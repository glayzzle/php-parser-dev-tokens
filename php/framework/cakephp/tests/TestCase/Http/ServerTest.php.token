[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * CakePHP(tm) : Rapid Development Framework (http:\/\/cakephp.org)\n * Copyright (c) Cake Software Foundation, Inc. (http:\/\/cakefoundation.org)\n *\n * Licensed under The MIT License\n * For full copyright and license information, please see the LICENSE.txt\n * Redistributions of files must retain the above copyright notice.\n *\n * @copyright     Copyright (c) Cake Software Foundation, Inc. (http:\/\/cakefoundation.org)\n * @link          http:\/\/cakephp.org CakePHP(tm) Project\n * @since         3.3.0\n * @license       http:\/\/www.opensource.org\/licenses\/mit-license.php MIT License\n *\/",2],["T_WHITESPACE","\n",14],["T_NAMESPACE","namespace",15],["T_WHITESPACE"," ",15],["T_STRING","Cake",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Test",15],["T_NS_SEPARATOR","\\",15],["T_STRING","TestCase",15],";",["T_WHITESPACE","\n\n",15],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Cake",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Http",17],["T_NS_SEPARATOR","\\",17],["T_STRING","CallbackStream",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Cake",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Http",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Server",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Cake",19],["T_NS_SEPARATOR","\\",19],["T_STRING","TestSuite",19],["T_NS_SEPARATOR","\\",19],["T_STRING","TestCase",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","TestApp",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Http",20],["T_NS_SEPARATOR","\\",20],["T_STRING","BadResponseApplication",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","TestApp",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Http",21],["T_NS_SEPARATOR","\\",21],["T_STRING","InvalidMiddlewareApplication",21],";",["T_WHITESPACE","\n",21],["T_USE","use",22],["T_WHITESPACE"," ",22],["T_STRING","TestApp",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Http",22],["T_NS_SEPARATOR","\\",22],["T_STRING","MiddlewareApplication",22],";",["T_WHITESPACE","\n",22],["T_USE","use",23],["T_WHITESPACE"," ",23],["T_STRING","Zend",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Diactoros",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Response",23],";",["T_WHITESPACE","\n",23],["T_USE","use",24],["T_WHITESPACE"," ",24],["T_STRING","Zend",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Diactoros",24],["T_NS_SEPARATOR","\\",24],["T_STRING","ServerRequestFactory",24],";",["T_WHITESPACE","\n\n",24],["T_REQUIRE_ONCE","require_once",26],["T_WHITESPACE"," ",26],["T_DIR","__DIR__",26],["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'\/server_mocks.php'",26],";",["T_WHITESPACE","\n\n\n",26],["T_DOC_COMMENT","\/**\n * Server test case\n *\/",29],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","ServerTest",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","TestCase",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_DOC_COMMENT","\/**\n     * Setup\n     *\n     * @return void\n     *\/",34],["T_WHITESPACE","\n    ",38],["T_PUBLIC","public",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","setUp",39],"(",")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_STRING","parent",41],["T_DOUBLE_COLON","::",41],["T_STRING","setUp",41],"(",")",";",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","server",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$_SERVER",42],";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","config",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","dirname",43],"(",["T_STRING","dirname",43],"(",["T_DIR","__DIR__",43],")",")",";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$GLOBALS",44],"[",["T_CONSTANT_ENCAPSED_STRING","'mockedHeaders'",44],"]",["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],"[","]",";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Teardown\n     *\n     * @return void\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","tearDown",52],"(",")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_STRING","parent",54],["T_DOUBLE_COLON","::",54],["T_STRING","tearDown",54],"(",")",";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$_SERVER",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","server",55],";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * test get\/set on the app\n     *\n     * @return void\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","testAppGetSet",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$app",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getMockBuilder",65],"(",["T_CONSTANT_ENCAPSED_STRING","'Cake\\Http\\BaseApplication'",65],")",["T_WHITESPACE","\n            ",65],["T_OBJECT_OPERATOR","->",66],["T_STRING","setConstructorArgs",66],"(","[",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","config",66],"]",")",["T_WHITESPACE","\n            ",66],["T_OBJECT_OPERATOR","->",67],["T_STRING","getMock",67],"(",")",";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$server",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_NEW","new",68],["T_WHITESPACE"," ",68],["T_STRING","Server",68],"(",["T_VARIABLE","$app",68],")",";",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","assertSame",69],"(",["T_VARIABLE","$app",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$server",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getApp",69],"(",["T_VARIABLE","$app",69],")",")",";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * test run building a response\n     *\n     * @return void\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","testRunWithRequestAndResponse",77],"(",")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$response",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_NEW","new",79],["T_WHITESPACE"," ",79],["T_STRING","Response",79],"(",["T_CONSTANT_ENCAPSED_STRING","'php:\/\/memory'",79],",",["T_WHITESPACE"," ",79],["T_LNUMBER","200",79],",",["T_WHITESPACE"," ",79],"[",["T_CONSTANT_ENCAPSED_STRING","'X-testing'",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'source header'",79],"]",")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$request",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","ServerRequestFactory",80],["T_DOUBLE_COLON","::",80],["T_STRING","fromGlobals",80],"(",")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$request",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$request",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","withHeader",81],"(",["T_CONSTANT_ENCAPSED_STRING","'X-pass'",81],",",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'request header'",81],")",";",["T_WHITESPACE","\n\n        ",81],["T_VARIABLE","$app",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_NEW","new",83],["T_WHITESPACE"," ",83],["T_STRING","MiddlewareApplication",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","config",83],")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$server",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_NEW","new",84],["T_WHITESPACE"," ",84],["T_STRING","Server",84],"(",["T_VARIABLE","$app",84],")",";",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$res",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$server",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","run",85],"(",["T_VARIABLE","$request",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$response",85],")",";",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","assertEquals",86],"(",["T_WHITESPACE","\n            ",86],["T_CONSTANT_ENCAPSED_STRING","'source header'",87],",",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$res",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getHeaderLine",88],"(",["T_CONSTANT_ENCAPSED_STRING","'X-testing'",88],")",",",["T_WHITESPACE","\n            ",88],["T_CONSTANT_ENCAPSED_STRING","'Input response is carried through out middleware'",89],["T_WHITESPACE","\n        ",89],")",";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","assertEquals",91],"(",["T_WHITESPACE","\n            ",91],["T_CONSTANT_ENCAPSED_STRING","'request header'",92],",",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$res",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getHeaderLine",93],"(",["T_CONSTANT_ENCAPSED_STRING","'X-pass'",93],")",",",["T_WHITESPACE","\n            ",93],["T_CONSTANT_ENCAPSED_STRING","'Request is used in middleware'",94],["T_WHITESPACE","\n        ",94],")",";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * test run building a request from globals.\n     *\n     * @return void\n     *\/",98],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","testRunWithGlobals",103],"(",")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$_SERVER",105],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_X_PASS'",105],"]",["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'globalvalue'",105],";",["T_WHITESPACE","\n\n        ",105],["T_VARIABLE","$app",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_NEW","new",107],["T_WHITESPACE"," ",107],["T_STRING","MiddlewareApplication",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","config",107],")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$server",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_NEW","new",108],["T_WHITESPACE"," ",108],["T_STRING","Server",108],"(",["T_VARIABLE","$app",108],")",";",["T_WHITESPACE","\n\n        ",108],["T_VARIABLE","$res",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$server",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","run",110],"(",")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","assertEquals",111],"(",["T_WHITESPACE","\n            ",111],["T_CONSTANT_ENCAPSED_STRING","'globalvalue'",112],",",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$res",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getHeaderLine",113],"(",["T_CONSTANT_ENCAPSED_STRING","'X-pass'",113],")",",",["T_WHITESPACE","\n            ",113],["T_CONSTANT_ENCAPSED_STRING","'Default request is made from server'",114],["T_WHITESPACE","\n        ",114],")",";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * test run where the protocol is invalid\n     *\n     * @return void\n     *\/",118],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","testRunInvalidProtocol",123],"(",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$_SERVER",125],"[",["T_CONSTANT_ENCAPSED_STRING","'SERVER_PROTOCOL'",125],"]",["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'HTTP\/onclick 1=1'",125],";",["T_WHITESPACE","\n\n        ",125],["T_VARIABLE","$app",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_NEW","new",127],["T_WHITESPACE"," ",127],["T_STRING","MiddlewareApplication",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","config",127],")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$server",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_NEW","new",128],["T_WHITESPACE"," ",128],["T_STRING","Server",128],"(",["T_VARIABLE","$app",128],")",";",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$res",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$server",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","run",130],"(",")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","assertEquals",131],"(",["T_LNUMBER","400",131],",",["T_WHITESPACE"," ",131],["T_VARIABLE","$res",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getStatusCode",131],"(",")",")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","assertEquals",132],"(",["T_CONSTANT_ENCAPSED_STRING","'text\/plain'",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$res",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getHeaderLine",132],"(",["T_CONSTANT_ENCAPSED_STRING","'content-type'",132],")",")",";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","assertEquals",133],"(",["T_CONSTANT_ENCAPSED_STRING","'Bad Request'",133],",",["T_WHITESPACE"," ",133],["T_CONSTANT_ENCAPSED_STRING","''",133],["T_WHITESPACE"," ",133],".",["T_WHITESPACE"," ",133],["T_VARIABLE","$res",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getBody",133],"(",")",")",";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * Test an application failing to build middleware properly\n     *\n     * @expectedException \\RuntimeException\n     * @expectedExceptionMessage The application `middleware` method\n     *\/",136],["T_WHITESPACE","\n    ",141],["T_PUBLIC","public",142],["T_WHITESPACE"," ",142],["T_FUNCTION","function",142],["T_WHITESPACE"," ",142],["T_STRING","testRunWithApplicationNotMakingMiddleware",142],"(",")",["T_WHITESPACE","\n    ",142],"{",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$app",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_NEW","new",144],["T_WHITESPACE"," ",144],["T_STRING","InvalidMiddlewareApplication",144],"(",["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","config",144],")",";",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$server",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_NEW","new",145],["T_WHITESPACE"," ",145],["T_STRING","Server",145],"(",["T_VARIABLE","$app",145],")",";",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$server",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","run",146],"(",")",";",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Test middleware being invoked.\n     *\n     * @return void\n     *\/",149],["T_WHITESPACE","\n    ",153],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","testRunMultipleMiddlewareSuccess",154],"(",")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$app",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_NEW","new",156],["T_WHITESPACE"," ",156],["T_STRING","MiddlewareApplication",156],"(",["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","config",156],")",";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$server",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_NEW","new",157],["T_WHITESPACE"," ",157],["T_STRING","Server",157],"(",["T_VARIABLE","$app",157],")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$res",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$server",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","run",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","assertSame",159],"(",["T_CONSTANT_ENCAPSED_STRING","'first'",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$res",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getHeaderLine",159],"(",["T_CONSTANT_ENCAPSED_STRING","'X-First'",159],")",")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","assertSame",160],"(",["T_CONSTANT_ENCAPSED_STRING","'second'",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$res",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getHeaderLine",160],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Second'",160],")",")",";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Test middleware not creating a response.\n     *\n     * @expectedException \\RuntimeException\n     * @expectedExceptionMessage Application did not create a response. Got \"Not a response\" instead.\n     *\/",163],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","testRunMiddlewareNoResponse",169],"(",")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$app",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_NEW","new",171],["T_WHITESPACE"," ",171],["T_STRING","BadResponseApplication",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","config",171],")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$server",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_NEW","new",172],["T_WHITESPACE"," ",172],["T_STRING","Server",172],"(",["T_VARIABLE","$app",172],")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$server",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","run",173],"(",")",";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n\n    ",174],["T_DOC_COMMENT","\/**\n     * Test that emit invokes the appropriate methods on the emitter.\n     *\n     * @return void\n     *\/",176],["T_WHITESPACE","\n    ",180],["T_PUBLIC","public",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","testEmit",181],"(",")",["T_WHITESPACE","\n    ",181],"{",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$response",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_NEW","new",183],["T_WHITESPACE"," ",183],["T_STRING","Response",183],"(",["T_CONSTANT_ENCAPSED_STRING","'php:\/\/memory'",183],",",["T_WHITESPACE"," ",183],["T_LNUMBER","200",183],",",["T_WHITESPACE"," ",183],"[",["T_CONSTANT_ENCAPSED_STRING","'x-testing'",183],["T_WHITESPACE"," ",183],["T_DOUBLE_ARROW","=>",183],["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'source header'",183],"]",")",";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$final",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$response",184],["T_WHITESPACE","\n            ",184],["T_OBJECT_OPERATOR","->",185],["T_STRING","withHeader",185],"(",["T_CONSTANT_ENCAPSED_STRING","'X-First'",185],",",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'first'",185],")",["T_WHITESPACE","\n            ",185],["T_OBJECT_OPERATOR","->",186],["T_STRING","withHeader",186],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Second'",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'second'",186],")",";",["T_WHITESPACE","\n\n        ",186],["T_VARIABLE","$emitter",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getMockBuilder",188],"(",["T_CONSTANT_ENCAPSED_STRING","'Zend\\Diactoros\\Response\\EmitterInterface'",188],")",["T_OBJECT_OPERATOR","->",188],["T_STRING","getMock",188],"(",")",";",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$emitter",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","expects",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","once",189],"(",")",")",["T_WHITESPACE","\n            ",189],["T_OBJECT_OPERATOR","->",190],["T_STRING","method",190],"(",["T_CONSTANT_ENCAPSED_STRING","'emit'",190],")",["T_WHITESPACE","\n            ",190],["T_OBJECT_OPERATOR","->",191],["T_STRING","with",191],"(",["T_VARIABLE","$final",191],")",";",["T_WHITESPACE","\n\n        ",191],["T_VARIABLE","$app",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_NEW","new",193],["T_WHITESPACE"," ",193],["T_STRING","MiddlewareApplication",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","config",193],")",";",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$server",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_NEW","new",194],["T_WHITESPACE"," ",194],["T_STRING","Server",194],"(",["T_VARIABLE","$app",194],")",";",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$server",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","emit",195],"(",["T_VARIABLE","$server",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","run",195],"(",["T_STRING","null",195],",",["T_WHITESPACE"," ",195],["T_VARIABLE","$response",195],")",",",["T_WHITESPACE"," ",195],["T_VARIABLE","$emitter",195],")",";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Test that emit invokes the appropriate methods on the emitter.\n     *\n     * @return void\n     *\/",198],["T_WHITESPACE","\n    ",202],["T_PUBLIC","public",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","testEmitCallbackStream",203],"(",")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$response",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_NEW","new",205],["T_WHITESPACE"," ",205],["T_STRING","Response",205],"(",["T_CONSTANT_ENCAPSED_STRING","'php:\/\/memory'",205],",",["T_WHITESPACE"," ",205],["T_LNUMBER","200",205],",",["T_WHITESPACE"," ",205],"[",["T_CONSTANT_ENCAPSED_STRING","'x-testing'",205],["T_WHITESPACE"," ",205],["T_DOUBLE_ARROW","=>",205],["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'source header'",205],"]",")",";",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$response",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$response",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","withBody",206],"(",["T_NEW","new",206],["T_WHITESPACE"," ",206],["T_STRING","CallbackStream",206],"(",["T_FUNCTION","function",206],["T_WHITESPACE"," ",206],"(",")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n            ",206],["T_ECHO","echo",207],["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'body content'",207],";",["T_WHITESPACE","\n        ",207],"}",")",")",";",["T_WHITESPACE","\n\n        ",208],["T_VARIABLE","$app",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_NEW","new",210],["T_WHITESPACE"," ",210],["T_STRING","MiddlewareApplication",210],"(",["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","config",210],")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$server",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_NEW","new",211],["T_WHITESPACE"," ",211],["T_STRING","Server",211],"(",["T_VARIABLE","$app",211],")",";",["T_WHITESPACE","\n        ",211],["T_STRING","ob_start",212],"(",")",";",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$server",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","emit",213],"(",["T_VARIABLE","$response",213],")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$result",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_STRING","ob_get_clean",214],"(",")",";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","assertEquals",215],"(",["T_CONSTANT_ENCAPSED_STRING","'body content'",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$result",215],")",";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Ensure that the Server.buildMiddleware event is fired.\n     *\n     * @return void\n     *\/",218],["T_WHITESPACE","\n    ",222],["T_PUBLIC","public",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","testBuildMiddlewareEvent",223],"(",")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$app",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_NEW","new",225],["T_WHITESPACE"," ",225],["T_STRING","MiddlewareApplication",225],"(",["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","config",225],")",";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$server",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_NEW","new",226],["T_WHITESPACE"," ",226],["T_STRING","Server",226],"(",["T_VARIABLE","$app",226],")",";",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","called",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_STRING","false",227],";",["T_WHITESPACE","\n\n        ",227],["T_VARIABLE","$server",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","eventManager",229],"(",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","on",229],"(",["T_CONSTANT_ENCAPSED_STRING","'Server.buildMiddleware'",229],",",["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],"(",["T_VARIABLE","$event",229],",",["T_WHITESPACE"," ",229],["T_VARIABLE","$middleware",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n            ",229],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","assertInstanceOf",230],"(",["T_CONSTANT_ENCAPSED_STRING","'Cake\\Http\\MiddlewareQueue'",230],",",["T_WHITESPACE"," ",230],["T_VARIABLE","$middleware",230],")",";",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$middleware",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","add",231],"(",["T_FUNCTION","function",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$req",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$res",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$next",231],")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n                ",231],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","called",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_STRING","true",232],";",["T_WHITESPACE","\n\n                ",232],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$next",234],"(",["T_VARIABLE","$req",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$res",234],")",";",["T_WHITESPACE","\n            ",234],"}",")",";",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","middleware",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_VARIABLE","$middleware",236],";",["T_WHITESPACE","\n        ",236],"}",")",";",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$server",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","run",238],"(",")",";",["T_WHITESPACE","\n        ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","assertTrue",239],"(",["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","called",239],",",["T_WHITESPACE"," ",239],["T_CONSTANT_ENCAPSED_STRING","'Middleware added in the event was not triggered.'",239],")",";",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","assertInstanceOf",240],"(",["T_CONSTANT_ENCAPSED_STRING","'Closure'",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","middleware",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","get",240],"(",["T_LNUMBER","3",240],")",",",["T_WHITESPACE"," ",240],["T_CONSTANT_ENCAPSED_STRING","'2nd last middleware is a closure'",240],")",";",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","assertSame",241],"(",["T_VARIABLE","$app",241],",",["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","middleware",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","get",241],"(",["T_LNUMBER","4",241],")",",",["T_WHITESPACE"," ",241],["T_CONSTANT_ENCAPSED_STRING","'Last middleware is an app instance'",241],")",";",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n",242],"}",["T_WHITESPACE","\n",243]]