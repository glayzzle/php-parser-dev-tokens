[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * CakePHP(tm) : Rapid Development Framework (http:\/\/cakephp.org)\n * Copyright (c) Cake Software Foundation, Inc. (http:\/\/cakefoundation.org)\n *\n * Licensed under The MIT License\n * For full copyright and license information, please see the LICENSE.txt\n * Redistributions of files must retain the above copyright notice.\n *\n * @copyright     Copyright (c) Cake Software Foundation, Inc. (http:\/\/cakefoundation.org)\n * @link          http:\/\/cakephp.org CakePHP(tm) Project\n * @since         3.0.0\n * @license       http:\/\/www.opensource.org\/licenses\/mit-license.php MIT License\n *\/",2],["T_WHITESPACE","\n",14],["T_NAMESPACE","namespace",15],["T_WHITESPACE"," ",15],["T_STRING","Cake",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Controller",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],";",["T_WHITESPACE","\n\n",15],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Cake",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Controller",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Component",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Cake",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Event",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Event",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Cake",19],["T_NS_SEPARATOR","\\",19],["T_STRING","I18n",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Time",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Cake",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Network",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Exception",20],["T_NS_SEPARATOR","\\",20],["T_STRING","InvalidCsrfTokenException",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Cake",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Network",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Request",21],";",["T_WHITESPACE","\n",21],["T_USE","use",22],["T_WHITESPACE"," ",22],["T_STRING","Cake",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Network",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Response",22],";",["T_WHITESPACE","\n",22],["T_USE","use",23],["T_WHITESPACE"," ",23],["T_STRING","Cake",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Utility",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Security",23],";",["T_WHITESPACE","\n\n",23],["T_DOC_COMMENT","\/**\n * Provides CSRF protection & validation.\n *\n * This component adds a CSRF token to a cookie. The cookie value is compared to\n * request data, or the X-CSRF-Token header on each PATCH, POST,\n * PUT, or DELETE request.\n *\n * If the request data is missing or does not match the cookie data,\n * an InvalidCsrfTokenException will be raised.\n *\n * This component integrates with the FormHelper automatically and when\n * used together your forms will have CSRF tokens automatically added\n * when `$this->Form->create(...)` is used in a view.\n *\/",25],["T_WHITESPACE","\n",38],["T_CLASS","class",39],["T_WHITESPACE"," ",39],["T_STRING","CsrfComponent",39],["T_WHITESPACE"," ",39],["T_EXTENDS","extends",39],["T_WHITESPACE"," ",39],["T_STRING","Component",39],["T_WHITESPACE","\n",39],"{",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Default config for the CSRF handling.\n     *\n     *  - cookieName = The name of the cookie to send.\n     *  - expiry = How long the CSRF token should last. Defaults to browser session.\n     *  - secure = Whether or not the cookie will be set with the Secure flag. Defaults to false.\n     *  - httpOnly = Whether or not the cookie will be set with the HttpOnly flag. Defaults to false.\n     *  - field = The form field to check. Changing this will also require configuring\n     *    FormHelper.\n     *\n     * @var array\n     *\/",42],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_defaultConfig",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],"[",["T_WHITESPACE","\n        ",54],["T_CONSTANT_ENCAPSED_STRING","'cookieName'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'csrfToken'",55],",",["T_WHITESPACE","\n        ",55],["T_CONSTANT_ENCAPSED_STRING","'expiry'",56],["T_WHITESPACE"," ",56],["T_DOUBLE_ARROW","=>",56],["T_WHITESPACE"," ",56],["T_LNUMBER","0",56],",",["T_WHITESPACE","\n        ",56],["T_CONSTANT_ENCAPSED_STRING","'secure'",57],["T_WHITESPACE"," ",57],["T_DOUBLE_ARROW","=>",57],["T_WHITESPACE"," ",57],["T_STRING","false",57],",",["T_WHITESPACE","\n        ",57],["T_CONSTANT_ENCAPSED_STRING","'httpOnly'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_STRING","false",58],",",["T_WHITESPACE","\n        ",58],["T_CONSTANT_ENCAPSED_STRING","'field'",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'_csrfToken'",59],",",["T_WHITESPACE","\n    ",59],"]",";",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Startup callback.\n     *\n     * Validates the CSRF token for POST data. If\n     * the request is a GET request, and the cookie value is absent a cookie will be set.\n     *\n     * Once a cookie is set it will be copied into request->params['_csrfToken']\n     * so that application and framework code can easily access the csrf token.\n     *\n     * RequestAction requests do not get checked, nor will\n     * they set a cookie should it be missing.\n     *\n     * @param \\Cake\\Event\\Event $event Event instance.\n     * @return void\n     *\/",62],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","startup",77],"(",["T_STRING","Event",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$event",77],")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$controller",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$event",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","subject",79],"(",")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$request",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$controller",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","request",80],";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$response",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$controller",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","response",81],";",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$cookieName",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_config",82],"[",["T_CONSTANT_ENCAPSED_STRING","'cookieName'",82],"]",";",["T_WHITESPACE","\n\n        ",82],["T_COMMENT","\/* @var \\Cake\\Network\\Request $request *\/",84],["T_WHITESPACE","\n        ",84],["T_VARIABLE","$cookieData",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$request",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","cookie",85],"(",["T_VARIABLE","$cookieName",85],")",";",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$cookieData",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$request",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","params",87],"[",["T_CONSTANT_ENCAPSED_STRING","'_csrfToken'",87],"]",["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$cookieData",87],";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n\n        ",88],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$request",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","is",90],"(",["T_CONSTANT_ENCAPSED_STRING","'requested'",90],")",")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_RETURN","return",91],";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_VARIABLE","$request",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","is",94],"(",["T_CONSTANT_ENCAPSED_STRING","'get'",94],")",["T_WHITESPACE"," ",94],["T_BOOLEAN_AND","&&",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$cookieData",94],["T_WHITESPACE"," ",94],["T_IS_IDENTICAL","===",94],["T_WHITESPACE"," ",94],["T_STRING","null",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n            ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_setCookie",95],"(",["T_VARIABLE","$request",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$response",95],")",";",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n        ",96],["T_IF","if",97],["T_WHITESPACE"," ",97],"(",["T_VARIABLE","$request",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","is",97],"(","[",["T_CONSTANT_ENCAPSED_STRING","'put'",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'post'",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'delete'",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'patch'",97],"]",")",["T_WHITESPACE"," ",97],["T_BOOLEAN_OR","||",97],["T_WHITESPACE"," ",97],"!",["T_EMPTY","empty",97],"(",["T_VARIABLE","$request",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","data",97],")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_validateToken",98],"(",["T_VARIABLE","$request",98],")",";",["T_WHITESPACE","\n            ",98],["T_UNSET","unset",99],"(",["T_VARIABLE","$request",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","data",99],"[",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_config",99],"[",["T_CONSTANT_ENCAPSED_STRING","'field'",99],"]","]",")",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Events supported by this component.\n     *\n     * @return array\n     *\/",103],["T_WHITESPACE","\n    ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","implementedEvents",108],"(",")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],"[",["T_WHITESPACE","\n            ",110],["T_CONSTANT_ENCAPSED_STRING","'Controller.startup'",111],["T_WHITESPACE"," ",111],["T_DOUBLE_ARROW","=>",111],["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'startup'",111],",",["T_WHITESPACE","\n        ",111],"]",";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * Set the cookie in the response.\n     *\n     * Also sets the request->params['_csrfToken'] so the newly minted\n     * token is available in the request data.\n     *\n     * @param \\Cake\\Network\\Request $request The request object.\n     * @param \\Cake\\Network\\Response $response The response object.\n     * @return void\n     *\/",115],["T_WHITESPACE","\n    ",124],["T_PROTECTED","protected",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","_setCookie",125],"(",["T_STRING","Request",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$request",125],",",["T_WHITESPACE"," ",125],["T_STRING","Response",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$response",125],")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$expiry",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_NEW","new",127],["T_WHITESPACE"," ",127],["T_STRING","Time",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_config",127],"[",["T_CONSTANT_ENCAPSED_STRING","'expiry'",127],"]",")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$value",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_STRING","hash",128],"(",["T_CONSTANT_ENCAPSED_STRING","'sha512'",128],",",["T_WHITESPACE"," ",128],["T_STRING","Security",128],["T_DOUBLE_COLON","::",128],["T_STRING","randomBytes",128],"(",["T_LNUMBER","16",128],")",",",["T_WHITESPACE"," ",128],["T_STRING","false",128],")",";",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$request",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","params",130],"[",["T_CONSTANT_ENCAPSED_STRING","'_csrfToken'",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$value",130],";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$response",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","cookie",131],"(","[",["T_WHITESPACE","\n            ",131],["T_CONSTANT_ENCAPSED_STRING","'name'",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_config",132],"[",["T_CONSTANT_ENCAPSED_STRING","'cookieName'",132],"]",",",["T_WHITESPACE","\n            ",132],["T_CONSTANT_ENCAPSED_STRING","'value'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$value",133],",",["T_WHITESPACE","\n            ",133],["T_CONSTANT_ENCAPSED_STRING","'expire'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$expiry",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","format",134],"(",["T_CONSTANT_ENCAPSED_STRING","'U'",134],")",",",["T_WHITESPACE","\n            ",134],["T_CONSTANT_ENCAPSED_STRING","'path'",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$request",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","webroot",135],",",["T_WHITESPACE","\n            ",135],["T_CONSTANT_ENCAPSED_STRING","'secure'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_config",136],"[",["T_CONSTANT_ENCAPSED_STRING","'secure'",136],"]",",",["T_WHITESPACE","\n            ",136],["T_CONSTANT_ENCAPSED_STRING","'httpOnly'",137],["T_WHITESPACE"," ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_config",137],"[",["T_CONSTANT_ENCAPSED_STRING","'httpOnly'",137],"]",",",["T_WHITESPACE","\n        ",137],"]",")",";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n\n    ",139],["T_DOC_COMMENT","\/**\n     * Validate the request data against the cookie token.\n     *\n     * @param \\Cake\\Network\\Request $request The request to validate against.\n     * @throws \\Cake\\Network\\Exception\\InvalidCsrfTokenException when the CSRF token is invalid or missing.\n     * @return void\n     *\/",141],["T_WHITESPACE","\n    ",147],["T_PROTECTED","protected",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","_validateToken",148],"(",["T_STRING","Request",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$request",148],")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$cookie",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$request",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","cookie",150],"(",["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_config",150],"[",["T_CONSTANT_ENCAPSED_STRING","'cookieName'",150],"]",")",";",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$post",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$request",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","data",151],"(",["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_config",151],"[",["T_CONSTANT_ENCAPSED_STRING","'field'",151],"]",")",";",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$header",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$request",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","header",152],"(",["T_CONSTANT_ENCAPSED_STRING","'X-CSRF-Token'",152],")",";",["T_WHITESPACE","\n\n        ",152],["T_IF","if",154],["T_WHITESPACE"," ",154],"(","!",["T_VARIABLE","$cookie",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_THROW","throw",155],["T_WHITESPACE"," ",155],["T_NEW","new",155],["T_WHITESPACE"," ",155],["T_STRING","InvalidCsrfTokenException",155],"(",["T_STRING","__d",155],"(",["T_CONSTANT_ENCAPSED_STRING","'cake'",155],",",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'Missing CSRF token cookie'",155],")",")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n\n        ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$post",158],["T_WHITESPACE"," ",158],["T_IS_NOT_IDENTICAL","!==",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$cookie",158],["T_WHITESPACE"," ",158],["T_BOOLEAN_AND","&&",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$header",158],["T_WHITESPACE"," ",158],["T_IS_NOT_IDENTICAL","!==",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$cookie",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_THROW","throw",159],["T_WHITESPACE"," ",159],["T_NEW","new",159],["T_WHITESPACE"," ",159],["T_STRING","InvalidCsrfTokenException",159],"(",["T_STRING","__d",159],"(",["T_CONSTANT_ENCAPSED_STRING","'cake'",159],",",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'CSRF token mismatch.'",159],")",")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n",161],"}",["T_WHITESPACE","\n",162]]