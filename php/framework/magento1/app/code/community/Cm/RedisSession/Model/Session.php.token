[["T_OPEN_TAG","<?php\n",1],["T_COMMENT","\/*\n==New BSD License==\n\nCopyright (c) 2013, Colin Mollenhour\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above copyright\n      notice, this list of conditions and the following disclaimer in the\n      documentation and\/or other materials provided with the distribution.\n    * The name of Colin Mollenhour may not be used to endorse or promote products\n      derived from this software without specific prior written permission.\n    * Redistributions in any form must not change the Cm_RedisSession namespace.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE LIABLE FOR ANY\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n *\/",2],["T_WHITESPACE","\n",30],["T_DOC_COMMENT","\/**\n * Redis session handler with optimistic locking.\n *\n * Features:\n *  - Falls back to mysql handler if it can't connect to redis. Mysql handler falls back to file handler.\n *  - When a session's data exceeds the compression threshold the session data will be compressed.\n *  - Compression libraries supported are 'gzip', 'lzf', 'lz4' and 'snappy'.\n *  - Compression can be enabled, disabled, or reconfigured on the fly with no loss of session data.\n *  - Expiration is handled by Redis. No garbage collection needed.\n *  - Logs when sessions are not written due to not having or losing their lock.\n *  - Limits the number of concurrent lock requests before a 503 error is returned.\n *\n * Locking Algorithm Properties:\n *  - Only one process may get a write lock on a session.\n *  - A process may lose it's lock if another process breaks it, in which case the session will not be written.\n *  - The lock may be broken after BREAK_AFTER seconds and the process that gets the lock is indeterminate.\n *  - Only MAX_CONCURRENCY processes may be waiting for a lock for the same session or else a 503 error is returned.\n *  - Detects crashed processes to prevent session deadlocks (Linux only).\n *  - Detects inactive waiting processes to prevent false-positives in concurrency throttling.\n *\n *\/",31],["T_WHITESPACE","\n",51],["T_CLASS","class",52],["T_WHITESPACE"," ",52],["T_STRING","Cm_RedisSession_Model_Session",52],["T_WHITESPACE"," ",52],["T_EXTENDS","extends",52],["T_WHITESPACE"," ",52],["T_STRING","Mage_Core_Model_Mysql4_Session",52],["T_WHITESPACE","\n",52],"{",["T_WHITESPACE","\n    ",53],["T_CONST","const",54],["T_WHITESPACE"," ",54],["T_STRING","SLEEP_TIME",54],["T_WHITESPACE","         ",54],"=",["T_WHITESPACE"," ",54],["T_LNUMBER","500000",54],";",["T_WHITESPACE","   ",54],["T_COMMENT","\/* Sleep 0.5 seconds between lock attempts (1,000,000 == 1 second) *\/",54],["T_WHITESPACE","\n    ",54],["T_CONST","const",55],["T_WHITESPACE"," ",55],["T_STRING","FAIL_AFTER",55],["T_WHITESPACE","         ",55],"=",["T_WHITESPACE"," ",55],["T_LNUMBER","15",55],";",["T_WHITESPACE","       ",55],["T_COMMENT","\/* Try to break lock for at most this many seconds *\/",55],["T_WHITESPACE","\n    ",55],["T_CONST","const",56],["T_WHITESPACE"," ",56],["T_STRING","DETECT_ZOMBIES",56],["T_WHITESPACE","     ",56],"=",["T_WHITESPACE"," ",56],["T_LNUMBER","20",56],";",["T_WHITESPACE","        ",56],["T_COMMENT","\/* Try to detect zombies every this many tries *\/",56],["T_WHITESPACE","\n    ",56],["T_CONST","const",57],["T_WHITESPACE"," ",57],["T_STRING","SESSION_PREFIX",57],["T_WHITESPACE","     ",57],"=",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'sess_'",57],";",["T_WHITESPACE","\n    ",57],["T_CONST","const",58],["T_WHITESPACE"," ",58],["T_STRING","LOG_FILE",58],["T_WHITESPACE","           ",58],"=",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'redis_session.log'",58],";",["T_WHITESPACE","\n\n    ",58],["T_COMMENT","\/* Bots get shorter session lifetimes *\/",60],["T_WHITESPACE","\n    ",60],["T_CONST","const",61],["T_WHITESPACE"," ",61],["T_STRING","BOT_REGEX",61],["T_WHITESPACE","          ",61],"=",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'\/^alexa|^blitz\\.io|bot|^browsermob|crawl|^curl|^facebookexternalhit|feed|google web preview|^ia_archiver|indexer|^java|jakarta|^libwww-perl|^load impact|^magespeedtest|monitor|^Mozilla$|nagios|^\\.net|^pinterest|postrank|slurp|spider|uptime|^wget|yandex\/i'",61],";",["T_WHITESPACE","\n\n    ",61],["T_CONST","const",63],["T_WHITESPACE"," ",63],["T_STRING","DEFAULT_TIMEOUT",63],["T_WHITESPACE","               ",63],"=",["T_WHITESPACE"," ",63],["T_DNUMBER","2.5",63],";",["T_WHITESPACE","\n    ",63],["T_CONST","const",64],["T_WHITESPACE"," ",64],["T_STRING","DEFAULT_COMPRESSION_THRESHOLD",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_LNUMBER","2048",64],";",["T_WHITESPACE","\n    ",64],["T_CONST","const",65],["T_WHITESPACE"," ",65],["T_STRING","DEFAULT_COMPRESSION_LIB",65],["T_WHITESPACE","       ",65],"=",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'gzip'",65],";",["T_WHITESPACE","\n    ",65],["T_CONST","const",66],["T_WHITESPACE"," ",66],["T_STRING","DEFAULT_LOG_LEVEL",66],["T_WHITESPACE","             ",66],"=",["T_WHITESPACE"," ",66],["T_LNUMBER","1",66],";",["T_WHITESPACE","\n    ",66],["T_CONST","const",67],["T_WHITESPACE"," ",67],["T_STRING","DEFAULT_MAX_CONCURRENCY",67],["T_WHITESPACE","       ",67],"=",["T_WHITESPACE"," ",67],["T_LNUMBER","6",67],";",["T_WHITESPACE","        ",67],["T_COMMENT","\/* The maximum number of concurrent lock waiters per session *\/",67],["T_WHITESPACE","\n    ",67],["T_CONST","const",68],["T_WHITESPACE"," ",68],["T_STRING","DEFAULT_BREAK_AFTER",68],["T_WHITESPACE","           ",68],"=",["T_WHITESPACE"," ",68],["T_LNUMBER","30",68],";",["T_WHITESPACE","       ",68],["T_COMMENT","\/* Try to break the lock after this many seconds *\/",68],["T_WHITESPACE","\n    ",68],["T_CONST","const",69],["T_WHITESPACE"," ",69],["T_STRING","DEFAULT_FIRST_LIFETIME",69],["T_WHITESPACE","        ",69],"=",["T_WHITESPACE"," ",69],["T_LNUMBER","600",69],";",["T_WHITESPACE","      ",69],["T_COMMENT","\/* The session lifetime for non-bots on the first write *\/",69],["T_WHITESPACE","\n    ",69],["T_CONST","const",70],["T_WHITESPACE"," ",70],["T_STRING","DEFAULT_BOT_FIRST_LIFETIME",70],["T_WHITESPACE","    ",70],"=",["T_WHITESPACE"," ",70],["T_LNUMBER","60",70],";",["T_WHITESPACE","       ",70],["T_COMMENT","\/* The session lifetime for bots on the first write *\/",70],["T_WHITESPACE","\n    ",70],["T_CONST","const",71],["T_WHITESPACE"," ",71],["T_STRING","DEFAULT_BOT_LIFETIME",71],["T_WHITESPACE","          ",71],"=",["T_WHITESPACE"," ",71],["T_LNUMBER","7200",71],";",["T_WHITESPACE","     ",71],["T_COMMENT","\/* The session lifetime for bots - shorter to prevent bots from wasting backend storage *\/",71],["T_WHITESPACE","\n    ",71],["T_CONST","const",72],["T_WHITESPACE"," ",72],["T_STRING","DEFAULT_DISABLE_LOCKING",72],["T_WHITESPACE","       ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","FALSE",72],";",["T_WHITESPACE","    ",72],["T_COMMENT","\/* Session locking is enabled by default *\/",72],["T_WHITESPACE","\n    ",72],["T_CONST","const",73],["T_WHITESPACE"," ",73],["T_STRING","DEFAULT_MAX_LIFETIME",73],["T_WHITESPACE","\t\t",73],"=",["T_WHITESPACE"," ",73],["T_LNUMBER","2592000",73],";",["T_WHITESPACE","  ",73],["T_COMMENT","\/* Redis backend limit *\/",73],["T_WHITESPACE","\n    ",73],["T_CONST","const",74],["T_WHITESPACE"," ",74],["T_STRING","DEFAULT_MIN_LIFETIME",74],["T_WHITESPACE","\t\t",74],"=",["T_WHITESPACE"," ",74],["T_LNUMBER","60",74],";",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/** @var bool *\/",76],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_useRedis",77],";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/** @var Credis_Client *\/",79],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$_redis",80],";",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/** @var int *\/",82],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$_dbNum",83],";",["T_WHITESPACE","\n\n    ",83],["T_PROTECTED","protected",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$_config",85],";",["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$_compressionThreshold",86],";",["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$_compressionLib",87],";",["T_WHITESPACE","\n    ",87],["T_PROTECTED","protected",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$_logLevel",88],";",["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$_maxConcurrency",89],";",["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$_breakAfter",90],";",["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$_useLocking",91],";",["T_WHITESPACE","\n    ",91],["T_PROTECTED","protected",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$_hasLock",92],";",["T_WHITESPACE","\n    ",92],["T_PROTECTED","protected",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$_sessionWritten",93],";",["T_WHITESPACE"," ",93],["T_COMMENT","\/\/ avoid infinite loops\n",93],["T_WHITESPACE","    ",94],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$_sessionWrites",94],";",["T_WHITESPACE"," ",94],["T_COMMENT","\/\/ set expire time based on activity\n",94],["T_WHITESPACE","    ",95],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$_maxLifetime",95],";",["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$_minLifetime",96],";",["T_WHITESPACE","\n\n    ",96],["T_STATIC","static",98],["T_WHITESPACE"," ",98],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$failedLockAttempts",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_LNUMBER","0",98],";",["T_WHITESPACE"," ",98],["T_COMMENT","\/\/ for debug or informational purposes\n",98],["T_WHITESPACE","\n    ",99],["T_PUBLIC","public",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","__construct",100],"(",")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_config",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$config",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","Mage",102],["T_DOUBLE_COLON","::",102],["T_STRING","getConfig",102],"(",")",["T_OBJECT_OPERATOR","->",102],["T_STRING","getNode",102],"(",["T_CONSTANT_ENCAPSED_STRING","'global\/redis_session'",102],")",";",["T_WHITESPACE","\n        ",102],["T_IF","if",103],["T_WHITESPACE"," ",103],"(","!",["T_VARIABLE","$config",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_useRedis",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_STRING","FALSE",104],";",["T_WHITESPACE","\n            ",104],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","log",105],"(",["T_CONSTANT_ENCAPSED_STRING","'Redis configuration does not exist, falling back to MySQL handler.'",105],",",["T_WHITESPACE"," ",105],["T_STRING","Zend_Log",105],["T_DOUBLE_COLON","::",105],["T_STRING","EMERG",105],")",";",["T_WHITESPACE","\n            ",105],["T_STRING","parent",106],["T_DOUBLE_COLON","::",106],["T_STRING","__construct",106],"(",")",";",["T_WHITESPACE","\n            ",106],["T_RETURN","return",107],";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n\n        ",108],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_logLevel",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE","  ",110],"(",["T_INT_CAST","(int)",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$config",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","descend",110],"(",["T_CONSTANT_ENCAPSED_STRING","'log_level'",110],")",["T_WHITESPACE"," ",110],"?",":",["T_WHITESPACE"," ",110],["T_STRING","self",110],["T_DOUBLE_COLON","::",110],["T_STRING","DEFAULT_LOG_LEVEL",110],")",";",["T_WHITESPACE","\n        ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_logLevel",111],["T_WHITESPACE"," ",111],["T_IS_GREATER_OR_EQUAL",">=",111],["T_WHITESPACE"," ",111],["T_STRING","Zend_Log",111],["T_DOUBLE_COLON","::",111],["T_STRING","DEBUG",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$timeStart",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","microtime",112],"(",["T_STRING","true",112],")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n        ",113],["T_COMMENT","\/\/ Database config\n",115],["T_WHITESPACE","        ",116],["T_VARIABLE","$host",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE","        ",116],"(",["T_STRING_CAST","(string)",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$config",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","descend",116],"(",["T_CONSTANT_ENCAPSED_STRING","'host'",116],")",["T_WHITESPACE"," ",116],"?",":",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'127.0.0.1'",116],")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$port",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE","           ",117],"(",["T_INT_CAST","(int)",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$config",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","descend",117],"(",["T_CONSTANT_ENCAPSED_STRING","'port'",117],")",["T_WHITESPACE"," ",117],"?",":",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'6379'",117],")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$pass",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE","        ",118],"(",["T_STRING_CAST","(string)",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$config",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","descend",118],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",118],")",["T_WHITESPACE"," ",118],"?",":",["T_WHITESPACE"," ",118],["T_CONSTANT_ENCAPSED_STRING","''",118],")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$timeout",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE","      ",119],"(",["T_DOUBLE_CAST","(float)",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$config",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","descend",119],"(",["T_CONSTANT_ENCAPSED_STRING","'timeout'",119],")",["T_WHITESPACE"," ",119],"?",":",["T_WHITESPACE"," ",119],["T_STRING","self",119],["T_DOUBLE_COLON","::",119],["T_STRING","DEFAULT_TIMEOUT",119],")",";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$persistent",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE","  ",120],"(",["T_STRING_CAST","(string)",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$config",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","descend",120],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",120],")",["T_WHITESPACE"," ",120],"?",":",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","''",120],")",";",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_dbNum",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE","   ",121],"(",["T_INT_CAST","(int)",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$config",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","descend",121],"(",["T_CONSTANT_ENCAPSED_STRING","'db'",121],")",["T_WHITESPACE"," ",121],"?",":",["T_WHITESPACE"," ",121],["T_LNUMBER","0",121],")",";",["T_WHITESPACE","\n\n        ",121],["T_COMMENT","\/\/ General config\n",123],["T_WHITESPACE","        ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_compressionThreshold",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE","  ",124],"(",["T_INT_CAST","(int)",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$config",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","descend",124],"(",["T_CONSTANT_ENCAPSED_STRING","'compression_threshold'",124],")",["T_WHITESPACE"," ",124],"?",":",["T_WHITESPACE"," ",124],["T_STRING","self",124],["T_DOUBLE_COLON","::",124],["T_STRING","DEFAULT_COMPRESSION_THRESHOLD",124],")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_compressionLib",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE","     ",125],"(",["T_STRING_CAST","(string)",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$config",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","descend",125],"(",["T_CONSTANT_ENCAPSED_STRING","'compression_lib'",125],")",["T_WHITESPACE"," ",125],"?",":",["T_WHITESPACE"," ",125],["T_STRING","self",125],["T_DOUBLE_COLON","::",125],["T_STRING","DEFAULT_COMPRESSION_LIB",125],")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_maxConcurrency",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE","        ",126],"(",["T_INT_CAST","(int)",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$config",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","descend",126],"(",["T_CONSTANT_ENCAPSED_STRING","'max_concurrency'",126],")",["T_WHITESPACE"," ",126],"?",":",["T_WHITESPACE"," ",126],["T_STRING","self",126],["T_DOUBLE_COLON","::",126],["T_STRING","DEFAULT_MAX_CONCURRENCY",126],")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_breakAfter",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE","          ",127],"(",["T_DOUBLE_CAST","(float)",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$config",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","descend",127],"(",["T_CONSTANT_ENCAPSED_STRING","'break_after_'",127],".",["T_STRING","session_name",127],"(",")",")",["T_WHITESPACE"," ",127],"?",":",["T_WHITESPACE"," ",127],["T_STRING","self",127],["T_DOUBLE_COLON","::",127],["T_STRING","DEFAULT_BREAK_AFTER",127],")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_maxLifetime",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE","           ",128],"(",["T_INT_CAST","(int)",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$config",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","descend",128],"(",["T_CONSTANT_ENCAPSED_STRING","'max_lifetime'",128],")",["T_WHITESPACE"," ",128],"?",":",["T_WHITESPACE"," ",128],["T_STRING","self",128],["T_DOUBLE_COLON","::",128],["T_STRING","DEFAULT_MAX_LIFETIME",128],")",";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_minLifetime",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE","           ",129],"(",["T_INT_CAST","(int)",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$config",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","descend",129],"(",["T_CONSTANT_ENCAPSED_STRING","'min_lifetime'",129],")",["T_WHITESPACE"," ",129],"?",":",["T_WHITESPACE"," ",129],["T_STRING","self",129],["T_DOUBLE_COLON","::",129],["T_STRING","DEFAULT_MIN_LIFETIME",129],")",";",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_useLocking",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","defined",130],"(",["T_CONSTANT_ENCAPSED_STRING","'CM_REDISSESSION_LOCKING_ENABLED'",130],")",["T_WHITESPACE","\n                    ",130],"?",["T_WHITESPACE"," ",131],["T_STRING","CM_REDISSESSION_LOCKING_ENABLED",131],["T_WHITESPACE","\n                    ",131],":",["T_WHITESPACE"," ",132],"!",["T_WHITESPACE"," ",132],"(",["T_INT_CAST","(int)",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$config",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","descend",132],"(",["T_CONSTANT_ENCAPSED_STRING","'disable_locking'",132],")",["T_WHITESPACE"," ",132],"?",":",["T_WHITESPACE"," ",132],["T_STRING","self",132],["T_DOUBLE_COLON","::",132],["T_STRING","DEFAULT_DISABLE_LOCKING",132],")",";",["T_WHITESPACE","\n\n        ",132],["T_COMMENT","\/\/ Use sleep time multiplier so break time is in seconds\n",134],["T_WHITESPACE","        ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_breakAfter",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_INT_CAST","(int)",135],["T_WHITESPACE"," ",135],["T_STRING","round",135],"(","(",["T_LNUMBER","1000000",135],["T_WHITESPACE"," ",135],"\/",["T_WHITESPACE"," ",135],["T_STRING","self",135],["T_DOUBLE_COLON","::",135],["T_STRING","SLEEP_TIME",135],")",["T_WHITESPACE"," ",135],"*",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_breakAfter",135],")",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_failAfter",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_INT_CAST","(int)",136],["T_WHITESPACE"," ",136],["T_STRING","round",136],"(","(",["T_LNUMBER","1000000",136],["T_WHITESPACE"," ",136],"\/",["T_WHITESPACE"," ",136],["T_STRING","self",136],["T_DOUBLE_COLON","::",136],["T_STRING","SLEEP_TIME",136],")",["T_WHITESPACE"," ",136],"*",["T_WHITESPACE"," ",136],["T_STRING","self",136],["T_DOUBLE_COLON","::",136],["T_STRING","FAIL_AFTER",136],")",";",["T_WHITESPACE","\n\n        ",136],["T_COMMENT","\/\/ Connect and authenticate\n",138],["T_WHITESPACE","        ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_redis",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_NEW","new",139],["T_WHITESPACE"," ",139],["T_STRING","Credis_Client",139],"(",["T_VARIABLE","$host",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$port",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$timeout",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$persistent",139],")",";",["T_WHITESPACE","\n        ",139],["T_IF","if",140],["T_WHITESPACE"," ",140],"(","!",["T_EMPTY","empty",140],"(",["T_VARIABLE","$pass",140],")",")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_redis",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","auth",141],"(",["T_VARIABLE","$pass",141],")",["T_WHITESPACE"," ",141],["T_LOGICAL_OR","or",141],["T_WHITESPACE"," ",141],["T_STRING","Zend_Cache",141],["T_DOUBLE_COLON","::",141],["T_STRING","throwException",141],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to authenticate with the redis server.'",141],")",";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_redis",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","setCloseOnDestruct",143],"(",["T_STRING","FALSE",143],")",";",["T_WHITESPACE","  ",143],["T_COMMENT","\/\/ Destructor order cannot be predicted\n",143],["T_WHITESPACE","        ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_useRedis",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","TRUE",144],";",["T_WHITESPACE","\n        ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_logLevel",145],["T_WHITESPACE"," ",145],["T_IS_GREATER_OR_EQUAL",">=",145],["T_WHITESPACE"," ",145],["T_STRING","Zend_Log",145],["T_DOUBLE_COLON","::",145],["T_STRING","DEBUG",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_log",146],"(",["T_STRING","sprintf",146],"(",["T_CONSTANT_ENCAPSED_STRING","\"%s initialized for connection to %s:%s after %.5f seconds\"",146],",",["T_WHITESPACE","\n                ",146],["T_STRING","get_class",147],"(",["T_VARIABLE","$this",147],")",",",["T_WHITESPACE"," ",147],["T_VARIABLE","$host",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$port",147],",",["T_WHITESPACE"," ",147],"(",["T_STRING","microtime",147],"(",["T_STRING","true",147],")",["T_WHITESPACE"," ",147],"-",["T_WHITESPACE"," ",147],["T_VARIABLE","$timeStart",147],")",["T_WHITESPACE","\n            ",147],")",")",";",["T_WHITESPACE","\n        ",148],"}",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n\n    ",150],["T_DOC_COMMENT","\/**\n     * @param $msg\n     * @param $level\n     *\/",152],["T_WHITESPACE","\n    ",155],["T_PROTECTED","protected",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","_log",156],"(",["T_VARIABLE","$msg",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$level",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_STRING","Zend_Log",156],["T_DOUBLE_COLON","::",156],["T_STRING","DEBUG",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_STRING","Mage",158],["T_DOUBLE_COLON","::",158],["T_STRING","log",158],"(","\"",["T_CURLY_OPEN","{",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getPid",158],"(",")","}",["T_ENCAPSED_AND_WHITESPACE",": ",158],["T_VARIABLE","$msg",158],"\"",",",["T_WHITESPACE"," ",158],["T_VARIABLE","$level",158],",",["T_WHITESPACE"," ",158],["T_STRING","self",158],["T_DOUBLE_COLON","::",158],["T_STRING","LOG_FILE",158],")",";",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * Check DB connection\n     *\n     * @return bool\n     *\/",161],["T_WHITESPACE","\n    ",165],["T_PUBLIC","public",166],["T_WHITESPACE"," ",166],["T_FUNCTION","function",166],["T_WHITESPACE"," ",166],["T_STRING","hasConnection",166],"(",")",["T_WHITESPACE","\n    ",166],"{",["T_WHITESPACE","\n        ",167],["T_IF","if",168],"(",["T_WHITESPACE"," ",168],"!",["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_useRedis",168],")",["T_WHITESPACE"," ",168],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_STRING","parent",168],["T_DOUBLE_COLON","::",168],["T_STRING","hasConnection",168],"(",")",";",["T_WHITESPACE","\n\n        ",168],["T_TRY","try",170],["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_redis",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","connect",171],"(",")",";",["T_WHITESPACE","\n            ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_logLevel",172],["T_WHITESPACE"," ",172],["T_IS_GREATER_OR_EQUAL",">=",172],["T_WHITESPACE"," ",172],["T_STRING","Zend_Log",172],["T_DOUBLE_COLON","::",172],["T_STRING","DEBUG",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n                ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_log",173],"(",["T_CONSTANT_ENCAPSED_STRING","\"Connected to Redis\"",173],")",";",["T_WHITESPACE","\n            ",173],"}",["T_WHITESPACE","\n            ",174],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_STRING","TRUE",175],";",["T_WHITESPACE","\n        ",175],"}",["T_WHITESPACE","\n        ",176],["T_CATCH","catch",177],["T_WHITESPACE"," ",177],"(",["T_STRING","Exception",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$e",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_STRING","Mage",178],["T_DOUBLE_COLON","::",178],["T_STRING","logException",178],"(",["T_VARIABLE","$e",178],")",";",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_redis",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_STRING","NULL",179],";",["T_WHITESPACE","\n            ",179],["T_STRING","Mage",180],["T_DOUBLE_COLON","::",180],["T_STRING","log",180],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to connect to Redis; falling back to MySQL handler'",180],",",["T_WHITESPACE"," ",180],["T_STRING","Zend_Log",180],["T_DOUBLE_COLON","::",180],["T_STRING","EMERG",180],")",";",["T_WHITESPACE","\n\n            ",180],["T_COMMENT","\/\/ Fall-back to MySQL handler. If this fails, the file handler will be used.\n",182],["T_WHITESPACE","            ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","_useRedis",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_STRING","FALSE",183],";",["T_WHITESPACE","\n            ",183],["T_STRING","parent",184],["T_DOUBLE_COLON","::",184],["T_STRING","__construct",184],"(",")",";",["T_WHITESPACE","\n            ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_STRING","parent",185],["T_DOUBLE_COLON","::",185],["T_STRING","hasConnection",185],"(",")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n\n    ",187],["T_DOC_COMMENT","\/**\n     * Fetch session data\n     *\n     * @param string $sessionId\n     * @return string\n     *\/",189],["T_WHITESPACE","\n    ",194],["T_PUBLIC","public",195],["T_WHITESPACE"," ",195],["T_FUNCTION","function",195],["T_WHITESPACE"," ",195],["T_STRING","read",195],"(",["T_VARIABLE","$sessionId",195],")",["T_WHITESPACE","\n    ",195],"{",["T_WHITESPACE","\n        ",196],["T_IF","if",197],["T_WHITESPACE"," ",197],"(",["T_WHITESPACE"," ",197],"!",["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_useRedis",197],")",["T_WHITESPACE"," ",197],["T_RETURN","return",197],["T_WHITESPACE"," ",197],["T_STRING","parent",197],["T_DOUBLE_COLON","::",197],["T_STRING","read",197],"(",["T_VARIABLE","$sessionId",197],")",";",["T_WHITESPACE","\n        ",197],["T_STRING","Varien_Profiler",198],["T_DOUBLE_COLON","::",198],["T_STRING","start",198],"(",["T_METHOD_C","__METHOD__",198],")",";",["T_WHITESPACE","\n\n        ",198],["T_COMMENT","\/\/ Get lock on session. Increment the \"lock\" field and if the new value is 1, we have the lock.\n",200],["T_WHITESPACE","        ",201],["T_VARIABLE","$sessionId",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","self",201],["T_DOUBLE_COLON","::",201],["T_STRING","SESSION_PREFIX",201],".",["T_VARIABLE","$sessionId",201],";",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$tries",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$waiting",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$lock",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_LNUMBER","0",202],";",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$lockPid",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$oldLockPid",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_STRING","NULL",203],";",["T_WHITESPACE"," ",203],["T_COMMENT","\/\/ Restart waiting for lock when current lock holder changes\n",203],["T_WHITESPACE","        ",204],["T_VARIABLE","$detectZombies",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_STRING","FALSE",204],";",["T_WHITESPACE","\n        ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_logLevel",205],["T_WHITESPACE"," ",205],["T_IS_GREATER_OR_EQUAL",">=",205],["T_WHITESPACE"," ",205],["T_STRING","Zend_Log",205],["T_DOUBLE_COLON","::",205],["T_STRING","WARN",205],")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$timeStart",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_STRING","microtime",206],"(",["T_STRING","true",206],")",";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n        ",207],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_logLevel",208],["T_WHITESPACE"," ",208],["T_IS_GREATER_OR_EQUAL",">=",208],["T_WHITESPACE"," ",208],["T_STRING","Zend_Log",208],["T_DOUBLE_COLON","::",208],["T_STRING","DEBUG",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_log",209],"(",["T_STRING","sprintf",209],"(",["T_CONSTANT_ENCAPSED_STRING","\"Attempting to take lock on ID %s\"",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$sessionId",209],")",")",";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_redis",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","select",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_dbNum",211],")",";",["T_WHITESPACE","\n        ",211],["T_WHILE","while",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","_useLocking",212],")",["T_WHITESPACE","\n        ",212],"{",["T_WHITESPACE","\n            ",213],["T_COMMENT","\/\/ Increment lock value for this session and retrieve the new value\n",214],["T_WHITESPACE","            ",215],["T_VARIABLE","$oldLock",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$lock",215],";",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$lock",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_redis",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","hIncrBy",216],"(",["T_VARIABLE","$sessionId",216],",",["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","'lock'",216],",",["T_WHITESPACE"," ",216],["T_LNUMBER","1",216],")",";",["T_WHITESPACE","\n\n            ",216],["T_COMMENT","\/\/ Get the pid of the process that has the lock\n",218],["T_WHITESPACE","            ",219],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$lock",219],["T_WHITESPACE"," ",219],["T_IS_NOT_EQUAL","!=",219],["T_WHITESPACE"," ",219],["T_LNUMBER","1",219],["T_WHITESPACE"," ",219],["T_BOOLEAN_AND","&&",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$tries",219],["T_WHITESPACE"," ",219],"+",["T_WHITESPACE"," ",219],["T_LNUMBER","1",219],["T_WHITESPACE"," ",219],["T_IS_GREATER_OR_EQUAL",">=",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_breakAfter",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n                ",219],["T_VARIABLE","$lockPid",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_redis",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","hGet",220],"(",["T_VARIABLE","$sessionId",220],",",["T_WHITESPACE"," ",220],["T_CONSTANT_ENCAPSED_STRING","'pid'",220],")",";",["T_WHITESPACE","\n            ",220],"}",["T_WHITESPACE","\n\n            ",221],["T_COMMENT","\/\/ If we got the lock, update with our pid and reset lock and expiration\n",223],["T_WHITESPACE","            ",224],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_WHITESPACE","   ",224],["T_VARIABLE","$lock",224],["T_WHITESPACE"," ",224],["T_IS_EQUAL","==",224],["T_WHITESPACE"," ",224],["T_LNUMBER","1",224],["T_WHITESPACE","                          ",224],["T_COMMENT","\/\/ We actually do have the lock\n",224],["T_WHITESPACE","                ",225],["T_BOOLEAN_OR","||",225],["T_WHITESPACE"," ",225],"(",["T_WHITESPACE","\n                        ",225],["T_VARIABLE","$tries",226],["T_WHITESPACE"," ",226],["T_IS_GREATER_OR_EQUAL",">=",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_breakAfter",226],["T_WHITESPACE","   ",226],["T_COMMENT","\/\/ We are done waiting and want to start trying to break it\n",226],["T_WHITESPACE","                     ",227],["T_BOOLEAN_AND","&&",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$oldLockPid",227],["T_WHITESPACE"," ",227],["T_IS_EQUAL","==",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$lockPid",227],["T_WHITESPACE","        ",227],["T_COMMENT","\/\/ Nobody else got the lock while we were waiting\n",227],["T_WHITESPACE","                   ",228],")",["T_WHITESPACE","\n            ",228],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                ",229],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_hasLock",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_STRING","TRUE",230],";",["T_WHITESPACE","\n                ",230],["T_BREAK","break",231],";",["T_WHITESPACE","\n            ",231],"}",["T_WHITESPACE","\n\n            ",232],["T_COMMENT","\/\/ Otherwise, add to \"wait\" counter and continue\n",234],["T_WHITESPACE","            ",235],["T_ELSE","else",235],["T_WHITESPACE"," ",235],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_WHITESPACE"," ",235],"!",["T_WHITESPACE"," ",235],["T_VARIABLE","$waiting",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n                ",235],["T_VARIABLE","$i",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_LNUMBER","0",236],";",["T_WHITESPACE","\n                ",236],["T_DO","do",237],["T_WHITESPACE"," ",237],"{",["T_WHITESPACE","\n                    ",237],["T_VARIABLE","$waiting",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_redis",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","hIncrBy",238],"(",["T_VARIABLE","$sessionId",238],",",["T_WHITESPACE"," ",238],["T_CONSTANT_ENCAPSED_STRING","'wait'",238],",",["T_WHITESPACE"," ",238],["T_LNUMBER","1",238],")",";",["T_WHITESPACE","\n                ",238],"}",["T_WHITESPACE"," ",239],["T_WHILE","while",239],["T_WHITESPACE"," ",239],"(",["T_INC","++",239],["T_VARIABLE","$i",239],["T_WHITESPACE"," ",239],"<",["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","_maxConcurrency",239],["T_WHITESPACE"," ",239],["T_BOOLEAN_AND","&&",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$waiting",239],["T_WHITESPACE"," ",239],"<",["T_WHITESPACE"," ",239],["T_LNUMBER","1",239],")",";",["T_WHITESPACE","\n            ",239],"}",["T_WHITESPACE","\n\n            ",240],["T_COMMENT","\/\/ Handle overloaded sessions\n",242],["T_WHITESPACE","            ",243],["T_ELSE","else",243],["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n                ",243],["T_COMMENT","\/\/ Detect broken sessions (e.g. caused by fatal errors)\n",244],["T_WHITESPACE","                ",245],["T_IF","if",245],["T_WHITESPACE"," ",245],"(",["T_VARIABLE","$detectZombies",245],")",["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n                    ",245],["T_VARIABLE","$detectZombies",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_STRING","FALSE",246],";",["T_WHITESPACE","\n                    ",246],["T_IF","if",247],["T_WHITESPACE"," ",247],"(",["T_WHITESPACE"," ",247],["T_VARIABLE","$lock",247],["T_WHITESPACE"," ",247],">",["T_WHITESPACE"," ",247],["T_VARIABLE","$oldLock",247],["T_WHITESPACE","                 ",247],["T_COMMENT","\/\/ lock shouldn't be less than old lock (another process broke the lock)\n",247],["T_WHITESPACE","                      ",248],["T_BOOLEAN_AND","&&",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$lock",248],["T_WHITESPACE"," ",248],"+",["T_WHITESPACE"," ",248],["T_LNUMBER","1",248],["T_WHITESPACE"," ",248],"<",["T_WHITESPACE"," ",248],["T_VARIABLE","$oldLock",248],["T_WHITESPACE"," ",248],"+",["T_WHITESPACE"," ",248],["T_VARIABLE","$waiting",248],["T_WHITESPACE"," ",248],["T_COMMENT","\/\/ lock should be old+waiting, otherwise there must be a dead process\n",248],["T_WHITESPACE","                    ",249],")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                        ",249],["T_COMMENT","\/\/ Reset session to fresh state\n",250],["T_WHITESPACE","                        ",251],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","_logLevel",251],["T_WHITESPACE"," ",251],["T_IS_GREATER_OR_EQUAL",">=",251],["T_WHITESPACE"," ",251],["T_STRING","Zend_Log",251],["T_DOUBLE_COLON","::",251],["T_STRING","INFO",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n                            ",251],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","_log",252],"(",["T_STRING","sprintf",252],"(",["T_WHITESPACE","\n                                ",252],["T_CONSTANT_ENCAPSED_STRING","\"Detected zombie waiter after %.5f seconds for ID %s (%d waiting)\\n  %s (%s - %s)\"",253],",",["T_WHITESPACE","\n                                ",253],"(",["T_STRING","microtime",254],"(",["T_STRING","true",254],")",["T_WHITESPACE"," ",254],"-",["T_WHITESPACE"," ",254],["T_VARIABLE","$timeStart",254],")",",",["T_WHITESPACE","\n                                ",254],["T_VARIABLE","$sessionId",255],",",["T_WHITESPACE"," ",255],["T_VARIABLE","$waiting",255],",",["T_WHITESPACE","\n                                ",255],["T_STRING","Mage",256],["T_DOUBLE_COLON","::",256],["T_STRING","app",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getRequest",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getRequestUri",256],"(",")",",",["T_WHITESPACE"," ",256],["T_STRING","Mage",256],["T_DOUBLE_COLON","::",256],["T_STRING","app",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getRequest",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getClientIp",256],"(",")",",",["T_WHITESPACE"," ",256],["T_STRING","Mage",256],["T_DOUBLE_COLON","::",256],["T_STRING","app",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getRequest",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getHeader",256],"(",["T_CONSTANT_ENCAPSED_STRING","'User-Agent'",256],")",["T_WHITESPACE","\n                            ",256],")",",",["T_WHITESPACE"," ",257],["T_STRING","Zend_Log",257],["T_DOUBLE_COLON","::",257],["T_STRING","INFO",257],")",";",["T_WHITESPACE","\n                        ",257],"}",["T_WHITESPACE","\n                        ",258],["T_VARIABLE","$waiting",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_redis",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","hIncrBy",259],"(",["T_VARIABLE","$sessionId",259],",",["T_WHITESPACE"," ",259],["T_CONSTANT_ENCAPSED_STRING","'wait'",259],",",["T_WHITESPACE"," ",259],"-",["T_LNUMBER","1",259],")",";",["T_WHITESPACE","\n                        ",259],["T_CONTINUE","continue",260],";",["T_WHITESPACE","\n                    ",260],"}",["T_WHITESPACE","\n                ",261],"}",["T_WHITESPACE","\n\n                ",262],["T_COMMENT","\/\/ Limit concurrent lock waiters to prevent server resource hogging\n",264],["T_WHITESPACE","                ",265],["T_IF","if",265],["T_WHITESPACE"," ",265],"(",["T_VARIABLE","$waiting",265],["T_WHITESPACE"," ",265],["T_IS_GREATER_OR_EQUAL",">=",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_maxConcurrency",265],")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n                    ",265],["T_COMMENT","\/\/ Overloaded sessions get 503 errors\n",266],["T_WHITESPACE","                    ",267],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","_redis",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","hIncrBy",267],"(",["T_VARIABLE","$sessionId",267],",",["T_WHITESPACE"," ",267],["T_CONSTANT_ENCAPSED_STRING","'wait'",267],",",["T_WHITESPACE"," ",267],"-",["T_LNUMBER","1",267],")",";",["T_WHITESPACE","\n                    ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_sessionWritten",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_STRING","TRUE",268],";",["T_WHITESPACE"," ",268],["T_COMMENT","\/\/ Prevent session from getting written\n",268],["T_WHITESPACE","                    ",269],["T_VARIABLE","$writes",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_redis",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","hGet",269],"(",["T_VARIABLE","$sessionId",269],",",["T_WHITESPACE"," ",269],["T_CONSTANT_ENCAPSED_STRING","'writes'",269],")",";",["T_WHITESPACE","\n                    ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_logLevel",270],["T_WHITESPACE"," ",270],["T_IS_GREATER_OR_EQUAL",">=",270],["T_WHITESPACE"," ",270],["T_STRING","Zend_Log",270],["T_DOUBLE_COLON","::",270],["T_STRING","WARN",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n                        ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","_log",271],"(",["T_STRING","sprintf",271],"(",["T_WHITESPACE","\n                            ",271],["T_CONSTANT_ENCAPSED_STRING","\"Session concurrency exceeded for ID %s; displaying HTTP 503 (%s waiting, %s total requests)\\n  %s (%s - %s)\"",272],",",["T_WHITESPACE","\n                            ",272],["T_VARIABLE","$sessionId",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$waiting",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$writes",273],",",["T_WHITESPACE","\n                            ",273],["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","app",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","getRequest",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","getRequestUri",274],"(",")",",",["T_WHITESPACE"," ",274],["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","app",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","getRequest",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","getClientIp",274],"(",")",",",["T_WHITESPACE"," ",274],["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","app",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","getRequest",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","getHeader",274],"(",["T_CONSTANT_ENCAPSED_STRING","'User-Agent'",274],")",["T_WHITESPACE","\n                        ",274],")",",",["T_WHITESPACE"," ",275],["T_STRING","Zend_Log",275],["T_DOUBLE_COLON","::",275],["T_STRING","WARN",275],")",";",["T_WHITESPACE","\n                    ",275],"}",["T_WHITESPACE","\n                    ",276],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_logLevel",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],"-",["T_LNUMBER","1",277],";",["T_WHITESPACE"," ",277],["T_COMMENT","\/\/ Disable further logging\n",277],["T_WHITESPACE","                    ",278],["T_REQUIRE_ONCE","require_once",278],"(",["T_STRING","Mage",278],["T_DOUBLE_COLON","::",278],["T_STRING","getBaseDir",278],"(",")",["T_WHITESPACE"," ",278],".",["T_WHITESPACE"," ",278],["T_STRING","DS",278],["T_WHITESPACE"," ",278],".",["T_WHITESPACE"," ",278],["T_CONSTANT_ENCAPSED_STRING","'errors'",278],["T_WHITESPACE"," ",278],".",["T_WHITESPACE"," ",278],["T_STRING","DS",278],["T_WHITESPACE"," ",278],".",["T_WHITESPACE"," ",278],["T_CONSTANT_ENCAPSED_STRING","'503.php'",278],")",";",["T_WHITESPACE","\n                    ",278],["T_EXIT","exit",279],";",["T_WHITESPACE","\n                ",279],"}",["T_WHITESPACE","\n            ",280],"}",["T_WHITESPACE","\n\n            ",281],["T_VARIABLE","$tries",283],["T_INC","++",283],";",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$oldLockPid",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$lockPid",284],";",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$sleepTime",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_STRING","self",285],["T_DOUBLE_COLON","::",285],["T_STRING","SLEEP_TIME",285],";",["T_WHITESPACE","\n\n            ",285],["T_COMMENT","\/\/ Detect dead lock waiters\n",287],["T_WHITESPACE","            ",288],["T_IF","if",288],["T_WHITESPACE"," ",288],"(",["T_VARIABLE","$tries",288],["T_WHITESPACE"," ",288],"%",["T_WHITESPACE"," ",288],["T_STRING","self",288],["T_DOUBLE_COLON","::",288],["T_STRING","DETECT_ZOMBIES",288],["T_WHITESPACE"," ",288],["T_IS_EQUAL","==",288],["T_WHITESPACE"," ",288],["T_LNUMBER","1",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n                ",288],["T_VARIABLE","$detectZombies",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_STRING","TRUE",289],";",["T_WHITESPACE","\n                ",289],["T_VARIABLE","$sleepTime",290],["T_WHITESPACE"," ",290],["T_PLUS_EQUAL","+=",290],["T_WHITESPACE"," ",290],["T_LNUMBER","10000",290],";",["T_WHITESPACE"," ",290],["T_COMMENT","\/\/ sleep + 0.01 seconds\n",290],["T_WHITESPACE","            ",291],"}",["T_WHITESPACE","\n            ",291],["T_COMMENT","\/\/ Detect dead lock holder every 10 seconds (only works on same node as lock holder)\n",292],["T_WHITESPACE","            ",293],["T_IF","if",293],["T_WHITESPACE"," ",293],"(",["T_VARIABLE","$tries",293],["T_WHITESPACE"," ",293],"%",["T_WHITESPACE"," ",293],["T_STRING","self",293],["T_DOUBLE_COLON","::",293],["T_STRING","DETECT_ZOMBIES",293],["T_WHITESPACE"," ",293],["T_IS_EQUAL","==",293],["T_WHITESPACE"," ",293],["T_LNUMBER","0",293],")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n                ",293],["T_STRING","Varien_Profiler",294],["T_DOUBLE_COLON","::",294],["T_STRING","start",294],"(",["T_METHOD_C","__METHOD__",294],".",["T_CONSTANT_ENCAPSED_STRING","'-detect-zombies'",294],")",";",["T_WHITESPACE","\n                ",294],["T_IF","if",295],["T_WHITESPACE"," ",295],"(",["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_logLevel",295],["T_WHITESPACE"," ",295],["T_IS_GREATER_OR_EQUAL",">=",295],["T_WHITESPACE"," ",295],["T_STRING","Zend_Log",295],["T_DOUBLE_COLON","::",295],["T_STRING","DEBUG",295],")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n                    ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_log",296],"(",["T_STRING","sprintf",296],"(",["T_WHITESPACE","\n                        ",296],["T_CONSTANT_ENCAPSED_STRING","\"Checking for zombies after %.5f seconds of waiting...\"",297],",",["T_WHITESPACE"," ",297],"(",["T_STRING","microtime",297],"(",["T_STRING","true",297],")",["T_WHITESPACE"," ",297],"-",["T_WHITESPACE"," ",297],["T_VARIABLE","$timeStart",297],")",["T_WHITESPACE","\n                    ",297],")",")",";",["T_WHITESPACE","\n                ",298],"}",["T_WHITESPACE","\n                ",299],["T_VARIABLE","$pid",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","_redis",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","hGet",300],"(",["T_VARIABLE","$sessionId",300],",",["T_WHITESPACE"," ",300],["T_CONSTANT_ENCAPSED_STRING","'pid'",300],")",";",["T_WHITESPACE","\n                ",300],["T_IF","if",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$pid",301],["T_WHITESPACE"," ",301],["T_BOOLEAN_AND","&&",301],["T_WHITESPACE"," ",301],"!",["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_pidExists",301],"(",["T_VARIABLE","$pid",301],")",")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n                    ",301],["T_COMMENT","\/\/ Allow a live process to get the lock\n",302],["T_WHITESPACE","                    ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_redis",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","hSet",303],"(",["T_VARIABLE","$sessionId",303],",",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'lock'",303],",",["T_WHITESPACE"," ",303],["T_LNUMBER","0",303],")",";",["T_WHITESPACE","\n                    ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_logLevel",304],["T_WHITESPACE"," ",304],["T_IS_GREATER_OR_EQUAL",">=",304],["T_WHITESPACE"," ",304],["T_STRING","Zend_Log",304],["T_DOUBLE_COLON","::",304],["T_STRING","INFO",304],")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n                        ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_log",305],"(",["T_STRING","sprintf",305],"(",["T_WHITESPACE","\n                            ",305],["T_CONSTANT_ENCAPSED_STRING","\"Detected zombie process (%s) for %s (%s waiting)\\n  %s (%s - %s)\"",306],",",["T_WHITESPACE","\n                            ",306],["T_VARIABLE","$pid",307],",",["T_WHITESPACE"," ",307],["T_VARIABLE","$sessionId",307],",",["T_WHITESPACE"," ",307],["T_VARIABLE","$waiting",307],",",["T_WHITESPACE","\n                            ",307],["T_STRING","Mage",308],["T_DOUBLE_COLON","::",308],["T_STRING","app",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getRequest",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getRequestUri",308],"(",")",",",["T_WHITESPACE"," ",308],["T_STRING","Mage",308],["T_DOUBLE_COLON","::",308],["T_STRING","app",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getRequest",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getClientIp",308],"(",")",",",["T_WHITESPACE"," ",308],["T_STRING","Mage",308],["T_DOUBLE_COLON","::",308],["T_STRING","app",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getRequest",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getHeader",308],"(",["T_CONSTANT_ENCAPSED_STRING","'User-Agent'",308],")",["T_WHITESPACE","\n                        ",308],")",",",["T_WHITESPACE"," ",309],["T_STRING","Zend_Log",309],["T_DOUBLE_COLON","::",309],["T_STRING","INFO",309],")",";",["T_WHITESPACE","\n                    ",309],"}",["T_WHITESPACE","\n                    ",310],["T_STRING","Varien_Profiler",311],["T_DOUBLE_COLON","::",311],["T_STRING","stop",311],"(",["T_METHOD_C","__METHOD__",311],".",["T_CONSTANT_ENCAPSED_STRING","'-detect-zombies'",311],")",";",["T_WHITESPACE","\n                    ",311],["T_CONTINUE","continue",312],";",["T_WHITESPACE","\n                ",312],"}",["T_WHITESPACE","\n                ",313],["T_STRING","Varien_Profiler",314],["T_DOUBLE_COLON","::",314],["T_STRING","stop",314],"(",["T_METHOD_C","__METHOD__",314],".",["T_CONSTANT_ENCAPSED_STRING","'-detect-zombies'",314],")",";",["T_WHITESPACE","\n            ",314],"}",["T_WHITESPACE","\n            ",315],["T_COMMENT","\/\/ Timeout\n",316],["T_WHITESPACE","            ",317],["T_IF","if",317],["T_WHITESPACE"," ",317],"(",["T_VARIABLE","$tries",317],["T_WHITESPACE"," ",317],["T_IS_GREATER_OR_EQUAL",">=",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_breakAfter",317],["T_WHITESPACE"," ",317],"+",["T_WHITESPACE"," ",317],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_failAfter",317],")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n                ",317],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","_hasLock",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_STRING","FALSE",318],";",["T_WHITESPACE","\n                ",318],["T_IF","if",319],["T_WHITESPACE"," ",319],"(",["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_logLevel",319],["T_WHITESPACE"," ",319],["T_IS_GREATER_OR_EQUAL",">=",319],["T_WHITESPACE"," ",319],["T_STRING","Zend_Log",319],["T_DOUBLE_COLON","::",319],["T_STRING","NOTICE",319],")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n                    ",319],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_log",320],"(",["T_STRING","sprintf",320],"(",["T_CONSTANT_ENCAPSED_STRING","\"Giving up on read lock for ID %s after %.5f seconds (%d attempts)\"",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$sessionId",320],",",["T_WHITESPACE"," ",320],"(",["T_STRING","microtime",320],"(",["T_STRING","true",320],")",["T_WHITESPACE"," ",320],"-",["T_WHITESPACE"," ",320],["T_VARIABLE","$timeStart",320],")",",",["T_WHITESPACE"," ",320],["T_VARIABLE","$tries",320],")",",",["T_WHITESPACE"," ",320],["T_STRING","Zend_Log",320],["T_DOUBLE_COLON","::",320],["T_STRING","NOTICE",320],")",";",["T_WHITESPACE","\n                ",320],"}",["T_WHITESPACE","\n                ",321],["T_BREAK","break",322],";",["T_WHITESPACE","\n            ",322],"}",["T_WHITESPACE","\n            ",323],["T_ELSE","else",324],["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n                ",324],["T_IF","if",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_logLevel",325],["T_WHITESPACE"," ",325],["T_IS_GREATER_OR_EQUAL",">=",325],["T_WHITESPACE"," ",325],["T_STRING","Zend_Log",325],["T_DOUBLE_COLON","::",325],["T_STRING","DEBUG",325],")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n                    ",325],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_log",326],"(",["T_STRING","sprintf",326],"(",["T_WHITESPACE","\n                        ",326],["T_CONSTANT_ENCAPSED_STRING","\"Waiting %.2f seconds for lock on ID %s (%d tries, lock pid is %s, %.5f seconds elapsed)\"",327],",",["T_WHITESPACE","\n                        ",327],["T_VARIABLE","$sleepTime",328],["T_WHITESPACE"," ",328],"\/",["T_WHITESPACE"," ",328],["T_LNUMBER","1000000",328],",",["T_WHITESPACE"," ",328],["T_VARIABLE","$sessionId",328],",",["T_WHITESPACE"," ",328],["T_VARIABLE","$tries",328],",",["T_WHITESPACE"," ",328],["T_VARIABLE","$lockPid",328],",",["T_WHITESPACE"," ",328],"(",["T_STRING","microtime",328],"(",["T_STRING","true",328],")",["T_WHITESPACE"," ",328],"-",["T_WHITESPACE"," ",328],["T_VARIABLE","$timeStart",328],")",["T_WHITESPACE","\n                    ",328],")",")",";",["T_WHITESPACE","\n                ",329],"}",["T_WHITESPACE","\n                ",330],["T_STRING","Varien_Profiler",331],["T_DOUBLE_COLON","::",331],["T_STRING","start",331],"(",["T_METHOD_C","__METHOD__",331],".",["T_CONSTANT_ENCAPSED_STRING","'-wait'",331],")",";",["T_WHITESPACE","\n                ",331],["T_STRING","usleep",332],"(",["T_VARIABLE","$sleepTime",332],")",";",["T_WHITESPACE","\n                ",332],["T_STRING","Varien_Profiler",333],["T_DOUBLE_COLON","::",333],["T_STRING","stop",333],"(",["T_METHOD_C","__METHOD__",333],".",["T_CONSTANT_ENCAPSED_STRING","'-wait'",333],")",";",["T_WHITESPACE","\n            ",333],"}",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n        ",335],["T_STRING","self",336],["T_DOUBLE_COLON","::",336],["T_VARIABLE","$failedLockAttempts",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$tries",336],";",["T_WHITESPACE","\n\n        ",336],["T_COMMENT","\/\/ Session can be read even if it was not locked by this pid!\n",338],["T_WHITESPACE","        ",339],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","_logLevel",339],["T_WHITESPACE"," ",339],["T_IS_GREATER_OR_EQUAL",">=",339],["T_WHITESPACE"," ",339],["T_STRING","Zend_Log",339],["T_DOUBLE_COLON","::",339],["T_STRING","DEBUG",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$timeStart",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_STRING","microtime",340],"(",["T_STRING","true",340],")",";",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n        ",341],["T_LIST","list",342],"(",["T_VARIABLE","$sessionData",342],",",["T_WHITESPACE"," ",342],["T_VARIABLE","$sessionWrites",342],")",["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","_redis",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","hMGet",342],"(",["T_VARIABLE","$sessionId",342],",",["T_WHITESPACE"," ",342],["T_ARRAY","array",342],"(",["T_CONSTANT_ENCAPSED_STRING","'data'",342],",",["T_CONSTANT_ENCAPSED_STRING","'writes'",342],")",")",";",["T_WHITESPACE","\n        ",342],["T_STRING","Varien_Profiler",343],["T_DOUBLE_COLON","::",343],["T_STRING","stop",343],"(",["T_METHOD_C","__METHOD__",343],")",";",["T_WHITESPACE","\n        ",343],["T_IF","if",344],["T_WHITESPACE"," ",344],"(",["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","_logLevel",344],["T_WHITESPACE"," ",344],["T_IS_GREATER_OR_EQUAL",">=",344],["T_WHITESPACE"," ",344],["T_STRING","Zend_Log",344],["T_DOUBLE_COLON","::",344],["T_STRING","DEBUG",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n            ",344],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_log",345],"(",["T_STRING","sprintf",345],"(",["T_CONSTANT_ENCAPSED_STRING","\"Data read for ID %s in %.5f seconds\"",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$sessionId",345],",",["T_WHITESPACE"," ",345],"(",["T_STRING","microtime",345],"(",["T_STRING","true",345],")",["T_WHITESPACE"," ",345],"-",["T_WHITESPACE"," ",345],["T_VARIABLE","$timeStart",345],")",")",")",";",["T_WHITESPACE","\n        ",345],"}",["T_WHITESPACE","\n        ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_sessionWrites",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_INT_CAST","(int)",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$sessionWrites",347],";",["T_WHITESPACE","\n\n        ",347],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_redis",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","pipeline",349],"(",")",";",["T_WHITESPACE","\n\n        ",349],["T_COMMENT","\/\/ This process is no longer waiting for a lock\n",351],["T_WHITESPACE","        ",352],["T_IF","if",352],["T_WHITESPACE"," ",352],"(",["T_VARIABLE","$tries",352],["T_WHITESPACE"," ",352],">",["T_WHITESPACE"," ",352],["T_LNUMBER","0",352],")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_redis",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","hIncrBy",353],"(",["T_VARIABLE","$sessionId",353],",",["T_WHITESPACE"," ",353],["T_CONSTANT_ENCAPSED_STRING","'wait'",353],",",["T_WHITESPACE"," ",353],"-",["T_LNUMBER","1",353],")",";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE","\n\n        ",354],["T_COMMENT","\/\/ This process has the lock, save the pid\n",356],["T_WHITESPACE","        ",357],["T_IF","if",357],["T_WHITESPACE"," ",357],"(",["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_hasLock",357],")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n            ",357],["T_VARIABLE","$setData",358],["T_WHITESPACE"," ",358],"=",["T_WHITESPACE"," ",358],["T_ARRAY","array",358],"(",["T_WHITESPACE","\n                ",358],["T_CONSTANT_ENCAPSED_STRING","'pid'",359],["T_WHITESPACE"," ",359],["T_DOUBLE_ARROW","=>",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","_getPid",359],"(",")",",",["T_WHITESPACE","\n                ",359],["T_CONSTANT_ENCAPSED_STRING","'lock'",360],["T_WHITESPACE"," ",360],["T_DOUBLE_ARROW","=>",360],["T_WHITESPACE"," ",360],["T_LNUMBER","1",360],",",["T_WHITESPACE","\n            ",360],")",";",["T_WHITESPACE","\n\n            ",361],["T_COMMENT","\/\/ Save request data in session so if a lock is broken we can know which page it was for debugging\n",363],["T_WHITESPACE","            ",364],["T_IF","if",364],["T_WHITESPACE"," ",364],"(",["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_logLevel",364],["T_WHITESPACE"," ",364],["T_IS_GREATER_OR_EQUAL",">=",364],["T_WHITESPACE"," ",364],["T_STRING","Zend_Log",364],["T_DOUBLE_COLON","::",364],["T_STRING","INFO",364],")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n                ",364],["T_IF","if",365],["T_WHITESPACE"," ",365],"(",["T_EMPTY","empty",365],"(",["T_VARIABLE","$_SERVER",365],"[",["T_CONSTANT_ENCAPSED_STRING","'REQUEST_METHOD'",365],"]",")",")",["T_WHITESPACE"," ",365],"{",["T_WHITESPACE","\n                    ",365],["T_VARIABLE","$setData",366],"[",["T_CONSTANT_ENCAPSED_STRING","'req'",366],"]",["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$_SERVER",366],"[",["T_CONSTANT_ENCAPSED_STRING","'SCRIPT_NAME'",366],"]",";",["T_WHITESPACE","\n                ",366],"}",["T_WHITESPACE"," ",367],["T_ELSE","else",367],["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n                    ",367],["T_VARIABLE","$setData",368],"[",["T_CONSTANT_ENCAPSED_STRING","'req'",368],"]",["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],"\"",["T_CURLY_OPEN","{",368],["T_VARIABLE","$_SERVER",368],"[",["T_CONSTANT_ENCAPSED_STRING","'REQUEST_METHOD'",368],"]","}",["T_ENCAPSED_AND_WHITESPACE"," ",368],["T_CURLY_OPEN","{",368],["T_VARIABLE","$_SERVER",368],"[",["T_CONSTANT_ENCAPSED_STRING","'SERVER_NAME'",368],"]","}",["T_CURLY_OPEN","{",368],["T_VARIABLE","$_SERVER",368],"[",["T_CONSTANT_ENCAPSED_STRING","'REQUEST_URI'",368],"]","}","\"",";",["T_WHITESPACE","\n                ",368],"}",["T_WHITESPACE","\n                ",369],["T_IF","if",370],["T_WHITESPACE"," ",370],"(",["T_VARIABLE","$lock",370],["T_WHITESPACE"," ",370],["T_IS_NOT_EQUAL","!=",370],["T_WHITESPACE"," ",370],["T_LNUMBER","1",370],")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n                    ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","_log",371],"(",["T_STRING","sprintf",371],"(",["T_WHITESPACE","\n                        ",371],["T_CONSTANT_ENCAPSED_STRING","\"Successfully broke lock for ID %s after %.5f seconds (%d attempts). Lock: %d\\nLast request of broken lock: %s\"",372],",",["T_WHITESPACE","\n                        ",372],["T_VARIABLE","$sessionId",373],",",["T_WHITESPACE"," ",373],"(",["T_STRING","microtime",373],"(",["T_STRING","true",373],")",["T_WHITESPACE"," ",373],"-",["T_WHITESPACE"," ",373],["T_VARIABLE","$timeStart",373],")",",",["T_WHITESPACE"," ",373],["T_VARIABLE","$tries",373],",",["T_WHITESPACE"," ",373],["T_VARIABLE","$lock",373],",",["T_WHITESPACE"," ",373],["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","_redis",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","hGet",373],"(",["T_VARIABLE","$sessionId",373],",",["T_WHITESPACE"," ",373],["T_CONSTANT_ENCAPSED_STRING","'req'",373],")",["T_WHITESPACE","\n                    ",373],")",",",["T_WHITESPACE"," ",374],["T_STRING","Zend_Log",374],["T_DOUBLE_COLON","::",374],["T_STRING","INFO",374],")",";",["T_WHITESPACE","\n                ",374],"}",["T_WHITESPACE","\n            ",375],"}",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","_redis",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","hMSet",377],"(",["T_VARIABLE","$sessionId",377],",",["T_WHITESPACE"," ",377],["T_VARIABLE","$setData",377],")",";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE","\n\n        ",378],["T_COMMENT","\/\/ Set session expiration\n",380],["T_WHITESPACE","        ",381],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","_redis",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","expire",381],"(",["T_VARIABLE","$sessionId",381],",",["T_WHITESPACE"," ",381],["T_STRING","min",381],"(",["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getLifeTime",381],"(",")",",",["T_WHITESPACE"," ",381],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","_maxLifetime",381],")",")",";",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_redis",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","exec",382],"(",")",";",["T_WHITESPACE","\n\n        ",382],["T_COMMENT","\/\/ Reset flag in case of multiple session read\/write operations\n",384],["T_WHITESPACE","        ",385],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","_sessionWritten",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_STRING","FALSE",385],";",["T_WHITESPACE","\n\n        ",385],["T_RETURN","return",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$sessionData",387],["T_WHITESPACE"," ",387],"?",["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_decodeData",387],"(",["T_VARIABLE","$sessionData",387],")",["T_WHITESPACE"," ",387],":",["T_WHITESPACE"," ",387],["T_CONSTANT_ENCAPSED_STRING","''",387],";",["T_WHITESPACE","\n    ",387],"}",["T_WHITESPACE","\n\n    ",388],["T_DOC_COMMENT","\/**\n     * Update session\n     *\n     * @param string $sessionId\n     * @param string $sessionData\n     * @return boolean\n     *\/",390],["T_WHITESPACE","\n    ",396],["T_PUBLIC","public",397],["T_WHITESPACE"," ",397],["T_FUNCTION","function",397],["T_WHITESPACE"," ",397],["T_STRING","write",397],"(",["T_VARIABLE","$sessionId",397],",",["T_WHITESPACE"," ",397],["T_VARIABLE","$sessionData",397],")",["T_WHITESPACE","\n    ",397],"{",["T_WHITESPACE","\n        ",398],["T_STRING","Varien_Profiler",399],["T_DOUBLE_COLON","::",399],["T_STRING","start",399],"(",["T_METHOD_C","__METHOD__",399],")",";",["T_WHITESPACE","\n        ",399],["T_IF","if",400],["T_WHITESPACE"," ",400],"(",["T_WHITESPACE"," ",400],"!",["T_WHITESPACE"," ",400],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","_useRedis",400],")",["T_WHITESPACE"," ",400],["T_RETURN","return",400],["T_WHITESPACE"," ",400],["T_STRING","parent",400],["T_DOUBLE_COLON","::",400],["T_STRING","write",400],"(",["T_VARIABLE","$sessionId",400],",",["T_WHITESPACE"," ",400],["T_VARIABLE","$sessionData",400],")",";",["T_WHITESPACE","\n        ",400],["T_IF","if",401],["T_WHITESPACE"," ",401],"(",["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","_sessionWritten",401],")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n            ",401],["T_IF","if",402],["T_WHITESPACE"," ",402],"(",["T_VARIABLE","$this",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","_logLevel",402],["T_WHITESPACE"," ",402],["T_IS_GREATER_OR_EQUAL",">=",402],["T_WHITESPACE"," ",402],["T_STRING","Zend_Log",402],["T_DOUBLE_COLON","::",402],["T_STRING","DEBUG",402],")",["T_WHITESPACE"," ",402],"{",["T_WHITESPACE","\n                ",402],["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_log",403],"(",["T_STRING","sprintf",403],"(",["T_CONSTANT_ENCAPSED_STRING","\"Repeated session write detected; skipping for ID %s\"",403],",",["T_WHITESPACE"," ",403],["T_VARIABLE","$sessionId",403],")",")",";",["T_WHITESPACE","\n            ",403],"}",["T_WHITESPACE","\n            ",404],["T_STRING","Varien_Profiler",405],["T_DOUBLE_COLON","::",405],["T_STRING","stop",405],"(",["T_METHOD_C","__METHOD__",405],")",";",["T_WHITESPACE","\n            ",405],["T_RETURN","return",406],["T_WHITESPACE"," ",406],["T_STRING","TRUE",406],";",["T_WHITESPACE","\n        ",406],"}",["T_WHITESPACE","\n        ",407],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","_sessionWritten",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_STRING","TRUE",408],";",["T_WHITESPACE","\n        ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(",["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","_logLevel",409],["T_WHITESPACE"," ",409],["T_IS_GREATER_OR_EQUAL",">=",409],["T_WHITESPACE"," ",409],["T_STRING","Zend_Log",409],["T_DOUBLE_COLON","::",409],["T_STRING","WARN",409],")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_VARIABLE","$timeStart",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_STRING","microtime",410],"(",["T_STRING","true",410],")",";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n\n        ",411],["T_COMMENT","\/\/ Do not overwrite the session if it is locked by another pid\n",413],["T_WHITESPACE","        ",414],["T_TRY","try",414],["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n            ",414],["T_IF","if",415],"(",["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_dbNum",415],")",["T_WHITESPACE"," ",415],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_redis",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","select",415],"(",["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_dbNum",415],")",";",["T_WHITESPACE","  ",415],["T_COMMENT","\/\/ Prevent conflicts with other connections?\n",415],["T_WHITESPACE","\n            ",416],["T_IF","if",417],["T_WHITESPACE"," ",417],"(",["T_WHITESPACE"," ",417],"!",["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","_useLocking",417],["T_WHITESPACE","\n              ",417],["T_BOOLEAN_OR","||",418],["T_WHITESPACE"," ",418],"(",["T_WHITESPACE"," ",418],"!",["T_WHITESPACE"," ",418],"(",["T_VARIABLE","$pid",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","_redis",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","hGet",418],"(",["T_CONSTANT_ENCAPSED_STRING","'sess_'",418],".",["T_VARIABLE","$sessionId",418],",",["T_WHITESPACE"," ",418],["T_CONSTANT_ENCAPSED_STRING","'pid'",418],")",")",["T_WHITESPACE"," ",418],["T_BOOLEAN_OR","||",418],["T_WHITESPACE"," ",418],["T_VARIABLE","$pid",418],["T_WHITESPACE"," ",418],["T_IS_EQUAL","==",418],["T_WHITESPACE"," ",418],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","_getPid",418],"(",")",")",["T_WHITESPACE","\n            ",418],")",["T_WHITESPACE"," ",419],"{",["T_WHITESPACE","\n                ",419],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","_writeRawSession",420],"(",["T_VARIABLE","$sessionId",420],",",["T_WHITESPACE"," ",420],["T_VARIABLE","$sessionData",420],",",["T_WHITESPACE"," ",420],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getLifeTime",420],"(",")",")",";",["T_WHITESPACE","\n                ",420],["T_IF","if",421],["T_WHITESPACE"," ",421],"(",["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","_logLevel",421],["T_WHITESPACE"," ",421],["T_IS_GREATER_OR_EQUAL",">=",421],["T_WHITESPACE"," ",421],["T_STRING","Zend_Log",421],["T_DOUBLE_COLON","::",421],["T_STRING","DEBUG",421],")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n                    ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_log",422],"(",["T_STRING","sprintf",422],"(",["T_CONSTANT_ENCAPSED_STRING","\"Data written to ID %s in %.5f seconds\"",422],",",["T_WHITESPACE"," ",422],["T_VARIABLE","$sessionId",422],",",["T_WHITESPACE"," ",422],"(",["T_STRING","microtime",422],"(",["T_STRING","true",422],")",["T_WHITESPACE"," ",422],"-",["T_WHITESPACE"," ",422],["T_VARIABLE","$timeStart",422],")",")",")",";",["T_WHITESPACE","\n                ",422],"}",["T_WHITESPACE","\n            ",423],"}",["T_WHITESPACE","\n            ",424],["T_ELSE","else",425],["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n                ",425],["T_IF","if",426],["T_WHITESPACE"," ",426],"(",["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","_logLevel",426],["T_WHITESPACE"," ",426],["T_IS_GREATER_OR_EQUAL",">=",426],["T_WHITESPACE"," ",426],["T_STRING","Zend_Log",426],["T_DOUBLE_COLON","::",426],["T_STRING","WARN",426],")",["T_WHITESPACE"," ",426],"{",["T_WHITESPACE","\n                    ",426],["T_IF","if",427],["T_WHITESPACE"," ",427],"(",["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_hasLock",427],")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n                        ",427],["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","_log",428],"(",["T_STRING","sprintf",428],"(",["T_CONSTANT_ENCAPSED_STRING","\"Did not write session for ID %s: another process took the lock.\"",428],",",["T_WHITESPACE","\n                            ",428],["T_VARIABLE","$sessionId",429],["T_WHITESPACE","\n                        ",429],")",",",["T_WHITESPACE"," ",430],["T_STRING","Zend_Log",430],["T_DOUBLE_COLON","::",430],["T_STRING","WARN",430],")",";",["T_WHITESPACE","\n                    ",430],"}",["T_WHITESPACE"," ",431],["T_ELSE","else",431],["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n                        ",431],["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","_log",432],"(",["T_STRING","sprintf",432],"(",["T_CONSTANT_ENCAPSED_STRING","\"Did not write session for ID %s: unable to acquire lock.\"",432],",",["T_WHITESPACE","\n                            ",432],["T_VARIABLE","$sessionId",433],["T_WHITESPACE","\n                        ",433],")",",",["T_WHITESPACE"," ",434],["T_STRING","Zend_Log",434],["T_DOUBLE_COLON","::",434],["T_STRING","WARN",434],")",";",["T_WHITESPACE","\n                    ",434],"}",["T_WHITESPACE","\n                ",435],"}",["T_WHITESPACE","\n            ",436],"}",["T_WHITESPACE","\n        ",437],"}",["T_WHITESPACE","\n        ",438],["T_CATCH","catch",439],"(",["T_STRING","Exception",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$e",439],")",["T_WHITESPACE"," ",439],"{",["T_WHITESPACE","\n            ",439],["T_IF","if",440],["T_WHITESPACE"," ",440],"(",["T_STRING","class_exists",440],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage'",440],",",["T_WHITESPACE"," ",440],["T_STRING","false",440],")",")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n                ",440],["T_STRING","Mage",441],["T_DOUBLE_COLON","::",441],["T_STRING","logException",441],"(",["T_VARIABLE","$e",441],")",";",["T_WHITESPACE","\n            ",441],"}",["T_WHITESPACE"," ",442],["T_ELSE","else",442],["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n                ",442],["T_STRING","error_log",443],"(","\"",["T_VARIABLE","$e",443],"\"",")",";",["T_WHITESPACE","\n            ",443],"}",["T_WHITESPACE","\n            ",444],["T_STRING","Varien_Profiler",445],["T_DOUBLE_COLON","::",445],["T_STRING","stop",445],"(",["T_METHOD_C","__METHOD__",445],")",";",["T_WHITESPACE","\n            ",445],["T_RETURN","return",446],["T_WHITESPACE"," ",446],["T_STRING","FALSE",446],";",["T_WHITESPACE","\n        ",446],"}",["T_WHITESPACE","\n        ",447],["T_STRING","Varien_Profiler",448],["T_DOUBLE_COLON","::",448],["T_STRING","stop",448],"(",["T_METHOD_C","__METHOD__",448],")",";",["T_WHITESPACE","\n        ",448],["T_RETURN","return",449],["T_WHITESPACE"," ",449],["T_STRING","TRUE",449],";",["T_WHITESPACE","\n    ",449],"}",["T_WHITESPACE","\n\n    ",450],["T_DOC_COMMENT","\/**\n     * Destroy session\n     *\n     * @param string $sessionId\n     * @return boolean\n     *\/",452],["T_WHITESPACE","\n    ",457],["T_PUBLIC","public",458],["T_WHITESPACE"," ",458],["T_FUNCTION","function",458],["T_WHITESPACE"," ",458],["T_STRING","destroy",458],"(",["T_VARIABLE","$sessionId",458],")",["T_WHITESPACE","\n    ",458],"{",["T_WHITESPACE","\n        ",459],["T_IF","if",460],["T_WHITESPACE"," ",460],"(",["T_WHITESPACE"," ",460],"!",["T_WHITESPACE"," ",460],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","_useRedis",460],")",["T_WHITESPACE"," ",460],["T_RETURN","return",460],["T_WHITESPACE"," ",460],["T_STRING","parent",460],["T_DOUBLE_COLON","::",460],["T_STRING","destroy",460],"(",["T_VARIABLE","$sessionId",460],")",";",["T_WHITESPACE","\n        ",460],["T_STRING","Varien_Profiler",461],["T_DOUBLE_COLON","::",461],["T_STRING","start",461],"(",["T_METHOD_C","__METHOD__",461],")",";",["T_WHITESPACE","\n\n        ",461],["T_IF","if",463],["T_WHITESPACE"," ",463],"(",["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","_logLevel",463],["T_WHITESPACE"," ",463],["T_IS_GREATER_OR_EQUAL",">=",463],["T_WHITESPACE"," ",463],["T_STRING","Zend_Log",463],["T_DOUBLE_COLON","::",463],["T_STRING","DEBUG",463],")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n            ",463],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_log",464],"(",["T_STRING","sprintf",464],"(",["T_CONSTANT_ENCAPSED_STRING","\"Destroying ID %s\"",464],",",["T_WHITESPACE"," ",464],["T_VARIABLE","$sessionId",464],")",")",";",["T_WHITESPACE","\n        ",464],"}",["T_WHITESPACE","\n        ",465],["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","_redis",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","pipeline",466],"(",")",";",["T_WHITESPACE","\n        ",466],["T_IF","if",467],"(",["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","_dbNum",467],")",["T_WHITESPACE"," ",467],["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","_redis",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","select",467],"(",["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","_dbNum",467],")",";",["T_WHITESPACE","\n        ",467],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","_redis",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","del",468],"(",["T_STRING","self",468],["T_DOUBLE_COLON","::",468],["T_STRING","SESSION_PREFIX",468],".",["T_VARIABLE","$sessionId",468],")",";",["T_WHITESPACE","\n        ",468],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_redis",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","exec",469],"(",")",";",["T_WHITESPACE","\n        ",469],["T_STRING","Varien_Profiler",470],["T_DOUBLE_COLON","::",470],["T_STRING","stop",470],"(",["T_METHOD_C","__METHOD__",470],")",";",["T_WHITESPACE","\n        ",470],["T_RETURN","return",471],["T_WHITESPACE"," ",471],["T_STRING","TRUE",471],";",["T_WHITESPACE","\n    ",471],"}",["T_WHITESPACE","\n\n    ",472],["T_DOC_COMMENT","\/**\n     * Overridden to prevent calling getLifeTime at shutdown\n     *\n     * @return bool\n     *\/",474],["T_WHITESPACE","\n    ",478],["T_PUBLIC","public",479],["T_WHITESPACE"," ",479],["T_FUNCTION","function",479],["T_WHITESPACE"," ",479],["T_STRING","close",479],"(",")",["T_WHITESPACE","\n    ",479],"{",["T_WHITESPACE","\n        ",480],["T_IF","if",481],["T_WHITESPACE"," ",481],"(",["T_WHITESPACE"," ",481],"!",["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","_useRedis",481],")",["T_WHITESPACE"," ",481],["T_RETURN","return",481],["T_WHITESPACE"," ",481],["T_STRING","parent",481],["T_DOUBLE_COLON","::",481],["T_STRING","close",481],"(",")",";",["T_WHITESPACE","\n        ",481],["T_IF","if",482],["T_WHITESPACE"," ",482],"(",["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","_logLevel",482],["T_WHITESPACE"," ",482],["T_IS_GREATER_OR_EQUAL",">=",482],["T_WHITESPACE"," ",482],["T_STRING","Zend_Log",482],["T_DOUBLE_COLON","::",482],["T_STRING","DEBUG",482],")",["T_WHITESPACE"," ",482],"{",["T_WHITESPACE","\n            ",482],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","_log",483],"(",["T_CONSTANT_ENCAPSED_STRING","\"Closing connection\"",483],")",";",["T_WHITESPACE","\n        ",483],"}",["T_WHITESPACE","\n        ",484],["T_IF","if",485],["T_WHITESPACE"," ",485],"(",["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","_redis",485],")",["T_WHITESPACE"," ",485],["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","_redis",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","close",485],"(",")",";",["T_WHITESPACE","\n        ",485],["T_RETURN","return",486],["T_WHITESPACE"," ",486],["T_STRING","TRUE",486],";",["T_WHITESPACE","\n    ",486],"}",["T_WHITESPACE","\n\n    ",487],["T_DOC_COMMENT","\/**\n     * Garbage collection\n     *\n     * @param int $maxLifeTime ignored\n     * @return boolean\n     *\/",489],["T_WHITESPACE","\n    ",494],["T_PUBLIC","public",495],["T_WHITESPACE"," ",495],["T_FUNCTION","function",495],["T_WHITESPACE"," ",495],["T_STRING","gc",495],"(",["T_VARIABLE","$maxLifeTime",495],")",["T_WHITESPACE","\n    ",495],"{",["T_WHITESPACE","\n        ",496],["T_IF","if",497],["T_WHITESPACE"," ",497],"(",["T_WHITESPACE"," ",497],"!",["T_WHITESPACE"," ",497],["T_VARIABLE","$this",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","_useRedis",497],")",["T_WHITESPACE"," ",497],["T_RETURN","return",497],["T_WHITESPACE"," ",497],["T_STRING","parent",497],["T_DOUBLE_COLON","::",497],["T_STRING","gc",497],"(",["T_VARIABLE","$maxLifeTime",497],")",";",["T_WHITESPACE","\n        ",497],["T_RETURN","return",498],["T_WHITESPACE"," ",498],["T_STRING","TRUE",498],";",["T_WHITESPACE","\n    ",498],"}",["T_WHITESPACE","\n\n    ",499],["T_DOC_COMMENT","\/**\n     * @return int|mixed\n     *\/",501],["T_WHITESPACE","\n    ",503],["T_PUBLIC","public",504],["T_WHITESPACE"," ",504],["T_FUNCTION","function",504],["T_WHITESPACE"," ",504],["T_STRING","getLifeTime",504],"(",")",["T_WHITESPACE","\n    ",504],"{",["T_WHITESPACE","\n        ",505],["T_IF","if",506],["T_WHITESPACE"," ",506],"(",["T_WHITESPACE"," ",506],"!",["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","_config",506],")",["T_WHITESPACE"," ",506],["T_RETURN","return",506],["T_WHITESPACE"," ",506],["T_STRING","parent",506],["T_DOUBLE_COLON","::",506],["T_STRING","getLifeTime",506],"(",")",";",["T_WHITESPACE","\n\n        ",506],["T_IF","if",508],["T_WHITESPACE"," ",508],"(",["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","_lifeTime",508],["T_WHITESPACE"," ",508],["T_IS_IDENTICAL","===",508],["T_WHITESPACE"," ",508],["T_STRING","NULL",508],")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n            ",508],["T_VARIABLE","$lifeTime",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_STRING","NULL",509],";",["T_WHITESPACE","\n\n            ",509],["T_COMMENT","\/\/ Detect bots by user agent\n",511],["T_WHITESPACE","            ",512],["T_VARIABLE","$botLifetime",512],["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],"(",["T_INT_CAST","(int)",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","_config",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","descend",512],"(",["T_CONSTANT_ENCAPSED_STRING","'bot_lifetime'",512],")",["T_WHITESPACE"," ",512],"?",":",["T_WHITESPACE"," ",512],["T_STRING","self",512],["T_DOUBLE_COLON","::",512],["T_STRING","DEFAULT_BOT_LIFETIME",512],")",";",["T_WHITESPACE","\n            ",512],["T_IF","if",513],["T_WHITESPACE"," ",513],"(",["T_VARIABLE","$botLifetime",513],")",["T_WHITESPACE"," ",513],"{",["T_WHITESPACE","\n                ",513],["T_VARIABLE","$userAgent",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_EMPTY","empty",514],"(",["T_VARIABLE","$_SERVER",514],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_USER_AGENT'",514],"]",")",["T_WHITESPACE"," ",514],"?",["T_WHITESPACE"," ",514],["T_STRING","FALSE",514],["T_WHITESPACE"," ",514],":",["T_WHITESPACE"," ",514],["T_VARIABLE","$_SERVER",514],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_USER_AGENT'",514],"]",";",["T_WHITESPACE","\n                ",514],["T_VARIABLE","$isBot",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],"!",["T_WHITESPACE"," ",515],["T_VARIABLE","$userAgent",515],["T_WHITESPACE"," ",515],["T_BOOLEAN_OR","||",515],["T_WHITESPACE"," ",515],["T_STRING","preg_match",515],"(",["T_STRING","self",515],["T_DOUBLE_COLON","::",515],["T_STRING","BOT_REGEX",515],",",["T_WHITESPACE"," ",515],["T_VARIABLE","$userAgent",515],")",";",["T_WHITESPACE","\n                ",515],["T_IF","if",516],["T_WHITESPACE"," ",516],"(",["T_VARIABLE","$isBot",516],")",["T_WHITESPACE"," ",516],"{",["T_WHITESPACE","\n                    ",516],["T_IF","if",517],["T_WHITESPACE"," ",517],"(",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","_logLevel",517],["T_WHITESPACE"," ",517],">",["T_WHITESPACE"," ",517],["T_STRING","Zend_Log",517],["T_DOUBLE_COLON","::",517],["T_STRING","DEBUG",517],")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n                        ",517],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","_log",518],"(",["T_STRING","sprintf",518],"(",["T_CONSTANT_ENCAPSED_STRING","\"Bot detected for user agent: %s\"",518],",",["T_WHITESPACE"," ",518],["T_VARIABLE","$userAgent",518],")",")",";",["T_WHITESPACE","\n                    ",518],"}",["T_WHITESPACE","\n                    ",519],["T_IF","if",520],["T_WHITESPACE"," ",520],"(",["T_WHITESPACE"," ",520],["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","_sessionWrites",520],["T_WHITESPACE"," ",520],["T_IS_SMALLER_OR_EQUAL","<=",520],["T_WHITESPACE"," ",520],["T_LNUMBER","1",520],["T_WHITESPACE","\n                      ",520],["T_BOOLEAN_AND","&&",521],["T_WHITESPACE"," ",521],"(",["T_VARIABLE","$botFirstLifetime",521],["T_WHITESPACE"," ",521],"=",["T_WHITESPACE"," ",521],"(",["T_INT_CAST","(int)",521],["T_WHITESPACE"," ",521],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","_config",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","descend",521],"(",["T_CONSTANT_ENCAPSED_STRING","'bot_first_lifetime'",521],")",["T_WHITESPACE"," ",521],"?",":",["T_WHITESPACE"," ",521],["T_STRING","self",521],["T_DOUBLE_COLON","::",521],["T_STRING","DEFAULT_BOT_FIRST_LIFETIME",521],")",")",["T_WHITESPACE","\n                    ",521],")",["T_WHITESPACE"," ",522],"{",["T_WHITESPACE","\n                        ",522],["T_VARIABLE","$lifeTime",523],["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_VARIABLE","$botFirstLifetime",523],["T_WHITESPACE"," ",523],"*",["T_WHITESPACE"," ",523],"(",["T_LNUMBER","1",523],"+",["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_sessionWrites",523],")",";",["T_WHITESPACE","\n                    ",523],"}",["T_WHITESPACE"," ",524],["T_ELSE","else",524],["T_WHITESPACE"," ",524],"{",["T_WHITESPACE","\n                        ",524],["T_VARIABLE","$lifeTime",525],["T_WHITESPACE"," ",525],"=",["T_WHITESPACE"," ",525],["T_STRING","min",525],"(",["T_STRING","parent",525],["T_DOUBLE_COLON","::",525],["T_STRING","getLifeTime",525],"(",")",",",["T_WHITESPACE"," ",525],["T_VARIABLE","$botLifetime",525],")",";",["T_WHITESPACE","\n                    ",525],"}",["T_WHITESPACE","\n                ",526],"}",["T_WHITESPACE","\n            ",527],"}",["T_WHITESPACE","\n\n            ",528],["T_COMMENT","\/\/ Use different lifetime for first write\n",530],["T_WHITESPACE","            ",531],["T_IF","if",531],["T_WHITESPACE"," ",531],"(",["T_VARIABLE","$lifeTime",531],["T_WHITESPACE"," ",531],["T_IS_IDENTICAL","===",531],["T_WHITESPACE"," ",531],["T_STRING","NULL",531],["T_WHITESPACE"," ",531],["T_BOOLEAN_AND","&&",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","_sessionWrites",531],["T_WHITESPACE"," ",531],["T_IS_SMALLER_OR_EQUAL","<=",531],["T_WHITESPACE"," ",531],["T_LNUMBER","1",531],")",["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n                ",531],["T_VARIABLE","$firstLifetime",532],["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],"(",["T_INT_CAST","(int)",532],["T_WHITESPACE"," ",532],["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","_config",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","descend",532],"(",["T_CONSTANT_ENCAPSED_STRING","'first_lifetime'",532],")",["T_WHITESPACE"," ",532],"?",":",["T_WHITESPACE"," ",532],["T_STRING","self",532],["T_DOUBLE_COLON","::",532],["T_STRING","DEFAULT_FIRST_LIFETIME",532],")",";",["T_WHITESPACE","\n                ",532],["T_IF","if",533],["T_WHITESPACE"," ",533],"(",["T_VARIABLE","$firstLifetime",533],")",["T_WHITESPACE"," ",533],"{",["T_WHITESPACE","\n                    ",533],["T_VARIABLE","$lifeTime",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_VARIABLE","$firstLifetime",534],["T_WHITESPACE"," ",534],"*",["T_WHITESPACE"," ",534],"(",["T_LNUMBER","1",534],"+",["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","_sessionWrites",534],")",";",["T_WHITESPACE","\n                ",534],"}",["T_WHITESPACE","\n            ",535],"}",["T_WHITESPACE","\n\n            ",536],["T_COMMENT","\/\/ Neither bot nor first write\n",538],["T_WHITESPACE","            ",539],["T_IF","if",539],["T_WHITESPACE"," ",539],"(",["T_VARIABLE","$lifeTime",539],["T_WHITESPACE"," ",539],["T_IS_IDENTICAL","===",539],["T_WHITESPACE"," ",539],["T_STRING","NULL",539],")",["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n                ",539],["T_VARIABLE","$lifeTime",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_STRING","parent",540],["T_DOUBLE_COLON","::",540],["T_STRING","getLifeTime",540],"(",")",";",["T_WHITESPACE","\n            ",540],"}",["T_WHITESPACE","\n\n            ",541],["T_VARIABLE","$this",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","_lifeTime",543],["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_VARIABLE","$lifeTime",543],";",["T_WHITESPACE","\n            ",543],["T_IF","if",544],["T_WHITESPACE"," ",544],"(",["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","_lifeTime",544],["T_WHITESPACE"," ",544],"<",["T_WHITESPACE"," ",544],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","_minLifetime",544],")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n                ",544],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","_lifeTime",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","_minLifetime",545],";",["T_WHITESPACE","\n            ",545],"}",["T_WHITESPACE","\n            ",546],["T_IF","if",547],["T_WHITESPACE"," ",547],"(",["T_VARIABLE","$this",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","_lifeTime",547],["T_WHITESPACE"," ",547],">",["T_WHITESPACE"," ",547],["T_VARIABLE","$this",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","_maxLifetime",547],")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n                ",547],["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","_lifeTime",548],["T_WHITESPACE"," ",548],"=",["T_WHITESPACE"," ",548],["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","_maxLifetime",548],";",["T_WHITESPACE","\n            ",548],"}",["T_WHITESPACE","\n        ",549],"}",["T_WHITESPACE","\n        ",550],["T_RETURN","return",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_lifeTime",551],";",["T_WHITESPACE","\n    ",551],"}",["T_WHITESPACE","\n\n    ",552],["T_DOC_COMMENT","\/**\n     * Public for testing purposes only.\n     *\n     * @param string $data\n     * @return string\n     *\/",554],["T_WHITESPACE","\n    ",559],["T_PUBLIC","public",560],["T_WHITESPACE"," ",560],["T_FUNCTION","function",560],["T_WHITESPACE"," ",560],["T_STRING","_encodeData",560],"(",["T_VARIABLE","$data",560],")",["T_WHITESPACE","\n    ",560],"{",["T_WHITESPACE","\n        ",561],["T_STRING","Varien_Profiler",562],["T_DOUBLE_COLON","::",562],["T_STRING","start",562],"(",["T_METHOD_C","__METHOD__",562],")",";",["T_WHITESPACE","\n        ",562],["T_VARIABLE","$originalDataSize",563],["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_STRING","strlen",563],"(",["T_VARIABLE","$data",563],")",";",["T_WHITESPACE","\n        ",563],["T_IF","if",564],["T_WHITESPACE"," ",564],"(",["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","_compressionThreshold",564],["T_WHITESPACE"," ",564],">",["T_WHITESPACE"," ",564],["T_LNUMBER","0",564],["T_WHITESPACE"," ",564],["T_BOOLEAN_AND","&&",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","_compressionLib",564],["T_WHITESPACE"," ",564],["T_IS_NOT_EQUAL","!=",564],["T_WHITESPACE"," ",564],["T_CONSTANT_ENCAPSED_STRING","'none'",564],["T_WHITESPACE"," ",564],["T_BOOLEAN_AND","&&",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$originalDataSize",564],["T_WHITESPACE"," ",564],["T_IS_GREATER_OR_EQUAL",">=",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","_compressionThreshold",564],")",["T_WHITESPACE"," ",564],"{",["T_WHITESPACE","\n            ",564],["T_IF","if",565],["T_WHITESPACE"," ",565],"(",["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","_logLevel",565],["T_WHITESPACE"," ",565],["T_IS_GREATER_OR_EQUAL",">=",565],["T_WHITESPACE"," ",565],["T_STRING","Zend_Log",565],["T_DOUBLE_COLON","::",565],["T_STRING","DEBUG",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n                ",565],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","_log",566],"(",["T_STRING","sprintf",566],"(",["T_CONSTANT_ENCAPSED_STRING","\"Compressing %s bytes with %s\"",566],",",["T_WHITESPACE"," ",566],["T_VARIABLE","$originalDataSize",566],",",["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","_compressionLib",566],")",")",";",["T_WHITESPACE","\n                ",566],["T_VARIABLE","$timeStart",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_STRING","microtime",567],"(",["T_STRING","true",567],")",";",["T_WHITESPACE","\n            ",567],"}",["T_WHITESPACE","\n            ",568],["T_VARIABLE","$prefix",569],["T_WHITESPACE"," ",569],"=",["T_WHITESPACE"," ",569],["T_CONSTANT_ENCAPSED_STRING","':'",569],".",["T_STRING","substr",569],"(",["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_compressionLib",569],",",["T_LNUMBER","0",569],",",["T_LNUMBER","2",569],")",".",["T_CONSTANT_ENCAPSED_STRING","':'",569],";",["T_WHITESPACE","\n            ",569],["T_SWITCH","switch",570],"(",["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","_compressionLib",570],")",["T_WHITESPACE"," ",570],"{",["T_WHITESPACE","\n                ",570],["T_CASE","case",571],["T_WHITESPACE"," ",571],["T_CONSTANT_ENCAPSED_STRING","'snappy'",571],":",["T_WHITESPACE"," ",571],["T_VARIABLE","$data",571],["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_STRING","snappy_compress",571],"(",["T_VARIABLE","$data",571],")",";",["T_WHITESPACE"," ",571],["T_BREAK","break",571],";",["T_WHITESPACE","\n                ",571],["T_CASE","case",572],["T_WHITESPACE"," ",572],["T_CONSTANT_ENCAPSED_STRING","'lzf'",572],":",["T_WHITESPACE","    ",572],["T_VARIABLE","$data",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_STRING","lzf_compress",572],"(",["T_VARIABLE","$data",572],")",";",["T_WHITESPACE"," ",572],["T_BREAK","break",572],";",["T_WHITESPACE","\n                ",572],["T_CASE","case",573],["T_WHITESPACE"," ",573],["T_CONSTANT_ENCAPSED_STRING","'lz4'",573],":",["T_WHITESPACE","    ",573],["T_VARIABLE","$data",573],["T_WHITESPACE"," ",573],"=",["T_WHITESPACE"," ",573],["T_STRING","lz4_compress",573],"(",["T_VARIABLE","$data",573],")",";",["T_WHITESPACE"," ",573],["T_VARIABLE","$prefix",573],["T_WHITESPACE"," ",573],"=",["T_WHITESPACE"," ",573],["T_CONSTANT_ENCAPSED_STRING","':l4:'",573],";",["T_WHITESPACE"," ",573],["T_BREAK","break",573],";",["T_WHITESPACE","\n                ",573],["T_CASE","case",574],["T_WHITESPACE"," ",574],["T_CONSTANT_ENCAPSED_STRING","'gzip'",574],":",["T_WHITESPACE","   ",574],["T_VARIABLE","$data",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_STRING","gzcompress",574],"(",["T_VARIABLE","$data",574],",",["T_WHITESPACE"," ",574],["T_LNUMBER","1",574],")",";",["T_WHITESPACE"," ",574],["T_BREAK","break",574],";",["T_WHITESPACE","\n            ",574],"}",["T_WHITESPACE","\n            ",575],["T_IF","if",576],"(",["T_VARIABLE","$data",576],")",["T_WHITESPACE"," ",576],"{",["T_WHITESPACE","\n                ",576],["T_VARIABLE","$data",577],["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_VARIABLE","$prefix",577],".",["T_VARIABLE","$data",577],";",["T_WHITESPACE","\n                ",577],["T_IF","if",578],["T_WHITESPACE"," ",578],"(",["T_VARIABLE","$this",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","_logLevel",578],["T_WHITESPACE"," ",578],["T_IS_GREATER_OR_EQUAL",">=",578],["T_WHITESPACE"," ",578],["T_STRING","Zend_Log",578],["T_DOUBLE_COLON","::",578],["T_STRING","DEBUG",578],")",["T_WHITESPACE"," ",578],"{",["T_WHITESPACE","\n                    ",578],["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","_log",579],"(",["T_STRING","sprintf",579],"(",["T_CONSTANT_ENCAPSED_STRING","\"Data compressed by %.1f percent in %.5f seconds\"",579],",",["T_WHITESPACE","\n                        ",579],"(",["T_VARIABLE","$originalDataSize",580],["T_WHITESPACE"," ",580],["T_IS_EQUAL","==",580],["T_WHITESPACE"," ",580],["T_LNUMBER","0",580],["T_WHITESPACE"," ",580],"?",["T_WHITESPACE"," ",580],["T_LNUMBER","0",580],["T_WHITESPACE"," ",580],":",["T_WHITESPACE"," ",580],"(",["T_LNUMBER","100",580],["T_WHITESPACE"," ",580],"-",["T_WHITESPACE"," ",580],"(",["T_STRING","strlen",580],"(",["T_VARIABLE","$data",580],")",["T_WHITESPACE"," ",580],"\/",["T_WHITESPACE"," ",580],["T_VARIABLE","$originalDataSize",580],["T_WHITESPACE"," ",580],"*",["T_WHITESPACE"," ",580],["T_LNUMBER","100",580],")",")",")",",",["T_WHITESPACE"," ",580],"(",["T_STRING","microtime",580],"(",["T_STRING","true",580],")",["T_WHITESPACE"," ",580],"-",["T_WHITESPACE"," ",580],["T_VARIABLE","$timeStart",580],")",["T_WHITESPACE","\n                    ",580],")",")",";",["T_WHITESPACE","\n                ",581],"}",["T_WHITESPACE","\n            ",582],"}",["T_WHITESPACE"," ",583],["T_ELSE","else",583],["T_WHITESPACE"," ",583],["T_IF","if",583],["T_WHITESPACE"," ",583],"(",["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","_logLevel",583],["T_WHITESPACE"," ",583],["T_IS_GREATER_OR_EQUAL",">=",583],["T_WHITESPACE"," ",583],["T_STRING","Zend_Log",583],["T_DOUBLE_COLON","::",583],["T_STRING","WARN",583],")",["T_WHITESPACE"," ",583],"{",["T_WHITESPACE","\n                ",583],["T_VARIABLE","$this",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","_log",584],"(",["T_STRING","sprintf",584],"(",["T_CONSTANT_ENCAPSED_STRING","\"Could not compress session data using %s\"",584],",",["T_WHITESPACE"," ",584],["T_VARIABLE","$this",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","_compressionLib",584],")",",",["T_WHITESPACE"," ",584],["T_STRING","Zend_Log",584],["T_DOUBLE_COLON","::",584],["T_STRING","WARN",584],")",";",["T_WHITESPACE","\n            ",584],"}",["T_WHITESPACE","\n        ",585],"}",["T_WHITESPACE","\n        ",586],["T_STRING","Varien_Profiler",587],["T_DOUBLE_COLON","::",587],["T_STRING","stop",587],"(",["T_METHOD_C","__METHOD__",587],")",";",["T_WHITESPACE","\n        ",587],["T_RETURN","return",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$data",588],";",["T_WHITESPACE","\n    ",588],"}",["T_WHITESPACE","\n\n    ",589],["T_DOC_COMMENT","\/**\n     * Public for testing purposes only.\n     *\n     * @param string $data\n     * @return string\n     *\/",591],["T_WHITESPACE","\n    ",596],["T_PUBLIC","public",597],["T_WHITESPACE"," ",597],["T_FUNCTION","function",597],["T_WHITESPACE"," ",597],["T_STRING","_decodeData",597],"(",["T_VARIABLE","$data",597],")",["T_WHITESPACE","\n    ",597],"{",["T_WHITESPACE","\n        ",598],["T_STRING","Varien_Profiler",599],["T_DOUBLE_COLON","::",599],["T_STRING","start",599],"(",["T_METHOD_C","__METHOD__",599],")",";",["T_WHITESPACE","\n        ",599],["T_SWITCH","switch",600],["T_WHITESPACE"," ",600],"(",["T_STRING","substr",600],"(",["T_VARIABLE","$data",600],",",["T_LNUMBER","0",600],",",["T_LNUMBER","4",600],")",")",["T_WHITESPACE"," ",600],"{",["T_WHITESPACE","\n            ",600],["T_COMMENT","\/\/ asking the data which library it uses allows for transparent changes of libraries\n",601],["T_WHITESPACE","            ",602],["T_CASE","case",602],["T_WHITESPACE"," ",602],["T_CONSTANT_ENCAPSED_STRING","':sn:'",602],":",["T_WHITESPACE"," ",602],["T_VARIABLE","$data",602],["T_WHITESPACE"," ",602],"=",["T_WHITESPACE"," ",602],["T_STRING","snappy_uncompress",602],"(",["T_STRING","substr",602],"(",["T_VARIABLE","$data",602],",",["T_LNUMBER","4",602],")",")",";",["T_WHITESPACE"," ",602],["T_BREAK","break",602],";",["T_WHITESPACE","\n            ",602],["T_CASE","case",603],["T_WHITESPACE"," ",603],["T_CONSTANT_ENCAPSED_STRING","':lz:'",603],":",["T_WHITESPACE"," ",603],["T_VARIABLE","$data",603],["T_WHITESPACE"," ",603],"=",["T_WHITESPACE"," ",603],["T_STRING","lzf_decompress",603],"(",["T_STRING","substr",603],"(",["T_VARIABLE","$data",603],",",["T_LNUMBER","4",603],")",")",";",["T_WHITESPACE"," ",603],["T_BREAK","break",603],";",["T_WHITESPACE","\n            ",603],["T_CASE","case",604],["T_WHITESPACE"," ",604],["T_CONSTANT_ENCAPSED_STRING","':l4:'",604],":",["T_WHITESPACE"," ",604],["T_VARIABLE","$data",604],["T_WHITESPACE"," ",604],"=",["T_WHITESPACE"," ",604],["T_STRING","lz4_uncompress",604],"(",["T_STRING","substr",604],"(",["T_VARIABLE","$data",604],",",["T_LNUMBER","4",604],")",")",";",["T_WHITESPACE"," ",604],["T_BREAK","break",604],";",["T_WHITESPACE","\n            ",604],["T_CASE","case",605],["T_WHITESPACE"," ",605],["T_CONSTANT_ENCAPSED_STRING","':gz:'",605],":",["T_WHITESPACE"," ",605],["T_VARIABLE","$data",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_STRING","gzuncompress",605],"(",["T_STRING","substr",605],"(",["T_VARIABLE","$data",605],",",["T_LNUMBER","4",605],")",")",";",["T_WHITESPACE"," ",605],["T_BREAK","break",605],";",["T_WHITESPACE","\n        ",605],"}",["T_WHITESPACE","\n        ",606],["T_STRING","Varien_Profiler",607],["T_DOUBLE_COLON","::",607],["T_STRING","stop",607],"(",["T_METHOD_C","__METHOD__",607],")",";",["T_WHITESPACE","\n        ",607],["T_RETURN","return",608],["T_WHITESPACE"," ",608],["T_VARIABLE","$data",608],";",["T_WHITESPACE","\n    ",608],"}",["T_WHITESPACE","\n\n    ",609],["T_DOC_COMMENT","\/**\n     * Public for testing\/import purposes only.\n     *\n     * @param $id\n     * @param $data\n     * @param $lifetime\n     * @throws Exception\n     *\/",611],["T_WHITESPACE","\n    ",618],["T_PUBLIC","public",619],["T_WHITESPACE"," ",619],["T_FUNCTION","function",619],["T_WHITESPACE"," ",619],["T_STRING","_writeRawSession",619],"(",["T_VARIABLE","$id",619],",",["T_WHITESPACE"," ",619],["T_VARIABLE","$data",619],",",["T_WHITESPACE"," ",619],["T_VARIABLE","$lifetime",619],")",["T_WHITESPACE","\n    ",619],"{",["T_WHITESPACE","\n        ",620],["T_IF","if",621],["T_WHITESPACE"," ",621],"(",["T_WHITESPACE"," ",621],"!",["T_WHITESPACE"," ",621],["T_VARIABLE","$this",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","_useRedis",621],")",["T_WHITESPACE"," ",621],"{",["T_WHITESPACE","\n            ",621],["T_THROW","throw",622],["T_WHITESPACE"," ",622],["T_NEW","new",622],["T_WHITESPACE"," ",622],["T_STRING","Exception",622],"(",["T_CONSTANT_ENCAPSED_STRING","'Not connected to redis!'",622],")",";",["T_WHITESPACE","\n        ",622],"}",["T_WHITESPACE","\n\n        ",623],["T_VARIABLE","$sessionId",625],["T_WHITESPACE"," ",625],"=",["T_WHITESPACE"," ",625],["T_CONSTANT_ENCAPSED_STRING","'sess_'",625],["T_WHITESPACE"," ",625],".",["T_WHITESPACE"," ",625],["T_VARIABLE","$id",625],";",["T_WHITESPACE","\n        ",625],["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","_redis",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","pipeline",626],"(",")",["T_WHITESPACE","\n            ",626],["T_OBJECT_OPERATOR","->",627],["T_STRING","select",627],"(",["T_VARIABLE","$this",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","_dbNum",627],")",["T_WHITESPACE","\n            ",627],["T_OBJECT_OPERATOR","->",628],["T_STRING","hMSet",628],"(",["T_VARIABLE","$sessionId",628],",",["T_WHITESPACE"," ",628],["T_ARRAY","array",628],"(",["T_WHITESPACE","\n                ",628],["T_CONSTANT_ENCAPSED_STRING","'data'",629],["T_WHITESPACE"," ",629],["T_DOUBLE_ARROW","=>",629],["T_WHITESPACE"," ",629],["T_VARIABLE","$this",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","_encodeData",629],"(",["T_VARIABLE","$data",629],")",",",["T_WHITESPACE","\n                ",629],["T_CONSTANT_ENCAPSED_STRING","'lock'",630],["T_WHITESPACE"," ",630],["T_DOUBLE_ARROW","=>",630],["T_WHITESPACE"," ",630],["T_LNUMBER","0",630],",",["T_WHITESPACE"," ",630],["T_COMMENT","\/\/ 0 so that next lock attempt will get 1\n",630],["T_WHITESPACE","            ",631],")",")",["T_WHITESPACE","\n            ",631],["T_OBJECT_OPERATOR","->",632],["T_STRING","hIncrBy",632],"(",["T_VARIABLE","$sessionId",632],",",["T_WHITESPACE"," ",632],["T_CONSTANT_ENCAPSED_STRING","'writes'",632],",",["T_WHITESPACE"," ",632],["T_LNUMBER","1",632],")",["T_WHITESPACE","\n            ",632],["T_OBJECT_OPERATOR","->",633],["T_STRING","expire",633],"(",["T_VARIABLE","$sessionId",633],",",["T_WHITESPACE"," ",633],["T_STRING","min",633],"(",["T_VARIABLE","$lifetime",633],",",["T_WHITESPACE"," ",633],["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","_maxLifetime",633],")",")",["T_WHITESPACE","\n            ",633],["T_OBJECT_OPERATOR","->",634],["T_STRING","exec",634],"(",")",";",["T_WHITESPACE","\n    ",634],"}",["T_WHITESPACE","\n\n    ",635],["T_DOC_COMMENT","\/**\n     * @param string $id\n     * @return array\n     * @throws Exception\n     *\/",637],["T_WHITESPACE","\n    ",641],["T_PUBLIC","public",642],["T_WHITESPACE"," ",642],["T_FUNCTION","function",642],["T_WHITESPACE"," ",642],["T_STRING","_inspectSession",642],"(",["T_VARIABLE","$id",642],")",["T_WHITESPACE","\n    ",642],"{",["T_WHITESPACE","\n        ",643],["T_IF","if",644],["T_WHITESPACE"," ",644],"(",["T_WHITESPACE"," ",644],"!",["T_WHITESPACE"," ",644],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","_useRedis",644],")",["T_WHITESPACE"," ",644],"{",["T_WHITESPACE","\n            ",644],["T_THROW","throw",645],["T_WHITESPACE"," ",645],["T_NEW","new",645],["T_WHITESPACE"," ",645],["T_STRING","Exception",645],"(",["T_CONSTANT_ENCAPSED_STRING","'Not connected to redis!'",645],")",";",["T_WHITESPACE","\n        ",645],"}",["T_WHITESPACE","\n\n        ",646],["T_VARIABLE","$sessionId",648],["T_WHITESPACE"," ",648],"=",["T_WHITESPACE"," ",648],["T_STRING","strpos",648],"(",["T_VARIABLE","$id",648],",",["T_WHITESPACE"," ",648],["T_CONSTANT_ENCAPSED_STRING","'sess_'",648],")",["T_WHITESPACE"," ",648],["T_IS_IDENTICAL","===",648],["T_WHITESPACE"," ",648],["T_LNUMBER","0",648],["T_WHITESPACE"," ",648],"?",["T_WHITESPACE"," ",648],["T_VARIABLE","$id",648],["T_WHITESPACE"," ",648],":",["T_WHITESPACE"," ",648],["T_CONSTANT_ENCAPSED_STRING","'sess_'",648],["T_WHITESPACE"," ",648],".",["T_WHITESPACE"," ",648],["T_VARIABLE","$id",648],";",["T_WHITESPACE","\n        ",648],["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","_redis",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","select",649],"(",["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","_dbNum",649],")",";",["T_WHITESPACE","\n        ",649],["T_VARIABLE","$data",650],["T_WHITESPACE"," ",650],"=",["T_WHITESPACE"," ",650],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","_redis",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","hGetAll",650],"(",["T_VARIABLE","$sessionId",650],")",";",["T_WHITESPACE","\n        ",650],["T_IF","if",651],["T_WHITESPACE"," ",651],"(",["T_VARIABLE","$data",651],["T_WHITESPACE"," ",651],["T_BOOLEAN_AND","&&",651],["T_WHITESPACE"," ",651],["T_ISSET","isset",651],"(",["T_VARIABLE","$data",651],"[",["T_CONSTANT_ENCAPSED_STRING","'data'",651],"]",")",")",["T_WHITESPACE"," ",651],"{",["T_WHITESPACE","\n            ",651],["T_VARIABLE","$data",652],"[",["T_CONSTANT_ENCAPSED_STRING","'data'",652],"]",["T_WHITESPACE"," ",652],"=",["T_WHITESPACE"," ",652],["T_VARIABLE","$this",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","_decodeData",652],"(",["T_VARIABLE","$data",652],"[",["T_CONSTANT_ENCAPSED_STRING","'data'",652],"]",")",";",["T_WHITESPACE","\n        ",652],"}",["T_WHITESPACE","\n        ",653],["T_RETURN","return",654],["T_WHITESPACE"," ",654],["T_VARIABLE","$data",654],";",["T_WHITESPACE","\n    ",654],"}",["T_WHITESPACE","\n\n    ",655],["T_DOC_COMMENT","\/**\n     * Public for testing\/inspection purposes only.\n     *\n     * @param $forceStandalone\n     * @return Credis_Client\n     *\/",657],["T_WHITESPACE","\n    ",662],["T_PUBLIC","public",663],["T_WHITESPACE"," ",663],["T_FUNCTION","function",663],["T_WHITESPACE"," ",663],["T_STRING","_redisClient",663],"(",["T_VARIABLE","$forceStandalone",663],")",["T_WHITESPACE","\n    ",663],"{",["T_WHITESPACE","\n        ",664],["T_IF","if",665],["T_WHITESPACE"," ",665],"(",["T_VARIABLE","$forceStandalone",665],")",["T_WHITESPACE"," ",665],"{",["T_WHITESPACE","\n            ",665],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","_redis",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","forceStandalone",666],"(",")",";",["T_WHITESPACE","\n        ",666],"}",["T_WHITESPACE","\n        ",667],["T_IF","if",668],["T_WHITESPACE"," ",668],"(",["T_VARIABLE","$this",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","_dbNum",668],")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n            ",668],["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","_redis",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","select",669],"(",["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","_dbNum",669],")",";",["T_WHITESPACE","\n        ",669],"}",["T_WHITESPACE","\n        ",670],["T_RETURN","return",671],["T_WHITESPACE"," ",671],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","_redis",671],";",["T_WHITESPACE","\n    ",671],"}",["T_WHITESPACE","\n\n    ",672],["T_DOC_COMMENT","\/**\n     * @return string\n     *\/",674],["T_WHITESPACE","\n    ",676],["T_PUBLIC","public",677],["T_WHITESPACE"," ",677],["T_FUNCTION","function",677],["T_WHITESPACE"," ",677],["T_STRING","_getPid",677],"(",")",["T_WHITESPACE","\n    ",677],"{",["T_WHITESPACE","\n        ",678],["T_RETURN","return",679],["T_WHITESPACE"," ",679],["T_STRING","gethostname",679],"(",")",".",["T_CONSTANT_ENCAPSED_STRING","'|'",679],".",["T_STRING","getmypid",679],"(",")",";",["T_WHITESPACE","\n    ",679],"}",["T_WHITESPACE","\n\n    ",680],["T_DOC_COMMENT","\/**\n     * @param $pid\n     * @return bool\n     *\/",682],["T_WHITESPACE","\n    ",685],["T_PUBLIC","public",686],["T_WHITESPACE"," ",686],["T_FUNCTION","function",686],["T_WHITESPACE"," ",686],["T_STRING","_pidExists",686],"(",["T_VARIABLE","$pid",686],")",["T_WHITESPACE","\n    ",686],"{",["T_WHITESPACE","\n        ",687],["T_LIST","list",688],"(",["T_VARIABLE","$host",688],",",["T_VARIABLE","$pid",688],")",["T_WHITESPACE"," ",688],"=",["T_WHITESPACE"," ",688],["T_STRING","explode",688],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",688],",",["T_WHITESPACE"," ",688],["T_VARIABLE","$pid",688],")",";",["T_WHITESPACE","\n        ",688],["T_IF","if",689],["T_WHITESPACE"," ",689],"(",["T_STRING","PHP_OS",689],["T_WHITESPACE"," ",689],["T_IS_NOT_EQUAL","!=",689],["T_WHITESPACE"," ",689],["T_CONSTANT_ENCAPSED_STRING","'Linux'",689],["T_WHITESPACE"," ",689],["T_BOOLEAN_OR","||",689],["T_WHITESPACE"," ",689],["T_VARIABLE","$host",689],["T_WHITESPACE"," ",689],["T_IS_NOT_EQUAL","!=",689],["T_WHITESPACE"," ",689],["T_STRING","gethostname",689],"(",")",")",["T_WHITESPACE"," ",689],"{",["T_WHITESPACE","\n            ",689],["T_RETURN","return",690],["T_WHITESPACE"," ",690],["T_STRING","TRUE",690],";",["T_WHITESPACE","\n        ",690],"}",["T_WHITESPACE","\n        ",691],["T_RETURN","return",692],["T_WHITESPACE"," ",692],"@",["T_STRING","file_exists",692],"(",["T_CONSTANT_ENCAPSED_STRING","'\/proc\/'",692],".",["T_VARIABLE","$pid",692],")",";",["T_WHITESPACE","\n    ",692],"}",["T_WHITESPACE","\n\n",693],"}",["T_WHITESPACE","\n",695]]