[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magentocommerce.com so we can send you a copy immediately.\n *\n * @category    Phoenix\n * @package     Phoenix_Moneybookers\n * @copyright   Copyright (c) 2016 Phoenix Medien GmbH & Co. KG (http:\/\/www.phoenix-medien.de)\n * @license     http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","Phoenix_Moneybookers_ProcessingController",20],["T_WHITESPACE"," ",20],["T_EXTENDS","extends",20],["T_WHITESPACE"," ",20],["T_STRING","Mage_Core_Controller_Front_Action",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_DOC_COMMENT","\/**\n     * Get singleton of Checkout Session Model\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",22],["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_FUNCTION","function",27],["T_WHITESPACE"," ",27],["T_STRING","_getCheckout",27],"(",")",["T_WHITESPACE","\n    ",27],"{",["T_WHITESPACE","\n        ",28],["T_RETURN","return",29],["T_WHITESPACE"," ",29],["T_STRING","Mage",29],["T_DOUBLE_COLON","::",29],["T_STRING","getSingleton",29],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",29],")",";",["T_WHITESPACE","\n    ",29],"}",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * Iframe page which submits the payment data to Moneybookers.\n     *\/",32],["T_WHITESPACE","\n    ",34],["T_PUBLIC","public",35],["T_WHITESPACE"," ",35],["T_FUNCTION","function",35],["T_WHITESPACE"," ",35],["T_STRING","placeformAction",35],"(",")",["T_WHITESPACE","\n    ",35],"{",["T_WHITESPACE","\n       ",36],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","loadLayout",37],"(",")",";",["T_WHITESPACE","\n       ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","renderLayout",38],"(",")",";",["T_WHITESPACE","\n    ",38],"}",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Show orderPlaceRedirect page which contains the Moneybookers iframe.\n     *\/",41],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","paymentAction",44],"(",")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_TRY","try",46],["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n            ",46],["T_VARIABLE","$session",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_getCheckout",47],"(",")",";",["T_WHITESPACE","\n\n            ",47],["T_VARIABLE","$order",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","Mage",49],["T_DOUBLE_COLON","::",49],["T_STRING","getModel",49],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",49],")",";",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$order",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","loadByIncrementId",50],"(",["T_VARIABLE","$session",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getLastRealOrderId",50],"(",")",")",";",["T_WHITESPACE","\n            ",50],["T_IF","if",51],["T_WHITESPACE"," ",51],"(","!",["T_VARIABLE","$order",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getId",51],"(",")",")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n                ",51],["T_STRING","Mage",52],["T_DOUBLE_COLON","::",52],["T_STRING","throwException",52],"(",["T_CONSTANT_ENCAPSED_STRING","'No order for processing found'",52],")",";",["T_WHITESPACE","\n            ",52],"}",["T_WHITESPACE","\n            ",53],["T_VARIABLE","$order",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","setState",54],"(",["T_STRING","Mage_Sales_Model_Order",54],["T_DOUBLE_COLON","::",54],["T_STRING","STATE_PENDING_PAYMENT",54],",",["T_WHITESPACE"," ",54],["T_STRING","Mage_Sales_Model_Order",54],["T_DOUBLE_COLON","::",54],["T_STRING","STATE_PENDING_PAYMENT",54],",",["T_WHITESPACE","\n                ",54],["T_STRING","Mage",55],["T_DOUBLE_COLON","::",55],["T_STRING","helper",55],"(",["T_CONSTANT_ENCAPSED_STRING","'moneybookers'",55],")",["T_OBJECT_OPERATOR","->",55],["T_STRING","__",55],"(",["T_CONSTANT_ENCAPSED_STRING","'The customer was redirected to Moneybookers.'",55],")",["T_WHITESPACE","\n            ",55],")",";",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$order",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","save",57],"(",")",";",["T_WHITESPACE","\n\n            ",57],["T_VARIABLE","$session",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","setMoneybookersQuoteId",59],"(",["T_VARIABLE","$session",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getQuoteId",59],"(",")",")",";",["T_WHITESPACE","\n            ",59],["T_VARIABLE","$session",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","setMoneybookersRealOrderId",60],"(",["T_VARIABLE","$session",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getLastRealOrderId",60],"(",")",")",";",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$session",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getQuote",61],"(",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","setIsActive",61],"(",["T_STRING","false",61],")",["T_OBJECT_OPERATOR","->",61],["T_STRING","save",61],"(",")",";",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$session",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","clear",62],"(",")",";",["T_WHITESPACE","\n\n            ",62],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","loadLayout",64],"(",")",";",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","renderLayout",65],"(",")",";",["T_WHITESPACE","\n        ",65],"}",["T_WHITESPACE"," ",66],["T_CATCH","catch",66],["T_WHITESPACE"," ",66],"(",["T_STRING","Exception",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$e",66],")","{",["T_WHITESPACE","\n            ",66],["T_STRING","Mage",67],["T_DOUBLE_COLON","::",67],["T_STRING","logException",67],"(",["T_VARIABLE","$e",67],")",";",["T_WHITESPACE","\n            ",67],["T_STRING","parent",68],["T_DOUBLE_COLON","::",68],["T_STRING","_redirect",68],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",68],")",";",["T_WHITESPACE","\n        ",68],"}",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Action to which the customer will be returned when the payment is made.\n     *\/",72],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","successAction",75],"(",")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$event",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","Mage",77],["T_DOUBLE_COLON","::",77],["T_STRING","getModel",77],"(",["T_CONSTANT_ENCAPSED_STRING","'moneybookers\/event'",77],")",["T_WHITESPACE","\n                 ",77],["T_OBJECT_OPERATOR","->",78],["T_STRING","setEventData",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getRequest",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","getParams",78],"(",")",")",";",["T_WHITESPACE","\n        ",78],["T_TRY","try",79],["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$quoteId",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$event",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","successEvent",80],"(",")",";",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_getCheckout",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","setLastSuccessQuoteId",81],"(",["T_VARIABLE","$quoteId",81],")",";",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_redirect",82],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/onepage\/success'",82],")",";",["T_WHITESPACE","\n            ",82],["T_RETURN","return",83],";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE"," ",84],["T_CATCH","catch",84],["T_WHITESPACE"," ",84],"(",["T_STRING","Mage_Core_Exception",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$e",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_getCheckout",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","addError",85],"(",["T_VARIABLE","$e",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getMessage",85],"(",")",")",";",["T_WHITESPACE","\n        ",85],"}",["T_WHITESPACE"," ",86],["T_CATCH","catch",86],"(",["T_STRING","Exception",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$e",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","logException",87],"(",["T_VARIABLE","$e",87],")",";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_redirect",89],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",89],")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Action to which the customer will be returned if the payment process is\n     * cancelled.\n     * Cancel order and redirect user to the shopping cart.\n     *\/",92],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","cancelAction",97],"(",")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$event",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","getModel",99],"(",["T_CONSTANT_ENCAPSED_STRING","'moneybookers\/event'",99],")",["T_WHITESPACE","\n                 ",99],["T_OBJECT_OPERATOR","->",100],["T_STRING","setEventData",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getRequest",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getParams",100],"(",")",")",";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$message",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$event",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","cancelEvent",101],"(",")",";",["T_WHITESPACE","\n\n        ",101],["T_COMMENT","\/\/ set quote to active\n",103],["T_WHITESPACE","        ",104],["T_VARIABLE","$session",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_getCheckout",104],"(",")",";",["T_WHITESPACE","\n        ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(",["T_VARIABLE","$quoteId",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$session",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getMoneybookersQuoteId",105],"(",")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$quote",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","Mage",106],["T_DOUBLE_COLON","::",106],["T_STRING","getModel",106],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",106],")",["T_OBJECT_OPERATOR","->",106],["T_STRING","load",106],"(",["T_VARIABLE","$quoteId",106],")",";",["T_WHITESPACE","\n            ",106],["T_IF","if",107],["T_WHITESPACE"," ",107],"(",["T_VARIABLE","$quote",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getId",107],"(",")",")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n                ",107],["T_VARIABLE","$quote",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","setIsActive",108],"(",["T_STRING","true",108],")",["T_OBJECT_OPERATOR","->",108],["T_STRING","save",108],"(",")",";",["T_WHITESPACE","\n                ",108],["T_VARIABLE","$session",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","setQuoteId",109],"(",["T_VARIABLE","$quoteId",109],")",";",["T_WHITESPACE","\n            ",109],"}",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_VARIABLE","$session",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","addError",113],"(",["T_VARIABLE","$message",113],")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_redirect",114],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",114],")",";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Action to which the transaction details will be posted after the payment\n     * process is complete.\n     *\/",117],["T_WHITESPACE","\n    ",120],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","statusAction",121],"(",")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$event",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","Mage",123],["T_DOUBLE_COLON","::",123],["T_STRING","getModel",123],"(",["T_CONSTANT_ENCAPSED_STRING","'moneybookers\/event'",123],")",["T_WHITESPACE","\n            ",123],["T_OBJECT_OPERATOR","->",124],["T_STRING","setEventData",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getRequest",124],"(",")",["T_OBJECT_OPERATOR","->",124],["T_STRING","getParams",124],"(",")",")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$message",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$event",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","processStatusEvent",125],"(",")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getResponse",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","setBody",126],"(",["T_VARIABLE","$message",126],")",";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Set redirect into responce. This has to be encapsulated in an JavaScript\n     * call to jump out of the iframe.\n     *\n     * @param string $path\n     * @param array $arguments\n     *\/",129],["T_WHITESPACE","\n    ",135],["T_PROTECTED","protected",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","_redirect",136],"(",["T_VARIABLE","$path",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$arguments",136],"=",["T_ARRAY","array",136],"(",")",")",["T_WHITESPACE","\n    ",136],"{",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getResponse",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","setBody",138],"(",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getLayout",139],"(",")",["T_WHITESPACE","\n                ",139],["T_OBJECT_OPERATOR","->",140],["T_STRING","createBlock",140],"(",["T_CONSTANT_ENCAPSED_STRING","'moneybookers\/redirect'",140],")",["T_WHITESPACE","\n                ",140],["T_OBJECT_OPERATOR","->",141],["T_STRING","setRedirectUrl",141],"(",["T_STRING","Mage",141],["T_DOUBLE_COLON","::",141],["T_STRING","getUrl",141],"(",["T_VARIABLE","$path",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$arguments",141],")",")",["T_WHITESPACE","\n                ",141],["T_OBJECT_OPERATOR","->",142],["T_STRING","toHtml",142],"(",")",["T_WHITESPACE","\n        ",142],")",";",["T_WHITESPACE","\n        ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n",145],"}",["T_WHITESPACE","\n",146]]