[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magentocommerce.com so we can send you a copy immediately.\n *\n * @category    Phoenix\n * @package     Phoenix_Moneybookers\n * @copyright   Copyright (c) 2016 Phoenix Medien GmbH & Co. KG (http:\/\/www.phoenix-medien.de)\n * @license     http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n",19],["T_CLASS","class",20],["T_WHITESPACE"," ",20],["T_STRING","Phoenix_Moneybookers_Helper_Data",20],["T_WHITESPACE"," ",20],["T_EXTENDS","extends",20],["T_WHITESPACE"," ",20],["T_STRING","Mage_Payment_Helper_Data",20],["T_WHITESPACE","\n",20],"{",["T_WHITESPACE","\n    ",21],["T_CONST","const",22],["T_WHITESPACE"," ",22],["T_STRING","XML_PATH_EMAIL",22],["T_WHITESPACE","        ",22],"=",["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","'moneybookers\/settings\/moneybookers_email'",22],";",["T_WHITESPACE","\n    ",22],["T_CONST","const",23],["T_WHITESPACE"," ",23],["T_STRING","XML_PATH_CUSTOMER_ID",23],["T_WHITESPACE","  ",23],"=",["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'moneybookers\/settings\/customer_id'",23],";",["T_WHITESPACE","\n    ",23],["T_CONST","const",24],["T_WHITESPACE"," ",24],["T_STRING","XML_PATH_SECRET_KEY",24],["T_WHITESPACE","   ",24],"=",["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'moneybookers\/settings\/secret_key'",24],";",["T_WHITESPACE","\n\n    ",24],["T_DOC_COMMENT","\/**\n     * Internal parameters for validation\n     *\/",26],["T_WHITESPACE","\n    ",28],["T_PROTECTED","protected",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$_moneybookersServer",29],["T_WHITESPACE","           ",29],"=",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/www.moneybookers.com'",29],";",["T_WHITESPACE","\n    ",29],["T_PROTECTED","protected",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$_checkEmailUrl",30],["T_WHITESPACE","                ",30],"=",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","'\/app\/email_check.pl'",30],";",["T_WHITESPACE","\n    ",30],["T_PROTECTED","protected",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$_checkEmailCustId",31],["T_WHITESPACE","             ",31],"=",["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'6999315'",31],";",["T_WHITESPACE","\n    ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$_checkEmailPassword",32],["T_WHITESPACE","           ",32],"=",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'a4ce5a98a8950c04a3d34a2e2cb8c89f'",32],";",["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$_checkSecretUrl",33],["T_WHITESPACE","               ",33],"=",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'\/app\/secret_word_check.pl'",33],";",["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$_activationEmailTo",34],["T_WHITESPACE","            ",34],"=",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'ecommerce@moneybookers.com'",34],";",["T_WHITESPACE","\n    ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$_activationEmailSubject",35],["T_WHITESPACE","       ",35],"=",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'Magento Moneybookers Activation'",35],";",["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_moneybookersMasterCustId",36],["T_WHITESPACE","     ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'7283403'",36],";",["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_moneybookersMasterSecretHash",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'c18524b6b1082653039078a4700367f0'",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Send activation Email to Moneybookers\n     *\/",39],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","activateEmail",42],"(",")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$storeId",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_STRING","Mage",44],["T_DOUBLE_COLON","::",44],["T_STRING","app",44],"(",")",["T_OBJECT_OPERATOR","->",44],["T_STRING","getStore",44],"(",")",["T_OBJECT_OPERATOR","->",44],["T_STRING","getId",44],"(",")",";",["T_WHITESPACE","\n\n        ",44],["T_VARIABLE","$translate",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","Mage",46],["T_DOUBLE_COLON","::",46],["T_STRING","getSingleton",46],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/translate'",46],")",";",["T_WHITESPACE","\n        ",46],["T_COMMENT","\/* @var $translate Mage_Core_Model_Translate *\/",47],["T_WHITESPACE","\n        ",47],["T_VARIABLE","$translate",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","setTranslateInline",48],"(",["T_STRING","false",48],")",";",["T_WHITESPACE","\n\n        ",48],["T_STRING","Mage",50],["T_DOUBLE_COLON","::",50],["T_STRING","getModel",50],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template'",50],")",["T_WHITESPACE","\n            ",50],["T_OBJECT_OPERATOR","->",51],["T_STRING","setDesignConfig",51],"(",["T_ARRAY","array",51],"(",["T_CONSTANT_ENCAPSED_STRING","'area'",51],["T_WHITESPACE"," ",51],["T_DOUBLE_ARROW","=>",51],["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'frontend'",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'store'",51],["T_WHITESPACE"," ",51],["T_DOUBLE_ARROW","=>",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$storeId",51],")",")",["T_WHITESPACE","\n            ",51],["T_OBJECT_OPERATOR","->",52],["T_STRING","sendTransactional",52],"(",["T_WHITESPACE","\n                ",52],["T_CONSTANT_ENCAPSED_STRING","'moneybookers_activateemail'",53],",",["T_WHITESPACE","\n                ",53],["T_STRING","Mage",54],["T_DOUBLE_COLON","::",54],["T_STRING","getStoreConfig",54],"(",["T_STRING","Mage_Sales_Model_Order",54],["T_DOUBLE_COLON","::",54],["T_STRING","XML_PATH_EMAIL_IDENTITY",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$storeId",54],")",",",["T_WHITESPACE","\n                ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_activationEmailTo",55],",",["T_WHITESPACE","\n                ",55],["T_STRING","null",56],",",["T_WHITESPACE","\n                ",56],["T_ARRAY","array",57],"(",["T_WHITESPACE","\n                    ",57],["T_CONSTANT_ENCAPSED_STRING","'subject'",58],["T_WHITESPACE","     ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","_activationEmailSubject",58],",",["T_WHITESPACE","\n                    ",58],["T_CONSTANT_ENCAPSED_STRING","'email_addr'",59],["T_WHITESPACE","  ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_STRING","Mage",59],["T_DOUBLE_COLON","::",59],["T_STRING","getStoreConfig",59],"(",["T_STRING","self",59],["T_DOUBLE_COLON","::",59],["T_STRING","XML_PATH_EMAIL",59],")",",",["T_WHITESPACE","\n                    ",59],["T_CONSTANT_ENCAPSED_STRING","'url'",60],["T_WHITESPACE","         ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_STRING","Mage",60],["T_DOUBLE_COLON","::",60],["T_STRING","getBaseUrl",60],"(",")",",",["T_WHITESPACE","\n                    ",60],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",61],["T_WHITESPACE"," ",61],["T_DOUBLE_ARROW","=>",61],["T_WHITESPACE"," ",61],["T_STRING","Mage",61],["T_DOUBLE_COLON","::",61],["T_STRING","getStoreConfig",61],"(",["T_STRING","self",61],["T_DOUBLE_COLON","::",61],["T_STRING","XML_PATH_CUSTOMER_ID",61],")",",",["T_WHITESPACE","\n                    ",61],["T_CONSTANT_ENCAPSED_STRING","'language'",62],["T_WHITESPACE","    ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_STRING","Mage",62],["T_DOUBLE_COLON","::",62],["T_STRING","getModel",62],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/locale'",62],")",["T_OBJECT_OPERATOR","->",62],["T_STRING","getDefaultLocale",62],"(",")",["T_WHITESPACE","\n                ",62],")",["T_WHITESPACE","\n            ",63],")",";",["T_WHITESPACE","\n\n        ",64],["T_VARIABLE","$translate",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","setTranslateInline",66],"(",["T_STRING","true",66],")",";",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Check if email is registered at Moneybookers\n     *\n     * @param array $params\n     * @return array\n     *\/",69],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","checkEmailRequest",75],"(",["T_ARRAY","Array",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$params",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$response",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","null",76],";",["T_WHITESPACE","\n        ",76],["T_TRY","try",77],["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$response",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getHttpsPage",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_moneybookersServer",78],["T_WHITESPACE"," ",78],".",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_checkEmailUrl",78],",",["T_WHITESPACE"," ",78],["T_ARRAY","array",78],"(",["T_WHITESPACE","\n                ",78],["T_CONSTANT_ENCAPSED_STRING","'email'",79],["T_WHITESPACE","    ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$params",79],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",79],"]",",",["T_WHITESPACE","\n                ",79],["T_CONSTANT_ENCAPSED_STRING","'cust_id'",80],["T_WHITESPACE","  ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_checkEmailCustId",80],",",["T_WHITESPACE","\n                ",80],["T_CONSTANT_ENCAPSED_STRING","'password'",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_checkEmailPassword",81],")",["T_WHITESPACE","\n            ",81],")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE"," ",83],["T_CATCH","catch",83],["T_WHITESPACE"," ",83],"(",["T_STRING","Exception",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$e",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","log",84],"(",["T_VARIABLE","$e",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getMessage",84],"(",")",")",";",["T_WHITESPACE","\n            ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_STRING","null",85],";",["T_WHITESPACE","\n        ",85],"}",["T_WHITESPACE","\n        ",86],["T_RETURN","return",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$response",87],";",["T_WHITESPACE","\n    ",87],"}",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Check if entered secret is valid\n     * @param array $params\n     * @return array\n     *\/",90],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","checkSecretRequest",95],"(",["T_ARRAY","Array",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$params",95],")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$response",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","null",97],";",["T_WHITESPACE","\n        ",97],["T_TRY","try",98],["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$response",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_getHttpsPage",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_moneybookersServer",99],["T_WHITESPACE"," ",99],".",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_checkSecretUrl",99],",",["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",["T_WHITESPACE","\n                ",99],["T_CONSTANT_ENCAPSED_STRING","'email'",100],["T_WHITESPACE","   ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$params",100],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",100],"]",",",["T_WHITESPACE","\n                ",100],["T_CONSTANT_ENCAPSED_STRING","'secret'",101],["T_WHITESPACE","  ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_STRING","md5",101],"(",["T_STRING","md5",101],"(",["T_VARIABLE","$params",101],"[",["T_CONSTANT_ENCAPSED_STRING","'secret'",101],"]",")",["T_WHITESPACE"," ",101],".",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_moneybookersMasterSecretHash",101],")",",",["T_WHITESPACE","\n                ",101],["T_CONSTANT_ENCAPSED_STRING","'cust_id'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_moneybookersMasterCustId",102],")",["T_WHITESPACE","\n            ",102],")",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE"," ",104],["T_CATCH","catch",104],["T_WHITESPACE"," ",104],"(",["T_STRING","Exception",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$e",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","log",105],"(",["T_VARIABLE","$e",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getMessage",105],"(",")",")",";",["T_WHITESPACE","\n            ",105],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_STRING","null",106],";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$response",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Reading a page via HTTPS and returning its content.\n     *\/",111],["T_WHITESPACE","\n    ",113],["T_PROTECTED","protected",114],["T_WHITESPACE"," ",114],["T_FUNCTION","function",114],["T_WHITESPACE"," ",114],["T_STRING","_getHttpsPage",114],"(",["T_VARIABLE","$host",114],",",["T_WHITESPACE"," ",114],["T_VARIABLE","$parameter",114],")",["T_WHITESPACE","\n    ",114],"{",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$client",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_NEW","new",116],["T_WHITESPACE"," ",116],["T_STRING","Varien_Http_Client",116],"(",")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$client",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","setUri",117],"(",["T_VARIABLE","$host",117],")",["T_WHITESPACE","\n            ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","setConfig",118],"(",["T_ARRAY","array",118],"(",["T_CONSTANT_ENCAPSED_STRING","'timeout'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_LNUMBER","30",118],")",")",["T_WHITESPACE","\n            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","setHeaders",119],"(",["T_CONSTANT_ENCAPSED_STRING","'accept-encoding'",119],",",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","''",119],")",["T_WHITESPACE","\n            ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","setParameterGet",120],"(",["T_VARIABLE","$parameter",120],")",["T_WHITESPACE","\n            ",120],["T_OBJECT_OPERATOR","->",121],["T_STRING","setMethod",121],"(",["T_STRING","Zend_Http_Client",121],["T_DOUBLE_COLON","::",121],["T_STRING","GET",121],")",";",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$request",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$client",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","request",122],"(",")",";",["T_WHITESPACE","\n        ",122],["T_COMMENT","\/\/ Workaround for pseudo chunked messages which are yet too short, so\n",123],["T_WHITESPACE","        ",124],["T_COMMENT","\/\/ only an exception is is thrown instead of returning raw body\n",124],["T_WHITESPACE","        ",125],["T_IF","if",125],["T_WHITESPACE"," ",125],"(","!",["T_STRING","preg_match",125],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/^([\\da-fA-F]+)[^\\r\\n]*\\r\\n\/sm\"",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$request",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getRawBody",125],"(",")",",",["T_WHITESPACE"," ",125],["T_VARIABLE","$m",125],")",")",["T_WHITESPACE","\n            ",125],["T_RETURN","return",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$request",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getRawBody",126],"(",")",";",["T_WHITESPACE","\n\n        ",126],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$request",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getBody",128],"(",")",";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n",129],"}",["T_WHITESPACE","\n",130]]