[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog category helper\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Catalog_Helper_Product_View",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Core_Helper_Abstract",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_COMMENT","\/\/ List of exceptions throwable during prepareAndRender() method\n",34],["T_WHITESPACE","    ",35],["T_PUBLIC","public",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$ERR_NO_PRODUCT_LOADED",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_LNUMBER","1",35],";",["T_WHITESPACE","\n    ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$ERR_BAD_CONTROLLER_INTERFACE",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_LNUMBER","2",36],";",["T_WHITESPACE","\n\n     ",36],["T_DOC_COMMENT","\/**\n     * Inits layout for viewing product page\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param Mage_Core_Controller_Front_Action $controller\n     *\n     * @return Mage_Catalog_Helper_Product_View\n     *\/",38],["T_WHITESPACE","\n    ",45],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","initProductLayout",46],"(",["T_VARIABLE","$product",46],",",["T_WHITESPACE"," ",46],["T_VARIABLE","$controller",46],")",["T_WHITESPACE","\n    ",46],"{",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$design",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","Mage",48],["T_DOUBLE_COLON","::",48],["T_STRING","getSingleton",48],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/design'",48],")",";",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$settings",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$design",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getDesignSettings",49],"(",["T_VARIABLE","$product",49],")",";",["T_WHITESPACE","\n\n        ",49],["T_IF","if",51],["T_WHITESPACE"," ",51],"(",["T_VARIABLE","$settings",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getCustomDesign",51],"(",")",")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$design",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","applyCustomDesign",52],"(",["T_VARIABLE","$settings",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getCustomDesign",52],"(",")",")",";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE","\n\n        ",53],["T_VARIABLE","$update",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$controller",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getLayout",55],"(",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","getUpdate",55],"(",")",";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$update",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","addHandle",56],"(",["T_CONSTANT_ENCAPSED_STRING","'default'",56],")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$controller",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","addActionLayoutHandles",57],"(",")",";",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$update",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","addHandle",59],"(",["T_CONSTANT_ENCAPSED_STRING","'PRODUCT_TYPE_'",59],["T_WHITESPACE"," ",59],".",["T_WHITESPACE"," ",59],["T_VARIABLE","$product",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getTypeId",59],"(",")",")",";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$update",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","addHandle",60],"(",["T_CONSTANT_ENCAPSED_STRING","'PRODUCT_'",60],["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_VARIABLE","$product",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getId",60],"(",")",")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$controller",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","loadLayoutUpdates",61],"(",")",";",["T_WHITESPACE","\n\n        ",61],["T_COMMENT","\/\/ Apply custom layout update once layout is loaded\n",63],["T_WHITESPACE","        ",64],["T_VARIABLE","$layoutUpdates",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$settings",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getLayoutUpdates",64],"(",")",";",["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_VARIABLE","$layoutUpdates",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_IF","if",66],["T_WHITESPACE"," ",66],"(",["T_STRING","is_array",66],"(",["T_VARIABLE","$layoutUpdates",66],")",")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n                ",66],["T_FOREACH","foreach",67],"(",["T_VARIABLE","$layoutUpdates",67],["T_WHITESPACE"," ",67],["T_AS","as",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$layoutUpdate",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n                    ",67],["T_VARIABLE","$update",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","addUpdate",68],"(",["T_VARIABLE","$layoutUpdate",68],")",";",["T_WHITESPACE","\n                ",68],"}",["T_WHITESPACE","\n            ",69],"}",["T_WHITESPACE","\n        ",70],"}",["T_WHITESPACE","\n\n        ",71],["T_VARIABLE","$controller",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","generateLayoutXml",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","generateLayoutBlocks",73],"(",")",";",["T_WHITESPACE","\n\n        ",73],["T_COMMENT","\/\/ Apply custom layout (page) template once the blocks are generated\n",75],["T_WHITESPACE","        ",76],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_VARIABLE","$settings",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getPageLayout",76],"(",")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$controller",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getLayout",77],"(",")",["T_OBJECT_OPERATOR","->",77],["T_STRING","helper",77],"(",["T_CONSTANT_ENCAPSED_STRING","'page\/layout'",77],")",["T_OBJECT_OPERATOR","->",77],["T_STRING","applyTemplate",77],"(",["T_VARIABLE","$settings",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getPageLayout",77],"(",")",")",";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$currentCategory",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","Mage",80],["T_DOUBLE_COLON","::",80],["T_STRING","registry",80],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",80],")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$root",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$controller",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getLayout",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","getBlock",81],"(",["T_CONSTANT_ENCAPSED_STRING","'root'",81],")",";",["T_WHITESPACE","\n        ",81],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_VARIABLE","$root",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$controllerClass",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$controller",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getFullActionName",83],"(",")",";",["T_WHITESPACE","\n            ",83],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_VARIABLE","$controllerClass",84],["T_WHITESPACE"," ",84],["T_IS_NOT_EQUAL","!=",84],["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'catalog-product-view'",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n                ",84],["T_VARIABLE","$root",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","addBodyClass",85],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog-product-view'",85],")",";",["T_WHITESPACE","\n            ",85],"}",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$root",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","addBodyClass",87],"(",["T_CONSTANT_ENCAPSED_STRING","'product-'",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_VARIABLE","$product",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getUrlKey",87],"(",")",")",";",["T_WHITESPACE","\n            ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$currentCategory",88],["T_WHITESPACE"," ",88],["T_INSTANCEOF","instanceof",88],["T_WHITESPACE"," ",88],["T_STRING","Mage_Catalog_Model_Category",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$root",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","addBodyClass",89],"(",["T_CONSTANT_ENCAPSED_STRING","'categorypath-'",89],["T_WHITESPACE"," ",89],".",["T_WHITESPACE"," ",89],["T_VARIABLE","$currentCategory",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getUrlPath",89],"(",")",")",["T_WHITESPACE","\n                    ",89],["T_OBJECT_OPERATOR","->",90],["T_STRING","addBodyClass",90],"(",["T_CONSTANT_ENCAPSED_STRING","'category-'",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_VARIABLE","$currentCategory",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getUrlKey",90],"(",")",")",";",["T_WHITESPACE","\n            ",90],"}",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Prepares product view page - inits layout and all needed stuff\n     *\n     * $params can have all values as $params in Mage_Catalog_Helper_Product - initProduct().\n     * Plus following keys:\n     *   - 'buy_request' - Varien_Object holding buyRequest to configure product\n     *   - 'specify_options' - boolean, whether to show 'Specify options' message\n     *   - 'configure_mode' - boolean, whether we're in Configure-mode to edit product configuration\n     *\n     * @param int $productId\n     * @param Mage_Core_Controller_Front_Action $controller\n     * @param null|Varien_Object $params\n     *\n     * @return Mage_Catalog_Helper_Product_View\n     *\/",97],["T_WHITESPACE","\n    ",111],["T_PUBLIC","public",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","prepareAndRender",112],"(",["T_VARIABLE","$productId",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$controller",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$params",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","null",112],")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_COMMENT","\/\/ Prepare data\n",114],["T_WHITESPACE","        ",115],["T_VARIABLE","$productHelper",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","Mage",115],["T_DOUBLE_COLON","::",115],["T_STRING","helper",115],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",115],")",";",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(","!",["T_VARIABLE","$params",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$params",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_NEW","new",117],["T_WHITESPACE"," ",117],["T_STRING","Varien_Object",117],"(",")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n\n        ",118],["T_COMMENT","\/\/ Standard algorithm to prepare and rendern product view page\n",120],["T_WHITESPACE","        ",121],["T_VARIABLE","$product",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$productHelper",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","initProduct",121],"(",["T_VARIABLE","$productId",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$controller",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$params",121],")",";",["T_WHITESPACE","\n        ",121],["T_IF","if",122],["T_WHITESPACE"," ",122],"(","!",["T_VARIABLE","$product",122],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_THROW","throw",123],["T_WHITESPACE"," ",123],["T_NEW","new",123],["T_WHITESPACE"," ",123],["T_STRING","Mage_Core_Exception",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","__",123],"(",["T_CONSTANT_ENCAPSED_STRING","'Product is not loaded'",123],")",",",["T_WHITESPACE"," ",123],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","ERR_NO_PRODUCT_LOADED",123],")",";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n\n        ",124],["T_VARIABLE","$buyRequest",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$params",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getBuyRequest",126],"(",")",";",["T_WHITESPACE","\n        ",126],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$buyRequest",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$productHelper",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","prepareProductOptions",128],"(",["T_VARIABLE","$product",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$buyRequest",128],")",";",["T_WHITESPACE","\n        ",128],"}",["T_WHITESPACE","\n\n        ",129],["T_IF","if",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$params",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","hasConfigureMode",131],"(",")",")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$product",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","setConfigureMode",132],"(",["T_VARIABLE","$params",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getConfigureMode",132],"(",")",")",";",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE","\n\n        ",133],["T_STRING","Mage",135],["T_DOUBLE_COLON","::",135],["T_STRING","dispatchEvent",135],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_controller_product_view'",135],",",["T_WHITESPACE"," ",135],["T_ARRAY","array",135],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$product",135],")",")",";",["T_WHITESPACE","\n\n        ",135],["T_IF","if",137],["T_WHITESPACE"," ",137],"(",["T_VARIABLE","$params",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getSpecifyOptions",137],"(",")",")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n            ",137],["T_VARIABLE","$notice",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$product",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getTypeInstance",138],"(",["T_STRING","true",138],")",["T_OBJECT_OPERATOR","->",138],["T_STRING","getSpecifyOptionMessage",138],"(",")",";",["T_WHITESPACE","\n            ",138],["T_STRING","Mage",139],["T_DOUBLE_COLON","::",139],["T_STRING","getSingleton",139],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",139],")",["T_OBJECT_OPERATOR","->",139],["T_STRING","addNotice",139],"(",["T_VARIABLE","$notice",139],")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n\n        ",140],["T_STRING","Mage",142],["T_DOUBLE_COLON","::",142],["T_STRING","getSingleton",142],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",142],")",["T_OBJECT_OPERATOR","->",142],["T_STRING","setLastViewedProductId",142],"(",["T_VARIABLE","$product",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getId",142],"(",")",")",";",["T_WHITESPACE","\n\n        ",142],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","initProductLayout",144],"(",["T_VARIABLE","$product",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$controller",144],")",";",["T_WHITESPACE","\n\n        ",144],["T_VARIABLE","$controller",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","initLayoutMessages",146],"(",["T_ARRAY","array",146],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",146],",",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'tag\/session'",146],",",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",146],")",")",["T_WHITESPACE","\n            ",146],["T_OBJECT_OPERATOR","->",147],["T_STRING","renderLayout",147],"(",")",";",["T_WHITESPACE","\n\n        ",147],["T_RETURN","return",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],";",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n",150],"}",["T_WHITESPACE","\n",151]]