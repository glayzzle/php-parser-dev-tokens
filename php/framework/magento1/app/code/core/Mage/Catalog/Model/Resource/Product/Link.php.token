[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog product link resource model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Link",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Product Link Attributes Table\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_attributesTable",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Define main table name and attributes table\n     *\/",44],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","_construct",47],"(",")",["T_WHITESPACE","\n    ",47],"{",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_init",49],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_link'",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'link_id'",49],")",";",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_attributesTable",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getTable",50],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_link_attribute'",50],")",";",["T_WHITESPACE","\n    ",50],"}",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Save Product Links process\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param array $data\n     * @param int $typeId\n     * @return Mage_Catalog_Model_Resource_Product_Link\n     *\/",53],["T_WHITESPACE","\n    ",60],["T_PUBLIC","public",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","saveProductLinks",61],"(",["T_VARIABLE","$product",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$data",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$typeId",61],")",["T_WHITESPACE","\n    ",61],"{",["T_WHITESPACE","\n        ",62],["T_IF","if",63],["T_WHITESPACE"," ",63],"(","!",["T_STRING","is_array",63],"(",["T_VARIABLE","$data",63],")",")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$data",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_ARRAY","array",64],"(",")",";",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE","\n\n        ",65],["T_VARIABLE","$attributes",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getAttributesByType",67],"(",["T_VARIABLE","$typeId",67],")",";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$adapter",68],["T_WHITESPACE","    ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_getWriteAdapter",68],"(",")",";",["T_WHITESPACE","\n\n        ",68],["T_VARIABLE","$bind",70],["T_WHITESPACE","   ",70],"=",["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",["T_WHITESPACE","\n            ",70],["T_CONSTANT_ENCAPSED_STRING","':product_id'",71],["T_WHITESPACE","    ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_INT_CAST","(int)",71],["T_VARIABLE","$product",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getId",71],"(",")",",",["T_WHITESPACE","\n            ",71],["T_CONSTANT_ENCAPSED_STRING","':link_type_id'",72],["T_WHITESPACE","  ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_INT_CAST","(int)",72],["T_VARIABLE","$typeId",72],["T_WHITESPACE","\n        ",72],")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$select",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$adapter",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","select",74],"(",")",["T_WHITESPACE","\n            ",74],["T_OBJECT_OPERATOR","->",75],["T_STRING","from",75],"(",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getMainTable",75],"(",")",",",["T_WHITESPACE"," ",75],["T_ARRAY","array",75],"(",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",75],",",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'link_id'",75],")",")",["T_WHITESPACE","\n            ",75],["T_OBJECT_OPERATOR","->",76],["T_STRING","where",76],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = :product_id'",76],")",["T_WHITESPACE","\n            ",76],["T_OBJECT_OPERATOR","->",77],["T_STRING","where",77],"(",["T_CONSTANT_ENCAPSED_STRING","'link_type_id = :link_type_id'",77],")",";",["T_WHITESPACE","\n\n        ",77],["T_VARIABLE","$links",79],["T_WHITESPACE","   ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$adapter",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","fetchPairs",79],"(",["T_VARIABLE","$select",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$bind",79],")",";",["T_WHITESPACE","\n\n        ",79],["T_VARIABLE","$deleteIds",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_ARRAY","array",81],"(",")",";",["T_WHITESPACE","\n        ",81],["T_FOREACH","foreach",82],"(",["T_VARIABLE","$links",82],["T_WHITESPACE"," ",82],["T_AS","as",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$linkedProductId",82],["T_WHITESPACE"," ",82],["T_DOUBLE_ARROW","=>",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$linkId",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(","!",["T_ISSET","isset",83],"(",["T_VARIABLE","$data",83],"[",["T_VARIABLE","$linkedProductId",83],"]",")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                ",83],["T_VARIABLE","$deleteIds",84],"[","]",["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_INT_CAST","(int)",84],["T_VARIABLE","$linkId",84],";",["T_WHITESPACE","\n            ",84],"}",["T_WHITESPACE","\n        ",85],"}",["T_WHITESPACE","\n        ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(","!",["T_EMPTY","empty",87],"(",["T_VARIABLE","$deleteIds",87],")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$adapter",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","delete",88],"(",["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getMainTable",88],"(",")",",",["T_WHITESPACE"," ",88],["T_ARRAY","array",88],"(",["T_WHITESPACE","\n                ",88],["T_CONSTANT_ENCAPSED_STRING","'link_id IN (?)'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$deleteIds",89],",",["T_WHITESPACE","\n            ",89],")",")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n\n        ",91],["T_FOREACH","foreach",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$data",93],["T_WHITESPACE"," ",93],["T_AS","as",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$linkedProductId",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$linkInfo",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$linkId",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","null",94],";",["T_WHITESPACE","\n            ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(",["T_ISSET","isset",95],"(",["T_VARIABLE","$links",95],"[",["T_VARIABLE","$linkedProductId",95],"]",")",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n                ",95],["T_VARIABLE","$linkId",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$links",96],"[",["T_VARIABLE","$linkedProductId",96],"]",";",["T_WHITESPACE","\n                ",96],["T_UNSET","unset",97],"(",["T_VARIABLE","$links",97],"[",["T_VARIABLE","$linkedProductId",97],"]",")",";",["T_WHITESPACE","\n            ",97],"}",["T_WHITESPACE"," ",98],["T_ELSE","else",98],["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                ",98],["T_VARIABLE","$bind",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",["T_WHITESPACE","\n                    ",99],["T_CONSTANT_ENCAPSED_STRING","'product_id'",100],["T_WHITESPACE","        ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$product",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getId",100],"(",")",",",["T_WHITESPACE","\n                    ",100],["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$linkedProductId",101],",",["T_WHITESPACE","\n                    ",101],["T_CONSTANT_ENCAPSED_STRING","'link_type_id'",102],["T_WHITESPACE","      ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$typeId",102],["T_WHITESPACE","\n                ",102],")",";",["T_WHITESPACE","\n                ",103],["T_VARIABLE","$adapter",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","insert",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getMainTable",104],"(",")",",",["T_WHITESPACE"," ",104],["T_VARIABLE","$bind",104],")",";",["T_WHITESPACE","\n                ",104],["T_VARIABLE","$linkId",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$adapter",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","lastInsertId",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getMainTable",105],"(",")",")",";",["T_WHITESPACE","\n            ",105],"}",["T_WHITESPACE","\n\n            ",106],["T_FOREACH","foreach",108],["T_WHITESPACE"," ",108],"(",["T_VARIABLE","$attributes",108],["T_WHITESPACE"," ",108],["T_AS","as",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$attributeInfo",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n                ",108],["T_VARIABLE","$attributeTable",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getAttributeTypeTable",109],"(",["T_VARIABLE","$attributeInfo",109],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",109],"]",")",";",["T_WHITESPACE","\n                ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$attributeTable",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                    ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_ISSET","isset",111],"(",["T_VARIABLE","$linkInfo",111],"[",["T_VARIABLE","$attributeInfo",111],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",111],"]","]",")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n                        ",111],["T_VARIABLE","$value",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_prepareAttributeValue",112],"(",["T_VARIABLE","$attributeInfo",112],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",112],"]",",",["T_WHITESPACE","\n                            ",112],["T_VARIABLE","$linkInfo",113],"[",["T_VARIABLE","$attributeInfo",113],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",113],"]","]",")",";",["T_WHITESPACE","\n                        ",113],["T_VARIABLE","$bind",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_ARRAY","array",114],"(",["T_WHITESPACE","\n                            ",114],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_id'",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$attributeInfo",115],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",115],"]",",",["T_WHITESPACE","\n                            ",115],["T_CONSTANT_ENCAPSED_STRING","'link_id'",116],["T_WHITESPACE","                   ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$linkId",116],",",["T_WHITESPACE","\n                            ",116],["T_CONSTANT_ENCAPSED_STRING","'value'",117],["T_WHITESPACE","                     ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$value",117],["T_WHITESPACE","\n                        ",117],")",";",["T_WHITESPACE","\n                        ",118],["T_VARIABLE","$adapter",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","insertOnDuplicate",119],"(",["T_VARIABLE","$attributeTable",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$bind",119],",",["T_WHITESPACE"," ",119],["T_ARRAY","array",119],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",119],")",")",";",["T_WHITESPACE","\n                    ",119],"}",["T_WHITESPACE"," ",120],["T_ELSE","else",120],["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n                        ",120],["T_VARIABLE","$adapter",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","delete",121],"(",["T_VARIABLE","$attributeTable",121],",",["T_WHITESPACE"," ",121],["T_ARRAY","array",121],"(",["T_WHITESPACE","\n                            ",121],["T_CONSTANT_ENCAPSED_STRING","'link_id = ?'",122],["T_WHITESPACE","                   ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$linkId",122],",",["T_WHITESPACE","\n                            ",122],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_id = ?'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$attributeInfo",123],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",123],"]",["T_WHITESPACE","\n                        ",123],")",")",";",["T_WHITESPACE","\n                    ",124],"}",["T_WHITESPACE","\n                ",125],"}",["T_WHITESPACE","\n            ",126],"}",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE","\n\n        ",128],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Prepare link attribute value by attribute type\n     *\n     * @param string $type\n     * @param mixed $value\n     * @return mixed\n     *\/",133],["T_WHITESPACE","\n    ",139],["T_PROTECTED","protected",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","_prepareAttributeValue",140],"(",["T_VARIABLE","$type",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$value",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(",["T_VARIABLE","$type",142],["T_WHITESPACE"," ",142],["T_IS_EQUAL","==",142],["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'int'",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$value",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_INT_CAST","(int)",143],["T_VARIABLE","$value",143],";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE"," ",144],["T_ELSEIF","elseif",144],["T_WHITESPACE"," ",144],"(",["T_VARIABLE","$type",144],["T_WHITESPACE"," ",144],["T_IS_EQUAL","==",144],["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'decimal'",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$value",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_DOUBLE_CAST","(float)",145],["T_STRING","sprintf",145],"(",["T_CONSTANT_ENCAPSED_STRING","'%F'",145],",",["T_WHITESPACE"," ",145],["T_VARIABLE","$value",145],")",";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n        ",146],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$value",147],";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Retrieve product link attributes by link type\n     *\n     * @param int $typeId\n     * @return array\n     *\/",150],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","getAttributesByType",156],"(",["T_VARIABLE","$typeId",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$adapter",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getReadAdapter",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$select",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$adapter",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","select",159],"(",")",["T_WHITESPACE","\n            ",159],["T_OBJECT_OPERATOR","->",160],["T_STRING","from",160],"(",["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_attributesTable",160],",",["T_WHITESPACE"," ",160],["T_ARRAY","array",160],"(",["T_WHITESPACE","\n                ",160],["T_CONSTANT_ENCAPSED_STRING","'id'",161],["T_WHITESPACE","    ",161],["T_DOUBLE_ARROW","=>",161],["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_id'",161],",",["T_WHITESPACE","\n                ",161],["T_CONSTANT_ENCAPSED_STRING","'code'",162],["T_WHITESPACE","  ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","'product_link_attribute_code'",162],",",["T_WHITESPACE","\n                ",162],["T_CONSTANT_ENCAPSED_STRING","'type'",163],["T_WHITESPACE","  ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'data_type'",163],["T_WHITESPACE","\n            ",163],")",")",["T_WHITESPACE","\n            ",164],["T_OBJECT_OPERATOR","->",165],["T_STRING","where",165],"(",["T_CONSTANT_ENCAPSED_STRING","'link_type_id = ?'",165],",",["T_WHITESPACE"," ",165],["T_VARIABLE","$typeId",165],")",";",["T_WHITESPACE","\n        ",165],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$adapter",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","fetchAll",166],"(",["T_VARIABLE","$select",166],")",";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n\n    ",167],["T_DOC_COMMENT","\/**\n     * Returns table for link attribute by attribute type\n     *\n     * @param string $type\n     * @return string\n     *\/",169],["T_WHITESPACE","\n    ",174],["T_PUBLIC","public",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","getAttributeTypeTable",175],"(",["T_VARIABLE","$type",175],")",["T_WHITESPACE","\n    ",175],"{",["T_WHITESPACE","\n        ",176],["T_RETURN","return",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getTable",177],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_link_attribute_'",177],["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_VARIABLE","$type",177],")",";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n\n    ",178],["T_DOC_COMMENT","\/**\n     * Retrieve Required children ids\n     * Return grouped array, ex array(\n     *   group => array(ids)\n     * )\n     *\n     * @param int $parentId\n     * @param int $typeId\n     * @return array\n     *\/",180],["T_WHITESPACE","\n    ",189],["T_PUBLIC","public",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","getChildrenIds",190],"(",["T_VARIABLE","$parentId",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$typeId",190],")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$adapter",192],["T_WHITESPACE","     ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_getReadAdapter",192],"(",")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$childrenIds",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_ARRAY","array",193],"(",")",";",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$bind",194],["T_WHITESPACE","        ",194],"=",["T_WHITESPACE"," ",194],["T_ARRAY","array",194],"(",["T_WHITESPACE","\n            ",194],["T_CONSTANT_ENCAPSED_STRING","':product_id'",195],["T_WHITESPACE","    ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_INT_CAST","(int)",195],["T_VARIABLE","$parentId",195],",",["T_WHITESPACE","\n            ",195],["T_CONSTANT_ENCAPSED_STRING","':link_type_id'",196],["T_WHITESPACE","  ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_INT_CAST","(int)",196],["T_VARIABLE","$typeId",196],["T_WHITESPACE","\n        ",196],")",";",["T_WHITESPACE","\n        ",197],["T_VARIABLE","$select",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_VARIABLE","$adapter",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","select",198],"(",")",["T_WHITESPACE","\n            ",198],["T_OBJECT_OPERATOR","->",199],["T_STRING","from",199],"(",["T_ARRAY","array",199],"(",["T_CONSTANT_ENCAPSED_STRING","'l'",199],["T_WHITESPACE"," ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getMainTable",199],"(",")",")",",",["T_WHITESPACE"," ",199],["T_ARRAY","array",199],"(",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",199],")",")",["T_WHITESPACE","\n            ",199],["T_OBJECT_OPERATOR","->",200],["T_STRING","where",200],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = :product_id'",200],")",["T_WHITESPACE","\n            ",200],["T_OBJECT_OPERATOR","->",201],["T_STRING","where",201],"(",["T_CONSTANT_ENCAPSED_STRING","'link_type_id = :link_type_id'",201],")",";",["T_WHITESPACE","\n        ",201],["T_IF","if",202],["T_WHITESPACE"," ",202],"(",["T_VARIABLE","$typeId",202],["T_WHITESPACE"," ",202],["T_IS_EQUAL","==",202],["T_WHITESPACE"," ",202],["T_STRING","Mage_Catalog_Model_Product_Link",202],["T_DOUBLE_COLON","::",202],["T_STRING","LINK_TYPE_GROUPED",202],")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$select",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","join",203],"(",["T_WHITESPACE","\n                ",203],["T_ARRAY","array",204],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",204],["T_WHITESPACE"," ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getTable",204],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",204],")",")",",",["T_WHITESPACE","\n                ",204],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = l.linked_product_id AND e.required_options = 0'",205],",",["T_WHITESPACE","\n                ",205],["T_ARRAY","array",206],"(",")",["T_WHITESPACE","\n            ",206],")",";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n\n        ",208],["T_VARIABLE","$childrenIds",210],"[",["T_VARIABLE","$typeId",210],"]",["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],"(",")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$result",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$adapter",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","fetchAll",211],"(",["T_VARIABLE","$select",211],",",["T_WHITESPACE"," ",211],["T_VARIABLE","$bind",211],")",";",["T_WHITESPACE","\n        ",211],["T_FOREACH","foreach",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$result",212],["T_WHITESPACE"," ",212],["T_AS","as",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$row",212],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$childrenIds",213],"[",["T_VARIABLE","$typeId",213],"]","[",["T_VARIABLE","$row",213],"[",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",213],"]","]",["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$row",213],"[",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",213],"]",";",["T_WHITESPACE","\n        ",213],"}",["T_WHITESPACE","\n\n        ",214],["T_RETURN","return",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$childrenIds",216],";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n\n    ",217],["T_DOC_COMMENT","\/**\n     * Retrieve parent ids array by required child\n     *\n     * @param int|array $childId\n     * @param int $typeId\n     * @return array\n     *\/",219],["T_WHITESPACE","\n    ",225],["T_PUBLIC","public",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","getParentIdsByChild",226],"(",["T_VARIABLE","$childId",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$typeId",226],")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$parentIds",228],["T_WHITESPACE","  ",228],"=",["T_WHITESPACE"," ",228],["T_ARRAY","array",228],"(",")",";",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$adapter",229],["T_WHITESPACE","    ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","_getReadAdapter",229],"(",")",";",["T_WHITESPACE","\n        ",229],["T_VARIABLE","$select",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$adapter",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","select",230],"(",")",["T_WHITESPACE","\n            ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","from",231],"(",["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getMainTable",231],"(",")",",",["T_WHITESPACE"," ",231],["T_ARRAY","array",231],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",231],",",["T_WHITESPACE"," ",231],["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",231],")",")",["T_WHITESPACE","\n            ",231],["T_OBJECT_OPERATOR","->",232],["T_STRING","where",232],"(",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id IN(?)'",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$childId",232],")",["T_WHITESPACE","\n            ",232],["T_OBJECT_OPERATOR","->",233],["T_STRING","where",233],"(",["T_CONSTANT_ENCAPSED_STRING","'link_type_id = ?'",233],",",["T_WHITESPACE"," ",233],["T_VARIABLE","$typeId",233],")",";",["T_WHITESPACE","\n\n        ",233],["T_VARIABLE","$result",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$adapter",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","fetchAll",235],"(",["T_VARIABLE","$select",235],")",";",["T_WHITESPACE","\n        ",235],["T_FOREACH","foreach",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$result",236],["T_WHITESPACE"," ",236],["T_AS","as",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$row",236],")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$parentIds",237],"[","]",["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$row",237],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",237],"]",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n\n        ",238],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$parentIds",240],";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n\n    ",241],["T_DOC_COMMENT","\/**\n     * Save grouped product relations\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param array $data\n     * @param int $typeId\n     * @return Mage_Catalog_Model_Resource_Product_Link\n     *\/",243],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","saveGroupedLinks",251],"(",["T_VARIABLE","$product",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$data",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$typeId",251],")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$adapter",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_getWriteAdapter",253],"(",")",";",["T_WHITESPACE","\n        ",253],["T_COMMENT","\/\/ check for change relations\n",254],["T_WHITESPACE","        ",255],["T_VARIABLE","$bind",255],["T_WHITESPACE","    ",255],"=",["T_WHITESPACE"," ",255],["T_ARRAY","array",255],"(",["T_WHITESPACE","\n            ",255],["T_CONSTANT_ENCAPSED_STRING","'product_id'",256],["T_WHITESPACE","    ",256],["T_DOUBLE_ARROW","=>",256],["T_WHITESPACE"," ",256],["T_INT_CAST","(int)",256],["T_VARIABLE","$product",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getId",256],"(",")",",",["T_WHITESPACE","\n            ",256],["T_CONSTANT_ENCAPSED_STRING","'link_type_id'",257],["T_WHITESPACE","  ",257],["T_DOUBLE_ARROW","=>",257],["T_WHITESPACE"," ",257],["T_INT_CAST","(int)",257],["T_VARIABLE","$typeId",257],["T_WHITESPACE","\n        ",257],")",";",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$select",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$adapter",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","select",259],"(",")",["T_WHITESPACE","\n            ",259],["T_OBJECT_OPERATOR","->",260],["T_STRING","from",260],"(",["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getMainTable",260],"(",")",",",["T_WHITESPACE"," ",260],["T_ARRAY","array",260],"(",["T_CONSTANT_ENCAPSED_STRING","'linked_product_id'",260],")",")",["T_WHITESPACE","\n            ",260],["T_OBJECT_OPERATOR","->",261],["T_STRING","where",261],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = :product_id'",261],")",["T_WHITESPACE","\n            ",261],["T_OBJECT_OPERATOR","->",262],["T_STRING","where",262],"(",["T_CONSTANT_ENCAPSED_STRING","'link_type_id = :link_type_id'",262],")",";",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$old",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$adapter",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","fetchCol",263],"(",["T_VARIABLE","$select",263],",",["T_WHITESPACE"," ",263],["T_VARIABLE","$bind",263],")",";",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$new",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_STRING","array_keys",264],"(",["T_VARIABLE","$data",264],")",";",["T_WHITESPACE","\n\n        ",264],["T_IF","if",266],["T_WHITESPACE"," ",266],"(",["T_STRING","array_diff",266],"(",["T_VARIABLE","$old",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$new",266],")",["T_WHITESPACE"," ",266],["T_BOOLEAN_OR","||",266],["T_WHITESPACE"," ",266],["T_STRING","array_diff",266],"(",["T_VARIABLE","$new",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$old",266],")",")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_VARIABLE","$product",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","setIsRelationsChanged",267],"(",["T_STRING","true",267],")",";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE","\n\n        ",268],["T_COMMENT","\/\/ save product links attributes\n",270],["T_WHITESPACE","        ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","saveProductLinks",271],"(",["T_VARIABLE","$product",271],",",["T_WHITESPACE"," ",271],["T_VARIABLE","$data",271],",",["T_WHITESPACE"," ",271],["T_VARIABLE","$typeId",271],")",";",["T_WHITESPACE","\n\n        ",271],["T_COMMENT","\/\/ Grouped product relations should be added to relation table\n",273],["T_WHITESPACE","        ",274],["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","getResourceSingleton",274],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_relation'",274],")",["T_WHITESPACE","\n            ",274],["T_OBJECT_OPERATOR","->",275],["T_STRING","processRelations",275],"(",["T_VARIABLE","$product",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getId",275],"(",")",",",["T_WHITESPACE"," ",275],["T_VARIABLE","$new",275],")",";",["T_WHITESPACE","\n\n        ",275],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],";",["T_WHITESPACE","\n    ",277],"}",["T_WHITESPACE","\n",278],"}",["T_WHITESPACE","\n",279]]