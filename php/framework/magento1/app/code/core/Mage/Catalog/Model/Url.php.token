[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog url model\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Url",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Number of characters allowed to be in URL path\n     *\n     * @var int\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","MAX_REQUEST_PATH_LENGTH",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_LNUMBER","240",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Number of characters allowed to be in URL path\n     * after MAX_REQUEST_PATH_LENGTH number of characters\n     *\n     * @var int\n     *\/",43],["T_WHITESPACE","\n    ",48],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","ALLOWED_REQUEST_PATH_OVERFLOW",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_LNUMBER","10",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Resource model\n     *\n     * @var Mage_Catalog_Model_Resource_Eav_Mysql4_Url\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_resourceModel",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Categories cache for products\n     *\n     * @var array\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_categories",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_ARRAY","array",63],"(",")",";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Store root categories cache\n     *\n     * @var array\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_rootCategories",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",")",";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Rewrite cache\n     *\n     * @var array\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_rewrites",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_ARRAY","array",77],"(",")",";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Current url rewrite rule\n     *\n     * @var Varien_Object\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$_rewrite",84],";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Cache for product rewrite suffix\n     *\n     * @var array\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$_productUrlSuffix",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_ARRAY","array",91],"(",")",";",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Cache for category rewrite suffix\n     *\n     * @var array\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PROTECTED","protected",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$_categoryUrlSuffix",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_ARRAY","array",98],"(",")",";",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Flag to overwrite config settings for Catalog URL rewrites history maintainance\n     *\n     * @var bool\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$_saveRewritesHistory",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","null",105],";",["T_WHITESPACE","\n\n     ",105],["T_DOC_COMMENT","\/**\n     * Singleton of category model for building URL path\n     *\n     * @var Mage_Catalog_Model_Category\n     *\/",107],["T_WHITESPACE","\n    ",111],["T_STATIC","static",112],["T_WHITESPACE"," ",112],["T_PROTECTED","protected",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$_categoryForUrlPath",112],";",["T_WHITESPACE","\n\n    ",112],["T_DOC_COMMENT","\/**\n     * Adds url_path property for non-root category - to ensure that url path is not empty.\n     *\n     * Sometimes attribute 'url_path' can be empty, because url_path hasn't been generated yet,\n     * in this case category is loaded with empty url_path and we should generate it manually.\n     *\n     * @param Varien_Object $category\n     * @return void\n     *\/",114],["T_WHITESPACE","\n    ",122],["T_PROTECTED","protected",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","_addCategoryUrlPath",123],"(",["T_VARIABLE","$category",123],")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(","!","(",["T_VARIABLE","$category",125],["T_WHITESPACE"," ",125],["T_INSTANCEOF","instanceof",125],["T_WHITESPACE"," ",125],["T_STRING","Varien_Object",125],")",["T_WHITESPACE"," ",125],["T_BOOLEAN_OR","||",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$category",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getUrlPath",125],"(",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_RETURN","return",126],";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_COMMENT","\/\/ This routine is not intended to be used with root categories,\n",129],["T_WHITESPACE","        ",130],["T_COMMENT","\/\/ but handle 'em gracefully - ensure them to have empty path.\n",130],["T_WHITESPACE","        ",131],["T_IF","if",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$category",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getLevel",131],"(",")",["T_WHITESPACE"," ",131],["T_IS_SMALLER_OR_EQUAL","<=",131],["T_WHITESPACE"," ",131],["T_LNUMBER","1",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$category",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","setUrlPath",132],"(",["T_CONSTANT_ENCAPSED_STRING","''",132],")",";",["T_WHITESPACE","\n            ",132],["T_RETURN","return",133],";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n\n        ",134],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_STRING","self",136],["T_DOUBLE_COLON","::",136],["T_VARIABLE","$_categoryForUrlPath",136],["T_WHITESPACE"," ",136],["T_IS_IDENTICAL","===",136],["T_WHITESPACE"," ",136],["T_STRING","null",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n            ",136],["T_STRING","self",137],["T_DOUBLE_COLON","::",137],["T_VARIABLE","$_categoryForUrlPath",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_STRING","Mage",137],["T_DOUBLE_COLON","::",137],["T_STRING","getModel",137],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",137],")",";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n\n        ",138],["T_COMMENT","\/\/ Generate url_path\n",140],["T_WHITESPACE","        ",141],["T_VARIABLE","$urlPath",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","self",141],["T_DOUBLE_COLON","::",141],["T_VARIABLE","$_categoryForUrlPath",141],["T_WHITESPACE","\n            ",141],["T_OBJECT_OPERATOR","->",142],["T_STRING","setData",142],"(",["T_VARIABLE","$category",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getData",142],"(",")",")",["T_WHITESPACE","\n            ",142],["T_OBJECT_OPERATOR","->",143],["T_STRING","getUrlPath",143],"(",")",";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$category",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","setUrlPath",144],"(",["T_VARIABLE","$urlPath",144],")",";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Retrieve stores array or store model\n     *\n     * @param int $storeId\n     * @return Mage_Core_Model_Store|array\n     *\/",147],["T_WHITESPACE","\n    ",152],["T_PUBLIC","public",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","getStores",153],"(",["T_VARIABLE","$storeId",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_STRING","null",153],")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getResource",155],"(",")",["T_OBJECT_OPERATOR","->",155],["T_STRING","getStores",155],"(",["T_VARIABLE","$storeId",155],")",";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Retrieve resource model\n     *\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Url\n     *\/",158],["T_WHITESPACE","\n    ",162],["T_PUBLIC","public",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","getResource",163],"(",")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_STRING","is_null",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_resourceModel",165],")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_resourceModel",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_STRING","Mage",166],["T_DOUBLE_COLON","::",166],["T_STRING","getResourceModel",166],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/url'",166],")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_resourceModel",168],";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Retrieve Category model singleton\n     *\n     * @return Mage_Catalog_Model_Category\n     *\/",171],["T_WHITESPACE","\n    ",175],["T_PUBLIC","public",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","getCategoryModel",176],"(",")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getResource",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","getCategoryModel",178],"(",")",";",["T_WHITESPACE","\n    ",178],"}",["T_WHITESPACE","\n\n    ",179],["T_DOC_COMMENT","\/**\n     * Retrieve product model singleton\n     *\n     * @return Mage_Catalog_Model_Product\n     *\/",181],["T_WHITESPACE","\n    ",185],["T_PUBLIC","public",186],["T_WHITESPACE"," ",186],["T_FUNCTION","function",186],["T_WHITESPACE"," ",186],["T_STRING","getProductModel",186],"(",")",["T_WHITESPACE","\n    ",186],"{",["T_WHITESPACE","\n        ",187],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getResource",188],"(",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","getProductModel",188],"(",")",";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Returns store root category, uses caching for it\n     *\n     * @param int $storeId\n     * @return Varien_Object\n     *\/",191],["T_WHITESPACE","\n    ",196],["T_PUBLIC","public",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","getStoreRootCategory",197],"(",["T_VARIABLE","$storeId",197],")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(","!",["T_STRING","array_key_exists",198],"(",["T_VARIABLE","$storeId",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_rootCategories",198],")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$category",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_STRING","null",199],";",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$store",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getStores",200],"(",["T_VARIABLE","$storeId",200],")",";",["T_WHITESPACE","\n            ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_VARIABLE","$store",201],")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                ",201],["T_VARIABLE","$rootCategoryId",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$store",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getRootCategoryId",202],"(",")",";",["T_WHITESPACE","\n                ",202],["T_VARIABLE","$category",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getResource",203],"(",")",["T_OBJECT_OPERATOR","->",203],["T_STRING","getCategory",203],"(",["T_VARIABLE","$rootCategoryId",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$storeId",203],")",";",["T_WHITESPACE","\n            ",203],"}",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_rootCategories",205],"[",["T_VARIABLE","$storeId",205],"]",["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$category",205],";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n        ",206],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_rootCategories",207],"[",["T_VARIABLE","$storeId",207],"]",";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n\n    ",208],["T_DOC_COMMENT","\/**\n     * Setter for $_saveRewritesHistory\n     * Force Rewrites History save bypass config settings\n     *\n     * @param bool $flag\n     * @return Mage_Catalog_Model_Url\n     *\/",210],["T_WHITESPACE","\n    ",216],["T_PUBLIC","public",217],["T_WHITESPACE"," ",217],["T_FUNCTION","function",217],["T_WHITESPACE"," ",217],["T_STRING","setShouldSaveRewritesHistory",217],"(",["T_VARIABLE","$flag",217],")",["T_WHITESPACE","\n    ",217],"{",["T_WHITESPACE","\n        ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_saveRewritesHistory",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_BOOL_CAST","(bool)",219],["T_VARIABLE","$flag",219],";",["T_WHITESPACE","\n        ",219],["T_RETURN","return",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],";",["T_WHITESPACE","\n    ",220],"}",["T_WHITESPACE","\n\n    ",221],["T_DOC_COMMENT","\/**\n     * Indicate whether to save URL Rewrite History or not (create redirects to old URLs)\n     *\n     * @param int $storeId Store View\n     * @return bool\n     *\/",223],["T_WHITESPACE","\n    ",228],["T_PUBLIC","public",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","getShouldSaveRewritesHistory",229],"(",["T_VARIABLE","$storeId",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_STRING","null",229],")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_IF","if",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_saveRewritesHistory",231],["T_WHITESPACE"," ",231],["T_IS_NOT_IDENTICAL","!==",231],["T_WHITESPACE"," ",231],["T_STRING","null",231],")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n            ",231],["T_RETURN","return",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","_saveRewritesHistory",232],";",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE","\n        ",233],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_STRING","Mage",234],["T_DOUBLE_COLON","::",234],["T_STRING","helper",234],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",234],")",["T_OBJECT_OPERATOR","->",234],["T_STRING","shouldSaveUrlRewritesHistory",234],"(",["T_VARIABLE","$storeId",234],")",";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Refresh all rewrite urls for some store or for all stores\n     * Used to make full reindexing of url rewrites\n     *\n     * @param int $storeId\n     * @return Mage_Catalog_Model_Url\n     *\/",237],["T_WHITESPACE","\n    ",243],["T_PUBLIC","public",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","refreshRewrites",244],"(",["T_VARIABLE","$storeId",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_STRING","null",244],")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_IF","if",246],["T_WHITESPACE"," ",246],"(",["T_STRING","is_null",246],"(",["T_VARIABLE","$storeId",246],")",")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_FOREACH","foreach",247],["T_WHITESPACE"," ",247],"(",["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getStores",247],"(",")",["T_WHITESPACE"," ",247],["T_AS","as",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$store",247],")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n                ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","refreshRewrites",248],"(",["T_VARIABLE","$store",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getId",248],"(",")",")",";",["T_WHITESPACE","\n            ",248],"}",["T_WHITESPACE","\n            ",249],["T_RETURN","return",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$this",250],";",["T_WHITESPACE","\n        ",250],"}",["T_WHITESPACE","\n\n        ",251],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","clearStoreInvalidRewrites",253],"(",["T_VARIABLE","$storeId",253],")",";",["T_WHITESPACE","\n        ",253],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","refreshCategoryRewrite",254],"(",["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getStores",254],"(",["T_VARIABLE","$storeId",254],")",["T_OBJECT_OPERATOR","->",254],["T_STRING","getRootCategoryId",254],"(",")",",",["T_WHITESPACE"," ",254],["T_VARIABLE","$storeId",254],",",["T_WHITESPACE"," ",254],["T_STRING","false",254],")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","refreshProductRewrites",255],"(",["T_VARIABLE","$storeId",255],")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getResource",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","clearCategoryProduct",256],"(",["T_VARIABLE","$storeId",256],")",";",["T_WHITESPACE","\n\n        ",256],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],";",["T_WHITESPACE","\n    ",258],"}",["T_WHITESPACE","\n\n    ",259],["T_DOC_COMMENT","\/**\n     * Refresh category rewrite\n     *\n     * @param Varien_Object $category\n     * @param string $parentPath\n     * @param bool $refreshProducts\n     * @return Mage_Catalog_Model_Url\n     *\/",261],["T_WHITESPACE","\n    ",268],["T_PROTECTED","protected",269],["T_WHITESPACE"," ",269],["T_FUNCTION","function",269],["T_WHITESPACE"," ",269],["T_STRING","_refreshCategoryRewrites",269],"(",["T_STRING","Varien_Object",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$category",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$parentPath",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","null",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$refreshProducts",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","true",269],")",["T_WHITESPACE","\n    ",269],"{",["T_WHITESPACE","\n        ",270],["T_IF","if",271],["T_WHITESPACE"," ",271],"(",["T_VARIABLE","$category",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getId",271],"(",")",["T_WHITESPACE"," ",271],["T_IS_NOT_EQUAL","!=",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getStores",271],"(",["T_VARIABLE","$category",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getStoreId",271],"(",")",")",["T_OBJECT_OPERATOR","->",271],["T_STRING","getRootCategoryId",271],"(",")",")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n            ",271],["T_IF","if",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$category",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getUrlKey",272],"(",")",["T_WHITESPACE"," ",272],["T_IS_EQUAL","==",272],["T_WHITESPACE"," ",272],["T_CONSTANT_ENCAPSED_STRING","''",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n                ",272],["T_VARIABLE","$urlKey",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getCategoryModel",273],"(",")",["T_OBJECT_OPERATOR","->",273],["T_STRING","formatUrlKey",273],"(",["T_VARIABLE","$category",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getName",273],"(",")",")",";",["T_WHITESPACE","\n            ",273],"}",["T_WHITESPACE","\n            ",274],["T_ELSE","else",275],["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n                ",275],["T_VARIABLE","$urlKey",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getCategoryModel",276],"(",")",["T_OBJECT_OPERATOR","->",276],["T_STRING","formatUrlKey",276],"(",["T_VARIABLE","$category",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getUrlKey",276],"(",")",")",";",["T_WHITESPACE","\n            ",276],"}",["T_WHITESPACE","\n\n            ",277],["T_VARIABLE","$idPath",279],["T_WHITESPACE","      ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","generatePath",279],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",279],",",["T_WHITESPACE"," ",279],["T_STRING","null",279],",",["T_WHITESPACE"," ",279],["T_VARIABLE","$category",279],")",";",["T_WHITESPACE","\n            ",279],["T_VARIABLE","$targetPath",280],["T_WHITESPACE","  ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","generatePath",280],"(",["T_CONSTANT_ENCAPSED_STRING","'target'",280],",",["T_WHITESPACE"," ",280],["T_STRING","null",280],",",["T_WHITESPACE"," ",280],["T_VARIABLE","$category",280],")",";",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$requestPath",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getCategoryRequestPath",281],"(",["T_VARIABLE","$category",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$parentPath",281],")",";",["T_WHITESPACE","\n\n            ",281],["T_VARIABLE","$rewriteData",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_ARRAY","array",283],"(",["T_WHITESPACE","\n                ",283],["T_CONSTANT_ENCAPSED_STRING","'store_id'",284],["T_WHITESPACE","      ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$category",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getStoreId",284],"(",")",",",["T_WHITESPACE","\n                ",284],["T_CONSTANT_ENCAPSED_STRING","'category_id'",285],["T_WHITESPACE","   ",285],["T_DOUBLE_ARROW","=>",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$category",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getId",285],"(",")",",",["T_WHITESPACE","\n                ",285],["T_CONSTANT_ENCAPSED_STRING","'product_id'",286],["T_WHITESPACE","    ",286],["T_DOUBLE_ARROW","=>",286],["T_WHITESPACE"," ",286],["T_STRING","null",286],",",["T_WHITESPACE","\n                ",286],["T_CONSTANT_ENCAPSED_STRING","'id_path'",287],["T_WHITESPACE","       ",287],["T_DOUBLE_ARROW","=>",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$idPath",287],",",["T_WHITESPACE","\n                ",287],["T_CONSTANT_ENCAPSED_STRING","'request_path'",288],["T_WHITESPACE","  ",288],["T_DOUBLE_ARROW","=>",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$requestPath",288],",",["T_WHITESPACE","\n                ",288],["T_CONSTANT_ENCAPSED_STRING","'target_path'",289],["T_WHITESPACE","   ",289],["T_DOUBLE_ARROW","=>",289],["T_WHITESPACE"," ",289],["T_VARIABLE","$targetPath",289],",",["T_WHITESPACE","\n                ",289],["T_CONSTANT_ENCAPSED_STRING","'is_system'",290],["T_WHITESPACE","     ",290],["T_DOUBLE_ARROW","=>",290],["T_WHITESPACE"," ",290],["T_LNUMBER","1",290],["T_WHITESPACE","\n            ",290],")",";",["T_WHITESPACE","\n\n            ",291],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","getResource",293],"(",")",["T_OBJECT_OPERATOR","->",293],["T_STRING","saveRewrite",293],"(",["T_VARIABLE","$rewriteData",293],",",["T_WHITESPACE"," ",293],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_rewrite",293],")",";",["T_WHITESPACE","\n\n            ",293],["T_IF","if",295],["T_WHITESPACE"," ",295],"(",["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getShouldSaveRewritesHistory",295],"(",["T_VARIABLE","$category",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getStoreId",295],"(",")",")",")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n                ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_saveRewriteHistory",296],"(",["T_VARIABLE","$rewriteData",296],",",["T_WHITESPACE"," ",296],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_rewrite",296],")",";",["T_WHITESPACE","\n            ",296],"}",["T_WHITESPACE","\n\n            ",297],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$category",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getUrlKey",299],"(",")",["T_WHITESPACE"," ",299],["T_IS_NOT_EQUAL","!=",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$urlKey",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                ",299],["T_VARIABLE","$category",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","setUrlKey",300],"(",["T_VARIABLE","$urlKey",300],")",";",["T_WHITESPACE","\n                ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getResource",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","saveCategoryAttribute",301],"(",["T_VARIABLE","$category",301],",",["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","'url_key'",301],")",";",["T_WHITESPACE","\n            ",301],"}",["T_WHITESPACE","\n            ",302],["T_IF","if",303],["T_WHITESPACE"," ",303],"(",["T_VARIABLE","$category",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getUrlPath",303],"(",")",["T_WHITESPACE"," ",303],["T_IS_NOT_EQUAL","!=",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$requestPath",303],")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n                ",303],["T_VARIABLE","$category",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","setUrlPath",304],"(",["T_VARIABLE","$requestPath",304],")",";",["T_WHITESPACE","\n                ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getResource",305],"(",")",["T_OBJECT_OPERATOR","->",305],["T_STRING","saveCategoryAttribute",305],"(",["T_VARIABLE","$category",305],",",["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","'url_path'",305],")",";",["T_WHITESPACE","\n            ",305],"}",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n        ",307],["T_ELSE","else",308],["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n            ",308],["T_IF","if",309],["T_WHITESPACE"," ",309],"(",["T_VARIABLE","$category",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getUrlPath",309],"(",")",["T_WHITESPACE"," ",309],["T_IS_NOT_EQUAL","!=",309],["T_WHITESPACE"," ",309],["T_CONSTANT_ENCAPSED_STRING","''",309],")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n                ",309],["T_VARIABLE","$category",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","setUrlPath",310],"(",["T_CONSTANT_ENCAPSED_STRING","''",310],")",";",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getResource",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","saveCategoryAttribute",311],"(",["T_VARIABLE","$category",311],",",["T_WHITESPACE"," ",311],["T_CONSTANT_ENCAPSED_STRING","'url_path'",311],")",";",["T_WHITESPACE","\n            ",311],"}",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n\n        ",313],["T_IF","if",315],["T_WHITESPACE"," ",315],"(",["T_VARIABLE","$refreshProducts",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","_refreshCategoryProductRewrites",316],"(",["T_VARIABLE","$category",316],")",";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE","\n\n        ",317],["T_FOREACH","foreach",319],["T_WHITESPACE"," ",319],"(",["T_VARIABLE","$category",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getChilds",319],"(",")",["T_WHITESPACE"," ",319],["T_AS","as",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$child",319],")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n            ",319],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_refreshCategoryRewrites",320],"(",["T_VARIABLE","$child",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$category",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getUrlPath",320],"(",")",["T_WHITESPACE"," ",320],".",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'\/'",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$refreshProducts",320],")",";",["T_WHITESPACE","\n        ",320],"}",["T_WHITESPACE","\n\n        ",321],["T_RETURN","return",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$this",323],";",["T_WHITESPACE","\n    ",323],"}",["T_WHITESPACE","\n\n    ",324],["T_DOC_COMMENT","\/**\n     * Refresh product rewrite\n     *\n     * @param Varien_Object $product\n     * @param Varien_Object $category\n     * @return Mage_Catalog_Model_Url\n     *\/",326],["T_WHITESPACE","\n    ",332],["T_PROTECTED","protected",333],["T_WHITESPACE"," ",333],["T_FUNCTION","function",333],["T_WHITESPACE"," ",333],["T_STRING","_refreshProductRewrite",333],"(",["T_STRING","Varien_Object",333],["T_WHITESPACE"," ",333],["T_VARIABLE","$product",333],",",["T_WHITESPACE"," ",333],["T_STRING","Varien_Object",333],["T_WHITESPACE"," ",333],["T_VARIABLE","$category",333],")",["T_WHITESPACE","\n    ",333],"{",["T_WHITESPACE","\n        ",334],["T_IF","if",335],["T_WHITESPACE"," ",335],"(",["T_VARIABLE","$category",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getId",335],"(",")",["T_WHITESPACE"," ",335],["T_IS_EQUAL","==",335],["T_WHITESPACE"," ",335],["T_VARIABLE","$category",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getPath",335],"(",")",")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n            ",335],["T_RETURN","return",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],";",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE","\n        ",337],["T_IF","if",338],["T_WHITESPACE"," ",338],"(",["T_VARIABLE","$product",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getUrlKey",338],"(",")",["T_WHITESPACE"," ",338],["T_IS_EQUAL","==",338],["T_WHITESPACE"," ",338],["T_CONSTANT_ENCAPSED_STRING","''",338],")",["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n            ",338],["T_VARIABLE","$urlKey",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getProductModel",339],"(",")",["T_OBJECT_OPERATOR","->",339],["T_STRING","formatUrlKey",339],"(",["T_VARIABLE","$product",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getName",339],"(",")",")",";",["T_WHITESPACE","\n        ",339],"}",["T_WHITESPACE","\n        ",340],["T_ELSE","else",341],["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n            ",341],["T_VARIABLE","$urlKey",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","getProductModel",342],"(",")",["T_OBJECT_OPERATOR","->",342],["T_STRING","formatUrlKey",342],"(",["T_VARIABLE","$product",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","getUrlKey",342],"(",")",")",";",["T_WHITESPACE","\n        ",342],"}",["T_WHITESPACE","\n\n        ",343],["T_VARIABLE","$idPath",345],["T_WHITESPACE","      ",345],"=",["T_WHITESPACE"," ",345],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","generatePath",345],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$product",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$category",345],")",";",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$targetPath",346],["T_WHITESPACE","  ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","generatePath",346],"(",["T_CONSTANT_ENCAPSED_STRING","'target'",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$product",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$category",346],")",";",["T_WHITESPACE","\n        ",346],["T_VARIABLE","$requestPath",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getProductRequestPath",347],"(",["T_VARIABLE","$product",347],",",["T_WHITESPACE"," ",347],["T_VARIABLE","$category",347],")",";",["T_WHITESPACE","\n\n        ",347],["T_VARIABLE","$categoryId",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_STRING","null",349],";",["T_WHITESPACE","\n        ",349],["T_VARIABLE","$updateKeys",350],["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_STRING","true",350],";",["T_WHITESPACE","\n        ",350],["T_IF","if",351],["T_WHITESPACE"," ",351],"(",["T_VARIABLE","$category",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getLevel",351],"(",")",["T_WHITESPACE"," ",351],">",["T_WHITESPACE"," ",351],["T_LNUMBER","1",351],")",["T_WHITESPACE"," ",351],"{",["T_WHITESPACE","\n            ",351],["T_VARIABLE","$categoryId",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_VARIABLE","$category",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getId",352],"(",")",";",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$updateKeys",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_STRING","false",353],";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE","\n\n        ",354],["T_VARIABLE","$rewriteData",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_ARRAY","array",356],"(",["T_WHITESPACE","\n            ",356],["T_CONSTANT_ENCAPSED_STRING","'store_id'",357],["T_WHITESPACE","      ",357],["T_DOUBLE_ARROW","=>",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$category",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getStoreId",357],"(",")",",",["T_WHITESPACE","\n            ",357],["T_CONSTANT_ENCAPSED_STRING","'category_id'",358],["T_WHITESPACE","   ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$categoryId",358],",",["T_WHITESPACE","\n            ",358],["T_CONSTANT_ENCAPSED_STRING","'product_id'",359],["T_WHITESPACE","    ",359],["T_DOUBLE_ARROW","=>",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$product",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getId",359],"(",")",",",["T_WHITESPACE","\n            ",359],["T_CONSTANT_ENCAPSED_STRING","'id_path'",360],["T_WHITESPACE","       ",360],["T_DOUBLE_ARROW","=>",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$idPath",360],",",["T_WHITESPACE","\n            ",360],["T_CONSTANT_ENCAPSED_STRING","'request_path'",361],["T_WHITESPACE","  ",361],["T_DOUBLE_ARROW","=>",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$requestPath",361],",",["T_WHITESPACE","\n            ",361],["T_CONSTANT_ENCAPSED_STRING","'target_path'",362],["T_WHITESPACE","   ",362],["T_DOUBLE_ARROW","=>",362],["T_WHITESPACE"," ",362],["T_VARIABLE","$targetPath",362],",",["T_WHITESPACE","\n            ",362],["T_CONSTANT_ENCAPSED_STRING","'is_system'",363],["T_WHITESPACE","     ",363],["T_DOUBLE_ARROW","=>",363],["T_WHITESPACE"," ",363],["T_LNUMBER","1",363],["T_WHITESPACE","\n        ",363],")",";",["T_WHITESPACE","\n\n        ",364],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getResource",366],"(",")",["T_OBJECT_OPERATOR","->",366],["T_STRING","saveRewrite",366],"(",["T_VARIABLE","$rewriteData",366],",",["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","_rewrite",366],")",";",["T_WHITESPACE","\n\n        ",366],["T_IF","if",368],["T_WHITESPACE"," ",368],"(",["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getShouldSaveRewritesHistory",368],"(",["T_VARIABLE","$category",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getStoreId",368],"(",")",")",")",["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n            ",368],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_saveRewriteHistory",369],"(",["T_VARIABLE","$rewriteData",369],",",["T_WHITESPACE"," ",369],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_rewrite",369],")",";",["T_WHITESPACE","\n        ",369],"}",["T_WHITESPACE","\n\n        ",370],["T_IF","if",372],["T_WHITESPACE"," ",372],"(",["T_VARIABLE","$updateKeys",372],["T_WHITESPACE"," ",372],["T_BOOLEAN_AND","&&",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$product",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getUrlKey",372],"(",")",["T_WHITESPACE"," ",372],["T_IS_NOT_EQUAL","!=",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$urlKey",372],")",["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n            ",372],["T_VARIABLE","$product",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","setUrlKey",373],"(",["T_VARIABLE","$urlKey",373],")",";",["T_WHITESPACE","\n            ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getResource",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","saveProductAttribute",374],"(",["T_VARIABLE","$product",374],",",["T_WHITESPACE"," ",374],["T_CONSTANT_ENCAPSED_STRING","'url_key'",374],")",";",["T_WHITESPACE","\n        ",374],"}",["T_WHITESPACE","\n        ",375],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_VARIABLE","$updateKeys",376],["T_WHITESPACE"," ",376],["T_BOOLEAN_AND","&&",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$product",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getUrlPath",376],"(",")",["T_WHITESPACE"," ",376],["T_IS_NOT_EQUAL","!=",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$requestPath",376],")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$product",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","setUrlPath",377],"(",["T_VARIABLE","$requestPath",377],")",";",["T_WHITESPACE","\n            ",377],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getResource",378],"(",")",["T_OBJECT_OPERATOR","->",378],["T_STRING","saveProductAttribute",378],"(",["T_VARIABLE","$product",378],",",["T_WHITESPACE"," ",378],["T_CONSTANT_ENCAPSED_STRING","'url_path'",378],")",";",["T_WHITESPACE","\n        ",378],"}",["T_WHITESPACE","\n\n        ",379],["T_RETURN","return",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$this",381],";",["T_WHITESPACE","\n    ",381],"}",["T_WHITESPACE","\n\n    ",382],["T_DOC_COMMENT","\/**\n     * Refresh products for catwgory\n     *\n     * @param Varien_Object $category\n     * @return Mage_Catalog_Model_Url\n     *\/",384],["T_WHITESPACE","\n    ",389],["T_PROTECTED","protected",390],["T_WHITESPACE"," ",390],["T_FUNCTION","function",390],["T_WHITESPACE"," ",390],["T_STRING","_refreshCategoryProductRewrites",390],"(",["T_STRING","Varien_Object",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$category",390],")",["T_WHITESPACE","\n    ",390],"{",["T_WHITESPACE","\n        ",391],["T_VARIABLE","$originalRewrites",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","_rewrites",392],";",["T_WHITESPACE","\n        ",392],["T_VARIABLE","$process",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_STRING","true",393],";",["T_WHITESPACE","\n        ",393],["T_VARIABLE","$lastEntityId",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],["T_LNUMBER","0",394],";",["T_WHITESPACE","\n        ",394],["T_VARIABLE","$firstIteration",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_STRING","true",395],";",["T_WHITESPACE","\n        ",395],["T_WHILE","while",396],["T_WHITESPACE"," ",396],"(",["T_VARIABLE","$process",396],["T_WHITESPACE"," ",396],["T_IS_EQUAL","==",396],["T_WHITESPACE"," ",396],["T_STRING","true",396],")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n            ",396],["T_VARIABLE","$products",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getResource",397],"(",")",["T_OBJECT_OPERATOR","->",397],["T_STRING","getProductsByCategory",397],"(",["T_VARIABLE","$category",397],",",["T_WHITESPACE"," ",397],["T_VARIABLE","$lastEntityId",397],")",";",["T_WHITESPACE","\n            ",397],["T_IF","if",398],["T_WHITESPACE"," ",398],"(","!",["T_VARIABLE","$products",398],")",["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n                ",398],["T_IF","if",399],["T_WHITESPACE"," ",399],"(",["T_VARIABLE","$firstIteration",399],")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n                    ",399],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getResource",400],"(",")",["T_OBJECT_OPERATOR","->",400],["T_STRING","deleteCategoryProductStoreRewrites",400],"(",["T_WHITESPACE","\n                        ",400],["T_VARIABLE","$category",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getId",401],"(",")",",",["T_WHITESPACE","\n                        ",401],["T_ARRAY","array",402],"(",")",",",["T_WHITESPACE","\n                        ",402],["T_VARIABLE","$category",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getStoreId",403],"(",")",["T_WHITESPACE","\n                    ",403],")",";",["T_WHITESPACE","\n                ",404],"}",["T_WHITESPACE","\n                ",405],["T_VARIABLE","$process",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_STRING","false",406],";",["T_WHITESPACE","\n                ",406],["T_BREAK","break",407],";",["T_WHITESPACE","\n            ",407],"}",["T_WHITESPACE","\n\n            ",408],["T_COMMENT","\/\/ Prepare rewrites for generation\n",410],["T_WHITESPACE","            ",411],["T_VARIABLE","$rootCategory",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getStoreRootCategory",411],"(",["T_VARIABLE","$category",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getStoreId",411],"(",")",")",";",["T_WHITESPACE","\n            ",411],["T_VARIABLE","$categoryIds",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_ARRAY","array",412],"(",["T_VARIABLE","$category",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getId",412],"(",")",",",["T_WHITESPACE"," ",412],["T_VARIABLE","$rootCategory",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getId",412],"(",")",")",";",["T_WHITESPACE","\n            ",412],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_rewrites",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getResource",413],"(",")",["T_OBJECT_OPERATOR","->",413],["T_STRING","prepareRewrites",413],"(",["T_WHITESPACE","\n                ",413],["T_VARIABLE","$category",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getStoreId",414],"(",")",",",["T_WHITESPACE","\n                ",414],["T_VARIABLE","$categoryIds",415],",",["T_WHITESPACE","\n                ",415],["T_STRING","array_keys",416],"(",["T_VARIABLE","$products",416],")",["T_WHITESPACE","\n            ",416],")",";",["T_WHITESPACE","\n\n            ",417],["T_FOREACH","foreach",419],["T_WHITESPACE"," ",419],"(",["T_VARIABLE","$products",419],["T_WHITESPACE"," ",419],["T_AS","as",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$product",419],")",["T_WHITESPACE"," ",419],"{",["T_WHITESPACE","\n                ",419],["T_COMMENT","\/\/ Product always must have rewrite in root category\n",420],["T_WHITESPACE","                ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","_refreshProductRewrite",421],"(",["T_VARIABLE","$product",421],",",["T_WHITESPACE"," ",421],["T_VARIABLE","$rootCategory",421],")",";",["T_WHITESPACE","\n                ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_refreshProductRewrite",422],"(",["T_VARIABLE","$product",422],",",["T_WHITESPACE"," ",422],["T_VARIABLE","$category",422],")",";",["T_WHITESPACE","\n            ",422],"}",["T_WHITESPACE","\n            ",423],["T_VARIABLE","$firstIteration",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_STRING","false",424],";",["T_WHITESPACE","\n            ",424],["T_UNSET","unset",425],"(",["T_VARIABLE","$products",425],")",";",["T_WHITESPACE","\n        ",425],"}",["T_WHITESPACE","\n        ",426],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_rewrites",427],["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_VARIABLE","$originalRewrites",427],";",["T_WHITESPACE","\n        ",427],["T_RETURN","return",428],["T_WHITESPACE"," ",428],["T_VARIABLE","$this",428],";",["T_WHITESPACE","\n    ",428],"}",["T_WHITESPACE","\n\n    ",429],["T_DOC_COMMENT","\/**\n     * Refresh category and childs rewrites\n     * Called when reindexing all rewrites and as a reaction on category change that affects rewrites\n     *\n     * @param int $categoryId\n     * @param int|null $storeId\n     * @param bool $refreshProducts\n     * @return Mage_Catalog_Model_Url\n     *\/",431],["T_WHITESPACE","\n    ",439],["T_PUBLIC","public",440],["T_WHITESPACE"," ",440],["T_FUNCTION","function",440],["T_WHITESPACE"," ",440],["T_STRING","refreshCategoryRewrite",440],"(",["T_VARIABLE","$categoryId",440],",",["T_WHITESPACE"," ",440],["T_VARIABLE","$storeId",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_STRING","null",440],",",["T_WHITESPACE"," ",440],["T_VARIABLE","$refreshProducts",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_STRING","true",440],")",["T_WHITESPACE","\n    ",440],"{",["T_WHITESPACE","\n        ",441],["T_IF","if",442],["T_WHITESPACE"," ",442],"(",["T_STRING","is_null",442],"(",["T_VARIABLE","$storeId",442],")",")",["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n            ",442],["T_FOREACH","foreach",443],["T_WHITESPACE"," ",443],"(",["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getStores",443],"(",")",["T_WHITESPACE"," ",443],["T_AS","as",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$store",443],")",["T_WHITESPACE"," ",443],"{",["T_WHITESPACE","\n                ",443],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","refreshCategoryRewrite",444],"(",["T_VARIABLE","$categoryId",444],",",["T_WHITESPACE"," ",444],["T_VARIABLE","$store",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getId",444],"(",")",",",["T_WHITESPACE"," ",444],["T_VARIABLE","$refreshProducts",444],")",";",["T_WHITESPACE","\n            ",444],"}",["T_WHITESPACE","\n            ",445],["T_RETURN","return",446],["T_WHITESPACE"," ",446],["T_VARIABLE","$this",446],";",["T_WHITESPACE","\n        ",446],"}",["T_WHITESPACE","\n\n        ",447],["T_VARIABLE","$category",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getResource",449],"(",")",["T_OBJECT_OPERATOR","->",449],["T_STRING","getCategory",449],"(",["T_VARIABLE","$categoryId",449],",",["T_WHITESPACE"," ",449],["T_VARIABLE","$storeId",449],")",";",["T_WHITESPACE","\n        ",449],["T_IF","if",450],["T_WHITESPACE"," ",450],"(","!",["T_VARIABLE","$category",450],")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n            ",450],["T_RETURN","return",451],["T_WHITESPACE"," ",451],["T_VARIABLE","$this",451],";",["T_WHITESPACE","\n        ",451],"}",["T_WHITESPACE","\n\n        ",452],["T_COMMENT","\/\/ Load all childs and refresh all categories\n",454],["T_WHITESPACE","        ",455],["T_VARIABLE","$category",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_VARIABLE","$this",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","getResource",455],"(",")",["T_OBJECT_OPERATOR","->",455],["T_STRING","loadCategoryChilds",455],"(",["T_VARIABLE","$category",455],")",";",["T_WHITESPACE","\n        ",455],["T_VARIABLE","$categoryIds",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_ARRAY","array",456],"(",["T_VARIABLE","$category",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","getId",456],"(",")",")",";",["T_WHITESPACE","\n        ",456],["T_IF","if",457],["T_WHITESPACE"," ",457],"(",["T_VARIABLE","$category",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getAllChilds",457],"(",")",")",["T_WHITESPACE"," ",457],"{",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$categoryIds",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_STRING","array_merge",458],"(",["T_VARIABLE","$categoryIds",458],",",["T_WHITESPACE"," ",458],["T_STRING","array_keys",458],"(",["T_VARIABLE","$category",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getAllChilds",458],"(",")",")",")",";",["T_WHITESPACE","\n        ",458],"}",["T_WHITESPACE","\n        ",459],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","_rewrites",460],["T_WHITESPACE"," ",460],"=",["T_WHITESPACE"," ",460],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getResource",460],"(",")",["T_OBJECT_OPERATOR","->",460],["T_STRING","prepareRewrites",460],"(",["T_VARIABLE","$storeId",460],",",["T_WHITESPACE"," ",460],["T_VARIABLE","$categoryIds",460],")",";",["T_WHITESPACE","\n        ",460],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","_refreshCategoryRewrites",461],"(",["T_VARIABLE","$category",461],",",["T_WHITESPACE"," ",461],["T_STRING","null",461],",",["T_WHITESPACE"," ",461],["T_VARIABLE","$refreshProducts",461],")",";",["T_WHITESPACE","\n\n        ",461],["T_UNSET","unset",463],"(",["T_VARIABLE","$category",463],")",";",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_rewrites",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_ARRAY","array",464],"(",")",";",["T_WHITESPACE","\n\n        ",464],["T_RETURN","return",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$this",466],";",["T_WHITESPACE","\n    ",466],"}",["T_WHITESPACE","\n\n    ",467],["T_DOC_COMMENT","\/**\n     * Refresh product rewrite urls for one store or all stores\n     * Called as a reaction on product change that affects rewrites\n     *\n     * @param int $productId\n     * @param int|null $storeId\n     * @return Mage_Catalog_Model_Url\n     *\/",469],["T_WHITESPACE","\n    ",476],["T_PUBLIC","public",477],["T_WHITESPACE"," ",477],["T_FUNCTION","function",477],["T_WHITESPACE"," ",477],["T_STRING","refreshProductRewrite",477],"(",["T_VARIABLE","$productId",477],",",["T_WHITESPACE"," ",477],["T_VARIABLE","$storeId",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_STRING","null",477],")",["T_WHITESPACE","\n    ",477],"{",["T_WHITESPACE","\n        ",478],["T_IF","if",479],["T_WHITESPACE"," ",479],"(",["T_STRING","is_null",479],"(",["T_VARIABLE","$storeId",479],")",")",["T_WHITESPACE"," ",479],"{",["T_WHITESPACE","\n            ",479],["T_FOREACH","foreach",480],["T_WHITESPACE"," ",480],"(",["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getStores",480],"(",")",["T_WHITESPACE"," ",480],["T_AS","as",480],["T_WHITESPACE"," ",480],["T_VARIABLE","$store",480],")",["T_WHITESPACE"," ",480],"{",["T_WHITESPACE","\n                ",480],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","refreshProductRewrite",481],"(",["T_VARIABLE","$productId",481],",",["T_WHITESPACE"," ",481],["T_VARIABLE","$store",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getId",481],"(",")",")",";",["T_WHITESPACE","\n            ",481],"}",["T_WHITESPACE","\n            ",482],["T_RETURN","return",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$this",483],";",["T_WHITESPACE","\n        ",483],"}",["T_WHITESPACE","\n\n        ",484],["T_VARIABLE","$product",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getResource",486],"(",")",["T_OBJECT_OPERATOR","->",486],["T_STRING","getProduct",486],"(",["T_VARIABLE","$productId",486],",",["T_WHITESPACE"," ",486],["T_VARIABLE","$storeId",486],")",";",["T_WHITESPACE","\n        ",486],["T_IF","if",487],["T_WHITESPACE"," ",487],"(",["T_VARIABLE","$product",487],")",["T_WHITESPACE"," ",487],"{",["T_WHITESPACE","\n            ",487],["T_VARIABLE","$store",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getStores",488],"(",["T_VARIABLE","$storeId",488],")",";",["T_WHITESPACE","\n            ",488],["T_VARIABLE","$storeRootCategoryId",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_VARIABLE","$store",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getRootCategoryId",489],"(",")",";",["T_WHITESPACE","\n\n            ",489],["T_COMMENT","\/\/ List of categories the product is assigned to, filtered by being within the store's categories root\n",491],["T_WHITESPACE","            ",492],["T_VARIABLE","$categories",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getResource",492],"(",")",["T_OBJECT_OPERATOR","->",492],["T_STRING","getCategories",492],"(",["T_VARIABLE","$product",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getCategoryIds",492],"(",")",",",["T_WHITESPACE"," ",492],["T_VARIABLE","$storeId",492],")",";",["T_WHITESPACE","\n            ",492],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","_rewrites",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getResource",493],"(",")",["T_OBJECT_OPERATOR","->",493],["T_STRING","prepareRewrites",493],"(",["T_VARIABLE","$storeId",493],",",["T_WHITESPACE"," ",493],["T_CONSTANT_ENCAPSED_STRING","''",493],",",["T_WHITESPACE"," ",493],["T_VARIABLE","$productId",493],")",";",["T_WHITESPACE","\n\n            ",493],["T_COMMENT","\/\/ Add rewrites for all needed categories\n",495],["T_WHITESPACE","            ",496],["T_COMMENT","\/\/ If product is assigned to any of store's categories -\n",496],["T_WHITESPACE","            ",497],["T_COMMENT","\/\/ we also should use store root category to create root product url rewrite\n",497],["T_WHITESPACE","            ",498],["T_IF","if",498],["T_WHITESPACE"," ",498],"(","!",["T_ISSET","isset",498],"(",["T_VARIABLE","$categories",498],"[",["T_VARIABLE","$storeRootCategoryId",498],"]",")",")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n                ",498],["T_VARIABLE","$categories",499],"[",["T_VARIABLE","$storeRootCategoryId",499],"]",["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","getResource",499],"(",")",["T_OBJECT_OPERATOR","->",499],["T_STRING","getCategory",499],"(",["T_VARIABLE","$storeRootCategoryId",499],",",["T_WHITESPACE"," ",499],["T_VARIABLE","$storeId",499],")",";",["T_WHITESPACE","\n            ",499],"}",["T_WHITESPACE","\n\n            ",500],["T_COMMENT","\/\/ Create product url rewrites\n",502],["T_WHITESPACE","            ",503],["T_FOREACH","foreach",503],["T_WHITESPACE"," ",503],"(",["T_VARIABLE","$categories",503],["T_WHITESPACE"," ",503],["T_AS","as",503],["T_WHITESPACE"," ",503],["T_VARIABLE","$category",503],")",["T_WHITESPACE"," ",503],"{",["T_WHITESPACE","\n                ",503],["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","_refreshProductRewrite",504],"(",["T_VARIABLE","$product",504],",",["T_WHITESPACE"," ",504],["T_VARIABLE","$category",504],")",";",["T_WHITESPACE","\n            ",504],"}",["T_WHITESPACE","\n\n            ",505],["T_COMMENT","\/\/ Remove all other product rewrites created earlier for this store - they're invalid now\n",507],["T_WHITESPACE","            ",508],["T_VARIABLE","$excludeCategoryIds",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_STRING","array_keys",508],"(",["T_VARIABLE","$categories",508],")",";",["T_WHITESPACE","\n            ",508],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getResource",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","clearProductRewrites",509],"(",["T_VARIABLE","$productId",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$storeId",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$excludeCategoryIds",509],")",";",["T_WHITESPACE","\n\n            ",509],["T_UNSET","unset",511],"(",["T_VARIABLE","$categories",511],")",";",["T_WHITESPACE","\n            ",511],["T_UNSET","unset",512],"(",["T_VARIABLE","$product",512],")",";",["T_WHITESPACE","\n        ",512],"}",["T_WHITESPACE"," ",513],["T_ELSE","else",513],["T_WHITESPACE"," ",513],"{",["T_WHITESPACE","\n            ",513],["T_COMMENT","\/\/ Product doesn't belong to this store - clear all its url rewrites including root one\n",514],["T_WHITESPACE","            ",515],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","getResource",515],"(",")",["T_OBJECT_OPERATOR","->",515],["T_STRING","clearProductRewrites",515],"(",["T_VARIABLE","$productId",515],",",["T_WHITESPACE"," ",515],["T_VARIABLE","$storeId",515],",",["T_WHITESPACE"," ",515],["T_ARRAY","array",515],"(",")",")",";",["T_WHITESPACE","\n        ",515],"}",["T_WHITESPACE","\n\n        ",516],["T_RETURN","return",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],";",["T_WHITESPACE","\n    ",518],"}",["T_WHITESPACE","\n\n    ",519],["T_DOC_COMMENT","\/**\n     * Refresh all product rewrites for designated store\n     *\n     * @param int $storeId\n     * @return Mage_Catalog_Model_Url\n     *\/",521],["T_WHITESPACE","\n    ",526],["T_PUBLIC","public",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","refreshProductRewrites",527],"(",["T_VARIABLE","$storeId",527],")",["T_WHITESPACE","\n    ",527],"{",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","_categories",529],["T_WHITESPACE","      ",529],"=",["T_WHITESPACE"," ",529],["T_ARRAY","array",529],"(",")",";",["T_WHITESPACE","\n        ",529],["T_VARIABLE","$storeRootCategoryId",530],["T_WHITESPACE","    ",530],"=",["T_WHITESPACE"," ",530],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","getStores",530],"(",["T_VARIABLE","$storeId",530],")",["T_OBJECT_OPERATOR","->",530],["T_STRING","getRootCategoryId",530],"(",")",";",["T_WHITESPACE","\n        ",530],["T_VARIABLE","$storeRootCategoryPath",531],["T_WHITESPACE","  ",531],"=",["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","getStores",531],"(",["T_VARIABLE","$storeId",531],")",["T_OBJECT_OPERATOR","->",531],["T_STRING","getRootCategoryPath",531],"(",")",";",["T_WHITESPACE","\n        ",531],["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","_categories",532],"[",["T_VARIABLE","$storeRootCategoryId",532],"]",["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","getResource",532],"(",")",["T_OBJECT_OPERATOR","->",532],["T_STRING","getCategory",532],"(",["T_VARIABLE","$storeRootCategoryId",532],",",["T_WHITESPACE"," ",532],["T_VARIABLE","$storeId",532],")",";",["T_WHITESPACE","\n\n        ",532],["T_VARIABLE","$lastEntityId",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_LNUMBER","0",534],";",["T_WHITESPACE","\n        ",534],["T_VARIABLE","$process",535],["T_WHITESPACE"," ",535],"=",["T_WHITESPACE"," ",535],["T_STRING","true",535],";",["T_WHITESPACE","\n\n        ",535],["T_WHILE","while",537],["T_WHITESPACE"," ",537],"(",["T_VARIABLE","$process",537],["T_WHITESPACE"," ",537],["T_IS_EQUAL","==",537],["T_WHITESPACE"," ",537],["T_STRING","true",537],")",["T_WHITESPACE"," ",537],"{",["T_WHITESPACE","\n            ",537],["T_VARIABLE","$products",538],["T_WHITESPACE"," ",538],"=",["T_WHITESPACE"," ",538],["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getResource",538],"(",")",["T_OBJECT_OPERATOR","->",538],["T_STRING","getProductsByStore",538],"(",["T_VARIABLE","$storeId",538],",",["T_WHITESPACE"," ",538],["T_VARIABLE","$lastEntityId",538],")",";",["T_WHITESPACE","\n            ",538],["T_IF","if",539],["T_WHITESPACE"," ",539],"(","!",["T_VARIABLE","$products",539],")",["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n                ",539],["T_VARIABLE","$process",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_STRING","false",540],";",["T_WHITESPACE","\n                ",540],["T_BREAK","break",541],";",["T_WHITESPACE","\n            ",541],"}",["T_WHITESPACE","\n\n            ",542],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","_rewrites",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getResource",544],"(",")",["T_OBJECT_OPERATOR","->",544],["T_STRING","prepareRewrites",544],"(",["T_VARIABLE","$storeId",544],",",["T_WHITESPACE"," ",544],["T_STRING","false",544],",",["T_WHITESPACE"," ",544],["T_STRING","array_keys",544],"(",["T_VARIABLE","$products",544],")",")",";",["T_WHITESPACE","\n\n            ",544],["T_VARIABLE","$loadCategories",546],["T_WHITESPACE"," ",546],"=",["T_WHITESPACE"," ",546],["T_ARRAY","array",546],"(",")",";",["T_WHITESPACE","\n            ",546],["T_FOREACH","foreach",547],["T_WHITESPACE"," ",547],"(",["T_VARIABLE","$products",547],["T_WHITESPACE"," ",547],["T_AS","as",547],["T_WHITESPACE"," ",547],["T_VARIABLE","$product",547],")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n                ",547],["T_FOREACH","foreach",548],["T_WHITESPACE"," ",548],"(",["T_VARIABLE","$product",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","getCategoryIds",548],"(",")",["T_WHITESPACE"," ",548],["T_AS","as",548],["T_WHITESPACE"," ",548],["T_VARIABLE","$categoryId",548],")",["T_WHITESPACE"," ",548],"{",["T_WHITESPACE","\n                    ",548],["T_IF","if",549],["T_WHITESPACE"," ",549],"(","!",["T_ISSET","isset",549],"(",["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","_categories",549],"[",["T_VARIABLE","$categoryId",549],"]",")",")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n                        ",549],["T_VARIABLE","$loadCategories",550],"[",["T_VARIABLE","$categoryId",550],"]",["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_VARIABLE","$categoryId",550],";",["T_WHITESPACE","\n                    ",550],"}",["T_WHITESPACE","\n                ",551],"}",["T_WHITESPACE","\n            ",552],"}",["T_WHITESPACE","\n\n            ",553],["T_IF","if",555],["T_WHITESPACE"," ",555],"(",["T_VARIABLE","$loadCategories",555],")",["T_WHITESPACE"," ",555],"{",["T_WHITESPACE","\n                ",555],["T_FOREACH","foreach",556],["T_WHITESPACE"," ",556],"(",["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","getResource",556],"(",")",["T_OBJECT_OPERATOR","->",556],["T_STRING","getCategories",556],"(",["T_VARIABLE","$loadCategories",556],",",["T_WHITESPACE"," ",556],["T_VARIABLE","$storeId",556],")",["T_WHITESPACE"," ",556],["T_AS","as",556],["T_WHITESPACE"," ",556],["T_VARIABLE","$category",556],")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n                    ",556],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_categories",557],"[",["T_VARIABLE","$category",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getId",557],"(",")","]",["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_VARIABLE","$category",557],";",["T_WHITESPACE","\n                ",557],"}",["T_WHITESPACE","\n            ",558],"}",["T_WHITESPACE","\n\n            ",559],["T_FOREACH","foreach",561],["T_WHITESPACE"," ",561],"(",["T_VARIABLE","$products",561],["T_WHITESPACE"," ",561],["T_AS","as",561],["T_WHITESPACE"," ",561],["T_VARIABLE","$product",561],")",["T_WHITESPACE"," ",561],"{",["T_WHITESPACE","\n                ",561],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","_refreshProductRewrite",562],"(",["T_VARIABLE","$product",562],",",["T_WHITESPACE"," ",562],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","_categories",562],"[",["T_VARIABLE","$storeRootCategoryId",562],"]",")",";",["T_WHITESPACE","\n                ",562],["T_FOREACH","foreach",563],["T_WHITESPACE"," ",563],"(",["T_VARIABLE","$product",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","getCategoryIds",563],"(",")",["T_WHITESPACE"," ",563],["T_AS","as",563],["T_WHITESPACE"," ",563],["T_VARIABLE","$categoryId",563],")",["T_WHITESPACE"," ",563],"{",["T_WHITESPACE","\n                    ",563],["T_IF","if",564],["T_WHITESPACE"," ",564],"(",["T_VARIABLE","$categoryId",564],["T_WHITESPACE"," ",564],["T_IS_NOT_EQUAL","!=",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$storeRootCategoryId",564],["T_WHITESPACE"," ",564],["T_BOOLEAN_AND","&&",564],["T_WHITESPACE"," ",564],["T_ISSET","isset",564],"(",["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","_categories",564],"[",["T_VARIABLE","$categoryId",564],"]",")",")",["T_WHITESPACE"," ",564],"{",["T_WHITESPACE","\n                        ",564],["T_IF","if",565],["T_WHITESPACE"," ",565],"(",["T_STRING","strpos",565],"(",["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","_categories",565],"[",["T_VARIABLE","$categoryId",565],"]","[",["T_CONSTANT_ENCAPSED_STRING","'path'",565],"]",",",["T_WHITESPACE"," ",565],["T_VARIABLE","$storeRootCategoryPath",565],["T_WHITESPACE"," ",565],".",["T_WHITESPACE"," ",565],["T_CONSTANT_ENCAPSED_STRING","'\/'",565],")",["T_WHITESPACE"," ",565],["T_IS_NOT_IDENTICAL","!==",565],["T_WHITESPACE"," ",565],["T_LNUMBER","0",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n                            ",565],["T_CONTINUE","continue",566],";",["T_WHITESPACE","\n                        ",566],"}",["T_WHITESPACE","\n                        ",567],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_refreshProductRewrite",568],"(",["T_VARIABLE","$product",568],",",["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_categories",568],"[",["T_VARIABLE","$categoryId",568],"]",")",";",["T_WHITESPACE","\n                    ",568],"}",["T_WHITESPACE","\n                ",569],"}",["T_WHITESPACE","\n            ",570],"}",["T_WHITESPACE","\n\n            ",571],["T_UNSET","unset",573],"(",["T_VARIABLE","$products",573],")",";",["T_WHITESPACE","\n            ",573],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","_rewrites",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_ARRAY","array",574],"(",")",";",["T_WHITESPACE","\n        ",574],"}",["T_WHITESPACE","\n\n        ",575],["T_VARIABLE","$this",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","_categories",577],["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_ARRAY","array",577],"(",")",";",["T_WHITESPACE","\n        ",577],["T_RETURN","return",578],["T_WHITESPACE"," ",578],["T_VARIABLE","$this",578],";",["T_WHITESPACE","\n    ",578],"}",["T_WHITESPACE","\n\n    ",579],["T_DOC_COMMENT","\/**\n     * Deletes old rewrites for store, left from the times when store had some other root category\n     *\n     * @param int $storeId\n     * @return Mage_Catalog_Model_Url\n     *\/",581],["T_WHITESPACE","\n    ",586],["T_PUBLIC","public",587],["T_WHITESPACE"," ",587],["T_FUNCTION","function",587],["T_WHITESPACE"," ",587],["T_STRING","clearStoreInvalidRewrites",587],"(",["T_VARIABLE","$storeId",587],["T_WHITESPACE"," ",587],"=",["T_WHITESPACE"," ",587],["T_STRING","null",587],")",["T_WHITESPACE","\n    ",587],"{",["T_WHITESPACE","\n        ",588],["T_IF","if",589],["T_WHITESPACE"," ",589],"(",["T_STRING","is_null",589],"(",["T_VARIABLE","$storeId",589],")",")",["T_WHITESPACE"," ",589],"{",["T_WHITESPACE","\n            ",589],["T_FOREACH","foreach",590],["T_WHITESPACE"," ",590],"(",["T_VARIABLE","$this",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","getStores",590],"(",")",["T_WHITESPACE"," ",590],["T_AS","as",590],["T_WHITESPACE"," ",590],["T_VARIABLE","$store",590],")",["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n                ",590],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","clearStoreInvalidRewrites",591],"(",["T_VARIABLE","$store",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","getId",591],"(",")",")",";",["T_WHITESPACE","\n            ",591],"}",["T_WHITESPACE","\n            ",592],["T_RETURN","return",593],["T_WHITESPACE"," ",593],["T_VARIABLE","$this",593],";",["T_WHITESPACE","\n        ",593],"}",["T_WHITESPACE","\n\n        ",594],["T_VARIABLE","$this",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","getResource",596],"(",")",["T_OBJECT_OPERATOR","->",596],["T_STRING","clearStoreInvalidRewrites",596],"(",["T_VARIABLE","$storeId",596],")",";",["T_WHITESPACE","\n        ",596],["T_RETURN","return",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$this",597],";",["T_WHITESPACE","\n    ",597],"}",["T_WHITESPACE","\n\n    ",598],["T_DOC_COMMENT","\/**\n     * Get requestPath that was not used yet.\n     *\n     * Will try to get unique path by adding -1 -2 etc. between url_key and optional url_suffix\n     *\n     * @param int $storeId\n     * @param string $requestPath\n     * @param string $idPath\n     * @return string\n     *\/",600],["T_WHITESPACE","\n    ",609],["T_PUBLIC","public",610],["T_WHITESPACE"," ",610],["T_FUNCTION","function",610],["T_WHITESPACE"," ",610],["T_STRING","getUnusedPath",610],"(",["T_VARIABLE","$storeId",610],",",["T_WHITESPACE"," ",610],["T_VARIABLE","$requestPath",610],",",["T_WHITESPACE"," ",610],["T_VARIABLE","$idPath",610],")",["T_WHITESPACE","\n    ",610],"{",["T_WHITESPACE","\n        ",611],["T_IF","if",612],["T_WHITESPACE"," ",612],"(",["T_STRING","strpos",612],"(",["T_VARIABLE","$idPath",612],",",["T_WHITESPACE"," ",612],["T_CONSTANT_ENCAPSED_STRING","'product'",612],")",["T_WHITESPACE"," ",612],["T_IS_NOT_IDENTICAL","!==",612],["T_WHITESPACE"," ",612],["T_STRING","false",612],")",["T_WHITESPACE"," ",612],"{",["T_WHITESPACE","\n            ",612],["T_VARIABLE","$suffix",613],["T_WHITESPACE"," ",613],"=",["T_WHITESPACE"," ",613],["T_VARIABLE","$this",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","getProductUrlSuffix",613],"(",["T_VARIABLE","$storeId",613],")",";",["T_WHITESPACE","\n        ",613],"}",["T_WHITESPACE"," ",614],["T_ELSE","else",614],["T_WHITESPACE"," ",614],"{",["T_WHITESPACE","\n            ",614],["T_VARIABLE","$suffix",615],["T_WHITESPACE"," ",615],"=",["T_WHITESPACE"," ",615],["T_VARIABLE","$this",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","getCategoryUrlSuffix",615],"(",["T_VARIABLE","$storeId",615],")",";",["T_WHITESPACE","\n        ",615],"}",["T_WHITESPACE","\n        ",616],["T_IF","if",617],["T_WHITESPACE"," ",617],"(",["T_EMPTY","empty",617],"(",["T_VARIABLE","$requestPath",617],")",")",["T_WHITESPACE"," ",617],"{",["T_WHITESPACE","\n            ",617],["T_VARIABLE","$requestPath",618],["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_CONSTANT_ENCAPSED_STRING","'-'",618],";",["T_WHITESPACE","\n        ",618],"}",["T_WHITESPACE"," ",619],["T_ELSEIF","elseif",619],["T_WHITESPACE"," ",619],"(",["T_VARIABLE","$requestPath",619],["T_WHITESPACE"," ",619],["T_IS_EQUAL","==",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$suffix",619],")",["T_WHITESPACE"," ",619],"{",["T_WHITESPACE","\n            ",619],["T_VARIABLE","$requestPath",620],["T_WHITESPACE"," ",620],"=",["T_WHITESPACE"," ",620],["T_CONSTANT_ENCAPSED_STRING","'-'",620],["T_WHITESPACE"," ",620],".",["T_WHITESPACE"," ",620],["T_VARIABLE","$suffix",620],";",["T_WHITESPACE","\n        ",620],"}",["T_WHITESPACE","\n\n        ",621],["T_DOC_COMMENT","\/**\n         * Validate maximum length of request path\n         *\/",623],["T_WHITESPACE","\n        ",625],["T_IF","if",626],["T_WHITESPACE"," ",626],"(",["T_STRING","strlen",626],"(",["T_VARIABLE","$requestPath",626],")",["T_WHITESPACE"," ",626],">",["T_WHITESPACE"," ",626],["T_STRING","self",626],["T_DOUBLE_COLON","::",626],["T_STRING","MAX_REQUEST_PATH_LENGTH",626],["T_WHITESPACE"," ",626],"+",["T_WHITESPACE"," ",626],["T_STRING","self",626],["T_DOUBLE_COLON","::",626],["T_STRING","ALLOWED_REQUEST_PATH_OVERFLOW",626],")",["T_WHITESPACE"," ",626],"{",["T_WHITESPACE","\n            ",626],["T_VARIABLE","$requestPath",627],["T_WHITESPACE"," ",627],"=",["T_WHITESPACE"," ",627],["T_STRING","substr",627],"(",["T_VARIABLE","$requestPath",627],",",["T_WHITESPACE"," ",627],["T_LNUMBER","0",627],",",["T_WHITESPACE"," ",627],["T_STRING","self",627],["T_DOUBLE_COLON","::",627],["T_STRING","MAX_REQUEST_PATH_LENGTH",627],")",";",["T_WHITESPACE","\n        ",627],"}",["T_WHITESPACE","\n\n        ",628],["T_IF","if",630],["T_WHITESPACE"," ",630],"(",["T_ISSET","isset",630],"(",["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","_rewrites",630],"[",["T_VARIABLE","$idPath",630],"]",")",")",["T_WHITESPACE"," ",630],"{",["T_WHITESPACE","\n            ",630],["T_VARIABLE","$this",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","_rewrite",631],["T_WHITESPACE"," ",631],"=",["T_WHITESPACE"," ",631],["T_VARIABLE","$this",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","_rewrites",631],"[",["T_VARIABLE","$idPath",631],"]",";",["T_WHITESPACE","\n            ",631],["T_IF","if",632],["T_WHITESPACE"," ",632],"(",["T_VARIABLE","$this",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","_rewrites",632],"[",["T_VARIABLE","$idPath",632],"]",["T_OBJECT_OPERATOR","->",632],["T_STRING","getRequestPath",632],"(",")",["T_WHITESPACE"," ",632],["T_IS_EQUAL","==",632],["T_WHITESPACE"," ",632],["T_VARIABLE","$requestPath",632],")",["T_WHITESPACE"," ",632],"{",["T_WHITESPACE","\n                ",632],["T_RETURN","return",633],["T_WHITESPACE"," ",633],["T_VARIABLE","$requestPath",633],";",["T_WHITESPACE","\n            ",633],"}",["T_WHITESPACE","\n        ",634],"}",["T_WHITESPACE","\n        ",635],["T_ELSE","else",636],["T_WHITESPACE"," ",636],"{",["T_WHITESPACE","\n            ",636],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_rewrite",637],["T_WHITESPACE"," ",637],"=",["T_WHITESPACE"," ",637],["T_STRING","null",637],";",["T_WHITESPACE","\n        ",637],"}",["T_WHITESPACE","\n\n        ",638],["T_VARIABLE","$rewrite",640],["T_WHITESPACE"," ",640],"=",["T_WHITESPACE"," ",640],["T_VARIABLE","$this",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","getResource",640],"(",")",["T_OBJECT_OPERATOR","->",640],["T_STRING","getRewriteByRequestPath",640],"(",["T_VARIABLE","$requestPath",640],",",["T_WHITESPACE"," ",640],["T_VARIABLE","$storeId",640],")",";",["T_WHITESPACE","\n        ",640],["T_IF","if",641],["T_WHITESPACE"," ",641],"(",["T_VARIABLE","$rewrite",641],["T_WHITESPACE"," ",641],["T_BOOLEAN_AND","&&",641],["T_WHITESPACE"," ",641],["T_VARIABLE","$rewrite",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","getId",641],"(",")",")",["T_WHITESPACE"," ",641],"{",["T_WHITESPACE","\n            ",641],["T_IF","if",642],["T_WHITESPACE"," ",642],"(",["T_VARIABLE","$rewrite",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","getIdPath",642],"(",")",["T_WHITESPACE"," ",642],["T_IS_EQUAL","==",642],["T_WHITESPACE"," ",642],["T_VARIABLE","$idPath",642],")",["T_WHITESPACE"," ",642],"{",["T_WHITESPACE","\n                ",642],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","_rewrite",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_VARIABLE","$rewrite",643],";",["T_WHITESPACE","\n                ",643],["T_RETURN","return",644],["T_WHITESPACE"," ",644],["T_VARIABLE","$requestPath",644],";",["T_WHITESPACE","\n            ",644],"}",["T_WHITESPACE","\n            ",645],["T_COMMENT","\/\/ match request_url abcdef1234(-12)(.html) pattern\n",646],["T_WHITESPACE","            ",647],["T_VARIABLE","$match",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_ARRAY","array",647],"(",")",";",["T_WHITESPACE","\n            ",647],["T_VARIABLE","$regularExpression",648],["T_WHITESPACE"," ",648],"=",["T_WHITESPACE"," ",648],["T_CONSTANT_ENCAPSED_STRING","'#^([0-9a-z\/-]+?)(-([0-9]+))?('",648],".",["T_STRING","preg_quote",648],"(",["T_VARIABLE","$suffix",648],")",".",["T_CONSTANT_ENCAPSED_STRING","')?$#i'",648],";",["T_WHITESPACE","\n            ",648],["T_IF","if",649],["T_WHITESPACE"," ",649],"(","!",["T_STRING","preg_match",649],"(",["T_VARIABLE","$regularExpression",649],",",["T_WHITESPACE"," ",649],["T_VARIABLE","$requestPath",649],",",["T_WHITESPACE"," ",649],["T_VARIABLE","$match",649],")",")",["T_WHITESPACE"," ",649],"{",["T_WHITESPACE","\n                ",649],["T_RETURN","return",650],["T_WHITESPACE"," ",650],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getUnusedPath",650],"(",["T_VARIABLE","$storeId",650],",",["T_WHITESPACE"," ",650],["T_CONSTANT_ENCAPSED_STRING","'-'",650],",",["T_WHITESPACE"," ",650],["T_VARIABLE","$idPath",650],")",";",["T_WHITESPACE","\n            ",650],"}",["T_WHITESPACE","\n            ",651],["T_VARIABLE","$match",652],"[",["T_LNUMBER","1",652],"]",["T_WHITESPACE"," ",652],"=",["T_WHITESPACE"," ",652],["T_VARIABLE","$match",652],"[",["T_LNUMBER","1",652],"]",["T_WHITESPACE"," ",652],".",["T_WHITESPACE"," ",652],["T_CONSTANT_ENCAPSED_STRING","'-'",652],";",["T_WHITESPACE","\n            ",652],["T_VARIABLE","$match",653],"[",["T_LNUMBER","4",653],"]",["T_WHITESPACE"," ",653],"=",["T_WHITESPACE"," ",653],["T_ISSET","isset",653],"(",["T_VARIABLE","$match",653],"[",["T_LNUMBER","4",653],"]",")",["T_WHITESPACE"," ",653],"?",["T_WHITESPACE"," ",653],["T_VARIABLE","$match",653],"[",["T_LNUMBER","4",653],"]",["T_WHITESPACE"," ",653],":",["T_WHITESPACE"," ",653],["T_CONSTANT_ENCAPSED_STRING","''",653],";",["T_WHITESPACE","\n\n            ",653],["T_VARIABLE","$lastRequestPath",655],["T_WHITESPACE"," ",655],"=",["T_WHITESPACE"," ",655],["T_VARIABLE","$this",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","getResource",655],"(",")",["T_WHITESPACE","\n                ",655],["T_OBJECT_OPERATOR","->",656],["T_STRING","getLastUsedRewriteRequestIncrement",656],"(",["T_VARIABLE","$match",656],"[",["T_LNUMBER","1",656],"]",",",["T_WHITESPACE"," ",656],["T_VARIABLE","$match",656],"[",["T_LNUMBER","4",656],"]",",",["T_WHITESPACE"," ",656],["T_VARIABLE","$storeId",656],")",";",["T_WHITESPACE","\n            ",656],["T_IF","if",657],["T_WHITESPACE"," ",657],"(",["T_VARIABLE","$lastRequestPath",657],")",["T_WHITESPACE"," ",657],"{",["T_WHITESPACE","\n                ",657],["T_VARIABLE","$match",658],"[",["T_LNUMBER","3",658],"]",["T_WHITESPACE"," ",658],"=",["T_WHITESPACE"," ",658],["T_VARIABLE","$lastRequestPath",658],";",["T_WHITESPACE","\n            ",658],"}",["T_WHITESPACE","\n            ",659],["T_RETURN","return",660],["T_WHITESPACE"," ",660],["T_VARIABLE","$match",660],"[",["T_LNUMBER","1",660],"]",["T_WHITESPACE","\n                ",660],".",["T_WHITESPACE"," ",661],"(",["T_ISSET","isset",661],"(",["T_VARIABLE","$match",661],"[",["T_LNUMBER","3",661],"]",")",["T_WHITESPACE"," ",661],"?",["T_WHITESPACE"," ",661],"(",["T_VARIABLE","$match",661],"[",["T_LNUMBER","3",661],"]","+",["T_LNUMBER","1",661],")",["T_WHITESPACE"," ",661],":",["T_WHITESPACE"," ",661],["T_CONSTANT_ENCAPSED_STRING","'1'",661],")",["T_WHITESPACE","\n                ",661],".",["T_WHITESPACE"," ",662],["T_VARIABLE","$match",662],"[",["T_LNUMBER","4",662],"]",";",["T_WHITESPACE","\n        ",662],"}",["T_WHITESPACE","\n        ",663],["T_ELSE","else",664],["T_WHITESPACE"," ",664],"{",["T_WHITESPACE","\n            ",664],["T_RETURN","return",665],["T_WHITESPACE"," ",665],["T_VARIABLE","$requestPath",665],";",["T_WHITESPACE","\n        ",665],"}",["T_WHITESPACE","\n    ",666],"}",["T_WHITESPACE","\n\n    ",667],["T_DOC_COMMENT","\/**\n     * Retrieve product rewrite sufix for store\n     *\n     * @param int $storeId\n     * @return string\n     *\/",669],["T_WHITESPACE","\n    ",674],["T_PUBLIC","public",675],["T_WHITESPACE"," ",675],["T_FUNCTION","function",675],["T_WHITESPACE"," ",675],["T_STRING","getProductUrlSuffix",675],"(",["T_VARIABLE","$storeId",675],")",["T_WHITESPACE","\n    ",675],"{",["T_WHITESPACE","\n        ",676],["T_RETURN","return",677],["T_WHITESPACE"," ",677],["T_STRING","Mage",677],["T_DOUBLE_COLON","::",677],["T_STRING","helper",677],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",677],")",["T_OBJECT_OPERATOR","->",677],["T_STRING","getProductUrlSuffix",677],"(",["T_VARIABLE","$storeId",677],")",";",["T_WHITESPACE","\n    ",677],"}",["T_WHITESPACE","\n\n    ",678],["T_DOC_COMMENT","\/**\n     * Retrieve category rewrite sufix for store\n     *\n     * @param int $storeId\n     * @return string\n     *\/",680],["T_WHITESPACE","\n    ",685],["T_PUBLIC","public",686],["T_WHITESPACE"," ",686],["T_FUNCTION","function",686],["T_WHITESPACE"," ",686],["T_STRING","getCategoryUrlSuffix",686],"(",["T_VARIABLE","$storeId",686],")",["T_WHITESPACE","\n    ",686],"{",["T_WHITESPACE","\n        ",687],["T_RETURN","return",688],["T_WHITESPACE"," ",688],["T_STRING","Mage",688],["T_DOUBLE_COLON","::",688],["T_STRING","helper",688],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",688],")",["T_OBJECT_OPERATOR","->",688],["T_STRING","getCategoryUrlSuffix",688],"(",["T_VARIABLE","$storeId",688],")",";",["T_WHITESPACE","\n    ",688],"}",["T_WHITESPACE","\n\n    ",689],["T_DOC_COMMENT","\/**\n     * Get unique category request path\n     *\n     * @param Varien_Object $category\n     * @param string $parentPath\n     * @return string\n     *\/",691],["T_WHITESPACE","\n    ",697],["T_PUBLIC","public",698],["T_WHITESPACE"," ",698],["T_FUNCTION","function",698],["T_WHITESPACE"," ",698],["T_STRING","getCategoryRequestPath",698],"(",["T_VARIABLE","$category",698],",",["T_WHITESPACE"," ",698],["T_VARIABLE","$parentPath",698],")",["T_WHITESPACE","\n    ",698],"{",["T_WHITESPACE","\n        ",699],["T_VARIABLE","$storeId",700],["T_WHITESPACE"," ",700],"=",["T_WHITESPACE"," ",700],["T_VARIABLE","$category",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","getStoreId",700],"(",")",";",["T_WHITESPACE","\n        ",700],["T_VARIABLE","$idPath",701],["T_WHITESPACE","  ",701],"=",["T_WHITESPACE"," ",701],["T_VARIABLE","$this",701],["T_OBJECT_OPERATOR","->",701],["T_STRING","generatePath",701],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",701],",",["T_WHITESPACE"," ",701],["T_STRING","null",701],",",["T_WHITESPACE"," ",701],["T_VARIABLE","$category",701],")",";",["T_WHITESPACE","\n        ",701],["T_VARIABLE","$suffix",702],["T_WHITESPACE","  ",702],"=",["T_WHITESPACE"," ",702],["T_VARIABLE","$this",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","getCategoryUrlSuffix",702],"(",["T_VARIABLE","$storeId",702],")",";",["T_WHITESPACE","\n\n        ",702],["T_IF","if",704],["T_WHITESPACE"," ",704],"(",["T_ISSET","isset",704],"(",["T_VARIABLE","$this",704],["T_OBJECT_OPERATOR","->",704],["T_STRING","_rewrites",704],"[",["T_VARIABLE","$idPath",704],"]",")",")",["T_WHITESPACE"," ",704],"{",["T_WHITESPACE","\n            ",704],["T_VARIABLE","$this",705],["T_OBJECT_OPERATOR","->",705],["T_STRING","_rewrite",705],["T_WHITESPACE"," ",705],"=",["T_WHITESPACE"," ",705],["T_VARIABLE","$this",705],["T_OBJECT_OPERATOR","->",705],["T_STRING","_rewrites",705],"[",["T_VARIABLE","$idPath",705],"]",";",["T_WHITESPACE","\n            ",705],["T_VARIABLE","$existingRequestPath",706],["T_WHITESPACE"," ",706],"=",["T_WHITESPACE"," ",706],["T_VARIABLE","$this",706],["T_OBJECT_OPERATOR","->",706],["T_STRING","_rewrites",706],"[",["T_VARIABLE","$idPath",706],"]",["T_OBJECT_OPERATOR","->",706],["T_STRING","getRequestPath",706],"(",")",";",["T_WHITESPACE","\n        ",706],"}",["T_WHITESPACE","\n\n        ",707],["T_IF","if",709],["T_WHITESPACE"," ",709],"(",["T_VARIABLE","$category",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","getUrlKey",709],"(",")",["T_WHITESPACE"," ",709],["T_IS_EQUAL","==",709],["T_WHITESPACE"," ",709],["T_CONSTANT_ENCAPSED_STRING","''",709],")",["T_WHITESPACE"," ",709],"{",["T_WHITESPACE","\n            ",709],["T_VARIABLE","$urlKey",710],["T_WHITESPACE"," ",710],"=",["T_WHITESPACE"," ",710],["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","getCategoryModel",710],"(",")",["T_OBJECT_OPERATOR","->",710],["T_STRING","formatUrlKey",710],"(",["T_VARIABLE","$category",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","getName",710],"(",")",")",";",["T_WHITESPACE","\n        ",710],"}",["T_WHITESPACE","\n        ",711],["T_ELSE","else",712],["T_WHITESPACE"," ",712],"{",["T_WHITESPACE","\n            ",712],["T_VARIABLE","$urlKey",713],["T_WHITESPACE"," ",713],"=",["T_WHITESPACE"," ",713],["T_VARIABLE","$this",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","getCategoryModel",713],"(",")",["T_OBJECT_OPERATOR","->",713],["T_STRING","formatUrlKey",713],"(",["T_VARIABLE","$category",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","getUrlKey",713],"(",")",")",";",["T_WHITESPACE","\n        ",713],"}",["T_WHITESPACE","\n\n        ",714],["T_VARIABLE","$categoryUrlSuffix",716],["T_WHITESPACE"," ",716],"=",["T_WHITESPACE"," ",716],["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","getCategoryUrlSuffix",716],"(",["T_VARIABLE","$category",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","getStoreId",716],"(",")",")",";",["T_WHITESPACE","\n        ",716],["T_IF","if",717],["T_WHITESPACE"," ",717],"(",["T_STRING","null",717],["T_WHITESPACE"," ",717],["T_IS_IDENTICAL","===",717],["T_WHITESPACE"," ",717],["T_VARIABLE","$parentPath",717],")",["T_WHITESPACE"," ",717],"{",["T_WHITESPACE","\n            ",717],["T_VARIABLE","$parentPath",718],["T_WHITESPACE"," ",718],"=",["T_WHITESPACE"," ",718],["T_VARIABLE","$this",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getResource",718],"(",")",["T_OBJECT_OPERATOR","->",718],["T_STRING","getCategoryParentPath",718],"(",["T_VARIABLE","$category",718],")",";",["T_WHITESPACE","\n        ",718],"}",["T_WHITESPACE","\n        ",719],["T_ELSEIF","elseif",720],["T_WHITESPACE"," ",720],"(",["T_VARIABLE","$parentPath",720],["T_WHITESPACE"," ",720],["T_IS_EQUAL","==",720],["T_WHITESPACE"," ",720],["T_CONSTANT_ENCAPSED_STRING","'\/'",720],")",["T_WHITESPACE"," ",720],"{",["T_WHITESPACE","\n            ",720],["T_VARIABLE","$parentPath",721],["T_WHITESPACE"," ",721],"=",["T_WHITESPACE"," ",721],["T_CONSTANT_ENCAPSED_STRING","''",721],";",["T_WHITESPACE","\n        ",721],"}",["T_WHITESPACE","\n        ",722],["T_VARIABLE","$parentPath",723],["T_WHITESPACE"," ",723],"=",["T_WHITESPACE"," ",723],["T_STRING","Mage",723],["T_DOUBLE_COLON","::",723],["T_STRING","helper",723],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",723],")",["T_OBJECT_OPERATOR","->",723],["T_STRING","getCategoryUrlPath",723],"(",["T_VARIABLE","$parentPath",723],",",["T_WHITESPACE","\n                                                                           ",723],["T_STRING","true",724],",",["T_WHITESPACE"," ",724],["T_VARIABLE","$category",724],["T_OBJECT_OPERATOR","->",724],["T_STRING","getStoreId",724],"(",")",")",";",["T_WHITESPACE","\n\n        ",724],["T_VARIABLE","$requestPath",726],["T_WHITESPACE"," ",726],"=",["T_WHITESPACE"," ",726],["T_VARIABLE","$parentPath",726],["T_WHITESPACE"," ",726],".",["T_WHITESPACE"," ",726],["T_VARIABLE","$urlKey",726],["T_WHITESPACE"," ",726],".",["T_WHITESPACE"," ",726],["T_VARIABLE","$categoryUrlSuffix",726],";",["T_WHITESPACE","\n        ",726],["T_IF","if",727],["T_WHITESPACE"," ",727],"(",["T_ISSET","isset",727],"(",["T_VARIABLE","$existingRequestPath",727],")",["T_WHITESPACE"," ",727],["T_BOOLEAN_AND","&&",727],["T_WHITESPACE"," ",727],["T_VARIABLE","$existingRequestPath",727],["T_WHITESPACE"," ",727],["T_IS_EQUAL","==",727],["T_WHITESPACE"," ",727],["T_VARIABLE","$requestPath",727],["T_WHITESPACE"," ",727],".",["T_WHITESPACE"," ",727],["T_VARIABLE","$suffix",727],")",["T_WHITESPACE"," ",727],"{",["T_WHITESPACE","\n            ",727],["T_RETURN","return",728],["T_WHITESPACE"," ",728],["T_VARIABLE","$existingRequestPath",728],";",["T_WHITESPACE","\n        ",728],"}",["T_WHITESPACE","\n\n        ",729],["T_IF","if",731],["T_WHITESPACE"," ",731],"(",["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","_deleteOldTargetPath",731],"(",["T_VARIABLE","$requestPath",731],",",["T_WHITESPACE"," ",731],["T_VARIABLE","$idPath",731],",",["T_WHITESPACE"," ",731],["T_VARIABLE","$storeId",731],")",")",["T_WHITESPACE"," ",731],"{",["T_WHITESPACE","\n            ",731],["T_RETURN","return",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$requestPath",732],";",["T_WHITESPACE","\n        ",732],"}",["T_WHITESPACE","\n\n        ",733],["T_RETURN","return",735],["T_WHITESPACE"," ",735],["T_VARIABLE","$this",735],["T_OBJECT_OPERATOR","->",735],["T_STRING","getUnusedPath",735],"(",["T_VARIABLE","$category",735],["T_OBJECT_OPERATOR","->",735],["T_STRING","getStoreId",735],"(",")",",",["T_WHITESPACE"," ",735],["T_VARIABLE","$requestPath",735],",",["T_WHITESPACE","\n                                    ",735],["T_VARIABLE","$this",736],["T_OBJECT_OPERATOR","->",736],["T_STRING","generatePath",736],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",736],",",["T_WHITESPACE"," ",736],["T_STRING","null",736],",",["T_WHITESPACE"," ",736],["T_VARIABLE","$category",736],")",["T_WHITESPACE","\n        ",736],")",";",["T_WHITESPACE","\n    ",737],"}",["T_WHITESPACE","\n\n    ",738],["T_DOC_COMMENT","\/**\n     * Check if current generated request path is one of the old paths\n     *\n     * @param string $requestPath\n     * @param string $idPath\n     * @param int $storeId\n     * @return bool\n     *\/",740],["T_WHITESPACE","\n    ",747],["T_PROTECTED","protected",748],["T_WHITESPACE"," ",748],["T_FUNCTION","function",748],["T_WHITESPACE"," ",748],["T_STRING","_deleteOldTargetPath",748],"(",["T_VARIABLE","$requestPath",748],",",["T_WHITESPACE"," ",748],["T_VARIABLE","$idPath",748],",",["T_WHITESPACE"," ",748],["T_VARIABLE","$storeId",748],")",["T_WHITESPACE","\n    ",748],"{",["T_WHITESPACE","\n        ",749],["T_VARIABLE","$finalOldTargetPath",750],["T_WHITESPACE"," ",750],"=",["T_WHITESPACE"," ",750],["T_VARIABLE","$this",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","getResource",750],"(",")",["T_OBJECT_OPERATOR","->",750],["T_STRING","findFinalTargetPath",750],"(",["T_VARIABLE","$requestPath",750],",",["T_WHITESPACE"," ",750],["T_VARIABLE","$storeId",750],")",";",["T_WHITESPACE","\n        ",750],["T_IF","if",751],["T_WHITESPACE"," ",751],"(",["T_VARIABLE","$finalOldTargetPath",751],["T_WHITESPACE"," ",751],["T_BOOLEAN_AND","&&",751],["T_WHITESPACE"," ",751],["T_VARIABLE","$finalOldTargetPath",751],["T_WHITESPACE"," ",751],["T_IS_EQUAL","==",751],["T_WHITESPACE"," ",751],["T_VARIABLE","$idPath",751],")",["T_WHITESPACE"," ",751],"{",["T_WHITESPACE","\n            ",751],["T_VARIABLE","$this",752],["T_OBJECT_OPERATOR","->",752],["T_STRING","getResource",752],"(",")",["T_OBJECT_OPERATOR","->",752],["T_STRING","deleteRewriteRecord",752],"(",["T_VARIABLE","$requestPath",752],",",["T_WHITESPACE"," ",752],["T_VARIABLE","$storeId",752],",",["T_WHITESPACE"," ",752],["T_STRING","true",752],")",";",["T_WHITESPACE","\n            ",752],["T_RETURN","return",753],["T_WHITESPACE"," ",753],["T_STRING","true",753],";",["T_WHITESPACE","\n        ",753],"}",["T_WHITESPACE","\n\n        ",754],["T_RETURN","return",756],["T_WHITESPACE"," ",756],["T_STRING","false",756],";",["T_WHITESPACE","\n    ",756],"}",["T_WHITESPACE","\n\n    ",757],["T_DOC_COMMENT","\/**\n     * Get unique product request path\n     *\n     * @param   Varien_Object $product\n     * @param   Varien_Object $category\n     * @return  string\n     *\/",759],["T_WHITESPACE","\n    ",765],["T_PUBLIC","public",766],["T_WHITESPACE"," ",766],["T_FUNCTION","function",766],["T_WHITESPACE"," ",766],["T_STRING","getProductRequestPath",766],"(",["T_VARIABLE","$product",766],",",["T_WHITESPACE"," ",766],["T_VARIABLE","$category",766],")",["T_WHITESPACE","\n    ",766],"{",["T_WHITESPACE","\n        ",767],["T_IF","if",768],["T_WHITESPACE"," ",768],"(",["T_VARIABLE","$product",768],["T_OBJECT_OPERATOR","->",768],["T_STRING","getUrlKey",768],"(",")",["T_WHITESPACE"," ",768],["T_IS_EQUAL","==",768],["T_WHITESPACE"," ",768],["T_CONSTANT_ENCAPSED_STRING","''",768],")",["T_WHITESPACE"," ",768],"{",["T_WHITESPACE","\n            ",768],["T_VARIABLE","$urlKey",769],["T_WHITESPACE"," ",769],"=",["T_WHITESPACE"," ",769],["T_VARIABLE","$this",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","getProductModel",769],"(",")",["T_OBJECT_OPERATOR","->",769],["T_STRING","formatUrlKey",769],"(",["T_VARIABLE","$product",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","getName",769],"(",")",")",";",["T_WHITESPACE","\n        ",769],"}",["T_WHITESPACE"," ",770],["T_ELSE","else",770],["T_WHITESPACE"," ",770],"{",["T_WHITESPACE","\n            ",770],["T_VARIABLE","$urlKey",771],["T_WHITESPACE"," ",771],"=",["T_WHITESPACE"," ",771],["T_VARIABLE","$this",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getProductModel",771],"(",")",["T_OBJECT_OPERATOR","->",771],["T_STRING","formatUrlKey",771],"(",["T_VARIABLE","$product",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getUrlKey",771],"(",")",")",";",["T_WHITESPACE","\n        ",771],"}",["T_WHITESPACE","\n        ",772],["T_VARIABLE","$storeId",773],["T_WHITESPACE"," ",773],"=",["T_WHITESPACE"," ",773],["T_VARIABLE","$category",773],["T_OBJECT_OPERATOR","->",773],["T_STRING","getStoreId",773],"(",")",";",["T_WHITESPACE","\n        ",773],["T_VARIABLE","$suffix",774],["T_WHITESPACE","  ",774],"=",["T_WHITESPACE"," ",774],["T_VARIABLE","$this",774],["T_OBJECT_OPERATOR","->",774],["T_STRING","getProductUrlSuffix",774],"(",["T_VARIABLE","$storeId",774],")",";",["T_WHITESPACE","\n        ",774],["T_VARIABLE","$idPath",775],["T_WHITESPACE","  ",775],"=",["T_WHITESPACE"," ",775],["T_VARIABLE","$this",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","generatePath",775],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",775],",",["T_WHITESPACE"," ",775],["T_VARIABLE","$product",775],",",["T_WHITESPACE"," ",775],["T_VARIABLE","$category",775],")",";",["T_WHITESPACE","\n        ",775],["T_DOC_COMMENT","\/**\n         * Prepare product base request path\n         *\/",776],["T_WHITESPACE","\n        ",778],["T_IF","if",779],["T_WHITESPACE"," ",779],"(",["T_VARIABLE","$category",779],["T_OBJECT_OPERATOR","->",779],["T_STRING","getLevel",779],"(",")",["T_WHITESPACE"," ",779],">",["T_WHITESPACE"," ",779],["T_LNUMBER","1",779],")",["T_WHITESPACE"," ",779],"{",["T_WHITESPACE","\n            ",779],["T_COMMENT","\/\/ To ensure, that category has path either from attribute or generated now\n",780],["T_WHITESPACE","            ",781],["T_VARIABLE","$this",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","_addCategoryUrlPath",781],"(",["T_VARIABLE","$category",781],")",";",["T_WHITESPACE","\n            ",781],["T_VARIABLE","$categoryUrl",782],["T_WHITESPACE"," ",782],"=",["T_WHITESPACE"," ",782],["T_STRING","Mage",782],["T_DOUBLE_COLON","::",782],["T_STRING","helper",782],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",782],")",["T_OBJECT_OPERATOR","->",782],["T_STRING","getCategoryUrlPath",782],"(",["T_VARIABLE","$category",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","getUrlPath",782],"(",")",",",["T_WHITESPACE","\n                ",782],["T_STRING","false",783],",",["T_WHITESPACE"," ",783],["T_VARIABLE","$storeId",783],")",";",["T_WHITESPACE","\n            ",783],["T_VARIABLE","$requestPath",784],["T_WHITESPACE"," ",784],"=",["T_WHITESPACE"," ",784],["T_VARIABLE","$categoryUrl",784],["T_WHITESPACE"," ",784],".",["T_WHITESPACE"," ",784],["T_CONSTANT_ENCAPSED_STRING","'\/'",784],["T_WHITESPACE"," ",784],".",["T_WHITESPACE"," ",784],["T_VARIABLE","$urlKey",784],";",["T_WHITESPACE","\n        ",784],"}",["T_WHITESPACE"," ",785],["T_ELSE","else",785],["T_WHITESPACE"," ",785],"{",["T_WHITESPACE","\n            ",785],["T_VARIABLE","$requestPath",786],["T_WHITESPACE"," ",786],"=",["T_WHITESPACE"," ",786],["T_VARIABLE","$urlKey",786],";",["T_WHITESPACE","\n        ",786],"}",["T_WHITESPACE","\n\n        ",787],["T_IF","if",789],["T_WHITESPACE"," ",789],"(",["T_STRING","strlen",789],"(",["T_VARIABLE","$requestPath",789],")",["T_WHITESPACE"," ",789],">",["T_WHITESPACE"," ",789],["T_STRING","self",789],["T_DOUBLE_COLON","::",789],["T_STRING","MAX_REQUEST_PATH_LENGTH",789],["T_WHITESPACE"," ",789],"+",["T_WHITESPACE"," ",789],["T_STRING","self",789],["T_DOUBLE_COLON","::",789],["T_STRING","ALLOWED_REQUEST_PATH_OVERFLOW",789],")",["T_WHITESPACE"," ",789],"{",["T_WHITESPACE","\n            ",789],["T_VARIABLE","$requestPath",790],["T_WHITESPACE"," ",790],"=",["T_WHITESPACE"," ",790],["T_STRING","substr",790],"(",["T_VARIABLE","$requestPath",790],",",["T_WHITESPACE"," ",790],["T_LNUMBER","0",790],",",["T_WHITESPACE"," ",790],["T_STRING","self",790],["T_DOUBLE_COLON","::",790],["T_STRING","MAX_REQUEST_PATH_LENGTH",790],")",";",["T_WHITESPACE","\n        ",790],"}",["T_WHITESPACE","\n\n        ",791],["T_VARIABLE","$this",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","_rewrite",793],["T_WHITESPACE"," ",793],"=",["T_WHITESPACE"," ",793],["T_STRING","null",793],";",["T_WHITESPACE","\n        ",793],["T_DOC_COMMENT","\/**\n         * Check $requestPath should be unique\n         *\/",794],["T_WHITESPACE","\n        ",796],["T_IF","if",797],["T_WHITESPACE"," ",797],"(",["T_ISSET","isset",797],"(",["T_VARIABLE","$this",797],["T_OBJECT_OPERATOR","->",797],["T_STRING","_rewrites",797],"[",["T_VARIABLE","$idPath",797],"]",")",")",["T_WHITESPACE"," ",797],"{",["T_WHITESPACE","\n            ",797],["T_VARIABLE","$this",798],["T_OBJECT_OPERATOR","->",798],["T_STRING","_rewrite",798],["T_WHITESPACE"," ",798],"=",["T_WHITESPACE"," ",798],["T_VARIABLE","$this",798],["T_OBJECT_OPERATOR","->",798],["T_STRING","_rewrites",798],"[",["T_VARIABLE","$idPath",798],"]",";",["T_WHITESPACE","\n            ",798],["T_VARIABLE","$existingRequestPath",799],["T_WHITESPACE"," ",799],"=",["T_WHITESPACE"," ",799],["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","_rewrites",799],"[",["T_VARIABLE","$idPath",799],"]",["T_OBJECT_OPERATOR","->",799],["T_STRING","getRequestPath",799],"(",")",";",["T_WHITESPACE","\n\n            ",799],["T_IF","if",801],["T_WHITESPACE"," ",801],"(",["T_VARIABLE","$existingRequestPath",801],["T_WHITESPACE"," ",801],["T_IS_EQUAL","==",801],["T_WHITESPACE"," ",801],["T_VARIABLE","$requestPath",801],["T_WHITESPACE"," ",801],".",["T_WHITESPACE"," ",801],["T_VARIABLE","$suffix",801],")",["T_WHITESPACE"," ",801],"{",["T_WHITESPACE","\n                ",801],["T_RETURN","return",802],["T_WHITESPACE"," ",802],["T_VARIABLE","$existingRequestPath",802],";",["T_WHITESPACE","\n            ",802],"}",["T_WHITESPACE","\n\n            ",803],["T_VARIABLE","$existingRequestPath",805],["T_WHITESPACE"," ",805],"=",["T_WHITESPACE"," ",805],["T_STRING","preg_replace",805],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",805],["T_WHITESPACE"," ",805],".",["T_WHITESPACE"," ",805],["T_STRING","preg_quote",805],"(",["T_VARIABLE","$suffix",805],",",["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","'\/'",805],")",["T_WHITESPACE"," ",805],".",["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","'$\/'",805],",",["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","''",805],",",["T_WHITESPACE"," ",805],["T_VARIABLE","$existingRequestPath",805],")",";",["T_WHITESPACE","\n            ",805],["T_DOC_COMMENT","\/**\n             * Check if existing request past can be used\n             *\/",806],["T_WHITESPACE","\n            ",808],["T_IF","if",809],["T_WHITESPACE"," ",809],"(",["T_VARIABLE","$product",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getUrlKey",809],"(",")",["T_WHITESPACE"," ",809],["T_IS_EQUAL","==",809],["T_WHITESPACE"," ",809],["T_CONSTANT_ENCAPSED_STRING","''",809],["T_WHITESPACE"," ",809],["T_BOOLEAN_AND","&&",809],["T_WHITESPACE"," ",809],"!",["T_EMPTY","empty",809],"(",["T_VARIABLE","$requestPath",809],")",["T_WHITESPACE","\n                ",809],["T_BOOLEAN_AND","&&",810],["T_WHITESPACE"," ",810],["T_STRING","strpos",810],"(",["T_VARIABLE","$existingRequestPath",810],",",["T_WHITESPACE"," ",810],["T_VARIABLE","$requestPath",810],")",["T_WHITESPACE"," ",810],["T_IS_IDENTICAL","===",810],["T_WHITESPACE"," ",810],["T_LNUMBER","0",810],["T_WHITESPACE","\n            ",810],")",["T_WHITESPACE"," ",811],"{",["T_WHITESPACE","\n                ",811],["T_VARIABLE","$existingRequestPath",812],["T_WHITESPACE"," ",812],"=",["T_WHITESPACE"," ",812],["T_STRING","preg_replace",812],"(",["T_WHITESPACE","\n                    ",812],["T_CONSTANT_ENCAPSED_STRING","'\/^'",813],["T_WHITESPACE"," ",813],".",["T_WHITESPACE"," ",813],["T_STRING","preg_quote",813],"(",["T_VARIABLE","$requestPath",813],",",["T_WHITESPACE"," ",813],["T_CONSTANT_ENCAPSED_STRING","'\/'",813],")",["T_WHITESPACE"," ",813],".",["T_WHITESPACE"," ",813],["T_CONSTANT_ENCAPSED_STRING","'\/'",813],",",["T_WHITESPACE"," ",813],["T_CONSTANT_ENCAPSED_STRING","''",813],",",["T_WHITESPACE"," ",813],["T_VARIABLE","$existingRequestPath",813],["T_WHITESPACE","\n                ",813],")",";",["T_WHITESPACE","\n                ",814],["T_IF","if",815],["T_WHITESPACE"," ",815],"(",["T_STRING","preg_match",815],"(",["T_CONSTANT_ENCAPSED_STRING","'#^-([0-9]+)$#i'",815],",",["T_WHITESPACE"," ",815],["T_VARIABLE","$existingRequestPath",815],")",")",["T_WHITESPACE"," ",815],"{",["T_WHITESPACE","\n                    ",815],["T_RETURN","return",816],["T_WHITESPACE"," ",816],["T_VARIABLE","$this",816],["T_OBJECT_OPERATOR","->",816],["T_STRING","_rewrites",816],"[",["T_VARIABLE","$idPath",816],"]",["T_OBJECT_OPERATOR","->",816],["T_STRING","getRequestPath",816],"(",")",";",["T_WHITESPACE","\n                ",816],"}",["T_WHITESPACE","\n            ",817],"}",["T_WHITESPACE","\n\n            ",818],["T_VARIABLE","$fullPath",820],["T_WHITESPACE"," ",820],"=",["T_WHITESPACE"," ",820],["T_VARIABLE","$requestPath",820],".",["T_VARIABLE","$suffix",820],";",["T_WHITESPACE","\n            ",820],["T_IF","if",821],["T_WHITESPACE"," ",821],"(",["T_VARIABLE","$this",821],["T_OBJECT_OPERATOR","->",821],["T_STRING","_deleteOldTargetPath",821],"(",["T_VARIABLE","$fullPath",821],",",["T_WHITESPACE"," ",821],["T_VARIABLE","$idPath",821],",",["T_WHITESPACE"," ",821],["T_VARIABLE","$storeId",821],")",")",["T_WHITESPACE"," ",821],"{",["T_WHITESPACE","\n                ",821],["T_RETURN","return",822],["T_WHITESPACE"," ",822],["T_VARIABLE","$fullPath",822],";",["T_WHITESPACE","\n            ",822],"}",["T_WHITESPACE","\n        ",823],"}",["T_WHITESPACE","\n        ",824],["T_DOC_COMMENT","\/**\n         * Check 2 variants: $requestPath and $requestPath . '-' . $productId\n         *\/",825],["T_WHITESPACE","\n        ",827],["T_VARIABLE","$validatedPath",828],["T_WHITESPACE"," ",828],"=",["T_WHITESPACE"," ",828],["T_VARIABLE","$this",828],["T_OBJECT_OPERATOR","->",828],["T_STRING","getResource",828],"(",")",["T_OBJECT_OPERATOR","->",828],["T_STRING","checkRequestPaths",828],"(",["T_WHITESPACE","\n            ",828],["T_ARRAY","array",829],"(",["T_VARIABLE","$requestPath",829],".",["T_VARIABLE","$suffix",829],",",["T_WHITESPACE"," ",829],["T_VARIABLE","$requestPath",829],".",["T_CONSTANT_ENCAPSED_STRING","'-'",829],".",["T_VARIABLE","$product",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","getId",829],"(",")",".",["T_VARIABLE","$suffix",829],")",",",["T_WHITESPACE","\n            ",829],["T_VARIABLE","$storeId",830],["T_WHITESPACE","\n        ",830],")",";",["T_WHITESPACE","\n\n        ",831],["T_IF","if",833],["T_WHITESPACE"," ",833],"(",["T_VARIABLE","$validatedPath",833],")",["T_WHITESPACE"," ",833],"{",["T_WHITESPACE","\n            ",833],["T_RETURN","return",834],["T_WHITESPACE"," ",834],["T_VARIABLE","$validatedPath",834],";",["T_WHITESPACE","\n        ",834],"}",["T_WHITESPACE","\n        ",835],["T_DOC_COMMENT","\/**\n         * Use unique path generator\n         *\/",836],["T_WHITESPACE","\n        ",838],["T_RETURN","return",839],["T_WHITESPACE"," ",839],["T_VARIABLE","$this",839],["T_OBJECT_OPERATOR","->",839],["T_STRING","getUnusedPath",839],"(",["T_VARIABLE","$storeId",839],",",["T_WHITESPACE"," ",839],["T_VARIABLE","$requestPath",839],".",["T_VARIABLE","$suffix",839],",",["T_WHITESPACE"," ",839],["T_VARIABLE","$idPath",839],")",";",["T_WHITESPACE","\n    ",839],"}",["T_WHITESPACE","\n\n    ",840],["T_DOC_COMMENT","\/**\n     * Generate either id path, request path or target path for product and\/or category\n     *\n     * For generating id or system path, either product or category is required\n     * For generating request path - category is required\n     * $parentPath used only for generating category path\n     *\n     * @param string $type\n     * @param Varien_Object $product\n     * @param Varien_Object $category\n     * @param string $parentPath\n     * @return string\n     * @throws Mage_Core_Exception\n     *\/",842],["T_WHITESPACE","\n    ",855],["T_PUBLIC","public",856],["T_WHITESPACE"," ",856],["T_FUNCTION","function",856],["T_WHITESPACE"," ",856],["T_STRING","generatePath",856],"(",["T_VARIABLE","$type",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_CONSTANT_ENCAPSED_STRING","'target'",856],",",["T_WHITESPACE"," ",856],["T_VARIABLE","$product",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_STRING","null",856],",",["T_WHITESPACE"," ",856],["T_VARIABLE","$category",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_STRING","null",856],",",["T_WHITESPACE"," ",856],["T_VARIABLE","$parentPath",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_STRING","null",856],")",["T_WHITESPACE","\n    ",856],"{",["T_WHITESPACE","\n        ",857],["T_IF","if",858],["T_WHITESPACE"," ",858],"(","!",["T_VARIABLE","$product",858],["T_WHITESPACE"," ",858],["T_BOOLEAN_AND","&&",858],["T_WHITESPACE"," ",858],"!",["T_VARIABLE","$category",858],")",["T_WHITESPACE"," ",858],"{",["T_WHITESPACE","\n            ",858],["T_STRING","Mage",859],["T_DOUBLE_COLON","::",859],["T_STRING","throwException",859],"(",["T_STRING","Mage",859],["T_DOUBLE_COLON","::",859],["T_STRING","helper",859],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",859],")",["T_OBJECT_OPERATOR","->",859],["T_STRING","__",859],"(",["T_CONSTANT_ENCAPSED_STRING","'Please specify either a category or a product, or both.'",859],")",")",";",["T_WHITESPACE","\n        ",859],"}",["T_WHITESPACE","\n\n        ",860],["T_COMMENT","\/\/ generate id_path\n",862],["T_WHITESPACE","        ",863],["T_IF","if",863],["T_WHITESPACE"," ",863],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",863],["T_WHITESPACE"," ",863],["T_IS_IDENTICAL","===",863],["T_WHITESPACE"," ",863],["T_VARIABLE","$type",863],")",["T_WHITESPACE"," ",863],"{",["T_WHITESPACE","\n            ",863],["T_IF","if",864],["T_WHITESPACE"," ",864],"(","!",["T_VARIABLE","$product",864],")",["T_WHITESPACE"," ",864],"{",["T_WHITESPACE","\n                ",864],["T_RETURN","return",865],["T_WHITESPACE"," ",865],["T_CONSTANT_ENCAPSED_STRING","'category\/'",865],["T_WHITESPACE"," ",865],".",["T_WHITESPACE"," ",865],["T_VARIABLE","$category",865],["T_OBJECT_OPERATOR","->",865],["T_STRING","getId",865],"(",")",";",["T_WHITESPACE","\n            ",865],"}",["T_WHITESPACE","\n            ",866],["T_IF","if",867],["T_WHITESPACE"," ",867],"(",["T_VARIABLE","$category",867],["T_WHITESPACE"," ",867],["T_BOOLEAN_AND","&&",867],["T_WHITESPACE"," ",867],["T_VARIABLE","$category",867],["T_OBJECT_OPERATOR","->",867],["T_STRING","getLevel",867],"(",")",["T_WHITESPACE"," ",867],">",["T_WHITESPACE"," ",867],["T_LNUMBER","1",867],")",["T_WHITESPACE"," ",867],"{",["T_WHITESPACE","\n                ",867],["T_RETURN","return",868],["T_WHITESPACE"," ",868],["T_CONSTANT_ENCAPSED_STRING","'product\/'",868],["T_WHITESPACE"," ",868],".",["T_WHITESPACE"," ",868],["T_VARIABLE","$product",868],["T_OBJECT_OPERATOR","->",868],["T_STRING","getId",868],"(",")",["T_WHITESPACE"," ",868],".",["T_WHITESPACE"," ",868],["T_CONSTANT_ENCAPSED_STRING","'\/'",868],["T_WHITESPACE"," ",868],".",["T_WHITESPACE"," ",868],["T_VARIABLE","$category",868],["T_OBJECT_OPERATOR","->",868],["T_STRING","getId",868],"(",")",";",["T_WHITESPACE","\n            ",868],"}",["T_WHITESPACE","\n            ",869],["T_RETURN","return",870],["T_WHITESPACE"," ",870],["T_CONSTANT_ENCAPSED_STRING","'product\/'",870],["T_WHITESPACE"," ",870],".",["T_WHITESPACE"," ",870],["T_VARIABLE","$product",870],["T_OBJECT_OPERATOR","->",870],["T_STRING","getId",870],"(",")",";",["T_WHITESPACE","\n        ",870],"}",["T_WHITESPACE","\n\n        ",871],["T_COMMENT","\/\/ generate request_path\n",873],["T_WHITESPACE","        ",874],["T_IF","if",874],["T_WHITESPACE"," ",874],"(",["T_CONSTANT_ENCAPSED_STRING","'request'",874],["T_WHITESPACE"," ",874],["T_IS_IDENTICAL","===",874],["T_WHITESPACE"," ",874],["T_VARIABLE","$type",874],")",["T_WHITESPACE"," ",874],"{",["T_WHITESPACE","\n            ",874],["T_COMMENT","\/\/ for category\n",875],["T_WHITESPACE","            ",876],["T_IF","if",876],["T_WHITESPACE"," ",876],"(","!",["T_VARIABLE","$product",876],")",["T_WHITESPACE"," ",876],"{",["T_WHITESPACE","\n                ",876],["T_IF","if",877],["T_WHITESPACE"," ",877],"(",["T_VARIABLE","$category",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","getUrlKey",877],"(",")",["T_WHITESPACE"," ",877],["T_IS_EQUAL","==",877],["T_WHITESPACE"," ",877],["T_CONSTANT_ENCAPSED_STRING","''",877],")",["T_WHITESPACE"," ",877],"{",["T_WHITESPACE","\n                    ",877],["T_VARIABLE","$urlKey",878],["T_WHITESPACE"," ",878],"=",["T_WHITESPACE"," ",878],["T_VARIABLE","$this",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","getCategoryModel",878],"(",")",["T_OBJECT_OPERATOR","->",878],["T_STRING","formatUrlKey",878],"(",["T_VARIABLE","$category",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","getName",878],"(",")",")",";",["T_WHITESPACE","\n                ",878],"}",["T_WHITESPACE","\n                ",879],["T_ELSE","else",880],["T_WHITESPACE"," ",880],"{",["T_WHITESPACE","\n                    ",880],["T_VARIABLE","$urlKey",881],["T_WHITESPACE"," ",881],"=",["T_WHITESPACE"," ",881],["T_VARIABLE","$this",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","getCategoryModel",881],"(",")",["T_OBJECT_OPERATOR","->",881],["T_STRING","formatUrlKey",881],"(",["T_VARIABLE","$category",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","getUrlKey",881],"(",")",")",";",["T_WHITESPACE","\n                ",881],"}",["T_WHITESPACE","\n\n                ",882],["T_VARIABLE","$categoryUrlSuffix",884],["T_WHITESPACE"," ",884],"=",["T_WHITESPACE"," ",884],["T_VARIABLE","$this",884],["T_OBJECT_OPERATOR","->",884],["T_STRING","getCategoryUrlSuffix",884],"(",["T_VARIABLE","$category",884],["T_OBJECT_OPERATOR","->",884],["T_STRING","getStoreId",884],"(",")",")",";",["T_WHITESPACE","\n                ",884],["T_IF","if",885],["T_WHITESPACE"," ",885],"(",["T_STRING","null",885],["T_WHITESPACE"," ",885],["T_IS_IDENTICAL","===",885],["T_WHITESPACE"," ",885],["T_VARIABLE","$parentPath",885],")",["T_WHITESPACE"," ",885],"{",["T_WHITESPACE","\n                    ",885],["T_VARIABLE","$parentPath",886],["T_WHITESPACE"," ",886],"=",["T_WHITESPACE"," ",886],["T_VARIABLE","$this",886],["T_OBJECT_OPERATOR","->",886],["T_STRING","getResource",886],"(",")",["T_OBJECT_OPERATOR","->",886],["T_STRING","getCategoryParentPath",886],"(",["T_VARIABLE","$category",886],")",";",["T_WHITESPACE","\n                ",886],"}",["T_WHITESPACE","\n                ",887],["T_ELSEIF","elseif",888],["T_WHITESPACE"," ",888],"(",["T_VARIABLE","$parentPath",888],["T_WHITESPACE"," ",888],["T_IS_EQUAL","==",888],["T_WHITESPACE"," ",888],["T_CONSTANT_ENCAPSED_STRING","'\/'",888],")",["T_WHITESPACE"," ",888],"{",["T_WHITESPACE","\n                    ",888],["T_VARIABLE","$parentPath",889],["T_WHITESPACE"," ",889],"=",["T_WHITESPACE"," ",889],["T_CONSTANT_ENCAPSED_STRING","''",889],";",["T_WHITESPACE","\n                ",889],"}",["T_WHITESPACE","\n                ",890],["T_VARIABLE","$parentPath",891],["T_WHITESPACE"," ",891],"=",["T_WHITESPACE"," ",891],["T_STRING","Mage",891],["T_DOUBLE_COLON","::",891],["T_STRING","helper",891],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",891],")",["T_OBJECT_OPERATOR","->",891],["T_STRING","getCategoryUrlPath",891],"(",["T_VARIABLE","$parentPath",891],",",["T_WHITESPACE","\n                    ",891],["T_STRING","true",892],",",["T_WHITESPACE"," ",892],["T_VARIABLE","$category",892],["T_OBJECT_OPERATOR","->",892],["T_STRING","getStoreId",892],"(",")",")",";",["T_WHITESPACE","\n\n                ",892],["T_RETURN","return",894],["T_WHITESPACE"," ",894],["T_VARIABLE","$this",894],["T_OBJECT_OPERATOR","->",894],["T_STRING","getUnusedPath",894],"(",["T_VARIABLE","$category",894],["T_OBJECT_OPERATOR","->",894],["T_STRING","getStoreId",894],"(",")",",",["T_WHITESPACE"," ",894],["T_VARIABLE","$parentPath",894],["T_WHITESPACE"," ",894],".",["T_WHITESPACE"," ",894],["T_VARIABLE","$urlKey",894],["T_WHITESPACE"," ",894],".",["T_WHITESPACE"," ",894],["T_VARIABLE","$categoryUrlSuffix",894],",",["T_WHITESPACE","\n                    ",894],["T_VARIABLE","$this",895],["T_OBJECT_OPERATOR","->",895],["T_STRING","generatePath",895],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",895],",",["T_WHITESPACE"," ",895],["T_STRING","null",895],",",["T_WHITESPACE"," ",895],["T_VARIABLE","$category",895],")",["T_WHITESPACE","\n                ",895],")",";",["T_WHITESPACE","\n            ",896],"}",["T_WHITESPACE","\n\n            ",897],["T_COMMENT","\/\/ for product & category\n",899],["T_WHITESPACE","            ",900],["T_IF","if",900],["T_WHITESPACE"," ",900],"(","!",["T_VARIABLE","$category",900],")",["T_WHITESPACE"," ",900],"{",["T_WHITESPACE","\n                ",900],["T_STRING","Mage",901],["T_DOUBLE_COLON","::",901],["T_STRING","throwException",901],"(",["T_STRING","Mage",901],["T_DOUBLE_COLON","::",901],["T_STRING","helper",901],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",901],")",["T_OBJECT_OPERATOR","->",901],["T_STRING","__",901],"(",["T_CONSTANT_ENCAPSED_STRING","'A category object is required for determining the product request path.'",901],")",")",";",["T_WHITESPACE"," ",901],["T_COMMENT","\/\/ why?\n",901],["T_WHITESPACE","            ",902],"}",["T_WHITESPACE","\n\n            ",902],["T_IF","if",904],["T_WHITESPACE"," ",904],"(",["T_VARIABLE","$product",904],["T_OBJECT_OPERATOR","->",904],["T_STRING","getUrlKey",904],"(",")",["T_WHITESPACE"," ",904],["T_IS_EQUAL","==",904],["T_WHITESPACE"," ",904],["T_CONSTANT_ENCAPSED_STRING","''",904],")",["T_WHITESPACE"," ",904],"{",["T_WHITESPACE","\n                ",904],["T_VARIABLE","$urlKey",905],["T_WHITESPACE"," ",905],"=",["T_WHITESPACE"," ",905],["T_VARIABLE","$this",905],["T_OBJECT_OPERATOR","->",905],["T_STRING","getProductModel",905],"(",")",["T_OBJECT_OPERATOR","->",905],["T_STRING","formatUrlKey",905],"(",["T_VARIABLE","$product",905],["T_OBJECT_OPERATOR","->",905],["T_STRING","getName",905],"(",")",")",";",["T_WHITESPACE","\n            ",905],"}",["T_WHITESPACE","\n            ",906],["T_ELSE","else",907],["T_WHITESPACE"," ",907],"{",["T_WHITESPACE","\n                ",907],["T_VARIABLE","$urlKey",908],["T_WHITESPACE"," ",908],"=",["T_WHITESPACE"," ",908],["T_VARIABLE","$this",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","getProductModel",908],"(",")",["T_OBJECT_OPERATOR","->",908],["T_STRING","formatUrlKey",908],"(",["T_VARIABLE","$product",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","getUrlKey",908],"(",")",")",";",["T_WHITESPACE","\n            ",908],"}",["T_WHITESPACE","\n            ",909],["T_VARIABLE","$productUrlSuffix",910],["T_WHITESPACE","  ",910],"=",["T_WHITESPACE"," ",910],["T_VARIABLE","$this",910],["T_OBJECT_OPERATOR","->",910],["T_STRING","getProductUrlSuffix",910],"(",["T_VARIABLE","$category",910],["T_OBJECT_OPERATOR","->",910],["T_STRING","getStoreId",910],"(",")",")",";",["T_WHITESPACE","\n            ",910],["T_IF","if",911],["T_WHITESPACE"," ",911],"(",["T_VARIABLE","$category",911],["T_OBJECT_OPERATOR","->",911],["T_STRING","getLevel",911],"(",")",["T_WHITESPACE"," ",911],">",["T_WHITESPACE"," ",911],["T_LNUMBER","1",911],")",["T_WHITESPACE"," ",911],"{",["T_WHITESPACE","\n                ",911],["T_COMMENT","\/\/ To ensure, that category has url path either from attribute or generated now\n",912],["T_WHITESPACE","                ",913],["T_VARIABLE","$this",913],["T_OBJECT_OPERATOR","->",913],["T_STRING","_addCategoryUrlPath",913],"(",["T_VARIABLE","$category",913],")",";",["T_WHITESPACE","\n                ",913],["T_VARIABLE","$categoryUrl",914],["T_WHITESPACE"," ",914],"=",["T_WHITESPACE"," ",914],["T_STRING","Mage",914],["T_DOUBLE_COLON","::",914],["T_STRING","helper",914],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",914],")",["T_OBJECT_OPERATOR","->",914],["T_STRING","getCategoryUrlPath",914],"(",["T_VARIABLE","$category",914],["T_OBJECT_OPERATOR","->",914],["T_STRING","getUrlPath",914],"(",")",",",["T_WHITESPACE","\n                    ",914],["T_STRING","false",915],",",["T_WHITESPACE"," ",915],["T_VARIABLE","$category",915],["T_OBJECT_OPERATOR","->",915],["T_STRING","getStoreId",915],"(",")",")",";",["T_WHITESPACE","\n                ",915],["T_RETURN","return",916],["T_WHITESPACE"," ",916],["T_VARIABLE","$this",916],["T_OBJECT_OPERATOR","->",916],["T_STRING","getUnusedPath",916],"(",["T_VARIABLE","$category",916],["T_OBJECT_OPERATOR","->",916],["T_STRING","getStoreId",916],"(",")",",",["T_WHITESPACE"," ",916],["T_VARIABLE","$categoryUrl",916],["T_WHITESPACE"," ",916],".",["T_WHITESPACE"," ",916],["T_CONSTANT_ENCAPSED_STRING","'\/'",916],["T_WHITESPACE"," ",916],".",["T_WHITESPACE"," ",916],["T_VARIABLE","$urlKey",916],["T_WHITESPACE"," ",916],".",["T_WHITESPACE"," ",916],["T_VARIABLE","$productUrlSuffix",916],",",["T_WHITESPACE","\n                    ",916],["T_VARIABLE","$this",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","generatePath",917],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",917],",",["T_WHITESPACE"," ",917],["T_VARIABLE","$product",917],",",["T_WHITESPACE"," ",917],["T_VARIABLE","$category",917],")",["T_WHITESPACE","\n                ",917],")",";",["T_WHITESPACE","\n            ",918],"}",["T_WHITESPACE","\n\n            ",919],["T_COMMENT","\/\/ for product only\n",921],["T_WHITESPACE","            ",922],["T_RETURN","return",922],["T_WHITESPACE"," ",922],["T_VARIABLE","$this",922],["T_OBJECT_OPERATOR","->",922],["T_STRING","getUnusedPath",922],"(",["T_VARIABLE","$category",922],["T_OBJECT_OPERATOR","->",922],["T_STRING","getStoreId",922],"(",")",",",["T_WHITESPACE"," ",922],["T_VARIABLE","$urlKey",922],["T_WHITESPACE"," ",922],".",["T_WHITESPACE"," ",922],["T_VARIABLE","$productUrlSuffix",922],",",["T_WHITESPACE","\n                ",922],["T_VARIABLE","$this",923],["T_OBJECT_OPERATOR","->",923],["T_STRING","generatePath",923],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",923],",",["T_WHITESPACE"," ",923],["T_VARIABLE","$product",923],")",["T_WHITESPACE","\n            ",923],")",";",["T_WHITESPACE","\n        ",924],"}",["T_WHITESPACE","\n\n        ",925],["T_COMMENT","\/\/ generate target_path\n",927],["T_WHITESPACE","        ",928],["T_IF","if",928],["T_WHITESPACE"," ",928],"(","!",["T_VARIABLE","$product",928],")",["T_WHITESPACE"," ",928],"{",["T_WHITESPACE","\n            ",928],["T_RETURN","return",929],["T_WHITESPACE"," ",929],["T_CONSTANT_ENCAPSED_STRING","'catalog\/category\/view\/id\/'",929],["T_WHITESPACE"," ",929],".",["T_WHITESPACE"," ",929],["T_VARIABLE","$category",929],["T_OBJECT_OPERATOR","->",929],["T_STRING","getId",929],"(",")",";",["T_WHITESPACE","\n        ",929],"}",["T_WHITESPACE","\n        ",930],["T_IF","if",931],["T_WHITESPACE"," ",931],"(",["T_VARIABLE","$category",931],["T_WHITESPACE"," ",931],["T_BOOLEAN_AND","&&",931],["T_WHITESPACE"," ",931],["T_VARIABLE","$category",931],["T_OBJECT_OPERATOR","->",931],["T_STRING","getLevel",931],"(",")",["T_WHITESPACE"," ",931],">",["T_WHITESPACE"," ",931],["T_LNUMBER","1",931],")",["T_WHITESPACE"," ",931],"{",["T_WHITESPACE","\n            ",931],["T_RETURN","return",932],["T_WHITESPACE"," ",932],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product\/view\/id\/'",932],["T_WHITESPACE"," ",932],".",["T_WHITESPACE"," ",932],["T_VARIABLE","$product",932],["T_OBJECT_OPERATOR","->",932],["T_STRING","getId",932],"(",")",["T_WHITESPACE"," ",932],".",["T_WHITESPACE"," ",932],["T_CONSTANT_ENCAPSED_STRING","'\/category\/'",932],["T_WHITESPACE"," ",932],".",["T_WHITESPACE"," ",932],["T_VARIABLE","$category",932],["T_OBJECT_OPERATOR","->",932],["T_STRING","getId",932],"(",")",";",["T_WHITESPACE","\n        ",932],"}",["T_WHITESPACE","\n        ",933],["T_RETURN","return",934],["T_WHITESPACE"," ",934],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product\/view\/id\/'",934],["T_WHITESPACE"," ",934],".",["T_WHITESPACE"," ",934],["T_VARIABLE","$product",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","getId",934],"(",")",";",["T_WHITESPACE","\n    ",934],"}",["T_WHITESPACE","\n\n    ",935],["T_DOC_COMMENT","\/**\n     * Return unique string based on the time in microseconds.\n     *\n     * @return string\n     *\/",937],["T_WHITESPACE","\n    ",941],["T_PUBLIC","public",942],["T_WHITESPACE"," ",942],["T_FUNCTION","function",942],["T_WHITESPACE"," ",942],["T_STRING","generateUniqueIdPath",942],"(",")",["T_WHITESPACE","\n    ",942],"{",["T_WHITESPACE","\n        ",943],["T_RETURN","return",944],["T_WHITESPACE"," ",944],["T_STRING","str_replace",944],"(",["T_CONSTANT_ENCAPSED_STRING","'0.'",944],",",["T_WHITESPACE"," ",944],["T_CONSTANT_ENCAPSED_STRING","''",944],",",["T_WHITESPACE"," ",944],["T_STRING","str_replace",944],"(",["T_CONSTANT_ENCAPSED_STRING","' '",944],",",["T_WHITESPACE"," ",944],["T_CONSTANT_ENCAPSED_STRING","'_'",944],",",["T_WHITESPACE"," ",944],["T_STRING","microtime",944],"(",")",")",")",";",["T_WHITESPACE","\n    ",944],"}",["T_WHITESPACE","\n\n    ",945],["T_DOC_COMMENT","\/**\n     * Create Custom URL Rewrite for old product\/category URL after url_key changed\n     * It will perform permanent redirect from old URL to new URL\n     *\n     * @param array $rewriteData New rewrite data\n     * @param Varien_Object $rewrite Rewrite model\n     * @return Mage_Catalog_Model_Url\n     *\/",947],["T_WHITESPACE","\n    ",954],["T_PROTECTED","protected",955],["T_WHITESPACE"," ",955],["T_FUNCTION","function",955],["T_WHITESPACE"," ",955],["T_STRING","_saveRewriteHistory",955],"(",["T_VARIABLE","$rewriteData",955],",",["T_WHITESPACE"," ",955],["T_VARIABLE","$rewrite",955],")",["T_WHITESPACE","\n    ",955],"{",["T_WHITESPACE","\n        ",956],["T_IF","if",957],["T_WHITESPACE"," ",957],"(",["T_VARIABLE","$rewrite",957],["T_WHITESPACE"," ",957],["T_INSTANCEOF","instanceof",957],["T_WHITESPACE"," ",957],["T_STRING","Varien_Object",957],["T_WHITESPACE"," ",957],["T_BOOLEAN_AND","&&",957],["T_WHITESPACE"," ",957],["T_VARIABLE","$rewrite",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getId",957],"(",")",")",["T_WHITESPACE"," ",957],"{",["T_WHITESPACE","\n            ",957],["T_VARIABLE","$rewriteData",958],"[",["T_CONSTANT_ENCAPSED_STRING","'target_path'",958],"]",["T_WHITESPACE"," ",958],"=",["T_WHITESPACE"," ",958],["T_VARIABLE","$rewriteData",958],"[",["T_CONSTANT_ENCAPSED_STRING","'request_path'",958],"]",";",["T_WHITESPACE","\n            ",958],["T_VARIABLE","$rewriteData",959],"[",["T_CONSTANT_ENCAPSED_STRING","'request_path'",959],"]",["T_WHITESPACE"," ",959],"=",["T_WHITESPACE"," ",959],["T_VARIABLE","$rewrite",959],["T_OBJECT_OPERATOR","->",959],["T_STRING","getRequestPath",959],"(",")",";",["T_WHITESPACE","\n            ",959],["T_VARIABLE","$rewriteData",960],"[",["T_CONSTANT_ENCAPSED_STRING","'id_path'",960],"]",["T_WHITESPACE"," ",960],"=",["T_WHITESPACE"," ",960],["T_VARIABLE","$this",960],["T_OBJECT_OPERATOR","->",960],["T_STRING","generateUniqueIdPath",960],"(",")",";",["T_WHITESPACE","\n            ",960],["T_VARIABLE","$rewriteData",961],"[",["T_CONSTANT_ENCAPSED_STRING","'is_system'",961],"]",["T_WHITESPACE"," ",961],"=",["T_WHITESPACE"," ",961],["T_LNUMBER","0",961],";",["T_WHITESPACE","\n            ",961],["T_VARIABLE","$rewriteData",962],"[",["T_CONSTANT_ENCAPSED_STRING","'options'",962],"]",["T_WHITESPACE"," ",962],"=",["T_WHITESPACE"," ",962],["T_CONSTANT_ENCAPSED_STRING","'RP'",962],";",["T_WHITESPACE"," ",962],["T_COMMENT","\/\/ Redirect = Permanent\n",962],["T_WHITESPACE","            ",963],["T_VARIABLE","$this",963],["T_OBJECT_OPERATOR","->",963],["T_STRING","getResource",963],"(",")",["T_OBJECT_OPERATOR","->",963],["T_STRING","saveRewriteHistory",963],"(",["T_VARIABLE","$rewriteData",963],")",";",["T_WHITESPACE","\n        ",963],"}",["T_WHITESPACE","\n\n        ",964],["T_RETURN","return",966],["T_WHITESPACE"," ",966],["T_VARIABLE","$this",966],";",["T_WHITESPACE","\n    ",966],"}",["T_WHITESPACE","\n",967],"}",["T_WHITESPACE","\n",968]]