[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Product collection\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Collection_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Alias for index table\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","INDEX_TABLE_ALIAS",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'price_index'",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Alias for main table\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_CONST","const",45],["T_WHITESPACE"," ",45],["T_STRING","MAIN_TABLE_ALIAS",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_CONSTANT_ENCAPSED_STRING","'e'",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Catalog Product Flat is enabled cache per store\n     *\n     * @var array\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_flatEnabled",52],["T_WHITESPACE","                  ",52],"=",["T_WHITESPACE"," ",52],["T_ARRAY","array",52],"(",")",";",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Product websites table name\n     *\n     * @var string\n     *\/",54],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$_productWebsiteTable",59],";",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * Product categories table name\n     *\n     * @var string\n     *\/",61],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$_productCategoryTable",66],";",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Is add URL rewrites to collection flag\n     *\n     * @var bool\n     *\/",68],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$_addUrlRewrite",73],["T_WHITESPACE","                ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","false",73],";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Add URL rewrite for category\n     *\n     * @var int\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$_urlRewriteCategory",80],["T_WHITESPACE","           ",80],"=",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","''",80],";",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Is add minimal price to product collection flag\n     *\n     * @var bool\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$_addMinimalPrice",87],["T_WHITESPACE","              ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","false",87],";",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Is add final price to product collection flag\n     *\n     * @var unknown_type\n     *\/",89],["T_WHITESPACE","\n    ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$_addFinalPrice",94],["T_WHITESPACE","                ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","false",94],";",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Cache for all ids\n     *\n     * @var array\n     *\/",96],["T_WHITESPACE","\n    ",100],["T_PROTECTED","protected",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$_allIdsCache",101],["T_WHITESPACE","                  ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","null",101],";",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Is add tax percents to product collection flag\n     *\n     * @var bool\n     *\/",103],["T_WHITESPACE","\n    ",107],["T_PROTECTED","protected",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$_addTaxPercents",108],["T_WHITESPACE","               ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","false",108],";",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Product limitation filters\n     * Allowed filters\n     *  store_id                int;\n     *  category_id             int;\n     *  category_is_anchor      int;\n     *  visibility              array|int;\n     *  website_ids             array|int;\n     *  store_table             string;\n     *  use_price_index         bool;   join price index table flag\n     *  customer_group_id       int;    required for price; customer group limitation for price\n     *  website_id              int;    required for price; website limitation for price\n     *\n     * @var array\n     *\/",110],["T_WHITESPACE","\n    ",124],["T_PROTECTED","protected",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$_productLimitationFilters",125],["T_WHITESPACE","     ",125],"=",["T_WHITESPACE"," ",125],["T_ARRAY","array",125],"(",")",";",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * Category product count select\n     *\n     * @var Zend_Db_Select\n     *\/",127],["T_WHITESPACE","\n    ",131],["T_PROTECTED","protected",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$_productCountSelect",132],["T_WHITESPACE","           ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","null",132],";",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Enter description here ...\n     *\n     * @var bool\n     *\/",134],["T_WHITESPACE","\n    ",138],["T_PROTECTED","protected",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$_isWebsiteFilter",139],["T_WHITESPACE","              ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","false",139],";",["T_WHITESPACE","\n\n    ",139],["T_DOC_COMMENT","\/**\n     * Additional field filters, applied in _productLimitationJoinPrice()\n     *\n     * @var array\n     *\/",141],["T_WHITESPACE","\n    ",145],["T_PROTECTED","protected",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$_priceDataFieldFilters",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_ARRAY","array",146],"(",")",";",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Map of price fields\n     *\n     * @var array\n     *\/",148],["T_WHITESPACE","\n    ",152],["T_PROTECTED","protected",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$_map",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_ARRAY","array",153],"(",["T_CONSTANT_ENCAPSED_STRING","'fields'",153],["T_WHITESPACE"," ",153],["T_DOUBLE_ARROW","=>",153],["T_WHITESPACE"," ",153],["T_ARRAY","array",153],"(",["T_WHITESPACE","\n        ",153],["T_CONSTANT_ENCAPSED_STRING","'price'",154],["T_WHITESPACE","         ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_CONSTANT_ENCAPSED_STRING","'price_index.price'",154],",",["T_WHITESPACE","\n        ",154],["T_CONSTANT_ENCAPSED_STRING","'final_price'",155],["T_WHITESPACE","   ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'price_index.final_price'",155],",",["T_WHITESPACE","\n        ",155],["T_CONSTANT_ENCAPSED_STRING","'min_price'",156],["T_WHITESPACE","     ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_CONSTANT_ENCAPSED_STRING","'price_index.min_price'",156],",",["T_WHITESPACE","\n        ",156],["T_CONSTANT_ENCAPSED_STRING","'max_price'",157],["T_WHITESPACE","     ",157],["T_DOUBLE_ARROW","=>",157],["T_WHITESPACE"," ",157],["T_CONSTANT_ENCAPSED_STRING","'price_index.max_price'",157],",",["T_WHITESPACE","\n        ",157],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",158],["T_WHITESPACE","    ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","'price_index.tier_price'",158],",",["T_WHITESPACE","\n        ",158],["T_CONSTANT_ENCAPSED_STRING","'special_price'",159],["T_WHITESPACE"," ",159],["T_DOUBLE_ARROW","=>",159],["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'price_index.special_price'",159],",",["T_WHITESPACE","\n    ",159],")",")",";",["T_WHITESPACE","\n\n    ",160],["T_DOC_COMMENT","\/**\n     * Price expression sql\n     *\n     * @var string|null\n     *\/",162],["T_WHITESPACE","\n    ",166],["T_PROTECTED","protected",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$_priceExpression",167],";",["T_WHITESPACE","\n\n    ",167],["T_DOC_COMMENT","\/**\n     * Additional price expression sql part\n     *\n     * @var string|null\n     *\/",169],["T_WHITESPACE","\n    ",173],["T_PROTECTED","protected",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$_additionalPriceExpression",174],";",["T_WHITESPACE","\n\n    ",174],["T_DOC_COMMENT","\/**\n     * Max prise (statistics data)\n     *\n     * @var float\n     *\/",176],["T_WHITESPACE","\n    ",180],["T_PROTECTED","protected",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$_maxPrice",181],";",["T_WHITESPACE","\n\n    ",181],["T_DOC_COMMENT","\/**\n     * Min prise (statistics data)\n     *\n     * @var float\n     *\/",183],["T_WHITESPACE","\n    ",187],["T_PROTECTED","protected",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$_minPrice",188],";",["T_WHITESPACE","\n\n    ",188],["T_DOC_COMMENT","\/**\n     * Prise standard deviation (statistics data)\n     *\n     * @var float\n     *\/",190],["T_WHITESPACE","\n    ",194],["T_PROTECTED","protected",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$_priceStandardDeviation",195],";",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Prises count (statistics data)\n     *\n     * @var int\n     *\/",197],["T_WHITESPACE","\n    ",201],["T_PROTECTED","protected",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$_pricesCount",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","null",202],";",["T_WHITESPACE","\n\n    ",202],["T_DOC_COMMENT","\/**\n     * Cloned Select after dispatching 'catalog_prepare_price_select' event\n     *\n     * @var Varien_Db_Select\n     *\/",204],["T_WHITESPACE","\n    ",208],["T_PROTECTED","protected",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$_catalogPreparePriceSelect",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_STRING","null",209],";",["T_WHITESPACE","\n\n    ",209],["T_DOC_COMMENT","\/**\n     * Catalog factory instance\n     *\n     * @var Mage_Catalog_Model_Factory\n     *\/",211],["T_WHITESPACE","\n    ",215],["T_PROTECTED","protected",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$_factory",216],";",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Initialize factory\n     *\n     * @param Mage_Core_Model_Resource_Abstract $resource\n     * @param array $args\n     *\/",218],["T_WHITESPACE","\n    ",223],["T_PUBLIC","public",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","__construct",224],"(",["T_VARIABLE","$resource",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","null",224],",",["T_WHITESPACE"," ",224],["T_ARRAY","array",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$args",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_ARRAY","array",224],"(",")",")",["T_WHITESPACE","\n    ",224],"{",["T_WHITESPACE","\n        ",225],["T_STRING","parent",226],["T_DOUBLE_COLON","::",226],["T_STRING","__construct",226],"(",["T_VARIABLE","$resource",226],")",";",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_factory",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],"!",["T_EMPTY","empty",227],"(",["T_VARIABLE","$args",227],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",227],"]",")",["T_WHITESPACE"," ",227],"?",["T_WHITESPACE"," ",227],["T_VARIABLE","$args",227],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",227],"]",["T_WHITESPACE"," ",227],":",["T_WHITESPACE"," ",227],["T_STRING","Mage",227],["T_DOUBLE_COLON","::",227],["T_STRING","getSingleton",227],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/factory'",227],")",";",["T_WHITESPACE","\n    ",227],"}",["T_WHITESPACE","\n\n    ",228],["T_DOC_COMMENT","\/**\n     * Get cloned Select after dispatching 'catalog_prepare_price_select' event\n     *\n     * @return Varien_Db_Select\n     *\/",230],["T_WHITESPACE","\n    ",234],["T_PUBLIC","public",235],["T_WHITESPACE"," ",235],["T_FUNCTION","function",235],["T_WHITESPACE"," ",235],["T_STRING","getCatalogPreparedSelect",235],"(",")",["T_WHITESPACE","\n    ",235],"{",["T_WHITESPACE","\n        ",236],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_catalogPreparePriceSelect",237],";",["T_WHITESPACE","\n    ",237],"}",["T_WHITESPACE","\n\n    ",238],["T_DOC_COMMENT","\/**\n     * Prepare additional price expression sql part\n     *\n     * @param Varien_Db_Select $select\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",240],["T_WHITESPACE","\n    ",245],["T_PROTECTED","protected",246],["T_WHITESPACE"," ",246],["T_FUNCTION","function",246],["T_WHITESPACE"," ",246],["T_STRING","_preparePriceExpressionParameters",246],"(",["T_VARIABLE","$select",246],")",["T_WHITESPACE","\n    ",246],"{",["T_WHITESPACE","\n        ",247],["T_COMMENT","\/\/ prepare response object for event\n",248],["T_WHITESPACE","        ",249],["T_VARIABLE","$response",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_NEW","new",249],["T_WHITESPACE"," ",249],["T_STRING","Varien_Object",249],"(",")",";",["T_WHITESPACE","\n        ",249],["T_VARIABLE","$response",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","setAdditionalCalculations",250],"(",["T_ARRAY","array",250],"(",")",")",";",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$tableAliases",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_STRING","array_keys",251],"(",["T_VARIABLE","$select",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getPart",251],"(",["T_STRING","Zend_Db_Select",251],["T_DOUBLE_COLON","::",251],["T_STRING","FROM",251],")",")",";",["T_WHITESPACE","\n        ",251],["T_IF","if",252],["T_WHITESPACE"," ",252],"(",["T_STRING","in_array",252],"(",["T_STRING","self",252],["T_DOUBLE_COLON","::",252],["T_STRING","INDEX_TABLE_ALIAS",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$tableAliases",252],")",")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n            ",252],["T_VARIABLE","$table",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_STRING","self",253],["T_DOUBLE_COLON","::",253],["T_STRING","INDEX_TABLE_ALIAS",253],";",["T_WHITESPACE","\n        ",253],"}",["T_WHITESPACE"," ",254],["T_ELSE","else",254],["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n            ",254],["T_VARIABLE","$table",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_STRING","reset",255],"(",["T_VARIABLE","$tableAliases",255],")",";",["T_WHITESPACE","\n        ",255],"}",["T_WHITESPACE","\n\n        ",256],["T_COMMENT","\/\/ prepare event arguments\n",258],["T_WHITESPACE","        ",259],["T_VARIABLE","$eventArgs",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_ARRAY","array",259],"(",["T_WHITESPACE","\n            ",259],["T_CONSTANT_ENCAPSED_STRING","'select'",260],["T_WHITESPACE","          ",260],["T_DOUBLE_ARROW","=>",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$select",260],",",["T_WHITESPACE","\n            ",260],["T_CONSTANT_ENCAPSED_STRING","'table'",261],["T_WHITESPACE","           ",261],["T_DOUBLE_ARROW","=>",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$table",261],",",["T_WHITESPACE","\n            ",261],["T_CONSTANT_ENCAPSED_STRING","'store_id'",262],["T_WHITESPACE","        ",262],["T_DOUBLE_ARROW","=>",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getStoreId",262],"(",")",",",["T_WHITESPACE","\n            ",262],["T_CONSTANT_ENCAPSED_STRING","'response_object'",263],["T_WHITESPACE"," ",263],["T_DOUBLE_ARROW","=>",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$response",263],["T_WHITESPACE","\n        ",263],")",";",["T_WHITESPACE","\n\n        ",264],["T_STRING","Mage",266],["T_DOUBLE_COLON","::",266],["T_STRING","dispatchEvent",266],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_prepare_price_select'",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$eventArgs",266],")",";",["T_WHITESPACE","\n\n        ",266],["T_VARIABLE","$additional",268],["T_WHITESPACE","   ",268],"=",["T_WHITESPACE"," ",268],["T_STRING","join",268],"(",["T_CONSTANT_ENCAPSED_STRING","''",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$response",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getAdditionalCalculations",268],"(",")",")",";",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_priceExpression",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$table",269],["T_WHITESPACE"," ",269],".",["T_WHITESPACE"," ",269],["T_CONSTANT_ENCAPSED_STRING","'.min_price'",269],";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_additionalPriceExpression",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$additional",270],";",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","_catalogPreparePriceSelect",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_CLONE","clone",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$select",271],";",["T_WHITESPACE","\n\n        ",271],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Get price expression sql part\n     *\n     * @param Varien_Db_Select $select\n     * @return string\n     *\/",276],["T_WHITESPACE","\n    ",281],["T_PUBLIC","public",282],["T_WHITESPACE"," ",282],["T_FUNCTION","function",282],["T_WHITESPACE"," ",282],["T_STRING","getPriceExpression",282],"(",["T_VARIABLE","$select",282],")",["T_WHITESPACE","\n    ",282],"{",["T_WHITESPACE","\n        ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_STRING","is_null",284],"(",["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_priceExpression",284],")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","_preparePriceExpressionParameters",285],"(",["T_VARIABLE","$select",285],")",";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n        ",286],["T_RETURN","return",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_priceExpression",287],";",["T_WHITESPACE","\n    ",287],"}",["T_WHITESPACE","\n\n    ",288],["T_DOC_COMMENT","\/**\n     * Get additional price expression sql part\n     *\n     * @param Varien_Db_Select $select\n     * @return string\n     *\/",290],["T_WHITESPACE","\n    ",295],["T_PUBLIC","public",296],["T_WHITESPACE"," ",296],["T_FUNCTION","function",296],["T_WHITESPACE"," ",296],["T_STRING","getAdditionalPriceExpression",296],"(",["T_VARIABLE","$select",296],")",["T_WHITESPACE","\n    ",296],"{",["T_WHITESPACE","\n        ",297],["T_IF","if",298],["T_WHITESPACE"," ",298],"(",["T_STRING","is_null",298],"(",["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_additionalPriceExpression",298],")",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n            ",298],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_preparePriceExpressionParameters",299],"(",["T_VARIABLE","$select",299],")",";",["T_WHITESPACE","\n        ",299],"}",["T_WHITESPACE","\n        ",300],["T_RETURN","return",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_additionalPriceExpression",301],";",["T_WHITESPACE","\n    ",301],"}",["T_WHITESPACE","\n\n    ",302],["T_DOC_COMMENT","\/**\n     * Get currency rate\n     *\n     * @return float\n     *\/",304],["T_WHITESPACE","\n    ",308],["T_PUBLIC","public",309],["T_WHITESPACE"," ",309],["T_FUNCTION","function",309],["T_WHITESPACE"," ",309],["T_STRING","getCurrencyRate",309],"(",")",["T_WHITESPACE","\n    ",309],"{",["T_WHITESPACE","\n        ",310],["T_RETURN","return",311],["T_WHITESPACE"," ",311],["T_STRING","Mage",311],["T_DOUBLE_COLON","::",311],["T_STRING","app",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getStore",311],"(",["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getStoreId",311],"(",")",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getCurrentCurrencyRate",311],"(",")",";",["T_WHITESPACE","\n    ",311],"}",["T_WHITESPACE","\n\n    ",312],["T_DOC_COMMENT","\/**\n     * Retrieve Catalog Product Flat Helper object\n     *\n     * @return Mage_Catalog_Helper_Product_Flat\n     *\/",314],["T_WHITESPACE","\n    ",318],["T_PUBLIC","public",319],["T_WHITESPACE"," ",319],["T_FUNCTION","function",319],["T_WHITESPACE"," ",319],["T_STRING","getFlatHelper",319],"(",")",["T_WHITESPACE","\n    ",319],"{",["T_WHITESPACE","\n        ",320],["T_RETURN","return",321],["T_WHITESPACE"," ",321],["T_STRING","Mage",321],["T_DOUBLE_COLON","::",321],["T_STRING","helper",321],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_flat'",321],")",";",["T_WHITESPACE","\n    ",321],"}",["T_WHITESPACE","\n\n    ",322],["T_DOC_COMMENT","\/**\n     * Retrieve is flat enabled flag\n     * Return always false if magento run admin\n     *\n     * @return bool\n     *\/",324],["T_WHITESPACE","\n    ",329],["T_PUBLIC","public",330],["T_WHITESPACE"," ",330],["T_FUNCTION","function",330],["T_WHITESPACE"," ",330],["T_STRING","isEnabledFlat",330],"(",")",["T_WHITESPACE","\n    ",330],"{",["T_WHITESPACE","\n        ",331],["T_COMMENT","\/\/ Flat Data can be used only on frontend\n",332],["T_WHITESPACE","        ",333],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_STRING","Mage",333],["T_DOUBLE_COLON","::",333],["T_STRING","app",333],"(",")",["T_OBJECT_OPERATOR","->",333],["T_STRING","getStore",333],"(",")",["T_OBJECT_OPERATOR","->",333],["T_STRING","isAdmin",333],"(",")",")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_RETURN","return",334],["T_WHITESPACE"," ",334],["T_STRING","false",334],";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n        ",335],["T_VARIABLE","$storeId",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getStoreId",336],"(",")",";",["T_WHITESPACE","\n        ",336],["T_IF","if",337],["T_WHITESPACE"," ",337],"(","!",["T_ISSET","isset",337],"(",["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","_flatEnabled",337],"[",["T_VARIABLE","$storeId",337],"]",")",")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n            ",337],["T_VARIABLE","$flatHelper",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getFlatHelper",338],"(",")",";",["T_WHITESPACE","\n            ",338],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","_flatEnabled",339],"[",["T_VARIABLE","$storeId",339],"]",["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$flatHelper",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","isAvailable",339],"(",")",["T_WHITESPACE"," ",339],["T_BOOLEAN_AND","&&",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$flatHelper",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","isBuilt",339],"(",["T_VARIABLE","$storeId",339],")",";",["T_WHITESPACE","\n        ",339],"}",["T_WHITESPACE","\n        ",340],["T_RETURN","return",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_flatEnabled",341],"[",["T_VARIABLE","$storeId",341],"]",";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_DOC_COMMENT","\/**\n     * Initialize resources\n     *\n     *\/",344],["T_WHITESPACE","\n    ",347],["T_PROTECTED","protected",348],["T_WHITESPACE"," ",348],["T_FUNCTION","function",348],["T_WHITESPACE"," ",348],["T_STRING","_construct",348],"(",")",["T_WHITESPACE","\n    ",348],"{",["T_WHITESPACE","\n        ",349],["T_IF","if",350],["T_WHITESPACE"," ",350],"(",["T_VARIABLE","$this",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","isEnabledFlat",350],"(",")",")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","_init",351],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",351],",",["T_WHITESPACE"," ",351],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_flat'",351],")",";",["T_WHITESPACE","\n        ",351],"}",["T_WHITESPACE","\n        ",352],["T_ELSE","else",353],["T_WHITESPACE"," ",353],"{",["T_WHITESPACE","\n            ",353],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","_init",354],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",354],")",";",["T_WHITESPACE","\n        ",354],"}",["T_WHITESPACE","\n        ",355],["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","_initTables",356],"(",")",";",["T_WHITESPACE","\n    ",356],"}",["T_WHITESPACE","\n\n    ",357],["T_DOC_COMMENT","\/**\n     * Define product website and category product tables\n     *\n     *\/",359],["T_WHITESPACE","\n    ",362],["T_PROTECTED","protected",363],["T_WHITESPACE"," ",363],["T_FUNCTION","function",363],["T_WHITESPACE"," ",363],["T_STRING","_initTables",363],"(",")",["T_WHITESPACE","\n    ",363],"{",["T_WHITESPACE","\n        ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_productWebsiteTable",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getResource",365],"(",")",["T_OBJECT_OPERATOR","->",365],["T_STRING","getTable",365],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",365],")",";",["T_WHITESPACE","\n        ",365],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","_productCategoryTable",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getResource",366],"(",")",["T_OBJECT_OPERATOR","->",366],["T_STRING","getTable",366],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",366],")",";",["T_WHITESPACE","\n    ",366],"}",["T_WHITESPACE","\n\n    ",367],["T_DOC_COMMENT","\/**\n     * Standard resource collection initalization\n     *\n     * @param string $model\n     * @param unknown_type $entityModel\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",369],["T_WHITESPACE","\n    ",375],["T_PROTECTED","protected",376],["T_WHITESPACE"," ",376],["T_FUNCTION","function",376],["T_WHITESPACE"," ",376],["T_STRING","_init",376],"(",["T_VARIABLE","$model",376],",",["T_WHITESPACE"," ",376],["T_VARIABLE","$entityModel",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_STRING","null",376],")",["T_WHITESPACE","\n    ",376],"{",["T_WHITESPACE","\n        ",377],["T_IF","if",378],["T_WHITESPACE"," ",378],"(",["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","isEnabledFlat",378],"(",")",")",["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n            ",378],["T_VARIABLE","$entityModel",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_flat'",379],";",["T_WHITESPACE","\n        ",379],"}",["T_WHITESPACE","\n\n        ",380],["T_RETURN","return",382],["T_WHITESPACE"," ",382],["T_STRING","parent",382],["T_DOUBLE_COLON","::",382],["T_STRING","_init",382],"(",["T_VARIABLE","$model",382],",",["T_WHITESPACE"," ",382],["T_VARIABLE","$entityModel",382],")",";",["T_WHITESPACE","\n    ",382],"}",["T_WHITESPACE","\n\n    ",383],["T_DOC_COMMENT","\/**\n     * Prepare static entity fields\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",385],["T_WHITESPACE","\n    ",389],["T_PROTECTED","protected",390],["T_WHITESPACE"," ",390],["T_FUNCTION","function",390],["T_WHITESPACE"," ",390],["T_STRING","_prepareStaticFields",390],"(",")",["T_WHITESPACE","\n    ",390],"{",["T_WHITESPACE","\n        ",391],["T_IF","if",392],["T_WHITESPACE"," ",392],"(",["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","isEnabledFlat",392],"(",")",")",["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n            ",392],["T_RETURN","return",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$this",393],";",["T_WHITESPACE","\n        ",393],"}",["T_WHITESPACE","\n        ",394],["T_RETURN","return",395],["T_WHITESPACE"," ",395],["T_STRING","parent",395],["T_DOUBLE_COLON","::",395],["T_STRING","_prepareStaticFields",395],"(",")",";",["T_WHITESPACE","\n    ",395],"}",["T_WHITESPACE","\n\n    ",396],["T_DOC_COMMENT","\/**\n     * Retrieve collection empty item\n     * Redeclared for specifying id field name without getting resource model inside model\n     *\n     * @return Varien_Object\n     *\/",398],["T_WHITESPACE","\n    ",403],["T_PUBLIC","public",404],["T_WHITESPACE"," ",404],["T_FUNCTION","function",404],["T_WHITESPACE"," ",404],["T_STRING","getNewEmptyItem",404],"(",")",["T_WHITESPACE","\n    ",404],"{",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$object",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_STRING","parent",406],["T_DOUBLE_COLON","::",406],["T_STRING","getNewEmptyItem",406],"(",")",";",["T_WHITESPACE","\n        ",406],["T_IF","if",407],["T_WHITESPACE"," ",407],"(",["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","isEnabledFlat",407],"(",")",")",["T_WHITESPACE"," ",407],"{",["T_WHITESPACE","\n            ",407],["T_VARIABLE","$object",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","setIdFieldName",408],"(",["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getEntity",408],"(",")",["T_OBJECT_OPERATOR","->",408],["T_STRING","getIdFieldName",408],"(",")",")",";",["T_WHITESPACE","\n        ",408],"}",["T_WHITESPACE","\n        ",409],["T_RETURN","return",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$object",410],";",["T_WHITESPACE","\n    ",410],"}",["T_WHITESPACE","\n\n    ",411],["T_DOC_COMMENT","\/**\n     * Set entity to use for attributes\n     *\n     * @param Mage_Eav_Model_Entity_Abstract $entity\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",413],["T_WHITESPACE","\n    ",418],["T_PUBLIC","public",419],["T_WHITESPACE"," ",419],["T_FUNCTION","function",419],["T_WHITESPACE"," ",419],["T_STRING","setEntity",419],"(",["T_VARIABLE","$entity",419],")",["T_WHITESPACE","\n    ",419],"{",["T_WHITESPACE","\n        ",420],["T_IF","if",421],["T_WHITESPACE"," ",421],"(",["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","isEnabledFlat",421],"(",")",["T_WHITESPACE"," ",421],["T_BOOLEAN_AND","&&",421],["T_WHITESPACE"," ",421],"(",["T_VARIABLE","$entity",421],["T_WHITESPACE"," ",421],["T_INSTANCEOF","instanceof",421],["T_WHITESPACE"," ",421],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",421],")",")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n            ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_entity",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$entity",422],";",["T_WHITESPACE","\n            ",422],["T_RETURN","return",423],["T_WHITESPACE"," ",423],["T_VARIABLE","$this",423],";",["T_WHITESPACE","\n        ",423],"}",["T_WHITESPACE","\n        ",424],["T_RETURN","return",425],["T_WHITESPACE"," ",425],["T_STRING","parent",425],["T_DOUBLE_COLON","::",425],["T_STRING","setEntity",425],"(",["T_VARIABLE","$entity",425],")",";",["T_WHITESPACE","\n    ",425],"}",["T_WHITESPACE","\n\n    ",426],["T_DOC_COMMENT","\/**\n     * Set Store scope for collection\n     *\n     * @param mixed $store\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",428],["T_WHITESPACE","\n    ",433],["T_PUBLIC","public",434],["T_WHITESPACE"," ",434],["T_FUNCTION","function",434],["T_WHITESPACE"," ",434],["T_STRING","setStore",434],"(",["T_VARIABLE","$store",434],")",["T_WHITESPACE","\n    ",434],"{",["T_WHITESPACE","\n        ",435],["T_STRING","parent",436],["T_DOUBLE_COLON","::",436],["T_STRING","setStore",436],"(",["T_VARIABLE","$store",436],")",";",["T_WHITESPACE","\n        ",436],["T_IF","if",437],["T_WHITESPACE"," ",437],"(",["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","isEnabledFlat",437],"(",")",")",["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n            ",437],["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getEntity",438],"(",")",["T_OBJECT_OPERATOR","->",438],["T_STRING","setStoreId",438],"(",["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getStoreId",438],"(",")",")",";",["T_WHITESPACE","\n        ",438],"}",["T_WHITESPACE","\n        ",439],["T_RETURN","return",440],["T_WHITESPACE"," ",440],["T_VARIABLE","$this",440],";",["T_WHITESPACE","\n    ",440],"}",["T_WHITESPACE","\n\n    ",441],["T_DOC_COMMENT","\/**\n     * Initialize collection select\n     * Redeclared for remove entity_type_id condition\n     * in catalog_product_entity we store just products\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",443],["T_WHITESPACE","\n    ",449],["T_PROTECTED","protected",450],["T_WHITESPACE"," ",450],["T_FUNCTION","function",450],["T_WHITESPACE"," ",450],["T_STRING","_initSelect",450],"(",")",["T_WHITESPACE","\n    ",450],"{",["T_WHITESPACE","\n        ",451],["T_IF","if",452],["T_WHITESPACE"," ",452],"(",["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","isEnabledFlat",452],"(",")",")",["T_WHITESPACE"," ",452],"{",["T_WHITESPACE","\n            ",452],["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","getSelect",453],"(",")",["T_WHITESPACE","\n                ",453],["T_OBJECT_OPERATOR","->",454],["T_STRING","from",454],"(",["T_ARRAY","array",454],"(",["T_STRING","self",454],["T_DOUBLE_COLON","::",454],["T_STRING","MAIN_TABLE_ALIAS",454],["T_WHITESPACE"," ",454],["T_DOUBLE_ARROW","=>",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","getEntity",454],"(",")",["T_OBJECT_OPERATOR","->",454],["T_STRING","getFlatTableName",454],"(",")",")",",",["T_WHITESPACE"," ",454],["T_STRING","null",454],")",["T_WHITESPACE","\n                ",454],["T_OBJECT_OPERATOR","->",455],["T_STRING","where",455],"(",["T_CONSTANT_ENCAPSED_STRING","'e.status = ?'",455],",",["T_WHITESPACE"," ",455],["T_NEW","new",455],["T_WHITESPACE"," ",455],["T_STRING","Zend_Db_Expr",455],"(",["T_STRING","Mage_Catalog_Model_Product_Status",455],["T_DOUBLE_COLON","::",455],["T_STRING","STATUS_ENABLED",455],")",")",";",["T_WHITESPACE","\n            ",455],["T_VARIABLE","$this",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","addAttributeToSelect",456],"(",["T_ARRAY","array",456],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",456],",",["T_WHITESPACE"," ",456],["T_CONSTANT_ENCAPSED_STRING","'type_id'",456],",",["T_WHITESPACE"," ",456],["T_CONSTANT_ENCAPSED_STRING","'attribute_set_id'",456],")",")",";",["T_WHITESPACE","\n            ",456],["T_IF","if",457],["T_WHITESPACE"," ",457],"(",["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getFlatHelper",457],"(",")",["T_OBJECT_OPERATOR","->",457],["T_STRING","isAddChildData",457],"(",")",")",["T_WHITESPACE"," ",457],"{",["T_WHITESPACE","\n                ",457],["T_VARIABLE","$this",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getSelect",458],"(",")",["T_WHITESPACE","\n                    ",458],["T_OBJECT_OPERATOR","->",459],["T_STRING","where",459],"(",["T_CONSTANT_ENCAPSED_STRING","'e.is_child = ?'",459],",",["T_WHITESPACE"," ",459],["T_LNUMBER","0",459],")",";",["T_WHITESPACE","\n                ",459],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","addAttributeToSelect",460],"(",["T_ARRAY","array",460],"(",["T_CONSTANT_ENCAPSED_STRING","'child_id'",460],",",["T_WHITESPACE"," ",460],["T_CONSTANT_ENCAPSED_STRING","'is_child'",460],")",")",";",["T_WHITESPACE","\n            ",460],"}",["T_WHITESPACE","\n        ",461],"}",["T_WHITESPACE"," ",462],["T_ELSE","else",462],["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n            ",462],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getSelect",463],"(",")",["T_OBJECT_OPERATOR","->",463],["T_STRING","from",463],"(",["T_ARRAY","array",463],"(",["T_STRING","self",463],["T_DOUBLE_COLON","::",463],["T_STRING","MAIN_TABLE_ALIAS",463],["T_WHITESPACE"," ",463],["T_DOUBLE_ARROW","=>",463],["T_WHITESPACE"," ",463],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getEntity",463],"(",")",["T_OBJECT_OPERATOR","->",463],["T_STRING","getEntityTable",463],"(",")",")",")",";",["T_WHITESPACE","\n        ",463],"}",["T_WHITESPACE","\n        ",464],["T_RETURN","return",465],["T_WHITESPACE"," ",465],["T_VARIABLE","$this",465],";",["T_WHITESPACE","\n    ",465],"}",["T_WHITESPACE","\n\n    ",466],["T_DOC_COMMENT","\/**\n     * Load attributes into loaded entities\n     *\n     * @param bool $printQuery\n     * @param bool $logQuery\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",468],["T_WHITESPACE","\n    ",474],["T_PUBLIC","public",475],["T_WHITESPACE"," ",475],["T_FUNCTION","function",475],["T_WHITESPACE"," ",475],["T_STRING","_loadAttributes",475],"(",["T_VARIABLE","$printQuery",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_STRING","false",475],",",["T_WHITESPACE"," ",475],["T_VARIABLE","$logQuery",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_STRING","false",475],")",["T_WHITESPACE","\n    ",475],"{",["T_WHITESPACE","\n        ",476],["T_IF","if",477],["T_WHITESPACE"," ",477],"(",["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","isEnabledFlat",477],"(",")",")",["T_WHITESPACE"," ",477],"{",["T_WHITESPACE","\n            ",477],["T_RETURN","return",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],";",["T_WHITESPACE","\n        ",478],"}",["T_WHITESPACE","\n        ",479],["T_RETURN","return",480],["T_WHITESPACE"," ",480],["T_STRING","parent",480],["T_DOUBLE_COLON","::",480],["T_STRING","_loadAttributes",480],"(",["T_VARIABLE","$printQuery",480],",",["T_WHITESPACE"," ",480],["T_VARIABLE","$logQuery",480],")",";",["T_WHITESPACE","\n    ",480],"}",["T_WHITESPACE","\n\n    ",481],["T_DOC_COMMENT","\/**\n     * Add attribute to entities in collection\n     * If $attribute=='*' select all attributes\n     *\n     * @param array|string|integer|Mage_Core_Model_Config_Element $attribute\n     * @param false|string $joinType\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",483],["T_WHITESPACE","\n    ",490],["T_PUBLIC","public",491],["T_WHITESPACE"," ",491],["T_FUNCTION","function",491],["T_WHITESPACE"," ",491],["T_STRING","addAttributeToSelect",491],"(",["T_VARIABLE","$attribute",491],",",["T_WHITESPACE"," ",491],["T_VARIABLE","$joinType",491],["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_STRING","false",491],")",["T_WHITESPACE","\n    ",491],"{",["T_WHITESPACE","\n        ",492],["T_IF","if",493],["T_WHITESPACE"," ",493],"(",["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","isEnabledFlat",493],"(",")",")",["T_WHITESPACE"," ",493],"{",["T_WHITESPACE","\n            ",493],["T_IF","if",494],["T_WHITESPACE"," ",494],"(","!",["T_STRING","is_array",494],"(",["T_VARIABLE","$attribute",494],")",")",["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n                ",494],["T_VARIABLE","$attribute",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_ARRAY","array",495],"(",["T_VARIABLE","$attribute",495],")",";",["T_WHITESPACE","\n            ",495],"}",["T_WHITESPACE","\n            ",496],["T_FOREACH","foreach",497],["T_WHITESPACE"," ",497],"(",["T_VARIABLE","$attribute",497],["T_WHITESPACE"," ",497],["T_AS","as",497],["T_WHITESPACE"," ",497],["T_VARIABLE","$attributeCode",497],")",["T_WHITESPACE"," ",497],"{",["T_WHITESPACE","\n                ",497],["T_IF","if",498],["T_WHITESPACE"," ",498],"(",["T_VARIABLE","$attributeCode",498],["T_WHITESPACE"," ",498],["T_IS_EQUAL","==",498],["T_WHITESPACE"," ",498],["T_CONSTANT_ENCAPSED_STRING","'*'",498],")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n                    ",498],["T_FOREACH","foreach",499],["T_WHITESPACE"," ",499],"(",["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","getEntity",499],"(",")",["T_OBJECT_OPERATOR","->",499],["T_STRING","getAllTableColumns",499],"(",")",["T_WHITESPACE"," ",499],["T_AS","as",499],["T_WHITESPACE"," ",499],["T_VARIABLE","$column",499],")",["T_WHITESPACE"," ",499],"{",["T_WHITESPACE","\n                        ",499],["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getSelect",500],"(",")",["T_OBJECT_OPERATOR","->",500],["T_STRING","columns",500],"(",["T_CONSTANT_ENCAPSED_STRING","'e.'",500],["T_WHITESPACE"," ",500],".",["T_WHITESPACE"," ",500],["T_VARIABLE","$column",500],")",";",["T_WHITESPACE","\n                        ",500],["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","_selectAttributes",501],"[",["T_VARIABLE","$column",501],"]",["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_VARIABLE","$column",501],";",["T_WHITESPACE","\n                        ",501],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","_staticFields",502],"[",["T_VARIABLE","$column",502],"]",["T_WHITESPACE","     ",502],"=",["T_WHITESPACE"," ",502],["T_VARIABLE","$column",502],";",["T_WHITESPACE","\n                    ",502],"}",["T_WHITESPACE","\n                ",503],"}",["T_WHITESPACE"," ",504],["T_ELSE","else",504],["T_WHITESPACE"," ",504],"{",["T_WHITESPACE","\n                    ",504],["T_VARIABLE","$columns",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getEntity",505],"(",")",["T_OBJECT_OPERATOR","->",505],["T_STRING","getAttributeForSelect",505],"(",["T_VARIABLE","$attributeCode",505],")",";",["T_WHITESPACE","\n                    ",505],["T_IF","if",506],["T_WHITESPACE"," ",506],"(",["T_VARIABLE","$columns",506],")",["T_WHITESPACE"," ",506],"{",["T_WHITESPACE","\n                        ",506],["T_FOREACH","foreach",507],["T_WHITESPACE"," ",507],"(",["T_VARIABLE","$columns",507],["T_WHITESPACE"," ",507],["T_AS","as",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$alias",507],["T_WHITESPACE"," ",507],["T_DOUBLE_ARROW","=>",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$column",507],")",["T_WHITESPACE"," ",507],"{",["T_WHITESPACE","\n                            ",507],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","getSelect",508],"(",")",["T_OBJECT_OPERATOR","->",508],["T_STRING","columns",508],"(",["T_ARRAY","array",508],"(",["T_VARIABLE","$alias",508],["T_WHITESPACE"," ",508],["T_DOUBLE_ARROW","=>",508],["T_WHITESPACE"," ",508],["T_CONSTANT_ENCAPSED_STRING","'e.'",508],["T_WHITESPACE"," ",508],".",["T_WHITESPACE"," ",508],["T_VARIABLE","$column",508],")",")",";",["T_WHITESPACE","\n                            ",508],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","_selectAttributes",509],"[",["T_VARIABLE","$column",509],"]",["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$column",509],";",["T_WHITESPACE","\n                            ",509],["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","_staticFields",510],"[",["T_VARIABLE","$column",510],"]",["T_WHITESPACE","     ",510],"=",["T_WHITESPACE"," ",510],["T_VARIABLE","$column",510],";",["T_WHITESPACE","\n                        ",510],"}",["T_WHITESPACE","\n                    ",511],"}",["T_WHITESPACE","\n                ",512],"}",["T_WHITESPACE","\n            ",513],"}",["T_WHITESPACE","\n            ",514],["T_RETURN","return",515],["T_WHITESPACE"," ",515],["T_VARIABLE","$this",515],";",["T_WHITESPACE","\n        ",515],"}",["T_WHITESPACE","\n        ",516],["T_RETURN","return",517],["T_WHITESPACE"," ",517],["T_STRING","parent",517],["T_DOUBLE_COLON","::",517],["T_STRING","addAttributeToSelect",517],"(",["T_VARIABLE","$attribute",517],",",["T_WHITESPACE"," ",517],["T_VARIABLE","$joinType",517],")",";",["T_WHITESPACE","\n    ",517],"}",["T_WHITESPACE","\n\n    ",518],["T_DOC_COMMENT","\/**\n     * Add tax class id attribute to select and join price rules data if needed\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",520],["T_WHITESPACE","\n    ",524],["T_PROTECTED","protected",525],["T_WHITESPACE"," ",525],["T_FUNCTION","function",525],["T_WHITESPACE"," ",525],["T_STRING","_beforeLoad",525],"(",")",["T_WHITESPACE","\n    ",525],"{",["T_WHITESPACE","\n        ",526],["T_STRING","Mage",527],["T_DOUBLE_COLON","::",527],["T_STRING","dispatchEvent",527],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_collection_load_before'",527],",",["T_WHITESPACE"," ",527],["T_ARRAY","array",527],"(",["T_CONSTANT_ENCAPSED_STRING","'collection'",527],["T_WHITESPACE"," ",527],["T_DOUBLE_ARROW","=>",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$this",527],")",")",";",["T_WHITESPACE","\n\n        ",527],["T_RETURN","return",529],["T_WHITESPACE"," ",529],["T_STRING","parent",529],["T_DOUBLE_COLON","::",529],["T_STRING","_beforeLoad",529],"(",")",";",["T_WHITESPACE","\n    ",529],"}",["T_WHITESPACE","\n\n    ",530],["T_DOC_COMMENT","\/**\n     * Processing collection items after loading\n     * Adding url rewrites, minimal prices, final prices, tax percents\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",532],["T_WHITESPACE","\n    ",537],["T_PROTECTED","protected",538],["T_WHITESPACE"," ",538],["T_FUNCTION","function",538],["T_WHITESPACE"," ",538],["T_STRING","_afterLoad",538],"(",")",["T_WHITESPACE","\n    ",538],"{",["T_WHITESPACE","\n        ",539],["T_IF","if",540],["T_WHITESPACE"," ",540],"(",["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","_addUrlRewrite",540],")",["T_WHITESPACE"," ",540],"{",["T_WHITESPACE","\n           ",540],["T_VARIABLE","$this",541],["T_OBJECT_OPERATOR","->",541],["T_STRING","_addUrlRewrite",541],"(",["T_VARIABLE","$this",541],["T_OBJECT_OPERATOR","->",541],["T_STRING","_urlRewriteCategory",541],")",";",["T_WHITESPACE","\n        ",541],"}",["T_WHITESPACE","\n\n        ",542],["T_IF","if",544],["T_WHITESPACE"," ",544],"(",["T_STRING","count",544],"(",["T_VARIABLE","$this",544],")",["T_WHITESPACE"," ",544],">",["T_WHITESPACE"," ",544],["T_LNUMBER","0",544],")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n            ",544],["T_STRING","Mage",545],["T_DOUBLE_COLON","::",545],["T_STRING","dispatchEvent",545],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_collection_load_after'",545],",",["T_WHITESPACE"," ",545],["T_ARRAY","array",545],"(",["T_CONSTANT_ENCAPSED_STRING","'collection'",545],["T_WHITESPACE"," ",545],["T_DOUBLE_ARROW","=>",545],["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],")",")",";",["T_WHITESPACE","\n        ",545],"}",["T_WHITESPACE","\n\n        ",546],["T_FOREACH","foreach",548],["T_WHITESPACE"," ",548],"(",["T_VARIABLE","$this",548],["T_WHITESPACE"," ",548],["T_AS","as",548],["T_WHITESPACE"," ",548],["T_VARIABLE","$product",548],")",["T_WHITESPACE"," ",548],"{",["T_WHITESPACE","\n            ",548],["T_IF","if",549],["T_WHITESPACE"," ",549],"(",["T_VARIABLE","$product",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","isRecurring",549],"(",")",["T_WHITESPACE"," ",549],["T_BOOLEAN_AND","&&",549],["T_WHITESPACE"," ",549],["T_VARIABLE","$profile",549],["T_WHITESPACE"," ",549],"=",["T_WHITESPACE"," ",549],["T_VARIABLE","$product",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getRecurringProfile",549],"(",")",")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n                ",549],["T_VARIABLE","$product",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","setRecurringProfile",550],"(",["T_STRING","unserialize",550],"(",["T_VARIABLE","$profile",550],")",")",";",["T_WHITESPACE","\n            ",550],"}",["T_WHITESPACE","\n        ",551],"}",["T_WHITESPACE","\n\n        ",552],["T_RETURN","return",554],["T_WHITESPACE"," ",554],["T_VARIABLE","$this",554],";",["T_WHITESPACE","\n    ",554],"}",["T_WHITESPACE","\n\n    ",555],["T_DOC_COMMENT","\/**\n     * Prepare Url Data object\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     * @deprecated after 1.7.0.2\n     *\/",557],["T_WHITESPACE","\n    ",562],["T_PROTECTED","protected",563],["T_WHITESPACE"," ",563],["T_FUNCTION","function",563],["T_WHITESPACE"," ",563],["T_STRING","_prepareUrlDataObject",563],"(",")",["T_WHITESPACE","\n    ",563],"{",["T_WHITESPACE","\n        ",564],["T_VARIABLE","$objects",565],["T_WHITESPACE"," ",565],"=",["T_WHITESPACE"," ",565],["T_ARRAY","array",565],"(",")",";",["T_WHITESPACE","\n        ",565],["T_DOC_COMMENT","\/** @var $item Mage_Catalog_Model_Product *\/",566],["T_WHITESPACE","\n        ",566],["T_FOREACH","foreach",567],["T_WHITESPACE"," ",567],"(",["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","_items",567],["T_WHITESPACE"," ",567],["T_AS","as",567],["T_WHITESPACE"," ",567],["T_VARIABLE","$item",567],")",["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n            ",567],["T_IF","if",568],["T_WHITESPACE"," ",568],"(",["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getFlag",568],"(",["T_CONSTANT_ENCAPSED_STRING","'do_not_use_category_id'",568],")",")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n                ",568],["T_VARIABLE","$item",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","setDoNotUseCategoryId",569],"(",["T_STRING","true",569],")",";",["T_WHITESPACE","\n            ",569],"}",["T_WHITESPACE","\n            ",570],["T_IF","if",571],["T_WHITESPACE"," ",571],"(","!",["T_VARIABLE","$item",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","isVisibleInSiteVisibility",571],"(",")",["T_WHITESPACE"," ",571],["T_BOOLEAN_AND","&&",571],["T_WHITESPACE"," ",571],["T_VARIABLE","$item",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","getItemStoreId",571],"(",")",")",["T_WHITESPACE"," ",571],"{",["T_WHITESPACE","\n                ",571],["T_VARIABLE","$objects",572],"[",["T_VARIABLE","$item",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","getEntityId",572],"(",")","]",["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$item",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","getItemStoreId",572],"(",")",";",["T_WHITESPACE","\n            ",572],"}",["T_WHITESPACE","\n        ",573],"}",["T_WHITESPACE","\n\n        ",574],["T_IF","if",576],["T_WHITESPACE"," ",576],"(",["T_VARIABLE","$objects",576],["T_WHITESPACE"," ",576],["T_BOOLEAN_AND","&&",576],["T_WHITESPACE"," ",576],["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","hasFlag",576],"(",["T_CONSTANT_ENCAPSED_STRING","'url_data_object'",576],")",")",["T_WHITESPACE"," ",576],"{",["T_WHITESPACE","\n            ",576],["T_VARIABLE","$objects",577],["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_STRING","Mage",577],["T_DOUBLE_COLON","::",577],["T_STRING","getResourceSingleton",577],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/url'",577],")",["T_WHITESPACE","\n                ",577],["T_OBJECT_OPERATOR","->",578],["T_STRING","getRewriteByProductStore",578],"(",["T_VARIABLE","$objects",578],")",";",["T_WHITESPACE","\n            ",578],["T_FOREACH","foreach",579],["T_WHITESPACE"," ",579],"(",["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","_items",579],["T_WHITESPACE"," ",579],["T_AS","as",579],["T_WHITESPACE"," ",579],["T_VARIABLE","$item",579],")",["T_WHITESPACE"," ",579],"{",["T_WHITESPACE","\n                ",579],["T_IF","if",580],["T_WHITESPACE"," ",580],"(",["T_ISSET","isset",580],"(",["T_VARIABLE","$objects",580],"[",["T_VARIABLE","$item",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getEntityId",580],"(",")","]",")",")",["T_WHITESPACE"," ",580],"{",["T_WHITESPACE","\n                    ",580],["T_VARIABLE","$object",581],["T_WHITESPACE"," ",581],"=",["T_WHITESPACE"," ",581],["T_NEW","new",581],["T_WHITESPACE"," ",581],["T_STRING","Varien_Object",581],"(",["T_VARIABLE","$objects",581],"[",["T_VARIABLE","$item",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","getEntityId",581],"(",")","]",")",";",["T_WHITESPACE","\n                    ",581],["T_VARIABLE","$item",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","setUrlDataObject",582],"(",["T_VARIABLE","$object",582],")",";",["T_WHITESPACE","\n                ",582],"}",["T_WHITESPACE","\n            ",583],"}",["T_WHITESPACE","\n        ",584],"}",["T_WHITESPACE","\n\n        ",585],["T_RETURN","return",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$this",587],";",["T_WHITESPACE","\n    ",587],"}",["T_WHITESPACE","\n\n    ",588],["T_DOC_COMMENT","\/**\n     * Add collection filters by identifiers\n     *\n     * @param mixed $productId\n     * @param boolean $exclude\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",590],["T_WHITESPACE","\n    ",596],["T_PUBLIC","public",597],["T_WHITESPACE"," ",597],["T_FUNCTION","function",597],["T_WHITESPACE"," ",597],["T_STRING","addIdFilter",597],"(",["T_VARIABLE","$productId",597],",",["T_WHITESPACE"," ",597],["T_VARIABLE","$exclude",597],["T_WHITESPACE"," ",597],"=",["T_WHITESPACE"," ",597],["T_STRING","false",597],")",["T_WHITESPACE","\n    ",597],"{",["T_WHITESPACE","\n        ",598],["T_IF","if",599],["T_WHITESPACE"," ",599],"(",["T_EMPTY","empty",599],"(",["T_VARIABLE","$productId",599],")",")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n            ",599],["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","_setIsLoaded",600],"(",["T_STRING","true",600],")",";",["T_WHITESPACE","\n            ",600],["T_RETURN","return",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$this",601],";",["T_WHITESPACE","\n        ",601],"}",["T_WHITESPACE","\n        ",602],["T_IF","if",603],["T_WHITESPACE"," ",603],"(",["T_STRING","is_array",603],"(",["T_VARIABLE","$productId",603],")",")",["T_WHITESPACE"," ",603],"{",["T_WHITESPACE","\n            ",603],["T_IF","if",604],["T_WHITESPACE"," ",604],"(","!",["T_EMPTY","empty",604],"(",["T_VARIABLE","$productId",604],")",")",["T_WHITESPACE"," ",604],"{",["T_WHITESPACE","\n                ",604],["T_IF","if",605],["T_WHITESPACE"," ",605],"(",["T_VARIABLE","$exclude",605],")",["T_WHITESPACE"," ",605],"{",["T_WHITESPACE","\n                    ",605],["T_VARIABLE","$condition",606],["T_WHITESPACE"," ",606],"=",["T_WHITESPACE"," ",606],["T_ARRAY","array",606],"(",["T_CONSTANT_ENCAPSED_STRING","'nin'",606],["T_WHITESPACE"," ",606],["T_DOUBLE_ARROW","=>",606],["T_WHITESPACE"," ",606],["T_VARIABLE","$productId",606],")",";",["T_WHITESPACE","\n                ",606],"}",["T_WHITESPACE"," ",607],["T_ELSE","else",607],["T_WHITESPACE"," ",607],"{",["T_WHITESPACE","\n                    ",607],["T_VARIABLE","$condition",608],["T_WHITESPACE"," ",608],"=",["T_WHITESPACE"," ",608],["T_ARRAY","array",608],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",608],["T_WHITESPACE"," ",608],["T_DOUBLE_ARROW","=>",608],["T_WHITESPACE"," ",608],["T_VARIABLE","$productId",608],")",";",["T_WHITESPACE","\n                ",608],"}",["T_WHITESPACE","\n            ",609],"}",["T_WHITESPACE"," ",610],["T_ELSE","else",610],["T_WHITESPACE"," ",610],"{",["T_WHITESPACE","\n                ",610],["T_VARIABLE","$condition",611],["T_WHITESPACE"," ",611],"=",["T_WHITESPACE"," ",611],["T_CONSTANT_ENCAPSED_STRING","''",611],";",["T_WHITESPACE","\n            ",611],"}",["T_WHITESPACE","\n        ",612],"}",["T_WHITESPACE"," ",613],["T_ELSE","else",613],["T_WHITESPACE"," ",613],"{",["T_WHITESPACE","\n            ",613],["T_IF","if",614],["T_WHITESPACE"," ",614],"(",["T_VARIABLE","$exclude",614],")",["T_WHITESPACE"," ",614],"{",["T_WHITESPACE","\n                ",614],["T_VARIABLE","$condition",615],["T_WHITESPACE"," ",615],"=",["T_WHITESPACE"," ",615],["T_ARRAY","array",615],"(",["T_CONSTANT_ENCAPSED_STRING","'neq'",615],["T_WHITESPACE"," ",615],["T_DOUBLE_ARROW","=>",615],["T_WHITESPACE"," ",615],["T_VARIABLE","$productId",615],")",";",["T_WHITESPACE","\n            ",615],"}",["T_WHITESPACE"," ",616],["T_ELSE","else",616],["T_WHITESPACE"," ",616],"{",["T_WHITESPACE","\n                ",616],["T_VARIABLE","$condition",617],["T_WHITESPACE"," ",617],"=",["T_WHITESPACE"," ",617],["T_VARIABLE","$productId",617],";",["T_WHITESPACE","\n            ",617],"}",["T_WHITESPACE","\n        ",618],"}",["T_WHITESPACE","\n        ",619],["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","addFieldToFilter",620],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",620],",",["T_WHITESPACE"," ",620],["T_VARIABLE","$condition",620],")",";",["T_WHITESPACE","\n        ",620],["T_RETURN","return",621],["T_WHITESPACE"," ",621],["T_VARIABLE","$this",621],";",["T_WHITESPACE","\n    ",621],"}",["T_WHITESPACE","\n\n    ",622],["T_DOC_COMMENT","\/**\n     * Adding product website names to result collection\n     * Add for each product websites information\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",624],["T_WHITESPACE","\n    ",629],["T_PUBLIC","public",630],["T_WHITESPACE"," ",630],["T_FUNCTION","function",630],["T_WHITESPACE"," ",630],["T_STRING","addWebsiteNamesToResult",630],"(",")",["T_WHITESPACE","\n    ",630],"{",["T_WHITESPACE","\n        ",631],["T_VARIABLE","$productWebsites",632],["T_WHITESPACE"," ",632],"=",["T_WHITESPACE"," ",632],["T_ARRAY","array",632],"(",")",";",["T_WHITESPACE","\n        ",632],["T_FOREACH","foreach",633],["T_WHITESPACE"," ",633],"(",["T_VARIABLE","$this",633],["T_WHITESPACE"," ",633],["T_AS","as",633],["T_WHITESPACE"," ",633],["T_VARIABLE","$product",633],")",["T_WHITESPACE"," ",633],"{",["T_WHITESPACE","\n            ",633],["T_VARIABLE","$productWebsites",634],"[",["T_VARIABLE","$product",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","getId",634],"(",")","]",["T_WHITESPACE"," ",634],"=",["T_WHITESPACE"," ",634],["T_ARRAY","array",634],"(",")",";",["T_WHITESPACE","\n        ",634],"}",["T_WHITESPACE","\n\n        ",635],["T_IF","if",637],["T_WHITESPACE"," ",637],"(","!",["T_EMPTY","empty",637],"(",["T_VARIABLE","$productWebsites",637],")",")",["T_WHITESPACE"," ",637],"{",["T_WHITESPACE","\n            ",637],["T_VARIABLE","$select",638],["T_WHITESPACE"," ",638],"=",["T_WHITESPACE"," ",638],["T_VARIABLE","$this",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","getConnection",638],"(",")",["T_OBJECT_OPERATOR","->",638],["T_STRING","select",638],"(",")",["T_WHITESPACE","\n                ",638],["T_OBJECT_OPERATOR","->",639],["T_STRING","from",639],"(",["T_ARRAY","array",639],"(",["T_CONSTANT_ENCAPSED_STRING","'product_website'",639],["T_WHITESPACE"," ",639],["T_DOUBLE_ARROW","=>",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$this",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","_productWebsiteTable",639],")",")",["T_WHITESPACE","\n                ",639],["T_OBJECT_OPERATOR","->",640],["T_STRING","join",640],"(",["T_WHITESPACE","\n                    ",640],["T_ARRAY","array",641],"(",["T_CONSTANT_ENCAPSED_STRING","'website'",641],["T_WHITESPACE"," ",641],["T_DOUBLE_ARROW","=>",641],["T_WHITESPACE"," ",641],["T_VARIABLE","$this",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","getResource",641],"(",")",["T_OBJECT_OPERATOR","->",641],["T_STRING","getTable",641],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",641],")",")",",",["T_WHITESPACE","\n                    ",641],["T_CONSTANT_ENCAPSED_STRING","'website.website_id = product_website.website_id'",642],",",["T_WHITESPACE","\n                    ",642],["T_ARRAY","array",643],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",643],")",")",["T_WHITESPACE","\n                ",643],["T_OBJECT_OPERATOR","->",644],["T_STRING","where",644],"(",["T_CONSTANT_ENCAPSED_STRING","'product_website.product_id IN (?)'",644],",",["T_WHITESPACE"," ",644],["T_STRING","array_keys",644],"(",["T_VARIABLE","$productWebsites",644],")",")",["T_WHITESPACE","\n                ",644],["T_OBJECT_OPERATOR","->",645],["T_STRING","where",645],"(",["T_CONSTANT_ENCAPSED_STRING","'website.website_id > ?'",645],",",["T_WHITESPACE"," ",645],["T_LNUMBER","0",645],")",";",["T_WHITESPACE","\n\n            ",645],["T_VARIABLE","$data",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_VARIABLE","$this",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","getConnection",647],"(",")",["T_OBJECT_OPERATOR","->",647],["T_STRING","fetchAll",647],"(",["T_VARIABLE","$select",647],")",";",["T_WHITESPACE","\n            ",647],["T_FOREACH","foreach",648],["T_WHITESPACE"," ",648],"(",["T_VARIABLE","$data",648],["T_WHITESPACE"," ",648],["T_AS","as",648],["T_WHITESPACE"," ",648],["T_VARIABLE","$row",648],")",["T_WHITESPACE"," ",648],"{",["T_WHITESPACE","\n                ",648],["T_VARIABLE","$productWebsites",649],"[",["T_VARIABLE","$row",649],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",649],"]","]","[","]",["T_WHITESPACE"," ",649],"=",["T_WHITESPACE"," ",649],["T_VARIABLE","$row",649],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",649],"]",";",["T_WHITESPACE","\n            ",649],"}",["T_WHITESPACE","\n        ",650],"}",["T_WHITESPACE","\n\n        ",651],["T_FOREACH","foreach",653],["T_WHITESPACE"," ",653],"(",["T_VARIABLE","$this",653],["T_WHITESPACE"," ",653],["T_AS","as",653],["T_WHITESPACE"," ",653],["T_VARIABLE","$product",653],")",["T_WHITESPACE"," ",653],"{",["T_WHITESPACE","\n            ",653],["T_IF","if",654],["T_WHITESPACE"," ",654],"(",["T_ISSET","isset",654],"(",["T_VARIABLE","$productWebsites",654],"[",["T_VARIABLE","$product",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","getId",654],"(",")","]",")",")",["T_WHITESPACE"," ",654],"{",["T_WHITESPACE","\n                ",654],["T_VARIABLE","$product",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","setData",655],"(",["T_CONSTANT_ENCAPSED_STRING","'websites'",655],",",["T_WHITESPACE"," ",655],["T_VARIABLE","$productWebsites",655],"[",["T_VARIABLE","$product",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","getId",655],"(",")","]",")",";",["T_WHITESPACE","\n            ",655],"}",["T_WHITESPACE","\n        ",656],"}",["T_WHITESPACE","\n        ",657],["T_RETURN","return",658],["T_WHITESPACE"," ",658],["T_VARIABLE","$this",658],";",["T_WHITESPACE","\n    ",658],"}",["T_WHITESPACE","\n\n    ",659],["T_DOC_COMMENT","\/**\n     * Add store availability filter. Include availability product\n     * for store website\n     *\n     * @param mixed $store\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",661],["T_WHITESPACE","\n    ",667],["T_PUBLIC","public",668],["T_WHITESPACE"," ",668],["T_FUNCTION","function",668],["T_WHITESPACE"," ",668],["T_STRING","addStoreFilter",668],"(",["T_VARIABLE","$store",668],["T_WHITESPACE"," ",668],"=",["T_WHITESPACE"," ",668],["T_STRING","null",668],")",["T_WHITESPACE","\n    ",668],"{",["T_WHITESPACE","\n        ",669],["T_IF","if",670],["T_WHITESPACE"," ",670],"(",["T_VARIABLE","$store",670],["T_WHITESPACE"," ",670],["T_IS_IDENTICAL","===",670],["T_WHITESPACE"," ",670],["T_STRING","null",670],")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n            ",670],["T_VARIABLE","$store",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","getStoreId",671],"(",")",";",["T_WHITESPACE","\n        ",671],"}",["T_WHITESPACE","\n        ",672],["T_VARIABLE","$store",673],["T_WHITESPACE"," ",673],"=",["T_WHITESPACE"," ",673],["T_STRING","Mage",673],["T_DOUBLE_COLON","::",673],["T_STRING","app",673],"(",")",["T_OBJECT_OPERATOR","->",673],["T_STRING","getStore",673],"(",["T_VARIABLE","$store",673],")",";",["T_WHITESPACE","\n\n        ",673],["T_IF","if",675],["T_WHITESPACE"," ",675],"(","!",["T_VARIABLE","$store",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","isAdmin",675],"(",")",")",["T_WHITESPACE"," ",675],"{",["T_WHITESPACE","\n            ",675],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","_productLimitationFilters",676],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",676],"]",["T_WHITESPACE"," ",676],"=",["T_WHITESPACE"," ",676],["T_VARIABLE","$store",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getId",676],"(",")",";",["T_WHITESPACE","\n            ",676],["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","_applyProductLimitations",677],"(",")",";",["T_WHITESPACE","\n        ",677],"}",["T_WHITESPACE","\n\n        ",678],["T_RETURN","return",680],["T_WHITESPACE"," ",680],["T_VARIABLE","$this",680],";",["T_WHITESPACE","\n    ",680],"}",["T_WHITESPACE","\n\n    ",681],["T_DOC_COMMENT","\/**\n     * Add website filter to collection\n     *\n     * @param unknown_type $websites\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",683],["T_WHITESPACE","\n    ",688],["T_PUBLIC","public",689],["T_WHITESPACE"," ",689],["T_FUNCTION","function",689],["T_WHITESPACE"," ",689],["T_STRING","addWebsiteFilter",689],"(",["T_VARIABLE","$websites",689],["T_WHITESPACE"," ",689],"=",["T_WHITESPACE"," ",689],["T_STRING","null",689],")",["T_WHITESPACE","\n    ",689],"{",["T_WHITESPACE","\n        ",690],["T_IF","if",691],["T_WHITESPACE"," ",691],"(","!",["T_STRING","is_array",691],"(",["T_VARIABLE","$websites",691],")",")",["T_WHITESPACE"," ",691],"{",["T_WHITESPACE","\n            ",691],["T_VARIABLE","$websites",692],["T_WHITESPACE"," ",692],"=",["T_WHITESPACE"," ",692],["T_ARRAY","array",692],"(",["T_STRING","Mage",692],["T_DOUBLE_COLON","::",692],["T_STRING","app",692],"(",")",["T_OBJECT_OPERATOR","->",692],["T_STRING","getWebsite",692],"(",["T_VARIABLE","$websites",692],")",["T_OBJECT_OPERATOR","->",692],["T_STRING","getId",692],"(",")",")",";",["T_WHITESPACE","\n        ",692],"}",["T_WHITESPACE","\n\n        ",693],["T_VARIABLE","$this",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","_productLimitationFilters",695],"[",["T_CONSTANT_ENCAPSED_STRING","'website_ids'",695],"]",["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_VARIABLE","$websites",695],";",["T_WHITESPACE","\n        ",695],["T_VARIABLE","$this",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","_applyProductLimitations",696],"(",")",";",["T_WHITESPACE","\n\n        ",696],["T_RETURN","return",698],["T_WHITESPACE"," ",698],["T_VARIABLE","$this",698],";",["T_WHITESPACE","\n    ",698],"}",["T_WHITESPACE","\n\n    ",699],["T_DOC_COMMENT","\/**\n     * Get filters applied to collection\n     *\n     * @return array\n     *\/",701],["T_WHITESPACE","\n    ",705],["T_PUBLIC","public",706],["T_WHITESPACE"," ",706],["T_FUNCTION","function",706],["T_WHITESPACE"," ",706],["T_STRING","getLimitationFilters",706],"(",")",["T_WHITESPACE","\n    ",706],"{",["T_WHITESPACE","\n        ",707],["T_RETURN","return",708],["T_WHITESPACE"," ",708],["T_VARIABLE","$this",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","_productLimitationFilters",708],";",["T_WHITESPACE","\n    ",708],"}",["T_WHITESPACE","\n\n    ",709],["T_DOC_COMMENT","\/**\n     * Specify category filter for product collection\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",711],["T_WHITESPACE","\n    ",716],["T_PUBLIC","public",717],["T_WHITESPACE"," ",717],["T_FUNCTION","function",717],["T_WHITESPACE"," ",717],["T_STRING","addCategoryFilter",717],"(",["T_STRING","Mage_Catalog_Model_Category",717],["T_WHITESPACE"," ",717],["T_VARIABLE","$category",717],")",["T_WHITESPACE","\n    ",717],"{",["T_WHITESPACE","\n        ",718],["T_VARIABLE","$this",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","_productLimitationFilters",719],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",719],"]",["T_WHITESPACE"," ",719],"=",["T_WHITESPACE"," ",719],["T_VARIABLE","$category",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","getId",719],"(",")",";",["T_WHITESPACE","\n        ",719],["T_IF","if",720],["T_WHITESPACE"," ",720],"(",["T_VARIABLE","$category",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","getIsAnchor",720],"(",")",")",["T_WHITESPACE"," ",720],"{",["T_WHITESPACE","\n            ",720],["T_UNSET","unset",721],"(",["T_VARIABLE","$this",721],["T_OBJECT_OPERATOR","->",721],["T_STRING","_productLimitationFilters",721],"[",["T_CONSTANT_ENCAPSED_STRING","'category_is_anchor'",721],"]",")",";",["T_WHITESPACE","\n        ",721],"}",["T_WHITESPACE"," ",722],["T_ELSE","else",722],["T_WHITESPACE"," ",722],"{",["T_WHITESPACE","\n            ",722],["T_VARIABLE","$this",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","_productLimitationFilters",723],"[",["T_CONSTANT_ENCAPSED_STRING","'category_is_anchor'",723],"]",["T_WHITESPACE"," ",723],"=",["T_WHITESPACE"," ",723],["T_LNUMBER","1",723],";",["T_WHITESPACE","\n        ",723],"}",["T_WHITESPACE","\n\n        ",724],["T_IF","if",726],["T_WHITESPACE"," ",726],"(",["T_VARIABLE","$this",726],["T_OBJECT_OPERATOR","->",726],["T_STRING","getStoreId",726],"(",")",["T_WHITESPACE"," ",726],["T_IS_EQUAL","==",726],["T_WHITESPACE"," ",726],["T_STRING","Mage_Catalog_Model_Abstract",726],["T_DOUBLE_COLON","::",726],["T_STRING","DEFAULT_STORE_ID",726],")",["T_WHITESPACE"," ",726],"{",["T_WHITESPACE","\n            ",726],["T_VARIABLE","$this",727],["T_OBJECT_OPERATOR","->",727],["T_STRING","_applyZeroStoreProductLimitations",727],"(",")",";",["T_WHITESPACE","\n        ",727],"}",["T_WHITESPACE"," ",728],["T_ELSE","else",728],["T_WHITESPACE"," ",728],"{",["T_WHITESPACE","\n            ",728],["T_VARIABLE","$this",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","_applyProductLimitations",729],"(",")",";",["T_WHITESPACE","\n        ",729],"}",["T_WHITESPACE","\n\n        ",730],["T_RETURN","return",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$this",732],";",["T_WHITESPACE","\n    ",732],"}",["T_WHITESPACE","\n\n    ",733],["T_DOC_COMMENT","\/**\n     * Join minimal price attribute to result\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",735],["T_WHITESPACE","\n    ",739],["T_PUBLIC","public",740],["T_WHITESPACE"," ",740],["T_FUNCTION","function",740],["T_WHITESPACE"," ",740],["T_STRING","joinMinimalPrice",740],"(",")",["T_WHITESPACE","\n    ",740],"{",["T_WHITESPACE","\n        ",741],["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","addAttributeToSelect",742],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",742],")",["T_WHITESPACE","\n             ",742],["T_OBJECT_OPERATOR","->",743],["T_STRING","addAttributeToSelect",743],"(",["T_CONSTANT_ENCAPSED_STRING","'minimal_price'",743],")",";",["T_WHITESPACE","\n        ",743],["T_RETURN","return",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$this",744],";",["T_WHITESPACE","\n    ",744],"}",["T_WHITESPACE","\n\n    ",745],["T_DOC_COMMENT","\/**\n     * Retrieve max value by attribute\n     *\n     * @param string $attribute\n     * @return mixed\n     *\/",747],["T_WHITESPACE","\n    ",752],["T_PUBLIC","public",753],["T_WHITESPACE"," ",753],["T_FUNCTION","function",753],["T_WHITESPACE"," ",753],["T_STRING","getMaxAttributeValue",753],"(",["T_VARIABLE","$attribute",753],")",["T_WHITESPACE","\n    ",753],"{",["T_WHITESPACE","\n        ",754],["T_VARIABLE","$select",755],["T_WHITESPACE","        ",755],"=",["T_WHITESPACE"," ",755],["T_CLONE","clone",755],["T_WHITESPACE"," ",755],["T_VARIABLE","$this",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","getSelect",755],"(",")",";",["T_WHITESPACE","\n        ",755],["T_VARIABLE","$attribute",756],["T_WHITESPACE","     ",756],"=",["T_WHITESPACE"," ",756],["T_VARIABLE","$this",756],["T_OBJECT_OPERATOR","->",756],["T_STRING","getEntity",756],"(",")",["T_OBJECT_OPERATOR","->",756],["T_STRING","getAttribute",756],"(",["T_VARIABLE","$attribute",756],")",";",["T_WHITESPACE","\n        ",756],["T_VARIABLE","$attributeCode",757],["T_WHITESPACE"," ",757],"=",["T_WHITESPACE"," ",757],["T_VARIABLE","$attribute",757],["T_OBJECT_OPERATOR","->",757],["T_STRING","getAttributeCode",757],"(",")",";",["T_WHITESPACE","\n        ",757],["T_VARIABLE","$tableAlias",758],["T_WHITESPACE","    ",758],"=",["T_WHITESPACE"," ",758],["T_VARIABLE","$attributeCode",758],["T_WHITESPACE"," ",758],".",["T_WHITESPACE"," ",758],["T_CONSTANT_ENCAPSED_STRING","'_max_value'",758],";",["T_WHITESPACE","\n        ",758],["T_VARIABLE","$fieldAlias",759],["T_WHITESPACE","    ",759],"=",["T_WHITESPACE"," ",759],["T_CONSTANT_ENCAPSED_STRING","'max_'",759],["T_WHITESPACE"," ",759],".",["T_WHITESPACE"," ",759],["T_VARIABLE","$attributeCode",759],";",["T_WHITESPACE","\n        ",759],["T_VARIABLE","$condition",760],["T_WHITESPACE","  ",760],"=",["T_WHITESPACE"," ",760],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = '",760],["T_WHITESPACE"," ",760],".",["T_WHITESPACE"," ",760],["T_VARIABLE","$tableAlias",760],["T_WHITESPACE"," ",760],".",["T_WHITESPACE"," ",760],["T_CONSTANT_ENCAPSED_STRING","'.entity_id\n            AND '",760],".",["T_VARIABLE","$this",761],["T_OBJECT_OPERATOR","->",761],["T_STRING","_getConditionSql",761],"(",["T_VARIABLE","$tableAlias",761],["T_WHITESPACE"," ",761],".",["T_WHITESPACE"," ",761],["T_CONSTANT_ENCAPSED_STRING","'.attribute_id'",761],",",["T_WHITESPACE"," ",761],["T_VARIABLE","$attribute",761],["T_OBJECT_OPERATOR","->",761],["T_STRING","getId",761],"(",")",")",";",["T_WHITESPACE","\n\n        ",761],["T_VARIABLE","$select",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","join",763],"(",["T_WHITESPACE","\n                ",763],["T_ARRAY","array",764],"(",["T_VARIABLE","$tableAlias",764],["T_WHITESPACE"," ",764],["T_DOUBLE_ARROW","=>",764],["T_WHITESPACE"," ",764],["T_VARIABLE","$attribute",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","getBackend",764],"(",")",["T_OBJECT_OPERATOR","->",764],["T_STRING","getTable",764],"(",")",")",",",["T_WHITESPACE","\n                ",764],["T_VARIABLE","$condition",765],",",["T_WHITESPACE","\n                ",765],["T_ARRAY","array",766],"(",["T_VARIABLE","$fieldAlias",766],["T_WHITESPACE"," ",766],["T_DOUBLE_ARROW","=>",766],["T_WHITESPACE"," ",766],["T_NEW","new",766],["T_WHITESPACE"," ",766],["T_STRING","Zend_Db_Expr",766],"(",["T_CONSTANT_ENCAPSED_STRING","'MAX('",766],".",["T_VARIABLE","$tableAlias",766],".",["T_CONSTANT_ENCAPSED_STRING","'.value)'",766],")",")",["T_WHITESPACE","\n            ",766],")",["T_WHITESPACE","\n            ",767],["T_OBJECT_OPERATOR","->",768],["T_STRING","group",768],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_type_id'",768],")",";",["T_WHITESPACE","\n\n        ",768],["T_VARIABLE","$data",770],["T_WHITESPACE"," ",770],"=",["T_WHITESPACE"," ",770],["T_VARIABLE","$this",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","getConnection",770],"(",")",["T_OBJECT_OPERATOR","->",770],["T_STRING","fetchRow",770],"(",["T_VARIABLE","$select",770],")",";",["T_WHITESPACE","\n        ",770],["T_IF","if",771],["T_WHITESPACE"," ",771],"(",["T_ISSET","isset",771],"(",["T_VARIABLE","$data",771],"[",["T_VARIABLE","$fieldAlias",771],"]",")",")",["T_WHITESPACE"," ",771],"{",["T_WHITESPACE","\n            ",771],["T_RETURN","return",772],["T_WHITESPACE"," ",772],["T_VARIABLE","$data",772],"[",["T_VARIABLE","$fieldAlias",772],"]",";",["T_WHITESPACE","\n        ",772],"}",["T_WHITESPACE","\n\n        ",773],["T_RETURN","return",775],["T_WHITESPACE"," ",775],["T_STRING","null",775],";",["T_WHITESPACE","\n    ",775],"}",["T_WHITESPACE","\n\n    ",776],["T_DOC_COMMENT","\/**\n     * Retrieve ranging product count for arrtibute range\n     *\n     * @param string $attribute\n     * @param int $range\n     * @return array\n     *\/",778],["T_WHITESPACE","\n    ",784],["T_PUBLIC","public",785],["T_WHITESPACE"," ",785],["T_FUNCTION","function",785],["T_WHITESPACE"," ",785],["T_STRING","getAttributeValueCountByRange",785],"(",["T_VARIABLE","$attribute",785],",",["T_WHITESPACE"," ",785],["T_VARIABLE","$range",785],")",["T_WHITESPACE","\n    ",785],"{",["T_WHITESPACE","\n        ",786],["T_VARIABLE","$select",787],["T_WHITESPACE","        ",787],"=",["T_WHITESPACE"," ",787],["T_CLONE","clone",787],["T_WHITESPACE"," ",787],["T_VARIABLE","$this",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","getSelect",787],"(",")",";",["T_WHITESPACE","\n        ",787],["T_VARIABLE","$attribute",788],["T_WHITESPACE","     ",788],"=",["T_WHITESPACE"," ",788],["T_VARIABLE","$this",788],["T_OBJECT_OPERATOR","->",788],["T_STRING","getEntity",788],"(",")",["T_OBJECT_OPERATOR","->",788],["T_STRING","getAttribute",788],"(",["T_VARIABLE","$attribute",788],")",";",["T_WHITESPACE","\n        ",788],["T_VARIABLE","$attributeCode",789],["T_WHITESPACE"," ",789],"=",["T_WHITESPACE"," ",789],["T_VARIABLE","$attribute",789],["T_OBJECT_OPERATOR","->",789],["T_STRING","getAttributeCode",789],"(",")",";",["T_WHITESPACE","\n        ",789],["T_VARIABLE","$tableAlias",790],["T_WHITESPACE","    ",790],"=",["T_WHITESPACE"," ",790],["T_VARIABLE","$attributeCode",790],["T_WHITESPACE"," ",790],".",["T_WHITESPACE"," ",790],["T_CONSTANT_ENCAPSED_STRING","'_range_count_value'",790],";",["T_WHITESPACE","\n\n        ",790],["T_VARIABLE","$condition",792],["T_WHITESPACE","  ",792],"=",["T_WHITESPACE"," ",792],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = '",792],["T_WHITESPACE"," ",792],".",["T_WHITESPACE"," ",792],["T_VARIABLE","$tableAlias",792],["T_WHITESPACE"," ",792],".",["T_WHITESPACE"," ",792],["T_CONSTANT_ENCAPSED_STRING","'.entity_id\n            AND '",792],["T_WHITESPACE"," ",793],".",["T_WHITESPACE"," ",793],["T_VARIABLE","$this",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","_getConditionSql",793],"(",["T_VARIABLE","$tableAlias",793],["T_WHITESPACE"," ",793],".",["T_WHITESPACE"," ",793],["T_CONSTANT_ENCAPSED_STRING","'.attribute_id'",793],",",["T_WHITESPACE"," ",793],["T_VARIABLE","$attribute",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","getId",793],"(",")",")",";",["T_WHITESPACE","\n\n        ",793],["T_VARIABLE","$select",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","reset",795],"(",["T_STRING","Zend_Db_Select",795],["T_DOUBLE_COLON","::",795],["T_STRING","GROUP",795],")",";",["T_WHITESPACE","\n        ",795],["T_VARIABLE","$select",796],["T_OBJECT_OPERATOR","->",796],["T_STRING","join",796],"(",["T_WHITESPACE","\n                ",796],["T_ARRAY","array",797],"(",["T_VARIABLE","$tableAlias",797],["T_WHITESPACE"," ",797],["T_DOUBLE_ARROW","=>",797],["T_WHITESPACE"," ",797],["T_VARIABLE","$attribute",797],["T_OBJECT_OPERATOR","->",797],["T_STRING","getBackend",797],"(",")",["T_OBJECT_OPERATOR","->",797],["T_STRING","getTable",797],"(",")",")",",",["T_WHITESPACE","\n                ",797],["T_VARIABLE","$condition",798],",",["T_WHITESPACE","\n                ",798],["T_ARRAY","array",799],"(",["T_WHITESPACE","\n                    ",799],["T_CONSTANT_ENCAPSED_STRING","'count_'",800],["T_WHITESPACE"," ",800],".",["T_WHITESPACE"," ",800],["T_VARIABLE","$attributeCode",800],["T_WHITESPACE"," ",800],["T_DOUBLE_ARROW","=>",800],["T_WHITESPACE"," ",800],["T_NEW","new",800],["T_WHITESPACE"," ",800],["T_STRING","Zend_Db_Expr",800],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT e.entity_id)'",800],")",",",["T_WHITESPACE","\n                    ",800],["T_CONSTANT_ENCAPSED_STRING","'range_'",801],["T_WHITESPACE"," ",801],".",["T_WHITESPACE"," ",801],["T_VARIABLE","$attributeCode",801],["T_WHITESPACE"," ",801],["T_DOUBLE_ARROW","=>",801],["T_WHITESPACE"," ",801],["T_NEW","new",801],["T_WHITESPACE"," ",801],["T_STRING","Zend_Db_Expr",801],"(",["T_WHITESPACE","\n                        ",801],["T_CONSTANT_ENCAPSED_STRING","'CEIL(('",802],["T_WHITESPACE"," ",802],".",["T_WHITESPACE"," ",802],["T_VARIABLE","$tableAlias",802],["T_WHITESPACE"," ",802],".",["T_WHITESPACE"," ",802],["T_CONSTANT_ENCAPSED_STRING","'.value+0.01)\/'",802],["T_WHITESPACE"," ",802],".",["T_WHITESPACE"," ",802],["T_VARIABLE","$range",802],["T_WHITESPACE"," ",802],".",["T_WHITESPACE"," ",802],["T_CONSTANT_ENCAPSED_STRING","')'",802],")",["T_WHITESPACE","\n                 ",802],")",["T_WHITESPACE","\n            ",803],")",["T_WHITESPACE","\n            ",804],["T_OBJECT_OPERATOR","->",805],["T_STRING","group",805],"(",["T_CONSTANT_ENCAPSED_STRING","'range_'",805],["T_WHITESPACE"," ",805],".",["T_WHITESPACE"," ",805],["T_VARIABLE","$attributeCode",805],")",";",["T_WHITESPACE","\n\n        ",805],["T_VARIABLE","$data",807],["T_WHITESPACE","   ",807],"=",["T_WHITESPACE"," ",807],["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","getConnection",807],"(",")",["T_OBJECT_OPERATOR","->",807],["T_STRING","fetchAll",807],"(",["T_VARIABLE","$select",807],")",";",["T_WHITESPACE","\n        ",807],["T_VARIABLE","$res",808],["T_WHITESPACE","    ",808],"=",["T_WHITESPACE"," ",808],["T_ARRAY","array",808],"(",")",";",["T_WHITESPACE","\n\n        ",808],["T_FOREACH","foreach",810],["T_WHITESPACE"," ",810],"(",["T_VARIABLE","$data",810],["T_WHITESPACE"," ",810],["T_AS","as",810],["T_WHITESPACE"," ",810],["T_VARIABLE","$row",810],")",["T_WHITESPACE"," ",810],"{",["T_WHITESPACE","\n            ",810],["T_VARIABLE","$res",811],"[",["T_VARIABLE","$row",811],"[",["T_CONSTANT_ENCAPSED_STRING","'range_'",811],["T_WHITESPACE"," ",811],".",["T_WHITESPACE"," ",811],["T_VARIABLE","$attributeCode",811],"]","]",["T_WHITESPACE"," ",811],"=",["T_WHITESPACE"," ",811],["T_VARIABLE","$row",811],"[",["T_CONSTANT_ENCAPSED_STRING","'count_'",811],["T_WHITESPACE"," ",811],".",["T_WHITESPACE"," ",811],["T_VARIABLE","$attributeCode",811],"]",";",["T_WHITESPACE","\n        ",811],"}",["T_WHITESPACE","\n        ",812],["T_RETURN","return",813],["T_WHITESPACE"," ",813],["T_VARIABLE","$res",813],";",["T_WHITESPACE","\n    ",813],"}",["T_WHITESPACE","\n\n    ",814],["T_DOC_COMMENT","\/**\n     * Retrieve product count by some value of attribute\n     *\n     * @param string $attribute\n     * @return array($value=>$count)\n     *\/",816],["T_WHITESPACE","\n    ",821],["T_PUBLIC","public",822],["T_WHITESPACE"," ",822],["T_FUNCTION","function",822],["T_WHITESPACE"," ",822],["T_STRING","getAttributeValueCount",822],"(",["T_VARIABLE","$attribute",822],")",["T_WHITESPACE","\n    ",822],"{",["T_WHITESPACE","\n        ",823],["T_VARIABLE","$select",824],["T_WHITESPACE","        ",824],"=",["T_WHITESPACE"," ",824],["T_CLONE","clone",824],["T_WHITESPACE"," ",824],["T_VARIABLE","$this",824],["T_OBJECT_OPERATOR","->",824],["T_STRING","getSelect",824],"(",")",";",["T_WHITESPACE","\n        ",824],["T_VARIABLE","$attribute",825],["T_WHITESPACE","     ",825],"=",["T_WHITESPACE"," ",825],["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","getEntity",825],"(",")",["T_OBJECT_OPERATOR","->",825],["T_STRING","getAttribute",825],"(",["T_VARIABLE","$attribute",825],")",";",["T_WHITESPACE","\n        ",825],["T_VARIABLE","$attributeCode",826],["T_WHITESPACE"," ",826],"=",["T_WHITESPACE"," ",826],["T_VARIABLE","$attribute",826],["T_OBJECT_OPERATOR","->",826],["T_STRING","getAttributeCode",826],"(",")",";",["T_WHITESPACE","\n        ",826],["T_VARIABLE","$tableAlias",827],["T_WHITESPACE","    ",827],"=",["T_WHITESPACE"," ",827],["T_VARIABLE","$attributeCode",827],["T_WHITESPACE"," ",827],".",["T_WHITESPACE"," ",827],["T_CONSTANT_ENCAPSED_STRING","'_value_count'",827],";",["T_WHITESPACE","\n\n        ",827],["T_VARIABLE","$select",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","reset",829],"(",["T_STRING","Zend_Db_Select",829],["T_DOUBLE_COLON","::",829],["T_STRING","GROUP",829],")",";",["T_WHITESPACE","\n        ",829],["T_VARIABLE","$condition",830],["T_WHITESPACE","  ",830],"=",["T_WHITESPACE"," ",830],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id='",830],["T_WHITESPACE"," ",830],".",["T_WHITESPACE"," ",830],["T_VARIABLE","$tableAlias",830],["T_WHITESPACE"," ",830],".",["T_WHITESPACE"," ",830],["T_CONSTANT_ENCAPSED_STRING","'.entity_id\n            AND '",830],".",["T_VARIABLE","$this",831],["T_OBJECT_OPERATOR","->",831],["T_STRING","_getConditionSql",831],"(",["T_VARIABLE","$tableAlias",831],["T_WHITESPACE"," ",831],".",["T_WHITESPACE"," ",831],["T_CONSTANT_ENCAPSED_STRING","'.attribute_id'",831],",",["T_WHITESPACE"," ",831],["T_VARIABLE","$attribute",831],["T_OBJECT_OPERATOR","->",831],["T_STRING","getId",831],"(",")",")",";",["T_WHITESPACE","\n\n        ",831],["T_VARIABLE","$select",833],["T_OBJECT_OPERATOR","->",833],["T_STRING","join",833],"(",["T_WHITESPACE","\n                ",833],["T_ARRAY","array",834],"(",["T_VARIABLE","$tableAlias",834],["T_WHITESPACE"," ",834],["T_DOUBLE_ARROW","=>",834],["T_WHITESPACE"," ",834],["T_VARIABLE","$attribute",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","getBackend",834],"(",")",["T_OBJECT_OPERATOR","->",834],["T_STRING","getTable",834],"(",")",")",",",["T_WHITESPACE","\n                ",834],["T_VARIABLE","$condition",835],",",["T_WHITESPACE","\n                ",835],["T_ARRAY","array",836],"(",["T_WHITESPACE","\n                    ",836],["T_CONSTANT_ENCAPSED_STRING","'count_'",837],["T_WHITESPACE"," ",837],".",["T_WHITESPACE"," ",837],["T_VARIABLE","$attributeCode",837],["T_WHITESPACE"," ",837],["T_DOUBLE_ARROW","=>",837],["T_WHITESPACE"," ",837],["T_NEW","new",837],["T_WHITESPACE"," ",837],["T_STRING","Zend_Db_Expr",837],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT e.entity_id)'",837],")",",",["T_WHITESPACE","\n                    ",837],["T_CONSTANT_ENCAPSED_STRING","'value_'",838],["T_WHITESPACE"," ",838],".",["T_WHITESPACE"," ",838],["T_VARIABLE","$attributeCode",838],["T_WHITESPACE"," ",838],["T_DOUBLE_ARROW","=>",838],["T_WHITESPACE"," ",838],["T_NEW","new",838],["T_WHITESPACE"," ",838],["T_STRING","Zend_Db_Expr",838],"(",["T_VARIABLE","$tableAlias",838],["T_WHITESPACE"," ",838],".",["T_WHITESPACE"," ",838],["T_CONSTANT_ENCAPSED_STRING","'.value'",838],")",["T_WHITESPACE","\n                 ",838],")",["T_WHITESPACE","\n            ",839],")",["T_WHITESPACE","\n            ",840],["T_OBJECT_OPERATOR","->",841],["T_STRING","group",841],"(",["T_CONSTANT_ENCAPSED_STRING","'value_'",841],["T_WHITESPACE"," ",841],".",["T_WHITESPACE"," ",841],["T_VARIABLE","$attributeCode",841],")",";",["T_WHITESPACE","\n\n        ",841],["T_VARIABLE","$data",843],["T_WHITESPACE","   ",843],"=",["T_WHITESPACE"," ",843],["T_VARIABLE","$this",843],["T_OBJECT_OPERATOR","->",843],["T_STRING","getConnection",843],"(",")",["T_OBJECT_OPERATOR","->",843],["T_STRING","fetchAll",843],"(",["T_VARIABLE","$select",843],")",";",["T_WHITESPACE","\n        ",843],["T_VARIABLE","$res",844],["T_WHITESPACE","    ",844],"=",["T_WHITESPACE"," ",844],["T_ARRAY","array",844],"(",")",";",["T_WHITESPACE","\n\n        ",844],["T_FOREACH","foreach",846],["T_WHITESPACE"," ",846],"(",["T_VARIABLE","$data",846],["T_WHITESPACE"," ",846],["T_AS","as",846],["T_WHITESPACE"," ",846],["T_VARIABLE","$row",846],")",["T_WHITESPACE"," ",846],"{",["T_WHITESPACE","\n            ",846],["T_VARIABLE","$res",847],"[",["T_VARIABLE","$row",847],"[",["T_CONSTANT_ENCAPSED_STRING","'value_'",847],["T_WHITESPACE"," ",847],".",["T_WHITESPACE"," ",847],["T_VARIABLE","$attributeCode",847],"]","]",["T_WHITESPACE"," ",847],"=",["T_WHITESPACE"," ",847],["T_VARIABLE","$row",847],"[",["T_CONSTANT_ENCAPSED_STRING","'count_'",847],["T_WHITESPACE"," ",847],".",["T_WHITESPACE"," ",847],["T_VARIABLE","$attributeCode",847],"]",";",["T_WHITESPACE","\n        ",847],"}",["T_WHITESPACE","\n        ",848],["T_RETURN","return",849],["T_WHITESPACE"," ",849],["T_VARIABLE","$res",849],";",["T_WHITESPACE","\n    ",849],"}",["T_WHITESPACE","\n\n    ",850],["T_DOC_COMMENT","\/**\n     * Return all attribute values as array in form:\n     * array(\n     *   [entity_id_1] => array(\n     *          [store_id_1] => store_value_1,\n     *          [store_id_2] => store_value_2,\n     *          ...\n     *          [store_id_n] => store_value_n\n     *   ),\n     *   ...\n     * )\n     *\n     * @param string $attribute attribute code\n     * @return array\n     *\/",852],["T_WHITESPACE","\n    ",866],["T_PUBLIC","public",867],["T_WHITESPACE"," ",867],["T_FUNCTION","function",867],["T_WHITESPACE"," ",867],["T_STRING","getAllAttributeValues",867],"(",["T_VARIABLE","$attribute",867],")",["T_WHITESPACE","\n    ",867],"{",["T_WHITESPACE","\n        ",868],["T_DOC_COMMENT","\/** @var $select Varien_Db_Select *\/",869],["T_WHITESPACE","\n        ",869],["T_VARIABLE","$select",870],["T_WHITESPACE","    ",870],"=",["T_WHITESPACE"," ",870],["T_CLONE","clone",870],["T_WHITESPACE"," ",870],["T_VARIABLE","$this",870],["T_OBJECT_OPERATOR","->",870],["T_STRING","getSelect",870],"(",")",";",["T_WHITESPACE","\n        ",870],["T_VARIABLE","$attribute",871],["T_WHITESPACE"," ",871],"=",["T_WHITESPACE"," ",871],["T_VARIABLE","$this",871],["T_OBJECT_OPERATOR","->",871],["T_STRING","getEntity",871],"(",")",["T_OBJECT_OPERATOR","->",871],["T_STRING","getAttribute",871],"(",["T_VARIABLE","$attribute",871],")",";",["T_WHITESPACE","\n\n        ",871],["T_VARIABLE","$select",873],["T_OBJECT_OPERATOR","->",873],["T_STRING","reset",873],"(",")",["T_WHITESPACE","\n            ",873],["T_OBJECT_OPERATOR","->",874],["T_STRING","from",874],"(",["T_VARIABLE","$attribute",874],["T_OBJECT_OPERATOR","->",874],["T_STRING","getBackend",874],"(",")",["T_OBJECT_OPERATOR","->",874],["T_STRING","getTable",874],"(",")",",",["T_WHITESPACE"," ",874],["T_ARRAY","array",874],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",874],",",["T_WHITESPACE"," ",874],["T_CONSTANT_ENCAPSED_STRING","'store_id'",874],",",["T_WHITESPACE"," ",874],["T_CONSTANT_ENCAPSED_STRING","'value'",874],")",")",["T_WHITESPACE","\n            ",874],["T_OBJECT_OPERATOR","->",875],["T_STRING","where",875],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",875],",",["T_WHITESPACE"," ",875],["T_INT_CAST","(int)",875],["T_VARIABLE","$attribute",875],["T_OBJECT_OPERATOR","->",875],["T_STRING","getId",875],"(",")",")",";",["T_WHITESPACE","\n\n        ",875],["T_VARIABLE","$data",877],["T_WHITESPACE"," ",877],"=",["T_WHITESPACE"," ",877],["T_VARIABLE","$this",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","getConnection",877],"(",")",["T_OBJECT_OPERATOR","->",877],["T_STRING","fetchAll",877],"(",["T_VARIABLE","$select",877],")",";",["T_WHITESPACE","\n        ",877],["T_VARIABLE","$res",878],["T_WHITESPACE","  ",878],"=",["T_WHITESPACE"," ",878],["T_ARRAY","array",878],"(",")",";",["T_WHITESPACE","\n\n        ",878],["T_FOREACH","foreach",880],["T_WHITESPACE"," ",880],"(",["T_VARIABLE","$data",880],["T_WHITESPACE"," ",880],["T_AS","as",880],["T_WHITESPACE"," ",880],["T_VARIABLE","$row",880],")",["T_WHITESPACE"," ",880],"{",["T_WHITESPACE","\n            ",880],["T_VARIABLE","$res",881],"[",["T_VARIABLE","$row",881],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",881],"]","]","[",["T_VARIABLE","$row",881],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",881],"]","]",["T_WHITESPACE"," ",881],"=",["T_WHITESPACE"," ",881],["T_VARIABLE","$row",881],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",881],"]",";",["T_WHITESPACE","\n        ",881],"}",["T_WHITESPACE","\n\n        ",882],["T_RETURN","return",884],["T_WHITESPACE"," ",884],["T_VARIABLE","$res",884],";",["T_WHITESPACE","\n    ",884],"}",["T_WHITESPACE","\n\n    ",885],["T_DOC_COMMENT","\/**\n     * Get SQL for get record count without left JOINs\n     *\n     * @return Varien_Db_Select\n     *\/",887],["T_WHITESPACE","\n    ",891],["T_PUBLIC","public",892],["T_WHITESPACE"," ",892],["T_FUNCTION","function",892],["T_WHITESPACE"," ",892],["T_STRING","getSelectCountSql",892],"(",")",["T_WHITESPACE","\n    ",892],"{",["T_WHITESPACE","\n        ",893],["T_RETURN","return",894],["T_WHITESPACE"," ",894],["T_VARIABLE","$this",894],["T_OBJECT_OPERATOR","->",894],["T_STRING","_getSelectCountSql",894],"(",")",";",["T_WHITESPACE","\n    ",894],"}",["T_WHITESPACE","\n\n    ",895],["T_DOC_COMMENT","\/**\n     * Get SQL for get record count\n     *\n     * @param bool $resetLeftJoins\n     * @return Varien_Db_Select\n     *\/",897],["T_WHITESPACE","\n    ",902],["T_PROTECTED","protected",903],["T_WHITESPACE"," ",903],["T_FUNCTION","function",903],["T_WHITESPACE"," ",903],["T_STRING","_getSelectCountSql",903],"(",["T_VARIABLE","$select",903],["T_WHITESPACE"," ",903],"=",["T_WHITESPACE"," ",903],["T_STRING","null",903],",",["T_WHITESPACE"," ",903],["T_VARIABLE","$resetLeftJoins",903],["T_WHITESPACE"," ",903],"=",["T_WHITESPACE"," ",903],["T_STRING","true",903],")",["T_WHITESPACE","\n    ",903],"{",["T_WHITESPACE","\n        ",904],["T_VARIABLE","$this",905],["T_OBJECT_OPERATOR","->",905],["T_STRING","_renderFilters",905],"(",")",";",["T_WHITESPACE","\n        ",905],["T_VARIABLE","$countSelect",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],"(",["T_STRING","is_null",906],"(",["T_VARIABLE","$select",906],")",")",["T_WHITESPACE"," ",906],"?",["T_WHITESPACE","\n            ",906],["T_VARIABLE","$this",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","_getClearSelect",907],"(",")",["T_WHITESPACE"," ",907],":",["T_WHITESPACE","\n            ",907],["T_VARIABLE","$this",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","_buildClearSelect",908],"(",["T_VARIABLE","$select",908],")",";",["T_WHITESPACE","\n        ",908],["T_COMMENT","\/\/ Clear GROUP condition for count method\n",909],["T_WHITESPACE","        ",910],["T_VARIABLE","$countSelect",910],["T_OBJECT_OPERATOR","->",910],["T_STRING","reset",910],"(",["T_STRING","Zend_Db_Select",910],["T_DOUBLE_COLON","::",910],["T_STRING","GROUP",910],")",";",["T_WHITESPACE","\n        ",910],["T_VARIABLE","$countSelect",911],["T_OBJECT_OPERATOR","->",911],["T_STRING","columns",911],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT e.entity_id)'",911],")",";",["T_WHITESPACE","\n        ",911],["T_IF","if",912],["T_WHITESPACE"," ",912],"(",["T_VARIABLE","$resetLeftJoins",912],")",["T_WHITESPACE"," ",912],"{",["T_WHITESPACE","\n            ",912],["T_VARIABLE","$countSelect",913],["T_OBJECT_OPERATOR","->",913],["T_STRING","resetJoinLeft",913],"(",")",";",["T_WHITESPACE","\n        ",913],"}",["T_WHITESPACE","\n        ",914],["T_RETURN","return",915],["T_WHITESPACE"," ",915],["T_VARIABLE","$countSelect",915],";",["T_WHITESPACE","\n    ",915],"}",["T_WHITESPACE","\n\n    ",916],["T_DOC_COMMENT","\/**\n     * Prepare statistics data\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",918],["T_WHITESPACE","\n    ",922],["T_PROTECTED","protected",923],["T_WHITESPACE"," ",923],["T_FUNCTION","function",923],["T_WHITESPACE"," ",923],["T_STRING","_prepareStatisticsData",923],"(",")",["T_WHITESPACE","\n    ",923],"{",["T_WHITESPACE","\n        ",924],["T_VARIABLE","$select",925],["T_WHITESPACE"," ",925],"=",["T_WHITESPACE"," ",925],["T_CLONE","clone",925],["T_WHITESPACE"," ",925],["T_VARIABLE","$this",925],["T_OBJECT_OPERATOR","->",925],["T_STRING","getSelect",925],"(",")",";",["T_WHITESPACE","\n        ",925],["T_VARIABLE","$priceExpression",926],["T_WHITESPACE"," ",926],"=",["T_WHITESPACE"," ",926],["T_VARIABLE","$this",926],["T_OBJECT_OPERATOR","->",926],["T_STRING","getPriceExpression",926],"(",["T_VARIABLE","$select",926],")",["T_WHITESPACE"," ",926],".",["T_WHITESPACE"," ",926],["T_CONSTANT_ENCAPSED_STRING","' '",926],["T_WHITESPACE"," ",926],".",["T_WHITESPACE"," ",926],["T_VARIABLE","$this",926],["T_OBJECT_OPERATOR","->",926],["T_STRING","getAdditionalPriceExpression",926],"(",["T_VARIABLE","$select",926],")",";",["T_WHITESPACE","\n        ",926],["T_VARIABLE","$sqlEndPart",927],["T_WHITESPACE"," ",927],"=",["T_WHITESPACE"," ",927],["T_CONSTANT_ENCAPSED_STRING","') * '",927],["T_WHITESPACE"," ",927],".",["T_WHITESPACE"," ",927],["T_VARIABLE","$this",927],["T_OBJECT_OPERATOR","->",927],["T_STRING","getCurrencyRate",927],"(",")",["T_WHITESPACE"," ",927],".",["T_WHITESPACE"," ",927],["T_CONSTANT_ENCAPSED_STRING","', 2)'",927],";",["T_WHITESPACE","\n        ",927],["T_VARIABLE","$select",928],["T_WHITESPACE"," ",928],"=",["T_WHITESPACE"," ",928],["T_VARIABLE","$this",928],["T_OBJECT_OPERATOR","->",928],["T_STRING","_getSelectCountSql",928],"(",["T_VARIABLE","$select",928],",",["T_WHITESPACE"," ",928],["T_STRING","false",928],")",";",["T_WHITESPACE","\n        ",928],["T_VARIABLE","$select",929],["T_OBJECT_OPERATOR","->",929],["T_STRING","columns",929],"(",["T_ARRAY","array",929],"(",["T_WHITESPACE","\n            ",929],["T_CONSTANT_ENCAPSED_STRING","'max'",930],["T_WHITESPACE"," ",930],["T_DOUBLE_ARROW","=>",930],["T_WHITESPACE"," ",930],["T_CONSTANT_ENCAPSED_STRING","'ROUND(MAX('",930],["T_WHITESPACE"," ",930],".",["T_WHITESPACE"," ",930],["T_VARIABLE","$priceExpression",930],["T_WHITESPACE"," ",930],".",["T_WHITESPACE"," ",930],["T_VARIABLE","$sqlEndPart",930],",",["T_WHITESPACE","\n            ",930],["T_CONSTANT_ENCAPSED_STRING","'min'",931],["T_WHITESPACE"," ",931],["T_DOUBLE_ARROW","=>",931],["T_WHITESPACE"," ",931],["T_CONSTANT_ENCAPSED_STRING","'ROUND(MIN('",931],["T_WHITESPACE"," ",931],".",["T_WHITESPACE"," ",931],["T_VARIABLE","$priceExpression",931],["T_WHITESPACE"," ",931],".",["T_WHITESPACE"," ",931],["T_VARIABLE","$sqlEndPart",931],",",["T_WHITESPACE","\n            ",931],["T_CONSTANT_ENCAPSED_STRING","'std'",932],["T_WHITESPACE"," ",932],["T_DOUBLE_ARROW","=>",932],["T_WHITESPACE"," ",932],["T_VARIABLE","$this",932],["T_OBJECT_OPERATOR","->",932],["T_STRING","getConnection",932],"(",")",["T_OBJECT_OPERATOR","->",932],["T_STRING","getStandardDeviationSql",932],"(",["T_CONSTANT_ENCAPSED_STRING","'ROUND(('",932],["T_WHITESPACE"," ",932],".",["T_WHITESPACE"," ",932],["T_VARIABLE","$priceExpression",932],["T_WHITESPACE"," ",932],".",["T_WHITESPACE"," ",932],["T_VARIABLE","$sqlEndPart",932],")",["T_WHITESPACE","\n        ",932],")",")",";",["T_WHITESPACE","\n        ",933],["T_VARIABLE","$select",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","where",934],"(",["T_VARIABLE","$this",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","getPriceExpression",934],"(",["T_VARIABLE","$select",934],")",["T_WHITESPACE"," ",934],".",["T_WHITESPACE"," ",934],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",934],")",";",["T_WHITESPACE","\n        ",934],["T_VARIABLE","$row",935],["T_WHITESPACE"," ",935],"=",["T_WHITESPACE"," ",935],["T_VARIABLE","$this",935],["T_OBJECT_OPERATOR","->",935],["T_STRING","getConnection",935],"(",")",["T_OBJECT_OPERATOR","->",935],["T_STRING","fetchRow",935],"(",["T_VARIABLE","$select",935],",",["T_WHITESPACE"," ",935],["T_VARIABLE","$this",935],["T_OBJECT_OPERATOR","->",935],["T_STRING","_bindParams",935],",",["T_WHITESPACE"," ",935],["T_STRING","Zend_Db",935],["T_DOUBLE_COLON","::",935],["T_STRING","FETCH_NUM",935],")",";",["T_WHITESPACE","\n        ",935],["T_VARIABLE","$this",936],["T_OBJECT_OPERATOR","->",936],["T_STRING","_pricesCount",936],["T_WHITESPACE"," ",936],"=",["T_WHITESPACE"," ",936],["T_INT_CAST","(int)",936],["T_VARIABLE","$row",936],"[",["T_LNUMBER","0",936],"]",";",["T_WHITESPACE","\n        ",936],["T_VARIABLE","$this",937],["T_OBJECT_OPERATOR","->",937],["T_STRING","_maxPrice",937],["T_WHITESPACE"," ",937],"=",["T_WHITESPACE"," ",937],["T_DOUBLE_CAST","(float)",937],["T_VARIABLE","$row",937],"[",["T_LNUMBER","1",937],"]",";",["T_WHITESPACE","\n        ",937],["T_VARIABLE","$this",938],["T_OBJECT_OPERATOR","->",938],["T_STRING","_minPrice",938],["T_WHITESPACE"," ",938],"=",["T_WHITESPACE"," ",938],["T_DOUBLE_CAST","(float)",938],["T_VARIABLE","$row",938],"[",["T_LNUMBER","2",938],"]",";",["T_WHITESPACE","\n        ",938],["T_VARIABLE","$this",939],["T_OBJECT_OPERATOR","->",939],["T_STRING","_priceStandardDeviation",939],["T_WHITESPACE"," ",939],"=",["T_WHITESPACE"," ",939],["T_DOUBLE_CAST","(float)",939],["T_VARIABLE","$row",939],"[",["T_LNUMBER","3",939],"]",";",["T_WHITESPACE","\n\n        ",939],["T_RETURN","return",941],["T_WHITESPACE"," ",941],["T_VARIABLE","$this",941],";",["T_WHITESPACE","\n    ",941],"}",["T_WHITESPACE","\n\n    ",942],["T_DOC_COMMENT","\/**\n     * Retreive clear select\n     *\n     * @return Varien_Db_Select\n     *\/",944],["T_WHITESPACE","\n    ",948],["T_PROTECTED","protected",949],["T_WHITESPACE"," ",949],["T_FUNCTION","function",949],["T_WHITESPACE"," ",949],["T_STRING","_getClearSelect",949],"(",")",["T_WHITESPACE","\n    ",949],"{",["T_WHITESPACE","\n        ",950],["T_RETURN","return",951],["T_WHITESPACE"," ",951],["T_VARIABLE","$this",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","_buildClearSelect",951],"(",")",";",["T_WHITESPACE","\n    ",951],"}",["T_WHITESPACE","\n\n    ",952],["T_DOC_COMMENT","\/**\n     * Build clear select\n     *\n     * @param Varien_Db_Select $select\n     * @return Varien_Db_Select\n     *\/",954],["T_WHITESPACE","\n    ",959],["T_PROTECTED","protected",960],["T_WHITESPACE"," ",960],["T_FUNCTION","function",960],["T_WHITESPACE"," ",960],["T_STRING","_buildClearSelect",960],"(",["T_VARIABLE","$select",960],["T_WHITESPACE"," ",960],"=",["T_WHITESPACE"," ",960],["T_STRING","null",960],")",["T_WHITESPACE","\n    ",960],"{",["T_WHITESPACE","\n        ",961],["T_IF","if",962],["T_WHITESPACE"," ",962],"(",["T_STRING","is_null",962],"(",["T_VARIABLE","$select",962],")",")",["T_WHITESPACE"," ",962],"{",["T_WHITESPACE","\n            ",962],["T_VARIABLE","$select",963],["T_WHITESPACE"," ",963],"=",["T_WHITESPACE"," ",963],["T_CLONE","clone",963],["T_WHITESPACE"," ",963],["T_VARIABLE","$this",963],["T_OBJECT_OPERATOR","->",963],["T_STRING","getSelect",963],"(",")",";",["T_WHITESPACE","\n        ",963],"}",["T_WHITESPACE","\n        ",964],["T_VARIABLE","$select",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","reset",965],"(",["T_STRING","Zend_Db_Select",965],["T_DOUBLE_COLON","::",965],["T_STRING","ORDER",965],")",";",["T_WHITESPACE","\n        ",965],["T_VARIABLE","$select",966],["T_OBJECT_OPERATOR","->",966],["T_STRING","reset",966],"(",["T_STRING","Zend_Db_Select",966],["T_DOUBLE_COLON","::",966],["T_STRING","LIMIT_COUNT",966],")",";",["T_WHITESPACE","\n        ",966],["T_VARIABLE","$select",967],["T_OBJECT_OPERATOR","->",967],["T_STRING","reset",967],"(",["T_STRING","Zend_Db_Select",967],["T_DOUBLE_COLON","::",967],["T_STRING","LIMIT_OFFSET",967],")",";",["T_WHITESPACE","\n        ",967],["T_VARIABLE","$select",968],["T_OBJECT_OPERATOR","->",968],["T_STRING","reset",968],"(",["T_STRING","Zend_Db_Select",968],["T_DOUBLE_COLON","::",968],["T_STRING","COLUMNS",968],")",";",["T_WHITESPACE","\n\n        ",968],["T_RETURN","return",970],["T_WHITESPACE"," ",970],["T_VARIABLE","$select",970],";",["T_WHITESPACE","\n    ",970],"}",["T_WHITESPACE","\n\n    ",971],["T_DOC_COMMENT","\/**\n     * Retrive all ids for collection\n     *\n     * @param unknown_type $limit\n     * @param unknown_type $offset\n     * @return array\n     *\/",973],["T_WHITESPACE","\n    ",979],["T_PUBLIC","public",980],["T_WHITESPACE"," ",980],["T_FUNCTION","function",980],["T_WHITESPACE"," ",980],["T_STRING","getAllIds",980],"(",["T_VARIABLE","$limit",980],["T_WHITESPACE"," ",980],"=",["T_WHITESPACE"," ",980],["T_STRING","null",980],",",["T_WHITESPACE"," ",980],["T_VARIABLE","$offset",980],["T_WHITESPACE"," ",980],"=",["T_WHITESPACE"," ",980],["T_STRING","null",980],")",["T_WHITESPACE","\n    ",980],"{",["T_WHITESPACE","\n        ",981],["T_VARIABLE","$idsSelect",982],["T_WHITESPACE"," ",982],"=",["T_WHITESPACE"," ",982],["T_VARIABLE","$this",982],["T_OBJECT_OPERATOR","->",982],["T_STRING","_getClearSelect",982],"(",")",";",["T_WHITESPACE","\n        ",982],["T_VARIABLE","$idsSelect",983],["T_OBJECT_OPERATOR","->",983],["T_STRING","columns",983],"(",["T_CONSTANT_ENCAPSED_STRING","'e.'",983],["T_WHITESPACE"," ",983],".",["T_WHITESPACE"," ",983],["T_VARIABLE","$this",983],["T_OBJECT_OPERATOR","->",983],["T_STRING","getEntity",983],"(",")",["T_OBJECT_OPERATOR","->",983],["T_STRING","getIdFieldName",983],"(",")",")",";",["T_WHITESPACE","\n        ",983],["T_VARIABLE","$idsSelect",984],["T_OBJECT_OPERATOR","->",984],["T_STRING","limit",984],"(",["T_VARIABLE","$limit",984],",",["T_WHITESPACE"," ",984],["T_VARIABLE","$offset",984],")",";",["T_WHITESPACE","\n        ",984],["T_VARIABLE","$idsSelect",985],["T_OBJECT_OPERATOR","->",985],["T_STRING","resetJoinLeft",985],"(",")",";",["T_WHITESPACE","\n\n        ",985],["T_RETURN","return",987],["T_WHITESPACE"," ",987],["T_VARIABLE","$this",987],["T_OBJECT_OPERATOR","->",987],["T_STRING","getConnection",987],"(",")",["T_OBJECT_OPERATOR","->",987],["T_STRING","fetchCol",987],"(",["T_VARIABLE","$idsSelect",987],",",["T_WHITESPACE"," ",987],["T_VARIABLE","$this",987],["T_OBJECT_OPERATOR","->",987],["T_STRING","_bindParams",987],")",";",["T_WHITESPACE","\n    ",987],"}",["T_WHITESPACE","\n\n    ",988],["T_DOC_COMMENT","\/**\n     * Retreive product count select for categories\n     *\n     * @return Varien_Db_Select\n     *\/",990],["T_WHITESPACE","\n    ",994],["T_PUBLIC","public",995],["T_WHITESPACE"," ",995],["T_FUNCTION","function",995],["T_WHITESPACE"," ",995],["T_STRING","getProductCountSelect",995],"(",")",["T_WHITESPACE","\n    ",995],"{",["T_WHITESPACE","\n        ",996],["T_IF","if",997],["T_WHITESPACE"," ",997],"(",["T_VARIABLE","$this",997],["T_OBJECT_OPERATOR","->",997],["T_STRING","_productCountSelect",997],["T_WHITESPACE"," ",997],["T_IS_IDENTICAL","===",997],["T_WHITESPACE"," ",997],["T_STRING","null",997],")",["T_WHITESPACE"," ",997],"{",["T_WHITESPACE","\n            ",997],["T_VARIABLE","$this",998],["T_OBJECT_OPERATOR","->",998],["T_STRING","_productCountSelect",998],["T_WHITESPACE"," ",998],"=",["T_WHITESPACE"," ",998],["T_CLONE","clone",998],["T_WHITESPACE"," ",998],["T_VARIABLE","$this",998],["T_OBJECT_OPERATOR","->",998],["T_STRING","getSelect",998],"(",")",";",["T_WHITESPACE","\n            ",998],["T_VARIABLE","$this",999],["T_OBJECT_OPERATOR","->",999],["T_STRING","_productCountSelect",999],["T_OBJECT_OPERATOR","->",999],["T_STRING","reset",999],"(",["T_STRING","Zend_Db_Select",999],["T_DOUBLE_COLON","::",999],["T_STRING","COLUMNS",999],")",["T_WHITESPACE","\n                ",999],["T_OBJECT_OPERATOR","->",1000],["T_STRING","reset",1000],"(",["T_STRING","Zend_Db_Select",1000],["T_DOUBLE_COLON","::",1000],["T_STRING","GROUP",1000],")",["T_WHITESPACE","\n                ",1000],["T_OBJECT_OPERATOR","->",1001],["T_STRING","reset",1001],"(",["T_STRING","Zend_Db_Select",1001],["T_DOUBLE_COLON","::",1001],["T_STRING","ORDER",1001],")",["T_WHITESPACE","\n                ",1001],["T_OBJECT_OPERATOR","->",1002],["T_STRING","distinct",1002],"(",["T_STRING","false",1002],")",["T_WHITESPACE","\n                ",1002],["T_OBJECT_OPERATOR","->",1003],["T_STRING","join",1003],"(",["T_ARRAY","array",1003],"(",["T_CONSTANT_ENCAPSED_STRING","'count_table'",1003],["T_WHITESPACE"," ",1003],["T_DOUBLE_ARROW","=>",1003],["T_WHITESPACE"," ",1003],["T_VARIABLE","$this",1003],["T_OBJECT_OPERATOR","->",1003],["T_STRING","getTable",1003],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",1003],")",")",",",["T_WHITESPACE","\n                    ",1003],["T_CONSTANT_ENCAPSED_STRING","'count_table.product_id = e.entity_id'",1004],",",["T_WHITESPACE","\n                    ",1004],["T_ARRAY","array",1005],"(",["T_WHITESPACE","\n                        ",1005],["T_CONSTANT_ENCAPSED_STRING","'count_table.category_id'",1006],",",["T_WHITESPACE","\n                        ",1006],["T_CONSTANT_ENCAPSED_STRING","'product_count'",1007],["T_WHITESPACE"," ",1007],["T_DOUBLE_ARROW","=>",1007],["T_WHITESPACE"," ",1007],["T_NEW","new",1007],["T_WHITESPACE"," ",1007],["T_STRING","Zend_Db_Expr",1007],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT count_table.product_id)'",1007],")",["T_WHITESPACE","\n                    ",1007],")",["T_WHITESPACE","\n                ",1008],")",["T_WHITESPACE","\n                ",1009],["T_OBJECT_OPERATOR","->",1010],["T_STRING","where",1010],"(",["T_CONSTANT_ENCAPSED_STRING","'count_table.store_id = ?'",1010],",",["T_WHITESPACE"," ",1010],["T_VARIABLE","$this",1010],["T_OBJECT_OPERATOR","->",1010],["T_STRING","getStoreId",1010],"(",")",")",["T_WHITESPACE","\n                ",1010],["T_OBJECT_OPERATOR","->",1011],["T_STRING","group",1011],"(",["T_CONSTANT_ENCAPSED_STRING","'count_table.category_id'",1011],")",";",["T_WHITESPACE","\n        ",1011],"}",["T_WHITESPACE","\n\n        ",1012],["T_RETURN","return",1014],["T_WHITESPACE"," ",1014],["T_VARIABLE","$this",1014],["T_OBJECT_OPERATOR","->",1014],["T_STRING","_productCountSelect",1014],";",["T_WHITESPACE","\n    ",1014],"}",["T_WHITESPACE","\n\n    ",1015],["T_DOC_COMMENT","\/**\n     * Destruct product count select\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1017],["T_WHITESPACE","\n    ",1021],["T_PUBLIC","public",1022],["T_WHITESPACE"," ",1022],["T_FUNCTION","function",1022],["T_WHITESPACE"," ",1022],["T_STRING","unsProductCountSelect",1022],"(",")",["T_WHITESPACE","\n    ",1022],"{",["T_WHITESPACE","\n        ",1023],["T_VARIABLE","$this",1024],["T_OBJECT_OPERATOR","->",1024],["T_STRING","_productCountSelect",1024],["T_WHITESPACE"," ",1024],"=",["T_WHITESPACE"," ",1024],["T_STRING","null",1024],";",["T_WHITESPACE","\n        ",1024],["T_RETURN","return",1025],["T_WHITESPACE"," ",1025],["T_VARIABLE","$this",1025],";",["T_WHITESPACE","\n    ",1025],"}",["T_WHITESPACE","\n\n    ",1026],["T_DOC_COMMENT","\/**\n     * Adding product count to categories collection\n     *\n     * @param Mage_Eav_Model_Entity_Collection_Abstract $categoryCollection\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1028],["T_WHITESPACE","\n    ",1033],["T_PUBLIC","public",1034],["T_WHITESPACE"," ",1034],["T_FUNCTION","function",1034],["T_WHITESPACE"," ",1034],["T_STRING","addCountToCategories",1034],"(",["T_VARIABLE","$categoryCollection",1034],")",["T_WHITESPACE","\n    ",1034],"{",["T_WHITESPACE","\n        ",1035],["T_VARIABLE","$isAnchor",1036],["T_WHITESPACE","    ",1036],"=",["T_WHITESPACE"," ",1036],["T_ARRAY","array",1036],"(",")",";",["T_WHITESPACE","\n        ",1036],["T_VARIABLE","$isNotAnchor",1037],["T_WHITESPACE"," ",1037],"=",["T_WHITESPACE"," ",1037],["T_ARRAY","array",1037],"(",")",";",["T_WHITESPACE","\n        ",1037],["T_FOREACH","foreach",1038],["T_WHITESPACE"," ",1038],"(",["T_VARIABLE","$categoryCollection",1038],["T_WHITESPACE"," ",1038],["T_AS","as",1038],["T_WHITESPACE"," ",1038],["T_VARIABLE","$category",1038],")",["T_WHITESPACE"," ",1038],"{",["T_WHITESPACE","\n            ",1038],["T_IF","if",1039],["T_WHITESPACE"," ",1039],"(",["T_VARIABLE","$category",1039],["T_OBJECT_OPERATOR","->",1039],["T_STRING","getIsAnchor",1039],"(",")",")",["T_WHITESPACE"," ",1039],"{",["T_WHITESPACE","\n                ",1039],["T_VARIABLE","$isAnchor",1040],"[","]",["T_WHITESPACE","    ",1040],"=",["T_WHITESPACE"," ",1040],["T_VARIABLE","$category",1040],["T_OBJECT_OPERATOR","->",1040],["T_STRING","getId",1040],"(",")",";",["T_WHITESPACE","\n            ",1040],"}",["T_WHITESPACE"," ",1041],["T_ELSE","else",1041],["T_WHITESPACE"," ",1041],"{",["T_WHITESPACE","\n                ",1041],["T_VARIABLE","$isNotAnchor",1042],"[","]",["T_WHITESPACE"," ",1042],"=",["T_WHITESPACE"," ",1042],["T_VARIABLE","$category",1042],["T_OBJECT_OPERATOR","->",1042],["T_STRING","getId",1042],"(",")",";",["T_WHITESPACE","\n            ",1042],"}",["T_WHITESPACE","\n        ",1043],"}",["T_WHITESPACE","\n        ",1044],["T_VARIABLE","$productCounts",1045],["T_WHITESPACE"," ",1045],"=",["T_WHITESPACE"," ",1045],["T_ARRAY","array",1045],"(",")",";",["T_WHITESPACE","\n        ",1045],["T_IF","if",1046],["T_WHITESPACE"," ",1046],"(",["T_VARIABLE","$isAnchor",1046],["T_WHITESPACE"," ",1046],["T_BOOLEAN_OR","||",1046],["T_WHITESPACE"," ",1046],["T_VARIABLE","$isNotAnchor",1046],")",["T_WHITESPACE"," ",1046],"{",["T_WHITESPACE","\n            ",1046],["T_VARIABLE","$select",1047],["T_WHITESPACE"," ",1047],"=",["T_WHITESPACE"," ",1047],["T_VARIABLE","$this",1047],["T_OBJECT_OPERATOR","->",1047],["T_STRING","getProductCountSelect",1047],"(",")",";",["T_WHITESPACE","\n\n            ",1047],["T_STRING","Mage",1049],["T_DOUBLE_COLON","::",1049],["T_STRING","dispatchEvent",1049],"(",["T_WHITESPACE","\n                ",1049],["T_CONSTANT_ENCAPSED_STRING","'catalog_product_collection_before_add_count_to_categories'",1050],",",["T_WHITESPACE","\n                ",1050],["T_ARRAY","array",1051],"(",["T_CONSTANT_ENCAPSED_STRING","'collection'",1051],["T_WHITESPACE"," ",1051],["T_DOUBLE_ARROW","=>",1051],["T_WHITESPACE"," ",1051],["T_VARIABLE","$this",1051],")",["T_WHITESPACE","\n            ",1051],")",";",["T_WHITESPACE","\n\n            ",1052],["T_IF","if",1054],["T_WHITESPACE"," ",1054],"(",["T_VARIABLE","$isAnchor",1054],")",["T_WHITESPACE"," ",1054],"{",["T_WHITESPACE","\n                ",1054],["T_VARIABLE","$anchorStmt",1055],["T_WHITESPACE"," ",1055],"=",["T_WHITESPACE"," ",1055],["T_CLONE","clone",1055],["T_WHITESPACE"," ",1055],["T_VARIABLE","$select",1055],";",["T_WHITESPACE","\n                ",1055],["T_VARIABLE","$anchorStmt",1056],["T_OBJECT_OPERATOR","->",1056],["T_STRING","limit",1056],"(",")",";",["T_WHITESPACE"," ",1056],["T_COMMENT","\/\/reset limits\n",1056],["T_WHITESPACE","                ",1057],["T_VARIABLE","$anchorStmt",1057],["T_OBJECT_OPERATOR","->",1057],["T_STRING","where",1057],"(",["T_CONSTANT_ENCAPSED_STRING","'count_table.category_id IN (?)'",1057],",",["T_WHITESPACE"," ",1057],["T_VARIABLE","$isAnchor",1057],")",";",["T_WHITESPACE","\n                ",1057],["T_VARIABLE","$productCounts",1058],["T_WHITESPACE"," ",1058],["T_PLUS_EQUAL","+=",1058],["T_WHITESPACE"," ",1058],["T_VARIABLE","$this",1058],["T_OBJECT_OPERATOR","->",1058],["T_STRING","getConnection",1058],"(",")",["T_OBJECT_OPERATOR","->",1058],["T_STRING","fetchPairs",1058],"(",["T_VARIABLE","$anchorStmt",1058],")",";",["T_WHITESPACE","\n                ",1058],["T_VARIABLE","$anchorStmt",1059],["T_WHITESPACE"," ",1059],"=",["T_WHITESPACE"," ",1059],["T_STRING","null",1059],";",["T_WHITESPACE","\n            ",1059],"}",["T_WHITESPACE","\n            ",1060],["T_IF","if",1061],["T_WHITESPACE"," ",1061],"(",["T_VARIABLE","$isNotAnchor",1061],")",["T_WHITESPACE"," ",1061],"{",["T_WHITESPACE","\n                ",1061],["T_VARIABLE","$notAnchorStmt",1062],["T_WHITESPACE"," ",1062],"=",["T_WHITESPACE"," ",1062],["T_CLONE","clone",1062],["T_WHITESPACE"," ",1062],["T_VARIABLE","$select",1062],";",["T_WHITESPACE","\n                ",1062],["T_VARIABLE","$notAnchorStmt",1063],["T_OBJECT_OPERATOR","->",1063],["T_STRING","limit",1063],"(",")",";",["T_WHITESPACE"," ",1063],["T_COMMENT","\/\/reset limits\n",1063],["T_WHITESPACE","                ",1064],["T_VARIABLE","$notAnchorStmt",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","where",1064],"(",["T_CONSTANT_ENCAPSED_STRING","'count_table.category_id IN (?)'",1064],",",["T_WHITESPACE"," ",1064],["T_VARIABLE","$isNotAnchor",1064],")",";",["T_WHITESPACE","\n                ",1064],["T_VARIABLE","$notAnchorStmt",1065],["T_OBJECT_OPERATOR","->",1065],["T_STRING","where",1065],"(",["T_CONSTANT_ENCAPSED_STRING","'count_table.is_parent = 1'",1065],")",";",["T_WHITESPACE","\n                ",1065],["T_VARIABLE","$productCounts",1066],["T_WHITESPACE"," ",1066],["T_PLUS_EQUAL","+=",1066],["T_WHITESPACE"," ",1066],["T_VARIABLE","$this",1066],["T_OBJECT_OPERATOR","->",1066],["T_STRING","getConnection",1066],"(",")",["T_OBJECT_OPERATOR","->",1066],["T_STRING","fetchPairs",1066],"(",["T_VARIABLE","$notAnchorStmt",1066],")",";",["T_WHITESPACE","\n                ",1066],["T_VARIABLE","$notAnchorStmt",1067],["T_WHITESPACE"," ",1067],"=",["T_WHITESPACE"," ",1067],["T_STRING","null",1067],";",["T_WHITESPACE","\n            ",1067],"}",["T_WHITESPACE","\n            ",1068],["T_VARIABLE","$select",1069],["T_WHITESPACE"," ",1069],"=",["T_WHITESPACE"," ",1069],["T_STRING","null",1069],";",["T_WHITESPACE","\n            ",1069],["T_VARIABLE","$this",1070],["T_OBJECT_OPERATOR","->",1070],["T_STRING","unsProductCountSelect",1070],"(",")",";",["T_WHITESPACE","\n        ",1070],"}",["T_WHITESPACE","\n\n        ",1071],["T_FOREACH","foreach",1073],["T_WHITESPACE"," ",1073],"(",["T_VARIABLE","$categoryCollection",1073],["T_WHITESPACE"," ",1073],["T_AS","as",1073],["T_WHITESPACE"," ",1073],["T_VARIABLE","$category",1073],")",["T_WHITESPACE"," ",1073],"{",["T_WHITESPACE","\n            ",1073],["T_VARIABLE","$_count",1074],["T_WHITESPACE"," ",1074],"=",["T_WHITESPACE"," ",1074],["T_LNUMBER","0",1074],";",["T_WHITESPACE","\n            ",1074],["T_IF","if",1075],["T_WHITESPACE"," ",1075],"(",["T_ISSET","isset",1075],"(",["T_VARIABLE","$productCounts",1075],"[",["T_VARIABLE","$category",1075],["T_OBJECT_OPERATOR","->",1075],["T_STRING","getId",1075],"(",")","]",")",")",["T_WHITESPACE"," ",1075],"{",["T_WHITESPACE","\n                ",1075],["T_VARIABLE","$_count",1076],["T_WHITESPACE"," ",1076],"=",["T_WHITESPACE"," ",1076],["T_VARIABLE","$productCounts",1076],"[",["T_VARIABLE","$category",1076],["T_OBJECT_OPERATOR","->",1076],["T_STRING","getId",1076],"(",")","]",";",["T_WHITESPACE","\n            ",1076],"}",["T_WHITESPACE","\n            ",1077],["T_VARIABLE","$category",1078],["T_OBJECT_OPERATOR","->",1078],["T_STRING","setProductCount",1078],"(",["T_VARIABLE","$_count",1078],")",";",["T_WHITESPACE","\n        ",1078],"}",["T_WHITESPACE","\n\n        ",1079],["T_RETURN","return",1081],["T_WHITESPACE"," ",1081],["T_VARIABLE","$this",1081],";",["T_WHITESPACE","\n    ",1081],"}",["T_WHITESPACE","\n\n    ",1082],["T_DOC_COMMENT","\/**\n     * Retrieve unique attribute set ids in collection\n     *\n     * @return array\n     *\/",1084],["T_WHITESPACE","\n    ",1088],["T_PUBLIC","public",1089],["T_WHITESPACE"," ",1089],["T_FUNCTION","function",1089],["T_WHITESPACE"," ",1089],["T_STRING","getSetIds",1089],"(",")",["T_WHITESPACE","\n    ",1089],"{",["T_WHITESPACE","\n        ",1090],["T_VARIABLE","$select",1091],["T_WHITESPACE"," ",1091],"=",["T_WHITESPACE"," ",1091],["T_CLONE","clone",1091],["T_WHITESPACE"," ",1091],["T_VARIABLE","$this",1091],["T_OBJECT_OPERATOR","->",1091],["T_STRING","getSelect",1091],"(",")",";",["T_WHITESPACE","\n        ",1091],["T_DOC_COMMENT","\/** @var $select Varien_Db_Select *\/",1092],["T_WHITESPACE","\n        ",1092],["T_VARIABLE","$select",1093],["T_OBJECT_OPERATOR","->",1093],["T_STRING","reset",1093],"(",["T_STRING","Zend_Db_Select",1093],["T_DOUBLE_COLON","::",1093],["T_STRING","COLUMNS",1093],")",";",["T_WHITESPACE","\n        ",1093],["T_VARIABLE","$select",1094],["T_OBJECT_OPERATOR","->",1094],["T_STRING","distinct",1094],"(",["T_STRING","true",1094],")",";",["T_WHITESPACE","\n        ",1094],["T_VARIABLE","$select",1095],["T_OBJECT_OPERATOR","->",1095],["T_STRING","columns",1095],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_set_id'",1095],")",";",["T_WHITESPACE","\n        ",1095],["T_RETURN","return",1096],["T_WHITESPACE"," ",1096],["T_VARIABLE","$this",1096],["T_OBJECT_OPERATOR","->",1096],["T_STRING","getConnection",1096],"(",")",["T_OBJECT_OPERATOR","->",1096],["T_STRING","fetchCol",1096],"(",["T_VARIABLE","$select",1096],")",";",["T_WHITESPACE","\n    ",1096],"}",["T_WHITESPACE","\n\n    ",1097],["T_DOC_COMMENT","\/**\n     * Return array of unique product type ids in collection\n     *\n     * @return array\n     *\/",1099],["T_WHITESPACE","\n    ",1103],["T_PUBLIC","public",1104],["T_WHITESPACE"," ",1104],["T_FUNCTION","function",1104],["T_WHITESPACE"," ",1104],["T_STRING","getProductTypeIds",1104],"(",")",["T_WHITESPACE","\n    ",1104],"{",["T_WHITESPACE","\n        ",1105],["T_VARIABLE","$select",1106],["T_WHITESPACE"," ",1106],"=",["T_WHITESPACE"," ",1106],["T_CLONE","clone",1106],["T_WHITESPACE"," ",1106],["T_VARIABLE","$this",1106],["T_OBJECT_OPERATOR","->",1106],["T_STRING","getSelect",1106],"(",")",";",["T_WHITESPACE","\n        ",1106],["T_DOC_COMMENT","\/** @var $select Varien_Db_Select *\/",1107],["T_WHITESPACE","\n        ",1107],["T_VARIABLE","$select",1108],["T_OBJECT_OPERATOR","->",1108],["T_STRING","reset",1108],"(",["T_STRING","Zend_Db_Select",1108],["T_DOUBLE_COLON","::",1108],["T_STRING","COLUMNS",1108],")",";",["T_WHITESPACE","\n        ",1108],["T_VARIABLE","$select",1109],["T_OBJECT_OPERATOR","->",1109],["T_STRING","distinct",1109],"(",["T_STRING","true",1109],")",";",["T_WHITESPACE","\n        ",1109],["T_VARIABLE","$select",1110],["T_OBJECT_OPERATOR","->",1110],["T_STRING","columns",1110],"(",["T_CONSTANT_ENCAPSED_STRING","'type_id'",1110],")",";",["T_WHITESPACE","\n        ",1110],["T_RETURN","return",1111],["T_WHITESPACE"," ",1111],["T_VARIABLE","$this",1111],["T_OBJECT_OPERATOR","->",1111],["T_STRING","getConnection",1111],"(",")",["T_OBJECT_OPERATOR","->",1111],["T_STRING","fetchCol",1111],"(",["T_VARIABLE","$select",1111],")",";",["T_WHITESPACE","\n    ",1111],"}",["T_WHITESPACE","\n\n    ",1112],["T_DOC_COMMENT","\/**\n     * Joins url rewrite rules to collection\n     *\n     * @deprecated after 1.7.0.2. Method is not used anywhere in the code.\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1114],["T_WHITESPACE","\n    ",1119],["T_PUBLIC","public",1120],["T_WHITESPACE"," ",1120],["T_FUNCTION","function",1120],["T_WHITESPACE"," ",1120],["T_STRING","joinUrlRewrite",1120],"(",")",["T_WHITESPACE","\n    ",1120],"{",["T_WHITESPACE","\n        ",1121],["T_VARIABLE","$this",1122],["T_OBJECT_OPERATOR","->",1122],["T_STRING","joinTable",1122],"(",["T_WHITESPACE","\n            ",1122],["T_CONSTANT_ENCAPSED_STRING","'core\/url_rewrite'",1123],",",["T_WHITESPACE","\n            ",1123],["T_CONSTANT_ENCAPSED_STRING","'entity_id=entity_id'",1124],",",["T_WHITESPACE","\n            ",1124],["T_ARRAY","array",1125],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path'",1125],")",",",["T_WHITESPACE","\n            ",1125],["T_CONSTANT_ENCAPSED_STRING","'{{table}}.type = '",1126],["T_WHITESPACE"," ",1126],".",["T_WHITESPACE"," ",1126],["T_STRING","Mage_Core_Model_Url_Rewrite",1126],["T_DOUBLE_COLON","::",1126],["T_STRING","TYPE_PRODUCT",1126],",",["T_WHITESPACE","\n            ",1126],["T_CONSTANT_ENCAPSED_STRING","'left'",1127],["T_WHITESPACE","\n        ",1127],")",";",["T_WHITESPACE","\n\n        ",1128],["T_RETURN","return",1130],["T_WHITESPACE"," ",1130],["T_VARIABLE","$this",1130],";",["T_WHITESPACE","\n    ",1130],"}",["T_WHITESPACE","\n\n    ",1131],["T_DOC_COMMENT","\/**\n     * Add URL rewrites data to product\n     * If collection loadded - run processing else set flag\n     *\n     * @param int|string $categoryId\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1133],["T_WHITESPACE","\n    ",1139],["T_PUBLIC","public",1140],["T_WHITESPACE"," ",1140],["T_FUNCTION","function",1140],["T_WHITESPACE"," ",1140],["T_STRING","addUrlRewrite",1140],"(",["T_VARIABLE","$categoryId",1140],["T_WHITESPACE"," ",1140],"=",["T_WHITESPACE"," ",1140],["T_CONSTANT_ENCAPSED_STRING","''",1140],")",["T_WHITESPACE","\n    ",1140],"{",["T_WHITESPACE","\n        ",1141],["T_VARIABLE","$this",1142],["T_OBJECT_OPERATOR","->",1142],["T_STRING","_addUrlRewrite",1142],["T_WHITESPACE"," ",1142],"=",["T_WHITESPACE"," ",1142],["T_STRING","true",1142],";",["T_WHITESPACE","\n        ",1142],["T_IF","if",1143],["T_WHITESPACE"," ",1143],"(",["T_STRING","Mage",1143],["T_DOUBLE_COLON","::",1143],["T_STRING","getStoreConfig",1143],"(",["T_STRING","Mage_Catalog_Helper_Product",1143],["T_DOUBLE_COLON","::",1143],["T_STRING","XML_PATH_PRODUCT_URL_USE_CATEGORY",1143],",",["T_WHITESPACE"," ",1143],["T_VARIABLE","$this",1143],["T_OBJECT_OPERATOR","->",1143],["T_STRING","getStoreId",1143],"(",")",")",")",["T_WHITESPACE"," ",1143],"{",["T_WHITESPACE","\n            ",1143],["T_VARIABLE","$this",1144],["T_OBJECT_OPERATOR","->",1144],["T_STRING","_urlRewriteCategory",1144],["T_WHITESPACE"," ",1144],"=",["T_WHITESPACE"," ",1144],["T_VARIABLE","$categoryId",1144],";",["T_WHITESPACE","\n        ",1144],"}",["T_WHITESPACE"," ",1145],["T_ELSE","else",1145],["T_WHITESPACE"," ",1145],"{",["T_WHITESPACE","\n            ",1145],["T_VARIABLE","$this",1146],["T_OBJECT_OPERATOR","->",1146],["T_STRING","_urlRewriteCategory",1146],["T_WHITESPACE"," ",1146],"=",["T_WHITESPACE"," ",1146],["T_LNUMBER","0",1146],";",["T_WHITESPACE","\n        ",1146],"}",["T_WHITESPACE","\n\n        ",1147],["T_IF","if",1149],["T_WHITESPACE"," ",1149],"(",["T_VARIABLE","$this",1149],["T_OBJECT_OPERATOR","->",1149],["T_STRING","isLoaded",1149],"(",")",")",["T_WHITESPACE"," ",1149],"{",["T_WHITESPACE","\n            ",1149],["T_VARIABLE","$this",1150],["T_OBJECT_OPERATOR","->",1150],["T_STRING","_addUrlRewrite",1150],"(",")",";",["T_WHITESPACE","\n        ",1150],"}",["T_WHITESPACE","\n\n        ",1151],["T_RETURN","return",1153],["T_WHITESPACE"," ",1153],["T_VARIABLE","$this",1153],";",["T_WHITESPACE","\n    ",1153],"}",["T_WHITESPACE","\n\n    ",1154],["T_DOC_COMMENT","\/**\n     * Add URL rewrites to collection\n     *\n     *\/",1156],["T_WHITESPACE","\n    ",1159],["T_PROTECTED","protected",1160],["T_WHITESPACE"," ",1160],["T_FUNCTION","function",1160],["T_WHITESPACE"," ",1160],["T_STRING","_addUrlRewrite",1160],"(",")",["T_WHITESPACE","\n    ",1160],"{",["T_WHITESPACE","\n        ",1161],["T_VARIABLE","$urlRewrites",1162],["T_WHITESPACE"," ",1162],"=",["T_WHITESPACE"," ",1162],["T_STRING","null",1162],";",["T_WHITESPACE","\n        ",1162],["T_IF","if",1163],["T_WHITESPACE"," ",1163],"(",["T_VARIABLE","$this",1163],["T_OBJECT_OPERATOR","->",1163],["T_STRING","_cacheConf",1163],")",["T_WHITESPACE"," ",1163],"{",["T_WHITESPACE","\n            ",1163],["T_IF","if",1164],["T_WHITESPACE"," ",1164],"(","!","(",["T_VARIABLE","$urlRewrites",1164],["T_WHITESPACE"," ",1164],"=",["T_WHITESPACE"," ",1164],["T_STRING","Mage",1164],["T_DOUBLE_COLON","::",1164],["T_STRING","app",1164],"(",")",["T_OBJECT_OPERATOR","->",1164],["T_STRING","loadCache",1164],"(",["T_VARIABLE","$this",1164],["T_OBJECT_OPERATOR","->",1164],["T_STRING","_cacheConf",1164],"[",["T_CONSTANT_ENCAPSED_STRING","'prefix'",1164],"]",["T_WHITESPACE"," ",1164],".",["T_WHITESPACE"," ",1164],["T_CONSTANT_ENCAPSED_STRING","'urlrewrite'",1164],")",")",")",["T_WHITESPACE"," ",1164],"{",["T_WHITESPACE","\n                ",1164],["T_VARIABLE","$urlRewrites",1165],["T_WHITESPACE"," ",1165],"=",["T_WHITESPACE"," ",1165],["T_STRING","null",1165],";",["T_WHITESPACE","\n            ",1165],"}",["T_WHITESPACE"," ",1166],["T_ELSE","else",1166],["T_WHITESPACE"," ",1166],"{",["T_WHITESPACE","\n                ",1166],["T_VARIABLE","$urlRewrites",1167],["T_WHITESPACE"," ",1167],"=",["T_WHITESPACE"," ",1167],["T_STRING","unserialize",1167],"(",["T_VARIABLE","$urlRewrites",1167],")",";",["T_WHITESPACE","\n            ",1167],"}",["T_WHITESPACE","\n        ",1168],"}",["T_WHITESPACE","\n\n        ",1169],["T_IF","if",1171],["T_WHITESPACE"," ",1171],"(","!",["T_VARIABLE","$urlRewrites",1171],")",["T_WHITESPACE"," ",1171],"{",["T_WHITESPACE","\n            ",1171],["T_VARIABLE","$productIds",1172],["T_WHITESPACE"," ",1172],"=",["T_WHITESPACE"," ",1172],["T_ARRAY","array",1172],"(",")",";",["T_WHITESPACE","\n            ",1172],["T_FOREACH","foreach",1173],"(",["T_VARIABLE","$this",1173],["T_OBJECT_OPERATOR","->",1173],["T_STRING","getItems",1173],"(",")",["T_WHITESPACE"," ",1173],["T_AS","as",1173],["T_WHITESPACE"," ",1173],["T_VARIABLE","$item",1173],")",["T_WHITESPACE"," ",1173],"{",["T_WHITESPACE","\n                ",1173],["T_VARIABLE","$productIds",1174],"[","]",["T_WHITESPACE"," ",1174],"=",["T_WHITESPACE"," ",1174],["T_VARIABLE","$item",1174],["T_OBJECT_OPERATOR","->",1174],["T_STRING","getEntityId",1174],"(",")",";",["T_WHITESPACE","\n            ",1174],"}",["T_WHITESPACE","\n            ",1175],["T_IF","if",1176],["T_WHITESPACE"," ",1176],"(","!",["T_STRING","count",1176],"(",["T_VARIABLE","$productIds",1176],")",")",["T_WHITESPACE"," ",1176],"{",["T_WHITESPACE","\n                ",1176],["T_RETURN","return",1177],";",["T_WHITESPACE","\n            ",1177],"}",["T_WHITESPACE","\n\n            ",1178],["T_VARIABLE","$select",1180],["T_WHITESPACE"," ",1180],"=",["T_WHITESPACE"," ",1180],["T_VARIABLE","$this",1180],["T_OBJECT_OPERATOR","->",1180],["T_STRING","_factory",1180],["T_OBJECT_OPERATOR","->",1180],["T_STRING","getProductUrlRewriteHelper",1180],"(",")",["T_WHITESPACE","\n                ",1180],["T_OBJECT_OPERATOR","->",1181],["T_STRING","getTableSelect",1181],"(",["T_VARIABLE","$productIds",1181],",",["T_WHITESPACE"," ",1181],["T_VARIABLE","$this",1181],["T_OBJECT_OPERATOR","->",1181],["T_STRING","_urlRewriteCategory",1181],",",["T_WHITESPACE"," ",1181],["T_STRING","Mage",1181],["T_DOUBLE_COLON","::",1181],["T_STRING","app",1181],"(",")",["T_OBJECT_OPERATOR","->",1181],["T_STRING","getStore",1181],"(",")",["T_OBJECT_OPERATOR","->",1181],["T_STRING","getId",1181],"(",")",")",";",["T_WHITESPACE","\n\n            ",1181],["T_VARIABLE","$urlRewrites",1183],["T_WHITESPACE"," ",1183],"=",["T_WHITESPACE"," ",1183],["T_ARRAY","array",1183],"(",")",";",["T_WHITESPACE","\n            ",1183],["T_FOREACH","foreach",1184],["T_WHITESPACE"," ",1184],"(",["T_VARIABLE","$this",1184],["T_OBJECT_OPERATOR","->",1184],["T_STRING","getConnection",1184],"(",")",["T_OBJECT_OPERATOR","->",1184],["T_STRING","fetchAll",1184],"(",["T_VARIABLE","$select",1184],")",["T_WHITESPACE"," ",1184],["T_AS","as",1184],["T_WHITESPACE"," ",1184],["T_VARIABLE","$row",1184],")",["T_WHITESPACE"," ",1184],"{",["T_WHITESPACE","\n                ",1184],["T_IF","if",1185],["T_WHITESPACE"," ",1185],"(","!",["T_ISSET","isset",1185],"(",["T_VARIABLE","$urlRewrites",1185],"[",["T_VARIABLE","$row",1185],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1185],"]","]",")",")",["T_WHITESPACE"," ",1185],"{",["T_WHITESPACE","\n                    ",1185],["T_VARIABLE","$urlRewrites",1186],"[",["T_VARIABLE","$row",1186],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1186],"]","]",["T_WHITESPACE"," ",1186],"=",["T_WHITESPACE"," ",1186],["T_VARIABLE","$row",1186],"[",["T_CONSTANT_ENCAPSED_STRING","'request_path'",1186],"]",";",["T_WHITESPACE","\n                ",1186],"}",["T_WHITESPACE","\n            ",1187],"}",["T_WHITESPACE","\n\n            ",1188],["T_IF","if",1190],["T_WHITESPACE"," ",1190],"(",["T_VARIABLE","$this",1190],["T_OBJECT_OPERATOR","->",1190],["T_STRING","_cacheConf",1190],")",["T_WHITESPACE"," ",1190],"{",["T_WHITESPACE","\n                ",1190],["T_STRING","Mage",1191],["T_DOUBLE_COLON","::",1191],["T_STRING","app",1191],"(",")",["T_OBJECT_OPERATOR","->",1191],["T_STRING","saveCache",1191],"(",["T_WHITESPACE","\n                    ",1191],["T_STRING","serialize",1192],"(",["T_VARIABLE","$urlRewrites",1192],")",",",["T_WHITESPACE","\n                    ",1192],["T_VARIABLE","$this",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","_cacheConf",1193],"[",["T_CONSTANT_ENCAPSED_STRING","'prefix'",1193],"]",["T_WHITESPACE"," ",1193],".",["T_WHITESPACE"," ",1193],["T_CONSTANT_ENCAPSED_STRING","'urlrewrite'",1193],",",["T_WHITESPACE","\n                    ",1193],["T_STRING","array_merge",1194],"(",["T_VARIABLE","$this",1194],["T_OBJECT_OPERATOR","->",1194],["T_STRING","_cacheConf",1194],"[",["T_CONSTANT_ENCAPSED_STRING","'tags'",1194],"]",",",["T_WHITESPACE"," ",1194],["T_ARRAY","array",1194],"(",["T_STRING","Mage_Catalog_Model_Product_Url",1194],["T_DOUBLE_COLON","::",1194],["T_STRING","CACHE_TAG",1194],")",")",",",["T_WHITESPACE","\n                    ",1194],["T_VARIABLE","$this",1195],["T_OBJECT_OPERATOR","->",1195],["T_STRING","_cacheLifetime",1195],["T_WHITESPACE","\n                ",1195],")",";",["T_WHITESPACE","\n            ",1196],"}",["T_WHITESPACE","\n        ",1197],"}",["T_WHITESPACE","\n\n        ",1198],["T_FOREACH","foreach",1200],"(",["T_VARIABLE","$this",1200],["T_OBJECT_OPERATOR","->",1200],["T_STRING","getItems",1200],"(",")",["T_WHITESPACE"," ",1200],["T_AS","as",1200],["T_WHITESPACE"," ",1200],["T_VARIABLE","$item",1200],")",["T_WHITESPACE"," ",1200],"{",["T_WHITESPACE","\n            ",1200],["T_IF","if",1201],["T_WHITESPACE"," ",1201],"(",["T_EMPTY","empty",1201],"(",["T_VARIABLE","$this",1201],["T_OBJECT_OPERATOR","->",1201],["T_STRING","_urlRewriteCategory",1201],")",")",["T_WHITESPACE"," ",1201],"{",["T_WHITESPACE","\n                ",1201],["T_VARIABLE","$item",1202],["T_OBJECT_OPERATOR","->",1202],["T_STRING","setDoNotUseCategoryId",1202],"(",["T_STRING","true",1202],")",";",["T_WHITESPACE","\n            ",1202],"}",["T_WHITESPACE","\n            ",1203],["T_IF","if",1204],["T_WHITESPACE"," ",1204],"(",["T_ISSET","isset",1204],"(",["T_VARIABLE","$urlRewrites",1204],"[",["T_VARIABLE","$item",1204],["T_OBJECT_OPERATOR","->",1204],["T_STRING","getEntityId",1204],"(",")","]",")",")",["T_WHITESPACE"," ",1204],"{",["T_WHITESPACE","\n                ",1204],["T_VARIABLE","$item",1205],["T_OBJECT_OPERATOR","->",1205],["T_STRING","setData",1205],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path'",1205],",",["T_WHITESPACE"," ",1205],["T_VARIABLE","$urlRewrites",1205],"[",["T_VARIABLE","$item",1205],["T_OBJECT_OPERATOR","->",1205],["T_STRING","getEntityId",1205],"(",")","]",")",";",["T_WHITESPACE","\n            ",1205],"}",["T_WHITESPACE"," ",1206],["T_ELSE","else",1206],["T_WHITESPACE"," ",1206],"{",["T_WHITESPACE","\n                ",1206],["T_VARIABLE","$item",1207],["T_OBJECT_OPERATOR","->",1207],["T_STRING","setData",1207],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path'",1207],",",["T_WHITESPACE"," ",1207],["T_STRING","false",1207],")",";",["T_WHITESPACE","\n            ",1207],"}",["T_WHITESPACE","\n        ",1208],"}",["T_WHITESPACE","\n    ",1209],"}",["T_WHITESPACE","\n\n    ",1210],["T_DOC_COMMENT","\/**\n     * Add minimal price data to result\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1212],["T_WHITESPACE","\n    ",1216],["T_PUBLIC","public",1217],["T_WHITESPACE"," ",1217],["T_FUNCTION","function",1217],["T_WHITESPACE"," ",1217],["T_STRING","addMinimalPrice",1217],"(",")",["T_WHITESPACE","\n    ",1217],"{",["T_WHITESPACE","\n        ",1218],["T_RETURN","return",1219],["T_WHITESPACE"," ",1219],["T_VARIABLE","$this",1219],["T_OBJECT_OPERATOR","->",1219],["T_STRING","addPriceData",1219],"(",")",";",["T_WHITESPACE","\n    ",1219],"}",["T_WHITESPACE","\n\n    ",1220],["T_DOC_COMMENT","\/**\n     * Add minimal price to product collection\n     *\n     * @deprecated sinse 1.3.2.2\n     * @see Mage_Catalog_Model_Resource_Product_Collection::addPriceData\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1222],["T_WHITESPACE","\n    ",1229],["T_PROTECTED","protected",1230],["T_WHITESPACE"," ",1230],["T_FUNCTION","function",1230],["T_WHITESPACE"," ",1230],["T_STRING","_addMinimalPrice",1230],"(",")",["T_WHITESPACE","\n    ",1230],"{",["T_WHITESPACE","\n        ",1231],["T_RETURN","return",1232],["T_WHITESPACE"," ",1232],["T_VARIABLE","$this",1232],";",["T_WHITESPACE","\n    ",1232],"}",["T_WHITESPACE","\n\n    ",1233],["T_DOC_COMMENT","\/**\n     * Add price data for calculate final price\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1235],["T_WHITESPACE","\n    ",1239],["T_PUBLIC","public",1240],["T_WHITESPACE"," ",1240],["T_FUNCTION","function",1240],["T_WHITESPACE"," ",1240],["T_STRING","addFinalPrice",1240],"(",")",["T_WHITESPACE","\n    ",1240],"{",["T_WHITESPACE","\n        ",1241],["T_RETURN","return",1242],["T_WHITESPACE"," ",1242],["T_VARIABLE","$this",1242],["T_OBJECT_OPERATOR","->",1242],["T_STRING","addPriceData",1242],"(",")",";",["T_WHITESPACE","\n    ",1242],"}",["T_WHITESPACE","\n\n    ",1243],["T_DOC_COMMENT","\/**\n     * Join prices from price rules to products collection\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1245],["T_WHITESPACE","\n    ",1249],["T_PROTECTED","protected",1250],["T_WHITESPACE"," ",1250],["T_FUNCTION","function",1250],["T_WHITESPACE"," ",1250],["T_STRING","_joinPriceRules",1250],"(",")",["T_WHITESPACE","\n    ",1250],"{",["T_WHITESPACE","\n        ",1251],["T_IF","if",1252],["T_WHITESPACE"," ",1252],"(",["T_VARIABLE","$this",1252],["T_OBJECT_OPERATOR","->",1252],["T_STRING","isEnabledFlat",1252],"(",")",")",["T_WHITESPACE"," ",1252],"{",["T_WHITESPACE","\n            ",1252],["T_VARIABLE","$customerGroup",1253],["T_WHITESPACE"," ",1253],"=",["T_WHITESPACE"," ",1253],["T_STRING","Mage",1253],["T_DOUBLE_COLON","::",1253],["T_STRING","getSingleton",1253],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",1253],")",["T_OBJECT_OPERATOR","->",1253],["T_STRING","getCustomerGroupId",1253],"(",")",";",["T_WHITESPACE","\n            ",1253],["T_VARIABLE","$priceColumn",1254],["T_WHITESPACE","   ",1254],"=",["T_WHITESPACE"," ",1254],["T_CONSTANT_ENCAPSED_STRING","'e.display_price_group_'",1254],["T_WHITESPACE"," ",1254],".",["T_WHITESPACE"," ",1254],["T_VARIABLE","$customerGroup",1254],";",["T_WHITESPACE","\n            ",1254],["T_VARIABLE","$this",1255],["T_OBJECT_OPERATOR","->",1255],["T_STRING","getSelect",1255],"(",")",["T_OBJECT_OPERATOR","->",1255],["T_STRING","columns",1255],"(",["T_ARRAY","array",1255],"(",["T_CONSTANT_ENCAPSED_STRING","'_rule_price'",1255],["T_WHITESPACE"," ",1255],["T_DOUBLE_ARROW","=>",1255],["T_WHITESPACE"," ",1255],["T_VARIABLE","$priceColumn",1255],")",")",";",["T_WHITESPACE","\n\n            ",1255],["T_RETURN","return",1257],["T_WHITESPACE"," ",1257],["T_VARIABLE","$this",1257],";",["T_WHITESPACE","\n        ",1257],"}",["T_WHITESPACE","\n        ",1258],["T_IF","if",1259],["T_WHITESPACE"," ",1259],"(","!",["T_STRING","Mage",1259],["T_DOUBLE_COLON","::",1259],["T_STRING","helper",1259],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",1259],")",["T_OBJECT_OPERATOR","->",1259],["T_STRING","isModuleEnabled",1259],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_CatalogRule'",1259],")",")",["T_WHITESPACE"," ",1259],"{",["T_WHITESPACE","\n            ",1259],["T_RETURN","return",1260],["T_WHITESPACE"," ",1260],["T_VARIABLE","$this",1260],";",["T_WHITESPACE","\n        ",1260],"}",["T_WHITESPACE","\n        ",1261],["T_VARIABLE","$wId",1262],["T_WHITESPACE"," ",1262],"=",["T_WHITESPACE"," ",1262],["T_STRING","Mage",1262],["T_DOUBLE_COLON","::",1262],["T_STRING","app",1262],"(",")",["T_OBJECT_OPERATOR","->",1262],["T_STRING","getWebsite",1262],"(",")",["T_OBJECT_OPERATOR","->",1262],["T_STRING","getId",1262],"(",")",";",["T_WHITESPACE","\n        ",1262],["T_VARIABLE","$gId",1263],["T_WHITESPACE"," ",1263],"=",["T_WHITESPACE"," ",1263],["T_STRING","Mage",1263],["T_DOUBLE_COLON","::",1263],["T_STRING","getSingleton",1263],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",1263],")",["T_OBJECT_OPERATOR","->",1263],["T_STRING","getCustomerGroupId",1263],"(",")",";",["T_WHITESPACE","\n\n        ",1263],["T_VARIABLE","$storeDate",1265],["T_WHITESPACE"," ",1265],"=",["T_WHITESPACE"," ",1265],["T_STRING","Mage",1265],["T_DOUBLE_COLON","::",1265],["T_STRING","app",1265],"(",")",["T_OBJECT_OPERATOR","->",1265],["T_STRING","getLocale",1265],"(",")",["T_OBJECT_OPERATOR","->",1265],["T_STRING","storeTimeStamp",1265],"(",["T_VARIABLE","$this",1265],["T_OBJECT_OPERATOR","->",1265],["T_STRING","getStoreId",1265],"(",")",")",";",["T_WHITESPACE","\n        ",1265],["T_VARIABLE","$conditions",1266],["T_WHITESPACE","  ",1266],"=",["T_WHITESPACE"," ",1266],["T_CONSTANT_ENCAPSED_STRING","'price_rule.product_id = e.entity_id AND '",1266],";",["T_WHITESPACE","\n        ",1266],["T_VARIABLE","$conditions",1267],["T_WHITESPACE"," ",1267],["T_CONCAT_EQUAL",".=",1267],["T_WHITESPACE"," ",1267],["T_CONSTANT_ENCAPSED_STRING","\"price_rule.rule_date = '\"",1267],".",["T_VARIABLE","$this",1267],["T_OBJECT_OPERATOR","->",1267],["T_STRING","getResource",1267],"(",")",["T_OBJECT_OPERATOR","->",1267],["T_STRING","formatDate",1267],"(",["T_VARIABLE","$storeDate",1267],",",["T_WHITESPACE"," ",1267],["T_STRING","false",1267],")",".",["T_CONSTANT_ENCAPSED_STRING","\"' AND \"",1267],";",["T_WHITESPACE","\n        ",1267],["T_VARIABLE","$conditions",1268],["T_WHITESPACE"," ",1268],["T_CONCAT_EQUAL",".=",1268],["T_WHITESPACE"," ",1268],["T_VARIABLE","$this",1268],["T_OBJECT_OPERATOR","->",1268],["T_STRING","getConnection",1268],"(",")",["T_OBJECT_OPERATOR","->",1268],["T_STRING","quoteInto",1268],"(",["T_CONSTANT_ENCAPSED_STRING","'price_rule.website_id = ? AND'",1268],",",["T_WHITESPACE"," ",1268],["T_VARIABLE","$wId",1268],")",";",["T_WHITESPACE","\n        ",1268],["T_VARIABLE","$conditions",1269],["T_WHITESPACE"," ",1269],["T_CONCAT_EQUAL",".=",1269],["T_WHITESPACE"," ",1269],["T_VARIABLE","$this",1269],["T_OBJECT_OPERATOR","->",1269],["T_STRING","getConnection",1269],"(",")",["T_OBJECT_OPERATOR","->",1269],["T_STRING","quoteInto",1269],"(",["T_CONSTANT_ENCAPSED_STRING","'price_rule.customer_group_id = ?'",1269],",",["T_WHITESPACE"," ",1269],["T_VARIABLE","$gId",1269],")",";",["T_WHITESPACE","\n\n        ",1269],["T_VARIABLE","$this",1271],["T_OBJECT_OPERATOR","->",1271],["T_STRING","getSelect",1271],"(",")",["T_OBJECT_OPERATOR","->",1271],["T_STRING","joinLeft",1271],"(",["T_WHITESPACE","\n            ",1271],["T_ARRAY","array",1272],"(",["T_CONSTANT_ENCAPSED_STRING","'price_rule'",1272],["T_WHITESPACE"," ",1272],["T_DOUBLE_ARROW","=>",1272],["T_WHITESPACE"," ",1272],["T_VARIABLE","$this",1272],["T_OBJECT_OPERATOR","->",1272],["T_STRING","getTable",1272],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product_price'",1272],")",")",",",["T_WHITESPACE","\n            ",1272],["T_VARIABLE","$conditions",1273],",",["T_WHITESPACE","\n            ",1273],["T_ARRAY","array",1274],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_price'",1274],["T_WHITESPACE"," ",1274],["T_DOUBLE_ARROW","=>",1274],["T_WHITESPACE"," ",1274],["T_CONSTANT_ENCAPSED_STRING","'rule_price'",1274],")",["T_WHITESPACE","\n        ",1274],")",";",["T_WHITESPACE","\n        ",1275],["T_RETURN","return",1276],["T_WHITESPACE"," ",1276],["T_VARIABLE","$this",1276],";",["T_WHITESPACE","\n    ",1276],"}",["T_WHITESPACE","\n\n    ",1277],["T_DOC_COMMENT","\/**\n     * Add final price to the product\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1279],["T_WHITESPACE","\n    ",1283],["T_PROTECTED","protected",1284],["T_WHITESPACE"," ",1284],["T_FUNCTION","function",1284],["T_WHITESPACE"," ",1284],["T_STRING","_addFinalPrice",1284],"(",")",["T_WHITESPACE","\n    ",1284],"{",["T_WHITESPACE","\n        ",1285],["T_FOREACH","foreach",1286],["T_WHITESPACE"," ",1286],"(",["T_VARIABLE","$this",1286],["T_OBJECT_OPERATOR","->",1286],["T_STRING","_items",1286],["T_WHITESPACE"," ",1286],["T_AS","as",1286],["T_WHITESPACE"," ",1286],["T_VARIABLE","$product",1286],")",["T_WHITESPACE"," ",1286],"{",["T_WHITESPACE","\n            ",1286],["T_VARIABLE","$basePrice",1287],["T_WHITESPACE"," ",1287],"=",["T_WHITESPACE"," ",1287],["T_VARIABLE","$product",1287],["T_OBJECT_OPERATOR","->",1287],["T_STRING","getPrice",1287],"(",")",";",["T_WHITESPACE","\n            ",1287],["T_VARIABLE","$specialPrice",1288],["T_WHITESPACE"," ",1288],"=",["T_WHITESPACE"," ",1288],["T_VARIABLE","$product",1288],["T_OBJECT_OPERATOR","->",1288],["T_STRING","getSpecialPrice",1288],"(",")",";",["T_WHITESPACE","\n            ",1288],["T_VARIABLE","$specialPriceFrom",1289],["T_WHITESPACE"," ",1289],"=",["T_WHITESPACE"," ",1289],["T_VARIABLE","$product",1289],["T_OBJECT_OPERATOR","->",1289],["T_STRING","getSpecialFromDate",1289],"(",")",";",["T_WHITESPACE","\n            ",1289],["T_VARIABLE","$specialPriceTo",1290],["T_WHITESPACE"," ",1290],"=",["T_WHITESPACE"," ",1290],["T_VARIABLE","$product",1290],["T_OBJECT_OPERATOR","->",1290],["T_STRING","getSpecialToDate",1290],"(",")",";",["T_WHITESPACE","\n            ",1290],["T_IF","if",1291],["T_WHITESPACE"," ",1291],"(",["T_VARIABLE","$this",1291],["T_OBJECT_OPERATOR","->",1291],["T_STRING","isEnabledFlat",1291],"(",")",")",["T_WHITESPACE"," ",1291],"{",["T_WHITESPACE","\n                ",1291],["T_VARIABLE","$rulePrice",1292],["T_WHITESPACE"," ",1292],"=",["T_WHITESPACE"," ",1292],["T_STRING","null",1292],";",["T_WHITESPACE","\n                ",1292],["T_IF","if",1293],["T_WHITESPACE"," ",1293],"(",["T_VARIABLE","$product",1293],["T_OBJECT_OPERATOR","->",1293],["T_STRING","getData",1293],"(",["T_CONSTANT_ENCAPSED_STRING","'_rule_price'",1293],")",["T_WHITESPACE"," ",1293],["T_IS_NOT_EQUAL","!=",1293],["T_WHITESPACE"," ",1293],["T_VARIABLE","$basePrice",1293],")",["T_WHITESPACE"," ",1293],"{",["T_WHITESPACE","\n                    ",1293],["T_VARIABLE","$rulePrice",1294],["T_WHITESPACE"," ",1294],"=",["T_WHITESPACE"," ",1294],["T_VARIABLE","$product",1294],["T_OBJECT_OPERATOR","->",1294],["T_STRING","getData",1294],"(",["T_CONSTANT_ENCAPSED_STRING","'_rule_price'",1294],")",";",["T_WHITESPACE","\n                ",1294],"}",["T_WHITESPACE","\n            ",1295],"}",["T_WHITESPACE"," ",1296],["T_ELSE","else",1296],["T_WHITESPACE"," ",1296],"{",["T_WHITESPACE","\n                ",1296],["T_VARIABLE","$rulePrice",1297],["T_WHITESPACE"," ",1297],"=",["T_WHITESPACE"," ",1297],["T_VARIABLE","$product",1297],["T_OBJECT_OPERATOR","->",1297],["T_STRING","getData",1297],"(",["T_CONSTANT_ENCAPSED_STRING","'_rule_price'",1297],")",";",["T_WHITESPACE","\n            ",1297],"}",["T_WHITESPACE","\n\n            ",1298],["T_VARIABLE","$finalPrice",1300],["T_WHITESPACE"," ",1300],"=",["T_WHITESPACE"," ",1300],["T_VARIABLE","$product",1300],["T_OBJECT_OPERATOR","->",1300],["T_STRING","getPriceModel",1300],"(",")",["T_OBJECT_OPERATOR","->",1300],["T_STRING","calculatePrice",1300],"(",["T_WHITESPACE","\n                ",1300],["T_VARIABLE","$basePrice",1301],",",["T_WHITESPACE","\n                ",1301],["T_VARIABLE","$specialPrice",1302],",",["T_WHITESPACE","\n                ",1302],["T_VARIABLE","$specialPriceFrom",1303],",",["T_WHITESPACE","\n                ",1303],["T_VARIABLE","$specialPriceTo",1304],",",["T_WHITESPACE","\n                ",1304],["T_VARIABLE","$rulePrice",1305],",",["T_WHITESPACE","\n                ",1305],["T_STRING","null",1306],",",["T_WHITESPACE","\n                ",1306],["T_STRING","null",1307],",",["T_WHITESPACE","\n                ",1307],["T_VARIABLE","$product",1308],["T_OBJECT_OPERATOR","->",1308],["T_STRING","getId",1308],"(",")",["T_WHITESPACE","\n            ",1308],")",";",["T_WHITESPACE","\n\n            ",1309],["T_VARIABLE","$product",1311],["T_OBJECT_OPERATOR","->",1311],["T_STRING","setCalculatedFinalPrice",1311],"(",["T_VARIABLE","$finalPrice",1311],")",";",["T_WHITESPACE","\n        ",1311],"}",["T_WHITESPACE","\n\n        ",1312],["T_RETURN","return",1314],["T_WHITESPACE"," ",1314],["T_VARIABLE","$this",1314],";",["T_WHITESPACE","\n    ",1314],"}",["T_WHITESPACE","\n\n    ",1315],["T_DOC_COMMENT","\/**\n     * Retreive all ids\n     *\n     * @param boolean $resetCache\n     * @return array\n     *\/",1317],["T_WHITESPACE","\n    ",1322],["T_PUBLIC","public",1323],["T_WHITESPACE"," ",1323],["T_FUNCTION","function",1323],["T_WHITESPACE"," ",1323],["T_STRING","getAllIdsCache",1323],"(",["T_VARIABLE","$resetCache",1323],["T_WHITESPACE"," ",1323],"=",["T_WHITESPACE"," ",1323],["T_STRING","false",1323],")",["T_WHITESPACE","\n    ",1323],"{",["T_WHITESPACE","\n        ",1324],["T_VARIABLE","$ids",1325],["T_WHITESPACE"," ",1325],"=",["T_WHITESPACE"," ",1325],["T_STRING","null",1325],";",["T_WHITESPACE","\n        ",1325],["T_IF","if",1326],["T_WHITESPACE"," ",1326],"(","!",["T_VARIABLE","$resetCache",1326],")",["T_WHITESPACE"," ",1326],"{",["T_WHITESPACE","\n            ",1326],["T_VARIABLE","$ids",1327],["T_WHITESPACE"," ",1327],"=",["T_WHITESPACE"," ",1327],["T_VARIABLE","$this",1327],["T_OBJECT_OPERATOR","->",1327],["T_STRING","_allIdsCache",1327],";",["T_WHITESPACE","\n        ",1327],"}",["T_WHITESPACE","\n\n        ",1328],["T_IF","if",1330],["T_WHITESPACE"," ",1330],"(",["T_STRING","is_null",1330],"(",["T_VARIABLE","$ids",1330],")",")",["T_WHITESPACE"," ",1330],"{",["T_WHITESPACE","\n            ",1330],["T_VARIABLE","$ids",1331],["T_WHITESPACE"," ",1331],"=",["T_WHITESPACE"," ",1331],["T_VARIABLE","$this",1331],["T_OBJECT_OPERATOR","->",1331],["T_STRING","getAllIds",1331],"(",")",";",["T_WHITESPACE","\n            ",1331],["T_VARIABLE","$this",1332],["T_OBJECT_OPERATOR","->",1332],["T_STRING","setAllIdsCache",1332],"(",["T_VARIABLE","$ids",1332],")",";",["T_WHITESPACE","\n        ",1332],"}",["T_WHITESPACE","\n\n        ",1333],["T_RETURN","return",1335],["T_WHITESPACE"," ",1335],["T_VARIABLE","$ids",1335],";",["T_WHITESPACE","\n    ",1335],"}",["T_WHITESPACE","\n\n    ",1336],["T_DOC_COMMENT","\/**\n     * Set all ids\n     *\n     * @param array $value\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1338],["T_WHITESPACE","\n    ",1343],["T_PUBLIC","public",1344],["T_WHITESPACE"," ",1344],["T_FUNCTION","function",1344],["T_WHITESPACE"," ",1344],["T_STRING","setAllIdsCache",1344],"(",["T_VARIABLE","$value",1344],")",["T_WHITESPACE","\n    ",1344],"{",["T_WHITESPACE","\n        ",1345],["T_VARIABLE","$this",1346],["T_OBJECT_OPERATOR","->",1346],["T_STRING","_allIdsCache",1346],["T_WHITESPACE"," ",1346],"=",["T_WHITESPACE"," ",1346],["T_VARIABLE","$value",1346],";",["T_WHITESPACE","\n        ",1346],["T_RETURN","return",1347],["T_WHITESPACE"," ",1347],["T_VARIABLE","$this",1347],";",["T_WHITESPACE","\n    ",1347],"}",["T_WHITESPACE","\n\n    ",1348],["T_DOC_COMMENT","\/**\n     * Add Price Data to result\n     *\n     * @param int $customerGroupId\n     * @param int $websiteId\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1350],["T_WHITESPACE","\n    ",1356],["T_PUBLIC","public",1357],["T_WHITESPACE"," ",1357],["T_FUNCTION","function",1357],["T_WHITESPACE"," ",1357],["T_STRING","addPriceData",1357],"(",["T_VARIABLE","$customerGroupId",1357],["T_WHITESPACE"," ",1357],"=",["T_WHITESPACE"," ",1357],["T_STRING","null",1357],",",["T_WHITESPACE"," ",1357],["T_VARIABLE","$websiteId",1357],["T_WHITESPACE"," ",1357],"=",["T_WHITESPACE"," ",1357],["T_STRING","null",1357],")",["T_WHITESPACE","\n    ",1357],"{",["T_WHITESPACE","\n        ",1358],["T_VARIABLE","$this",1359],["T_OBJECT_OPERATOR","->",1359],["T_STRING","_productLimitationFilters",1359],"[",["T_CONSTANT_ENCAPSED_STRING","'use_price_index'",1359],"]",["T_WHITESPACE"," ",1359],"=",["T_WHITESPACE"," ",1359],["T_STRING","true",1359],";",["T_WHITESPACE","\n\n        ",1359],["T_IF","if",1361],["T_WHITESPACE"," ",1361],"(","!",["T_ISSET","isset",1361],"(",["T_VARIABLE","$this",1361],["T_OBJECT_OPERATOR","->",1361],["T_STRING","_productLimitationFilters",1361],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",1361],"]",")",["T_WHITESPACE"," ",1361],["T_BOOLEAN_AND","&&",1361],["T_WHITESPACE"," ",1361],["T_STRING","is_null",1361],"(",["T_VARIABLE","$customerGroupId",1361],")",")",["T_WHITESPACE"," ",1361],"{",["T_WHITESPACE","\n            ",1361],["T_VARIABLE","$customerGroupId",1362],["T_WHITESPACE"," ",1362],"=",["T_WHITESPACE"," ",1362],["T_STRING","Mage",1362],["T_DOUBLE_COLON","::",1362],["T_STRING","getSingleton",1362],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",1362],")",["T_OBJECT_OPERATOR","->",1362],["T_STRING","getCustomerGroupId",1362],"(",")",";",["T_WHITESPACE","\n        ",1362],"}",["T_WHITESPACE","\n        ",1363],["T_IF","if",1364],["T_WHITESPACE"," ",1364],"(","!",["T_ISSET","isset",1364],"(",["T_VARIABLE","$this",1364],["T_OBJECT_OPERATOR","->",1364],["T_STRING","_productLimitationFilters",1364],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",1364],"]",")",["T_WHITESPACE"," ",1364],["T_BOOLEAN_AND","&&",1364],["T_WHITESPACE"," ",1364],["T_STRING","is_null",1364],"(",["T_VARIABLE","$websiteId",1364],")",")",["T_WHITESPACE"," ",1364],"{",["T_WHITESPACE","\n            ",1364],["T_VARIABLE","$websiteId",1365],["T_WHITESPACE","       ",1365],"=",["T_WHITESPACE"," ",1365],["T_STRING","Mage",1365],["T_DOUBLE_COLON","::",1365],["T_STRING","app",1365],"(",")",["T_OBJECT_OPERATOR","->",1365],["T_STRING","getStore",1365],"(",["T_VARIABLE","$this",1365],["T_OBJECT_OPERATOR","->",1365],["T_STRING","getStoreId",1365],"(",")",")",["T_OBJECT_OPERATOR","->",1365],["T_STRING","getWebsiteId",1365],"(",")",";",["T_WHITESPACE","\n        ",1365],"}",["T_WHITESPACE","\n\n        ",1366],["T_IF","if",1368],["T_WHITESPACE"," ",1368],"(","!",["T_STRING","is_null",1368],"(",["T_VARIABLE","$customerGroupId",1368],")",")",["T_WHITESPACE"," ",1368],"{",["T_WHITESPACE","\n            ",1368],["T_VARIABLE","$this",1369],["T_OBJECT_OPERATOR","->",1369],["T_STRING","_productLimitationFilters",1369],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",1369],"]",["T_WHITESPACE"," ",1369],"=",["T_WHITESPACE"," ",1369],["T_VARIABLE","$customerGroupId",1369],";",["T_WHITESPACE","\n        ",1369],"}",["T_WHITESPACE","\n        ",1370],["T_IF","if",1371],["T_WHITESPACE"," ",1371],"(","!",["T_STRING","is_null",1371],"(",["T_VARIABLE","$websiteId",1371],")",")",["T_WHITESPACE"," ",1371],"{",["T_WHITESPACE","\n            ",1371],["T_VARIABLE","$this",1372],["T_OBJECT_OPERATOR","->",1372],["T_STRING","_productLimitationFilters",1372],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",1372],"]",["T_WHITESPACE"," ",1372],"=",["T_WHITESPACE"," ",1372],["T_VARIABLE","$websiteId",1372],";",["T_WHITESPACE","\n        ",1372],"}",["T_WHITESPACE","\n\n        ",1373],["T_VARIABLE","$this",1375],["T_OBJECT_OPERATOR","->",1375],["T_STRING","_applyProductLimitations",1375],"(",")",";",["T_WHITESPACE","\n\n        ",1375],["T_RETURN","return",1377],["T_WHITESPACE"," ",1377],["T_VARIABLE","$this",1377],";",["T_WHITESPACE","\n    ",1377],"}",["T_WHITESPACE","\n\n    ",1378],["T_DOC_COMMENT","\/**\n     * Add attribute to filter\n     *\n     * @param Mage_Eav_Model_Entity_Attribute_Abstract|string $attribute\n     * @param array $condition\n     * @param string $joinType\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1380],["T_WHITESPACE","\n    ",1387],["T_PUBLIC","public",1388],["T_WHITESPACE"," ",1388],["T_FUNCTION","function",1388],["T_WHITESPACE"," ",1388],["T_STRING","addAttributeToFilter",1388],"(",["T_VARIABLE","$attribute",1388],",",["T_WHITESPACE"," ",1388],["T_VARIABLE","$condition",1388],["T_WHITESPACE"," ",1388],"=",["T_WHITESPACE"," ",1388],["T_STRING","null",1388],",",["T_WHITESPACE"," ",1388],["T_VARIABLE","$joinType",1388],["T_WHITESPACE"," ",1388],"=",["T_WHITESPACE"," ",1388],["T_CONSTANT_ENCAPSED_STRING","'inner'",1388],")",["T_WHITESPACE","\n    ",1388],"{",["T_WHITESPACE","\n        ",1389],["T_IF","if",1390],["T_WHITESPACE"," ",1390],"(",["T_VARIABLE","$this",1390],["T_OBJECT_OPERATOR","->",1390],["T_STRING","isEnabledFlat",1390],"(",")",")",["T_WHITESPACE"," ",1390],"{",["T_WHITESPACE","\n            ",1390],["T_IF","if",1391],["T_WHITESPACE"," ",1391],"(",["T_VARIABLE","$attribute",1391],["T_WHITESPACE"," ",1391],["T_INSTANCEOF","instanceof",1391],["T_WHITESPACE"," ",1391],["T_STRING","Mage_Eav_Model_Entity_Attribute_Abstract",1391],")",["T_WHITESPACE"," ",1391],"{",["T_WHITESPACE","\n                ",1391],["T_VARIABLE","$attribute",1392],["T_WHITESPACE"," ",1392],"=",["T_WHITESPACE"," ",1392],["T_VARIABLE","$attribute",1392],["T_OBJECT_OPERATOR","->",1392],["T_STRING","getAttributeCode",1392],"(",")",";",["T_WHITESPACE","\n            ",1392],"}",["T_WHITESPACE","\n\n            ",1393],["T_IF","if",1395],["T_WHITESPACE"," ",1395],"(",["T_STRING","is_array",1395],"(",["T_VARIABLE","$attribute",1395],")",")",["T_WHITESPACE"," ",1395],"{",["T_WHITESPACE","\n                ",1395],["T_VARIABLE","$sqlArr",1396],["T_WHITESPACE"," ",1396],"=",["T_WHITESPACE"," ",1396],["T_ARRAY","array",1396],"(",")",";",["T_WHITESPACE","\n                ",1396],["T_FOREACH","foreach",1397],["T_WHITESPACE"," ",1397],"(",["T_VARIABLE","$attribute",1397],["T_WHITESPACE"," ",1397],["T_AS","as",1397],["T_WHITESPACE"," ",1397],["T_VARIABLE","$condition",1397],")",["T_WHITESPACE"," ",1397],"{",["T_WHITESPACE","\n                    ",1397],["T_VARIABLE","$sqlArr",1398],"[","]",["T_WHITESPACE"," ",1398],"=",["T_WHITESPACE"," ",1398],["T_VARIABLE","$this",1398],["T_OBJECT_OPERATOR","->",1398],["T_STRING","_getAttributeConditionSql",1398],"(",["T_VARIABLE","$condition",1398],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute'",1398],"]",",",["T_WHITESPACE"," ",1398],["T_VARIABLE","$condition",1398],",",["T_WHITESPACE"," ",1398],["T_VARIABLE","$joinType",1398],")",";",["T_WHITESPACE","\n                ",1398],"}",["T_WHITESPACE","\n                ",1399],["T_VARIABLE","$conditionSql",1400],["T_WHITESPACE"," ",1400],"=",["T_WHITESPACE"," ",1400],["T_CONSTANT_ENCAPSED_STRING","'('",1400],".",["T_STRING","join",1400],"(",["T_CONSTANT_ENCAPSED_STRING","') OR ('",1400],",",["T_WHITESPACE"," ",1400],["T_VARIABLE","$sqlArr",1400],")",".",["T_CONSTANT_ENCAPSED_STRING","')'",1400],";",["T_WHITESPACE","\n                ",1400],["T_VARIABLE","$this",1401],["T_OBJECT_OPERATOR","->",1401],["T_STRING","getSelect",1401],"(",")",["T_OBJECT_OPERATOR","->",1401],["T_STRING","where",1401],"(",["T_VARIABLE","$conditionSql",1401],")",";",["T_WHITESPACE","\n                ",1401],["T_RETURN","return",1402],["T_WHITESPACE"," ",1402],["T_VARIABLE","$this",1402],";",["T_WHITESPACE","\n            ",1402],"}",["T_WHITESPACE","\n\n            ",1403],["T_IF","if",1405],["T_WHITESPACE"," ",1405],"(","!",["T_ISSET","isset",1405],"(",["T_VARIABLE","$this",1405],["T_OBJECT_OPERATOR","->",1405],["T_STRING","_selectAttributes",1405],"[",["T_VARIABLE","$attribute",1405],"]",")",")",["T_WHITESPACE"," ",1405],"{",["T_WHITESPACE","\n                ",1405],["T_VARIABLE","$this",1406],["T_OBJECT_OPERATOR","->",1406],["T_STRING","addAttributeToSelect",1406],"(",["T_VARIABLE","$attribute",1406],")",";",["T_WHITESPACE","\n            ",1406],"}",["T_WHITESPACE","\n\n            ",1407],["T_IF","if",1409],["T_WHITESPACE"," ",1409],"(",["T_ISSET","isset",1409],"(",["T_VARIABLE","$this",1409],["T_OBJECT_OPERATOR","->",1409],["T_STRING","_selectAttributes",1409],"[",["T_VARIABLE","$attribute",1409],"]",")",")",["T_WHITESPACE"," ",1409],"{",["T_WHITESPACE","\n                ",1409],["T_VARIABLE","$this",1410],["T_OBJECT_OPERATOR","->",1410],["T_STRING","getSelect",1410],"(",")",["T_OBJECT_OPERATOR","->",1410],["T_STRING","where",1410],"(",["T_VARIABLE","$this",1410],["T_OBJECT_OPERATOR","->",1410],["T_STRING","_getConditionSql",1410],"(",["T_CONSTANT_ENCAPSED_STRING","'e.'",1410],["T_WHITESPACE"," ",1410],".",["T_WHITESPACE"," ",1410],["T_VARIABLE","$attribute",1410],",",["T_WHITESPACE"," ",1410],["T_VARIABLE","$condition",1410],")",")",";",["T_WHITESPACE","\n            ",1410],"}",["T_WHITESPACE","\n\n            ",1411],["T_RETURN","return",1413],["T_WHITESPACE"," ",1413],["T_VARIABLE","$this",1413],";",["T_WHITESPACE","\n        ",1413],"}",["T_WHITESPACE","\n\n        ",1414],["T_VARIABLE","$this",1416],["T_OBJECT_OPERATOR","->",1416],["T_STRING","_allIdsCache",1416],["T_WHITESPACE"," ",1416],"=",["T_WHITESPACE"," ",1416],["T_STRING","null",1416],";",["T_WHITESPACE","\n\n        ",1416],["T_IF","if",1418],["T_WHITESPACE"," ",1418],"(",["T_STRING","is_string",1418],"(",["T_VARIABLE","$attribute",1418],")",["T_WHITESPACE"," ",1418],["T_BOOLEAN_AND","&&",1418],["T_WHITESPACE"," ",1418],["T_VARIABLE","$attribute",1418],["T_WHITESPACE"," ",1418],["T_IS_EQUAL","==",1418],["T_WHITESPACE"," ",1418],["T_CONSTANT_ENCAPSED_STRING","'is_saleable'",1418],")",["T_WHITESPACE"," ",1418],"{",["T_WHITESPACE","\n            ",1418],["T_VARIABLE","$columns",1419],["T_WHITESPACE"," ",1419],"=",["T_WHITESPACE"," ",1419],["T_VARIABLE","$this",1419],["T_OBJECT_OPERATOR","->",1419],["T_STRING","getSelect",1419],"(",")",["T_OBJECT_OPERATOR","->",1419],["T_STRING","getPart",1419],"(",["T_STRING","Zend_Db_Select",1419],["T_DOUBLE_COLON","::",1419],["T_STRING","COLUMNS",1419],")",";",["T_WHITESPACE","\n            ",1419],["T_FOREACH","foreach",1420],["T_WHITESPACE"," ",1420],"(",["T_VARIABLE","$columns",1420],["T_WHITESPACE"," ",1420],["T_AS","as",1420],["T_WHITESPACE"," ",1420],["T_VARIABLE","$columnEntry",1420],")",["T_WHITESPACE"," ",1420],"{",["T_WHITESPACE","\n                ",1420],["T_LIST","list",1421],"(",["T_VARIABLE","$correlationName",1421],",",["T_WHITESPACE"," ",1421],["T_VARIABLE","$column",1421],",",["T_WHITESPACE"," ",1421],["T_VARIABLE","$alias",1421],")",["T_WHITESPACE"," ",1421],"=",["T_WHITESPACE"," ",1421],["T_VARIABLE","$columnEntry",1421],";",["T_WHITESPACE","\n                ",1421],["T_IF","if",1422],["T_WHITESPACE"," ",1422],"(",["T_VARIABLE","$alias",1422],["T_WHITESPACE"," ",1422],["T_IS_EQUAL","==",1422],["T_WHITESPACE"," ",1422],["T_CONSTANT_ENCAPSED_STRING","'is_saleable'",1422],")",["T_WHITESPACE"," ",1422],"{",["T_WHITESPACE","\n                    ",1422],["T_IF","if",1423],["T_WHITESPACE"," ",1423],"(",["T_VARIABLE","$column",1423],["T_WHITESPACE"," ",1423],["T_INSTANCEOF","instanceof",1423],["T_WHITESPACE"," ",1423],["T_STRING","Zend_Db_Expr",1423],")",["T_WHITESPACE"," ",1423],"{",["T_WHITESPACE","\n                        ",1423],["T_VARIABLE","$field",1424],["T_WHITESPACE"," ",1424],"=",["T_WHITESPACE"," ",1424],["T_VARIABLE","$column",1424],";",["T_WHITESPACE","\n                    ",1424],"}",["T_WHITESPACE"," ",1425],["T_ELSE","else",1425],["T_WHITESPACE"," ",1425],"{",["T_WHITESPACE","\n                        ",1425],["T_VARIABLE","$adapter",1426],["T_WHITESPACE"," ",1426],"=",["T_WHITESPACE"," ",1426],["T_VARIABLE","$this",1426],["T_OBJECT_OPERATOR","->",1426],["T_STRING","getSelect",1426],"(",")",["T_OBJECT_OPERATOR","->",1426],["T_STRING","getAdapter",1426],"(",")",";",["T_WHITESPACE","\n                        ",1426],["T_IF","if",1427],["T_WHITESPACE"," ",1427],"(",["T_EMPTY","empty",1427],"(",["T_VARIABLE","$correlationName",1427],")",")",["T_WHITESPACE"," ",1427],"{",["T_WHITESPACE","\n                            ",1427],["T_VARIABLE","$field",1428],["T_WHITESPACE"," ",1428],"=",["T_WHITESPACE"," ",1428],["T_VARIABLE","$adapter",1428],["T_OBJECT_OPERATOR","->",1428],["T_STRING","quoteColumnAs",1428],"(",["T_VARIABLE","$column",1428],",",["T_WHITESPACE"," ",1428],["T_VARIABLE","$alias",1428],",",["T_WHITESPACE"," ",1428],["T_STRING","true",1428],")",";",["T_WHITESPACE","\n                        ",1428],"}",["T_WHITESPACE"," ",1429],["T_ELSE","else",1429],["T_WHITESPACE"," ",1429],"{",["T_WHITESPACE","\n                            ",1429],["T_VARIABLE","$field",1430],["T_WHITESPACE"," ",1430],"=",["T_WHITESPACE"," ",1430],["T_VARIABLE","$adapter",1430],["T_OBJECT_OPERATOR","->",1430],["T_STRING","quoteColumnAs",1430],"(",["T_ARRAY","array",1430],"(",["T_VARIABLE","$correlationName",1430],",",["T_WHITESPACE"," ",1430],["T_VARIABLE","$column",1430],")",",",["T_WHITESPACE"," ",1430],["T_VARIABLE","$alias",1430],",",["T_WHITESPACE"," ",1430],["T_STRING","true",1430],")",";",["T_WHITESPACE","\n                        ",1430],"}",["T_WHITESPACE","\n                    ",1431],"}",["T_WHITESPACE","\n                    ",1432],["T_VARIABLE","$this",1433],["T_OBJECT_OPERATOR","->",1433],["T_STRING","getSelect",1433],"(",")",["T_OBJECT_OPERATOR","->",1433],["T_STRING","where",1433],"(","\"",["T_CURLY_OPEN","{",1433],["T_VARIABLE","$field",1433],"}",["T_ENCAPSED_AND_WHITESPACE"," = ?",1433],"\"",",",["T_WHITESPACE"," ",1433],["T_VARIABLE","$condition",1433],")",";",["T_WHITESPACE","\n                    ",1433],["T_BREAK","break",1434],";",["T_WHITESPACE","\n                ",1434],"}",["T_WHITESPACE","\n            ",1435],"}",["T_WHITESPACE","\n\n            ",1436],["T_RETURN","return",1438],["T_WHITESPACE"," ",1438],["T_VARIABLE","$this",1438],";",["T_WHITESPACE","\n        ",1438],"}",["T_WHITESPACE"," ",1439],["T_ELSE","else",1439],["T_WHITESPACE"," ",1439],"{",["T_WHITESPACE","\n            ",1439],["T_RETURN","return",1440],["T_WHITESPACE"," ",1440],["T_STRING","parent",1440],["T_DOUBLE_COLON","::",1440],["T_STRING","addAttributeToFilter",1440],"(",["T_VARIABLE","$attribute",1440],",",["T_WHITESPACE"," ",1440],["T_VARIABLE","$condition",1440],",",["T_WHITESPACE"," ",1440],["T_VARIABLE","$joinType",1440],")",";",["T_WHITESPACE","\n        ",1440],"}",["T_WHITESPACE","\n    ",1441],"}",["T_WHITESPACE","\n\n    ",1442],["T_DOC_COMMENT","\/**\n     * Add requere tax percent flag for product collection\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1444],["T_WHITESPACE","\n    ",1448],["T_PUBLIC","public",1449],["T_WHITESPACE"," ",1449],["T_FUNCTION","function",1449],["T_WHITESPACE"," ",1449],["T_STRING","addTaxPercents",1449],"(",")",["T_WHITESPACE","\n    ",1449],"{",["T_WHITESPACE","\n        ",1450],["T_VARIABLE","$this",1451],["T_OBJECT_OPERATOR","->",1451],["T_STRING","_addTaxPercents",1451],["T_WHITESPACE"," ",1451],"=",["T_WHITESPACE"," ",1451],["T_STRING","true",1451],";",["T_WHITESPACE","\n        ",1451],["T_RETURN","return",1452],["T_WHITESPACE"," ",1452],["T_VARIABLE","$this",1452],";",["T_WHITESPACE","\n    ",1452],"}",["T_WHITESPACE","\n\n    ",1453],["T_DOC_COMMENT","\/**\n     * Get require tax percent flag value\n     *\n     * @return bool\n     *\/",1455],["T_WHITESPACE","\n    ",1459],["T_PUBLIC","public",1460],["T_WHITESPACE"," ",1460],["T_FUNCTION","function",1460],["T_WHITESPACE"," ",1460],["T_STRING","requireTaxPercent",1460],"(",")",["T_WHITESPACE","\n    ",1460],"{",["T_WHITESPACE","\n        ",1461],["T_RETURN","return",1462],["T_WHITESPACE"," ",1462],["T_VARIABLE","$this",1462],["T_OBJECT_OPERATOR","->",1462],["T_STRING","_addTaxPercents",1462],";",["T_WHITESPACE","\n    ",1462],"}",["T_WHITESPACE","\n\n    ",1463],["T_DOC_COMMENT","\/**\n     * Enter description here ...\n     *\n     * @deprecated from 1.3.0\n     *\n     *\/",1465],["T_WHITESPACE","\n    ",1470],["T_PROTECTED","protected",1471],["T_WHITESPACE"," ",1471],["T_FUNCTION","function",1471],["T_WHITESPACE"," ",1471],["T_STRING","_addTaxPercents",1471],"(",")",["T_WHITESPACE","\n    ",1471],"{",["T_WHITESPACE","\n        ",1472],["T_VARIABLE","$classToRate",1473],["T_WHITESPACE"," ",1473],"=",["T_WHITESPACE"," ",1473],["T_ARRAY","array",1473],"(",")",";",["T_WHITESPACE","\n        ",1473],["T_VARIABLE","$request",1474],["T_WHITESPACE"," ",1474],"=",["T_WHITESPACE"," ",1474],["T_STRING","Mage",1474],["T_DOUBLE_COLON","::",1474],["T_STRING","getSingleton",1474],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",1474],")",["T_OBJECT_OPERATOR","->",1474],["T_STRING","getRateRequest",1474],"(",")",";",["T_WHITESPACE","\n        ",1474],["T_FOREACH","foreach",1475],["T_WHITESPACE"," ",1475],"(",["T_VARIABLE","$this",1475],["T_WHITESPACE"," ",1475],["T_AS","as",1475],["T_WHITESPACE"," ",1475],"&",["T_VARIABLE","$item",1475],")",["T_WHITESPACE"," ",1475],"{",["T_WHITESPACE","\n            ",1475],["T_IF","if",1476],["T_WHITESPACE"," ",1476],"(",["T_STRING","null",1476],["T_WHITESPACE"," ",1476],["T_IS_IDENTICAL","===",1476],["T_WHITESPACE"," ",1476],["T_VARIABLE","$item",1476],["T_OBJECT_OPERATOR","->",1476],["T_STRING","getTaxClassId",1476],"(",")",")",["T_WHITESPACE"," ",1476],"{",["T_WHITESPACE","\n                ",1476],["T_VARIABLE","$item",1477],["T_OBJECT_OPERATOR","->",1477],["T_STRING","setTaxClassId",1477],"(",["T_VARIABLE","$item",1477],["T_OBJECT_OPERATOR","->",1477],["T_STRING","getMinimalTaxClassId",1477],"(",")",")",";",["T_WHITESPACE","\n            ",1477],"}",["T_WHITESPACE","\n            ",1478],["T_IF","if",1479],["T_WHITESPACE"," ",1479],"(","!",["T_ISSET","isset",1479],"(",["T_VARIABLE","$classToRate",1479],"[",["T_VARIABLE","$item",1479],["T_OBJECT_OPERATOR","->",1479],["T_STRING","getTaxClassId",1479],"(",")","]",")",")",["T_WHITESPACE"," ",1479],"{",["T_WHITESPACE","\n                ",1479],["T_VARIABLE","$request",1480],["T_OBJECT_OPERATOR","->",1480],["T_STRING","setProductClassId",1480],"(",["T_VARIABLE","$item",1480],["T_OBJECT_OPERATOR","->",1480],["T_STRING","getTaxClassId",1480],"(",")",")",";",["T_WHITESPACE","\n                ",1480],["T_VARIABLE","$classToRate",1481],"[",["T_VARIABLE","$item",1481],["T_OBJECT_OPERATOR","->",1481],["T_STRING","getTaxClassId",1481],"(",")","]",["T_WHITESPACE"," ",1481],"=",["T_WHITESPACE"," ",1481],["T_STRING","Mage",1481],["T_DOUBLE_COLON","::",1481],["T_STRING","getSingleton",1481],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",1481],")",["T_OBJECT_OPERATOR","->",1481],["T_STRING","getRate",1481],"(",["T_VARIABLE","$request",1481],")",";",["T_WHITESPACE","\n            ",1481],"}",["T_WHITESPACE","\n            ",1482],["T_VARIABLE","$item",1483],["T_OBJECT_OPERATOR","->",1483],["T_STRING","setTaxPercent",1483],"(",["T_VARIABLE","$classToRate",1483],"[",["T_VARIABLE","$item",1483],["T_OBJECT_OPERATOR","->",1483],["T_STRING","getTaxClassId",1483],"(",")","]",")",";",["T_WHITESPACE","\n        ",1483],"}",["T_WHITESPACE","\n    ",1484],"}",["T_WHITESPACE","\n\n    ",1485],["T_DOC_COMMENT","\/**\n     * Adding product custom options to result collection\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1487],["T_WHITESPACE","\n    ",1491],["T_PUBLIC","public",1492],["T_WHITESPACE"," ",1492],["T_FUNCTION","function",1492],["T_WHITESPACE"," ",1492],["T_STRING","addOptionsToResult",1492],"(",")",["T_WHITESPACE","\n    ",1492],"{",["T_WHITESPACE","\n        ",1493],["T_VARIABLE","$productIds",1494],["T_WHITESPACE"," ",1494],"=",["T_WHITESPACE"," ",1494],["T_ARRAY","array",1494],"(",")",";",["T_WHITESPACE","\n        ",1494],["T_FOREACH","foreach",1495],["T_WHITESPACE"," ",1495],"(",["T_VARIABLE","$this",1495],["T_WHITESPACE"," ",1495],["T_AS","as",1495],["T_WHITESPACE"," ",1495],["T_VARIABLE","$product",1495],")",["T_WHITESPACE"," ",1495],"{",["T_WHITESPACE","\n            ",1495],["T_VARIABLE","$productIds",1496],"[","]",["T_WHITESPACE"," ",1496],"=",["T_WHITESPACE"," ",1496],["T_VARIABLE","$product",1496],["T_OBJECT_OPERATOR","->",1496],["T_STRING","getId",1496],"(",")",";",["T_WHITESPACE","\n        ",1496],"}",["T_WHITESPACE","\n        ",1497],["T_IF","if",1498],["T_WHITESPACE"," ",1498],"(","!",["T_EMPTY","empty",1498],"(",["T_VARIABLE","$productIds",1498],")",")",["T_WHITESPACE"," ",1498],"{",["T_WHITESPACE","\n            ",1498],["T_VARIABLE","$options",1499],["T_WHITESPACE"," ",1499],"=",["T_WHITESPACE"," ",1499],["T_STRING","Mage",1499],["T_DOUBLE_COLON","::",1499],["T_STRING","getModel",1499],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",1499],")",["T_WHITESPACE","\n                ",1499],["T_OBJECT_OPERATOR","->",1500],["T_STRING","getCollection",1500],"(",")",["T_WHITESPACE","\n                ",1500],["T_OBJECT_OPERATOR","->",1501],["T_STRING","addTitleToResult",1501],"(",["T_STRING","Mage",1501],["T_DOUBLE_COLON","::",1501],["T_STRING","app",1501],"(",")",["T_OBJECT_OPERATOR","->",1501],["T_STRING","getStore",1501],"(",")",["T_OBJECT_OPERATOR","->",1501],["T_STRING","getId",1501],"(",")",")",["T_WHITESPACE","\n                ",1501],["T_OBJECT_OPERATOR","->",1502],["T_STRING","addPriceToResult",1502],"(",["T_STRING","Mage",1502],["T_DOUBLE_COLON","::",1502],["T_STRING","app",1502],"(",")",["T_OBJECT_OPERATOR","->",1502],["T_STRING","getStore",1502],"(",")",["T_OBJECT_OPERATOR","->",1502],["T_STRING","getId",1502],"(",")",")",["T_WHITESPACE","\n                ",1502],["T_OBJECT_OPERATOR","->",1503],["T_STRING","addProductToFilter",1503],"(",["T_VARIABLE","$productIds",1503],")",["T_WHITESPACE","\n                ",1503],["T_OBJECT_OPERATOR","->",1504],["T_STRING","addValuesToResult",1504],"(",")",";",["T_WHITESPACE","\n\n            ",1504],["T_FOREACH","foreach",1506],["T_WHITESPACE"," ",1506],"(",["T_VARIABLE","$options",1506],["T_WHITESPACE"," ",1506],["T_AS","as",1506],["T_WHITESPACE"," ",1506],["T_VARIABLE","$option",1506],")",["T_WHITESPACE"," ",1506],"{",["T_WHITESPACE","\n                ",1506],["T_IF","if",1507],"(",["T_VARIABLE","$this",1507],["T_OBJECT_OPERATOR","->",1507],["T_STRING","getItemById",1507],"(",["T_VARIABLE","$option",1507],["T_OBJECT_OPERATOR","->",1507],["T_STRING","getProductId",1507],"(",")",")",")",["T_WHITESPACE"," ",1507],"{",["T_WHITESPACE","\n                    ",1507],["T_VARIABLE","$this",1508],["T_OBJECT_OPERATOR","->",1508],["T_STRING","getItemById",1508],"(",["T_VARIABLE","$option",1508],["T_OBJECT_OPERATOR","->",1508],["T_STRING","getProductId",1508],"(",")",")",["T_OBJECT_OPERATOR","->",1508],["T_STRING","addOption",1508],"(",["T_VARIABLE","$option",1508],")",";",["T_WHITESPACE","\n                ",1508],"}",["T_WHITESPACE","\n            ",1509],"}",["T_WHITESPACE","\n        ",1510],"}",["T_WHITESPACE","\n\n        ",1511],["T_RETURN","return",1513],["T_WHITESPACE"," ",1513],["T_VARIABLE","$this",1513],";",["T_WHITESPACE","\n    ",1513],"}",["T_WHITESPACE","\n\n    ",1514],["T_DOC_COMMENT","\/**\n     * Filter products with required options\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1516],["T_WHITESPACE","\n    ",1520],["T_PUBLIC","public",1521],["T_WHITESPACE"," ",1521],["T_FUNCTION","function",1521],["T_WHITESPACE"," ",1521],["T_STRING","addFilterByRequiredOptions",1521],"(",")",["T_WHITESPACE","\n    ",1521],"{",["T_WHITESPACE","\n        ",1522],["T_VARIABLE","$this",1523],["T_OBJECT_OPERATOR","->",1523],["T_STRING","addAttributeToFilter",1523],"(",["T_CONSTANT_ENCAPSED_STRING","'required_options'",1523],",",["T_WHITESPACE"," ",1523],["T_ARRAY","array",1523],"(",["T_ARRAY","array",1523],"(",["T_CONSTANT_ENCAPSED_STRING","'neq'",1523],["T_WHITESPACE"," ",1523],["T_DOUBLE_ARROW","=>",1523],["T_WHITESPACE"," ",1523],["T_CONSTANT_ENCAPSED_STRING","'1'",1523],")",",",["T_WHITESPACE"," ",1523],["T_ARRAY","array",1523],"(",["T_CONSTANT_ENCAPSED_STRING","'null'",1523],["T_WHITESPACE"," ",1523],["T_DOUBLE_ARROW","=>",1523],["T_WHITESPACE"," ",1523],["T_STRING","true",1523],")",")",",",["T_WHITESPACE"," ",1523],["T_CONSTANT_ENCAPSED_STRING","'left'",1523],")",";",["T_WHITESPACE","\n        ",1523],["T_RETURN","return",1524],["T_WHITESPACE"," ",1524],["T_VARIABLE","$this",1524],";",["T_WHITESPACE","\n    ",1524],"}",["T_WHITESPACE","\n\n    ",1525],["T_DOC_COMMENT","\/**\n     * Set product visibility filter for enabled products\n     *\n     * @param array $visibility\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1527],["T_WHITESPACE","\n    ",1532],["T_PUBLIC","public",1533],["T_WHITESPACE"," ",1533],["T_FUNCTION","function",1533],["T_WHITESPACE"," ",1533],["T_STRING","setVisibility",1533],"(",["T_VARIABLE","$visibility",1533],")",["T_WHITESPACE","\n    ",1533],"{",["T_WHITESPACE","\n        ",1534],["T_VARIABLE","$this",1535],["T_OBJECT_OPERATOR","->",1535],["T_STRING","_productLimitationFilters",1535],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1535],"]",["T_WHITESPACE"," ",1535],"=",["T_WHITESPACE"," ",1535],["T_VARIABLE","$visibility",1535],";",["T_WHITESPACE","\n        ",1535],["T_VARIABLE","$this",1536],["T_OBJECT_OPERATOR","->",1536],["T_STRING","_applyProductLimitations",1536],"(",")",";",["T_WHITESPACE","\n\n        ",1536],["T_RETURN","return",1538],["T_WHITESPACE"," ",1538],["T_VARIABLE","$this",1538],";",["T_WHITESPACE","\n    ",1538],"}",["T_WHITESPACE","\n\n    ",1539],["T_DOC_COMMENT","\/**\n     * Add attribute to sort order\n     *\n     * @param string $attribute\n     * @param string $dir\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1541],["T_WHITESPACE","\n    ",1547],["T_PUBLIC","public",1548],["T_WHITESPACE"," ",1548],["T_FUNCTION","function",1548],["T_WHITESPACE"," ",1548],["T_STRING","addAttributeToSort",1548],"(",["T_VARIABLE","$attribute",1548],",",["T_WHITESPACE"," ",1548],["T_VARIABLE","$dir",1548],["T_WHITESPACE"," ",1548],"=",["T_WHITESPACE"," ",1548],["T_STRING","self",1548],["T_DOUBLE_COLON","::",1548],["T_STRING","SORT_ORDER_ASC",1548],")",["T_WHITESPACE","\n    ",1548],"{",["T_WHITESPACE","\n        ",1549],["T_IF","if",1550],["T_WHITESPACE"," ",1550],"(",["T_VARIABLE","$attribute",1550],["T_WHITESPACE"," ",1550],["T_IS_EQUAL","==",1550],["T_WHITESPACE"," ",1550],["T_CONSTANT_ENCAPSED_STRING","'position'",1550],")",["T_WHITESPACE"," ",1550],"{",["T_WHITESPACE","\n            ",1550],["T_IF","if",1551],["T_WHITESPACE"," ",1551],"(",["T_ISSET","isset",1551],"(",["T_VARIABLE","$this",1551],["T_OBJECT_OPERATOR","->",1551],["T_STRING","_joinFields",1551],"[",["T_VARIABLE","$attribute",1551],"]",")",")",["T_WHITESPACE"," ",1551],"{",["T_WHITESPACE","\n                ",1551],["T_VARIABLE","$this",1552],["T_OBJECT_OPERATOR","->",1552],["T_STRING","getSelect",1552],"(",")",["T_OBJECT_OPERATOR","->",1552],["T_STRING","order",1552],"(",["T_VARIABLE","$this",1552],["T_OBJECT_OPERATOR","->",1552],["T_STRING","_getAttributeFieldName",1552],"(",["T_VARIABLE","$attribute",1552],")",["T_WHITESPACE"," ",1552],".",["T_WHITESPACE"," ",1552],["T_CONSTANT_ENCAPSED_STRING","' '",1552],["T_WHITESPACE"," ",1552],".",["T_WHITESPACE"," ",1552],["T_VARIABLE","$dir",1552],")",";",["T_WHITESPACE","\n                ",1552],["T_RETURN","return",1553],["T_WHITESPACE"," ",1553],["T_VARIABLE","$this",1553],";",["T_WHITESPACE","\n            ",1553],"}",["T_WHITESPACE","\n            ",1554],["T_IF","if",1555],["T_WHITESPACE"," ",1555],"(",["T_VARIABLE","$this",1555],["T_OBJECT_OPERATOR","->",1555],["T_STRING","isEnabledFlat",1555],"(",")",")",["T_WHITESPACE"," ",1555],"{",["T_WHITESPACE","\n                ",1555],["T_VARIABLE","$this",1556],["T_OBJECT_OPERATOR","->",1556],["T_STRING","getSelect",1556],"(",")",["T_OBJECT_OPERATOR","->",1556],["T_STRING","order",1556],"(","\"",["T_ENCAPSED_AND_WHITESPACE","cat_index_position ",1556],["T_CURLY_OPEN","{",1556],["T_VARIABLE","$dir",1556],"}","\"",")",";",["T_WHITESPACE","\n            ",1556],"}",["T_WHITESPACE","\n            ",1557],["T_COMMENT","\/\/ optimize if using cat index\n",1558],["T_WHITESPACE","            ",1559],["T_VARIABLE","$filters",1559],["T_WHITESPACE"," ",1559],"=",["T_WHITESPACE"," ",1559],["T_VARIABLE","$this",1559],["T_OBJECT_OPERATOR","->",1559],["T_STRING","_productLimitationFilters",1559],";",["T_WHITESPACE","\n            ",1559],["T_IF","if",1560],["T_WHITESPACE"," ",1560],"(",["T_ISSET","isset",1560],"(",["T_VARIABLE","$filters",1560],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1560],"]",")",["T_WHITESPACE"," ",1560],["T_BOOLEAN_OR","||",1560],["T_WHITESPACE"," ",1560],["T_ISSET","isset",1560],"(",["T_VARIABLE","$filters",1560],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1560],"]",")",")",["T_WHITESPACE"," ",1560],"{",["T_WHITESPACE","\n                ",1560],["T_VARIABLE","$this",1561],["T_OBJECT_OPERATOR","->",1561],["T_STRING","getSelect",1561],"(",")",["T_OBJECT_OPERATOR","->",1561],["T_STRING","order",1561],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index.position '",1561],["T_WHITESPACE"," ",1561],".",["T_WHITESPACE"," ",1561],["T_VARIABLE","$dir",1561],")",";",["T_WHITESPACE","\n            ",1561],"}",["T_WHITESPACE"," ",1562],["T_ELSE","else",1562],["T_WHITESPACE"," ",1562],"{",["T_WHITESPACE","\n                ",1562],["T_VARIABLE","$this",1563],["T_OBJECT_OPERATOR","->",1563],["T_STRING","getSelect",1563],"(",")",["T_OBJECT_OPERATOR","->",1563],["T_STRING","order",1563],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id '",1563],["T_WHITESPACE"," ",1563],".",["T_WHITESPACE"," ",1563],["T_VARIABLE","$dir",1563],")",";",["T_WHITESPACE","\n            ",1563],"}",["T_WHITESPACE","\n\n            ",1564],["T_RETURN","return",1566],["T_WHITESPACE"," ",1566],["T_VARIABLE","$this",1566],";",["T_WHITESPACE","\n        ",1566],"}",["T_WHITESPACE"," ",1567],["T_ELSEIF","elseif",1567],"(",["T_VARIABLE","$attribute",1567],["T_WHITESPACE"," ",1567],["T_IS_EQUAL","==",1567],["T_WHITESPACE"," ",1567],["T_CONSTANT_ENCAPSED_STRING","'is_saleable'",1567],")","{",["T_WHITESPACE","\n            ",1567],["T_VARIABLE","$this",1568],["T_OBJECT_OPERATOR","->",1568],["T_STRING","getSelect",1568],"(",")",["T_OBJECT_OPERATOR","->",1568],["T_STRING","order",1568],"(",["T_CONSTANT_ENCAPSED_STRING","\"is_saleable \"",1568],["T_WHITESPACE"," ",1568],".",["T_WHITESPACE"," ",1568],["T_VARIABLE","$dir",1568],")",";",["T_WHITESPACE","\n            ",1568],["T_RETURN","return",1569],["T_WHITESPACE"," ",1569],["T_VARIABLE","$this",1569],";",["T_WHITESPACE","\n        ",1569],"}",["T_WHITESPACE","\n\n        ",1570],["T_VARIABLE","$storeId",1572],["T_WHITESPACE"," ",1572],"=",["T_WHITESPACE"," ",1572],["T_VARIABLE","$this",1572],["T_OBJECT_OPERATOR","->",1572],["T_STRING","getStoreId",1572],"(",")",";",["T_WHITESPACE","\n        ",1572],["T_IF","if",1573],["T_WHITESPACE"," ",1573],"(",["T_VARIABLE","$attribute",1573],["T_WHITESPACE"," ",1573],["T_IS_EQUAL","==",1573],["T_WHITESPACE"," ",1573],["T_CONSTANT_ENCAPSED_STRING","'price'",1573],["T_WHITESPACE"," ",1573],["T_BOOLEAN_AND","&&",1573],["T_WHITESPACE"," ",1573],["T_VARIABLE","$storeId",1573],["T_WHITESPACE"," ",1573],["T_IS_NOT_EQUAL","!=",1573],["T_WHITESPACE"," ",1573],["T_LNUMBER","0",1573],")",["T_WHITESPACE"," ",1573],"{",["T_WHITESPACE","\n            ",1573],["T_VARIABLE","$this",1574],["T_OBJECT_OPERATOR","->",1574],["T_STRING","addPriceData",1574],"(",")",";",["T_WHITESPACE","\n            ",1574],["T_VARIABLE","$this",1575],["T_OBJECT_OPERATOR","->",1575],["T_STRING","getSelect",1575],"(",")",["T_OBJECT_OPERATOR","->",1575],["T_STRING","order",1575],"(","\"",["T_ENCAPSED_AND_WHITESPACE","price_index.min_price ",1575],["T_CURLY_OPEN","{",1575],["T_VARIABLE","$dir",1575],"}","\"",")",";",["T_WHITESPACE","\n\n            ",1575],["T_RETURN","return",1577],["T_WHITESPACE"," ",1577],["T_VARIABLE","$this",1577],";",["T_WHITESPACE","\n        ",1577],"}",["T_WHITESPACE","\n\n        ",1578],["T_IF","if",1580],["T_WHITESPACE"," ",1580],"(",["T_VARIABLE","$this",1580],["T_OBJECT_OPERATOR","->",1580],["T_STRING","isEnabledFlat",1580],"(",")",")",["T_WHITESPACE"," ",1580],"{",["T_WHITESPACE","\n            ",1580],["T_VARIABLE","$column",1581],["T_WHITESPACE"," ",1581],"=",["T_WHITESPACE"," ",1581],["T_VARIABLE","$this",1581],["T_OBJECT_OPERATOR","->",1581],["T_STRING","getEntity",1581],"(",")",["T_OBJECT_OPERATOR","->",1581],["T_STRING","getAttributeSortColumn",1581],"(",["T_VARIABLE","$attribute",1581],")",";",["T_WHITESPACE","\n\n            ",1581],["T_IF","if",1583],["T_WHITESPACE"," ",1583],"(",["T_VARIABLE","$column",1583],")",["T_WHITESPACE"," ",1583],"{",["T_WHITESPACE","\n                ",1583],["T_VARIABLE","$this",1584],["T_OBJECT_OPERATOR","->",1584],["T_STRING","getSelect",1584],"(",")",["T_OBJECT_OPERATOR","->",1584],["T_STRING","order",1584],"(","\"",["T_ENCAPSED_AND_WHITESPACE","e.",1584],["T_CURLY_OPEN","{",1584],["T_VARIABLE","$column",1584],"}",["T_ENCAPSED_AND_WHITESPACE"," ",1584],["T_CURLY_OPEN","{",1584],["T_VARIABLE","$dir",1584],"}","\"",")",";",["T_WHITESPACE","\n            ",1584],"}",["T_WHITESPACE","\n            ",1585],["T_ELSE","else",1586],["T_WHITESPACE"," ",1586],["T_IF","if",1586],["T_WHITESPACE"," ",1586],"(",["T_ISSET","isset",1586],"(",["T_VARIABLE","$this",1586],["T_OBJECT_OPERATOR","->",1586],["T_STRING","_joinFields",1586],"[",["T_VARIABLE","$attribute",1586],"]",")",")",["T_WHITESPACE"," ",1586],"{",["T_WHITESPACE","\n                ",1586],["T_VARIABLE","$this",1587],["T_OBJECT_OPERATOR","->",1587],["T_STRING","getSelect",1587],"(",")",["T_OBJECT_OPERATOR","->",1587],["T_STRING","order",1587],"(",["T_VARIABLE","$this",1587],["T_OBJECT_OPERATOR","->",1587],["T_STRING","_getAttributeFieldName",1587],"(",["T_VARIABLE","$attribute",1587],")",["T_WHITESPACE"," ",1587],".",["T_WHITESPACE"," ",1587],["T_CONSTANT_ENCAPSED_STRING","' '",1587],["T_WHITESPACE"," ",1587],".",["T_WHITESPACE"," ",1587],["T_VARIABLE","$dir",1587],")",";",["T_WHITESPACE","\n            ",1587],"}",["T_WHITESPACE","\n\n            ",1588],["T_RETURN","return",1590],["T_WHITESPACE"," ",1590],["T_VARIABLE","$this",1590],";",["T_WHITESPACE","\n        ",1590],"}",["T_WHITESPACE"," ",1591],["T_ELSE","else",1591],["T_WHITESPACE"," ",1591],"{",["T_WHITESPACE","\n            ",1591],["T_VARIABLE","$attrInstance",1592],["T_WHITESPACE"," ",1592],"=",["T_WHITESPACE"," ",1592],["T_VARIABLE","$this",1592],["T_OBJECT_OPERATOR","->",1592],["T_STRING","getEntity",1592],"(",")",["T_OBJECT_OPERATOR","->",1592],["T_STRING","getAttribute",1592],"(",["T_VARIABLE","$attribute",1592],")",";",["T_WHITESPACE","\n            ",1592],["T_IF","if",1593],["T_WHITESPACE"," ",1593],"(",["T_VARIABLE","$attrInstance",1593],["T_WHITESPACE"," ",1593],["T_BOOLEAN_AND","&&",1593],["T_WHITESPACE"," ",1593],["T_VARIABLE","$attrInstance",1593],["T_OBJECT_OPERATOR","->",1593],["T_STRING","usesSource",1593],"(",")",")",["T_WHITESPACE"," ",1593],"{",["T_WHITESPACE","\n                ",1593],["T_VARIABLE","$attrInstance",1594],["T_OBJECT_OPERATOR","->",1594],["T_STRING","getSource",1594],"(",")",["T_WHITESPACE","\n                    ",1594],["T_OBJECT_OPERATOR","->",1595],["T_STRING","addValueSortToCollection",1595],"(",["T_VARIABLE","$this",1595],",",["T_WHITESPACE"," ",1595],["T_VARIABLE","$dir",1595],")",";",["T_WHITESPACE","\n                ",1595],["T_RETURN","return",1596],["T_WHITESPACE"," ",1596],["T_VARIABLE","$this",1596],";",["T_WHITESPACE","\n            ",1596],"}",["T_WHITESPACE","\n        ",1597],"}",["T_WHITESPACE","\n\n        ",1598],["T_RETURN","return",1600],["T_WHITESPACE"," ",1600],["T_STRING","parent",1600],["T_DOUBLE_COLON","::",1600],["T_STRING","addAttributeToSort",1600],"(",["T_VARIABLE","$attribute",1600],",",["T_WHITESPACE"," ",1600],["T_VARIABLE","$dir",1600],")",";",["T_WHITESPACE","\n    ",1600],"}",["T_WHITESPACE","\n\n    ",1601],["T_DOC_COMMENT","\/**\n     * Prepare limitation filters\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1603],["T_WHITESPACE","\n    ",1607],["T_PROTECTED","protected",1608],["T_WHITESPACE"," ",1608],["T_FUNCTION","function",1608],["T_WHITESPACE"," ",1608],["T_STRING","_prepareProductLimitationFilters",1608],"(",")",["T_WHITESPACE","\n    ",1608],"{",["T_WHITESPACE","\n        ",1609],["T_IF","if",1610],["T_WHITESPACE"," ",1610],"(",["T_ISSET","isset",1610],"(",["T_VARIABLE","$this",1610],["T_OBJECT_OPERATOR","->",1610],["T_STRING","_productLimitationFilters",1610],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1610],"]",")",["T_WHITESPACE","\n            ",1610],["T_BOOLEAN_AND","&&",1611],["T_WHITESPACE"," ",1611],"!",["T_ISSET","isset",1611],"(",["T_VARIABLE","$this",1611],["T_OBJECT_OPERATOR","->",1611],["T_STRING","_productLimitationFilters",1611],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1611],"]",")",["T_WHITESPACE","\n        ",1611],")",["T_WHITESPACE"," ",1612],"{",["T_WHITESPACE","\n            ",1612],["T_VARIABLE","$this",1613],["T_OBJECT_OPERATOR","->",1613],["T_STRING","_productLimitationFilters",1613],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1613],"]",["T_WHITESPACE"," ",1613],"=",["T_WHITESPACE"," ",1613],["T_VARIABLE","$this",1613],["T_OBJECT_OPERATOR","->",1613],["T_STRING","getStoreId",1613],"(",")",";",["T_WHITESPACE","\n        ",1613],"}",["T_WHITESPACE","\n        ",1614],["T_IF","if",1615],["T_WHITESPACE"," ",1615],"(",["T_ISSET","isset",1615],"(",["T_VARIABLE","$this",1615],["T_OBJECT_OPERATOR","->",1615],["T_STRING","_productLimitationFilters",1615],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1615],"]",")",["T_WHITESPACE","\n            ",1615],["T_BOOLEAN_AND","&&",1616],["T_WHITESPACE"," ",1616],"!",["T_ISSET","isset",1616],"(",["T_VARIABLE","$this",1616],["T_OBJECT_OPERATOR","->",1616],["T_STRING","_productLimitationFilters",1616],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1616],"]",")",["T_WHITESPACE","\n        ",1616],")",["T_WHITESPACE"," ",1617],"{",["T_WHITESPACE","\n            ",1617],["T_VARIABLE","$this",1618],["T_OBJECT_OPERATOR","->",1618],["T_STRING","_productLimitationFilters",1618],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1618],"]",["T_WHITESPACE"," ",1618],"=",["T_WHITESPACE"," ",1618],["T_VARIABLE","$this",1618],["T_OBJECT_OPERATOR","->",1618],["T_STRING","getStoreId",1618],"(",")",";",["T_WHITESPACE","\n        ",1618],"}",["T_WHITESPACE","\n        ",1619],["T_IF","if",1620],["T_WHITESPACE"," ",1620],"(",["T_ISSET","isset",1620],"(",["T_VARIABLE","$this",1620],["T_OBJECT_OPERATOR","->",1620],["T_STRING","_productLimitationFilters",1620],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1620],"]",")",["T_WHITESPACE","\n            ",1620],["T_BOOLEAN_AND","&&",1621],["T_WHITESPACE"," ",1621],["T_ISSET","isset",1621],"(",["T_VARIABLE","$this",1621],["T_OBJECT_OPERATOR","->",1621],["T_STRING","_productLimitationFilters",1621],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1621],"]",")",["T_WHITESPACE","\n            ",1621],["T_BOOLEAN_AND","&&",1622],["T_WHITESPACE"," ",1622],"!",["T_ISSET","isset",1622],"(",["T_VARIABLE","$this",1622],["T_OBJECT_OPERATOR","->",1622],["T_STRING","_productLimitationFilters",1622],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1622],"]",")",["T_WHITESPACE","\n        ",1622],")",["T_WHITESPACE"," ",1623],"{",["T_WHITESPACE","\n            ",1623],["T_VARIABLE","$this",1624],["T_OBJECT_OPERATOR","->",1624],["T_STRING","_productLimitationFilters",1624],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1624],"]",["T_WHITESPACE"," ",1624],"=",["T_WHITESPACE"," ",1624],["T_STRING","Mage",1624],["T_DOUBLE_COLON","::",1624],["T_STRING","app",1624],"(",")",["T_WHITESPACE","\n                ",1624],["T_OBJECT_OPERATOR","->",1625],["T_STRING","getStore",1625],"(",["T_VARIABLE","$this",1625],["T_OBJECT_OPERATOR","->",1625],["T_STRING","_productLimitationFilters",1625],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1625],"]",")",["T_WHITESPACE","\n                ",1625],["T_OBJECT_OPERATOR","->",1626],["T_STRING","getRootCategoryId",1626],"(",")",";",["T_WHITESPACE","\n        ",1626],"}",["T_WHITESPACE","\n\n        ",1627],["T_RETURN","return",1629],["T_WHITESPACE"," ",1629],["T_VARIABLE","$this",1629],";",["T_WHITESPACE","\n    ",1629],"}",["T_WHITESPACE","\n\n    ",1630],["T_DOC_COMMENT","\/**\n     * Join website product limitation\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1632],["T_WHITESPACE","\n    ",1636],["T_PROTECTED","protected",1637],["T_WHITESPACE"," ",1637],["T_FUNCTION","function",1637],["T_WHITESPACE"," ",1637],["T_STRING","_productLimitationJoinWebsite",1637],"(",")",["T_WHITESPACE","\n    ",1637],"{",["T_WHITESPACE","\n        ",1638],["T_VARIABLE","$joinWebsite",1639],["T_WHITESPACE"," ",1639],"=",["T_WHITESPACE"," ",1639],["T_STRING","false",1639],";",["T_WHITESPACE","\n        ",1639],["T_VARIABLE","$filters",1640],["T_WHITESPACE","     ",1640],"=",["T_WHITESPACE"," ",1640],["T_VARIABLE","$this",1640],["T_OBJECT_OPERATOR","->",1640],["T_STRING","_productLimitationFilters",1640],";",["T_WHITESPACE","\n        ",1640],["T_VARIABLE","$conditions",1641],["T_WHITESPACE","  ",1641],"=",["T_WHITESPACE"," ",1641],["T_ARRAY","array",1641],"(",["T_CONSTANT_ENCAPSED_STRING","'product_website.product_id = e.entity_id'",1641],")",";",["T_WHITESPACE","\n\n        ",1641],["T_IF","if",1643],["T_WHITESPACE"," ",1643],"(",["T_ISSET","isset",1643],"(",["T_VARIABLE","$filters",1643],"[",["T_CONSTANT_ENCAPSED_STRING","'website_ids'",1643],"]",")",")",["T_WHITESPACE"," ",1643],"{",["T_WHITESPACE","\n            ",1643],["T_VARIABLE","$joinWebsite",1644],["T_WHITESPACE"," ",1644],"=",["T_WHITESPACE"," ",1644],["T_STRING","true",1644],";",["T_WHITESPACE","\n            ",1644],["T_IF","if",1645],["T_WHITESPACE"," ",1645],"(",["T_STRING","count",1645],"(",["T_VARIABLE","$filters",1645],"[",["T_CONSTANT_ENCAPSED_STRING","'website_ids'",1645],"]",")",["T_WHITESPACE"," ",1645],">",["T_WHITESPACE"," ",1645],["T_LNUMBER","1",1645],")",["T_WHITESPACE"," ",1645],"{",["T_WHITESPACE","\n                ",1645],["T_VARIABLE","$this",1646],["T_OBJECT_OPERATOR","->",1646],["T_STRING","getSelect",1646],"(",")",["T_OBJECT_OPERATOR","->",1646],["T_STRING","distinct",1646],"(",["T_STRING","true",1646],")",";",["T_WHITESPACE","\n            ",1646],"}",["T_WHITESPACE","\n            ",1647],["T_VARIABLE","$conditions",1648],"[","]",["T_WHITESPACE"," ",1648],"=",["T_WHITESPACE"," ",1648],["T_VARIABLE","$this",1648],["T_OBJECT_OPERATOR","->",1648],["T_STRING","getConnection",1648],"(",")",["T_WHITESPACE","\n                ",1648],["T_OBJECT_OPERATOR","->",1649],["T_STRING","quoteInto",1649],"(",["T_CONSTANT_ENCAPSED_STRING","'product_website.website_id IN(?)'",1649],",",["T_WHITESPACE"," ",1649],["T_VARIABLE","$filters",1649],"[",["T_CONSTANT_ENCAPSED_STRING","'website_ids'",1649],"]",")",";",["T_WHITESPACE","\n        ",1649],"}",["T_WHITESPACE"," ",1650],["T_ELSEIF","elseif",1650],["T_WHITESPACE"," ",1650],"(",["T_ISSET","isset",1650],"(",["T_VARIABLE","$filters",1650],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1650],"]",")",["T_WHITESPACE","\n            ",1650],["T_BOOLEAN_AND","&&",1651],["T_WHITESPACE"," ",1651],"(","!",["T_ISSET","isset",1651],"(",["T_VARIABLE","$filters",1651],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1651],"]",")",["T_WHITESPACE"," ",1651],["T_BOOLEAN_AND","&&",1651],["T_WHITESPACE"," ",1651],"!",["T_ISSET","isset",1651],"(",["T_VARIABLE","$filters",1651],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1651],"]",")",")",["T_WHITESPACE","\n            ",1651],["T_BOOLEAN_AND","&&",1652],["T_WHITESPACE"," ",1652],"!",["T_VARIABLE","$this",1652],["T_OBJECT_OPERATOR","->",1652],["T_STRING","isEnabledFlat",1652],"(",")",["T_WHITESPACE","\n        ",1652],")",["T_WHITESPACE"," ",1653],"{",["T_WHITESPACE","\n            ",1653],["T_VARIABLE","$joinWebsite",1654],["T_WHITESPACE"," ",1654],"=",["T_WHITESPACE"," ",1654],["T_STRING","true",1654],";",["T_WHITESPACE","\n            ",1654],["T_VARIABLE","$websiteId",1655],["T_WHITESPACE"," ",1655],"=",["T_WHITESPACE"," ",1655],["T_STRING","Mage",1655],["T_DOUBLE_COLON","::",1655],["T_STRING","app",1655],"(",")",["T_OBJECT_OPERATOR","->",1655],["T_STRING","getStore",1655],"(",["T_VARIABLE","$filters",1655],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1655],"]",")",["T_OBJECT_OPERATOR","->",1655],["T_STRING","getWebsiteId",1655],"(",")",";",["T_WHITESPACE","\n            ",1655],["T_VARIABLE","$conditions",1656],"[","]",["T_WHITESPACE"," ",1656],"=",["T_WHITESPACE"," ",1656],["T_VARIABLE","$this",1656],["T_OBJECT_OPERATOR","->",1656],["T_STRING","getConnection",1656],"(",")",["T_WHITESPACE","\n                ",1656],["T_OBJECT_OPERATOR","->",1657],["T_STRING","quoteInto",1657],"(",["T_CONSTANT_ENCAPSED_STRING","'product_website.website_id = ?'",1657],",",["T_WHITESPACE"," ",1657],["T_VARIABLE","$websiteId",1657],")",";",["T_WHITESPACE","\n        ",1657],"}",["T_WHITESPACE","\n\n        ",1658],["T_VARIABLE","$fromPart",1660],["T_WHITESPACE"," ",1660],"=",["T_WHITESPACE"," ",1660],["T_VARIABLE","$this",1660],["T_OBJECT_OPERATOR","->",1660],["T_STRING","getSelect",1660],"(",")",["T_OBJECT_OPERATOR","->",1660],["T_STRING","getPart",1660],"(",["T_STRING","Zend_Db_Select",1660],["T_DOUBLE_COLON","::",1660],["T_STRING","FROM",1660],")",";",["T_WHITESPACE","\n        ",1660],["T_IF","if",1661],["T_WHITESPACE"," ",1661],"(",["T_ISSET","isset",1661],"(",["T_VARIABLE","$fromPart",1661],"[",["T_CONSTANT_ENCAPSED_STRING","'product_website'",1661],"]",")",")",["T_WHITESPACE"," ",1661],"{",["T_WHITESPACE","\n            ",1661],["T_IF","if",1662],["T_WHITESPACE"," ",1662],"(","!",["T_VARIABLE","$joinWebsite",1662],")",["T_WHITESPACE"," ",1662],"{",["T_WHITESPACE","\n                ",1662],["T_UNSET","unset",1663],"(",["T_VARIABLE","$fromPart",1663],"[",["T_CONSTANT_ENCAPSED_STRING","'product_website'",1663],"]",")",";",["T_WHITESPACE","\n            ",1663],"}",["T_WHITESPACE"," ",1664],["T_ELSE","else",1664],["T_WHITESPACE"," ",1664],"{",["T_WHITESPACE","\n                ",1664],["T_VARIABLE","$fromPart",1665],"[",["T_CONSTANT_ENCAPSED_STRING","'product_website'",1665],"]","[",["T_CONSTANT_ENCAPSED_STRING","'joinCondition'",1665],"]",["T_WHITESPACE"," ",1665],"=",["T_WHITESPACE"," ",1665],["T_STRING","join",1665],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",1665],",",["T_WHITESPACE"," ",1665],["T_VARIABLE","$conditions",1665],")",";",["T_WHITESPACE","\n            ",1665],"}",["T_WHITESPACE","\n            ",1666],["T_VARIABLE","$this",1667],["T_OBJECT_OPERATOR","->",1667],["T_STRING","getSelect",1667],"(",")",["T_OBJECT_OPERATOR","->",1667],["T_STRING","setPart",1667],"(",["T_STRING","Zend_Db_Select",1667],["T_DOUBLE_COLON","::",1667],["T_STRING","FROM",1667],",",["T_WHITESPACE"," ",1667],["T_VARIABLE","$fromPart",1667],")",";",["T_WHITESPACE","\n        ",1667],"}",["T_WHITESPACE"," ",1668],["T_ELSEIF","elseif",1668],["T_WHITESPACE"," ",1668],"(",["T_VARIABLE","$joinWebsite",1668],")",["T_WHITESPACE"," ",1668],"{",["T_WHITESPACE","\n            ",1668],["T_VARIABLE","$this",1669],["T_OBJECT_OPERATOR","->",1669],["T_STRING","getSelect",1669],"(",")",["T_OBJECT_OPERATOR","->",1669],["T_STRING","join",1669],"(",["T_WHITESPACE","\n                ",1669],["T_ARRAY","array",1670],"(",["T_CONSTANT_ENCAPSED_STRING","'product_website'",1670],["T_WHITESPACE"," ",1670],["T_DOUBLE_ARROW","=>",1670],["T_WHITESPACE"," ",1670],["T_VARIABLE","$this",1670],["T_OBJECT_OPERATOR","->",1670],["T_STRING","getTable",1670],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",1670],")",")",",",["T_WHITESPACE","\n                ",1670],["T_STRING","join",1671],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",1671],",",["T_WHITESPACE"," ",1671],["T_VARIABLE","$conditions",1671],")",",",["T_WHITESPACE","\n                ",1671],["T_ARRAY","array",1672],"(",")",["T_WHITESPACE","\n            ",1672],")",";",["T_WHITESPACE","\n        ",1673],"}",["T_WHITESPACE","\n\n        ",1674],["T_RETURN","return",1676],["T_WHITESPACE"," ",1676],["T_VARIABLE","$this",1676],";",["T_WHITESPACE","\n    ",1676],"}",["T_WHITESPACE","\n\n    ",1677],["T_DOC_COMMENT","\/**\n     * Join additional (alternative) store visibility filter\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1679],["T_WHITESPACE","\n    ",1683],["T_PROTECTED","protected",1684],["T_WHITESPACE"," ",1684],["T_FUNCTION","function",1684],["T_WHITESPACE"," ",1684],["T_STRING","_productLimitationJoinStore",1684],"(",")",["T_WHITESPACE","\n    ",1684],"{",["T_WHITESPACE","\n        ",1685],["T_VARIABLE","$filters",1686],["T_WHITESPACE"," ",1686],"=",["T_WHITESPACE"," ",1686],["T_VARIABLE","$this",1686],["T_OBJECT_OPERATOR","->",1686],["T_STRING","_productLimitationFilters",1686],";",["T_WHITESPACE","\n        ",1686],["T_IF","if",1687],["T_WHITESPACE"," ",1687],"(","!",["T_ISSET","isset",1687],"(",["T_VARIABLE","$filters",1687],"[",["T_CONSTANT_ENCAPSED_STRING","'store_table'",1687],"]",")",")",["T_WHITESPACE"," ",1687],"{",["T_WHITESPACE","\n            ",1687],["T_RETURN","return",1688],["T_WHITESPACE"," ",1688],["T_VARIABLE","$this",1688],";",["T_WHITESPACE","\n        ",1688],"}",["T_WHITESPACE","\n\n        ",1689],["T_VARIABLE","$hasColumn",1691],["T_WHITESPACE"," ",1691],"=",["T_WHITESPACE"," ",1691],["T_STRING","false",1691],";",["T_WHITESPACE","\n        ",1691],["T_FOREACH","foreach",1692],["T_WHITESPACE"," ",1692],"(",["T_VARIABLE","$this",1692],["T_OBJECT_OPERATOR","->",1692],["T_STRING","getSelect",1692],"(",")",["T_OBJECT_OPERATOR","->",1692],["T_STRING","getPart",1692],"(",["T_STRING","Zend_Db_Select",1692],["T_DOUBLE_COLON","::",1692],["T_STRING","COLUMNS",1692],")",["T_WHITESPACE"," ",1692],["T_AS","as",1692],["T_WHITESPACE"," ",1692],["T_VARIABLE","$columnEntry",1692],")",["T_WHITESPACE"," ",1692],"{",["T_WHITESPACE","\n            ",1692],["T_LIST","list",1693],"(",",",",",["T_VARIABLE","$alias",1693],")",["T_WHITESPACE"," ",1693],"=",["T_WHITESPACE"," ",1693],["T_VARIABLE","$columnEntry",1693],";",["T_WHITESPACE","\n            ",1693],["T_IF","if",1694],["T_WHITESPACE"," ",1694],"(",["T_VARIABLE","$alias",1694],["T_WHITESPACE"," ",1694],["T_IS_EQUAL","==",1694],["T_WHITESPACE"," ",1694],["T_CONSTANT_ENCAPSED_STRING","'visibility'",1694],")",["T_WHITESPACE"," ",1694],"{",["T_WHITESPACE","\n                ",1694],["T_VARIABLE","$hasColumn",1695],["T_WHITESPACE"," ",1695],"=",["T_WHITESPACE"," ",1695],["T_STRING","true",1695],";",["T_WHITESPACE","\n            ",1695],"}",["T_WHITESPACE","\n        ",1696],"}",["T_WHITESPACE","\n        ",1697],["T_IF","if",1698],["T_WHITESPACE"," ",1698],"(","!",["T_VARIABLE","$hasColumn",1698],")",["T_WHITESPACE"," ",1698],"{",["T_WHITESPACE","\n            ",1698],["T_VARIABLE","$this",1699],["T_OBJECT_OPERATOR","->",1699],["T_STRING","getSelect",1699],"(",")",["T_OBJECT_OPERATOR","->",1699],["T_STRING","columns",1699],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1699],",",["T_WHITESPACE"," ",1699],["T_CONSTANT_ENCAPSED_STRING","'cat_index'",1699],")",";",["T_WHITESPACE","\n        ",1699],"}",["T_WHITESPACE","\n\n        ",1700],["T_VARIABLE","$fromPart",1702],["T_WHITESPACE"," ",1702],"=",["T_WHITESPACE"," ",1702],["T_VARIABLE","$this",1702],["T_OBJECT_OPERATOR","->",1702],["T_STRING","getSelect",1702],"(",")",["T_OBJECT_OPERATOR","->",1702],["T_STRING","getPart",1702],"(",["T_STRING","Zend_Db_Select",1702],["T_DOUBLE_COLON","::",1702],["T_STRING","FROM",1702],")",";",["T_WHITESPACE","\n        ",1702],["T_IF","if",1703],["T_WHITESPACE"," ",1703],"(","!",["T_ISSET","isset",1703],"(",["T_VARIABLE","$fromPart",1703],"[",["T_CONSTANT_ENCAPSED_STRING","'store_index'",1703],"]",")",")",["T_WHITESPACE"," ",1703],"{",["T_WHITESPACE","\n            ",1703],["T_VARIABLE","$this",1704],["T_OBJECT_OPERATOR","->",1704],["T_STRING","getSelect",1704],"(",")",["T_OBJECT_OPERATOR","->",1704],["T_STRING","joinLeft",1704],"(",["T_WHITESPACE","\n                ",1704],["T_ARRAY","array",1705],"(",["T_CONSTANT_ENCAPSED_STRING","'store_index'",1705],["T_WHITESPACE"," ",1705],["T_DOUBLE_ARROW","=>",1705],["T_WHITESPACE"," ",1705],["T_VARIABLE","$this",1705],["T_OBJECT_OPERATOR","->",1705],["T_STRING","getTable",1705],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",1705],")",")",",",["T_WHITESPACE","\n                ",1705],["T_CONSTANT_ENCAPSED_STRING","'store_index.store_id = '",1706],["T_WHITESPACE"," ",1706],".",["T_WHITESPACE"," ",1706],["T_VARIABLE","$filters",1706],"[",["T_CONSTANT_ENCAPSED_STRING","'store_table'",1706],"]",["T_WHITESPACE"," ",1706],".",["T_WHITESPACE"," ",1706],["T_CONSTANT_ENCAPSED_STRING","'.store_id'",1706],",",["T_WHITESPACE","\n                ",1706],["T_ARRAY","array",1707],"(",")",["T_WHITESPACE","\n            ",1707],")",";",["T_WHITESPACE","\n        ",1708],"}",["T_WHITESPACE","\n        ",1709],["T_IF","if",1710],["T_WHITESPACE"," ",1710],"(","!",["T_ISSET","isset",1710],"(",["T_VARIABLE","$fromPart",1710],"[",["T_CONSTANT_ENCAPSED_STRING","'store_group_index'",1710],"]",")",")",["T_WHITESPACE"," ",1710],"{",["T_WHITESPACE","\n            ",1710],["T_VARIABLE","$this",1711],["T_OBJECT_OPERATOR","->",1711],["T_STRING","getSelect",1711],"(",")",["T_OBJECT_OPERATOR","->",1711],["T_STRING","joinLeft",1711],"(",["T_WHITESPACE","\n                ",1711],["T_ARRAY","array",1712],"(",["T_CONSTANT_ENCAPSED_STRING","'store_group_index'",1712],["T_WHITESPACE"," ",1712],["T_DOUBLE_ARROW","=>",1712],["T_WHITESPACE"," ",1712],["T_VARIABLE","$this",1712],["T_OBJECT_OPERATOR","->",1712],["T_STRING","getTable",1712],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",1712],")",")",",",["T_WHITESPACE","\n                ",1712],["T_CONSTANT_ENCAPSED_STRING","'store_index.group_id = store_group_index.group_id'",1713],",",["T_WHITESPACE","\n                ",1713],["T_ARRAY","array",1714],"(",")",["T_WHITESPACE","\n            ",1714],")",";",["T_WHITESPACE","\n        ",1715],"}",["T_WHITESPACE","\n        ",1716],["T_IF","if",1717],["T_WHITESPACE"," ",1717],"(","!",["T_ISSET","isset",1717],"(",["T_VARIABLE","$fromPart",1717],"[",["T_CONSTANT_ENCAPSED_STRING","'store_cat_index'",1717],"]",")",")",["T_WHITESPACE"," ",1717],"{",["T_WHITESPACE","\n            ",1717],["T_VARIABLE","$this",1718],["T_OBJECT_OPERATOR","->",1718],["T_STRING","getSelect",1718],"(",")",["T_OBJECT_OPERATOR","->",1718],["T_STRING","joinLeft",1718],"(",["T_WHITESPACE","\n                ",1718],["T_ARRAY","array",1719],"(",["T_CONSTANT_ENCAPSED_STRING","'store_cat_index'",1719],["T_WHITESPACE"," ",1719],["T_DOUBLE_ARROW","=>",1719],["T_WHITESPACE"," ",1719],["T_VARIABLE","$this",1719],["T_OBJECT_OPERATOR","->",1719],["T_STRING","getTable",1719],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",1719],")",")",",",["T_WHITESPACE","\n                ",1719],["T_STRING","join",1720],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",1720],",",["T_WHITESPACE"," ",1720],["T_ARRAY","array",1720],"(",["T_WHITESPACE","\n                    ",1720],["T_CONSTANT_ENCAPSED_STRING","'store_cat_index.product_id = e.entity_id'",1721],",",["T_WHITESPACE","\n                    ",1721],["T_CONSTANT_ENCAPSED_STRING","'store_cat_index.store_id = '",1722],["T_WHITESPACE"," ",1722],".",["T_WHITESPACE"," ",1722],["T_VARIABLE","$filters",1722],"[",["T_CONSTANT_ENCAPSED_STRING","'store_table'",1722],"]",["T_WHITESPACE"," ",1722],".",["T_WHITESPACE"," ",1722],["T_CONSTANT_ENCAPSED_STRING","'.store_id'",1722],",",["T_WHITESPACE","\n                    ",1722],["T_CONSTANT_ENCAPSED_STRING","'store_cat_index.category_id=store_group_index.root_category_id'",1723],["T_WHITESPACE","\n                ",1723],")",")",",",["T_WHITESPACE","\n                ",1724],["T_ARRAY","array",1725],"(",["T_CONSTANT_ENCAPSED_STRING","'store_visibility'",1725],["T_WHITESPACE"," ",1725],["T_DOUBLE_ARROW","=>",1725],["T_WHITESPACE"," ",1725],["T_CONSTANT_ENCAPSED_STRING","'visibility'",1725],")",["T_WHITESPACE","\n            ",1725],")",";",["T_WHITESPACE","\n        ",1726],"}",["T_WHITESPACE","\n        ",1727],["T_COMMENT","\/\/ Avoid column duplication problems\n",1728],["T_WHITESPACE","        ",1729],["T_STRING","Mage",1729],["T_DOUBLE_COLON","::",1729],["T_STRING","getResourceHelper",1729],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",1729],")",["T_OBJECT_OPERATOR","->",1729],["T_STRING","prepareColumnsList",1729],"(",["T_VARIABLE","$this",1729],["T_OBJECT_OPERATOR","->",1729],["T_STRING","getSelect",1729],"(",")",")",";",["T_WHITESPACE","\n\n        ",1729],["T_VARIABLE","$whereCond",1731],["T_WHITESPACE"," ",1731],"=",["T_WHITESPACE"," ",1731],["T_STRING","join",1731],"(",["T_CONSTANT_ENCAPSED_STRING","' OR '",1731],",",["T_WHITESPACE"," ",1731],["T_ARRAY","array",1731],"(",["T_WHITESPACE","\n            ",1731],["T_VARIABLE","$this",1732],["T_OBJECT_OPERATOR","->",1732],["T_STRING","getConnection",1732],"(",")",["T_OBJECT_OPERATOR","->",1732],["T_STRING","quoteInto",1732],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index.visibility IN(?)'",1732],",",["T_WHITESPACE"," ",1732],["T_VARIABLE","$filters",1732],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1732],"]",")",",",["T_WHITESPACE","\n            ",1732],["T_VARIABLE","$this",1733],["T_OBJECT_OPERATOR","->",1733],["T_STRING","getConnection",1733],"(",")",["T_OBJECT_OPERATOR","->",1733],["T_STRING","quoteInto",1733],"(",["T_CONSTANT_ENCAPSED_STRING","'store_cat_index.visibility IN(?)'",1733],",",["T_WHITESPACE"," ",1733],["T_VARIABLE","$filters",1733],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1733],"]",")",["T_WHITESPACE","\n        ",1733],")",")",";",["T_WHITESPACE","\n\n        ",1734],["T_VARIABLE","$wherePart",1736],["T_WHITESPACE"," ",1736],"=",["T_WHITESPACE"," ",1736],["T_VARIABLE","$this",1736],["T_OBJECT_OPERATOR","->",1736],["T_STRING","getSelect",1736],"(",")",["T_OBJECT_OPERATOR","->",1736],["T_STRING","getPart",1736],"(",["T_STRING","Zend_Db_Select",1736],["T_DOUBLE_COLON","::",1736],["T_STRING","WHERE",1736],")",";",["T_WHITESPACE","\n        ",1736],["T_VARIABLE","$hasCond",1737],["T_WHITESPACE","   ",1737],"=",["T_WHITESPACE"," ",1737],["T_STRING","false",1737],";",["T_WHITESPACE","\n        ",1737],["T_FOREACH","foreach",1738],["T_WHITESPACE"," ",1738],"(",["T_VARIABLE","$wherePart",1738],["T_WHITESPACE"," ",1738],["T_AS","as",1738],["T_WHITESPACE"," ",1738],["T_VARIABLE","$cond",1738],")",["T_WHITESPACE"," ",1738],"{",["T_WHITESPACE","\n            ",1738],["T_IF","if",1739],["T_WHITESPACE"," ",1739],"(",["T_VARIABLE","$cond",1739],["T_WHITESPACE"," ",1739],["T_IS_EQUAL","==",1739],["T_WHITESPACE"," ",1739],["T_CONSTANT_ENCAPSED_STRING","'('",1739],["T_WHITESPACE"," ",1739],".",["T_WHITESPACE"," ",1739],["T_VARIABLE","$whereCond",1739],["T_WHITESPACE"," ",1739],".",["T_WHITESPACE"," ",1739],["T_CONSTANT_ENCAPSED_STRING","')'",1739],")",["T_WHITESPACE"," ",1739],"{",["T_WHITESPACE","\n                ",1739],["T_VARIABLE","$hasCond",1740],["T_WHITESPACE"," ",1740],"=",["T_WHITESPACE"," ",1740],["T_STRING","true",1740],";",["T_WHITESPACE","\n            ",1740],"}",["T_WHITESPACE","\n        ",1741],"}",["T_WHITESPACE","\n\n        ",1742],["T_IF","if",1744],["T_WHITESPACE"," ",1744],"(","!",["T_VARIABLE","$hasCond",1744],")",["T_WHITESPACE"," ",1744],"{",["T_WHITESPACE","\n            ",1744],["T_VARIABLE","$this",1745],["T_OBJECT_OPERATOR","->",1745],["T_STRING","getSelect",1745],"(",")",["T_OBJECT_OPERATOR","->",1745],["T_STRING","where",1745],"(",["T_VARIABLE","$whereCond",1745],")",";",["T_WHITESPACE","\n        ",1745],"}",["T_WHITESPACE","\n\n        ",1746],["T_RETURN","return",1748],["T_WHITESPACE"," ",1748],["T_VARIABLE","$this",1748],";",["T_WHITESPACE","\n    ",1748],"}",["T_WHITESPACE","\n\n    ",1749],["T_DOC_COMMENT","\/**\n     * Join Product Price Table\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1751],["T_WHITESPACE","\n    ",1755],["T_PROTECTED","protected",1756],["T_WHITESPACE"," ",1756],["T_FUNCTION","function",1756],["T_WHITESPACE"," ",1756],["T_STRING","_productLimitationJoinPrice",1756],"(",")",["T_WHITESPACE","\n    ",1756],"{",["T_WHITESPACE","\n        ",1757],["T_RETURN","return",1758],["T_WHITESPACE"," ",1758],["T_VARIABLE","$this",1758],["T_OBJECT_OPERATOR","->",1758],["T_STRING","_productLimitationPrice",1758],"(",")",";",["T_WHITESPACE","\n    ",1758],"}",["T_WHITESPACE","\n\n    ",1759],["T_DOC_COMMENT","\/**\n     * Join Product Price Table with left-join possibility\n     *\n     * @see Mage_Catalog_Model_Resource_Product_Collection::_productLimitationJoinPrice()\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1761],["T_WHITESPACE","\n    ",1766],["T_PROTECTED","protected",1767],["T_WHITESPACE"," ",1767],["T_FUNCTION","function",1767],["T_WHITESPACE"," ",1767],["T_STRING","_productLimitationPrice",1767],"(",["T_VARIABLE","$joinLeft",1767],["T_WHITESPACE"," ",1767],"=",["T_WHITESPACE"," ",1767],["T_STRING","false",1767],")",["T_WHITESPACE","\n    ",1767],"{",["T_WHITESPACE","\n        ",1768],["T_VARIABLE","$filters",1769],["T_WHITESPACE"," ",1769],"=",["T_WHITESPACE"," ",1769],["T_VARIABLE","$this",1769],["T_OBJECT_OPERATOR","->",1769],["T_STRING","_productLimitationFilters",1769],";",["T_WHITESPACE","\n        ",1769],["T_IF","if",1770],["T_WHITESPACE"," ",1770],"(",["T_EMPTY","empty",1770],"(",["T_VARIABLE","$filters",1770],"[",["T_CONSTANT_ENCAPSED_STRING","'use_price_index'",1770],"]",")",")",["T_WHITESPACE"," ",1770],"{",["T_WHITESPACE","\n            ",1770],["T_RETURN","return",1771],["T_WHITESPACE"," ",1771],["T_VARIABLE","$this",1771],";",["T_WHITESPACE","\n        ",1771],"}",["T_WHITESPACE","\n\n        ",1772],["T_VARIABLE","$helper",1774],["T_WHITESPACE","     ",1774],"=",["T_WHITESPACE"," ",1774],["T_STRING","Mage",1774],["T_DOUBLE_COLON","::",1774],["T_STRING","getResourceHelper",1774],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",1774],")",";",["T_WHITESPACE","\n        ",1774],["T_VARIABLE","$connection",1775],["T_WHITESPACE"," ",1775],"=",["T_WHITESPACE"," ",1775],["T_VARIABLE","$this",1775],["T_OBJECT_OPERATOR","->",1775],["T_STRING","getConnection",1775],"(",")",";",["T_WHITESPACE","\n        ",1775],["T_VARIABLE","$select",1776],["T_WHITESPACE","     ",1776],"=",["T_WHITESPACE"," ",1776],["T_VARIABLE","$this",1776],["T_OBJECT_OPERATOR","->",1776],["T_STRING","getSelect",1776],"(",")",";",["T_WHITESPACE","\n        ",1776],["T_VARIABLE","$joinCond",1777],["T_WHITESPACE","   ",1777],"=",["T_WHITESPACE"," ",1777],["T_STRING","join",1777],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",1777],",",["T_WHITESPACE"," ",1777],["T_ARRAY","array",1777],"(",["T_WHITESPACE","\n            ",1777],["T_CONSTANT_ENCAPSED_STRING","'price_index.entity_id = e.entity_id'",1778],",",["T_WHITESPACE","\n            ",1778],["T_VARIABLE","$connection",1779],["T_OBJECT_OPERATOR","->",1779],["T_STRING","quoteInto",1779],"(",["T_CONSTANT_ENCAPSED_STRING","'price_index.website_id = ?'",1779],",",["T_WHITESPACE"," ",1779],["T_VARIABLE","$filters",1779],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",1779],"]",")",",",["T_WHITESPACE","\n            ",1779],["T_VARIABLE","$connection",1780],["T_OBJECT_OPERATOR","->",1780],["T_STRING","quoteInto",1780],"(",["T_CONSTANT_ENCAPSED_STRING","'price_index.customer_group_id = ?'",1780],",",["T_WHITESPACE"," ",1780],["T_VARIABLE","$filters",1780],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",1780],"]",")",["T_WHITESPACE","\n        ",1780],")",")",";",["T_WHITESPACE","\n\n        ",1781],["T_VARIABLE","$fromPart",1783],["T_WHITESPACE"," ",1783],"=",["T_WHITESPACE"," ",1783],["T_VARIABLE","$select",1783],["T_OBJECT_OPERATOR","->",1783],["T_STRING","getPart",1783],"(",["T_STRING","Zend_Db_Select",1783],["T_DOUBLE_COLON","::",1783],["T_STRING","FROM",1783],")",";",["T_WHITESPACE","\n        ",1783],["T_IF","if",1784],["T_WHITESPACE"," ",1784],"(","!",["T_ISSET","isset",1784],"(",["T_VARIABLE","$fromPart",1784],"[",["T_CONSTANT_ENCAPSED_STRING","'price_index'",1784],"]",")",")",["T_WHITESPACE"," ",1784],"{",["T_WHITESPACE","\n            ",1784],["T_VARIABLE","$least",1785],["T_WHITESPACE","       ",1785],"=",["T_WHITESPACE"," ",1785],["T_VARIABLE","$connection",1785],["T_OBJECT_OPERATOR","->",1785],["T_STRING","getLeastSql",1785],"(",["T_ARRAY","array",1785],"(",["T_CONSTANT_ENCAPSED_STRING","'price_index.min_price'",1785],",",["T_WHITESPACE"," ",1785],["T_CONSTANT_ENCAPSED_STRING","'price_index.tier_price'",1785],")",")",";",["T_WHITESPACE","\n            ",1785],["T_VARIABLE","$minimalExpr",1786],["T_WHITESPACE"," ",1786],"=",["T_WHITESPACE"," ",1786],["T_VARIABLE","$connection",1786],["T_OBJECT_OPERATOR","->",1786],["T_STRING","getCheckSql",1786],"(",["T_CONSTANT_ENCAPSED_STRING","'price_index.tier_price IS NOT NULL'",1786],",",["T_WHITESPACE","\n                ",1786],["T_VARIABLE","$least",1787],",",["T_WHITESPACE"," ",1787],["T_CONSTANT_ENCAPSED_STRING","'price_index.min_price'",1787],")",";",["T_WHITESPACE","\n            ",1787],["T_VARIABLE","$colls",1788],["T_WHITESPACE","       ",1788],"=",["T_WHITESPACE"," ",1788],["T_ARRAY","array",1788],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",1788],",",["T_WHITESPACE"," ",1788],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",1788],",",["T_WHITESPACE"," ",1788],["T_CONSTANT_ENCAPSED_STRING","'final_price'",1788],",",["T_WHITESPACE","\n                ",1788],["T_CONSTANT_ENCAPSED_STRING","'minimal_price'",1789],["T_WHITESPACE"," ",1789],["T_DOUBLE_ARROW","=>",1789],["T_WHITESPACE"," ",1789],["T_VARIABLE","$minimalExpr",1789],["T_WHITESPACE"," ",1789],",",["T_WHITESPACE"," ",1789],["T_CONSTANT_ENCAPSED_STRING","'min_price'",1789],",",["T_WHITESPACE"," ",1789],["T_CONSTANT_ENCAPSED_STRING","'max_price'",1789],",",["T_WHITESPACE"," ",1789],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",1789],")",";",["T_WHITESPACE","\n            ",1789],["T_VARIABLE","$tableName",1790],["T_WHITESPACE"," ",1790],"=",["T_WHITESPACE"," ",1790],["T_ARRAY","array",1790],"(",["T_CONSTANT_ENCAPSED_STRING","'price_index'",1790],["T_WHITESPACE"," ",1790],["T_DOUBLE_ARROW","=>",1790],["T_WHITESPACE"," ",1790],["T_VARIABLE","$this",1790],["T_OBJECT_OPERATOR","->",1790],["T_STRING","getTable",1790],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_price'",1790],")",")",";",["T_WHITESPACE","\n            ",1790],["T_IF","if",1791],["T_WHITESPACE"," ",1791],"(",["T_VARIABLE","$joinLeft",1791],")",["T_WHITESPACE"," ",1791],"{",["T_WHITESPACE","\n                ",1791],["T_VARIABLE","$select",1792],["T_OBJECT_OPERATOR","->",1792],["T_STRING","joinLeft",1792],"(",["T_VARIABLE","$tableName",1792],",",["T_WHITESPACE"," ",1792],["T_VARIABLE","$joinCond",1792],",",["T_WHITESPACE"," ",1792],["T_VARIABLE","$colls",1792],")",";",["T_WHITESPACE","\n            ",1792],"}",["T_WHITESPACE"," ",1793],["T_ELSE","else",1793],["T_WHITESPACE"," ",1793],"{",["T_WHITESPACE","\n                ",1793],["T_VARIABLE","$select",1794],["T_OBJECT_OPERATOR","->",1794],["T_STRING","join",1794],"(",["T_VARIABLE","$tableName",1794],",",["T_WHITESPACE"," ",1794],["T_VARIABLE","$joinCond",1794],",",["T_WHITESPACE"," ",1794],["T_VARIABLE","$colls",1794],")",";",["T_WHITESPACE","\n            ",1794],"}",["T_WHITESPACE","\n            ",1795],["T_COMMENT","\/\/ Set additional field filters\n",1796],["T_WHITESPACE","            ",1797],["T_FOREACH","foreach",1797],["T_WHITESPACE"," ",1797],"(",["T_VARIABLE","$this",1797],["T_OBJECT_OPERATOR","->",1797],["T_STRING","_priceDataFieldFilters",1797],["T_WHITESPACE"," ",1797],["T_AS","as",1797],["T_WHITESPACE"," ",1797],["T_VARIABLE","$filterData",1797],")",["T_WHITESPACE"," ",1797],"{",["T_WHITESPACE","\n                ",1797],["T_VARIABLE","$select",1798],["T_OBJECT_OPERATOR","->",1798],["T_STRING","where",1798],"(",["T_STRING","call_user_func_array",1798],"(",["T_CONSTANT_ENCAPSED_STRING","'sprintf'",1798],",",["T_WHITESPACE"," ",1798],["T_VARIABLE","$filterData",1798],")",")",";",["T_WHITESPACE","\n            ",1798],"}",["T_WHITESPACE","\n        ",1799],"}",["T_WHITESPACE"," ",1800],["T_ELSE","else",1800],["T_WHITESPACE"," ",1800],"{",["T_WHITESPACE","\n            ",1800],["T_VARIABLE","$fromPart",1801],"[",["T_CONSTANT_ENCAPSED_STRING","'price_index'",1801],"]","[",["T_CONSTANT_ENCAPSED_STRING","'joinCondition'",1801],"]",["T_WHITESPACE"," ",1801],"=",["T_WHITESPACE"," ",1801],["T_VARIABLE","$joinCond",1801],";",["T_WHITESPACE","\n            ",1801],["T_VARIABLE","$select",1802],["T_OBJECT_OPERATOR","->",1802],["T_STRING","setPart",1802],"(",["T_STRING","Zend_Db_Select",1802],["T_DOUBLE_COLON","::",1802],["T_STRING","FROM",1802],",",["T_WHITESPACE"," ",1802],["T_VARIABLE","$fromPart",1802],")",";",["T_WHITESPACE","\n        ",1802],"}",["T_WHITESPACE","\n        ",1803],["T_COMMENT","\/\/Clean duplicated fields\n",1804],["T_WHITESPACE","        ",1805],["T_VARIABLE","$helper",1805],["T_OBJECT_OPERATOR","->",1805],["T_STRING","prepareColumnsList",1805],"(",["T_VARIABLE","$select",1805],")",";",["T_WHITESPACE","\n\n\n        ",1805],["T_RETURN","return",1808],["T_WHITESPACE"," ",1808],["T_VARIABLE","$this",1808],";",["T_WHITESPACE","\n    ",1808],"}",["T_WHITESPACE","\n\n    ",1809],["T_DOC_COMMENT","\/**\n     * Apply front-end price limitation filters to the collection\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1811],["T_WHITESPACE","\n    ",1815],["T_PUBLIC","public",1816],["T_WHITESPACE"," ",1816],["T_FUNCTION","function",1816],["T_WHITESPACE"," ",1816],["T_STRING","applyFrontendPriceLimitations",1816],"(",")",["T_WHITESPACE","\n    ",1816],"{",["T_WHITESPACE","\n        ",1817],["T_VARIABLE","$this",1818],["T_OBJECT_OPERATOR","->",1818],["T_STRING","_productLimitationFilters",1818],"[",["T_CONSTANT_ENCAPSED_STRING","'use_price_index'",1818],"]",["T_WHITESPACE"," ",1818],"=",["T_WHITESPACE"," ",1818],["T_STRING","true",1818],";",["T_WHITESPACE","\n        ",1818],["T_IF","if",1819],["T_WHITESPACE"," ",1819],"(","!",["T_ISSET","isset",1819],"(",["T_VARIABLE","$this",1819],["T_OBJECT_OPERATOR","->",1819],["T_STRING","_productLimitationFilters",1819],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",1819],"]",")",")",["T_WHITESPACE"," ",1819],"{",["T_WHITESPACE","\n            ",1819],["T_VARIABLE","$customerGroupId",1820],["T_WHITESPACE"," ",1820],"=",["T_WHITESPACE"," ",1820],["T_STRING","Mage",1820],["T_DOUBLE_COLON","::",1820],["T_STRING","getSingleton",1820],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",1820],")",["T_OBJECT_OPERATOR","->",1820],["T_STRING","getCustomerGroupId",1820],"(",")",";",["T_WHITESPACE","\n            ",1820],["T_VARIABLE","$this",1821],["T_OBJECT_OPERATOR","->",1821],["T_STRING","_productLimitationFilters",1821],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",1821],"]",["T_WHITESPACE"," ",1821],"=",["T_WHITESPACE"," ",1821],["T_VARIABLE","$customerGroupId",1821],";",["T_WHITESPACE","\n        ",1821],"}",["T_WHITESPACE","\n        ",1822],["T_IF","if",1823],["T_WHITESPACE"," ",1823],"(","!",["T_ISSET","isset",1823],"(",["T_VARIABLE","$this",1823],["T_OBJECT_OPERATOR","->",1823],["T_STRING","_productLimitationFilters",1823],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",1823],"]",")",")",["T_WHITESPACE"," ",1823],"{",["T_WHITESPACE","\n            ",1823],["T_VARIABLE","$websiteId",1824],["T_WHITESPACE"," ",1824],"=",["T_WHITESPACE"," ",1824],["T_STRING","Mage",1824],["T_DOUBLE_COLON","::",1824],["T_STRING","app",1824],"(",")",["T_OBJECT_OPERATOR","->",1824],["T_STRING","getStore",1824],"(",["T_VARIABLE","$this",1824],["T_OBJECT_OPERATOR","->",1824],["T_STRING","getStoreId",1824],"(",")",")",["T_OBJECT_OPERATOR","->",1824],["T_STRING","getWebsiteId",1824],"(",")",";",["T_WHITESPACE","\n            ",1824],["T_VARIABLE","$this",1825],["T_OBJECT_OPERATOR","->",1825],["T_STRING","_productLimitationFilters",1825],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",1825],"]",["T_WHITESPACE"," ",1825],"=",["T_WHITESPACE"," ",1825],["T_VARIABLE","$websiteId",1825],";",["T_WHITESPACE","\n        ",1825],"}",["T_WHITESPACE","\n        ",1826],["T_VARIABLE","$this",1827],["T_OBJECT_OPERATOR","->",1827],["T_STRING","_applyProductLimitations",1827],"(",")",";",["T_WHITESPACE","\n        ",1827],["T_RETURN","return",1828],["T_WHITESPACE"," ",1828],["T_VARIABLE","$this",1828],";",["T_WHITESPACE","\n    ",1828],"}",["T_WHITESPACE","\n\n    ",1829],["T_DOC_COMMENT","\/**\n     * Apply limitation filters to collection\n     * Method allows using one time category product index table (or product website table)\n     * for different combinations of store_id\/category_id\/visibility filter states\n     * Method supports multiple changes in one collection object for this parameters\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1831],["T_WHITESPACE","\n    ",1838],["T_PROTECTED","protected",1839],["T_WHITESPACE"," ",1839],["T_FUNCTION","function",1839],["T_WHITESPACE"," ",1839],["T_STRING","_applyProductLimitations",1839],"(",")",["T_WHITESPACE","\n    ",1839],"{",["T_WHITESPACE","\n        ",1840],["T_STRING","Mage",1841],["T_DOUBLE_COLON","::",1841],["T_STRING","dispatchEvent",1841],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_collection_apply_limitations_before'",1841],",",["T_WHITESPACE"," ",1841],["T_ARRAY","array",1841],"(",["T_WHITESPACE","\n            ",1841],["T_CONSTANT_ENCAPSED_STRING","'collection'",1842],["T_WHITESPACE","  ",1842],["T_DOUBLE_ARROW","=>",1842],["T_WHITESPACE"," ",1842],["T_VARIABLE","$this",1842],",",["T_WHITESPACE","\n            ",1842],["T_CONSTANT_ENCAPSED_STRING","'category_id'",1843],["T_WHITESPACE"," ",1843],["T_DOUBLE_ARROW","=>",1843],["T_WHITESPACE"," ",1843],["T_ISSET","isset",1843],"(",["T_VARIABLE","$this",1843],["T_OBJECT_OPERATOR","->",1843],["T_STRING","_productLimitationFilters",1843],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1843],"]",")",["T_WHITESPACE","\n                ",1843],"?",["T_WHITESPACE"," ",1844],["T_VARIABLE","$this",1844],["T_OBJECT_OPERATOR","->",1844],["T_STRING","_productLimitationFilters",1844],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1844],"]",["T_WHITESPACE","\n                ",1844],":",["T_WHITESPACE"," ",1845],["T_STRING","null",1845],",",["T_WHITESPACE","\n        ",1845],")",")",";",["T_WHITESPACE","\n        ",1846],["T_VARIABLE","$this",1847],["T_OBJECT_OPERATOR","->",1847],["T_STRING","_prepareProductLimitationFilters",1847],"(",")",";",["T_WHITESPACE","\n        ",1847],["T_VARIABLE","$this",1848],["T_OBJECT_OPERATOR","->",1848],["T_STRING","_productLimitationJoinWebsite",1848],"(",")",";",["T_WHITESPACE","\n        ",1848],["T_VARIABLE","$this",1849],["T_OBJECT_OPERATOR","->",1849],["T_STRING","_productLimitationJoinPrice",1849],"(",")",";",["T_WHITESPACE","\n        ",1849],["T_VARIABLE","$filters",1850],["T_WHITESPACE"," ",1850],"=",["T_WHITESPACE"," ",1850],["T_VARIABLE","$this",1850],["T_OBJECT_OPERATOR","->",1850],["T_STRING","_productLimitationFilters",1850],";",["T_WHITESPACE","\n\n        ",1850],["T_IF","if",1852],["T_WHITESPACE"," ",1852],"(","!",["T_ISSET","isset",1852],"(",["T_VARIABLE","$filters",1852],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1852],"]",")",["T_WHITESPACE"," ",1852],["T_BOOLEAN_AND","&&",1852],["T_WHITESPACE"," ",1852],"!",["T_ISSET","isset",1852],"(",["T_VARIABLE","$filters",1852],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1852],"]",")",")",["T_WHITESPACE"," ",1852],"{",["T_WHITESPACE","\n            ",1852],["T_RETURN","return",1853],["T_WHITESPACE"," ",1853],["T_VARIABLE","$this",1853],";",["T_WHITESPACE","\n        ",1853],"}",["T_WHITESPACE","\n\n        ",1854],["T_VARIABLE","$conditions",1856],["T_WHITESPACE"," ",1856],"=",["T_WHITESPACE"," ",1856],["T_ARRAY","array",1856],"(",["T_WHITESPACE","\n            ",1856],["T_CONSTANT_ENCAPSED_STRING","'cat_index.product_id=e.entity_id'",1857],",",["T_WHITESPACE","\n            ",1857],["T_VARIABLE","$this",1858],["T_OBJECT_OPERATOR","->",1858],["T_STRING","getConnection",1858],"(",")",["T_OBJECT_OPERATOR","->",1858],["T_STRING","quoteInto",1858],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index.store_id=?'",1858],",",["T_WHITESPACE"," ",1858],["T_VARIABLE","$filters",1858],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1858],"]",")",["T_WHITESPACE","\n        ",1858],")",";",["T_WHITESPACE","\n        ",1859],["T_IF","if",1860],["T_WHITESPACE"," ",1860],"(",["T_ISSET","isset",1860],"(",["T_VARIABLE","$filters",1860],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1860],"]",")",["T_WHITESPACE"," ",1860],["T_BOOLEAN_AND","&&",1860],["T_WHITESPACE"," ",1860],"!",["T_ISSET","isset",1860],"(",["T_VARIABLE","$filters",1860],"[",["T_CONSTANT_ENCAPSED_STRING","'store_table'",1860],"]",")",")",["T_WHITESPACE"," ",1860],"{",["T_WHITESPACE","\n            ",1860],["T_VARIABLE","$conditions",1861],"[","]",["T_WHITESPACE"," ",1861],"=",["T_WHITESPACE"," ",1861],["T_VARIABLE","$this",1861],["T_OBJECT_OPERATOR","->",1861],["T_STRING","getConnection",1861],"(",")",["T_WHITESPACE","\n                ",1861],["T_OBJECT_OPERATOR","->",1862],["T_STRING","quoteInto",1862],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index.visibility IN(?)'",1862],",",["T_WHITESPACE"," ",1862],["T_VARIABLE","$filters",1862],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1862],"]",")",";",["T_WHITESPACE","\n        ",1862],"}",["T_WHITESPACE","\n\n        ",1863],["T_IF","if",1865],["T_WHITESPACE"," ",1865],"(","!",["T_VARIABLE","$this",1865],["T_OBJECT_OPERATOR","->",1865],["T_STRING","getFlag",1865],"(",["T_CONSTANT_ENCAPSED_STRING","'disable_root_category_filter'",1865],")",")",["T_WHITESPACE"," ",1865],"{",["T_WHITESPACE","\n            ",1865],["T_VARIABLE","$conditions",1866],"[","]",["T_WHITESPACE"," ",1866],"=",["T_WHITESPACE"," ",1866],["T_VARIABLE","$this",1866],["T_OBJECT_OPERATOR","->",1866],["T_STRING","getConnection",1866],"(",")",["T_OBJECT_OPERATOR","->",1866],["T_STRING","quoteInto",1866],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index.category_id = ?'",1866],",",["T_WHITESPACE"," ",1866],["T_VARIABLE","$filters",1866],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1866],"]",")",";",["T_WHITESPACE","\n        ",1866],"}",["T_WHITESPACE","\n\n        ",1867],["T_IF","if",1869],["T_WHITESPACE"," ",1869],"(",["T_ISSET","isset",1869],"(",["T_VARIABLE","$filters",1869],"[",["T_CONSTANT_ENCAPSED_STRING","'category_is_anchor'",1869],"]",")",")",["T_WHITESPACE"," ",1869],"{",["T_WHITESPACE","\n            ",1869],["T_VARIABLE","$conditions",1870],"[","]",["T_WHITESPACE"," ",1870],"=",["T_WHITESPACE"," ",1870],["T_VARIABLE","$this",1870],["T_OBJECT_OPERATOR","->",1870],["T_STRING","getConnection",1870],"(",")",["T_WHITESPACE","\n                ",1870],["T_OBJECT_OPERATOR","->",1871],["T_STRING","quoteInto",1871],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index.is_parent=?'",1871],",",["T_WHITESPACE"," ",1871],["T_VARIABLE","$filters",1871],"[",["T_CONSTANT_ENCAPSED_STRING","'category_is_anchor'",1871],"]",")",";",["T_WHITESPACE","\n        ",1871],"}",["T_WHITESPACE","\n\n        ",1872],["T_VARIABLE","$joinCond",1874],["T_WHITESPACE"," ",1874],"=",["T_WHITESPACE"," ",1874],["T_STRING","join",1874],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",1874],",",["T_WHITESPACE"," ",1874],["T_VARIABLE","$conditions",1874],")",";",["T_WHITESPACE","\n        ",1874],["T_VARIABLE","$fromPart",1875],["T_WHITESPACE"," ",1875],"=",["T_WHITESPACE"," ",1875],["T_VARIABLE","$this",1875],["T_OBJECT_OPERATOR","->",1875],["T_STRING","getSelect",1875],"(",")",["T_OBJECT_OPERATOR","->",1875],["T_STRING","getPart",1875],"(",["T_STRING","Zend_Db_Select",1875],["T_DOUBLE_COLON","::",1875],["T_STRING","FROM",1875],")",";",["T_WHITESPACE","\n        ",1875],["T_IF","if",1876],["T_WHITESPACE"," ",1876],"(",["T_ISSET","isset",1876],"(",["T_VARIABLE","$fromPart",1876],"[",["T_CONSTANT_ENCAPSED_STRING","'cat_index'",1876],"]",")",")",["T_WHITESPACE"," ",1876],"{",["T_WHITESPACE","\n            ",1876],["T_VARIABLE","$fromPart",1877],"[",["T_CONSTANT_ENCAPSED_STRING","'cat_index'",1877],"]","[",["T_CONSTANT_ENCAPSED_STRING","'joinCondition'",1877],"]",["T_WHITESPACE"," ",1877],"=",["T_WHITESPACE"," ",1877],["T_VARIABLE","$joinCond",1877],";",["T_WHITESPACE","\n            ",1877],["T_VARIABLE","$this",1878],["T_OBJECT_OPERATOR","->",1878],["T_STRING","getSelect",1878],"(",")",["T_OBJECT_OPERATOR","->",1878],["T_STRING","setPart",1878],"(",["T_STRING","Zend_Db_Select",1878],["T_DOUBLE_COLON","::",1878],["T_STRING","FROM",1878],",",["T_WHITESPACE"," ",1878],["T_VARIABLE","$fromPart",1878],")",";",["T_WHITESPACE","\n        ",1878],"}",["T_WHITESPACE","\n        ",1879],["T_ELSE","else",1880],["T_WHITESPACE"," ",1880],"{",["T_WHITESPACE","\n            ",1880],["T_VARIABLE","$this",1881],["T_OBJECT_OPERATOR","->",1881],["T_STRING","getSelect",1881],"(",")",["T_OBJECT_OPERATOR","->",1881],["T_STRING","join",1881],"(",["T_WHITESPACE","\n                ",1881],["T_ARRAY","array",1882],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index'",1882],["T_WHITESPACE"," ",1882],["T_DOUBLE_ARROW","=>",1882],["T_WHITESPACE"," ",1882],["T_VARIABLE","$this",1882],["T_OBJECT_OPERATOR","->",1882],["T_STRING","getTable",1882],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",1882],")",")",",",["T_WHITESPACE","\n                ",1882],["T_VARIABLE","$joinCond",1883],",",["T_WHITESPACE","\n                ",1883],["T_ARRAY","array",1884],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index_position'",1884],["T_WHITESPACE"," ",1884],["T_DOUBLE_ARROW","=>",1884],["T_WHITESPACE"," ",1884],["T_CONSTANT_ENCAPSED_STRING","'position'",1884],")",["T_WHITESPACE","\n            ",1884],")",";",["T_WHITESPACE","\n        ",1885],"}",["T_WHITESPACE","\n\n        ",1886],["T_VARIABLE","$this",1888],["T_OBJECT_OPERATOR","->",1888],["T_STRING","_productLimitationJoinStore",1888],"(",")",";",["T_WHITESPACE","\n\n        ",1888],["T_STRING","Mage",1890],["T_DOUBLE_COLON","::",1890],["T_STRING","dispatchEvent",1890],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_collection_apply_limitations_after'",1890],",",["T_WHITESPACE"," ",1890],["T_ARRAY","array",1890],"(",["T_WHITESPACE","\n            ",1890],["T_CONSTANT_ENCAPSED_STRING","'collection'",1891],["T_WHITESPACE"," ",1891],["T_DOUBLE_ARROW","=>",1891],["T_WHITESPACE"," ",1891],["T_VARIABLE","$this",1891],["T_WHITESPACE","\n        ",1891],")",")",";",["T_WHITESPACE","\n\n        ",1892],["T_RETURN","return",1894],["T_WHITESPACE"," ",1894],["T_VARIABLE","$this",1894],";",["T_WHITESPACE","\n    ",1894],"}",["T_WHITESPACE","\n\n    ",1895],["T_DOC_COMMENT","\/**\n     * Apply limitation filters to collection base on API\n     * Method allows using one time category product table\n     * for combinations of category_id filter states\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1897],["T_WHITESPACE","\n    ",1903],["T_PROTECTED","protected",1904],["T_WHITESPACE"," ",1904],["T_FUNCTION","function",1904],["T_WHITESPACE"," ",1904],["T_STRING","_applyZeroStoreProductLimitations",1904],"(",")",["T_WHITESPACE","\n    ",1904],"{",["T_WHITESPACE","\n        ",1905],["T_VARIABLE","$filters",1906],["T_WHITESPACE"," ",1906],"=",["T_WHITESPACE"," ",1906],["T_VARIABLE","$this",1906],["T_OBJECT_OPERATOR","->",1906],["T_STRING","_productLimitationFilters",1906],";",["T_WHITESPACE","\n\n        ",1906],["T_VARIABLE","$conditions",1908],["T_WHITESPACE"," ",1908],"=",["T_WHITESPACE"," ",1908],["T_ARRAY","array",1908],"(",["T_WHITESPACE","\n            ",1908],["T_CONSTANT_ENCAPSED_STRING","'cat_pro.product_id=e.entity_id'",1909],",",["T_WHITESPACE","\n            ",1909],["T_VARIABLE","$this",1910],["T_OBJECT_OPERATOR","->",1910],["T_STRING","getConnection",1910],"(",")",["T_OBJECT_OPERATOR","->",1910],["T_STRING","quoteInto",1910],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_pro.category_id=?'",1910],",",["T_WHITESPACE"," ",1910],["T_VARIABLE","$filters",1910],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1910],"]",")",["T_WHITESPACE","\n        ",1910],")",";",["T_WHITESPACE","\n        ",1911],["T_VARIABLE","$joinCond",1912],["T_WHITESPACE"," ",1912],"=",["T_WHITESPACE"," ",1912],["T_STRING","join",1912],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",1912],",",["T_WHITESPACE"," ",1912],["T_VARIABLE","$conditions",1912],")",";",["T_WHITESPACE","\n\n        ",1912],["T_VARIABLE","$fromPart",1914],["T_WHITESPACE"," ",1914],"=",["T_WHITESPACE"," ",1914],["T_VARIABLE","$this",1914],["T_OBJECT_OPERATOR","->",1914],["T_STRING","getSelect",1914],"(",")",["T_OBJECT_OPERATOR","->",1914],["T_STRING","getPart",1914],"(",["T_STRING","Zend_Db_Select",1914],["T_DOUBLE_COLON","::",1914],["T_STRING","FROM",1914],")",";",["T_WHITESPACE","\n        ",1914],["T_IF","if",1915],["T_WHITESPACE"," ",1915],"(",["T_ISSET","isset",1915],"(",["T_VARIABLE","$fromPart",1915],"[",["T_CONSTANT_ENCAPSED_STRING","'cat_pro'",1915],"]",")",")",["T_WHITESPACE"," ",1915],"{",["T_WHITESPACE","\n            ",1915],["T_VARIABLE","$fromPart",1916],"[",["T_CONSTANT_ENCAPSED_STRING","'cat_pro'",1916],"]","[",["T_CONSTANT_ENCAPSED_STRING","'joinCondition'",1916],"]",["T_WHITESPACE"," ",1916],"=",["T_WHITESPACE"," ",1916],["T_VARIABLE","$joinCond",1916],";",["T_WHITESPACE","\n            ",1916],["T_VARIABLE","$this",1917],["T_OBJECT_OPERATOR","->",1917],["T_STRING","getSelect",1917],"(",")",["T_OBJECT_OPERATOR","->",1917],["T_STRING","setPart",1917],"(",["T_STRING","Zend_Db_Select",1917],["T_DOUBLE_COLON","::",1917],["T_STRING","FROM",1917],",",["T_WHITESPACE"," ",1917],["T_VARIABLE","$fromPart",1917],")",";",["T_WHITESPACE","\n        ",1917],"}",["T_WHITESPACE","\n        ",1918],["T_ELSE","else",1919],["T_WHITESPACE"," ",1919],"{",["T_WHITESPACE","\n            ",1919],["T_VARIABLE","$this",1920],["T_OBJECT_OPERATOR","->",1920],["T_STRING","getSelect",1920],"(",")",["T_OBJECT_OPERATOR","->",1920],["T_STRING","join",1920],"(",["T_WHITESPACE","\n                ",1920],["T_ARRAY","array",1921],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_pro'",1921],["T_WHITESPACE"," ",1921],["T_DOUBLE_ARROW","=>",1921],["T_WHITESPACE"," ",1921],["T_VARIABLE","$this",1921],["T_OBJECT_OPERATOR","->",1921],["T_STRING","getTable",1921],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",1921],")",")",",",["T_WHITESPACE","\n                ",1921],["T_VARIABLE","$joinCond",1922],",",["T_WHITESPACE","\n                ",1922],["T_ARRAY","array",1923],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_index_position'",1923],["T_WHITESPACE"," ",1923],["T_DOUBLE_ARROW","=>",1923],["T_WHITESPACE"," ",1923],["T_CONSTANT_ENCAPSED_STRING","'position'",1923],")",["T_WHITESPACE","\n            ",1923],")",";",["T_WHITESPACE","\n        ",1924],"}",["T_WHITESPACE","\n        ",1925],["T_VARIABLE","$this",1926],["T_OBJECT_OPERATOR","->",1926],["T_STRING","_joinFields",1926],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",1926],"]",["T_WHITESPACE"," ",1926],"=",["T_WHITESPACE"," ",1926],["T_ARRAY","array",1926],"(",["T_WHITESPACE","\n            ",1926],["T_CONSTANT_ENCAPSED_STRING","'table'",1927],["T_WHITESPACE"," ",1927],["T_DOUBLE_ARROW","=>",1927],["T_WHITESPACE"," ",1927],["T_CONSTANT_ENCAPSED_STRING","'cat_pro'",1927],",",["T_WHITESPACE","\n            ",1927],["T_CONSTANT_ENCAPSED_STRING","'field'",1928],["T_WHITESPACE"," ",1928],["T_DOUBLE_ARROW","=>",1928],["T_WHITESPACE"," ",1928],["T_CONSTANT_ENCAPSED_STRING","'position'",1928],",",["T_WHITESPACE","\n        ",1928],")",";",["T_WHITESPACE","\n\n        ",1929],["T_RETURN","return",1931],["T_WHITESPACE"," ",1931],["T_VARIABLE","$this",1931],";",["T_WHITESPACE","\n    ",1931],"}",["T_WHITESPACE","\n\n    ",1932],["T_DOC_COMMENT","\/**\n     * Add category ids to loaded items\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1934],["T_WHITESPACE","\n    ",1938],["T_PUBLIC","public",1939],["T_WHITESPACE"," ",1939],["T_FUNCTION","function",1939],["T_WHITESPACE"," ",1939],["T_STRING","addCategoryIds",1939],"(",")",["T_WHITESPACE","\n    ",1939],"{",["T_WHITESPACE","\n        ",1940],["T_IF","if",1941],["T_WHITESPACE"," ",1941],"(",["T_VARIABLE","$this",1941],["T_OBJECT_OPERATOR","->",1941],["T_STRING","getFlag",1941],"(",["T_CONSTANT_ENCAPSED_STRING","'category_ids_added'",1941],")",")",["T_WHITESPACE"," ",1941],"{",["T_WHITESPACE","\n            ",1941],["T_RETURN","return",1942],["T_WHITESPACE"," ",1942],["T_VARIABLE","$this",1942],";",["T_WHITESPACE","\n        ",1942],"}",["T_WHITESPACE","\n        ",1943],["T_VARIABLE","$ids",1944],["T_WHITESPACE"," ",1944],"=",["T_WHITESPACE"," ",1944],["T_STRING","array_keys",1944],"(",["T_VARIABLE","$this",1944],["T_OBJECT_OPERATOR","->",1944],["T_STRING","_items",1944],")",";",["T_WHITESPACE","\n        ",1944],["T_IF","if",1945],["T_WHITESPACE"," ",1945],"(",["T_EMPTY","empty",1945],"(",["T_VARIABLE","$ids",1945],")",")",["T_WHITESPACE"," ",1945],"{",["T_WHITESPACE","\n            ",1945],["T_RETURN","return",1946],["T_WHITESPACE"," ",1946],["T_VARIABLE","$this",1946],";",["T_WHITESPACE","\n        ",1946],"}",["T_WHITESPACE","\n\n        ",1947],["T_VARIABLE","$select",1949],["T_WHITESPACE"," ",1949],"=",["T_WHITESPACE"," ",1949],["T_VARIABLE","$this",1949],["T_OBJECT_OPERATOR","->",1949],["T_STRING","getConnection",1949],"(",")",["T_OBJECT_OPERATOR","->",1949],["T_STRING","select",1949],"(",")",";",["T_WHITESPACE","\n\n        ",1949],["T_VARIABLE","$select",1951],["T_OBJECT_OPERATOR","->",1951],["T_STRING","from",1951],"(",["T_VARIABLE","$this",1951],["T_OBJECT_OPERATOR","->",1951],["T_STRING","_productCategoryTable",1951],",",["T_WHITESPACE"," ",1951],["T_ARRAY","array",1951],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1951],",",["T_WHITESPACE"," ",1951],["T_CONSTANT_ENCAPSED_STRING","'category_id'",1951],")",")",";",["T_WHITESPACE","\n        ",1951],["T_VARIABLE","$select",1952],["T_OBJECT_OPERATOR","->",1952],["T_STRING","where",1952],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",1952],",",["T_WHITESPACE"," ",1952],["T_VARIABLE","$ids",1952],")",";",["T_WHITESPACE","\n\n        ",1952],["T_VARIABLE","$data",1954],["T_WHITESPACE"," ",1954],"=",["T_WHITESPACE"," ",1954],["T_VARIABLE","$this",1954],["T_OBJECT_OPERATOR","->",1954],["T_STRING","getConnection",1954],"(",")",["T_OBJECT_OPERATOR","->",1954],["T_STRING","fetchAll",1954],"(",["T_VARIABLE","$select",1954],")",";",["T_WHITESPACE","\n\n        ",1954],["T_VARIABLE","$categoryIds",1956],["T_WHITESPACE"," ",1956],"=",["T_WHITESPACE"," ",1956],["T_ARRAY","array",1956],"(",")",";",["T_WHITESPACE","\n        ",1956],["T_FOREACH","foreach",1957],["T_WHITESPACE"," ",1957],"(",["T_VARIABLE","$data",1957],["T_WHITESPACE"," ",1957],["T_AS","as",1957],["T_WHITESPACE"," ",1957],["T_VARIABLE","$info",1957],")",["T_WHITESPACE"," ",1957],"{",["T_WHITESPACE","\n            ",1957],["T_IF","if",1958],["T_WHITESPACE"," ",1958],"(",["T_ISSET","isset",1958],"(",["T_VARIABLE","$categoryIds",1958],"[",["T_VARIABLE","$info",1958],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1958],"]","]",")",")",["T_WHITESPACE"," ",1958],"{",["T_WHITESPACE","\n                ",1958],["T_VARIABLE","$categoryIds",1959],"[",["T_VARIABLE","$info",1959],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1959],"]","]","[","]",["T_WHITESPACE"," ",1959],"=",["T_WHITESPACE"," ",1959],["T_VARIABLE","$info",1959],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1959],"]",";",["T_WHITESPACE","\n            ",1959],"}",["T_WHITESPACE"," ",1960],["T_ELSE","else",1960],["T_WHITESPACE"," ",1960],"{",["T_WHITESPACE","\n                ",1960],["T_VARIABLE","$categoryIds",1961],"[",["T_VARIABLE","$info",1961],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1961],"]","]",["T_WHITESPACE"," ",1961],"=",["T_WHITESPACE"," ",1961],["T_ARRAY","array",1961],"(",["T_VARIABLE","$info",1961],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1961],"]",")",";",["T_WHITESPACE","\n            ",1961],"}",["T_WHITESPACE","\n        ",1962],"}",["T_WHITESPACE","\n\n\n        ",1963],["T_FOREACH","foreach",1966],["T_WHITESPACE"," ",1966],"(",["T_VARIABLE","$this",1966],["T_OBJECT_OPERATOR","->",1966],["T_STRING","getItems",1966],"(",")",["T_WHITESPACE"," ",1966],["T_AS","as",1966],["T_WHITESPACE"," ",1966],["T_VARIABLE","$item",1966],")",["T_WHITESPACE"," ",1966],"{",["T_WHITESPACE","\n            ",1966],["T_VARIABLE","$productId",1967],["T_WHITESPACE"," ",1967],"=",["T_WHITESPACE"," ",1967],["T_VARIABLE","$item",1967],["T_OBJECT_OPERATOR","->",1967],["T_STRING","getId",1967],"(",")",";",["T_WHITESPACE","\n            ",1967],["T_IF","if",1968],["T_WHITESPACE"," ",1968],"(",["T_ISSET","isset",1968],"(",["T_VARIABLE","$categoryIds",1968],"[",["T_VARIABLE","$productId",1968],"]",")",")",["T_WHITESPACE"," ",1968],"{",["T_WHITESPACE","\n                ",1968],["T_VARIABLE","$item",1969],["T_OBJECT_OPERATOR","->",1969],["T_STRING","setCategoryIds",1969],"(",["T_VARIABLE","$categoryIds",1969],"[",["T_VARIABLE","$productId",1969],"]",")",";",["T_WHITESPACE","\n            ",1969],"}",["T_WHITESPACE"," ",1970],["T_ELSE","else",1970],["T_WHITESPACE"," ",1970],"{",["T_WHITESPACE","\n                ",1970],["T_VARIABLE","$item",1971],["T_OBJECT_OPERATOR","->",1971],["T_STRING","setCategoryIds",1971],"(",["T_ARRAY","array",1971],"(",")",")",";",["T_WHITESPACE","\n            ",1971],"}",["T_WHITESPACE","\n        ",1972],"}",["T_WHITESPACE","\n\n        ",1973],["T_VARIABLE","$this",1975],["T_OBJECT_OPERATOR","->",1975],["T_STRING","setFlag",1975],"(",["T_CONSTANT_ENCAPSED_STRING","'category_ids_added'",1975],",",["T_WHITESPACE"," ",1975],["T_STRING","true",1975],")",";",["T_WHITESPACE","\n        ",1975],["T_RETURN","return",1976],["T_WHITESPACE"," ",1976],["T_VARIABLE","$this",1976],";",["T_WHITESPACE","\n    ",1976],"}",["T_WHITESPACE","\n\n    ",1977],["T_DOC_COMMENT","\/**\n     * Add tier price data to loaded items\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",1979],["T_WHITESPACE","\n    ",1983],["T_PUBLIC","public",1984],["T_WHITESPACE"," ",1984],["T_FUNCTION","function",1984],["T_WHITESPACE"," ",1984],["T_STRING","addTierPriceData",1984],"(",")",["T_WHITESPACE","\n    ",1984],"{",["T_WHITESPACE","\n        ",1985],["T_IF","if",1986],["T_WHITESPACE"," ",1986],"(",["T_VARIABLE","$this",1986],["T_OBJECT_OPERATOR","->",1986],["T_STRING","getFlag",1986],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price_added'",1986],")",")",["T_WHITESPACE"," ",1986],"{",["T_WHITESPACE","\n            ",1986],["T_RETURN","return",1987],["T_WHITESPACE"," ",1987],["T_VARIABLE","$this",1987],";",["T_WHITESPACE","\n        ",1987],"}",["T_WHITESPACE","\n\n        ",1988],["T_VARIABLE","$tierPrices",1990],["T_WHITESPACE"," ",1990],"=",["T_WHITESPACE"," ",1990],["T_ARRAY","array",1990],"(",")",";",["T_WHITESPACE","\n        ",1990],["T_VARIABLE","$productIds",1991],["T_WHITESPACE"," ",1991],"=",["T_WHITESPACE"," ",1991],["T_ARRAY","array",1991],"(",")",";",["T_WHITESPACE","\n        ",1991],["T_FOREACH","foreach",1992],["T_WHITESPACE"," ",1992],"(",["T_VARIABLE","$this",1992],["T_OBJECT_OPERATOR","->",1992],["T_STRING","getItems",1992],"(",")",["T_WHITESPACE"," ",1992],["T_AS","as",1992],["T_WHITESPACE"," ",1992],["T_VARIABLE","$item",1992],")",["T_WHITESPACE"," ",1992],"{",["T_WHITESPACE","\n            ",1992],["T_VARIABLE","$productIds",1993],"[","]",["T_WHITESPACE"," ",1993],"=",["T_WHITESPACE"," ",1993],["T_VARIABLE","$item",1993],["T_OBJECT_OPERATOR","->",1993],["T_STRING","getId",1993],"(",")",";",["T_WHITESPACE","\n            ",1993],["T_VARIABLE","$tierPrices",1994],"[",["T_VARIABLE","$item",1994],["T_OBJECT_OPERATOR","->",1994],["T_STRING","getId",1994],"(",")","]",["T_WHITESPACE"," ",1994],"=",["T_WHITESPACE"," ",1994],["T_ARRAY","array",1994],"(",")",";",["T_WHITESPACE","\n        ",1994],"}",["T_WHITESPACE","\n        ",1995],["T_IF","if",1996],["T_WHITESPACE"," ",1996],"(","!",["T_VARIABLE","$productIds",1996],")",["T_WHITESPACE"," ",1996],"{",["T_WHITESPACE","\n            ",1996],["T_RETURN","return",1997],["T_WHITESPACE"," ",1997],["T_VARIABLE","$this",1997],";",["T_WHITESPACE","\n        ",1997],"}",["T_WHITESPACE","\n\n        ",1998],["T_DOC_COMMENT","\/** @var $attribute Mage_Catalog_Model_Resource_Eav_Attribute *\/",2000],["T_WHITESPACE","\n        ",2000],["T_VARIABLE","$attribute",2001],["T_WHITESPACE"," ",2001],"=",["T_WHITESPACE"," ",2001],["T_VARIABLE","$this",2001],["T_OBJECT_OPERATOR","->",2001],["T_STRING","getAttribute",2001],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",2001],")",";",["T_WHITESPACE","\n        ",2001],["T_IF","if",2002],["T_WHITESPACE"," ",2002],"(",["T_VARIABLE","$attribute",2002],["T_OBJECT_OPERATOR","->",2002],["T_STRING","isScopeGlobal",2002],"(",")",")",["T_WHITESPACE"," ",2002],"{",["T_WHITESPACE","\n            ",2002],["T_VARIABLE","$websiteId",2003],["T_WHITESPACE"," ",2003],"=",["T_WHITESPACE"," ",2003],["T_LNUMBER","0",2003],";",["T_WHITESPACE","\n        ",2003],"}",["T_WHITESPACE"," ",2004],["T_ELSE","else",2004],["T_WHITESPACE"," ",2004],["T_IF","if",2004],["T_WHITESPACE"," ",2004],"(",["T_VARIABLE","$this",2004],["T_OBJECT_OPERATOR","->",2004],["T_STRING","getStoreId",2004],"(",")",")",["T_WHITESPACE"," ",2004],"{",["T_WHITESPACE","\n            ",2004],["T_VARIABLE","$websiteId",2005],["T_WHITESPACE"," ",2005],"=",["T_WHITESPACE"," ",2005],["T_STRING","Mage",2005],["T_DOUBLE_COLON","::",2005],["T_STRING","app",2005],"(",")",["T_OBJECT_OPERATOR","->",2005],["T_STRING","getStore",2005],"(",["T_VARIABLE","$this",2005],["T_OBJECT_OPERATOR","->",2005],["T_STRING","getStoreId",2005],"(",")",")",["T_OBJECT_OPERATOR","->",2005],["T_STRING","getWebsiteId",2005],"(",")",";",["T_WHITESPACE","\n        ",2005],"}",["T_WHITESPACE","\n\n        ",2006],["T_VARIABLE","$adapter",2008],["T_WHITESPACE","   ",2008],"=",["T_WHITESPACE"," ",2008],["T_VARIABLE","$this",2008],["T_OBJECT_OPERATOR","->",2008],["T_STRING","getConnection",2008],"(",")",";",["T_WHITESPACE","\n        ",2008],["T_VARIABLE","$columns",2009],["T_WHITESPACE","   ",2009],"=",["T_WHITESPACE"," ",2009],["T_ARRAY","array",2009],"(",["T_WHITESPACE","\n            ",2009],["T_CONSTANT_ENCAPSED_STRING","'price_id'",2010],["T_WHITESPACE","      ",2010],["T_DOUBLE_ARROW","=>",2010],["T_WHITESPACE"," ",2010],["T_CONSTANT_ENCAPSED_STRING","'value_id'",2010],",",["T_WHITESPACE","\n            ",2010],["T_CONSTANT_ENCAPSED_STRING","'website_id'",2011],["T_WHITESPACE","    ",2011],["T_DOUBLE_ARROW","=>",2011],["T_WHITESPACE"," ",2011],["T_CONSTANT_ENCAPSED_STRING","'website_id'",2011],",",["T_WHITESPACE","\n            ",2011],["T_CONSTANT_ENCAPSED_STRING","'all_groups'",2012],["T_WHITESPACE","    ",2012],["T_DOUBLE_ARROW","=>",2012],["T_WHITESPACE"," ",2012],["T_CONSTANT_ENCAPSED_STRING","'all_groups'",2012],",",["T_WHITESPACE","\n            ",2012],["T_CONSTANT_ENCAPSED_STRING","'cust_group'",2013],["T_WHITESPACE","    ",2013],["T_DOUBLE_ARROW","=>",2013],["T_WHITESPACE"," ",2013],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",2013],",",["T_WHITESPACE","\n            ",2013],["T_CONSTANT_ENCAPSED_STRING","'price_qty'",2014],["T_WHITESPACE","     ",2014],["T_DOUBLE_ARROW","=>",2014],["T_WHITESPACE"," ",2014],["T_CONSTANT_ENCAPSED_STRING","'qty'",2014],",",["T_WHITESPACE","\n            ",2014],["T_CONSTANT_ENCAPSED_STRING","'price'",2015],["T_WHITESPACE","         ",2015],["T_DOUBLE_ARROW","=>",2015],["T_WHITESPACE"," ",2015],["T_CONSTANT_ENCAPSED_STRING","'value'",2015],",",["T_WHITESPACE","\n            ",2015],["T_CONSTANT_ENCAPSED_STRING","'product_id'",2016],["T_WHITESPACE","    ",2016],["T_DOUBLE_ARROW","=>",2016],["T_WHITESPACE"," ",2016],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",2016],["T_WHITESPACE","\n        ",2016],")",";",["T_WHITESPACE","\n        ",2017],["T_VARIABLE","$select",2018],["T_WHITESPACE","  ",2018],"=",["T_WHITESPACE"," ",2018],["T_VARIABLE","$adapter",2018],["T_OBJECT_OPERATOR","->",2018],["T_STRING","select",2018],"(",")",["T_WHITESPACE","\n            ",2018],["T_OBJECT_OPERATOR","->",2019],["T_STRING","from",2019],"(",["T_VARIABLE","$this",2019],["T_OBJECT_OPERATOR","->",2019],["T_STRING","getTable",2019],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_tier_price'",2019],")",",",["T_WHITESPACE"," ",2019],["T_VARIABLE","$columns",2019],")",["T_WHITESPACE","\n            ",2019],["T_OBJECT_OPERATOR","->",2020],["T_STRING","where",2020],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",2020],",",["T_WHITESPACE"," ",2020],["T_VARIABLE","$productIds",2020],")",["T_WHITESPACE","\n            ",2020],["T_OBJECT_OPERATOR","->",2021],["T_STRING","order",2021],"(",["T_ARRAY","array",2021],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",2021],",",["T_CONSTANT_ENCAPSED_STRING","'qty'",2021],")",")",";",["T_WHITESPACE","\n\n        ",2021],["T_IF","if",2023],["T_WHITESPACE"," ",2023],"(",["T_VARIABLE","$websiteId",2023],["T_WHITESPACE"," ",2023],["T_IS_EQUAL","==",2023],["T_WHITESPACE"," ",2023],["T_CONSTANT_ENCAPSED_STRING","'0'",2023],")",["T_WHITESPACE"," ",2023],"{",["T_WHITESPACE","\n            ",2023],["T_VARIABLE","$select",2024],["T_OBJECT_OPERATOR","->",2024],["T_STRING","where",2024],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id = ?'",2024],",",["T_WHITESPACE"," ",2024],["T_VARIABLE","$websiteId",2024],")",";",["T_WHITESPACE","\n        ",2024],"}",["T_WHITESPACE"," ",2025],["T_ELSE","else",2025],["T_WHITESPACE"," ",2025],"{",["T_WHITESPACE","\n            ",2025],["T_VARIABLE","$select",2026],["T_OBJECT_OPERATOR","->",2026],["T_STRING","where",2026],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id IN(?)'",2026],",",["T_WHITESPACE"," ",2026],["T_ARRAY","array",2026],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",2026],",",["T_WHITESPACE"," ",2026],["T_VARIABLE","$websiteId",2026],")",")",";",["T_WHITESPACE","\n        ",2026],"}",["T_WHITESPACE","\n\n        ",2027],["T_FOREACH","foreach",2029],["T_WHITESPACE"," ",2029],"(",["T_VARIABLE","$adapter",2029],["T_OBJECT_OPERATOR","->",2029],["T_STRING","fetchAll",2029],"(",["T_VARIABLE","$select",2029],")",["T_WHITESPACE"," ",2029],["T_AS","as",2029],["T_WHITESPACE"," ",2029],["T_VARIABLE","$row",2029],")",["T_WHITESPACE"," ",2029],"{",["T_WHITESPACE","\n            ",2029],["T_VARIABLE","$tierPrices",2030],"[",["T_VARIABLE","$row",2030],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",2030],"]","]","[","]",["T_WHITESPACE"," ",2030],"=",["T_WHITESPACE"," ",2030],["T_ARRAY","array",2030],"(",["T_WHITESPACE","\n                ",2030],["T_CONSTANT_ENCAPSED_STRING","'website_id'",2031],["T_WHITESPACE","    ",2031],["T_DOUBLE_ARROW","=>",2031],["T_WHITESPACE"," ",2031],["T_VARIABLE","$row",2031],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",2031],"]",",",["T_WHITESPACE","\n                ",2031],["T_CONSTANT_ENCAPSED_STRING","'cust_group'",2032],["T_WHITESPACE","    ",2032],["T_DOUBLE_ARROW","=>",2032],["T_WHITESPACE"," ",2032],["T_VARIABLE","$row",2032],"[",["T_CONSTANT_ENCAPSED_STRING","'all_groups'",2032],"]",["T_WHITESPACE"," ",2032],"?",["T_WHITESPACE"," ",2032],["T_STRING","Mage_Customer_Model_Group",2032],["T_DOUBLE_COLON","::",2032],["T_STRING","CUST_GROUP_ALL",2032],["T_WHITESPACE"," ",2032],":",["T_WHITESPACE"," ",2032],["T_VARIABLE","$row",2032],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",2032],"]",",",["T_WHITESPACE","\n                ",2032],["T_CONSTANT_ENCAPSED_STRING","'price_qty'",2033],["T_WHITESPACE","     ",2033],["T_DOUBLE_ARROW","=>",2033],["T_WHITESPACE"," ",2033],["T_VARIABLE","$row",2033],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",2033],"]",",",["T_WHITESPACE","\n                ",2033],["T_CONSTANT_ENCAPSED_STRING","'price'",2034],["T_WHITESPACE","         ",2034],["T_DOUBLE_ARROW","=>",2034],["T_WHITESPACE"," ",2034],["T_VARIABLE","$row",2034],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",2034],"]",",",["T_WHITESPACE","\n                ",2034],["T_CONSTANT_ENCAPSED_STRING","'website_price'",2035],["T_WHITESPACE"," ",2035],["T_DOUBLE_ARROW","=>",2035],["T_WHITESPACE"," ",2035],["T_VARIABLE","$row",2035],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",2035],"]",",",["T_WHITESPACE","\n\n            ",2035],")",";",["T_WHITESPACE","\n        ",2037],"}",["T_WHITESPACE","\n\n        ",2038],["T_COMMENT","\/* @var $backend Mage_Catalog_Model_Product_Attribute_Backend_Tierprice *\/",2040],["T_WHITESPACE","\n        ",2040],["T_VARIABLE","$backend",2041],["T_WHITESPACE"," ",2041],"=",["T_WHITESPACE"," ",2041],["T_VARIABLE","$attribute",2041],["T_OBJECT_OPERATOR","->",2041],["T_STRING","getBackend",2041],"(",")",";",["T_WHITESPACE","\n\n        ",2041],["T_FOREACH","foreach",2043],["T_WHITESPACE"," ",2043],"(",["T_VARIABLE","$this",2043],["T_OBJECT_OPERATOR","->",2043],["T_STRING","getItems",2043],"(",")",["T_WHITESPACE"," ",2043],["T_AS","as",2043],["T_WHITESPACE"," ",2043],["T_VARIABLE","$item",2043],")",["T_WHITESPACE"," ",2043],"{",["T_WHITESPACE","\n            ",2043],["T_VARIABLE","$data",2044],["T_WHITESPACE"," ",2044],"=",["T_WHITESPACE"," ",2044],["T_VARIABLE","$tierPrices",2044],"[",["T_VARIABLE","$item",2044],["T_OBJECT_OPERATOR","->",2044],["T_STRING","getId",2044],"(",")","]",";",["T_WHITESPACE","\n            ",2044],["T_IF","if",2045],["T_WHITESPACE"," ",2045],"(","!",["T_EMPTY","empty",2045],"(",["T_VARIABLE","$data",2045],")",["T_WHITESPACE"," ",2045],["T_BOOLEAN_AND","&&",2045],["T_WHITESPACE"," ",2045],["T_VARIABLE","$websiteId",2045],")",["T_WHITESPACE"," ",2045],"{",["T_WHITESPACE","\n                ",2045],["T_VARIABLE","$data",2046],["T_WHITESPACE"," ",2046],"=",["T_WHITESPACE"," ",2046],["T_VARIABLE","$backend",2046],["T_OBJECT_OPERATOR","->",2046],["T_STRING","preparePriceData",2046],"(",["T_VARIABLE","$data",2046],",",["T_WHITESPACE"," ",2046],["T_VARIABLE","$item",2046],["T_OBJECT_OPERATOR","->",2046],["T_STRING","getTypeId",2046],"(",")",",",["T_WHITESPACE"," ",2046],["T_VARIABLE","$websiteId",2046],")",";",["T_WHITESPACE","\n            ",2046],"}",["T_WHITESPACE","\n            ",2047],["T_VARIABLE","$item",2048],["T_OBJECT_OPERATOR","->",2048],["T_STRING","setData",2048],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",2048],",",["T_WHITESPACE"," ",2048],["T_VARIABLE","$data",2048],")",";",["T_WHITESPACE","\n        ",2048],"}",["T_WHITESPACE","\n\n        ",2049],["T_VARIABLE","$this",2051],["T_OBJECT_OPERATOR","->",2051],["T_STRING","setFlag",2051],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price_added'",2051],",",["T_WHITESPACE"," ",2051],["T_STRING","true",2051],")",";",["T_WHITESPACE","\n        ",2051],["T_RETURN","return",2052],["T_WHITESPACE"," ",2052],["T_VARIABLE","$this",2052],";",["T_WHITESPACE","\n    ",2052],"}",["T_WHITESPACE","\n\n    ",2053],["T_DOC_COMMENT","\/**\n     * Add field comparison expression\n     *\n     * @param string $comparisonFormat - expression for sprintf()\n     * @param array $fields - list of fields\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     * @throws Exception\n     *\/",2055],["T_WHITESPACE","\n    ",2062],["T_PUBLIC","public",2063],["T_WHITESPACE"," ",2063],["T_FUNCTION","function",2063],["T_WHITESPACE"," ",2063],["T_STRING","addPriceDataFieldFilter",2063],"(",["T_VARIABLE","$comparisonFormat",2063],",",["T_WHITESPACE"," ",2063],["T_VARIABLE","$fields",2063],")",["T_WHITESPACE","\n    ",2063],"{",["T_WHITESPACE","\n        ",2064],["T_IF","if",2065],["T_WHITESPACE"," ",2065],"(","!",["T_STRING","preg_match",2065],"(",["T_CONSTANT_ENCAPSED_STRING","'\/^%s( (<|>|=|<=|>=|<>) %s)*$\/'",2065],",",["T_WHITESPACE"," ",2065],["T_VARIABLE","$comparisonFormat",2065],")",")",["T_WHITESPACE"," ",2065],"{",["T_WHITESPACE","\n            ",2065],["T_THROW","throw",2066],["T_WHITESPACE"," ",2066],["T_NEW","new",2066],["T_WHITESPACE"," ",2066],["T_STRING","Exception",2066],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid comparison format.'",2066],")",";",["T_WHITESPACE","\n        ",2066],"}",["T_WHITESPACE","\n\n        ",2067],["T_IF","if",2069],["T_WHITESPACE"," ",2069],"(","!",["T_STRING","is_array",2069],"(",["T_VARIABLE","$fields",2069],")",")",["T_WHITESPACE"," ",2069],"{",["T_WHITESPACE","\n            ",2069],["T_VARIABLE","$fields",2070],["T_WHITESPACE"," ",2070],"=",["T_WHITESPACE"," ",2070],["T_ARRAY","array",2070],"(",["T_VARIABLE","$fields",2070],")",";",["T_WHITESPACE","\n        ",2070],"}",["T_WHITESPACE","\n        ",2071],["T_FOREACH","foreach",2072],["T_WHITESPACE"," ",2072],"(",["T_VARIABLE","$fields",2072],["T_WHITESPACE"," ",2072],["T_AS","as",2072],["T_WHITESPACE"," ",2072],["T_VARIABLE","$key",2072],["T_WHITESPACE"," ",2072],["T_DOUBLE_ARROW","=>",2072],["T_WHITESPACE"," ",2072],["T_VARIABLE","$field",2072],")",["T_WHITESPACE"," ",2072],"{",["T_WHITESPACE","\n            ",2072],["T_VARIABLE","$fields",2073],"[",["T_VARIABLE","$key",2073],"]",["T_WHITESPACE"," ",2073],"=",["T_WHITESPACE"," ",2073],["T_VARIABLE","$this",2073],["T_OBJECT_OPERATOR","->",2073],["T_STRING","_getMappedField",2073],"(",["T_VARIABLE","$field",2073],")",";",["T_WHITESPACE","\n        ",2073],"}",["T_WHITESPACE","\n\n        ",2074],["T_VARIABLE","$this",2076],["T_OBJECT_OPERATOR","->",2076],["T_STRING","_priceDataFieldFilters",2076],"[","]",["T_WHITESPACE"," ",2076],"=",["T_WHITESPACE"," ",2076],["T_STRING","array_merge",2076],"(",["T_ARRAY","array",2076],"(",["T_VARIABLE","$comparisonFormat",2076],")",",",["T_WHITESPACE"," ",2076],["T_VARIABLE","$fields",2076],")",";",["T_WHITESPACE","\n        ",2076],["T_RETURN","return",2077],["T_WHITESPACE"," ",2077],["T_VARIABLE","$this",2077],";",["T_WHITESPACE","\n    ",2077],"}",["T_WHITESPACE","\n\n    ",2078],["T_DOC_COMMENT","\/**\n     * Clear collection\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",2080],["T_WHITESPACE","\n    ",2084],["T_PUBLIC","public",2085],["T_WHITESPACE"," ",2085],["T_FUNCTION","function",2085],["T_WHITESPACE"," ",2085],["T_STRING","clear",2085],"(",")",["T_WHITESPACE","\n    ",2085],"{",["T_WHITESPACE","\n        ",2086],["T_FOREACH","foreach",2087],["T_WHITESPACE"," ",2087],"(",["T_VARIABLE","$this",2087],["T_OBJECT_OPERATOR","->",2087],["T_STRING","_items",2087],["T_WHITESPACE"," ",2087],["T_AS","as",2087],["T_WHITESPACE"," ",2087],["T_VARIABLE","$i",2087],["T_WHITESPACE"," ",2087],["T_DOUBLE_ARROW","=>",2087],["T_WHITESPACE"," ",2087],["T_VARIABLE","$item",2087],")",["T_WHITESPACE"," ",2087],"{",["T_WHITESPACE","\n            ",2087],["T_IF","if",2088],["T_WHITESPACE"," ",2088],"(",["T_VARIABLE","$item",2088],["T_OBJECT_OPERATOR","->",2088],["T_STRING","hasStockItem",2088],"(",")",")",["T_WHITESPACE"," ",2088],"{",["T_WHITESPACE","\n                ",2088],["T_VARIABLE","$item",2089],["T_OBJECT_OPERATOR","->",2089],["T_STRING","unsStockItem",2089],"(",")",";",["T_WHITESPACE","\n            ",2089],"}",["T_WHITESPACE","\n            ",2090],["T_VARIABLE","$item",2091],["T_WHITESPACE"," ",2091],"=",["T_WHITESPACE"," ",2091],["T_VARIABLE","$this",2091],["T_OBJECT_OPERATOR","->",2091],["T_STRING","_items",2091],"[",["T_VARIABLE","$i",2091],"]",["T_WHITESPACE"," ",2091],"=",["T_WHITESPACE"," ",2091],["T_STRING","null",2091],";",["T_WHITESPACE","\n        ",2091],"}",["T_WHITESPACE","\n\n        ",2092],["T_FOREACH","foreach",2094],["T_WHITESPACE"," ",2094],"(",["T_VARIABLE","$this",2094],["T_OBJECT_OPERATOR","->",2094],["T_STRING","_itemsById",2094],["T_WHITESPACE"," ",2094],["T_AS","as",2094],["T_WHITESPACE"," ",2094],["T_VARIABLE","$i",2094],["T_WHITESPACE"," ",2094],["T_DOUBLE_ARROW","=>",2094],["T_WHITESPACE"," ",2094],["T_VARIABLE","$item",2094],")",["T_WHITESPACE"," ",2094],"{",["T_WHITESPACE","\n            ",2094],["T_VARIABLE","$item",2095],["T_WHITESPACE"," ",2095],"=",["T_WHITESPACE"," ",2095],["T_VARIABLE","$this",2095],["T_OBJECT_OPERATOR","->",2095],["T_STRING","_itemsById",2095],"[",["T_VARIABLE","$i",2095],"]",["T_WHITESPACE"," ",2095],"=",["T_WHITESPACE"," ",2095],["T_STRING","null",2095],";",["T_WHITESPACE","\n        ",2095],"}",["T_WHITESPACE","\n\n        ",2096],["T_UNSET","unset",2098],"(",["T_VARIABLE","$this",2098],["T_OBJECT_OPERATOR","->",2098],["T_STRING","_items",2098],",",["T_WHITESPACE"," ",2098],["T_VARIABLE","$this",2098],["T_OBJECT_OPERATOR","->",2098],["T_STRING","_data",2098],",",["T_WHITESPACE"," ",2098],["T_VARIABLE","$this",2098],["T_OBJECT_OPERATOR","->",2098],["T_STRING","_itemsById",2098],")",";",["T_WHITESPACE","\n        ",2098],["T_VARIABLE","$this",2099],["T_OBJECT_OPERATOR","->",2099],["T_STRING","_data",2099],["T_WHITESPACE"," ",2099],"=",["T_WHITESPACE"," ",2099],["T_ARRAY","array",2099],"(",")",";",["T_WHITESPACE","\n        ",2099],["T_VARIABLE","$this",2100],["T_OBJECT_OPERATOR","->",2100],["T_STRING","_itemsById",2100],["T_WHITESPACE"," ",2100],"=",["T_WHITESPACE"," ",2100],["T_ARRAY","array",2100],"(",")",";",["T_WHITESPACE","\n        ",2100],["T_RETURN","return",2101],["T_WHITESPACE"," ",2101],["T_STRING","parent",2101],["T_DOUBLE_COLON","::",2101],["T_STRING","clear",2101],"(",")",";",["T_WHITESPACE","\n    ",2101],"}",["T_WHITESPACE","\n\n    ",2102],["T_DOC_COMMENT","\/**\n     * Set Order field\n     *\n     * @param string $attribute\n     * @param string $dir\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",2104],["T_WHITESPACE","\n    ",2110],["T_PUBLIC","public",2111],["T_WHITESPACE"," ",2111],["T_FUNCTION","function",2111],["T_WHITESPACE"," ",2111],["T_STRING","setOrder",2111],"(",["T_VARIABLE","$attribute",2111],",",["T_WHITESPACE"," ",2111],["T_VARIABLE","$dir",2111],["T_WHITESPACE"," ",2111],"=",["T_WHITESPACE"," ",2111],["T_CONSTANT_ENCAPSED_STRING","'desc'",2111],")",["T_WHITESPACE","\n    ",2111],"{",["T_WHITESPACE","\n        ",2112],["T_IF","if",2113],["T_WHITESPACE"," ",2113],"(",["T_VARIABLE","$attribute",2113],["T_WHITESPACE"," ",2113],["T_IS_EQUAL","==",2113],["T_WHITESPACE"," ",2113],["T_CONSTANT_ENCAPSED_STRING","'price'",2113],")",["T_WHITESPACE"," ",2113],"{",["T_WHITESPACE","\n            ",2113],["T_VARIABLE","$this",2114],["T_OBJECT_OPERATOR","->",2114],["T_STRING","addAttributeToSort",2114],"(",["T_VARIABLE","$attribute",2114],",",["T_WHITESPACE"," ",2114],["T_VARIABLE","$dir",2114],")",";",["T_WHITESPACE","\n        ",2114],"}",["T_WHITESPACE"," ",2115],["T_ELSE","else",2115],["T_WHITESPACE"," ",2115],"{",["T_WHITESPACE","\n            ",2115],["T_STRING","parent",2116],["T_DOUBLE_COLON","::",2116],["T_STRING","setOrder",2116],"(",["T_VARIABLE","$attribute",2116],",",["T_WHITESPACE"," ",2116],["T_VARIABLE","$dir",2116],")",";",["T_WHITESPACE","\n        ",2116],"}",["T_WHITESPACE","\n        ",2117],["T_RETURN","return",2118],["T_WHITESPACE"," ",2118],["T_VARIABLE","$this",2118],";",["T_WHITESPACE","\n    ",2118],"}",["T_WHITESPACE","\n\n    ",2119],["T_DOC_COMMENT","\/**\n     * Get products max price\n     *\n     * @return float\n     *\/",2121],["T_WHITESPACE","\n    ",2125],["T_PUBLIC","public",2126],["T_WHITESPACE"," ",2126],["T_FUNCTION","function",2126],["T_WHITESPACE"," ",2126],["T_STRING","getMaxPrice",2126],"(",")",["T_WHITESPACE","\n    ",2126],"{",["T_WHITESPACE","\n        ",2127],["T_IF","if",2128],["T_WHITESPACE"," ",2128],"(",["T_STRING","is_null",2128],"(",["T_VARIABLE","$this",2128],["T_OBJECT_OPERATOR","->",2128],["T_STRING","_maxPrice",2128],")",")",["T_WHITESPACE"," ",2128],"{",["T_WHITESPACE","\n            ",2128],["T_VARIABLE","$this",2129],["T_OBJECT_OPERATOR","->",2129],["T_STRING","_prepareStatisticsData",2129],"(",")",";",["T_WHITESPACE","\n        ",2129],"}",["T_WHITESPACE","\n\n        ",2130],["T_RETURN","return",2132],["T_WHITESPACE"," ",2132],["T_VARIABLE","$this",2132],["T_OBJECT_OPERATOR","->",2132],["T_STRING","_maxPrice",2132],";",["T_WHITESPACE","\n    ",2132],"}",["T_WHITESPACE","\n\n    ",2133],["T_DOC_COMMENT","\/**\n     * Get products min price\n     *\n     * @return float\n     *\/",2135],["T_WHITESPACE","\n    ",2139],["T_PUBLIC","public",2140],["T_WHITESPACE"," ",2140],["T_FUNCTION","function",2140],["T_WHITESPACE"," ",2140],["T_STRING","getMinPrice",2140],"(",")",["T_WHITESPACE","\n    ",2140],"{",["T_WHITESPACE","\n        ",2141],["T_IF","if",2142],["T_WHITESPACE"," ",2142],"(",["T_STRING","is_null",2142],"(",["T_VARIABLE","$this",2142],["T_OBJECT_OPERATOR","->",2142],["T_STRING","_minPrice",2142],")",")",["T_WHITESPACE"," ",2142],"{",["T_WHITESPACE","\n            ",2142],["T_VARIABLE","$this",2143],["T_OBJECT_OPERATOR","->",2143],["T_STRING","_prepareStatisticsData",2143],"(",")",";",["T_WHITESPACE","\n        ",2143],"}",["T_WHITESPACE","\n\n        ",2144],["T_RETURN","return",2146],["T_WHITESPACE"," ",2146],["T_VARIABLE","$this",2146],["T_OBJECT_OPERATOR","->",2146],["T_STRING","_minPrice",2146],";",["T_WHITESPACE","\n    ",2146],"}",["T_WHITESPACE","\n\n    ",2147],["T_DOC_COMMENT","\/**\n     * Get standard deviation of products price\n     *\n     * @return float\n     *\/",2149],["T_WHITESPACE","\n    ",2153],["T_PUBLIC","public",2154],["T_WHITESPACE"," ",2154],["T_FUNCTION","function",2154],["T_WHITESPACE"," ",2154],["T_STRING","getPriceStandardDeviation",2154],"(",")",["T_WHITESPACE","\n    ",2154],"{",["T_WHITESPACE","\n        ",2155],["T_IF","if",2156],["T_WHITESPACE"," ",2156],"(",["T_STRING","is_null",2156],"(",["T_VARIABLE","$this",2156],["T_OBJECT_OPERATOR","->",2156],["T_STRING","_priceStandardDeviation",2156],")",")",["T_WHITESPACE"," ",2156],"{",["T_WHITESPACE","\n            ",2156],["T_VARIABLE","$this",2157],["T_OBJECT_OPERATOR","->",2157],["T_STRING","_prepareStatisticsData",2157],"(",")",";",["T_WHITESPACE","\n        ",2157],"}",["T_WHITESPACE","\n\n        ",2158],["T_RETURN","return",2160],["T_WHITESPACE"," ",2160],["T_VARIABLE","$this",2160],["T_OBJECT_OPERATOR","->",2160],["T_STRING","_priceStandardDeviation",2160],";",["T_WHITESPACE","\n    ",2160],"}",["T_WHITESPACE","\n\n\n    ",2161],["T_DOC_COMMENT","\/**\n     * Get count of product prices\n     *\n     * @return int\n     *\/",2164],["T_WHITESPACE","\n    ",2168],["T_PUBLIC","public",2169],["T_WHITESPACE"," ",2169],["T_FUNCTION","function",2169],["T_WHITESPACE"," ",2169],["T_STRING","getPricesCount",2169],"(",")",["T_WHITESPACE","\n    ",2169],"{",["T_WHITESPACE","\n        ",2170],["T_IF","if",2171],["T_WHITESPACE"," ",2171],"(",["T_STRING","is_null",2171],"(",["T_VARIABLE","$this",2171],["T_OBJECT_OPERATOR","->",2171],["T_STRING","_pricesCount",2171],")",")",["T_WHITESPACE"," ",2171],"{",["T_WHITESPACE","\n            ",2171],["T_VARIABLE","$this",2172],["T_OBJECT_OPERATOR","->",2172],["T_STRING","_prepareStatisticsData",2172],"(",")",";",["T_WHITESPACE","\n        ",2172],"}",["T_WHITESPACE","\n\n        ",2173],["T_RETURN","return",2175],["T_WHITESPACE"," ",2175],["T_VARIABLE","$this",2175],["T_OBJECT_OPERATOR","->",2175],["T_STRING","_pricesCount",2175],";",["T_WHITESPACE","\n    ",2175],"}",["T_WHITESPACE","\n",2176],"}",["T_WHITESPACE","\n",2177]]