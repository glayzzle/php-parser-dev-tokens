[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * API2 for product image. Admin role\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Api2_Product_Image_Rest_Admin_V1",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Api2_Product_Image_Rest",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Product image add\n     *\n     * @throws Mage_Api2_Exception\n     * @param array $data\n     * @return string\n     *\/",36],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","_create",43],"(",["T_ARRAY","array",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$data",43],")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_COMMENT","\/* @var $validator Mage_Catalog_Model_Api2_Product_Image_Validator_Image *\/",45],["T_WHITESPACE","\n        ",45],["T_VARIABLE","$validator",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","Mage",46],["T_DOUBLE_COLON","::",46],["T_STRING","getModel",46],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/api2_product_image_validator_image'",46],")",";",["T_WHITESPACE","\n        ",46],["T_IF","if",47],["T_WHITESPACE"," ",47],"(","!",["T_VARIABLE","$validator",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","isValidData",47],"(",["T_VARIABLE","$data",47],")",")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n            ",47],["T_FOREACH","foreach",48],["T_WHITESPACE"," ",48],"(",["T_VARIABLE","$validator",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getErrors",48],"(",")",["T_WHITESPACE"," ",48],["T_AS","as",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$error",48],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n                ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_error",49],"(",["T_VARIABLE","$error",49],",",["T_WHITESPACE"," ",49],["T_STRING","Mage_Api2_Model_Server",49],["T_DOUBLE_COLON","::",49],["T_STRING","HTTP_BAD_REQUEST",49],")",";",["T_WHITESPACE","\n            ",49],"}",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_critical",51],"(",["T_STRING","self",51],["T_DOUBLE_COLON","::",51],["T_STRING","RESOURCE_DATA_PRE_VALIDATION_ERROR",51],")",";",["T_WHITESPACE","\n        ",51],"}",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$imageFileContent",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],"@",["T_STRING","base64_decode",53],"(",["T_VARIABLE","$data",53],"[",["T_CONSTANT_ENCAPSED_STRING","'file_content'",53],"]",",",["T_WHITESPACE"," ",53],["T_STRING","true",53],")",";",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","!",["T_VARIABLE","$imageFileContent",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_critical",55],"(",["T_CONSTANT_ENCAPSED_STRING","'The image content must be valid base64 encoded data'",55],",",["T_WHITESPACE","\n                ",55],["T_STRING","Mage_Api2_Model_Server",56],["T_DOUBLE_COLON","::",56],["T_STRING","HTTP_BAD_REQUEST",56],")",";",["T_WHITESPACE","\n        ",56],"}",["T_WHITESPACE","\n        ",57],["T_UNSET","unset",58],"(",["T_VARIABLE","$data",58],"[",["T_CONSTANT_ENCAPSED_STRING","'file_content'",58],"]",")",";",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$apiTempDir",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","Mage",60],["T_DOUBLE_COLON","::",60],["T_STRING","getBaseDir",60],"(",["T_CONSTANT_ENCAPSED_STRING","'var'",60],")",["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_STRING","DS",60],["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'api'",60],["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_STRING","DS",60],["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_STRING","Mage",60],["T_DOUBLE_COLON","::",60],["T_STRING","getSingleton",60],"(",["T_CONSTANT_ENCAPSED_STRING","'api\/session'",60],")",["T_OBJECT_OPERATOR","->",60],["T_STRING","getSessionId",60],"(",")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$imageFileName",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_getFileName",61],"(",["T_VARIABLE","$data",61],")",";",["T_WHITESPACE","\n\n        ",61],["T_TRY","try",63],["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$ioAdapter",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_NEW","new",64],["T_WHITESPACE"," ",64],["T_STRING","Varien_Io_File",64],"(",")",";",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$ioAdapter",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","checkAndCreateFolder",65],"(",["T_VARIABLE","$apiTempDir",65],")",";",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$ioAdapter",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","open",66],"(",["T_ARRAY","array",66],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$apiTempDir",66],")",")",";",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$ioAdapter",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","write",67],"(",["T_VARIABLE","$imageFileName",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$imageFileContent",67],",",["T_WHITESPACE"," ",67],["T_LNUMBER","0666",67],")",";",["T_WHITESPACE","\n            ",67],["T_UNSET","unset",68],"(",["T_VARIABLE","$imageFileContent",68],")",";",["T_WHITESPACE","\n\n            ",68],["T_COMMENT","\/\/ try to create Image object to check if image data is valid\n",70],["T_WHITESPACE","            ",71],["T_TRY","try",71],["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n                ",71],["T_NEW","new",72],["T_WHITESPACE"," ",72],["T_STRING","Varien_Image",72],"(",["T_VARIABLE","$apiTempDir",72],["T_WHITESPACE"," ",72],".",["T_WHITESPACE"," ",72],["T_STRING","DS",72],["T_WHITESPACE"," ",72],".",["T_WHITESPACE"," ",72],["T_VARIABLE","$imageFileName",72],")",";",["T_WHITESPACE","\n            ",72],"}",["T_WHITESPACE"," ",73],["T_CATCH","catch",73],["T_WHITESPACE"," ",73],"(",["T_STRING","Exception",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$e",73],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n                ",73],["T_VARIABLE","$ioAdapter",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","rmdir",74],"(",["T_VARIABLE","$apiTempDir",74],",",["T_WHITESPACE"," ",74],["T_STRING","true",74],")",";",["T_WHITESPACE","\n                ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_critical",75],"(",["T_VARIABLE","$e",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getMessage",75],"(",")",",",["T_WHITESPACE"," ",75],["T_STRING","Mage_Api2_Model_Server",75],["T_DOUBLE_COLON","::",75],["T_STRING","HTTP_INTERNAL_ERROR",75],")",";",["T_WHITESPACE","\n            ",75],"}",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$product",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_getProduct",77],"(",")",";",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$imageFileUri",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getMediaGallery",78],"(",")",["T_WHITESPACE","\n                ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","addImage",79],"(",["T_VARIABLE","$product",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$apiTempDir",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_STRING","DS",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_VARIABLE","$imageFileName",79],",",["T_WHITESPACE"," ",79],["T_STRING","null",79],",",["T_WHITESPACE"," ",79],["T_STRING","false",79],",",["T_WHITESPACE"," ",79],["T_STRING","false",79],")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$ioAdapter",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","rmdir",80],"(",["T_VARIABLE","$apiTempDir",80],",",["T_WHITESPACE"," ",80],["T_STRING","true",80],")",";",["T_WHITESPACE","\n            ",80],["T_COMMENT","\/\/ updateImage() must be called to add image data that is missing after addImage() call\n",81],["T_WHITESPACE","            ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_getMediaGallery",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","updateImage",82],"(",["T_VARIABLE","$product",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$imageFileUri",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$data",82],")",";",["T_WHITESPACE","\n\n            ",82],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_ISSET","isset",84],"(",["T_VARIABLE","$data",84],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",84],"]",")",")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n                ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_getMediaGallery",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","setMediaAttribute",85],"(",["T_VARIABLE","$product",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$data",85],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",85],"]",",",["T_WHITESPACE"," ",85],["T_VARIABLE","$imageFileUri",85],")",";",["T_WHITESPACE","\n            ",85],"}",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$product",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","save",87],"(",")",";",["T_WHITESPACE","\n            ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_getImageLocation",88],"(",["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_getCreatedImageId",88],"(",["T_VARIABLE","$imageFileUri",88],")",")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE"," ",89],["T_CATCH","catch",89],["T_WHITESPACE"," ",89],"(",["T_STRING","Mage_Core_Exception",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$e",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_critical",90],"(",["T_VARIABLE","$e",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getMessage",90],"(",")",",",["T_WHITESPACE"," ",90],["T_STRING","Mage_Api2_Model_Server",90],["T_DOUBLE_COLON","::",90],["T_STRING","HTTP_INTERNAL_ERROR",90],")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE"," ",91],["T_CATCH","catch",91],["T_WHITESPACE"," ",91],"(",["T_STRING","Exception",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$e",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_critical",92],"(",["T_STRING","self",92],["T_DOUBLE_COLON","::",92],["T_STRING","RESOURCE_UNKNOWN_ERROR",92],")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Get added image ID\n     *\n     * @throws Mage_Api2_Exception\n     * @param string $imageFileUri\n     * @return int\n     *\/",96],["T_WHITESPACE","\n    ",102],["T_PROTECTED","protected",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","_getCreatedImageId",103],"(",["T_VARIABLE","$imageFileUri",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$imageId",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","null",105],";",["T_WHITESPACE","\n\n        ",105],["T_VARIABLE","$imageData",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_STRING","Mage",107],["T_DOUBLE_COLON","::",107],["T_STRING","getResourceModel",107],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_backend_media'",107],")",["T_WHITESPACE","\n            ",107],["T_OBJECT_OPERATOR","->",108],["T_STRING","loadGallery",108],"(",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_getProduct",108],"(",")",",",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_getMediaGallery",108],"(",")",")",";",["T_WHITESPACE","\n        ",108],["T_FOREACH","foreach",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$imageData",109],["T_WHITESPACE"," ",109],["T_AS","as",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$image",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$image",110],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",110],"]",["T_WHITESPACE"," ",110],["T_IS_EQUAL","==",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$imageFileUri",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                ",110],["T_VARIABLE","$imageId",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$image",111],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",111],"]",";",["T_WHITESPACE","\n                ",111],["T_BREAK","break",112],";",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n        ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(","!",["T_VARIABLE","$imageId",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_critical",116],"(",["T_CONSTANT_ENCAPSED_STRING","'Unknown error during image save'",116],",",["T_WHITESPACE"," ",116],["T_STRING","Mage_Api2_Model_Server",116],["T_DOUBLE_COLON","::",116],["T_STRING","HTTP_INTERNAL_ERROR",116],")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n        ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$imageId",118],";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Retrieve product images data\n     *\n     * @throws Mage_Api2_Exception\n     * @return array\n     *\/",121],["T_WHITESPACE","\n    ",126],["T_PROTECTED","protected",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","_retrieve",127],"(",")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$result",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_ARRAY","array",129],"(",")",";",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$imageId",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_INT_CAST","(int)",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getRequest",130],"(",")",["T_OBJECT_OPERATOR","->",130],["T_STRING","getParam",130],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",130],")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$galleryData",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_getProduct",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","getData",131],"(",["T_STRING","self",131],["T_DOUBLE_COLON","::",131],["T_STRING","GALLERY_ATTRIBUTE_CODE",131],")",";",["T_WHITESPACE","\n        ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(","!",["T_ISSET","isset",132],"(",["T_VARIABLE","$galleryData",132],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",132],"]",")",["T_WHITESPACE"," ",132],["T_BOOLEAN_OR","||",132],["T_WHITESPACE"," ",132],"!",["T_STRING","is_array",132],"(",["T_VARIABLE","$galleryData",132],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",132],"]",")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_critical",133],"(",["T_CONSTANT_ENCAPSED_STRING","'Product image not found'",133],",",["T_WHITESPACE"," ",133],["T_STRING","Mage_Api2_Model_Server",133],["T_DOUBLE_COLON","::",133],["T_STRING","HTTP_NOT_FOUND",133],")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n        ",134],["T_FOREACH","foreach",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$galleryData",135],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",135],"]",["T_WHITESPACE"," ",135],["T_AS","as",135],["T_WHITESPACE"," ",135],"&",["T_VARIABLE","$image",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$image",136],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",136],"]",["T_WHITESPACE"," ",136],["T_IS_EQUAL","==",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$imageId",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$result",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_formatImageData",137],"(",["T_VARIABLE","$image",137],")",";",["T_WHITESPACE","\n                ",137],["T_BREAK","break",138],";",["T_WHITESPACE","\n            ",138],"}",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n        ",140],["T_IF","if",141],["T_WHITESPACE"," ",141],"(",["T_EMPTY","empty",141],"(",["T_VARIABLE","$result",141],")",")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_critical",142],"(",["T_CONSTANT_ENCAPSED_STRING","'Product image not found'",142],",",["T_WHITESPACE"," ",142],["T_STRING","Mage_Api2_Model_Server",142],["T_DOUBLE_COLON","::",142],["T_STRING","HTTP_NOT_FOUND",142],")",";",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE","\n        ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$result",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Update product image\n     *\n     * @throws Mage_Api2_Exception\n     * @param array $data\n     * @return bool\n     *\/",147],["T_WHITESPACE","\n    ",153],["T_PROTECTED","protected",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","_update",154],"(",["T_ARRAY","array",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$data",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$imageId",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_INT_CAST","(int)",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getRequest",156],"(",")",["T_OBJECT_OPERATOR","->",156],["T_STRING","getParam",156],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",156],")",";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$imageFileUri",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_getImageFileById",157],"(",["T_VARIABLE","$imageId",157],")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$product",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getProduct",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_getMediaGallery",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","updateImage",159],"(",["T_VARIABLE","$product",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$imageFileUri",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$data",159],")",";",["T_WHITESPACE","\n        ",159],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_ISSET","isset",160],"(",["T_VARIABLE","$data",160],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",160],"]",")",["T_WHITESPACE"," ",160],["T_BOOLEAN_AND","&&",160],["T_WHITESPACE"," ",160],["T_STRING","is_array",160],"(",["T_VARIABLE","$data",160],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",160],"]",")",")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n            ",160],["T_VARIABLE","$assignedTypes",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_getImageTypesAssignedToProduct",161],"(",["T_VARIABLE","$imageFileUri",161],")",";",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$typesToBeCleared",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","array_diff",162],"(",["T_VARIABLE","$assignedTypes",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$data",162],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",162],"]",")",";",["T_WHITESPACE","\n            ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_STRING","count",163],"(",["T_VARIABLE","$typesToBeCleared",163],")",["T_WHITESPACE"," ",163],">",["T_WHITESPACE"," ",163],["T_LNUMBER","0",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_getMediaGallery",164],"(",")",["T_OBJECT_OPERATOR","->",164],["T_STRING","clearMediaAttribute",164],"(",["T_VARIABLE","$product",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$typesToBeCleared",164],")",";",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_getMediaGallery",166],"(",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","setMediaAttribute",166],"(",["T_VARIABLE","$product",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$data",166],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",166],"]",",",["T_WHITESPACE"," ",166],["T_VARIABLE","$imageFileUri",166],")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_TRY","try",168],["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$product",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","save",169],"(",")",";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE"," ",170],["T_CATCH","catch",170],["T_WHITESPACE"," ",170],"(",["T_STRING","Mage_Core_Exception",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$e",170],")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_critical",171],"(",["T_VARIABLE","$e",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getMessage",171],"(",")",",",["T_WHITESPACE"," ",171],["T_STRING","Mage_Api2_Model_Server",171],["T_DOUBLE_COLON","::",171],["T_STRING","HTTP_INTERNAL_ERROR",171],")",";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE"," ",172],["T_CATCH","catch",172],["T_WHITESPACE"," ",172],"(",["T_STRING","Exception",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$e",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_critical",173],"(",["T_STRING","self",173],["T_DOUBLE_COLON","::",173],["T_STRING","RESOURCE_INTERNAL_ERROR",173],")",";",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Product image delete\n     *\n     * @throws Mage_Api2_Exception\n     *\/",177],["T_WHITESPACE","\n    ",181],["T_PROTECTED","protected",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","_delete",182],"(",")",["T_WHITESPACE","\n    ",182],"{",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$imageId",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_INT_CAST","(int)",184],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getRequest",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","getParam",184],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",184],")",";",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$product",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_getProduct",185],"(",")",";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$imageFileUri",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_getImageFileById",186],"(",["T_VARIABLE","$imageId",186],")",";",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_getMediaGallery",187],"(",")",["T_OBJECT_OPERATOR","->",187],["T_STRING","removeImage",187],"(",["T_VARIABLE","$product",187],",",["T_WHITESPACE"," ",187],["T_VARIABLE","$imageFileUri",187],")",";",["T_WHITESPACE","\n        ",187],["T_TRY","try",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$product",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","save",189],"(",")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE"," ",190],["T_CATCH","catch",190],["T_WHITESPACE"," ",190],"(",["T_STRING","Mage_Core_Exception",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$e",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_critical",191],"(",["T_VARIABLE","$e",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getMessage",191],"(",")",",",["T_WHITESPACE"," ",191],["T_STRING","Mage_Api2_Model_Server",191],["T_DOUBLE_COLON","::",191],["T_STRING","HTTP_INTERNAL_ERROR",191],")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE"," ",192],["T_CATCH","catch",192],["T_WHITESPACE"," ",192],"(",["T_STRING","Exception",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$e",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_critical",193],"(",["T_STRING","self",193],["T_DOUBLE_COLON","::",193],["T_STRING","RESOURCE_INTERNAL_ERROR",193],")",";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Retrieve product images data\n     *\n     * @throws Mage_Api2_Exception\n     * @return array\n     *\/",197],["T_WHITESPACE","\n    ",202],["T_PROTECTED","protected",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","_retrieveCollection",203],"(",")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$images",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_ARRAY","array",205],"(",")",";",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$galleryData",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_getProduct",206],"(",")",["T_OBJECT_OPERATOR","->",206],["T_STRING","getData",206],"(",["T_STRING","self",206],["T_DOUBLE_COLON","::",206],["T_STRING","GALLERY_ATTRIBUTE_CODE",206],")",";",["T_WHITESPACE","\n        ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_ISSET","isset",207],"(",["T_VARIABLE","$galleryData",207],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",207],"]",")",["T_WHITESPACE"," ",207],["T_BOOLEAN_AND","&&",207],["T_WHITESPACE"," ",207],["T_STRING","is_array",207],"(",["T_VARIABLE","$galleryData",207],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",207],"]",")",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_FOREACH","foreach",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$galleryData",208],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",208],"]",["T_WHITESPACE"," ",208],["T_AS","as",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$image",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n                ",208],["T_VARIABLE","$images",209],"[","]",["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_formatImageData",209],"(",["T_VARIABLE","$image",209],")",";",["T_WHITESPACE","\n            ",209],"}",["T_WHITESPACE","\n        ",210],"}",["T_WHITESPACE","\n        ",211],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$images",212],";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * Get image resource location\n     *\n     * @param int $imageId\n     * @return string URL\n     *\/",215],["T_WHITESPACE","\n    ",220],["T_PROTECTED","protected",221],["T_WHITESPACE"," ",221],["T_FUNCTION","function",221],["T_WHITESPACE"," ",221],["T_STRING","_getImageLocation",221],"(",["T_VARIABLE","$imageId",221],")",["T_WHITESPACE","\n    ",221],"{",["T_WHITESPACE","\n        ",222],["T_COMMENT","\/* @var $apiTypeRoute Mage_Api2_Model_Route_ApiType *\/",223],["T_WHITESPACE","\n        ",223],["T_VARIABLE","$apiTypeRoute",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","Mage",224],["T_DOUBLE_COLON","::",224],["T_STRING","getModel",224],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/route_apiType'",224],")",";",["T_WHITESPACE","\n\n        ",224],["T_VARIABLE","$chain",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_VARIABLE","$apiTypeRoute",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","chain",226],"(",["T_WHITESPACE","\n            ",226],["T_NEW","new",227],["T_WHITESPACE"," ",227],["T_STRING","Zend_Controller_Router_Route",227],"(",["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getConfig",227],"(",")",["T_OBJECT_OPERATOR","->",227],["T_STRING","getRouteWithEntityTypeAction",227],"(",["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getResourceType",227],"(",")",")",")",["T_WHITESPACE","\n        ",227],")",";",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$params",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_ARRAY","array",229],"(",["T_WHITESPACE","\n            ",229],["T_CONSTANT_ENCAPSED_STRING","'api_type'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getRequest",230],"(",")",["T_OBJECT_OPERATOR","->",230],["T_STRING","getApiType",230],"(",")",",",["T_WHITESPACE","\n            ",230],["T_CONSTANT_ENCAPSED_STRING","'id'",231],["T_WHITESPACE","       ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getRequest",231],"(",")",["T_OBJECT_OPERATOR","->",231],["T_STRING","getParam",231],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",231],")",",",["T_WHITESPACE","\n            ",231],["T_CONSTANT_ENCAPSED_STRING","'image'",232],["T_WHITESPACE","    ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$imageId",232],["T_WHITESPACE","\n        ",232],")",";",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$uri",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$chain",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","assemble",234],"(",["T_VARIABLE","$params",234],")",";",["T_WHITESPACE","\n        ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","'\/'",235],["T_WHITESPACE"," ",235],".",["T_WHITESPACE"," ",235],["T_VARIABLE","$uri",235],";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n",236],"}",["T_WHITESPACE","\n",237]]