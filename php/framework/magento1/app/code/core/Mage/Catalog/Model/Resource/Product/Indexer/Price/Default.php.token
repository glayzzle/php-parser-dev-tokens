[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Default Product Type Price Indexer Resource model\n * For correctly work need define product type id\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",35],["T_CLASS","class",36],["T_WHITESPACE"," ",36],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Price_Default",36],["T_WHITESPACE","\n    ",36],["T_EXTENDS","extends",37],["T_WHITESPACE"," ",37],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Abstract",37],["T_WHITESPACE","\n    ",37],["T_IMPLEMENTS","implements",38],["T_WHITESPACE"," ",38],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Price_Interface",38],["T_WHITESPACE","\n",38],"{",["T_WHITESPACE","\n    ",39],["T_DOC_COMMENT","\/**\n     * Product type code\n     *\n     * @var string\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_typeId",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Product Type is composite flag\n     *\n     * @var bool\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_isComposite",52],["T_WHITESPACE","    ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","false",52],";",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Define main price index table\n     *\n     *\/",54],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","_construct",58],"(",")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_init",60],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_price'",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",60],")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Set Product Type code\n     *\n     * @param string $typeCode\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",63],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","setTypeId",69],"(",["T_VARIABLE","$typeCode",69],")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_typeId",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$typeCode",71],";",["T_WHITESPACE","\n        ",71],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],";",["T_WHITESPACE","\n    ",72],"}",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Retrieve Product Type Code\n     *\n     * @return string\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PUBLIC","public",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","getTypeId",80],"(",")",["T_WHITESPACE","\n    ",80],"{",["T_WHITESPACE","\n        ",81],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_STRING","is_null",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_typeId",82],")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_STRING","Mage",83],["T_DOUBLE_COLON","::",83],["T_STRING","throwException",83],"(",["T_STRING","Mage",83],["T_DOUBLE_COLON","::",83],["T_STRING","helper",83],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",83],")",["T_OBJECT_OPERATOR","->",83],["T_STRING","__",83],"(",["T_CONSTANT_ENCAPSED_STRING","'A product type is not defined for the indexer.'",83],")",")",";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n        ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_typeId",85],";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Set Product Type Composite flag\n     *\n     * @param bool $flag\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",88],["T_WHITESPACE","\n    ",93],["T_PUBLIC","public",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","setIsComposite",94],"(",["T_VARIABLE","$flag",94],")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_isComposite",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_BOOL_CAST","(bool)",96],["T_VARIABLE","$flag",96],";",["T_WHITESPACE","\n        ",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Check product type is composite\n     *\n     * @return bool\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","getIsComposite",105],"(",")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_isComposite",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for all products\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",110],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","reindexAll",115],"(",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","useIdxTable",117],"(",["T_STRING","true",117],")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","beginTransaction",118],"(",")",";",["T_WHITESPACE","\n        ",118],["T_TRY","try",119],["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_prepareFinalPriceData",120],"(",")",";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_applyCustomOption",121],"(",")",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_movePriceDataToIndexTable",122],"(",")",";",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","commit",123],"(",")",";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE"," ",124],["T_CATCH","catch",124],["T_WHITESPACE"," ",124],"(",["T_STRING","Exception",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$e",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","rollBack",125],"(",")",";",["T_WHITESPACE","\n            ",125],["T_THROW","throw",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$e",126],";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n        ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for defined product(s)\n     *\n     * @param int|array $entityIds\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",131],["T_WHITESPACE","\n    ",136],["T_PUBLIC","public",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","reindexEntity",137],"(",["T_VARIABLE","$entityIds",137],")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","useDisableKeys",139],"(",["T_STRING","false",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_prepareFinalPriceData",140],"(",["T_VARIABLE","$entityIds",140],")",";",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_applyCustomOption",141],"(",")",";",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_movePriceDataToIndexTable",142],"(",")",";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","useDisableKeys",143],"(",["T_STRING","true",143],")",";",["T_WHITESPACE","\n\n        ",143],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Retrieve final price temporary index table name\n     *\n     * @see _prepareDefaultFinalPriceTable()\n     *\n     * @return string\n     *\/",148],["T_WHITESPACE","\n    ",154],["T_PROTECTED","protected",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","_getDefaultFinalPriceTable",155],"(",")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","useIdxTable",157],"(",")",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getTable",158],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_final_idx'",158],")",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n        ",159],["T_RETURN","return",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getTable",160],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_final_tmp'",160],")",";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Prepare final price temporary index table\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",163],["T_WHITESPACE","\n    ",167],["T_PROTECTED","protected",168],["T_WHITESPACE"," ",168],["T_FUNCTION","function",168],["T_WHITESPACE"," ",168],["T_STRING","_prepareDefaultFinalPriceTable",168],"(",")",["T_WHITESPACE","\n    ",168],"{",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_getWriteAdapter",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","delete",170],"(",["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_getDefaultFinalPriceTable",170],"(",")",")",";",["T_WHITESPACE","\n        ",170],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],";",["T_WHITESPACE","\n    ",171],"}",["T_WHITESPACE","\n\n    ",172],["T_DOC_COMMENT","\/**\n     * Retrieve website current dates table name\n     *\n     * @return string\n     *\/",174],["T_WHITESPACE","\n    ",178],["T_PROTECTED","protected",179],["T_WHITESPACE"," ",179],["T_FUNCTION","function",179],["T_WHITESPACE"," ",179],["T_STRING","_getWebsiteDateTable",179],"(",")",["T_WHITESPACE","\n    ",179],"{",["T_WHITESPACE","\n        ",180],["T_RETURN","return",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getTable",181],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_website'",181],")",";",["T_WHITESPACE","\n    ",181],"}",["T_WHITESPACE","\n\n    ",182],["T_DOC_COMMENT","\/**\n     * Prepare products default final price in temporary index table\n     *\n     * @param int|array $entityIds  the entity ids limitation\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",184],["T_WHITESPACE","\n    ",189],["T_PROTECTED","protected",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","_prepareFinalPriceData",190],"(",["T_VARIABLE","$entityIds",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_STRING","null",190],")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_prepareDefaultFinalPriceTable",192],"(",")",";",["T_WHITESPACE","\n\n        ",192],["T_VARIABLE","$write",194],["T_WHITESPACE","  ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_getWriteAdapter",194],"(",")",";",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$select",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$write",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","select",195],"(",")",["T_WHITESPACE","\n            ",195],["T_OBJECT_OPERATOR","->",196],["T_STRING","from",196],"(",["T_ARRAY","array",196],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",196],["T_WHITESPACE"," ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getTable",196],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",196],")",")",",",["T_WHITESPACE"," ",196],["T_ARRAY","array",196],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",196],")",")",["T_WHITESPACE","\n            ",196],["T_OBJECT_OPERATOR","->",197],["T_STRING","join",197],"(",["T_WHITESPACE","\n                ",197],["T_ARRAY","array",198],"(",["T_CONSTANT_ENCAPSED_STRING","'cg'",198],["T_WHITESPACE"," ",198],["T_DOUBLE_ARROW","=>",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getTable",198],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",198],")",")",",",["T_WHITESPACE","\n                ",198],["T_CONSTANT_ENCAPSED_STRING","''",199],",",["T_WHITESPACE","\n                ",199],["T_ARRAY","array",200],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",200],")",")",["T_WHITESPACE","\n            ",200],["T_OBJECT_OPERATOR","->",201],["T_STRING","join",201],"(",["T_WHITESPACE","\n                ",201],["T_ARRAY","array",202],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",202],["T_WHITESPACE"," ",202],["T_DOUBLE_ARROW","=>",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getTable",202],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",202],")",")",",",["T_WHITESPACE","\n                ",202],["T_CONSTANT_ENCAPSED_STRING","''",203],",",["T_WHITESPACE","\n                ",203],["T_ARRAY","array",204],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",204],")",")",["T_WHITESPACE","\n            ",204],["T_OBJECT_OPERATOR","->",205],["T_STRING","join",205],"(",["T_WHITESPACE","\n                ",205],["T_ARRAY","array",206],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd'",206],["T_WHITESPACE"," ",206],["T_DOUBLE_ARROW","=>",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_getWebsiteDateTable",206],"(",")",")",",",["T_WHITESPACE","\n                ",206],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = cwd.website_id'",207],",",["T_WHITESPACE","\n                ",207],["T_ARRAY","array",208],"(",")",")",["T_WHITESPACE","\n            ",208],["T_OBJECT_OPERATOR","->",209],["T_STRING","join",209],"(",["T_WHITESPACE","\n                ",209],["T_ARRAY","array",210],"(",["T_CONSTANT_ENCAPSED_STRING","'csg'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getTable",210],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",210],")",")",",",["T_WHITESPACE","\n                ",210],["T_CONSTANT_ENCAPSED_STRING","'csg.website_id = cw.website_id AND cw.default_group_id = csg.group_id'",211],",",["T_WHITESPACE","\n                ",211],["T_ARRAY","array",212],"(",")",")",["T_WHITESPACE","\n            ",212],["T_OBJECT_OPERATOR","->",213],["T_STRING","join",213],"(",["T_WHITESPACE","\n                ",213],["T_ARRAY","array",214],"(",["T_CONSTANT_ENCAPSED_STRING","'cs'",214],["T_WHITESPACE"," ",214],["T_DOUBLE_ARROW","=>",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getTable",214],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",214],")",")",",",["T_WHITESPACE","\n                ",214],["T_CONSTANT_ENCAPSED_STRING","'csg.default_store_id = cs.store_id AND cs.store_id != 0'",215],",",["T_WHITESPACE","\n                ",215],["T_ARRAY","array",216],"(",")",")",["T_WHITESPACE","\n            ",216],["T_OBJECT_OPERATOR","->",217],["T_STRING","join",217],"(",["T_WHITESPACE","\n                ",217],["T_ARRAY","array",218],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getTable",218],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",218],")",")",",",["T_WHITESPACE","\n                ",218],["T_CONSTANT_ENCAPSED_STRING","'pw.product_id = e.entity_id AND pw.website_id = cw.website_id'",219],",",["T_WHITESPACE","\n                ",219],["T_ARRAY","array",220],"(",")",")",["T_WHITESPACE","\n            ",220],["T_OBJECT_OPERATOR","->",221],["T_STRING","joinLeft",221],"(",["T_WHITESPACE","\n                ",221],["T_ARRAY","array",222],"(",["T_CONSTANT_ENCAPSED_STRING","'tp'",222],["T_WHITESPACE"," ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_getTierPriceIndexTable",222],"(",")",")",",",["T_WHITESPACE","\n                ",222],["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id = e.entity_id AND tp.website_id = cw.website_id'",223],["T_WHITESPACE","\n                    ",223],".",["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","' AND tp.customer_group_id = cg.customer_group_id'",224],",",["T_WHITESPACE","\n                ",224],["T_ARRAY","array",225],"(",")",")",["T_WHITESPACE","\n            ",225],["T_OBJECT_OPERATOR","->",226],["T_STRING","joinLeft",226],"(",["T_WHITESPACE","\n                ",226],["T_ARRAY","array",227],"(",["T_CONSTANT_ENCAPSED_STRING","'gp'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_getGroupPriceIndexTable",227],"(",")",")",",",["T_WHITESPACE","\n                ",227],["T_CONSTANT_ENCAPSED_STRING","'gp.entity_id = e.entity_id AND gp.website_id = cw.website_id'",228],["T_WHITESPACE","\n                    ",228],".",["T_WHITESPACE"," ",229],["T_CONSTANT_ENCAPSED_STRING","' AND gp.customer_group_id = cg.customer_group_id'",229],",",["T_WHITESPACE","\n                ",229],["T_ARRAY","array",230],"(",")",")",["T_WHITESPACE","\n            ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","where",231],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id = ?'",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getTypeId",231],"(",")",")",";",["T_WHITESPACE","\n\n        ",231],["T_COMMENT","\/\/ add enable products limitation\n",233],["T_WHITESPACE","        ",234],["T_VARIABLE","$statusCond",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$write",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","quoteInto",234],"(",["T_CONSTANT_ENCAPSED_STRING","'=?'",234],",",["T_WHITESPACE"," ",234],["T_STRING","Mage_Catalog_Model_Product_Status",234],["T_DOUBLE_COLON","::",234],["T_STRING","STATUS_ENABLED",234],")",";",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_addAttributeToSelect",235],"(",["T_VARIABLE","$select",235],",",["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","'status'",235],",",["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",235],",",["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$statusCond",235],",",["T_WHITESPACE"," ",235],["T_STRING","true",235],")",";",["T_WHITESPACE","\n        ",235],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_STRING","Mage",236],["T_DOUBLE_COLON","::",236],["T_STRING","helper",236],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",236],")",["T_OBJECT_OPERATOR","->",236],["T_STRING","isModuleEnabled",236],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Tax'",236],")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$taxClassId",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_addAttributeToSelect",237],"(",["T_VARIABLE","$select",237],",",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",237],",",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",237],",",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",237],")",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE"," ",238],["T_ELSE","else",238],["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$taxClassId",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_NEW","new",239],["T_WHITESPACE"," ",239],["T_STRING","Zend_Db_Expr",239],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",239],")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$select",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","columns",241],"(",["T_ARRAY","array",241],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",241],["T_WHITESPACE"," ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$taxClassId",241],")",")",";",["T_WHITESPACE","\n\n        ",241],["T_VARIABLE","$price",243],["T_WHITESPACE","          ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_addAttributeToSelect",243],"(",["T_VARIABLE","$select",243],",",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'price'",243],",",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",243],",",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",243],")",";",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$specialPrice",244],["T_WHITESPACE","   ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_addAttributeToSelect",244],"(",["T_VARIABLE","$select",244],",",["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'special_price'",244],",",["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",244],",",["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",244],")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$specialFrom",245],["T_WHITESPACE","    ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","_addAttributeToSelect",245],"(",["T_VARIABLE","$select",245],",",["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",245],",",["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",245],",",["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",245],")",";",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$specialTo",246],["T_WHITESPACE","      ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_addAttributeToSelect",246],"(",["T_VARIABLE","$select",246],",",["T_WHITESPACE"," ",246],["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",246],",",["T_WHITESPACE"," ",246],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",246],",",["T_WHITESPACE"," ",246],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",246],")",";",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$currentDate",247],["T_WHITESPACE","    ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$write",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getDatePartSql",247],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd.website_date'",247],")",";",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$groupPrice",248],["T_WHITESPACE","     ",248],"=",["T_WHITESPACE"," ",248],["T_VARIABLE","$write",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getCheckSql",248],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.price IS NULL'",248],",",["T_WHITESPACE"," ",248],"\"",["T_CURLY_OPEN","{",248],["T_VARIABLE","$price",248],"}","\"",",",["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'gp.price'",248],")",";",["T_WHITESPACE","\n\n        ",248],["T_VARIABLE","$specialFromDate",250],["T_WHITESPACE","    ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$write",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getDatePartSql",250],"(",["T_VARIABLE","$specialFrom",250],")",";",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$specialToDate",251],["T_WHITESPACE","      ",251],"=",["T_WHITESPACE"," ",251],["T_VARIABLE","$write",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getDatePartSql",251],"(",["T_VARIABLE","$specialTo",251],")",";",["T_WHITESPACE","\n\n        ",251],["T_VARIABLE","$specialFromUse",253],["T_WHITESPACE","     ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$write",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getCheckSql",253],"(","\"",["T_CURLY_OPEN","{",253],["T_VARIABLE","$specialFromDate",253],"}",["T_ENCAPSED_AND_WHITESPACE"," <= ",253],["T_CURLY_OPEN","{",253],["T_VARIABLE","$currentDate",253],"}","\"",",",["T_WHITESPACE"," ",253],["T_CONSTANT_ENCAPSED_STRING","'1'",253],",",["T_WHITESPACE"," ",253],["T_CONSTANT_ENCAPSED_STRING","'0'",253],")",";",["T_WHITESPACE","\n        ",253],["T_VARIABLE","$specialToUse",254],["T_WHITESPACE","       ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$write",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getCheckSql",254],"(","\"",["T_CURLY_OPEN","{",254],["T_VARIABLE","$specialToDate",254],"}",["T_ENCAPSED_AND_WHITESPACE"," >= ",254],["T_CURLY_OPEN","{",254],["T_VARIABLE","$currentDate",254],"}","\"",",",["T_WHITESPACE"," ",254],["T_CONSTANT_ENCAPSED_STRING","'1'",254],",",["T_WHITESPACE"," ",254],["T_CONSTANT_ENCAPSED_STRING","'0'",254],")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$specialFromHas",255],["T_WHITESPACE","     ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$write",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getCheckSql",255],"(","\"",["T_CURLY_OPEN","{",255],["T_VARIABLE","$specialFrom",255],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NULL",255],"\"",",",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'1'",255],",",["T_WHITESPACE"," ",255],"\"",["T_CURLY_OPEN","{",255],["T_VARIABLE","$specialFromUse",255],"}","\"",")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$specialToHas",256],["T_WHITESPACE","       ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$write",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getCheckSql",256],"(","\"",["T_CURLY_OPEN","{",256],["T_VARIABLE","$specialTo",256],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NULL",256],"\"",",",["T_WHITESPACE"," ",256],["T_CONSTANT_ENCAPSED_STRING","'1'",256],",",["T_WHITESPACE"," ",256],"\"",["T_CURLY_OPEN","{",256],["T_VARIABLE","$specialToUse",256],"}","\"",")",";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$finalPrice",257],["T_WHITESPACE","         ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$write",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getCheckSql",257],"(","\"",["T_CURLY_OPEN","{",257],["T_VARIABLE","$specialFromHas",257],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND ",257],["T_CURLY_OPEN","{",257],["T_VARIABLE","$specialToHas",257],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0",257],"\"",["T_WHITESPACE","\n            ",257],".",["T_WHITESPACE"," ",258],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",258],["T_CURLY_OPEN","{",258],["T_VARIABLE","$specialPrice",258],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",258],["T_CURLY_OPEN","{",258],["T_VARIABLE","$price",258],"}","\"",",",["T_WHITESPACE"," ",258],["T_VARIABLE","$specialPrice",258],",",["T_WHITESPACE"," ",258],["T_VARIABLE","$price",258],")",";",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$finalPrice",259],["T_WHITESPACE","         ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$write",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getCheckSql",259],"(","\"",["T_CURLY_OPEN","{",259],["T_VARIABLE","$groupPrice",259],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",259],["T_CURLY_OPEN","{",259],["T_VARIABLE","$finalPrice",259],"}","\"",",",["T_WHITESPACE"," ",259],["T_VARIABLE","$groupPrice",259],",",["T_WHITESPACE"," ",259],["T_VARIABLE","$finalPrice",259],")",";",["T_WHITESPACE","\n\n        ",259],["T_VARIABLE","$select",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","columns",261],"(",["T_ARRAY","array",261],"(",["T_WHITESPACE","\n            ",261],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",262],["T_WHITESPACE","       ",262],["T_DOUBLE_ARROW","=>",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$price",262],",",["T_WHITESPACE","\n            ",262],["T_CONSTANT_ENCAPSED_STRING","'price'",263],["T_WHITESPACE","            ",263],["T_DOUBLE_ARROW","=>",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$finalPrice",263],",",["T_WHITESPACE","\n            ",263],["T_CONSTANT_ENCAPSED_STRING","'min_price'",264],["T_WHITESPACE","        ",264],["T_DOUBLE_ARROW","=>",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$finalPrice",264],",",["T_WHITESPACE","\n            ",264],["T_CONSTANT_ENCAPSED_STRING","'max_price'",265],["T_WHITESPACE","        ",265],["T_DOUBLE_ARROW","=>",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$finalPrice",265],",",["T_WHITESPACE","\n            ",265],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",266],["T_WHITESPACE","       ",266],["T_DOUBLE_ARROW","=>",266],["T_WHITESPACE"," ",266],["T_NEW","new",266],["T_WHITESPACE"," ",266],["T_STRING","Zend_Db_Expr",266],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.min_price'",266],")",",",["T_WHITESPACE","\n            ",266],["T_CONSTANT_ENCAPSED_STRING","'base_tier'",267],["T_WHITESPACE","        ",267],["T_DOUBLE_ARROW","=>",267],["T_WHITESPACE"," ",267],["T_NEW","new",267],["T_WHITESPACE"," ",267],["T_STRING","Zend_Db_Expr",267],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.min_price'",267],")",",",["T_WHITESPACE","\n            ",267],["T_CONSTANT_ENCAPSED_STRING","'group_price'",268],["T_WHITESPACE","      ",268],["T_DOUBLE_ARROW","=>",268],["T_WHITESPACE"," ",268],["T_NEW","new",268],["T_WHITESPACE"," ",268],["T_STRING","Zend_Db_Expr",268],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.price'",268],")",",",["T_WHITESPACE","\n            ",268],["T_CONSTANT_ENCAPSED_STRING","'base_group_price'",269],["T_WHITESPACE"," ",269],["T_DOUBLE_ARROW","=>",269],["T_WHITESPACE"," ",269],["T_NEW","new",269],["T_WHITESPACE"," ",269],["T_STRING","Zend_Db_Expr",269],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.price'",269],")",",",["T_WHITESPACE","\n        ",269],")",")",";",["T_WHITESPACE","\n\n        ",270],["T_IF","if",272],["T_WHITESPACE"," ",272],"(","!",["T_STRING","is_null",272],"(",["T_VARIABLE","$entityIds",272],")",")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$select",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","where",273],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$entityIds",273],")",";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE","\n\n        ",274],["T_DOC_COMMENT","\/**\n         * Add additional external limitation\n         *\/",276],["T_WHITESPACE","\n        ",278],["T_STRING","Mage",279],["T_DOUBLE_COLON","::",279],["T_STRING","dispatchEvent",279],"(",["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_index_select'",279],",",["T_WHITESPACE"," ",279],["T_ARRAY","array",279],"(",["T_WHITESPACE","\n            ",279],["T_CONSTANT_ENCAPSED_STRING","'select'",280],["T_WHITESPACE","        ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$select",280],",",["T_WHITESPACE","\n            ",280],["T_CONSTANT_ENCAPSED_STRING","'entity_field'",281],["T_WHITESPACE","  ",281],["T_DOUBLE_ARROW","=>",281],["T_WHITESPACE"," ",281],["T_NEW","new",281],["T_WHITESPACE"," ",281],["T_STRING","Zend_Db_Expr",281],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",281],")",",",["T_WHITESPACE","\n            ",281],["T_CONSTANT_ENCAPSED_STRING","'website_field'",282],["T_WHITESPACE"," ",282],["T_DOUBLE_ARROW","=>",282],["T_WHITESPACE"," ",282],["T_NEW","new",282],["T_WHITESPACE"," ",282],["T_STRING","Zend_Db_Expr",282],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",282],")",",",["T_WHITESPACE","\n            ",282],["T_CONSTANT_ENCAPSED_STRING","'store_field'",283],["T_WHITESPACE","   ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_NEW","new",283],["T_WHITESPACE"," ",283],["T_STRING","Zend_Db_Expr",283],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",283],")",["T_WHITESPACE","\n        ",283],")",")",";",["T_WHITESPACE","\n\n        ",284],["T_VARIABLE","$query",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$select",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","insertFromSelect",286],"(",["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_getDefaultFinalPriceTable",286],"(",")",",",["T_WHITESPACE"," ",286],["T_ARRAY","array",286],"(",")",",",["T_WHITESPACE"," ",286],["T_STRING","false",286],")",";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$write",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","query",287],"(",["T_VARIABLE","$query",287],")",";",["T_WHITESPACE","\n\n        ",287],["T_DOC_COMMENT","\/**\n         * Add possibility modify prices from external events\n         *\/",289],["T_WHITESPACE","\n        ",291],["T_VARIABLE","$select",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$write",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","select",292],"(",")",["T_WHITESPACE","\n            ",292],["T_OBJECT_OPERATOR","->",293],["T_STRING","join",293],"(",["T_ARRAY","array",293],"(",["T_CONSTANT_ENCAPSED_STRING","'wd'",293],["T_WHITESPACE"," ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_getWebsiteDateTable",293],"(",")",")",",",["T_WHITESPACE","\n                ",293],["T_CONSTANT_ENCAPSED_STRING","'i.website_id = wd.website_id'",294],",",["T_WHITESPACE","\n                ",294],["T_ARRAY","array",295],"(",")",")",";",["T_WHITESPACE","\n        ",295],["T_STRING","Mage",296],["T_DOUBLE_COLON","::",296],["T_STRING","dispatchEvent",296],"(",["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_price_index_table'",296],",",["T_WHITESPACE"," ",296],["T_ARRAY","array",296],"(",["T_WHITESPACE","\n            ",296],["T_CONSTANT_ENCAPSED_STRING","'index_table'",297],["T_WHITESPACE","       ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_ARRAY","array",297],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",297],["T_WHITESPACE"," ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_getDefaultFinalPriceTable",297],"(",")",")",",",["T_WHITESPACE","\n            ",297],["T_CONSTANT_ENCAPSED_STRING","'select'",298],["T_WHITESPACE","            ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$select",298],",",["T_WHITESPACE","\n            ",298],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",299],["T_WHITESPACE","         ",299],["T_DOUBLE_ARROW","=>",299],["T_WHITESPACE"," ",299],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id'",299],",",["T_WHITESPACE","\n            ",299],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",300],["T_WHITESPACE"," ",300],["T_DOUBLE_ARROW","=>",300],["T_WHITESPACE"," ",300],["T_CONSTANT_ENCAPSED_STRING","'i.customer_group_id'",300],",",["T_WHITESPACE","\n            ",300],["T_CONSTANT_ENCAPSED_STRING","'website_id'",301],["T_WHITESPACE","        ",301],["T_DOUBLE_ARROW","=>",301],["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","'i.website_id'",301],",",["T_WHITESPACE","\n            ",301],["T_CONSTANT_ENCAPSED_STRING","'website_date'",302],["T_WHITESPACE","      ",302],["T_DOUBLE_ARROW","=>",302],["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","'wd.website_date'",302],",",["T_WHITESPACE","\n            ",302],["T_CONSTANT_ENCAPSED_STRING","'update_fields'",303],["T_WHITESPACE","     ",303],["T_DOUBLE_ARROW","=>",303],["T_WHITESPACE"," ",303],["T_ARRAY","array",303],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",303],",",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'min_price'",303],",",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'max_price'",303],")",["T_WHITESPACE","\n        ",303],")",")",";",["T_WHITESPACE","\n\n        ",304],["T_RETURN","return",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],";",["T_WHITESPACE","\n    ",306],"}",["T_WHITESPACE","\n\n    ",307],["T_DOC_COMMENT","\/**\n     * Retrieve table name for custom option temporary aggregation data\n     *\n     * @return string\n     *\/",309],["T_WHITESPACE","\n    ",313],["T_PROTECTED","protected",314],["T_WHITESPACE"," ",314],["T_FUNCTION","function",314],["T_WHITESPACE"," ",314],["T_STRING","_getCustomOptionAggregateTable",314],"(",")",["T_WHITESPACE","\n    ",314],"{",["T_WHITESPACE","\n        ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","useIdxTable",316],"(",")",")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_RETURN","return",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getTable",317],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_option_aggregate_idx'",317],")",";",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE","\n        ",318],["T_RETURN","return",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getTable",319],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_option_aggregate_tmp'",319],")",";",["T_WHITESPACE","\n    ",319],"}",["T_WHITESPACE","\n\n    ",320],["T_DOC_COMMENT","\/**\n     * Retrieve table name for custom option prices data\n     *\n     * @return string\n     *\/",322],["T_WHITESPACE","\n    ",326],["T_PROTECTED","protected",327],["T_WHITESPACE"," ",327],["T_FUNCTION","function",327],["T_WHITESPACE"," ",327],["T_STRING","_getCustomOptionPriceTable",327],"(",")",["T_WHITESPACE","\n    ",327],"{",["T_WHITESPACE","\n        ",328],["T_IF","if",329],["T_WHITESPACE"," ",329],"(",["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","useIdxTable",329],"(",")",")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getTable",330],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_option_idx'",330],")",";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n        ",331],["T_RETURN","return",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getTable",332],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_option_tmp'",332],")",";",["T_WHITESPACE","\n    ",332],"}",["T_WHITESPACE","\n\n    ",333],["T_DOC_COMMENT","\/**\n     * Prepare table structure for custom option temporary aggregation data\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",335],["T_WHITESPACE","\n    ",339],["T_PROTECTED","protected",340],["T_WHITESPACE"," ",340],["T_FUNCTION","function",340],["T_WHITESPACE"," ",340],["T_STRING","_prepareCustomOptionAggregateTable",340],"(",")",["T_WHITESPACE","\n    ",340],"{",["T_WHITESPACE","\n        ",341],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","_getWriteAdapter",342],"(",")",["T_OBJECT_OPERATOR","->",342],["T_STRING","delete",342],"(",["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","_getCustomOptionAggregateTable",342],"(",")",")",";",["T_WHITESPACE","\n        ",342],["T_RETURN","return",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$this",343],";",["T_WHITESPACE","\n    ",343],"}",["T_WHITESPACE","\n\n    ",344],["T_DOC_COMMENT","\/**\n     * Prepare table structure for custom option prices data\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",346],["T_WHITESPACE","\n    ",350],["T_PROTECTED","protected",351],["T_WHITESPACE"," ",351],["T_FUNCTION","function",351],["T_WHITESPACE"," ",351],["T_STRING","_prepareCustomOptionPriceTable",351],"(",")",["T_WHITESPACE","\n    ",351],"{",["T_WHITESPACE","\n        ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_getWriteAdapter",353],"(",")",["T_OBJECT_OPERATOR","->",353],["T_STRING","delete",353],"(",["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_getCustomOptionPriceTable",353],"(",")",")",";",["T_WHITESPACE","\n        ",353],["T_RETURN","return",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$this",354],";",["T_WHITESPACE","\n    ",354],"}",["T_WHITESPACE","\n\n    ",355],["T_DOC_COMMENT","\/**\n     * Apply custom option minimal and maximal price to temporary final price index table\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",357],["T_WHITESPACE","\n    ",361],["T_PROTECTED","protected",362],["T_WHITESPACE"," ",362],["T_FUNCTION","function",362],["T_WHITESPACE"," ",362],["T_STRING","_applyCustomOption",362],"(",")",["T_WHITESPACE","\n    ",362],"{",["T_WHITESPACE","\n        ",363],["T_VARIABLE","$write",364],["T_WHITESPACE","      ",364],"=",["T_WHITESPACE"," ",364],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_getWriteAdapter",364],"(",")",";",["T_WHITESPACE","\n        ",364],["T_VARIABLE","$coaTable",365],["T_WHITESPACE","   ",365],"=",["T_WHITESPACE"," ",365],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_getCustomOptionAggregateTable",365],"(",")",";",["T_WHITESPACE","\n        ",365],["T_VARIABLE","$copTable",366],["T_WHITESPACE","   ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","_getCustomOptionPriceTable",366],"(",")",";",["T_WHITESPACE","\n\n        ",366],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_prepareCustomOptionAggregateTable",368],"(",")",";",["T_WHITESPACE","\n        ",368],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_prepareCustomOptionPriceTable",369],"(",")",";",["T_WHITESPACE","\n\n        ",369],["T_VARIABLE","$select",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_VARIABLE","$write",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","select",371],"(",")",["T_WHITESPACE","\n            ",371],["T_OBJECT_OPERATOR","->",372],["T_STRING","from",372],"(",["T_WHITESPACE","\n                ",372],["T_ARRAY","array",373],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",373],["T_WHITESPACE"," ",373],["T_DOUBLE_ARROW","=>",373],["T_WHITESPACE"," ",373],["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","_getDefaultFinalPriceTable",373],"(",")",")",",",["T_WHITESPACE","\n                ",373],["T_ARRAY","array",374],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",374],",",["T_WHITESPACE"," ",374],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",374],",",["T_WHITESPACE"," ",374],["T_CONSTANT_ENCAPSED_STRING","'website_id'",374],")",")",["T_WHITESPACE","\n            ",374],["T_OBJECT_OPERATOR","->",375],["T_STRING","join",375],"(",["T_WHITESPACE","\n                ",375],["T_ARRAY","array",376],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",376],["T_WHITESPACE"," ",376],["T_DOUBLE_ARROW","=>",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getTable",376],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",376],")",")",",",["T_WHITESPACE","\n                ",376],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = i.website_id'",377],",",["T_WHITESPACE","\n                ",377],["T_ARRAY","array",378],"(",")",")",["T_WHITESPACE","\n            ",378],["T_OBJECT_OPERATOR","->",379],["T_STRING","join",379],"(",["T_WHITESPACE","\n                ",379],["T_ARRAY","array",380],"(",["T_CONSTANT_ENCAPSED_STRING","'csg'",380],["T_WHITESPACE"," ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getTable",380],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",380],")",")",",",["T_WHITESPACE","\n                ",380],["T_CONSTANT_ENCAPSED_STRING","'csg.group_id = cw.default_group_id'",381],",",["T_WHITESPACE","\n                ",381],["T_ARRAY","array",382],"(",")",")",["T_WHITESPACE","\n            ",382],["T_OBJECT_OPERATOR","->",383],["T_STRING","join",383],"(",["T_WHITESPACE","\n                ",383],["T_ARRAY","array",384],"(",["T_CONSTANT_ENCAPSED_STRING","'cs'",384],["T_WHITESPACE"," ",384],["T_DOUBLE_ARROW","=>",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getTable",384],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",384],")",")",",",["T_WHITESPACE","\n                ",384],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id = csg.default_store_id'",385],",",["T_WHITESPACE","\n                ",385],["T_ARRAY","array",386],"(",")",")",["T_WHITESPACE","\n            ",386],["T_OBJECT_OPERATOR","->",387],["T_STRING","join",387],"(",["T_WHITESPACE","\n                ",387],["T_ARRAY","array",388],"(",["T_CONSTANT_ENCAPSED_STRING","'o'",388],["T_WHITESPACE"," ",388],["T_DOUBLE_ARROW","=>",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","getTable",388],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",388],")",")",",",["T_WHITESPACE","\n                ",388],["T_CONSTANT_ENCAPSED_STRING","'o.product_id = i.entity_id'",389],",",["T_WHITESPACE","\n                ",389],["T_ARRAY","array",390],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",390],")",")",["T_WHITESPACE","\n            ",390],["T_OBJECT_OPERATOR","->",391],["T_STRING","join",391],"(",["T_WHITESPACE","\n                ",391],["T_ARRAY","array",392],"(",["T_CONSTANT_ENCAPSED_STRING","'ot'",392],["T_WHITESPACE"," ",392],["T_DOUBLE_ARROW","=>",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","getTable",392],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_value'",392],")",")",",",["T_WHITESPACE","\n                ",392],["T_CONSTANT_ENCAPSED_STRING","'ot.option_id = o.option_id'",393],",",["T_WHITESPACE","\n                ",393],["T_ARRAY","array",394],"(",")",")",["T_WHITESPACE","\n            ",394],["T_OBJECT_OPERATOR","->",395],["T_STRING","join",395],"(",["T_WHITESPACE","\n                ",395],["T_ARRAY","array",396],"(",["T_CONSTANT_ENCAPSED_STRING","'otpd'",396],["T_WHITESPACE"," ",396],["T_DOUBLE_ARROW","=>",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getTable",396],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_price'",396],")",")",",",["T_WHITESPACE","\n                ",396],["T_CONSTANT_ENCAPSED_STRING","'otpd.option_type_id = ot.option_type_id AND otpd.store_id = 0'",397],",",["T_WHITESPACE","\n                ",397],["T_ARRAY","array",398],"(",")",")",["T_WHITESPACE","\n            ",398],["T_OBJECT_OPERATOR","->",399],["T_STRING","joinLeft",399],"(",["T_WHITESPACE","\n                ",399],["T_ARRAY","array",400],"(",["T_CONSTANT_ENCAPSED_STRING","'otps'",400],["T_WHITESPACE"," ",400],["T_DOUBLE_ARROW","=>",400],["T_WHITESPACE"," ",400],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getTable",400],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_price'",400],")",")",",",["T_WHITESPACE","\n                ",400],["T_CONSTANT_ENCAPSED_STRING","'otps.option_type_id = otpd.option_type_id AND otpd.store_id = cs.store_id'",401],",",["T_WHITESPACE","\n                ",401],["T_ARRAY","array",402],"(",")",")",["T_WHITESPACE","\n            ",402],["T_OBJECT_OPERATOR","->",403],["T_STRING","group",403],"(",["T_ARRAY","array",403],"(",["T_CONSTANT_ENCAPSED_STRING","'i.entity_id'",403],",",["T_WHITESPACE"," ",403],["T_CONSTANT_ENCAPSED_STRING","'i.customer_group_id'",403],",",["T_WHITESPACE"," ",403],["T_CONSTANT_ENCAPSED_STRING","'i.website_id'",403],",",["T_WHITESPACE"," ",403],["T_CONSTANT_ENCAPSED_STRING","'o.option_id'",403],")",")",";",["T_WHITESPACE","\n\n        ",403],["T_VARIABLE","$optPriceType",405],["T_WHITESPACE","   ",405],"=",["T_WHITESPACE"," ",405],["T_VARIABLE","$write",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","getCheckSql",405],"(",["T_CONSTANT_ENCAPSED_STRING","'otps.option_type_price_id > 0'",405],",",["T_WHITESPACE"," ",405],["T_CONSTANT_ENCAPSED_STRING","'otps.price_type'",405],",",["T_WHITESPACE"," ",405],["T_CONSTANT_ENCAPSED_STRING","'otpd.price_type'",405],")",";",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$optPriceValue",406],["T_WHITESPACE","  ",406],"=",["T_WHITESPACE"," ",406],["T_VARIABLE","$write",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","getCheckSql",406],"(",["T_CONSTANT_ENCAPSED_STRING","'otps.option_type_price_id > 0'",406],",",["T_WHITESPACE"," ",406],["T_CONSTANT_ENCAPSED_STRING","'otps.price'",406],",",["T_WHITESPACE"," ",406],["T_CONSTANT_ENCAPSED_STRING","'otpd.price'",406],")",";",["T_WHITESPACE","\n        ",406],["T_VARIABLE","$minPriceRound",407],["T_WHITESPACE","  ",407],"=",["T_WHITESPACE"," ",407],["T_NEW","new",407],["T_WHITESPACE"," ",407],["T_STRING","Zend_Db_Expr",407],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.price * (",407],["T_CURLY_OPEN","{",407],["T_VARIABLE","$optPriceValue",407],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",407],"\"",")",";",["T_WHITESPACE","\n        ",407],["T_VARIABLE","$minPriceExpr",408],["T_WHITESPACE","   ",408],"=",["T_WHITESPACE"," ",408],["T_VARIABLE","$write",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getCheckSql",408],"(","\"",["T_CURLY_OPEN","{",408],["T_VARIABLE","$optPriceType",408],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",408],"\"",",",["T_WHITESPACE"," ",408],["T_VARIABLE","$optPriceValue",408],",",["T_WHITESPACE"," ",408],["T_VARIABLE","$minPriceRound",408],")",";",["T_WHITESPACE","\n        ",408],["T_VARIABLE","$minPriceMin",409],["T_WHITESPACE","    ",409],"=",["T_WHITESPACE"," ",409],["T_NEW","new",409],["T_WHITESPACE"," ",409],["T_STRING","Zend_Db_Expr",409],"(","\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",409],["T_CURLY_OPEN","{",409],["T_VARIABLE","$minPriceExpr",409],"}",["T_ENCAPSED_AND_WHITESPACE",")",409],"\"",")",";",["T_WHITESPACE","\n        ",409],["T_VARIABLE","$minPrice",410],["T_WHITESPACE","       ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$write",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getCheckSql",410],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(o.is_require) = 1\"",410],",",["T_WHITESPACE"," ",410],["T_VARIABLE","$minPriceMin",410],",",["T_WHITESPACE"," ",410],["T_CONSTANT_ENCAPSED_STRING","'0'",410],")",";",["T_WHITESPACE","\n\n        ",410],["T_VARIABLE","$tierPriceRound",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_NEW","new",412],["T_WHITESPACE"," ",412],["T_STRING","Zend_Db_Expr",412],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.base_tier * (",412],["T_CURLY_OPEN","{",412],["T_VARIABLE","$optPriceValue",412],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",412],"\"",")",";",["T_WHITESPACE","\n        ",412],["T_VARIABLE","$tierPriceExpr",413],["T_WHITESPACE","  ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$write",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getCheckSql",413],"(","\"",["T_CURLY_OPEN","{",413],["T_VARIABLE","$optPriceType",413],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",413],"\"",",",["T_WHITESPACE"," ",413],["T_VARIABLE","$optPriceValue",413],",",["T_WHITESPACE"," ",413],["T_VARIABLE","$tierPriceRound",413],")",";",["T_WHITESPACE","\n        ",413],["T_VARIABLE","$tierPriceMin",414],["T_WHITESPACE","   ",414],"=",["T_WHITESPACE"," ",414],["T_NEW","new",414],["T_WHITESPACE"," ",414],["T_STRING","Zend_Db_Expr",414],"(","\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",414],["T_VARIABLE","$tierPriceExpr",414],["T_ENCAPSED_AND_WHITESPACE",")",414],"\"",")",";",["T_WHITESPACE","\n        ",414],["T_VARIABLE","$tierPriceValue",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_VARIABLE","$write",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getCheckSql",415],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(o.is_require) > 0\"",415],",",["T_WHITESPACE"," ",415],["T_VARIABLE","$tierPriceMin",415],",",["T_WHITESPACE"," ",415],["T_LNUMBER","0",415],")",";",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$tierPrice",416],["T_WHITESPACE","      ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$write",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getCheckSql",416],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(i.base_tier) IS NOT NULL\"",416],",",["T_WHITESPACE"," ",416],["T_VARIABLE","$tierPriceValue",416],",",["T_WHITESPACE"," ",416],["T_CONSTANT_ENCAPSED_STRING","\"NULL\"",416],")",";",["T_WHITESPACE","\n\n        ",416],["T_VARIABLE","$groupPriceRound",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_NEW","new",418],["T_WHITESPACE"," ",418],["T_STRING","Zend_Db_Expr",418],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.base_group_price * (",418],["T_CURLY_OPEN","{",418],["T_VARIABLE","$optPriceValue",418],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",418],"\"",")",";",["T_WHITESPACE","\n        ",418],["T_VARIABLE","$groupPriceExpr",419],["T_WHITESPACE","  ",419],"=",["T_WHITESPACE"," ",419],["T_VARIABLE","$write",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getCheckSql",419],"(","\"",["T_CURLY_OPEN","{",419],["T_VARIABLE","$optPriceType",419],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",419],"\"",",",["T_WHITESPACE"," ",419],["T_VARIABLE","$optPriceValue",419],",",["T_WHITESPACE"," ",419],["T_VARIABLE","$groupPriceRound",419],")",";",["T_WHITESPACE","\n        ",419],["T_VARIABLE","$groupPriceMin",420],["T_WHITESPACE","   ",420],"=",["T_WHITESPACE"," ",420],["T_NEW","new",420],["T_WHITESPACE"," ",420],["T_STRING","Zend_Db_Expr",420],"(","\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",420],["T_VARIABLE","$groupPriceExpr",420],["T_ENCAPSED_AND_WHITESPACE",")",420],"\"",")",";",["T_WHITESPACE","\n        ",420],["T_VARIABLE","$groupPriceValue",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_VARIABLE","$write",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getCheckSql",421],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(o.is_require) > 0\"",421],",",["T_WHITESPACE"," ",421],["T_VARIABLE","$groupPriceMin",421],",",["T_WHITESPACE"," ",421],["T_LNUMBER","0",421],")",";",["T_WHITESPACE","\n        ",421],["T_VARIABLE","$groupPrice",422],["T_WHITESPACE","      ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$write",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getCheckSql",422],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(i.base_group_price) IS NOT NULL\"",422],",",["T_WHITESPACE"," ",422],["T_VARIABLE","$groupPriceValue",422],",",["T_WHITESPACE"," ",422],["T_CONSTANT_ENCAPSED_STRING","\"NULL\"",422],")",";",["T_WHITESPACE","\n\n        ",422],["T_VARIABLE","$maxPriceRound",424],["T_WHITESPACE","  ",424],"=",["T_WHITESPACE"," ",424],["T_NEW","new",424],["T_WHITESPACE"," ",424],["T_STRING","Zend_Db_Expr",424],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.price * (",424],["T_CURLY_OPEN","{",424],["T_VARIABLE","$optPriceValue",424],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",424],"\"",")",";",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$maxPriceExpr",425],["T_WHITESPACE","   ",425],"=",["T_WHITESPACE"," ",425],["T_VARIABLE","$write",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getCheckSql",425],"(","\"",["T_CURLY_OPEN","{",425],["T_VARIABLE","$optPriceType",425],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",425],"\"",",",["T_WHITESPACE"," ",425],["T_VARIABLE","$optPriceValue",425],",",["T_WHITESPACE"," ",425],["T_VARIABLE","$maxPriceRound",425],")",";",["T_WHITESPACE","\n        ",425],["T_VARIABLE","$maxPrice",426],["T_WHITESPACE","       ",426],"=",["T_WHITESPACE"," ",426],["T_VARIABLE","$write",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getCheckSql",426],"(",["T_CONSTANT_ENCAPSED_STRING","\"(MIN(o.type)='radio' OR MIN(o.type)='drop_down')\"",426],",",["T_WHITESPACE","\n            ",426],"\"",["T_ENCAPSED_AND_WHITESPACE","MAX(",427],["T_VARIABLE","$maxPriceExpr",427],["T_ENCAPSED_AND_WHITESPACE",")",427],"\"",",",["T_WHITESPACE"," ",427],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",427],["T_VARIABLE","$maxPriceExpr",427],["T_ENCAPSED_AND_WHITESPACE",")",427],"\"",")",";",["T_WHITESPACE","\n\n        ",427],["T_VARIABLE","$select",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","columns",429],"(",["T_ARRAY","array",429],"(",["T_WHITESPACE","\n            ",429],["T_CONSTANT_ENCAPSED_STRING","'min_price'",430],["T_WHITESPACE","   ",430],["T_DOUBLE_ARROW","=>",430],["T_WHITESPACE"," ",430],["T_VARIABLE","$minPrice",430],",",["T_WHITESPACE","\n            ",430],["T_CONSTANT_ENCAPSED_STRING","'max_price'",431],["T_WHITESPACE","   ",431],["T_DOUBLE_ARROW","=>",431],["T_WHITESPACE"," ",431],["T_VARIABLE","$maxPrice",431],",",["T_WHITESPACE","\n            ",431],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",432],["T_WHITESPACE","  ",432],["T_DOUBLE_ARROW","=>",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$tierPrice",432],",",["T_WHITESPACE","\n            ",432],["T_CONSTANT_ENCAPSED_STRING","'group_price'",433],["T_WHITESPACE"," ",433],["T_DOUBLE_ARROW","=>",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$groupPrice",433],",",["T_WHITESPACE","\n        ",433],")",")",";",["T_WHITESPACE","\n\n        ",434],["T_VARIABLE","$query",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$select",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","insertFromSelect",436],"(",["T_VARIABLE","$coaTable",436],")",";",["T_WHITESPACE","\n        ",436],["T_VARIABLE","$write",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","query",437],"(",["T_VARIABLE","$query",437],")",";",["T_WHITESPACE","\n\n        ",437],["T_VARIABLE","$select",439],["T_WHITESPACE"," ",439],"=",["T_WHITESPACE"," ",439],["T_VARIABLE","$write",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","select",439],"(",")",["T_WHITESPACE","\n            ",439],["T_OBJECT_OPERATOR","->",440],["T_STRING","from",440],"(",["T_WHITESPACE","\n                ",440],["T_ARRAY","array",441],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",441],["T_WHITESPACE"," ",441],["T_DOUBLE_ARROW","=>",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","_getDefaultFinalPriceTable",441],"(",")",")",",",["T_WHITESPACE","\n                ",441],["T_ARRAY","array",442],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",442],",",["T_WHITESPACE"," ",442],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",442],",",["T_WHITESPACE"," ",442],["T_CONSTANT_ENCAPSED_STRING","'website_id'",442],")",")",["T_WHITESPACE","\n            ",442],["T_OBJECT_OPERATOR","->",443],["T_STRING","join",443],"(",["T_WHITESPACE","\n                ",443],["T_ARRAY","array",444],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",444],["T_WHITESPACE"," ",444],["T_DOUBLE_ARROW","=>",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getTable",444],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",444],")",")",",",["T_WHITESPACE","\n                ",444],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = i.website_id'",445],",",["T_WHITESPACE","\n                ",445],["T_ARRAY","array",446],"(",")",")",["T_WHITESPACE","\n            ",446],["T_OBJECT_OPERATOR","->",447],["T_STRING","join",447],"(",["T_WHITESPACE","\n                ",447],["T_ARRAY","array",448],"(",["T_CONSTANT_ENCAPSED_STRING","'csg'",448],["T_WHITESPACE"," ",448],["T_DOUBLE_ARROW","=>",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","getTable",448],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",448],")",")",",",["T_WHITESPACE","\n                ",448],["T_CONSTANT_ENCAPSED_STRING","'csg.group_id = cw.default_group_id'",449],",",["T_WHITESPACE","\n                ",449],["T_ARRAY","array",450],"(",")",")",["T_WHITESPACE","\n            ",450],["T_OBJECT_OPERATOR","->",451],["T_STRING","join",451],"(",["T_WHITESPACE","\n                ",451],["T_ARRAY","array",452],"(",["T_CONSTANT_ENCAPSED_STRING","'cs'",452],["T_WHITESPACE"," ",452],["T_DOUBLE_ARROW","=>",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getTable",452],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",452],")",")",",",["T_WHITESPACE","\n                ",452],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id = csg.default_store_id'",453],",",["T_WHITESPACE","\n                ",453],["T_ARRAY","array",454],"(",")",")",["T_WHITESPACE","\n            ",454],["T_OBJECT_OPERATOR","->",455],["T_STRING","join",455],"(",["T_WHITESPACE","\n                ",455],["T_ARRAY","array",456],"(",["T_CONSTANT_ENCAPSED_STRING","'o'",456],["T_WHITESPACE"," ",456],["T_DOUBLE_ARROW","=>",456],["T_WHITESPACE"," ",456],["T_VARIABLE","$this",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","getTable",456],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",456],")",")",",",["T_WHITESPACE","\n                ",456],["T_CONSTANT_ENCAPSED_STRING","'o.product_id = i.entity_id'",457],",",["T_WHITESPACE","\n                ",457],["T_ARRAY","array",458],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",458],")",")",["T_WHITESPACE","\n            ",458],["T_OBJECT_OPERATOR","->",459],["T_STRING","join",459],"(",["T_WHITESPACE","\n                ",459],["T_ARRAY","array",460],"(",["T_CONSTANT_ENCAPSED_STRING","'opd'",460],["T_WHITESPACE"," ",460],["T_DOUBLE_ARROW","=>",460],["T_WHITESPACE"," ",460],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getTable",460],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_price'",460],")",")",",",["T_WHITESPACE","\n                ",460],["T_CONSTANT_ENCAPSED_STRING","'opd.option_id = o.option_id AND opd.store_id = 0'",461],",",["T_WHITESPACE","\n                ",461],["T_ARRAY","array",462],"(",")",")",["T_WHITESPACE","\n            ",462],["T_OBJECT_OPERATOR","->",463],["T_STRING","joinLeft",463],"(",["T_WHITESPACE","\n                ",463],["T_ARRAY","array",464],"(",["T_CONSTANT_ENCAPSED_STRING","'ops'",464],["T_WHITESPACE"," ",464],["T_DOUBLE_ARROW","=>",464],["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getTable",464],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_price'",464],")",")",",",["T_WHITESPACE","\n                ",464],["T_CONSTANT_ENCAPSED_STRING","'ops.option_id = opd.option_id AND ops.store_id = cs.store_id'",465],",",["T_WHITESPACE","\n                ",465],["T_ARRAY","array",466],"(",")",")",";",["T_WHITESPACE","\n\n        ",466],["T_VARIABLE","$optPriceType",468],["T_WHITESPACE","   ",468],"=",["T_WHITESPACE"," ",468],["T_VARIABLE","$write",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getCheckSql",468],"(",["T_CONSTANT_ENCAPSED_STRING","'ops.option_price_id > 0'",468],",",["T_WHITESPACE"," ",468],["T_CONSTANT_ENCAPSED_STRING","'ops.price_type'",468],",",["T_WHITESPACE"," ",468],["T_CONSTANT_ENCAPSED_STRING","'opd.price_type'",468],")",";",["T_WHITESPACE","\n        ",468],["T_VARIABLE","$optPriceValue",469],["T_WHITESPACE","  ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$write",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getCheckSql",469],"(",["T_CONSTANT_ENCAPSED_STRING","'ops.option_price_id > 0'",469],",",["T_WHITESPACE"," ",469],["T_CONSTANT_ENCAPSED_STRING","'ops.price'",469],",",["T_WHITESPACE"," ",469],["T_CONSTANT_ENCAPSED_STRING","'opd.price'",469],")",";",["T_WHITESPACE","\n\n        ",469],["T_VARIABLE","$minPriceRound",471],["T_WHITESPACE","  ",471],"=",["T_WHITESPACE"," ",471],["T_NEW","new",471],["T_WHITESPACE"," ",471],["T_STRING","Zend_Db_Expr",471],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.price * (",471],["T_CURLY_OPEN","{",471],["T_VARIABLE","$optPriceValue",471],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",471],"\"",")",";",["T_WHITESPACE","\n        ",471],["T_VARIABLE","$priceExpr",472],["T_WHITESPACE","      ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$write",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getCheckSql",472],"(","\"",["T_CURLY_OPEN","{",472],["T_VARIABLE","$optPriceType",472],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",472],"\"",",",["T_WHITESPACE"," ",472],["T_VARIABLE","$optPriceValue",472],",",["T_WHITESPACE"," ",472],["T_VARIABLE","$minPriceRound",472],")",";",["T_WHITESPACE","\n        ",472],["T_VARIABLE","$minPrice",473],["T_WHITESPACE","       ",473],"=",["T_WHITESPACE"," ",473],["T_VARIABLE","$write",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getCheckSql",473],"(","\"",["T_CURLY_OPEN","{",473],["T_VARIABLE","$priceExpr",473],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND o.is_require > 1",473],"\"",",",["T_WHITESPACE"," ",473],["T_VARIABLE","$priceExpr",473],",",["T_WHITESPACE"," ",473],["T_LNUMBER","0",473],")",";",["T_WHITESPACE","\n\n        ",473],["T_VARIABLE","$maxPrice",475],["T_WHITESPACE","       ",475],"=",["T_WHITESPACE"," ",475],["T_VARIABLE","$priceExpr",475],";",["T_WHITESPACE","\n\n        ",475],["T_VARIABLE","$tierPriceRound",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_NEW","new",477],["T_WHITESPACE"," ",477],["T_STRING","Zend_Db_Expr",477],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.base_tier * (",477],["T_CURLY_OPEN","{",477],["T_VARIABLE","$optPriceValue",477],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",477],"\"",")",";",["T_WHITESPACE","\n        ",477],["T_VARIABLE","$tierPriceExpr",478],["T_WHITESPACE","  ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$write",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getCheckSql",478],"(","\"",["T_CURLY_OPEN","{",478],["T_VARIABLE","$optPriceType",478],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",478],"\"",",",["T_WHITESPACE"," ",478],["T_VARIABLE","$optPriceValue",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$tierPriceRound",478],")",";",["T_WHITESPACE","\n        ",478],["T_VARIABLE","$tierPriceValue",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_VARIABLE","$write",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getCheckSql",479],"(","\"",["T_CURLY_OPEN","{",479],["T_VARIABLE","$tierPriceExpr",479],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND o.is_require > 0",479],"\"",",",["T_WHITESPACE"," ",479],["T_VARIABLE","$tierPriceExpr",479],",",["T_WHITESPACE"," ",479],["T_LNUMBER","0",479],")",";",["T_WHITESPACE","\n        ",479],["T_VARIABLE","$tierPrice",480],["T_WHITESPACE","      ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$write",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getCheckSql",480],"(",["T_CONSTANT_ENCAPSED_STRING","\"i.base_tier IS NOT NULL\"",480],",",["T_WHITESPACE"," ",480],["T_VARIABLE","$tierPriceValue",480],",",["T_WHITESPACE"," ",480],["T_CONSTANT_ENCAPSED_STRING","\"NULL\"",480],")",";",["T_WHITESPACE","\n\n        ",480],["T_VARIABLE","$groupPriceRound",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_NEW","new",482],["T_WHITESPACE"," ",482],["T_STRING","Zend_Db_Expr",482],"(","\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.base_group_price * (",482],["T_CURLY_OPEN","{",482],["T_VARIABLE","$optPriceValue",482],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",482],"\"",")",";",["T_WHITESPACE","\n        ",482],["T_VARIABLE","$groupPriceExpr",483],["T_WHITESPACE","  ",483],"=",["T_WHITESPACE"," ",483],["T_VARIABLE","$write",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getCheckSql",483],"(","\"",["T_CURLY_OPEN","{",483],["T_VARIABLE","$optPriceType",483],"}",["T_ENCAPSED_AND_WHITESPACE"," = 'fixed'",483],"\"",",",["T_WHITESPACE"," ",483],["T_VARIABLE","$optPriceValue",483],",",["T_WHITESPACE"," ",483],["T_VARIABLE","$groupPriceRound",483],")",";",["T_WHITESPACE","\n        ",483],["T_VARIABLE","$groupPriceValue",484],["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_VARIABLE","$write",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getCheckSql",484],"(","\"",["T_CURLY_OPEN","{",484],["T_VARIABLE","$groupPriceExpr",484],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND o.is_require > 0",484],"\"",",",["T_WHITESPACE"," ",484],["T_VARIABLE","$groupPriceExpr",484],",",["T_WHITESPACE"," ",484],["T_LNUMBER","0",484],")",";",["T_WHITESPACE","\n        ",484],["T_VARIABLE","$groupPrice",485],["T_WHITESPACE","      ",485],"=",["T_WHITESPACE"," ",485],["T_VARIABLE","$write",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","getCheckSql",485],"(",["T_CONSTANT_ENCAPSED_STRING","\"i.base_group_price IS NOT NULL\"",485],",",["T_WHITESPACE"," ",485],["T_VARIABLE","$groupPriceValue",485],",",["T_WHITESPACE"," ",485],["T_CONSTANT_ENCAPSED_STRING","\"NULL\"",485],")",";",["T_WHITESPACE","\n\n        ",485],["T_VARIABLE","$select",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","columns",487],"(",["T_ARRAY","array",487],"(",["T_WHITESPACE","\n            ",487],["T_CONSTANT_ENCAPSED_STRING","'min_price'",488],["T_WHITESPACE","   ",488],["T_DOUBLE_ARROW","=>",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$minPrice",488],",",["T_WHITESPACE","\n            ",488],["T_CONSTANT_ENCAPSED_STRING","'max_price'",489],["T_WHITESPACE","   ",489],["T_DOUBLE_ARROW","=>",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$maxPrice",489],",",["T_WHITESPACE","\n            ",489],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",490],["T_WHITESPACE","  ",490],["T_DOUBLE_ARROW","=>",490],["T_WHITESPACE"," ",490],["T_VARIABLE","$tierPrice",490],",",["T_WHITESPACE","\n            ",490],["T_CONSTANT_ENCAPSED_STRING","'group_price'",491],["T_WHITESPACE"," ",491],["T_DOUBLE_ARROW","=>",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$groupPrice",491],",",["T_WHITESPACE","\n        ",491],")",")",";",["T_WHITESPACE","\n\n        ",492],["T_VARIABLE","$query",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],["T_VARIABLE","$select",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","insertFromSelect",494],"(",["T_VARIABLE","$coaTable",494],")",";",["T_WHITESPACE","\n        ",494],["T_VARIABLE","$write",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","query",495],"(",["T_VARIABLE","$query",495],")",";",["T_WHITESPACE","\n\n        ",495],["T_VARIABLE","$select",497],["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_VARIABLE","$write",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","select",497],"(",")",["T_WHITESPACE","\n            ",497],["T_OBJECT_OPERATOR","->",498],["T_STRING","from",498],"(",["T_WHITESPACE","\n                ",498],["T_ARRAY","array",499],"(",["T_VARIABLE","$coaTable",499],")",",",["T_WHITESPACE","\n                ",499],["T_ARRAY","array",500],"(",["T_WHITESPACE","\n                    ",500],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",501],",",["T_WHITESPACE","\n                    ",501],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",502],",",["T_WHITESPACE","\n                    ",502],["T_CONSTANT_ENCAPSED_STRING","'website_id'",503],",",["T_WHITESPACE","\n                    ",503],["T_CONSTANT_ENCAPSED_STRING","'min_price'",504],["T_WHITESPACE","     ",504],["T_DOUBLE_ARROW","=>",504],["T_WHITESPACE"," ",504],["T_CONSTANT_ENCAPSED_STRING","'SUM(min_price)'",504],",",["T_WHITESPACE","\n                    ",504],["T_CONSTANT_ENCAPSED_STRING","'max_price'",505],["T_WHITESPACE","     ",505],["T_DOUBLE_ARROW","=>",505],["T_WHITESPACE"," ",505],["T_CONSTANT_ENCAPSED_STRING","'SUM(max_price)'",505],",",["T_WHITESPACE","\n                    ",505],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",506],["T_WHITESPACE","    ",506],["T_DOUBLE_ARROW","=>",506],["T_WHITESPACE"," ",506],["T_CONSTANT_ENCAPSED_STRING","'SUM(tier_price)'",506],",",["T_WHITESPACE","\n                    ",506],["T_CONSTANT_ENCAPSED_STRING","'group_price'",507],["T_WHITESPACE","   ",507],["T_DOUBLE_ARROW","=>",507],["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'SUM(group_price)'",507],",",["T_WHITESPACE","\n                ",507],")",")",["T_WHITESPACE","\n            ",508],["T_OBJECT_OPERATOR","->",509],["T_STRING","group",509],"(",["T_ARRAY","array",509],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",509],",",["T_WHITESPACE"," ",509],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",509],",",["T_WHITESPACE"," ",509],["T_CONSTANT_ENCAPSED_STRING","'website_id'",509],")",")",";",["T_WHITESPACE","\n        ",509],["T_VARIABLE","$query",510],["T_WHITESPACE"," ",510],"=",["T_WHITESPACE"," ",510],["T_VARIABLE","$select",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","insertFromSelect",510],"(",["T_VARIABLE","$copTable",510],")",";",["T_WHITESPACE","\n        ",510],["T_VARIABLE","$write",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","query",511],"(",["T_VARIABLE","$query",511],")",";",["T_WHITESPACE","\n\n        ",511],["T_VARIABLE","$table",513],["T_WHITESPACE","  ",513],"=",["T_WHITESPACE"," ",513],["T_ARRAY","array",513],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",513],["T_WHITESPACE"," ",513],["T_DOUBLE_ARROW","=>",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$this",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","_getDefaultFinalPriceTable",513],"(",")",")",";",["T_WHITESPACE","\n        ",513],["T_VARIABLE","$select",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_VARIABLE","$write",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","select",514],"(",")",["T_WHITESPACE","\n            ",514],["T_OBJECT_OPERATOR","->",515],["T_STRING","join",515],"(",["T_WHITESPACE","\n                ",515],["T_ARRAY","array",516],"(",["T_CONSTANT_ENCAPSED_STRING","'io'",516],["T_WHITESPACE"," ",516],["T_DOUBLE_ARROW","=>",516],["T_WHITESPACE"," ",516],["T_VARIABLE","$copTable",516],")",",",["T_WHITESPACE","\n                ",516],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id = io.entity_id AND i.customer_group_id = io.customer_group_id'",517],["T_WHITESPACE","\n                    ",517],".",["T_CONSTANT_ENCAPSED_STRING","' AND i.website_id = io.website_id'",518],",",["T_WHITESPACE","\n                ",518],["T_ARRAY","array",519],"(",")",")",";",["T_WHITESPACE","\n        ",519],["T_VARIABLE","$select",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","columns",520],"(",["T_ARRAY","array",520],"(",["T_WHITESPACE","\n            ",520],["T_CONSTANT_ENCAPSED_STRING","'min_price'",521],["T_WHITESPACE","   ",521],["T_DOUBLE_ARROW","=>",521],["T_WHITESPACE"," ",521],["T_NEW","new",521],["T_WHITESPACE"," ",521],["T_STRING","Zend_Db_Expr",521],"(",["T_CONSTANT_ENCAPSED_STRING","'i.min_price + io.min_price'",521],")",",",["T_WHITESPACE","\n            ",521],["T_CONSTANT_ENCAPSED_STRING","'max_price'",522],["T_WHITESPACE","   ",522],["T_DOUBLE_ARROW","=>",522],["T_WHITESPACE"," ",522],["T_NEW","new",522],["T_WHITESPACE"," ",522],["T_STRING","Zend_Db_Expr",522],"(",["T_CONSTANT_ENCAPSED_STRING","'i.max_price + io.max_price'",522],")",",",["T_WHITESPACE","\n            ",522],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",523],["T_WHITESPACE","  ",523],["T_DOUBLE_ARROW","=>",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$write",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","getCheckSql",523],"(",["T_CONSTANT_ENCAPSED_STRING","'i.tier_price IS NOT NULL'",523],",",["T_WHITESPACE"," ",523],["T_CONSTANT_ENCAPSED_STRING","'i.tier_price + io.tier_price'",523],",",["T_WHITESPACE"," ",523],["T_CONSTANT_ENCAPSED_STRING","'NULL'",523],")",",",["T_WHITESPACE","\n            ",523],["T_CONSTANT_ENCAPSED_STRING","'group_price'",524],["T_WHITESPACE"," ",524],["T_DOUBLE_ARROW","=>",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$write",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","getCheckSql",524],"(",["T_WHITESPACE","\n                ",524],["T_CONSTANT_ENCAPSED_STRING","'i.group_price IS NOT NULL'",525],",",["T_WHITESPACE","\n                ",525],["T_CONSTANT_ENCAPSED_STRING","'i.group_price + io.group_price'",526],",",["T_WHITESPACE"," ",526],["T_CONSTANT_ENCAPSED_STRING","'NULL'",526],["T_WHITESPACE","\n            ",526],")",",",["T_WHITESPACE","\n        ",527],")",")",";",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$query",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$select",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","crossUpdateFromSelect",529],"(",["T_VARIABLE","$table",529],")",";",["T_WHITESPACE","\n        ",529],["T_VARIABLE","$write",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","query",530],"(",["T_VARIABLE","$query",530],")",";",["T_WHITESPACE","\n\n        ",530],["T_VARIABLE","$write",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","delete",532],"(",["T_VARIABLE","$coaTable",532],")",";",["T_WHITESPACE","\n        ",532],["T_VARIABLE","$write",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","delete",533],"(",["T_VARIABLE","$copTable",533],")",";",["T_WHITESPACE","\n\n        ",533],["T_RETURN","return",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$this",535],";",["T_WHITESPACE","\n    ",535],"}",["T_WHITESPACE","\n\n    ",536],["T_DOC_COMMENT","\/**\n     * Mode Final Prices index to primary temporary index table\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Default\n     *\/",538],["T_WHITESPACE","\n    ",542],["T_PROTECTED","protected",543],["T_WHITESPACE"," ",543],["T_FUNCTION","function",543],["T_WHITESPACE"," ",543],["T_STRING","_movePriceDataToIndexTable",543],"(",")",["T_WHITESPACE","\n    ",543],"{",["T_WHITESPACE","\n        ",544],["T_VARIABLE","$columns",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_ARRAY","array",545],"(",["T_WHITESPACE","\n            ",545],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",546],["T_WHITESPACE","         ",546],["T_DOUBLE_ARROW","=>",546],["T_WHITESPACE"," ",546],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",546],",",["T_WHITESPACE","\n            ",546],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",547],["T_WHITESPACE"," ",547],["T_DOUBLE_ARROW","=>",547],["T_WHITESPACE"," ",547],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",547],",",["T_WHITESPACE","\n            ",547],["T_CONSTANT_ENCAPSED_STRING","'website_id'",548],["T_WHITESPACE","        ",548],["T_DOUBLE_ARROW","=>",548],["T_WHITESPACE"," ",548],["T_CONSTANT_ENCAPSED_STRING","'website_id'",548],",",["T_WHITESPACE","\n            ",548],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",549],["T_WHITESPACE","      ",549],["T_DOUBLE_ARROW","=>",549],["T_WHITESPACE"," ",549],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",549],",",["T_WHITESPACE","\n            ",549],["T_CONSTANT_ENCAPSED_STRING","'price'",550],["T_WHITESPACE","             ",550],["T_DOUBLE_ARROW","=>",550],["T_WHITESPACE"," ",550],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",550],",",["T_WHITESPACE","\n            ",550],["T_CONSTANT_ENCAPSED_STRING","'final_price'",551],["T_WHITESPACE","       ",551],["T_DOUBLE_ARROW","=>",551],["T_WHITESPACE"," ",551],["T_CONSTANT_ENCAPSED_STRING","'price'",551],",",["T_WHITESPACE","\n            ",551],["T_CONSTANT_ENCAPSED_STRING","'min_price'",552],["T_WHITESPACE","         ",552],["T_DOUBLE_ARROW","=>",552],["T_WHITESPACE"," ",552],["T_CONSTANT_ENCAPSED_STRING","'min_price'",552],",",["T_WHITESPACE","\n            ",552],["T_CONSTANT_ENCAPSED_STRING","'max_price'",553],["T_WHITESPACE","         ",553],["T_DOUBLE_ARROW","=>",553],["T_WHITESPACE"," ",553],["T_CONSTANT_ENCAPSED_STRING","'max_price'",553],",",["T_WHITESPACE","\n            ",553],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",554],["T_WHITESPACE","        ",554],["T_DOUBLE_ARROW","=>",554],["T_WHITESPACE"," ",554],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",554],",",["T_WHITESPACE","\n            ",554],["T_CONSTANT_ENCAPSED_STRING","'group_price'",555],["T_WHITESPACE","       ",555],["T_DOUBLE_ARROW","=>",555],["T_WHITESPACE"," ",555],["T_CONSTANT_ENCAPSED_STRING","'group_price'",555],",",["T_WHITESPACE","\n        ",555],")",";",["T_WHITESPACE","\n\n        ",556],["T_VARIABLE","$write",558],["T_WHITESPACE","  ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","_getWriteAdapter",558],"(",")",";",["T_WHITESPACE","\n        ",558],["T_VARIABLE","$table",559],["T_WHITESPACE","  ",559],"=",["T_WHITESPACE"," ",559],["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","_getDefaultFinalPriceTable",559],"(",")",";",["T_WHITESPACE","\n        ",559],["T_VARIABLE","$select",560],["T_WHITESPACE"," ",560],"=",["T_WHITESPACE"," ",560],["T_VARIABLE","$write",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","select",560],"(",")",["T_WHITESPACE","\n            ",560],["T_OBJECT_OPERATOR","->",561],["T_STRING","from",561],"(",["T_VARIABLE","$table",561],",",["T_WHITESPACE"," ",561],["T_VARIABLE","$columns",561],")",";",["T_WHITESPACE","\n\n        ",561],["T_VARIABLE","$query",563],["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_VARIABLE","$select",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","insertFromSelect",563],"(",["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","getIdxTable",563],"(",")",",",["T_WHITESPACE"," ",563],["T_ARRAY","array",563],"(",")",",",["T_WHITESPACE"," ",563],["T_STRING","false",563],")",";",["T_WHITESPACE","\n        ",563],["T_VARIABLE","$write",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","query",564],"(",["T_VARIABLE","$query",564],")",";",["T_WHITESPACE","\n\n        ",564],["T_VARIABLE","$write",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","delete",566],"(",["T_VARIABLE","$table",566],")",";",["T_WHITESPACE","\n\n        ",566],["T_RETURN","return",568],["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],";",["T_WHITESPACE","\n    ",568],"}",["T_WHITESPACE","\n\n    ",569],["T_DOC_COMMENT","\/**\n     * Retrieve table name for product tier price index\n     *\n     * @return string\n     *\/",571],["T_WHITESPACE","\n    ",575],["T_PROTECTED","protected",576],["T_WHITESPACE"," ",576],["T_FUNCTION","function",576],["T_WHITESPACE"," ",576],["T_STRING","_getTierPriceIndexTable",576],"(",")",["T_WHITESPACE","\n    ",576],"{",["T_WHITESPACE","\n        ",577],["T_RETURN","return",578],["T_WHITESPACE"," ",578],["T_VARIABLE","$this",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getTable",578],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_tier_price'",578],")",";",["T_WHITESPACE","\n    ",578],"}",["T_WHITESPACE","\n\n    ",579],["T_DOC_COMMENT","\/**\n     * Retrieve table name for product group price index\n     *\n     * @return string\n     *\/",581],["T_WHITESPACE","\n    ",585],["T_PROTECTED","protected",586],["T_WHITESPACE"," ",586],["T_FUNCTION","function",586],["T_WHITESPACE"," ",586],["T_STRING","_getGroupPriceIndexTable",586],"(",")",["T_WHITESPACE","\n    ",586],"{",["T_WHITESPACE","\n        ",587],["T_RETURN","return",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","getTable",588],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_group_price'",588],")",";",["T_WHITESPACE","\n    ",588],"}",["T_WHITESPACE","\n\n    ",589],["T_DOC_COMMENT","\/**\n     * Register data required by product type process in event object\n     *\n     * @param Mage_Index_Model_Event $event\n     *\/",591],["T_WHITESPACE","\n    ",595],["T_PUBLIC","public",596],["T_WHITESPACE"," ",596],["T_FUNCTION","function",596],["T_WHITESPACE"," ",596],["T_STRING","registerEvent",596],"(",["T_STRING","Mage_Index_Model_Event",596],["T_WHITESPACE"," ",596],["T_VARIABLE","$event",596],")",["T_WHITESPACE","\n    ",596],"{",["T_WHITESPACE","\n\n    ",597],"}",["T_WHITESPACE","\n\n    ",599],["T_DOC_COMMENT","\/**\n     * Retrieve temporary index table name\n     *\n     * @param string $table\n     * @return string\n     *\/",601],["T_WHITESPACE","\n    ",606],["T_PUBLIC","public",607],["T_WHITESPACE"," ",607],["T_FUNCTION","function",607],["T_WHITESPACE"," ",607],["T_STRING","getIdxTable",607],"(",["T_VARIABLE","$table",607],["T_WHITESPACE"," ",607],"=",["T_WHITESPACE"," ",607],["T_STRING","null",607],")",["T_WHITESPACE","\n    ",607],"{",["T_WHITESPACE","\n        ",608],["T_IF","if",609],["T_WHITESPACE"," ",609],"(",["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","useIdxTable",609],"(",")",")",["T_WHITESPACE"," ",609],"{",["T_WHITESPACE","\n            ",609],["T_RETURN","return",610],["T_WHITESPACE"," ",610],["T_VARIABLE","$this",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getTable",610],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_idx'",610],")",";",["T_WHITESPACE","\n        ",610],"}",["T_WHITESPACE","\n        ",611],["T_RETURN","return",612],["T_WHITESPACE"," ",612],["T_VARIABLE","$this",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","getTable",612],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_tmp'",612],")",";",["T_WHITESPACE","\n    ",612],"}",["T_WHITESPACE","\n",613],"}",["T_WHITESPACE","\n",614]]