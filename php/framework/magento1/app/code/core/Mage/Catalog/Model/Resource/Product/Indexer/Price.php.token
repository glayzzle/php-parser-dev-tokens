[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog Product Price Indexer Resource Model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Price",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Index_Model_Resource_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Default Product Type Price indexer resource model\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_defaultPriceIndexer",42],["T_WHITESPACE","    ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_indexer_price_default'",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Product Type Price indexer resource models\n     *\n     * @var array\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_indexers",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Define main index table\n     *\n     *\/",51],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","_construct",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_init",57],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_price'",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",57],")",";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Retrieve parent ids and types by child id\n     * Return array with key product_id and value as product type id\n     *\n     * @param int $childId\n     * @return array\n     *\/",60],["T_WHITESPACE","\n    ",66],["T_PUBLIC","public",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","getProductParentsByChild",67],"(",["T_VARIABLE","$childId",67],")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$write",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_getWriteAdapter",69],"(",")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$select",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$write",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","select",70],"(",")",["T_WHITESPACE","\n            ",70],["T_OBJECT_OPERATOR","->",71],["T_STRING","from",71],"(",["T_ARRAY","array",71],"(",["T_CONSTANT_ENCAPSED_STRING","'l'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getTable",71],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_relation'",71],")",")",",",["T_WHITESPACE"," ",71],["T_ARRAY","array",71],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",71],")",")",["T_WHITESPACE","\n            ",71],["T_OBJECT_OPERATOR","->",72],["T_STRING","join",72],"(",["T_WHITESPACE","\n                ",72],["T_ARRAY","array",73],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getTable",73],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",73],")",")",",",["T_WHITESPACE","\n                ",73],["T_CONSTANT_ENCAPSED_STRING","'l.parent_id = e.entity_id'",74],",",["T_WHITESPACE","\n                ",74],["T_ARRAY","array",75],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id'",75],")",")",["T_WHITESPACE","\n            ",75],["T_OBJECT_OPERATOR","->",76],["T_STRING","where",76],"(",["T_CONSTANT_ENCAPSED_STRING","'l.child_id = ?'",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$childId",76],")",";",["T_WHITESPACE","\n\n        ",76],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$write",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","fetchPairs",78],"(",["T_VARIABLE","$select",78],")",";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Process produce delete\n     * If the deleted product was found in a composite product(s) update it\n     *\n     * @param Mage_Index_Model_Event $event\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",81],["T_WHITESPACE","\n    ",87],["T_PUBLIC","public",88],["T_WHITESPACE"," ",88],["T_FUNCTION","function",88],["T_WHITESPACE"," ",88],["T_STRING","catalogProductDelete",88],"(",["T_STRING","Mage_Index_Model_Event",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$event",88],")",["T_WHITESPACE","\n    ",88],"{",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$data",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$event",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getNewData",90],"(",")",";",["T_WHITESPACE","\n        ",90],["T_IF","if",91],["T_WHITESPACE"," ",91],"(",["T_EMPTY","empty",91],"(",["T_VARIABLE","$data",91],"[",["T_CONSTANT_ENCAPSED_STRING","'reindex_price_parent_ids'",91],"]",")",")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_RETURN","return",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n\n        ",93],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","clearTemporaryIndexTable",95],"(",")",";",["T_WHITESPACE","\n\n        ",95],["T_VARIABLE","$processIds",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","array_keys",97],"(",["T_VARIABLE","$data",97],"[",["T_CONSTANT_ENCAPSED_STRING","'reindex_price_parent_ids'",97],"]",")",";",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$parentIds",98],["T_WHITESPACE","  ",98],"=",["T_WHITESPACE"," ",98],["T_ARRAY","array",98],"(",")",";",["T_WHITESPACE","\n        ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$data",99],"[",["T_CONSTANT_ENCAPSED_STRING","'reindex_price_parent_ids'",99],"]",["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$parentId",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$parentType",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$parentIds",100],"[",["T_VARIABLE","$parentType",100],"]","[",["T_VARIABLE","$parentId",100],"]",["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$parentId",100],";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE","\n\n        ",101],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_copyRelationIndexData",103],"(",["T_VARIABLE","$processIds",103],")",";",["T_WHITESPACE","\n        ",103],["T_FOREACH","foreach",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$parentIds",104],["T_WHITESPACE"," ",104],["T_AS","as",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$parentType",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$entityIds",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_getIndexer",105],"(",["T_VARIABLE","$parentType",105],")",["T_OBJECT_OPERATOR","->",105],["T_STRING","reindexEntity",105],"(",["T_VARIABLE","$entityIds",105],")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_copyIndexDataToMainTable",108],"(",["T_VARIABLE","$parentIds",108],")",";",["T_WHITESPACE","\n\n        ",108],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Copy data from temporary index table to main table by defined ids\n     *\n     * @param array $processIds\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     * @throws Exception\n     *\/",113],["T_WHITESPACE","\n    ",119],["T_PROTECTED","protected",120],["T_WHITESPACE"," ",120],["T_FUNCTION","function",120],["T_WHITESPACE"," ",120],["T_STRING","_copyIndexDataToMainTable",120],"(",["T_VARIABLE","$processIds",120],")",["T_WHITESPACE","\n    ",120],"{",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$write",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_getWriteAdapter",122],"(",")",";",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","beginTransaction",123],"(",")",";",["T_WHITESPACE","\n        ",123],["T_TRY","try",124],["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_COMMENT","\/\/ remove old index\n",125],["T_WHITESPACE","            ",126],["T_VARIABLE","$where",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$write",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","quoteInto",126],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$processIds",126],")",";",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$write",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","delete",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getMainTable",127],"(",")",",",["T_WHITESPACE"," ",127],["T_VARIABLE","$where",127],")",";",["T_WHITESPACE","\n\n            ",127],["T_COMMENT","\/\/ remove additional data from index\n",129],["T_WHITESPACE","            ",130],["T_VARIABLE","$where",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$write",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","quoteInto",130],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id NOT IN(?)'",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$processIds",130],")",";",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$write",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","delete",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getIdxTable",131],"(",")",",",["T_WHITESPACE"," ",131],["T_VARIABLE","$where",131],")",";",["T_WHITESPACE","\n\n            ",131],["T_COMMENT","\/\/ insert new index\n",133],["T_WHITESPACE","            ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","useDisableKeys",134],"(",["T_STRING","false",134],")",";",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","insertFromTable",135],"(",["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getIdxTable",135],"(",")",",",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getMainTable",135],"(",")",")",";",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","useDisableKeys",136],"(",["T_STRING","true",136],")",";",["T_WHITESPACE","\n\n            ",136],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","commit",138],"(",")",";",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE"," ",139],["T_CATCH","catch",139],["T_WHITESPACE"," ",139],"(",["T_STRING","Exception",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$e",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","rollBack",140],"(",")",";",["T_WHITESPACE","\n            ",140],["T_THROW","throw",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$e",141],";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n\n        ",142],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Process product save.\n     * Method is responsible for index support\n     * when product was saved and changed attribute(s) has an effect on price.\n     *\n     * @param Mage_Index_Model_Event $event\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",147],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","catalogProductSave",155],"(",["T_STRING","Mage_Index_Model_Event",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$event",155],")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$productId",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$event",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getEntityPk",157],"(",")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$data",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$event",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getNewData",158],"(",")",";",["T_WHITESPACE","\n\n        ",158],["T_DOC_COMMENT","\/**\n         * Check if price attribute values were updated\n         *\/",160],["T_WHITESPACE","\n        ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(","!",["T_ISSET","isset",163],"(",["T_VARIABLE","$data",163],"[",["T_CONSTANT_ENCAPSED_STRING","'reindex_price'",163],"]",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","clearTemporaryIndexTable",167],"(",")",";",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_prepareWebsiteDateTable",168],"(",")",";",["T_WHITESPACE","\n\n        ",168],["T_VARIABLE","$indexer",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_getIndexer",170],"(",["T_VARIABLE","$data",170],"[",["T_CONSTANT_ENCAPSED_STRING","'product_type_id'",170],"]",")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$processIds",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_ARRAY","array",171],"(",["T_VARIABLE","$productId",171],")",";",["T_WHITESPACE","\n        ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$indexer",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getIsComposite",172],"(",")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_copyRelationIndexData",173],"(",["T_VARIABLE","$productId",173],")",";",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","_prepareTierPriceIndex",174],"(",["T_VARIABLE","$productId",174],")",";",["T_WHITESPACE","\n            ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_prepareGroupPriceIndex",175],"(",["T_VARIABLE","$productId",175],")",";",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$indexer",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","reindexEntity",176],"(",["T_VARIABLE","$productId",176],")",";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE"," ",177],["T_ELSE","else",177],["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$parentIds",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getProductParentsByChild",178],"(",["T_VARIABLE","$productId",178],")",";",["T_WHITESPACE","\n\n            ",178],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$parentIds",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n                ",180],["T_VARIABLE","$processIds",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_STRING","array_merge",181],"(",["T_VARIABLE","$processIds",181],",",["T_WHITESPACE"," ",181],["T_STRING","array_keys",181],"(",["T_VARIABLE","$parentIds",181],")",")",";",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_copyRelationIndexData",182],"(",["T_STRING","array_keys",182],"(",["T_VARIABLE","$parentIds",182],")",",",["T_WHITESPACE"," ",182],["T_VARIABLE","$productId",182],")",";",["T_WHITESPACE","\n                ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","_prepareTierPriceIndex",183],"(",["T_VARIABLE","$processIds",183],")",";",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","_prepareGroupPriceIndex",184],"(",["T_VARIABLE","$processIds",184],")",";",["T_WHITESPACE","\n                ",184],["T_VARIABLE","$indexer",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","reindexEntity",185],"(",["T_VARIABLE","$productId",185],")",";",["T_WHITESPACE","\n\n                ",185],["T_VARIABLE","$parentByType",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_ARRAY","array",187],"(",")",";",["T_WHITESPACE","\n                ",187],["T_FOREACH","foreach",188],["T_WHITESPACE"," ",188],"(",["T_VARIABLE","$parentIds",188],["T_WHITESPACE"," ",188],["T_AS","as",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$parentId",188],["T_WHITESPACE"," ",188],["T_DOUBLE_ARROW","=>",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$parentType",188],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n                    ",188],["T_VARIABLE","$parentByType",189],"[",["T_VARIABLE","$parentType",189],"]","[",["T_VARIABLE","$parentId",189],"]",["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$parentId",189],";",["T_WHITESPACE","\n                ",189],"}",["T_WHITESPACE","\n\n                ",190],["T_FOREACH","foreach",192],["T_WHITESPACE"," ",192],"(",["T_VARIABLE","$parentByType",192],["T_WHITESPACE"," ",192],["T_AS","as",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$parentType",192],["T_WHITESPACE"," ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$entityIds",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n                    ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_getIndexer",193],"(",["T_VARIABLE","$parentType",193],")",["T_OBJECT_OPERATOR","->",193],["T_STRING","reindexEntity",193],"(",["T_VARIABLE","$entityIds",193],")",";",["T_WHITESPACE","\n                ",193],"}",["T_WHITESPACE","\n            ",194],"}",["T_WHITESPACE"," ",195],["T_ELSE","else",195],["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n                ",195],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_prepareTierPriceIndex",196],"(",["T_VARIABLE","$productId",196],")",";",["T_WHITESPACE","\n                ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_prepareGroupPriceIndex",197],"(",["T_VARIABLE","$productId",197],")",";",["T_WHITESPACE","\n                ",197],["T_VARIABLE","$indexer",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","reindexEntity",198],"(",["T_VARIABLE","$productId",198],")",";",["T_WHITESPACE","\n            ",198],"}",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n\n        ",200],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_copyIndexDataToMainTable",202],"(",["T_VARIABLE","$processIds",202],")",";",["T_WHITESPACE","\n\n        ",202],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Process product mass update action\n     *\n     * @param Mage_Index_Model_Event $event\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",207],["T_WHITESPACE","\n    ",212],["T_PUBLIC","public",213],["T_WHITESPACE"," ",213],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","catalogProductMassAction",213],"(",["T_STRING","Mage_Index_Model_Event",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$event",213],")",["T_WHITESPACE","\n    ",213],"{",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$data",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$event",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getNewData",215],"(",")",";",["T_WHITESPACE","\n        ",215],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_EMPTY","empty",216],"(",["T_VARIABLE","$data",216],"[",["T_CONSTANT_ENCAPSED_STRING","'reindex_price_product_ids'",216],"]",")",")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$this",217],";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n\n        ",218],["T_VARIABLE","$processIds",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$data",220],"[",["T_CONSTANT_ENCAPSED_STRING","'reindex_price_product_ids'",220],"]",";",["T_WHITESPACE","\n\n        ",220],["T_VARIABLE","$write",222],["T_WHITESPACE","  ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_getWriteAdapter",222],"(",")",";",["T_WHITESPACE","\n        ",222],["T_VARIABLE","$select",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_VARIABLE","$write",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","select",223],"(",")",["T_WHITESPACE","\n            ",223],["T_OBJECT_OPERATOR","->",224],["T_STRING","from",224],"(",["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getTable",224],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",224],")",",",["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",224],")",";",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$pCount",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$write",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","fetchOne",225],"(",["T_VARIABLE","$select",225],")",";",["T_WHITESPACE","\n\n        ",225],["T_COMMENT","\/\/ if affected more 30% of all products - run reindex all products\n",227],["T_WHITESPACE","        ",228],["T_IF","if",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$pCount",228],["T_WHITESPACE"," ",228],"*",["T_WHITESPACE"," ",228],["T_DNUMBER","0.3",228],["T_WHITESPACE"," ",228],"<",["T_WHITESPACE"," ",228],["T_STRING","count",228],"(",["T_VARIABLE","$processIds",228],")",")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_RETURN","return",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","reindexAll",229],"(",")",";",["T_WHITESPACE","\n        ",229],"}",["T_WHITESPACE","\n\n        ",230],["T_COMMENT","\/\/ calculate relations\n",232],["T_WHITESPACE","        ",233],["T_VARIABLE","$select",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$write",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","select",233],"(",")",["T_WHITESPACE","\n            ",233],["T_OBJECT_OPERATOR","->",234],["T_STRING","from",234],"(",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getTable",234],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_relation'",234],")",",",["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT parent_id)'",234],")",["T_WHITESPACE","\n            ",234],["T_OBJECT_OPERATOR","->",235],["T_STRING","where",235],"(",["T_CONSTANT_ENCAPSED_STRING","'child_id IN(?)'",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$processIds",235],")",";",["T_WHITESPACE","\n        ",235],["T_VARIABLE","$aCount",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_VARIABLE","$write",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","fetchOne",236],"(",["T_VARIABLE","$select",236],")",";",["T_WHITESPACE","\n        ",236],["T_VARIABLE","$select",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$write",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","select",237],"(",")",["T_WHITESPACE","\n            ",237],["T_OBJECT_OPERATOR","->",238],["T_STRING","from",238],"(",["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getTable",238],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_relation'",238],")",",",["T_WHITESPACE"," ",238],["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT child_id)'",238],")",["T_WHITESPACE","\n            ",238],["T_OBJECT_OPERATOR","->",239],["T_STRING","where",239],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id IN(?)'",239],",",["T_WHITESPACE"," ",239],["T_VARIABLE","$processIds",239],")",";",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$bCount",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$write",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","fetchOne",240],"(",["T_VARIABLE","$select",240],")",";",["T_WHITESPACE","\n\n        ",240],["T_COMMENT","\/\/ if affected with relations more 30% of all products - run reindex all products\n",242],["T_WHITESPACE","        ",243],["T_IF","if",243],["T_WHITESPACE"," ",243],"(",["T_VARIABLE","$pCount",243],["T_WHITESPACE"," ",243],"*",["T_WHITESPACE"," ",243],["T_DNUMBER","0.3",243],["T_WHITESPACE"," ",243],"<",["T_WHITESPACE"," ",243],["T_STRING","count",243],"(",["T_VARIABLE","$processIds",243],")",["T_WHITESPACE"," ",243],"+",["T_WHITESPACE"," ",243],["T_VARIABLE","$aCount",243],["T_WHITESPACE"," ",243],"+",["T_WHITESPACE"," ",243],["T_VARIABLE","$bCount",243],")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n            ",243],["T_RETURN","return",244],["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","reindexAll",244],"(",")",";",["T_WHITESPACE","\n        ",244],"}",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","reindexProductIds",246],"(",["T_VARIABLE","$processIds",246],")",";",["T_WHITESPACE","\n        ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],";",["T_WHITESPACE","\n    ",247],"}",["T_WHITESPACE","\n\n    ",248],["T_DOC_COMMENT","\/**\n     * Reindex product prices for specified product ids\n     *\n     * @param array | int $ids\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",250],["T_WHITESPACE","\n    ",255],["T_PUBLIC","public",256],["T_WHITESPACE"," ",256],["T_FUNCTION","function",256],["T_WHITESPACE"," ",256],["T_STRING","reindexProductIds",256],"(",["T_VARIABLE","$ids",256],")",["T_WHITESPACE","\n    ",256],"{",["T_WHITESPACE","\n        ",257],["T_IF","if",258],["T_WHITESPACE"," ",258],"(",["T_EMPTY","empty",258],"(",["T_VARIABLE","$ids",258],")",")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_RETURN","return",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],";",["T_WHITESPACE","\n        ",259],"}",["T_WHITESPACE","\n        ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(","!",["T_STRING","is_array",261],"(",["T_VARIABLE","$ids",261],")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_VARIABLE","$ids",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_ARRAY","array",262],"(",["T_VARIABLE","$ids",262],")",";",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","clearTemporaryIndexTable",264],"(",")",";",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$write",265],["T_WHITESPACE","  ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_getWriteAdapter",265],"(",")",";",["T_WHITESPACE","\n        ",265],["T_COMMENT","\/\/ retrieve products types\n",266],["T_WHITESPACE","        ",267],["T_VARIABLE","$select",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$write",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","select",267],"(",")",["T_WHITESPACE","\n            ",267],["T_OBJECT_OPERATOR","->",268],["T_STRING","from",268],"(",["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getTable",268],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",268],")",",",["T_WHITESPACE"," ",268],["T_ARRAY","array",268],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",268],",",["T_WHITESPACE"," ",268],["T_CONSTANT_ENCAPSED_STRING","'type_id'",268],")",")",["T_WHITESPACE","\n            ",268],["T_OBJECT_OPERATOR","->",269],["T_STRING","where",269],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$ids",269],")",";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$pairs",270],["T_WHITESPACE","  ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$write",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","fetchPairs",270],"(",["T_VARIABLE","$select",270],")",";",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$byType",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_ARRAY","array",271],"(",")",";",["T_WHITESPACE","\n        ",271],["T_FOREACH","foreach",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$pairs",272],["T_WHITESPACE"," ",272],["T_AS","as",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$productId",272],["T_WHITESPACE"," ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$productType",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$byType",273],"[",["T_VARIABLE","$productType",273],"]","[",["T_VARIABLE","$productId",273],"]",["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$productId",273],";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE","\n\n        ",274],["T_VARIABLE","$compositeIds",276],["T_WHITESPACE","    ",276],"=",["T_WHITESPACE"," ",276],["T_ARRAY","array",276],"(",")",";",["T_WHITESPACE","\n        ",276],["T_VARIABLE","$notCompositeIds",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_ARRAY","array",277],"(",")",";",["T_WHITESPACE","\n\n        ",277],["T_FOREACH","foreach",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$byType",279],["T_WHITESPACE"," ",279],["T_AS","as",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$productType",279],["T_WHITESPACE"," ",279],["T_DOUBLE_ARROW","=>",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$entityIds",279],")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n            ",279],["T_VARIABLE","$indexer",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","_getIndexer",280],"(",["T_VARIABLE","$productType",280],")",";",["T_WHITESPACE","\n            ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$indexer",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getIsComposite",281],"(",")",")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n                ",281],["T_VARIABLE","$compositeIds",282],["T_WHITESPACE"," ",282],["T_PLUS_EQUAL","+=",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$entityIds",282],";",["T_WHITESPACE","\n            ",282],"}",["T_WHITESPACE"," ",283],["T_ELSE","else",283],["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n                ",283],["T_VARIABLE","$notCompositeIds",284],["T_WHITESPACE"," ",284],["T_PLUS_EQUAL","+=",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$entityIds",284],";",["T_WHITESPACE","\n            ",284],"}",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n\n        ",286],["T_IF","if",288],["T_WHITESPACE"," ",288],"(","!",["T_EMPTY","empty",288],"(",["T_VARIABLE","$notCompositeIds",288],")",")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$select",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$write",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","select",289],"(",")",["T_WHITESPACE","\n                ",289],["T_OBJECT_OPERATOR","->",290],["T_STRING","from",290],"(",["T_WHITESPACE","\n                    ",290],["T_ARRAY","array",291],"(",["T_CONSTANT_ENCAPSED_STRING","'l'",291],["T_WHITESPACE"," ",291],["T_DOUBLE_ARROW","=>",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getTable",291],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_relation'",291],")",")",",",["T_WHITESPACE","\n                    ",291],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",292],")",["T_WHITESPACE","\n                ",292],["T_OBJECT_OPERATOR","->",293],["T_STRING","join",293],"(",["T_WHITESPACE","\n                    ",293],["T_ARRAY","array",294],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",294],["T_WHITESPACE"," ",294],["T_DOUBLE_ARROW","=>",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getTable",294],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",294],")",")",",",["T_WHITESPACE","\n                    ",294],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = l.parent_id'",295],",",["T_WHITESPACE","\n                    ",295],["T_ARRAY","array",296],"(",["T_CONSTANT_ENCAPSED_STRING","'type_id'",296],")",")",["T_WHITESPACE","\n                ",296],["T_OBJECT_OPERATOR","->",297],["T_STRING","where",297],"(",["T_CONSTANT_ENCAPSED_STRING","'l.child_id IN(?)'",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$notCompositeIds",297],")",";",["T_WHITESPACE","\n            ",297],["T_VARIABLE","$pairs",298],["T_WHITESPACE","  ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$write",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","fetchPairs",298],"(",["T_VARIABLE","$select",298],")",";",["T_WHITESPACE","\n            ",298],["T_FOREACH","foreach",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$pairs",299],["T_WHITESPACE"," ",299],["T_AS","as",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$productId",299],["T_WHITESPACE"," ",299],["T_DOUBLE_ARROW","=>",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$productType",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                ",299],["T_IF","if",300],["T_WHITESPACE"," ",300],"(","!",["T_STRING","in_array",300],"(",["T_VARIABLE","$productId",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$ids",300],")",")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n                    ",300],["T_VARIABLE","$ids",301],"[","]",["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$productId",301],";",["T_WHITESPACE","\n                    ",301],["T_VARIABLE","$byType",302],"[",["T_VARIABLE","$productType",302],"]","[",["T_VARIABLE","$productId",302],"]",["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$productId",302],";",["T_WHITESPACE","\n                    ",302],["T_VARIABLE","$compositeIds",303],"[",["T_VARIABLE","$productId",303],"]",["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$productId",303],";",["T_WHITESPACE","\n                ",303],"}",["T_WHITESPACE","\n            ",304],"}",["T_WHITESPACE","\n        ",305],"}",["T_WHITESPACE","\n\n        ",306],["T_IF","if",308],["T_WHITESPACE"," ",308],"(","!",["T_EMPTY","empty",308],"(",["T_VARIABLE","$compositeIds",308],")",")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","_copyRelationIndexData",309],"(",["T_VARIABLE","$compositeIds",309],",",["T_WHITESPACE"," ",309],["T_VARIABLE","$notCompositeIds",309],")",";",["T_WHITESPACE","\n        ",309],"}",["T_WHITESPACE","\n\n        ",310],["T_VARIABLE","$indexers",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","getTypeIndexers",312],"(",")",";",["T_WHITESPACE","\n        ",312],["T_FOREACH","foreach",313],["T_WHITESPACE"," ",313],"(",["T_VARIABLE","$indexers",313],["T_WHITESPACE"," ",313],["T_AS","as",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$indexer",313],")",["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n            ",313],["T_IF","if",314],["T_WHITESPACE"," ",314],"(","!",["T_EMPTY","empty",314],"(",["T_VARIABLE","$byType",314],"[",["T_VARIABLE","$indexer",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getTypeId",314],"(",")","]",")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n                ",314],["T_VARIABLE","$indexer",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","reindexEntity",315],"(",["T_VARIABLE","$byType",315],"[",["T_VARIABLE","$indexer",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getTypeId",315],"(",")","]",")",";",["T_WHITESPACE","\n            ",315],"}",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE","\n\n        ",317],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_copyIndexDataToMainTable",319],"(",["T_VARIABLE","$ids",319],")",";",["T_WHITESPACE","\n        ",319],["T_RETURN","return",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * Retrieve Price indexer by Product Type\n     *\n     * @param string $productTypeId\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Interface\n     * @throws Mage_Core_Exception\n     *\/",323],["T_WHITESPACE","\n    ",329],["T_PROTECTED","protected",330],["T_WHITESPACE"," ",330],["T_FUNCTION","function",330],["T_WHITESPACE"," ",330],["T_STRING","_getIndexer",330],"(",["T_VARIABLE","$productTypeId",330],")",["T_WHITESPACE","\n    ",330],"{",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$types",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getTypeIndexers",332],"(",")",";",["T_WHITESPACE","\n        ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(","!",["T_ISSET","isset",333],"(",["T_VARIABLE","$types",333],"[",["T_VARIABLE","$productTypeId",333],"]",")",")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_STRING","Mage",334],["T_DOUBLE_COLON","::",334],["T_STRING","throwException",334],"(",["T_STRING","Mage",334],["T_DOUBLE_COLON","::",334],["T_STRING","helper",334],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",334],")",["T_OBJECT_OPERATOR","->",334],["T_STRING","__",334],"(",["T_CONSTANT_ENCAPSED_STRING","'Unsupported product type \"%s\".'",334],",",["T_WHITESPACE"," ",334],["T_VARIABLE","$productTypeId",334],")",")",";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n        ",335],["T_RETURN","return",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$types",336],"[",["T_VARIABLE","$productTypeId",336],"]",";",["T_WHITESPACE","\n    ",336],"}",["T_WHITESPACE","\n\n    ",337],["T_DOC_COMMENT","\/**\n     * Retrieve price indexers per product type\n     *\n     * @return array\n     *\/",339],["T_WHITESPACE","\n    ",343],["T_PUBLIC","public",344],["T_WHITESPACE"," ",344],["T_FUNCTION","function",344],["T_WHITESPACE"," ",344],["T_STRING","getTypeIndexers",344],"(",")",["T_WHITESPACE","\n    ",344],"{",["T_WHITESPACE","\n        ",345],["T_IF","if",346],["T_WHITESPACE"," ",346],"(",["T_STRING","is_null",346],"(",["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_indexers",346],")",")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n            ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_indexers",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_ARRAY","array",347],"(",")",";",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$types",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_STRING","Mage",348],["T_DOUBLE_COLON","::",348],["T_STRING","getSingleton",348],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_type'",348],")",["T_OBJECT_OPERATOR","->",348],["T_STRING","getTypesByPriority",348],"(",")",";",["T_WHITESPACE","\n            ",348],["T_FOREACH","foreach",349],["T_WHITESPACE"," ",349],"(",["T_VARIABLE","$types",349],["T_WHITESPACE"," ",349],["T_AS","as",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$typeId",349],["T_WHITESPACE"," ",349],["T_DOUBLE_ARROW","=>",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$typeInfo",349],")",["T_WHITESPACE"," ",349],"{",["T_WHITESPACE","\n                ",349],["T_IF","if",350],["T_WHITESPACE"," ",350],"(",["T_ISSET","isset",350],"(",["T_VARIABLE","$typeInfo",350],"[",["T_CONSTANT_ENCAPSED_STRING","'price_indexer'",350],"]",")",")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                    ",350],["T_VARIABLE","$modelName",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_VARIABLE","$typeInfo",351],"[",["T_CONSTANT_ENCAPSED_STRING","'price_indexer'",351],"]",";",["T_WHITESPACE","\n                ",351],"}",["T_WHITESPACE"," ",352],["T_ELSE","else",352],["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n                    ",352],["T_VARIABLE","$modelName",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_defaultPriceIndexer",353],";",["T_WHITESPACE","\n                ",353],"}",["T_WHITESPACE","\n                ",354],["T_VARIABLE","$isComposite",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],"!",["T_EMPTY","empty",355],"(",["T_VARIABLE","$typeInfo",355],"[",["T_CONSTANT_ENCAPSED_STRING","'composite'",355],"]",")",";",["T_WHITESPACE","\n                ",355],["T_VARIABLE","$indexer",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_STRING","Mage",356],["T_DOUBLE_COLON","::",356],["T_STRING","getResourceModel",356],"(",["T_VARIABLE","$modelName",356],")",["T_WHITESPACE","\n                    ",356],["T_OBJECT_OPERATOR","->",357],["T_STRING","setTypeId",357],"(",["T_VARIABLE","$typeId",357],")",["T_WHITESPACE","\n                    ",357],["T_OBJECT_OPERATOR","->",358],["T_STRING","setIsComposite",358],"(",["T_VARIABLE","$isComposite",358],")",";",["T_WHITESPACE","\n\n                ",358],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","_indexers",360],"[",["T_VARIABLE","$typeId",360],"]",["T_WHITESPACE"," ",360],"=",["T_WHITESPACE"," ",360],["T_VARIABLE","$indexer",360],";",["T_WHITESPACE","\n            ",360],"}",["T_WHITESPACE","\n        ",361],"}",["T_WHITESPACE","\n\n        ",362],["T_RETURN","return",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_indexers",364],";",["T_WHITESPACE","\n    ",364],"}",["T_WHITESPACE","\n\n    ",365],["T_DOC_COMMENT","\/**\n     * Rebuild all index data\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",367],["T_WHITESPACE","\n    ",371],["T_PUBLIC","public",372],["T_WHITESPACE"," ",372],["T_FUNCTION","function",372],["T_WHITESPACE"," ",372],["T_STRING","reindexAll",372],"(",")",["T_WHITESPACE","\n    ",372],"{",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","useIdxTable",374],"(",["T_STRING","true",374],")",";",["T_WHITESPACE","\n        ",374],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","beginTransaction",375],"(",")",";",["T_WHITESPACE","\n        ",375],["T_TRY","try",376],["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","clearTemporaryIndexTable",377],"(",")",";",["T_WHITESPACE","\n            ",377],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_prepareWebsiteDateTable",378],"(",")",";",["T_WHITESPACE","\n            ",378],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","_prepareTierPriceIndex",379],"(",")",";",["T_WHITESPACE","\n            ",379],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","_prepareGroupPriceIndex",380],"(",")",";",["T_WHITESPACE","\n\n            ",380],["T_VARIABLE","$indexers",382],["T_WHITESPACE"," ",382],"=",["T_WHITESPACE"," ",382],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getTypeIndexers",382],"(",")",";",["T_WHITESPACE","\n            ",382],["T_FOREACH","foreach",383],["T_WHITESPACE"," ",383],"(",["T_VARIABLE","$indexers",383],["T_WHITESPACE"," ",383],["T_AS","as",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$indexer",383],")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n                ",383],["T_DOC_COMMENT","\/** @var $indexer Mage_Catalog_Model_Resource_Product_Indexer_Price_Interface *\/",384],["T_WHITESPACE","\n                ",384],["T_VARIABLE","$indexer",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","reindexAll",385],"(",")",";",["T_WHITESPACE","\n            ",385],"}",["T_WHITESPACE","\n\n            ",386],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","syncData",388],"(",")",";",["T_WHITESPACE","\n            ",388],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","commit",389],"(",")",";",["T_WHITESPACE","\n        ",389],"}",["T_WHITESPACE"," ",390],["T_CATCH","catch",390],["T_WHITESPACE"," ",390],"(",["T_STRING","Exception",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$e",390],")",["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n            ",390],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","rollBack",391],"(",")",";",["T_WHITESPACE","\n            ",391],["T_THROW","throw",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$e",392],";",["T_WHITESPACE","\n        ",392],"}",["T_WHITESPACE","\n        ",393],["T_RETURN","return",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$this",394],";",["T_WHITESPACE","\n    ",394],"}",["T_WHITESPACE","\n\n    ",395],["T_DOC_COMMENT","\/**\n     * Retrieve table name for product tier price index\n     *\n     * @return string\n     *\/",397],["T_WHITESPACE","\n    ",401],["T_PROTECTED","protected",402],["T_WHITESPACE"," ",402],["T_FUNCTION","function",402],["T_WHITESPACE"," ",402],["T_STRING","_getTierPriceIndexTable",402],"(",")",["T_WHITESPACE","\n    ",402],"{",["T_WHITESPACE","\n        ",403],["T_RETURN","return",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","getTable",404],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_tier_price'",404],")",";",["T_WHITESPACE","\n    ",404],"}",["T_WHITESPACE","\n\n    ",405],["T_DOC_COMMENT","\/**\n     * Retrieve table name for product group price index\n     *\n     * @return string\n     *\/",407],["T_WHITESPACE","\n    ",411],["T_PROTECTED","protected",412],["T_WHITESPACE"," ",412],["T_FUNCTION","function",412],["T_WHITESPACE"," ",412],["T_STRING","_getGroupPriceIndexTable",412],"(",")",["T_WHITESPACE","\n    ",412],"{",["T_WHITESPACE","\n        ",413],["T_RETURN","return",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getTable",414],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_group_price'",414],")",";",["T_WHITESPACE","\n    ",414],"}",["T_WHITESPACE","\n\n    ",415],["T_DOC_COMMENT","\/**\n     * Prepare tier price index table\n     *\n     * @param int|array $entityIds the entity ids limitation\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",417],["T_WHITESPACE","\n    ",422],["T_PROTECTED","protected",423],["T_WHITESPACE"," ",423],["T_FUNCTION","function",423],["T_WHITESPACE"," ",423],["T_STRING","_prepareTierPriceIndex",423],"(",["T_VARIABLE","$entityIds",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_STRING","null",423],")",["T_WHITESPACE","\n    ",423],"{",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$write",425],["T_WHITESPACE"," ",425],"=",["T_WHITESPACE"," ",425],["T_VARIABLE","$this",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","_getWriteAdapter",425],"(",")",";",["T_WHITESPACE","\n        ",425],["T_VARIABLE","$table",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","_getTierPriceIndexTable",426],"(",")",";",["T_WHITESPACE","\n        ",426],["T_VARIABLE","$write",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","delete",427],"(",["T_VARIABLE","$table",427],")",";",["T_WHITESPACE","\n\n        ",427],["T_VARIABLE","$websiteExpression",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$write",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getCheckSql",429],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.website_id = 0'",429],",",["T_WHITESPACE"," ",429],["T_CONSTANT_ENCAPSED_STRING","'ROUND(tp.value * cwd.rate, 4)'",429],",",["T_WHITESPACE"," ",429],["T_CONSTANT_ENCAPSED_STRING","'tp.value'",429],")",";",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$select",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_VARIABLE","$write",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","select",430],"(",")",["T_WHITESPACE","\n            ",430],["T_OBJECT_OPERATOR","->",431],["T_STRING","from",431],"(",["T_WHITESPACE","\n                ",431],["T_ARRAY","array",432],"(",["T_CONSTANT_ENCAPSED_STRING","'tp'",432],["T_WHITESPACE"," ",432],["T_DOUBLE_ARROW","=>",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getValueTable",432],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",432],",",["T_WHITESPACE"," ",432],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",432],")",")",",",["T_WHITESPACE","\n                ",432],["T_ARRAY","array",433],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",433],")",")",["T_WHITESPACE","\n            ",433],["T_OBJECT_OPERATOR","->",434],["T_STRING","join",434],"(",["T_WHITESPACE","\n                ",434],["T_ARRAY","array",435],"(",["T_CONSTANT_ENCAPSED_STRING","'cg'",435],["T_WHITESPACE"," ",435],["T_DOUBLE_ARROW","=>",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getTable",435],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",435],")",")",",",["T_WHITESPACE","\n                ",435],["T_CONSTANT_ENCAPSED_STRING","'tp.all_groups = 1 OR (tp.all_groups = 0 AND tp.customer_group_id = cg.customer_group_id)'",436],",",["T_WHITESPACE","\n                ",436],["T_ARRAY","array",437],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",437],")",")",["T_WHITESPACE","\n            ",437],["T_OBJECT_OPERATOR","->",438],["T_STRING","join",438],"(",["T_WHITESPACE","\n                ",438],["T_ARRAY","array",439],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",439],["T_WHITESPACE"," ",439],["T_DOUBLE_ARROW","=>",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$this",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getTable",439],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",439],")",")",",",["T_WHITESPACE","\n                ",439],["T_CONSTANT_ENCAPSED_STRING","'tp.website_id = 0 OR tp.website_id = cw.website_id'",440],",",["T_WHITESPACE","\n                ",440],["T_ARRAY","array",441],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",441],")",")",["T_WHITESPACE","\n            ",441],["T_OBJECT_OPERATOR","->",442],["T_STRING","join",442],"(",["T_WHITESPACE","\n                ",442],["T_ARRAY","array",443],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd'",443],["T_WHITESPACE"," ",443],["T_DOUBLE_ARROW","=>",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","_getWebsiteDateTable",443],"(",")",")",",",["T_WHITESPACE","\n                ",443],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = cwd.website_id'",444],",",["T_WHITESPACE","\n                ",444],["T_ARRAY","array",445],"(",")",")",["T_WHITESPACE","\n            ",445],["T_OBJECT_OPERATOR","->",446],["T_STRING","where",446],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",446],")",["T_WHITESPACE","\n            ",446],["T_OBJECT_OPERATOR","->",447],["T_STRING","columns",447],"(",["T_NEW","new",447],["T_WHITESPACE"," ",447],["T_STRING","Zend_Db_Expr",447],"(","\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",447],["T_CURLY_OPEN","{",447],["T_VARIABLE","$websiteExpression",447],"}",["T_ENCAPSED_AND_WHITESPACE",")",447],"\"",")",")",["T_WHITESPACE","\n            ",447],["T_OBJECT_OPERATOR","->",448],["T_STRING","group",448],"(",["T_ARRAY","array",448],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id'",448],",",["T_WHITESPACE"," ",448],["T_CONSTANT_ENCAPSED_STRING","'cg.customer_group_id'",448],",",["T_WHITESPACE"," ",448],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",448],")",")",";",["T_WHITESPACE","\n\n        ",448],["T_IF","if",450],["T_WHITESPACE"," ",450],"(","!",["T_EMPTY","empty",450],"(",["T_VARIABLE","$entityIds",450],")",")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n            ",450],["T_VARIABLE","$select",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","where",451],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id IN(?)'",451],",",["T_WHITESPACE"," ",451],["T_VARIABLE","$entityIds",451],")",";",["T_WHITESPACE","\n        ",451],"}",["T_WHITESPACE","\n\n        ",452],["T_VARIABLE","$query",454],["T_WHITESPACE"," ",454],"=",["T_WHITESPACE"," ",454],["T_VARIABLE","$select",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","insertFromSelect",454],"(",["T_VARIABLE","$table",454],")",";",["T_WHITESPACE","\n        ",454],["T_VARIABLE","$write",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","query",455],"(",["T_VARIABLE","$query",455],")",";",["T_WHITESPACE","\n\n        ",455],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],";",["T_WHITESPACE","\n    ",457],"}",["T_WHITESPACE","\n\n    ",458],["T_DOC_COMMENT","\/**\n     * Prepare group price index table\n     *\n     * @param int|array $entityIds the entity ids limitation\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",460],["T_WHITESPACE","\n    ",465],["T_PROTECTED","protected",466],["T_WHITESPACE"," ",466],["T_FUNCTION","function",466],["T_WHITESPACE"," ",466],["T_STRING","_prepareGroupPriceIndex",466],"(",["T_VARIABLE","$entityIds",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_STRING","null",466],")",["T_WHITESPACE","\n    ",466],"{",["T_WHITESPACE","\n        ",467],["T_VARIABLE","$write",468],["T_WHITESPACE"," ",468],"=",["T_WHITESPACE"," ",468],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","_getWriteAdapter",468],"(",")",";",["T_WHITESPACE","\n        ",468],["T_VARIABLE","$table",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_getGroupPriceIndexTable",469],"(",")",";",["T_WHITESPACE","\n        ",469],["T_VARIABLE","$write",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","delete",470],"(",["T_VARIABLE","$table",470],")",";",["T_WHITESPACE","\n\n        ",470],["T_VARIABLE","$websiteExpression",472],["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$write",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getCheckSql",472],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.website_id = 0'",472],",",["T_WHITESPACE"," ",472],["T_CONSTANT_ENCAPSED_STRING","'ROUND(gp.value * cwd.rate, 4)'",472],",",["T_WHITESPACE"," ",472],["T_CONSTANT_ENCAPSED_STRING","'gp.value'",472],")",";",["T_WHITESPACE","\n        ",472],["T_VARIABLE","$select",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_VARIABLE","$write",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","select",473],"(",")",["T_WHITESPACE","\n            ",473],["T_OBJECT_OPERATOR","->",474],["T_STRING","from",474],"(",["T_WHITESPACE","\n                ",474],["T_ARRAY","array",475],"(",["T_CONSTANT_ENCAPSED_STRING","'gp'",475],["T_WHITESPACE"," ",475],["T_DOUBLE_ARROW","=>",475],["T_WHITESPACE"," ",475],["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","getValueTable",475],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",475],",",["T_WHITESPACE"," ",475],["T_CONSTANT_ENCAPSED_STRING","'group_price'",475],")",")",",",["T_WHITESPACE","\n                ",475],["T_ARRAY","array",476],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",476],")",")",["T_WHITESPACE","\n            ",476],["T_OBJECT_OPERATOR","->",477],["T_STRING","join",477],"(",["T_WHITESPACE","\n                ",477],["T_ARRAY","array",478],"(",["T_CONSTANT_ENCAPSED_STRING","'cg'",478],["T_WHITESPACE"," ",478],["T_DOUBLE_ARROW","=>",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getTable",478],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",478],")",")",",",["T_WHITESPACE","\n                ",478],["T_CONSTANT_ENCAPSED_STRING","'gp.all_groups = 1 OR (gp.all_groups = 0 AND gp.customer_group_id = cg.customer_group_id)'",479],",",["T_WHITESPACE","\n                ",479],["T_ARRAY","array",480],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",480],")",")",["T_WHITESPACE","\n            ",480],["T_OBJECT_OPERATOR","->",481],["T_STRING","join",481],"(",["T_WHITESPACE","\n                ",481],["T_ARRAY","array",482],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",482],["T_WHITESPACE"," ",482],["T_DOUBLE_ARROW","=>",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getTable",482],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",482],")",")",",",["T_WHITESPACE","\n                ",482],["T_CONSTANT_ENCAPSED_STRING","'gp.website_id = 0 OR gp.website_id = cw.website_id'",483],",",["T_WHITESPACE","\n                ",483],["T_ARRAY","array",484],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",484],")",")",["T_WHITESPACE","\n            ",484],["T_OBJECT_OPERATOR","->",485],["T_STRING","join",485],"(",["T_WHITESPACE","\n                ",485],["T_ARRAY","array",486],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd'",486],["T_WHITESPACE"," ",486],["T_DOUBLE_ARROW","=>",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","_getWebsiteDateTable",486],"(",")",")",",",["T_WHITESPACE","\n                ",486],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = cwd.website_id'",487],",",["T_WHITESPACE","\n                ",487],["T_ARRAY","array",488],"(",")",")",["T_WHITESPACE","\n            ",488],["T_OBJECT_OPERATOR","->",489],["T_STRING","where",489],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",489],")",["T_WHITESPACE","\n            ",489],["T_OBJECT_OPERATOR","->",490],["T_STRING","columns",490],"(",["T_NEW","new",490],["T_WHITESPACE"," ",490],["T_STRING","Zend_Db_Expr",490],"(","\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",490],["T_CURLY_OPEN","{",490],["T_VARIABLE","$websiteExpression",490],"}",["T_ENCAPSED_AND_WHITESPACE",")",490],"\"",")",")",["T_WHITESPACE","\n            ",490],["T_OBJECT_OPERATOR","->",491],["T_STRING","group",491],"(",["T_ARRAY","array",491],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.entity_id'",491],",",["T_WHITESPACE"," ",491],["T_CONSTANT_ENCAPSED_STRING","'cg.customer_group_id'",491],",",["T_WHITESPACE"," ",491],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",491],")",")",";",["T_WHITESPACE","\n\n        ",491],["T_IF","if",493],["T_WHITESPACE"," ",493],"(","!",["T_EMPTY","empty",493],"(",["T_VARIABLE","$entityIds",493],")",")",["T_WHITESPACE"," ",493],"{",["T_WHITESPACE","\n            ",493],["T_VARIABLE","$select",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","where",494],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.entity_id IN(?)'",494],",",["T_WHITESPACE"," ",494],["T_VARIABLE","$entityIds",494],")",";",["T_WHITESPACE","\n        ",494],"}",["T_WHITESPACE","\n\n        ",495],["T_VARIABLE","$query",497],["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_VARIABLE","$select",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","insertFromSelect",497],"(",["T_VARIABLE","$table",497],")",";",["T_WHITESPACE","\n        ",497],["T_VARIABLE","$write",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","query",498],"(",["T_VARIABLE","$query",498],")",";",["T_WHITESPACE","\n\n        ",498],["T_RETURN","return",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$this",500],";",["T_WHITESPACE","\n    ",500],"}",["T_WHITESPACE","\n\n    ",501],["T_DOC_COMMENT","\/**\n     * Copy relations product index from primary index to temporary index table by parent entity\n     *\n     * @package array|int $excludeIds\n     *\n     * @param array|int $parentIds\n     * @param unknown_type $excludeIds\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",503],["T_WHITESPACE","\n    ",511],["T_PROTECTED","protected",512],["T_WHITESPACE"," ",512],["T_FUNCTION","function",512],["T_WHITESPACE"," ",512],["T_STRING","_copyRelationIndexData",512],"(",["T_VARIABLE","$parentIds",512],",",["T_WHITESPACE"," ",512],["T_VARIABLE","$excludeIds",512],["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],["T_STRING","null",512],")",["T_WHITESPACE","\n    ",512],"{",["T_WHITESPACE","\n        ",513],["T_VARIABLE","$write",514],["T_WHITESPACE","  ",514],"=",["T_WHITESPACE"," ",514],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","_getWriteAdapter",514],"(",")",";",["T_WHITESPACE","\n        ",514],["T_VARIABLE","$select",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_VARIABLE","$write",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","select",515],"(",")",["T_WHITESPACE","\n            ",515],["T_OBJECT_OPERATOR","->",516],["T_STRING","from",516],"(",["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","getTable",516],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_relation'",516],")",",",["T_WHITESPACE"," ",516],["T_ARRAY","array",516],"(",["T_CONSTANT_ENCAPSED_STRING","'child_id'",516],")",")",["T_WHITESPACE","\n            ",516],["T_OBJECT_OPERATOR","->",517],["T_STRING","where",517],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id IN(?)'",517],",",["T_WHITESPACE"," ",517],["T_VARIABLE","$parentIds",517],")",";",["T_WHITESPACE","\n        ",517],["T_IF","if",518],["T_WHITESPACE"," ",518],"(","!",["T_EMPTY","empty",518],"(",["T_VARIABLE","$excludeIds",518],")",")",["T_WHITESPACE"," ",518],"{",["T_WHITESPACE","\n            ",518],["T_VARIABLE","$select",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","where",519],"(",["T_CONSTANT_ENCAPSED_STRING","'child_id NOT IN(?)'",519],",",["T_WHITESPACE"," ",519],["T_VARIABLE","$excludeIds",519],")",";",["T_WHITESPACE","\n        ",519],"}",["T_WHITESPACE","\n\n        ",520],["T_VARIABLE","$children",522],["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_VARIABLE","$write",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","fetchCol",522],"(",["T_VARIABLE","$select",522],")",";",["T_WHITESPACE","\n\n        ",522],["T_IF","if",524],["T_WHITESPACE"," ",524],"(",["T_VARIABLE","$children",524],")",["T_WHITESPACE"," ",524],"{",["T_WHITESPACE","\n            ",524],["T_VARIABLE","$select",525],["T_WHITESPACE"," ",525],"=",["T_WHITESPACE"," ",525],["T_VARIABLE","$write",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","select",525],"(",")",["T_WHITESPACE","\n                ",525],["T_OBJECT_OPERATOR","->",526],["T_STRING","from",526],"(",["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getMainTable",526],"(",")",")",["T_WHITESPACE","\n                ",526],["T_OBJECT_OPERATOR","->",527],["T_STRING","where",527],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",527],",",["T_WHITESPACE"," ",527],["T_VARIABLE","$children",527],")",";",["T_WHITESPACE","\n            ",527],["T_VARIABLE","$query",528],["T_WHITESPACE","  ",528],"=",["T_WHITESPACE"," ",528],["T_VARIABLE","$select",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","insertFromSelect",528],"(",["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getIdxTable",528],"(",")",",",["T_WHITESPACE"," ",528],["T_ARRAY","array",528],"(",")",",",["T_WHITESPACE"," ",528],["T_STRING","false",528],")",";",["T_WHITESPACE","\n            ",528],["T_VARIABLE","$write",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","query",529],"(",["T_VARIABLE","$query",529],")",";",["T_WHITESPACE","\n        ",529],"}",["T_WHITESPACE","\n\n        ",530],["T_RETURN","return",532],["T_WHITESPACE"," ",532],["T_VARIABLE","$this",532],";",["T_WHITESPACE","\n    ",532],"}",["T_WHITESPACE","\n\n    ",533],["T_DOC_COMMENT","\/**\n     * Retrieve website current dates table name\n     *\n     * @return string\n     *\/",535],["T_WHITESPACE","\n    ",539],["T_PROTECTED","protected",540],["T_WHITESPACE"," ",540],["T_FUNCTION","function",540],["T_WHITESPACE"," ",540],["T_STRING","_getWebsiteDateTable",540],"(",")",["T_WHITESPACE","\n    ",540],"{",["T_WHITESPACE","\n        ",541],["T_RETURN","return",542],["T_WHITESPACE"," ",542],["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getTable",542],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_website'",542],")",";",["T_WHITESPACE","\n    ",542],"}",["T_WHITESPACE","\n\n    ",543],["T_DOC_COMMENT","\/**\n     * Prepare website current dates table\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price\n     *\/",545],["T_WHITESPACE","\n    ",549],["T_PROTECTED","protected",550],["T_WHITESPACE"," ",550],["T_FUNCTION","function",550],["T_WHITESPACE"," ",550],["T_STRING","_prepareWebsiteDateTable",550],"(",")",["T_WHITESPACE","\n    ",550],"{",["T_WHITESPACE","\n        ",551],["T_VARIABLE","$write",552],["T_WHITESPACE"," ",552],"=",["T_WHITESPACE"," ",552],["T_VARIABLE","$this",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","_getWriteAdapter",552],"(",")",";",["T_WHITESPACE","\n        ",552],["T_VARIABLE","$baseCurrency",553],["T_WHITESPACE"," ",553],"=",["T_WHITESPACE"," ",553],["T_STRING","Mage",553],["T_DOUBLE_COLON","::",553],["T_STRING","app",553],"(",")",["T_OBJECT_OPERATOR","->",553],["T_STRING","getBaseCurrencyCode",553],"(",")",";",["T_WHITESPACE","\n\n        ",553],["T_VARIABLE","$select",555],["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],["T_VARIABLE","$write",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","select",555],"(",")",["T_WHITESPACE","\n            ",555],["T_OBJECT_OPERATOR","->",556],["T_STRING","from",556],"(",["T_WHITESPACE","\n                ",556],["T_ARRAY","array",557],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",557],["T_WHITESPACE"," ",557],["T_DOUBLE_ARROW","=>",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getTable",557],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",557],")",")",",",["T_WHITESPACE","\n                ",557],["T_ARRAY","array",558],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",558],")",")",["T_WHITESPACE","\n            ",558],["T_OBJECT_OPERATOR","->",559],["T_STRING","join",559],"(",["T_WHITESPACE","\n                ",559],["T_ARRAY","array",560],"(",["T_CONSTANT_ENCAPSED_STRING","'csg'",560],["T_WHITESPACE"," ",560],["T_DOUBLE_ARROW","=>",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getTable",560],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",560],")",")",",",["T_WHITESPACE","\n                ",560],["T_CONSTANT_ENCAPSED_STRING","'cw.default_group_id = csg.group_id'",561],",",["T_WHITESPACE","\n                ",561],["T_ARRAY","array",562],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",562],["T_WHITESPACE"," ",562],["T_DOUBLE_ARROW","=>",562],["T_WHITESPACE"," ",562],["T_CONSTANT_ENCAPSED_STRING","'default_store_id'",562],")",")",["T_WHITESPACE","\n            ",562],["T_OBJECT_OPERATOR","->",563],["T_STRING","where",563],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",563],")",";",["T_WHITESPACE","\n\n\n        ",563],["T_VARIABLE","$data",566],["T_WHITESPACE"," ",566],"=",["T_WHITESPACE"," ",566],["T_ARRAY","array",566],"(",")",";",["T_WHITESPACE","\n        ",566],["T_FOREACH","foreach",567],["T_WHITESPACE"," ",567],"(",["T_VARIABLE","$write",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","fetchAll",567],"(",["T_VARIABLE","$select",567],")",["T_WHITESPACE"," ",567],["T_AS","as",567],["T_WHITESPACE"," ",567],["T_VARIABLE","$item",567],")",["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n            ",567],["T_DOC_COMMENT","\/** @var $website Mage_Core_Model_Website *\/",568],["T_WHITESPACE","\n            ",568],["T_VARIABLE","$website",569],["T_WHITESPACE"," ",569],"=",["T_WHITESPACE"," ",569],["T_STRING","Mage",569],["T_DOUBLE_COLON","::",569],["T_STRING","app",569],"(",")",["T_OBJECT_OPERATOR","->",569],["T_STRING","getWebsite",569],"(",["T_VARIABLE","$item",569],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",569],"]",")",";",["T_WHITESPACE","\n\n            ",569],["T_IF","if",571],["T_WHITESPACE"," ",571],"(",["T_VARIABLE","$website",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","getBaseCurrencyCode",571],"(",")",["T_WHITESPACE"," ",571],["T_IS_NOT_EQUAL","!=",571],["T_WHITESPACE"," ",571],["T_VARIABLE","$baseCurrency",571],")",["T_WHITESPACE"," ",571],"{",["T_WHITESPACE","\n                ",571],["T_VARIABLE","$rate",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_STRING","Mage",572],["T_DOUBLE_COLON","::",572],["T_STRING","getModel",572],"(",["T_CONSTANT_ENCAPSED_STRING","'directory\/currency'",572],")",["T_WHITESPACE","\n                    ",572],["T_OBJECT_OPERATOR","->",573],["T_STRING","load",573],"(",["T_VARIABLE","$baseCurrency",573],")",["T_WHITESPACE","\n                    ",573],["T_OBJECT_OPERATOR","->",574],["T_STRING","getRate",574],"(",["T_VARIABLE","$website",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","getBaseCurrencyCode",574],"(",")",")",";",["T_WHITESPACE","\n                ",574],["T_IF","if",575],["T_WHITESPACE"," ",575],"(","!",["T_VARIABLE","$rate",575],")",["T_WHITESPACE"," ",575],"{",["T_WHITESPACE","\n                    ",575],["T_VARIABLE","$rate",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_LNUMBER","1",576],";",["T_WHITESPACE","\n                ",576],"}",["T_WHITESPACE","\n            ",577],"}",["T_WHITESPACE"," ",578],["T_ELSE","else",578],["T_WHITESPACE"," ",578],"{",["T_WHITESPACE","\n                ",578],["T_VARIABLE","$rate",579],["T_WHITESPACE"," ",579],"=",["T_WHITESPACE"," ",579],["T_LNUMBER","1",579],";",["T_WHITESPACE","\n            ",579],"}",["T_WHITESPACE","\n\n            ",580],["T_DOC_COMMENT","\/** @var $store Mage_Core_Model_Store *\/",582],["T_WHITESPACE","\n            ",582],["T_VARIABLE","$store",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_STRING","Mage",583],["T_DOUBLE_COLON","::",583],["T_STRING","app",583],"(",")",["T_OBJECT_OPERATOR","->",583],["T_STRING","getStore",583],"(",["T_VARIABLE","$item",583],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",583],"]",")",";",["T_WHITESPACE","\n            ",583],["T_IF","if",584],["T_WHITESPACE"," ",584],"(",["T_VARIABLE","$store",584],")",["T_WHITESPACE"," ",584],"{",["T_WHITESPACE","\n                ",584],["T_VARIABLE","$timestamp",585],["T_WHITESPACE"," ",585],"=",["T_WHITESPACE"," ",585],["T_STRING","Mage",585],["T_DOUBLE_COLON","::",585],["T_STRING","app",585],"(",")",["T_OBJECT_OPERATOR","->",585],["T_STRING","getLocale",585],"(",")",["T_OBJECT_OPERATOR","->",585],["T_STRING","storeTimeStamp",585],"(",["T_VARIABLE","$store",585],")",";",["T_WHITESPACE","\n                ",585],["T_VARIABLE","$data",586],"[","]",["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_ARRAY","array",586],"(",["T_WHITESPACE","\n                    ",586],["T_CONSTANT_ENCAPSED_STRING","'website_id'",587],["T_WHITESPACE"," ",587],["T_DOUBLE_ARROW","=>",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$website",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getId",587],"(",")",",",["T_WHITESPACE","\n                    ",587],["T_CONSTANT_ENCAPSED_STRING","'website_date'",588],["T_WHITESPACE","       ",588],["T_DOUBLE_ARROW","=>",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","formatDate",588],"(",["T_VARIABLE","$timestamp",588],",",["T_WHITESPACE"," ",588],["T_STRING","false",588],")",",",["T_WHITESPACE","\n                    ",588],["T_CONSTANT_ENCAPSED_STRING","'rate'",589],["T_WHITESPACE","       ",589],["T_DOUBLE_ARROW","=>",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$rate",589],["T_WHITESPACE","\n                ",589],")",";",["T_WHITESPACE","\n            ",590],"}",["T_WHITESPACE","\n        ",591],"}",["T_WHITESPACE","\n\n        ",592],["T_VARIABLE","$write",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","beginTransaction",594],"(",")",";",["T_WHITESPACE","\n        ",594],["T_VARIABLE","$table",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","_getWebsiteDateTable",595],"(",")",";",["T_WHITESPACE","\n        ",595],["T_VARIABLE","$write",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","delete",596],"(",["T_VARIABLE","$table",596],")",";",["T_WHITESPACE","\n\n        ",596],["T_IF","if",598],["T_WHITESPACE"," ",598],"(",["T_VARIABLE","$data",598],")",["T_WHITESPACE"," ",598],"{",["T_WHITESPACE","\n            ",598],["T_VARIABLE","$write",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","insertMultiple",599],"(",["T_VARIABLE","$table",599],",",["T_WHITESPACE"," ",599],["T_VARIABLE","$data",599],")",";",["T_WHITESPACE","\n        ",599],"}",["T_WHITESPACE","\n        ",600],["T_VARIABLE","$write",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","commit",601],"(",")",";",["T_WHITESPACE","\n\n        ",601],["T_RETURN","return",603],["T_WHITESPACE"," ",603],["T_VARIABLE","$this",603],";",["T_WHITESPACE","\n    ",603],"}",["T_WHITESPACE","\n\n    ",604],["T_DOC_COMMENT","\/**\n     * Retrieve temporary index table name\n     *\n     * @param unknown_type $table\n     * @return string\n     *\/",606],["T_WHITESPACE","\n    ",611],["T_PUBLIC","public",612],["T_WHITESPACE"," ",612],["T_FUNCTION","function",612],["T_WHITESPACE"," ",612],["T_STRING","getIdxTable",612],"(",["T_VARIABLE","$table",612],["T_WHITESPACE"," ",612],"=",["T_WHITESPACE"," ",612],["T_STRING","null",612],")",["T_WHITESPACE","\n    ",612],"{",["T_WHITESPACE","\n        ",613],["T_IF","if",614],["T_WHITESPACE"," ",614],"(",["T_VARIABLE","$this",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","useIdxTable",614],"(",")",")",["T_WHITESPACE"," ",614],"{",["T_WHITESPACE","\n            ",614],["T_RETURN","return",615],["T_WHITESPACE"," ",615],["T_VARIABLE","$this",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","getTable",615],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_idx'",615],")",";",["T_WHITESPACE","\n        ",615],"}",["T_WHITESPACE","\n        ",616],["T_RETURN","return",617],["T_WHITESPACE"," ",617],["T_VARIABLE","$this",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getTable",617],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_tmp'",617],")",";",["T_WHITESPACE","\n    ",617],"}",["T_WHITESPACE","\n",618],"}",["T_WHITESPACE","\n",619]]