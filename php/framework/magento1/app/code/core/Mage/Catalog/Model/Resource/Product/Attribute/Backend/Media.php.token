[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog product media gallery attribute backend resource\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Attribute_Backend_Media",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","GALLERY_TABLE",37],["T_WHITESPACE","       ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_media_gallery'",37],";",["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","GALLERY_VALUE_TABLE",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_media_gallery_value'",38],";",["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","GALLERY_IMAGE_TABLE",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_media_gallery_image'",39],";",["T_WHITESPACE","\n\n    ",39],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_eventPrefix",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'catalog_product_attribute_backend_media'",41],";",["T_WHITESPACE","\n\n    ",41],["T_PRIVATE","private",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_attributeId",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","null",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Resource initialization\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","_construct",48],"(",")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_init",50],"(",["T_STRING","self",50],["T_DOUBLE_COLON","::",50],["T_STRING","GALLERY_TABLE",50],",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'value_id'",50],")",";",["T_WHITESPACE","\n    ",50],"}",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Load gallery images for product using reusable select method\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param Mage_Catalog_Model_Product_Attribute_Backend_Media $object\n     * @return array\n     *\/",53],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","loadGallery",60],"(",["T_VARIABLE","$product",60],",",["T_WHITESPACE"," ",60],["T_VARIABLE","$object",60],")",["T_WHITESPACE","\n    ",60],"{",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$eventObjectWrapper",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_NEW","new",62],["T_WHITESPACE"," ",62],["T_STRING","Varien_Object",62],"(",["T_WHITESPACE","\n            ",62],["T_ARRAY","array",63],"(",["T_WHITESPACE","\n                ",63],["T_CONSTANT_ENCAPSED_STRING","'product'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$product",64],",",["T_WHITESPACE","\n                ",64],["T_CONSTANT_ENCAPSED_STRING","'backend_attribute'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$object",65],["T_WHITESPACE","\n            ",65],")",["T_WHITESPACE","\n        ",66],")",";",["T_WHITESPACE","\n        ",67],["T_STRING","Mage",68],["T_DOUBLE_COLON","::",68],["T_STRING","dispatchEvent",68],"(",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_eventPrefix",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'_load_gallery_before'",69],",",["T_WHITESPACE","\n            ",69],["T_ARRAY","array",70],"(",["T_CONSTANT_ENCAPSED_STRING","'event_object_wrapper'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$eventObjectWrapper",70],")",["T_WHITESPACE","\n        ",70],")",";",["T_WHITESPACE","\n\n        ",71],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$eventObjectWrapper",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","hasProductIdsOverride",73],"(",")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$productIds",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$eventObjectWrapper",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getProductIdsOverride",74],"(",")",";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE"," ",75],["T_ELSE","else",75],["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$productIds",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_ARRAY","array",76],"(",["T_VARIABLE","$product",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getId",76],"(",")",")",";",["T_WHITESPACE","\n        ",76],"}",["T_WHITESPACE","\n\n        ",77],["T_VARIABLE","$select",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_getLoadGallerySelect",79],"(",["T_VARIABLE","$productIds",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$product",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getStoreId",79],"(",")",",",["T_WHITESPACE"," ",79],["T_VARIABLE","$object",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getAttribute",79],"(",")",["T_OBJECT_OPERATOR","->",79],["T_STRING","getId",79],"(",")",")",";",["T_WHITESPACE","\n\n        ",79],["T_VARIABLE","$adapter",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_getReadAdapter",81],"(",")",";",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$result",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$adapter",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","fetchAll",82],"(",["T_VARIABLE","$select",82],")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_removeDuplicates",83],"(",["T_VARIABLE","$result",83],")",";",["T_WHITESPACE","\n        ",83],["T_RETURN","return",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$result",84],";",["T_WHITESPACE","\n    ",84],"}",["T_WHITESPACE","\n\n    ",85],["T_DOC_COMMENT","\/**\n     * Remove duplicates\n     *\n     * @param array $result\n     * @return Mage_Catalog_Model_Resource_Product_Attribute_Backend_Media\n     *\/",87],["T_WHITESPACE","\n    ",92],["T_PROTECTED","protected",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","_removeDuplicates",93],"(","&",["T_VARIABLE","$result",93],")",["T_WHITESPACE","\n    ",93],"{",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$fileToId",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_ARRAY","array",95],"(",")",";",["T_WHITESPACE","\n\n        ",95],["T_FOREACH","foreach",97],["T_WHITESPACE"," ",97],"(",["T_STRING","array_keys",97],"(",["T_VARIABLE","$result",97],")",["T_WHITESPACE"," ",97],["T_AS","as",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$index",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_ISSET","isset",98],"(",["T_VARIABLE","$fileToId",98],"[",["T_VARIABLE","$result",98],"[",["T_VARIABLE","$index",98],"]","[",["T_CONSTANT_ENCAPSED_STRING","'file'",98],"]","]",")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                ",98],["T_VARIABLE","$fileToId",99],"[",["T_VARIABLE","$result",99],"[",["T_VARIABLE","$index",99],"]","[",["T_CONSTANT_ENCAPSED_STRING","'file'",99],"]","]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$result",99],"[",["T_VARIABLE","$index",99],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",99],"]",";",["T_WHITESPACE","\n            ",99],"}",["T_WHITESPACE"," ",100],["T_ELSEIF","elseif",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$fileToId",100],"[",["T_VARIABLE","$result",100],"[",["T_VARIABLE","$index",100],"]","[",["T_CONSTANT_ENCAPSED_STRING","'file'",100],"]","]",["T_WHITESPACE"," ",100],["T_IS_NOT_EQUAL","!=",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$result",100],"[",["T_VARIABLE","$index",100],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",100],"]",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","deleteGallery",101],"(",["T_VARIABLE","$result",101],"[",["T_VARIABLE","$index",101],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",101],"]",")",";",["T_WHITESPACE","\n                ",101],["T_UNSET","unset",102],"(",["T_VARIABLE","$result",102],"[",["T_VARIABLE","$index",102],"]",")",";",["T_WHITESPACE","\n            ",102],"}",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n\n        ",104],["T_VARIABLE","$result",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","array_values",106],"(",["T_VARIABLE","$result",106],")",";",["T_WHITESPACE","\n        ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Insert gallery value to db and retrive last id\n     *\n     * @param array $data\n     * @return interger\n     *\/",110],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","insertGallery",116],"(",["T_VARIABLE","$data",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$adapter",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_getWriteAdapter",118],"(",")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$data",119],["T_WHITESPACE","    ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_prepareDataForTable",119],"(",["T_NEW","new",119],["T_WHITESPACE"," ",119],["T_STRING","Varien_Object",119],"(",["T_VARIABLE","$data",119],")",",",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getMainTable",119],"(",")",")",";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$adapter",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","insert",120],"(",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getMainTable",120],"(",")",",",["T_WHITESPACE"," ",120],["T_VARIABLE","$data",120],")",";",["T_WHITESPACE","\n\n        ",120],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$adapter",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","lastInsertId",122],"(",["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getMainTable",122],"(",")",")",";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * Delete gallery value in db\n     *\n     * @param array|integer $valueId\n     * @return Mage_Catalog_Model_Resource_Product_Attribute_Backend_Media\n     *\/",125],["T_WHITESPACE","\n    ",130],["T_PUBLIC","public",131],["T_WHITESPACE"," ",131],["T_FUNCTION","function",131],["T_WHITESPACE"," ",131],["T_STRING","deleteGallery",131],"(",["T_VARIABLE","$valueId",131],")",["T_WHITESPACE","\n    ",131],"{",["T_WHITESPACE","\n        ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_STRING","is_array",133],"(",["T_VARIABLE","$valueId",133],")",["T_WHITESPACE"," ",133],["T_BOOLEAN_AND","&&",133],["T_WHITESPACE"," ",133],["T_STRING","count",133],"(",["T_VARIABLE","$valueId",133],")",">",["T_LNUMBER","0",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$condition",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_getWriteAdapter",134],"(",")",["T_OBJECT_OPERATOR","->",134],["T_STRING","quoteInto",134],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id IN(?) '",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$valueId",134],")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE"," ",135],["T_ELSEIF","elseif",135],["T_WHITESPACE"," ",135],"(","!",["T_STRING","is_array",135],"(",["T_VARIABLE","$valueId",135],")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$condition",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_getWriteAdapter",136],"(",")",["T_OBJECT_OPERATOR","->",136],["T_STRING","quoteInto",136],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id = ? '",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$valueId",136],")",";",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE"," ",137],["T_ELSE","else",137],["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n            ",137],["T_RETURN","return",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],";",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n\n        ",139],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_getWriteAdapter",141],"(",")",["T_OBJECT_OPERATOR","->",141],["T_STRING","delete",141],"(",["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getMainTable",141],"(",")",",",["T_WHITESPACE"," ",141],["T_VARIABLE","$condition",141],")",";",["T_WHITESPACE","\n        ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_DOC_COMMENT","\/**\n     * Insert gallery value for store to db\n     *\n     * @param array $data\n     * @return Mage_Catalog_Model_Resource_Product_Attribute_Backend_Media\n     *\/",145],["T_WHITESPACE","\n    ",150],["T_PUBLIC","public",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","insertGalleryValueInStore",151],"(",["T_VARIABLE","$data",151],")",["T_WHITESPACE","\n    ",151],"{",["T_WHITESPACE","\n        ",152],["T_VARIABLE","$data",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_prepareDataForTable",153],"(",["T_NEW","new",153],["T_WHITESPACE"," ",153],["T_STRING","Varien_Object",153],"(",["T_VARIABLE","$data",153],")",",",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getTable",153],"(",["T_STRING","self",153],["T_DOUBLE_COLON","::",153],["T_STRING","GALLERY_VALUE_TABLE",153],")",")",";",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_getWriteAdapter",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","insert",154],"(",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getTable",154],"(",["T_STRING","self",154],["T_DOUBLE_COLON","::",154],["T_STRING","GALLERY_VALUE_TABLE",154],")",",",["T_WHITESPACE"," ",154],["T_VARIABLE","$data",154],")",";",["T_WHITESPACE","\n\n        ",154],["T_RETURN","return",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],";",["T_WHITESPACE","\n    ",156],"}",["T_WHITESPACE","\n\n    ",157],["T_DOC_COMMENT","\/**\n     * Delete gallery value for store in db\n     *\n     * @param integer $valueId\n     * @param integer $storeId\n     * @return Mage_Catalog_Model_Resource_Product_Attribute_Backend_Media\n     *\/",159],["T_WHITESPACE","\n    ",165],["T_PUBLIC","public",166],["T_WHITESPACE"," ",166],["T_FUNCTION","function",166],["T_WHITESPACE"," ",166],["T_STRING","deleteGalleryValueInStore",166],"(",["T_VARIABLE","$valueId",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$storeId",166],")",["T_WHITESPACE","\n    ",166],"{",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$adapter",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_getWriteAdapter",168],"(",")",";",["T_WHITESPACE","\n\n        ",168],["T_VARIABLE","$conditions",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_STRING","implode",170],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",170],",",["T_WHITESPACE"," ",170],["T_ARRAY","array",170],"(",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$adapter",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","quoteInto",171],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id = ?'",171],",",["T_WHITESPACE"," ",171],["T_INT_CAST","(int)",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$valueId",171],")",",",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$adapter",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","quoteInto",172],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",172],",",["T_WHITESPACE"," ",172],["T_INT_CAST","(int)",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$storeId",172],")",",",["T_WHITESPACE","\n        ",172],")",")",";",["T_WHITESPACE","\n\n        ",173],["T_VARIABLE","$adapter",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","delete",175],"(",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getTable",175],"(",["T_STRING","self",175],["T_DOUBLE_COLON","::",175],["T_STRING","GALLERY_VALUE_TABLE",175],")",",",["T_WHITESPACE"," ",175],["T_VARIABLE","$conditions",175],")",";",["T_WHITESPACE","\n\n        ",175],["T_RETURN","return",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n\n    ",178],["T_DOC_COMMENT","\/**\n     * Duplicates gallery db values\n     *\n     * @param Mage_Catalog_Model_Product_Attribute_Backend_Media $object\n     * @param array $newFiles\n     * @param int $originalProductId\n     * @param int $newProductId\n     * @return Mage_Catalog_Model_Resource_Product_Attribute_Backend_Media\n     *\/",180],["T_WHITESPACE","\n    ",188],["T_PUBLIC","public",189],["T_WHITESPACE"," ",189],["T_FUNCTION","function",189],["T_WHITESPACE"," ",189],["T_STRING","duplicate",189],"(",["T_VARIABLE","$object",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$newFiles",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$originalProductId",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$newProductId",189],")",["T_WHITESPACE","\n    ",189],"{",["T_WHITESPACE","\n        ",190],["T_VARIABLE","$select",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_getReadAdapter",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","select",191],"(",")",["T_WHITESPACE","\n            ",191],["T_OBJECT_OPERATOR","->",192],["T_STRING","from",192],"(",["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getMainTable",192],"(",")",",",["T_WHITESPACE"," ",192],["T_ARRAY","array",192],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id'",192],",",["T_WHITESPACE"," ",192],["T_CONSTANT_ENCAPSED_STRING","'value'",192],")",")",["T_WHITESPACE","\n            ",192],["T_OBJECT_OPERATOR","->",193],["T_STRING","where",193],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$object",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getAttribute",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","getId",193],"(",")",")",["T_WHITESPACE","\n            ",193],["T_OBJECT_OPERATOR","->",194],["T_STRING","where",194],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",194],",",["T_WHITESPACE"," ",194],["T_VARIABLE","$originalProductId",194],")",";",["T_WHITESPACE","\n\n        ",194],["T_VARIABLE","$valueIdMap",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_ARRAY","array",196],"(",")",";",["T_WHITESPACE","\n        ",196],["T_COMMENT","\/\/ Duplicate main entries of gallery\n",197],["T_WHITESPACE","        ",198],["T_FOREACH","foreach",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_getReadAdapter",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","fetchAll",198],"(",["T_VARIABLE","$select",198],")",["T_WHITESPACE"," ",198],["T_AS","as",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$row",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$data",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_ARRAY","array",199],"(",["T_WHITESPACE","\n                ",199],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",200],["T_WHITESPACE"," ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$object",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getAttribute",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","getId",200],"(",")",",",["T_WHITESPACE","\n                ",200],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",201],["T_WHITESPACE","    ",201],["T_DOUBLE_ARROW","=>",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$newProductId",201],",",["T_WHITESPACE","\n                ",201],["T_CONSTANT_ENCAPSED_STRING","'value'",202],["T_WHITESPACE","        ",202],["T_DOUBLE_ARROW","=>",202],["T_WHITESPACE"," ",202],"(",["T_ISSET","isset",202],"(",["T_VARIABLE","$newFiles",202],"[",["T_VARIABLE","$row",202],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",202],"]","]",")",["T_WHITESPACE"," ",202],"?",["T_WHITESPACE"," ",202],["T_VARIABLE","$newFiles",202],"[",["T_VARIABLE","$row",202],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",202],"]","]",["T_WHITESPACE"," ",202],":",["T_WHITESPACE"," ",202],["T_VARIABLE","$row",202],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",202],"]",")",["T_WHITESPACE","\n            ",202],")",";",["T_WHITESPACE","\n\n            ",203],["T_VARIABLE","$valueIdMap",205],"[",["T_VARIABLE","$row",205],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",205],"]","]",["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","insertGallery",205],"(",["T_VARIABLE","$data",205],")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n\n        ",206],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_STRING","count",208],"(",["T_VARIABLE","$valueIdMap",208],")",["T_WHITESPACE"," ",208],["T_IS_EQUAL","==",208],["T_WHITESPACE"," ",208],["T_LNUMBER","0",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_RETURN","return",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n\n        ",210],["T_COMMENT","\/\/ Duplicate per store gallery values\n",212],["T_WHITESPACE","        ",213],["T_VARIABLE","$select",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_getReadAdapter",213],"(",")",["T_OBJECT_OPERATOR","->",213],["T_STRING","select",213],"(",")",["T_WHITESPACE","\n            ",213],["T_OBJECT_OPERATOR","->",214],["T_STRING","from",214],"(",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getTable",214],"(",["T_STRING","self",214],["T_DOUBLE_COLON","::",214],["T_STRING","GALLERY_VALUE_TABLE",214],")",")",["T_WHITESPACE","\n            ",214],["T_OBJECT_OPERATOR","->",215],["T_STRING","where",215],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id IN(?)'",215],",",["T_WHITESPACE"," ",215],["T_STRING","array_keys",215],"(",["T_VARIABLE","$valueIdMap",215],")",")",";",["T_WHITESPACE","\n\n        ",215],["T_FOREACH","foreach",217],["T_WHITESPACE"," ",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_getReadAdapter",217],"(",")",["T_OBJECT_OPERATOR","->",217],["T_STRING","fetchAll",217],"(",["T_VARIABLE","$select",217],")",["T_WHITESPACE"," ",217],["T_AS","as",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$row",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$row",218],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",218],"]",["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$valueIdMap",218],"[",["T_VARIABLE","$row",218],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",218],"]","]",";",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","insertGalleryValueInStore",219],"(",["T_VARIABLE","$row",219],")",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n\n        ",220],["T_RETURN","return",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],";",["T_WHITESPACE","\n    ",222],"}",["T_WHITESPACE","\n\n    ",223],["T_DOC_COMMENT","\/**\n     * Get select to retrieve media gallery images\n     * for given product IDs.\n     *\n     * @param array $productIds\n     * @param $storeId\n     * @param int $attributeId\n     * @return Varien_Db_Select\n     *\/",225],["T_WHITESPACE","\n    ",233],["T_PROTECTED","protected",234],["T_WHITESPACE"," ",234],["T_FUNCTION","function",234],["T_WHITESPACE"," ",234],["T_STRING","_getLoadGallerySelect",234],"(",["T_ARRAY","array",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$productIds",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$storeId",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$attributeId",234],")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$adapter",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_getReadAdapter",235],"(",")",";",["T_WHITESPACE","\n\n        ",235],["T_VARIABLE","$positionCheckSql",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$adapter",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getCheckSql",237],"(",["T_CONSTANT_ENCAPSED_STRING","'value.position IS NULL'",237],",",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'default_value.position'",237],",",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","'value.position'",237],")",";",["T_WHITESPACE","\n\n        ",237],["T_COMMENT","\/\/ Select gallery images for product\n",239],["T_WHITESPACE","        ",240],["T_VARIABLE","$select",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$adapter",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","select",240],"(",")",["T_WHITESPACE","\n            ",240],["T_OBJECT_OPERATOR","->",241],["T_STRING","from",241],"(",["T_WHITESPACE","\n                ",241],["T_ARRAY","array",242],"(",["T_CONSTANT_ENCAPSED_STRING","'main'",242],["T_DOUBLE_ARROW","=>",242],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getMainTable",242],"(",")",")",",",["T_WHITESPACE","\n                ",242],["T_ARRAY","array",243],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id'",243],",",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'value AS file'",243],",",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'product_id'",243],["T_WHITESPACE"," ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",243],")",["T_WHITESPACE","\n            ",243],")",["T_WHITESPACE","\n            ",244],["T_OBJECT_OPERATOR","->",245],["T_STRING","joinLeft",245],"(",["T_WHITESPACE","\n                ",245],["T_ARRAY","array",246],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",246],["T_WHITESPACE"," ",246],["T_DOUBLE_ARROW","=>",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getTable",246],"(",["T_STRING","self",246],["T_DOUBLE_COLON","::",246],["T_STRING","GALLERY_VALUE_TABLE",246],")",")",",",["T_WHITESPACE","\n                ",246],["T_VARIABLE","$adapter",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","quoteInto",247],"(",["T_CONSTANT_ENCAPSED_STRING","'main.value_id = value.value_id AND value.store_id = ?'",247],",",["T_WHITESPACE"," ",247],["T_INT_CAST","(int)",247],["T_VARIABLE","$storeId",247],")",",",["T_WHITESPACE","\n                ",247],["T_ARRAY","array",248],"(",["T_CONSTANT_ENCAPSED_STRING","'label'",248],",",["T_CONSTANT_ENCAPSED_STRING","'position'",248],",",["T_CONSTANT_ENCAPSED_STRING","'disabled'",248],")",["T_WHITESPACE","\n            ",248],")",["T_WHITESPACE","\n            ",249],["T_OBJECT_OPERATOR","->",250],["T_STRING","joinLeft",250],"(",["T_WHITESPACE"," ",250],["T_COMMENT","\/\/ Joining default values\n",250],["T_WHITESPACE","                ",251],["T_ARRAY","array",251],"(",["T_CONSTANT_ENCAPSED_STRING","'default_value'",251],["T_WHITESPACE"," ",251],["T_DOUBLE_ARROW","=>",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getTable",251],"(",["T_STRING","self",251],["T_DOUBLE_COLON","::",251],["T_STRING","GALLERY_VALUE_TABLE",251],")",")",",",["T_WHITESPACE","\n                ",251],["T_CONSTANT_ENCAPSED_STRING","'main.value_id = default_value.value_id AND default_value.store_id = 0'",252],",",["T_WHITESPACE","\n                ",252],["T_ARRAY","array",253],"(",["T_WHITESPACE","\n                    ",253],["T_CONSTANT_ENCAPSED_STRING","'label_default'",254],["T_WHITESPACE"," ",254],["T_DOUBLE_ARROW","=>",254],["T_WHITESPACE"," ",254],["T_CONSTANT_ENCAPSED_STRING","'label'",254],",",["T_WHITESPACE","\n                    ",254],["T_CONSTANT_ENCAPSED_STRING","'position_default'",255],["T_WHITESPACE"," ",255],["T_DOUBLE_ARROW","=>",255],["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'position'",255],",",["T_WHITESPACE","\n                    ",255],["T_CONSTANT_ENCAPSED_STRING","'disabled_default'",256],["T_WHITESPACE"," ",256],["T_DOUBLE_ARROW","=>",256],["T_WHITESPACE"," ",256],["T_CONSTANT_ENCAPSED_STRING","'disabled'",256],["T_WHITESPACE","\n                ",256],")",["T_WHITESPACE","\n            ",257],")",["T_WHITESPACE","\n            ",258],["T_OBJECT_OPERATOR","->",259],["T_STRING","where",259],"(",["T_CONSTANT_ENCAPSED_STRING","'main.attribute_id = ?'",259],",",["T_WHITESPACE"," ",259],["T_VARIABLE","$attributeId",259],")",["T_WHITESPACE","\n            ",259],["T_OBJECT_OPERATOR","->",260],["T_STRING","where",260],"(",["T_CONSTANT_ENCAPSED_STRING","'main.entity_id in (?)'",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$productIds",260],")",["T_WHITESPACE","\n            ",260],["T_OBJECT_OPERATOR","->",261],["T_STRING","order",261],"(",["T_VARIABLE","$positionCheckSql",261],["T_WHITESPACE"," ",261],".",["T_WHITESPACE"," ",261],["T_CONSTANT_ENCAPSED_STRING","' '",261],["T_WHITESPACE"," ",261],".",["T_WHITESPACE"," ",261],["T_STRING","Varien_Db_Select",261],["T_DOUBLE_COLON","::",261],["T_STRING","SQL_ASC",261],")",";",["T_WHITESPACE","\n\n        ",261],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$select",263],";",["T_WHITESPACE","\n    ",263],"}",["T_WHITESPACE","\n\n    ",264],["T_DOC_COMMENT","\/**\n     * Get attribute ID\n     *\n     * @return int\n     *\/",266],["T_WHITESPACE","\n    ",270],["T_PROTECTED","protected",271],["T_WHITESPACE"," ",271],["T_FUNCTION","function",271],["T_WHITESPACE"," ",271],["T_STRING","_getAttributeId",271],"(",")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n        ",271],["T_IF","if",272],"(",["T_STRING","is_null",272],"(",["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","_attributeId",272],")",")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$attribute",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","Mage",273],["T_DOUBLE_COLON","::",273],["T_STRING","getModel",273],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/entity_attribute'",273],")",["T_WHITESPACE","\n                ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","loadByCode",274],"(",["T_STRING","Mage_Catalog_Model_Product",274],["T_DOUBLE_COLON","::",274],["T_STRING","ENTITY",274],",",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'media_gallery'",274],")",";",["T_WHITESPACE","\n\n            ",274],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_attributeId",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$attribute",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getId",276],"(",")",";",["T_WHITESPACE","\n        ",276],"}",["T_WHITESPACE","\n        ",277],["T_RETURN","return",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_attributeId",278],";",["T_WHITESPACE","\n    ",278],"}",["T_WHITESPACE","\n\n    ",279],["T_DOC_COMMENT","\/**\n     * Get media gallery set for given product IDs\n     *\n     * @param array $productIds\n     * @param $storeId\n     * @return array\n     *\/",281],["T_WHITESPACE","\n    ",287],["T_PUBLIC","public",288],["T_WHITESPACE"," ",288],["T_FUNCTION","function",288],["T_WHITESPACE"," ",288],["T_STRING","loadGallerySet",288],"(",["T_ARRAY","array",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$productIds",288],",",["T_WHITESPACE"," ",288],["T_VARIABLE","$storeId",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n        ",288],["T_VARIABLE","$select",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","_getLoadGallerySelect",289],"(",["T_VARIABLE","$productIds",289],",",["T_WHITESPACE"," ",289],["T_VARIABLE","$storeId",289],",",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","_getAttributeId",289],"(",")",")",";",["T_WHITESPACE","\n\n        ",289],["T_VARIABLE","$adapter",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","_getReadAdapter",291],"(",")",";",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$result",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$adapter",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","fetchAll",292],"(",["T_VARIABLE","$select",292],")",";",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_removeDuplicates",293],"(",["T_VARIABLE","$result",293],")",";",["T_WHITESPACE","\n        ",293],["T_RETURN","return",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$result",294],";",["T_WHITESPACE","\n    ",294],"}",["T_WHITESPACE","\n",295],"}",["T_WHITESPACE","\n",296]]