[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog url rewrite resource model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Url",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Stores configuration array\n     *\n     * @var array\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_stores",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Category attribute properties cache\n     *\n     * @var array\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_categoryAttributes",49],["T_WHITESPACE","          ",49],"=",["T_WHITESPACE"," ",49],["T_ARRAY","array",49],"(",")",";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Product attribute properties cache\n     *\n     * @var array\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_productAttributes",56],["T_WHITESPACE","           ",56],"=",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",")",";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Limit products for select\n     *\n     * @var int\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_productLimit",63],["T_WHITESPACE","                ",63],"=",["T_WHITESPACE"," ",63],["T_LNUMBER","250",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Cache of root category children ids\n     *\n     * @var array\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_rootChildrenIds",70],["T_WHITESPACE","             ",70],"=",["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",")",";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Load core Url rewrite model\n     *\n     *\/",72],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","_construct",76],"(",")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_init",78],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/url_rewrite'",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'url_rewrite_id'",78],")",";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Retrieve stores array or store model\n     *\n     * @param int $storeId\n     * @return Mage_Core_Model_Store|array\n     *\/",81],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","getStores",87],"(",["T_VARIABLE","$storeId",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","null",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_stores",89],["T_WHITESPACE"," ",89],["T_IS_IDENTICAL","===",89],["T_WHITESPACE"," ",89],["T_STRING","null",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_stores",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_prepareStoreRootCategories",90],"(",["T_STRING","Mage",90],["T_DOUBLE_COLON","::",90],["T_STRING","app",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","getStores",90],"(",")",")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n        ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$storeId",92],["T_WHITESPACE"," ",92],["T_BOOLEAN_AND","&&",92],["T_WHITESPACE"," ",92],["T_ISSET","isset",92],"(",["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_stores",92],"[",["T_VARIABLE","$storeId",92],"]",")",")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n            ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_stores",93],"[",["T_VARIABLE","$storeId",93],"]",";",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE","\n        ",94],["T_RETURN","return",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_stores",95],";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Retrieve Category model singleton\n     *\n     * @return Mage_Catalog_Model_Category\n     *\/",98],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getCategoryModel",103],"(",")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","getSingleton",105],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",105],")",";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Retrieve product model singleton\n     *\n     * @return Mage_Catalog_Model_Product\n     *\/",108],["T_WHITESPACE","\n    ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","getProductModel",113],"(",")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_STRING","Mage",115],["T_DOUBLE_COLON","::",115],["T_STRING","getSingleton",115],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",115],")",";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Retrieve rewrite by idPath\n     *\n     * @param string $idPath\n     * @param int $storeId\n     * @return Varien_Object|false\n     *\/",118],["T_WHITESPACE","\n    ",124],["T_PUBLIC","public",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","getRewriteByIdPath",125],"(",["T_VARIABLE","$idPath",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$storeId",125],")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$adapter",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_getReadAdapter",127],"(",")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$select",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$adapter",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","select",128],"(",")",["T_WHITESPACE","\n            ",128],["T_OBJECT_OPERATOR","->",129],["T_STRING","from",129],"(",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getMainTable",129],"(",")",")",["T_WHITESPACE","\n            ",129],["T_OBJECT_OPERATOR","->",130],["T_STRING","where",130],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = :store_id'",130],")",["T_WHITESPACE","\n            ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","where",131],"(",["T_CONSTANT_ENCAPSED_STRING","'id_path = :id_path'",131],")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$bind",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_ARRAY","array",132],"(",["T_WHITESPACE","\n            ",132],["T_CONSTANT_ENCAPSED_STRING","'store_id'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_INT_CAST","(int)",133],["T_VARIABLE","$storeId",133],",",["T_WHITESPACE","\n            ",133],["T_CONSTANT_ENCAPSED_STRING","'id_path'",134],["T_WHITESPACE","  ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$idPath",134],["T_WHITESPACE","\n        ",134],")",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$row",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$adapter",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","fetchRow",136],"(",["T_VARIABLE","$select",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$bind",136],")",";",["T_WHITESPACE","\n\n        ",136],["T_IF","if",138],["T_WHITESPACE"," ",138],"(","!",["T_VARIABLE","$row",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_STRING","false",139],";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$rewrite",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_NEW","new",141],["T_WHITESPACE"," ",141],["T_STRING","Varien_Object",141],"(",["T_VARIABLE","$row",141],")",";",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$rewrite",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","setIdFieldName",142],"(",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getIdFieldName",142],"(",")",")",";",["T_WHITESPACE","\n\n        ",142],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$rewrite",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Retrieve rewrite by requestPath\n     *\n     * @param string $requestPath\n     * @param int $storeId\n     * @return Varien_Object|false\n     *\/",147],["T_WHITESPACE","\n    ",153],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","getRewriteByRequestPath",154],"(",["T_VARIABLE","$requestPath",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$storeId",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$adapter",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_getWriteAdapter",156],"(",")",";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$select",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$adapter",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","select",157],"(",")",["T_WHITESPACE","\n            ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","from",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getMainTable",158],"(",")",")",["T_WHITESPACE","\n            ",158],["T_OBJECT_OPERATOR","->",159],["T_STRING","where",159],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = :store_id'",159],")",["T_WHITESPACE","\n            ",159],["T_OBJECT_OPERATOR","->",160],["T_STRING","where",160],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path = :request_path'",160],")",";",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$bind",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_ARRAY","array",161],"(",["T_WHITESPACE","\n            ",161],["T_CONSTANT_ENCAPSED_STRING","'request_path'",162],["T_WHITESPACE","  ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$requestPath",162],",",["T_WHITESPACE","\n            ",162],["T_CONSTANT_ENCAPSED_STRING","'store_id'",163],["T_WHITESPACE","      ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_INT_CAST","(int)",163],["T_VARIABLE","$storeId",163],["T_WHITESPACE","\n        ",163],")",";",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$row",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$adapter",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","fetchRow",165],"(",["T_VARIABLE","$select",165],",",["T_WHITESPACE"," ",165],["T_VARIABLE","$bind",165],")",";",["T_WHITESPACE","\n\n        ",165],["T_IF","if",167],["T_WHITESPACE"," ",167],"(","!",["T_VARIABLE","$row",167],")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_STRING","false",168],";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$rewrite",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_NEW","new",170],["T_WHITESPACE"," ",170],["T_STRING","Varien_Object",170],"(",["T_VARIABLE","$row",170],")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$rewrite",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setIdFieldName",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getIdFieldName",171],"(",")",")",";",["T_WHITESPACE","\n\n        ",171],["T_RETURN","return",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$rewrite",173],";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n\n    ",174],["T_DOC_COMMENT","\/**\n     * Get last used increment part of rewrite request path\n     *\n     * @param string $prefix\n     * @param string $suffix\n     * @param int $storeId\n     * @return int\n     *\/",176],["T_WHITESPACE","\n    ",183],["T_PUBLIC","public",184],["T_WHITESPACE"," ",184],["T_FUNCTION","function",184],["T_WHITESPACE"," ",184],["T_STRING","getLastUsedRewriteRequestIncrement",184],"(",["T_VARIABLE","$prefix",184],",",["T_WHITESPACE"," ",184],["T_VARIABLE","$suffix",184],",",["T_WHITESPACE"," ",184],["T_VARIABLE","$storeId",184],")",["T_WHITESPACE","\n    ",184],"{",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$adapter",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_getWriteAdapter",186],"(",")",";",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$requestPathField",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_NEW","new",187],["T_WHITESPACE"," ",187],["T_STRING","Zend_Db_Expr",187],"(",["T_VARIABLE","$adapter",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","quoteIdentifier",187],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path'",187],")",")",";",["T_WHITESPACE","\n        ",187],["T_COMMENT","\/\/select increment part of request path and cast expression to integer\n",188],["T_WHITESPACE","        ",189],["T_VARIABLE","$urlIncrementPartExpression",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_STRING","Mage",189],["T_DOUBLE_COLON","::",189],["T_STRING","getResourceHelper",189],"(",["T_CONSTANT_ENCAPSED_STRING","'eav'",189],")",["T_WHITESPACE","\n            ",189],["T_OBJECT_OPERATOR","->",190],["T_STRING","getCastToIntExpression",190],"(",["T_VARIABLE","$adapter",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getSubstringSql",190],"(",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$requestPathField",191],",",["T_WHITESPACE","\n                ",191],["T_STRING","strlen",192],"(",["T_VARIABLE","$prefix",192],")",["T_WHITESPACE"," ",192],"+",["T_WHITESPACE"," ",192],["T_LNUMBER","1",192],",",["T_WHITESPACE","\n                ",192],["T_VARIABLE","$adapter",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getLengthSql",193],"(",["T_VARIABLE","$requestPathField",193],")",["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","' - '",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_STRING","strlen",193],"(",["T_VARIABLE","$prefix",193],")",["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","' - '",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_STRING","strlen",193],"(",["T_VARIABLE","$suffix",193],")",["T_WHITESPACE","\n            ",193],")",")",";",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$select",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$adapter",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","select",195],"(",")",["T_WHITESPACE","\n            ",195],["T_OBJECT_OPERATOR","->",196],["T_STRING","from",196],"(",["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getMainTable",196],"(",")",",",["T_WHITESPACE"," ",196],["T_NEW","new",196],["T_WHITESPACE"," ",196],["T_STRING","Zend_Db_Expr",196],"(",["T_CONSTANT_ENCAPSED_STRING","'MAX('",196],["T_WHITESPACE"," ",196],".",["T_WHITESPACE"," ",196],["T_VARIABLE","$urlIncrementPartExpression",196],["T_WHITESPACE"," ",196],".",["T_WHITESPACE"," ",196],["T_CONSTANT_ENCAPSED_STRING","')'",196],")",")",["T_WHITESPACE","\n            ",196],["T_OBJECT_OPERATOR","->",197],["T_STRING","where",197],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = :store_id'",197],")",["T_WHITESPACE","\n            ",197],["T_OBJECT_OPERATOR","->",198],["T_STRING","where",198],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path LIKE :request_path'",198],")",["T_WHITESPACE","\n            ",198],["T_OBJECT_OPERATOR","->",199],["T_STRING","where",199],"(",["T_VARIABLE","$adapter",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","prepareSqlCondition",199],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path'",199],",",["T_WHITESPACE"," ",199],["T_ARRAY","array",199],"(",["T_WHITESPACE","\n                ",199],["T_CONSTANT_ENCAPSED_STRING","'regexp'",200],["T_WHITESPACE"," ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'^'",200],["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_STRING","preg_quote",200],"(",["T_VARIABLE","$prefix",200],")",["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'[0-9]*'",200],["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_STRING","preg_quote",200],"(",["T_VARIABLE","$suffix",200],")",["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'$'",200],["T_WHITESPACE","\n            ",200],")",")",")",";",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$bind",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_ARRAY","array",202],"(",["T_WHITESPACE","\n            ",202],["T_CONSTANT_ENCAPSED_STRING","'store_id'",203],["T_WHITESPACE","            ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_INT_CAST","(int)",203],["T_VARIABLE","$storeId",203],",",["T_WHITESPACE","\n            ",203],["T_CONSTANT_ENCAPSED_STRING","'request_path'",204],["T_WHITESPACE","        ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$prefix",204],["T_WHITESPACE"," ",204],".",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'%'",204],["T_WHITESPACE"," ",204],".",["T_WHITESPACE"," ",204],["T_VARIABLE","$suffix",204],",",["T_WHITESPACE","\n        ",204],")",";",["T_WHITESPACE","\n\n        ",205],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_INT_CAST","(int)",207],["T_VARIABLE","$adapter",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","fetchOne",207],"(",["T_VARIABLE","$select",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$bind",207],")",";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n\n    ",208],["T_DOC_COMMENT","\/**\n     * Validate array of request paths. Return first not used path in case if validations passed\n     *\n     * @param array $paths\n     * @param int $storeId\n     * @return false | string\n     *\/",210],["T_WHITESPACE","\n    ",216],["T_PUBLIC","public",217],["T_WHITESPACE"," ",217],["T_FUNCTION","function",217],["T_WHITESPACE"," ",217],["T_STRING","checkRequestPaths",217],"(",["T_VARIABLE","$paths",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$storeId",217],")",["T_WHITESPACE","\n    ",217],"{",["T_WHITESPACE","\n        ",218],["T_VARIABLE","$adapter",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_getWriteAdapter",219],"(",")",";",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$select",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$adapter",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","select",220],"(",")",["T_WHITESPACE","\n            ",220],["T_OBJECT_OPERATOR","->",221],["T_STRING","from",221],"(",["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getMainTable",221],"(",")",",",["T_WHITESPACE"," ",221],["T_CONSTANT_ENCAPSED_STRING","'request_path'",221],")",["T_WHITESPACE","\n            ",221],["T_OBJECT_OPERATOR","->",222],["T_STRING","where",222],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = :store_id'",222],")",["T_WHITESPACE","\n            ",222],["T_OBJECT_OPERATOR","->",223],["T_STRING","where",223],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path IN (?)'",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$paths",223],")",";",["T_WHITESPACE","\n        ",223],["T_VARIABLE","$data",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$adapter",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","fetchCol",224],"(",["T_VARIABLE","$select",224],",",["T_WHITESPACE"," ",224],["T_ARRAY","array",224],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$storeId",224],")",")",";",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$paths",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_STRING","array_diff",225],"(",["T_VARIABLE","$paths",225],",",["T_WHITESPACE"," ",225],["T_VARIABLE","$data",225],")",";",["T_WHITESPACE","\n        ",225],["T_IF","if",226],["T_WHITESPACE"," ",226],"(",["T_EMPTY","empty",226],"(",["T_VARIABLE","$paths",226],")",")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_RETURN","return",227],["T_WHITESPACE"," ",227],["T_STRING","false",227],";",["T_WHITESPACE","\n        ",227],"}",["T_WHITESPACE","\n        ",228],["T_STRING","reset",229],"(",["T_VARIABLE","$paths",229],")",";",["T_WHITESPACE","\n\n        ",229],["T_RETURN","return",231],["T_WHITESPACE"," ",231],["T_STRING","current",231],"(",["T_VARIABLE","$paths",231],")",";",["T_WHITESPACE","\n    ",231],"}",["T_WHITESPACE","\n\n    ",232],["T_DOC_COMMENT","\/**\n     * Prepare rewrites for condition\n     *\n     * @param int $storeId\n     * @param int|array $categoryIds\n     * @param int|array $productIds\n     * @return array\n     *\/",234],["T_WHITESPACE","\n    ",241],["T_PUBLIC","public",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","prepareRewrites",242],"(",["T_VARIABLE","$storeId",242],",",["T_WHITESPACE"," ",242],["T_VARIABLE","$categoryIds",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_STRING","null",242],",",["T_WHITESPACE"," ",242],["T_VARIABLE","$productIds",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_STRING","null",242],")",["T_WHITESPACE","\n    ",242],"{",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$rewrites",244],["T_WHITESPACE","   ",244],"=",["T_WHITESPACE"," ",244],["T_ARRAY","array",244],"(",")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$adapter",245],["T_WHITESPACE","    ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","_getWriteAdapter",245],"(",")",";",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$select",246],["T_WHITESPACE","     ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$adapter",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","select",246],"(",")",["T_WHITESPACE","\n            ",246],["T_OBJECT_OPERATOR","->",247],["T_STRING","from",247],"(",["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getMainTable",247],"(",")",")",["T_WHITESPACE","\n            ",247],["T_OBJECT_OPERATOR","->",248],["T_STRING","where",248],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = :store_id'",248],")",["T_WHITESPACE","\n            ",248],["T_OBJECT_OPERATOR","->",249],["T_STRING","where",249],"(",["T_CONSTANT_ENCAPSED_STRING","'is_system = ?'",249],",",["T_WHITESPACE"," ",249],["T_LNUMBER","1",249],")",";",["T_WHITESPACE","\n        ",249],["T_VARIABLE","$bind",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_ARRAY","array",250],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",250],["T_WHITESPACE"," ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$storeId",250],")",";",["T_WHITESPACE","\n        ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_VARIABLE","$categoryIds",251],["T_WHITESPACE"," ",251],["T_IS_IDENTICAL","===",251],["T_WHITESPACE"," ",251],["T_STRING","null",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n            ",251],["T_VARIABLE","$select",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","where",252],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id IS NULL'",252],")",";",["T_WHITESPACE","\n        ",252],"}",["T_WHITESPACE"," ",253],["T_ELSEIF","elseif",253],["T_WHITESPACE"," ",253],"(",["T_VARIABLE","$categoryIds",253],")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n            ",253],["T_VARIABLE","$catIds",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_STRING","is_array",254],"(",["T_VARIABLE","$categoryIds",254],")",["T_WHITESPACE"," ",254],"?",["T_WHITESPACE"," ",254],["T_VARIABLE","$categoryIds",254],["T_WHITESPACE"," ",254],":",["T_WHITESPACE"," ",254],["T_ARRAY","array",254],"(",["T_VARIABLE","$categoryIds",254],")",";",["T_WHITESPACE","\n\n            ",254],["T_COMMENT","\/\/ Check maybe we request products and root category id is within categoryIds,\n",256],["T_WHITESPACE","            ",257],["T_COMMENT","\/\/ it's a separate case because root category products are stored with NULL categoryId\n",257],["T_WHITESPACE","            ",258],["T_IF","if",258],["T_WHITESPACE"," ",258],"(",["T_VARIABLE","$productIds",258],")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n                ",258],["T_VARIABLE","$addNullCategory",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_STRING","in_array",259],"(",["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getStores",259],"(",["T_VARIABLE","$storeId",259],")",["T_OBJECT_OPERATOR","->",259],["T_STRING","getRootCategoryId",259],"(",")",",",["T_WHITESPACE"," ",259],["T_VARIABLE","$catIds",259],")",";",["T_WHITESPACE","\n            ",259],"}",["T_WHITESPACE"," ",260],["T_ELSE","else",260],["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n                ",260],["T_VARIABLE","$addNullCategory",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_STRING","false",261],";",["T_WHITESPACE","\n            ",261],"}",["T_WHITESPACE","\n\n            ",262],["T_COMMENT","\/\/ Compose optimal condition\n",264],["T_WHITESPACE","            ",265],["T_IF","if",265],["T_WHITESPACE"," ",265],"(",["T_VARIABLE","$addNullCategory",265],")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n                ",265],["T_VARIABLE","$select",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","where",266],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id IN(?) OR category_id IS NULL'",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$catIds",266],")",";",["T_WHITESPACE","\n            ",266],"}",["T_WHITESPACE"," ",267],["T_ELSE","else",267],["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n                ",267],["T_VARIABLE","$select",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","where",268],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id IN(?)'",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$catIds",268],")",";",["T_WHITESPACE","\n            ",268],"}",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE","\n\n        ",270],["T_IF","if",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$productIds",272],["T_WHITESPACE"," ",272],["T_IS_IDENTICAL","===",272],["T_WHITESPACE"," ",272],["T_STRING","null",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$select",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","where",273],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IS NULL'",273],")",";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE"," ",274],["T_ELSEIF","elseif",274],["T_WHITESPACE"," ",274],"(",["T_VARIABLE","$productIds",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n            ",274],["T_VARIABLE","$select",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","where",275],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN(?)'",275],",",["T_WHITESPACE"," ",275],["T_VARIABLE","$productIds",275],")",";",["T_WHITESPACE","\n        ",275],"}",["T_WHITESPACE","\n\n        ",276],["T_VARIABLE","$rowSet",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$adapter",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","fetchAll",278],"(",["T_VARIABLE","$select",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$bind",278],")",";",["T_WHITESPACE","\n\n        ",278],["T_FOREACH","foreach",280],["T_WHITESPACE"," ",280],"(",["T_VARIABLE","$rowSet",280],["T_WHITESPACE"," ",280],["T_AS","as",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$row",280],")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$rewrite",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_NEW","new",281],["T_WHITESPACE"," ",281],["T_STRING","Varien_Object",281],"(",["T_VARIABLE","$row",281],")",";",["T_WHITESPACE","\n            ",281],["T_VARIABLE","$rewrite",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","setIdFieldName",282],"(",["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getIdFieldName",282],"(",")",")",";",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$rewrites",283],"[",["T_VARIABLE","$rewrite",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getIdPath",283],"(",")","]",["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$rewrite",283],";",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE","\n\n        ",284],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$rewrites",286],";",["T_WHITESPACE","\n    ",286],"}",["T_WHITESPACE","\n\n    ",287],["T_DOC_COMMENT","\/**\n     * Save rewrite URL\n     *\n     * @param array $rewriteData\n     * @param int|Varien_Object $rewrite\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",289],["T_WHITESPACE","\n    ",295],["T_PUBLIC","public",296],["T_WHITESPACE"," ",296],["T_FUNCTION","function",296],["T_WHITESPACE"," ",296],["T_STRING","saveRewrite",296],"(",["T_VARIABLE","$rewriteData",296],",",["T_WHITESPACE"," ",296],["T_VARIABLE","$rewrite",296],")",["T_WHITESPACE","\n    ",296],"{",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$adapter",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_getWriteAdapter",298],"(",")",";",["T_WHITESPACE","\n        ",298],["T_TRY","try",299],["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n            ",299],["T_VARIABLE","$adapter",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","insertOnDuplicate",300],"(",["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getMainTable",300],"(",")",",",["T_WHITESPACE"," ",300],["T_VARIABLE","$rewriteData",300],")",";",["T_WHITESPACE","\n        ",300],"}",["T_WHITESPACE"," ",301],["T_CATCH","catch",301],["T_WHITESPACE"," ",301],"(",["T_STRING","Exception",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$e",301],")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n            ",301],["T_STRING","Mage",302],["T_DOUBLE_COLON","::",302],["T_STRING","logException",302],"(",["T_VARIABLE","$e",302],")",";",["T_WHITESPACE","\n            ",302],["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","throwException",303],"(",["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","helper",303],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",303],")",["T_OBJECT_OPERATOR","->",303],["T_STRING","__",303],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while saving the URL rewrite'",303],")",")",";",["T_WHITESPACE","\n        ",303],"}",["T_WHITESPACE","\n\n        ",304],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$rewrite",306],["T_WHITESPACE"," ",306],["T_BOOLEAN_AND","&&",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$rewrite",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getId",306],"(",")",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_VARIABLE","$rewriteData",307],"[",["T_CONSTANT_ENCAPSED_STRING","'request_path'",307],"]",["T_WHITESPACE"," ",307],["T_IS_NOT_EQUAL","!=",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$rewrite",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getRequestPath",307],"(",")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n                ",307],["T_COMMENT","\/\/ Update existing rewrites history and avoid chain redirects\n",308],["T_WHITESPACE","                ",309],["T_VARIABLE","$where",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_ARRAY","array",309],"(",["T_CONSTANT_ENCAPSED_STRING","'target_path = ?'",309],["T_WHITESPACE"," ",309],["T_DOUBLE_ARROW","=>",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$rewrite",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getRequestPath",309],"(",")",")",";",["T_WHITESPACE","\n                ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(",["T_VARIABLE","$rewrite",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getStoreId",310],"(",")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                    ",310],["T_VARIABLE","$where",311],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",311],"]",["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_INT_CAST","(int)",311],["T_VARIABLE","$rewrite",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getStoreId",311],"(",")",";",["T_WHITESPACE","\n                ",311],"}",["T_WHITESPACE","\n                ",312],["T_VARIABLE","$adapter",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","update",313],"(",["T_WHITESPACE","\n                    ",313],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getMainTable",314],"(",")",",",["T_WHITESPACE","\n                    ",314],["T_ARRAY","array",315],"(",["T_CONSTANT_ENCAPSED_STRING","'target_path'",315],["T_WHITESPACE"," ",315],["T_DOUBLE_ARROW","=>",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$rewriteData",315],"[",["T_CONSTANT_ENCAPSED_STRING","'request_path'",315],"]",")",",",["T_WHITESPACE","\n                    ",315],["T_VARIABLE","$where",316],["T_WHITESPACE","\n                ",316],")",";",["T_WHITESPACE","\n            ",317],"}",["T_WHITESPACE","\n        ",318],"}",["T_WHITESPACE","\n        ",319],["T_UNSET","unset",320],"(",["T_VARIABLE","$rewriteData",320],")",";",["T_WHITESPACE","\n\n        ",320],["T_RETURN","return",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$this",322],";",["T_WHITESPACE","\n    ",322],"}",["T_WHITESPACE","\n\n    ",323],["T_DOC_COMMENT","\/**\n     * Saves rewrite history\n     *\n     * @param array $rewriteData\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",325],["T_WHITESPACE","\n    ",330],["T_PUBLIC","public",331],["T_WHITESPACE"," ",331],["T_FUNCTION","function",331],["T_WHITESPACE"," ",331],["T_STRING","saveRewriteHistory",331],"(",["T_VARIABLE","$rewriteData",331],")",["T_WHITESPACE","\n    ",331],"{",["T_WHITESPACE","\n        ",332],["T_VARIABLE","$rewriteData",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_NEW","new",333],["T_WHITESPACE"," ",333],["T_STRING","Varien_Object",333],"(",["T_VARIABLE","$rewriteData",333],")",";",["T_WHITESPACE","\n        ",333],["T_COMMENT","\/\/ check if rewrite exists with save request_path\n",334],["T_WHITESPACE","        ",335],["T_VARIABLE","$rewrite",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getRewriteByRequestPath",335],"(",["T_VARIABLE","$rewriteData",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getRequestPath",335],"(",")",",",["T_WHITESPACE"," ",335],["T_VARIABLE","$rewriteData",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getStoreId",335],"(",")",")",";",["T_WHITESPACE","\n        ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$rewrite",336],["T_WHITESPACE"," ",336],["T_IS_IDENTICAL","===",336],["T_WHITESPACE"," ",336],["T_STRING","false",336],")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_COMMENT","\/\/ create permanent redirect\n",337],["T_WHITESPACE","            ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_getWriteAdapter",338],"(",")",["T_OBJECT_OPERATOR","->",338],["T_STRING","insert",338],"(",["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getMainTable",338],"(",")",",",["T_WHITESPACE"," ",338],["T_VARIABLE","$rewriteData",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getData",338],"(",")",")",";",["T_WHITESPACE","\n        ",338],"}",["T_WHITESPACE","\n\n        ",339],["T_RETURN","return",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_DOC_COMMENT","\/**\n     * Save category attribute\n     *\n     * @param Varien_Object $category\n     * @param string $attributeCode\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",344],["T_WHITESPACE","\n    ",350],["T_PUBLIC","public",351],["T_WHITESPACE"," ",351],["T_FUNCTION","function",351],["T_WHITESPACE"," ",351],["T_STRING","saveCategoryAttribute",351],"(",["T_STRING","Varien_Object",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$category",351],",",["T_WHITESPACE"," ",351],["T_VARIABLE","$attributeCode",351],")",["T_WHITESPACE","\n    ",351],"{",["T_WHITESPACE","\n        ",352],["T_VARIABLE","$adapter",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_getWriteAdapter",353],"(",")",";",["T_WHITESPACE","\n        ",353],["T_IF","if",354],["T_WHITESPACE"," ",354],"(","!",["T_ISSET","isset",354],"(",["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","_categoryAttributes",354],"[",["T_VARIABLE","$attributeCode",354],"]",")",")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n            ",354],["T_VARIABLE","$attribute",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getCategoryModel",355],"(",")",["T_OBJECT_OPERATOR","->",355],["T_STRING","getResource",355],"(",")",["T_OBJECT_OPERATOR","->",355],["T_STRING","getAttribute",355],"(",["T_VARIABLE","$attributeCode",355],")",";",["T_WHITESPACE","\n\n            ",355],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_categoryAttributes",357],"[",["T_VARIABLE","$attributeCode",357],"]",["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_ARRAY","array",357],"(",["T_WHITESPACE","\n                ",357],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",358],["T_WHITESPACE"," ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$attribute",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getEntityTypeId",358],"(",")",",",["T_WHITESPACE","\n                ",358],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",359],["T_WHITESPACE","   ",359],["T_DOUBLE_ARROW","=>",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$attribute",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getId",359],"(",")",",",["T_WHITESPACE","\n                ",359],["T_CONSTANT_ENCAPSED_STRING","'table'",360],["T_WHITESPACE","          ",360],["T_DOUBLE_ARROW","=>",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$attribute",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getBackend",360],"(",")",["T_OBJECT_OPERATOR","->",360],["T_STRING","getTable",360],"(",")",",",["T_WHITESPACE","\n                ",360],["T_CONSTANT_ENCAPSED_STRING","'is_global'",361],["T_WHITESPACE","      ",361],["T_DOUBLE_ARROW","=>",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$attribute",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getIsGlobal",361],"(",")",["T_WHITESPACE","\n            ",361],")",";",["T_WHITESPACE","\n            ",362],["T_UNSET","unset",363],"(",["T_VARIABLE","$attribute",363],")",";",["T_WHITESPACE","\n        ",363],"}",["T_WHITESPACE","\n\n        ",364],["T_VARIABLE","$attributeTable",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","_categoryAttributes",366],"[",["T_VARIABLE","$attributeCode",366],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",366],"]",";",["T_WHITESPACE","\n\n        ",366],["T_VARIABLE","$attributeData",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_ARRAY","array",368],"(",["T_WHITESPACE","\n            ",368],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",369],["T_WHITESPACE","    ",369],["T_DOUBLE_ARROW","=>",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_categoryAttributes",369],"[",["T_VARIABLE","$attributeCode",369],"]","[",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",369],"]",",",["T_WHITESPACE","\n            ",369],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",370],["T_WHITESPACE","      ",370],["T_DOUBLE_ARROW","=>",370],["T_WHITESPACE"," ",370],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","_categoryAttributes",370],"[",["T_VARIABLE","$attributeCode",370],"]","[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",370],"]",",",["T_WHITESPACE","\n            ",370],["T_CONSTANT_ENCAPSED_STRING","'store_id'",371],["T_WHITESPACE","          ",371],["T_DOUBLE_ARROW","=>",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$category",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getStoreId",371],"(",")",",",["T_WHITESPACE","\n            ",371],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",372],["T_WHITESPACE","         ",372],["T_DOUBLE_ARROW","=>",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$category",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getId",372],"(",")",",",["T_WHITESPACE","\n            ",372],["T_CONSTANT_ENCAPSED_STRING","'value'",373],["T_WHITESPACE","             ",373],["T_DOUBLE_ARROW","=>",373],["T_WHITESPACE"," ",373],["T_VARIABLE","$category",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getData",373],"(",["T_VARIABLE","$attributeCode",373],")",["T_WHITESPACE","\n        ",373],")",";",["T_WHITESPACE","\n\n        ",374],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","_categoryAttributes",376],"[",["T_VARIABLE","$attributeCode",376],"]","[",["T_CONSTANT_ENCAPSED_STRING","'is_global'",376],"]",["T_WHITESPACE"," ",376],["T_BOOLEAN_OR","||",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$category",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getStoreId",376],"(",")",["T_WHITESPACE"," ",376],["T_IS_EQUAL","==",376],["T_WHITESPACE"," ",376],["T_LNUMBER","0",376],")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$attributeData",377],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",377],"]",["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_LNUMBER","0",377],";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE","\n\n        ",378],["T_VARIABLE","$select",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_VARIABLE","$adapter",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","select",380],"(",")",["T_WHITESPACE","\n            ",380],["T_OBJECT_OPERATOR","->",381],["T_STRING","from",381],"(",["T_VARIABLE","$attributeTable",381],")",["T_WHITESPACE","\n            ",381],["T_OBJECT_OPERATOR","->",382],["T_STRING","where",382],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id = ?'",382],",",["T_WHITESPACE"," ",382],["T_INT_CAST","(int)",382],["T_VARIABLE","$attributeData",382],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",382],"]",")",["T_WHITESPACE","\n            ",382],["T_OBJECT_OPERATOR","->",383],["T_STRING","where",383],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",383],",",["T_WHITESPACE"," ",383],["T_INT_CAST","(int)",383],["T_VARIABLE","$attributeData",383],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",383],"]",")",["T_WHITESPACE","\n            ",383],["T_OBJECT_OPERATOR","->",384],["T_STRING","where",384],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",384],",",["T_WHITESPACE"," ",384],["T_INT_CAST","(int)",384],["T_VARIABLE","$attributeData",384],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",384],"]",")",["T_WHITESPACE","\n            ",384],["T_OBJECT_OPERATOR","->",385],["T_STRING","where",385],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",385],",",["T_WHITESPACE"," ",385],["T_INT_CAST","(int)",385],["T_VARIABLE","$attributeData",385],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",385],"]",")",";",["T_WHITESPACE","\n\n        ",385],["T_VARIABLE","$row",387],["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],["T_VARIABLE","$adapter",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","fetchRow",387],"(",["T_VARIABLE","$select",387],")",";",["T_WHITESPACE","\n        ",387],["T_VARIABLE","$whereCond",388],["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_ARRAY","array",388],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id = ?'",388],["T_WHITESPACE"," ",388],["T_DOUBLE_ARROW","=>",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$row",388],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",388],"]",")",";",["T_WHITESPACE","\n        ",388],["T_IF","if",389],["T_WHITESPACE"," ",389],"(",["T_VARIABLE","$row",389],")",["T_WHITESPACE"," ",389],"{",["T_WHITESPACE","\n            ",389],["T_VARIABLE","$adapter",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","update",390],"(",["T_VARIABLE","$attributeTable",390],",",["T_WHITESPACE"," ",390],["T_VARIABLE","$attributeData",390],",",["T_WHITESPACE"," ",390],["T_VARIABLE","$whereCond",390],")",";",["T_WHITESPACE","\n        ",390],"}",["T_WHITESPACE"," ",391],["T_ELSE","else",391],["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n            ",391],["T_VARIABLE","$adapter",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","insert",392],"(",["T_VARIABLE","$attributeTable",392],",",["T_WHITESPACE"," ",392],["T_VARIABLE","$attributeData",392],")",";",["T_WHITESPACE","\n        ",392],"}",["T_WHITESPACE","\n\n        ",393],["T_IF","if",395],["T_WHITESPACE"," ",395],"(",["T_VARIABLE","$attributeData",395],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",395],"]",["T_WHITESPACE"," ",395],["T_IS_NOT_EQUAL","!=",395],["T_WHITESPACE"," ",395],["T_LNUMBER","0",395],")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n            ",395],["T_VARIABLE","$attributeData",396],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",396],"]",["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_LNUMBER","0",396],";",["T_WHITESPACE","\n            ",396],["T_VARIABLE","$select",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$adapter",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","select",397],"(",")",["T_WHITESPACE","\n                ",397],["T_OBJECT_OPERATOR","->",398],["T_STRING","from",398],"(",["T_VARIABLE","$attributeTable",398],")",["T_WHITESPACE","\n                ",398],["T_OBJECT_OPERATOR","->",399],["T_STRING","where",399],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id = ?'",399],",",["T_WHITESPACE"," ",399],["T_INT_CAST","(int)",399],["T_VARIABLE","$attributeData",399],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",399],"]",")",["T_WHITESPACE","\n                ",399],["T_OBJECT_OPERATOR","->",400],["T_STRING","where",400],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",400],",",["T_WHITESPACE"," ",400],["T_INT_CAST","(int)",400],["T_VARIABLE","$attributeData",400],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",400],"]",")",["T_WHITESPACE","\n                ",400],["T_OBJECT_OPERATOR","->",401],["T_STRING","where",401],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",401],",",["T_WHITESPACE"," ",401],["T_INT_CAST","(int)",401],["T_VARIABLE","$attributeData",401],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",401],"]",")",["T_WHITESPACE","\n                ",401],["T_OBJECT_OPERATOR","->",402],["T_STRING","where",402],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",402],",",["T_WHITESPACE"," ",402],["T_INT_CAST","(int)",402],["T_VARIABLE","$attributeData",402],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",402],"]",")",";",["T_WHITESPACE","\n\n            ",402],["T_VARIABLE","$row",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_VARIABLE","$adapter",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","fetchRow",404],"(",["T_VARIABLE","$select",404],")",";",["T_WHITESPACE","\n            ",404],["T_IF","if",405],["T_WHITESPACE"," ",405],"(",["T_VARIABLE","$row",405],")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n                ",405],["T_VARIABLE","$whereCond",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_ARRAY","array",406],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id = ?'",406],["T_WHITESPACE"," ",406],["T_DOUBLE_ARROW","=>",406],["T_WHITESPACE"," ",406],["T_VARIABLE","$row",406],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",406],"]",")",";",["T_WHITESPACE","\n                ",406],["T_VARIABLE","$adapter",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","update",407],"(",["T_VARIABLE","$attributeTable",407],",",["T_WHITESPACE"," ",407],["T_VARIABLE","$attributeData",407],",",["T_WHITESPACE"," ",407],["T_VARIABLE","$whereCond",407],")",";",["T_WHITESPACE","\n            ",407],"}",["T_WHITESPACE"," ",408],["T_ELSE","else",408],["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n                ",408],["T_VARIABLE","$adapter",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","insert",409],"(",["T_VARIABLE","$attributeTable",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$attributeData",409],")",";",["T_WHITESPACE","\n            ",409],"}",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n        ",411],["T_UNSET","unset",412],"(",["T_VARIABLE","$attributeData",412],")",";",["T_WHITESPACE","\n\n        ",412],["T_RETURN","return",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$this",414],";",["T_WHITESPACE","\n    ",414],"}",["T_WHITESPACE","\n\n    ",415],["T_DOC_COMMENT","\/**\n     * Retrieve category attributes\n     *\n     * @param string $attributeCode\n     * @param int|array $categoryIds\n     * @param int $storeId\n     * @return array\n     *\/",417],["T_WHITESPACE","\n    ",424],["T_PROTECTED","protected",425],["T_WHITESPACE"," ",425],["T_FUNCTION","function",425],["T_WHITESPACE"," ",425],["T_STRING","_getCategoryAttribute",425],"(",["T_VARIABLE","$attributeCode",425],",",["T_WHITESPACE"," ",425],["T_VARIABLE","$categoryIds",425],",",["T_WHITESPACE"," ",425],["T_VARIABLE","$storeId",425],")",["T_WHITESPACE","\n    ",425],"{",["T_WHITESPACE","\n        ",426],["T_VARIABLE","$adapter",427],["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_getWriteAdapter",427],"(",")",";",["T_WHITESPACE","\n        ",427],["T_IF","if",428],["T_WHITESPACE"," ",428],"(","!",["T_ISSET","isset",428],"(",["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","_categoryAttributes",428],"[",["T_VARIABLE","$attributeCode",428],"]",")",")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n            ",428],["T_VARIABLE","$attribute",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getCategoryModel",429],"(",")",["T_OBJECT_OPERATOR","->",429],["T_STRING","getResource",429],"(",")",["T_OBJECT_OPERATOR","->",429],["T_STRING","getAttribute",429],"(",["T_VARIABLE","$attributeCode",429],")",";",["T_WHITESPACE","\n\n            ",429],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_categoryAttributes",431],"[",["T_VARIABLE","$attributeCode",431],"]",["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_ARRAY","array",431],"(",["T_WHITESPACE","\n                ",431],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",432],["T_WHITESPACE"," ",432],["T_DOUBLE_ARROW","=>",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$attribute",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getEntityTypeId",432],"(",")",",",["T_WHITESPACE","\n                ",432],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",433],["T_WHITESPACE","   ",433],["T_DOUBLE_ARROW","=>",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$attribute",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getId",433],"(",")",",",["T_WHITESPACE","\n                ",433],["T_CONSTANT_ENCAPSED_STRING","'table'",434],["T_WHITESPACE","          ",434],["T_DOUBLE_ARROW","=>",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$attribute",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getBackend",434],"(",")",["T_OBJECT_OPERATOR","->",434],["T_STRING","getTable",434],"(",")",",",["T_WHITESPACE","\n                ",434],["T_CONSTANT_ENCAPSED_STRING","'is_global'",435],["T_WHITESPACE","      ",435],["T_DOUBLE_ARROW","=>",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$attribute",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getIsGlobal",435],"(",")",",",["T_WHITESPACE","\n                ",435],["T_CONSTANT_ENCAPSED_STRING","'is_static'",436],["T_WHITESPACE","      ",436],["T_DOUBLE_ARROW","=>",436],["T_WHITESPACE"," ",436],["T_VARIABLE","$attribute",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","isStatic",436],"(",")",["T_WHITESPACE","\n            ",436],")",";",["T_WHITESPACE","\n            ",437],["T_UNSET","unset",438],"(",["T_VARIABLE","$attribute",438],")",";",["T_WHITESPACE","\n        ",438],"}",["T_WHITESPACE","\n\n        ",439],["T_IF","if",441],["T_WHITESPACE"," ",441],"(","!",["T_STRING","is_array",441],"(",["T_VARIABLE","$categoryIds",441],")",")",["T_WHITESPACE"," ",441],"{",["T_WHITESPACE","\n            ",441],["T_VARIABLE","$categoryIds",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_ARRAY","array",442],"(",["T_VARIABLE","$categoryIds",442],")",";",["T_WHITESPACE","\n        ",442],"}",["T_WHITESPACE","\n\n        ",443],["T_VARIABLE","$attributeTable",445],["T_WHITESPACE"," ",445],"=",["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","_categoryAttributes",445],"[",["T_VARIABLE","$attributeCode",445],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",445],"]",";",["T_WHITESPACE","\n        ",445],["T_VARIABLE","$select",446],["T_WHITESPACE","         ",446],"=",["T_WHITESPACE"," ",446],["T_VARIABLE","$adapter",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","select",446],"(",")",";",["T_WHITESPACE","\n        ",446],["T_VARIABLE","$bind",447],["T_WHITESPACE","           ",447],"=",["T_WHITESPACE"," ",447],["T_ARRAY","array",447],"(",")",";",["T_WHITESPACE","\n        ",447],["T_IF","if",448],["T_WHITESPACE"," ",448],"(",["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","_categoryAttributes",448],"[",["T_VARIABLE","$attributeCode",448],"]","[",["T_CONSTANT_ENCAPSED_STRING","'is_static'",448],"]",")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$select",449],["T_WHITESPACE","\n                ",449],["T_OBJECT_OPERATOR","->",450],["T_STRING","from",450],"(",["T_WHITESPACE","\n                    ",450],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getTable",451],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",451],")",",",["T_WHITESPACE","\n                    ",451],["T_ARRAY","array",452],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",452],["T_WHITESPACE"," ",452],["T_DOUBLE_ARROW","=>",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$attributeCode",452],",",["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",452],["T_WHITESPACE"," ",452],["T_DOUBLE_ARROW","=>",452],["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",452],")",["T_WHITESPACE","\n                ",452],")",["T_WHITESPACE","\n                ",453],["T_OBJECT_OPERATOR","->",454],["T_STRING","where",454],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",454],",",["T_WHITESPACE"," ",454],["T_VARIABLE","$categoryIds",454],")",";",["T_WHITESPACE","\n        ",454],"}",["T_WHITESPACE"," ",455],["T_ELSEIF","elseif",455],["T_WHITESPACE"," ",455],"(",["T_VARIABLE","$this",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","_categoryAttributes",455],"[",["T_VARIABLE","$attributeCode",455],"]","[",["T_CONSTANT_ENCAPSED_STRING","'is_global'",455],"]",["T_WHITESPACE"," ",455],["T_BOOLEAN_OR","||",455],["T_WHITESPACE"," ",455],["T_VARIABLE","$storeId",455],["T_WHITESPACE"," ",455],["T_IS_EQUAL","==",455],["T_WHITESPACE"," ",455],["T_LNUMBER","0",455],")",["T_WHITESPACE"," ",455],"{",["T_WHITESPACE","\n            ",455],["T_VARIABLE","$select",456],["T_WHITESPACE","\n                ",456],["T_OBJECT_OPERATOR","->",457],["T_STRING","from",457],"(",["T_VARIABLE","$attributeTable",457],",",["T_WHITESPACE"," ",457],["T_ARRAY","array",457],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",457],",",["T_WHITESPACE"," ",457],["T_CONSTANT_ENCAPSED_STRING","'value'",457],")",")",["T_WHITESPACE","\n                ",457],["T_OBJECT_OPERATOR","->",458],["T_STRING","where",458],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = :attribute_id'",458],")",["T_WHITESPACE","\n                ",458],["T_OBJECT_OPERATOR","->",459],["T_STRING","where",459],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",459],",",["T_WHITESPACE"," ",459],["T_LNUMBER","0",459],")",["T_WHITESPACE","\n                ",459],["T_OBJECT_OPERATOR","->",460],["T_STRING","where",460],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",460],",",["T_WHITESPACE"," ",460],["T_VARIABLE","$categoryIds",460],")",";",["T_WHITESPACE","\n            ",460],["T_VARIABLE","$bind",461],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",461],"]",["T_WHITESPACE"," ",461],"=",["T_WHITESPACE"," ",461],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","_categoryAttributes",461],"[",["T_VARIABLE","$attributeCode",461],"]","[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",461],"]",";",["T_WHITESPACE","\n        ",461],"}",["T_WHITESPACE"," ",462],["T_ELSE","else",462],["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n            ",462],["T_VARIABLE","$valueExpr",463],["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_VARIABLE","$adapter",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getCheckSql",463],"(",["T_CONSTANT_ENCAPSED_STRING","'t2.value_id > 0'",463],",",["T_WHITESPACE"," ",463],["T_CONSTANT_ENCAPSED_STRING","'t2.value'",463],",",["T_WHITESPACE"," ",463],["T_CONSTANT_ENCAPSED_STRING","'t1.value'",463],")",";",["T_WHITESPACE","\n            ",463],["T_VARIABLE","$select",464],["T_WHITESPACE","\n                ",464],["T_OBJECT_OPERATOR","->",465],["T_STRING","from",465],"(",["T_WHITESPACE","\n                    ",465],["T_ARRAY","array",466],"(",["T_CONSTANT_ENCAPSED_STRING","'t1'",466],["T_WHITESPACE"," ",466],["T_DOUBLE_ARROW","=>",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$attributeTable",466],")",",",["T_WHITESPACE","\n                    ",466],["T_ARRAY","array",467],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",467],",",["T_WHITESPACE"," ",467],["T_CONSTANT_ENCAPSED_STRING","'value'",467],["T_WHITESPACE"," ",467],["T_DOUBLE_ARROW","=>",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$valueExpr",467],")",["T_WHITESPACE","\n                ",467],")",["T_WHITESPACE","\n                ",468],["T_OBJECT_OPERATOR","->",469],["T_STRING","joinLeft",469],"(",["T_WHITESPACE","\n                    ",469],["T_ARRAY","array",470],"(",["T_CONSTANT_ENCAPSED_STRING","'t2'",470],["T_WHITESPACE"," ",470],["T_DOUBLE_ARROW","=>",470],["T_WHITESPACE"," ",470],["T_VARIABLE","$attributeTable",470],")",",",["T_WHITESPACE","\n                    ",470],["T_CONSTANT_ENCAPSED_STRING","'t1.entity_id = t2.entity_id AND t1.attribute_id = t2.attribute_id AND t2.store_id = :store_id'",471],",",["T_WHITESPACE","\n                    ",471],["T_ARRAY","array",472],"(",")",["T_WHITESPACE","\n                ",472],")",["T_WHITESPACE","\n                ",473],["T_OBJECT_OPERATOR","->",474],["T_STRING","where",474],"(",["T_CONSTANT_ENCAPSED_STRING","'t1.store_id = ?'",474],",",["T_WHITESPACE"," ",474],["T_LNUMBER","0",474],")",["T_WHITESPACE","\n                ",474],["T_OBJECT_OPERATOR","->",475],["T_STRING","where",475],"(",["T_CONSTANT_ENCAPSED_STRING","'t1.attribute_id = :attribute_id'",475],")",["T_WHITESPACE","\n                ",475],["T_OBJECT_OPERATOR","->",476],["T_STRING","where",476],"(",["T_CONSTANT_ENCAPSED_STRING","'t1.entity_id IN(?)'",476],",",["T_WHITESPACE"," ",476],["T_VARIABLE","$categoryIds",476],")",";",["T_WHITESPACE","\n\n            ",476],["T_VARIABLE","$bind",478],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",478],"]",["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","_categoryAttributes",478],"[",["T_VARIABLE","$attributeCode",478],"]","[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",478],"]",";",["T_WHITESPACE","\n            ",478],["T_VARIABLE","$bind",479],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",479],"]",["T_WHITESPACE","     ",479],"=",["T_WHITESPACE"," ",479],["T_VARIABLE","$storeId",479],";",["T_WHITESPACE","\n        ",479],"}",["T_WHITESPACE","\n\n        ",480],["T_VARIABLE","$rowSet",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_VARIABLE","$adapter",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","fetchAll",482],"(",["T_VARIABLE","$select",482],",",["T_WHITESPACE"," ",482],["T_VARIABLE","$bind",482],")",";",["T_WHITESPACE","\n\n        ",482],["T_VARIABLE","$attributes",484],["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_ARRAY","array",484],"(",")",";",["T_WHITESPACE","\n        ",484],["T_FOREACH","foreach",485],["T_WHITESPACE"," ",485],"(",["T_VARIABLE","$rowSet",485],["T_WHITESPACE"," ",485],["T_AS","as",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$row",485],")",["T_WHITESPACE"," ",485],"{",["T_WHITESPACE","\n            ",485],["T_VARIABLE","$attributes",486],"[",["T_VARIABLE","$row",486],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",486],"]","]",["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$row",486],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",486],"]",";",["T_WHITESPACE","\n        ",486],"}",["T_WHITESPACE","\n        ",487],["T_UNSET","unset",488],"(",["T_VARIABLE","$rowSet",488],")",";",["T_WHITESPACE","\n        ",488],["T_FOREACH","foreach",489],["T_WHITESPACE"," ",489],"(",["T_VARIABLE","$categoryIds",489],["T_WHITESPACE"," ",489],["T_AS","as",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$categoryId",489],")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n            ",489],["T_IF","if",490],["T_WHITESPACE"," ",490],"(","!",["T_ISSET","isset",490],"(",["T_VARIABLE","$attributes",490],"[",["T_VARIABLE","$categoryId",490],"]",")",")",["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n                ",490],["T_VARIABLE","$attributes",491],"[",["T_VARIABLE","$categoryId",491],"]",["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_STRING","null",491],";",["T_WHITESPACE","\n            ",491],"}",["T_WHITESPACE","\n        ",492],"}",["T_WHITESPACE","\n\n        ",493],["T_RETURN","return",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$attributes",495],";",["T_WHITESPACE","\n    ",495],"}",["T_WHITESPACE","\n\n    ",496],["T_DOC_COMMENT","\/**\n     * Save product attribute\n     *\n     * @param Varien_Object $product\n     * @param string $attributeCode\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",498],["T_WHITESPACE","\n    ",504],["T_PUBLIC","public",505],["T_WHITESPACE"," ",505],["T_FUNCTION","function",505],["T_WHITESPACE"," ",505],["T_STRING","saveProductAttribute",505],"(",["T_STRING","Varien_Object",505],["T_WHITESPACE"," ",505],["T_VARIABLE","$product",505],",",["T_WHITESPACE"," ",505],["T_VARIABLE","$attributeCode",505],")",["T_WHITESPACE","\n    ",505],"{",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$adapter",507],["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","_getWriteAdapter",507],"(",")",";",["T_WHITESPACE","\n        ",507],["T_IF","if",508],["T_WHITESPACE"," ",508],"(","!",["T_ISSET","isset",508],"(",["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","_productAttributes",508],"[",["T_VARIABLE","$attributeCode",508],"]",")",")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n            ",508],["T_VARIABLE","$attribute",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getProductModel",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","getResource",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","getAttribute",509],"(",["T_VARIABLE","$attributeCode",509],")",";",["T_WHITESPACE","\n\n            ",509],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","_productAttributes",511],"[",["T_VARIABLE","$attributeCode",511],"]",["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_ARRAY","array",511],"(",["T_WHITESPACE","\n                ",511],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",512],["T_WHITESPACE"," ",512],["T_DOUBLE_ARROW","=>",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$attribute",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getEntityTypeId",512],"(",")",",",["T_WHITESPACE","\n                ",512],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",513],["T_WHITESPACE","   ",513],["T_DOUBLE_ARROW","=>",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$attribute",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getId",513],"(",")",",",["T_WHITESPACE","\n                ",513],["T_CONSTANT_ENCAPSED_STRING","'table'",514],["T_WHITESPACE","          ",514],["T_DOUBLE_ARROW","=>",514],["T_WHITESPACE"," ",514],["T_VARIABLE","$attribute",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","getBackend",514],"(",")",["T_OBJECT_OPERATOR","->",514],["T_STRING","getTable",514],"(",")",",",["T_WHITESPACE","\n                ",514],["T_CONSTANT_ENCAPSED_STRING","'is_global'",515],["T_WHITESPACE","      ",515],["T_DOUBLE_ARROW","=>",515],["T_WHITESPACE"," ",515],["T_VARIABLE","$attribute",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","getIsGlobal",515],"(",")",["T_WHITESPACE","\n            ",515],")",";",["T_WHITESPACE","\n            ",516],["T_UNSET","unset",517],"(",["T_VARIABLE","$attribute",517],")",";",["T_WHITESPACE","\n        ",517],"}",["T_WHITESPACE","\n\n        ",518],["T_VARIABLE","$attributeTable",520],["T_WHITESPACE"," ",520],"=",["T_WHITESPACE"," ",520],["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","_productAttributes",520],"[",["T_VARIABLE","$attributeCode",520],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",520],"]",";",["T_WHITESPACE","\n\n        ",520],["T_VARIABLE","$attributeData",522],["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_ARRAY","array",522],"(",["T_WHITESPACE","\n            ",522],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",523],["T_WHITESPACE","    ",523],["T_DOUBLE_ARROW","=>",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_productAttributes",523],"[",["T_VARIABLE","$attributeCode",523],"]","[",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",523],"]",",",["T_WHITESPACE","\n            ",523],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",524],["T_WHITESPACE","      ",524],["T_DOUBLE_ARROW","=>",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","_productAttributes",524],"[",["T_VARIABLE","$attributeCode",524],"]","[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",524],"]",",",["T_WHITESPACE","\n            ",524],["T_CONSTANT_ENCAPSED_STRING","'store_id'",525],["T_WHITESPACE","          ",525],["T_DOUBLE_ARROW","=>",525],["T_WHITESPACE"," ",525],["T_VARIABLE","$product",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","getStoreId",525],"(",")",",",["T_WHITESPACE","\n            ",525],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",526],["T_WHITESPACE","         ",526],["T_DOUBLE_ARROW","=>",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$product",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getId",526],"(",")",",",["T_WHITESPACE","\n            ",526],["T_CONSTANT_ENCAPSED_STRING","'value'",527],["T_WHITESPACE","             ",527],["T_DOUBLE_ARROW","=>",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$product",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getData",527],"(",["T_VARIABLE","$attributeCode",527],")",["T_WHITESPACE","\n        ",527],")",";",["T_WHITESPACE","\n\n        ",528],["T_IF","if",530],["T_WHITESPACE"," ",530],"(",["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","_productAttributes",530],"[",["T_VARIABLE","$attributeCode",530],"]","[",["T_CONSTANT_ENCAPSED_STRING","'is_global'",530],"]",["T_WHITESPACE"," ",530],["T_BOOLEAN_OR","||",530],["T_WHITESPACE"," ",530],["T_VARIABLE","$product",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","getStoreId",530],"(",")",["T_WHITESPACE"," ",530],["T_IS_EQUAL","==",530],["T_WHITESPACE"," ",530],["T_LNUMBER","0",530],")",["T_WHITESPACE"," ",530],"{",["T_WHITESPACE","\n            ",530],["T_VARIABLE","$attributeData",531],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",531],"]",["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_LNUMBER","0",531],";",["T_WHITESPACE","\n        ",531],"}",["T_WHITESPACE","\n\n        ",532],["T_VARIABLE","$select",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_VARIABLE","$adapter",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","select",534],"(",")",["T_WHITESPACE","\n            ",534],["T_OBJECT_OPERATOR","->",535],["T_STRING","from",535],"(",["T_VARIABLE","$attributeTable",535],")",["T_WHITESPACE","\n            ",535],["T_OBJECT_OPERATOR","->",536],["T_STRING","where",536],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id = ?'",536],",",["T_WHITESPACE"," ",536],["T_INT_CAST","(int)",536],["T_VARIABLE","$attributeData",536],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",536],"]",")",["T_WHITESPACE","\n            ",536],["T_OBJECT_OPERATOR","->",537],["T_STRING","where",537],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",537],",",["T_WHITESPACE"," ",537],["T_INT_CAST","(int)",537],["T_VARIABLE","$attributeData",537],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",537],"]",")",["T_WHITESPACE","\n            ",537],["T_OBJECT_OPERATOR","->",538],["T_STRING","where",538],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",538],",",["T_WHITESPACE"," ",538],["T_INT_CAST","(int)",538],["T_VARIABLE","$attributeData",538],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",538],"]",")",["T_WHITESPACE","\n            ",538],["T_OBJECT_OPERATOR","->",539],["T_STRING","where",539],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",539],",",["T_WHITESPACE"," ",539],["T_INT_CAST","(int)",539],["T_VARIABLE","$attributeData",539],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",539],"]",")",";",["T_WHITESPACE","\n\n        ",539],["T_VARIABLE","$row",541],["T_WHITESPACE"," ",541],"=",["T_WHITESPACE"," ",541],["T_VARIABLE","$adapter",541],["T_OBJECT_OPERATOR","->",541],["T_STRING","fetchRow",541],"(",["T_VARIABLE","$select",541],")",";",["T_WHITESPACE","\n        ",541],["T_IF","if",542],["T_WHITESPACE"," ",542],"(",["T_VARIABLE","$row",542],")",["T_WHITESPACE"," ",542],"{",["T_WHITESPACE","\n            ",542],["T_VARIABLE","$whereCond",543],["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_ARRAY","array",543],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id = ?'",543],["T_WHITESPACE"," ",543],["T_DOUBLE_ARROW","=>",543],["T_WHITESPACE"," ",543],["T_VARIABLE","$row",543],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",543],"]",")",";",["T_WHITESPACE","\n            ",543],["T_VARIABLE","$adapter",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","update",544],"(",["T_VARIABLE","$attributeTable",544],",",["T_WHITESPACE"," ",544],["T_VARIABLE","$attributeData",544],",",["T_WHITESPACE"," ",544],["T_VARIABLE","$whereCond",544],")",";",["T_WHITESPACE","\n        ",544],"}",["T_WHITESPACE"," ",545],["T_ELSE","else",545],["T_WHITESPACE"," ",545],"{",["T_WHITESPACE","\n            ",545],["T_VARIABLE","$adapter",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","insert",546],"(",["T_VARIABLE","$attributeTable",546],",",["T_WHITESPACE"," ",546],["T_VARIABLE","$attributeData",546],")",";",["T_WHITESPACE","\n        ",546],"}",["T_WHITESPACE","\n\n        ",547],["T_IF","if",549],["T_WHITESPACE"," ",549],"(",["T_VARIABLE","$attributeData",549],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",549],"]",["T_WHITESPACE"," ",549],["T_IS_NOT_EQUAL","!=",549],["T_WHITESPACE"," ",549],["T_LNUMBER","0",549],")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_VARIABLE","$attributeData",550],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",550],"]",["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_LNUMBER","0",550],";",["T_WHITESPACE","\n            ",550],["T_VARIABLE","$select",551],["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_VARIABLE","$adapter",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","select",551],"(",")",["T_WHITESPACE","\n                ",551],["T_OBJECT_OPERATOR","->",552],["T_STRING","from",552],"(",["T_VARIABLE","$attributeTable",552],")",["T_WHITESPACE","\n                ",552],["T_OBJECT_OPERATOR","->",553],["T_STRING","where",553],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id = ?'",553],",",["T_WHITESPACE"," ",553],["T_INT_CAST","(int)",553],["T_VARIABLE","$attributeData",553],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",553],"]",")",["T_WHITESPACE","\n                ",553],["T_OBJECT_OPERATOR","->",554],["T_STRING","where",554],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",554],",",["T_WHITESPACE"," ",554],["T_INT_CAST","(int)",554],["T_VARIABLE","$attributeData",554],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",554],"]",")",["T_WHITESPACE","\n                ",554],["T_OBJECT_OPERATOR","->",555],["T_STRING","where",555],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",555],",",["T_WHITESPACE"," ",555],["T_INT_CAST","(int)",555],["T_VARIABLE","$attributeData",555],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",555],"]",")",["T_WHITESPACE","\n                ",555],["T_OBJECT_OPERATOR","->",556],["T_STRING","where",556],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",556],",",["T_WHITESPACE"," ",556],["T_INT_CAST","(int)",556],["T_VARIABLE","$attributeData",556],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",556],"]",")",";",["T_WHITESPACE","\n\n            ",556],["T_VARIABLE","$row",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$adapter",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","fetchRow",558],"(",["T_VARIABLE","$select",558],")",";",["T_WHITESPACE","\n            ",558],["T_IF","if",559],["T_WHITESPACE"," ",559],"(",["T_VARIABLE","$row",559],")",["T_WHITESPACE"," ",559],"{",["T_WHITESPACE","\n                ",559],["T_VARIABLE","$whereCond",560],["T_WHITESPACE"," ",560],"=",["T_WHITESPACE"," ",560],["T_ARRAY","array",560],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id = ?'",560],["T_WHITESPACE"," ",560],["T_DOUBLE_ARROW","=>",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$row",560],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",560],"]",")",";",["T_WHITESPACE","\n                ",560],["T_VARIABLE","$adapter",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","update",561],"(",["T_VARIABLE","$attributeTable",561],",",["T_WHITESPACE"," ",561],["T_VARIABLE","$attributeData",561],",",["T_WHITESPACE"," ",561],["T_VARIABLE","$whereCond",561],")",";",["T_WHITESPACE","\n            ",561],"}",["T_WHITESPACE"," ",562],["T_ELSE","else",562],["T_WHITESPACE"," ",562],"{",["T_WHITESPACE","\n                ",562],["T_VARIABLE","$adapter",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","insert",563],"(",["T_VARIABLE","$attributeTable",563],",",["T_WHITESPACE"," ",563],["T_VARIABLE","$attributeData",563],")",";",["T_WHITESPACE","\n            ",563],"}",["T_WHITESPACE","\n        ",564],"}",["T_WHITESPACE","\n        ",565],["T_UNSET","unset",566],"(",["T_VARIABLE","$attributeData",566],")",";",["T_WHITESPACE","\n\n        ",566],["T_RETURN","return",568],["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],";",["T_WHITESPACE","\n    ",568],"}",["T_WHITESPACE","\n\n    ",569],["T_DOC_COMMENT","\/**\n     * Retrieve product attribute\n     *\n     * @param string $attributeCode\n     * @param int|array $productIds\n     * @param string $storeId\n     * @return array\n     *\/",571],["T_WHITESPACE","\n    ",578],["T_PUBLIC","public",579],["T_WHITESPACE"," ",579],["T_FUNCTION","function",579],["T_WHITESPACE"," ",579],["T_STRING","_getProductAttribute",579],"(",["T_VARIABLE","$attributeCode",579],",",["T_WHITESPACE"," ",579],["T_VARIABLE","$productIds",579],",",["T_WHITESPACE"," ",579],["T_VARIABLE","$storeId",579],")",["T_WHITESPACE","\n    ",579],"{",["T_WHITESPACE","\n        ",580],["T_VARIABLE","$adapter",581],["T_WHITESPACE"," ",581],"=",["T_WHITESPACE"," ",581],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","_getReadAdapter",581],"(",")",";",["T_WHITESPACE","\n        ",581],["T_IF","if",582],["T_WHITESPACE"," ",582],"(","!",["T_ISSET","isset",582],"(",["T_VARIABLE","$this",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","_productAttributes",582],"[",["T_VARIABLE","$attributeCode",582],"]",")",")",["T_WHITESPACE"," ",582],"{",["T_WHITESPACE","\n            ",582],["T_VARIABLE","$attribute",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","getProductModel",583],"(",")",["T_OBJECT_OPERATOR","->",583],["T_STRING","getResource",583],"(",")",["T_OBJECT_OPERATOR","->",583],["T_STRING","getAttribute",583],"(",["T_VARIABLE","$attributeCode",583],")",";",["T_WHITESPACE","\n\n            ",583],["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","_productAttributes",585],"[",["T_VARIABLE","$attributeCode",585],"]",["T_WHITESPACE"," ",585],"=",["T_WHITESPACE"," ",585],["T_ARRAY","array",585],"(",["T_WHITESPACE","\n                ",585],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",586],["T_WHITESPACE"," ",586],["T_DOUBLE_ARROW","=>",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$attribute",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","getEntityTypeId",586],"(",")",",",["T_WHITESPACE","\n                ",586],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",587],["T_WHITESPACE","   ",587],["T_DOUBLE_ARROW","=>",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$attribute",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getId",587],"(",")",",",["T_WHITESPACE","\n                ",587],["T_CONSTANT_ENCAPSED_STRING","'table'",588],["T_WHITESPACE","          ",588],["T_DOUBLE_ARROW","=>",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$attribute",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","getBackend",588],"(",")",["T_OBJECT_OPERATOR","->",588],["T_STRING","getTable",588],"(",")",",",["T_WHITESPACE","\n                ",588],["T_CONSTANT_ENCAPSED_STRING","'is_global'",589],["T_WHITESPACE","      ",589],["T_DOUBLE_ARROW","=>",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$attribute",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getIsGlobal",589],"(",")",["T_WHITESPACE","\n            ",589],")",";",["T_WHITESPACE","\n            ",590],["T_UNSET","unset",591],"(",["T_VARIABLE","$attribute",591],")",";",["T_WHITESPACE","\n        ",591],"}",["T_WHITESPACE","\n\n        ",592],["T_IF","if",594],["T_WHITESPACE"," ",594],"(","!",["T_STRING","is_array",594],"(",["T_VARIABLE","$productIds",594],")",")",["T_WHITESPACE"," ",594],"{",["T_WHITESPACE","\n            ",594],["T_VARIABLE","$productIds",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],["T_ARRAY","array",595],"(",["T_VARIABLE","$productIds",595],")",";",["T_WHITESPACE","\n        ",595],"}",["T_WHITESPACE","\n        ",596],["T_VARIABLE","$bind",597],["T_WHITESPACE"," ",597],"=",["T_WHITESPACE"," ",597],["T_ARRAY","array",597],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",597],["T_WHITESPACE"," ",597],["T_DOUBLE_ARROW","=>",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","_productAttributes",597],"[",["T_VARIABLE","$attributeCode",597],"]","[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",597],"]",")",";",["T_WHITESPACE","\n        ",597],["T_VARIABLE","$select",598],["T_WHITESPACE"," ",598],"=",["T_WHITESPACE"," ",598],["T_VARIABLE","$adapter",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","select",598],"(",")",";",["T_WHITESPACE","\n        ",598],["T_VARIABLE","$attributeTable",599],["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","_productAttributes",599],"[",["T_VARIABLE","$attributeCode",599],"]","[",["T_CONSTANT_ENCAPSED_STRING","'table'",599],"]",";",["T_WHITESPACE","\n        ",599],["T_IF","if",600],["T_WHITESPACE"," ",600],"(",["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","_productAttributes",600],"[",["T_VARIABLE","$attributeCode",600],"]","[",["T_CONSTANT_ENCAPSED_STRING","'is_global'",600],"]",["T_WHITESPACE"," ",600],["T_BOOLEAN_OR","||",600],["T_WHITESPACE"," ",600],["T_VARIABLE","$storeId",600],["T_WHITESPACE"," ",600],["T_IS_EQUAL","==",600],["T_WHITESPACE"," ",600],["T_LNUMBER","0",600],")",["T_WHITESPACE"," ",600],"{",["T_WHITESPACE","\n            ",600],["T_VARIABLE","$select",601],["T_WHITESPACE","\n                ",601],["T_OBJECT_OPERATOR","->",602],["T_STRING","from",602],"(",["T_VARIABLE","$attributeTable",602],",",["T_WHITESPACE"," ",602],["T_ARRAY","array",602],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",602],",",["T_WHITESPACE"," ",602],["T_CONSTANT_ENCAPSED_STRING","'value'",602],")",")",["T_WHITESPACE","\n                ",602],["T_OBJECT_OPERATOR","->",603],["T_STRING","where",603],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = :attribute_id'",603],")",["T_WHITESPACE","\n                ",603],["T_OBJECT_OPERATOR","->",604],["T_STRING","where",604],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",604],",",["T_WHITESPACE"," ",604],["T_LNUMBER","0",604],")",["T_WHITESPACE","\n                ",604],["T_OBJECT_OPERATOR","->",605],["T_STRING","where",605],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",605],",",["T_WHITESPACE"," ",605],["T_VARIABLE","$productIds",605],")",";",["T_WHITESPACE","\n        ",605],"}",["T_WHITESPACE"," ",606],["T_ELSE","else",606],["T_WHITESPACE"," ",606],"{",["T_WHITESPACE","\n            ",606],["T_VARIABLE","$valueExpr",607],["T_WHITESPACE"," ",607],"=",["T_WHITESPACE"," ",607],["T_VARIABLE","$adapter",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","getCheckSql",607],"(",["T_CONSTANT_ENCAPSED_STRING","'t2.value_id > 0'",607],",",["T_WHITESPACE"," ",607],["T_CONSTANT_ENCAPSED_STRING","'t2.value'",607],",",["T_WHITESPACE"," ",607],["T_CONSTANT_ENCAPSED_STRING","'t1.value'",607],")",";",["T_WHITESPACE","\n            ",607],["T_VARIABLE","$select",608],["T_WHITESPACE","\n                ",608],["T_OBJECT_OPERATOR","->",609],["T_STRING","from",609],"(",["T_WHITESPACE","\n                    ",609],["T_ARRAY","array",610],"(",["T_CONSTANT_ENCAPSED_STRING","'t1'",610],["T_WHITESPACE"," ",610],["T_DOUBLE_ARROW","=>",610],["T_WHITESPACE"," ",610],["T_VARIABLE","$attributeTable",610],")",",",["T_WHITESPACE","\n                    ",610],["T_ARRAY","array",611],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",611],",",["T_WHITESPACE"," ",611],["T_CONSTANT_ENCAPSED_STRING","'value'",611],["T_WHITESPACE"," ",611],["T_DOUBLE_ARROW","=>",611],["T_WHITESPACE"," ",611],["T_VARIABLE","$valueExpr",611],")",["T_WHITESPACE","\n                ",611],")",["T_WHITESPACE","\n                ",612],["T_OBJECT_OPERATOR","->",613],["T_STRING","joinLeft",613],"(",["T_WHITESPACE","\n                    ",613],["T_ARRAY","array",614],"(",["T_CONSTANT_ENCAPSED_STRING","'t2'",614],["T_WHITESPACE"," ",614],["T_DOUBLE_ARROW","=>",614],["T_WHITESPACE"," ",614],["T_VARIABLE","$attributeTable",614],")",",",["T_WHITESPACE","\n                    ",614],["T_CONSTANT_ENCAPSED_STRING","'t1.entity_id = t2.entity_id AND t1.attribute_id = t2.attribute_id AND t2.store_id=:store_id'",615],",",["T_WHITESPACE","\n                    ",615],["T_ARRAY","array",616],"(",")",["T_WHITESPACE","\n                ",616],")",["T_WHITESPACE","\n                ",617],["T_OBJECT_OPERATOR","->",618],["T_STRING","where",618],"(",["T_CONSTANT_ENCAPSED_STRING","'t1.store_id = ?'",618],",",["T_WHITESPACE"," ",618],["T_LNUMBER","0",618],")",["T_WHITESPACE","\n                ",618],["T_OBJECT_OPERATOR","->",619],["T_STRING","where",619],"(",["T_CONSTANT_ENCAPSED_STRING","'t1.attribute_id = :attribute_id'",619],")",["T_WHITESPACE","\n                ",619],["T_OBJECT_OPERATOR","->",620],["T_STRING","where",620],"(",["T_CONSTANT_ENCAPSED_STRING","'t1.entity_id IN(?)'",620],",",["T_WHITESPACE"," ",620],["T_VARIABLE","$productIds",620],")",";",["T_WHITESPACE","\n            ",620],["T_VARIABLE","$bind",621],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",621],"]",["T_WHITESPACE"," ",621],"=",["T_WHITESPACE"," ",621],["T_VARIABLE","$storeId",621],";",["T_WHITESPACE","\n        ",621],"}",["T_WHITESPACE","\n\n        ",622],["T_VARIABLE","$rowSet",624],["T_WHITESPACE"," ",624],"=",["T_WHITESPACE"," ",624],["T_VARIABLE","$adapter",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","fetchAll",624],"(",["T_VARIABLE","$select",624],",",["T_WHITESPACE"," ",624],["T_VARIABLE","$bind",624],")",";",["T_WHITESPACE","\n\n        ",624],["T_VARIABLE","$attributes",626],["T_WHITESPACE"," ",626],"=",["T_WHITESPACE"," ",626],["T_ARRAY","array",626],"(",")",";",["T_WHITESPACE","\n        ",626],["T_FOREACH","foreach",627],["T_WHITESPACE"," ",627],"(",["T_VARIABLE","$rowSet",627],["T_WHITESPACE"," ",627],["T_AS","as",627],["T_WHITESPACE"," ",627],["T_VARIABLE","$row",627],")",["T_WHITESPACE"," ",627],"{",["T_WHITESPACE","\n            ",627],["T_VARIABLE","$attributes",628],"[",["T_VARIABLE","$row",628],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",628],"]","]",["T_WHITESPACE"," ",628],"=",["T_WHITESPACE"," ",628],["T_VARIABLE","$row",628],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",628],"]",";",["T_WHITESPACE","\n        ",628],"}",["T_WHITESPACE","\n        ",629],["T_UNSET","unset",630],"(",["T_VARIABLE","$rowSet",630],")",";",["T_WHITESPACE","\n        ",630],["T_FOREACH","foreach",631],["T_WHITESPACE"," ",631],"(",["T_VARIABLE","$productIds",631],["T_WHITESPACE"," ",631],["T_AS","as",631],["T_WHITESPACE"," ",631],["T_VARIABLE","$productIds",631],")",["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n            ",631],["T_IF","if",632],["T_WHITESPACE"," ",632],"(","!",["T_ISSET","isset",632],"(",["T_VARIABLE","$attributes",632],"[",["T_VARIABLE","$productIds",632],"]",")",")",["T_WHITESPACE"," ",632],"{",["T_WHITESPACE","\n                ",632],["T_VARIABLE","$attributes",633],"[",["T_VARIABLE","$productIds",633],"]",["T_WHITESPACE"," ",633],"=",["T_WHITESPACE"," ",633],["T_STRING","null",633],";",["T_WHITESPACE","\n            ",633],"}",["T_WHITESPACE","\n        ",634],"}",["T_WHITESPACE","\n\n        ",635],["T_RETURN","return",637],["T_WHITESPACE"," ",637],["T_VARIABLE","$attributes",637],";",["T_WHITESPACE","\n    ",637],"}",["T_WHITESPACE","\n\n    ",638],["T_DOC_COMMENT","\/**\n     * Prepare category parentId\n     *\n     * @param Varien_Object $category\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",640],["T_WHITESPACE","\n    ",645],["T_PROTECTED","protected",646],["T_WHITESPACE"," ",646],["T_FUNCTION","function",646],["T_WHITESPACE"," ",646],["T_STRING","_prepareCategoryParentId",646],"(",["T_STRING","Varien_Object",646],["T_WHITESPACE"," ",646],["T_VARIABLE","$category",646],")",["T_WHITESPACE","\n    ",646],"{",["T_WHITESPACE","\n        ",647],["T_IF","if",648],["T_WHITESPACE"," ",648],"(",["T_VARIABLE","$category",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getPath",648],"(",")",["T_WHITESPACE"," ",648],["T_IS_NOT_EQUAL","!=",648],["T_WHITESPACE"," ",648],["T_VARIABLE","$category",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getId",648],"(",")",")",["T_WHITESPACE"," ",648],"{",["T_WHITESPACE","\n            ",648],["T_VARIABLE","$split",649],["T_WHITESPACE"," ",649],"=",["T_WHITESPACE"," ",649],["T_STRING","explode",649],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",649],",",["T_WHITESPACE"," ",649],["T_VARIABLE","$category",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","getPath",649],"(",")",")",";",["T_WHITESPACE","\n            ",649],["T_VARIABLE","$category",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","setParentId",650],"(",["T_VARIABLE","$split",650],"[","(",["T_STRING","count",650],"(",["T_VARIABLE","$split",650],")",["T_WHITESPACE"," ",650],"-",["T_WHITESPACE"," ",650],["T_LNUMBER","2",650],")","]",")",";",["T_WHITESPACE","\n        ",650],"}",["T_WHITESPACE"," ",651],["T_ELSE","else",651],["T_WHITESPACE"," ",651],"{",["T_WHITESPACE","\n            ",651],["T_VARIABLE","$category",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","setParentId",652],"(",["T_LNUMBER","0",652],")",";",["T_WHITESPACE","\n        ",652],"}",["T_WHITESPACE","\n        ",653],["T_RETURN","return",654],["T_WHITESPACE"," ",654],["T_VARIABLE","$this",654],";",["T_WHITESPACE","\n    ",654],"}",["T_WHITESPACE","\n\n    ",655],["T_DOC_COMMENT","\/**\n     * Prepare stores root categories\n     *\n     * @param array $stores\n     * @return array\n     *\/",657],["T_WHITESPACE","\n    ",662],["T_PROTECTED","protected",663],["T_WHITESPACE"," ",663],["T_FUNCTION","function",663],["T_WHITESPACE"," ",663],["T_STRING","_prepareStoreRootCategories",663],"(",["T_VARIABLE","$stores",663],")",["T_WHITESPACE","\n    ",663],"{",["T_WHITESPACE","\n        ",664],["T_VARIABLE","$rootCategoryIds",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_ARRAY","array",665],"(",")",";",["T_WHITESPACE","\n        ",665],["T_FOREACH","foreach",666],["T_WHITESPACE"," ",666],"(",["T_VARIABLE","$stores",666],["T_WHITESPACE"," ",666],["T_AS","as",666],["T_WHITESPACE"," ",666],["T_VARIABLE","$store",666],")",["T_WHITESPACE"," ",666],"{",["T_WHITESPACE","\n            ",666],["T_COMMENT","\/* @var $store Mage_Core_Model_Store *\/",667],["T_WHITESPACE","\n            ",667],["T_VARIABLE","$rootCategoryIds",668],"[",["T_VARIABLE","$store",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","getRootCategoryId",668],"(",")","]",["T_WHITESPACE"," ",668],"=",["T_WHITESPACE"," ",668],["T_VARIABLE","$store",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","getRootCategoryId",668],"(",")",";",["T_WHITESPACE","\n        ",668],"}",["T_WHITESPACE","\n        ",669],["T_IF","if",670],["T_WHITESPACE"," ",670],"(",["T_VARIABLE","$rootCategoryIds",670],")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n            ",670],["T_VARIABLE","$categories",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","_getCategories",671],"(",["T_VARIABLE","$rootCategoryIds",671],")",";",["T_WHITESPACE","\n        ",671],"}",["T_WHITESPACE","\n        ",672],["T_FOREACH","foreach",673],["T_WHITESPACE"," ",673],"(",["T_VARIABLE","$stores",673],["T_WHITESPACE"," ",673],["T_AS","as",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$store",673],")",["T_WHITESPACE"," ",673],"{",["T_WHITESPACE","\n            ",673],["T_COMMENT","\/* @var $store Mage_Core_Model_Store *\/",674],["T_WHITESPACE","\n            ",674],["T_VARIABLE","$rootCategoryId",675],["T_WHITESPACE"," ",675],"=",["T_WHITESPACE"," ",675],["T_VARIABLE","$store",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getRootCategoryId",675],"(",")",";",["T_WHITESPACE","\n            ",675],["T_IF","if",676],["T_WHITESPACE"," ",676],"(",["T_ISSET","isset",676],"(",["T_VARIABLE","$categories",676],"[",["T_VARIABLE","$rootCategoryId",676],"]",")",")",["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n                ",676],["T_VARIABLE","$store",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","setRootCategoryPath",677],"(",["T_VARIABLE","$categories",677],"[",["T_VARIABLE","$rootCategoryId",677],"]",["T_OBJECT_OPERATOR","->",677],["T_STRING","getPath",677],"(",")",")",";",["T_WHITESPACE","\n                ",677],["T_VARIABLE","$store",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","setRootCategory",678],"(",["T_VARIABLE","$categories",678],"[",["T_VARIABLE","$rootCategoryId",678],"]",")",";",["T_WHITESPACE","\n            ",678],"}",["T_WHITESPACE"," ",679],["T_ELSE","else",679],["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n                ",679],["T_UNSET","unset",680],"(",["T_VARIABLE","$stores",680],"[",["T_VARIABLE","$store",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","getId",680],"(",")","]",")",";",["T_WHITESPACE","\n            ",680],"}",["T_WHITESPACE","\n        ",681],"}",["T_WHITESPACE","\n        ",682],["T_RETURN","return",683],["T_WHITESPACE"," ",683],["T_VARIABLE","$stores",683],";",["T_WHITESPACE","\n    ",683],"}",["T_WHITESPACE","\n\n    ",684],["T_DOC_COMMENT","\/**\n     * Retrieve categories objects\n     * Either $categoryIds or $path (with ending slash) must be specified\n     *\n     * @param int|array $categoryIds\n     * @param int $storeId\n     * @param string $path\n     * @return array\n     *\/",686],["T_WHITESPACE","\n    ",694],["T_PROTECTED","protected",695],["T_WHITESPACE"," ",695],["T_FUNCTION","function",695],["T_WHITESPACE"," ",695],["T_STRING","_getCategories",695],"(",["T_VARIABLE","$categoryIds",695],",",["T_WHITESPACE"," ",695],["T_VARIABLE","$storeId",695],["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_STRING","null",695],",",["T_WHITESPACE"," ",695],["T_VARIABLE","$path",695],["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_STRING","null",695],")",["T_WHITESPACE","\n    ",695],"{",["T_WHITESPACE","\n        ",696],["T_VARIABLE","$isActiveAttribute",697],["T_WHITESPACE"," ",697],"=",["T_WHITESPACE"," ",697],["T_STRING","Mage",697],["T_DOUBLE_COLON","::",697],["T_STRING","getSingleton",697],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",697],")",["T_WHITESPACE","\n            ",697],["T_OBJECT_OPERATOR","->",698],["T_STRING","getAttribute",698],"(",["T_STRING","Mage_Catalog_Model_Category",698],["T_DOUBLE_COLON","::",698],["T_STRING","ENTITY",698],",",["T_WHITESPACE"," ",698],["T_CONSTANT_ENCAPSED_STRING","'is_active'",698],")",";",["T_WHITESPACE","\n        ",698],["T_VARIABLE","$categories",699],["T_WHITESPACE","        ",699],"=",["T_WHITESPACE"," ",699],["T_ARRAY","array",699],"(",")",";",["T_WHITESPACE","\n        ",699],["T_VARIABLE","$adapter",700],["T_WHITESPACE","           ",700],"=",["T_WHITESPACE"," ",700],["T_VARIABLE","$this",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","_getReadAdapter",700],"(",")",";",["T_WHITESPACE","\n\n        ",700],["T_IF","if",702],["T_WHITESPACE"," ",702],"(","!",["T_STRING","is_array",702],"(",["T_VARIABLE","$categoryIds",702],")",")",["T_WHITESPACE"," ",702],"{",["T_WHITESPACE","\n            ",702],["T_VARIABLE","$categoryIds",703],["T_WHITESPACE"," ",703],"=",["T_WHITESPACE"," ",703],["T_ARRAY","array",703],"(",["T_VARIABLE","$categoryIds",703],")",";",["T_WHITESPACE","\n        ",703],"}",["T_WHITESPACE","\n        ",704],["T_VARIABLE","$isActiveExpr",705],["T_WHITESPACE"," ",705],"=",["T_WHITESPACE"," ",705],["T_VARIABLE","$adapter",705],["T_OBJECT_OPERATOR","->",705],["T_STRING","getCheckSql",705],"(",["T_CONSTANT_ENCAPSED_STRING","'c.value_id > 0'",705],",",["T_WHITESPACE"," ",705],["T_CONSTANT_ENCAPSED_STRING","'c.value'",705],",",["T_WHITESPACE"," ",705],["T_CONSTANT_ENCAPSED_STRING","'c.value'",705],")",";",["T_WHITESPACE","\n        ",705],["T_VARIABLE","$select",706],["T_WHITESPACE"," ",706],"=",["T_WHITESPACE"," ",706],["T_VARIABLE","$adapter",706],["T_OBJECT_OPERATOR","->",706],["T_STRING","select",706],"(",")",["T_WHITESPACE","\n            ",706],["T_OBJECT_OPERATOR","->",707],["T_STRING","from",707],"(",["T_ARRAY","array",707],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table'",707],["T_WHITESPACE"," ",707],["T_DOUBLE_ARROW","=>",707],["T_WHITESPACE"," ",707],["T_VARIABLE","$this",707],["T_OBJECT_OPERATOR","->",707],["T_STRING","getTable",707],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",707],")",")",",",["T_WHITESPACE"," ",707],["T_ARRAY","array",707],"(",["T_WHITESPACE","\n                ",707],["T_CONSTANT_ENCAPSED_STRING","'main_table.entity_id'",708],",",["T_WHITESPACE","\n                ",708],["T_CONSTANT_ENCAPSED_STRING","'main_table.parent_id'",709],",",["T_WHITESPACE","\n                ",709],["T_CONSTANT_ENCAPSED_STRING","'main_table.level'",710],",",["T_WHITESPACE","\n                ",710],["T_CONSTANT_ENCAPSED_STRING","'is_active'",711],["T_WHITESPACE"," ",711],["T_DOUBLE_ARROW","=>",711],["T_WHITESPACE"," ",711],["T_VARIABLE","$isActiveExpr",711],",",["T_WHITESPACE","\n                ",711],["T_CONSTANT_ENCAPSED_STRING","'main_table.path'",712],")",")",";",["T_WHITESPACE","\n\n        ",712],["T_COMMENT","\/\/ Prepare variables for checking whether categories belong to store\n",714],["T_WHITESPACE","        ",715],["T_IF","if",715],["T_WHITESPACE"," ",715],"(",["T_VARIABLE","$path",715],["T_WHITESPACE"," ",715],["T_IS_IDENTICAL","===",715],["T_WHITESPACE"," ",715],["T_STRING","null",715],")",["T_WHITESPACE"," ",715],"{",["T_WHITESPACE","\n            ",715],["T_VARIABLE","$select",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","where",716],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.entity_id IN(?)'",716],",",["T_WHITESPACE"," ",716],["T_VARIABLE","$categoryIds",716],")",";",["T_WHITESPACE","\n        ",716],"}",["T_WHITESPACE"," ",717],["T_ELSE","else",717],["T_WHITESPACE"," ",717],"{",["T_WHITESPACE","\n            ",717],["T_COMMENT","\/\/ Ensure that path ends with '\/', otherwise we can get wrong results - e.g. $path = '1\/2' will get '1\/20'\n",718],["T_WHITESPACE","            ",719],["T_IF","if",719],["T_WHITESPACE"," ",719],"(",["T_STRING","substr",719],"(",["T_VARIABLE","$path",719],",",["T_WHITESPACE"," ",719],"-",["T_LNUMBER","1",719],")",["T_WHITESPACE"," ",719],["T_IS_NOT_EQUAL","!=",719],["T_WHITESPACE"," ",719],["T_CONSTANT_ENCAPSED_STRING","'\/'",719],")",["T_WHITESPACE"," ",719],"{",["T_WHITESPACE","\n                ",719],["T_VARIABLE","$path",720],["T_WHITESPACE"," ",720],["T_CONCAT_EQUAL",".=",720],["T_WHITESPACE"," ",720],["T_CONSTANT_ENCAPSED_STRING","'\/'",720],";",["T_WHITESPACE","\n            ",720],"}",["T_WHITESPACE","\n\n            ",721],["T_VARIABLE","$select",723],["T_WHITESPACE","\n                ",723],["T_OBJECT_OPERATOR","->",724],["T_STRING","where",724],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.path LIKE ?'",724],",",["T_WHITESPACE"," ",724],["T_VARIABLE","$path",724],["T_WHITESPACE"," ",724],".",["T_WHITESPACE"," ",724],["T_CONSTANT_ENCAPSED_STRING","'%'",724],")",["T_WHITESPACE","\n                ",724],["T_OBJECT_OPERATOR","->",725],["T_STRING","order",725],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.path'",725],")",";",["T_WHITESPACE","\n        ",725],"}",["T_WHITESPACE","\n        ",726],["T_VARIABLE","$table",727],["T_WHITESPACE"," ",727],"=",["T_WHITESPACE"," ",727],["T_VARIABLE","$this",727],["T_OBJECT_OPERATOR","->",727],["T_STRING","getTable",727],"(",["T_ARRAY","array",727],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",727],",",["T_WHITESPACE"," ",727],["T_CONSTANT_ENCAPSED_STRING","'int'",727],")",")",";",["T_WHITESPACE","\n        ",727],["T_VARIABLE","$select",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","joinLeft",728],"(",["T_ARRAY","array",728],"(",["T_CONSTANT_ENCAPSED_STRING","'d'",728],["T_WHITESPACE"," ",728],["T_DOUBLE_ARROW","=>",728],["T_WHITESPACE"," ",728],["T_VARIABLE","$table",728],")",",",["T_WHITESPACE","\n            ",728],["T_CONSTANT_ENCAPSED_STRING","'d.attribute_id = :attribute_id AND d.store_id = 0 AND d.entity_id = main_table.entity_id'",729],",",["T_WHITESPACE","\n            ",729],["T_ARRAY","array",730],"(",")",["T_WHITESPACE","\n        ",730],")",["T_WHITESPACE","\n        ",731],["T_OBJECT_OPERATOR","->",732],["T_STRING","joinLeft",732],"(",["T_ARRAY","array",732],"(",["T_CONSTANT_ENCAPSED_STRING","'c'",732],["T_WHITESPACE"," ",732],["T_DOUBLE_ARROW","=>",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$table",732],")",",",["T_WHITESPACE","\n            ",732],["T_CONSTANT_ENCAPSED_STRING","'c.attribute_id = :attribute_id AND c.store_id = :store_id AND c.entity_id = main_table.entity_id'",733],",",["T_WHITESPACE","\n            ",733],["T_ARRAY","array",734],"(",")",["T_WHITESPACE","\n        ",734],")",";",["T_WHITESPACE","\n\n        ",735],["T_IF","if",737],["T_WHITESPACE"," ",737],"(",["T_VARIABLE","$storeId",737],["T_WHITESPACE"," ",737],["T_IS_NOT_IDENTICAL","!==",737],["T_WHITESPACE"," ",737],["T_STRING","null",737],")",["T_WHITESPACE"," ",737],"{",["T_WHITESPACE","\n            ",737],["T_VARIABLE","$rootCategoryPath",738],["T_WHITESPACE"," ",738],"=",["T_WHITESPACE"," ",738],["T_VARIABLE","$this",738],["T_OBJECT_OPERATOR","->",738],["T_STRING","getStores",738],"(",["T_VARIABLE","$storeId",738],")",["T_OBJECT_OPERATOR","->",738],["T_STRING","getRootCategoryPath",738],"(",")",";",["T_WHITESPACE","\n            ",738],["T_VARIABLE","$rootCategoryPathLength",739],["T_WHITESPACE"," ",739],"=",["T_WHITESPACE"," ",739],["T_STRING","strlen",739],"(",["T_VARIABLE","$rootCategoryPath",739],")",";",["T_WHITESPACE","\n        ",739],"}",["T_WHITESPACE","\n        ",740],["T_VARIABLE","$bind",741],["T_WHITESPACE"," ",741],"=",["T_WHITESPACE"," ",741],["T_ARRAY","array",741],"(",["T_WHITESPACE","\n            ",741],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",742],["T_WHITESPACE"," ",742],["T_DOUBLE_ARROW","=>",742],["T_WHITESPACE"," ",742],["T_INT_CAST","(int)",742],["T_VARIABLE","$isActiveAttribute",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","getId",742],"(",")",",",["T_WHITESPACE","\n            ",742],["T_CONSTANT_ENCAPSED_STRING","'store_id'",743],["T_WHITESPACE","     ",743],["T_DOUBLE_ARROW","=>",743],["T_WHITESPACE"," ",743],["T_INT_CAST","(int)",743],["T_VARIABLE","$storeId",743],["T_WHITESPACE","\n        ",743],")",";",["T_WHITESPACE","\n\n        ",744],["T_VARIABLE","$rowSet",746],["T_WHITESPACE"," ",746],"=",["T_WHITESPACE"," ",746],["T_VARIABLE","$adapter",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","fetchAll",746],"(",["T_VARIABLE","$select",746],",",["T_WHITESPACE"," ",746],["T_VARIABLE","$bind",746],")",";",["T_WHITESPACE","\n        ",746],["T_FOREACH","foreach",747],["T_WHITESPACE"," ",747],"(",["T_VARIABLE","$rowSet",747],["T_WHITESPACE"," ",747],["T_AS","as",747],["T_WHITESPACE"," ",747],["T_VARIABLE","$row",747],")",["T_WHITESPACE"," ",747],"{",["T_WHITESPACE","\n            ",747],["T_IF","if",748],["T_WHITESPACE"," ",748],"(",["T_VARIABLE","$storeId",748],["T_WHITESPACE"," ",748],["T_IS_NOT_IDENTICAL","!==",748],["T_WHITESPACE"," ",748],["T_STRING","null",748],")",["T_WHITESPACE"," ",748],"{",["T_WHITESPACE","\n                ",748],["T_COMMENT","\/\/ Check the category to be either store's root or its descendant\n",749],["T_WHITESPACE","                ",750],["T_COMMENT","\/\/ First - check that category's start is the same as root category\n",750],["T_WHITESPACE","                ",751],["T_IF","if",751],["T_WHITESPACE"," ",751],"(",["T_STRING","substr",751],"(",["T_VARIABLE","$row",751],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",751],"]",",",["T_WHITESPACE"," ",751],["T_LNUMBER","0",751],",",["T_WHITESPACE"," ",751],["T_VARIABLE","$rootCategoryPathLength",751],")",["T_WHITESPACE"," ",751],["T_IS_NOT_EQUAL","!=",751],["T_WHITESPACE"," ",751],["T_VARIABLE","$rootCategoryPath",751],")",["T_WHITESPACE"," ",751],"{",["T_WHITESPACE","\n                    ",751],["T_CONTINUE","continue",752],";",["T_WHITESPACE","\n                ",752],"}",["T_WHITESPACE","\n                ",753],["T_COMMENT","\/\/ Second - check non-root category - that it's really a descendant, not a simple string match\n",754],["T_WHITESPACE","                ",755],["T_IF","if",755],["T_WHITESPACE"," ",755],"(","(",["T_STRING","strlen",755],"(",["T_VARIABLE","$row",755],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",755],"]",")",["T_WHITESPACE"," ",755],">",["T_WHITESPACE"," ",755],["T_VARIABLE","$rootCategoryPathLength",755],")",["T_WHITESPACE","\n                    ",755],["T_BOOLEAN_AND","&&",756],["T_WHITESPACE"," ",756],"(",["T_VARIABLE","$row",756],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",756],"]","[",["T_VARIABLE","$rootCategoryPathLength",756],"]",["T_WHITESPACE"," ",756],["T_IS_NOT_EQUAL","!=",756],["T_WHITESPACE"," ",756],["T_CONSTANT_ENCAPSED_STRING","'\/'",756],")",")",["T_WHITESPACE"," ",756],"{",["T_WHITESPACE","\n                    ",756],["T_CONTINUE","continue",757],";",["T_WHITESPACE","\n                ",757],"}",["T_WHITESPACE","\n            ",758],"}",["T_WHITESPACE","\n\n            ",759],["T_VARIABLE","$category",761],["T_WHITESPACE"," ",761],"=",["T_WHITESPACE"," ",761],["T_NEW","new",761],["T_WHITESPACE"," ",761],["T_STRING","Varien_Object",761],"(",["T_VARIABLE","$row",761],")",";",["T_WHITESPACE","\n            ",761],["T_VARIABLE","$category",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","setIdFieldName",762],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",762],")",";",["T_WHITESPACE","\n            ",762],["T_VARIABLE","$category",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","setStoreId",763],"(",["T_VARIABLE","$storeId",763],")",";",["T_WHITESPACE","\n            ",763],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","_prepareCategoryParentId",764],"(",["T_VARIABLE","$category",764],")",";",["T_WHITESPACE","\n\n            ",764],["T_VARIABLE","$categories",766],"[",["T_VARIABLE","$category",766],["T_OBJECT_OPERATOR","->",766],["T_STRING","getId",766],"(",")","]",["T_WHITESPACE"," ",766],"=",["T_WHITESPACE"," ",766],["T_VARIABLE","$category",766],";",["T_WHITESPACE","\n        ",766],"}",["T_WHITESPACE","\n        ",767],["T_UNSET","unset",768],"(",["T_VARIABLE","$rowSet",768],")",";",["T_WHITESPACE","\n\n        ",768],["T_IF","if",770],["T_WHITESPACE"," ",770],"(",["T_VARIABLE","$storeId",770],["T_WHITESPACE"," ",770],["T_IS_NOT_IDENTICAL","!==",770],["T_WHITESPACE"," ",770],["T_STRING","null",770],["T_WHITESPACE"," ",770],["T_BOOLEAN_AND","&&",770],["T_WHITESPACE"," ",770],["T_VARIABLE","$categories",770],")",["T_WHITESPACE"," ",770],"{",["T_WHITESPACE","\n            ",770],["T_FOREACH","foreach",771],["T_WHITESPACE"," ",771],"(",["T_ARRAY","array",771],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",771],",",["T_WHITESPACE"," ",771],["T_CONSTANT_ENCAPSED_STRING","'url_key'",771],",",["T_WHITESPACE"," ",771],["T_CONSTANT_ENCAPSED_STRING","'url_path'",771],")",["T_WHITESPACE"," ",771],["T_AS","as",771],["T_WHITESPACE"," ",771],["T_VARIABLE","$attributeCode",771],")",["T_WHITESPACE"," ",771],"{",["T_WHITESPACE","\n                ",771],["T_VARIABLE","$attributes",772],["T_WHITESPACE"," ",772],"=",["T_WHITESPACE"," ",772],["T_VARIABLE","$this",772],["T_OBJECT_OPERATOR","->",772],["T_STRING","_getCategoryAttribute",772],"(",["T_VARIABLE","$attributeCode",772],",",["T_WHITESPACE"," ",772],["T_STRING","array_keys",772],"(",["T_VARIABLE","$categories",772],")",",",["T_WHITESPACE","\n                    ",772],["T_VARIABLE","$category",773],["T_OBJECT_OPERATOR","->",773],["T_STRING","getStoreId",773],"(",")",")",";",["T_WHITESPACE","\n                ",773],["T_FOREACH","foreach",774],["T_WHITESPACE"," ",774],"(",["T_VARIABLE","$attributes",774],["T_WHITESPACE"," ",774],["T_AS","as",774],["T_WHITESPACE"," ",774],["T_VARIABLE","$categoryId",774],["T_WHITESPACE"," ",774],["T_DOUBLE_ARROW","=>",774],["T_WHITESPACE"," ",774],["T_VARIABLE","$attributeValue",774],")",["T_WHITESPACE"," ",774],"{",["T_WHITESPACE","\n                    ",774],["T_VARIABLE","$categories",775],"[",["T_VARIABLE","$categoryId",775],"]",["T_OBJECT_OPERATOR","->",775],["T_STRING","setData",775],"(",["T_VARIABLE","$attributeCode",775],",",["T_WHITESPACE"," ",775],["T_VARIABLE","$attributeValue",775],")",";",["T_WHITESPACE","\n                ",775],"}",["T_WHITESPACE","\n            ",776],"}",["T_WHITESPACE","\n        ",777],"}",["T_WHITESPACE","\n\n        ",778],["T_RETURN","return",780],["T_WHITESPACE"," ",780],["T_VARIABLE","$categories",780],";",["T_WHITESPACE","\n    ",780],"}",["T_WHITESPACE","\n\n    ",781],["T_DOC_COMMENT","\/**\n     * Retrieve category data object\n     *\n     * @param int $categoryId\n     * @param int $storeId\n     * @return Varien_Object\n     *\/",783],["T_WHITESPACE","\n    ",789],["T_PUBLIC","public",790],["T_WHITESPACE"," ",790],["T_FUNCTION","function",790],["T_WHITESPACE"," ",790],["T_STRING","getCategory",790],"(",["T_VARIABLE","$categoryId",790],",",["T_WHITESPACE"," ",790],["T_VARIABLE","$storeId",790],")",["T_WHITESPACE","\n    ",790],"{",["T_WHITESPACE","\n        ",791],["T_IF","if",792],["T_WHITESPACE"," ",792],"(","!",["T_VARIABLE","$categoryId",792],["T_WHITESPACE"," ",792],["T_BOOLEAN_OR","||",792],["T_WHITESPACE"," ",792],"!",["T_VARIABLE","$storeId",792],")",["T_WHITESPACE"," ",792],"{",["T_WHITESPACE","\n            ",792],["T_RETURN","return",793],["T_WHITESPACE"," ",793],["T_STRING","false",793],";",["T_WHITESPACE","\n        ",793],"}",["T_WHITESPACE","\n\n        ",794],["T_VARIABLE","$categories",796],["T_WHITESPACE"," ",796],"=",["T_WHITESPACE"," ",796],["T_VARIABLE","$this",796],["T_OBJECT_OPERATOR","->",796],["T_STRING","_getCategories",796],"(",["T_VARIABLE","$categoryId",796],",",["T_WHITESPACE"," ",796],["T_VARIABLE","$storeId",796],")",";",["T_WHITESPACE","\n        ",796],["T_IF","if",797],["T_WHITESPACE"," ",797],"(",["T_ISSET","isset",797],"(",["T_VARIABLE","$categories",797],"[",["T_VARIABLE","$categoryId",797],"]",")",")",["T_WHITESPACE"," ",797],"{",["T_WHITESPACE","\n            ",797],["T_RETURN","return",798],["T_WHITESPACE"," ",798],["T_VARIABLE","$categories",798],"[",["T_VARIABLE","$categoryId",798],"]",";",["T_WHITESPACE","\n        ",798],"}",["T_WHITESPACE","\n        ",799],["T_RETURN","return",800],["T_WHITESPACE"," ",800],["T_STRING","false",800],";",["T_WHITESPACE","\n    ",800],"}",["T_WHITESPACE","\n\n    ",801],["T_DOC_COMMENT","\/**\n     * Retrieve categories data objects by their ids. Return only categories that belong to specified store.\n     *\n     * @param int|array $categoryIds\n     * @param int $storeId\n     * @return array\n     *\/",803],["T_WHITESPACE","\n    ",809],["T_PUBLIC","public",810],["T_WHITESPACE"," ",810],["T_FUNCTION","function",810],["T_WHITESPACE"," ",810],["T_STRING","getCategories",810],"(",["T_VARIABLE","$categoryIds",810],",",["T_WHITESPACE"," ",810],["T_VARIABLE","$storeId",810],")",["T_WHITESPACE","\n    ",810],"{",["T_WHITESPACE","\n        ",811],["T_IF","if",812],["T_WHITESPACE"," ",812],"(","!",["T_VARIABLE","$categoryIds",812],["T_WHITESPACE"," ",812],["T_BOOLEAN_OR","||",812],["T_WHITESPACE"," ",812],"!",["T_VARIABLE","$storeId",812],")",["T_WHITESPACE"," ",812],"{",["T_WHITESPACE","\n            ",812],["T_RETURN","return",813],["T_WHITESPACE"," ",813],["T_STRING","false",813],";",["T_WHITESPACE","\n        ",813],"}",["T_WHITESPACE","\n\n        ",814],["T_RETURN","return",816],["T_WHITESPACE"," ",816],["T_VARIABLE","$this",816],["T_OBJECT_OPERATOR","->",816],["T_STRING","_getCategories",816],"(",["T_VARIABLE","$categoryIds",816],",",["T_WHITESPACE"," ",816],["T_VARIABLE","$storeId",816],")",";",["T_WHITESPACE","\n    ",816],"}",["T_WHITESPACE","\n\n    ",817],["T_DOC_COMMENT","\/**\n     * Retrieve category childs data objects\n     *\n     * @param Varien_Object $category\n     * @return Varien_Object\n     *\/",819],["T_WHITESPACE","\n    ",824],["T_PUBLIC","public",825],["T_WHITESPACE"," ",825],["T_FUNCTION","function",825],["T_WHITESPACE"," ",825],["T_STRING","loadCategoryChilds",825],"(",["T_STRING","Varien_Object",825],["T_WHITESPACE"," ",825],["T_VARIABLE","$category",825],")",["T_WHITESPACE","\n    ",825],"{",["T_WHITESPACE","\n        ",826],["T_IF","if",827],["T_WHITESPACE"," ",827],"(",["T_VARIABLE","$category",827],["T_OBJECT_OPERATOR","->",827],["T_STRING","getId",827],"(",")",["T_WHITESPACE"," ",827],["T_IS_IDENTICAL","===",827],["T_WHITESPACE"," ",827],["T_STRING","null",827],["T_WHITESPACE"," ",827],["T_BOOLEAN_OR","||",827],["T_WHITESPACE"," ",827],["T_VARIABLE","$category",827],["T_OBJECT_OPERATOR","->",827],["T_STRING","getStoreId",827],"(",")",["T_WHITESPACE"," ",827],["T_IS_IDENTICAL","===",827],["T_WHITESPACE"," ",827],["T_STRING","null",827],")",["T_WHITESPACE"," ",827],"{",["T_WHITESPACE","\n            ",827],["T_RETURN","return",828],["T_WHITESPACE"," ",828],["T_VARIABLE","$category",828],";",["T_WHITESPACE","\n        ",828],"}",["T_WHITESPACE","\n\n        ",829],["T_VARIABLE","$categories",831],["T_WHITESPACE"," ",831],"=",["T_WHITESPACE"," ",831],["T_VARIABLE","$this",831],["T_OBJECT_OPERATOR","->",831],["T_STRING","_getCategories",831],"(",["T_STRING","null",831],",",["T_WHITESPACE"," ",831],["T_VARIABLE","$category",831],["T_OBJECT_OPERATOR","->",831],["T_STRING","getStoreId",831],"(",")",",",["T_WHITESPACE"," ",831],["T_VARIABLE","$category",831],["T_OBJECT_OPERATOR","->",831],["T_STRING","getPath",831],"(",")",["T_WHITESPACE"," ",831],".",["T_WHITESPACE"," ",831],["T_CONSTANT_ENCAPSED_STRING","'\/'",831],")",";",["T_WHITESPACE","\n        ",831],["T_VARIABLE","$category",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","setChilds",832],"(",["T_ARRAY","array",832],"(",")",")",";",["T_WHITESPACE","\n        ",832],["T_FOREACH","foreach",833],["T_WHITESPACE"," ",833],"(",["T_VARIABLE","$categories",833],["T_WHITESPACE"," ",833],["T_AS","as",833],["T_WHITESPACE"," ",833],["T_VARIABLE","$child",833],")",["T_WHITESPACE"," ",833],"{",["T_WHITESPACE","\n            ",833],["T_IF","if",834],["T_WHITESPACE"," ",834],"(","!",["T_STRING","is_array",834],"(",["T_VARIABLE","$child",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","getChilds",834],"(",")",")",")",["T_WHITESPACE"," ",834],"{",["T_WHITESPACE","\n                ",834],["T_VARIABLE","$child",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","setChilds",835],"(",["T_ARRAY","array",835],"(",")",")",";",["T_WHITESPACE","\n            ",835],"}",["T_WHITESPACE","\n            ",836],["T_IF","if",837],["T_WHITESPACE"," ",837],"(",["T_VARIABLE","$child",837],["T_OBJECT_OPERATOR","->",837],["T_STRING","getParentId",837],"(",")",["T_WHITESPACE"," ",837],["T_IS_EQUAL","==",837],["T_WHITESPACE"," ",837],["T_VARIABLE","$category",837],["T_OBJECT_OPERATOR","->",837],["T_STRING","getId",837],"(",")",")",["T_WHITESPACE"," ",837],"{",["T_WHITESPACE","\n                ",837],["T_VARIABLE","$category",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","setChilds",838],"(",["T_VARIABLE","$category",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","getChilds",838],"(",")",["T_WHITESPACE"," ",838],"+",["T_WHITESPACE"," ",838],["T_ARRAY","array",838],"(",["T_VARIABLE","$child",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","getId",838],"(",")",["T_WHITESPACE"," ",838],["T_DOUBLE_ARROW","=>",838],["T_WHITESPACE"," ",838],["T_VARIABLE","$child",838],")",")",";",["T_WHITESPACE","\n            ",838],"}",["T_WHITESPACE"," ",839],["T_ELSE","else",839],["T_WHITESPACE"," ",839],"{",["T_WHITESPACE","\n                ",839],["T_IF","if",840],["T_WHITESPACE"," ",840],"(",["T_ISSET","isset",840],"(",["T_VARIABLE","$categories",840],"[",["T_VARIABLE","$child",840],["T_OBJECT_OPERATOR","->",840],["T_STRING","getParentId",840],"(",")","]",")",")",["T_WHITESPACE"," ",840],"{",["T_WHITESPACE","\n                    ",840],["T_IF","if",841],["T_WHITESPACE"," ",841],"(","!",["T_STRING","is_array",841],"(",["T_VARIABLE","$categories",841],"[",["T_VARIABLE","$child",841],["T_OBJECT_OPERATOR","->",841],["T_STRING","getParentId",841],"(",")","]",["T_OBJECT_OPERATOR","->",841],["T_STRING","getChilds",841],"(",")",")",")",["T_WHITESPACE"," ",841],"{",["T_WHITESPACE","\n                        ",841],["T_VARIABLE","$categories",842],"[",["T_VARIABLE","$child",842],["T_OBJECT_OPERATOR","->",842],["T_STRING","getParentId",842],"(",")","]",["T_OBJECT_OPERATOR","->",842],["T_STRING","setChilds",842],"(",["T_ARRAY","array",842],"(",")",")",";",["T_WHITESPACE","\n                    ",842],"}",["T_WHITESPACE","\n                    ",843],["T_VARIABLE","$categories",844],"[",["T_VARIABLE","$child",844],["T_OBJECT_OPERATOR","->",844],["T_STRING","getParentId",844],"(",")","]",["T_OBJECT_OPERATOR","->",844],["T_STRING","setChilds",844],"(",["T_WHITESPACE","\n                        ",844],["T_VARIABLE","$categories",845],"[",["T_VARIABLE","$child",845],["T_OBJECT_OPERATOR","->",845],["T_STRING","getParentId",845],"(",")","]",["T_OBJECT_OPERATOR","->",845],["T_STRING","getChilds",845],"(",")",["T_WHITESPACE"," ",845],"+",["T_WHITESPACE"," ",845],["T_ARRAY","array",845],"(",["T_VARIABLE","$child",845],["T_OBJECT_OPERATOR","->",845],["T_STRING","getId",845],"(",")",["T_WHITESPACE"," ",845],["T_DOUBLE_ARROW","=>",845],["T_WHITESPACE"," ",845],["T_VARIABLE","$child",845],")",["T_WHITESPACE","\n                    ",845],")",";",["T_WHITESPACE","\n                ",846],"}",["T_WHITESPACE","\n            ",847],"}",["T_WHITESPACE","\n        ",848],"}",["T_WHITESPACE","\n        ",849],["T_VARIABLE","$category",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","setAllChilds",850],"(",["T_VARIABLE","$categories",850],")",";",["T_WHITESPACE","\n\n        ",850],["T_RETURN","return",852],["T_WHITESPACE"," ",852],["T_VARIABLE","$category",852],";",["T_WHITESPACE","\n    ",852],"}",["T_WHITESPACE","\n\n    ",853],["T_DOC_COMMENT","\/**\n     * Retrieves all children ids of root category tree\n     * Actually this routine can be used to get children ids of any category, not only root.\n     * But as far as result is cached in memory, it's not recommended to do so.\n     *\n     * @param Varien_Object $category\n     * @return Varien_Object\n     *\/",855],["T_WHITESPACE","\n    ",862],["T_PUBLIC","public",863],["T_WHITESPACE"," ",863],["T_FUNCTION","function",863],["T_WHITESPACE"," ",863],["T_STRING","getRootChildrenIds",863],"(",["T_VARIABLE","$categoryId",863],",",["T_WHITESPACE"," ",863],["T_VARIABLE","$categoryPath",863],",",["T_WHITESPACE"," ",863],["T_VARIABLE","$includeStart",863],["T_WHITESPACE"," ",863],"=",["T_WHITESPACE"," ",863],["T_STRING","true",863],")",["T_WHITESPACE","\n    ",863],"{",["T_WHITESPACE","\n        ",864],["T_IF","if",865],["T_WHITESPACE"," ",865],"(","!",["T_ISSET","isset",865],"(",["T_VARIABLE","$this",865],["T_OBJECT_OPERATOR","->",865],["T_STRING","_rootChildrenIds",865],"[",["T_VARIABLE","$categoryId",865],"]",")",")",["T_WHITESPACE"," ",865],"{",["T_WHITESPACE","\n            ",865],["T_COMMENT","\/\/ Select all descedant category ids\n",866],["T_WHITESPACE","            ",867],["T_VARIABLE","$adapter",867],["T_WHITESPACE"," ",867],"=",["T_WHITESPACE"," ",867],["T_VARIABLE","$this",867],["T_OBJECT_OPERATOR","->",867],["T_STRING","_getReadAdapter",867],"(",")",";",["T_WHITESPACE","\n            ",867],["T_VARIABLE","$select",868],["T_WHITESPACE"," ",868],"=",["T_WHITESPACE"," ",868],["T_VARIABLE","$adapter",868],["T_OBJECT_OPERATOR","->",868],["T_STRING","select",868],"(",")",["T_WHITESPACE","\n                ",868],["T_OBJECT_OPERATOR","->",869],["T_STRING","from",869],"(",["T_ARRAY","array",869],"(",["T_VARIABLE","$this",869],["T_OBJECT_OPERATOR","->",869],["T_STRING","getTable",869],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",869],")",")",",",["T_WHITESPACE"," ",869],["T_ARRAY","array",869],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",869],")",")",["T_WHITESPACE","\n                ",869],["T_OBJECT_OPERATOR","->",870],["T_STRING","where",870],"(",["T_CONSTANT_ENCAPSED_STRING","'path LIKE ?'",870],",",["T_WHITESPACE"," ",870],["T_VARIABLE","$categoryPath",870],["T_WHITESPACE"," ",870],".",["T_WHITESPACE"," ",870],["T_CONSTANT_ENCAPSED_STRING","'\/%'",870],")",";",["T_WHITESPACE","\n\n            ",870],["T_VARIABLE","$categoryIds",872],["T_WHITESPACE"," ",872],"=",["T_WHITESPACE"," ",872],["T_ARRAY","array",872],"(",")",";",["T_WHITESPACE","\n            ",872],["T_VARIABLE","$rowSet",873],["T_WHITESPACE"," ",873],"=",["T_WHITESPACE"," ",873],["T_VARIABLE","$adapter",873],["T_OBJECT_OPERATOR","->",873],["T_STRING","fetchAll",873],"(",["T_VARIABLE","$select",873],")",";",["T_WHITESPACE","\n            ",873],["T_FOREACH","foreach",874],["T_WHITESPACE"," ",874],"(",["T_VARIABLE","$rowSet",874],["T_WHITESPACE"," ",874],["T_AS","as",874],["T_WHITESPACE"," ",874],["T_VARIABLE","$row",874],")",["T_WHITESPACE"," ",874],"{",["T_WHITESPACE","\n                ",874],["T_VARIABLE","$categoryIds",875],"[",["T_VARIABLE","$row",875],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",875],"]","]",["T_WHITESPACE"," ",875],"=",["T_WHITESPACE"," ",875],["T_VARIABLE","$row",875],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",875],"]",";",["T_WHITESPACE","\n            ",875],"}",["T_WHITESPACE","\n            ",876],["T_VARIABLE","$this",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","_rootChildrenIds",877],"[",["T_VARIABLE","$categoryId",877],"]",["T_WHITESPACE"," ",877],"=",["T_WHITESPACE"," ",877],["T_VARIABLE","$categoryIds",877],";",["T_WHITESPACE","\n        ",877],"}",["T_WHITESPACE","\n\n        ",878],["T_VARIABLE","$categoryIds",880],["T_WHITESPACE"," ",880],"=",["T_WHITESPACE"," ",880],["T_VARIABLE","$this",880],["T_OBJECT_OPERATOR","->",880],["T_STRING","_rootChildrenIds",880],"[",["T_VARIABLE","$categoryId",880],"]",";",["T_WHITESPACE","\n        ",880],["T_IF","if",881],["T_WHITESPACE"," ",881],"(",["T_VARIABLE","$includeStart",881],")",["T_WHITESPACE"," ",881],"{",["T_WHITESPACE","\n            ",881],["T_VARIABLE","$categoryIds",882],"[",["T_VARIABLE","$categoryId",882],"]",["T_WHITESPACE"," ",882],"=",["T_WHITESPACE"," ",882],["T_VARIABLE","$categoryId",882],";",["T_WHITESPACE","\n        ",882],"}",["T_WHITESPACE","\n        ",883],["T_RETURN","return",884],["T_WHITESPACE"," ",884],["T_VARIABLE","$categoryIds",884],";",["T_WHITESPACE","\n    ",884],"}",["T_WHITESPACE","\n\n    ",885],["T_DOC_COMMENT","\/**\n     * Retrieve category parent path\n     *\n     * @param Varien_Object $category\n     * @return string\n     *\/",887],["T_WHITESPACE","\n    ",892],["T_PUBLIC","public",893],["T_WHITESPACE"," ",893],["T_FUNCTION","function",893],["T_WHITESPACE"," ",893],["T_STRING","getCategoryParentPath",893],"(",["T_STRING","Varien_Object",893],["T_WHITESPACE"," ",893],["T_VARIABLE","$category",893],")",["T_WHITESPACE","\n    ",893],"{",["T_WHITESPACE","\n        ",894],["T_VARIABLE","$store",895],["T_WHITESPACE"," ",895],"=",["T_WHITESPACE"," ",895],["T_STRING","Mage",895],["T_DOUBLE_COLON","::",895],["T_STRING","app",895],"(",")",["T_OBJECT_OPERATOR","->",895],["T_STRING","getStore",895],"(",["T_VARIABLE","$category",895],["T_OBJECT_OPERATOR","->",895],["T_STRING","getStoreId",895],"(",")",")",";",["T_WHITESPACE","\n\n        ",895],["T_IF","if",897],["T_WHITESPACE"," ",897],"(",["T_VARIABLE","$category",897],["T_OBJECT_OPERATOR","->",897],["T_STRING","getId",897],"(",")",["T_WHITESPACE"," ",897],["T_IS_EQUAL","==",897],["T_WHITESPACE"," ",897],["T_VARIABLE","$store",897],["T_OBJECT_OPERATOR","->",897],["T_STRING","getRootCategoryId",897],"(",")",")",["T_WHITESPACE"," ",897],"{",["T_WHITESPACE","\n            ",897],["T_RETURN","return",898],["T_WHITESPACE"," ",898],["T_CONSTANT_ENCAPSED_STRING","''",898],";",["T_WHITESPACE","\n        ",898],"}",["T_WHITESPACE"," ",899],["T_ELSEIF","elseif",899],["T_WHITESPACE"," ",899],"(",["T_VARIABLE","$category",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","getParentId",899],"(",")",["T_WHITESPACE"," ",899],["T_IS_EQUAL","==",899],["T_WHITESPACE"," ",899],["T_LNUMBER","1",899],["T_WHITESPACE"," ",899],["T_BOOLEAN_OR","||",899],["T_WHITESPACE"," ",899],["T_VARIABLE","$category",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","getParentId",899],"(",")",["T_WHITESPACE"," ",899],["T_IS_EQUAL","==",899],["T_WHITESPACE"," ",899],["T_VARIABLE","$store",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","getRootCategoryId",899],"(",")",")",["T_WHITESPACE"," ",899],"{",["T_WHITESPACE","\n            ",899],["T_RETURN","return",900],["T_WHITESPACE"," ",900],["T_CONSTANT_ENCAPSED_STRING","''",900],";",["T_WHITESPACE","\n        ",900],"}",["T_WHITESPACE","\n\n        ",901],["T_VARIABLE","$parentCategory",903],["T_WHITESPACE"," ",903],"=",["T_WHITESPACE"," ",903],["T_VARIABLE","$this",903],["T_OBJECT_OPERATOR","->",903],["T_STRING","getCategory",903],"(",["T_VARIABLE","$category",903],["T_OBJECT_OPERATOR","->",903],["T_STRING","getParentId",903],"(",")",",",["T_WHITESPACE"," ",903],["T_VARIABLE","$store",903],["T_OBJECT_OPERATOR","->",903],["T_STRING","getId",903],"(",")",")",";",["T_WHITESPACE","\n        ",903],["T_RETURN","return",904],["T_WHITESPACE"," ",904],["T_VARIABLE","$parentCategory",904],["T_OBJECT_OPERATOR","->",904],["T_STRING","getUrlPath",904],"(",")",["T_WHITESPACE"," ",904],".",["T_WHITESPACE"," ",904],["T_CONSTANT_ENCAPSED_STRING","'\/'",904],";",["T_WHITESPACE","\n    ",904],"}",["T_WHITESPACE","\n\n    ",905],["T_DOC_COMMENT","\/**\n     * Retrieve product ids by category\n     *\n     * @param Varien_Object|int $category\n     * @return array\n     *\/",907],["T_WHITESPACE","\n    ",912],["T_PUBLIC","public",913],["T_WHITESPACE"," ",913],["T_FUNCTION","function",913],["T_WHITESPACE"," ",913],["T_STRING","getProductIdsByCategory",913],"(",["T_VARIABLE","$category",913],")",["T_WHITESPACE","\n    ",913],"{",["T_WHITESPACE","\n        ",914],["T_IF","if",915],["T_WHITESPACE"," ",915],"(",["T_VARIABLE","$category",915],["T_WHITESPACE"," ",915],["T_INSTANCEOF","instanceof",915],["T_WHITESPACE"," ",915],["T_STRING","Varien_Object",915],")",["T_WHITESPACE"," ",915],"{",["T_WHITESPACE","\n            ",915],["T_VARIABLE","$categoryId",916],["T_WHITESPACE"," ",916],"=",["T_WHITESPACE"," ",916],["T_VARIABLE","$category",916],["T_OBJECT_OPERATOR","->",916],["T_STRING","getId",916],"(",")",";",["T_WHITESPACE","\n        ",916],"}",["T_WHITESPACE"," ",917],["T_ELSE","else",917],["T_WHITESPACE"," ",917],"{",["T_WHITESPACE","\n            ",917],["T_VARIABLE","$categoryId",918],["T_WHITESPACE"," ",918],"=",["T_WHITESPACE"," ",918],["T_VARIABLE","$category",918],";",["T_WHITESPACE","\n        ",918],"}",["T_WHITESPACE","\n        ",919],["T_VARIABLE","$adapter",920],["T_WHITESPACE"," ",920],"=",["T_WHITESPACE"," ",920],["T_VARIABLE","$this",920],["T_OBJECT_OPERATOR","->",920],["T_STRING","_getReadAdapter",920],"(",")",";",["T_WHITESPACE","\n        ",920],["T_VARIABLE","$select",921],["T_WHITESPACE"," ",921],"=",["T_WHITESPACE"," ",921],["T_VARIABLE","$adapter",921],["T_OBJECT_OPERATOR","->",921],["T_STRING","select",921],"(",")",["T_WHITESPACE","\n            ",921],["T_OBJECT_OPERATOR","->",922],["T_STRING","from",922],"(",["T_VARIABLE","$this",922],["T_OBJECT_OPERATOR","->",922],["T_STRING","getTable",922],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",922],")",",",["T_WHITESPACE"," ",922],["T_ARRAY","array",922],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",922],")",")",["T_WHITESPACE","\n            ",922],["T_OBJECT_OPERATOR","->",923],["T_STRING","where",923],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id = :category_id'",923],")",["T_WHITESPACE","\n            ",923],["T_OBJECT_OPERATOR","->",924],["T_STRING","order",924],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",924],")",";",["T_WHITESPACE","\n        ",924],["T_VARIABLE","$bind",925],["T_WHITESPACE"," ",925],"=",["T_WHITESPACE"," ",925],["T_ARRAY","array",925],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",925],["T_WHITESPACE"," ",925],["T_DOUBLE_ARROW","=>",925],["T_WHITESPACE"," ",925],["T_VARIABLE","$categoryId",925],")",";",["T_WHITESPACE","\n\n        ",925],["T_RETURN","return",927],["T_WHITESPACE"," ",927],["T_VARIABLE","$adapter",927],["T_OBJECT_OPERATOR","->",927],["T_STRING","fetchCol",927],"(",["T_VARIABLE","$select",927],",",["T_WHITESPACE"," ",927],["T_VARIABLE","$bind",927],")",";",["T_WHITESPACE","\n    ",927],"}",["T_WHITESPACE","\n\n    ",928],["T_DOC_COMMENT","\/**\n     * Retrieve Product data objects\n     *\n     * @param int|array $productIds\n     * @param int $storeId\n     * @param int $entityId\n     * @param int $lastEntityId\n     * @return array\n     *\/",930],["T_WHITESPACE","\n    ",938],["T_PROTECTED","protected",939],["T_WHITESPACE"," ",939],["T_FUNCTION","function",939],["T_WHITESPACE"," ",939],["T_STRING","_getProducts",939],"(",["T_VARIABLE","$productIds",939],",",["T_WHITESPACE"," ",939],["T_VARIABLE","$storeId",939],",",["T_WHITESPACE"," ",939],["T_VARIABLE","$entityId",939],",",["T_WHITESPACE"," ",939],"&",["T_VARIABLE","$lastEntityId",939],")",["T_WHITESPACE","\n    ",939],"{",["T_WHITESPACE","\n        ",940],["T_VARIABLE","$products",941],["T_WHITESPACE","   ",941],"=",["T_WHITESPACE"," ",941],["T_ARRAY","array",941],"(",")",";",["T_WHITESPACE","\n        ",941],["T_VARIABLE","$websiteId",942],["T_WHITESPACE","  ",942],"=",["T_WHITESPACE"," ",942],["T_STRING","Mage",942],["T_DOUBLE_COLON","::",942],["T_STRING","app",942],"(",")",["T_OBJECT_OPERATOR","->",942],["T_STRING","getStore",942],"(",["T_VARIABLE","$storeId",942],")",["T_OBJECT_OPERATOR","->",942],["T_STRING","getWebsiteId",942],"(",")",";",["T_WHITESPACE","\n        ",942],["T_VARIABLE","$adapter",943],["T_WHITESPACE","    ",943],"=",["T_WHITESPACE"," ",943],["T_VARIABLE","$this",943],["T_OBJECT_OPERATOR","->",943],["T_STRING","_getReadAdapter",943],"(",")",";",["T_WHITESPACE","\n        ",943],["T_IF","if",944],["T_WHITESPACE"," ",944],"(",["T_VARIABLE","$productIds",944],["T_WHITESPACE"," ",944],["T_IS_NOT_IDENTICAL","!==",944],["T_WHITESPACE"," ",944],["T_STRING","null",944],")",["T_WHITESPACE"," ",944],"{",["T_WHITESPACE","\n            ",944],["T_IF","if",945],["T_WHITESPACE"," ",945],"(","!",["T_STRING","is_array",945],"(",["T_VARIABLE","$productIds",945],")",")",["T_WHITESPACE"," ",945],"{",["T_WHITESPACE","\n                ",945],["T_VARIABLE","$productIds",946],["T_WHITESPACE"," ",946],"=",["T_WHITESPACE"," ",946],["T_ARRAY","array",946],"(",["T_VARIABLE","$productIds",946],")",";",["T_WHITESPACE","\n            ",946],"}",["T_WHITESPACE","\n        ",947],"}",["T_WHITESPACE","\n        ",948],["T_VARIABLE","$bind",949],["T_WHITESPACE"," ",949],"=",["T_WHITESPACE"," ",949],["T_ARRAY","array",949],"(",["T_WHITESPACE","\n            ",949],["T_CONSTANT_ENCAPSED_STRING","'website_id'",950],["T_WHITESPACE"," ",950],["T_DOUBLE_ARROW","=>",950],["T_WHITESPACE"," ",950],["T_INT_CAST","(int)",950],["T_VARIABLE","$websiteId",950],",",["T_WHITESPACE","\n            ",950],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",951],["T_WHITESPACE","  ",951],["T_DOUBLE_ARROW","=>",951],["T_WHITESPACE"," ",951],["T_INT_CAST","(int)",951],["T_VARIABLE","$entityId",951],",",["T_WHITESPACE","\n        ",951],")",";",["T_WHITESPACE","\n        ",952],["T_VARIABLE","$select",953],["T_WHITESPACE"," ",953],"=",["T_WHITESPACE"," ",953],["T_VARIABLE","$adapter",953],["T_OBJECT_OPERATOR","->",953],["T_STRING","select",953],"(",")",["T_WHITESPACE","\n            ",953],["T_OBJECT_OPERATOR","->",954],["T_STRING","useStraightJoin",954],"(",["T_STRING","true",954],")",["T_WHITESPACE","\n            ",954],["T_OBJECT_OPERATOR","->",955],["T_STRING","from",955],"(",["T_ARRAY","array",955],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",955],["T_WHITESPACE"," ",955],["T_DOUBLE_ARROW","=>",955],["T_WHITESPACE"," ",955],["T_VARIABLE","$this",955],["T_OBJECT_OPERATOR","->",955],["T_STRING","getTable",955],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",955],")",")",",",["T_WHITESPACE"," ",955],["T_ARRAY","array",955],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",955],")",")",["T_WHITESPACE","\n            ",955],["T_OBJECT_OPERATOR","->",956],["T_STRING","join",956],"(",["T_WHITESPACE","\n                ",956],["T_ARRAY","array",957],"(",["T_CONSTANT_ENCAPSED_STRING","'w'",957],["T_WHITESPACE"," ",957],["T_DOUBLE_ARROW","=>",957],["T_WHITESPACE"," ",957],["T_VARIABLE","$this",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getTable",957],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",957],")",")",",",["T_WHITESPACE","\n                ",957],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = w.product_id AND w.website_id = :website_id'",958],",",["T_WHITESPACE","\n                ",958],["T_ARRAY","array",959],"(",")",["T_WHITESPACE","\n            ",959],")",["T_WHITESPACE","\n            ",960],["T_OBJECT_OPERATOR","->",961],["T_STRING","where",961],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id > :entity_id'",961],")",["T_WHITESPACE","\n            ",961],["T_OBJECT_OPERATOR","->",962],["T_STRING","order",962],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",962],")",["T_WHITESPACE","\n            ",962],["T_OBJECT_OPERATOR","->",963],["T_STRING","limit",963],"(",["T_VARIABLE","$this",963],["T_OBJECT_OPERATOR","->",963],["T_STRING","_productLimit",963],")",";",["T_WHITESPACE","\n        ",963],["T_IF","if",964],["T_WHITESPACE"," ",964],"(",["T_VARIABLE","$productIds",964],["T_WHITESPACE"," ",964],["T_IS_NOT_IDENTICAL","!==",964],["T_WHITESPACE"," ",964],["T_STRING","null",964],")",["T_WHITESPACE"," ",964],"{",["T_WHITESPACE","\n            ",964],["T_VARIABLE","$select",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","where",965],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",965],",",["T_WHITESPACE"," ",965],["T_VARIABLE","$productIds",965],")",";",["T_WHITESPACE","\n        ",965],"}",["T_WHITESPACE","\n\n        ",966],["T_VARIABLE","$rowSet",968],["T_WHITESPACE"," ",968],"=",["T_WHITESPACE"," ",968],["T_VARIABLE","$adapter",968],["T_OBJECT_OPERATOR","->",968],["T_STRING","fetchAll",968],"(",["T_VARIABLE","$select",968],",",["T_WHITESPACE"," ",968],["T_VARIABLE","$bind",968],")",";",["T_WHITESPACE","\n        ",968],["T_FOREACH","foreach",969],["T_WHITESPACE"," ",969],"(",["T_VARIABLE","$rowSet",969],["T_WHITESPACE"," ",969],["T_AS","as",969],["T_WHITESPACE"," ",969],["T_VARIABLE","$row",969],")",["T_WHITESPACE"," ",969],"{",["T_WHITESPACE","\n            ",969],["T_VARIABLE","$product",970],["T_WHITESPACE"," ",970],"=",["T_WHITESPACE"," ",970],["T_NEW","new",970],["T_WHITESPACE"," ",970],["T_STRING","Varien_Object",970],"(",["T_VARIABLE","$row",970],")",";",["T_WHITESPACE","\n            ",970],["T_VARIABLE","$product",971],["T_OBJECT_OPERATOR","->",971],["T_STRING","setIdFieldName",971],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",971],")",";",["T_WHITESPACE","\n            ",971],["T_VARIABLE","$product",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","setCategoryIds",972],"(",["T_ARRAY","array",972],"(",")",")",";",["T_WHITESPACE","\n            ",972],["T_VARIABLE","$product",973],["T_OBJECT_OPERATOR","->",973],["T_STRING","setStoreId",973],"(",["T_VARIABLE","$storeId",973],")",";",["T_WHITESPACE","\n            ",973],["T_VARIABLE","$products",974],"[",["T_VARIABLE","$product",974],["T_OBJECT_OPERATOR","->",974],["T_STRING","getId",974],"(",")","]",["T_WHITESPACE"," ",974],"=",["T_WHITESPACE"," ",974],["T_VARIABLE","$product",974],";",["T_WHITESPACE","\n            ",974],["T_VARIABLE","$lastEntityId",975],["T_WHITESPACE"," ",975],"=",["T_WHITESPACE"," ",975],["T_VARIABLE","$product",975],["T_OBJECT_OPERATOR","->",975],["T_STRING","getId",975],"(",")",";",["T_WHITESPACE","\n        ",975],"}",["T_WHITESPACE","\n\n        ",976],["T_UNSET","unset",978],"(",["T_VARIABLE","$rowSet",978],")",";",["T_WHITESPACE","\n\n        ",978],["T_IF","if",980],["T_WHITESPACE"," ",980],"(",["T_VARIABLE","$products",980],")",["T_WHITESPACE"," ",980],"{",["T_WHITESPACE","\n            ",980],["T_VARIABLE","$select",981],["T_WHITESPACE"," ",981],"=",["T_WHITESPACE"," ",981],["T_VARIABLE","$adapter",981],["T_OBJECT_OPERATOR","->",981],["T_STRING","select",981],"(",")",["T_WHITESPACE","\n                ",981],["T_OBJECT_OPERATOR","->",982],["T_STRING","from",982],"(",["T_WHITESPACE","\n                    ",982],["T_VARIABLE","$this",983],["T_OBJECT_OPERATOR","->",983],["T_STRING","getTable",983],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",983],")",",",["T_WHITESPACE","\n                    ",983],["T_ARRAY","array",984],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",984],",",["T_WHITESPACE"," ",984],["T_CONSTANT_ENCAPSED_STRING","'category_id'",984],")",["T_WHITESPACE","\n                ",984],")",["T_WHITESPACE","\n                ",985],["T_OBJECT_OPERATOR","->",986],["T_STRING","where",986],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN(?)'",986],",",["T_WHITESPACE"," ",986],["T_STRING","array_keys",986],"(",["T_VARIABLE","$products",986],")",")",";",["T_WHITESPACE","\n            ",986],["T_VARIABLE","$categories",987],["T_WHITESPACE"," ",987],"=",["T_WHITESPACE"," ",987],["T_VARIABLE","$adapter",987],["T_OBJECT_OPERATOR","->",987],["T_STRING","fetchAll",987],"(",["T_VARIABLE","$select",987],")",";",["T_WHITESPACE","\n            ",987],["T_FOREACH","foreach",988],["T_WHITESPACE"," ",988],"(",["T_VARIABLE","$categories",988],["T_WHITESPACE"," ",988],["T_AS","as",988],["T_WHITESPACE"," ",988],["T_VARIABLE","$category",988],")",["T_WHITESPACE"," ",988],"{",["T_WHITESPACE","\n                ",988],["T_VARIABLE","$productId",989],["T_WHITESPACE"," ",989],"=",["T_WHITESPACE"," ",989],["T_VARIABLE","$category",989],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",989],"]",";",["T_WHITESPACE","\n                ",989],["T_VARIABLE","$categoryIds",990],["T_WHITESPACE"," ",990],"=",["T_WHITESPACE"," ",990],["T_VARIABLE","$products",990],"[",["T_VARIABLE","$productId",990],"]",["T_OBJECT_OPERATOR","->",990],["T_STRING","getCategoryIds",990],"(",")",";",["T_WHITESPACE","\n                ",990],["T_VARIABLE","$categoryIds",991],"[","]",["T_WHITESPACE"," ",991],"=",["T_WHITESPACE"," ",991],["T_VARIABLE","$category",991],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id'",991],"]",";",["T_WHITESPACE","\n                ",991],["T_VARIABLE","$products",992],"[",["T_VARIABLE","$productId",992],"]",["T_OBJECT_OPERATOR","->",992],["T_STRING","setCategoryIds",992],"(",["T_VARIABLE","$categoryIds",992],")",";",["T_WHITESPACE","\n            ",992],"}",["T_WHITESPACE","\n\n            ",993],["T_FOREACH","foreach",995],["T_WHITESPACE"," ",995],"(",["T_ARRAY","array",995],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",995],",",["T_WHITESPACE"," ",995],["T_CONSTANT_ENCAPSED_STRING","'url_key'",995],",",["T_WHITESPACE"," ",995],["T_CONSTANT_ENCAPSED_STRING","'url_path'",995],")",["T_WHITESPACE"," ",995],["T_AS","as",995],["T_WHITESPACE"," ",995],["T_VARIABLE","$attributeCode",995],")",["T_WHITESPACE"," ",995],"{",["T_WHITESPACE","\n                ",995],["T_VARIABLE","$attributes",996],["T_WHITESPACE"," ",996],"=",["T_WHITESPACE"," ",996],["T_VARIABLE","$this",996],["T_OBJECT_OPERATOR","->",996],["T_STRING","_getProductAttribute",996],"(",["T_VARIABLE","$attributeCode",996],",",["T_WHITESPACE"," ",996],["T_STRING","array_keys",996],"(",["T_VARIABLE","$products",996],")",",",["T_WHITESPACE"," ",996],["T_VARIABLE","$storeId",996],")",";",["T_WHITESPACE","\n                ",996],["T_FOREACH","foreach",997],["T_WHITESPACE"," ",997],"(",["T_VARIABLE","$attributes",997],["T_WHITESPACE"," ",997],["T_AS","as",997],["T_WHITESPACE"," ",997],["T_VARIABLE","$productId",997],["T_WHITESPACE"," ",997],["T_DOUBLE_ARROW","=>",997],["T_WHITESPACE"," ",997],["T_VARIABLE","$attributeValue",997],")",["T_WHITESPACE"," ",997],"{",["T_WHITESPACE","\n                    ",997],["T_VARIABLE","$products",998],"[",["T_VARIABLE","$productId",998],"]",["T_OBJECT_OPERATOR","->",998],["T_STRING","setData",998],"(",["T_VARIABLE","$attributeCode",998],",",["T_WHITESPACE"," ",998],["T_VARIABLE","$attributeValue",998],")",";",["T_WHITESPACE","\n                ",998],"}",["T_WHITESPACE","\n            ",999],"}",["T_WHITESPACE","\n        ",1000],"}",["T_WHITESPACE","\n\n        ",1001],["T_RETURN","return",1003],["T_WHITESPACE"," ",1003],["T_VARIABLE","$products",1003],";",["T_WHITESPACE","\n    ",1003],"}",["T_WHITESPACE","\n\n    ",1004],["T_DOC_COMMENT","\/**\n     * Retrieve Product data object\n     *\n     * @param int $productId\n     * @param int $storeId\n     * @return Varien_Object\n     *\/",1006],["T_WHITESPACE","\n    ",1012],["T_PUBLIC","public",1013],["T_WHITESPACE"," ",1013],["T_FUNCTION","function",1013],["T_WHITESPACE"," ",1013],["T_STRING","getProduct",1013],"(",["T_VARIABLE","$productId",1013],",",["T_WHITESPACE"," ",1013],["T_VARIABLE","$storeId",1013],")",["T_WHITESPACE","\n    ",1013],"{",["T_WHITESPACE","\n        ",1014],["T_VARIABLE","$entityId",1015],["T_WHITESPACE"," ",1015],"=",["T_WHITESPACE"," ",1015],["T_LNUMBER","0",1015],";",["T_WHITESPACE","\n        ",1015],["T_VARIABLE","$products",1016],["T_WHITESPACE"," ",1016],"=",["T_WHITESPACE"," ",1016],["T_VARIABLE","$this",1016],["T_OBJECT_OPERATOR","->",1016],["T_STRING","_getProducts",1016],"(",["T_VARIABLE","$productId",1016],",",["T_WHITESPACE"," ",1016],["T_VARIABLE","$storeId",1016],",",["T_WHITESPACE"," ",1016],["T_LNUMBER","0",1016],",",["T_WHITESPACE"," ",1016],["T_VARIABLE","$entityId",1016],")",";",["T_WHITESPACE","\n        ",1016],["T_IF","if",1017],["T_WHITESPACE"," ",1017],"(",["T_ISSET","isset",1017],"(",["T_VARIABLE","$products",1017],"[",["T_VARIABLE","$productId",1017],"]",")",")",["T_WHITESPACE"," ",1017],"{",["T_WHITESPACE","\n            ",1017],["T_RETURN","return",1018],["T_WHITESPACE"," ",1018],["T_VARIABLE","$products",1018],"[",["T_VARIABLE","$productId",1018],"]",";",["T_WHITESPACE","\n        ",1018],"}",["T_WHITESPACE","\n        ",1019],["T_RETURN","return",1020],["T_WHITESPACE"," ",1020],["T_STRING","false",1020],";",["T_WHITESPACE","\n    ",1020],"}",["T_WHITESPACE","\n\n    ",1021],["T_DOC_COMMENT","\/**\n     * Retrieve Product data obects for store\n     *\n     * @param int $storeId\n     * @param int $lastEntityId\n     * @return array\n     *\/",1023],["T_WHITESPACE","\n    ",1029],["T_PUBLIC","public",1030],["T_WHITESPACE"," ",1030],["T_FUNCTION","function",1030],["T_WHITESPACE"," ",1030],["T_STRING","getProductsByStore",1030],"(",["T_VARIABLE","$storeId",1030],",",["T_WHITESPACE"," ",1030],"&",["T_VARIABLE","$lastEntityId",1030],")",["T_WHITESPACE","\n    ",1030],"{",["T_WHITESPACE","\n        ",1031],["T_RETURN","return",1032],["T_WHITESPACE"," ",1032],["T_VARIABLE","$this",1032],["T_OBJECT_OPERATOR","->",1032],["T_STRING","_getProducts",1032],"(",["T_STRING","null",1032],",",["T_WHITESPACE"," ",1032],["T_VARIABLE","$storeId",1032],",",["T_WHITESPACE"," ",1032],["T_VARIABLE","$lastEntityId",1032],",",["T_WHITESPACE"," ",1032],["T_VARIABLE","$lastEntityId",1032],")",";",["T_WHITESPACE","\n    ",1032],"}",["T_WHITESPACE","\n\n    ",1033],["T_DOC_COMMENT","\/**\n     * Retrieve Product data objects in category\n     *\n     * @param Varien_Object $category\n     * @param int $lastEntityId\n     * @return array\n     *\/",1035],["T_WHITESPACE","\n    ",1041],["T_PUBLIC","public",1042],["T_WHITESPACE"," ",1042],["T_FUNCTION","function",1042],["T_WHITESPACE"," ",1042],["T_STRING","getProductsByCategory",1042],"(",["T_STRING","Varien_Object",1042],["T_WHITESPACE"," ",1042],["T_VARIABLE","$category",1042],",",["T_WHITESPACE"," ",1042],"&",["T_VARIABLE","$lastEntityId",1042],")",["T_WHITESPACE","\n    ",1042],"{",["T_WHITESPACE","\n        ",1043],["T_VARIABLE","$productIds",1044],["T_WHITESPACE"," ",1044],"=",["T_WHITESPACE"," ",1044],["T_VARIABLE","$this",1044],["T_OBJECT_OPERATOR","->",1044],["T_STRING","getProductIdsByCategory",1044],"(",["T_VARIABLE","$category",1044],")",";",["T_WHITESPACE","\n        ",1044],["T_IF","if",1045],["T_WHITESPACE"," ",1045],"(","!",["T_VARIABLE","$productIds",1045],")",["T_WHITESPACE"," ",1045],"{",["T_WHITESPACE","\n            ",1045],["T_RETURN","return",1046],["T_WHITESPACE"," ",1046],["T_ARRAY","array",1046],"(",")",";",["T_WHITESPACE","\n        ",1046],"}",["T_WHITESPACE","\n        ",1047],["T_RETURN","return",1048],["T_WHITESPACE"," ",1048],["T_VARIABLE","$this",1048],["T_OBJECT_OPERATOR","->",1048],["T_STRING","_getProducts",1048],"(",["T_VARIABLE","$productIds",1048],",",["T_WHITESPACE"," ",1048],["T_VARIABLE","$category",1048],["T_OBJECT_OPERATOR","->",1048],["T_STRING","getStoreId",1048],"(",")",",",["T_WHITESPACE"," ",1048],["T_VARIABLE","$lastEntityId",1048],",",["T_WHITESPACE"," ",1048],["T_VARIABLE","$lastEntityId",1048],")",";",["T_WHITESPACE","\n    ",1048],"}",["T_WHITESPACE","\n\n    ",1049],["T_DOC_COMMENT","\/**\n     * Find and remove unused products rewrites - a case when products were moved away from the category\n     * (either to other category or deleted), so rewrite \"category_id-product_id\" is invalid\n     *\n     * @param int $storeId\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",1051],["T_WHITESPACE","\n    ",1057],["T_PUBLIC","public",1058],["T_WHITESPACE"," ",1058],["T_FUNCTION","function",1058],["T_WHITESPACE"," ",1058],["T_STRING","clearCategoryProduct",1058],"(",["T_VARIABLE","$storeId",1058],")",["T_WHITESPACE","\n    ",1058],"{",["T_WHITESPACE","\n        ",1059],["T_VARIABLE","$adapter",1060],["T_WHITESPACE"," ",1060],"=",["T_WHITESPACE"," ",1060],["T_VARIABLE","$this",1060],["T_OBJECT_OPERATOR","->",1060],["T_STRING","_getWriteAdapter",1060],"(",")",";",["T_WHITESPACE","\n        ",1060],["T_VARIABLE","$select",1061],["T_WHITESPACE"," ",1061],"=",["T_WHITESPACE"," ",1061],["T_VARIABLE","$adapter",1061],["T_OBJECT_OPERATOR","->",1061],["T_STRING","select",1061],"(",")",["T_WHITESPACE","\n            ",1061],["T_OBJECT_OPERATOR","->",1062],["T_STRING","from",1062],"(",["T_ARRAY","array",1062],"(",["T_CONSTANT_ENCAPSED_STRING","'tur'",1062],["T_WHITESPACE"," ",1062],["T_DOUBLE_ARROW","=>",1062],["T_WHITESPACE"," ",1062],["T_VARIABLE","$this",1062],["T_OBJECT_OPERATOR","->",1062],["T_STRING","getMainTable",1062],"(",")",")",",",["T_WHITESPACE"," ",1062],["T_VARIABLE","$this",1062],["T_OBJECT_OPERATOR","->",1062],["T_STRING","getIdFieldName",1062],"(",")",")",["T_WHITESPACE","\n            ",1062],["T_OBJECT_OPERATOR","->",1063],["T_STRING","joinLeft",1063],"(",["T_WHITESPACE","\n                ",1063],["T_ARRAY","array",1064],"(",["T_CONSTANT_ENCAPSED_STRING","'tcp'",1064],["T_WHITESPACE"," ",1064],["T_DOUBLE_ARROW","=>",1064],["T_WHITESPACE"," ",1064],["T_VARIABLE","$this",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","getTable",1064],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",1064],")",")",",",["T_WHITESPACE","\n                ",1064],["T_CONSTANT_ENCAPSED_STRING","'tur.category_id = tcp.category_id AND tur.product_id = tcp.product_id'",1065],",",["T_WHITESPACE","\n                ",1065],["T_ARRAY","array",1066],"(",")",["T_WHITESPACE","\n            ",1066],")",["T_WHITESPACE","\n            ",1067],["T_OBJECT_OPERATOR","->",1068],["T_STRING","where",1068],"(",["T_CONSTANT_ENCAPSED_STRING","'tur.store_id = :store_id'",1068],")",["T_WHITESPACE","\n            ",1068],["T_OBJECT_OPERATOR","->",1069],["T_STRING","where",1069],"(",["T_CONSTANT_ENCAPSED_STRING","'tur.category_id IS NOT NULL'",1069],")",["T_WHITESPACE","\n            ",1069],["T_OBJECT_OPERATOR","->",1070],["T_STRING","where",1070],"(",["T_CONSTANT_ENCAPSED_STRING","'tur.product_id IS NOT NULL'",1070],")",["T_WHITESPACE","\n            ",1070],["T_OBJECT_OPERATOR","->",1071],["T_STRING","where",1071],"(",["T_CONSTANT_ENCAPSED_STRING","'tcp.category_id IS NULL'",1071],")",";",["T_WHITESPACE","\n        ",1071],["T_VARIABLE","$rewriteIds",1072],["T_WHITESPACE"," ",1072],"=",["T_WHITESPACE"," ",1072],["T_VARIABLE","$adapter",1072],["T_OBJECT_OPERATOR","->",1072],["T_STRING","fetchCol",1072],"(",["T_VARIABLE","$select",1072],",",["T_WHITESPACE"," ",1072],["T_ARRAY","array",1072],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1072],["T_WHITESPACE"," ",1072],["T_DOUBLE_ARROW","=>",1072],["T_WHITESPACE"," ",1072],["T_VARIABLE","$storeId",1072],")",")",";",["T_WHITESPACE","\n        ",1072],["T_IF","if",1073],["T_WHITESPACE"," ",1073],"(",["T_VARIABLE","$rewriteIds",1073],")",["T_WHITESPACE"," ",1073],"{",["T_WHITESPACE","\n            ",1073],["T_VARIABLE","$where",1074],["T_WHITESPACE"," ",1074],"=",["T_WHITESPACE"," ",1074],["T_ARRAY","array",1074],"(",["T_VARIABLE","$this",1074],["T_OBJECT_OPERATOR","->",1074],["T_STRING","getIdFieldName",1074],"(",")",["T_WHITESPACE"," ",1074],".",["T_WHITESPACE"," ",1074],["T_CONSTANT_ENCAPSED_STRING","' IN(?)'",1074],["T_WHITESPACE"," ",1074],["T_DOUBLE_ARROW","=>",1074],["T_WHITESPACE"," ",1074],["T_VARIABLE","$rewriteIds",1074],")",";",["T_WHITESPACE","\n            ",1074],["T_VARIABLE","$adapter",1075],["T_OBJECT_OPERATOR","->",1075],["T_STRING","delete",1075],"(",["T_VARIABLE","$this",1075],["T_OBJECT_OPERATOR","->",1075],["T_STRING","getMainTable",1075],"(",")",",",["T_WHITESPACE"," ",1075],["T_VARIABLE","$where",1075],")",";",["T_WHITESPACE","\n        ",1075],"}",["T_WHITESPACE","\n\n        ",1076],["T_RETURN","return",1078],["T_WHITESPACE"," ",1078],["T_VARIABLE","$this",1078],";",["T_WHITESPACE","\n    ",1078],"}",["T_WHITESPACE","\n\n    ",1079],["T_DOC_COMMENT","\/**\n     * Remove unused rewrites for product - called after we created all needed rewrites for product and know the categories\n     * where the product is contained ($excludeCategoryIds), so we can remove all invalid product rewrites that have other category ids\n     *\n     * Notice: this routine is not identical to clearCategoryProduct(), because after checking all categories this one removes rewrites\n     * for product still contained within categories.\n     *\n     * @param int $productId Product entity Id\n     * @param int $storeId Store Id for rewrites\n     * @param array $excludeCategoryIds Array of category Ids that should be skipped\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",1081],["T_WHITESPACE","\n    ",1092],["T_PUBLIC","public",1093],["T_WHITESPACE"," ",1093],["T_FUNCTION","function",1093],["T_WHITESPACE"," ",1093],["T_STRING","clearProductRewrites",1093],"(",["T_VARIABLE","$productId",1093],",",["T_WHITESPACE"," ",1093],["T_VARIABLE","$storeId",1093],",",["T_WHITESPACE"," ",1093],["T_VARIABLE","$excludeCategoryIds",1093],["T_WHITESPACE"," ",1093],"=",["T_WHITESPACE"," ",1093],["T_ARRAY","array",1093],"(",")",")",["T_WHITESPACE","\n    ",1093],"{",["T_WHITESPACE","\n        ",1094],["T_VARIABLE","$where",1095],["T_WHITESPACE"," ",1095],"=",["T_WHITESPACE"," ",1095],["T_ARRAY","array",1095],"(",["T_WHITESPACE","\n            ",1095],["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",1096],["T_WHITESPACE"," ",1096],["T_DOUBLE_ARROW","=>",1096],["T_WHITESPACE"," ",1096],["T_VARIABLE","$productId",1096],",",["T_WHITESPACE","\n            ",1096],["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",1097],["T_WHITESPACE"," ",1097],["T_DOUBLE_ARROW","=>",1097],["T_WHITESPACE"," ",1097],["T_VARIABLE","$storeId",1097],["T_WHITESPACE","\n        ",1097],")",";",["T_WHITESPACE","\n\n        ",1098],["T_IF","if",1100],["T_WHITESPACE"," ",1100],"(","!",["T_EMPTY","empty",1100],"(",["T_VARIABLE","$excludeCategoryIds",1100],")",")",["T_WHITESPACE"," ",1100],"{",["T_WHITESPACE","\n            ",1100],["T_VARIABLE","$where",1101],"[",["T_CONSTANT_ENCAPSED_STRING","'category_id NOT IN (?)'",1101],"]",["T_WHITESPACE"," ",1101],"=",["T_WHITESPACE"," ",1101],["T_VARIABLE","$excludeCategoryIds",1101],";",["T_WHITESPACE","\n            ",1101],["T_COMMENT","\/\/ If there's at least one category to skip, also skip root category, because product belongs to website\n",1102],["T_WHITESPACE","            ",1103],["T_VARIABLE","$where",1103],"[","]",["T_WHITESPACE"," ",1103],"=",["T_WHITESPACE"," ",1103],["T_CONSTANT_ENCAPSED_STRING","'category_id IS NOT NULL'",1103],";",["T_WHITESPACE","\n        ",1103],"}",["T_WHITESPACE","\n\n        ",1104],["T_VARIABLE","$this",1106],["T_OBJECT_OPERATOR","->",1106],["T_STRING","_getWriteAdapter",1106],"(",")",["T_OBJECT_OPERATOR","->",1106],["T_STRING","delete",1106],"(",["T_VARIABLE","$this",1106],["T_OBJECT_OPERATOR","->",1106],["T_STRING","getMainTable",1106],"(",")",",",["T_WHITESPACE"," ",1106],["T_VARIABLE","$where",1106],")",";",["T_WHITESPACE","\n\n        ",1106],["T_RETURN","return",1108],["T_WHITESPACE"," ",1108],["T_VARIABLE","$this",1108],";",["T_WHITESPACE","\n    ",1108],"}",["T_WHITESPACE","\n\n    ",1109],["T_DOC_COMMENT","\/**\n     * Finds and deletes all old category and category\/product rewrites for store\n     * left from the times when categories\/products belonged to store\n     *\n     * @param int $storeId\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Url\n     *\/",1111],["T_WHITESPACE","\n    ",1117],["T_PUBLIC","public",1118],["T_WHITESPACE"," ",1118],["T_FUNCTION","function",1118],["T_WHITESPACE"," ",1118],["T_STRING","clearStoreCategoriesInvalidRewrites",1118],"(",["T_VARIABLE","$storeId",1118],")",["T_WHITESPACE","\n    ",1118],"{",["T_WHITESPACE","\n        ",1119],["T_COMMENT","\/\/ Form a list of all current store categories ids\n",1120],["T_WHITESPACE","        ",1121],["T_VARIABLE","$store",1121],["T_WHITESPACE","          ",1121],"=",["T_WHITESPACE"," ",1121],["T_VARIABLE","$this",1121],["T_OBJECT_OPERATOR","->",1121],["T_STRING","getStores",1121],"(",["T_VARIABLE","$storeId",1121],")",";",["T_WHITESPACE","\n        ",1121],["T_VARIABLE","$rootCategoryId",1122],["T_WHITESPACE"," ",1122],"=",["T_WHITESPACE"," ",1122],["T_VARIABLE","$store",1122],["T_OBJECT_OPERATOR","->",1122],["T_STRING","getRootCategoryId",1122],"(",")",";",["T_WHITESPACE","\n        ",1122],["T_IF","if",1123],["T_WHITESPACE"," ",1123],"(","!",["T_VARIABLE","$rootCategoryId",1123],")",["T_WHITESPACE"," ",1123],"{",["T_WHITESPACE","\n            ",1123],["T_RETURN","return",1124],["T_WHITESPACE"," ",1124],["T_VARIABLE","$this",1124],";",["T_WHITESPACE","\n        ",1124],"}",["T_WHITESPACE","\n        ",1125],["T_VARIABLE","$categoryIds",1126],["T_WHITESPACE"," ",1126],"=",["T_WHITESPACE"," ",1126],["T_VARIABLE","$this",1126],["T_OBJECT_OPERATOR","->",1126],["T_STRING","getRootChildrenIds",1126],"(",["T_VARIABLE","$rootCategoryId",1126],",",["T_WHITESPACE"," ",1126],["T_VARIABLE","$store",1126],["T_OBJECT_OPERATOR","->",1126],["T_STRING","getRootCategoryPath",1126],"(",")",")",";",["T_WHITESPACE","\n\n        ",1126],["T_COMMENT","\/\/ Remove all store catalog rewrites that are for some category or cartegory\/product not within store categories\n",1128],["T_WHITESPACE","        ",1129],["T_VARIABLE","$where",1129],["T_WHITESPACE","   ",1129],"=",["T_WHITESPACE"," ",1129],["T_ARRAY","array",1129],"(",["T_WHITESPACE","\n            ",1129],["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",1130],["T_WHITESPACE"," ",1130],["T_DOUBLE_ARROW","=>",1130],["T_WHITESPACE"," ",1130],["T_VARIABLE","$storeId",1130],",",["T_WHITESPACE","\n            ",1130],["T_CONSTANT_ENCAPSED_STRING","'category_id IS NOT NULL'",1131],",",["T_WHITESPACE"," ",1131],["T_COMMENT","\/\/ For sure check that it's a catalog rewrite\n",1131],["T_WHITESPACE","            ",1132],["T_CONSTANT_ENCAPSED_STRING","'category_id NOT IN (?)'",1132],["T_WHITESPACE"," ",1132],["T_DOUBLE_ARROW","=>",1132],["T_WHITESPACE"," ",1132],["T_VARIABLE","$categoryIds",1132],["T_WHITESPACE","\n        ",1132],")",";",["T_WHITESPACE","\n\n        ",1133],["T_VARIABLE","$this",1135],["T_OBJECT_OPERATOR","->",1135],["T_STRING","_getWriteAdapter",1135],"(",")",["T_OBJECT_OPERATOR","->",1135],["T_STRING","delete",1135],"(",["T_VARIABLE","$this",1135],["T_OBJECT_OPERATOR","->",1135],["T_STRING","getMainTable",1135],"(",")",",",["T_WHITESPACE"," ",1135],["T_VARIABLE","$where",1135],")",";",["T_WHITESPACE","\n\n        ",1135],["T_RETURN","return",1137],["T_WHITESPACE"," ",1137],["T_VARIABLE","$this",1137],";",["T_WHITESPACE","\n    ",1137],"}",["T_WHITESPACE","\n\n    ",1138],["T_DOC_COMMENT","\/**\n     * Finds and deletes product rewrites (that are not assigned to any category) for store\n     * left from the times when product was assigned to this store's website and now is not assigned\n     *\n     * Notice: this routine is different from clearProductRewrites() and clearCategoryProduct() because\n     * it handles direct rewrites to product without defined category (category_id IS NULL) whilst that routines\n     * handle only product rewrites within categories\n     *\n     * @param int $storeId\n     * @param int|array|null $productId\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Url\n     *\/",1140],["T_WHITESPACE","\n    ",1151],["T_PUBLIC","public",1152],["T_WHITESPACE"," ",1152],["T_FUNCTION","function",1152],["T_WHITESPACE"," ",1152],["T_STRING","clearStoreProductsInvalidRewrites",1152],"(",["T_VARIABLE","$storeId",1152],",",["T_WHITESPACE"," ",1152],["T_VARIABLE","$productId",1152],["T_WHITESPACE"," ",1152],"=",["T_WHITESPACE"," ",1152],["T_STRING","null",1152],")",["T_WHITESPACE","\n    ",1152],"{",["T_WHITESPACE","\n        ",1153],["T_VARIABLE","$store",1154],["T_WHITESPACE","   ",1154],"=",["T_WHITESPACE"," ",1154],["T_VARIABLE","$this",1154],["T_OBJECT_OPERATOR","->",1154],["T_STRING","getStores",1154],"(",["T_VARIABLE","$storeId",1154],")",";",["T_WHITESPACE","\n        ",1154],["T_VARIABLE","$adapter",1155],["T_WHITESPACE"," ",1155],"=",["T_WHITESPACE"," ",1155],["T_VARIABLE","$this",1155],["T_OBJECT_OPERATOR","->",1155],["T_STRING","_getReadAdapter",1155],"(",")",";",["T_WHITESPACE","\n        ",1155],["T_VARIABLE","$bind",1156],["T_WHITESPACE","    ",1156],"=",["T_WHITESPACE"," ",1156],["T_ARRAY","array",1156],"(",["T_WHITESPACE","\n            ",1156],["T_CONSTANT_ENCAPSED_STRING","'website_id'",1157],["T_WHITESPACE"," ",1157],["T_DOUBLE_ARROW","=>",1157],["T_WHITESPACE"," ",1157],["T_INT_CAST","(int)",1157],["T_VARIABLE","$store",1157],["T_OBJECT_OPERATOR","->",1157],["T_STRING","getWebsiteId",1157],"(",")",",",["T_WHITESPACE","\n            ",1157],["T_CONSTANT_ENCAPSED_STRING","'store_id'",1158],["T_WHITESPACE","   ",1158],["T_DOUBLE_ARROW","=>",1158],["T_WHITESPACE"," ",1158],["T_INT_CAST","(int)",1158],["T_VARIABLE","$storeId",1158],["T_WHITESPACE","\n        ",1158],")",";",["T_WHITESPACE","\n        ",1159],["T_VARIABLE","$select",1160],["T_WHITESPACE"," ",1160],"=",["T_WHITESPACE"," ",1160],["T_VARIABLE","$adapter",1160],["T_OBJECT_OPERATOR","->",1160],["T_STRING","select",1160],"(",")",["T_WHITESPACE","\n            ",1160],["T_OBJECT_OPERATOR","->",1161],["T_STRING","from",1161],"(",["T_ARRAY","array",1161],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite'",1161],["T_WHITESPACE"," ",1161],["T_DOUBLE_ARROW","=>",1161],["T_WHITESPACE"," ",1161],["T_VARIABLE","$this",1161],["T_OBJECT_OPERATOR","->",1161],["T_STRING","getMainTable",1161],"(",")",")",",",["T_WHITESPACE"," ",1161],["T_VARIABLE","$this",1161],["T_OBJECT_OPERATOR","->",1161],["T_STRING","getIdFieldName",1161],"(",")",")",["T_WHITESPACE","\n            ",1161],["T_OBJECT_OPERATOR","->",1162],["T_STRING","joinLeft",1162],"(",["T_WHITESPACE","\n                ",1162],["T_ARRAY","array",1163],"(",["T_CONSTANT_ENCAPSED_STRING","'website'",1163],["T_WHITESPACE"," ",1163],["T_DOUBLE_ARROW","=>",1163],["T_WHITESPACE"," ",1163],["T_VARIABLE","$this",1163],["T_OBJECT_OPERATOR","->",1163],["T_STRING","getTable",1163],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",1163],")",")",",",["T_WHITESPACE","\n                ",1163],["T_CONSTANT_ENCAPSED_STRING","'rewrite.product_id = website.product_id AND website.website_id = :website_id'",1164],",",["T_WHITESPACE","\n                ",1164],["T_ARRAY","array",1165],"(",")",["T_WHITESPACE","\n            ",1165],")",["T_OBJECT_OPERATOR","->",1166],["T_STRING","where",1166],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite.store_id = :store_id'",1166],")",["T_WHITESPACE","\n            ",1166],["T_OBJECT_OPERATOR","->",1167],["T_STRING","where",1167],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite.category_id IS NULL'",1167],")",";",["T_WHITESPACE","\n        ",1167],["T_IF","if",1168],["T_WHITESPACE"," ",1168],"(",["T_VARIABLE","$productId",1168],")",["T_WHITESPACE"," ",1168],"{",["T_WHITESPACE","\n            ",1168],["T_VARIABLE","$select",1169],["T_OBJECT_OPERATOR","->",1169],["T_STRING","where",1169],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite.product_id IN (?)'",1169],",",["T_WHITESPACE"," ",1169],["T_VARIABLE","$productId",1169],")",";",["T_WHITESPACE","\n        ",1169],"}",["T_WHITESPACE"," ",1170],["T_ELSE","else",1170],["T_WHITESPACE"," ",1170],"{",["T_WHITESPACE","\n            ",1170],["T_VARIABLE","$select",1171],["T_OBJECT_OPERATOR","->",1171],["T_STRING","where",1171],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite.product_id IS NOT NULL'",1171],")",";",["T_WHITESPACE","\n        ",1171],"}",["T_WHITESPACE","\n        ",1172],["T_VARIABLE","$select",1173],["T_OBJECT_OPERATOR","->",1173],["T_STRING","where",1173],"(",["T_CONSTANT_ENCAPSED_STRING","'website.website_id IS NULL'",1173],")",";",["T_WHITESPACE","\n\n        ",1173],["T_VARIABLE","$rewriteIds",1175],["T_WHITESPACE"," ",1175],"=",["T_WHITESPACE"," ",1175],["T_VARIABLE","$adapter",1175],["T_OBJECT_OPERATOR","->",1175],["T_STRING","fetchCol",1175],"(",["T_VARIABLE","$select",1175],",",["T_WHITESPACE"," ",1175],["T_VARIABLE","$bind",1175],")",";",["T_WHITESPACE","\n        ",1175],["T_IF","if",1176],["T_WHITESPACE"," ",1176],"(",["T_VARIABLE","$rewriteIds",1176],")",["T_WHITESPACE"," ",1176],"{",["T_WHITESPACE","\n            ",1176],["T_VARIABLE","$where",1177],["T_WHITESPACE"," ",1177],"=",["T_WHITESPACE"," ",1177],["T_ARRAY","array",1177],"(",["T_VARIABLE","$this",1177],["T_OBJECT_OPERATOR","->",1177],["T_STRING","getIdFieldName",1177],"(",")",["T_WHITESPACE"," ",1177],".",["T_WHITESPACE"," ",1177],["T_CONSTANT_ENCAPSED_STRING","' IN(?)'",1177],["T_WHITESPACE"," ",1177],["T_DOUBLE_ARROW","=>",1177],["T_WHITESPACE"," ",1177],["T_VARIABLE","$rewriteIds",1177],")",";",["T_WHITESPACE","\n            ",1177],["T_VARIABLE","$this",1178],["T_OBJECT_OPERATOR","->",1178],["T_STRING","_getWriteAdapter",1178],"(",")",["T_OBJECT_OPERATOR","->",1178],["T_STRING","delete",1178],"(",["T_VARIABLE","$this",1178],["T_OBJECT_OPERATOR","->",1178],["T_STRING","getMainTable",1178],"(",")",",",["T_WHITESPACE"," ",1178],["T_VARIABLE","$where",1178],")",";",["T_WHITESPACE","\n        ",1178],"}",["T_WHITESPACE","\n\n        ",1179],["T_RETURN","return",1181],["T_WHITESPACE"," ",1181],["T_VARIABLE","$this",1181],";",["T_WHITESPACE","\n    ",1181],"}",["T_WHITESPACE","\n\n    ",1182],["T_DOC_COMMENT","\/**\n     * Finds and deletes old rewrites for store\n     * a) category rewrites left from the times when store had some other root category\n     * b) product rewrites left from products that once belonged to this site, but then deleted or just removed from website\n     *\n     * @param int $storeId\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Url\n     *\/",1184],["T_WHITESPACE","\n    ",1191],["T_PUBLIC","public",1192],["T_WHITESPACE"," ",1192],["T_FUNCTION","function",1192],["T_WHITESPACE"," ",1192],["T_STRING","clearStoreInvalidRewrites",1192],"(",["T_VARIABLE","$storeId",1192],")",["T_WHITESPACE","\n    ",1192],"{",["T_WHITESPACE","\n        ",1193],["T_VARIABLE","$this",1194],["T_OBJECT_OPERATOR","->",1194],["T_STRING","clearStoreCategoriesInvalidRewrites",1194],"(",["T_VARIABLE","$storeId",1194],")",";",["T_WHITESPACE","\n        ",1194],["T_VARIABLE","$this",1195],["T_OBJECT_OPERATOR","->",1195],["T_STRING","clearStoreProductsInvalidRewrites",1195],"(",["T_VARIABLE","$storeId",1195],")",";",["T_WHITESPACE","\n        ",1195],["T_RETURN","return",1196],["T_WHITESPACE"," ",1196],["T_VARIABLE","$this",1196],";",["T_WHITESPACE","\n    ",1196],"}",["T_WHITESPACE","\n\n    ",1197],["T_DOC_COMMENT","\/**\n     * Delete rewrites for associated to category products\n     *\n     * @param int $categoryId\n     * @param array $productIds\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",1199],["T_WHITESPACE","\n    ",1205],["T_PUBLIC","public",1206],["T_WHITESPACE"," ",1206],["T_FUNCTION","function",1206],["T_WHITESPACE"," ",1206],["T_STRING","deleteCategoryProductRewrites",1206],"(",["T_VARIABLE","$categoryId",1206],",",["T_WHITESPACE"," ",1206],["T_VARIABLE","$productIds",1206],")",["T_WHITESPACE","\n    ",1206],"{",["T_WHITESPACE","\n        ",1207],["T_VARIABLE","$this",1208],["T_OBJECT_OPERATOR","->",1208],["T_STRING","deleteCategoryProductStoreRewrites",1208],"(",["T_VARIABLE","$categoryId",1208],",",["T_WHITESPACE"," ",1208],["T_VARIABLE","$productIds",1208],")",";",["T_WHITESPACE","\n        ",1208],["T_RETURN","return",1209],["T_WHITESPACE"," ",1209],["T_VARIABLE","$this",1209],";",["T_WHITESPACE","\n    ",1209],"}",["T_WHITESPACE","\n\n    ",1210],["T_DOC_COMMENT","\/**\n     * Delete URL rewrites for category products of specific store\n     *\n     * @param int $categoryId\n     * @param array|int|null $productIds\n     * @param null|int $storeId\n     * @return Mage_Catalog_Model_Resource_Url\n     *\/",1212],["T_WHITESPACE","\n    ",1219],["T_PUBLIC","public",1220],["T_WHITESPACE"," ",1220],["T_FUNCTION","function",1220],["T_WHITESPACE"," ",1220],["T_STRING","deleteCategoryProductStoreRewrites",1220],"(",["T_VARIABLE","$categoryId",1220],",",["T_WHITESPACE"," ",1220],["T_VARIABLE","$productIds",1220],["T_WHITESPACE"," ",1220],"=",["T_WHITESPACE"," ",1220],["T_STRING","null",1220],",",["T_WHITESPACE"," ",1220],["T_VARIABLE","$storeId",1220],["T_WHITESPACE"," ",1220],"=",["T_WHITESPACE"," ",1220],["T_STRING","null",1220],")",["T_WHITESPACE","\n    ",1220],"{",["T_WHITESPACE","\n        ",1221],["T_COMMENT","\/\/ Notice that we don't include category_id = NULL in case of root category,\n",1222],["T_WHITESPACE","        ",1223],["T_COMMENT","\/\/ because product removed from all categories but assigned to store's website is still\n",1223],["T_WHITESPACE","        ",1224],["T_COMMENT","\/\/ assumed to be in root cat. Unassigned products must be removed by other routine.\n",1224],["T_WHITESPACE","        ",1225],["T_VARIABLE","$condition",1225],["T_WHITESPACE"," ",1225],"=",["T_WHITESPACE"," ",1225],["T_ARRAY","array",1225],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id = ?'",1225],["T_WHITESPACE"," ",1225],["T_DOUBLE_ARROW","=>",1225],["T_WHITESPACE"," ",1225],["T_VARIABLE","$categoryId",1225],")",";",["T_WHITESPACE","\n        ",1225],["T_IF","if",1226],["T_WHITESPACE"," ",1226],"(",["T_EMPTY","empty",1226],"(",["T_VARIABLE","$productIds",1226],")",")",["T_WHITESPACE"," ",1226],"{",["T_WHITESPACE","\n            ",1226],["T_VARIABLE","$condition",1227],"[","]",["T_WHITESPACE"," ",1227],"=",["T_WHITESPACE"," ",1227],["T_CONSTANT_ENCAPSED_STRING","'product_id IS NOT NULL'",1227],";",["T_WHITESPACE","\n        ",1227],"}",["T_WHITESPACE"," ",1228],["T_ELSE","else",1228],["T_WHITESPACE"," ",1228],"{",["T_WHITESPACE","\n            ",1228],["T_VARIABLE","$condition",1229],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",1229],"]",["T_WHITESPACE"," ",1229],"=",["T_WHITESPACE"," ",1229],["T_VARIABLE","$productIds",1229],";",["T_WHITESPACE","\n        ",1229],"}",["T_WHITESPACE","\n\n        ",1230],["T_IF","if",1232],["T_WHITESPACE"," ",1232],"(",["T_VARIABLE","$storeId",1232],["T_WHITESPACE"," ",1232],["T_IS_NOT_IDENTICAL","!==",1232],["T_WHITESPACE"," ",1232],["T_STRING","null",1232],")",["T_WHITESPACE"," ",1232],"{",["T_WHITESPACE","\n            ",1232],["T_VARIABLE","$condition",1233],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id IN(?)'",1233],"]",["T_WHITESPACE"," ",1233],"=",["T_WHITESPACE"," ",1233],["T_VARIABLE","$storeId",1233],";",["T_WHITESPACE","\n        ",1233],"}",["T_WHITESPACE","\n\n        ",1234],["T_VARIABLE","$this",1236],["T_OBJECT_OPERATOR","->",1236],["T_STRING","_getWriteAdapter",1236],"(",")",["T_OBJECT_OPERATOR","->",1236],["T_STRING","delete",1236],"(",["T_VARIABLE","$this",1236],["T_OBJECT_OPERATOR","->",1236],["T_STRING","getMainTable",1236],"(",")",",",["T_WHITESPACE"," ",1236],["T_VARIABLE","$condition",1236],")",";",["T_WHITESPACE","\n        ",1236],["T_RETURN","return",1237],["T_WHITESPACE"," ",1237],["T_VARIABLE","$this",1237],";",["T_WHITESPACE","\n    ",1237],"}",["T_WHITESPACE","\n\n    ",1238],["T_DOC_COMMENT","\/**\n     * Retrieve rewrites and visibility by store\n     * Input array format:\n     * product_id as key and store_id as value\n     * Output array format (product_id as key)\n     * store_id     int; store id\n     * visibility   int; visibility for store\n     * url_rewrite  string; rewrite URL for store\n     *\n     * @param array $products\n     * @return array\n     *\/",1240],["T_WHITESPACE","\n    ",1251],["T_PUBLIC","public",1252],["T_WHITESPACE"," ",1252],["T_FUNCTION","function",1252],["T_WHITESPACE"," ",1252],["T_STRING","getRewriteByProductStore",1252],"(",["T_ARRAY","array",1252],["T_WHITESPACE"," ",1252],["T_VARIABLE","$products",1252],")",["T_WHITESPACE","\n    ",1252],"{",["T_WHITESPACE","\n        ",1253],["T_VARIABLE","$result",1254],["T_WHITESPACE"," ",1254],"=",["T_WHITESPACE"," ",1254],["T_ARRAY","array",1254],"(",")",";",["T_WHITESPACE","\n\n        ",1254],["T_IF","if",1256],["T_WHITESPACE"," ",1256],"(",["T_EMPTY","empty",1256],"(",["T_VARIABLE","$products",1256],")",")",["T_WHITESPACE"," ",1256],"{",["T_WHITESPACE","\n            ",1256],["T_RETURN","return",1257],["T_WHITESPACE"," ",1257],["T_VARIABLE","$result",1257],";",["T_WHITESPACE","\n        ",1257],"}",["T_WHITESPACE","\n        ",1258],["T_VARIABLE","$adapter",1259],["T_WHITESPACE"," ",1259],"=",["T_WHITESPACE"," ",1259],["T_VARIABLE","$this",1259],["T_OBJECT_OPERATOR","->",1259],["T_STRING","_getReadAdapter",1259],"(",")",";",["T_WHITESPACE","\n\n        ",1259],["T_VARIABLE","$select",1261],["T_WHITESPACE"," ",1261],"=",["T_WHITESPACE"," ",1261],["T_VARIABLE","$adapter",1261],["T_OBJECT_OPERATOR","->",1261],["T_STRING","select",1261],"(",")",["T_WHITESPACE","\n            ",1261],["T_OBJECT_OPERATOR","->",1262],["T_STRING","from",1262],"(",["T_WHITESPACE","\n                ",1262],["T_ARRAY","array",1263],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",1263],["T_WHITESPACE"," ",1263],["T_DOUBLE_ARROW","=>",1263],["T_WHITESPACE"," ",1263],["T_VARIABLE","$this",1263],["T_OBJECT_OPERATOR","->",1263],["T_STRING","getTable",1263],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",1263],")",")",",",["T_WHITESPACE","\n                ",1263],["T_ARRAY","array",1264],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1264],",",["T_WHITESPACE"," ",1264],["T_CONSTANT_ENCAPSED_STRING","'store_id'",1264],",",["T_WHITESPACE"," ",1264],["T_CONSTANT_ENCAPSED_STRING","'visibility'",1264],")",["T_WHITESPACE","\n            ",1264],")",["T_WHITESPACE","\n            ",1265],["T_OBJECT_OPERATOR","->",1266],["T_STRING","joinLeft",1266],"(",["T_WHITESPACE","\n                ",1266],["T_ARRAY","array",1267],"(",["T_CONSTANT_ENCAPSED_STRING","'r'",1267],["T_WHITESPACE"," ",1267],["T_DOUBLE_ARROW","=>",1267],["T_WHITESPACE"," ",1267],["T_VARIABLE","$this",1267],["T_OBJECT_OPERATOR","->",1267],["T_STRING","getMainTable",1267],"(",")",")",",",["T_WHITESPACE","\n                ",1267],["T_CONSTANT_ENCAPSED_STRING","'i.product_id = r.product_id AND i.store_id=r.store_id AND r.category_id IS NULL'",1268],",",["T_WHITESPACE","\n                ",1268],["T_ARRAY","array",1269],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path'",1269],")",["T_WHITESPACE","\n            ",1269],")",";",["T_WHITESPACE","\n\n        ",1270],["T_VARIABLE","$bind",1272],["T_WHITESPACE"," ",1272],"=",["T_WHITESPACE"," ",1272],["T_ARRAY","array",1272],"(",")",";",["T_WHITESPACE","\n        ",1272],["T_FOREACH","foreach",1273],["T_WHITESPACE"," ",1273],"(",["T_VARIABLE","$products",1273],["T_WHITESPACE"," ",1273],["T_AS","as",1273],["T_WHITESPACE"," ",1273],["T_VARIABLE","$productId",1273],["T_WHITESPACE"," ",1273],["T_DOUBLE_ARROW","=>",1273],["T_WHITESPACE"," ",1273],["T_VARIABLE","$storeId",1273],")",["T_WHITESPACE"," ",1273],"{",["T_WHITESPACE","\n            ",1273],["T_VARIABLE","$catId",1274],["T_WHITESPACE"," ",1274],"=",["T_WHITESPACE"," ",1274],["T_STRING","Mage",1274],["T_DOUBLE_COLON","::",1274],["T_STRING","app",1274],"(",")",["T_OBJECT_OPERATOR","->",1274],["T_STRING","getStore",1274],"(",["T_VARIABLE","$storeId",1274],")",["T_OBJECT_OPERATOR","->",1274],["T_STRING","getRootCategoryId",1274],"(",")",";",["T_WHITESPACE","\n            ",1274],["T_VARIABLE","$productBind",1275],["T_WHITESPACE"," ",1275],"=",["T_WHITESPACE"," ",1275],["T_CONSTANT_ENCAPSED_STRING","'product_id'",1275],["T_WHITESPACE"," ",1275],".",["T_WHITESPACE"," ",1275],["T_VARIABLE","$productId",1275],";",["T_WHITESPACE","\n            ",1275],["T_VARIABLE","$storeBind",1276],["T_WHITESPACE","   ",1276],"=",["T_WHITESPACE"," ",1276],["T_CONSTANT_ENCAPSED_STRING","'store_id'",1276],["T_WHITESPACE"," ",1276],".",["T_WHITESPACE"," ",1276],["T_VARIABLE","$storeId",1276],";",["T_WHITESPACE","\n            ",1276],["T_VARIABLE","$catBind",1277],["T_WHITESPACE","     ",1277],"=",["T_WHITESPACE"," ",1277],["T_CONSTANT_ENCAPSED_STRING","'category_id'",1277],["T_WHITESPACE"," ",1277],".",["T_WHITESPACE"," ",1277],["T_VARIABLE","$catId",1277],";",["T_WHITESPACE","\n            ",1277],["T_VARIABLE","$cond",1278],["T_WHITESPACE","  ",1278],"=",["T_WHITESPACE"," ",1278],["T_CONSTANT_ENCAPSED_STRING","'('",1278],["T_WHITESPACE"," ",1278],".",["T_WHITESPACE"," ",1278],["T_STRING","implode",1278],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",1278],",",["T_WHITESPACE"," ",1278],["T_ARRAY","array",1278],"(",["T_WHITESPACE","\n                ",1278],["T_CONSTANT_ENCAPSED_STRING","'i.product_id = :'",1279],["T_WHITESPACE"," ",1279],".",["T_WHITESPACE"," ",1279],["T_VARIABLE","$productBind",1279],",",["T_WHITESPACE","\n                ",1279],["T_CONSTANT_ENCAPSED_STRING","'i.store_id = :'",1280],["T_WHITESPACE"," ",1280],".",["T_WHITESPACE"," ",1280],["T_VARIABLE","$storeBind",1280],",",["T_WHITESPACE","\n                ",1280],["T_CONSTANT_ENCAPSED_STRING","'i.category_id = :'",1281],["T_WHITESPACE"," ",1281],".",["T_WHITESPACE"," ",1281],["T_VARIABLE","$catBind",1281],",",["T_WHITESPACE","\n            ",1281],")",")",["T_WHITESPACE"," ",1282],".",["T_WHITESPACE"," ",1282],["T_CONSTANT_ENCAPSED_STRING","')'",1282],";",["T_WHITESPACE","\n            ",1282],["T_VARIABLE","$bind",1283],"[",["T_VARIABLE","$productBind",1283],"]",["T_WHITESPACE"," ",1283],"=",["T_WHITESPACE"," ",1283],["T_VARIABLE","$productId",1283],";",["T_WHITESPACE","\n            ",1283],["T_VARIABLE","$bind",1284],"[",["T_VARIABLE","$storeBind",1284],"]",["T_WHITESPACE","   ",1284],"=",["T_WHITESPACE"," ",1284],["T_VARIABLE","$storeId",1284],";",["T_WHITESPACE","\n            ",1284],["T_VARIABLE","$bind",1285],"[",["T_VARIABLE","$catBind",1285],"]",["T_WHITESPACE","     ",1285],"=",["T_WHITESPACE"," ",1285],["T_VARIABLE","$catId",1285],";",["T_WHITESPACE","\n            ",1285],["T_VARIABLE","$select",1286],["T_OBJECT_OPERATOR","->",1286],["T_STRING","orWhere",1286],"(",["T_VARIABLE","$cond",1286],")",";",["T_WHITESPACE","\n        ",1286],"}",["T_WHITESPACE","\n\n        ",1287],["T_VARIABLE","$rowSet",1289],["T_WHITESPACE"," ",1289],"=",["T_WHITESPACE"," ",1289],["T_VARIABLE","$adapter",1289],["T_OBJECT_OPERATOR","->",1289],["T_STRING","fetchAll",1289],"(",["T_VARIABLE","$select",1289],",",["T_WHITESPACE"," ",1289],["T_VARIABLE","$bind",1289],")",";",["T_WHITESPACE","\n        ",1289],["T_FOREACH","foreach",1290],["T_WHITESPACE"," ",1290],"(",["T_VARIABLE","$rowSet",1290],["T_WHITESPACE"," ",1290],["T_AS","as",1290],["T_WHITESPACE"," ",1290],["T_VARIABLE","$row",1290],")",["T_WHITESPACE"," ",1290],"{",["T_WHITESPACE","\n            ",1290],["T_VARIABLE","$result",1291],"[",["T_VARIABLE","$row",1291],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1291],"]","]",["T_WHITESPACE"," ",1291],"=",["T_WHITESPACE"," ",1291],["T_ARRAY","array",1291],"(",["T_WHITESPACE","\n                ",1291],["T_CONSTANT_ENCAPSED_STRING","'store_id'",1292],["T_WHITESPACE","      ",1292],["T_DOUBLE_ARROW","=>",1292],["T_WHITESPACE"," ",1292],["T_VARIABLE","$row",1292],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1292],"]",",",["T_WHITESPACE","\n                ",1292],["T_CONSTANT_ENCAPSED_STRING","'visibility'",1293],["T_WHITESPACE","    ",1293],["T_DOUBLE_ARROW","=>",1293],["T_WHITESPACE"," ",1293],["T_VARIABLE","$row",1293],"[",["T_CONSTANT_ENCAPSED_STRING","'visibility'",1293],"]",",",["T_WHITESPACE","\n                ",1293],["T_CONSTANT_ENCAPSED_STRING","'url_rewrite'",1294],["T_WHITESPACE","   ",1294],["T_DOUBLE_ARROW","=>",1294],["T_WHITESPACE"," ",1294],["T_VARIABLE","$row",1294],"[",["T_CONSTANT_ENCAPSED_STRING","'request_path'",1294],"]",",",["T_WHITESPACE","\n            ",1294],")",";",["T_WHITESPACE","\n        ",1295],"}",["T_WHITESPACE","\n\n        ",1296],["T_RETURN","return",1298],["T_WHITESPACE"," ",1298],["T_VARIABLE","$result",1298],";",["T_WHITESPACE","\n    ",1298],"}",["T_WHITESPACE","\n\n    ",1299],["T_DOC_COMMENT","\/**\n     * Find and return final id path by request path\n     * Needed for permanent redirect old URLs.\n     *\n     * @param string $requestPath\n     * @param int $storeId\n     * @param array $_checkedPaths internal varible to prevent infinite loops.\n     * @return string | bool\n     *\/",1301],["T_WHITESPACE","\n    ",1309],["T_PUBLIC","public",1310],["T_WHITESPACE"," ",1310],["T_FUNCTION","function",1310],["T_WHITESPACE"," ",1310],["T_STRING","findFinalTargetPath",1310],"(",["T_VARIABLE","$requestPath",1310],",",["T_WHITESPACE"," ",1310],["T_VARIABLE","$storeId",1310],",",["T_WHITESPACE"," ",1310],"&",["T_VARIABLE","$_checkedPaths",1310],["T_WHITESPACE"," ",1310],"=",["T_WHITESPACE"," ",1310],["T_ARRAY","array",1310],"(",")",")",["T_WHITESPACE","\n    ",1310],"{",["T_WHITESPACE","\n        ",1311],["T_IF","if",1312],["T_WHITESPACE"," ",1312],"(",["T_STRING","in_array",1312],"(",["T_VARIABLE","$requestPath",1312],",",["T_WHITESPACE"," ",1312],["T_VARIABLE","$_checkedPaths",1312],")",")",["T_WHITESPACE"," ",1312],"{",["T_WHITESPACE","\n            ",1312],["T_RETURN","return",1313],["T_WHITESPACE"," ",1313],["T_STRING","false",1313],";",["T_WHITESPACE","\n        ",1313],"}",["T_WHITESPACE","\n\n        ",1314],["T_VARIABLE","$_checkedPaths",1316],"[","]",["T_WHITESPACE"," ",1316],"=",["T_WHITESPACE"," ",1316],["T_VARIABLE","$requestPath",1316],";",["T_WHITESPACE","\n\n        ",1316],["T_VARIABLE","$select",1318],["T_WHITESPACE"," ",1318],"=",["T_WHITESPACE"," ",1318],["T_VARIABLE","$this",1318],["T_OBJECT_OPERATOR","->",1318],["T_STRING","_getWriteAdapter",1318],"(",")",["T_OBJECT_OPERATOR","->",1318],["T_STRING","select",1318],"(",")",["T_WHITESPACE","\n            ",1318],["T_OBJECT_OPERATOR","->",1319],["T_STRING","from",1319],"(",["T_VARIABLE","$this",1319],["T_OBJECT_OPERATOR","->",1319],["T_STRING","getMainTable",1319],"(",")",",",["T_WHITESPACE"," ",1319],["T_ARRAY","array",1319],"(",["T_CONSTANT_ENCAPSED_STRING","'target_path'",1319],",",["T_WHITESPACE"," ",1319],["T_CONSTANT_ENCAPSED_STRING","'id_path'",1319],")",")",["T_WHITESPACE","\n            ",1319],["T_OBJECT_OPERATOR","->",1320],["T_STRING","where",1320],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",1320],",",["T_WHITESPACE"," ",1320],["T_VARIABLE","$storeId",1320],")",["T_WHITESPACE","\n            ",1320],["T_OBJECT_OPERATOR","->",1321],["T_STRING","where",1321],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path = ?'",1321],",",["T_WHITESPACE"," ",1321],["T_VARIABLE","$requestPath",1321],")",";",["T_WHITESPACE","\n\n        ",1321],["T_IF","if",1323],["T_WHITESPACE"," ",1323],"(",["T_VARIABLE","$row",1323],["T_WHITESPACE"," ",1323],"=",["T_WHITESPACE"," ",1323],["T_VARIABLE","$this",1323],["T_OBJECT_OPERATOR","->",1323],["T_STRING","_getWriteAdapter",1323],"(",")",["T_OBJECT_OPERATOR","->",1323],["T_STRING","fetchRow",1323],"(",["T_VARIABLE","$select",1323],")",")",["T_WHITESPACE"," ",1323],"{",["T_WHITESPACE","\n            ",1323],["T_VARIABLE","$idPath",1324],["T_WHITESPACE"," ",1324],"=",["T_WHITESPACE"," ",1324],["T_VARIABLE","$this",1324],["T_OBJECT_OPERATOR","->",1324],["T_STRING","findFinalTargetPath",1324],"(",["T_VARIABLE","$row",1324],"[",["T_CONSTANT_ENCAPSED_STRING","'target_path'",1324],"]",",",["T_WHITESPACE"," ",1324],["T_VARIABLE","$storeId",1324],",",["T_WHITESPACE"," ",1324],["T_VARIABLE","$_checkedPaths",1324],")",";",["T_WHITESPACE","\n            ",1324],["T_IF","if",1325],["T_WHITESPACE"," ",1325],"(","!",["T_VARIABLE","$idPath",1325],")",["T_WHITESPACE"," ",1325],"{",["T_WHITESPACE","\n                ",1325],["T_RETURN","return",1326],["T_WHITESPACE"," ",1326],["T_VARIABLE","$row",1326],"[",["T_CONSTANT_ENCAPSED_STRING","'id_path'",1326],"]",";",["T_WHITESPACE","\n            ",1326],"}",["T_WHITESPACE"," ",1327],["T_ELSE","else",1327],["T_WHITESPACE"," ",1327],"{",["T_WHITESPACE","\n                ",1327],["T_RETURN","return",1328],["T_WHITESPACE"," ",1328],["T_VARIABLE","$idPath",1328],";",["T_WHITESPACE","\n            ",1328],"}",["T_WHITESPACE","\n        ",1329],"}",["T_WHITESPACE","\n\n        ",1330],["T_RETURN","return",1332],["T_WHITESPACE"," ",1332],["T_STRING","false",1332],";",["T_WHITESPACE","\n    ",1332],"}",["T_WHITESPACE","\n\n    ",1333],["T_DOC_COMMENT","\/**\n     * Delete rewrite path record from the database.\n     *\n     * @param string $requestPath\n     * @param int $storeId\n     * @return void\n     *\/",1335],["T_WHITESPACE","\n    ",1341],["T_PUBLIC","public",1342],["T_WHITESPACE"," ",1342],["T_FUNCTION","function",1342],["T_WHITESPACE"," ",1342],["T_STRING","deleteRewrite",1342],"(",["T_VARIABLE","$requestPath",1342],",",["T_WHITESPACE"," ",1342],["T_VARIABLE","$storeId",1342],")",["T_WHITESPACE","\n    ",1342],"{",["T_WHITESPACE","\n        ",1343],["T_VARIABLE","$this",1344],["T_OBJECT_OPERATOR","->",1344],["T_STRING","deleteRewriteRecord",1344],"(",["T_VARIABLE","$requestPath",1344],",",["T_WHITESPACE"," ",1344],["T_VARIABLE","$storeId",1344],")",";",["T_WHITESPACE","\n    ",1344],"}",["T_WHITESPACE","\n\n    ",1345],["T_DOC_COMMENT","\/**\n     * Delete rewrite path record from the database with RP checking.\n     *\n     * @param string $requestPath\n     * @param int $storeId\n     * @param bool $rp whether check rewrite option to be \"Redirect = Permanent\"\n     * @return void\n     *\/",1347],["T_WHITESPACE","\n    ",1354],["T_PUBLIC","public",1355],["T_WHITESPACE"," ",1355],["T_FUNCTION","function",1355],["T_WHITESPACE"," ",1355],["T_STRING","deleteRewriteRecord",1355],"(",["T_VARIABLE","$requestPath",1355],",",["T_WHITESPACE"," ",1355],["T_VARIABLE","$storeId",1355],",",["T_WHITESPACE"," ",1355],["T_VARIABLE","$rp",1355],["T_WHITESPACE"," ",1355],"=",["T_WHITESPACE"," ",1355],["T_STRING","false",1355],")",["T_WHITESPACE","\n    ",1355],"{",["T_WHITESPACE","\n        ",1356],["T_VARIABLE","$conditions",1357],["T_WHITESPACE"," ",1357],"=",["T_WHITESPACE","  ",1357],["T_ARRAY","array",1357],"(",["T_WHITESPACE","\n            ",1357],["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",1358],["T_WHITESPACE"," ",1358],["T_DOUBLE_ARROW","=>",1358],["T_WHITESPACE"," ",1358],["T_VARIABLE","$storeId",1358],",",["T_WHITESPACE","\n            ",1358],["T_CONSTANT_ENCAPSED_STRING","'request_path = ?'",1359],["T_WHITESPACE"," ",1359],["T_DOUBLE_ARROW","=>",1359],["T_WHITESPACE"," ",1359],["T_VARIABLE","$requestPath",1359],",",["T_WHITESPACE","\n        ",1359],")",";",["T_WHITESPACE","\n        ",1360],["T_IF","if",1361],["T_WHITESPACE"," ",1361],"(",["T_VARIABLE","$rp",1361],")",["T_WHITESPACE"," ",1361],"{",["T_WHITESPACE","\n            ",1361],["T_VARIABLE","$conditions",1362],"[",["T_CONSTANT_ENCAPSED_STRING","'options = ?'",1362],"]",["T_WHITESPACE"," ",1362],"=",["T_WHITESPACE"," ",1362],["T_CONSTANT_ENCAPSED_STRING","'RP'",1362],";",["T_WHITESPACE","\n        ",1362],"}",["T_WHITESPACE","\n        ",1363],["T_VARIABLE","$this",1364],["T_OBJECT_OPERATOR","->",1364],["T_STRING","_getWriteAdapter",1364],"(",")",["T_OBJECT_OPERATOR","->",1364],["T_STRING","delete",1364],"(",["T_VARIABLE","$this",1364],["T_OBJECT_OPERATOR","->",1364],["T_STRING","getMainTable",1364],"(",")",",",["T_WHITESPACE"," ",1364],["T_VARIABLE","$conditions",1364],")",";",["T_WHITESPACE","\n    ",1364],"}",["T_WHITESPACE","\n",1365],"}",["T_WHITESPACE","\n",1366]]