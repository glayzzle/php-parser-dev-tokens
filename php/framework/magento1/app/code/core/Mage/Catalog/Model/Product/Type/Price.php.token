[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Product type price model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Type_Price",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","CACHE_TAG",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'PRODUCT_PRICE'",36],";",["T_WHITESPACE","\n\n    ",36],["T_STATIC","static",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$attributeCache",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",")",";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Default action to get price of product\n     *\n     * @return decimal\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PUBLIC","public",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","getPrice",45],"(",["T_VARIABLE","$product",45],")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$product",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getData",47],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",47],")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Get base price with apply Group, Tier, Special prises\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param float|null $qty\n     *\n     * @return float\n     *\/",50],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","getBasePrice",58],"(",["T_VARIABLE","$product",58],",",["T_WHITESPACE"," ",58],["T_VARIABLE","$qty",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","null",58],")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$price",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_DOUBLE_CAST","(float)",60],["T_VARIABLE","$product",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getPrice",60],"(",")",";",["T_WHITESPACE","\n        ",60],["T_RETURN","return",61],["T_WHITESPACE"," ",61],["T_STRING","min",61],"(",["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_applyGroupPrice",61],"(",["T_VARIABLE","$product",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$price",61],")",",",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_applyTierPrice",61],"(",["T_VARIABLE","$product",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$qty",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$price",61],")",",",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_applySpecialPrice",62],"(",["T_VARIABLE","$product",62],",",["T_WHITESPACE"," ",62],["T_VARIABLE","$price",62],")",["T_WHITESPACE","\n        ",62],")",";",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n\n\n    ",64],["T_DOC_COMMENT","\/**\n     * Retrieve product final price\n     *\n     * @param float|null $qty\n     * @param Mage_Catalog_Model_Product $product\n     * @return float\n     *\/",67],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","getFinalPrice",74],"(",["T_VARIABLE","$qty",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","null",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$product",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_STRING","is_null",76],"(",["T_VARIABLE","$qty",76],")",["T_WHITESPACE"," ",76],["T_BOOLEAN_AND","&&",76],["T_WHITESPACE"," ",76],"!",["T_STRING","is_null",76],"(",["T_VARIABLE","$product",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getCalculatedFinalPrice",76],"(",")",")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$product",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getCalculatedFinalPrice",77],"(",")",";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$finalPrice",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getBasePrice",80],"(",["T_VARIABLE","$product",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$qty",80],")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$product",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","setFinalPrice",81],"(",["T_VARIABLE","$finalPrice",81],")",";",["T_WHITESPACE","\n\n        ",81],["T_STRING","Mage",83],["T_DOUBLE_COLON","::",83],["T_STRING","dispatchEvent",83],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_get_final_price'",83],",",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",83],["T_WHITESPACE"," ",83],["T_DOUBLE_ARROW","=>",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$product",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'qty'",83],["T_WHITESPACE"," ",83],["T_DOUBLE_ARROW","=>",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$qty",83],")",")",";",["T_WHITESPACE","\n\n        ",83],["T_VARIABLE","$finalPrice",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$product",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getData",85],"(",["T_CONSTANT_ENCAPSED_STRING","'final_price'",85],")",";",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$finalPrice",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_applyOptionsPrice",86],"(",["T_VARIABLE","$product",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$qty",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$finalPrice",86],")",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$finalPrice",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","max",87],"(",["T_LNUMBER","0",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$finalPrice",87],")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$product",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","setFinalPrice",88],"(",["T_VARIABLE","$finalPrice",88],")",";",["T_WHITESPACE","\n\n        ",88],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$finalPrice",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","getChildFinalPrice",93],"(",["T_VARIABLE","$product",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$productQty",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$childProduct",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$childProductQty",93],")",["T_WHITESPACE","\n    ",93],"{",["T_WHITESPACE","\n        ",94],["T_RETURN","return",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getFinalPrice",95],"(",["T_VARIABLE","$childProductQty",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$childProduct",95],")",";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Apply group price for product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param float $finalPrice\n     * @return float\n     *\/",98],["T_WHITESPACE","\n    ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","_applyGroupPrice",105],"(",["T_VARIABLE","$product",105],",",["T_WHITESPACE"," ",105],["T_VARIABLE","$finalPrice",105],")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$groupPrice",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$product",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getGroupPrice",107],"(",")",";",["T_WHITESPACE","\n        ",107],["T_IF","if",108],["T_WHITESPACE"," ",108],"(",["T_STRING","is_numeric",108],"(",["T_VARIABLE","$groupPrice",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$finalPrice",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_STRING","min",109],"(",["T_VARIABLE","$finalPrice",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$groupPrice",109],")",";",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE","\n        ",110],["T_RETURN","return",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$finalPrice",111],";",["T_WHITESPACE","\n    ",111],"}",["T_WHITESPACE","\n\n    ",112],["T_DOC_COMMENT","\/**\n     * Get product group price\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return float\n     *\/",114],["T_WHITESPACE","\n    ",119],["T_PUBLIC","public",120],["T_WHITESPACE"," ",120],["T_FUNCTION","function",120],["T_WHITESPACE"," ",120],["T_STRING","getGroupPrice",120],"(",["T_VARIABLE","$product",120],")",["T_WHITESPACE","\n    ",120],"{",["T_WHITESPACE","\n\n        ",121],["T_VARIABLE","$groupPrices",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$product",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getData",123],"(",["T_CONSTANT_ENCAPSED_STRING","'group_price'",123],")",";",["T_WHITESPACE","\n\n        ",123],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_STRING","is_null",125],"(",["T_VARIABLE","$groupPrices",125],")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$attribute",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$product",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getResource",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getAttribute",126],"(",["T_CONSTANT_ENCAPSED_STRING","'group_price'",126],")",";",["T_WHITESPACE","\n            ",126],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$attribute",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n                ",127],["T_VARIABLE","$attribute",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getBackend",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","afterLoad",128],"(",["T_VARIABLE","$product",128],")",";",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$groupPrices",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$product",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getData",129],"(",["T_CONSTANT_ENCAPSED_STRING","'group_price'",129],")",";",["T_WHITESPACE","\n            ",129],"}",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n\n        ",131],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_STRING","is_null",133],"(",["T_VARIABLE","$groupPrices",133],")",["T_WHITESPACE"," ",133],["T_BOOLEAN_OR","||",133],["T_WHITESPACE"," ",133],"!",["T_STRING","is_array",133],"(",["T_VARIABLE","$groupPrices",133],")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$product",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getPrice",134],"(",")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n\n        ",135],["T_VARIABLE","$customerGroup",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_getCustomerGroupId",137],"(",["T_VARIABLE","$product",137],")",";",["T_WHITESPACE","\n\n        ",137],["T_VARIABLE","$matchedPrice",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$product",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getPrice",139],"(",")",";",["T_WHITESPACE","\n        ",139],["T_FOREACH","foreach",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$groupPrices",140],["T_WHITESPACE"," ",140],["T_AS","as",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$groupPrice",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_IF","if",141],["T_WHITESPACE"," ",141],"(",["T_VARIABLE","$groupPrice",141],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",141],"]",["T_WHITESPACE"," ",141],["T_IS_EQUAL","==",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$customerGroup",141],["T_WHITESPACE"," ",141],["T_BOOLEAN_AND","&&",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$groupPrice",141],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",141],"]",["T_WHITESPACE"," ",141],"<",["T_WHITESPACE"," ",141],["T_VARIABLE","$matchedPrice",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$matchedPrice",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$groupPrice",142],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",142],"]",";",["T_WHITESPACE","\n                ",142],["T_BREAK","break",143],";",["T_WHITESPACE","\n            ",143],"}",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n\n        ",145],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$matchedPrice",147],";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Apply tier price for product if not return price that was before\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @param   float $qty\n     * @param   float $finalPrice\n     * @return  float\n     *\/",150],["T_WHITESPACE","\n    ",157],["T_PROTECTED","protected",158],["T_WHITESPACE"," ",158],["T_FUNCTION","function",158],["T_WHITESPACE"," ",158],["T_STRING","_applyTierPrice",158],"(",["T_VARIABLE","$product",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$qty",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$finalPrice",158],")",["T_WHITESPACE","\n    ",158],"{",["T_WHITESPACE","\n        ",159],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_STRING","is_null",160],"(",["T_VARIABLE","$qty",160],")",")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n            ",160],["T_RETURN","return",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$finalPrice",161],";",["T_WHITESPACE","\n        ",161],"}",["T_WHITESPACE","\n\n        ",162],["T_VARIABLE","$tierPrice",164],["T_WHITESPACE","  ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$product",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getTierPrice",164],"(",["T_VARIABLE","$qty",164],")",";",["T_WHITESPACE","\n        ",164],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_STRING","is_numeric",165],"(",["T_VARIABLE","$tierPrice",165],")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$finalPrice",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_STRING","min",166],"(",["T_VARIABLE","$finalPrice",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$tierPrice",166],")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$finalPrice",168],";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Get product tier price by qty\n     *\n     * @param   float $qty\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  float\n     *\/",171],["T_WHITESPACE","\n    ",177],["T_PUBLIC","public",178],["T_WHITESPACE"," ",178],["T_FUNCTION","function",178],["T_WHITESPACE"," ",178],["T_STRING","getTierPrice",178],"(",["T_VARIABLE","$qty",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_STRING","null",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$product",178],")",["T_WHITESPACE","\n    ",178],"{",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$allGroups",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","Mage_Customer_Model_Group",180],["T_DOUBLE_COLON","::",180],["T_STRING","CUST_GROUP_ALL",180],";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$prices",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$product",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getData",181],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",181],")",";",["T_WHITESPACE","\n\n        ",181],["T_IF","if",183],["T_WHITESPACE"," ",183],"(",["T_STRING","is_null",183],"(",["T_VARIABLE","$prices",183],")",")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$attribute",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$product",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getResource",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","getAttribute",184],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",184],")",";",["T_WHITESPACE","\n            ",184],["T_IF","if",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$attribute",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                ",185],["T_VARIABLE","$attribute",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getBackend",186],"(",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","afterLoad",186],"(",["T_VARIABLE","$product",186],")",";",["T_WHITESPACE","\n                ",186],["T_VARIABLE","$prices",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$product",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getData",187],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",187],")",";",["T_WHITESPACE","\n            ",187],"}",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE","\n\n        ",189],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_STRING","is_null",191],"(",["T_VARIABLE","$prices",191],")",["T_WHITESPACE"," ",191],["T_BOOLEAN_OR","||",191],["T_WHITESPACE"," ",191],"!",["T_STRING","is_array",191],"(",["T_VARIABLE","$prices",191],")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_IF","if",192],["T_WHITESPACE"," ",192],"(","!",["T_STRING","is_null",192],"(",["T_VARIABLE","$qty",192],")",")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n                ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$product",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getPrice",193],"(",")",";",["T_WHITESPACE","\n            ",193],"}",["T_WHITESPACE","\n            ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_ARRAY","array",195],"(",["T_ARRAY","array",195],"(",["T_WHITESPACE","\n                ",195],["T_CONSTANT_ENCAPSED_STRING","'price'",196],["T_WHITESPACE","         ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$product",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getPrice",196],"(",")",",",["T_WHITESPACE","\n                ",196],["T_CONSTANT_ENCAPSED_STRING","'website_price'",197],["T_WHITESPACE"," ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$product",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getPrice",197],"(",")",",",["T_WHITESPACE","\n                ",197],["T_CONSTANT_ENCAPSED_STRING","'price_qty'",198],["T_WHITESPACE","     ",198],["T_DOUBLE_ARROW","=>",198],["T_WHITESPACE"," ",198],["T_LNUMBER","1",198],",",["T_WHITESPACE","\n                ",198],["T_CONSTANT_ENCAPSED_STRING","'cust_group'",199],["T_WHITESPACE","    ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$allGroups",199],",",["T_WHITESPACE","\n            ",199],")",")",";",["T_WHITESPACE","\n        ",200],"}",["T_WHITESPACE","\n\n        ",201],["T_VARIABLE","$custGroup",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_getCustomerGroupId",203],"(",["T_VARIABLE","$product",203],")",";",["T_WHITESPACE","\n        ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(",["T_VARIABLE","$qty",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$prevQty",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_LNUMBER","1",205],";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$prevPrice",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$product",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getPrice",206],"(",")",";",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$prevGroup",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$allGroups",207],";",["T_WHITESPACE","\n\n            ",207],["T_FOREACH","foreach",209],["T_WHITESPACE"," ",209],"(",["T_VARIABLE","$prices",209],["T_WHITESPACE"," ",209],["T_AS","as",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$price",209],")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n                ",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$price",210],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",210],"]",["T_IS_NOT_EQUAL","!=",210],["T_VARIABLE","$custGroup",210],["T_WHITESPACE"," ",210],["T_BOOLEAN_AND","&&",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$price",210],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",210],"]",["T_IS_NOT_EQUAL","!=",210],["T_VARIABLE","$allGroups",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n                    ",210],["T_COMMENT","\/\/ tier not for current customer group nor is for all groups\n",211],["T_WHITESPACE","                    ",212],["T_CONTINUE","continue",212],";",["T_WHITESPACE","\n                ",212],"}",["T_WHITESPACE","\n                ",213],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$qty",214],["T_WHITESPACE"," ",214],"<",["T_WHITESPACE"," ",214],["T_VARIABLE","$price",214],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",214],"]",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n                    ",214],["T_COMMENT","\/\/ tier is higher than product qty\n",215],["T_WHITESPACE","                    ",216],["T_CONTINUE","continue",216],";",["T_WHITESPACE","\n                ",216],"}",["T_WHITESPACE","\n                ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$price",218],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",218],"]",["T_WHITESPACE"," ",218],"<",["T_WHITESPACE"," ",218],["T_VARIABLE","$prevQty",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n                    ",218],["T_COMMENT","\/\/ higher tier qty already found\n",219],["T_WHITESPACE","                    ",220],["T_CONTINUE","continue",220],";",["T_WHITESPACE","\n                ",220],"}",["T_WHITESPACE","\n                ",221],["T_IF","if",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$price",222],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",222],"]",["T_WHITESPACE"," ",222],["T_IS_EQUAL","==",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$prevQty",222],["T_WHITESPACE"," ",222],["T_BOOLEAN_AND","&&",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$prevGroup",222],["T_WHITESPACE"," ",222],["T_IS_NOT_EQUAL","!=",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$allGroups",222],["T_WHITESPACE"," ",222],["T_BOOLEAN_AND","&&",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$price",222],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",222],"]",["T_WHITESPACE"," ",222],["T_IS_EQUAL","==",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$allGroups",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n                    ",222],["T_COMMENT","\/\/ found tier qty is same as current tier qty but current tier group is ALL_GROUPS\n",223],["T_WHITESPACE","                    ",224],["T_CONTINUE","continue",224],";",["T_WHITESPACE","\n                ",224],"}",["T_WHITESPACE","\n                ",225],["T_IF","if",226],["T_WHITESPACE"," ",226],"(",["T_VARIABLE","$price",226],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",226],"]",["T_WHITESPACE"," ",226],"<",["T_WHITESPACE"," ",226],["T_VARIABLE","$prevPrice",226],")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n                    ",226],["T_VARIABLE","$prevPrice",227],["T_WHITESPACE","  ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$price",227],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",227],"]",";",["T_WHITESPACE","\n                    ",227],["T_VARIABLE","$prevQty",228],["T_WHITESPACE","    ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$price",228],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",228],"]",";",["T_WHITESPACE","\n                    ",228],["T_VARIABLE","$prevGroup",229],["T_WHITESPACE","  ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$price",229],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",229],"]",";",["T_WHITESPACE","\n                ",229],"}",["T_WHITESPACE","\n            ",230],"}",["T_WHITESPACE","\n            ",231],["T_RETURN","return",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$prevPrice",232],";",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE"," ",233],["T_ELSE","else",233],["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n            ",233],["T_VARIABLE","$qtyCache",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_ARRAY","array",234],"(",")",";",["T_WHITESPACE","\n            ",234],["T_FOREACH","foreach",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$prices",235],["T_WHITESPACE"," ",235],["T_AS","as",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$i",235],["T_WHITESPACE"," ",235],["T_DOUBLE_ARROW","=>",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$price",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n                ",235],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$price",236],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",236],"]",["T_WHITESPACE"," ",236],["T_IS_NOT_EQUAL","!=",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$custGroup",236],["T_WHITESPACE"," ",236],["T_BOOLEAN_AND","&&",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$price",236],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",236],"]",["T_WHITESPACE"," ",236],["T_IS_NOT_EQUAL","!=",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$allGroups",236],")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n                    ",236],["T_UNSET","unset",237],"(",["T_VARIABLE","$prices",237],"[",["T_VARIABLE","$i",237],"]",")",";",["T_WHITESPACE","\n                ",237],"}",["T_WHITESPACE"," ",238],["T_ELSE","else",238],["T_WHITESPACE"," ",238],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_ISSET","isset",238],"(",["T_VARIABLE","$qtyCache",238],"[",["T_VARIABLE","$price",238],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",238],"]","]",")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n                    ",238],["T_VARIABLE","$j",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$qtyCache",239],"[",["T_VARIABLE","$price",239],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",239],"]","]",";",["T_WHITESPACE","\n                    ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_VARIABLE","$prices",240],"[",["T_VARIABLE","$j",240],"]","[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",240],"]",["T_WHITESPACE"," ",240],">",["T_WHITESPACE"," ",240],["T_VARIABLE","$price",240],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",240],"]",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n                        ",240],["T_UNSET","unset",241],"(",["T_VARIABLE","$prices",241],"[",["T_VARIABLE","$j",241],"]",")",";",["T_WHITESPACE","\n                        ",241],["T_VARIABLE","$qtyCache",242],"[",["T_VARIABLE","$price",242],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",242],"]","]",["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$i",242],";",["T_WHITESPACE","\n                    ",242],"}",["T_WHITESPACE"," ",243],["T_ELSE","else",243],["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n                        ",243],["T_UNSET","unset",244],"(",["T_VARIABLE","$prices",244],"[",["T_VARIABLE","$i",244],"]",")",";",["T_WHITESPACE","\n                    ",244],"}",["T_WHITESPACE","\n                ",245],"}",["T_WHITESPACE"," ",246],["T_ELSE","else",246],["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n                    ",246],["T_VARIABLE","$qtyCache",247],"[",["T_VARIABLE","$price",247],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",247],"]","]",["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$i",247],";",["T_WHITESPACE","\n                ",247],"}",["T_WHITESPACE","\n            ",248],"}",["T_WHITESPACE","\n        ",249],"}",["T_WHITESPACE","\n\n        ",250],["T_RETURN","return",252],["T_WHITESPACE"," ",252],"(",["T_VARIABLE","$prices",252],")",["T_WHITESPACE"," ",252],"?",["T_WHITESPACE"," ",252],["T_VARIABLE","$prices",252],["T_WHITESPACE"," ",252],":",["T_WHITESPACE"," ",252],["T_ARRAY","array",252],"(",")",";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_PROTECTED","protected",255],["T_WHITESPACE"," ",255],["T_FUNCTION","function",255],["T_WHITESPACE"," ",255],["T_STRING","_getCustomerGroupId",255],"(",["T_VARIABLE","$product",255],")",["T_WHITESPACE","\n    ",255],"{",["T_WHITESPACE","\n        ",256],["T_IF","if",257],["T_WHITESPACE"," ",257],"(",["T_VARIABLE","$product",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getCustomerGroupId",257],"(",")",")",["T_WHITESPACE"," ",257],"{",["T_WHITESPACE","\n            ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$product",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getCustomerGroupId",258],"(",")",";",["T_WHITESPACE","\n        ",258],"}",["T_WHITESPACE","\n        ",259],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_STRING","Mage",260],["T_DOUBLE_COLON","::",260],["T_STRING","getSingleton",260],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",260],")",["T_OBJECT_OPERATOR","->",260],["T_STRING","getCustomerGroupId",260],"(",")",";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n\n    ",261],["T_DOC_COMMENT","\/**\n     * Apply special price for product if not return price that was before\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @param   float $finalPrice\n     * @return  float\n     *\/",263],["T_WHITESPACE","\n    ",269],["T_PROTECTED","protected",270],["T_WHITESPACE"," ",270],["T_FUNCTION","function",270],["T_WHITESPACE"," ",270],["T_STRING","_applySpecialPrice",270],"(",["T_VARIABLE","$product",270],",",["T_WHITESPACE"," ",270],["T_VARIABLE","$finalPrice",270],")",["T_WHITESPACE","\n    ",270],"{",["T_WHITESPACE","\n        ",271],["T_RETURN","return",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","calculateSpecialPrice",272],"(",["T_VARIABLE","$finalPrice",272],",",["T_WHITESPACE"," ",272],["T_VARIABLE","$product",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getSpecialPrice",272],"(",")",",",["T_WHITESPACE"," ",272],["T_VARIABLE","$product",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getSpecialFromDate",272],"(",")",",",["T_WHITESPACE","\n                        ",272],["T_VARIABLE","$product",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getSpecialToDate",273],"(",")",",",["T_WHITESPACE"," ",273],["T_VARIABLE","$product",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getStore",273],"(",")",["T_WHITESPACE","\n        ",273],")",";",["T_WHITESPACE","\n    ",274],"}",["T_WHITESPACE","\n\n    ",275],["T_DOC_COMMENT","\/**\n     * Count how many tier prices we have for the product\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  int\n     *\/",277],["T_WHITESPACE","\n    ",282],["T_PUBLIC","public",283],["T_WHITESPACE"," ",283],["T_FUNCTION","function",283],["T_WHITESPACE"," ",283],["T_STRING","getTierPriceCount",283],"(",["T_VARIABLE","$product",283],")",["T_WHITESPACE","\n    ",283],"{",["T_WHITESPACE","\n        ",284],["T_VARIABLE","$price",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$product",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getTierPrice",285],"(",")",";",["T_WHITESPACE","\n        ",285],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_STRING","count",286],"(",["T_VARIABLE","$price",286],")",";",["T_WHITESPACE","\n    ",286],"}",["T_WHITESPACE","\n\n    ",287],["T_DOC_COMMENT","\/**\n     * Get formatted by currency tier price\n     *\n     * @param   float $qty\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  array || float\n     *\/",289],["T_WHITESPACE","\n    ",295],["T_PUBLIC","public",296],["T_WHITESPACE"," ",296],["T_FUNCTION","function",296],["T_WHITESPACE"," ",296],["T_STRING","getFormatedTierPrice",296],"(",["T_VARIABLE","$qty",296],"=",["T_STRING","null",296],",",["T_WHITESPACE"," ",296],["T_VARIABLE","$product",296],")",["T_WHITESPACE","\n    ",296],"{",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$price",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$product",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getTierPrice",298],"(",["T_VARIABLE","$qty",298],")",";",["T_WHITESPACE","\n        ",298],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_STRING","is_array",299],"(",["T_VARIABLE","$price",299],")",")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n            ",299],["T_FOREACH","foreach",300],["T_WHITESPACE"," ",300],"(",["T_VARIABLE","$price",300],["T_WHITESPACE"," ",300],["T_AS","as",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$index",300],["T_WHITESPACE"," ",300],["T_DOUBLE_ARROW","=>",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$value",300],")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n                ",300],["T_VARIABLE","$price",301],"[",["T_VARIABLE","$index",301],"]","[",["T_CONSTANT_ENCAPSED_STRING","'formated_price'",301],"]",["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_STRING","Mage",301],["T_DOUBLE_COLON","::",301],["T_STRING","app",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","getStore",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","convertPrice",301],"(",["T_WHITESPACE","\n                        ",301],["T_VARIABLE","$price",302],"[",["T_VARIABLE","$index",302],"]","[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",302],"]",",",["T_WHITESPACE"," ",302],["T_STRING","true",302],["T_WHITESPACE","\n                ",302],")",";",["T_WHITESPACE","\n            ",303],"}",["T_WHITESPACE","\n        ",304],"}",["T_WHITESPACE","\n        ",305],["T_ELSE","else",306],["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$price",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_STRING","Mage",307],["T_DOUBLE_COLON","::",307],["T_STRING","app",307],"(",")",["T_OBJECT_OPERATOR","->",307],["T_STRING","getStore",307],"(",")",["T_OBJECT_OPERATOR","->",307],["T_STRING","formatPrice",307],"(",["T_VARIABLE","$price",307],")",";",["T_WHITESPACE","\n        ",307],"}",["T_WHITESPACE","\n\n        ",308],["T_RETURN","return",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$price",310],";",["T_WHITESPACE","\n    ",310],"}",["T_WHITESPACE","\n\n    ",311],["T_DOC_COMMENT","\/**\n     * Get formatted by currency product price\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  array || float\n     *\/",313],["T_WHITESPACE","\n    ",318],["T_PUBLIC","public",319],["T_WHITESPACE"," ",319],["T_FUNCTION","function",319],["T_WHITESPACE"," ",319],["T_STRING","getFormatedPrice",319],"(",["T_VARIABLE","$product",319],")",["T_WHITESPACE","\n    ",319],"{",["T_WHITESPACE","\n        ",320],["T_RETURN","return",321],["T_WHITESPACE"," ",321],["T_STRING","Mage",321],["T_DOUBLE_COLON","::",321],["T_STRING","app",321],"(",")",["T_OBJECT_OPERATOR","->",321],["T_STRING","getStore",321],"(",")",["T_OBJECT_OPERATOR","->",321],["T_STRING","formatPrice",321],"(",["T_VARIABLE","$product",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getFinalPrice",321],"(",")",")",";",["T_WHITESPACE","\n    ",321],"}",["T_WHITESPACE","\n\n    ",322],["T_DOC_COMMENT","\/**\n     * Apply options price\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param int $qty\n     * @param float $finalPrice\n     * @return float\n     *\/",324],["T_WHITESPACE","\n    ",331],["T_PROTECTED","protected",332],["T_WHITESPACE"," ",332],["T_FUNCTION","function",332],["T_WHITESPACE"," ",332],["T_STRING","_applyOptionsPrice",332],"(",["T_VARIABLE","$product",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$qty",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$finalPrice",332],")",["T_WHITESPACE","\n    ",332],"{",["T_WHITESPACE","\n        ",333],["T_IF","if",334],["T_WHITESPACE"," ",334],"(",["T_VARIABLE","$optionIds",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$product",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getCustomOption",334],"(",["T_CONSTANT_ENCAPSED_STRING","'option_ids'",334],")",")",["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n            ",334],["T_VARIABLE","$basePrice",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$finalPrice",335],";",["T_WHITESPACE","\n            ",335],["T_FOREACH","foreach",336],["T_WHITESPACE"," ",336],"(",["T_STRING","explode",336],"(",["T_CONSTANT_ENCAPSED_STRING","','",336],",",["T_WHITESPACE"," ",336],["T_VARIABLE","$optionIds",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getValue",336],"(",")",")",["T_WHITESPACE"," ",336],["T_AS","as",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$optionId",336],")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n                ",336],["T_IF","if",337],["T_WHITESPACE"," ",337],"(",["T_VARIABLE","$option",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$product",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getOptionById",337],"(",["T_VARIABLE","$optionId",337],")",")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                    ",337],["T_VARIABLE","$confItemOption",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$product",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getCustomOption",338],"(",["T_CONSTANT_ENCAPSED_STRING","'option_'",338],".",["T_VARIABLE","$option",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getId",338],"(",")",")",";",["T_WHITESPACE","\n\n                    ",338],["T_VARIABLE","$group",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$option",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","groupFactory",340],"(",["T_VARIABLE","$option",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getType",340],"(",")",")",["T_WHITESPACE","\n                        ",340],["T_OBJECT_OPERATOR","->",341],["T_STRING","setOption",341],"(",["T_VARIABLE","$option",341],")",["T_WHITESPACE","\n                        ",341],["T_OBJECT_OPERATOR","->",342],["T_STRING","setConfigurationItemOption",342],"(",["T_VARIABLE","$confItemOption",342],")",";",["T_WHITESPACE","\n                    ",342],["T_VARIABLE","$finalPrice",343],["T_WHITESPACE"," ",343],["T_PLUS_EQUAL","+=",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$group",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getOptionPrice",343],"(",["T_VARIABLE","$confItemOption",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getValue",343],"(",")",",",["T_WHITESPACE"," ",343],["T_VARIABLE","$basePrice",343],")",";",["T_WHITESPACE","\n                ",343],"}",["T_WHITESPACE","\n            ",344],"}",["T_WHITESPACE","\n        ",345],"}",["T_WHITESPACE","\n\n        ",346],["T_RETURN","return",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$finalPrice",348],";",["T_WHITESPACE","\n    ",348],"}",["T_WHITESPACE","\n\n    ",349],["T_DOC_COMMENT","\/**\n     * Calculate product price based on special price data and price rules\n     *\n     * @param   float $basePrice\n     * @param   float $specialPrice\n     * @param   string $specialPriceFrom\n     * @param   string $specialPriceTo\n     * @param   float|null|false $rulePrice\n     * @param   mixed $wId\n     * @param   mixed $gId\n     * @param   null|int $productId\n     * @return  float\n     *\/",351],["T_WHITESPACE","\n    ",363],["T_PUBLIC","public",364],["T_WHITESPACE"," ",364],["T_STATIC","static",364],["T_WHITESPACE"," ",364],["T_FUNCTION","function",364],["T_WHITESPACE"," ",364],["T_STRING","calculatePrice",364],"(",["T_VARIABLE","$basePrice",364],",",["T_WHITESPACE"," ",364],["T_VARIABLE","$specialPrice",364],",",["T_WHITESPACE"," ",364],["T_VARIABLE","$specialPriceFrom",364],",",["T_WHITESPACE"," ",364],["T_VARIABLE","$specialPriceTo",364],",",["T_WHITESPACE","\n            ",364],["T_VARIABLE","$rulePrice",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_STRING","false",365],",",["T_WHITESPACE"," ",365],["T_VARIABLE","$wId",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_STRING","null",365],",",["T_WHITESPACE"," ",365],["T_VARIABLE","$gId",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_STRING","null",365],",",["T_WHITESPACE"," ",365],["T_VARIABLE","$productId",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_STRING","null",365],")",["T_WHITESPACE","\n    ",365],"{",["T_WHITESPACE","\n        ",366],["T_STRING","Varien_Profiler",367],["T_DOUBLE_COLON","::",367],["T_STRING","start",367],"(",["T_CONSTANT_ENCAPSED_STRING","'__PRODUCT_CALCULATE_PRICE__'",367],")",";",["T_WHITESPACE","\n        ",367],["T_IF","if",368],["T_WHITESPACE"," ",368],"(",["T_VARIABLE","$wId",368],["T_WHITESPACE"," ",368],["T_INSTANCEOF","instanceof",368],["T_WHITESPACE"," ",368],["T_STRING","Mage_Core_Model_Store",368],")",["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n            ",368],["T_VARIABLE","$sId",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_VARIABLE","$wId",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getId",369],"(",")",";",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$wId",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_VARIABLE","$wId",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getWebsiteId",370],"(",")",";",["T_WHITESPACE","\n        ",370],"}",["T_WHITESPACE"," ",371],["T_ELSE","else",371],["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n            ",371],["T_VARIABLE","$sId",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_STRING","Mage",372],["T_DOUBLE_COLON","::",372],["T_STRING","app",372],"(",")",["T_OBJECT_OPERATOR","->",372],["T_STRING","getWebsite",372],"(",["T_VARIABLE","$wId",372],")",["T_OBJECT_OPERATOR","->",372],["T_STRING","getDefaultGroup",372],"(",")",["T_OBJECT_OPERATOR","->",372],["T_STRING","getDefaultStoreId",372],"(",")",";",["T_WHITESPACE","\n        ",372],"}",["T_WHITESPACE","\n\n        ",373],["T_VARIABLE","$finalPrice",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$basePrice",375],";",["T_WHITESPACE","\n        ",375],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_VARIABLE","$gId",376],["T_WHITESPACE"," ",376],["T_INSTANCEOF","instanceof",376],["T_WHITESPACE"," ",376],["T_STRING","Mage_Customer_Model_Group",376],")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$gId",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_VARIABLE","$gId",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getId",377],"(",")",";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE","\n\n        ",378],["T_VARIABLE","$finalPrice",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_STRING","self",380],["T_DOUBLE_COLON","::",380],["T_STRING","calculateSpecialPrice",380],"(",["T_VARIABLE","$finalPrice",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$specialPrice",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$specialPriceFrom",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$specialPriceTo",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$sId",380],")",";",["T_WHITESPACE","\n\n        ",380],["T_IF","if",382],["T_WHITESPACE"," ",382],"(",["T_VARIABLE","$rulePrice",382],["T_WHITESPACE"," ",382],["T_IS_IDENTICAL","===",382],["T_WHITESPACE"," ",382],["T_STRING","false",382],")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_VARIABLE","$storeTimestamp",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_STRING","Mage",383],["T_DOUBLE_COLON","::",383],["T_STRING","app",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","getLocale",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","storeTimeStamp",383],"(",["T_VARIABLE","$sId",383],")",";",["T_WHITESPACE","\n            ",383],["T_VARIABLE","$rulePrice",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_STRING","Mage",384],["T_DOUBLE_COLON","::",384],["T_STRING","getResourceModel",384],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",384],")",["T_WHITESPACE","\n                ",384],["T_OBJECT_OPERATOR","->",385],["T_STRING","getRulePrice",385],"(",["T_VARIABLE","$storeTimestamp",385],",",["T_WHITESPACE"," ",385],["T_VARIABLE","$wId",385],",",["T_WHITESPACE"," ",385],["T_VARIABLE","$gId",385],",",["T_WHITESPACE"," ",385],["T_VARIABLE","$productId",385],")",";",["T_WHITESPACE","\n        ",385],"}",["T_WHITESPACE","\n\n        ",386],["T_IF","if",388],["T_WHITESPACE"," ",388],"(",["T_VARIABLE","$rulePrice",388],["T_WHITESPACE"," ",388],["T_IS_NOT_IDENTICAL","!==",388],["T_WHITESPACE"," ",388],["T_STRING","null",388],["T_WHITESPACE"," ",388],["T_BOOLEAN_AND","&&",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$rulePrice",388],["T_WHITESPACE"," ",388],["T_IS_NOT_IDENTICAL","!==",388],["T_WHITESPACE"," ",388],["T_STRING","false",388],")",["T_WHITESPACE"," ",388],"{",["T_WHITESPACE","\n            ",388],["T_VARIABLE","$finalPrice",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_STRING","min",389],"(",["T_VARIABLE","$finalPrice",389],",",["T_WHITESPACE"," ",389],["T_VARIABLE","$rulePrice",389],")",";",["T_WHITESPACE","\n        ",389],"}",["T_WHITESPACE","\n\n        ",390],["T_VARIABLE","$finalPrice",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_STRING","max",392],"(",["T_VARIABLE","$finalPrice",392],",",["T_WHITESPACE"," ",392],["T_LNUMBER","0",392],")",";",["T_WHITESPACE","\n        ",392],["T_STRING","Varien_Profiler",393],["T_DOUBLE_COLON","::",393],["T_STRING","stop",393],"(",["T_CONSTANT_ENCAPSED_STRING","'__PRODUCT_CALCULATE_PRICE__'",393],")",";",["T_WHITESPACE","\n        ",393],["T_RETURN","return",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$finalPrice",394],";",["T_WHITESPACE","\n    ",394],"}",["T_WHITESPACE","\n\n    ",395],["T_DOC_COMMENT","\/**\n     * Calculate and apply special price\n     *\n     * @param float $finalPrice\n     * @param float $specialPrice\n     * @param string $specialPriceFrom\n     * @param string $specialPriceTo\n     * @param mixed $store\n     * @return float\n     *\/",397],["T_WHITESPACE","\n    ",406],["T_PUBLIC","public",407],["T_WHITESPACE"," ",407],["T_STATIC","static",407],["T_WHITESPACE"," ",407],["T_FUNCTION","function",407],["T_WHITESPACE"," ",407],["T_STRING","calculateSpecialPrice",407],"(",["T_VARIABLE","$finalPrice",407],",",["T_WHITESPACE"," ",407],["T_VARIABLE","$specialPrice",407],",",["T_WHITESPACE"," ",407],["T_VARIABLE","$specialPriceFrom",407],",",["T_WHITESPACE"," ",407],["T_VARIABLE","$specialPriceTo",407],",",["T_WHITESPACE","\n            ",407],["T_VARIABLE","$store",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_STRING","null",408],")",["T_WHITESPACE","\n    ",408],"{",["T_WHITESPACE","\n        ",409],["T_IF","if",410],["T_WHITESPACE"," ",410],"(","!",["T_STRING","is_null",410],"(",["T_VARIABLE","$specialPrice",410],")",["T_WHITESPACE"," ",410],["T_BOOLEAN_AND","&&",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$specialPrice",410],["T_WHITESPACE"," ",410],["T_IS_NOT_EQUAL","!=",410],["T_WHITESPACE"," ",410],["T_STRING","false",410],")",["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n            ",410],["T_IF","if",411],["T_WHITESPACE"," ",411],"(",["T_STRING","Mage",411],["T_DOUBLE_COLON","::",411],["T_STRING","app",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","getLocale",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","isStoreDateInInterval",411],"(",["T_VARIABLE","$store",411],",",["T_WHITESPACE"," ",411],["T_VARIABLE","$specialPriceFrom",411],",",["T_WHITESPACE"," ",411],["T_VARIABLE","$specialPriceTo",411],")",")",["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n                ",411],["T_VARIABLE","$finalPrice",412],["T_WHITESPACE","     ",412],"=",["T_WHITESPACE"," ",412],["T_STRING","min",412],"(",["T_VARIABLE","$finalPrice",412],",",["T_WHITESPACE"," ",412],["T_VARIABLE","$specialPrice",412],")",";",["T_WHITESPACE","\n            ",412],"}",["T_WHITESPACE","\n        ",413],"}",["T_WHITESPACE","\n        ",414],["T_RETURN","return",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$finalPrice",415],";",["T_WHITESPACE","\n    ",415],"}",["T_WHITESPACE","\n\n    ",416],["T_DOC_COMMENT","\/**\n     * Check is tier price value fixed or percent of original price\n     *\n     * @return bool\n     *\/",418],["T_WHITESPACE","\n    ",422],["T_PUBLIC","public",423],["T_WHITESPACE"," ",423],["T_FUNCTION","function",423],["T_WHITESPACE"," ",423],["T_STRING","isTierPriceFixed",423],"(",")",["T_WHITESPACE","\n    ",423],"{",["T_WHITESPACE","\n        ",424],["T_RETURN","return",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$this",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","isGroupPriceFixed",425],"(",")",";",["T_WHITESPACE","\n    ",425],"}",["T_WHITESPACE","\n\n    ",426],["T_DOC_COMMENT","\/**\n     * Check is group price value fixed or percent of original price\n     *\n     * @return bool\n     *\/",428],["T_WHITESPACE","\n    ",432],["T_PUBLIC","public",433],["T_WHITESPACE"," ",433],["T_FUNCTION","function",433],["T_WHITESPACE"," ",433],["T_STRING","isGroupPriceFixed",433],"(",")",["T_WHITESPACE","\n    ",433],"{",["T_WHITESPACE","\n        ",434],["T_RETURN","return",435],["T_WHITESPACE"," ",435],["T_STRING","true",435],";",["T_WHITESPACE","\n    ",435],"}",["T_WHITESPACE","\n",436],"}",["T_WHITESPACE","\n",437]]