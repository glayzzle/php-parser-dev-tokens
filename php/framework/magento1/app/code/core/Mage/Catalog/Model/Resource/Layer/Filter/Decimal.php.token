[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog Layer Decimal attribute Filter Resource Model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Layer_Filter_Decimal",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Initialize connection and define main table name\n     *\n     *\/",37],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_init",43],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_index_eav_decimal'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Apply attribute filter to product collection\n     *\n     * @param Mage_Catalog_Model_Layer_Filter_Decimal $filter\n     * @param float $range\n     * @param int $index\n     * @return Mage_Catalog_Model_Resource_Layer_Filter_Decimal\n     *\/",46],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","applyFilterToCollection",54],"(",["T_VARIABLE","$filter",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$range",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$index",54],")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$collection",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$filter",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getLayer",56],"(",")",["T_OBJECT_OPERATOR","->",56],["T_STRING","getProductCollection",56],"(",")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$attribute",57],["T_WHITESPACE","  ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$filter",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getAttributeModel",57],"(",")",";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$connection",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","_getReadAdapter",58],"(",")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$tableAlias",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","sprintf",59],"(",["T_CONSTANT_ENCAPSED_STRING","'%s_idx'",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$attribute",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getAttributeCode",59],"(",")",")",";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$conditions",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_ARRAY","array",60],"(",["T_WHITESPACE","\n            ",60],"\"",["T_CURLY_OPEN","{",61],["T_VARIABLE","$tableAlias",61],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_id = e.entity_id",61],"\"",",",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$connection",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","quoteInto",62],"(","\"",["T_CURLY_OPEN","{",62],["T_VARIABLE","$tableAlias",62],"}",["T_ENCAPSED_AND_WHITESPACE",".attribute_id = ?",62],"\"",",",["T_WHITESPACE"," ",62],["T_VARIABLE","$attribute",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getAttributeId",62],"(",")",")",",",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$connection",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","quoteInto",63],"(","\"",["T_CURLY_OPEN","{",63],["T_VARIABLE","$tableAlias",63],"}",["T_ENCAPSED_AND_WHITESPACE",".store_id = ?",63],"\"",",",["T_WHITESPACE"," ",63],["T_VARIABLE","$collection",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getStoreId",63],"(",")",")",["T_WHITESPACE","\n        ",63],")",";",["T_WHITESPACE","\n\n        ",64],["T_VARIABLE","$collection",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getSelect",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","join",66],"(",["T_WHITESPACE","\n            ",66],["T_ARRAY","array",67],"(",["T_VARIABLE","$tableAlias",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getMainTable",67],"(",")",")",",",["T_WHITESPACE","\n            ",67],["T_STRING","implode",68],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$conditions",68],")",",",["T_WHITESPACE","\n            ",68],["T_ARRAY","array",69],"(",")",["T_WHITESPACE","\n        ",69],")",";",["T_WHITESPACE","\n\n        ",70],["T_VARIABLE","$collection",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getSelect",72],"(",")",["T_WHITESPACE","\n            ",72],["T_OBJECT_OPERATOR","->",73],["T_STRING","where",73],"(","\"",["T_CURLY_OPEN","{",73],["T_VARIABLE","$tableAlias",73],"}",["T_ENCAPSED_AND_WHITESPACE",".value >= ?",73],"\"",",",["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$range",73],["T_WHITESPACE"," ",73],"*",["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$index",73],["T_WHITESPACE"," ",73],"-",["T_WHITESPACE"," ",73],["T_LNUMBER","1",73],")",")",")",["T_WHITESPACE","\n            ",73],["T_OBJECT_OPERATOR","->",74],["T_STRING","where",74],"(","\"",["T_CURLY_OPEN","{",74],["T_VARIABLE","$tableAlias",74],"}",["T_ENCAPSED_AND_WHITESPACE",".value < ?",74],"\"",",",["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$range",74],["T_WHITESPACE"," ",74],"*",["T_WHITESPACE"," ",74],["T_VARIABLE","$index",74],")",")",";",["T_WHITESPACE","\n\n        ",74],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Retrieve array of minimal and maximal values\n     *\n     * @param Mage_Catalog_Model_Layer_Filter_Decimal $filter\n     * @return array\n     *\/",79],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","getMinMax",85],"(",["T_VARIABLE","$filter",85],")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$select",87],["T_WHITESPACE","     ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_getSelect",87],"(",["T_VARIABLE","$filter",87],")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$adapter",88],["T_WHITESPACE","    ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_getReadAdapter",88],"(",")",";",["T_WHITESPACE","\n\n        ",88],["T_VARIABLE","$select",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","columns",90],"(",["T_ARRAY","array",90],"(",["T_WHITESPACE","\n            ",90],["T_CONSTANT_ENCAPSED_STRING","'min_value'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_NEW","new",91],["T_WHITESPACE"," ",91],["T_STRING","Zend_Db_Expr",91],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(decimal_index.value)'",91],")",",",["T_WHITESPACE","\n            ",91],["T_CONSTANT_ENCAPSED_STRING","'max_value'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_NEW","new",92],["T_WHITESPACE"," ",92],["T_STRING","Zend_Db_Expr",92],"(",["T_CONSTANT_ENCAPSED_STRING","'MAX(decimal_index.value)'",92],")",",",["T_WHITESPACE","\n        ",92],")",")",";",["T_WHITESPACE","\n\n        ",93],["T_VARIABLE","$result",95],["T_WHITESPACE","     ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$adapter",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","fetchRow",95],"(",["T_VARIABLE","$select",95],")",";",["T_WHITESPACE","\n\n        ",95],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_ARRAY","array",97],"(",["T_VARIABLE","$result",97],"[",["T_CONSTANT_ENCAPSED_STRING","'min_value'",97],"]",",",["T_WHITESPACE"," ",97],["T_VARIABLE","$result",97],"[",["T_CONSTANT_ENCAPSED_STRING","'max_value'",97],"]",")",";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Retrieve clean select with joined index table\n     * Joined table has index\n     *\n     * @param Mage_Catalog_Model_Layer_Filter_Decimal $filter\n     * @return Varien_Db_Select\n     *\/",100],["T_WHITESPACE","\n    ",106],["T_PROTECTED","protected",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","_getSelect",107],"(",["T_VARIABLE","$filter",107],")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$collection",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$filter",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getLayer",109],"(",")",["T_OBJECT_OPERATOR","->",109],["T_STRING","getProductCollection",109],"(",")",";",["T_WHITESPACE","\n\n        ",109],["T_COMMENT","\/\/ clone select from collection with filters\n",111],["T_WHITESPACE","        ",112],["T_VARIABLE","$select",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_CLONE","clone",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$collection",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getSelect",112],"(",")",";",["T_WHITESPACE","\n        ",112],["T_COMMENT","\/\/ reset columns, order and limitation conditions\n",113],["T_WHITESPACE","        ",114],["T_VARIABLE","$select",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","reset",114],"(",["T_STRING","Zend_Db_Select",114],["T_DOUBLE_COLON","::",114],["T_STRING","COLUMNS",114],")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$select",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","reset",115],"(",["T_STRING","Zend_Db_Select",115],["T_DOUBLE_COLON","::",115],["T_STRING","ORDER",115],")",";",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$select",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","reset",116],"(",["T_STRING","Zend_Db_Select",116],["T_DOUBLE_COLON","::",116],["T_STRING","LIMIT_COUNT",116],")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$select",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","reset",117],"(",["T_STRING","Zend_Db_Select",117],["T_DOUBLE_COLON","::",117],["T_STRING","LIMIT_OFFSET",117],")",";",["T_WHITESPACE","\n\n        ",117],["T_VARIABLE","$attributeId",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$filter",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getAttributeModel",119],"(",")",["T_OBJECT_OPERATOR","->",119],["T_STRING","getId",119],"(",")",";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$storeId",120],["T_WHITESPACE","     ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$collection",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getStoreId",120],"(",")",";",["T_WHITESPACE","\n\n        ",120],["T_VARIABLE","$select",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","join",122],"(",["T_WHITESPACE","\n            ",122],["T_ARRAY","array",123],"(",["T_CONSTANT_ENCAPSED_STRING","'decimal_index'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getMainTable",123],"(",")",")",",",["T_WHITESPACE","\n            ",123],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = decimal_index.entity_id'",124],".",["T_WHITESPACE","\n            ",124],["T_CONSTANT_ENCAPSED_STRING","' AND '",125],["T_WHITESPACE"," ",125],".",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_getReadAdapter",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","quoteInto",125],"(",["T_CONSTANT_ENCAPSED_STRING","'decimal_index.attribute_id = ?'",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$attributeId",125],")",["T_WHITESPACE"," ",125],".",["T_WHITESPACE","\n            ",125],["T_CONSTANT_ENCAPSED_STRING","' AND '",126],["T_WHITESPACE"," ",126],".",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_getReadAdapter",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","quoteInto",126],"(",["T_CONSTANT_ENCAPSED_STRING","'decimal_index.store_id = ?'",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$storeId",126],")",",",["T_WHITESPACE","\n            ",126],["T_ARRAY","array",127],"(",")",["T_WHITESPACE","\n        ",127],")",";",["T_WHITESPACE","\n\n        ",128],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$select",130],";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Retrieve array with products counts per range\n     *\n     * @param Mage_Catalog_Model_Layer_Filter_Decimal $filter\n     * @param int $range\n     * @return array\n     *\/",133],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","getCount",140],"(",["T_VARIABLE","$filter",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$range",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$select",142],["T_WHITESPACE","     ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_getSelect",142],"(",["T_VARIABLE","$filter",142],")",";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$adapter",143],["T_WHITESPACE","    ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_getReadAdapter",143],"(",")",";",["T_WHITESPACE","\n\n        ",143],["T_VARIABLE","$countExpr",145],["T_WHITESPACE","  ",145],"=",["T_WHITESPACE"," ",145],["T_NEW","new",145],["T_WHITESPACE"," ",145],["T_STRING","Zend_Db_Expr",145],"(",["T_CONSTANT_ENCAPSED_STRING","\"COUNT(*)\"",145],")",";",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$rangeExpr",146],["T_WHITESPACE","  ",146],"=",["T_WHITESPACE"," ",146],["T_NEW","new",146],["T_WHITESPACE"," ",146],["T_STRING","Zend_Db_Expr",146],"(","\"",["T_ENCAPSED_AND_WHITESPACE","FLOOR(decimal_index.value \/ ",146],["T_CURLY_OPEN","{",146],["T_VARIABLE","$range",146],"}",["T_ENCAPSED_AND_WHITESPACE",") + 1",146],"\"",")",";",["T_WHITESPACE","\n\n        ",146],["T_VARIABLE","$select",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","columns",148],"(",["T_ARRAY","array",148],"(",["T_WHITESPACE","\n            ",148],["T_CONSTANT_ENCAPSED_STRING","'decimal_range'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$rangeExpr",149],",",["T_WHITESPACE","\n            ",149],["T_CONSTANT_ENCAPSED_STRING","'count'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$countExpr",150],["T_WHITESPACE","\n        ",150],")",")",";",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$select",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","group",152],"(",["T_VARIABLE","$rangeExpr",152],")",";",["T_WHITESPACE","\n\n        ",152],["T_RETURN","return",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$adapter",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","fetchPairs",154],"(",["T_VARIABLE","$select",154],")",";",["T_WHITESPACE","\n    ",154],"}",["T_WHITESPACE","\n",155],"}",["T_WHITESPACE","\n",156]]