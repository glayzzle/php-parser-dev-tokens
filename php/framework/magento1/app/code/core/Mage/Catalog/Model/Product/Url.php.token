[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Product Url model\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Product_Url",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Varien_Object",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","CACHE_TAG",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'url_rewrite'",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * URL instance\n     *\n     * @var Mage_Core_Model_Url\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE","  ",44],["T_VARIABLE","$_url",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * URL Rewrite Instance\n     *\n     * @var Mage_Core_Model_Url_Rewrite\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_urlRewrite",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Factory instance\n     *\n     * @var Mage_Catalog_Model_Factory\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$_factory",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * @var Mage_Core_Model_Store\n     *\/",60],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_store",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Initialize Url model\n     *\n     * @param array $args\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","__construct",70],"(",["T_ARRAY","array",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$args",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",")",")",["T_WHITESPACE","\n    ",70],"{",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_factory",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],"!",["T_EMPTY","empty",72],"(",["T_VARIABLE","$args",72],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",72],"]",")",["T_WHITESPACE"," ",72],"?",["T_WHITESPACE"," ",72],["T_VARIABLE","$args",72],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",72],"]",["T_WHITESPACE"," ",72],":",["T_WHITESPACE"," ",72],["T_STRING","Mage",72],["T_DOUBLE_COLON","::",72],["T_STRING","getSingleton",72],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/factory'",72],")",";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_store",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],"!",["T_EMPTY","empty",73],"(",["T_VARIABLE","$args",73],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",73],"]",")",["T_WHITESPACE"," ",73],"?",["T_WHITESPACE"," ",73],["T_VARIABLE","$args",73],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",73],"]",["T_WHITESPACE"," ",73],":",["T_WHITESPACE"," ",73],["T_STRING","Mage",73],["T_DOUBLE_COLON","::",73],["T_STRING","app",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getStore",73],"(",")",";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Retrieve URL Instance\n     *\n     * @return Mage_Core_Model_Url\n     *\/",76],["T_WHITESPACE","\n    ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","getUrlInstance",81],"(",")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_STRING","null",83],["T_WHITESPACE"," ",83],["T_IS_IDENTICAL","===",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_url",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_url",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","getModel",84],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/url'",84],")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n        ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_url",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Retrieve URL Rewrite Instance\n     *\n     * @return Mage_Core_Model_Url_Rewrite\n     *\/",89],["T_WHITESPACE","\n    ",93],["T_PUBLIC","public",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","getUrlRewrite",94],"(",")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_IF","if",96],["T_WHITESPACE"," ",96],"(",["T_STRING","null",96],["T_WHITESPACE"," ",96],["T_IS_IDENTICAL","===",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_urlRewrite",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n            ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_urlRewrite",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_factory",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getUrlRewriteInstance",97],"(",")",";",["T_WHITESPACE","\n        ",97],"}",["T_WHITESPACE","\n        ",98],["T_RETURN","return",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_urlRewrite",99],";",["T_WHITESPACE","\n    ",99],"}",["T_WHITESPACE","\n\n    ",100],["T_DOC_COMMENT","\/**\n     * 'no_selection' shouldn't be a valid image attribute value\n     *\n     * @param string $image\n     * @return string\n     *\/",102],["T_WHITESPACE","\n    ",107],["T_PROTECTED","protected",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","_validImage",108],"(",["T_VARIABLE","$image",108],")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_IF","if",110],"(",["T_VARIABLE","$image",110],["T_WHITESPACE"," ",110],["T_IS_EQUAL","==",110],["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'no_selection'",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$image",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","null",111],";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n        ",112],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$image",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Retrieve URL in current store\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param array $params the URL route params\n     * @return string\n     *\/",116],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","getUrlInStore",123],"(",["T_STRING","Mage_Catalog_Model_Product",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$product",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$params",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_ARRAY","array",123],"(",")",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$params",125],"[",["T_CONSTANT_ENCAPSED_STRING","'_store_to_url'",125],"]",["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","true",125],";",["T_WHITESPACE","\n        ",125],["T_RETURN","return",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getUrl",126],"(",["T_VARIABLE","$product",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$params",126],")",";",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Retrieve Product URL\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @param  bool $useSid forced SID mode\n     * @return string\n     *\/",129],["T_WHITESPACE","\n    ",135],["T_PUBLIC","public",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","getProductUrl",136],"(",["T_VARIABLE","$product",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$useSid",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","null",136],")",["T_WHITESPACE","\n    ",136],"{",["T_WHITESPACE","\n        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$useSid",138],["T_WHITESPACE"," ",138],["T_IS_IDENTICAL","===",138],["T_WHITESPACE"," ",138],["T_STRING","null",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$useSid",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","Mage",139],["T_DOUBLE_COLON","::",139],["T_STRING","app",139],"(",")",["T_OBJECT_OPERATOR","->",139],["T_STRING","getUseSessionInUrl",139],"(",")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n\n        ",140],["T_VARIABLE","$params",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_ARRAY","array",142],"(",")",";",["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(","!",["T_VARIABLE","$useSid",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$params",144],"[",["T_CONSTANT_ENCAPSED_STRING","'_nosid'",144],"]",["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","true",144],";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n\n        ",145],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getUrl",147],"(",["T_VARIABLE","$product",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$params",147],")",";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Format Key for URL\n     *\n     * @param string $str\n     * @return string\n     *\/",150],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","formatUrlKey",156],"(",["T_VARIABLE","$str",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$urlKey",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","preg_replace",158],"(",["T_CONSTANT_ENCAPSED_STRING","'#[^0-9a-z]+#i'",158],",",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","'-'",158],",",["T_WHITESPACE"," ",158],["T_STRING","Mage",158],["T_DOUBLE_COLON","::",158],["T_STRING","helper",158],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_url'",158],")",["T_OBJECT_OPERATOR","->",158],["T_STRING","format",158],"(",["T_VARIABLE","$str",158],")",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$urlKey",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","strtolower",159],"(",["T_VARIABLE","$urlKey",159],")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$urlKey",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","trim",160],"(",["T_VARIABLE","$urlKey",160],",",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'-'",160],")",";",["T_WHITESPACE","\n\n        ",160],["T_RETURN","return",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$urlKey",162],";",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n\n    ",163],["T_DOC_COMMENT","\/**\n     * Retrieve Product Url path (with category if exists)\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param Mage_Catalog_Model_Category $category\n     *\n     * @return string\n     *\/",165],["T_WHITESPACE","\n    ",172],["T_PUBLIC","public",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","getUrlPath",173],"(",["T_VARIABLE","$product",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$category",173],"=",["T_STRING","null",173],")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$path",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$product",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getData",175],"(",["T_CONSTANT_ENCAPSED_STRING","'url_path'",175],")",";",["T_WHITESPACE","\n\n        ",175],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_STRING","is_null",177],"(",["T_VARIABLE","$category",177],")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_DOC_COMMENT","\/** @todo get default category *\/",178],["T_WHITESPACE","\n            ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$path",179],";",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE"," ",180],["T_ELSEIF","elseif",180],["T_WHITESPACE"," ",180],"(","!",["T_VARIABLE","$category",180],["T_WHITESPACE"," ",180],["T_INSTANCEOF","instanceof",180],["T_WHITESPACE"," ",180],["T_STRING","Mage_Catalog_Model_Category",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_STRING","Mage",181],["T_DOUBLE_COLON","::",181],["T_STRING","throwException",181],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid category object supplied'",181],")",";",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n\n        ",182],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","helper",184],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",184],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","getCategoryUrlPath",184],"(",["T_VARIABLE","$category",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getUrlPath",184],"(",")",")",["T_WHITESPACE","\n            ",184],".",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'\/'",185],["T_WHITESPACE"," ",185],".",["T_WHITESPACE"," ",185],["T_VARIABLE","$path",185],";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Retrieve Product URL using UrlDataObject\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param array $params\n     * @return string\n     *\/",188],["T_WHITESPACE","\n    ",194],["T_PUBLIC","public",195],["T_WHITESPACE"," ",195],["T_FUNCTION","function",195],["T_WHITESPACE"," ",195],["T_STRING","getUrl",195],"(",["T_STRING","Mage_Catalog_Model_Product",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$product",195],",",["T_WHITESPACE"," ",195],["T_VARIABLE","$params",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_ARRAY","array",195],"(",")",")",["T_WHITESPACE","\n    ",195],"{",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$url",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$product",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getData",197],"(",["T_CONSTANT_ENCAPSED_STRING","'url'",197],")",";",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(","!",["T_EMPTY","empty",198],"(",["T_VARIABLE","$url",198],")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_RETURN","return",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$url",199],";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n\n        ",200],["T_VARIABLE","$requestPath",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$product",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getData",202],"(",["T_CONSTANT_ENCAPSED_STRING","'request_path'",202],")",";",["T_WHITESPACE","\n        ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(",["T_EMPTY","empty",203],"(",["T_VARIABLE","$requestPath",203],")",")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$requestPath",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_getRequestPath",204],"(",["T_VARIABLE","$product",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_getCategoryIdForUrl",204],"(",["T_VARIABLE","$product",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$params",204],")",")",";",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$product",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","setRequestPath",205],"(",["T_VARIABLE","$requestPath",205],")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n\n        ",206],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_ISSET","isset",208],"(",["T_VARIABLE","$params",208],"[",["T_CONSTANT_ENCAPSED_STRING","'_store'",208],"]",")",")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$storeId",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_getStoreId",209],"(",["T_VARIABLE","$params",209],"[",["T_CONSTANT_ENCAPSED_STRING","'_store'",209],"]",")",";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE"," ",210],["T_ELSE","else",210],["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$storeId",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$product",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getStoreId",211],"(",")",";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE","\n\n        ",212],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$storeId",214],["T_WHITESPACE"," ",214],["T_IS_NOT_EQUAL","!=",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_getStoreId",214],"(",")",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$params",215],"[",["T_CONSTANT_ENCAPSED_STRING","'_store_to_url'",215],"]",["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_STRING","true",215],";",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n\n        ",216],["T_COMMENT","\/\/ reset cached URL instance GET query params\n",218],["T_WHITESPACE","        ",219],["T_IF","if",219],["T_WHITESPACE"," ",219],"(","!",["T_ISSET","isset",219],"(",["T_VARIABLE","$params",219],"[",["T_CONSTANT_ENCAPSED_STRING","'_query'",219],"]",")",")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$params",220],"[",["T_CONSTANT_ENCAPSED_STRING","'_query'",220],"]",["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_ARRAY","array",220],"(",")",";",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n\n        ",221],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getUrlInstance",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","setStore",223],"(",["T_VARIABLE","$storeId",223],")",";",["T_WHITESPACE","\n        ",223],["T_VARIABLE","$productUrl",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_getProductUrl",224],"(",["T_VARIABLE","$product",224],",",["T_WHITESPACE"," ",224],["T_VARIABLE","$requestPath",224],",",["T_WHITESPACE"," ",224],["T_VARIABLE","$params",224],")",";",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$product",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","setData",225],"(",["T_CONSTANT_ENCAPSED_STRING","'url'",225],",",["T_WHITESPACE"," ",225],["T_VARIABLE","$productUrl",225],")",";",["T_WHITESPACE","\n        ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$product",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getData",226],"(",["T_CONSTANT_ENCAPSED_STRING","'url'",226],")",";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_DOC_COMMENT","\/**\n     * Returns checked store_id value\n     *\n     * @param int|null $id\n     * @return int\n     *\/",229],["T_WHITESPACE","\n    ",234],["T_PROTECTED","protected",235],["T_WHITESPACE"," ",235],["T_FUNCTION","function",235],["T_WHITESPACE"," ",235],["T_STRING","_getStoreId",235],"(",["T_VARIABLE","$id",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_STRING","null",235],")",["T_WHITESPACE","\n    ",235],"{",["T_WHITESPACE","\n        ",236],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_STRING","Mage",237],["T_DOUBLE_COLON","::",237],["T_STRING","app",237],"(",")",["T_OBJECT_OPERATOR","->",237],["T_STRING","getStore",237],"(",["T_VARIABLE","$id",237],")",["T_OBJECT_OPERATOR","->",237],["T_STRING","getId",237],"(",")",";",["T_WHITESPACE","\n    ",237],"}",["T_WHITESPACE","\n\n    ",238],["T_DOC_COMMENT","\/**\n     * Check product category\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param array $params\n     *\n     * @return int|null\n     *\/",240],["T_WHITESPACE","\n    ",247],["T_PROTECTED","protected",248],["T_WHITESPACE"," ",248],["T_FUNCTION","function",248],["T_WHITESPACE"," ",248],["T_STRING","_getCategoryIdForUrl",248],"(",["T_VARIABLE","$product",248],",",["T_WHITESPACE"," ",248],["T_VARIABLE","$params",248],")",["T_WHITESPACE","\n    ",248],"{",["T_WHITESPACE","\n        ",249],["T_IF","if",250],["T_WHITESPACE"," ",250],"(",["T_ISSET","isset",250],"(",["T_VARIABLE","$params",250],"[",["T_CONSTANT_ENCAPSED_STRING","'_ignore_category'",250],"]",")",")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n            ",250],["T_RETURN","return",251],["T_WHITESPACE"," ",251],["T_STRING","null",251],";",["T_WHITESPACE","\n        ",251],"}",["T_WHITESPACE"," ",252],["T_ELSE","else",252],["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n            ",252],["T_RETURN","return",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$product",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getCategoryId",253],"(",")",["T_WHITESPACE"," ",253],["T_BOOLEAN_AND","&&",253],["T_WHITESPACE"," ",253],"!",["T_VARIABLE","$product",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getDoNotUseCategoryId",253],"(",")",["T_WHITESPACE","\n                ",253],"?",["T_WHITESPACE"," ",254],["T_VARIABLE","$product",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getCategoryId",254],"(",")",["T_WHITESPACE"," ",254],":",["T_WHITESPACE"," ",254],["T_STRING","null",254],";",["T_WHITESPACE","\n        ",254],"}",["T_WHITESPACE","\n    ",255],"}",["T_WHITESPACE","\n\n    ",256],["T_DOC_COMMENT","\/**\n     * Retrieve product URL based on requestPath param\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param string $requestPath\n     * @param array $routeParams\n     *\n     * @return string\n     *\/",258],["T_WHITESPACE","\n    ",266],["T_PROTECTED","protected",267],["T_WHITESPACE"," ",267],["T_FUNCTION","function",267],["T_WHITESPACE"," ",267],["T_STRING","_getProductUrl",267],"(",["T_VARIABLE","$product",267],",",["T_WHITESPACE"," ",267],["T_VARIABLE","$requestPath",267],",",["T_WHITESPACE"," ",267],["T_VARIABLE","$routeParams",267],")",["T_WHITESPACE","\n    ",267],"{",["T_WHITESPACE","\n        ",268],["T_IF","if",269],["T_WHITESPACE"," ",269],"(","!",["T_EMPTY","empty",269],"(",["T_VARIABLE","$requestPath",269],")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_RETURN","return",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getUrlInstance",270],"(",")",["T_OBJECT_OPERATOR","->",270],["T_STRING","getDirectUrl",270],"(",["T_VARIABLE","$requestPath",270],",",["T_WHITESPACE"," ",270],["T_VARIABLE","$routeParams",270],")",";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$routeParams",272],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",272],"]",["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$product",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getId",272],"(",")",";",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$routeParams",273],"[",["T_CONSTANT_ENCAPSED_STRING","'s'",273],"]",["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$product",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getUrlKey",273],"(",")",";",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$categoryId",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_getCategoryIdForUrl",274],"(",["T_VARIABLE","$product",274],",",["T_WHITESPACE"," ",274],["T_VARIABLE","$routeParams",274],")",";",["T_WHITESPACE","\n        ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$categoryId",275],")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$routeParams",276],"[",["T_CONSTANT_ENCAPSED_STRING","'category'",276],"]",["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$categoryId",276],";",["T_WHITESPACE","\n        ",276],"}",["T_WHITESPACE","\n        ",277],["T_RETURN","return",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getUrlInstance",278],"(",")",["T_OBJECT_OPERATOR","->",278],["T_STRING","getUrl",278],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product\/view'",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$routeParams",278],")",";",["T_WHITESPACE","\n    ",278],"}",["T_WHITESPACE","\n\n    ",279],["T_DOC_COMMENT","\/**\n     * Retrieve request path\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param int $categoryId\n     * @return bool|string\n     *\/",281],["T_WHITESPACE","\n    ",287],["T_PROTECTED","protected",288],["T_WHITESPACE"," ",288],["T_FUNCTION","function",288],["T_WHITESPACE"," ",288],["T_STRING","_getRequestPath",288],"(",["T_VARIABLE","$product",288],",",["T_WHITESPACE"," ",288],["T_VARIABLE","$categoryId",288],")",["T_WHITESPACE","\n    ",288],"{",["T_WHITESPACE","\n        ",289],["T_VARIABLE","$idPath",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","sprintf",290],"(",["T_CONSTANT_ENCAPSED_STRING","'product\/%d'",290],",",["T_WHITESPACE"," ",290],["T_VARIABLE","$product",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getEntityId",290],"(",")",")",";",["T_WHITESPACE","\n        ",290],["T_IF","if",291],["T_WHITESPACE"," ",291],"(",["T_VARIABLE","$categoryId",291],")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$idPath",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_STRING","sprintf",292],"(",["T_CONSTANT_ENCAPSED_STRING","'%s\/%d'",292],",",["T_WHITESPACE"," ",292],["T_VARIABLE","$idPath",292],",",["T_WHITESPACE"," ",292],["T_VARIABLE","$categoryId",292],")",";",["T_WHITESPACE","\n        ",292],"}",["T_WHITESPACE","\n        ",293],["T_VARIABLE","$rewrite",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getUrlRewrite",294],"(",")",";",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$rewrite",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","setStoreId",295],"(",["T_VARIABLE","$product",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getStoreId",295],"(",")",")",["T_WHITESPACE","\n            ",295],["T_OBJECT_OPERATOR","->",296],["T_STRING","loadByIdPath",296],"(",["T_VARIABLE","$idPath",296],")",";",["T_WHITESPACE","\n        ",296],["T_IF","if",297],["T_WHITESPACE"," ",297],"(",["T_VARIABLE","$rewrite",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getId",297],"(",")",")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n            ",297],["T_RETURN","return",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$rewrite",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getRequestPath",298],"(",")",";",["T_WHITESPACE","\n        ",298],"}",["T_WHITESPACE","\n\n        ",299],["T_RETURN","return",301],["T_WHITESPACE"," ",301],["T_STRING","false",301],";",["T_WHITESPACE","\n    ",301],"}",["T_WHITESPACE","\n",302],"}",["T_WHITESPACE","\n",303]]