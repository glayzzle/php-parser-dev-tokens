[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Configurable Products Price Indexer Resource model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Price_Configurable",35],["T_WHITESPACE","\n    ",35],["T_EXTENDS","extends",36],["T_WHITESPACE"," ",36],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Price_Default",36],["T_WHITESPACE","\n",36],"{",["T_WHITESPACE","\n    ",37],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for all products\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Configurable\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PUBLIC","public",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","reindexAll",43],"(",")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","useIdxTable",45],"(",["T_STRING","true",45],")",";",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","beginTransaction",46],"(",")",";",["T_WHITESPACE","\n        ",46],["T_TRY","try",47],["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n            ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","_prepareFinalPriceData",48],"(",")",";",["T_WHITESPACE","\n            ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_applyCustomOption",49],"(",")",";",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_applyConfigurableOption",50],"(",")",";",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_movePriceDataToIndexTable",51],"(",")",";",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","commit",52],"(",")",";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE"," ",53],["T_CATCH","catch",53],["T_WHITESPACE"," ",53],"(",["T_STRING","Exception",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$e",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","rollBack",54],"(",")",";",["T_WHITESPACE","\n            ",54],["T_THROW","throw",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$e",55],";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n        ",56],["T_RETURN","return",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for defined product(s)\n     *\n     * @param int|array $entityIds\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Configurable\n     *\/",60],["T_WHITESPACE","\n    ",65],["T_PUBLIC","public",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","reindexEntity",66],"(",["T_VARIABLE","$entityIds",66],")",["T_WHITESPACE","\n    ",66],"{",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_prepareFinalPriceData",68],"(",["T_VARIABLE","$entityIds",68],")",";",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_applyCustomOption",69],"(",")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_applyConfigurableOption",70],"(",")",";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_movePriceDataToIndexTable",71],"(",")",";",["T_WHITESPACE","\n\n        ",71],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Retrieve table name for custom option temporary aggregation data\n     *\n     * @return string\n     *\/",76],["T_WHITESPACE","\n    ",80],["T_PROTECTED","protected",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","_getConfigurableOptionAggregateTable",81],"(",")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","useIdxTable",83],"(",")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_RETURN","return",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getTable",84],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_cfg_option_aggregate_idx'",84],")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n        ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getTable",86],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_cfg_option_aggregate_tmp'",86],")",";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Retrieve table name for custom option prices data\n     *\n     * @return string\n     *\/",89],["T_WHITESPACE","\n    ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","_getConfigurableOptionPriceTable",94],"(",")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_IF","if",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","useIdxTable",96],"(",")",")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n            ",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getTable",97],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_cfg_option_idx'",97],")",";",["T_WHITESPACE","\n        ",97],"}",["T_WHITESPACE","\n        ",98],["T_RETURN","return",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getTable",99],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_price_indexer_cfg_option_tmp'",99],")",";",["T_WHITESPACE","\n    ",99],"}",["T_WHITESPACE","\n\n    ",100],["T_DOC_COMMENT","\/**\n     * Prepare table structure for custom option temporary aggregation data\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Configurable\n     *\/",102],["T_WHITESPACE","\n    ",106],["T_PROTECTED","protected",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","_prepareConfigurableOptionAggregateTable",107],"(",")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_getWriteAdapter",109],"(",")",["T_OBJECT_OPERATOR","->",109],["T_STRING","delete",109],"(",["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_getConfigurableOptionAggregateTable",109],"(",")",")",";",["T_WHITESPACE","\n        ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Prepare table structure for custom option prices data\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Configurable\n     *\/",113],["T_WHITESPACE","\n    ",117],["T_PROTECTED","protected",118],["T_WHITESPACE"," ",118],["T_FUNCTION","function",118],["T_WHITESPACE"," ",118],["T_STRING","_prepareConfigurableOptionPriceTable",118],"(",")",["T_WHITESPACE","\n    ",118],"{",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_getWriteAdapter",120],"(",")",["T_OBJECT_OPERATOR","->",120],["T_STRING","delete",120],"(",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_getConfigurableOptionPriceTable",120],"(",")",")",";",["T_WHITESPACE","\n        ",120],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Calculate minimal and maximal prices for configurable product options\n     * and apply it to final price\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Price_Configurable\n     *\/",124],["T_WHITESPACE","\n    ",129],["T_PROTECTED","protected",130],["T_WHITESPACE"," ",130],["T_FUNCTION","function",130],["T_WHITESPACE"," ",130],["T_STRING","_applyConfigurableOption",130],"(",")",["T_WHITESPACE","\n    ",130],"{",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$write",132],["T_WHITESPACE","      ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_getWriteAdapter",132],"(",")",";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$coaTable",133],["T_WHITESPACE","   ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_getConfigurableOptionAggregateTable",133],"(",")",";",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$copTable",134],["T_WHITESPACE","   ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_getConfigurableOptionPriceTable",134],"(",")",";",["T_WHITESPACE","\n\n        ",134],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_prepareConfigurableOptionAggregateTable",136],"(",")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_prepareConfigurableOptionPriceTable",137],"(",")",";",["T_WHITESPACE","\n\n        ",137],["T_VARIABLE","$select",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$write",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","select",139],"(",")",["T_WHITESPACE","\n            ",139],["T_OBJECT_OPERATOR","->",140],["T_STRING","from",140],"(",["T_ARRAY","array",140],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",140],["T_WHITESPACE"," ",140],["T_DOUBLE_ARROW","=>",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_getDefaultFinalPriceTable",140],"(",")",")",",",["T_WHITESPACE"," ",140],["T_ARRAY","array",140],"(",")",")",["T_WHITESPACE","\n            ",140],["T_OBJECT_OPERATOR","->",141],["T_STRING","join",141],"(",["T_WHITESPACE","\n                ",141],["T_ARRAY","array",142],"(",["T_CONSTANT_ENCAPSED_STRING","'l'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getTable",142],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_super_link'",142],")",")",",",["T_WHITESPACE","\n                ",142],["T_CONSTANT_ENCAPSED_STRING","'l.parent_id = i.entity_id'",143],",",["T_WHITESPACE","\n                ",143],["T_ARRAY","array",144],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",144],",",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'product_id'",144],")",")",["T_WHITESPACE","\n            ",144],["T_OBJECT_OPERATOR","->",145],["T_STRING","columns",145],"(",["T_ARRAY","array",145],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",145],",",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'website_id'",145],")",",",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'i'",145],")",["T_WHITESPACE","\n            ",145],["T_OBJECT_OPERATOR","->",146],["T_STRING","join",146],"(",["T_WHITESPACE","\n                ",146],["T_ARRAY","array",147],"(",["T_CONSTANT_ENCAPSED_STRING","'a'",147],["T_WHITESPACE"," ",147],["T_DOUBLE_ARROW","=>",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getTable",147],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_super_attribute'",147],")",")",",",["T_WHITESPACE","\n                ",147],["T_CONSTANT_ENCAPSED_STRING","'l.parent_id = a.product_id'",148],",",["T_WHITESPACE","\n                ",148],["T_ARRAY","array",149],"(",")",")",["T_WHITESPACE","\n            ",149],["T_OBJECT_OPERATOR","->",150],["T_STRING","join",150],"(",["T_WHITESPACE","\n                ",150],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getValueTable",151],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",151],",",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'int'",151],")",")",",",["T_WHITESPACE","\n                ",151],["T_CONSTANT_ENCAPSED_STRING","'l.product_id = cp.entity_id AND cp.attribute_id = a.attribute_id AND cp.store_id = 0'",152],",",["T_WHITESPACE","\n                ",152],["T_ARRAY","array",153],"(",")",")",["T_WHITESPACE","\n            ",153],["T_OBJECT_OPERATOR","->",154],["T_STRING","joinLeft",154],"(",["T_WHITESPACE","\n                ",154],["T_ARRAY","array",155],"(",["T_CONSTANT_ENCAPSED_STRING","'apd'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getTable",155],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_super_attribute_pricing'",155],")",")",",",["T_WHITESPACE","\n                ",155],["T_CONSTANT_ENCAPSED_STRING","'a.product_super_attribute_id = apd.product_super_attribute_id'",156],["T_WHITESPACE","\n                    ",156],".",["T_WHITESPACE"," ",157],["T_CONSTANT_ENCAPSED_STRING","' AND apd.website_id = 0 AND cp.value = apd.value_index'",157],",",["T_WHITESPACE","\n                ",157],["T_ARRAY","array",158],"(",")",")",["T_WHITESPACE","\n            ",158],["T_OBJECT_OPERATOR","->",159],["T_STRING","joinLeft",159],"(",["T_WHITESPACE","\n                ",159],["T_ARRAY","array",160],"(",["T_CONSTANT_ENCAPSED_STRING","'apw'",160],["T_WHITESPACE"," ",160],["T_DOUBLE_ARROW","=>",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getTable",160],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_super_attribute_pricing'",160],")",")",",",["T_WHITESPACE","\n                ",160],["T_CONSTANT_ENCAPSED_STRING","'a.product_super_attribute_id = apw.product_super_attribute_id'",161],["T_WHITESPACE","\n                    ",161],".",["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","' AND apw.website_id = i.website_id AND cp.value = apw.value_index'",162],",",["T_WHITESPACE","\n                ",162],["T_ARRAY","array",163],"(",")",")",["T_WHITESPACE","\n            ",163],["T_OBJECT_OPERATOR","->",164],["T_STRING","join",164],"(",["T_WHITESPACE","\n                ",164],["T_ARRAY","array",165],"(",["T_CONSTANT_ENCAPSED_STRING","'le'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getTable",165],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",165],")",")",",",["T_WHITESPACE","\n                ",165],["T_CONSTANT_ENCAPSED_STRING","'le.entity_id = l.product_id'",166],",",["T_WHITESPACE","\n                ",166],["T_ARRAY","array",167],"(",")",")",["T_WHITESPACE","\n            ",167],["T_OBJECT_OPERATOR","->",168],["T_STRING","where",168],"(",["T_CONSTANT_ENCAPSED_STRING","'le.required_options=0'",168],")",["T_WHITESPACE","\n            ",168],["T_OBJECT_OPERATOR","->",169],["T_STRING","group",169],"(",["T_ARRAY","array",169],"(",["T_CONSTANT_ENCAPSED_STRING","'l.parent_id'",169],",",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'i.customer_group_id'",169],",",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'i.website_id'",169],",",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'l.product_id'",169],")",")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_addWebsiteJoinToSelect",170],"(",["T_VARIABLE","$select",170],",",["T_WHITESPACE"," ",170],["T_STRING","true",170],")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_addProductWebsiteJoinToSelect",171],"(",["T_VARIABLE","$select",171],",",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",171],",",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'le.entity_id'",171],")",";",["T_WHITESPACE","\n\n        ",171],["T_VARIABLE","$priceExpression",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$write",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getCheckSql",173],"(",["T_CONSTANT_ENCAPSED_STRING","'apw.value_id IS NOT NULL'",173],",",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'apw.pricing_value'",173],",",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'apd.pricing_value'",173],")",";",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$percentExpr",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$write",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getCheckSql",174],"(",["T_CONSTANT_ENCAPSED_STRING","'apw.value_id IS NOT NULL'",174],",",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","'apw.is_percent'",174],",",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","'apd.is_percent'",174],")",";",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$roundExpr",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],"\"",["T_ENCAPSED_AND_WHITESPACE","ROUND(i.price * (",175],["T_CURLY_OPEN","{",175],["T_VARIABLE","$priceExpression",175],"}",["T_ENCAPSED_AND_WHITESPACE"," \/ 100), 4)",175],"\"",";",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$roundPriceExpr",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$write",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getCheckSql",176],"(","\"",["T_CURLY_OPEN","{",176],["T_VARIABLE","$percentExpr",176],"}",["T_ENCAPSED_AND_WHITESPACE"," = 1",176],"\"",",",["T_WHITESPACE"," ",176],["T_VARIABLE","$roundExpr",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$priceExpression",176],")",";",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$priceColumn",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$write",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getCheckSql",177],"(","\"",["T_CURLY_OPEN","{",177],["T_VARIABLE","$priceExpression",177],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NULL",177],"\"",",",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","'0'",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$roundPriceExpr",177],")",";",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$priceColumn",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_NEW","new",178],["T_WHITESPACE"," ",178],["T_STRING","Zend_Db_Expr",178],"(","\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",178],["T_CURLY_OPEN","{",178],["T_VARIABLE","$priceColumn",178],"}",["T_ENCAPSED_AND_WHITESPACE",")",178],"\"",")",";",["T_WHITESPACE","\n\n        ",178],["T_VARIABLE","$tierPrice",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$priceExpression",180],";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$tierRoundPriceExp",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$write",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getCheckSql",181],"(","\"",["T_CURLY_OPEN","{",181],["T_VARIABLE","$percentExpr",181],"}",["T_ENCAPSED_AND_WHITESPACE"," = 1",181],"\"",",",["T_WHITESPACE"," ",181],["T_VARIABLE","$roundExpr",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$tierPrice",181],")",";",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$tierPriceExp",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$write",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getCheckSql",182],"(","\"",["T_CURLY_OPEN","{",182],["T_VARIABLE","$tierPrice",182],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NULL",182],"\"",",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'0'",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$tierRoundPriceExp",182],")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$tierPriceColumn",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$write",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getCheckSql",183],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(i.tier_price) IS NOT NULL\"",183],",",["T_WHITESPACE"," ",183],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",183],["T_CURLY_OPEN","{",183],["T_VARIABLE","$tierPriceExp",183],"}",["T_ENCAPSED_AND_WHITESPACE",")",183],"\"",",",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'NULL'",183],")",";",["T_WHITESPACE","\n\n        ",183],["T_VARIABLE","$groupPrice",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$priceExpression",185],";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$groupRoundPriceExp",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$write",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getCheckSql",186],"(","\"",["T_CURLY_OPEN","{",186],["T_VARIABLE","$percentExpr",186],"}",["T_ENCAPSED_AND_WHITESPACE"," = 1",186],"\"",",",["T_WHITESPACE"," ",186],["T_VARIABLE","$roundExpr",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$groupPrice",186],")",";",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$groupPriceExp",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$write",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getCheckSql",187],"(","\"",["T_CURLY_OPEN","{",187],["T_VARIABLE","$groupPrice",187],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NULL",187],"\"",",",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'0'",187],",",["T_WHITESPACE"," ",187],["T_VARIABLE","$groupRoundPriceExp",187],")",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$groupPriceColumn",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$write",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getCheckSql",188],"(",["T_CONSTANT_ENCAPSED_STRING","\"MIN(i.group_price) IS NOT NULL\"",188],",",["T_WHITESPACE"," ",188],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",188],["T_CURLY_OPEN","{",188],["T_VARIABLE","$groupPriceExp",188],"}",["T_ENCAPSED_AND_WHITESPACE",")",188],"\"",",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'NULL'",188],")",";",["T_WHITESPACE","\n\n        ",188],["T_VARIABLE","$select",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","columns",190],"(",["T_ARRAY","array",190],"(",["T_WHITESPACE","\n            ",190],["T_CONSTANT_ENCAPSED_STRING","'price'",191],["T_WHITESPACE","       ",191],["T_DOUBLE_ARROW","=>",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$priceColumn",191],",",["T_WHITESPACE","\n            ",191],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",192],["T_WHITESPACE","  ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$tierPriceColumn",192],",",["T_WHITESPACE","\n            ",192],["T_CONSTANT_ENCAPSED_STRING","'group_price'",193],["T_WHITESPACE"," ",193],["T_DOUBLE_ARROW","=>",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$groupPriceColumn",193],",",["T_WHITESPACE","\n        ",193],")",")",";",["T_WHITESPACE","\n\n        ",194],["T_VARIABLE","$statusCond",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_VARIABLE","$write",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","quoteInto",196],"(",["T_CONSTANT_ENCAPSED_STRING","' = ?'",196],",",["T_WHITESPACE"," ",196],["T_STRING","Mage_Catalog_Model_Product_Status",196],["T_DOUBLE_COLON","::",196],["T_STRING","STATUS_ENABLED",196],")",";",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_addAttributeToSelect",197],"(",["T_VARIABLE","$select",197],",",["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","'status'",197],",",["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","'le.entity_id'",197],",",["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$statusCond",197],")",";",["T_WHITESPACE","\n\n        ",197],["T_VARIABLE","$query",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$select",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","insertFromSelect",199],"(",["T_VARIABLE","$coaTable",199],")",";",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$write",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","query",200],"(",["T_VARIABLE","$query",200],")",";",["T_WHITESPACE","\n\n        ",200],["T_VARIABLE","$select",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$write",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","select",202],"(",")",["T_WHITESPACE","\n            ",202],["T_OBJECT_OPERATOR","->",203],["T_STRING","from",203],"(",["T_WHITESPACE","\n                ",203],["T_ARRAY","array",204],"(",["T_VARIABLE","$coaTable",204],")",",",["T_WHITESPACE","\n                ",204],["T_ARRAY","array",205],"(",["T_WHITESPACE","\n                    ",205],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",206],",",["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",206],",",["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'website_id'",206],",",["T_WHITESPACE","\n                    ",206],["T_CONSTANT_ENCAPSED_STRING","'MIN(price)'",207],",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'MAX(price)'",207],",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'MIN(tier_price)'",207],",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'MIN(group_price)'",207],["T_WHITESPACE","\n                ",207],")",")",["T_WHITESPACE","\n            ",208],["T_OBJECT_OPERATOR","->",209],["T_STRING","group",209],"(",["T_ARRAY","array",209],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",209],",",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",209],",",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'website_id'",209],")",")",";",["T_WHITESPACE","\n\n        ",209],["T_VARIABLE","$query",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$select",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","insertFromSelect",211],"(",["T_VARIABLE","$copTable",211],")",";",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$write",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","query",212],"(",["T_VARIABLE","$query",212],")",";",["T_WHITESPACE","\n\n        ",212],["T_VARIABLE","$table",214],["T_WHITESPACE","  ",214],"=",["T_WHITESPACE"," ",214],["T_ARRAY","array",214],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",214],["T_WHITESPACE"," ",214],["T_DOUBLE_ARROW","=>",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_getDefaultFinalPriceTable",214],"(",")",")",";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$select",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$write",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","select",215],"(",")",["T_WHITESPACE","\n            ",215],["T_OBJECT_OPERATOR","->",216],["T_STRING","join",216],"(",["T_WHITESPACE","\n                ",216],["T_ARRAY","array",217],"(",["T_CONSTANT_ENCAPSED_STRING","'io'",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$copTable",217],")",",",["T_WHITESPACE","\n                ",217],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id = io.entity_id AND i.customer_group_id = io.customer_group_id'",218],["T_WHITESPACE","\n                    ",218],".",["T_CONSTANT_ENCAPSED_STRING","' AND i.website_id = io.website_id'",219],",",["T_WHITESPACE","\n                ",219],["T_ARRAY","array",220],"(",")",")",";",["T_WHITESPACE","\n        ",220],["T_VARIABLE","$select",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","columns",221],"(",["T_ARRAY","array",221],"(",["T_WHITESPACE","\n            ",221],["T_CONSTANT_ENCAPSED_STRING","'min_price'",222],["T_WHITESPACE","   ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_NEW","new",222],["T_WHITESPACE"," ",222],["T_STRING","Zend_Db_Expr",222],"(",["T_CONSTANT_ENCAPSED_STRING","'i.min_price + io.min_price'",222],")",",",["T_WHITESPACE","\n            ",222],["T_CONSTANT_ENCAPSED_STRING","'max_price'",223],["T_WHITESPACE","   ",223],["T_DOUBLE_ARROW","=>",223],["T_WHITESPACE"," ",223],["T_NEW","new",223],["T_WHITESPACE"," ",223],["T_STRING","Zend_Db_Expr",223],"(",["T_CONSTANT_ENCAPSED_STRING","'i.max_price + io.max_price'",223],")",",",["T_WHITESPACE","\n            ",223],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",224],["T_WHITESPACE","  ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$write",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getCheckSql",224],"(",["T_CONSTANT_ENCAPSED_STRING","'i.tier_price IS NOT NULL'",224],",",["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'i.tier_price + io.tier_price'",224],",",["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","'NULL'",224],")",",",["T_WHITESPACE","\n            ",224],["T_CONSTANT_ENCAPSED_STRING","'group_price'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$write",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getCheckSql",225],"(",["T_WHITESPACE","\n                ",225],["T_CONSTANT_ENCAPSED_STRING","'i.group_price IS NOT NULL'",226],",",["T_WHITESPACE","\n                ",226],["T_CONSTANT_ENCAPSED_STRING","'i.group_price + io.group_price'",227],",",["T_WHITESPACE"," ",227],["T_CONSTANT_ENCAPSED_STRING","'NULL'",227],["T_WHITESPACE","\n            ",227],")",",",["T_WHITESPACE","\n        ",228],")",")",";",["T_WHITESPACE","\n\n        ",229],["T_VARIABLE","$query",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$select",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","crossUpdateFromSelect",231],"(",["T_VARIABLE","$table",231],")",";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$write",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","query",232],"(",["T_VARIABLE","$query",232],")",";",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$select",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$write",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","select",234],"(",")",["T_WHITESPACE","\n            ",234],["T_OBJECT_OPERATOR","->",235],["T_STRING","from",235],"(",["T_VARIABLE","$table",235],")",["T_WHITESPACE","\n            ",235],["T_OBJECT_OPERATOR","->",236],["T_STRING","join",236],"(",["T_WHITESPACE","\n                ",236],["T_ARRAY","array",237],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",237],["T_WHITESPACE"," ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getTable",237],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",237],")",")",",",["T_WHITESPACE","\n                ",237],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = i.entity_id'",238],",",["T_WHITESPACE","\n                ",238],["T_ARRAY","array",239],"(",")",")",["T_WHITESPACE","\n            ",239],["T_OBJECT_OPERATOR","->",240],["T_STRING","joinLeft",240],"(",["T_WHITESPACE","\n                ",240],["T_ARRAY","array",241],"(",["T_CONSTANT_ENCAPSED_STRING","'coa'",241],["T_WHITESPACE"," ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$coaTable",241],")",",",["T_WHITESPACE","\n                ",241],["T_CONSTANT_ENCAPSED_STRING","'coa.parent_id = i.entity_id'",242],",",["T_WHITESPACE","\n                ",242],["T_ARRAY","array",243],"(",")",")",["T_WHITESPACE","\n            ",243],["T_OBJECT_OPERATOR","->",244],["T_STRING","where",244],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id = ?'",244],",",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getTypeId",244],"(",")",")",["T_WHITESPACE","\n            ",244],["T_OBJECT_OPERATOR","->",245],["T_STRING","where",245],"(",["T_CONSTANT_ENCAPSED_STRING","'coa.parent_id IS NULL'",245],")",";",["T_WHITESPACE","\n\n        ",245],["T_VARIABLE","$query",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$select",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","deleteFromSelect",247],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",247],")",";",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$write",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","query",248],"(",["T_VARIABLE","$query",248],")",";",["T_WHITESPACE","\n\n        ",248],["T_VARIABLE","$write",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","delete",250],"(",["T_VARIABLE","$coaTable",250],")",";",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$write",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","delete",251],"(",["T_VARIABLE","$copTable",251],")",";",["T_WHITESPACE","\n\n        ",251],["T_RETURN","return",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],";",["T_WHITESPACE","\n    ",253],"}",["T_WHITESPACE","\n",254],"}",["T_WHITESPACE","\n",255]]