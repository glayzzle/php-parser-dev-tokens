[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog product link model\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Image",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_width",36],";",["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_height",37],";",["T_WHITESPACE","\n    ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$_quality",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_LNUMBER","90",38],";",["T_WHITESPACE","\n\n    ",38],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_keepAspectRatio",40],["T_WHITESPACE","  ",40],"=",["T_WHITESPACE"," ",40],["T_STRING","true",40],";",["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_keepFrame",41],["T_WHITESPACE","        ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","true",41],";",["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_keepTransparency",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","true",42],";",["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_constrainOnly",43],["T_WHITESPACE","    ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","false",43],";",["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_backgroundColor",44],["T_WHITESPACE","  ",44],"=",["T_WHITESPACE"," ",44],["T_ARRAY","array",44],"(",["T_LNUMBER","255",44],",",["T_WHITESPACE"," ",44],["T_LNUMBER","255",44],",",["T_WHITESPACE"," ",44],["T_LNUMBER","255",44],")",";",["T_WHITESPACE","\n\n    ",44],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$_baseFile",46],";",["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$_isBaseFilePlaceholder",47],";",["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_newFile",48],";",["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_processor",49],";",["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$_destinationSubdir",50],";",["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_angle",51],";",["T_WHITESPACE","\n\n    ",51],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$_watermarkFile",53],";",["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_watermarkPosition",54],";",["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_watermarkWidth",55],";",["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_watermarkHeigth",56],";",["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$_watermarkImageOpacity",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_LNUMBER","70",57],";",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",59],["T_WHITESPACE","\n    ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","setWidth",62],"(",["T_VARIABLE","$width",62],")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_width",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$width",64],";",["T_WHITESPACE","\n        ",64],["T_RETURN","return",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","getWidth",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_RETURN","return",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_width",70],";",["T_WHITESPACE","\n    ",70],"}",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",73],["T_WHITESPACE","\n    ",75],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","setHeight",76],"(",["T_VARIABLE","$height",76],")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_height",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$height",78],";",["T_WHITESPACE","\n        ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","getHeight",82],"(",")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_RETURN","return",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_height",84],";",["T_WHITESPACE","\n    ",84],"}",["T_WHITESPACE","\n\n    ",85],["T_DOC_COMMENT","\/**\n     * Set image quality, values in percentage from 0 to 100\n     *\n     * @param int $quality\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",87],["T_WHITESPACE","\n    ",92],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","setQuality",93],"(",["T_VARIABLE","$quality",93],")",["T_WHITESPACE","\n    ",93],"{",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_quality",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$quality",95],";",["T_WHITESPACE","\n        ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Get image quality\n     *\n     * @return int\n     *\/",99],["T_WHITESPACE","\n    ",103],["T_PUBLIC","public",104],["T_WHITESPACE"," ",104],["T_FUNCTION","function",104],["T_WHITESPACE"," ",104],["T_STRING","getQuality",104],"(",")",["T_WHITESPACE","\n    ",104],"{",["T_WHITESPACE","\n        ",105],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_quality",106],";",["T_WHITESPACE","\n    ",106],"}",["T_WHITESPACE","\n\n    ",107],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",109],["T_WHITESPACE","\n    ",111],["T_PUBLIC","public",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","setKeepAspectRatio",112],"(",["T_VARIABLE","$keep",112],")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_keepAspectRatio",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_BOOL_CAST","(bool)",114],["T_VARIABLE","$keep",114],";",["T_WHITESPACE","\n        ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",118],["T_WHITESPACE","\n    ",120],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","setKeepFrame",121],"(",["T_VARIABLE","$keep",121],")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_keepFrame",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_BOOL_CAST","(bool)",123],["T_VARIABLE","$keep",123],";",["T_WHITESPACE","\n        ",123],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",127],["T_WHITESPACE","\n    ",129],["T_PUBLIC","public",130],["T_WHITESPACE"," ",130],["T_FUNCTION","function",130],["T_WHITESPACE"," ",130],["T_STRING","setKeepTransparency",130],"(",["T_VARIABLE","$keep",130],")",["T_WHITESPACE","\n    ",130],"{",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_keepTransparency",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_BOOL_CAST","(bool)",132],["T_VARIABLE","$keep",132],";",["T_WHITESPACE","\n        ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",136],["T_WHITESPACE","\n    ",138],["T_PUBLIC","public",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","setConstrainOnly",139],"(",["T_VARIABLE","$flag",139],")",["T_WHITESPACE","\n    ",139],"{",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_constrainOnly",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_BOOL_CAST","(bool)",141],["T_VARIABLE","$flag",141],";",["T_WHITESPACE","\n        ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",145],["T_WHITESPACE","\n    ",147],["T_PUBLIC","public",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","setBackgroundColor",148],"(",["T_ARRAY","array",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$rgbArray",148],")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_backgroundColor",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$rgbArray",150],";",["T_WHITESPACE","\n        ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",154],["T_WHITESPACE","\n    ",156],["T_PUBLIC","public",157],["T_WHITESPACE"," ",157],["T_FUNCTION","function",157],["T_WHITESPACE"," ",157],["T_STRING","setSize",157],"(",["T_VARIABLE","$size",157],")",["T_WHITESPACE","\n    ",157],"{",["T_WHITESPACE","\n        ",158],["T_COMMENT","\/\/ determine width and height from string\n",159],["T_WHITESPACE","        ",160],["T_LIST","list",160],"(",["T_VARIABLE","$width",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$height",160],")",["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","explode",160],"(",["T_CONSTANT_ENCAPSED_STRING","'x'",160],",",["T_WHITESPACE"," ",160],["T_STRING","strtolower",160],"(",["T_VARIABLE","$size",160],")",",",["T_WHITESPACE"," ",160],["T_LNUMBER","2",160],")",";",["T_WHITESPACE","\n        ",160],["T_FOREACH","foreach",161],["T_WHITESPACE"," ",161],"(",["T_ARRAY","array",161],"(",["T_CONSTANT_ENCAPSED_STRING","'width'",161],",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'height'",161],")",["T_WHITESPACE"," ",161],["T_AS","as",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$wh",161],")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],"$",["T_VARIABLE","$wh",162],["T_WHITESPACE","  ",162],"=",["T_WHITESPACE"," ",162],["T_INT_CAST","(int)",162],"$",["T_VARIABLE","$wh",162],";",["T_WHITESPACE","\n            ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_EMPTY","empty",163],"(","$",["T_VARIABLE","$wh",163],")",")",["T_WHITESPACE","\n                ",163],"$",["T_VARIABLE","$wh",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_STRING","null",164],";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_COMMENT","\/\/ set sizes\n",167],["T_WHITESPACE","        ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","setWidth",168],"(",["T_VARIABLE","$width",168],")",["T_OBJECT_OPERATOR","->",168],["T_STRING","setHeight",168],"(",["T_VARIABLE","$height",168],")",";",["T_WHITESPACE","\n\n        ",168],["T_RETURN","return",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],";",["T_WHITESPACE","\n    ",170],"}",["T_WHITESPACE","\n\n    ",171],["T_PROTECTED","protected",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","_checkMemory",173],"(",["T_VARIABLE","$file",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_STRING","null",173],")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n",174],["T_COMMENT","\/\/        print '$this->_getMemoryLimit() = '.$this->_getMemoryLimit();\n",175],["T_COMMENT","\/\/        print '$this->_getMemoryUsage() = '.$this->_getMemoryUsage();\n",176],["T_COMMENT","\/\/        print '$this->_getNeedMemoryForBaseFile() = '.$this->_getNeedMemoryForBaseFile();\n",177],["T_WHITESPACE","\n        ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_getMemoryLimit",179],"(",")",["T_WHITESPACE"," ",179],">",["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_getMemoryUsage",179],"(",")",["T_WHITESPACE"," ",179],"+",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_getNeedMemoryForFile",179],"(",["T_VARIABLE","$file",179],")",")",["T_WHITESPACE"," ",179],["T_BOOLEAN_OR","||",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_getMemoryLimit",179],"(",")",["T_WHITESPACE"," ",179],["T_IS_EQUAL","==",179],["T_WHITESPACE"," ",179],"-",["T_LNUMBER","1",179],";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n\n    ",180],["T_PROTECTED","protected",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","_getMemoryLimit",182],"(",")",["T_WHITESPACE","\n    ",182],"{",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$memoryLimit",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","trim",184],"(",["T_STRING","strtoupper",184],"(",["T_STRING","ini_get",184],"(",["T_CONSTANT_ENCAPSED_STRING","'memory_limit'",184],")",")",")",";",["T_WHITESPACE","\n\n        ",184],["T_IF","if",186],["T_WHITESPACE"," ",186],"(","!",["T_ISSET","isSet",186],"(",["T_VARIABLE","$memoryLimit",186],"[",["T_LNUMBER","0",186],"]",")",")","{",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$memoryLimit",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","\"128M\"",187],";",["T_WHITESPACE","\n        ",187],"}",["T_WHITESPACE","\n\n        ",188],["T_IF","if",190],["T_WHITESPACE"," ",190],"(",["T_STRING","substr",190],"(",["T_VARIABLE","$memoryLimit",190],",",["T_WHITESPACE"," ",190],"-",["T_LNUMBER","1",190],")",["T_WHITESPACE"," ",190],["T_IS_EQUAL","==",190],["T_WHITESPACE"," ",190],["T_CONSTANT_ENCAPSED_STRING","'K'",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_STRING","substr",191],"(",["T_VARIABLE","$memoryLimit",191],",",["T_WHITESPACE"," ",191],["T_LNUMBER","0",191],",",["T_WHITESPACE"," ",191],"-",["T_LNUMBER","1",191],")",["T_WHITESPACE"," ",191],"*",["T_WHITESPACE"," ",191],["T_LNUMBER","1024",191],";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n        ",192],["T_IF","if",193],["T_WHITESPACE"," ",193],"(",["T_STRING","substr",193],"(",["T_VARIABLE","$memoryLimit",193],",",["T_WHITESPACE"," ",193],"-",["T_LNUMBER","1",193],")",["T_WHITESPACE"," ",193],["T_IS_EQUAL","==",193],["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","'M'",193],")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_RETURN","return",194],["T_WHITESPACE"," ",194],["T_STRING","substr",194],"(",["T_VARIABLE","$memoryLimit",194],",",["T_WHITESPACE"," ",194],["T_LNUMBER","0",194],",",["T_WHITESPACE"," ",194],"-",["T_LNUMBER","1",194],")",["T_WHITESPACE"," ",194],"*",["T_WHITESPACE"," ",194],["T_LNUMBER","1024",194],["T_WHITESPACE"," ",194],"*",["T_WHITESPACE"," ",194],["T_LNUMBER","1024",194],";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n        ",195],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_STRING","substr",196],"(",["T_VARIABLE","$memoryLimit",196],",",["T_WHITESPACE"," ",196],"-",["T_LNUMBER","1",196],")",["T_WHITESPACE"," ",196],["T_IS_EQUAL","==",196],["T_WHITESPACE"," ",196],["T_CONSTANT_ENCAPSED_STRING","'G'",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_RETURN","return",197],["T_WHITESPACE"," ",197],["T_STRING","substr",197],"(",["T_VARIABLE","$memoryLimit",197],",",["T_WHITESPACE"," ",197],["T_LNUMBER","0",197],",",["T_WHITESPACE"," ",197],"-",["T_LNUMBER","1",197],")",["T_WHITESPACE"," ",197],"*",["T_WHITESPACE"," ",197],["T_LNUMBER","1024",197],["T_WHITESPACE"," ",197],"*",["T_WHITESPACE"," ",197],["T_LNUMBER","1024",197],["T_WHITESPACE"," ",197],"*",["T_WHITESPACE"," ",197],["T_LNUMBER","1024",197],";",["T_WHITESPACE","\n        ",197],"}",["T_WHITESPACE","\n        ",198],["T_RETURN","return",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$memoryLimit",199],";",["T_WHITESPACE","\n    ",199],"}",["T_WHITESPACE","\n\n    ",200],["T_PROTECTED","protected",202],["T_WHITESPACE"," ",202],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","_getMemoryUsage",202],"(",")",["T_WHITESPACE","\n    ",202],"{",["T_WHITESPACE","\n        ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(",["T_STRING","function_exists",204],"(",["T_CONSTANT_ENCAPSED_STRING","'memory_get_usage'",204],")",")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_RETURN","return",205],["T_WHITESPACE"," ",205],["T_STRING","memory_get_usage",205],"(",")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n        ",206],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_LNUMBER","0",207],";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n\n    ",208],["T_PROTECTED","protected",210],["T_WHITESPACE"," ",210],["T_FUNCTION","function",210],["T_WHITESPACE"," ",210],["T_STRING","_getNeedMemoryForFile",210],"(",["T_VARIABLE","$file",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_STRING","null",210],")",["T_WHITESPACE","\n    ",210],"{",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$file",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_STRING","is_null",212],"(",["T_VARIABLE","$file",212],")",["T_WHITESPACE"," ",212],"?",["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getBaseFile",212],"(",")",["T_WHITESPACE"," ",212],":",["T_WHITESPACE"," ",212],["T_VARIABLE","$file",212],";",["T_WHITESPACE","\n        ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(","!",["T_VARIABLE","$file",213],")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_LNUMBER","0",214],";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n\n        ",215],["T_IF","if",217],["T_WHITESPACE"," ",217],"(","!",["T_STRING","file_exists",217],"(",["T_VARIABLE","$file",217],")",["T_WHITESPACE"," ",217],["T_BOOLEAN_OR","||",217],["T_WHITESPACE"," ",217],"!",["T_STRING","is_file",217],"(",["T_VARIABLE","$file",217],")",")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n            ",217],["T_RETURN","return",218],["T_WHITESPACE"," ",218],["T_LNUMBER","0",218],";",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE","\n\n        ",219],["T_VARIABLE","$imageInfo",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_STRING","getimagesize",221],"(",["T_VARIABLE","$file",221],")",";",["T_WHITESPACE","\n\n        ",221],["T_IF","if",223],["T_WHITESPACE"," ",223],"(","!",["T_ISSET","isset",223],"(",["T_VARIABLE","$imageInfo",223],"[",["T_LNUMBER","0",223],"]",")",["T_WHITESPACE"," ",223],["T_BOOLEAN_OR","||",223],["T_WHITESPACE"," ",223],"!",["T_ISSET","isset",223],"(",["T_VARIABLE","$imageInfo",223],"[",["T_LNUMBER","1",223],"]",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n            ",223],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_LNUMBER","0",224],";",["T_WHITESPACE","\n        ",224],"}",["T_WHITESPACE","\n        ",225],["T_IF","if",226],["T_WHITESPACE"," ",226],"(","!",["T_ISSET","isset",226],"(",["T_VARIABLE","$imageInfo",226],"[",["T_CONSTANT_ENCAPSED_STRING","'channels'",226],"]",")",")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_COMMENT","\/\/ if there is no info about this parameter lets set it for maximum\n",227],["T_WHITESPACE","            ",228],["T_VARIABLE","$imageInfo",228],"[",["T_CONSTANT_ENCAPSED_STRING","'channels'",228],"]",["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_LNUMBER","4",228],";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n        ",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(","!",["T_ISSET","isset",230],"(",["T_VARIABLE","$imageInfo",230],"[",["T_CONSTANT_ENCAPSED_STRING","'bits'",230],"]",")",")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_COMMENT","\/\/ if there is no info about this parameter lets set it for maximum\n",231],["T_WHITESPACE","            ",232],["T_VARIABLE","$imageInfo",232],"[",["T_CONSTANT_ENCAPSED_STRING","'bits'",232],"]",["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_LNUMBER","8",232],";",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE","\n        ",233],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_STRING","round",234],"(","(",["T_VARIABLE","$imageInfo",234],"[",["T_LNUMBER","0",234],"]",["T_WHITESPACE"," ",234],"*",["T_WHITESPACE"," ",234],["T_VARIABLE","$imageInfo",234],"[",["T_LNUMBER","1",234],"]",["T_WHITESPACE"," ",234],"*",["T_WHITESPACE"," ",234],["T_VARIABLE","$imageInfo",234],"[",["T_CONSTANT_ENCAPSED_STRING","'bits'",234],"]",["T_WHITESPACE"," ",234],"*",["T_WHITESPACE"," ",234],["T_VARIABLE","$imageInfo",234],"[",["T_CONSTANT_ENCAPSED_STRING","'channels'",234],"]",["T_WHITESPACE"," ",234],"\/",["T_WHITESPACE"," ",234],["T_LNUMBER","8",234],["T_WHITESPACE"," ",234],"+",["T_WHITESPACE"," ",234],["T_STRING","Pow",234],"(",["T_LNUMBER","2",234],",",["T_WHITESPACE"," ",234],["T_LNUMBER","16",234],")",")",["T_WHITESPACE"," ",234],"*",["T_WHITESPACE"," ",234],["T_DNUMBER","1.65",234],")",";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Convert array of 3 items (decimal r, g, b) to string of their hex values\n     *\n     * @param array $rgbArray\n     * @return string\n     *\/",237],["T_WHITESPACE","\n    ",242],["T_PROTECTED","protected",243],["T_WHITESPACE"," ",243],["T_FUNCTION","function",243],["T_WHITESPACE"," ",243],["T_STRING","_rgbToString",243],"(",["T_VARIABLE","$rgbArray",243],")",["T_WHITESPACE","\n    ",243],"{",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$result",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_ARRAY","array",245],"(",")",";",["T_WHITESPACE","\n        ",245],["T_FOREACH","foreach",246],["T_WHITESPACE"," ",246],"(",["T_VARIABLE","$rgbArray",246],["T_WHITESPACE"," ",246],["T_AS","as",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$value",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_IF","if",247],["T_WHITESPACE"," ",247],"(",["T_STRING","null",247],["T_WHITESPACE"," ",247],["T_IS_IDENTICAL","===",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$value",247],")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n                ",247],["T_VARIABLE","$result",248],"[","]",["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'null'",248],";",["T_WHITESPACE","\n            ",248],"}",["T_WHITESPACE","\n            ",249],["T_ELSE","else",250],["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n                ",250],["T_VARIABLE","$result",251],"[","]",["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_STRING","sprintf",251],"(",["T_CONSTANT_ENCAPSED_STRING","'%02s'",251],",",["T_WHITESPACE"," ",251],["T_STRING","dechex",251],"(",["T_VARIABLE","$value",251],")",")",";",["T_WHITESPACE","\n            ",251],"}",["T_WHITESPACE","\n        ",252],"}",["T_WHITESPACE","\n        ",253],["T_RETURN","return",254],["T_WHITESPACE"," ",254],["T_STRING","implode",254],"(",["T_VARIABLE","$result",254],")",";",["T_WHITESPACE","\n    ",254],"}",["T_WHITESPACE","\n\n    ",255],["T_DOC_COMMENT","\/**\n     * Set filenames for base file and new file\n     *\n     * @param string $file\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",257],["T_WHITESPACE","\n    ",262],["T_PUBLIC","public",263],["T_WHITESPACE"," ",263],["T_FUNCTION","function",263],["T_WHITESPACE"," ",263],["T_STRING","setBaseFile",263],"(",["T_VARIABLE","$file",263],")",["T_WHITESPACE","\n    ",263],"{",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_isBaseFilePlaceholder",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","false",265],";",["T_WHITESPACE","\n\n        ",265],["T_IF","if",267],["T_WHITESPACE"," ",267],"(","(",["T_VARIABLE","$file",267],")",["T_WHITESPACE"," ",267],["T_BOOLEAN_AND","&&",267],["T_WHITESPACE"," ",267],"(",["T_LNUMBER","0",267],["T_WHITESPACE"," ",267],["T_IS_NOT_IDENTICAL","!==",267],["T_WHITESPACE"," ",267],["T_STRING","strpos",267],"(",["T_VARIABLE","$file",267],",",["T_WHITESPACE"," ",267],["T_CONSTANT_ENCAPSED_STRING","'\/'",267],",",["T_WHITESPACE"," ",267],["T_LNUMBER","0",267],")",")",")",["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n            ",267],["T_VARIABLE","$file",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_CONSTANT_ENCAPSED_STRING","'\/'",268],["T_WHITESPACE"," ",268],".",["T_WHITESPACE"," ",268],["T_VARIABLE","$file",268],";",["T_WHITESPACE","\n        ",268],"}",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$baseDir",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_STRING","Mage",270],["T_DOUBLE_COLON","::",270],["T_STRING","getSingleton",270],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_media_config'",270],")",["T_OBJECT_OPERATOR","->",270],["T_STRING","getBaseMediaPath",270],"(",")",";",["T_WHITESPACE","\n\n        ",270],["T_IF","if",272],["T_WHITESPACE"," ",272],"(",["T_CONSTANT_ENCAPSED_STRING","'\/no_selection'",272],["T_WHITESPACE"," ",272],["T_IS_EQUAL","==",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$file",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$file",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","null",273],";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE","\n        ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$file",275],")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n            ",275],["T_IF","if",276],["T_WHITESPACE"," ",276],"(","(","!",["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_fileExists",276],"(",["T_VARIABLE","$baseDir",276],["T_WHITESPACE"," ",276],".",["T_WHITESPACE"," ",276],["T_VARIABLE","$file",276],")",")",["T_WHITESPACE"," ",276],["T_BOOLEAN_OR","||",276],["T_WHITESPACE"," ",276],"!",["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_checkMemory",276],"(",["T_VARIABLE","$baseDir",276],["T_WHITESPACE"," ",276],".",["T_WHITESPACE"," ",276],["T_VARIABLE","$file",276],")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n                ",276],["T_VARIABLE","$file",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_STRING","null",277],";",["T_WHITESPACE","\n            ",277],"}",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n        ",279],["T_IF","if",280],["T_WHITESPACE"," ",280],"(","!",["T_VARIABLE","$file",280],")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n            ",280],["T_COMMENT","\/\/ check if placeholder defined in config\n",281],["T_WHITESPACE","            ",282],["T_VARIABLE","$isConfigPlaceholder",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_STRING","Mage",282],["T_DOUBLE_COLON","::",282],["T_STRING","getStoreConfig",282],"(","\"",["T_ENCAPSED_AND_WHITESPACE","catalog\/placeholder\/",282],["T_CURLY_OPEN","{",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getDestinationSubdir",282],"(",")","}",["T_ENCAPSED_AND_WHITESPACE","_placeholder",282],"\"",")",";",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$configPlaceholder",283],["T_WHITESPACE","   ",283],"=",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'\/placeholder\/'",283],["T_WHITESPACE"," ",283],".",["T_WHITESPACE"," ",283],["T_VARIABLE","$isConfigPlaceholder",283],";",["T_WHITESPACE","\n            ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$isConfigPlaceholder",284],["T_WHITESPACE"," ",284],["T_BOOLEAN_AND","&&",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_fileExists",284],"(",["T_VARIABLE","$baseDir",284],["T_WHITESPACE"," ",284],".",["T_WHITESPACE"," ",284],["T_VARIABLE","$configPlaceholder",284],")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                ",284],["T_VARIABLE","$file",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$configPlaceholder",285],";",["T_WHITESPACE","\n            ",285],"}",["T_WHITESPACE","\n            ",286],["T_ELSE","else",287],["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n                ",287],["T_COMMENT","\/\/ replace file with skin or default skin placeholder\n",288],["T_WHITESPACE","                ",289],["T_VARIABLE","$skinBaseDir",289],["T_WHITESPACE","     ",289],"=",["T_WHITESPACE"," ",289],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","getDesign",289],"(",")",["T_OBJECT_OPERATOR","->",289],["T_STRING","getSkinBaseDir",289],"(",")",";",["T_WHITESPACE","\n                ",289],["T_VARIABLE","$skinPlaceholder",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],"\"",["T_ENCAPSED_AND_WHITESPACE","\/images\/catalog\/product\/placeholder\/",290],["T_CURLY_OPEN","{",290],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getDestinationSubdir",290],"(",")","}",["T_ENCAPSED_AND_WHITESPACE",".jpg",290],"\"",";",["T_WHITESPACE","\n                ",290],["T_VARIABLE","$file",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$skinPlaceholder",291],";",["T_WHITESPACE","\n                ",291],["T_IF","if",292],["T_WHITESPACE"," ",292],"(",["T_STRING","file_exists",292],"(",["T_VARIABLE","$skinBaseDir",292],["T_WHITESPACE"," ",292],".",["T_WHITESPACE"," ",292],["T_VARIABLE","$file",292],")",")",["T_WHITESPACE"," ",292],"{",["T_WHITESPACE","\n                    ",292],["T_VARIABLE","$baseDir",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$skinBaseDir",293],";",["T_WHITESPACE","\n                ",293],"}",["T_WHITESPACE","\n                ",294],["T_ELSE","else",295],["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n                    ",295],["T_VARIABLE","$baseDir",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_STRING","Mage",296],["T_DOUBLE_COLON","::",296],["T_STRING","getDesign",296],"(",")",["T_OBJECT_OPERATOR","->",296],["T_STRING","getSkinBaseDir",296],"(",["T_ARRAY","array",296],"(",["T_CONSTANT_ENCAPSED_STRING","'_theme'",296],["T_WHITESPACE"," ",296],["T_DOUBLE_ARROW","=>",296],["T_WHITESPACE"," ",296],["T_CONSTANT_ENCAPSED_STRING","'default'",296],")",")",";",["T_WHITESPACE","\n                    ",296],["T_IF","if",297],["T_WHITESPACE"," ",297],"(","!",["T_STRING","file_exists",297],"(",["T_VARIABLE","$baseDir",297],["T_WHITESPACE"," ",297],".",["T_WHITESPACE"," ",297],["T_VARIABLE","$file",297],")",")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n                        ",297],["T_VARIABLE","$baseDir",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_STRING","Mage",298],["T_DOUBLE_COLON","::",298],["T_STRING","getDesign",298],"(",")",["T_OBJECT_OPERATOR","->",298],["T_STRING","getSkinBaseDir",298],"(",["T_ARRAY","array",298],"(",["T_CONSTANT_ENCAPSED_STRING","'_theme'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_CONSTANT_ENCAPSED_STRING","'default'",298],",",["T_WHITESPACE"," ",298],["T_CONSTANT_ENCAPSED_STRING","'_package'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_CONSTANT_ENCAPSED_STRING","'base'",298],")",")",";",["T_WHITESPACE","\n                    ",298],"}",["T_WHITESPACE","\n                ",299],"}",["T_WHITESPACE","\n            ",300],"}",["T_WHITESPACE","\n            ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_isBaseFilePlaceholder",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_STRING","true",302],";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE","\n\n        ",303],["T_VARIABLE","$baseFile",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$baseDir",305],["T_WHITESPACE"," ",305],".",["T_WHITESPACE"," ",305],["T_VARIABLE","$file",305],";",["T_WHITESPACE","\n\n        ",305],["T_IF","if",307],["T_WHITESPACE"," ",307],"(","(","!",["T_VARIABLE","$file",307],")",["T_WHITESPACE"," ",307],["T_BOOLEAN_OR","||",307],["T_WHITESPACE"," ",307],"(","!",["T_STRING","file_exists",307],"(",["T_VARIABLE","$baseFile",307],")",")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n            ",307],["T_THROW","throw",308],["T_WHITESPACE"," ",308],["T_NEW","new",308],["T_WHITESPACE"," ",308],["T_STRING","Exception",308],"(",["T_STRING","Mage",308],["T_DOUBLE_COLON","::",308],["T_STRING","helper",308],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",308],")",["T_OBJECT_OPERATOR","->",308],["T_STRING","__",308],"(",["T_CONSTANT_ENCAPSED_STRING","'Image file was not found.'",308],")",")",";",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n\n        ",309],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_baseFile",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$baseFile",311],";",["T_WHITESPACE","\n\n        ",311],["T_COMMENT","\/\/ build new filename (most important params)\n",313],["T_WHITESPACE","        ",314],["T_VARIABLE","$path",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_ARRAY","array",314],"(",["T_WHITESPACE","\n            ",314],["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","getSingleton",315],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_media_config'",315],")",["T_OBJECT_OPERATOR","->",315],["T_STRING","getBaseMediaPath",315],"(",")",",",["T_WHITESPACE","\n            ",315],["T_CONSTANT_ENCAPSED_STRING","'cache'",316],",",["T_WHITESPACE","\n            ",316],["T_STRING","Mage",317],["T_DOUBLE_COLON","::",317],["T_STRING","app",317],"(",")",["T_OBJECT_OPERATOR","->",317],["T_STRING","getStore",317],"(",")",["T_OBJECT_OPERATOR","->",317],["T_STRING","getId",317],"(",")",",",["T_WHITESPACE","\n            ",317],["T_VARIABLE","$path",318],"[","]",["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getDestinationSubdir",318],"(",")",["T_WHITESPACE","\n        ",318],")",";",["T_WHITESPACE","\n        ",319],["T_IF","if",320],"(","(","!",["T_EMPTY","empty",320],"(",["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_width",320],")",")",["T_WHITESPACE"," ",320],["T_BOOLEAN_OR","||",320],["T_WHITESPACE"," ",320],"(","!",["T_EMPTY","empty",320],"(",["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_height",320],")",")",")",["T_WHITESPACE","\n            ",320],["T_VARIABLE","$path",321],"[","]",["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],"\"",["T_CURLY_OPEN","{",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_width",321],"}",["T_ENCAPSED_AND_WHITESPACE","x",321],["T_CURLY_OPEN","{",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_height",321],"}","\"",";",["T_WHITESPACE","\n\n        ",321],["T_COMMENT","\/\/ add misk params as a hash\n",323],["T_WHITESPACE","        ",324],["T_VARIABLE","$miscParams",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_ARRAY","array",324],"(",["T_WHITESPACE","\n                ",324],"(",["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_keepAspectRatio",325],["T_WHITESPACE","  ",325],"?",["T_WHITESPACE"," ",325],["T_CONSTANT_ENCAPSED_STRING","''",325],["T_WHITESPACE"," ",325],":",["T_WHITESPACE"," ",325],["T_CONSTANT_ENCAPSED_STRING","'non'",325],")",["T_WHITESPACE"," ",325],".",["T_WHITESPACE"," ",325],["T_CONSTANT_ENCAPSED_STRING","'proportional'",325],",",["T_WHITESPACE","\n                ",325],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_keepFrame",326],["T_WHITESPACE","        ",326],"?",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","''",326],["T_WHITESPACE"," ",326],":",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","'no'",326],")",["T_WHITESPACE","  ",326],".",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","'frame'",326],",",["T_WHITESPACE","\n                ",326],"(",["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_keepTransparency",327],["T_WHITESPACE"," ",327],"?",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","''",327],["T_WHITESPACE"," ",327],":",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'no'",327],")",["T_WHITESPACE","  ",327],".",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'transparency'",327],",",["T_WHITESPACE","\n                ",327],"(",["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_constrainOnly",328],["T_WHITESPACE"," ",328],"?",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'do'",328],["T_WHITESPACE"," ",328],":",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'not'",328],")",["T_WHITESPACE","  ",328],".",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'constrainonly'",328],",",["T_WHITESPACE","\n                ",328],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_rgbToString",329],"(",["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_backgroundColor",329],")",",",["T_WHITESPACE","\n                ",329],["T_CONSTANT_ENCAPSED_STRING","'angle'",330],["T_WHITESPACE"," ",330],".",["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_angle",330],",",["T_WHITESPACE","\n                ",330],["T_CONSTANT_ENCAPSED_STRING","'quality'",331],["T_WHITESPACE"," ",331],".",["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","_quality",331],["T_WHITESPACE","\n        ",331],")",";",["T_WHITESPACE","\n\n        ",332],["T_COMMENT","\/\/ if has watermark add watermark params to hash\n",334],["T_WHITESPACE","        ",335],["T_IF","if",335],["T_WHITESPACE"," ",335],"(",["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getWatermarkFile",335],"(",")",")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n            ",335],["T_VARIABLE","$miscParams",336],"[","]",["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getWatermarkFile",336],"(",")",";",["T_WHITESPACE","\n            ",336],["T_VARIABLE","$miscParams",337],"[","]",["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getWatermarkImageOpacity",337],"(",")",";",["T_WHITESPACE","\n            ",337],["T_VARIABLE","$miscParams",338],"[","]",["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getWatermarkPosition",338],"(",")",";",["T_WHITESPACE","\n            ",338],["T_VARIABLE","$miscParams",339],"[","]",["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getWatermarkWidth",339],"(",")",";",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$miscParams",340],"[","]",["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getWatermarkHeigth",340],"(",")",";",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n\n        ",341],["T_VARIABLE","$path",343],"[","]",["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_STRING","md5",343],"(",["T_STRING","implode",343],"(",["T_CONSTANT_ENCAPSED_STRING","'_'",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$miscParams",343],")",")",";",["T_WHITESPACE","\n\n        ",343],["T_COMMENT","\/\/ append prepared filename\n",345],["T_WHITESPACE","        ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_newFile",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_STRING","implode",346],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$path",346],")",["T_WHITESPACE"," ",346],".",["T_WHITESPACE"," ",346],["T_VARIABLE","$file",346],";",["T_WHITESPACE"," ",346],["T_COMMENT","\/\/ the $file contains heading slash\n",346],["T_WHITESPACE","\n        ",347],["T_RETURN","return",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$this",348],";",["T_WHITESPACE","\n    ",348],"}",["T_WHITESPACE","\n\n    ",349],["T_PUBLIC","public",351],["T_WHITESPACE"," ",351],["T_FUNCTION","function",351],["T_WHITESPACE"," ",351],["T_STRING","getBaseFile",351],"(",")",["T_WHITESPACE","\n    ",351],"{",["T_WHITESPACE","\n        ",352],["T_RETURN","return",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_baseFile",353],";",["T_WHITESPACE","\n    ",353],"}",["T_WHITESPACE","\n\n    ",354],["T_PUBLIC","public",356],["T_WHITESPACE"," ",356],["T_FUNCTION","function",356],["T_WHITESPACE"," ",356],["T_STRING","getNewFile",356],"(",")",["T_WHITESPACE","\n    ",356],"{",["T_WHITESPACE","\n        ",357],["T_RETURN","return",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","_newFile",358],";",["T_WHITESPACE","\n    ",358],"}",["T_WHITESPACE","\n\n    ",359],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",361],["T_WHITESPACE","\n    ",363],["T_PUBLIC","public",364],["T_WHITESPACE"," ",364],["T_FUNCTION","function",364],["T_WHITESPACE"," ",364],["T_STRING","setImageProcessor",364],"(",["T_VARIABLE","$processor",364],")",["T_WHITESPACE","\n    ",364],"{",["T_WHITESPACE","\n        ",365],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","_processor",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$processor",366],";",["T_WHITESPACE","\n        ",366],["T_RETURN","return",367],["T_WHITESPACE"," ",367],["T_VARIABLE","$this",367],";",["T_WHITESPACE","\n    ",367],"}",["T_WHITESPACE","\n\n    ",368],["T_DOC_COMMENT","\/**\n     * @return Varien_Image\n     *\/",370],["T_WHITESPACE","\n    ",372],["T_PUBLIC","public",373],["T_WHITESPACE"," ",373],["T_FUNCTION","function",373],["T_WHITESPACE"," ",373],["T_STRING","getImageProcessor",373],"(",")",["T_WHITESPACE","\n    ",373],"{",["T_WHITESPACE","\n        ",374],["T_IF","if",375],"(",["T_WHITESPACE"," ",375],"!",["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","_processor",375],["T_WHITESPACE"," ",375],")",["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n",375],["T_COMMENT","\/\/            var_dump($this->_checkMemory());\n",376],["T_COMMENT","\/\/            if (!$this->_checkMemory()) {\n",377],["T_COMMENT","\/\/                $this->_baseFile = null;\n",378],["T_COMMENT","\/\/            }\n",379],["T_WHITESPACE","            ",380],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","_processor",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_NEW","new",380],["T_WHITESPACE"," ",380],["T_STRING","Varien_Image",380],"(",["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getBaseFile",380],"(",")",")",";",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_processor",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","keepAspectRatio",382],"(",["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_keepAspectRatio",382],")",";",["T_WHITESPACE","\n        ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","_processor",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","keepFrame",383],"(",["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","_keepFrame",383],")",";",["T_WHITESPACE","\n        ",383],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_processor",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","keepTransparency",384],"(",["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_keepTransparency",384],")",";",["T_WHITESPACE","\n        ",384],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","_processor",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","constrainOnly",385],"(",["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","_constrainOnly",385],")",";",["T_WHITESPACE","\n        ",385],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_processor",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","backgroundColor",386],"(",["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_backgroundColor",386],")",";",["T_WHITESPACE","\n        ",386],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_processor",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","quality",387],"(",["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_quality",387],")",";",["T_WHITESPACE","\n        ",387],["T_RETURN","return",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","_processor",388],";",["T_WHITESPACE","\n    ",388],"}",["T_WHITESPACE","\n\n    ",389],["T_DOC_COMMENT","\/**\n     * @see Varien_Image_Adapter_Abstract\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",391],["T_WHITESPACE","\n    ",394],["T_PUBLIC","public",395],["T_WHITESPACE"," ",395],["T_FUNCTION","function",395],["T_WHITESPACE"," ",395],["T_STRING","resize",395],"(",")",["T_WHITESPACE","\n    ",395],"{",["T_WHITESPACE","\n        ",396],["T_IF","if",397],["T_WHITESPACE"," ",397],"(",["T_STRING","is_null",397],"(",["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getWidth",397],"(",")",")",["T_WHITESPACE"," ",397],["T_BOOLEAN_AND","&&",397],["T_WHITESPACE"," ",397],["T_STRING","is_null",397],"(",["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getHeight",397],"(",")",")",")",["T_WHITESPACE"," ",397],"{",["T_WHITESPACE","\n            ",397],["T_RETURN","return",398],["T_WHITESPACE"," ",398],["T_VARIABLE","$this",398],";",["T_WHITESPACE","\n        ",398],"}",["T_WHITESPACE","\n        ",399],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getImageProcessor",400],"(",")",["T_OBJECT_OPERATOR","->",400],["T_STRING","resize",400],"(",["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","_width",400],",",["T_WHITESPACE"," ",400],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","_height",400],")",";",["T_WHITESPACE","\n        ",400],["T_RETURN","return",401],["T_WHITESPACE"," ",401],["T_VARIABLE","$this",401],";",["T_WHITESPACE","\n    ",401],"}",["T_WHITESPACE","\n\n    ",402],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",404],["T_WHITESPACE","\n    ",406],["T_PUBLIC","public",407],["T_WHITESPACE"," ",407],["T_FUNCTION","function",407],["T_WHITESPACE"," ",407],["T_STRING","rotate",407],"(",["T_VARIABLE","$angle",407],")",["T_WHITESPACE","\n    ",407],"{",["T_WHITESPACE","\n        ",408],["T_VARIABLE","$angle",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_STRING","intval",409],"(",["T_VARIABLE","$angle",409],")",";",["T_WHITESPACE","\n        ",409],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getImageProcessor",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","rotate",410],"(",["T_VARIABLE","$angle",410],")",";",["T_WHITESPACE","\n        ",410],["T_RETURN","return",411],["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],";",["T_WHITESPACE","\n    ",411],"}",["T_WHITESPACE","\n\n    ",412],["T_DOC_COMMENT","\/**\n     * Set angle for rotating\n     *\n     * This func actually affects only the cache filename.\n     *\n     * @param int $angle\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",414],["T_WHITESPACE","\n    ",421],["T_PUBLIC","public",422],["T_WHITESPACE"," ",422],["T_FUNCTION","function",422],["T_WHITESPACE"," ",422],["T_STRING","setAngle",422],"(",["T_VARIABLE","$angle",422],")",["T_WHITESPACE","\n    ",422],"{",["T_WHITESPACE","\n        ",423],["T_VARIABLE","$this",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","_angle",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_VARIABLE","$angle",424],";",["T_WHITESPACE","\n        ",424],["T_RETURN","return",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$this",425],";",["T_WHITESPACE","\n    ",425],"}",["T_WHITESPACE","\n\n    ",426],["T_DOC_COMMENT","\/**\n     * Add watermark to image\n     * size param in format 100x200\n     *\n     * @param string $file\n     * @param string $position\n     * @param string $size\n     * @param int $width\n     * @param int $heigth\n     * @param int $imageOpacity\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",428],["T_WHITESPACE","\n    ",439],["T_PUBLIC","public",440],["T_WHITESPACE"," ",440],["T_FUNCTION","function",440],["T_WHITESPACE"," ",440],["T_STRING","setWatermark",440],"(",["T_VARIABLE","$file",440],",",["T_WHITESPACE"," ",440],["T_VARIABLE","$position",440],"=",["T_STRING","null",440],",",["T_WHITESPACE"," ",440],["T_VARIABLE","$size",440],"=",["T_STRING","null",440],",",["T_WHITESPACE"," ",440],["T_VARIABLE","$width",440],"=",["T_STRING","null",440],",",["T_WHITESPACE"," ",440],["T_VARIABLE","$heigth",440],"=",["T_STRING","null",440],",",["T_WHITESPACE"," ",440],["T_VARIABLE","$imageOpacity",440],"=",["T_STRING","null",440],")",["T_WHITESPACE","\n    ",440],"{",["T_WHITESPACE","\n        ",441],["T_IF","if",442],["T_WHITESPACE"," ",442],"(",["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","_isBaseFilePlaceholder",442],")",["T_WHITESPACE","\n        ",442],"{",["T_WHITESPACE","\n            ",443],["T_RETURN","return",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],";",["T_WHITESPACE","\n        ",444],"}",["T_WHITESPACE","\n\n        ",445],["T_IF","if",447],["T_WHITESPACE"," ",447],"(",["T_VARIABLE","$file",447],")",["T_WHITESPACE"," ",447],"{",["T_WHITESPACE","\n            ",447],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","setWatermarkFile",448],"(",["T_VARIABLE","$file",448],")",";",["T_WHITESPACE","\n        ",448],"}",["T_WHITESPACE"," ",449],["T_ELSE","else",449],["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_RETURN","return",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$this",450],";",["T_WHITESPACE","\n        ",450],"}",["T_WHITESPACE","\n\n        ",451],["T_IF","if",453],["T_WHITESPACE"," ",453],"(",["T_VARIABLE","$position",453],")",["T_WHITESPACE","\n           ",453],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","setWatermarkPosition",454],"(",["T_VARIABLE","$position",454],")",";",["T_WHITESPACE","\n        ",454],["T_IF","if",455],["T_WHITESPACE"," ",455],"(",["T_VARIABLE","$size",455],")",["T_WHITESPACE","\n            ",455],["T_VARIABLE","$this",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","setWatermarkSize",456],"(",["T_VARIABLE","$size",456],")",";",["T_WHITESPACE","\n        ",456],["T_IF","if",457],["T_WHITESPACE"," ",457],"(",["T_VARIABLE","$width",457],")",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$this",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","setWatermarkWidth",458],"(",["T_VARIABLE","$width",458],")",";",["T_WHITESPACE","\n        ",458],["T_IF","if",459],["T_WHITESPACE"," ",459],"(",["T_VARIABLE","$heigth",459],")",["T_WHITESPACE","\n            ",459],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","setWatermarkHeigth",460],"(",["T_VARIABLE","$heigth",460],")",";",["T_WHITESPACE","\n        ",460],["T_IF","if",461],["T_WHITESPACE"," ",461],"(",["T_VARIABLE","$imageOpacity",461],")",["T_WHITESPACE","\n            ",461],["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","setImageOpacity",462],"(",["T_VARIABLE","$imageOpacity",462],")",";",["T_WHITESPACE","\n\n        ",462],["T_VARIABLE","$filePath",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_getWatermarkFilePath",464],"(",")",";",["T_WHITESPACE","\n\n        ",464],["T_IF","if",466],"(",["T_VARIABLE","$filePath",466],")",["T_WHITESPACE"," ",466],"{",["T_WHITESPACE","\n            ",466],["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","getImageProcessor",467],"(",")",["T_WHITESPACE","\n                ",467],["T_OBJECT_OPERATOR","->",468],["T_STRING","setWatermarkPosition",468],"(",["T_WHITESPACE"," ",468],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getWatermarkPosition",468],"(",")",["T_WHITESPACE"," ",468],")",["T_WHITESPACE","\n                ",468],["T_OBJECT_OPERATOR","->",469],["T_STRING","setWatermarkImageOpacity",469],"(",["T_WHITESPACE"," ",469],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getWatermarkImageOpacity",469],"(",")",["T_WHITESPACE"," ",469],")",["T_WHITESPACE","\n                ",469],["T_OBJECT_OPERATOR","->",470],["T_STRING","setWatermarkWidth",470],"(",["T_WHITESPACE"," ",470],["T_VARIABLE","$this",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","getWatermarkWidth",470],"(",")",["T_WHITESPACE"," ",470],")",["T_WHITESPACE","\n                ",470],["T_OBJECT_OPERATOR","->",471],["T_STRING","setWatermarkHeigth",471],"(",["T_WHITESPACE"," ",471],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getWatermarkHeigth",471],"(",")",["T_WHITESPACE"," ",471],")",["T_WHITESPACE","\n                ",471],["T_OBJECT_OPERATOR","->",472],["T_STRING","watermark",472],"(",["T_VARIABLE","$filePath",472],")",";",["T_WHITESPACE","\n        ",472],"}",["T_WHITESPACE","\n\n        ",473],["T_RETURN","return",475],["T_WHITESPACE"," ",475],["T_VARIABLE","$this",475],";",["T_WHITESPACE","\n    ",475],"}",["T_WHITESPACE","\n\n    ",476],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",478],["T_WHITESPACE","\n    ",480],["T_PUBLIC","public",481],["T_WHITESPACE"," ",481],["T_FUNCTION","function",481],["T_WHITESPACE"," ",481],["T_STRING","saveFile",481],"(",")",["T_WHITESPACE","\n    ",481],"{",["T_WHITESPACE","\n        ",482],["T_VARIABLE","$filename",483],["T_WHITESPACE"," ",483],"=",["T_WHITESPACE"," ",483],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getNewFile",483],"(",")",";",["T_WHITESPACE","\n        ",483],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getImageProcessor",484],"(",")",["T_OBJECT_OPERATOR","->",484],["T_STRING","save",484],"(",["T_VARIABLE","$filename",484],")",";",["T_WHITESPACE","\n        ",484],["T_STRING","Mage",485],["T_DOUBLE_COLON","::",485],["T_STRING","helper",485],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",485],")",["T_OBJECT_OPERATOR","->",485],["T_STRING","saveFile",485],"(",["T_VARIABLE","$filename",485],")",";",["T_WHITESPACE","\n        ",485],["T_RETURN","return",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$this",486],";",["T_WHITESPACE","\n    ",486],"}",["T_WHITESPACE","\n\n    ",487],["T_DOC_COMMENT","\/**\n     * @return string\n     *\/",489],["T_WHITESPACE","\n    ",491],["T_PUBLIC","public",492],["T_WHITESPACE"," ",492],["T_FUNCTION","function",492],["T_WHITESPACE"," ",492],["T_STRING","getUrl",492],"(",")",["T_WHITESPACE","\n    ",492],"{",["T_WHITESPACE","\n        ",493],["T_VARIABLE","$baseDir",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],["T_STRING","Mage",494],["T_DOUBLE_COLON","::",494],["T_STRING","getBaseDir",494],"(",["T_CONSTANT_ENCAPSED_STRING","'media'",494],")",";",["T_WHITESPACE","\n        ",494],["T_VARIABLE","$path",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_STRING","str_replace",495],"(",["T_VARIABLE","$baseDir",495],["T_WHITESPACE"," ",495],".",["T_WHITESPACE"," ",495],["T_STRING","DS",495],",",["T_WHITESPACE"," ",495],["T_CONSTANT_ENCAPSED_STRING","\"\"",495],",",["T_WHITESPACE"," ",495],["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","_newFile",495],")",";",["T_WHITESPACE","\n        ",495],["T_RETURN","return",496],["T_WHITESPACE"," ",496],["T_STRING","Mage",496],["T_DOUBLE_COLON","::",496],["T_STRING","getBaseUrl",496],"(",["T_CONSTANT_ENCAPSED_STRING","'media'",496],")",["T_WHITESPACE"," ",496],".",["T_WHITESPACE"," ",496],["T_STRING","str_replace",496],"(",["T_STRING","DS",496],",",["T_WHITESPACE"," ",496],["T_CONSTANT_ENCAPSED_STRING","'\/'",496],",",["T_WHITESPACE"," ",496],["T_VARIABLE","$path",496],")",";",["T_WHITESPACE","\n    ",496],"}",["T_WHITESPACE","\n\n    ",497],["T_PUBLIC","public",499],["T_WHITESPACE"," ",499],["T_FUNCTION","function",499],["T_WHITESPACE"," ",499],["T_STRING","push",499],"(",")",["T_WHITESPACE","\n    ",499],"{",["T_WHITESPACE","\n        ",500],["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getImageProcessor",501],"(",")",["T_OBJECT_OPERATOR","->",501],["T_STRING","display",501],"(",")",";",["T_WHITESPACE","\n    ",501],"}",["T_WHITESPACE","\n\n    ",502],["T_DOC_COMMENT","\/**\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",504],["T_WHITESPACE","\n    ",506],["T_PUBLIC","public",507],["T_WHITESPACE"," ",507],["T_FUNCTION","function",507],["T_WHITESPACE"," ",507],["T_STRING","setDestinationSubdir",507],"(",["T_VARIABLE","$dir",507],")",["T_WHITESPACE","\n    ",507],"{",["T_WHITESPACE","\n        ",508],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","_destinationSubdir",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$dir",509],";",["T_WHITESPACE","\n        ",509],["T_RETURN","return",510],["T_WHITESPACE"," ",510],["T_VARIABLE","$this",510],";",["T_WHITESPACE","\n    ",510],"}",["T_WHITESPACE","\n\n    ",511],["T_DOC_COMMENT","\/**\n     * @return string\n     *\/",513],["T_WHITESPACE","\n    ",515],["T_PUBLIC","public",516],["T_WHITESPACE"," ",516],["T_FUNCTION","function",516],["T_WHITESPACE"," ",516],["T_STRING","getDestinationSubdir",516],"(",")",["T_WHITESPACE","\n    ",516],"{",["T_WHITESPACE","\n        ",517],["T_RETURN","return",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","_destinationSubdir",518],";",["T_WHITESPACE","\n    ",518],"}",["T_WHITESPACE","\n\n    ",519],["T_PUBLIC","public",521],["T_WHITESPACE"," ",521],["T_FUNCTION","function",521],["T_WHITESPACE"," ",521],["T_STRING","isCached",521],"(",")",["T_WHITESPACE","\n    ",521],"{",["T_WHITESPACE","\n        ",522],["T_RETURN","return",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_fileExists",523],"(",["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_newFile",523],")",";",["T_WHITESPACE","\n    ",523],"}",["T_WHITESPACE","\n\n    ",524],["T_DOC_COMMENT","\/**\n     * Set watermark file name\n     *\n     * @param string $file\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",526],["T_WHITESPACE","\n    ",531],["T_PUBLIC","public",532],["T_WHITESPACE"," ",532],["T_FUNCTION","function",532],["T_WHITESPACE"," ",532],["T_STRING","setWatermarkFile",532],"(",["T_VARIABLE","$file",532],")",["T_WHITESPACE","\n    ",532],"{",["T_WHITESPACE","\n        ",533],["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","_watermarkFile",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_VARIABLE","$file",534],";",["T_WHITESPACE","\n        ",534],["T_RETURN","return",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$this",535],";",["T_WHITESPACE","\n    ",535],"}",["T_WHITESPACE","\n\n    ",536],["T_DOC_COMMENT","\/**\n     * Get watermark file name\n     *\n     * @return string\n     *\/",538],["T_WHITESPACE","\n    ",542],["T_PUBLIC","public",543],["T_WHITESPACE"," ",543],["T_FUNCTION","function",543],["T_WHITESPACE"," ",543],["T_STRING","getWatermarkFile",543],"(",")",["T_WHITESPACE","\n    ",543],"{",["T_WHITESPACE","\n        ",544],["T_RETURN","return",545],["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","_watermarkFile",545],";",["T_WHITESPACE","\n    ",545],"}",["T_WHITESPACE","\n\n    ",546],["T_DOC_COMMENT","\/**\n     * Get relative watermark file path\n     * or false if file not found\n     *\n     * @return string | bool\n     *\/",548],["T_WHITESPACE","\n    ",553],["T_PROTECTED","protected",554],["T_WHITESPACE"," ",554],["T_FUNCTION","function",554],["T_WHITESPACE"," ",554],["T_STRING","_getWatermarkFilePath",554],"(",")",["T_WHITESPACE","\n    ",554],"{",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$filePath",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_STRING","false",556],";",["T_WHITESPACE","\n\n        ",556],["T_IF","if",558],["T_WHITESPACE"," ",558],"(","!",["T_VARIABLE","$file",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getWatermarkFile",558],"(",")",")",["T_WHITESPACE","\n        ",558],"{",["T_WHITESPACE","\n            ",559],["T_RETURN","return",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$filePath",560],";",["T_WHITESPACE","\n        ",560],"}",["T_WHITESPACE","\n\n        ",561],["T_VARIABLE","$baseDir",563],["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_STRING","Mage",563],["T_DOUBLE_COLON","::",563],["T_STRING","getSingleton",563],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_media_config'",563],")",["T_OBJECT_OPERATOR","->",563],["T_STRING","getBaseMediaPath",563],"(",")",";",["T_WHITESPACE","\n\n        ",563],["T_IF","if",565],"(",["T_WHITESPACE"," ",565],["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","_fileExists",565],"(",["T_VARIABLE","$baseDir",565],["T_WHITESPACE"," ",565],".",["T_WHITESPACE"," ",565],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/stores\/'",565],["T_WHITESPACE"," ",565],".",["T_WHITESPACE"," ",565],["T_STRING","Mage",565],["T_DOUBLE_COLON","::",565],["T_STRING","app",565],"(",")",["T_OBJECT_OPERATOR","->",565],["T_STRING","getStore",565],"(",")",["T_OBJECT_OPERATOR","->",565],["T_STRING","getId",565],"(",")",["T_WHITESPACE"," ",565],".",["T_WHITESPACE"," ",565],["T_VARIABLE","$file",565],")",["T_WHITESPACE"," ",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n            ",565],["T_VARIABLE","$filePath",566],["T_WHITESPACE"," ",566],"=",["T_WHITESPACE"," ",566],["T_VARIABLE","$baseDir",566],["T_WHITESPACE"," ",566],".",["T_WHITESPACE"," ",566],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/stores\/'",566],["T_WHITESPACE"," ",566],".",["T_WHITESPACE"," ",566],["T_STRING","Mage",566],["T_DOUBLE_COLON","::",566],["T_STRING","app",566],"(",")",["T_OBJECT_OPERATOR","->",566],["T_STRING","getStore",566],"(",")",["T_OBJECT_OPERATOR","->",566],["T_STRING","getId",566],"(",")",["T_WHITESPACE"," ",566],".",["T_WHITESPACE"," ",566],["T_VARIABLE","$file",566],";",["T_WHITESPACE","\n        ",566],"}",["T_WHITESPACE"," ",567],["T_ELSEIF","elseif",567],["T_WHITESPACE"," ",567],"(",["T_WHITESPACE"," ",567],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","_fileExists",567],"(",["T_VARIABLE","$baseDir",567],["T_WHITESPACE"," ",567],".",["T_WHITESPACE"," ",567],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/websites\/'",567],["T_WHITESPACE"," ",567],".",["T_WHITESPACE"," ",567],["T_STRING","Mage",567],["T_DOUBLE_COLON","::",567],["T_STRING","app",567],"(",")",["T_OBJECT_OPERATOR","->",567],["T_STRING","getWebsite",567],"(",")",["T_OBJECT_OPERATOR","->",567],["T_STRING","getId",567],"(",")",["T_WHITESPACE"," ",567],".",["T_WHITESPACE"," ",567],["T_VARIABLE","$file",567],")",["T_WHITESPACE"," ",567],")",["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n            ",567],["T_VARIABLE","$filePath",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_VARIABLE","$baseDir",568],["T_WHITESPACE"," ",568],".",["T_WHITESPACE"," ",568],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/websites\/'",568],["T_WHITESPACE"," ",568],".",["T_WHITESPACE"," ",568],["T_STRING","Mage",568],["T_DOUBLE_COLON","::",568],["T_STRING","app",568],"(",")",["T_OBJECT_OPERATOR","->",568],["T_STRING","getWebsite",568],"(",")",["T_OBJECT_OPERATOR","->",568],["T_STRING","getId",568],"(",")",["T_WHITESPACE"," ",568],".",["T_WHITESPACE"," ",568],["T_VARIABLE","$file",568],";",["T_WHITESPACE","\n        ",568],"}",["T_WHITESPACE"," ",569],["T_ELSEIF","elseif",569],["T_WHITESPACE"," ",569],"(",["T_WHITESPACE"," ",569],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_fileExists",569],"(",["T_VARIABLE","$baseDir",569],["T_WHITESPACE"," ",569],".",["T_WHITESPACE"," ",569],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/default\/'",569],["T_WHITESPACE"," ",569],".",["T_WHITESPACE"," ",569],["T_VARIABLE","$file",569],")",["T_WHITESPACE"," ",569],")",["T_WHITESPACE"," ",569],"{",["T_WHITESPACE","\n            ",569],["T_VARIABLE","$filePath",570],["T_WHITESPACE"," ",570],"=",["T_WHITESPACE"," ",570],["T_VARIABLE","$baseDir",570],["T_WHITESPACE"," ",570],".",["T_WHITESPACE"," ",570],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/default\/'",570],["T_WHITESPACE"," ",570],".",["T_WHITESPACE"," ",570],["T_VARIABLE","$file",570],";",["T_WHITESPACE","\n        ",570],"}",["T_WHITESPACE"," ",571],["T_ELSEIF","elseif",571],["T_WHITESPACE"," ",571],"(",["T_WHITESPACE"," ",571],["T_VARIABLE","$this",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","_fileExists",571],"(",["T_VARIABLE","$baseDir",571],["T_WHITESPACE"," ",571],".",["T_WHITESPACE"," ",571],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/'",571],["T_WHITESPACE"," ",571],".",["T_WHITESPACE"," ",571],["T_VARIABLE","$file",571],")",["T_WHITESPACE"," ",571],")",["T_WHITESPACE"," ",571],"{",["T_WHITESPACE","\n            ",571],["T_VARIABLE","$filePath",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$baseDir",572],["T_WHITESPACE"," ",572],".",["T_WHITESPACE"," ",572],["T_CONSTANT_ENCAPSED_STRING","'\/watermark\/'",572],["T_WHITESPACE"," ",572],".",["T_WHITESPACE"," ",572],["T_VARIABLE","$file",572],";",["T_WHITESPACE","\n        ",572],"}",["T_WHITESPACE"," ",573],["T_ELSE","else",573],["T_WHITESPACE"," ",573],"{",["T_WHITESPACE","\n            ",573],["T_VARIABLE","$baseDir",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_STRING","Mage",574],["T_DOUBLE_COLON","::",574],["T_STRING","getDesign",574],"(",")",["T_OBJECT_OPERATOR","->",574],["T_STRING","getSkinBaseDir",574],"(",")",";",["T_WHITESPACE","\n            ",574],["T_IF","if",575],"(",["T_WHITESPACE"," ",575],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","_fileExists",575],"(",["T_VARIABLE","$baseDir",575],["T_WHITESPACE"," ",575],".",["T_WHITESPACE"," ",575],["T_VARIABLE","$file",575],")",["T_WHITESPACE"," ",575],")",["T_WHITESPACE"," ",575],"{",["T_WHITESPACE","\n                ",575],["T_VARIABLE","$filePath",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_VARIABLE","$baseDir",576],["T_WHITESPACE"," ",576],".",["T_WHITESPACE"," ",576],["T_VARIABLE","$file",576],";",["T_WHITESPACE","\n            ",576],"}",["T_WHITESPACE","\n        ",577],"}",["T_WHITESPACE","\n\n        ",578],["T_RETURN","return",580],["T_WHITESPACE"," ",580],["T_VARIABLE","$filePath",580],";",["T_WHITESPACE","\n    ",580],"}",["T_WHITESPACE","\n\n    ",581],["T_DOC_COMMENT","\/**\n     * Set watermark position\n     *\n     * @param string $position\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",583],["T_WHITESPACE","\n    ",588],["T_PUBLIC","public",589],["T_WHITESPACE"," ",589],["T_FUNCTION","function",589],["T_WHITESPACE"," ",589],["T_STRING","setWatermarkPosition",589],"(",["T_VARIABLE","$position",589],")",["T_WHITESPACE","\n    ",589],"{",["T_WHITESPACE","\n        ",590],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_watermarkPosition",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_VARIABLE","$position",591],";",["T_WHITESPACE","\n        ",591],["T_RETURN","return",592],["T_WHITESPACE"," ",592],["T_VARIABLE","$this",592],";",["T_WHITESPACE","\n    ",592],"}",["T_WHITESPACE","\n\n    ",593],["T_DOC_COMMENT","\/**\n     * Get watermark position\n     *\n     * @return string\n     *\/",595],["T_WHITESPACE","\n    ",599],["T_PUBLIC","public",600],["T_WHITESPACE"," ",600],["T_FUNCTION","function",600],["T_WHITESPACE"," ",600],["T_STRING","getWatermarkPosition",600],"(",")",["T_WHITESPACE","\n    ",600],"{",["T_WHITESPACE","\n        ",601],["T_RETURN","return",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","_watermarkPosition",602],";",["T_WHITESPACE","\n    ",602],"}",["T_WHITESPACE","\n\n    ",603],["T_DOC_COMMENT","\/**\n     * Set watermark image opacity\n     *\n     * @param int $imageOpacity\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",605],["T_WHITESPACE","\n    ",610],["T_PUBLIC","public",611],["T_WHITESPACE"," ",611],["T_FUNCTION","function",611],["T_WHITESPACE"," ",611],["T_STRING","setWatermarkImageOpacity",611],"(",["T_VARIABLE","$imageOpacity",611],")",["T_WHITESPACE","\n    ",611],"{",["T_WHITESPACE","\n        ",612],["T_VARIABLE","$this",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","_watermarkImageOpacity",613],["T_WHITESPACE"," ",613],"=",["T_WHITESPACE"," ",613],["T_VARIABLE","$imageOpacity",613],";",["T_WHITESPACE","\n        ",613],["T_RETURN","return",614],["T_WHITESPACE"," ",614],["T_VARIABLE","$this",614],";",["T_WHITESPACE","\n    ",614],"}",["T_WHITESPACE","\n\n    ",615],["T_DOC_COMMENT","\/**\n     * Get watermark image opacity\n     *\n     * @return int\n     *\/",617],["T_WHITESPACE","\n    ",621],["T_PUBLIC","public",622],["T_WHITESPACE"," ",622],["T_FUNCTION","function",622],["T_WHITESPACE"," ",622],["T_STRING","getWatermarkImageOpacity",622],"(",")",["T_WHITESPACE","\n    ",622],"{",["T_WHITESPACE","\n        ",623],["T_RETURN","return",624],["T_WHITESPACE"," ",624],["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","_watermarkImageOpacity",624],";",["T_WHITESPACE","\n    ",624],"}",["T_WHITESPACE","\n\n    ",625],["T_DOC_COMMENT","\/**\n     * Set watermark size\n     *\n     * @param array $size\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",627],["T_WHITESPACE","\n    ",632],["T_PUBLIC","public",633],["T_WHITESPACE"," ",633],["T_FUNCTION","function",633],["T_WHITESPACE"," ",633],["T_STRING","setWatermarkSize",633],"(",["T_VARIABLE","$size",633],")",["T_WHITESPACE","\n    ",633],"{",["T_WHITESPACE","\n        ",634],["T_IF","if",635],"(",["T_WHITESPACE"," ",635],["T_STRING","is_array",635],"(",["T_VARIABLE","$size",635],")",["T_WHITESPACE"," ",635],")",["T_WHITESPACE"," ",635],"{",["T_WHITESPACE","\n            ",635],["T_VARIABLE","$this",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","setWatermarkWidth",636],"(",["T_VARIABLE","$size",636],"[",["T_CONSTANT_ENCAPSED_STRING","'width'",636],"]",")",["T_WHITESPACE","\n                ",636],["T_OBJECT_OPERATOR","->",637],["T_STRING","setWatermarkHeigth",637],"(",["T_VARIABLE","$size",637],"[",["T_CONSTANT_ENCAPSED_STRING","'heigth'",637],"]",")",";",["T_WHITESPACE","\n        ",637],"}",["T_WHITESPACE","\n        ",638],["T_RETURN","return",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$this",639],";",["T_WHITESPACE","\n    ",639],"}",["T_WHITESPACE","\n\n    ",640],["T_DOC_COMMENT","\/**\n     * Set watermark width\n     *\n     * @param int $width\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",642],["T_WHITESPACE","\n    ",647],["T_PUBLIC","public",648],["T_WHITESPACE"," ",648],["T_FUNCTION","function",648],["T_WHITESPACE"," ",648],["T_STRING","setWatermarkWidth",648],"(",["T_VARIABLE","$width",648],")",["T_WHITESPACE","\n    ",648],"{",["T_WHITESPACE","\n        ",649],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","_watermarkWidth",650],["T_WHITESPACE"," ",650],"=",["T_WHITESPACE"," ",650],["T_VARIABLE","$width",650],";",["T_WHITESPACE","\n        ",650],["T_RETURN","return",651],["T_WHITESPACE"," ",651],["T_VARIABLE","$this",651],";",["T_WHITESPACE","\n    ",651],"}",["T_WHITESPACE","\n\n    ",652],["T_DOC_COMMENT","\/**\n     * Get watermark width\n     *\n     * @return int\n     *\/",654],["T_WHITESPACE","\n    ",658],["T_PUBLIC","public",659],["T_WHITESPACE"," ",659],["T_FUNCTION","function",659],["T_WHITESPACE"," ",659],["T_STRING","getWatermarkWidth",659],"(",")",["T_WHITESPACE","\n    ",659],"{",["T_WHITESPACE","\n        ",660],["T_RETURN","return",661],["T_WHITESPACE"," ",661],["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","_watermarkWidth",661],";",["T_WHITESPACE","\n    ",661],"}",["T_WHITESPACE","\n\n    ",662],["T_DOC_COMMENT","\/**\n     * Set watermark heigth\n     *\n     * @param int $heigth\n     * @return Mage_Catalog_Model_Product_Image\n     *\/",664],["T_WHITESPACE","\n    ",669],["T_PUBLIC","public",670],["T_WHITESPACE"," ",670],["T_FUNCTION","function",670],["T_WHITESPACE"," ",670],["T_STRING","setWatermarkHeigth",670],"(",["T_VARIABLE","$heigth",670],")",["T_WHITESPACE","\n    ",670],"{",["T_WHITESPACE","\n        ",671],["T_VARIABLE","$this",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","_watermarkHeigth",672],["T_WHITESPACE"," ",672],"=",["T_WHITESPACE"," ",672],["T_VARIABLE","$heigth",672],";",["T_WHITESPACE","\n        ",672],["T_RETURN","return",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$this",673],";",["T_WHITESPACE","\n    ",673],"}",["T_WHITESPACE","\n\n    ",674],["T_DOC_COMMENT","\/**\n     * Get watermark heigth\n     *\n     * @return string\n     *\/",676],["T_WHITESPACE","\n    ",680],["T_PUBLIC","public",681],["T_WHITESPACE"," ",681],["T_FUNCTION","function",681],["T_WHITESPACE"," ",681],["T_STRING","getWatermarkHeigth",681],"(",")",["T_WHITESPACE","\n    ",681],"{",["T_WHITESPACE","\n        ",682],["T_RETURN","return",683],["T_WHITESPACE"," ",683],["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","_watermarkHeigth",683],";",["T_WHITESPACE","\n    ",683],"}",["T_WHITESPACE","\n\n    ",684],["T_PUBLIC","public",686],["T_WHITESPACE"," ",686],["T_FUNCTION","function",686],["T_WHITESPACE"," ",686],["T_STRING","clearCache",686],"(",")",["T_WHITESPACE","\n    ",686],"{",["T_WHITESPACE","\n        ",687],["T_VARIABLE","$directory",688],["T_WHITESPACE"," ",688],"=",["T_WHITESPACE"," ",688],["T_STRING","Mage",688],["T_DOUBLE_COLON","::",688],["T_STRING","getBaseDir",688],"(",["T_CONSTANT_ENCAPSED_STRING","'media'",688],")",["T_WHITESPACE"," ",688],".",["T_WHITESPACE"," ",688],["T_STRING","DS",688],".",["T_CONSTANT_ENCAPSED_STRING","'catalog'",688],".",["T_STRING","DS",688],".",["T_CONSTANT_ENCAPSED_STRING","'product'",688],".",["T_STRING","DS",688],".",["T_CONSTANT_ENCAPSED_STRING","'cache'",688],".",["T_STRING","DS",688],";",["T_WHITESPACE","\n        ",688],["T_VARIABLE","$io",689],["T_WHITESPACE"," ",689],"=",["T_WHITESPACE"," ",689],["T_NEW","new",689],["T_WHITESPACE"," ",689],["T_STRING","Varien_Io_File",689],"(",")",";",["T_WHITESPACE","\n        ",689],["T_VARIABLE","$io",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","rmdir",690],"(",["T_VARIABLE","$directory",690],",",["T_WHITESPACE"," ",690],["T_STRING","true",690],")",";",["T_WHITESPACE","\n\n        ",690],["T_STRING","Mage",692],["T_DOUBLE_COLON","::",692],["T_STRING","helper",692],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",692],")",["T_OBJECT_OPERATOR","->",692],["T_STRING","deleteFolder",692],"(",["T_VARIABLE","$directory",692],")",";",["T_WHITESPACE","\n    ",692],"}",["T_WHITESPACE","\n\n    ",693],["T_DOC_COMMENT","\/**\n     * First check this file on FS\n     * If it doesn't exist - try to download it from DB\n     *\n     * @param string $filename\n     * @return bool\n     *\/",695],["T_WHITESPACE","\n    ",701],["T_PROTECTED","protected",702],["T_WHITESPACE"," ",702],["T_FUNCTION","function",702],["T_WHITESPACE"," ",702],["T_STRING","_fileExists",702],"(",["T_VARIABLE","$filename",702],")",["T_WHITESPACE"," ",702],"{",["T_WHITESPACE","\n        ",702],["T_IF","if",703],["T_WHITESPACE"," ",703],"(",["T_STRING","file_exists",703],"(",["T_VARIABLE","$filename",703],")",")",["T_WHITESPACE"," ",703],"{",["T_WHITESPACE","\n            ",703],["T_RETURN","return",704],["T_WHITESPACE"," ",704],["T_STRING","true",704],";",["T_WHITESPACE","\n        ",704],"}",["T_WHITESPACE"," ",705],["T_ELSE","else",705],["T_WHITESPACE"," ",705],"{",["T_WHITESPACE","\n            ",705],["T_RETURN","return",706],["T_WHITESPACE"," ",706],["T_STRING","Mage",706],["T_DOUBLE_COLON","::",706],["T_STRING","helper",706],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",706],")",["T_OBJECT_OPERATOR","->",706],["T_STRING","saveFileToFilesystem",706],"(",["T_VARIABLE","$filename",706],")",";",["T_WHITESPACE","\n        ",706],"}",["T_WHITESPACE","\n    ",707],"}",["T_WHITESPACE","\n",708],"}",["T_WHITESPACE","\n",709]]