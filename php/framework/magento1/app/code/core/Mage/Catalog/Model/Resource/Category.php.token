[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog category model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Category",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Category tree object\n     *\n     * @var Varien_Data_Tree_Db\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_tree",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Catalog products table name\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_categoryProductTable",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Id of 'is_active' category attribute\n     *\n     * @var int\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_isActiveAttributeId",56],["T_WHITESPACE","      ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","null",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Store id\n     *\n     * @var int\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_storeId",63],["T_WHITESPACE","                  ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","null",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Class constructor\n     *\n     *\/",65],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","__construct",69],"(",")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$resource",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","Mage",71],["T_DOUBLE_COLON","::",71],["T_STRING","getSingleton",71],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource'",71],")",";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","setType",72],"(",["T_STRING","Mage_Catalog_Model_Category",72],["T_DOUBLE_COLON","::",72],["T_STRING","ENTITY",72],")",["T_WHITESPACE","\n            ",72],["T_OBJECT_OPERATOR","->",73],["T_STRING","setConnection",73],"(",["T_WHITESPACE","\n                ",73],["T_VARIABLE","$resource",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getConnection",74],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_read'",74],")",",",["T_WHITESPACE","\n                ",74],["T_VARIABLE","$resource",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getConnection",75],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_write'",75],")",["T_WHITESPACE","\n            ",75],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_categoryProductTable",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getTable",77],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",77],")",";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * Set store Id\n     *\n     * @param integer $storeId\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",80],["T_WHITESPACE","\n    ",85],["T_PUBLIC","public",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","setStoreId",86],"(",["T_VARIABLE","$storeId",86],")",["T_WHITESPACE","\n    ",86],"{",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_storeId",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$storeId",88],";",["T_WHITESPACE","\n        ",88],["T_RETURN","return",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Return store id\n     *\n     * @return integer\n     *\/",92],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","getStoreId",97],"(",")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_storeId",99],["T_WHITESPACE"," ",99],["T_IS_IDENTICAL","===",99],["T_WHITESPACE"," ",99],["T_STRING","null",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_STRING","Mage",100],["T_DOUBLE_COLON","::",100],["T_STRING","app",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getStore",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getId",100],"(",")",";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE","\n        ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_storeId",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Retrieve category tree object\n     *\n     * @return Varien_Data_Tree_Db\n     *\/",105],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","_getTree",110],"(",")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(","!",["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_tree",112],")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_tree",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","Mage",113],["T_DOUBLE_COLON","::",113],["T_STRING","getResourceModel",113],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_tree'",113],")",["T_WHITESPACE","\n                ",113],["T_OBJECT_OPERATOR","->",114],["T_STRING","load",114],"(",")",";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE","\n        ",115],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_tree",116],";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * Process category data before delete\n     * update children count for parent category\n     * delete child categories\n     *\n     * @param Varien_Object $object\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",119],["T_WHITESPACE","\n    ",126],["T_PROTECTED","protected",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","_beforeDelete",127],"(",["T_STRING","Varien_Object",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$object",127],")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_STRING","parent",129],["T_DOUBLE_COLON","::",129],["T_STRING","_beforeDelete",129],"(",["T_VARIABLE","$object",129],")",";",["T_WHITESPACE","\n\n        ",129],["T_DOC_COMMENT","\/**\n         * Update children count for all parent categories\n         *\/",131],["T_WHITESPACE","\n        ",133],["T_VARIABLE","$parentIds",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$object",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getParentIds",134],"(",")",";",["T_WHITESPACE","\n        ",134],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$parentIds",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$childDecrease",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$object",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getChildrenCount",136],"(",")",["T_WHITESPACE"," ",136],"+",["T_WHITESPACE"," ",136],["T_LNUMBER","1",136],";",["T_WHITESPACE"," ",136],["T_COMMENT","\/\/ +1 is itself\n",136],["T_WHITESPACE","            ",137],["T_VARIABLE","$data",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_ARRAY","array",137],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count'",137],["T_WHITESPACE"," ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_NEW","new",137],["T_WHITESPACE"," ",137],["T_STRING","Zend_Db_Expr",137],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count - '",137],["T_WHITESPACE"," ",137],".",["T_WHITESPACE"," ",137],["T_VARIABLE","$childDecrease",137],")",")",";",["T_WHITESPACE","\n            ",137],["T_VARIABLE","$where",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_ARRAY","array",138],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",138],["T_WHITESPACE"," ",138],["T_DOUBLE_ARROW","=>",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$parentIds",138],")",";",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_getWriteAdapter",139],"(",")",["T_OBJECT_OPERATOR","->",139],["T_STRING","update",139],"(",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getEntityTable",139],"(",")",",",["T_WHITESPACE"," ",139],["T_VARIABLE","$data",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$where",139],")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","deleteChildren",141],"(",["T_VARIABLE","$object",141],")",";",["T_WHITESPACE","\n        ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_DOC_COMMENT","\/**\n     * Delete children categories of specific category\n     *\n     * @param Varien_Object $object\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",145],["T_WHITESPACE","\n    ",150],["T_PUBLIC","public",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","deleteChildren",151],"(",["T_STRING","Varien_Object",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$object",151],")",["T_WHITESPACE","\n    ",151],"{",["T_WHITESPACE","\n        ",152],["T_VARIABLE","$adapter",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_getWriteAdapter",153],"(",")",";",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$pathField",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$adapter",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","quoteIdentifier",154],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",154],")",";",["T_WHITESPACE","\n\n        ",154],["T_VARIABLE","$select",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$adapter",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","select",156],"(",")",["T_WHITESPACE","\n            ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","from",157],"(",["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getEntityTable",157],"(",")",",",["T_WHITESPACE"," ",157],["T_ARRAY","array",157],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",157],")",")",["T_WHITESPACE","\n            ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","where",158],"(",["T_VARIABLE","$pathField",158],["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","' LIKE :c_path'",158],")",";",["T_WHITESPACE","\n\n        ",158],["T_VARIABLE","$childrenIds",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$adapter",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","fetchCol",160],"(",["T_VARIABLE","$select",160],",",["T_WHITESPACE"," ",160],["T_ARRAY","array",160],"(",["T_CONSTANT_ENCAPSED_STRING","'c_path'",160],["T_WHITESPACE"," ",160],["T_DOUBLE_ARROW","=>",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$object",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getPath",160],"(",")",["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'\/%'",160],")",")",";",["T_WHITESPACE","\n\n        ",160],["T_IF","if",162],["T_WHITESPACE"," ",162],"(","!",["T_EMPTY","empty",162],"(",["T_VARIABLE","$childrenIds",162],")",")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$adapter",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","delete",163],"(",["T_WHITESPACE","\n                ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getEntityTable",164],"(",")",",",["T_WHITESPACE","\n                ",164],["T_ARRAY","array",165],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN (?)'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$childrenIds",165],")",["T_WHITESPACE","\n            ",165],")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n\n        ",167],["T_DOC_COMMENT","\/**\n         * Add deleted children ids to object\n         * This data can be used in after delete event\n         *\/",169],["T_WHITESPACE","\n        ",172],["T_VARIABLE","$object",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","setDeletedChildrenIds",173],"(",["T_VARIABLE","$childrenIds",173],")",";",["T_WHITESPACE","\n        ",173],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Process category data before saving\n     * prepare path and increment children count for parent categories\n     *\n     * @param Varien_Object $object\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",177],["T_WHITESPACE","\n    ",183],["T_PROTECTED","protected",184],["T_WHITESPACE"," ",184],["T_FUNCTION","function",184],["T_WHITESPACE"," ",184],["T_STRING","_beforeSave",184],"(",["T_STRING","Varien_Object",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$object",184],")",["T_WHITESPACE","\n    ",184],"{",["T_WHITESPACE","\n        ",185],["T_STRING","parent",186],["T_DOUBLE_COLON","::",186],["T_STRING","_beforeSave",186],"(",["T_VARIABLE","$object",186],")",";",["T_WHITESPACE","\n\n        ",186],["T_IF","if",188],["T_WHITESPACE"," ",188],"(","!",["T_VARIABLE","$object",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getChildrenCount",188],"(",")",")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$object",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","setChildrenCount",189],"(",["T_LNUMBER","0",189],")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n        ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$object",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getLevel",191],"(",")",["T_WHITESPACE"," ",191],["T_IS_IDENTICAL","===",191],["T_WHITESPACE"," ",191],["T_STRING","null",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$object",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","setLevel",192],"(",["T_LNUMBER","1",192],")",";",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n\n        ",193],["T_IF","if",195],["T_WHITESPACE"," ",195],"(","!",["T_VARIABLE","$object",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getId",195],"(",")",")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$object",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","setPosition",196],"(",["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_getMaxPosition",196],"(",["T_VARIABLE","$object",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getPath",196],"(",")",")",["T_WHITESPACE"," ",196],"+",["T_WHITESPACE"," ",196],["T_LNUMBER","1",196],")",";",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$path",197],["T_WHITESPACE","  ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","explode",197],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$object",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getPath",197],"(",")",")",";",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$level",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_STRING","count",198],"(",["T_VARIABLE","$path",198],")",";",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$object",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","setLevel",199],"(",["T_VARIABLE","$level",199],")",";",["T_WHITESPACE","\n            ",199],["T_IF","if",200],["T_WHITESPACE"," ",200],"(",["T_VARIABLE","$level",200],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n                ",200],["T_VARIABLE","$object",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","setParentId",201],"(",["T_VARIABLE","$path",201],"[",["T_VARIABLE","$level",201],["T_WHITESPACE"," ",201],"-",["T_WHITESPACE"," ",201],["T_LNUMBER","1",201],"]",")",";",["T_WHITESPACE","\n            ",201],"}",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$object",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","setPath",203],"(",["T_VARIABLE","$object",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getPath",203],"(",")",["T_WHITESPACE"," ",203],".",["T_WHITESPACE"," ",203],["T_CONSTANT_ENCAPSED_STRING","'\/'",203],")",";",["T_WHITESPACE","\n\n            ",203],["T_VARIABLE","$toUpdateChild",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_STRING","explode",205],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",205],",",["T_VARIABLE","$object",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getPath",205],"(",")",")",";",["T_WHITESPACE","\n\n            ",205],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_getWriteAdapter",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","update",207],"(",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getEntityTable",208],"(",")",",",["T_WHITESPACE","\n                ",208],["T_ARRAY","array",209],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count'",209],["T_WHITESPACE","  ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_NEW","new",209],["T_WHITESPACE"," ",209],["T_STRING","Zend_Db_Expr",209],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count+1'",209],")",")",",",["T_WHITESPACE","\n                ",209],["T_ARRAY","array",210],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$toUpdateChild",210],")",["T_WHITESPACE","\n            ",210],")",";",["T_WHITESPACE","\n\n        ",211],"}",["T_WHITESPACE","\n        ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],";",["T_WHITESPACE","\n    ",214],"}",["T_WHITESPACE","\n\n    ",215],["T_DOC_COMMENT","\/**\n     * Process category data after save category object\n     * save related products ids and update path value\n     *\n     * @param Varien_Object $object\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",217],["T_WHITESPACE","\n    ",223],["T_PROTECTED","protected",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","_afterSave",224],"(",["T_STRING","Varien_Object",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$object",224],")",["T_WHITESPACE","\n    ",224],"{",["T_WHITESPACE","\n        ",225],["T_DOC_COMMENT","\/**\n         * Add identifier for new category\n         *\/",226],["T_WHITESPACE","\n        ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_STRING","substr",229],"(",["T_VARIABLE","$object",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getPath",229],"(",")",",",["T_WHITESPACE"," ",229],"-",["T_LNUMBER","1",229],")",["T_WHITESPACE"," ",229],["T_IS_EQUAL","==",229],["T_WHITESPACE"," ",229],["T_CONSTANT_ENCAPSED_STRING","'\/'",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n            ",229],["T_VARIABLE","$object",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","setPath",230],"(",["T_VARIABLE","$object",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getPath",230],"(",")",["T_WHITESPACE"," ",230],".",["T_WHITESPACE"," ",230],["T_VARIABLE","$object",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getId",230],"(",")",")",";",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_savePath",231],"(",["T_VARIABLE","$object",231],")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_saveCategoryProducts",234],"(",["T_VARIABLE","$object",234],")",";",["T_WHITESPACE","\n        ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_STRING","parent",235],["T_DOUBLE_COLON","::",235],["T_STRING","_afterSave",235],"(",["T_VARIABLE","$object",235],")",";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_DOC_COMMENT","\/**\n     * Update path field\n     *\n     * @param Mage_Catalog_Model_Category $object\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",238],["T_WHITESPACE","\n    ",243],["T_PROTECTED","protected",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","_savePath",244],"(",["T_VARIABLE","$object",244],")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_IF","if",246],["T_WHITESPACE"," ",246],"(",["T_VARIABLE","$object",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getId",246],"(",")",")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_getWriteAdapter",247],"(",")",["T_OBJECT_OPERATOR","->",247],["T_STRING","update",247],"(",["T_WHITESPACE","\n                ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getEntityTable",248],"(",")",",",["T_WHITESPACE","\n                ",248],["T_ARRAY","array",249],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",249],["T_WHITESPACE"," ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$object",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getPath",249],"(",")",")",",",["T_WHITESPACE","\n                ",249],["T_ARRAY","array",250],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",250],["T_WHITESPACE"," ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$object",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getId",250],"(",")",")",["T_WHITESPACE","\n            ",250],")",";",["T_WHITESPACE","\n        ",251],"}",["T_WHITESPACE","\n        ",252],["T_RETURN","return",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],";",["T_WHITESPACE","\n    ",253],"}",["T_WHITESPACE","\n\n    ",254],["T_DOC_COMMENT","\/**\n     * Get maximum position of child categories by specific tree path\n     *\n     * @param string $path\n     * @return int\n     *\/",256],["T_WHITESPACE","\n    ",261],["T_PROTECTED","protected",262],["T_WHITESPACE"," ",262],["T_FUNCTION","function",262],["T_WHITESPACE"," ",262],["T_STRING","_getMaxPosition",262],"(",["T_VARIABLE","$path",262],")",["T_WHITESPACE","\n    ",262],"{",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$adapter",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getReadConnection",264],"(",")",";",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$positionField",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$adapter",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","quoteIdentifier",265],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",265],")",";",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$level",266],["T_WHITESPACE","   ",266],"=",["T_WHITESPACE"," ",266],["T_STRING","count",266],"(",["T_STRING","explode",266],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$path",266],")",")",";",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$bind",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_ARRAY","array",267],"(",["T_WHITESPACE","\n            ",267],["T_CONSTANT_ENCAPSED_STRING","'c_level'",268],["T_WHITESPACE"," ",268],["T_DOUBLE_ARROW","=>",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$level",268],",",["T_WHITESPACE","\n            ",268],["T_CONSTANT_ENCAPSED_STRING","'c_path'",269],["T_WHITESPACE","  ",269],["T_DOUBLE_ARROW","=>",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$path",269],["T_WHITESPACE"," ",269],".",["T_WHITESPACE"," ",269],["T_CONSTANT_ENCAPSED_STRING","'\/%'",269],["T_WHITESPACE","\n        ",269],")",";",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$select",271],["T_WHITESPACE","  ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$adapter",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","select",271],"(",")",["T_WHITESPACE","\n            ",271],["T_OBJECT_OPERATOR","->",272],["T_STRING","from",272],"(",["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getTable",272],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",272],")",",",["T_WHITESPACE"," ",272],["T_CONSTANT_ENCAPSED_STRING","'MAX('",272],["T_WHITESPACE"," ",272],".",["T_WHITESPACE"," ",272],["T_VARIABLE","$positionField",272],["T_WHITESPACE"," ",272],".",["T_WHITESPACE"," ",272],["T_CONSTANT_ENCAPSED_STRING","')'",272],")",["T_WHITESPACE","\n            ",272],["T_OBJECT_OPERATOR","->",273],["T_STRING","where",273],"(",["T_VARIABLE","$adapter",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","quoteIdentifier",273],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",273],")",["T_WHITESPACE"," ",273],".",["T_WHITESPACE"," ",273],["T_CONSTANT_ENCAPSED_STRING","' LIKE :c_path'",273],")",["T_WHITESPACE","\n            ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","where",274],"(",["T_VARIABLE","$adapter",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","quoteIdentifier",274],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",274],")",["T_WHITESPACE"," ",274],".",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","' = :c_level'",274],")",";",["T_WHITESPACE","\n\n        ",274],["T_VARIABLE","$position",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$adapter",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","fetchOne",276],"(",["T_VARIABLE","$select",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$bind",276],")",";",["T_WHITESPACE","\n        ",276],["T_IF","if",277],["T_WHITESPACE"," ",277],"(","!",["T_VARIABLE","$position",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$position",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_LNUMBER","0",278],";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n        ",279],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$position",280],";",["T_WHITESPACE","\n    ",280],"}",["T_WHITESPACE","\n\n    ",281],["T_DOC_COMMENT","\/**\n     * Save category products relation\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",283],["T_WHITESPACE","\n    ",288],["T_PROTECTED","protected",289],["T_WHITESPACE"," ",289],["T_FUNCTION","function",289],["T_WHITESPACE"," ",289],["T_STRING","_saveCategoryProducts",289],"(",["T_VARIABLE","$category",289],")",["T_WHITESPACE","\n    ",289],"{",["T_WHITESPACE","\n        ",290],["T_VARIABLE","$category",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","setIsChangedProductList",291],"(",["T_STRING","false",291],")",";",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$id",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$category",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getId",292],"(",")",";",["T_WHITESPACE","\n        ",292],["T_DOC_COMMENT","\/**\n         * new category-product relationships\n         *\/",293],["T_WHITESPACE","\n        ",295],["T_VARIABLE","$products",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$category",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getPostedProducts",296],"(",")",";",["T_WHITESPACE","\n\n        ",296],["T_DOC_COMMENT","\/**\n         * Example re-save category\n         *\/",298],["T_WHITESPACE","\n        ",300],["T_IF","if",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$products",301],["T_WHITESPACE"," ",301],["T_IS_IDENTICAL","===",301],["T_WHITESPACE"," ",301],["T_STRING","null",301],")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n            ",301],["T_RETURN","return",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE","\n\n        ",303],["T_DOC_COMMENT","\/**\n         * old category-product relationships\n         *\/",305],["T_WHITESPACE","\n        ",307],["T_VARIABLE","$oldProducts",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$category",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getProductsPosition",308],"(",")",";",["T_WHITESPACE","\n\n        ",308],["T_VARIABLE","$insert",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_STRING","array_diff_key",310],"(",["T_VARIABLE","$products",310],",",["T_WHITESPACE"," ",310],["T_VARIABLE","$oldProducts",310],")",";",["T_WHITESPACE","\n        ",310],["T_VARIABLE","$delete",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_STRING","array_diff_key",311],"(",["T_VARIABLE","$oldProducts",311],",",["T_WHITESPACE"," ",311],["T_VARIABLE","$products",311],")",";",["T_WHITESPACE","\n\n        ",311],["T_DOC_COMMENT","\/**\n         * Find product ids which are presented in both arrays\n         * and saved before (check $oldProducts array)\n         *\/",313],["T_WHITESPACE","\n        ",316],["T_VARIABLE","$update",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_STRING","array_intersect_key",317],"(",["T_VARIABLE","$products",317],",",["T_WHITESPACE"," ",317],["T_VARIABLE","$oldProducts",317],")",";",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$update",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_STRING","array_diff_assoc",318],"(",["T_VARIABLE","$update",318],",",["T_WHITESPACE"," ",318],["T_VARIABLE","$oldProducts",318],")",";",["T_WHITESPACE","\n\n        ",318],["T_VARIABLE","$adapter",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_getWriteAdapter",320],"(",")",";",["T_WHITESPACE","\n\n        ",320],["T_DOC_COMMENT","\/**\n         * Delete products from category\n         *\/",322],["T_WHITESPACE","\n        ",324],["T_IF","if",325],["T_WHITESPACE"," ",325],"(","!",["T_EMPTY","empty",325],"(",["T_VARIABLE","$delete",325],")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_VARIABLE","$cond",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_ARRAY","array",326],"(",["T_WHITESPACE","\n                ",326],["T_CONSTANT_ENCAPSED_STRING","'product_id IN(?)'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_STRING","array_keys",327],"(",["T_VARIABLE","$delete",327],")",",",["T_WHITESPACE","\n                ",327],["T_CONSTANT_ENCAPSED_STRING","'category_id=?'",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$id",328],["T_WHITESPACE","\n            ",328],")",";",["T_WHITESPACE","\n            ",329],["T_VARIABLE","$adapter",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","delete",330],"(",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_categoryProductTable",330],",",["T_WHITESPACE"," ",330],["T_VARIABLE","$cond",330],")",";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n\n        ",331],["T_DOC_COMMENT","\/**\n         * Add products to category\n         *\/",333],["T_WHITESPACE","\n        ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(","!",["T_EMPTY","empty",336],"(",["T_VARIABLE","$insert",336],")",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_VARIABLE","$data",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_ARRAY","array",337],"(",")",";",["T_WHITESPACE","\n            ",337],["T_FOREACH","foreach",338],["T_WHITESPACE"," ",338],"(",["T_VARIABLE","$insert",338],["T_WHITESPACE"," ",338],["T_AS","as",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$productId",338],["T_WHITESPACE"," ",338],["T_DOUBLE_ARROW","=>",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$position",338],")",["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$data",339],"[","]",["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_ARRAY","array",339],"(",["T_WHITESPACE","\n                    ",339],["T_CONSTANT_ENCAPSED_STRING","'category_id'",340],["T_WHITESPACE"," ",340],["T_DOUBLE_ARROW","=>",340],["T_WHITESPACE"," ",340],["T_INT_CAST","(int)",340],["T_VARIABLE","$id",340],",",["T_WHITESPACE","\n                    ",340],["T_CONSTANT_ENCAPSED_STRING","'product_id'",341],["T_WHITESPACE","  ",341],["T_DOUBLE_ARROW","=>",341],["T_WHITESPACE"," ",341],["T_INT_CAST","(int)",341],["T_VARIABLE","$productId",341],",",["T_WHITESPACE","\n                    ",341],["T_CONSTANT_ENCAPSED_STRING","'position'",342],["T_WHITESPACE","    ",342],["T_DOUBLE_ARROW","=>",342],["T_WHITESPACE"," ",342],["T_INT_CAST","(int)",342],["T_VARIABLE","$position",342],["T_WHITESPACE","\n                ",342],")",";",["T_WHITESPACE","\n            ",343],"}",["T_WHITESPACE","\n            ",344],["T_VARIABLE","$adapter",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","insertMultiple",345],"(",["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_categoryProductTable",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$data",345],")",";",["T_WHITESPACE","\n        ",345],"}",["T_WHITESPACE","\n\n        ",346],["T_DOC_COMMENT","\/**\n         * Update product positions in category\n         *\/",348],["T_WHITESPACE","\n        ",350],["T_IF","if",351],["T_WHITESPACE"," ",351],"(","!",["T_EMPTY","empty",351],"(",["T_VARIABLE","$update",351],")",")",["T_WHITESPACE"," ",351],"{",["T_WHITESPACE","\n            ",351],["T_FOREACH","foreach",352],["T_WHITESPACE"," ",352],"(",["T_VARIABLE","$update",352],["T_WHITESPACE"," ",352],["T_AS","as",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$productId",352],["T_WHITESPACE"," ",352],["T_DOUBLE_ARROW","=>",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$position",352],")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n                ",352],["T_VARIABLE","$where",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_ARRAY","array",353],"(",["T_WHITESPACE","\n                    ",353],["T_CONSTANT_ENCAPSED_STRING","'category_id = ?'",354],["T_DOUBLE_ARROW","=>",354],["T_WHITESPACE"," ",354],["T_INT_CAST","(int)",354],["T_VARIABLE","$id",354],",",["T_WHITESPACE","\n                    ",354],["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",355],["T_WHITESPACE"," ",355],["T_DOUBLE_ARROW","=>",355],["T_WHITESPACE"," ",355],["T_INT_CAST","(int)",355],["T_VARIABLE","$productId",355],["T_WHITESPACE","\n                ",355],")",";",["T_WHITESPACE","\n                ",356],["T_VARIABLE","$bind",357],["T_WHITESPACE","  ",357],"=",["T_WHITESPACE"," ",357],["T_ARRAY","array",357],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",357],["T_WHITESPACE"," ",357],["T_DOUBLE_ARROW","=>",357],["T_WHITESPACE"," ",357],["T_INT_CAST","(int)",357],["T_VARIABLE","$position",357],")",";",["T_WHITESPACE","\n                ",357],["T_VARIABLE","$adapter",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","update",358],"(",["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","_categoryProductTable",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$bind",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$where",358],")",";",["T_WHITESPACE","\n            ",358],"}",["T_WHITESPACE","\n        ",359],"}",["T_WHITESPACE","\n\n        ",360],["T_IF","if",362],["T_WHITESPACE"," ",362],"(","!",["T_EMPTY","empty",362],"(",["T_VARIABLE","$insert",362],")",["T_WHITESPACE"," ",362],["T_BOOLEAN_OR","||",362],["T_WHITESPACE"," ",362],"!",["T_EMPTY","empty",362],"(",["T_VARIABLE","$delete",362],")",")",["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n            ",362],["T_VARIABLE","$productIds",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_STRING","array_unique",363],"(",["T_STRING","array_merge",363],"(",["T_STRING","array_keys",363],"(",["T_VARIABLE","$insert",363],")",",",["T_WHITESPACE"," ",363],["T_STRING","array_keys",363],"(",["T_VARIABLE","$delete",363],")",")",")",";",["T_WHITESPACE","\n            ",363],["T_STRING","Mage",364],["T_DOUBLE_COLON","::",364],["T_STRING","dispatchEvent",364],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_category_change_products'",364],",",["T_WHITESPACE"," ",364],["T_ARRAY","array",364],"(",["T_WHITESPACE","\n                ",364],["T_CONSTANT_ENCAPSED_STRING","'category'",365],["T_WHITESPACE","      ",365],["T_DOUBLE_ARROW","=>",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$category",365],",",["T_WHITESPACE","\n                ",365],["T_CONSTANT_ENCAPSED_STRING","'product_ids'",366],["T_WHITESPACE","   ",366],["T_DOUBLE_ARROW","=>",366],["T_WHITESPACE"," ",366],["T_VARIABLE","$productIds",366],["T_WHITESPACE","\n            ",366],")",")",";",["T_WHITESPACE","\n        ",367],"}",["T_WHITESPACE","\n\n        ",368],["T_IF","if",370],["T_WHITESPACE"," ",370],"(","!",["T_EMPTY","empty",370],"(",["T_VARIABLE","$insert",370],")",["T_WHITESPACE"," ",370],["T_BOOLEAN_OR","||",370],["T_WHITESPACE"," ",370],"!",["T_EMPTY","empty",370],"(",["T_VARIABLE","$update",370],")",["T_WHITESPACE"," ",370],["T_BOOLEAN_OR","||",370],["T_WHITESPACE"," ",370],"!",["T_EMPTY","empty",370],"(",["T_VARIABLE","$delete",370],")",")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n            ",370],["T_VARIABLE","$category",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","setIsChangedProductList",371],"(",["T_STRING","true",371],")",";",["T_WHITESPACE","\n\n            ",371],["T_DOC_COMMENT","\/**\n             * Setting affected products to category for third party engine index refresh\n             *\/",373],["T_WHITESPACE","\n            ",375],["T_VARIABLE","$productIds",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_STRING","array_keys",376],"(",["T_VARIABLE","$insert",376],["T_WHITESPACE"," ",376],"+",["T_WHITESPACE"," ",376],["T_VARIABLE","$delete",376],["T_WHITESPACE"," ",376],"+",["T_WHITESPACE"," ",376],["T_VARIABLE","$update",376],")",";",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$category",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","setAffectedProductIds",377],"(",["T_VARIABLE","$productIds",377],")",";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE","\n        ",378],["T_RETURN","return",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],";",["T_WHITESPACE","\n    ",379],"}",["T_WHITESPACE","\n\n    ",380],["T_DOC_COMMENT","\/**\n     * Get positions of associated to category products\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return array\n     *\/",382],["T_WHITESPACE","\n    ",387],["T_PUBLIC","public",388],["T_WHITESPACE"," ",388],["T_FUNCTION","function",388],["T_WHITESPACE"," ",388],["T_STRING","getProductsPosition",388],"(",["T_VARIABLE","$category",388],")",["T_WHITESPACE","\n    ",388],"{",["T_WHITESPACE","\n        ",389],["T_VARIABLE","$select",390],["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","_getWriteAdapter",390],"(",")",["T_OBJECT_OPERATOR","->",390],["T_STRING","select",390],"(",")",["T_WHITESPACE","\n            ",390],["T_OBJECT_OPERATOR","->",391],["T_STRING","from",391],"(",["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","_categoryProductTable",391],",",["T_WHITESPACE"," ",391],["T_ARRAY","array",391],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",391],",",["T_WHITESPACE"," ",391],["T_CONSTANT_ENCAPSED_STRING","'position'",391],")",")",["T_WHITESPACE","\n            ",391],["T_OBJECT_OPERATOR","->",392],["T_STRING","where",392],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id = :category_id'",392],")",";",["T_WHITESPACE","\n        ",392],["T_VARIABLE","$bind",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_ARRAY","array",393],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",393],["T_WHITESPACE"," ",393],["T_DOUBLE_ARROW","=>",393],["T_WHITESPACE"," ",393],["T_INT_CAST","(int)",393],["T_VARIABLE","$category",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getId",393],"(",")",")",";",["T_WHITESPACE","\n\n        ",393],["T_RETURN","return",395],["T_WHITESPACE"," ",395],["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","_getWriteAdapter",395],"(",")",["T_OBJECT_OPERATOR","->",395],["T_STRING","fetchPairs",395],"(",["T_VARIABLE","$select",395],",",["T_WHITESPACE"," ",395],["T_VARIABLE","$bind",395],")",";",["T_WHITESPACE","\n    ",395],"}",["T_WHITESPACE","\n\n    ",396],["T_DOC_COMMENT","\/**\n     * Get chlden categories count\n     *\n     * @param int $categoryId\n     * @return int\n     *\/",398],["T_WHITESPACE","\n    ",403],["T_PUBLIC","public",404],["T_WHITESPACE"," ",404],["T_FUNCTION","function",404],["T_WHITESPACE"," ",404],["T_STRING","getChildrenCount",404],"(",["T_VARIABLE","$categoryId",404],")",["T_WHITESPACE","\n    ",404],"{",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$select",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_getReadAdapter",406],"(",")",["T_OBJECT_OPERATOR","->",406],["T_STRING","select",406],"(",")",["T_WHITESPACE","\n            ",406],["T_OBJECT_OPERATOR","->",407],["T_STRING","from",407],"(",["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getEntityTable",407],"(",")",",",["T_WHITESPACE"," ",407],["T_CONSTANT_ENCAPSED_STRING","'children_count'",407],")",["T_WHITESPACE","\n            ",407],["T_OBJECT_OPERATOR","->",408],["T_STRING","where",408],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",408],")",";",["T_WHITESPACE","\n        ",408],["T_VARIABLE","$bind",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_ARRAY","array",409],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",409],["T_WHITESPACE"," ",409],["T_DOUBLE_ARROW","=>",409],["T_WHITESPACE"," ",409],["T_VARIABLE","$categoryId",409],")",";",["T_WHITESPACE","\n\n        ",409],["T_RETURN","return",411],["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_getReadAdapter",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","fetchOne",411],"(",["T_VARIABLE","$select",411],",",["T_WHITESPACE"," ",411],["T_VARIABLE","$bind",411],")",";",["T_WHITESPACE","\n    ",411],"}",["T_WHITESPACE","\n\n    ",412],["T_DOC_COMMENT","\/**\n     * Check if category id exist\n     *\n     * @param int $entityId\n     * @return bool\n     *\/",414],["T_WHITESPACE","\n    ",419],["T_PUBLIC","public",420],["T_WHITESPACE"," ",420],["T_FUNCTION","function",420],["T_WHITESPACE"," ",420],["T_STRING","checkId",420],"(",["T_VARIABLE","$entityId",420],")",["T_WHITESPACE","\n    ",420],"{",["T_WHITESPACE","\n        ",421],["T_VARIABLE","$select",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_getReadAdapter",422],"(",")",["T_OBJECT_OPERATOR","->",422],["T_STRING","select",422],"(",")",["T_WHITESPACE","\n            ",422],["T_OBJECT_OPERATOR","->",423],["T_STRING","from",423],"(",["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getEntityTable",423],"(",")",",",["T_WHITESPACE"," ",423],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",423],")",["T_WHITESPACE","\n            ",423],["T_OBJECT_OPERATOR","->",424],["T_STRING","where",424],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",424],")",";",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$bind",425],["T_WHITESPACE"," ",425],"=",["T_WHITESPACE","  ",425],["T_ARRAY","array",425],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",425],["T_WHITESPACE"," ",425],["T_DOUBLE_ARROW","=>",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$entityId",425],")",";",["T_WHITESPACE","\n\n        ",425],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_getReadAdapter",427],"(",")",["T_OBJECT_OPERATOR","->",427],["T_STRING","fetchOne",427],"(",["T_VARIABLE","$select",427],",",["T_WHITESPACE"," ",427],["T_VARIABLE","$bind",427],")",";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n\n    ",428],["T_DOC_COMMENT","\/**\n     * Check array of category identifiers\n     *\n     * @param array $ids\n     * @return array\n     *\/",430],["T_WHITESPACE","\n    ",435],["T_PUBLIC","public",436],["T_WHITESPACE"," ",436],["T_FUNCTION","function",436],["T_WHITESPACE"," ",436],["T_STRING","verifyIds",436],"(",["T_ARRAY","array",436],["T_WHITESPACE"," ",436],["T_VARIABLE","$ids",436],")",["T_WHITESPACE","\n    ",436],"{",["T_WHITESPACE","\n        ",437],["T_IF","if",438],["T_WHITESPACE"," ",438],"(",["T_EMPTY","empty",438],"(",["T_VARIABLE","$ids",438],")",")",["T_WHITESPACE"," ",438],"{",["T_WHITESPACE","\n            ",438],["T_RETURN","return",439],["T_WHITESPACE"," ",439],["T_ARRAY","array",439],"(",")",";",["T_WHITESPACE","\n        ",439],"}",["T_WHITESPACE","\n\n        ",440],["T_VARIABLE","$select",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","_getReadAdapter",442],"(",")",["T_OBJECT_OPERATOR","->",442],["T_STRING","select",442],"(",")",["T_WHITESPACE","\n            ",442],["T_OBJECT_OPERATOR","->",443],["T_STRING","from",443],"(",["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getEntityTable",443],"(",")",",",["T_WHITESPACE"," ",443],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",443],")",["T_WHITESPACE","\n            ",443],["T_OBJECT_OPERATOR","->",444],["T_STRING","where",444],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",444],",",["T_WHITESPACE"," ",444],["T_VARIABLE","$ids",444],")",";",["T_WHITESPACE","\n\n        ",444],["T_RETURN","return",446],["T_WHITESPACE"," ",446],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","_getReadAdapter",446],"(",")",["T_OBJECT_OPERATOR","->",446],["T_STRING","fetchCol",446],"(",["T_VARIABLE","$select",446],")",";",["T_WHITESPACE","\n    ",446],"}",["T_WHITESPACE","\n\n    ",447],["T_DOC_COMMENT","\/**\n     * Get count of active\/not active children categories\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @param bool $isActiveFlag\n     * @return int\n     *\/",449],["T_WHITESPACE","\n    ",455],["T_PUBLIC","public",456],["T_WHITESPACE"," ",456],["T_FUNCTION","function",456],["T_WHITESPACE"," ",456],["T_STRING","getChildrenAmount",456],"(",["T_VARIABLE","$category",456],",",["T_WHITESPACE"," ",456],["T_VARIABLE","$isActiveFlag",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_STRING","true",456],")",["T_WHITESPACE","\n    ",456],"{",["T_WHITESPACE","\n        ",457],["T_VARIABLE","$storeId",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_STRING","Mage",458],["T_DOUBLE_COLON","::",458],["T_STRING","app",458],"(",")",["T_OBJECT_OPERATOR","->",458],["T_STRING","getStore",458],"(",")",["T_OBJECT_OPERATOR","->",458],["T_STRING","getId",458],"(",")",";",["T_WHITESPACE","\n        ",458],["T_VARIABLE","$attributeId",459],["T_WHITESPACE"," ",459],"=",["T_WHITESPACE"," ",459],["T_VARIABLE","$this",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","_getIsActiveAttributeId",459],"(",")",";",["T_WHITESPACE","\n        ",459],["T_VARIABLE","$table",460],["T_WHITESPACE","   ",460],"=",["T_WHITESPACE"," ",460],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getTable",460],"(",["T_ARRAY","array",460],"(",["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getEntityTablePrefix",460],"(",")",",",["T_WHITESPACE"," ",460],["T_CONSTANT_ENCAPSED_STRING","'int'",460],")",")",";",["T_WHITESPACE","\n        ",460],["T_VARIABLE","$adapter",461],["T_WHITESPACE"," ",461],"=",["T_WHITESPACE"," ",461],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","_getReadAdapter",461],"(",")",";",["T_WHITESPACE","\n        ",461],["T_VARIABLE","$checkSql",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_VARIABLE","$adapter",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","getCheckSql",462],"(",["T_CONSTANT_ENCAPSED_STRING","'c.value_id > 0'",462],",",["T_WHITESPACE"," ",462],["T_CONSTANT_ENCAPSED_STRING","'c.value'",462],",",["T_WHITESPACE"," ",462],["T_CONSTANT_ENCAPSED_STRING","'d.value'",462],")",";",["T_WHITESPACE","\n\n        ",462],["T_VARIABLE","$bind",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_ARRAY","array",464],"(",["T_WHITESPACE","\n            ",464],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",465],["T_WHITESPACE"," ",465],["T_DOUBLE_ARROW","=>",465],["T_WHITESPACE"," ",465],["T_VARIABLE","$attributeId",465],",",["T_WHITESPACE","\n            ",465],["T_CONSTANT_ENCAPSED_STRING","'store_id'",466],["T_WHITESPACE","     ",466],["T_DOUBLE_ARROW","=>",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$storeId",466],",",["T_WHITESPACE","\n            ",466],["T_CONSTANT_ENCAPSED_STRING","'active_flag'",467],["T_WHITESPACE","  ",467],["T_DOUBLE_ARROW","=>",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$isActiveFlag",467],",",["T_WHITESPACE","\n            ",467],["T_CONSTANT_ENCAPSED_STRING","'c_path'",468],["T_WHITESPACE","       ",468],["T_DOUBLE_ARROW","=>",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$category",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getPath",468],"(",")",["T_WHITESPACE"," ",468],".",["T_WHITESPACE"," ",468],["T_CONSTANT_ENCAPSED_STRING","'\/%'",468],["T_WHITESPACE","\n        ",468],")",";",["T_WHITESPACE","\n        ",469],["T_VARIABLE","$select",470],["T_WHITESPACE"," ",470],"=",["T_WHITESPACE"," ",470],["T_VARIABLE","$adapter",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","select",470],"(",")",["T_WHITESPACE","\n            ",470],["T_OBJECT_OPERATOR","->",471],["T_STRING","from",471],"(",["T_ARRAY","array",471],"(",["T_CONSTANT_ENCAPSED_STRING","'m'",471],["T_WHITESPACE"," ",471],["T_DOUBLE_ARROW","=>",471],["T_WHITESPACE"," ",471],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getEntityTable",471],"(",")",")",",",["T_WHITESPACE"," ",471],["T_ARRAY","array",471],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(m.entity_id)'",471],")",")",["T_WHITESPACE","\n            ",471],["T_OBJECT_OPERATOR","->",472],["T_STRING","joinLeft",472],"(",["T_WHITESPACE","\n                ",472],["T_ARRAY","array",473],"(",["T_CONSTANT_ENCAPSED_STRING","'d'",473],["T_WHITESPACE"," ",473],["T_DOUBLE_ARROW","=>",473],["T_WHITESPACE"," ",473],["T_VARIABLE","$table",473],")",",",["T_WHITESPACE","\n                ",473],["T_CONSTANT_ENCAPSED_STRING","'d.attribute_id = :attribute_id AND d.store_id = 0 AND d.entity_id = m.entity_id'",474],",",["T_WHITESPACE","\n                ",474],["T_ARRAY","array",475],"(",")",["T_WHITESPACE","\n            ",475],")",["T_WHITESPACE","\n            ",476],["T_OBJECT_OPERATOR","->",477],["T_STRING","joinLeft",477],"(",["T_WHITESPACE","\n                ",477],["T_ARRAY","array",478],"(",["T_CONSTANT_ENCAPSED_STRING","'c'",478],["T_WHITESPACE"," ",478],["T_DOUBLE_ARROW","=>",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$table",478],")",",",["T_WHITESPACE","\n                ",478],["T_CONSTANT_ENCAPSED_STRING","\"c.attribute_id = :attribute_id AND c.store_id = :store_id AND c.entity_id = m.entity_id\"",479],",",["T_WHITESPACE","\n                ",479],["T_ARRAY","array",480],"(",")",["T_WHITESPACE","\n            ",480],")",["T_WHITESPACE","\n            ",481],["T_OBJECT_OPERATOR","->",482],["T_STRING","where",482],"(",["T_CONSTANT_ENCAPSED_STRING","'m.path LIKE :c_path'",482],")",["T_WHITESPACE","\n            ",482],["T_OBJECT_OPERATOR","->",483],["T_STRING","where",483],"(",["T_VARIABLE","$checkSql",483],["T_WHITESPACE"," ",483],".",["T_WHITESPACE"," ",483],["T_CONSTANT_ENCAPSED_STRING","' = :active_flag'",483],")",";",["T_WHITESPACE","\n\n        ",483],["T_RETURN","return",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","_getReadAdapter",485],"(",")",["T_OBJECT_OPERATOR","->",485],["T_STRING","fetchOne",485],"(",["T_VARIABLE","$select",485],",",["T_WHITESPACE"," ",485],["T_VARIABLE","$bind",485],")",";",["T_WHITESPACE","\n    ",485],"}",["T_WHITESPACE","\n\n    ",486],["T_DOC_COMMENT","\/**\n     * Get \"is_active\" attribute identifier\n     *\n     * @return int\n     *\/",488],["T_WHITESPACE","\n    ",492],["T_PROTECTED","protected",493],["T_WHITESPACE"," ",493],["T_FUNCTION","function",493],["T_WHITESPACE"," ",493],["T_STRING","_getIsActiveAttributeId",493],"(",")",["T_WHITESPACE","\n    ",493],"{",["T_WHITESPACE","\n        ",494],["T_IF","if",495],["T_WHITESPACE"," ",495],"(",["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","_isActiveAttributeId",495],["T_WHITESPACE"," ",495],["T_IS_IDENTICAL","===",495],["T_WHITESPACE"," ",495],["T_STRING","null",495],")",["T_WHITESPACE"," ",495],"{",["T_WHITESPACE","\n            ",495],["T_VARIABLE","$bind",496],["T_WHITESPACE"," ",496],"=",["T_WHITESPACE"," ",496],["T_ARRAY","array",496],"(",["T_WHITESPACE","\n                ",496],["T_CONSTANT_ENCAPSED_STRING","'catalog_category'",497],["T_WHITESPACE"," ",497],["T_DOUBLE_ARROW","=>",497],["T_WHITESPACE"," ",497],["T_STRING","Mage_Catalog_Model_Category",497],["T_DOUBLE_COLON","::",497],["T_STRING","ENTITY",497],",",["T_WHITESPACE","\n                ",497],["T_CONSTANT_ENCAPSED_STRING","'is_active'",498],["T_WHITESPACE","        ",498],["T_DOUBLE_ARROW","=>",498],["T_WHITESPACE"," ",498],["T_CONSTANT_ENCAPSED_STRING","'is_active'",498],",",["T_WHITESPACE","\n            ",498],")",";",["T_WHITESPACE","\n            ",499],["T_VARIABLE","$select",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","_getReadAdapter",500],"(",")",["T_OBJECT_OPERATOR","->",500],["T_STRING","select",500],"(",")",["T_WHITESPACE","\n                ",500],["T_OBJECT_OPERATOR","->",501],["T_STRING","from",501],"(",["T_ARRAY","array",501],"(",["T_CONSTANT_ENCAPSED_STRING","'a'",501],["T_DOUBLE_ARROW","=>",501],["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getTable",501],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/attribute'",501],")",")",",",["T_WHITESPACE"," ",501],["T_ARRAY","array",501],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",501],")",")",["T_WHITESPACE","\n                ",501],["T_OBJECT_OPERATOR","->",502],["T_STRING","join",502],"(",["T_ARRAY","array",502],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",502],["T_DOUBLE_ARROW","=>",502],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getTable",502],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/entity_type'",502],")",")",",",["T_WHITESPACE"," ",502],["T_CONSTANT_ENCAPSED_STRING","'a.entity_type_id = t.entity_type_id'",502],")",["T_WHITESPACE","\n                ",502],["T_OBJECT_OPERATOR","->",503],["T_STRING","where",503],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_type_code = :catalog_category'",503],")",["T_WHITESPACE","\n                ",503],["T_OBJECT_OPERATOR","->",504],["T_STRING","where",504],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_code = :is_active'",504],")",";",["T_WHITESPACE","\n\n            ",504],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","_isActiveAttributeId",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","_getReadAdapter",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","fetchOne",506],"(",["T_VARIABLE","$select",506],",",["T_WHITESPACE"," ",506],["T_VARIABLE","$bind",506],")",";",["T_WHITESPACE","\n        ",506],"}",["T_WHITESPACE","\n\n        ",507],["T_RETURN","return",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","_isActiveAttributeId",509],";",["T_WHITESPACE","\n    ",509],"}",["T_WHITESPACE","\n\n    ",510],["T_DOC_COMMENT","\/**\n     * Return entities where attribute value is\n     *\n     * @param array|int $entityIdsFilter\n     * @param Mage_Eav_Model_Entity_Attribute $attribute\n     * @param mixed $expectedValue\n     * @return array\n     *\/",512],["T_WHITESPACE","\n    ",519],["T_PUBLIC","public",520],["T_WHITESPACE"," ",520],["T_FUNCTION","function",520],["T_WHITESPACE"," ",520],["T_STRING","findWhereAttributeIs",520],"(",["T_VARIABLE","$entityIdsFilter",520],",",["T_WHITESPACE"," ",520],["T_VARIABLE","$attribute",520],",",["T_WHITESPACE"," ",520],["T_VARIABLE","$expectedValue",520],")",["T_WHITESPACE","\n    ",520],"{",["T_WHITESPACE","\n        ",521],["T_VARIABLE","$bind",522],["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_ARRAY","array",522],"(",["T_WHITESPACE","\n            ",522],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",523],["T_WHITESPACE"," ",523],["T_DOUBLE_ARROW","=>",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$attribute",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","getId",523],"(",")",",",["T_WHITESPACE","\n            ",523],["T_CONSTANT_ENCAPSED_STRING","'value'",524],["T_WHITESPACE","        ",524],["T_DOUBLE_ARROW","=>",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$expectedValue",524],["T_WHITESPACE","\n        ",524],")",";",["T_WHITESPACE","\n        ",525],["T_VARIABLE","$select",526],["T_WHITESPACE"," ",526],"=",["T_WHITESPACE"," ",526],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","_getReadAdapter",526],"(",")",["T_OBJECT_OPERATOR","->",526],["T_STRING","select",526],"(",")",["T_WHITESPACE","\n            ",526],["T_OBJECT_OPERATOR","->",527],["T_STRING","from",527],"(",["T_VARIABLE","$attribute",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getBackend",527],"(",")",["T_OBJECT_OPERATOR","->",527],["T_STRING","getTable",527],"(",")",",",["T_WHITESPACE"," ",527],["T_ARRAY","array",527],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",527],")",")",["T_WHITESPACE","\n            ",527],["T_OBJECT_OPERATOR","->",528],["T_STRING","where",528],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = :attribute_id'",528],")",["T_WHITESPACE","\n            ",528],["T_OBJECT_OPERATOR","->",529],["T_STRING","where",529],"(",["T_CONSTANT_ENCAPSED_STRING","'value = :value'",529],")",["T_WHITESPACE","\n            ",529],["T_OBJECT_OPERATOR","->",530],["T_STRING","where",530],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",530],",",["T_WHITESPACE"," ",530],["T_VARIABLE","$entityIdsFilter",530],")",";",["T_WHITESPACE","\n\n        ",530],["T_RETURN","return",532],["T_WHITESPACE"," ",532],["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","_getReadAdapter",532],"(",")",["T_OBJECT_OPERATOR","->",532],["T_STRING","fetchCol",532],"(",["T_VARIABLE","$select",532],",",["T_WHITESPACE"," ",532],["T_VARIABLE","$bind",532],")",";",["T_WHITESPACE","\n    ",532],"}",["T_WHITESPACE","\n\n    ",533],["T_DOC_COMMENT","\/**\n     * Get products count in category\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return int\n     *\/",535],["T_WHITESPACE","\n    ",540],["T_PUBLIC","public",541],["T_WHITESPACE"," ",541],["T_FUNCTION","function",541],["T_WHITESPACE"," ",541],["T_STRING","getProductCount",541],"(",["T_VARIABLE","$category",541],")",["T_WHITESPACE","\n    ",541],"{",["T_WHITESPACE","\n        ",542],["T_VARIABLE","$productTable",543],["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_STRING","Mage",543],["T_DOUBLE_COLON","::",543],["T_STRING","getSingleton",543],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource'",543],")",["T_OBJECT_OPERATOR","->",543],["T_STRING","getTableName",543],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",543],")",";",["T_WHITESPACE","\n\n        ",543],["T_VARIABLE","$select",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","getReadConnection",545],"(",")",["T_OBJECT_OPERATOR","->",545],["T_STRING","select",545],"(",")",["T_WHITESPACE","\n            ",545],["T_OBJECT_OPERATOR","->",546],["T_STRING","from",546],"(",["T_WHITESPACE","\n                ",546],["T_ARRAY","array",547],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table'",547],["T_WHITESPACE"," ",547],["T_DOUBLE_ARROW","=>",547],["T_WHITESPACE"," ",547],["T_VARIABLE","$productTable",547],")",",",["T_WHITESPACE","\n                ",547],["T_ARRAY","array",548],"(",["T_NEW","new",548],["T_WHITESPACE"," ",548],["T_STRING","Zend_Db_Expr",548],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(main_table.product_id)'",548],")",")",["T_WHITESPACE","\n            ",548],")",["T_WHITESPACE","\n            ",549],["T_OBJECT_OPERATOR","->",550],["T_STRING","where",550],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.category_id = :category_id'",550],")",";",["T_WHITESPACE","\n\n        ",550],["T_VARIABLE","$bind",552],["T_WHITESPACE"," ",552],"=",["T_WHITESPACE"," ",552],["T_ARRAY","array",552],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",552],["T_WHITESPACE"," ",552],["T_DOUBLE_ARROW","=>",552],["T_WHITESPACE"," ",552],["T_INT_CAST","(int)",552],["T_VARIABLE","$category",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","getId",552],"(",")",")",";",["T_WHITESPACE","\n        ",552],["T_VARIABLE","$counts",553],["T_WHITESPACE"," ",553],"=",["T_WHITESPACE"," ",553],["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","getReadConnection",553],"(",")",["T_OBJECT_OPERATOR","->",553],["T_STRING","fetchOne",553],"(",["T_VARIABLE","$select",553],",",["T_WHITESPACE"," ",553],["T_VARIABLE","$bind",553],")",";",["T_WHITESPACE","\n\n        ",553],["T_RETURN","return",555],["T_WHITESPACE"," ",555],["T_STRING","intval",555],"(",["T_VARIABLE","$counts",555],")",";",["T_WHITESPACE","\n    ",555],"}",["T_WHITESPACE","\n\n    ",556],["T_DOC_COMMENT","\/**\n     * Retrieve categories\n     *\n     * @param integer $parent\n     * @param integer $recursionLevel\n     * @param boolean|string $sorted\n     * @param boolean $asCollection\n     * @param boolean $toLoad\n     * @return Varien_Data_Tree_Node_Collection|Mage_Catalog_Model_Resource_Category_Collection\n     *\/",558],["T_WHITESPACE","\n    ",567],["T_PUBLIC","public",568],["T_WHITESPACE"," ",568],["T_FUNCTION","function",568],["T_WHITESPACE"," ",568],["T_STRING","getCategories",568],"(",["T_VARIABLE","$parent",568],",",["T_WHITESPACE"," ",568],["T_VARIABLE","$recursionLevel",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_LNUMBER","0",568],",",["T_WHITESPACE"," ",568],["T_VARIABLE","$sorted",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_STRING","false",568],",",["T_WHITESPACE"," ",568],["T_VARIABLE","$asCollection",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_STRING","false",568],",",["T_WHITESPACE"," ",568],["T_VARIABLE","$toLoad",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_STRING","true",568],")",["T_WHITESPACE","\n    ",568],"{",["T_WHITESPACE","\n        ",569],["T_VARIABLE","$tree",570],["T_WHITESPACE"," ",570],"=",["T_WHITESPACE"," ",570],["T_STRING","Mage",570],["T_DOUBLE_COLON","::",570],["T_STRING","getResourceModel",570],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_tree'",570],")",";",["T_WHITESPACE","\n        ",570],["T_COMMENT","\/* @var $tree Mage_Catalog_Model_Resource_Category_Tree *\/",571],["T_WHITESPACE","\n        ",571],["T_VARIABLE","$nodes",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$tree",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","loadNode",572],"(",["T_VARIABLE","$parent",572],")",["T_WHITESPACE","\n            ",572],["T_OBJECT_OPERATOR","->",573],["T_STRING","loadChildren",573],"(",["T_VARIABLE","$recursionLevel",573],")",["T_WHITESPACE","\n            ",573],["T_OBJECT_OPERATOR","->",574],["T_STRING","getChildren",574],"(",")",";",["T_WHITESPACE","\n\n        ",574],["T_VARIABLE","$tree",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","addCollectionData",576],"(",["T_STRING","null",576],",",["T_WHITESPACE"," ",576],["T_VARIABLE","$sorted",576],",",["T_WHITESPACE"," ",576],["T_VARIABLE","$parent",576],",",["T_WHITESPACE"," ",576],["T_VARIABLE","$toLoad",576],",",["T_WHITESPACE"," ",576],["T_STRING","true",576],")",";",["T_WHITESPACE","\n\n        ",576],["T_IF","if",578],["T_WHITESPACE"," ",578],"(",["T_VARIABLE","$asCollection",578],")",["T_WHITESPACE"," ",578],"{",["T_WHITESPACE","\n            ",578],["T_RETURN","return",579],["T_WHITESPACE"," ",579],["T_VARIABLE","$tree",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","getCollection",579],"(",")",";",["T_WHITESPACE","\n        ",579],"}",["T_WHITESPACE","\n        ",580],["T_RETURN","return",581],["T_WHITESPACE"," ",581],["T_VARIABLE","$nodes",581],";",["T_WHITESPACE","\n    ",581],"}",["T_WHITESPACE","\n\n    ",582],["T_DOC_COMMENT","\/**\n     * Return parent categories of category\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return array\n     *\/",584],["T_WHITESPACE","\n    ",589],["T_PUBLIC","public",590],["T_WHITESPACE"," ",590],["T_FUNCTION","function",590],["T_WHITESPACE"," ",590],["T_STRING","getParentCategories",590],"(",["T_VARIABLE","$category",590],")",["T_WHITESPACE","\n    ",590],"{",["T_WHITESPACE","\n        ",591],["T_VARIABLE","$pathIds",592],["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_STRING","array_reverse",592],"(",["T_STRING","explode",592],"(",["T_CONSTANT_ENCAPSED_STRING","','",592],",",["T_WHITESPACE"," ",592],["T_VARIABLE","$category",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","getPathInStore",592],"(",")",")",")",";",["T_WHITESPACE","\n        ",592],["T_VARIABLE","$categories",593],["T_WHITESPACE"," ",593],"=",["T_WHITESPACE"," ",593],["T_STRING","Mage",593],["T_DOUBLE_COLON","::",593],["T_STRING","getResourceModel",593],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_collection'",593],")",["T_WHITESPACE","\n            ",593],["T_OBJECT_OPERATOR","->",594],["T_STRING","setStore",594],"(",["T_STRING","Mage",594],["T_DOUBLE_COLON","::",594],["T_STRING","app",594],"(",")",["T_OBJECT_OPERATOR","->",594],["T_STRING","getStore",594],"(",")",")",["T_WHITESPACE","\n            ",594],["T_OBJECT_OPERATOR","->",595],["T_STRING","addAttributeToSelect",595],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",595],")",["T_WHITESPACE","\n            ",595],["T_OBJECT_OPERATOR","->",596],["T_STRING","addAttributeToSelect",596],"(",["T_CONSTANT_ENCAPSED_STRING","'url_key'",596],")",["T_WHITESPACE","\n            ",596],["T_OBJECT_OPERATOR","->",597],["T_STRING","addFieldToFilter",597],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",597],",",["T_WHITESPACE"," ",597],["T_ARRAY","array",597],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",597],["T_WHITESPACE"," ",597],["T_DOUBLE_ARROW","=>",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$pathIds",597],")",")",["T_WHITESPACE","\n            ",597],["T_OBJECT_OPERATOR","->",598],["T_STRING","addFieldToFilter",598],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active'",598],",",["T_WHITESPACE"," ",598],["T_LNUMBER","1",598],")",["T_WHITESPACE","\n            ",598],["T_OBJECT_OPERATOR","->",599],["T_STRING","load",599],"(",")",["T_WHITESPACE","\n            ",599],["T_OBJECT_OPERATOR","->",600],["T_STRING","getItems",600],"(",")",";",["T_WHITESPACE","\n        ",600],["T_RETURN","return",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$categories",601],";",["T_WHITESPACE","\n    ",601],"}",["T_WHITESPACE","\n\n    ",602],["T_DOC_COMMENT","\/**\n     * Return parent category of current category with own custom design settings\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return Mage_Catalog_Model_Category\n     *\/",604],["T_WHITESPACE","\n    ",609],["T_PUBLIC","public",610],["T_WHITESPACE"," ",610],["T_FUNCTION","function",610],["T_WHITESPACE"," ",610],["T_STRING","getParentDesignCategory",610],"(",["T_VARIABLE","$category",610],")",["T_WHITESPACE","\n    ",610],"{",["T_WHITESPACE","\n        ",611],["T_VARIABLE","$pathIds",612],["T_WHITESPACE"," ",612],"=",["T_WHITESPACE"," ",612],["T_STRING","array_reverse",612],"(",["T_VARIABLE","$category",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","getPathIds",612],"(",")",")",";",["T_WHITESPACE","\n        ",612],["T_VARIABLE","$collection",613],["T_WHITESPACE"," ",613],"=",["T_WHITESPACE"," ",613],["T_VARIABLE","$category",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","getCollection",613],"(",")",["T_WHITESPACE","\n            ",613],["T_OBJECT_OPERATOR","->",614],["T_STRING","setStore",614],"(",["T_STRING","Mage",614],["T_DOUBLE_COLON","::",614],["T_STRING","app",614],"(",")",["T_OBJECT_OPERATOR","->",614],["T_STRING","getStore",614],"(",")",")",["T_WHITESPACE","\n            ",614],["T_OBJECT_OPERATOR","->",615],["T_STRING","addAttributeToSelect",615],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_design'",615],")",["T_WHITESPACE","\n            ",615],["T_OBJECT_OPERATOR","->",616],["T_STRING","addAttributeToSelect",616],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_design_from'",616],")",["T_WHITESPACE","\n            ",616],["T_OBJECT_OPERATOR","->",617],["T_STRING","addAttributeToSelect",617],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_design_to'",617],")",["T_WHITESPACE","\n            ",617],["T_OBJECT_OPERATOR","->",618],["T_STRING","addAttributeToSelect",618],"(",["T_CONSTANT_ENCAPSED_STRING","'page_layout'",618],")",["T_WHITESPACE","\n            ",618],["T_OBJECT_OPERATOR","->",619],["T_STRING","addAttributeToSelect",619],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_layout_update'",619],")",["T_WHITESPACE","\n            ",619],["T_OBJECT_OPERATOR","->",620],["T_STRING","addAttributeToSelect",620],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_apply_to_products'",620],")",["T_WHITESPACE","\n            ",620],["T_OBJECT_OPERATOR","->",621],["T_STRING","addFieldToFilter",621],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",621],",",["T_WHITESPACE"," ",621],["T_ARRAY","array",621],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",621],["T_WHITESPACE"," ",621],["T_DOUBLE_ARROW","=>",621],["T_WHITESPACE"," ",621],["T_VARIABLE","$pathIds",621],")",")",["T_WHITESPACE","\n            ",621],["T_OBJECT_OPERATOR","->",622],["T_STRING","addAttributeToFilter",622],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_use_parent_settings'",622],",",["T_WHITESPACE"," ",622],["T_ARRAY","array",622],"(",["T_ARRAY","array",622],"(",["T_CONSTANT_ENCAPSED_STRING","'eq'",622],["T_WHITESPACE"," ",622],["T_DOUBLE_ARROW","=>",622],["T_WHITESPACE"," ",622],["T_LNUMBER","0",622],")",",",["T_WHITESPACE"," ",622],["T_ARRAY","array",622],"(",["T_CONSTANT_ENCAPSED_STRING","'null'",622],["T_WHITESPACE"," ",622],["T_DOUBLE_ARROW","=>",622],["T_WHITESPACE"," ",622],["T_LNUMBER","0",622],")",")",",",["T_WHITESPACE"," ",622],["T_CONSTANT_ENCAPSED_STRING","'left'",622],")",["T_WHITESPACE","\n            ",622],["T_OBJECT_OPERATOR","->",623],["T_STRING","addFieldToFilter",623],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",623],",",["T_WHITESPACE"," ",623],["T_ARRAY","array",623],"(",["T_CONSTANT_ENCAPSED_STRING","'neq'",623],["T_WHITESPACE"," ",623],["T_DOUBLE_ARROW","=>",623],["T_WHITESPACE"," ",623],["T_LNUMBER","0",623],")",")",["T_WHITESPACE","\n            ",623],["T_OBJECT_OPERATOR","->",624],["T_STRING","setOrder",624],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",624],",",["T_WHITESPACE"," ",624],["T_CONSTANT_ENCAPSED_STRING","'DESC'",624],")",["T_WHITESPACE","\n            ",624],["T_OBJECT_OPERATOR","->",625],["T_STRING","load",625],"(",")",";",["T_WHITESPACE","\n        ",625],["T_RETURN","return",626],["T_WHITESPACE"," ",626],["T_VARIABLE","$collection",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getFirstItem",626],"(",")",";",["T_WHITESPACE","\n    ",626],"}",["T_WHITESPACE","\n\n    ",627],["T_DOC_COMMENT","\/**\n     * Prepare base collection setup for get categories list\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return Mage_Catalog_Model_Resource_Category_Collection\n     *\/",629],["T_WHITESPACE","\n    ",634],["T_PROTECTED","protected",635],["T_WHITESPACE"," ",635],["T_FUNCTION","function",635],["T_WHITESPACE"," ",635],["T_STRING","_getChildrenCategoriesBase",635],"(",["T_VARIABLE","$category",635],")",["T_WHITESPACE","\n    ",635],"{",["T_WHITESPACE","\n        ",636],["T_VARIABLE","$collection",637],["T_WHITESPACE"," ",637],"=",["T_WHITESPACE"," ",637],["T_VARIABLE","$category",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","getCollection",637],"(",")",";",["T_WHITESPACE","\n        ",637],["T_VARIABLE","$collection",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","addAttributeToSelect",638],"(",["T_CONSTANT_ENCAPSED_STRING","'url_key'",638],")",["T_WHITESPACE","\n            ",638],["T_OBJECT_OPERATOR","->",639],["T_STRING","addAttributeToSelect",639],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",639],")",["T_WHITESPACE","\n            ",639],["T_OBJECT_OPERATOR","->",640],["T_STRING","addAttributeToSelect",640],"(",["T_CONSTANT_ENCAPSED_STRING","'all_children'",640],")",["T_WHITESPACE","\n            ",640],["T_OBJECT_OPERATOR","->",641],["T_STRING","addAttributeToSelect",641],"(",["T_CONSTANT_ENCAPSED_STRING","'is_anchor'",641],")",["T_WHITESPACE","\n            ",641],["T_OBJECT_OPERATOR","->",642],["T_STRING","setOrder",642],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",642],",",["T_WHITESPACE"," ",642],["T_STRING","Varien_Db_Select",642],["T_DOUBLE_COLON","::",642],["T_STRING","SQL_ASC",642],")",["T_WHITESPACE","\n            ",642],["T_OBJECT_OPERATOR","->",643],["T_STRING","joinUrlRewrite",643],"(",")",";",["T_WHITESPACE","\n\n        ",643],["T_RETURN","return",645],["T_WHITESPACE"," ",645],["T_VARIABLE","$collection",645],";",["T_WHITESPACE","\n    ",645],"}",["T_WHITESPACE","\n\n\n    ",646],["T_DOC_COMMENT","\/**\n     * Return child categories\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return Mage_Catalog_Model_Resource_Category_Collection\n     *\/",649],["T_WHITESPACE","\n    ",654],["T_PUBLIC","public",655],["T_WHITESPACE"," ",655],["T_FUNCTION","function",655],["T_WHITESPACE"," ",655],["T_STRING","getChildrenCategories",655],"(",["T_VARIABLE","$category",655],")",["T_WHITESPACE","\n    ",655],"{",["T_WHITESPACE","\n        ",656],["T_VARIABLE","$collection",657],["T_WHITESPACE"," ",657],"=",["T_WHITESPACE"," ",657],["T_VARIABLE","$this",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","_getChildrenCategoriesBase",657],"(",["T_VARIABLE","$category",657],")",";",["T_WHITESPACE","\n        ",657],["T_VARIABLE","$collection",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","addAttributeToFilter",658],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active'",658],",",["T_WHITESPACE"," ",658],["T_LNUMBER","1",658],")",["T_WHITESPACE","\n            ",658],["T_OBJECT_OPERATOR","->",659],["T_STRING","addIdFilter",659],"(",["T_VARIABLE","$category",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","getChildren",659],"(",")",")",["T_WHITESPACE","\n            ",659],["T_OBJECT_OPERATOR","->",660],["T_STRING","load",660],"(",")",";",["T_WHITESPACE","\n\n        ",660],["T_RETURN","return",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$collection",662],";",["T_WHITESPACE","\n    ",662],"}",["T_WHITESPACE","\n\n\n    ",663],["T_DOC_COMMENT","\/**\n     * Return children categories lists with inactive\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return Mage_Catalog_Model_Resource_Category_Collection\n     *\/",666],["T_WHITESPACE","\n    ",671],["T_PUBLIC","public",672],["T_WHITESPACE"," ",672],["T_FUNCTION","function",672],["T_WHITESPACE"," ",672],["T_STRING","getChildrenCategoriesWithInactive",672],"(",["T_VARIABLE","$category",672],")",["T_WHITESPACE","\n    ",672],"{",["T_WHITESPACE","\n        ",673],["T_VARIABLE","$collection",674],["T_WHITESPACE"," ",674],"=",["T_WHITESPACE"," ",674],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","_getChildrenCategoriesBase",674],"(",["T_VARIABLE","$category",674],")",";",["T_WHITESPACE","\n        ",674],["T_VARIABLE","$collection",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","addFieldToFilter",675],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",675],",",["T_WHITESPACE"," ",675],["T_VARIABLE","$category",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getId",675],"(",")",")",";",["T_WHITESPACE","\n\n        ",675],["T_RETURN","return",677],["T_WHITESPACE"," ",677],["T_VARIABLE","$collection",677],";",["T_WHITESPACE","\n    ",677],"}",["T_WHITESPACE","\n\n    ",678],["T_DOC_COMMENT","\/**\n     * Returns select for category's children.\n     *\n     * @param $category\n     * @param bool $recursive\n     * @return Varien_Db_Select\n     *\/",680],["T_WHITESPACE","\n    ",686],["T_PROTECTED","protected",687],["T_WHITESPACE"," ",687],["T_FUNCTION","function",687],["T_WHITESPACE"," ",687],["T_STRING","_getChildrenIdSelect",687],"(",["T_VARIABLE","$category",687],",",["T_WHITESPACE"," ",687],["T_VARIABLE","$recursive",687],["T_WHITESPACE"," ",687],"=",["T_WHITESPACE"," ",687],["T_STRING","true",687],")",["T_WHITESPACE","\n    ",687],"{",["T_WHITESPACE","\n        ",688],["T_VARIABLE","$adapter",689],["T_WHITESPACE"," ",689],"=",["T_WHITESPACE"," ",689],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","_getReadAdapter",689],"(",")",";",["T_WHITESPACE","\n        ",689],["T_VARIABLE","$select",690],["T_WHITESPACE"," ",690],"=",["T_WHITESPACE"," ",690],["T_VARIABLE","$adapter",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","select",690],"(",")",["T_WHITESPACE","\n            ",690],["T_OBJECT_OPERATOR","->",691],["T_STRING","from",691],"(",["T_ARRAY","array",691],"(",["T_CONSTANT_ENCAPSED_STRING","'m'",691],["T_WHITESPACE"," ",691],["T_DOUBLE_ARROW","=>",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$this",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","getEntityTable",691],"(",")",")",",",["T_WHITESPACE"," ",691],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",691],")",["T_WHITESPACE","\n            ",691],["T_OBJECT_OPERATOR","->",692],["T_STRING","where",692],"(",["T_VARIABLE","$adapter",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","quoteIdentifier",692],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",692],")",["T_WHITESPACE"," ",692],".",["T_WHITESPACE"," ",692],["T_CONSTANT_ENCAPSED_STRING","' LIKE ?'",692],",",["T_WHITESPACE"," ",692],["T_VARIABLE","$category",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","getPath",692],"(",")",["T_WHITESPACE"," ",692],".",["T_WHITESPACE"," ",692],["T_CONSTANT_ENCAPSED_STRING","'\/%'",692],")",";",["T_WHITESPACE","\n\n        ",692],["T_IF","if",694],["T_WHITESPACE"," ",694],"(","!",["T_VARIABLE","$recursive",694],")",["T_WHITESPACE"," ",694],"{",["T_WHITESPACE","\n            ",694],["T_VARIABLE","$select",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","where",695],"(",["T_VARIABLE","$adapter",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","quoteIdentifier",695],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",695],")",["T_WHITESPACE"," ",695],".",["T_WHITESPACE"," ",695],["T_CONSTANT_ENCAPSED_STRING","' <= ?'",695],",",["T_WHITESPACE"," ",695],["T_VARIABLE","$category",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","getLevel",695],"(",")",["T_WHITESPACE"," ",695],"+",["T_WHITESPACE"," ",695],["T_LNUMBER","1",695],")",";",["T_WHITESPACE","\n        ",695],"}",["T_WHITESPACE","\n        ",696],["T_RETURN","return",697],["T_WHITESPACE"," ",697],["T_VARIABLE","$select",697],";",["T_WHITESPACE","\n    ",697],"}",["T_WHITESPACE","\n\n    ",698],["T_DOC_COMMENT","\/**\n     * Return children ids of category\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @param boolean $recursive\n     * @return array\n     *\/",700],["T_WHITESPACE","\n    ",706],["T_PUBLIC","public",707],["T_WHITESPACE"," ",707],["T_FUNCTION","function",707],["T_WHITESPACE"," ",707],["T_STRING","getChildren",707],"(",["T_VARIABLE","$category",707],",",["T_WHITESPACE"," ",707],["T_VARIABLE","$recursive",707],["T_WHITESPACE"," ",707],"=",["T_WHITESPACE"," ",707],["T_STRING","true",707],")",["T_WHITESPACE","\n    ",707],"{",["T_WHITESPACE","\n        ",708],["T_VARIABLE","$attributeId",709],["T_WHITESPACE","  ",709],"=",["T_WHITESPACE"," ",709],["T_INT_CAST","(int)",709],["T_VARIABLE","$this",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","_getIsActiveAttributeId",709],"(",")",";",["T_WHITESPACE","\n        ",709],["T_VARIABLE","$backendTable",710],["T_WHITESPACE"," ",710],"=",["T_WHITESPACE"," ",710],["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","getTable",710],"(",["T_ARRAY","array",710],"(",["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","getEntityTablePrefix",710],"(",")",",",["T_WHITESPACE"," ",710],["T_CONSTANT_ENCAPSED_STRING","'int'",710],")",")",";",["T_WHITESPACE","\n        ",710],["T_VARIABLE","$adapter",711],["T_WHITESPACE","      ",711],"=",["T_WHITESPACE"," ",711],["T_VARIABLE","$this",711],["T_OBJECT_OPERATOR","->",711],["T_STRING","_getReadAdapter",711],"(",")",";",["T_WHITESPACE","\n        ",711],["T_VARIABLE","$checkSql",712],["T_WHITESPACE","     ",712],"=",["T_WHITESPACE"," ",712],["T_VARIABLE","$adapter",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","getCheckSql",712],"(",["T_CONSTANT_ENCAPSED_STRING","'c.value_id > 0'",712],",",["T_WHITESPACE"," ",712],["T_CONSTANT_ENCAPSED_STRING","'c.value'",712],",",["T_WHITESPACE"," ",712],["T_CONSTANT_ENCAPSED_STRING","'d.value'",712],")",";",["T_WHITESPACE","\n        ",712],["T_VARIABLE","$bind",713],["T_WHITESPACE"," ",713],"=",["T_WHITESPACE"," ",713],["T_ARRAY","array",713],"(",["T_WHITESPACE","\n            ",713],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",714],["T_WHITESPACE"," ",714],["T_DOUBLE_ARROW","=>",714],["T_WHITESPACE"," ",714],["T_VARIABLE","$attributeId",714],",",["T_WHITESPACE","\n            ",714],["T_CONSTANT_ENCAPSED_STRING","'store_id'",715],["T_WHITESPACE","     ",715],["T_DOUBLE_ARROW","=>",715],["T_WHITESPACE"," ",715],["T_VARIABLE","$category",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","getStoreId",715],"(",")",",",["T_WHITESPACE","\n            ",715],["T_CONSTANT_ENCAPSED_STRING","'scope'",716],["T_WHITESPACE","        ",716],["T_DOUBLE_ARROW","=>",716],["T_WHITESPACE"," ",716],["T_LNUMBER","1",716],",",["T_WHITESPACE","\n        ",716],")",";",["T_WHITESPACE","\n        ",717],["T_VARIABLE","$select",718],["T_WHITESPACE"," ",718],"=",["T_WHITESPACE"," ",718],["T_VARIABLE","$this",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","_getChildrenIdSelect",718],"(",["T_VARIABLE","$category",718],",",["T_WHITESPACE"," ",718],["T_VARIABLE","$recursive",718],")",";",["T_WHITESPACE","\n        ",718],["T_VARIABLE","$select",719],["T_WHITESPACE","\n            ",719],["T_OBJECT_OPERATOR","->",720],["T_STRING","joinLeft",720],"(",["T_WHITESPACE","\n                ",720],["T_ARRAY","array",721],"(",["T_CONSTANT_ENCAPSED_STRING","'d'",721],["T_WHITESPACE"," ",721],["T_DOUBLE_ARROW","=>",721],["T_WHITESPACE"," ",721],["T_VARIABLE","$backendTable",721],")",",",["T_WHITESPACE","\n                ",721],["T_CONSTANT_ENCAPSED_STRING","'d.attribute_id = :attribute_id AND d.store_id = 0 AND d.entity_id = m.entity_id'",722],",",["T_WHITESPACE","\n                ",722],["T_ARRAY","array",723],"(",")",["T_WHITESPACE","\n            ",723],")",["T_WHITESPACE","\n            ",724],["T_OBJECT_OPERATOR","->",725],["T_STRING","joinLeft",725],"(",["T_WHITESPACE","\n                ",725],["T_ARRAY","array",726],"(",["T_CONSTANT_ENCAPSED_STRING","'c'",726],["T_WHITESPACE"," ",726],["T_DOUBLE_ARROW","=>",726],["T_WHITESPACE"," ",726],["T_VARIABLE","$backendTable",726],")",",",["T_WHITESPACE","\n                ",726],["T_CONSTANT_ENCAPSED_STRING","'c.attribute_id = :attribute_id AND c.store_id = :store_id AND c.entity_id = m.entity_id'",727],",",["T_WHITESPACE","\n                ",727],["T_ARRAY","array",728],"(",")",["T_WHITESPACE","\n            ",728],")",["T_WHITESPACE","\n            ",729],["T_OBJECT_OPERATOR","->",730],["T_STRING","where",730],"(",["T_VARIABLE","$checkSql",730],["T_WHITESPACE"," ",730],".",["T_WHITESPACE"," ",730],["T_CONSTANT_ENCAPSED_STRING","' = :scope'",730],")",";",["T_WHITESPACE","\n\n        ",730],["T_RETURN","return",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$adapter",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","fetchCol",732],"(",["T_VARIABLE","$select",732],",",["T_WHITESPACE"," ",732],["T_VARIABLE","$bind",732],")",";",["T_WHITESPACE","\n    ",732],"}",["T_WHITESPACE","\n\n    ",733],["T_DOC_COMMENT","\/**\n     * Return IDs of category's children along with inactive categories.\n     *\n     * @param $category\n     * @param bool $recursive\n     * @return array\n     *\/",735],["T_WHITESPACE","\n    ",741],["T_PUBLIC","public",742],["T_WHITESPACE"," ",742],["T_FUNCTION","function",742],["T_WHITESPACE"," ",742],["T_STRING","getChildrenIds",742],"(",["T_VARIABLE","$category",742],",",["T_WHITESPACE"," ",742],["T_VARIABLE","$recursive",742],["T_WHITESPACE"," ",742],"=",["T_WHITESPACE"," ",742],["T_STRING","true",742],")",["T_WHITESPACE","\n    ",742],"{",["T_WHITESPACE","\n        ",743],["T_VARIABLE","$select",744],["T_WHITESPACE"," ",744],"=",["T_WHITESPACE"," ",744],["T_VARIABLE","$this",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","_getChildrenIdSelect",744],"(",["T_VARIABLE","$category",744],",",["T_WHITESPACE"," ",744],["T_VARIABLE","$recursive",744],")",";",["T_WHITESPACE","\n        ",744],["T_RETURN","return",745],["T_WHITESPACE"," ",745],["T_VARIABLE","$this",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","_getReadAdapter",745],"(",")",["T_OBJECT_OPERATOR","->",745],["T_STRING","fetchCol",745],"(",["T_VARIABLE","$select",745],")",";",["T_WHITESPACE","\n    ",745],"}",["T_WHITESPACE","\n\n    ",746],["T_DOC_COMMENT","\/**\n     * Return all children ids of category (with category id)\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return array\n     *\/",748],["T_WHITESPACE","\n    ",753],["T_PUBLIC","public",754],["T_WHITESPACE"," ",754],["T_FUNCTION","function",754],["T_WHITESPACE"," ",754],["T_STRING","getAllChildren",754],"(",["T_VARIABLE","$category",754],")",["T_WHITESPACE","\n    ",754],"{",["T_WHITESPACE","\n        ",755],["T_VARIABLE","$children",756],["T_WHITESPACE"," ",756],"=",["T_WHITESPACE"," ",756],["T_VARIABLE","$this",756],["T_OBJECT_OPERATOR","->",756],["T_STRING","getChildren",756],"(",["T_VARIABLE","$category",756],")",";",["T_WHITESPACE","\n        ",756],["T_VARIABLE","$myId",757],["T_WHITESPACE"," ",757],"=",["T_WHITESPACE"," ",757],["T_ARRAY","array",757],"(",["T_VARIABLE","$category",757],["T_OBJECT_OPERATOR","->",757],["T_STRING","getId",757],"(",")",")",";",["T_WHITESPACE","\n        ",757],["T_VARIABLE","$children",758],["T_WHITESPACE"," ",758],"=",["T_WHITESPACE"," ",758],["T_STRING","array_merge",758],"(",["T_VARIABLE","$myId",758],",",["T_WHITESPACE"," ",758],["T_VARIABLE","$children",758],")",";",["T_WHITESPACE","\n\n        ",758],["T_RETURN","return",760],["T_WHITESPACE"," ",760],["T_VARIABLE","$children",760],";",["T_WHITESPACE","\n    ",760],"}",["T_WHITESPACE","\n\n    ",761],["T_DOC_COMMENT","\/**\n     * Check is category in list of store categories\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @return boolean\n     *\/",763],["T_WHITESPACE","\n    ",768],["T_PUBLIC","public",769],["T_WHITESPACE"," ",769],["T_FUNCTION","function",769],["T_WHITESPACE"," ",769],["T_STRING","isInRootCategoryList",769],"(",["T_VARIABLE","$category",769],")",["T_WHITESPACE","\n    ",769],"{",["T_WHITESPACE","\n        ",770],["T_VARIABLE","$rootCategoryId",771],["T_WHITESPACE"," ",771],"=",["T_WHITESPACE"," ",771],["T_STRING","Mage",771],["T_DOUBLE_COLON","::",771],["T_STRING","app",771],"(",")",["T_OBJECT_OPERATOR","->",771],["T_STRING","getStore",771],"(",")",["T_OBJECT_OPERATOR","->",771],["T_STRING","getRootCategoryId",771],"(",")",";",["T_WHITESPACE","\n\n        ",771],["T_RETURN","return",773],["T_WHITESPACE"," ",773],["T_STRING","in_array",773],"(",["T_VARIABLE","$rootCategoryId",773],",",["T_WHITESPACE"," ",773],["T_VARIABLE","$category",773],["T_OBJECT_OPERATOR","->",773],["T_STRING","getParentIds",773],"(",")",")",";",["T_WHITESPACE","\n    ",773],"}",["T_WHITESPACE","\n\n    ",774],["T_DOC_COMMENT","\/**\n     * Check category is forbidden to delete.\n     * If category is root and assigned to store group return false\n     *\n     * @param integer $categoryId\n     * @return boolean\n     *\/",776],["T_WHITESPACE","\n    ",782],["T_PUBLIC","public",783],["T_WHITESPACE"," ",783],["T_FUNCTION","function",783],["T_WHITESPACE"," ",783],["T_STRING","isForbiddenToDelete",783],"(",["T_VARIABLE","$categoryId",783],")",["T_WHITESPACE","\n    ",783],"{",["T_WHITESPACE","\n        ",784],["T_VARIABLE","$select",785],["T_WHITESPACE"," ",785],"=",["T_WHITESPACE"," ",785],["T_VARIABLE","$this",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","_getReadAdapter",785],"(",")",["T_OBJECT_OPERATOR","->",785],["T_STRING","select",785],"(",")",["T_WHITESPACE","\n            ",785],["T_OBJECT_OPERATOR","->",786],["T_STRING","from",786],"(",["T_VARIABLE","$this",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","getTable",786],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",786],")",",",["T_WHITESPACE"," ",786],["T_ARRAY","array",786],"(",["T_CONSTANT_ENCAPSED_STRING","'group_id'",786],")",")",["T_WHITESPACE","\n            ",786],["T_OBJECT_OPERATOR","->",787],["T_STRING","where",787],"(",["T_CONSTANT_ENCAPSED_STRING","'root_category_id = :root_category_id'",787],")",";",["T_WHITESPACE","\n        ",787],["T_VARIABLE","$result",788],["T_WHITESPACE"," ",788],"=",["T_WHITESPACE"," ",788],["T_VARIABLE","$this",788],["T_OBJECT_OPERATOR","->",788],["T_STRING","_getReadAdapter",788],"(",")",["T_OBJECT_OPERATOR","->",788],["T_STRING","fetchOne",788],"(",["T_VARIABLE","$select",788],",",["T_WHITESPACE","  ",788],["T_ARRAY","array",788],"(",["T_CONSTANT_ENCAPSED_STRING","'root_category_id'",788],["T_WHITESPACE"," ",788],["T_DOUBLE_ARROW","=>",788],["T_WHITESPACE"," ",788],["T_VARIABLE","$categoryId",788],")",")",";",["T_WHITESPACE","\n\n        ",788],["T_IF","if",790],["T_WHITESPACE"," ",790],"(",["T_VARIABLE","$result",790],")",["T_WHITESPACE"," ",790],"{",["T_WHITESPACE","\n            ",790],["T_RETURN","return",791],["T_WHITESPACE"," ",791],["T_STRING","true",791],";",["T_WHITESPACE","\n        ",791],"}",["T_WHITESPACE","\n        ",792],["T_RETURN","return",793],["T_WHITESPACE"," ",793],["T_STRING","false",793],";",["T_WHITESPACE","\n    ",793],"}",["T_WHITESPACE","\n\n    ",794],["T_DOC_COMMENT","\/**\n     * Get category path value by its id\n     *\n     * @param int $categoryId\n     * @return string\n     *\/",796],["T_WHITESPACE","\n    ",801],["T_PUBLIC","public",802],["T_WHITESPACE"," ",802],["T_FUNCTION","function",802],["T_WHITESPACE"," ",802],["T_STRING","getCategoryPathById",802],"(",["T_VARIABLE","$categoryId",802],")",["T_WHITESPACE","\n    ",802],"{",["T_WHITESPACE","\n        ",803],["T_VARIABLE","$select",804],["T_WHITESPACE"," ",804],"=",["T_WHITESPACE"," ",804],["T_VARIABLE","$this",804],["T_OBJECT_OPERATOR","->",804],["T_STRING","getReadConnection",804],"(",")",["T_OBJECT_OPERATOR","->",804],["T_STRING","select",804],"(",")",["T_WHITESPACE","\n            ",804],["T_OBJECT_OPERATOR","->",805],["T_STRING","from",805],"(",["T_VARIABLE","$this",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","getEntityTable",805],"(",")",",",["T_WHITESPACE"," ",805],["T_ARRAY","array",805],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",805],")",")",["T_WHITESPACE","\n            ",805],["T_OBJECT_OPERATOR","->",806],["T_STRING","where",806],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",806],")",";",["T_WHITESPACE","\n        ",806],["T_VARIABLE","$bind",807],["T_WHITESPACE"," ",807],"=",["T_WHITESPACE"," ",807],["T_ARRAY","array",807],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",807],["T_WHITESPACE"," ",807],["T_DOUBLE_ARROW","=>",807],["T_WHITESPACE"," ",807],["T_INT_CAST","(int)",807],["T_VARIABLE","$categoryId",807],")",";",["T_WHITESPACE","\n\n        ",807],["T_RETURN","return",809],["T_WHITESPACE"," ",809],["T_VARIABLE","$this",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getReadConnection",809],"(",")",["T_OBJECT_OPERATOR","->",809],["T_STRING","fetchOne",809],"(",["T_VARIABLE","$select",809],",",["T_WHITESPACE"," ",809],["T_VARIABLE","$bind",809],")",";",["T_WHITESPACE","\n    ",809],"}",["T_WHITESPACE","\n\n    ",810],["T_DOC_COMMENT","\/**\n     * Move category to another parent node\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @param Mage_Catalog_Model_Category $newParent\n     * @param null|int $afterCategoryId\n     * @return Mage_Catalog_Model_Resource_Category\n     *\/",812],["T_WHITESPACE","\n    ",819],["T_PUBLIC","public",820],["T_WHITESPACE"," ",820],["T_FUNCTION","function",820],["T_WHITESPACE"," ",820],["T_STRING","changeParent",820],"(",["T_STRING","Mage_Catalog_Model_Category",820],["T_WHITESPACE"," ",820],["T_VARIABLE","$category",820],",",["T_WHITESPACE"," ",820],["T_STRING","Mage_Catalog_Model_Category",820],["T_WHITESPACE"," ",820],["T_VARIABLE","$newParent",820],",",["T_WHITESPACE","\n        ",820],["T_VARIABLE","$afterCategoryId",821],["T_WHITESPACE"," ",821],"=",["T_WHITESPACE"," ",821],["T_STRING","null",821],")",["T_WHITESPACE","\n    ",821],"{",["T_WHITESPACE","\n        ",822],["T_VARIABLE","$childrenCount",823],["T_WHITESPACE","  ",823],"=",["T_WHITESPACE"," ",823],["T_VARIABLE","$this",823],["T_OBJECT_OPERATOR","->",823],["T_STRING","getChildrenCount",823],"(",["T_VARIABLE","$category",823],["T_OBJECT_OPERATOR","->",823],["T_STRING","getId",823],"(",")",")",["T_WHITESPACE"," ",823],"+",["T_WHITESPACE"," ",823],["T_LNUMBER","1",823],";",["T_WHITESPACE","\n        ",823],["T_VARIABLE","$table",824],["T_WHITESPACE","          ",824],"=",["T_WHITESPACE"," ",824],["T_VARIABLE","$this",824],["T_OBJECT_OPERATOR","->",824],["T_STRING","getEntityTable",824],"(",")",";",["T_WHITESPACE","\n        ",824],["T_VARIABLE","$adapter",825],["T_WHITESPACE","        ",825],"=",["T_WHITESPACE"," ",825],["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","_getWriteAdapter",825],"(",")",";",["T_WHITESPACE","\n        ",825],["T_VARIABLE","$levelFiled",826],["T_WHITESPACE","     ",826],"=",["T_WHITESPACE"," ",826],["T_VARIABLE","$adapter",826],["T_OBJECT_OPERATOR","->",826],["T_STRING","quoteIdentifier",826],"(",["T_CONSTANT_ENCAPSED_STRING","'level'",826],")",";",["T_WHITESPACE","\n        ",826],["T_VARIABLE","$pathField",827],["T_WHITESPACE","      ",827],"=",["T_WHITESPACE"," ",827],["T_VARIABLE","$adapter",827],["T_OBJECT_OPERATOR","->",827],["T_STRING","quoteIdentifier",827],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",827],")",";",["T_WHITESPACE","\n\n        ",827],["T_DOC_COMMENT","\/**\n         * Decrease children count for all old category parent categories\n         *\/",829],["T_WHITESPACE","\n        ",831],["T_VARIABLE","$adapter",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","update",832],"(",["T_WHITESPACE","\n            ",832],["T_VARIABLE","$table",833],",",["T_WHITESPACE","\n            ",833],["T_ARRAY","array",834],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count'",834],["T_WHITESPACE"," ",834],["T_DOUBLE_ARROW","=>",834],["T_WHITESPACE"," ",834],["T_NEW","new",834],["T_WHITESPACE"," ",834],["T_STRING","Zend_Db_Expr",834],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count - '",834],["T_WHITESPACE"," ",834],".",["T_WHITESPACE"," ",834],["T_VARIABLE","$childrenCount",834],")",")",",",["T_WHITESPACE","\n            ",834],["T_ARRAY","array",835],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",835],["T_WHITESPACE"," ",835],["T_DOUBLE_ARROW","=>",835],["T_WHITESPACE"," ",835],["T_VARIABLE","$category",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","getParentIds",835],"(",")",")",["T_WHITESPACE","\n        ",835],")",";",["T_WHITESPACE","\n\n        ",836],["T_DOC_COMMENT","\/**\n         * Increase children count for new category parents\n         *\/",838],["T_WHITESPACE","\n        ",840],["T_VARIABLE","$adapter",841],["T_OBJECT_OPERATOR","->",841],["T_STRING","update",841],"(",["T_WHITESPACE","\n            ",841],["T_VARIABLE","$table",842],",",["T_WHITESPACE","\n            ",842],["T_ARRAY","array",843],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count'",843],["T_WHITESPACE"," ",843],["T_DOUBLE_ARROW","=>",843],["T_WHITESPACE"," ",843],["T_NEW","new",843],["T_WHITESPACE"," ",843],["T_STRING","Zend_Db_Expr",843],"(",["T_CONSTANT_ENCAPSED_STRING","'children_count + '",843],["T_WHITESPACE"," ",843],".",["T_WHITESPACE"," ",843],["T_VARIABLE","$childrenCount",843],")",")",",",["T_WHITESPACE","\n            ",843],["T_ARRAY","array",844],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",844],["T_WHITESPACE"," ",844],["T_DOUBLE_ARROW","=>",844],["T_WHITESPACE"," ",844],["T_VARIABLE","$newParent",844],["T_OBJECT_OPERATOR","->",844],["T_STRING","getPathIds",844],"(",")",")",["T_WHITESPACE","\n        ",844],")",";",["T_WHITESPACE","\n\n        ",845],["T_VARIABLE","$position",847],["T_WHITESPACE"," ",847],"=",["T_WHITESPACE"," ",847],["T_VARIABLE","$this",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","_processPositions",847],"(",["T_VARIABLE","$category",847],",",["T_WHITESPACE"," ",847],["T_VARIABLE","$newParent",847],",",["T_WHITESPACE"," ",847],["T_VARIABLE","$afterCategoryId",847],")",";",["T_WHITESPACE","\n\n        ",847],["T_VARIABLE","$newPath",849],["T_WHITESPACE","          ",849],"=",["T_WHITESPACE"," ",849],["T_STRING","sprintf",849],"(",["T_CONSTANT_ENCAPSED_STRING","'%s\/%s'",849],",",["T_WHITESPACE"," ",849],["T_VARIABLE","$newParent",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","getPath",849],"(",")",",",["T_WHITESPACE"," ",849],["T_VARIABLE","$category",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","getId",849],"(",")",")",";",["T_WHITESPACE","\n        ",849],["T_VARIABLE","$newLevel",850],["T_WHITESPACE","         ",850],"=",["T_WHITESPACE"," ",850],["T_VARIABLE","$newParent",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","getLevel",850],"(",")",["T_WHITESPACE"," ",850],"+",["T_WHITESPACE"," ",850],["T_LNUMBER","1",850],";",["T_WHITESPACE","\n        ",850],["T_VARIABLE","$levelDisposition",851],["T_WHITESPACE"," ",851],"=",["T_WHITESPACE"," ",851],["T_VARIABLE","$newLevel",851],["T_WHITESPACE"," ",851],"-",["T_WHITESPACE"," ",851],["T_VARIABLE","$category",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","getLevel",851],"(",")",";",["T_WHITESPACE","\n\n        ",851],["T_DOC_COMMENT","\/**\n         * Update children nodes path\n         *\/",853],["T_WHITESPACE","\n        ",855],["T_VARIABLE","$adapter",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","update",856],"(",["T_WHITESPACE","\n            ",856],["T_VARIABLE","$table",857],",",["T_WHITESPACE","\n            ",857],["T_ARRAY","array",858],"(",["T_WHITESPACE","\n                ",858],["T_CONSTANT_ENCAPSED_STRING","'path'",859],["T_WHITESPACE"," ",859],["T_DOUBLE_ARROW","=>",859],["T_WHITESPACE"," ",859],["T_NEW","new",859],["T_WHITESPACE"," ",859],["T_STRING","Zend_Db_Expr",859],"(",["T_CONSTANT_ENCAPSED_STRING","'REPLACE('",859],["T_WHITESPACE"," ",859],".",["T_WHITESPACE"," ",859],["T_VARIABLE","$pathField",859],["T_WHITESPACE"," ",859],".",["T_WHITESPACE"," ",859],["T_CONSTANT_ENCAPSED_STRING","','",859],".",["T_WHITESPACE","\n                    ",859],["T_VARIABLE","$adapter",860],["T_OBJECT_OPERATOR","->",860],["T_STRING","quote",860],"(",["T_VARIABLE","$category",860],["T_OBJECT_OPERATOR","->",860],["T_STRING","getPath",860],"(",")",["T_WHITESPACE"," ",860],".",["T_WHITESPACE"," ",860],["T_CONSTANT_ENCAPSED_STRING","'\/'",860],")",".",["T_WHITESPACE"," ",860],["T_CONSTANT_ENCAPSED_STRING","', '",860],".",["T_VARIABLE","$adapter",860],["T_OBJECT_OPERATOR","->",860],["T_STRING","quote",860],"(",["T_VARIABLE","$newPath",860],["T_WHITESPACE"," ",860],".",["T_WHITESPACE"," ",860],["T_CONSTANT_ENCAPSED_STRING","'\/'",860],")",".",["T_CONSTANT_ENCAPSED_STRING","')'",860],["T_WHITESPACE","\n                ",860],")",",",["T_WHITESPACE","\n                ",861],["T_CONSTANT_ENCAPSED_STRING","'level'",862],["T_WHITESPACE"," ",862],["T_DOUBLE_ARROW","=>",862],["T_WHITESPACE"," ",862],["T_NEW","new",862],["T_WHITESPACE"," ",862],["T_STRING","Zend_Db_Expr",862],"(",["T_WHITESPACE"," ",862],["T_VARIABLE","$levelFiled",862],["T_WHITESPACE"," ",862],".",["T_WHITESPACE"," ",862],["T_CONSTANT_ENCAPSED_STRING","' + '",862],["T_WHITESPACE"," ",862],".",["T_WHITESPACE"," ",862],["T_VARIABLE","$levelDisposition",862],")",["T_WHITESPACE","\n            ",862],")",",",["T_WHITESPACE","\n            ",863],["T_ARRAY","array",864],"(",["T_VARIABLE","$pathField",864],["T_WHITESPACE"," ",864],".",["T_WHITESPACE"," ",864],["T_CONSTANT_ENCAPSED_STRING","' LIKE ?'",864],["T_WHITESPACE"," ",864],["T_DOUBLE_ARROW","=>",864],["T_WHITESPACE"," ",864],["T_VARIABLE","$category",864],["T_OBJECT_OPERATOR","->",864],["T_STRING","getPath",864],"(",")",["T_WHITESPACE"," ",864],".",["T_WHITESPACE"," ",864],["T_CONSTANT_ENCAPSED_STRING","'\/%'",864],")",["T_WHITESPACE","\n        ",864],")",";",["T_WHITESPACE","\n        ",865],["T_DOC_COMMENT","\/**\n         * Update moved category data\n         *\/",866],["T_WHITESPACE","\n        ",868],["T_VARIABLE","$data",869],["T_WHITESPACE"," ",869],"=",["T_WHITESPACE"," ",869],["T_ARRAY","array",869],"(",["T_WHITESPACE","\n            ",869],["T_CONSTANT_ENCAPSED_STRING","'path'",870],["T_WHITESPACE","      ",870],["T_DOUBLE_ARROW","=>",870],["T_WHITESPACE"," ",870],["T_VARIABLE","$newPath",870],",",["T_WHITESPACE","\n            ",870],["T_CONSTANT_ENCAPSED_STRING","'level'",871],["T_WHITESPACE","     ",871],["T_DOUBLE_ARROW","=>",871],["T_WHITESPACE"," ",871],["T_VARIABLE","$newLevel",871],",",["T_WHITESPACE","\n            ",871],["T_CONSTANT_ENCAPSED_STRING","'position'",872],["T_WHITESPACE","  ",872],["T_DOUBLE_ARROW","=>",872],["T_VARIABLE","$position",872],",",["T_WHITESPACE","\n            ",872],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",873],["T_WHITESPACE"," ",873],["T_DOUBLE_ARROW","=>",873],["T_VARIABLE","$newParent",873],["T_OBJECT_OPERATOR","->",873],["T_STRING","getId",873],"(",")",["T_WHITESPACE","\n        ",873],")",";",["T_WHITESPACE","\n        ",874],["T_VARIABLE","$adapter",875],["T_OBJECT_OPERATOR","->",875],["T_STRING","update",875],"(",["T_VARIABLE","$table",875],",",["T_WHITESPACE"," ",875],["T_VARIABLE","$data",875],",",["T_WHITESPACE"," ",875],["T_ARRAY","array",875],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",875],["T_WHITESPACE"," ",875],["T_DOUBLE_ARROW","=>",875],["T_WHITESPACE"," ",875],["T_VARIABLE","$category",875],["T_OBJECT_OPERATOR","->",875],["T_STRING","getId",875],"(",")",")",")",";",["T_WHITESPACE","\n\n        ",875],["T_COMMENT","\/\/ Update category object to new data\n",877],["T_WHITESPACE","        ",878],["T_VARIABLE","$category",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","addData",878],"(",["T_VARIABLE","$data",878],")",";",["T_WHITESPACE","\n\n        ",878],["T_RETURN","return",880],["T_WHITESPACE"," ",880],["T_VARIABLE","$this",880],";",["T_WHITESPACE","\n    ",880],"}",["T_WHITESPACE","\n\n    ",881],["T_DOC_COMMENT","\/**\n     * Process positions of old parent category children and new parent category children.\n     * Get position for moved category\n     *\n     * @param Mage_Catalog_Model_Category $category\n     * @param Mage_Catalog_Model_Category $newParent\n     * @param null|int $afterCategoryId\n     * @return int\n     *\/",883],["T_WHITESPACE","\n    ",891],["T_PROTECTED","protected",892],["T_WHITESPACE"," ",892],["T_FUNCTION","function",892],["T_WHITESPACE"," ",892],["T_STRING","_processPositions",892],"(",["T_VARIABLE","$category",892],",",["T_WHITESPACE"," ",892],["T_VARIABLE","$newParent",892],",",["T_WHITESPACE"," ",892],["T_VARIABLE","$afterCategoryId",892],")",["T_WHITESPACE","\n    ",892],"{",["T_WHITESPACE","\n        ",893],["T_VARIABLE","$table",894],["T_WHITESPACE","          ",894],"=",["T_WHITESPACE"," ",894],["T_VARIABLE","$this",894],["T_OBJECT_OPERATOR","->",894],["T_STRING","getEntityTable",894],"(",")",";",["T_WHITESPACE","\n        ",894],["T_VARIABLE","$adapter",895],["T_WHITESPACE","        ",895],"=",["T_WHITESPACE"," ",895],["T_VARIABLE","$this",895],["T_OBJECT_OPERATOR","->",895],["T_STRING","_getWriteAdapter",895],"(",")",";",["T_WHITESPACE","\n        ",895],["T_VARIABLE","$positionField",896],["T_WHITESPACE","  ",896],"=",["T_WHITESPACE"," ",896],["T_VARIABLE","$adapter",896],["T_OBJECT_OPERATOR","->",896],["T_STRING","quoteIdentifier",896],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",896],")",";",["T_WHITESPACE","\n\n        ",896],["T_VARIABLE","$bind",898],["T_WHITESPACE"," ",898],"=",["T_WHITESPACE"," ",898],["T_ARRAY","array",898],"(",["T_WHITESPACE","\n            ",898],["T_CONSTANT_ENCAPSED_STRING","'position'",899],["T_WHITESPACE"," ",899],["T_DOUBLE_ARROW","=>",899],["T_WHITESPACE"," ",899],["T_NEW","new",899],["T_WHITESPACE"," ",899],["T_STRING","Zend_Db_Expr",899],"(",["T_VARIABLE","$positionField",899],["T_WHITESPACE"," ",899],".",["T_WHITESPACE"," ",899],["T_CONSTANT_ENCAPSED_STRING","' - 1'",899],")",["T_WHITESPACE","\n        ",899],")",";",["T_WHITESPACE","\n        ",900],["T_VARIABLE","$where",901],["T_WHITESPACE"," ",901],"=",["T_WHITESPACE"," ",901],["T_ARRAY","array",901],"(",["T_WHITESPACE","\n            ",901],["T_CONSTANT_ENCAPSED_STRING","'parent_id = ?'",902],["T_WHITESPACE","         ",902],["T_DOUBLE_ARROW","=>",902],["T_WHITESPACE"," ",902],["T_VARIABLE","$category",902],["T_OBJECT_OPERATOR","->",902],["T_STRING","getParentId",902],"(",")",",",["T_WHITESPACE","\n            ",902],["T_VARIABLE","$positionField",903],["T_WHITESPACE"," ",903],".",["T_WHITESPACE"," ",903],["T_CONSTANT_ENCAPSED_STRING","' > ?'",903],["T_WHITESPACE"," ",903],["T_DOUBLE_ARROW","=>",903],["T_WHITESPACE"," ",903],["T_VARIABLE","$category",903],["T_OBJECT_OPERATOR","->",903],["T_STRING","getPosition",903],"(",")",["T_WHITESPACE","\n        ",903],")",";",["T_WHITESPACE","\n        ",904],["T_VARIABLE","$adapter",905],["T_OBJECT_OPERATOR","->",905],["T_STRING","update",905],"(",["T_VARIABLE","$table",905],",",["T_WHITESPACE"," ",905],["T_VARIABLE","$bind",905],",",["T_WHITESPACE"," ",905],["T_VARIABLE","$where",905],")",";",["T_WHITESPACE","\n\n        ",905],["T_DOC_COMMENT","\/**\n         * Prepare position value\n         *\/",907],["T_WHITESPACE","\n        ",909],["T_IF","if",910],["T_WHITESPACE"," ",910],"(",["T_VARIABLE","$afterCategoryId",910],")",["T_WHITESPACE"," ",910],"{",["T_WHITESPACE","\n            ",910],["T_VARIABLE","$select",911],["T_WHITESPACE"," ",911],"=",["T_WHITESPACE"," ",911],["T_VARIABLE","$adapter",911],["T_OBJECT_OPERATOR","->",911],["T_STRING","select",911],"(",")",["T_WHITESPACE","\n                ",911],["T_OBJECT_OPERATOR","->",912],["T_STRING","from",912],"(",["T_VARIABLE","$table",912],",",["T_CONSTANT_ENCAPSED_STRING","'position'",912],")",["T_WHITESPACE","\n                ",912],["T_OBJECT_OPERATOR","->",913],["T_STRING","where",913],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",913],")",";",["T_WHITESPACE","\n            ",913],["T_VARIABLE","$position",914],["T_WHITESPACE"," ",914],"=",["T_WHITESPACE"," ",914],["T_VARIABLE","$adapter",914],["T_OBJECT_OPERATOR","->",914],["T_STRING","fetchOne",914],"(",["T_VARIABLE","$select",914],",",["T_WHITESPACE"," ",914],["T_ARRAY","array",914],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",914],["T_WHITESPACE"," ",914],["T_DOUBLE_ARROW","=>",914],["T_WHITESPACE"," ",914],["T_VARIABLE","$afterCategoryId",914],")",")",";",["T_WHITESPACE","\n\n            ",914],["T_VARIABLE","$bind",916],["T_WHITESPACE"," ",916],"=",["T_WHITESPACE"," ",916],["T_ARRAY","array",916],"(",["T_WHITESPACE","\n                ",916],["T_CONSTANT_ENCAPSED_STRING","'position'",917],["T_WHITESPACE"," ",917],["T_DOUBLE_ARROW","=>",917],["T_WHITESPACE"," ",917],["T_NEW","new",917],["T_WHITESPACE"," ",917],["T_STRING","Zend_Db_Expr",917],"(",["T_VARIABLE","$positionField",917],["T_WHITESPACE"," ",917],".",["T_WHITESPACE"," ",917],["T_CONSTANT_ENCAPSED_STRING","' + 1'",917],")",["T_WHITESPACE","\n            ",917],")",";",["T_WHITESPACE","\n            ",918],["T_VARIABLE","$where",919],["T_WHITESPACE"," ",919],"=",["T_WHITESPACE"," ",919],["T_ARRAY","array",919],"(",["T_WHITESPACE","\n                ",919],["T_CONSTANT_ENCAPSED_STRING","'parent_id = ?'",920],["T_WHITESPACE"," ",920],["T_DOUBLE_ARROW","=>",920],["T_WHITESPACE"," ",920],["T_VARIABLE","$newParent",920],["T_OBJECT_OPERATOR","->",920],["T_STRING","getId",920],"(",")",",",["T_WHITESPACE","\n                ",920],["T_VARIABLE","$positionField",921],["T_WHITESPACE"," ",921],".",["T_WHITESPACE"," ",921],["T_CONSTANT_ENCAPSED_STRING","' > ?'",921],["T_WHITESPACE"," ",921],["T_DOUBLE_ARROW","=>",921],["T_WHITESPACE"," ",921],["T_VARIABLE","$position",921],["T_WHITESPACE","\n            ",921],")",";",["T_WHITESPACE","\n            ",922],["T_VARIABLE","$adapter",923],["T_OBJECT_OPERATOR","->",923],["T_STRING","update",923],"(",["T_VARIABLE","$table",923],",",["T_VARIABLE","$bind",923],",",["T_VARIABLE","$where",923],")",";",["T_WHITESPACE","\n        ",923],"}",["T_WHITESPACE"," ",924],["T_ELSEIF","elseif",924],["T_WHITESPACE"," ",924],"(",["T_VARIABLE","$afterCategoryId",924],["T_WHITESPACE"," ",924],["T_IS_NOT_IDENTICAL","!==",924],["T_WHITESPACE"," ",924],["T_STRING","null",924],")",["T_WHITESPACE"," ",924],"{",["T_WHITESPACE","\n            ",924],["T_VARIABLE","$position",925],["T_WHITESPACE"," ",925],"=",["T_WHITESPACE"," ",925],["T_LNUMBER","0",925],";",["T_WHITESPACE","\n            ",925],["T_VARIABLE","$bind",926],["T_WHITESPACE"," ",926],"=",["T_WHITESPACE"," ",926],["T_ARRAY","array",926],"(",["T_WHITESPACE","\n                ",926],["T_CONSTANT_ENCAPSED_STRING","'position'",927],["T_WHITESPACE"," ",927],["T_DOUBLE_ARROW","=>",927],["T_WHITESPACE"," ",927],["T_NEW","new",927],["T_WHITESPACE"," ",927],["T_STRING","Zend_Db_Expr",927],"(",["T_VARIABLE","$positionField",927],["T_WHITESPACE"," ",927],".",["T_WHITESPACE"," ",927],["T_CONSTANT_ENCAPSED_STRING","' + 1'",927],")",["T_WHITESPACE","\n            ",927],")",";",["T_WHITESPACE","\n            ",928],["T_VARIABLE","$where",929],["T_WHITESPACE"," ",929],"=",["T_WHITESPACE"," ",929],["T_ARRAY","array",929],"(",["T_WHITESPACE","\n                ",929],["T_CONSTANT_ENCAPSED_STRING","'parent_id = ?'",930],["T_WHITESPACE"," ",930],["T_DOUBLE_ARROW","=>",930],["T_WHITESPACE"," ",930],["T_VARIABLE","$newParent",930],["T_OBJECT_OPERATOR","->",930],["T_STRING","getId",930],"(",")",",",["T_WHITESPACE","\n                ",930],["T_VARIABLE","$positionField",931],["T_WHITESPACE"," ",931],".",["T_WHITESPACE"," ",931],["T_CONSTANT_ENCAPSED_STRING","' > ?'",931],["T_WHITESPACE"," ",931],["T_DOUBLE_ARROW","=>",931],["T_WHITESPACE"," ",931],["T_VARIABLE","$position",931],["T_WHITESPACE","\n            ",931],")",";",["T_WHITESPACE","\n            ",932],["T_VARIABLE","$adapter",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","update",933],"(",["T_VARIABLE","$table",933],",",["T_VARIABLE","$bind",933],",",["T_VARIABLE","$where",933],")",";",["T_WHITESPACE","\n        ",933],"}",["T_WHITESPACE"," ",934],["T_ELSE","else",934],["T_WHITESPACE"," ",934],"{",["T_WHITESPACE","\n            ",934],["T_VARIABLE","$select",935],["T_WHITESPACE"," ",935],"=",["T_WHITESPACE"," ",935],["T_VARIABLE","$adapter",935],["T_OBJECT_OPERATOR","->",935],["T_STRING","select",935],"(",")",["T_WHITESPACE","\n                ",935],["T_OBJECT_OPERATOR","->",936],["T_STRING","from",936],"(",["T_VARIABLE","$table",936],",",["T_ARRAY","array",936],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",936],["T_WHITESPACE"," ",936],["T_DOUBLE_ARROW","=>",936],["T_WHITESPACE"," ",936],["T_NEW","new",936],["T_WHITESPACE"," ",936],["T_STRING","Zend_Db_Expr",936],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN('",936],["T_WHITESPACE"," ",936],".",["T_WHITESPACE"," ",936],["T_VARIABLE","$positionField",936],".",["T_WHITESPACE"," ",936],["T_CONSTANT_ENCAPSED_STRING","')'",936],")",")",")",["T_WHITESPACE","\n                ",936],["T_OBJECT_OPERATOR","->",937],["T_STRING","where",937],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id = :parent_id'",937],")",";",["T_WHITESPACE","\n            ",937],["T_VARIABLE","$position",938],["T_WHITESPACE"," ",938],"=",["T_WHITESPACE"," ",938],["T_VARIABLE","$adapter",938],["T_OBJECT_OPERATOR","->",938],["T_STRING","fetchOne",938],"(",["T_VARIABLE","$select",938],",",["T_WHITESPACE"," ",938],["T_ARRAY","array",938],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",938],["T_WHITESPACE"," ",938],["T_DOUBLE_ARROW","=>",938],["T_WHITESPACE"," ",938],["T_VARIABLE","$newParent",938],["T_OBJECT_OPERATOR","->",938],["T_STRING","getId",938],"(",")",")",")",";",["T_WHITESPACE","\n        ",938],"}",["T_WHITESPACE","\n        ",939],["T_VARIABLE","$position",940],["T_WHITESPACE"," ",940],["T_PLUS_EQUAL","+=",940],["T_WHITESPACE"," ",940],["T_LNUMBER","1",940],";",["T_WHITESPACE","\n\n        ",940],["T_RETURN","return",942],["T_WHITESPACE"," ",942],["T_VARIABLE","$position",942],";",["T_WHITESPACE","\n    ",942],"}",["T_WHITESPACE","\n",943],"}",["T_WHITESPACE","\n",944]]