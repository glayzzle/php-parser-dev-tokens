[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_COMMENT","\/* @var $installer Mage_Eav_Model_Entity_Setup *\/",28],["T_WHITESPACE","\n",28],["T_VARIABLE","$installer",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$this",29],";",["T_WHITESPACE","\n",29],["T_COMMENT","\/*\n$installer->startSetup();\n\n$entityTypeId = $installer->getEntityTypeId('catalog_category');\n$designApplyAttributeId = $installer->getAttributeId($entityTypeId, 'custom_design_apply');\n$designAttributeId = $installer->getAttributeId($entityTypeId, 'custom_design');\n$catalogCategoryEntityIntTable = $installer->getAttributeTable($entityTypeId, $designApplyAttributeId);\n$eavAttributeTable = $installer->getTable('eav\/attribute');\n\n$installer->addAttribute($entityTypeId, 'custom_use_parent_settings', array(\n    'type'          => 'int',\n    'input'         => 'select',\n    'label'         => 'Use Parent Category Settings',\n    'source'        => 'eav\/entity_attribute_source_boolean',\n    'required'      => 0,\n    'group'         => 'Custom Design',\n    'sort_order'    => '5',\n    'global'        => 0\n));\n$installer->addAttribute($entityTypeId, 'custom_apply_to_products', array(\n    'type'          => 'int',\n    'input'         => 'select',\n    'label'         => 'Apply To Products',\n    'source'        => 'eav\/entity_attribute_source_boolean',\n    'required'      => 0,\n    'group'         => 'Custom Design',\n    'sort_order'    => '6',\n    'global'        => 0\n));\n$useParentSettingsAttributeId = $installer->getAttributeId($entityTypeId, 'custom_use_parent_settings');\n$applyToProductsAttributeId = $installer->getAttributeId($entityTypeId, 'custom_apply_to_products');\n\n\n\n$attributeIdExpr = new Zend_Db_Expr(\n    'IF (e_a.attribute_id = e.attribute_id,'.\n    $useParentSettingsAttributeId.', '.\n    $applyToProductsAttributeId .')');\n$productValueExpr = new Zend_Db_Expr('IF (e.value IN (1,3), 1, 0)');\n$valueExpr = new Zend_Db_Expr('IF (e_a.attribute_id = e.attribute_id, 1, '. $productValueExpr .')');\n$select = $installer->getConnection()->select()\n    ->from(\n        array('e' => $catalogCategoryEntityIntTable),\n        array(\n            'entity_type_id',\n            'attribute_id' => $attributeIdExpr,\n            'store_id',\n            'entity_id',\n            'value' => $valueExpr\n        )\n    )\n    ->joinCross(\n        array('e_a' => $eavAttributeTable),\n        array())\n    ->where('e_a.attribute_id IN (?)', array($designApplyAttributeId, $designAttributeId))\n    ->where('e.attribute_id = ?', $designApplyAttributeId)\n    ->order(array('e.entity_id', 'attribute_id'));\n\n$insertArray = array(\n    'entity_type_id',\n    'attribute_id',\n    'store_id',\n    'entity_id',\n    'value'\n);\n\n$sqlQuery = $select->insertFromSelect($catalogCategoryEntityIntTable, $insertArray, false);\n$installer->getConnection()->query($sqlQuery);\n\n$installer->endSetup();\n*\/",30],["T_WHITESPACE","\n",100]]