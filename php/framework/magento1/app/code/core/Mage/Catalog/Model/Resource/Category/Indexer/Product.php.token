[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Resource model for category product indexer\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Category_Indexer_Product",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Index_Model_Resource_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Category table\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_categoryTable",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Category product table\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_categoryProductTable",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Product website table\n     *\n     * @var string\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_productWebsiteTable",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Store table\n     *\n     * @var string\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_storeTable",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Group table\n     *\n     * @var string\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_groupTable",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Array of info about stores\n     *\n     * @var array\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_storesInfo",77],";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Model initialization\n     *\n     *\/",79],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","_construct",83],"(",")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_init",85],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'category_id'",85],")",";",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_categoryTable",86],["T_WHITESPACE","        ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getTable",86],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",86],")",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_categoryProductTable",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getTable",87],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",87],")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_productWebsiteTable",88],["T_WHITESPACE","  ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getTable",88],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",88],")",";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_storeTable",89],["T_WHITESPACE","           ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getTable",89],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",89],")",";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_groupTable",90],["T_WHITESPACE","           ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getTable",90],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",90],")",";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Process product save.\n     * Method is responsible for index support\n     * when product was saved and assigned categories was changed.\n     *\n     * @param Mage_Index_Model_Event $event\n     * @return Mage_Catalog_Model_Resource_Category_Indexer_Product\n     *\/",93],["T_WHITESPACE","\n    ",100],["T_PUBLIC","public",101],["T_WHITESPACE"," ",101],["T_FUNCTION","function",101],["T_WHITESPACE"," ",101],["T_STRING","catalogProductSave",101],"(",["T_STRING","Mage_Index_Model_Event",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$event",101],")",["T_WHITESPACE","\n    ",101],"{",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$productId",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$event",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getEntityPk",103],"(",")",";",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$data",104],["T_WHITESPACE","      ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$event",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getNewData",104],"(",")",";",["T_WHITESPACE","\n\n        ",104],["T_DOC_COMMENT","\/**\n         * Check if category ids were updated\n         *\/",106],["T_WHITESPACE","\n        ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(","!",["T_ISSET","isset",109],"(",["T_VARIABLE","$data",109],"[",["T_CONSTANT_ENCAPSED_STRING","'category_ids'",109],"]",")",")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_DOC_COMMENT","\/**\n         * Select relations to categories\n         *\/",113],["T_WHITESPACE","\n        ",115],["T_VARIABLE","$select",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_getWriteAdapter",116],"(",")",["T_OBJECT_OPERATOR","->",116],["T_STRING","select",116],"(",")",["T_WHITESPACE","\n            ",116],["T_OBJECT_OPERATOR","->",117],["T_STRING","from",117],"(",["T_ARRAY","array",117],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_categoryProductTable",117],")",",",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'category_id'",117],")",["T_WHITESPACE","\n            ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","joinInner",118],"(",["T_ARRAY","array",118],"(",["T_CONSTANT_ENCAPSED_STRING","'ce'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_categoryTable",118],")",",",["T_WHITESPACE"," ",118],["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id=cp.category_id'",118],",",["T_WHITESPACE"," ",118],["T_CONSTANT_ENCAPSED_STRING","'path'",118],")",["T_WHITESPACE","\n            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","where",119],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.product_id=:product_id'",119],")",";",["T_WHITESPACE","\n\n        ",119],["T_DOC_COMMENT","\/**\n         * Get information about product categories\n         *\/",121],["T_WHITESPACE","\n        ",123],["T_VARIABLE","$categories",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_getWriteAdapter",124],"(",")",["T_OBJECT_OPERATOR","->",124],["T_STRING","fetchPairs",124],"(",["T_VARIABLE","$select",124],",",["T_WHITESPACE"," ",124],["T_ARRAY","array",124],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$productId",124],")",")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$categoryIds",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_ARRAY","array",125],"(",")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$allCategoryIds",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_ARRAY","array",126],"(",")",";",["T_WHITESPACE","\n\n        ",126],["T_FOREACH","foreach",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$categories",128],["T_WHITESPACE"," ",128],["T_AS","as",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$id",128],["T_DOUBLE_ARROW","=>",128],["T_VARIABLE","$path",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$categoryIds",129],"[","]",["T_WHITESPACE","  ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$id",129],";",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$allCategoryIds",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","array_merge",130],"(",["T_VARIABLE","$allCategoryIds",130],",",["T_WHITESPACE"," ",130],["T_STRING","explode",130],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$path",130],")",")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$allCategoryIds",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","array_unique",132],"(",["T_VARIABLE","$allCategoryIds",132],")",";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$allCategoryIds",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","array_diff",133],"(",["T_VARIABLE","$allCategoryIds",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$categoryIds",133],")",";",["T_WHITESPACE","\n\n        ",133],["T_DOC_COMMENT","\/**\n         * Delete previous index data\n         *\/",135],["T_WHITESPACE","\n        ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_getWriteAdapter",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","delete",138],"(",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getMainTable",139],"(",")",",",["T_WHITESPACE","\n            ",139],["T_ARRAY","array",140],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",140],["T_WHITESPACE"," ",140],["T_DOUBLE_ARROW","=>",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$productId",140],")",["T_WHITESPACE","\n        ",140],")",";",["T_WHITESPACE","\n\n        ",141],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_refreshAnchorRelations",143],"(",["T_VARIABLE","$allCategoryIds",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$productId",143],")",";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_refreshDirectRelations",144],"(",["T_VARIABLE","$categoryIds",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$productId",144],")",";",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_refreshRootRelations",145],"(",["T_VARIABLE","$productId",145],")",";",["T_WHITESPACE","\n        ",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$this",146],";",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Process Catalog Product mass action\n     *\n     * @param Mage_Index_Model_Event $event\n     * @return Mage_Catalog_Model_Resource_Category_Indexer_Product\n     *\/",149],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","catalogProductMassAction",155],"(",["T_STRING","Mage_Index_Model_Event",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$event",155],")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$data",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$event",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getNewData",157],"(",")",";",["T_WHITESPACE","\n\n        ",157],["T_DOC_COMMENT","\/**\n         * check is product ids were updated\n         *\/",159],["T_WHITESPACE","\n        ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(","!",["T_ISSET","isset",162],"(",["T_VARIABLE","$data",162],"[",["T_CONSTANT_ENCAPSED_STRING","'product_ids'",162],"]",")",")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],";",["T_WHITESPACE","\n        ",163],"}",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$productIds",165],["T_WHITESPACE","     ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$data",165],"[",["T_CONSTANT_ENCAPSED_STRING","'product_ids'",165],"]",";",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$categoryIds",166],["T_WHITESPACE","    ",166],"=",["T_WHITESPACE"," ",166],["T_ARRAY","array",166],"(",")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$allCategoryIds",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",")",";",["T_WHITESPACE","\n\n        ",167],["T_DOC_COMMENT","\/**\n         * Select relations to categories\n         *\/",169],["T_WHITESPACE","\n        ",171],["T_VARIABLE","$adapter",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_getWriteAdapter",172],"(",")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$select",173],["T_WHITESPACE","  ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$adapter",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","select",173],"(",")",["T_WHITESPACE","\n            ",173],["T_OBJECT_OPERATOR","->",174],["T_STRING","distinct",174],"(",["T_STRING","true",174],")",["T_WHITESPACE","\n            ",174],["T_OBJECT_OPERATOR","->",175],["T_STRING","from",175],"(",["T_ARRAY","array",175],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",175],["T_WHITESPACE"," ",175],["T_DOUBLE_ARROW","=>",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_categoryProductTable",175],")",",",["T_WHITESPACE"," ",175],["T_ARRAY","array",175],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",175],")",")",["T_WHITESPACE","\n            ",175],["T_OBJECT_OPERATOR","->",176],["T_STRING","join",176],"(",["T_WHITESPACE","\n                ",176],["T_ARRAY","array",177],"(",["T_CONSTANT_ENCAPSED_STRING","'ce'",177],["T_WHITESPACE"," ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_categoryTable",177],")",",",["T_WHITESPACE","\n                ",177],["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id=cp.category_id'",178],",",["T_WHITESPACE","\n                ",178],["T_ARRAY","array",179],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",179],")",")",["T_WHITESPACE","\n            ",179],["T_OBJECT_OPERATOR","->",180],["T_STRING","where",180],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.product_id IN(?)'",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$productIds",180],")",";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$pairs",181],["T_WHITESPACE","   ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$adapter",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","fetchPairs",181],"(",["T_VARIABLE","$select",181],")",";",["T_WHITESPACE","\n        ",181],["T_FOREACH","foreach",182],["T_WHITESPACE"," ",182],"(",["T_VARIABLE","$pairs",182],["T_WHITESPACE"," ",182],["T_AS","as",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$categoryId",182],["T_WHITESPACE"," ",182],["T_DOUBLE_ARROW","=>",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$categoryPath",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$categoryIds",183],"[","]",["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$categoryId",183],";",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$allCategoryIds",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","array_merge",184],"(",["T_VARIABLE","$allCategoryIds",184],",",["T_WHITESPACE"," ",184],["T_STRING","explode",184],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",184],",",["T_WHITESPACE"," ",184],["T_VARIABLE","$categoryPath",184],")",")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n\n        ",185],["T_VARIABLE","$allCategoryIds",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_STRING","array_unique",187],"(",["T_VARIABLE","$allCategoryIds",187],")",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$allCategoryIds",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","array_diff",188],"(",["T_VARIABLE","$allCategoryIds",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$categoryIds",188],")",";",["T_WHITESPACE","\n\n        ",188],["T_DOC_COMMENT","\/**\n         * Delete previous index data\n         *\/",190],["T_WHITESPACE","\n        ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_getWriteAdapter",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","delete",193],"(",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getMainTable",194],"(",")",",",["T_WHITESPACE"," ",194],["T_ARRAY","array",194],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN(?)'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$productIds",194],")",["T_WHITESPACE","\n        ",194],")",";",["T_WHITESPACE","\n\n        ",195],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_refreshAnchorRelations",197],"(",["T_VARIABLE","$allCategoryIds",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$productIds",197],")",";",["T_WHITESPACE","\n        ",197],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_refreshDirectRelations",198],"(",["T_VARIABLE","$categoryIds",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$productIds",198],")",";",["T_WHITESPACE","\n        ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_refreshRootRelations",199],"(",["T_VARIABLE","$productIds",199],")",";",["T_WHITESPACE","\n        ",199],["T_RETURN","return",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],";",["T_WHITESPACE","\n    ",200],"}",["T_WHITESPACE","\n\n    ",201],["T_DOC_COMMENT","\/**\n     * Return array of used root category id - path pairs\n     *\n     * @return array\n     *\/",203],["T_WHITESPACE","\n    ",207],["T_PROTECTED","protected",208],["T_WHITESPACE"," ",208],["T_FUNCTION","function",208],["T_WHITESPACE"," ",208],["T_STRING","_getRootCategories",208],"(",")",["T_WHITESPACE","\n    ",208],"{",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$rootCategories",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],"(",")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$stores",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_getStoresInfo",211],"(",")",";",["T_WHITESPACE","\n        ",211],["T_FOREACH","foreach",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$stores",212],["T_WHITESPACE"," ",212],["T_AS","as",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$storeInfo",212],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_VARIABLE","$storeInfo",213],"[",["T_CONSTANT_ENCAPSED_STRING","'root_id'",213],"]",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n                ",213],["T_VARIABLE","$rootCategories",214],"[",["T_VARIABLE","$storeInfo",214],"[",["T_CONSTANT_ENCAPSED_STRING","'root_id'",214],"]","]",["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$storeInfo",214],"[",["T_CONSTANT_ENCAPSED_STRING","'root_path'",214],"]",";",["T_WHITESPACE","\n            ",214],"}",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n\n        ",216],["T_RETURN","return",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$rootCategories",218],";",["T_WHITESPACE","\n    ",218],"}",["T_WHITESPACE","\n\n    ",219],["T_DOC_COMMENT","\/**\n     * Process category index after category save\n     *\n     * @param Mage_Index_Model_Event $event\n     *\/",221],["T_WHITESPACE","\n    ",225],["T_PUBLIC","public",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","catalogCategorySave",226],"(",["T_STRING","Mage_Index_Model_Event",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$event",226],")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$data",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$event",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getNewData",228],"(",")",";",["T_WHITESPACE","\n\n        ",228],["T_VARIABLE","$checkRootCategories",230],["T_WHITESPACE","        ",230],"=",["T_WHITESPACE"," ",230],["T_STRING","false",230],";",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$processRootCategories",231],["T_WHITESPACE","      ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","false",231],";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$affectedRootCategoryIds",232],["T_WHITESPACE","    ",232],"=",["T_WHITESPACE"," ",232],["T_ARRAY","array",232],"(",")",";",["T_WHITESPACE","\n        ",232],["T_VARIABLE","$rootCategories",233],["T_WHITESPACE","             ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_getRootCategories",233],"(",")",";",["T_WHITESPACE","\n\n        ",233],["T_DOC_COMMENT","\/**\n         * Check if we have reindex category move results\n         *\/",235],["T_WHITESPACE","\n        ",237],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_ISSET","isset",238],"(",["T_VARIABLE","$data",238],"[",["T_CONSTANT_ENCAPSED_STRING","'affected_category_ids'",238],"]",")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$categoryIds",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$data",239],"[",["T_CONSTANT_ENCAPSED_STRING","'affected_category_ids'",239],"]",";",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$checkRootCategories",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_STRING","true",240],";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE"," ",241],["T_ELSE","else",241],["T_WHITESPACE"," ",241],["T_IF","if",241],["T_WHITESPACE"," ",241],"(",["T_ISSET","isset",241],"(",["T_VARIABLE","$data",241],"[",["T_CONSTANT_ENCAPSED_STRING","'products_was_changed'",241],"]",")",")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n            ",241],["T_VARIABLE","$categoryIds",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_ARRAY","array",242],"(",["T_VARIABLE","$event",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getEntityPk",242],"(",")",")",";",["T_WHITESPACE","\n\n            ",242],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_ISSET","isset",244],"(",["T_VARIABLE","$rootCategories",244],"[",["T_VARIABLE","$event",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getEntityPk",244],"(",")","]",")",")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n                ",244],["T_VARIABLE","$processRootCategories",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_STRING","true",245],";",["T_WHITESPACE","\n                ",245],["T_VARIABLE","$affectedRootCategoryIds",246],"[","]",["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$event",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getEntityPk",246],"(",")",";",["T_WHITESPACE","\n            ",246],"}",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE"," ",248],["T_ELSE","else",248],["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n            ",248],["T_RETURN","return",249],";",["T_WHITESPACE","\n        ",249],"}",["T_WHITESPACE","\n\n        ",250],["T_VARIABLE","$select",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","_getWriteAdapter",252],"(",")",["T_OBJECT_OPERATOR","->",252],["T_STRING","select",252],"(",")",["T_WHITESPACE","\n            ",252],["T_OBJECT_OPERATOR","->",253],["T_STRING","from",253],"(",["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_categoryTable",253],",",["T_WHITESPACE"," ",253],["T_CONSTANT_ENCAPSED_STRING","'path'",253],")",["T_WHITESPACE","\n            ",253],["T_OBJECT_OPERATOR","->",254],["T_STRING","where",254],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN (?)'",254],",",["T_WHITESPACE"," ",254],["T_VARIABLE","$categoryIds",254],")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$paths",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","_getWriteAdapter",255],"(",")",["T_OBJECT_OPERATOR","->",255],["T_STRING","fetchCol",255],"(",["T_VARIABLE","$select",255],")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$allCategoryIds",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_ARRAY","array",256],"(",")",";",["T_WHITESPACE","\n        ",256],["T_FOREACH","foreach",257],["T_WHITESPACE"," ",257],"(",["T_VARIABLE","$paths",257],["T_WHITESPACE"," ",257],["T_AS","as",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$path",257],")",["T_WHITESPACE"," ",257],"{",["T_WHITESPACE","\n            ",257],["T_IF","if",258],["T_WHITESPACE"," ",258],"(",["T_VARIABLE","$checkRootCategories",258],")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n                ",258],["T_FOREACH","foreach",259],["T_WHITESPACE"," ",259],"(",["T_VARIABLE","$rootCategories",259],["T_WHITESPACE"," ",259],["T_AS","as",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$rootCategoryId",259],["T_WHITESPACE"," ",259],["T_DOUBLE_ARROW","=>",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$rootCategoryPath",259],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n                    ",259],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_STRING","strpos",260],"(",["T_VARIABLE","$path",260],",",["T_WHITESPACE"," ",260],["T_STRING","sprintf",260],"(",["T_CONSTANT_ENCAPSED_STRING","'%d\/'",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$rootCategoryPath",260],")",")",["T_WHITESPACE"," ",260],["T_IS_IDENTICAL","===",260],["T_WHITESPACE"," ",260],["T_LNUMBER","0",260],["T_WHITESPACE"," ",260],["T_BOOLEAN_OR","||",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$path",260],["T_WHITESPACE"," ",260],["T_IS_EQUAL","==",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$rootCategoryPath",260],")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n                        ",260],["T_VARIABLE","$affectedRootCategoryIds",261],"[",["T_VARIABLE","$rootCategoryId",261],"]",["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$rootCategoryId",261],";",["T_WHITESPACE","\n                    ",261],"}",["T_WHITESPACE","\n                ",262],"}",["T_WHITESPACE","\n            ",263],"}",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$allCategoryIds",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","array_merge",265],"(",["T_VARIABLE","$allCategoryIds",265],",",["T_WHITESPACE"," ",265],["T_STRING","explode",265],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",265],",",["T_WHITESPACE"," ",265],["T_VARIABLE","$path",265],")",")",";",["T_WHITESPACE","\n        ",265],"}",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$allCategoryIds",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_STRING","array_unique",267],"(",["T_VARIABLE","$allCategoryIds",267],")",";",["T_WHITESPACE","\n\n        ",267],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_VARIABLE","$checkRootCategories",269],["T_WHITESPACE"," ",269],["T_BOOLEAN_AND","&&",269],["T_WHITESPACE"," ",269],["T_STRING","count",269],"(",["T_VARIABLE","$affectedRootCategoryIds",269],")",["T_WHITESPACE"," ",269],">",["T_WHITESPACE"," ",269],["T_LNUMBER","1",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$processRootCategories",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_STRING","true",270],";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n\n        ",271],["T_DOC_COMMENT","\/**\n         * retrieve anchor category id\n         *\/",273],["T_WHITESPACE","\n        ",275],["T_VARIABLE","$anchorInfo",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_getAnchorAttributeInfo",276],"(",")",";",["T_WHITESPACE","\n        ",276],["T_VARIABLE","$bind",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_ARRAY","array",277],"(",["T_WHITESPACE","\n            ",277],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",278],["T_WHITESPACE"," ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$anchorInfo",278],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",278],"]",",",["T_WHITESPACE","\n            ",278],["T_CONSTANT_ENCAPSED_STRING","'store_id'",279],["T_WHITESPACE","     ",279],["T_DOUBLE_ARROW","=>",279],["T_WHITESPACE"," ",279],["T_STRING","Mage_Catalog_Model_Abstract",279],["T_DOUBLE_COLON","::",279],["T_STRING","DEFAULT_STORE_ID",279],",",["T_WHITESPACE","\n            ",279],["T_CONSTANT_ENCAPSED_STRING","'e_value'",280],["T_WHITESPACE","      ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_LNUMBER","1",280],["T_WHITESPACE","\n        ",280],")",";",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$select",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","_getReadAdapter",282],"(",")",["T_OBJECT_OPERATOR","->",282],["T_STRING","select",282],"(",")",["T_WHITESPACE","\n            ",282],["T_OBJECT_OPERATOR","->",283],["T_STRING","distinct",283],"(",["T_STRING","true",283],")",["T_WHITESPACE","\n            ",283],["T_OBJECT_OPERATOR","->",284],["T_STRING","from",284],"(",["T_ARRAY","array",284],"(",["T_CONSTANT_ENCAPSED_STRING","'ce'",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_categoryTable",284],")",",",["T_WHITESPACE"," ",284],["T_ARRAY","array",284],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",284],")",")",["T_WHITESPACE","\n            ",284],["T_OBJECT_OPERATOR","->",285],["T_STRING","joinInner",285],"(",["T_WHITESPACE","\n                ",285],["T_ARRAY","array",286],"(",["T_CONSTANT_ENCAPSED_STRING","'dca'",286],["T_DOUBLE_ARROW","=>",286],["T_VARIABLE","$anchorInfo",286],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",286],"]",")",",",["T_WHITESPACE","\n                ",286],["T_CONSTANT_ENCAPSED_STRING","\"dca.entity_id=ce.entity_id AND dca.attribute_id=:attribute_id AND dca.store_id=:store_id\"",287],",",["T_WHITESPACE","\n                ",287],["T_ARRAY","array",288],"(",")",")",["T_WHITESPACE","\n             ",288],["T_OBJECT_OPERATOR","->",289],["T_STRING","where",289],"(",["T_CONSTANT_ENCAPSED_STRING","'dca.value=:e_value'",289],")",["T_WHITESPACE","\n             ",289],["T_OBJECT_OPERATOR","->",290],["T_STRING","where",290],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id IN (?)'",290],",",["T_WHITESPACE"," ",290],["T_VARIABLE","$allCategoryIds",290],")",";",["T_WHITESPACE","\n        ",290],["T_VARIABLE","$anchorIds",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","_getWriteAdapter",291],"(",")",["T_OBJECT_OPERATOR","->",291],["T_STRING","fetchCol",291],"(",["T_VARIABLE","$select",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$bind",291],")",";",["T_WHITESPACE","\n        ",291],["T_DOC_COMMENT","\/**\n         * delete only anchor id and category ids\n         *\/",292],["T_WHITESPACE","\n        ",294],["T_VARIABLE","$deleteCategoryIds",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_STRING","array_merge",295],"(",["T_VARIABLE","$anchorIds",295],",",["T_VARIABLE","$categoryIds",295],")",";",["T_WHITESPACE","\n\n        ",295],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_getWriteAdapter",297],"(",")",["T_OBJECT_OPERATOR","->",297],["T_STRING","delete",297],"(",["T_WHITESPACE","\n            ",297],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getMainTable",298],"(",")",",",["T_WHITESPACE","\n            ",298],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_getWriteAdapter",299],"(",")",["T_OBJECT_OPERATOR","->",299],["T_STRING","quoteInto",299],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id IN(?)'",299],",",["T_WHITESPACE"," ",299],["T_VARIABLE","$deleteCategoryIds",299],")",["T_WHITESPACE","\n        ",299],")",";",["T_WHITESPACE","\n\n        ",300],["T_VARIABLE","$directIds",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_STRING","array_diff",302],"(",["T_VARIABLE","$categoryIds",302],",",["T_WHITESPACE"," ",302],["T_VARIABLE","$anchorIds",302],")",";",["T_WHITESPACE","\n        ",302],["T_IF","if",303],["T_WHITESPACE"," ",303],"(",["T_VARIABLE","$anchorIds",303],")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_refreshAnchorRelations",304],"(",["T_VARIABLE","$anchorIds",304],")",";",["T_WHITESPACE","\n        ",304],"}",["T_WHITESPACE","\n        ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$directIds",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_refreshDirectRelations",307],"(",["T_VARIABLE","$directIds",307],")",";",["T_WHITESPACE","\n        ",307],"}",["T_WHITESPACE","\n\n        ",308],["T_DOC_COMMENT","\/**\n         * Need to re-index affected root category ids when its are not anchor\n         *\/",310],["T_WHITESPACE","\n        ",312],["T_IF","if",313],["T_WHITESPACE"," ",313],"(",["T_VARIABLE","$processRootCategories",313],")",["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n            ",313],["T_VARIABLE","$reindexRootCategoryIds",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_STRING","array_diff",314],"(",["T_VARIABLE","$affectedRootCategoryIds",314],",",["T_WHITESPACE"," ",314],["T_VARIABLE","$anchorIds",314],")",";",["T_WHITESPACE","\n            ",314],["T_IF","if",315],["T_WHITESPACE"," ",315],"(",["T_VARIABLE","$reindexRootCategoryIds",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n                ",315],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","_refreshNotAnchorRootCategories",316],"(",["T_VARIABLE","$reindexRootCategoryIds",316],")",";",["T_WHITESPACE","\n            ",316],"}",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE","\n\n    ",318],"}",["T_WHITESPACE","\n\n    ",320],["T_DOC_COMMENT","\/**\n     * Reindex not anchor root categories\n     *\n     * @param array $categoryIds\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Category_Indexer_Product\n     *\/",322],["T_WHITESPACE","\n    ",327],["T_PROTECTED","protected",328],["T_WHITESPACE"," ",328],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","_refreshNotAnchorRootCategories",328],"(",["T_ARRAY","array",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$categoryIds",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_STRING","null",328],")",["T_WHITESPACE","\n    ",328],"{",["T_WHITESPACE","\n        ",329],["T_IF","if",330],["T_WHITESPACE"," ",330],"(",["T_EMPTY","empty",330],"(",["T_VARIABLE","$categoryIds",330],")",")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n            ",330],["T_RETURN","return",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],";",["T_WHITESPACE","\n        ",331],"}",["T_WHITESPACE","\n\n        ",332],["T_VARIABLE","$adapter",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","_getWriteAdapter",334],"(",")",";",["T_WHITESPACE","\n\n        ",334],["T_COMMENT","\/\/ remove anchor relations\n",336],["T_WHITESPACE","        ",337],["T_VARIABLE","$where",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_ARRAY","array",337],"(",["T_WHITESPACE","\n            ",337],["T_CONSTANT_ENCAPSED_STRING","'category_id IN(?)'",338],["T_WHITESPACE"," ",338],["T_DOUBLE_ARROW","=>",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$categoryIds",338],",",["T_WHITESPACE","\n            ",338],["T_CONSTANT_ENCAPSED_STRING","'is_parent=?'",339],["T_WHITESPACE","       ",339],["T_DOUBLE_ARROW","=>",339],["T_WHITESPACE"," ",339],["T_LNUMBER","0",339],["T_WHITESPACE","\n        ",339],")",";",["T_WHITESPACE","\n        ",340],["T_VARIABLE","$adapter",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","delete",341],"(",["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getMainTable",341],"(",")",",",["T_WHITESPACE"," ",341],["T_VARIABLE","$where",341],")",";",["T_WHITESPACE","\n\n        ",341],["T_VARIABLE","$stores",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_getStoresInfo",343],"(",")",";",["T_WHITESPACE","\n        ",343],["T_DOC_COMMENT","\/**\n         * Build index for each store\n         *\/",344],["T_WHITESPACE","\n        ",346],["T_FOREACH","foreach",347],["T_WHITESPACE"," ",347],"(",["T_VARIABLE","$stores",347],["T_WHITESPACE"," ",347],["T_AS","as",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$storeData",347],")",["T_WHITESPACE"," ",347],"{",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$storeId",348],["T_WHITESPACE","    ",348],"=",["T_WHITESPACE"," ",348],["T_VARIABLE","$storeData",348],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",348],"]",";",["T_WHITESPACE","\n            ",348],["T_VARIABLE","$websiteId",349],["T_WHITESPACE","  ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$storeData",349],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",349],"]",";",["T_WHITESPACE","\n            ",349],["T_VARIABLE","$rootPath",350],["T_WHITESPACE","   ",350],"=",["T_WHITESPACE"," ",350],["T_VARIABLE","$storeData",350],"[",["T_CONSTANT_ENCAPSED_STRING","'root_path'",350],"]",";",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$rootId",351],["T_WHITESPACE","     ",351],"=",["T_WHITESPACE"," ",351],["T_VARIABLE","$storeData",351],"[",["T_CONSTANT_ENCAPSED_STRING","'root_id'",351],"]",";",["T_WHITESPACE","\n            ",351],["T_IF","if",352],["T_WHITESPACE"," ",352],"(","!",["T_STRING","in_array",352],"(",["T_VARIABLE","$rootId",352],",",["T_WHITESPACE"," ",352],["T_VARIABLE","$categoryIds",352],")",")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n                ",352],["T_CONTINUE","continue",353],";",["T_WHITESPACE","\n            ",353],"}",["T_WHITESPACE","\n\n            ",354],["T_VARIABLE","$select",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_VARIABLE","$adapter",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","select",356],"(",")",["T_WHITESPACE","\n                ",356],["T_OBJECT_OPERATOR","->",357],["T_STRING","distinct",357],"(",["T_STRING","true",357],")",["T_WHITESPACE","\n                ",357],["T_OBJECT_OPERATOR","->",358],["T_STRING","from",358],"(",["T_ARRAY","array",358],"(",["T_CONSTANT_ENCAPSED_STRING","'cc'",358],["T_WHITESPACE"," ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getTable",358],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",358],")",")",",",["T_WHITESPACE"," ",358],["T_STRING","null",358],")",["T_WHITESPACE","\n                ",358],["T_OBJECT_OPERATOR","->",359],["T_STRING","join",359],"(",["T_WHITESPACE","\n                    ",359],["T_ARRAY","array",360],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",360],["T_WHITESPACE"," ",360],["T_DOUBLE_ARROW","=>",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getMainTable",360],"(",")",")",",",["T_WHITESPACE","\n                    ",360],["T_CONSTANT_ENCAPSED_STRING","'i.category_id = cc.entity_id and i.store_id = 1'",361],",",["T_WHITESPACE","\n                    ",361],["T_ARRAY","array",362],"(",")",")",["T_WHITESPACE","\n                ",362],["T_OBJECT_OPERATOR","->",363],["T_STRING","joinLeft",363],"(",["T_WHITESPACE","\n                    ",363],["T_ARRAY","array",364],"(",["T_CONSTANT_ENCAPSED_STRING","'ie'",364],["T_WHITESPACE"," ",364],["T_DOUBLE_ARROW","=>",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getMainTable",364],"(",")",")",",",["T_WHITESPACE","\n                    ",364],["T_CONSTANT_ENCAPSED_STRING","'ie.category_id = '",365],["T_WHITESPACE"," ",365],".",["T_WHITESPACE"," ",365],["T_INT_CAST","(int)",365],["T_VARIABLE","$rootId",365],["T_WHITESPACE","\n                        ",365],".",["T_WHITESPACE"," ",366],["T_CONSTANT_ENCAPSED_STRING","' AND ie.product_id=i.product_id AND ie.store_id = '",366],["T_WHITESPACE"," ",366],".",["T_WHITESPACE"," ",366],["T_INT_CAST","(int)",366],["T_VARIABLE","$storeId",366],",",["T_WHITESPACE","\n                    ",366],["T_ARRAY","array",367],"(",")",")",["T_WHITESPACE","\n                ",367],["T_OBJECT_OPERATOR","->",368],["T_STRING","where",368],"(",["T_CONSTANT_ENCAPSED_STRING","'cc.path LIKE ?'",368],",",["T_WHITESPACE"," ",368],["T_VARIABLE","$rootPath",368],["T_WHITESPACE"," ",368],".",["T_WHITESPACE"," ",368],["T_CONSTANT_ENCAPSED_STRING","'\/%'",368],")",["T_WHITESPACE","\n                ",368],["T_OBJECT_OPERATOR","->",369],["T_STRING","where",369],"(",["T_CONSTANT_ENCAPSED_STRING","'ie.category_id IS NULL'",369],")",["T_WHITESPACE","\n                ",369],["T_OBJECT_OPERATOR","->",370],["T_STRING","columns",370],"(",["T_ARRAY","array",370],"(",["T_WHITESPACE","\n                    ",370],["T_CONSTANT_ENCAPSED_STRING","'category_id'",371],["T_WHITESPACE","   ",371],["T_DOUBLE_ARROW","=>",371],["T_WHITESPACE"," ",371],["T_NEW","new",371],["T_WHITESPACE"," ",371],["T_STRING","Zend_Db_Expr",371],"(",["T_VARIABLE","$rootId",371],")",",",["T_WHITESPACE","\n                    ",371],["T_CONSTANT_ENCAPSED_STRING","'product_id'",372],["T_WHITESPACE","    ",372],["T_DOUBLE_ARROW","=>",372],["T_WHITESPACE"," ",372],["T_CONSTANT_ENCAPSED_STRING","'i.product_id'",372],",",["T_WHITESPACE","\n                    ",372],["T_CONSTANT_ENCAPSED_STRING","'position'",373],["T_WHITESPACE","      ",373],["T_DOUBLE_ARROW","=>",373],["T_WHITESPACE"," ",373],["T_NEW","new",373],["T_WHITESPACE"," ",373],["T_STRING","Zend_Db_Expr",373],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",373],")",",",["T_WHITESPACE","\n                    ",373],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",374],["T_WHITESPACE","     ",374],["T_DOUBLE_ARROW","=>",374],["T_WHITESPACE"," ",374],["T_NEW","new",374],["T_WHITESPACE"," ",374],["T_STRING","Zend_Db_Expr",374],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",374],")",",",["T_WHITESPACE","\n                    ",374],["T_CONSTANT_ENCAPSED_STRING","'store_id'",375],["T_WHITESPACE","      ",375],["T_DOUBLE_ARROW","=>",375],["T_WHITESPACE"," ",375],["T_NEW","new",375],["T_WHITESPACE"," ",375],["T_STRING","Zend_Db_Expr",375],"(",["T_VARIABLE","$storeId",375],")",",",["T_WHITESPACE","\n                    ",375],["T_CONSTANT_ENCAPSED_STRING","'visibility'",376],["T_WHITESPACE","    ",376],["T_DOUBLE_ARROW","=>",376],["T_WHITESPACE"," ",376],["T_CONSTANT_ENCAPSED_STRING","'i.visibility'",376],["T_WHITESPACE","\n                ",376],")",")",";",["T_WHITESPACE","\n            ",377],["T_VARIABLE","$query",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$select",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","insertFromSelect",378],"(",["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getMainTable",378],"(",")",")",";",["T_WHITESPACE","\n            ",378],["T_VARIABLE","$adapter",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","query",379],"(",["T_VARIABLE","$query",379],")",";",["T_WHITESPACE","\n\n            ",379],["T_VARIABLE","$visibilityInfo",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","_getVisibilityAttributeInfo",381],"(",")",";",["T_WHITESPACE","\n            ",381],["T_VARIABLE","$statusInfo",382],["T_WHITESPACE","     ",382],"=",["T_WHITESPACE"," ",382],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_getStatusAttributeInfo",382],"(",")",";",["T_WHITESPACE","\n\n            ",382],["T_VARIABLE","$select",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_getReadAdapter",384],"(",")",["T_OBJECT_OPERATOR","->",384],["T_STRING","select",384],"(",")",["T_WHITESPACE","\n                ",384],["T_OBJECT_OPERATOR","->",385],["T_STRING","from",385],"(",["T_ARRAY","array",385],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",385],["T_WHITESPACE"," ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","_productWebsiteTable",385],")",",",["T_WHITESPACE"," ",385],["T_ARRAY","array",385],"(",")",")",["T_WHITESPACE","\n                ",385],["T_OBJECT_OPERATOR","->",386],["T_STRING","joinLeft",386],"(",["T_WHITESPACE","\n                    ",386],["T_ARRAY","array",387],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",387],["T_WHITESPACE"," ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getMainTable",387],"(",")",")",",",["T_WHITESPACE","\n                    ",387],["T_CONSTANT_ENCAPSED_STRING","'i.product_id = pw.product_id AND i.category_id = '",388],["T_WHITESPACE"," ",388],".",["T_WHITESPACE"," ",388],["T_INT_CAST","(int)",388],["T_VARIABLE","$rootId",388],["T_WHITESPACE","\n                        ",388],".",["T_WHITESPACE"," ",389],["T_CONSTANT_ENCAPSED_STRING","' AND i.store_id = '",389],["T_WHITESPACE"," ",389],".",["T_WHITESPACE"," ",389],["T_INT_CAST","(int)",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$storeId",389],",",["T_WHITESPACE","\n                    ",389],["T_ARRAY","array",390],"(",")",")",["T_WHITESPACE","\n                ",390],["T_OBJECT_OPERATOR","->",391],["T_STRING","join",391],"(",["T_WHITESPACE","\n                    ",391],["T_ARRAY","array",392],"(",["T_CONSTANT_ENCAPSED_STRING","'dv'",392],["T_WHITESPACE"," ",392],["T_DOUBLE_ARROW","=>",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$visibilityInfo",392],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",392],"]",")",",",["T_WHITESPACE","\n                    ",392],"\"",["T_ENCAPSED_AND_WHITESPACE","dv.entity_id = pw.product_id AND dv.attribute_id = ",393],["T_CURLY_OPEN","{",393],["T_VARIABLE","$visibilityInfo",393],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",393],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND dv.store_id = 0",393],"\"",",",["T_WHITESPACE","\n                    ",393],["T_ARRAY","array",394],"(",")",")",["T_WHITESPACE","\n                ",394],["T_OBJECT_OPERATOR","->",395],["T_STRING","joinLeft",395],"(",["T_WHITESPACE","\n                    ",395],["T_ARRAY","array",396],"(",["T_CONSTANT_ENCAPSED_STRING","'sv'",396],["T_WHITESPACE"," ",396],["T_DOUBLE_ARROW","=>",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$visibilityInfo",396],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",396],"]",")",",",["T_WHITESPACE","\n                    ",396],"\"",["T_ENCAPSED_AND_WHITESPACE","sv.entity_id = pw.product_id AND sv.attribute_id = ",397],["T_CURLY_OPEN","{",397],["T_VARIABLE","$visibilityInfo",397],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",397],"]","}","\"",["T_WHITESPACE","\n                        ",397],".",["T_WHITESPACE"," ",398],["T_CONSTANT_ENCAPSED_STRING","\" AND sv.store_id = \"",398],["T_WHITESPACE"," ",398],".",["T_WHITESPACE"," ",398],["T_INT_CAST","(int)",398],["T_VARIABLE","$storeId",398],",",["T_WHITESPACE","\n                    ",398],["T_ARRAY","array",399],"(",")",")",["T_WHITESPACE","\n                ",399],["T_OBJECT_OPERATOR","->",400],["T_STRING","join",400],"(",["T_WHITESPACE","\n                    ",400],["T_ARRAY","array",401],"(",["T_CONSTANT_ENCAPSED_STRING","'ds'",401],["T_WHITESPACE"," ",401],["T_DOUBLE_ARROW","=>",401],["T_WHITESPACE"," ",401],["T_VARIABLE","$statusInfo",401],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",401],"]",")",",",["T_WHITESPACE","\n                    ",401],"\"",["T_ENCAPSED_AND_WHITESPACE","ds.entity_id = pw.product_id AND ds.attribute_id = ",402],["T_CURLY_OPEN","{",402],["T_VARIABLE","$statusInfo",402],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",402],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ds.store_id = 0",402],"\"",",",["T_WHITESPACE","\n                    ",402],["T_ARRAY","array",403],"(",")",")",["T_WHITESPACE","\n                ",403],["T_OBJECT_OPERATOR","->",404],["T_STRING","joinLeft",404],"(",["T_WHITESPACE","\n                    ",404],["T_ARRAY","array",405],"(",["T_CONSTANT_ENCAPSED_STRING","'ss'",405],["T_WHITESPACE"," ",405],["T_DOUBLE_ARROW","=>",405],["T_WHITESPACE"," ",405],["T_VARIABLE","$statusInfo",405],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",405],"]",")",",",["T_WHITESPACE","\n                    ",405],"\"",["T_ENCAPSED_AND_WHITESPACE","ss.entity_id = pw.product_id AND ss.attribute_id = ",406],["T_CURLY_OPEN","{",406],["T_VARIABLE","$statusInfo",406],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",406],"]","}","\"",["T_WHITESPACE","\n                        ",406],".",["T_WHITESPACE"," ",407],["T_CONSTANT_ENCAPSED_STRING","\" AND ss.store_id = \"",407],["T_WHITESPACE"," ",407],".",["T_WHITESPACE"," ",407],["T_INT_CAST","(int)",407],["T_VARIABLE","$storeId",407],",",["T_WHITESPACE","\n                    ",407],["T_ARRAY","array",408],"(",")",")",["T_WHITESPACE","\n                ",408],["T_OBJECT_OPERATOR","->",409],["T_STRING","where",409],"(",["T_CONSTANT_ENCAPSED_STRING","'i.product_id IS NULL'",409],")",["T_WHITESPACE","\n                ",409],["T_OBJECT_OPERATOR","->",410],["T_STRING","where",410],"(",["T_CONSTANT_ENCAPSED_STRING","'pw.website_id=?'",410],",",["T_WHITESPACE"," ",410],["T_VARIABLE","$websiteId",410],")",["T_WHITESPACE","\n                ",410],["T_OBJECT_OPERATOR","->",411],["T_STRING","where",411],"(",["T_WHITESPACE","\n                    ",411],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","_getWriteAdapter",412],"(",")",["T_OBJECT_OPERATOR","->",412],["T_STRING","getCheckSql",412],"(",["T_CONSTANT_ENCAPSED_STRING","'ss.value_id IS NOT NULL'",412],",",["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","'ss.value'",412],",",["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","'ds.value'",412],")",["T_WHITESPACE"," ",412],".",["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","' = ?'",412],",",["T_WHITESPACE","\n                    ",412],["T_STRING","Mage_Catalog_Model_Product_Status",413],["T_DOUBLE_COLON","::",413],["T_STRING","STATUS_ENABLED",413],")",["T_WHITESPACE","\n                ",413],["T_OBJECT_OPERATOR","->",414],["T_STRING","columns",414],"(",["T_ARRAY","array",414],"(",["T_WHITESPACE","\n                    ",414],["T_CONSTANT_ENCAPSED_STRING","'category_id'",415],["T_WHITESPACE","   ",415],["T_DOUBLE_ARROW","=>",415],["T_WHITESPACE"," ",415],["T_NEW","new",415],["T_WHITESPACE"," ",415],["T_STRING","Zend_Db_Expr",415],"(",["T_VARIABLE","$rootId",415],")",",",["T_WHITESPACE","\n                    ",415],["T_CONSTANT_ENCAPSED_STRING","'product_id'",416],["T_WHITESPACE","    ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],["T_CONSTANT_ENCAPSED_STRING","'pw.product_id'",416],",",["T_WHITESPACE","\n                    ",416],["T_CONSTANT_ENCAPSED_STRING","'position'",417],["T_WHITESPACE","      ",417],["T_DOUBLE_ARROW","=>",417],["T_WHITESPACE"," ",417],["T_NEW","new",417],["T_WHITESPACE"," ",417],["T_STRING","Zend_Db_Expr",417],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",417],")",",",["T_WHITESPACE","\n                    ",417],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",418],["T_WHITESPACE","     ",418],["T_DOUBLE_ARROW","=>",418],["T_WHITESPACE"," ",418],["T_NEW","new",418],["T_WHITESPACE"," ",418],["T_STRING","Zend_Db_Expr",418],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",418],")",",",["T_WHITESPACE","\n                    ",418],["T_CONSTANT_ENCAPSED_STRING","'store_id'",419],["T_WHITESPACE","      ",419],["T_DOUBLE_ARROW","=>",419],["T_WHITESPACE"," ",419],["T_NEW","new",419],["T_WHITESPACE"," ",419],["T_STRING","Zend_Db_Expr",419],"(",["T_VARIABLE","$storeId",419],")",",",["T_WHITESPACE","\n                    ",419],["T_CONSTANT_ENCAPSED_STRING","'visibility'",420],["T_WHITESPACE","    ",420],["T_DOUBLE_ARROW","=>",420],["T_WHITESPACE"," ",420],["T_VARIABLE","$adapter",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getCheckSql",420],"(",["T_CONSTANT_ENCAPSED_STRING","'sv.value_id IS NOT NULL'",420],",",["T_WHITESPACE"," ",420],["T_CONSTANT_ENCAPSED_STRING","'sv.value'",420],",",["T_WHITESPACE"," ",420],["T_CONSTANT_ENCAPSED_STRING","'dv.value'",420],")",["T_WHITESPACE","\n                ",420],")",")",";",["T_WHITESPACE","\n\n            ",421],["T_VARIABLE","$query",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$select",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","insertFromSelect",423],"(",["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getMainTable",423],"(",")",")",";",["T_WHITESPACE","\n            ",423],["T_VARIABLE","$this",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","_getWriteAdapter",424],"(",")",["T_OBJECT_OPERATOR","->",424],["T_STRING","query",424],"(",["T_VARIABLE","$query",424],")",";",["T_WHITESPACE","\n        ",424],"}",["T_WHITESPACE","\n\n        ",425],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$this",427],";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n\n\n    ",428],["T_DOC_COMMENT","\/**\n     * Rebuild index for direct associations categories and products\n     *\n     * @param null|array $categoryIds\n     * @param null|array $productIds\n     * @return Mage_Catalog_Model_Resource_Category_Indexer_Product\n     *\/",431],["T_WHITESPACE","\n    ",437],["T_PROTECTED","protected",438],["T_WHITESPACE"," ",438],["T_FUNCTION","function",438],["T_WHITESPACE"," ",438],["T_STRING","_refreshDirectRelations",438],"(",["T_VARIABLE","$categoryIds",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_STRING","null",438],",",["T_WHITESPACE"," ",438],["T_VARIABLE","$productIds",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_STRING","null",438],")",["T_WHITESPACE","\n    ",438],"{",["T_WHITESPACE","\n        ",439],["T_IF","if",440],["T_WHITESPACE"," ",440],"(","!",["T_VARIABLE","$categoryIds",440],["T_WHITESPACE"," ",440],["T_BOOLEAN_AND","&&",440],["T_WHITESPACE"," ",440],"!",["T_VARIABLE","$productIds",440],")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n            ",440],["T_RETURN","return",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],";",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE","\n\n        ",442],["T_VARIABLE","$visibilityInfo",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","_getVisibilityAttributeInfo",444],"(",")",";",["T_WHITESPACE","\n        ",444],["T_VARIABLE","$statusInfo",445],["T_WHITESPACE","     ",445],"=",["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","_getStatusAttributeInfo",445],"(",")",";",["T_WHITESPACE","\n        ",445],["T_VARIABLE","$adapter",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","_getWriteAdapter",446],"(",")",";",["T_WHITESPACE","\n        ",446],["T_DOC_COMMENT","\/**\n         * Insert direct relations\n         * product_ids (enabled filter) X category_ids X store_ids\n         * Validate store root category\n         *\/",447],["T_WHITESPACE","\n        ",451],["T_VARIABLE","$isParent",452],["T_WHITESPACE"," ",452],"=",["T_WHITESPACE"," ",452],["T_NEW","new",452],["T_WHITESPACE"," ",452],["T_STRING","Zend_Db_Expr",452],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",452],")",";",["T_WHITESPACE","\n        ",452],["T_VARIABLE","$select",453],["T_WHITESPACE"," ",453],"=",["T_WHITESPACE"," ",453],["T_VARIABLE","$adapter",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","select",453],"(",")",["T_WHITESPACE","\n            ",453],["T_OBJECT_OPERATOR","->",454],["T_STRING","from",454],"(",["T_ARRAY","array",454],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",454],["T_WHITESPACE"," ",454],["T_DOUBLE_ARROW","=>",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","_categoryProductTable",454],")",",",["T_WHITESPACE","\n                ",454],["T_ARRAY","array",455],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",455],",",["T_WHITESPACE"," ",455],["T_CONSTANT_ENCAPSED_STRING","'product_id'",455],",",["T_WHITESPACE"," ",455],["T_CONSTANT_ENCAPSED_STRING","'position'",455],",",["T_WHITESPACE"," ",455],["T_VARIABLE","$isParent",455],")",")",["T_WHITESPACE","\n            ",455],["T_OBJECT_OPERATOR","->",456],["T_STRING","joinInner",456],"(",["T_ARRAY","array",456],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",456],["T_WHITESPACE","  ",456],["T_DOUBLE_ARROW","=>",456],["T_WHITESPACE"," ",456],["T_VARIABLE","$this",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","_productWebsiteTable",456],")",",",["T_WHITESPACE"," ",456],["T_CONSTANT_ENCAPSED_STRING","'pw.product_id=cp.product_id'",456],",",["T_WHITESPACE"," ",456],["T_ARRAY","array",456],"(",")",")",["T_WHITESPACE","\n            ",456],["T_OBJECT_OPERATOR","->",457],["T_STRING","joinInner",457],"(",["T_ARRAY","array",457],"(",["T_CONSTANT_ENCAPSED_STRING","'g'",457],["T_WHITESPACE","   ",457],["T_DOUBLE_ARROW","=>",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","_groupTable",457],")",",",["T_WHITESPACE"," ",457],["T_CONSTANT_ENCAPSED_STRING","'g.website_id=pw.website_id'",457],",",["T_WHITESPACE"," ",457],["T_ARRAY","array",457],"(",")",")",["T_WHITESPACE","\n            ",457],["T_OBJECT_OPERATOR","->",458],["T_STRING","joinInner",458],"(",["T_ARRAY","array",458],"(",["T_CONSTANT_ENCAPSED_STRING","'s'",458],["T_WHITESPACE","   ",458],["T_DOUBLE_ARROW","=>",458],["T_WHITESPACE"," ",458],["T_VARIABLE","$this",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","_storeTable",458],")",",",["T_WHITESPACE"," ",458],["T_CONSTANT_ENCAPSED_STRING","'s.group_id=g.group_id'",458],",",["T_WHITESPACE"," ",458],["T_ARRAY","array",458],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",458],")",")",["T_WHITESPACE","\n            ",458],["T_OBJECT_OPERATOR","->",459],["T_STRING","joinInner",459],"(",["T_ARRAY","array",459],"(",["T_CONSTANT_ENCAPSED_STRING","'rc'",459],["T_WHITESPACE","  ",459],["T_DOUBLE_ARROW","=>",459],["T_WHITESPACE"," ",459],["T_VARIABLE","$this",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","_categoryTable",459],")",",",["T_WHITESPACE"," ",459],["T_CONSTANT_ENCAPSED_STRING","'rc.entity_id=g.root_category_id'",459],",",["T_WHITESPACE"," ",459],["T_ARRAY","array",459],"(",")",")",["T_WHITESPACE","\n            ",459],["T_OBJECT_OPERATOR","->",460],["T_STRING","joinInner",460],"(",["T_WHITESPACE","\n                ",460],["T_ARRAY","array",461],"(",["T_CONSTANT_ENCAPSED_STRING","'ce'",461],["T_DOUBLE_ARROW","=>",461],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","_categoryTable",461],")",",",["T_WHITESPACE","\n                ",461],["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id=cp.category_id AND ('",462],".",["T_WHITESPACE","\n                ",462],["T_VARIABLE","$adapter",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","quoteIdentifier",463],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.path'",463],")",["T_WHITESPACE"," ",463],".",["T_WHITESPACE"," ",463],["T_CONSTANT_ENCAPSED_STRING","' LIKE '",463],["T_WHITESPACE"," ",463],".",["T_WHITESPACE","\n                ",463],["T_VARIABLE","$adapter",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getConcatSql",464],"(",["T_ARRAY","array",464],"(",["T_VARIABLE","$adapter",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","quoteIdentifier",464],"(",["T_CONSTANT_ENCAPSED_STRING","'rc.path'",464],")",["T_WHITESPACE"," ",464],",",["T_WHITESPACE"," ",464],["T_VARIABLE","$adapter",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","quote",464],"(",["T_CONSTANT_ENCAPSED_STRING","'\/%'",464],")",")",")",["T_WHITESPACE"," ",464],".",["T_WHITESPACE","\n                ",464],["T_CONSTANT_ENCAPSED_STRING","' OR ce.entity_id=rc.entity_id)'",465],",",["T_WHITESPACE","\n                ",465],["T_ARRAY","array",466],"(",")",")",["T_WHITESPACE","\n            ",466],["T_OBJECT_OPERATOR","->",467],["T_STRING","joinLeft",467],"(",["T_WHITESPACE","\n                ",467],["T_ARRAY","array",468],"(",["T_CONSTANT_ENCAPSED_STRING","'dv'",468],["T_DOUBLE_ARROW","=>",468],["T_VARIABLE","$visibilityInfo",468],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",468],"]",")",",",["T_WHITESPACE","\n                ",468],["T_VARIABLE","$adapter",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","quoteInto",469],"(",["T_WHITESPACE","\n                    ",469],["T_CONSTANT_ENCAPSED_STRING","\"dv.entity_id=cp.product_id AND dv.attribute_id=? AND dv.store_id=0\"",470],",",["T_WHITESPACE","\n                    ",470],["T_VARIABLE","$visibilityInfo",471],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",471],"]",")",",",["T_WHITESPACE","\n                ",471],["T_ARRAY","array",472],"(",")",["T_WHITESPACE","\n            ",472],")",["T_WHITESPACE","\n            ",473],["T_OBJECT_OPERATOR","->",474],["T_STRING","joinLeft",474],"(",["T_WHITESPACE","\n                ",474],["T_ARRAY","array",475],"(",["T_CONSTANT_ENCAPSED_STRING","'sv'",475],["T_DOUBLE_ARROW","=>",475],["T_VARIABLE","$visibilityInfo",475],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",475],"]",")",",",["T_WHITESPACE","\n                ",475],["T_VARIABLE","$adapter",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","quoteInto",476],"(",["T_WHITESPACE","\n                    ",476],["T_CONSTANT_ENCAPSED_STRING","\"sv.entity_id=cp.product_id AND sv.attribute_id=? AND sv.store_id=s.store_id\"",477],",",["T_WHITESPACE","\n                    ",477],["T_VARIABLE","$visibilityInfo",478],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",478],"]",")",",",["T_WHITESPACE","\n                ",478],["T_ARRAY","array",479],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",479],["T_WHITESPACE"," ",479],["T_DOUBLE_ARROW","=>",479],["T_WHITESPACE"," ",479],["T_VARIABLE","$adapter",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getCheckSql",479],"(",["T_CONSTANT_ENCAPSED_STRING","'sv.value_id IS NOT NULL'",479],",",["T_WHITESPACE","\n                    ",479],["T_VARIABLE","$adapter",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","quoteIdentifier",480],"(",["T_CONSTANT_ENCAPSED_STRING","'sv.value'",480],")",",",["T_WHITESPACE","\n                    ",480],["T_VARIABLE","$adapter",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","quoteIdentifier",481],"(",["T_CONSTANT_ENCAPSED_STRING","'dv.value'",481],")",["T_WHITESPACE","\n                ",481],")",")",["T_WHITESPACE","\n            ",482],")",["T_WHITESPACE","\n            ",483],["T_OBJECT_OPERATOR","->",484],["T_STRING","joinLeft",484],"(",["T_WHITESPACE","\n                ",484],["T_ARRAY","array",485],"(",["T_CONSTANT_ENCAPSED_STRING","'ds'",485],["T_DOUBLE_ARROW","=>",485],["T_VARIABLE","$statusInfo",485],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",485],"]",")",",",["T_WHITESPACE","\n                ",485],"\"",["T_ENCAPSED_AND_WHITESPACE","ds.entity_id=cp.product_id AND ds.attribute_id=",486],["T_CURLY_OPEN","{",486],["T_VARIABLE","$statusInfo",486],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",486],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ds.store_id=0",486],"\"",",",["T_WHITESPACE","\n                ",486],["T_ARRAY","array",487],"(",")",")",["T_WHITESPACE","\n            ",487],["T_OBJECT_OPERATOR","->",488],["T_STRING","joinLeft",488],"(",["T_WHITESPACE","\n                ",488],["T_ARRAY","array",489],"(",["T_CONSTANT_ENCAPSED_STRING","'ss'",489],["T_DOUBLE_ARROW","=>",489],["T_VARIABLE","$statusInfo",489],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",489],"]",")",",",["T_WHITESPACE","\n                ",489],"\"",["T_ENCAPSED_AND_WHITESPACE","ss.entity_id=cp.product_id AND ss.attribute_id=",490],["T_CURLY_OPEN","{",490],["T_VARIABLE","$statusInfo",490],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",490],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ss.store_id=s.store_id",490],"\"",",",["T_WHITESPACE","\n                ",490],["T_ARRAY","array",491],"(",")",")",["T_WHITESPACE","\n            ",491],["T_OBJECT_OPERATOR","->",492],["T_STRING","where",492],"(",["T_WHITESPACE","\n                ",492],["T_VARIABLE","$adapter",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getCheckSql",493],"(",["T_CONSTANT_ENCAPSED_STRING","'ss.value_id IS NOT NULL'",493],",",["T_WHITESPACE","\n                    ",493],["T_VARIABLE","$adapter",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","quoteIdentifier",494],"(",["T_CONSTANT_ENCAPSED_STRING","'ss.value'",494],")",",",["T_WHITESPACE","\n                    ",494],["T_VARIABLE","$adapter",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","quoteIdentifier",495],"(",["T_CONSTANT_ENCAPSED_STRING","'ds.value'",495],")",["T_WHITESPACE","\n                ",495],")",["T_WHITESPACE"," ",496],".",["T_WHITESPACE"," ",496],["T_CONSTANT_ENCAPSED_STRING","' = ?'",496],",",["T_WHITESPACE","\n                ",496],["T_STRING","Mage_Catalog_Model_Product_Status",497],["T_DOUBLE_COLON","::",497],["T_STRING","STATUS_ENABLED",497],["T_WHITESPACE","\n            ",497],")",";",["T_WHITESPACE","\n        ",498],["T_IF","if",499],["T_WHITESPACE"," ",499],"(",["T_VARIABLE","$categoryIds",499],")",["T_WHITESPACE"," ",499],"{",["T_WHITESPACE","\n            ",499],["T_VARIABLE","$select",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","where",500],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.category_id IN (?)'",500],",",["T_WHITESPACE"," ",500],["T_VARIABLE","$categoryIds",500],")",";",["T_WHITESPACE","\n        ",500],"}",["T_WHITESPACE","\n        ",501],["T_IF","if",502],["T_WHITESPACE"," ",502],"(",["T_VARIABLE","$productIds",502],")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE","\n            ",502],["T_VARIABLE","$select",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","where",503],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.product_id IN(?)'",503],",",["T_WHITESPACE"," ",503],["T_VARIABLE","$productIds",503],")",";",["T_WHITESPACE","\n        ",503],"}",["T_WHITESPACE","\n        ",504],["T_VARIABLE","$sql",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_VARIABLE","$select",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","insertFromSelect",505],"(",["T_WHITESPACE","\n            ",505],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getMainTable",506],"(",")",",",["T_WHITESPACE","\n            ",506],["T_ARRAY","array",507],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",507],",",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'product_id'",507],",",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'position'",507],",",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",507],",",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'store_id'",507],",",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'visibility'",507],")",",",["T_WHITESPACE","\n            ",507],["T_STRING","true",508],["T_WHITESPACE","\n        ",508],")",";",["T_WHITESPACE","\n        ",509],["T_VARIABLE","$adapter",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","query",510],"(",["T_VARIABLE","$sql",510],")",";",["T_WHITESPACE","\n        ",510],["T_RETURN","return",511],["T_WHITESPACE"," ",511],["T_VARIABLE","$this",511],";",["T_WHITESPACE","\n    ",511],"}",["T_WHITESPACE","\n\n    ",512],["T_DOC_COMMENT","\/**\n     * Rebuild index for anchor categories and associated to child categories products\n     *\n     * @param null | array $categoryIds\n     * @param null | array $productIds\n     * @return Mage_Catalog_Model_Resource_Category_Indexer_Product\n     *\/",514],["T_WHITESPACE","\n    ",520],["T_PROTECTED","protected",521],["T_WHITESPACE"," ",521],["T_FUNCTION","function",521],["T_WHITESPACE"," ",521],["T_STRING","_refreshAnchorRelations",521],"(",["T_VARIABLE","$categoryIds",521],["T_WHITESPACE"," ",521],"=",["T_WHITESPACE"," ",521],["T_STRING","null",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$productIds",521],["T_WHITESPACE"," ",521],"=",["T_WHITESPACE"," ",521],["T_STRING","null",521],")",["T_WHITESPACE","\n    ",521],"{",["T_WHITESPACE","\n        ",522],["T_IF","if",523],["T_WHITESPACE"," ",523],"(","!",["T_VARIABLE","$categoryIds",523],["T_WHITESPACE"," ",523],["T_BOOLEAN_AND","&&",523],["T_WHITESPACE"," ",523],"!",["T_VARIABLE","$productIds",523],")",["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n            ",523],["T_RETURN","return",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$this",524],";",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n\n        ",525],["T_VARIABLE","$anchorInfo",527],["T_WHITESPACE","     ",527],"=",["T_WHITESPACE"," ",527],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","_getAnchorAttributeInfo",527],"(",")",";",["T_WHITESPACE","\n        ",527],["T_VARIABLE","$visibilityInfo",528],["T_WHITESPACE"," ",528],"=",["T_WHITESPACE"," ",528],["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","_getVisibilityAttributeInfo",528],"(",")",";",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$statusInfo",529],["T_WHITESPACE","     ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","_getStatusAttributeInfo",529],"(",")",";",["T_WHITESPACE","\n\n        ",529],["T_DOC_COMMENT","\/**\n         * Insert anchor categories relations\n         *\/",531],["T_WHITESPACE","\n        ",533],["T_VARIABLE","$adapter",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","_getReadAdapter",534],"(",")",";",["T_WHITESPACE","\n        ",534],["T_VARIABLE","$isParent",535],["T_WHITESPACE"," ",535],"=",["T_WHITESPACE"," ",535],["T_VARIABLE","$adapter",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","getCheckSql",535],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(cp.category_id)=ce.entity_id'",535],",",["T_WHITESPACE"," ",535],["T_LNUMBER","1",535],",",["T_WHITESPACE"," ",535],["T_LNUMBER","0",535],")",";",["T_WHITESPACE","\n        ",535],["T_VARIABLE","$position",536],["T_WHITESPACE"," ",536],"=",["T_WHITESPACE"," ",536],["T_CONSTANT_ENCAPSED_STRING","'MIN('",536],".",["T_WHITESPACE","\n            ",536],["T_VARIABLE","$adapter",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getCheckSql",537],"(",["T_WHITESPACE","\n                ",537],["T_CONSTANT_ENCAPSED_STRING","'cp.category_id = ce.entity_id'",538],",",["T_WHITESPACE","\n                ",538],["T_CONSTANT_ENCAPSED_STRING","'cp.position'",539],",",["T_WHITESPACE","\n                ",539],["T_CONSTANT_ENCAPSED_STRING","'(cc.position + 1) * ('",540],".",["T_VARIABLE","$adapter",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","quoteIdentifier",540],"(",["T_CONSTANT_ENCAPSED_STRING","'cc.level'",540],")",".",["T_CONSTANT_ENCAPSED_STRING","' + 1) * 10000 + cp.position'",540],["T_WHITESPACE","\n            ",540],")",["T_WHITESPACE","\n        ",541],".",["T_CONSTANT_ENCAPSED_STRING","')'",542],";",["T_WHITESPACE","\n\n        ",542],["T_VARIABLE","$select",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],["T_VARIABLE","$adapter",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","select",544],"(",")",["T_WHITESPACE","\n            ",544],["T_OBJECT_OPERATOR","->",545],["T_STRING","distinct",545],"(",["T_STRING","true",545],")",["T_WHITESPACE","\n            ",545],["T_OBJECT_OPERATOR","->",546],["T_STRING","from",546],"(",["T_ARRAY","array",546],"(",["T_CONSTANT_ENCAPSED_STRING","'ce'",546],["T_WHITESPACE"," ",546],["T_DOUBLE_ARROW","=>",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$this",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","_categoryTable",546],")",",",["T_WHITESPACE"," ",546],["T_ARRAY","array",546],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",546],")",")",["T_WHITESPACE","\n            ",546],["T_OBJECT_OPERATOR","->",547],["T_STRING","joinInner",547],"(",["T_WHITESPACE","\n                ",547],["T_ARRAY","array",548],"(",["T_CONSTANT_ENCAPSED_STRING","'cc'",548],["T_WHITESPACE"," ",548],["T_DOUBLE_ARROW","=>",548],["T_WHITESPACE"," ",548],["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","_categoryTable",548],")",",",["T_WHITESPACE","\n                ",548],["T_VARIABLE","$adapter",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","quoteIdentifier",549],"(",["T_CONSTANT_ENCAPSED_STRING","'cc.path'",549],")",["T_WHITESPACE"," ",549],".",["T_WHITESPACE","\n                ",549],["T_CONSTANT_ENCAPSED_STRING","' LIKE ('",550],".",["T_VARIABLE","$adapter",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","getConcatSql",550],"(",["T_ARRAY","array",550],"(",["T_VARIABLE","$adapter",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","quoteIdentifier",550],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.path'",550],")",",",["T_VARIABLE","$adapter",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","quote",550],"(",["T_CONSTANT_ENCAPSED_STRING","'\/%'",550],")",")",")",".",["T_CONSTANT_ENCAPSED_STRING","')'",550],["T_WHITESPACE","\n                ",550],".",["T_WHITESPACE"," ",551],["T_CONSTANT_ENCAPSED_STRING","' OR cc.entity_id=ce.entity_id'",551],["T_WHITESPACE","\n                ",551],",",["T_WHITESPACE"," ",552],["T_ARRAY","array",552],"(",")",["T_WHITESPACE","\n            ",552],")",["T_WHITESPACE","\n            ",553],["T_OBJECT_OPERATOR","->",554],["T_STRING","joinInner",554],"(",["T_WHITESPACE","\n                ",554],["T_ARRAY","array",555],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",555],["T_WHITESPACE"," ",555],["T_DOUBLE_ARROW","=>",555],["T_WHITESPACE"," ",555],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","_categoryProductTable",555],")",",",["T_WHITESPACE","\n                ",555],["T_CONSTANT_ENCAPSED_STRING","'cp.category_id=cc.entity_id'",556],",",["T_WHITESPACE","\n                ",556],["T_ARRAY","array",557],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.product_id'",557],",",["T_WHITESPACE"," ",557],["T_CONSTANT_ENCAPSED_STRING","'position'",557],["T_WHITESPACE"," ",557],["T_DOUBLE_ARROW","=>",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$position",557],",",["T_WHITESPACE"," ",557],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",557],["T_WHITESPACE"," ",557],["T_DOUBLE_ARROW","=>",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$isParent",557],")",["T_WHITESPACE","\n            ",557],")",["T_WHITESPACE","\n            ",558],["T_OBJECT_OPERATOR","->",559],["T_STRING","joinInner",559],"(",["T_ARRAY","array",559],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",559],["T_WHITESPACE"," ",559],["T_DOUBLE_ARROW","=>",559],["T_WHITESPACE"," ",559],["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","_productWebsiteTable",559],")",",",["T_WHITESPACE"," ",559],["T_CONSTANT_ENCAPSED_STRING","'pw.product_id=cp.product_id'",559],",",["T_WHITESPACE"," ",559],["T_ARRAY","array",559],"(",")",")",["T_WHITESPACE","\n            ",559],["T_OBJECT_OPERATOR","->",560],["T_STRING","joinInner",560],"(",["T_ARRAY","array",560],"(",["T_CONSTANT_ENCAPSED_STRING","'g'",560],["T_WHITESPACE","  ",560],["T_DOUBLE_ARROW","=>",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","_groupTable",560],")",",",["T_WHITESPACE"," ",560],["T_CONSTANT_ENCAPSED_STRING","'g.website_id=pw.website_id'",560],",",["T_WHITESPACE"," ",560],["T_ARRAY","array",560],"(",")",")",["T_WHITESPACE","\n            ",560],["T_OBJECT_OPERATOR","->",561],["T_STRING","joinInner",561],"(",["T_ARRAY","array",561],"(",["T_CONSTANT_ENCAPSED_STRING","'s'",561],["T_WHITESPACE","  ",561],["T_DOUBLE_ARROW","=>",561],["T_WHITESPACE"," ",561],["T_VARIABLE","$this",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","_storeTable",561],")",",",["T_WHITESPACE"," ",561],["T_CONSTANT_ENCAPSED_STRING","'s.group_id=g.group_id'",561],",",["T_WHITESPACE"," ",561],["T_ARRAY","array",561],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",561],")",")",["T_WHITESPACE","\n            ",561],["T_OBJECT_OPERATOR","->",562],["T_STRING","joinInner",562],"(",["T_ARRAY","array",562],"(",["T_CONSTANT_ENCAPSED_STRING","'rc'",562],["T_WHITESPACE"," ",562],["T_DOUBLE_ARROW","=>",562],["T_WHITESPACE"," ",562],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","_categoryTable",562],")",",",["T_WHITESPACE"," ",562],["T_CONSTANT_ENCAPSED_STRING","'rc.entity_id=g.root_category_id'",562],",",["T_WHITESPACE"," ",562],["T_ARRAY","array",562],"(",")",")",["T_WHITESPACE","\n            ",562],["T_OBJECT_OPERATOR","->",563],["T_STRING","joinLeft",563],"(",["T_WHITESPACE","\n                ",563],["T_ARRAY","array",564],"(",["T_CONSTANT_ENCAPSED_STRING","'dca'",564],["T_DOUBLE_ARROW","=>",564],["T_VARIABLE","$anchorInfo",564],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",564],"]",")",",",["T_WHITESPACE","\n                ",564],"\"",["T_ENCAPSED_AND_WHITESPACE","dca.entity_id=ce.entity_id AND dca.attribute_id=",565],["T_CURLY_OPEN","{",565],["T_VARIABLE","$anchorInfo",565],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",565],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND dca.store_id=0",565],"\"",",",["T_WHITESPACE","\n                ",565],["T_ARRAY","array",566],"(",")",")",["T_WHITESPACE","\n            ",566],["T_OBJECT_OPERATOR","->",567],["T_STRING","joinLeft",567],"(",["T_WHITESPACE","\n                ",567],["T_ARRAY","array",568],"(",["T_CONSTANT_ENCAPSED_STRING","'sca'",568],["T_DOUBLE_ARROW","=>",568],["T_VARIABLE","$anchorInfo",568],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",568],"]",")",",",["T_WHITESPACE","\n                ",568],"\"",["T_ENCAPSED_AND_WHITESPACE","sca.entity_id=ce.entity_id AND sca.attribute_id=",569],["T_CURLY_OPEN","{",569],["T_VARIABLE","$anchorInfo",569],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",569],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND sca.store_id=s.store_id",569],"\"",",",["T_WHITESPACE","\n                ",569],["T_ARRAY","array",570],"(",")",")",["T_WHITESPACE","\n            ",570],["T_OBJECT_OPERATOR","->",571],["T_STRING","joinLeft",571],"(",["T_WHITESPACE","\n                ",571],["T_ARRAY","array",572],"(",["T_CONSTANT_ENCAPSED_STRING","'dv'",572],["T_DOUBLE_ARROW","=>",572],["T_VARIABLE","$visibilityInfo",572],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",572],"]",")",",",["T_WHITESPACE","\n                ",572],"\"",["T_ENCAPSED_AND_WHITESPACE","dv.entity_id=pw.product_id AND dv.attribute_id=",573],["T_CURLY_OPEN","{",573],["T_VARIABLE","$visibilityInfo",573],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",573],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND dv.store_id=0",573],"\"",",",["T_WHITESPACE","\n                ",573],["T_ARRAY","array",574],"(",")",")",["T_WHITESPACE","\n            ",574],["T_OBJECT_OPERATOR","->",575],["T_STRING","joinLeft",575],"(",["T_WHITESPACE","\n                ",575],["T_ARRAY","array",576],"(",["T_CONSTANT_ENCAPSED_STRING","'sv'",576],["T_DOUBLE_ARROW","=>",576],["T_VARIABLE","$visibilityInfo",576],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",576],"]",")",",",["T_WHITESPACE","\n                ",576],"\"",["T_ENCAPSED_AND_WHITESPACE","sv.entity_id=pw.product_id AND sv.attribute_id=",577],["T_CURLY_OPEN","{",577],["T_VARIABLE","$visibilityInfo",577],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",577],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND sv.store_id=s.store_id",577],"\"",",",["T_WHITESPACE","\n                ",577],["T_ARRAY","array",578],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",578],["T_WHITESPACE"," ",578],["T_DOUBLE_ARROW","=>",578],["T_WHITESPACE"," ",578],["T_VARIABLE","$adapter",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getCheckSql",578],"(",["T_WHITESPACE","\n                    ",578],["T_CONSTANT_ENCAPSED_STRING","'MIN(sv.value_id) IS NOT NULL'",579],",",["T_WHITESPACE","\n                    ",579],["T_CONSTANT_ENCAPSED_STRING","'MIN(sv.value)'",580],",",["T_WHITESPACE"," ",580],["T_CONSTANT_ENCAPSED_STRING","'MIN(dv.value)'",580],["T_WHITESPACE","\n                ",580],")",")",["T_WHITESPACE","\n            ",581],")",["T_WHITESPACE","\n            ",582],["T_OBJECT_OPERATOR","->",583],["T_STRING","joinLeft",583],"(",["T_WHITESPACE","\n                ",583],["T_ARRAY","array",584],"(",["T_CONSTANT_ENCAPSED_STRING","'ds'",584],["T_DOUBLE_ARROW","=>",584],["T_VARIABLE","$statusInfo",584],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",584],"]",")",",",["T_WHITESPACE","\n                ",584],"\"",["T_ENCAPSED_AND_WHITESPACE","ds.entity_id=pw.product_id AND ds.attribute_id=",585],["T_CURLY_OPEN","{",585],["T_VARIABLE","$statusInfo",585],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",585],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ds.store_id=0",585],"\"",",",["T_WHITESPACE","\n                ",585],["T_ARRAY","array",586],"(",")",")",["T_WHITESPACE","\n            ",586],["T_OBJECT_OPERATOR","->",587],["T_STRING","joinLeft",587],"(",["T_WHITESPACE","\n                ",587],["T_ARRAY","array",588],"(",["T_CONSTANT_ENCAPSED_STRING","'ss'",588],["T_DOUBLE_ARROW","=>",588],["T_VARIABLE","$statusInfo",588],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",588],"]",")",",",["T_WHITESPACE","\n                ",588],"\"",["T_ENCAPSED_AND_WHITESPACE","ss.entity_id=pw.product_id AND ss.attribute_id=",589],["T_CURLY_OPEN","{",589],["T_VARIABLE","$statusInfo",589],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",589],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ss.store_id=s.store_id",589],"\"",",",["T_WHITESPACE","\n                ",589],["T_ARRAY","array",590],"(",")",")",["T_WHITESPACE","\n            ",590],["T_DOC_COMMENT","\/**\n             * Condition for anchor or root category (all products should be assigned to root)\n             *\/",591],["T_WHITESPACE","\n            ",593],["T_OBJECT_OPERATOR","->",594],["T_STRING","where",594],"(",["T_CONSTANT_ENCAPSED_STRING","'('",594],".",["T_WHITESPACE","\n                ",594],["T_VARIABLE","$adapter",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","quoteIdentifier",595],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.path'",595],")",["T_WHITESPACE"," ",595],".",["T_WHITESPACE"," ",595],["T_CONSTANT_ENCAPSED_STRING","' LIKE '",595],["T_WHITESPACE"," ",595],".",["T_WHITESPACE","\n                ",595],["T_VARIABLE","$adapter",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","getConcatSql",596],"(",["T_ARRAY","array",596],"(",["T_VARIABLE","$adapter",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","quoteIdentifier",596],"(",["T_CONSTANT_ENCAPSED_STRING","'rc.path'",596],")",",",["T_WHITESPACE"," ",596],["T_VARIABLE","$adapter",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","quote",596],"(",["T_CONSTANT_ENCAPSED_STRING","'\/%'",596],")",")",")",["T_WHITESPACE"," ",596],".",["T_WHITESPACE"," ",596],["T_CONSTANT_ENCAPSED_STRING","' AND '",596],["T_WHITESPACE"," ",596],".",["T_WHITESPACE","\n                ",596],["T_VARIABLE","$adapter",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","getCheckSql",597],"(",["T_CONSTANT_ENCAPSED_STRING","'sca.value_id IS NOT NULL'",597],",",["T_WHITESPACE","\n                    ",597],["T_VARIABLE","$adapter",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","quoteIdentifier",598],"(",["T_CONSTANT_ENCAPSED_STRING","'sca.value'",598],")",",",["T_WHITESPACE","\n                    ",598],["T_VARIABLE","$adapter",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","quoteIdentifier",599],"(",["T_CONSTANT_ENCAPSED_STRING","'dca.value'",599],")",")",["T_WHITESPACE"," ",599],".",["T_WHITESPACE"," ",599],["T_CONSTANT_ENCAPSED_STRING","'=1) OR ce.entity_id=rc.entity_id'",599],["T_WHITESPACE","\n            ",599],")",["T_WHITESPACE","\n            ",600],["T_OBJECT_OPERATOR","->",601],["T_STRING","where",601],"(",["T_WHITESPACE","\n                ",601],["T_VARIABLE","$adapter",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getCheckSql",602],"(",["T_CONSTANT_ENCAPSED_STRING","'ss.value_id IS NOT NULL'",602],",",["T_WHITESPACE"," ",602],["T_CONSTANT_ENCAPSED_STRING","'ss.value'",602],",",["T_WHITESPACE"," ",602],["T_CONSTANT_ENCAPSED_STRING","'ds.value'",602],")",["T_WHITESPACE"," ",602],".",["T_WHITESPACE"," ",602],["T_CONSTANT_ENCAPSED_STRING","'=?'",602],",",["T_WHITESPACE","\n                ",602],["T_STRING","Mage_Catalog_Model_Product_Status",603],["T_DOUBLE_COLON","::",603],["T_STRING","STATUS_ENABLED",603],["T_WHITESPACE","\n            ",603],")",["T_WHITESPACE","\n            ",604],["T_OBJECT_OPERATOR","->",605],["T_STRING","group",605],"(",["T_ARRAY","array",605],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id'",605],",",["T_WHITESPACE"," ",605],["T_CONSTANT_ENCAPSED_STRING","'cp.product_id'",605],",",["T_WHITESPACE"," ",605],["T_CONSTANT_ENCAPSED_STRING","'s.store_id'",605],")",")",";",["T_WHITESPACE","\n        ",605],["T_IF","if",606],["T_WHITESPACE"," ",606],"(",["T_VARIABLE","$categoryIds",606],")",["T_WHITESPACE"," ",606],"{",["T_WHITESPACE","\n            ",606],["T_VARIABLE","$select",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","where",607],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id IN (?)'",607],",",["T_WHITESPACE"," ",607],["T_VARIABLE","$categoryIds",607],")",";",["T_WHITESPACE","\n        ",607],"}",["T_WHITESPACE","\n        ",608],["T_IF","if",609],["T_WHITESPACE"," ",609],"(",["T_VARIABLE","$productIds",609],")",["T_WHITESPACE"," ",609],"{",["T_WHITESPACE","\n            ",609],["T_VARIABLE","$select",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","where",610],"(",["T_CONSTANT_ENCAPSED_STRING","'pw.product_id IN(?)'",610],",",["T_WHITESPACE"," ",610],["T_VARIABLE","$productIds",610],")",";",["T_WHITESPACE","\n        ",610],"}",["T_WHITESPACE","\n\n        ",611],["T_VARIABLE","$sql",613],["T_WHITESPACE"," ",613],"=",["T_WHITESPACE"," ",613],["T_VARIABLE","$select",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","insertFromSelect",613],"(",["T_VARIABLE","$this",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","getMainTable",613],"(",")",")",";",["T_WHITESPACE","\n        ",613],["T_VARIABLE","$this",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","_getWriteAdapter",614],"(",")",["T_OBJECT_OPERATOR","->",614],["T_STRING","query",614],"(",["T_VARIABLE","$sql",614],")",";",["T_WHITESPACE","\n        ",614],["T_RETURN","return",615],["T_WHITESPACE"," ",615],["T_VARIABLE","$this",615],";",["T_WHITESPACE","\n    ",615],"}",["T_WHITESPACE","\n\n    ",616],["T_DOC_COMMENT","\/**\n     * Add product association with root store category for products which are not assigned to any another category\n     *\n     * @param int | array $productIds\n     * @return Mage_Catalog_Model_Resource_Category_Indexer_Product\n     *\/",618],["T_WHITESPACE","\n    ",623],["T_PROTECTED","protected",624],["T_WHITESPACE"," ",624],["T_FUNCTION","function",624],["T_WHITESPACE"," ",624],["T_STRING","_refreshRootRelations",624],"(",["T_VARIABLE","$productIds",624],")",["T_WHITESPACE","\n    ",624],"{",["T_WHITESPACE","\n        ",625],["T_VARIABLE","$visibilityInfo",626],["T_WHITESPACE"," ",626],"=",["T_WHITESPACE"," ",626],["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","_getVisibilityAttributeInfo",626],"(",")",";",["T_WHITESPACE","\n        ",626],["T_VARIABLE","$statusInfo",627],["T_WHITESPACE","     ",627],"=",["T_WHITESPACE"," ",627],["T_VARIABLE","$this",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","_getStatusAttributeInfo",627],"(",")",";",["T_WHITESPACE","\n        ",627],["T_VARIABLE","$adapter",628],["T_WHITESPACE"," ",628],"=",["T_WHITESPACE"," ",628],["T_VARIABLE","$this",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","_getWriteAdapter",628],"(",")",";",["T_WHITESPACE","\n        ",628],["T_DOC_COMMENT","\/**\n         * Insert anchor categories relations\n         *\/",629],["T_WHITESPACE","\n        ",631],["T_VARIABLE","$isParent",632],["T_WHITESPACE"," ",632],"=",["T_WHITESPACE"," ",632],["T_NEW","new",632],["T_WHITESPACE"," ",632],["T_STRING","Zend_Db_Expr",632],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",632],")",";",["T_WHITESPACE","\n        ",632],["T_VARIABLE","$position",633],["T_WHITESPACE"," ",633],"=",["T_WHITESPACE"," ",633],["T_NEW","new",633],["T_WHITESPACE"," ",633],["T_STRING","Zend_Db_Expr",633],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",633],")",";",["T_WHITESPACE","\n        ",633],["T_VARIABLE","$select",634],["T_WHITESPACE"," ",634],"=",["T_WHITESPACE"," ",634],["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","_getReadAdapter",634],"(",")",["T_OBJECT_OPERATOR","->",634],["T_STRING","select",634],"(",")",["T_WHITESPACE","\n            ",634],["T_OBJECT_OPERATOR","->",635],["T_STRING","distinct",635],"(",["T_STRING","true",635],")",["T_WHITESPACE","\n            ",635],["T_OBJECT_OPERATOR","->",636],["T_STRING","from",636],"(",["T_ARRAY","array",636],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",636],["T_WHITESPACE","  ",636],["T_DOUBLE_ARROW","=>",636],["T_WHITESPACE"," ",636],["T_VARIABLE","$this",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","_productWebsiteTable",636],")",",",["T_WHITESPACE"," ",636],["T_ARRAY","array",636],"(",")",")",["T_WHITESPACE","\n            ",636],["T_OBJECT_OPERATOR","->",637],["T_STRING","joinInner",637],"(",["T_ARRAY","array",637],"(",["T_CONSTANT_ENCAPSED_STRING","'g'",637],["T_WHITESPACE","   ",637],["T_DOUBLE_ARROW","=>",637],["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_groupTable",637],")",",",["T_WHITESPACE"," ",637],["T_CONSTANT_ENCAPSED_STRING","'g.website_id=pw.website_id'",637],",",["T_WHITESPACE"," ",637],["T_ARRAY","array",637],"(",")",")",["T_WHITESPACE","\n            ",637],["T_OBJECT_OPERATOR","->",638],["T_STRING","joinInner",638],"(",["T_ARRAY","array",638],"(",["T_CONSTANT_ENCAPSED_STRING","'s'",638],["T_WHITESPACE","   ",638],["T_DOUBLE_ARROW","=>",638],["T_WHITESPACE"," ",638],["T_VARIABLE","$this",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","_storeTable",638],")",",",["T_WHITESPACE"," ",638],["T_CONSTANT_ENCAPSED_STRING","'s.group_id=g.group_id'",638],",",["T_WHITESPACE"," ",638],["T_ARRAY","array",638],"(",")",")",["T_WHITESPACE","\n            ",638],["T_OBJECT_OPERATOR","->",639],["T_STRING","joinInner",639],"(",["T_ARRAY","array",639],"(",["T_CONSTANT_ENCAPSED_STRING","'rc'",639],["T_WHITESPACE","  ",639],["T_DOUBLE_ARROW","=>",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$this",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","_categoryTable",639],")",",",["T_WHITESPACE"," ",639],["T_CONSTANT_ENCAPSED_STRING","'rc.entity_id=g.root_category_id'",639],",",["T_WHITESPACE","\n                ",639],["T_ARRAY","array",640],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",640],")",")",["T_WHITESPACE","\n            ",640],["T_OBJECT_OPERATOR","->",641],["T_STRING","joinLeft",641],"(",["T_ARRAY","array",641],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",641],["T_WHITESPACE","   ",641],["T_DOUBLE_ARROW","=>",641],["T_WHITESPACE"," ",641],["T_VARIABLE","$this",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","_categoryProductTable",641],")",",",["T_WHITESPACE"," ",641],["T_CONSTANT_ENCAPSED_STRING","'cp.product_id=pw.product_id'",641],",",["T_WHITESPACE","\n                ",641],["T_ARRAY","array",642],"(",["T_CONSTANT_ENCAPSED_STRING","'pw.product_id'",642],",",["T_WHITESPACE"," ",642],["T_VARIABLE","$position",642],",",["T_WHITESPACE"," ",642],["T_VARIABLE","$isParent",642],",",["T_WHITESPACE"," ",642],["T_CONSTANT_ENCAPSED_STRING","'s.store_id'",642],")",")",["T_WHITESPACE","\n            ",642],["T_OBJECT_OPERATOR","->",643],["T_STRING","joinLeft",643],"(",["T_WHITESPACE","\n                ",643],["T_ARRAY","array",644],"(",["T_CONSTANT_ENCAPSED_STRING","'dv'",644],["T_DOUBLE_ARROW","=>",644],["T_VARIABLE","$visibilityInfo",644],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",644],"]",")",",",["T_WHITESPACE","\n                ",644],"\"",["T_ENCAPSED_AND_WHITESPACE","dv.entity_id=pw.product_id AND dv.attribute_id=",645],["T_CURLY_OPEN","{",645],["T_VARIABLE","$visibilityInfo",645],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",645],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND dv.store_id=0",645],"\"",",",["T_WHITESPACE","\n                ",645],["T_ARRAY","array",646],"(",")",")",["T_WHITESPACE","\n            ",646],["T_OBJECT_OPERATOR","->",647],["T_STRING","joinLeft",647],"(",["T_WHITESPACE","\n                ",647],["T_ARRAY","array",648],"(",["T_CONSTANT_ENCAPSED_STRING","'sv'",648],["T_DOUBLE_ARROW","=>",648],["T_VARIABLE","$visibilityInfo",648],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",648],"]",")",",",["T_WHITESPACE","\n                ",648],"\"",["T_ENCAPSED_AND_WHITESPACE","sv.entity_id=pw.product_id AND sv.attribute_id=",649],["T_CURLY_OPEN","{",649],["T_VARIABLE","$visibilityInfo",649],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",649],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND sv.store_id=s.store_id",649],"\"",",",["T_WHITESPACE","\n                ",649],["T_ARRAY","array",650],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",650],["T_WHITESPACE"," ",650],["T_DOUBLE_ARROW","=>",650],["T_WHITESPACE"," ",650],["T_VARIABLE","$adapter",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getCheckSql",650],"(",["T_CONSTANT_ENCAPSED_STRING","'sv.value_id IS NOT NULL'",650],",",["T_WHITESPACE","\n                    ",650],["T_VARIABLE","$adapter",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","quoteIdentifier",651],"(",["T_CONSTANT_ENCAPSED_STRING","'sv.value'",651],")",",",["T_WHITESPACE","\n                    ",651],["T_VARIABLE","$adapter",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","quoteIdentifier",652],"(",["T_CONSTANT_ENCAPSED_STRING","'dv.value'",652],")",["T_WHITESPACE","\n                ",652],")",")",["T_WHITESPACE","\n            ",653],")",["T_WHITESPACE","\n            ",654],["T_OBJECT_OPERATOR","->",655],["T_STRING","joinLeft",655],"(",["T_WHITESPACE","\n                ",655],["T_ARRAY","array",656],"(",["T_CONSTANT_ENCAPSED_STRING","'ds'",656],["T_DOUBLE_ARROW","=>",656],["T_VARIABLE","$statusInfo",656],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",656],"]",")",",",["T_WHITESPACE","\n                ",656],"\"",["T_ENCAPSED_AND_WHITESPACE","ds.entity_id=pw.product_id AND ds.attribute_id=",657],["T_CURLY_OPEN","{",657],["T_VARIABLE","$statusInfo",657],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",657],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ds.store_id=0",657],"\"",",",["T_WHITESPACE","\n                ",657],["T_ARRAY","array",658],"(",")",")",["T_WHITESPACE","\n            ",658],["T_OBJECT_OPERATOR","->",659],["T_STRING","joinLeft",659],"(",["T_WHITESPACE","\n                ",659],["T_ARRAY","array",660],"(",["T_CONSTANT_ENCAPSED_STRING","'ss'",660],["T_DOUBLE_ARROW","=>",660],["T_VARIABLE","$statusInfo",660],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",660],"]",")",",",["T_WHITESPACE","\n                ",660],"\"",["T_ENCAPSED_AND_WHITESPACE","ss.entity_id=pw.product_id AND ss.attribute_id=",661],["T_CURLY_OPEN","{",661],["T_VARIABLE","$statusInfo",661],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",661],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ss.store_id=s.store_id",661],"\"",",",["T_WHITESPACE","\n                ",661],["T_ARRAY","array",662],"(",")",")",["T_WHITESPACE","\n            ",662],["T_DOC_COMMENT","\/**\n             * Condition for anchor or root category (all products should be assigned to root)\n             *\/",663],["T_WHITESPACE","\n            ",665],["T_OBJECT_OPERATOR","->",666],["T_STRING","where",666],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.product_id IS NULL'",666],")",["T_WHITESPACE","\n            ",666],["T_OBJECT_OPERATOR","->",667],["T_STRING","where",667],"(",["T_WHITESPACE","\n                    ",667],["T_VARIABLE","$adapter",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","getCheckSql",668],"(",["T_CONSTANT_ENCAPSED_STRING","'ss.value_id IS NOT NULL'",668],",",["T_WHITESPACE","\n                        ",668],["T_VARIABLE","$adapter",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","quoteIdentifier",669],"(",["T_CONSTANT_ENCAPSED_STRING","'ss.value'",669],")",",",["T_WHITESPACE","\n                        ",669],["T_VARIABLE","$adapter",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","quoteIdentifier",670],"(",["T_CONSTANT_ENCAPSED_STRING","'ds.value'",670],")",["T_WHITESPACE","\n                    ",670],")",["T_WHITESPACE"," ",671],".",["T_WHITESPACE"," ",671],["T_CONSTANT_ENCAPSED_STRING","' = ?'",671],",",["T_WHITESPACE"," ",671],["T_STRING","Mage_Catalog_Model_Product_Status",671],["T_DOUBLE_COLON","::",671],["T_STRING","STATUS_ENABLED",671],")",["T_WHITESPACE","\n            ",671],["T_OBJECT_OPERATOR","->",672],["T_STRING","where",672],"(",["T_CONSTANT_ENCAPSED_STRING","'pw.product_id IN(?)'",672],",",["T_WHITESPACE"," ",672],["T_VARIABLE","$productIds",672],")",";",["T_WHITESPACE","\n\n        ",672],["T_VARIABLE","$sql",674],["T_WHITESPACE"," ",674],"=",["T_WHITESPACE"," ",674],["T_VARIABLE","$select",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","insertFromSelect",674],"(",["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","getMainTable",674],"(",")",")",";",["T_WHITESPACE","\n        ",674],["T_VARIABLE","$this",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","_getWriteAdapter",675],"(",")",["T_OBJECT_OPERATOR","->",675],["T_STRING","query",675],"(",["T_VARIABLE","$sql",675],")",";",["T_WHITESPACE","\n\n        ",675],["T_VARIABLE","$select",677],["T_WHITESPACE"," ",677],"=",["T_WHITESPACE"," ",677],["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","_getReadAdapter",677],"(",")",["T_OBJECT_OPERATOR","->",677],["T_STRING","select",677],"(",")",["T_WHITESPACE","\n            ",677],["T_OBJECT_OPERATOR","->",678],["T_STRING","from",678],"(",["T_ARRAY","array",678],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",678],["T_WHITESPACE"," ",678],["T_DOUBLE_ARROW","=>",678],["T_WHITESPACE"," ",678],["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","_productWebsiteTable",678],")",",",["T_WHITESPACE"," ",678],["T_ARRAY","array",678],"(",")",")",["T_WHITESPACE","\n            ",678],["T_OBJECT_OPERATOR","->",679],["T_STRING","joinInner",679],"(",["T_ARRAY","array",679],"(",["T_CONSTANT_ENCAPSED_STRING","'g'",679],["T_WHITESPACE"," ",679],["T_DOUBLE_ARROW","=>",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$this",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","_groupTable",679],")",",",["T_WHITESPACE"," ",679],["T_CONSTANT_ENCAPSED_STRING","'g.website_id = pw.website_id'",679],",",["T_WHITESPACE"," ",679],["T_ARRAY","array",679],"(",")",")",["T_WHITESPACE","\n            ",679],["T_OBJECT_OPERATOR","->",680],["T_STRING","joinInner",680],"(",["T_ARRAY","array",680],"(",["T_CONSTANT_ENCAPSED_STRING","'s'",680],["T_WHITESPACE"," ",680],["T_DOUBLE_ARROW","=>",680],["T_WHITESPACE"," ",680],["T_VARIABLE","$this",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","_storeTable",680],")",",",["T_WHITESPACE"," ",680],["T_CONSTANT_ENCAPSED_STRING","'s.group_id = g.group_id'",680],",",["T_WHITESPACE"," ",680],["T_ARRAY","array",680],"(",")",")",["T_WHITESPACE","\n            ",680],["T_OBJECT_OPERATOR","->",681],["T_STRING","joinLeft",681],"(",["T_WHITESPACE","\n                ",681],["T_ARRAY","array",682],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",682],["T_WHITESPACE","  ",682],["T_DOUBLE_ARROW","=>",682],["T_WHITESPACE"," ",682],["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getMainTable",682],"(",")",")",",",["T_WHITESPACE","\n                ",682],["T_CONSTANT_ENCAPSED_STRING","'i.product_id = pw.product_id AND i.category_id = g.root_category_id'",683],",",["T_WHITESPACE"," ",683],["T_ARRAY","array",683],"(",")",")",["T_WHITESPACE","\n            ",683],["T_OBJECT_OPERATOR","->",684],["T_STRING","joinLeft",684],"(",["T_WHITESPACE","\n                ",684],["T_ARRAY","array",685],"(",["T_CONSTANT_ENCAPSED_STRING","'dv'",685],["T_WHITESPACE"," ",685],["T_DOUBLE_ARROW","=>",685],["T_WHITESPACE"," ",685],["T_VARIABLE","$visibilityInfo",685],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",685],"]",")",",",["T_WHITESPACE","\n                ",685],"\"",["T_ENCAPSED_AND_WHITESPACE","dv.entity_id = pw.product_id AND dv.attribute_id = ",686],["T_CURLY_OPEN","{",686],["T_VARIABLE","$visibilityInfo",686],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",686],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND dv.store_id = 0",686],"\"",",",["T_WHITESPACE","\n                ",686],["T_ARRAY","array",687],"(",")",")",["T_WHITESPACE","\n            ",687],["T_OBJECT_OPERATOR","->",688],["T_STRING","joinLeft",688],"(",["T_WHITESPACE","\n                ",688],["T_ARRAY","array",689],"(",["T_CONSTANT_ENCAPSED_STRING","'sv'",689],["T_WHITESPACE"," ",689],["T_DOUBLE_ARROW","=>",689],["T_WHITESPACE"," ",689],["T_VARIABLE","$visibilityInfo",689],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",689],"]",")",",",["T_WHITESPACE","\n                ",689],"\"",["T_ENCAPSED_AND_WHITESPACE","sv.entity_id = pw.product_id AND sv.attribute_id = ",690],["T_CURLY_OPEN","{",690],["T_VARIABLE","$visibilityInfo",690],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",690],"]","}","\"",["T_WHITESPACE","\n                    ",690],".",["T_WHITESPACE"," ",691],["T_CONSTANT_ENCAPSED_STRING","\" AND sv.store_id = s.store_id\"",691],",",["T_WHITESPACE","\n                ",691],["T_ARRAY","array",692],"(",")",")",["T_WHITESPACE","\n            ",692],["T_OBJECT_OPERATOR","->",693],["T_STRING","join",693],"(",["T_WHITESPACE","\n                ",693],["T_ARRAY","array",694],"(",["T_CONSTANT_ENCAPSED_STRING","'ds'",694],["T_WHITESPACE"," ",694],["T_DOUBLE_ARROW","=>",694],["T_WHITESPACE"," ",694],["T_VARIABLE","$statusInfo",694],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",694],"]",")",",",["T_WHITESPACE","\n                ",694],"\"",["T_ENCAPSED_AND_WHITESPACE","ds.entity_id = pw.product_id AND ds.attribute_id = ",695],["T_CURLY_OPEN","{",695],["T_VARIABLE","$statusInfo",695],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",695],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ds.store_id = 0",695],"\"",",",["T_WHITESPACE","\n                ",695],["T_ARRAY","array",696],"(",")",")",["T_WHITESPACE","\n            ",696],["T_OBJECT_OPERATOR","->",697],["T_STRING","joinLeft",697],"(",["T_WHITESPACE","\n                ",697],["T_ARRAY","array",698],"(",["T_CONSTANT_ENCAPSED_STRING","'ss'",698],["T_WHITESPACE"," ",698],["T_DOUBLE_ARROW","=>",698],["T_WHITESPACE"," ",698],["T_VARIABLE","$statusInfo",698],"[",["T_CONSTANT_ENCAPSED_STRING","'table'",698],"]",")",",",["T_WHITESPACE","\n                ",698],"\"",["T_ENCAPSED_AND_WHITESPACE","ss.entity_id = pw.product_id AND ss.attribute_id = ",699],["T_CURLY_OPEN","{",699],["T_VARIABLE","$statusInfo",699],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",699],"]","}",["T_ENCAPSED_AND_WHITESPACE"," AND ss.store_id = s.store_id",699],"\"",",",["T_WHITESPACE","\n                ",699],["T_ARRAY","array",700],"(",")",")",["T_WHITESPACE","\n            ",700],["T_OBJECT_OPERATOR","->",701],["T_STRING","where",701],"(",["T_CONSTANT_ENCAPSED_STRING","'i.product_id IS NULL'",701],")",["T_WHITESPACE","\n            ",701],["T_OBJECT_OPERATOR","->",702],["T_STRING","where",702],"(",["T_WHITESPACE","\n                ",702],["T_VARIABLE","$adapter",703],["T_OBJECT_OPERATOR","->",703],["T_STRING","getCheckSql",703],"(",["T_CONSTANT_ENCAPSED_STRING","'ss.value_id IS NOT NULL'",703],",",["T_WHITESPACE"," ",703],["T_CONSTANT_ENCAPSED_STRING","'ss.value'",703],",",["T_WHITESPACE"," ",703],["T_CONSTANT_ENCAPSED_STRING","'ds.value'",703],")",["T_WHITESPACE"," ",703],".",["T_WHITESPACE"," ",703],["T_CONSTANT_ENCAPSED_STRING","'=?'",703],",",["T_WHITESPACE","\n                ",703],["T_STRING","Mage_Catalog_Model_Product_Status",704],["T_DOUBLE_COLON","::",704],["T_STRING","STATUS_ENABLED",704],")",["T_WHITESPACE","\n            ",704],["T_OBJECT_OPERATOR","->",705],["T_STRING","where",705],"(",["T_CONSTANT_ENCAPSED_STRING","'pw.product_id IN(?)'",705],",",["T_WHITESPACE"," ",705],["T_VARIABLE","$productIds",705],")",["T_WHITESPACE","\n            ",705],["T_OBJECT_OPERATOR","->",706],["T_STRING","columns",706],"(",["T_ARRAY","array",706],"(",["T_WHITESPACE","\n                ",706],["T_CONSTANT_ENCAPSED_STRING","'category_id'",707],["T_WHITESPACE","   ",707],["T_DOUBLE_ARROW","=>",707],["T_WHITESPACE"," ",707],["T_CONSTANT_ENCAPSED_STRING","'g.root_category_id'",707],",",["T_WHITESPACE","\n                ",707],["T_CONSTANT_ENCAPSED_STRING","'product_id'",708],["T_WHITESPACE","    ",708],["T_DOUBLE_ARROW","=>",708],["T_WHITESPACE"," ",708],["T_CONSTANT_ENCAPSED_STRING","'pw.product_id'",708],",",["T_WHITESPACE","\n                ",708],["T_CONSTANT_ENCAPSED_STRING","'position'",709],["T_WHITESPACE","      ",709],["T_DOUBLE_ARROW","=>",709],["T_WHITESPACE"," ",709],["T_VARIABLE","$position",709],",",["T_WHITESPACE","\n                ",709],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",710],["T_WHITESPACE","     ",710],["T_DOUBLE_ARROW","=>",710],["T_WHITESPACE"," ",710],["T_NEW","new",710],["T_WHITESPACE"," ",710],["T_STRING","Zend_Db_Expr",710],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",710],")",",",["T_WHITESPACE","\n                ",710],["T_CONSTANT_ENCAPSED_STRING","'store_id'",711],["T_WHITESPACE","      ",711],["T_DOUBLE_ARROW","=>",711],["T_WHITESPACE"," ",711],["T_CONSTANT_ENCAPSED_STRING","'s.store_id'",711],",",["T_WHITESPACE","\n                ",711],["T_CONSTANT_ENCAPSED_STRING","'visibility'",712],["T_WHITESPACE","    ",712],["T_DOUBLE_ARROW","=>",712],["T_WHITESPACE"," ",712],["T_VARIABLE","$adapter",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","getCheckSql",712],"(",["T_CONSTANT_ENCAPSED_STRING","'sv.value_id IS NOT NULL'",712],",",["T_WHITESPACE"," ",712],["T_CONSTANT_ENCAPSED_STRING","'sv.value'",712],",",["T_WHITESPACE"," ",712],["T_CONSTANT_ENCAPSED_STRING","'dv.value'",712],")",",",["T_WHITESPACE","\n            ",712],")",")",";",["T_WHITESPACE","\n\n        ",713],["T_VARIABLE","$sql",715],["T_WHITESPACE"," ",715],"=",["T_WHITESPACE"," ",715],["T_VARIABLE","$select",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","insertFromSelect",715],"(",["T_VARIABLE","$this",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","getMainTable",715],"(",")",")",";",["T_WHITESPACE","\n        ",715],["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","_getWriteAdapter",716],"(",")",["T_OBJECT_OPERATOR","->",716],["T_STRING","query",716],"(",["T_VARIABLE","$sql",716],")",";",["T_WHITESPACE","\n\n        ",716],["T_RETURN","return",718],["T_WHITESPACE"," ",718],["T_VARIABLE","$this",718],";",["T_WHITESPACE","\n    ",718],"}",["T_WHITESPACE","\n\n    ",719],["T_DOC_COMMENT","\/**\n     * Get is_anchor category attribute information\n     *\n     * @return array array('id' => $id, 'table'=>$table)\n     *\/",721],["T_WHITESPACE","\n    ",725],["T_PROTECTED","protected",726],["T_WHITESPACE"," ",726],["T_FUNCTION","function",726],["T_WHITESPACE"," ",726],["T_STRING","_getAnchorAttributeInfo",726],"(",")",["T_WHITESPACE","\n    ",726],"{",["T_WHITESPACE","\n        ",727],["T_VARIABLE","$isAnchorAttribute",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_STRING","Mage",728],["T_DOUBLE_COLON","::",728],["T_STRING","getSingleton",728],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",728],")",["T_WHITESPACE","\n            ",728],["T_OBJECT_OPERATOR","->",729],["T_STRING","getAttribute",729],"(",["T_STRING","Mage_Catalog_Model_Category",729],["T_DOUBLE_COLON","::",729],["T_STRING","ENTITY",729],",",["T_WHITESPACE"," ",729],["T_CONSTANT_ENCAPSED_STRING","'is_anchor'",729],")",";",["T_WHITESPACE","\n        ",729],["T_VARIABLE","$info",730],["T_WHITESPACE"," ",730],"=",["T_WHITESPACE"," ",730],["T_ARRAY","array",730],"(",["T_WHITESPACE","\n            ",730],["T_CONSTANT_ENCAPSED_STRING","'id'",731],["T_WHITESPACE","    ",731],["T_DOUBLE_ARROW","=>",731],["T_WHITESPACE"," ",731],["T_VARIABLE","$isAnchorAttribute",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getId",731],"(",")",["T_WHITESPACE"," ",731],",",["T_WHITESPACE","\n            ",731],["T_CONSTANT_ENCAPSED_STRING","'table'",732],["T_WHITESPACE"," ",732],["T_DOUBLE_ARROW","=>",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$isAnchorAttribute",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","getBackend",732],"(",")",["T_OBJECT_OPERATOR","->",732],["T_STRING","getTable",732],"(",")",["T_WHITESPACE","\n        ",732],")",";",["T_WHITESPACE","\n        ",733],["T_RETURN","return",734],["T_WHITESPACE"," ",734],["T_VARIABLE","$info",734],";",["T_WHITESPACE","\n    ",734],"}",["T_WHITESPACE","\n\n    ",735],["T_DOC_COMMENT","\/**\n     * Get visibility product attribute information\n     *\n     * @return array array('id' => $id, 'table'=>$table)\n     *\/",737],["T_WHITESPACE","\n    ",741],["T_PROTECTED","protected",742],["T_WHITESPACE"," ",742],["T_FUNCTION","function",742],["T_WHITESPACE"," ",742],["T_STRING","_getVisibilityAttributeInfo",742],"(",")",["T_WHITESPACE","\n    ",742],"{",["T_WHITESPACE","\n        ",743],["T_VARIABLE","$visibilityAttribute",744],["T_WHITESPACE"," ",744],"=",["T_WHITESPACE"," ",744],["T_STRING","Mage",744],["T_DOUBLE_COLON","::",744],["T_STRING","getSingleton",744],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",744],")",["T_WHITESPACE","\n            ",744],["T_OBJECT_OPERATOR","->",745],["T_STRING","getAttribute",745],"(",["T_STRING","Mage_Catalog_Model_Product",745],["T_DOUBLE_COLON","::",745],["T_STRING","ENTITY",745],",",["T_WHITESPACE"," ",745],["T_CONSTANT_ENCAPSED_STRING","'visibility'",745],")",";",["T_WHITESPACE","\n        ",745],["T_VARIABLE","$info",746],["T_WHITESPACE"," ",746],"=",["T_WHITESPACE"," ",746],["T_ARRAY","array",746],"(",["T_WHITESPACE","\n            ",746],["T_CONSTANT_ENCAPSED_STRING","'id'",747],["T_WHITESPACE","    ",747],["T_DOUBLE_ARROW","=>",747],["T_WHITESPACE"," ",747],["T_VARIABLE","$visibilityAttribute",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","getId",747],"(",")",["T_WHITESPACE"," ",747],",",["T_WHITESPACE","\n            ",747],["T_CONSTANT_ENCAPSED_STRING","'table'",748],["T_WHITESPACE"," ",748],["T_DOUBLE_ARROW","=>",748],["T_WHITESPACE"," ",748],["T_VARIABLE","$visibilityAttribute",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","getBackend",748],"(",")",["T_OBJECT_OPERATOR","->",748],["T_STRING","getTable",748],"(",")",["T_WHITESPACE","\n        ",748],")",";",["T_WHITESPACE","\n        ",749],["T_RETURN","return",750],["T_WHITESPACE"," ",750],["T_VARIABLE","$info",750],";",["T_WHITESPACE","\n    ",750],"}",["T_WHITESPACE","\n\n    ",751],["T_DOC_COMMENT","\/**\n     * Get status product attribute information\n     *\n     * @return array array('id' => $id, 'table'=>$table)\n     *\/",753],["T_WHITESPACE","\n    ",757],["T_PROTECTED","protected",758],["T_WHITESPACE"," ",758],["T_FUNCTION","function",758],["T_WHITESPACE"," ",758],["T_STRING","_getStatusAttributeInfo",758],"(",")",["T_WHITESPACE","\n    ",758],"{",["T_WHITESPACE","\n        ",759],["T_VARIABLE","$statusAttribute",760],["T_WHITESPACE"," ",760],"=",["T_WHITESPACE"," ",760],["T_STRING","Mage",760],["T_DOUBLE_COLON","::",760],["T_STRING","getSingleton",760],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",760],")",["T_OBJECT_OPERATOR","->",760],["T_STRING","getAttribute",760],"(",["T_STRING","Mage_Catalog_Model_Product",760],["T_DOUBLE_COLON","::",760],["T_STRING","ENTITY",760],",",["T_WHITESPACE"," ",760],["T_CONSTANT_ENCAPSED_STRING","'status'",760],")",";",["T_WHITESPACE","\n        ",760],["T_VARIABLE","$info",761],["T_WHITESPACE"," ",761],"=",["T_WHITESPACE"," ",761],["T_ARRAY","array",761],"(",["T_WHITESPACE","\n            ",761],["T_CONSTANT_ENCAPSED_STRING","'id'",762],["T_WHITESPACE","    ",762],["T_DOUBLE_ARROW","=>",762],["T_WHITESPACE"," ",762],["T_VARIABLE","$statusAttribute",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","getId",762],"(",")",["T_WHITESPACE"," ",762],",",["T_WHITESPACE","\n            ",762],["T_CONSTANT_ENCAPSED_STRING","'table'",763],["T_WHITESPACE"," ",763],["T_DOUBLE_ARROW","=>",763],["T_WHITESPACE"," ",763],["T_VARIABLE","$statusAttribute",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","getBackend",763],"(",")",["T_OBJECT_OPERATOR","->",763],["T_STRING","getTable",763],"(",")",["T_WHITESPACE","\n        ",763],")",";",["T_WHITESPACE","\n        ",764],["T_RETURN","return",765],["T_WHITESPACE"," ",765],["T_VARIABLE","$info",765],";",["T_WHITESPACE","\n    ",765],"}",["T_WHITESPACE","\n\n    ",766],["T_DOC_COMMENT","\/**\n     * Rebuild all index data\n     *\n     * @return Mage_Catalog_Model_Resource_Category_Indexer_Product\n     *\/",768],["T_WHITESPACE","\n    ",772],["T_PUBLIC","public",773],["T_WHITESPACE"," ",773],["T_FUNCTION","function",773],["T_WHITESPACE"," ",773],["T_STRING","reindexAll",773],"(",")",["T_WHITESPACE","\n    ",773],"{",["T_WHITESPACE","\n        ",774],["T_VARIABLE","$this",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","useIdxTable",775],"(",["T_STRING","true",775],")",";",["T_WHITESPACE","\n        ",775],["T_VARIABLE","$this",776],["T_OBJECT_OPERATOR","->",776],["T_STRING","beginTransaction",776],"(",")",";",["T_WHITESPACE","\n        ",776],["T_TRY","try",777],["T_WHITESPACE"," ",777],"{",["T_WHITESPACE","\n            ",777],["T_VARIABLE","$this",778],["T_OBJECT_OPERATOR","->",778],["T_STRING","clearTemporaryIndexTable",778],"(",")",";",["T_WHITESPACE","\n            ",778],["T_VARIABLE","$idxTable",779],["T_WHITESPACE"," ",779],"=",["T_WHITESPACE"," ",779],["T_VARIABLE","$this",779],["T_OBJECT_OPERATOR","->",779],["T_STRING","getIdxTable",779],"(",")",";",["T_WHITESPACE","\n            ",779],["T_VARIABLE","$idxAdapter",780],["T_WHITESPACE"," ",780],"=",["T_WHITESPACE"," ",780],["T_VARIABLE","$this",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","_getIndexAdapter",780],"(",")",";",["T_WHITESPACE","\n            ",780],["T_VARIABLE","$stores",781],["T_WHITESPACE"," ",781],"=",["T_WHITESPACE"," ",781],["T_VARIABLE","$this",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","_getStoresInfo",781],"(",")",";",["T_WHITESPACE","\n            ",781],["T_DOC_COMMENT","\/**\n             * Build index for each store\n             *\/",782],["T_WHITESPACE","\n            ",784],["T_FOREACH","foreach",785],["T_WHITESPACE"," ",785],"(",["T_VARIABLE","$stores",785],["T_WHITESPACE"," ",785],["T_AS","as",785],["T_WHITESPACE"," ",785],["T_VARIABLE","$storeData",785],")",["T_WHITESPACE"," ",785],"{",["T_WHITESPACE","\n                ",785],["T_VARIABLE","$storeId",786],["T_WHITESPACE","    ",786],"=",["T_WHITESPACE"," ",786],["T_VARIABLE","$storeData",786],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",786],"]",";",["T_WHITESPACE","\n                ",786],["T_VARIABLE","$websiteId",787],["T_WHITESPACE","  ",787],"=",["T_WHITESPACE"," ",787],["T_VARIABLE","$storeData",787],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",787],"]",";",["T_WHITESPACE","\n                ",787],["T_VARIABLE","$rootPath",788],["T_WHITESPACE","   ",788],"=",["T_WHITESPACE"," ",788],["T_VARIABLE","$storeData",788],"[",["T_CONSTANT_ENCAPSED_STRING","'root_path'",788],"]",";",["T_WHITESPACE","\n                ",788],["T_VARIABLE","$rootId",789],["T_WHITESPACE","     ",789],"=",["T_WHITESPACE"," ",789],["T_VARIABLE","$storeData",789],"[",["T_CONSTANT_ENCAPSED_STRING","'root_id'",789],"]",";",["T_WHITESPACE","\n                ",789],["T_DOC_COMMENT","\/**\n                 * Prepare visibility for all enabled store products\n                 *\/",790],["T_WHITESPACE","\n                ",792],["T_VARIABLE","$enabledTable",793],["T_WHITESPACE"," ",793],"=",["T_WHITESPACE"," ",793],["T_VARIABLE","$this",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","_prepareEnabledProductsVisibility",793],"(",["T_VARIABLE","$websiteId",793],",",["T_WHITESPACE"," ",793],["T_VARIABLE","$storeId",793],")",";",["T_WHITESPACE","\n                ",793],["T_DOC_COMMENT","\/**\n                 * Select information about anchor categories\n                 *\/",794],["T_WHITESPACE","\n                ",796],["T_VARIABLE","$anchorTable",797],["T_WHITESPACE"," ",797],"=",["T_WHITESPACE"," ",797],["T_VARIABLE","$this",797],["T_OBJECT_OPERATOR","->",797],["T_STRING","_prepareAnchorCategories",797],"(",["T_VARIABLE","$storeId",797],",",["T_WHITESPACE"," ",797],["T_VARIABLE","$rootPath",797],")",";",["T_WHITESPACE","\n                ",797],["T_DOC_COMMENT","\/**\n                 * Add relations between not anchor categories and products\n                 *\/",798],["T_WHITESPACE","\n                ",800],["T_VARIABLE","$select",801],["T_WHITESPACE"," ",801],"=",["T_WHITESPACE"," ",801],["T_VARIABLE","$idxAdapter",801],["T_OBJECT_OPERATOR","->",801],["T_STRING","select",801],"(",")",";",["T_WHITESPACE","\n                ",801],["T_DOC_COMMENT","\/** @var $select Varien_Db_Select *\/",802],["T_WHITESPACE","\n                ",802],["T_VARIABLE","$select",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","from",803],"(",["T_WHITESPACE","\n                    ",803],["T_ARRAY","array",804],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",804],["T_WHITESPACE"," ",804],["T_DOUBLE_ARROW","=>",804],["T_WHITESPACE"," ",804],["T_VARIABLE","$this",804],["T_OBJECT_OPERATOR","->",804],["T_STRING","_categoryProductTable",804],")",",",["T_WHITESPACE","\n                    ",804],["T_ARRAY","array",805],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",805],",",["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","'product_id'",805],",",["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","'position'",805],",",["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",805],["T_WHITESPACE"," ",805],["T_DOUBLE_ARROW","=>",805],["T_WHITESPACE"," ",805],["T_NEW","new",805],["T_WHITESPACE"," ",805],["T_STRING","Zend_Db_Expr",805],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",805],")",",",["T_WHITESPACE","\n                        ",805],["T_CONSTANT_ENCAPSED_STRING","'store_id'",806],["T_WHITESPACE"," ",806],["T_DOUBLE_ARROW","=>",806],["T_WHITESPACE"," ",806],["T_NEW","new",806],["T_WHITESPACE"," ",806],["T_STRING","Zend_Db_Expr",806],"(",["T_VARIABLE","$storeId",806],")",")",["T_WHITESPACE","\n                ",806],")",["T_WHITESPACE","\n                ",807],["T_OBJECT_OPERATOR","->",808],["T_STRING","joinInner",808],"(",["T_ARRAY","array",808],"(",["T_CONSTANT_ENCAPSED_STRING","'pv'",808],["T_WHITESPACE"," ",808],["T_DOUBLE_ARROW","=>",808],["T_WHITESPACE"," ",808],["T_VARIABLE","$enabledTable",808],")",",",["T_WHITESPACE"," ",808],["T_CONSTANT_ENCAPSED_STRING","'pv.product_id=cp.product_id'",808],",",["T_WHITESPACE"," ",808],["T_ARRAY","array",808],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",808],")",")",["T_WHITESPACE","\n                ",808],["T_OBJECT_OPERATOR","->",809],["T_STRING","joinLeft",809],"(",["T_ARRAY","array",809],"(",["T_CONSTANT_ENCAPSED_STRING","'ac'",809],["T_WHITESPACE"," ",809],["T_DOUBLE_ARROW","=>",809],["T_WHITESPACE"," ",809],["T_VARIABLE","$anchorTable",809],")",",",["T_WHITESPACE"," ",809],["T_CONSTANT_ENCAPSED_STRING","'ac.category_id=cp.category_id'",809],",",["T_WHITESPACE"," ",809],["T_ARRAY","array",809],"(",")",")",["T_WHITESPACE","\n                ",809],["T_OBJECT_OPERATOR","->",810],["T_STRING","where",810],"(",["T_CONSTANT_ENCAPSED_STRING","'ac.category_id IS NULL'",810],")",";",["T_WHITESPACE","\n\n                ",810],["T_VARIABLE","$query",812],["T_WHITESPACE"," ",812],"=",["T_WHITESPACE"," ",812],["T_VARIABLE","$select",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","insertFromSelect",812],"(",["T_WHITESPACE","\n                    ",812],["T_VARIABLE","$idxTable",813],",",["T_WHITESPACE","\n                    ",813],["T_ARRAY","array",814],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",814],",",["T_WHITESPACE"," ",814],["T_CONSTANT_ENCAPSED_STRING","'product_id'",814],",",["T_WHITESPACE"," ",814],["T_CONSTANT_ENCAPSED_STRING","'position'",814],",",["T_WHITESPACE"," ",814],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",814],",",["T_WHITESPACE"," ",814],["T_CONSTANT_ENCAPSED_STRING","'store_id'",814],",",["T_WHITESPACE"," ",814],["T_CONSTANT_ENCAPSED_STRING","'visibility'",814],")",",",["T_WHITESPACE","\n                    ",814],["T_STRING","false",815],["T_WHITESPACE","\n                ",815],")",";",["T_WHITESPACE","\n                ",816],["T_VARIABLE","$idxAdapter",817],["T_OBJECT_OPERATOR","->",817],["T_STRING","query",817],"(",["T_VARIABLE","$query",817],")",";",["T_WHITESPACE","\n\n                ",817],["T_DOC_COMMENT","\/**\n                 * Assign products not associated to any category to root category in index\n                 *\/",819],["T_WHITESPACE","\n\n                ",821],["T_VARIABLE","$select",823],["T_WHITESPACE"," ",823],"=",["T_WHITESPACE"," ",823],["T_VARIABLE","$idxAdapter",823],["T_OBJECT_OPERATOR","->",823],["T_STRING","select",823],"(",")",";",["T_WHITESPACE","\n                ",823],["T_VARIABLE","$select",824],["T_OBJECT_OPERATOR","->",824],["T_STRING","from",824],"(",["T_WHITESPACE","\n                    ",824],["T_ARRAY","array",825],"(",["T_CONSTANT_ENCAPSED_STRING","'pv'",825],["T_WHITESPACE"," ",825],["T_DOUBLE_ARROW","=>",825],["T_WHITESPACE"," ",825],["T_VARIABLE","$enabledTable",825],")",",",["T_WHITESPACE","\n                    ",825],["T_ARRAY","array",826],"(",["T_NEW","new",826],["T_WHITESPACE"," ",826],["T_STRING","Zend_Db_Expr",826],"(",["T_VARIABLE","$rootId",826],")",",",["T_WHITESPACE"," ",826],["T_CONSTANT_ENCAPSED_STRING","'product_id'",826],",",["T_WHITESPACE"," ",826],["T_NEW","new",826],["T_WHITESPACE"," ",826],["T_STRING","Zend_Db_Expr",826],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",826],")",",",["T_WHITESPACE"," ",826],["T_NEW","new",826],["T_WHITESPACE"," ",826],["T_STRING","Zend_Db_Expr",826],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",826],")",",",["T_WHITESPACE","\n                        ",826],["T_NEW","new",827],["T_WHITESPACE"," ",827],["T_STRING","Zend_Db_Expr",827],"(",["T_VARIABLE","$storeId",827],")",",",["T_WHITESPACE"," ",827],["T_CONSTANT_ENCAPSED_STRING","'visibility'",827],")",["T_WHITESPACE","\n                ",827],")",["T_WHITESPACE","\n                ",828],["T_OBJECT_OPERATOR","->",829],["T_STRING","joinLeft",829],"(",["T_ARRAY","array",829],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",829],["T_WHITESPACE"," ",829],["T_DOUBLE_ARROW","=>",829],["T_WHITESPACE"," ",829],["T_VARIABLE","$this",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","_categoryProductTable",829],")",",",["T_WHITESPACE"," ",829],["T_CONSTANT_ENCAPSED_STRING","'pv.product_id=cp.product_id'",829],",",["T_WHITESPACE"," ",829],["T_ARRAY","array",829],"(",")",")",["T_WHITESPACE","\n                ",829],["T_OBJECT_OPERATOR","->",830],["T_STRING","where",830],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.product_id IS NULL'",830],")",";",["T_WHITESPACE","\n\n                ",830],["T_VARIABLE","$query",832],["T_WHITESPACE"," ",832],"=",["T_WHITESPACE"," ",832],["T_VARIABLE","$select",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","insertFromSelect",832],"(",["T_WHITESPACE","\n                    ",832],["T_VARIABLE","$idxTable",833],",",["T_WHITESPACE","\n                    ",833],["T_ARRAY","array",834],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",834],",",["T_WHITESPACE"," ",834],["T_CONSTANT_ENCAPSED_STRING","'product_id'",834],",",["T_WHITESPACE"," ",834],["T_CONSTANT_ENCAPSED_STRING","'position'",834],",",["T_WHITESPACE"," ",834],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",834],",",["T_WHITESPACE"," ",834],["T_CONSTANT_ENCAPSED_STRING","'store_id'",834],",",["T_WHITESPACE"," ",834],["T_CONSTANT_ENCAPSED_STRING","'visibility'",834],")",",",["T_WHITESPACE","\n                    ",834],["T_STRING","false",835],["T_WHITESPACE","\n                ",835],")",";",["T_WHITESPACE","\n                ",836],["T_VARIABLE","$idxAdapter",837],["T_OBJECT_OPERATOR","->",837],["T_STRING","query",837],"(",["T_VARIABLE","$query",837],")",";",["T_WHITESPACE","\n\n                ",837],["T_DOC_COMMENT","\/**\n                 * Prepare anchor categories products\n                 *\/",839],["T_WHITESPACE","\n                ",841],["T_VARIABLE","$anchorProductsTable",842],["T_WHITESPACE"," ",842],"=",["T_WHITESPACE"," ",842],["T_VARIABLE","$this",842],["T_OBJECT_OPERATOR","->",842],["T_STRING","_getAnchorCategoriesProductsTemporaryTable",842],"(",")",";",["T_WHITESPACE","\n                ",842],["T_VARIABLE","$idxAdapter",843],["T_OBJECT_OPERATOR","->",843],["T_STRING","delete",843],"(",["T_VARIABLE","$anchorProductsTable",843],")",";",["T_WHITESPACE","\n\n                ",843],["T_VARIABLE","$position",845],["T_WHITESPACE"," ",845],"=",["T_WHITESPACE"," ",845],["T_CONSTANT_ENCAPSED_STRING","'MIN('",845],".",["T_WHITESPACE","\n                    ",845],["T_VARIABLE","$idxAdapter",846],["T_OBJECT_OPERATOR","->",846],["T_STRING","getCheckSql",846],"(",["T_WHITESPACE","\n                        ",846],["T_CONSTANT_ENCAPSED_STRING","'ca.category_id = ce.entity_id'",847],",",["T_WHITESPACE","\n                        ",847],["T_VARIABLE","$idxAdapter",848],["T_OBJECT_OPERATOR","->",848],["T_STRING","quoteIdentifier",848],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.position'",848],")",",",["T_WHITESPACE","\n                        ",848],["T_CONSTANT_ENCAPSED_STRING","'('",849],".",["T_VARIABLE","$idxAdapter",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","quoteIdentifier",849],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.position'",849],")",".",["T_CONSTANT_ENCAPSED_STRING","' + 1) * '",849],["T_WHITESPACE","\n                        ",849],".",["T_CONSTANT_ENCAPSED_STRING","'('",850],".",["T_VARIABLE","$idxAdapter",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","quoteIdentifier",850],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.level'",850],")",".",["T_CONSTANT_ENCAPSED_STRING","' + 1 * 10000)'",850],["T_WHITESPACE","\n                        ",850],".",["T_CONSTANT_ENCAPSED_STRING","' + '",851],".",["T_VARIABLE","$idxAdapter",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","quoteIdentifier",851],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.position'",851],")",["T_WHITESPACE","\n                    ",851],")",["T_WHITESPACE","\n                ",852],".",["T_CONSTANT_ENCAPSED_STRING","')'",853],";",["T_WHITESPACE","\n\n\n                ",853],["T_VARIABLE","$select",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_VARIABLE","$idxAdapter",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","select",856],"(",")",["T_WHITESPACE","\n                ",856],["T_OBJECT_OPERATOR","->",857],["T_STRING","useStraightJoin",857],"(",["T_STRING","true",857],")",["T_WHITESPACE","\n                ",857],["T_OBJECT_OPERATOR","->",858],["T_STRING","distinct",858],"(",["T_STRING","true",858],")",["T_WHITESPACE","\n                ",858],["T_OBJECT_OPERATOR","->",859],["T_STRING","from",859],"(",["T_ARRAY","array",859],"(",["T_CONSTANT_ENCAPSED_STRING","'ca'",859],["T_WHITESPACE"," ",859],["T_DOUBLE_ARROW","=>",859],["T_WHITESPACE"," ",859],["T_VARIABLE","$anchorTable",859],")",",",["T_WHITESPACE"," ",859],["T_ARRAY","array",859],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",859],")",")",["T_WHITESPACE","\n                ",859],["T_OBJECT_OPERATOR","->",860],["T_STRING","joinInner",860],"(",["T_WHITESPACE","\n                    ",860],["T_ARRAY","array",861],"(",["T_CONSTANT_ENCAPSED_STRING","'ce'",861],["T_WHITESPACE"," ",861],["T_DOUBLE_ARROW","=>",861],["T_WHITESPACE"," ",861],["T_VARIABLE","$this",861],["T_OBJECT_OPERATOR","->",861],["T_STRING","_categoryTable",861],")",",",["T_WHITESPACE","\n                    ",861],["T_VARIABLE","$idxAdapter",862],["T_OBJECT_OPERATOR","->",862],["T_STRING","quoteIdentifier",862],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.path'",862],")",["T_WHITESPACE"," ",862],".",["T_WHITESPACE"," ",862],["T_CONSTANT_ENCAPSED_STRING","' LIKE '",862],["T_WHITESPACE"," ",862],".",["T_WHITESPACE","\n                    ",862],["T_VARIABLE","$idxAdapter",863],["T_OBJECT_OPERATOR","->",863],["T_STRING","quoteIdentifier",863],"(",["T_CONSTANT_ENCAPSED_STRING","'ca.path'",863],")",["T_WHITESPACE"," ",863],".",["T_WHITESPACE"," ",863],["T_CONSTANT_ENCAPSED_STRING","' OR ce.entity_id = ca.category_id'",863],",",["T_WHITESPACE","\n                    ",863],["T_ARRAY","array",864],"(",")",["T_WHITESPACE","\n                ",864],")",["T_WHITESPACE","\n                ",865],["T_OBJECT_OPERATOR","->",866],["T_STRING","joinInner",866],"(",["T_WHITESPACE","\n                    ",866],["T_ARRAY","array",867],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",867],["T_WHITESPACE"," ",867],["T_DOUBLE_ARROW","=>",867],["T_WHITESPACE"," ",867],["T_VARIABLE","$this",867],["T_OBJECT_OPERATOR","->",867],["T_STRING","_categoryProductTable",867],")",",",["T_WHITESPACE","\n                    ",867],["T_CONSTANT_ENCAPSED_STRING","'cp.category_id = ce.entity_id'",868],",",["T_WHITESPACE","\n                    ",868],["T_ARRAY","array",869],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",869],")",["T_WHITESPACE","\n                ",869],")",["T_WHITESPACE","\n                ",870],["T_OBJECT_OPERATOR","->",871],["T_STRING","joinInner",871],"(",["T_WHITESPACE","\n                    ",871],["T_ARRAY","array",872],"(",["T_CONSTANT_ENCAPSED_STRING","'pv'",872],["T_WHITESPACE"," ",872],["T_DOUBLE_ARROW","=>",872],["T_WHITESPACE"," ",872],["T_VARIABLE","$enabledTable",872],")",",",["T_WHITESPACE","\n                    ",872],["T_CONSTANT_ENCAPSED_STRING","'pv.product_id = cp.product_id'",873],",",["T_WHITESPACE","\n                    ",873],["T_ARRAY","array",874],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",874],["T_WHITESPACE"," ",874],["T_DOUBLE_ARROW","=>",874],["T_WHITESPACE"," ",874],["T_VARIABLE","$position",874],")",["T_WHITESPACE","\n                ",874],")",["T_WHITESPACE","\n                ",875],["T_OBJECT_OPERATOR","->",876],["T_STRING","group",876],"(",["T_ARRAY","array",876],"(",["T_CONSTANT_ENCAPSED_STRING","'ca.category_id'",876],",",["T_WHITESPACE"," ",876],["T_CONSTANT_ENCAPSED_STRING","'cp.product_id'",876],")",")",";",["T_WHITESPACE","\n                ",876],["T_VARIABLE","$query",877],["T_WHITESPACE"," ",877],"=",["T_WHITESPACE"," ",877],["T_VARIABLE","$select",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","insertFromSelect",877],"(",["T_VARIABLE","$anchorProductsTable",877],",",["T_WHITESPACE","\n                    ",877],["T_ARRAY","array",878],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",878],",",["T_WHITESPACE"," ",878],["T_CONSTANT_ENCAPSED_STRING","'product_id'",878],",",["T_WHITESPACE"," ",878],["T_CONSTANT_ENCAPSED_STRING","'position'",878],")",",",["T_WHITESPACE"," ",878],["T_STRING","false",878],")",";",["T_WHITESPACE","\n                ",878],["T_VARIABLE","$idxAdapter",879],["T_OBJECT_OPERATOR","->",879],["T_STRING","query",879],"(",["T_VARIABLE","$query",879],")",";",["T_WHITESPACE","\n\n                ",879],["T_DOC_COMMENT","\/**\n                 * Add anchor categories products to index\n                 *\/",881],["T_WHITESPACE","\n                ",883],["T_VARIABLE","$select",884],["T_WHITESPACE"," ",884],"=",["T_WHITESPACE"," ",884],["T_VARIABLE","$idxAdapter",884],["T_OBJECT_OPERATOR","->",884],["T_STRING","select",884],"(",")",["T_WHITESPACE","\n                ",884],["T_OBJECT_OPERATOR","->",885],["T_STRING","from",885],"(",["T_WHITESPACE","\n                    ",885],["T_ARRAY","array",886],"(",["T_CONSTANT_ENCAPSED_STRING","'ap'",886],["T_WHITESPACE"," ",886],["T_DOUBLE_ARROW","=>",886],["T_WHITESPACE"," ",886],["T_VARIABLE","$anchorProductsTable",886],")",",",["T_WHITESPACE","\n                    ",886],["T_ARRAY","array",887],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",887],",",["T_WHITESPACE"," ",887],["T_CONSTANT_ENCAPSED_STRING","'product_id'",887],",",["T_WHITESPACE","\n                        ",887],["T_CONSTANT_ENCAPSED_STRING","'position'",888],",",["T_WHITESPACE"," ",888],["T_COMMENT","\/\/ => new Zend_Db_Expr('MIN('. $idxAdapter->quoteIdentifier('ap.position').')'),\n",888],["T_WHITESPACE","                        ",889],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",889],["T_WHITESPACE"," ",889],["T_DOUBLE_ARROW","=>",889],["T_WHITESPACE"," ",889],["T_VARIABLE","$idxAdapter",889],["T_OBJECT_OPERATOR","->",889],["T_STRING","getCheckSql",889],"(",["T_CONSTANT_ENCAPSED_STRING","'cp.product_id > 0'",889],",",["T_WHITESPACE"," ",889],["T_LNUMBER","1",889],",",["T_WHITESPACE"," ",889],["T_LNUMBER","0",889],")",",",["T_WHITESPACE","\n                        ",889],["T_CONSTANT_ENCAPSED_STRING","'store_id'",890],["T_WHITESPACE"," ",890],["T_DOUBLE_ARROW","=>",890],["T_WHITESPACE"," ",890],["T_NEW","new",890],["T_WHITESPACE"," ",890],["T_STRING","Zend_Db_Expr",890],"(",["T_VARIABLE","$storeId",890],")",")",["T_WHITESPACE","\n                ",890],")",["T_WHITESPACE","\n                ",891],["T_OBJECT_OPERATOR","->",892],["T_STRING","joinLeft",892],"(",["T_WHITESPACE","\n                    ",892],["T_ARRAY","array",893],"(",["T_CONSTANT_ENCAPSED_STRING","'cp'",893],["T_WHITESPACE"," ",893],["T_DOUBLE_ARROW","=>",893],["T_WHITESPACE"," ",893],["T_VARIABLE","$this",893],["T_OBJECT_OPERATOR","->",893],["T_STRING","_categoryProductTable",893],")",",",["T_WHITESPACE","\n                    ",893],["T_CONSTANT_ENCAPSED_STRING","'cp.category_id=ap.category_id AND cp.product_id=ap.product_id'",894],",",["T_WHITESPACE","\n                    ",894],["T_ARRAY","array",895],"(",")",["T_WHITESPACE","\n                ",895],")",["T_WHITESPACE","\n                ",896],["T_OBJECT_OPERATOR","->",897],["T_STRING","joinInner",897],"(",["T_ARRAY","array",897],"(",["T_CONSTANT_ENCAPSED_STRING","'pv'",897],["T_WHITESPACE"," ",897],["T_DOUBLE_ARROW","=>",897],["T_WHITESPACE"," ",897],["T_VARIABLE","$enabledTable",897],")",",",["T_WHITESPACE"," ",897],["T_CONSTANT_ENCAPSED_STRING","'pv.product_id = ap.product_id'",897],",",["T_WHITESPACE"," ",897],["T_ARRAY","array",897],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",897],")",")",";",["T_WHITESPACE","\n\n                ",897],["T_VARIABLE","$query",899],["T_WHITESPACE"," ",899],"=",["T_WHITESPACE"," ",899],["T_VARIABLE","$select",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","insertFromSelect",899],"(",["T_WHITESPACE","\n                    ",899],["T_VARIABLE","$idxTable",900],",",["T_WHITESPACE","\n                    ",900],["T_ARRAY","array",901],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",901],",",["T_WHITESPACE"," ",901],["T_CONSTANT_ENCAPSED_STRING","'product_id'",901],",",["T_WHITESPACE"," ",901],["T_CONSTANT_ENCAPSED_STRING","'position'",901],",",["T_WHITESPACE"," ",901],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",901],",",["T_WHITESPACE"," ",901],["T_CONSTANT_ENCAPSED_STRING","'store_id'",901],",",["T_WHITESPACE"," ",901],["T_CONSTANT_ENCAPSED_STRING","'visibility'",901],")",",",["T_WHITESPACE","\n                    ",901],["T_STRING","false",902],["T_WHITESPACE","\n                ",902],")",";",["T_WHITESPACE","\n                ",903],["T_VARIABLE","$idxAdapter",904],["T_OBJECT_OPERATOR","->",904],["T_STRING","query",904],"(",["T_VARIABLE","$query",904],")",";",["T_WHITESPACE","\n\n                ",904],["T_VARIABLE","$select",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],["T_VARIABLE","$idxAdapter",906],["T_OBJECT_OPERATOR","->",906],["T_STRING","select",906],"(",")",["T_WHITESPACE","\n                    ",906],["T_OBJECT_OPERATOR","->",907],["T_STRING","from",907],"(",["T_ARRAY","array",907],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",907],["T_WHITESPACE"," ",907],["T_DOUBLE_ARROW","=>",907],["T_WHITESPACE"," ",907],["T_VARIABLE","$this",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","getTable",907],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",907],")",")",",",["T_WHITESPACE"," ",907],["T_STRING","null",907],")",["T_WHITESPACE","\n                    ",907],["T_OBJECT_OPERATOR","->",908],["T_STRING","join",908],"(",["T_WHITESPACE","\n                        ",908],["T_ARRAY","array",909],"(",["T_CONSTANT_ENCAPSED_STRING","'ei'",909],["T_WHITESPACE"," ",909],["T_DOUBLE_ARROW","=>",909],["T_WHITESPACE"," ",909],["T_VARIABLE","$enabledTable",909],")",",",["T_WHITESPACE","\n                        ",909],["T_CONSTANT_ENCAPSED_STRING","'ei.product_id = e.entity_id'",910],",",["T_WHITESPACE","\n                        ",910],["T_ARRAY","array",911],"(",")",")",["T_WHITESPACE","\n                    ",911],["T_OBJECT_OPERATOR","->",912],["T_STRING","joinLeft",912],"(",["T_WHITESPACE","\n                        ",912],["T_ARRAY","array",913],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",913],["T_WHITESPACE"," ",913],["T_DOUBLE_ARROW","=>",913],["T_WHITESPACE"," ",913],["T_VARIABLE","$idxTable",913],")",",",["T_WHITESPACE","\n                        ",913],["T_CONSTANT_ENCAPSED_STRING","'i.product_id = e.entity_id AND i.category_id = :category_id AND i.store_id = :store_id'",914],",",["T_WHITESPACE","\n                        ",914],["T_ARRAY","array",915],"(",")",")",["T_WHITESPACE","\n                    ",915],["T_OBJECT_OPERATOR","->",916],["T_STRING","where",916],"(",["T_CONSTANT_ENCAPSED_STRING","'i.product_id IS NULL'",916],")",["T_WHITESPACE","\n                    ",916],["T_OBJECT_OPERATOR","->",917],["T_STRING","columns",917],"(",["T_ARRAY","array",917],"(",["T_WHITESPACE","\n                        ",917],["T_CONSTANT_ENCAPSED_STRING","'category_id'",918],["T_WHITESPACE","   ",918],["T_DOUBLE_ARROW","=>",918],["T_WHITESPACE"," ",918],["T_NEW","new",918],["T_WHITESPACE"," ",918],["T_STRING","Zend_Db_Expr",918],"(",["T_VARIABLE","$rootId",918],")",",",["T_WHITESPACE","\n                        ",918],["T_CONSTANT_ENCAPSED_STRING","'product_id'",919],["T_WHITESPACE","    ",919],["T_DOUBLE_ARROW","=>",919],["T_WHITESPACE"," ",919],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",919],",",["T_WHITESPACE","\n                        ",919],["T_CONSTANT_ENCAPSED_STRING","'position'",920],["T_WHITESPACE","      ",920],["T_DOUBLE_ARROW","=>",920],["T_WHITESPACE"," ",920],["T_NEW","new",920],["T_WHITESPACE"," ",920],["T_STRING","Zend_Db_Expr",920],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",920],")",",",["T_WHITESPACE","\n                        ",920],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",921],["T_WHITESPACE","     ",921],["T_DOUBLE_ARROW","=>",921],["T_WHITESPACE"," ",921],["T_NEW","new",921],["T_WHITESPACE"," ",921],["T_STRING","Zend_Db_Expr",921],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",921],")",",",["T_WHITESPACE","\n                        ",921],["T_CONSTANT_ENCAPSED_STRING","'store_id'",922],["T_WHITESPACE","      ",922],["T_DOUBLE_ARROW","=>",922],["T_WHITESPACE"," ",922],["T_NEW","new",922],["T_WHITESPACE"," ",922],["T_STRING","Zend_Db_Expr",922],"(",["T_VARIABLE","$storeId",922],")",",",["T_WHITESPACE","\n                        ",922],["T_CONSTANT_ENCAPSED_STRING","'visibility'",923],["T_WHITESPACE","    ",923],["T_DOUBLE_ARROW","=>",923],["T_WHITESPACE"," ",923],["T_CONSTANT_ENCAPSED_STRING","'ei.visibility'",923],["T_WHITESPACE","\n                    ",923],")",")",";",["T_WHITESPACE","\n\n                ",924],["T_VARIABLE","$query",926],["T_WHITESPACE"," ",926],"=",["T_WHITESPACE"," ",926],["T_VARIABLE","$select",926],["T_OBJECT_OPERATOR","->",926],["T_STRING","insertFromSelect",926],"(",["T_WHITESPACE","\n                    ",926],["T_VARIABLE","$idxTable",927],",",["T_WHITESPACE","\n                    ",927],["T_ARRAY","array",928],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",928],",",["T_WHITESPACE"," ",928],["T_CONSTANT_ENCAPSED_STRING","'product_id'",928],",",["T_WHITESPACE"," ",928],["T_CONSTANT_ENCAPSED_STRING","'position'",928],",",["T_WHITESPACE"," ",928],["T_CONSTANT_ENCAPSED_STRING","'is_parent'",928],",",["T_WHITESPACE"," ",928],["T_CONSTANT_ENCAPSED_STRING","'store_id'",928],",",["T_WHITESPACE"," ",928],["T_CONSTANT_ENCAPSED_STRING","'visibility'",928],")",",",["T_WHITESPACE","\n                    ",928],["T_STRING","false",929],["T_WHITESPACE","\n                ",929],")",";",["T_WHITESPACE","\n\n                ",930],["T_VARIABLE","$idxAdapter",932],["T_OBJECT_OPERATOR","->",932],["T_STRING","query",932],"(",["T_VARIABLE","$query",932],",",["T_WHITESPACE"," ",932],["T_ARRAY","array",932],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",932],["T_WHITESPACE"," ",932],["T_DOUBLE_ARROW","=>",932],["T_WHITESPACE"," ",932],["T_VARIABLE","$storeId",932],",",["T_WHITESPACE"," ",932],["T_CONSTANT_ENCAPSED_STRING","'category_id'",932],["T_WHITESPACE"," ",932],["T_DOUBLE_ARROW","=>",932],["T_WHITESPACE"," ",932],["T_VARIABLE","$rootId",932],")",")",";",["T_WHITESPACE","\n            ",932],"}",["T_WHITESPACE","\n\n            ",933],["T_VARIABLE","$this",935],["T_OBJECT_OPERATOR","->",935],["T_STRING","syncData",935],"(",")",";",["T_WHITESPACE","\n\n            ",935],["T_DOC_COMMENT","\/**\n             * Clean up temporary tables\n             *\/",937],["T_WHITESPACE","\n            ",939],["T_VARIABLE","$this",940],["T_OBJECT_OPERATOR","->",940],["T_STRING","clearTemporaryIndexTable",940],"(",")",";",["T_WHITESPACE","\n            ",940],["T_VARIABLE","$idxAdapter",941],["T_OBJECT_OPERATOR","->",941],["T_STRING","delete",941],"(",["T_VARIABLE","$enabledTable",941],")",";",["T_WHITESPACE","\n            ",941],["T_VARIABLE","$idxAdapter",942],["T_OBJECT_OPERATOR","->",942],["T_STRING","delete",942],"(",["T_VARIABLE","$anchorTable",942],")",";",["T_WHITESPACE","\n            ",942],["T_VARIABLE","$idxAdapter",943],["T_OBJECT_OPERATOR","->",943],["T_STRING","delete",943],"(",["T_VARIABLE","$anchorProductsTable",943],")",";",["T_WHITESPACE","\n            ",943],["T_VARIABLE","$this",944],["T_OBJECT_OPERATOR","->",944],["T_STRING","commit",944],"(",")",";",["T_WHITESPACE","\n        ",944],"}",["T_WHITESPACE"," ",945],["T_CATCH","catch",945],["T_WHITESPACE"," ",945],"(",["T_STRING","Exception",945],["T_WHITESPACE"," ",945],["T_VARIABLE","$e",945],")",["T_WHITESPACE"," ",945],"{",["T_WHITESPACE","\n            ",945],["T_VARIABLE","$this",946],["T_OBJECT_OPERATOR","->",946],["T_STRING","rollBack",946],"(",")",";",["T_WHITESPACE","\n            ",946],["T_THROW","throw",947],["T_WHITESPACE"," ",947],["T_VARIABLE","$e",947],";",["T_WHITESPACE","\n        ",947],"}",["T_WHITESPACE","\n        ",948],["T_RETURN","return",949],["T_WHITESPACE"," ",949],["T_VARIABLE","$this",949],";",["T_WHITESPACE","\n    ",949],"}",["T_WHITESPACE","\n\n\n    ",950],["T_DOC_COMMENT","\/**\n     * Create temporary table with enabled products visibility info\n     *\n     * @param int $websiteId\n     * @param int $storeId\n     * @return string temporary table name\n     *\/",953],["T_WHITESPACE","\n    ",959],["T_PROTECTED","protected",960],["T_WHITESPACE"," ",960],["T_FUNCTION","function",960],["T_WHITESPACE"," ",960],["T_STRING","_prepareEnabledProductsVisibility",960],"(",["T_VARIABLE","$websiteId",960],",",["T_WHITESPACE"," ",960],["T_VARIABLE","$storeId",960],")",["T_WHITESPACE","\n    ",960],"{",["T_WHITESPACE","\n        ",961],["T_VARIABLE","$statusAttribute",962],["T_WHITESPACE"," ",962],"=",["T_WHITESPACE"," ",962],["T_STRING","Mage",962],["T_DOUBLE_COLON","::",962],["T_STRING","getSingleton",962],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",962],")",["T_OBJECT_OPERATOR","->",962],["T_STRING","getAttribute",962],"(",["T_STRING","Mage_Catalog_Model_Product",962],["T_DOUBLE_COLON","::",962],["T_STRING","ENTITY",962],",",["T_WHITESPACE"," ",962],["T_CONSTANT_ENCAPSED_STRING","'status'",962],")",";",["T_WHITESPACE","\n        ",962],["T_VARIABLE","$visibilityAttribute",963],["T_WHITESPACE"," ",963],"=",["T_WHITESPACE"," ",963],["T_STRING","Mage",963],["T_DOUBLE_COLON","::",963],["T_STRING","getSingleton",963],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",963],")",["T_WHITESPACE","\n            ",963],["T_OBJECT_OPERATOR","->",964],["T_STRING","getAttribute",964],"(",["T_STRING","Mage_Catalog_Model_Product",964],["T_DOUBLE_COLON","::",964],["T_STRING","ENTITY",964],",",["T_WHITESPACE"," ",964],["T_CONSTANT_ENCAPSED_STRING","'visibility'",964],")",";",["T_WHITESPACE","\n        ",964],["T_VARIABLE","$statusAttributeId",965],["T_WHITESPACE"," ",965],"=",["T_WHITESPACE"," ",965],["T_VARIABLE","$statusAttribute",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","getId",965],"(",")",";",["T_WHITESPACE","\n        ",965],["T_VARIABLE","$visibilityAttributeId",966],["T_WHITESPACE"," ",966],"=",["T_WHITESPACE"," ",966],["T_VARIABLE","$visibilityAttribute",966],["T_OBJECT_OPERATOR","->",966],["T_STRING","getId",966],"(",")",";",["T_WHITESPACE","\n        ",966],["T_VARIABLE","$statusTable",967],["T_WHITESPACE"," ",967],"=",["T_WHITESPACE"," ",967],["T_VARIABLE","$statusAttribute",967],["T_OBJECT_OPERATOR","->",967],["T_STRING","getBackend",967],"(",")",["T_OBJECT_OPERATOR","->",967],["T_STRING","getTable",967],"(",")",";",["T_WHITESPACE","\n        ",967],["T_VARIABLE","$visibilityTable",968],["T_WHITESPACE"," ",968],"=",["T_WHITESPACE"," ",968],["T_VARIABLE","$visibilityAttribute",968],["T_OBJECT_OPERATOR","->",968],["T_STRING","getBackend",968],"(",")",["T_OBJECT_OPERATOR","->",968],["T_STRING","getTable",968],"(",")",";",["T_WHITESPACE","\n\n        ",968],["T_DOC_COMMENT","\/**\n         * Prepare temporary table\n         *\/",970],["T_WHITESPACE","\n        ",972],["T_VARIABLE","$tmpTable",973],["T_WHITESPACE"," ",973],"=",["T_WHITESPACE"," ",973],["T_VARIABLE","$this",973],["T_OBJECT_OPERATOR","->",973],["T_STRING","_getEnabledProductsTemporaryTable",973],"(",")",";",["T_WHITESPACE","\n        ",973],["T_VARIABLE","$this",974],["T_OBJECT_OPERATOR","->",974],["T_STRING","_getIndexAdapter",974],"(",")",["T_OBJECT_OPERATOR","->",974],["T_STRING","delete",974],"(",["T_VARIABLE","$tmpTable",974],")",";",["T_WHITESPACE","\n\n        ",974],["T_VARIABLE","$adapter",976],["T_WHITESPACE","        ",976],"=",["T_WHITESPACE"," ",976],["T_VARIABLE","$this",976],["T_OBJECT_OPERATOR","->",976],["T_STRING","_getIndexAdapter",976],"(",")",";",["T_WHITESPACE","\n        ",976],["T_VARIABLE","$visibilityExpr",977],["T_WHITESPACE"," ",977],"=",["T_WHITESPACE"," ",977],["T_VARIABLE","$adapter",977],["T_OBJECT_OPERATOR","->",977],["T_STRING","getCheckSql",977],"(",["T_CONSTANT_ENCAPSED_STRING","'pvs.value_id>0'",977],",",["T_WHITESPACE"," ",977],["T_VARIABLE","$adapter",977],["T_OBJECT_OPERATOR","->",977],["T_STRING","quoteIdentifier",977],"(",["T_CONSTANT_ENCAPSED_STRING","'pvs.value'",977],")",",",["T_WHITESPACE","\n            ",977],["T_VARIABLE","$adapter",978],["T_OBJECT_OPERATOR","->",978],["T_STRING","quoteIdentifier",978],"(",["T_CONSTANT_ENCAPSED_STRING","'pvd.value'",978],")",")",";",["T_WHITESPACE","\n        ",978],["T_VARIABLE","$select",979],["T_WHITESPACE","         ",979],"=",["T_WHITESPACE"," ",979],["T_VARIABLE","$adapter",979],["T_OBJECT_OPERATOR","->",979],["T_STRING","select",979],"(",")",["T_WHITESPACE","\n            ",979],["T_OBJECT_OPERATOR","->",980],["T_STRING","from",980],"(",["T_ARRAY","array",980],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",980],["T_WHITESPACE"," ",980],["T_DOUBLE_ARROW","=>",980],["T_WHITESPACE"," ",980],["T_VARIABLE","$this",980],["T_OBJECT_OPERATOR","->",980],["T_STRING","_productWebsiteTable",980],")",",",["T_WHITESPACE"," ",980],["T_ARRAY","array",980],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",980],",",["T_WHITESPACE"," ",980],["T_CONSTANT_ENCAPSED_STRING","'visibility'",980],["T_WHITESPACE"," ",980],["T_DOUBLE_ARROW","=>",980],["T_WHITESPACE"," ",980],["T_VARIABLE","$visibilityExpr",980],")",")",["T_WHITESPACE","\n            ",980],["T_OBJECT_OPERATOR","->",981],["T_STRING","joinLeft",981],"(",["T_WHITESPACE","\n                ",981],["T_ARRAY","array",982],"(",["T_CONSTANT_ENCAPSED_STRING","'pvd'",982],["T_WHITESPACE"," ",982],["T_DOUBLE_ARROW","=>",982],["T_WHITESPACE"," ",982],["T_VARIABLE","$visibilityTable",982],")",",",["T_WHITESPACE","\n                ",982],["T_VARIABLE","$adapter",983],["T_OBJECT_OPERATOR","->",983],["T_STRING","quoteInto",983],"(",["T_CONSTANT_ENCAPSED_STRING","'pvd.entity_id=pw.product_id AND pvd.attribute_id=? AND pvd.store_id=0'",983],",",["T_WHITESPACE","\n                    ",983],["T_VARIABLE","$visibilityAttributeId",984],")",",",["T_WHITESPACE","\n                ",984],["T_ARRAY","array",985],"(",")",")",["T_WHITESPACE","\n            ",985],["T_OBJECT_OPERATOR","->",986],["T_STRING","joinLeft",986],"(",["T_WHITESPACE","\n                ",986],["T_ARRAY","array",987],"(",["T_CONSTANT_ENCAPSED_STRING","'pvs'",987],["T_WHITESPACE"," ",987],["T_DOUBLE_ARROW","=>",987],["T_WHITESPACE"," ",987],["T_VARIABLE","$visibilityTable",987],")",",",["T_WHITESPACE","\n                ",987],["T_VARIABLE","$adapter",988],["T_OBJECT_OPERATOR","->",988],["T_STRING","quoteInto",988],"(",["T_CONSTANT_ENCAPSED_STRING","'pvs.entity_id=pw.product_id AND pvs.attribute_id=? AND '",988],",",["T_WHITESPACE"," ",988],["T_VARIABLE","$visibilityAttributeId",988],")",["T_WHITESPACE","\n                    ",988],".",["T_WHITESPACE"," ",989],["T_VARIABLE","$adapter",989],["T_OBJECT_OPERATOR","->",989],["T_STRING","quoteInto",989],"(",["T_CONSTANT_ENCAPSED_STRING","'pvs.store_id=?'",989],",",["T_WHITESPACE"," ",989],["T_VARIABLE","$storeId",989],")",",",["T_WHITESPACE","\n                ",989],["T_ARRAY","array",990],"(",")",")",["T_WHITESPACE","\n            ",990],["T_OBJECT_OPERATOR","->",991],["T_STRING","joinLeft",991],"(",["T_WHITESPACE","\n                ",991],["T_ARRAY","array",992],"(",["T_CONSTANT_ENCAPSED_STRING","'psd'",992],["T_WHITESPACE"," ",992],["T_DOUBLE_ARROW","=>",992],["T_WHITESPACE"," ",992],["T_VARIABLE","$statusTable",992],")",",",["T_WHITESPACE","\n                ",992],["T_VARIABLE","$adapter",993],["T_OBJECT_OPERATOR","->",993],["T_STRING","quoteInto",993],"(",["T_CONSTANT_ENCAPSED_STRING","'psd.entity_id=pw.product_id AND psd.attribute_id=? AND psd.store_id=0'",993],",",["T_WHITESPACE","\n                    ",993],["T_VARIABLE","$statusAttributeId",994],")",",",["T_WHITESPACE","\n                ",994],["T_ARRAY","array",995],"(",")",")",["T_WHITESPACE","\n            ",995],["T_OBJECT_OPERATOR","->",996],["T_STRING","joinLeft",996],"(",["T_WHITESPACE","\n                ",996],["T_ARRAY","array",997],"(",["T_CONSTANT_ENCAPSED_STRING","'pss'",997],["T_WHITESPACE"," ",997],["T_DOUBLE_ARROW","=>",997],["T_WHITESPACE"," ",997],["T_VARIABLE","$statusTable",997],")",",",["T_WHITESPACE","\n                    ",997],["T_VARIABLE","$adapter",998],["T_OBJECT_OPERATOR","->",998],["T_STRING","quoteInto",998],"(",["T_CONSTANT_ENCAPSED_STRING","'pss.entity_id=pw.product_id AND pss.attribute_id=? AND '",998],",",["T_WHITESPACE"," ",998],["T_VARIABLE","$statusAttributeId",998],")",["T_WHITESPACE","\n                        ",998],".",["T_WHITESPACE"," ",999],["T_VARIABLE","$adapter",999],["T_OBJECT_OPERATOR","->",999],["T_STRING","quoteInto",999],"(",["T_CONSTANT_ENCAPSED_STRING","'pss.store_id=?'",999],",",["T_WHITESPACE"," ",999],["T_VARIABLE","$storeId",999],")",",",["T_WHITESPACE","\n                ",999],["T_ARRAY","array",1000],"(",")",")",["T_WHITESPACE","\n            ",1000],["T_OBJECT_OPERATOR","->",1001],["T_STRING","where",1001],"(",["T_CONSTANT_ENCAPSED_STRING","'pw.website_id=?'",1001],",",["T_VARIABLE","$websiteId",1001],")",["T_WHITESPACE","\n            ",1001],["T_OBJECT_OPERATOR","->",1002],["T_STRING","where",1002],"(",["T_VARIABLE","$adapter",1002],["T_OBJECT_OPERATOR","->",1002],["T_STRING","getCheckSql",1002],"(",["T_CONSTANT_ENCAPSED_STRING","'pss.value_id > 0'",1002],",",["T_WHITESPACE","\n                ",1002],["T_VARIABLE","$adapter",1003],["T_OBJECT_OPERATOR","->",1003],["T_STRING","quoteIdentifier",1003],"(",["T_CONSTANT_ENCAPSED_STRING","'pss.value'",1003],")",",",["T_WHITESPACE","\n                ",1003],["T_VARIABLE","$adapter",1004],["T_OBJECT_OPERATOR","->",1004],["T_STRING","quoteIdentifier",1004],"(",["T_CONSTANT_ENCAPSED_STRING","'psd.value'",1004],")",")",["T_WHITESPACE"," ",1004],".",["T_WHITESPACE"," ",1004],["T_CONSTANT_ENCAPSED_STRING","' = ?'",1004],",",["T_WHITESPACE"," ",1004],["T_STRING","Mage_Catalog_Model_Product_Status",1004],["T_DOUBLE_COLON","::",1004],["T_STRING","STATUS_ENABLED",1004],")",";",["T_WHITESPACE","\n\n        ",1004],["T_VARIABLE","$query",1006],["T_WHITESPACE"," ",1006],"=",["T_WHITESPACE"," ",1006],["T_VARIABLE","$select",1006],["T_OBJECT_OPERATOR","->",1006],["T_STRING","insertFromSelect",1006],"(",["T_VARIABLE","$tmpTable",1006],",",["T_WHITESPACE"," ",1006],["T_ARRAY","array",1006],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",1006],["T_WHITESPACE"," ",1006],",",["T_WHITESPACE"," ",1006],["T_CONSTANT_ENCAPSED_STRING","'visibility'",1006],")",",",["T_WHITESPACE"," ",1006],["T_STRING","false",1006],")",";",["T_WHITESPACE","\n        ",1006],["T_VARIABLE","$adapter",1007],["T_OBJECT_OPERATOR","->",1007],["T_STRING","query",1007],"(",["T_VARIABLE","$query",1007],")",";",["T_WHITESPACE","\n        ",1007],["T_RETURN","return",1008],["T_WHITESPACE"," ",1008],["T_VARIABLE","$tmpTable",1008],";",["T_WHITESPACE","\n    ",1008],"}",["T_WHITESPACE","\n\n    ",1009],["T_DOC_COMMENT","\/**\n     * Retrieve temporary table of category enabled products\n     *\n     * @return string\n     *\/",1011],["T_WHITESPACE","\n    ",1015],["T_PROTECTED","protected",1016],["T_WHITESPACE"," ",1016],["T_FUNCTION","function",1016],["T_WHITESPACE"," ",1016],["T_STRING","_getEnabledProductsTemporaryTable",1016],"(",")",["T_WHITESPACE","\n    ",1016],"{",["T_WHITESPACE","\n        ",1017],["T_IF","if",1018],["T_WHITESPACE"," ",1018],"(",["T_VARIABLE","$this",1018],["T_OBJECT_OPERATOR","->",1018],["T_STRING","useIdxTable",1018],"(",")",")",["T_WHITESPACE"," ",1018],"{",["T_WHITESPACE","\n            ",1018],["T_RETURN","return",1019],["T_WHITESPACE"," ",1019],["T_VARIABLE","$this",1019],["T_OBJECT_OPERATOR","->",1019],["T_STRING","getTable",1019],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_enabled_indexer_idx'",1019],")",";",["T_WHITESPACE","\n        ",1019],"}",["T_WHITESPACE","\n        ",1020],["T_RETURN","return",1021],["T_WHITESPACE"," ",1021],["T_VARIABLE","$this",1021],["T_OBJECT_OPERATOR","->",1021],["T_STRING","getTable",1021],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_enabled_indexer_tmp'",1021],")",";",["T_WHITESPACE","\n    ",1021],"}",["T_WHITESPACE","\n\n    ",1022],["T_DOC_COMMENT","\/**\n     * Get array with store|website|root_categry path information\n     *\n     * @return array\n     *\/",1024],["T_WHITESPACE","\n    ",1028],["T_PROTECTED","protected",1029],["T_WHITESPACE"," ",1029],["T_FUNCTION","function",1029],["T_WHITESPACE"," ",1029],["T_STRING","_getStoresInfo",1029],"(",")",["T_WHITESPACE","\n    ",1029],"{",["T_WHITESPACE","\n        ",1030],["T_IF","if",1031],["T_WHITESPACE"," ",1031],"(",["T_STRING","is_null",1031],"(",["T_VARIABLE","$this",1031],["T_OBJECT_OPERATOR","->",1031],["T_STRING","_storesInfo",1031],")",")",["T_WHITESPACE"," ",1031],"{",["T_WHITESPACE","\n            ",1031],["T_VARIABLE","$adapter",1032],["T_WHITESPACE"," ",1032],"=",["T_WHITESPACE"," ",1032],["T_VARIABLE","$this",1032],["T_OBJECT_OPERATOR","->",1032],["T_STRING","_getReadAdapter",1032],"(",")",";",["T_WHITESPACE","\n            ",1032],["T_VARIABLE","$select",1033],["T_WHITESPACE"," ",1033],"=",["T_WHITESPACE"," ",1033],["T_VARIABLE","$adapter",1033],["T_OBJECT_OPERATOR","->",1033],["T_STRING","select",1033],"(",")",["T_WHITESPACE","\n                ",1033],["T_OBJECT_OPERATOR","->",1034],["T_STRING","from",1034],"(",["T_ARRAY","array",1034],"(",["T_CONSTANT_ENCAPSED_STRING","'s'",1034],["T_WHITESPACE"," ",1034],["T_DOUBLE_ARROW","=>",1034],["T_WHITESPACE"," ",1034],["T_VARIABLE","$this",1034],["T_OBJECT_OPERATOR","->",1034],["T_STRING","getTable",1034],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",1034],")",")",",",["T_WHITESPACE"," ",1034],["T_ARRAY","array",1034],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",1034],",",["T_WHITESPACE"," ",1034],["T_CONSTANT_ENCAPSED_STRING","'website_id'",1034],")",")",["T_WHITESPACE","\n                ",1034],["T_OBJECT_OPERATOR","->",1035],["T_STRING","join",1035],"(",["T_WHITESPACE","\n                    ",1035],["T_ARRAY","array",1036],"(",["T_CONSTANT_ENCAPSED_STRING","'sg'",1036],["T_WHITESPACE"," ",1036],["T_DOUBLE_ARROW","=>",1036],["T_WHITESPACE"," ",1036],["T_VARIABLE","$this",1036],["T_OBJECT_OPERATOR","->",1036],["T_STRING","getTable",1036],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store_group'",1036],")",")",",",["T_WHITESPACE","\n                    ",1036],["T_CONSTANT_ENCAPSED_STRING","'sg.group_id = s.group_id'",1037],",",["T_WHITESPACE","\n                    ",1037],["T_ARRAY","array",1038],"(",")",")",["T_WHITESPACE","\n                ",1038],["T_OBJECT_OPERATOR","->",1039],["T_STRING","join",1039],"(",["T_WHITESPACE","\n                    ",1039],["T_ARRAY","array",1040],"(",["T_CONSTANT_ENCAPSED_STRING","'c'",1040],["T_WHITESPACE"," ",1040],["T_DOUBLE_ARROW","=>",1040],["T_WHITESPACE"," ",1040],["T_VARIABLE","$this",1040],["T_OBJECT_OPERATOR","->",1040],["T_STRING","getTable",1040],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",1040],")",")",",",["T_WHITESPACE","\n                    ",1040],["T_CONSTANT_ENCAPSED_STRING","'c.entity_id = sg.root_category_id'",1041],",",["T_WHITESPACE","\n                    ",1041],["T_ARRAY","array",1042],"(",["T_WHITESPACE","\n                        ",1042],["T_CONSTANT_ENCAPSED_STRING","'root_path'",1043],["T_WHITESPACE"," ",1043],["T_DOUBLE_ARROW","=>",1043],["T_WHITESPACE"," ",1043],["T_CONSTANT_ENCAPSED_STRING","'path'",1043],",",["T_WHITESPACE","\n                        ",1043],["T_CONSTANT_ENCAPSED_STRING","'root_id'",1044],["T_WHITESPACE","   ",1044],["T_DOUBLE_ARROW","=>",1044],["T_WHITESPACE"," ",1044],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1044],["T_WHITESPACE","\n                    ",1044],")",["T_WHITESPACE","\n                ",1045],")",";",["T_WHITESPACE","\n            ",1046],["T_VARIABLE","$this",1047],["T_OBJECT_OPERATOR","->",1047],["T_STRING","_storesInfo",1047],["T_WHITESPACE"," ",1047],"=",["T_WHITESPACE"," ",1047],["T_VARIABLE","$adapter",1047],["T_OBJECT_OPERATOR","->",1047],["T_STRING","fetchAll",1047],"(",["T_VARIABLE","$select",1047],")",";",["T_WHITESPACE","\n        ",1047],"}",["T_WHITESPACE","\n\n        ",1048],["T_RETURN","return",1050],["T_WHITESPACE"," ",1050],["T_VARIABLE","$this",1050],["T_OBJECT_OPERATOR","->",1050],["T_STRING","_storesInfo",1050],";",["T_WHITESPACE","\n    ",1050],"}",["T_WHITESPACE","\n\n\n    ",1051],["T_DOC_COMMENT","\/**\n     * @param int $storeId\n     * @param string $rootPath\n     * @return string temporary table name\n     *\/",1054],["T_WHITESPACE","\n    ",1058],["T_PROTECTED","protected",1059],["T_WHITESPACE"," ",1059],["T_FUNCTION","function",1059],["T_WHITESPACE"," ",1059],["T_STRING","_prepareAnchorCategories",1059],"(",["T_VARIABLE","$storeId",1059],",",["T_WHITESPACE"," ",1059],["T_VARIABLE","$rootPath",1059],")",["T_WHITESPACE","\n    ",1059],"{",["T_WHITESPACE","\n        ",1060],["T_VARIABLE","$isAnchorAttribute",1061],["T_WHITESPACE"," ",1061],"=",["T_WHITESPACE"," ",1061],["T_STRING","Mage",1061],["T_DOUBLE_COLON","::",1061],["T_STRING","getSingleton",1061],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",1061],")",["T_WHITESPACE","\n            ",1061],["T_OBJECT_OPERATOR","->",1062],["T_STRING","getAttribute",1062],"(",["T_STRING","Mage_Catalog_Model_Category",1062],["T_DOUBLE_COLON","::",1062],["T_STRING","ENTITY",1062],",",["T_WHITESPACE"," ",1062],["T_CONSTANT_ENCAPSED_STRING","'is_anchor'",1062],")",";",["T_WHITESPACE","\n        ",1062],["T_VARIABLE","$anchorAttributeId",1063],["T_WHITESPACE"," ",1063],"=",["T_WHITESPACE"," ",1063],["T_VARIABLE","$isAnchorAttribute",1063],["T_OBJECT_OPERATOR","->",1063],["T_STRING","getId",1063],"(",")",";",["T_WHITESPACE","\n        ",1063],["T_VARIABLE","$anchorTable",1064],["T_WHITESPACE"," ",1064],"=",["T_WHITESPACE"," ",1064],["T_VARIABLE","$isAnchorAttribute",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","getBackend",1064],"(",")",["T_OBJECT_OPERATOR","->",1064],["T_STRING","getTable",1064],"(",")",";",["T_WHITESPACE","\n        ",1064],["T_VARIABLE","$adapter",1065],["T_WHITESPACE"," ",1065],"=",["T_WHITESPACE"," ",1065],["T_VARIABLE","$this",1065],["T_OBJECT_OPERATOR","->",1065],["T_STRING","_getIndexAdapter",1065],"(",")",";",["T_WHITESPACE","\n        ",1065],["T_VARIABLE","$tmpTable",1066],["T_WHITESPACE"," ",1066],"=",["T_WHITESPACE"," ",1066],["T_VARIABLE","$this",1066],["T_OBJECT_OPERATOR","->",1066],["T_STRING","_getAnchorCategoriesTemporaryTable",1066],"(",")",";",["T_WHITESPACE","\n        ",1066],["T_VARIABLE","$adapter",1067],["T_OBJECT_OPERATOR","->",1067],["T_STRING","delete",1067],"(",["T_VARIABLE","$tmpTable",1067],")",";",["T_WHITESPACE","\n\n        ",1067],["T_VARIABLE","$anchorExpr",1069],["T_WHITESPACE"," ",1069],"=",["T_WHITESPACE"," ",1069],["T_VARIABLE","$adapter",1069],["T_OBJECT_OPERATOR","->",1069],["T_STRING","getCheckSql",1069],"(",["T_CONSTANT_ENCAPSED_STRING","'cas.value_id>0'",1069],",",["T_WHITESPACE"," ",1069],["T_VARIABLE","$adapter",1069],["T_OBJECT_OPERATOR","->",1069],["T_STRING","quoteIdentifier",1069],"(",["T_CONSTANT_ENCAPSED_STRING","'cas.value'",1069],")",",",["T_WHITESPACE","\n            ",1069],["T_VARIABLE","$adapter",1070],["T_OBJECT_OPERATOR","->",1070],["T_STRING","quoteIdentifier",1070],"(",["T_CONSTANT_ENCAPSED_STRING","'cad.value'",1070],")",")",";",["T_WHITESPACE","\n        ",1070],["T_VARIABLE","$pathConcat",1071],["T_WHITESPACE"," ",1071],"=",["T_WHITESPACE"," ",1071],["T_VARIABLE","$adapter",1071],["T_OBJECT_OPERATOR","->",1071],["T_STRING","getConcatSql",1071],"(",["T_ARRAY","array",1071],"(",["T_VARIABLE","$adapter",1071],["T_OBJECT_OPERATOR","->",1071],["T_STRING","quoteIdentifier",1071],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.path'",1071],")",",",["T_WHITESPACE"," ",1071],["T_VARIABLE","$adapter",1071],["T_OBJECT_OPERATOR","->",1071],["T_STRING","quote",1071],"(",["T_CONSTANT_ENCAPSED_STRING","'\/%'",1071],")",")",")",";",["T_WHITESPACE","\n        ",1071],["T_VARIABLE","$select",1072],["T_WHITESPACE"," ",1072],"=",["T_WHITESPACE"," ",1072],["T_VARIABLE","$adapter",1072],["T_OBJECT_OPERATOR","->",1072],["T_STRING","select",1072],"(",")",["T_WHITESPACE","\n            ",1072],["T_OBJECT_OPERATOR","->",1073],["T_STRING","from",1073],"(",["T_WHITESPACE","\n                ",1073],["T_ARRAY","array",1074],"(",["T_CONSTANT_ENCAPSED_STRING","'ce'",1074],["T_WHITESPACE"," ",1074],["T_DOUBLE_ARROW","=>",1074],["T_WHITESPACE"," ",1074],["T_VARIABLE","$this",1074],["T_OBJECT_OPERATOR","->",1074],["T_STRING","_categoryTable",1074],")",",",["T_WHITESPACE","\n                ",1074],["T_ARRAY","array",1075],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1075],["T_WHITESPACE"," ",1075],["T_DOUBLE_ARROW","=>",1075],["T_WHITESPACE"," ",1075],["T_CONSTANT_ENCAPSED_STRING","'ce.entity_id'",1075],",",["T_WHITESPACE"," ",1075],["T_CONSTANT_ENCAPSED_STRING","'path'",1075],["T_WHITESPACE"," ",1075],["T_DOUBLE_ARROW","=>",1075],["T_WHITESPACE"," ",1075],["T_VARIABLE","$pathConcat",1075],")",")",["T_WHITESPACE","\n            ",1075],["T_OBJECT_OPERATOR","->",1076],["T_STRING","joinLeft",1076],"(",["T_WHITESPACE","\n                ",1076],["T_ARRAY","array",1077],"(",["T_CONSTANT_ENCAPSED_STRING","'cad'",1077],["T_WHITESPACE"," ",1077],["T_DOUBLE_ARROW","=>",1077],["T_WHITESPACE"," ",1077],["T_VARIABLE","$anchorTable",1077],")",",",["T_WHITESPACE","\n                ",1077],["T_VARIABLE","$adapter",1078],["T_OBJECT_OPERATOR","->",1078],["T_STRING","quoteInto",1078],"(",["T_CONSTANT_ENCAPSED_STRING","\"cad.entity_id=ce.entity_id AND cad.attribute_id=? AND cad.store_id=0\"",1078],",",["T_WHITESPACE","\n                    ",1078],["T_VARIABLE","$anchorAttributeId",1079],")",",",["T_WHITESPACE","\n                ",1079],["T_ARRAY","array",1080],"(",")",")",["T_WHITESPACE","\n            ",1080],["T_OBJECT_OPERATOR","->",1081],["T_STRING","joinLeft",1081],"(",["T_WHITESPACE","\n                ",1081],["T_ARRAY","array",1082],"(",["T_CONSTANT_ENCAPSED_STRING","'cas'",1082],["T_WHITESPACE"," ",1082],["T_DOUBLE_ARROW","=>",1082],["T_WHITESPACE"," ",1082],["T_VARIABLE","$anchorTable",1082],")",",",["T_WHITESPACE","\n                ",1082],["T_VARIABLE","$adapter",1083],["T_OBJECT_OPERATOR","->",1083],["T_STRING","quoteInto",1083],"(",["T_CONSTANT_ENCAPSED_STRING","\"cas.entity_id=ce.entity_id AND cas.attribute_id=? AND \"",1083],",",["T_WHITESPACE"," ",1083],["T_VARIABLE","$anchorAttributeId",1083],")",["T_WHITESPACE","\n                    ",1083],".",["T_WHITESPACE"," ",1084],["T_VARIABLE","$adapter",1084],["T_OBJECT_OPERATOR","->",1084],["T_STRING","quoteInto",1084],"(",["T_CONSTANT_ENCAPSED_STRING","'cas.store_id=?'",1084],",",["T_WHITESPACE"," ",1084],["T_VARIABLE","$storeId",1084],")",",",["T_WHITESPACE","\n                ",1084],["T_ARRAY","array",1085],"(",")",")",["T_WHITESPACE","\n            ",1085],["T_OBJECT_OPERATOR","->",1086],["T_STRING","where",1086],"(","\"",["T_CURLY_OPEN","{",1086],["T_VARIABLE","$anchorExpr",1086],"}",["T_ENCAPSED_AND_WHITESPACE"," = 1 AND ",1086],["T_CURLY_OPEN","{",1086],["T_VARIABLE","$adapter",1086],["T_OBJECT_OPERATOR","->",1086],["T_STRING","quoteIdentifier",1086],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.path'",1086],")","}",["T_ENCAPSED_AND_WHITESPACE"," LIKE ?",1086],"\"",",",["T_WHITESPACE"," ",1086],["T_VARIABLE","$rootPath",1086],["T_WHITESPACE"," ",1086],".",["T_WHITESPACE"," ",1086],["T_CONSTANT_ENCAPSED_STRING","'%'",1086],")",["T_WHITESPACE","\n            ",1086],["T_OBJECT_OPERATOR","->",1087],["T_STRING","orWhere",1087],"(",["T_CONSTANT_ENCAPSED_STRING","'ce.path = ?'",1087],",",["T_WHITESPACE"," ",1087],["T_VARIABLE","$rootPath",1087],")",";",["T_WHITESPACE","\n\n        ",1087],["T_VARIABLE","$query",1089],["T_WHITESPACE"," ",1089],"=",["T_WHITESPACE"," ",1089],["T_VARIABLE","$select",1089],["T_OBJECT_OPERATOR","->",1089],["T_STRING","insertFromSelect",1089],"(",["T_VARIABLE","$tmpTable",1089],",",["T_WHITESPACE"," ",1089],["T_ARRAY","array",1089],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",1089],["T_WHITESPACE"," ",1089],",",["T_WHITESPACE"," ",1089],["T_CONSTANT_ENCAPSED_STRING","'path'",1089],")",",",["T_WHITESPACE"," ",1089],["T_STRING","false",1089],")",";",["T_WHITESPACE","\n        ",1089],["T_VARIABLE","$adapter",1090],["T_OBJECT_OPERATOR","->",1090],["T_STRING","query",1090],"(",["T_VARIABLE","$query",1090],")",";",["T_WHITESPACE","\n        ",1090],["T_RETURN","return",1091],["T_WHITESPACE"," ",1091],["T_VARIABLE","$tmpTable",1091],";",["T_WHITESPACE","\n    ",1091],"}",["T_WHITESPACE","\n\n    ",1092],["T_DOC_COMMENT","\/**\n     * Retrieve temporary table of anchor categories\n     *\n     * @return string\n     *\/",1094],["T_WHITESPACE","\n    ",1098],["T_PROTECTED","protected",1099],["T_WHITESPACE"," ",1099],["T_FUNCTION","function",1099],["T_WHITESPACE"," ",1099],["T_STRING","_getAnchorCategoriesTemporaryTable",1099],"(",")",["T_WHITESPACE","\n    ",1099],"{",["T_WHITESPACE","\n        ",1100],["T_IF","if",1101],["T_WHITESPACE"," ",1101],"(",["T_VARIABLE","$this",1101],["T_OBJECT_OPERATOR","->",1101],["T_STRING","useIdxTable",1101],"(",")",")",["T_WHITESPACE"," ",1101],"{",["T_WHITESPACE","\n            ",1101],["T_RETURN","return",1102],["T_WHITESPACE"," ",1102],["T_VARIABLE","$this",1102],["T_OBJECT_OPERATOR","->",1102],["T_STRING","getTable",1102],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_anchor_indexer_idx'",1102],")",";",["T_WHITESPACE","\n        ",1102],"}",["T_WHITESPACE","\n        ",1103],["T_RETURN","return",1104],["T_WHITESPACE"," ",1104],["T_VARIABLE","$this",1104],["T_OBJECT_OPERATOR","->",1104],["T_STRING","getTable",1104],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_anchor_indexer_tmp'",1104],")",";",["T_WHITESPACE","\n    ",1104],"}",["T_WHITESPACE","\n\n    ",1105],["T_DOC_COMMENT","\/**\n     * Retrieve temporary table of anchor categories products\n     *\n     * @return string\n     *\/",1107],["T_WHITESPACE","\n    ",1111],["T_PROTECTED","protected",1112],["T_WHITESPACE"," ",1112],["T_FUNCTION","function",1112],["T_WHITESPACE"," ",1112],["T_STRING","_getAnchorCategoriesProductsTemporaryTable",1112],"(",")",["T_WHITESPACE","\n    ",1112],"{",["T_WHITESPACE","\n        ",1113],["T_IF","if",1114],["T_WHITESPACE"," ",1114],"(",["T_VARIABLE","$this",1114],["T_OBJECT_OPERATOR","->",1114],["T_STRING","useIdxTable",1114],"(",")",")",["T_WHITESPACE"," ",1114],"{",["T_WHITESPACE","\n            ",1114],["T_RETURN","return",1115],["T_WHITESPACE"," ",1115],["T_VARIABLE","$this",1115],["T_OBJECT_OPERATOR","->",1115],["T_STRING","getTable",1115],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_anchor_products_indexer_idx'",1115],")",";",["T_WHITESPACE","\n        ",1115],"}",["T_WHITESPACE","\n        ",1116],["T_RETURN","return",1117],["T_WHITESPACE"," ",1117],["T_VARIABLE","$this",1117],["T_OBJECT_OPERATOR","->",1117],["T_STRING","getTable",1117],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_anchor_products_indexer_tmp'",1117],")",";",["T_WHITESPACE","\n    ",1117],"}",["T_WHITESPACE","\n\n    ",1118],["T_DOC_COMMENT","\/**\n     * Retrieve temporary decimal index table name\n     *\n     * @param string $table\n     * @return string\n     *\/",1120],["T_WHITESPACE","\n    ",1125],["T_PUBLIC","public",1126],["T_WHITESPACE"," ",1126],["T_FUNCTION","function",1126],["T_WHITESPACE"," ",1126],["T_STRING","getIdxTable",1126],"(",["T_VARIABLE","$table",1126],["T_WHITESPACE"," ",1126],"=",["T_WHITESPACE"," ",1126],["T_STRING","null",1126],")",["T_WHITESPACE","\n    ",1126],"{",["T_WHITESPACE","\n        ",1127],["T_IF","if",1128],["T_WHITESPACE"," ",1128],"(",["T_VARIABLE","$this",1128],["T_OBJECT_OPERATOR","->",1128],["T_STRING","useIdxTable",1128],"(",")",")",["T_WHITESPACE"," ",1128],"{",["T_WHITESPACE","\n            ",1128],["T_RETURN","return",1129],["T_WHITESPACE"," ",1129],["T_VARIABLE","$this",1129],["T_OBJECT_OPERATOR","->",1129],["T_STRING","getTable",1129],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_indexer_idx'",1129],")",";",["T_WHITESPACE","\n        ",1129],"}",["T_WHITESPACE","\n        ",1130],["T_RETURN","return",1131],["T_WHITESPACE"," ",1131],["T_VARIABLE","$this",1131],["T_OBJECT_OPERATOR","->",1131],["T_STRING","getTable",1131],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_indexer_tmp'",1131],")",";",["T_WHITESPACE","\n    ",1131],"}",["T_WHITESPACE","\n",1132],"}",["T_WHITESPACE","\n",1133]]