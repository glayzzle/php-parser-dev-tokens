[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog Product Eav Attributes abstract indexer resource model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_ABSTRACT","abstract",35],["T_WHITESPACE"," ",35],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract",35],["T_WHITESPACE","\n    ",35],["T_EXTENDS","extends",36],["T_WHITESPACE"," ",36],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Abstract",36],["T_WHITESPACE","\n",36],"{",["T_WHITESPACE","\n    ",37],["T_DOC_COMMENT","\/**\n     * Rebuild all index data\n     *\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract\n     *\/",38],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","reindexAll",44],"(",")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","useIdxTable",46],"(",["T_STRING","true",46],")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","beginTransaction",47],"(",")",";",["T_WHITESPACE","\n        ",47],["T_TRY","try",48],["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n            ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","clearTemporaryIndexTable",49],"(",")",";",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_prepareIndex",50],"(",")",";",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_prepareRelationIndex",51],"(",")",";",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_removeNotVisibleEntityFromIndex",52],"(",")",";",["T_WHITESPACE","\n\n            ",52],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","syncData",54],"(",")",";",["T_WHITESPACE","\n            ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","commit",55],"(",")",";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE"," ",56],["T_CATCH","catch",56],["T_WHITESPACE"," ",56],"(",["T_STRING","Exception",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$e",56],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","rollBack",57],"(",")",";",["T_WHITESPACE","\n            ",57],["T_THROW","throw",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$e",58],";",["T_WHITESPACE","\n        ",58],"}",["T_WHITESPACE","\n\n        ",59],["T_RETURN","return",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],";",["T_WHITESPACE","\n    ",61],"}",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Rebuild index data by entities\n     *\n     *\n     * @param int|array $processIds\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract\n     * @throws Exception\n     *\/",64],["T_WHITESPACE","\n    ",71],["T_PUBLIC","public",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","reindexEntities",72],"(",["T_VARIABLE","$processIds",72],")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$adapter",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_getWriteAdapter",74],"(",")",";",["T_WHITESPACE","\n\n        ",74],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","clearTemporaryIndexTable",76],"(",")",";",["T_WHITESPACE","\n\n        ",76],["T_IF","if",78],["T_WHITESPACE"," ",78],"(","!",["T_STRING","is_array",78],"(",["T_VARIABLE","$processIds",78],")",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$processIds",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_ARRAY","array",79],"(",["T_VARIABLE","$processIds",79],")",";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n\n        ",80],["T_VARIABLE","$parentIds",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getRelationsByChild",82],"(",["T_VARIABLE","$processIds",82],")",";",["T_WHITESPACE","\n        ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$parentIds",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$processIds",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","array_unique",84],"(",["T_STRING","array_merge",84],"(",["T_VARIABLE","$processIds",84],",",["T_WHITESPACE"," ",84],["T_VARIABLE","$parentIds",84],")",")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$childIds",86],["T_WHITESPACE","  ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getRelationsByParent",86],"(",["T_VARIABLE","$processIds",86],")",";",["T_WHITESPACE","\n        ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$childIds",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$processIds",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_STRING","array_unique",88],"(",["T_STRING","array_merge",88],"(",["T_VARIABLE","$processIds",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$childIds",88],")",")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n\n        ",89],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_prepareIndex",91],"(",["T_VARIABLE","$processIds",91],")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_prepareRelationIndex",92],"(",["T_VARIABLE","$processIds",92],")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_removeNotVisibleEntityFromIndex",93],"(",")",";",["T_WHITESPACE","\n\n        ",93],["T_VARIABLE","$adapter",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","beginTransaction",95],"(",")",";",["T_WHITESPACE","\n        ",95],["T_TRY","try",96],["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n            ",96],["T_COMMENT","\/\/ remove old index\n",97],["T_WHITESPACE","            ",98],["T_VARIABLE","$where",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$adapter",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","quoteInto",98],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$processIds",98],")",";",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$adapter",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","delete",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getMainTable",99],"(",")",",",["T_WHITESPACE"," ",99],["T_VARIABLE","$where",99],")",";",["T_WHITESPACE","\n\n            ",99],["T_COMMENT","\/\/ insert new index\n",101],["T_WHITESPACE","            ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","useDisableKeys",102],"(",["T_STRING","false",102],")",";",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","insertFromTable",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getIdxTable",103],"(",")",",",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getMainTable",103],"(",")",")",";",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","useDisableKeys",104],"(",["T_STRING","true",104],")",";",["T_WHITESPACE","\n\n            ",104],["T_VARIABLE","$adapter",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","commit",106],"(",")",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE"," ",107],["T_CATCH","catch",107],["T_WHITESPACE"," ",107],"(",["T_STRING","Exception",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$e",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$adapter",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","rollBack",108],"(",")",";",["T_WHITESPACE","\n            ",108],["T_THROW","throw",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$e",109],";",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE","\n\n        ",110],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * Rebuild index data by attribute id\n     * If attribute is not indexable remove data by attribute\n     *\n     *\n     * @param int $attributeId\n     * @param bool $isIndexable\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract\n     *\/",115],["T_WHITESPACE","\n    ",123],["T_PUBLIC","public",124],["T_WHITESPACE"," ",124],["T_FUNCTION","function",124],["T_WHITESPACE"," ",124],["T_STRING","reindexAttribute",124],"(",["T_VARIABLE","$attributeId",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$isIndexable",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","true",124],")",["T_WHITESPACE","\n    ",124],"{",["T_WHITESPACE","\n        ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(","!",["T_VARIABLE","$isIndexable",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_removeAttributeIndexData",127],"(",["T_VARIABLE","$attributeId",127],")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE"," ",128],["T_ELSE","else",128],["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","clearTemporaryIndexTable",129],"(",")",";",["T_WHITESPACE","\n\n            ",129],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_prepareIndex",131],"(",["T_STRING","null",131],",",["T_WHITESPACE"," ",131],["T_VARIABLE","$attributeId",131],")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_prepareRelationIndex",132],"(",")",";",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_removeNotVisibleEntityFromIndex",133],"(",")",";",["T_WHITESPACE","\n\n            ",133],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_synchronizeAttributeIndexData",135],"(",["T_VARIABLE","$attributeId",135],")",";",["T_WHITESPACE","\n        ",135],"}",["T_WHITESPACE","\n\n        ",136],["T_RETURN","return",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n\n    ",139],["T_DOC_COMMENT","\/**\n     * Prepare data index for indexable attributes\n     *\n     * @param array $entityIds      the entity ids limitation\n     * @param int $attributeId      the attribute id limitation\n     *\/",141],["T_WHITESPACE","\n    ",146],["T_ABSTRACT","abstract",147],["T_WHITESPACE"," ",147],["T_PROTECTED","protected",147],["T_WHITESPACE"," ",147],["T_FUNCTION","function",147],["T_WHITESPACE"," ",147],["T_STRING","_prepareIndex",147],"(",["T_VARIABLE","$entityIds",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_STRING","null",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$attributeId",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_STRING","null",147],")",";",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Remove Not Visible products from temporary data index\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract\n     *\/",149],["T_WHITESPACE","\n    ",153],["T_PROTECTED","protected",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","_removeNotVisibleEntityFromIndex",154],"(",")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$write",156],["T_WHITESPACE","      ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_getWriteAdapter",156],"(",")",";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$idxTable",157],["T_WHITESPACE","   ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getIdxTable",157],"(",")",";",["T_WHITESPACE","\n\n        ",157],["T_VARIABLE","$select",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$write",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","select",159],"(",")",["T_WHITESPACE","\n            ",159],["T_OBJECT_OPERATOR","->",160],["T_STRING","from",160],"(",["T_VARIABLE","$idxTable",160],",",["T_WHITESPACE"," ",160],["T_STRING","null",160],")",";",["T_WHITESPACE","\n\n        ",160],["T_VARIABLE","$condition",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$write",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","quoteInto",162],"(",["T_CONSTANT_ENCAPSED_STRING","'=?'",162],",",["T_STRING","Mage_Catalog_Model_Product_Visibility",162],["T_DOUBLE_COLON","::",162],["T_STRING","VISIBILITY_NOT_VISIBLE",162],")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_addAttributeToSelect",163],"(",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$select",164],",",["T_WHITESPACE","\n            ",164],["T_CONSTANT_ENCAPSED_STRING","'visibility'",165],",",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$idxTable",166],["T_WHITESPACE"," ",166],".",["T_WHITESPACE"," ",166],["T_CONSTANT_ENCAPSED_STRING","'.entity_id'",166],",",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$idxTable",167],["T_WHITESPACE"," ",167],".",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'.store_id'",167],",",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$condition",168],["T_WHITESPACE","\n        ",168],")",";",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$query",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$select",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","deleteFromSelect",171],"(",["T_VARIABLE","$idxTable",171],")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$write",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","query",172],"(",["T_VARIABLE","$query",172],")",";",["T_WHITESPACE","\n\n        ",172],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Prepare data index for product relations\n     *\n     * @param array $parentIds  the parent entity ids limitation\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract\n     *\/",177],["T_WHITESPACE","\n    ",182],["T_PROTECTED","protected",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","_prepareRelationIndex",183],"(",["T_VARIABLE","$parentIds",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_STRING","null",183],")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$write",185],["T_WHITESPACE","      ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_getWriteAdapter",185],"(",")",";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$idxTable",186],["T_WHITESPACE","   ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getIdxTable",186],"(",")",";",["T_WHITESPACE","\n\n        ",186],["T_VARIABLE","$select",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$write",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","select",188],"(",")",["T_WHITESPACE","\n            ",188],["T_OBJECT_OPERATOR","->",189],["T_STRING","from",189],"(",["T_ARRAY","array",189],"(",["T_CONSTANT_ENCAPSED_STRING","'l'",189],["T_WHITESPACE"," ",189],["T_DOUBLE_ARROW","=>",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getTable",189],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_relation'",189],")",")",",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",189],")",["T_WHITESPACE","\n            ",189],["T_OBJECT_OPERATOR","->",190],["T_STRING","join",190],"(",["T_WHITESPACE","\n                ",190],["T_ARRAY","array",191],"(",["T_CONSTANT_ENCAPSED_STRING","'cs'",191],["T_WHITESPACE"," ",191],["T_DOUBLE_ARROW","=>",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getTable",191],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",191],")",")",",",["T_WHITESPACE","\n                ",191],["T_CONSTANT_ENCAPSED_STRING","''",192],",",["T_WHITESPACE","\n                ",192],["T_ARRAY","array",193],"(",")",")",["T_WHITESPACE","\n            ",193],["T_OBJECT_OPERATOR","->",194],["T_STRING","join",194],"(",["T_WHITESPACE","\n                ",194],["T_ARRAY","array",195],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",195],["T_WHITESPACE"," ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$idxTable",195],")",",",["T_WHITESPACE","\n                ",195],["T_CONSTANT_ENCAPSED_STRING","'l.child_id = i.entity_id AND cs.store_id = i.store_id'",196],",",["T_WHITESPACE","\n                ",196],["T_ARRAY","array",197],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",197],",",["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","'store_id'",197],",",["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","'value'",197],")",")",["T_WHITESPACE","\n            ",197],["T_OBJECT_OPERATOR","->",198],["T_STRING","group",198],"(",["T_ARRAY","array",198],"(",["T_WHITESPACE","\n                ",198],["T_CONSTANT_ENCAPSED_STRING","'l.parent_id'",199],",",["T_WHITESPACE"," ",199],["T_CONSTANT_ENCAPSED_STRING","'i.attribute_id'",199],",",["T_WHITESPACE"," ",199],["T_CONSTANT_ENCAPSED_STRING","'i.store_id'",199],",",["T_WHITESPACE"," ",199],["T_CONSTANT_ENCAPSED_STRING","'i.value'",199],["T_WHITESPACE","\n            ",199],")",")",";",["T_WHITESPACE","\n        ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(","!",["T_STRING","is_null",201],"(",["T_VARIABLE","$parentIds",201],")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$select",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","where",202],"(",["T_CONSTANT_ENCAPSED_STRING","'l.parent_id IN(?)'",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$parentIds",202],")",";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n\n        ",203],["T_DOC_COMMENT","\/**\n         * Add additional external limitation\n         *\/",205],["T_WHITESPACE","\n        ",207],["T_STRING","Mage",208],["T_DOUBLE_COLON","::",208],["T_STRING","dispatchEvent",208],"(",["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_index_select'",208],",",["T_WHITESPACE"," ",208],["T_ARRAY","array",208],"(",["T_WHITESPACE","\n            ",208],["T_CONSTANT_ENCAPSED_STRING","'select'",209],["T_WHITESPACE","        ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$select",209],",",["T_WHITESPACE","\n            ",209],["T_CONSTANT_ENCAPSED_STRING","'entity_field'",210],["T_WHITESPACE","  ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_NEW","new",210],["T_WHITESPACE"," ",210],["T_STRING","Zend_Db_Expr",210],"(",["T_CONSTANT_ENCAPSED_STRING","'l.parent_id'",210],")",",",["T_WHITESPACE","\n            ",210],["T_CONSTANT_ENCAPSED_STRING","'website_field'",211],["T_WHITESPACE"," ",211],["T_DOUBLE_ARROW","=>",211],["T_WHITESPACE"," ",211],["T_NEW","new",211],["T_WHITESPACE"," ",211],["T_STRING","Zend_Db_Expr",211],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.website_id'",211],")",",",["T_WHITESPACE","\n            ",211],["T_CONSTANT_ENCAPSED_STRING","'store_field'",212],["T_WHITESPACE","   ",212],["T_DOUBLE_ARROW","=>",212],["T_WHITESPACE"," ",212],["T_NEW","new",212],["T_WHITESPACE"," ",212],["T_STRING","Zend_Db_Expr",212],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",212],")",["T_WHITESPACE","\n        ",212],")",")",";",["T_WHITESPACE","\n\n        ",213],["T_VARIABLE","$query",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$write",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","insertFromSelect",215],"(",["T_VARIABLE","$select",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$idxTable",215],",",["T_WHITESPACE"," ",215],["T_ARRAY","array",215],"(",")",",",["T_WHITESPACE"," ",215],["T_STRING","Varien_Db_Adapter_Interface",215],["T_DOUBLE_COLON","::",215],["T_STRING","INSERT_IGNORE",215],")",";",["T_WHITESPACE","\n        ",215],["T_VARIABLE","$write",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","query",216],"(",["T_VARIABLE","$query",216],")",";",["T_WHITESPACE","\n\n        ",216],["T_RETURN","return",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],";",["T_WHITESPACE","\n    ",218],"}",["T_WHITESPACE","\n\n    ",219],["T_DOC_COMMENT","\/**\n     * Retrieve condition for retrieve indexable attribute select\n     * the catalog\/eav_attribute table must have alias is ca\n     *\n     * @return string\n     *\/",221],["T_WHITESPACE","\n    ",226],["T_PROTECTED","protected",227],["T_WHITESPACE"," ",227],["T_FUNCTION","function",227],["T_WHITESPACE"," ",227],["T_STRING","_getIndexableAttributesCondition",227],"(",")",["T_WHITESPACE","\n    ",227],"{",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$conditions",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_ARRAY","array",229],"(",["T_WHITESPACE","\n            ",229],["T_CONSTANT_ENCAPSED_STRING","'ca.is_filterable_in_search > 0'",230],",",["T_WHITESPACE","\n            ",230],["T_CONSTANT_ENCAPSED_STRING","'ca.is_visible_in_advanced_search > 0'",231],",",["T_WHITESPACE","\n            ",231],["T_CONSTANT_ENCAPSED_STRING","'ca.is_filterable > 0'",232],["T_WHITESPACE","\n        ",232],")",";",["T_WHITESPACE","\n\n        ",233],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_STRING","implode",235],"(",["T_CONSTANT_ENCAPSED_STRING","' OR '",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$conditions",235],")",";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_DOC_COMMENT","\/**\n     * Remove index data from index by attribute id\n     *\n     * @param int $attributeId\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract\n     *\/",238],["T_WHITESPACE","\n    ",243],["T_PROTECTED","protected",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","_removeAttributeIndexData",244],"(",["T_VARIABLE","$attributeId",244],")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$adapter",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_getWriteAdapter",246],"(",")",";",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$adapter",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","beginTransaction",247],"(",")",";",["T_WHITESPACE","\n        ",247],["T_TRY","try",248],["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$where",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_VARIABLE","$adapter",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","quoteInto",249],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",249],",",["T_WHITESPACE"," ",249],["T_VARIABLE","$attributeId",249],")",";",["T_WHITESPACE","\n            ",249],["T_VARIABLE","$adapter",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","delete",250],"(",["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getMainTable",250],"(",")",",",["T_WHITESPACE"," ",250],["T_VARIABLE","$where",250],")",";",["T_WHITESPACE","\n            ",250],["T_VARIABLE","$adapter",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","commit",251],"(",")",";",["T_WHITESPACE","\n        ",251],"}",["T_WHITESPACE"," ",252],["T_CATCH","catch",252],["T_WHITESPACE"," ",252],"(",["T_STRING","Exception",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$e",252],")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n            ",252],["T_VARIABLE","$adapter",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","rollback",253],"(",")",";",["T_WHITESPACE","\n            ",253],["T_THROW","throw",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$e",254],";",["T_WHITESPACE","\n        ",254],"}",["T_WHITESPACE","\n\n        ",255],["T_RETURN","return",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],";",["T_WHITESPACE","\n    ",257],"}",["T_WHITESPACE","\n\n    ",258],["T_DOC_COMMENT","\/**\n     * Synchronize temporary index table with index table by attribute id\n     *\n     * @param int $attributeId\n     * @return Mage_Catalog_Model_Resource_Product_Indexer_Eav_Abstract\n     * @throws Exception\n     *\/",260],["T_WHITESPACE","\n    ",266],["T_PROTECTED","protected",267],["T_WHITESPACE"," ",267],["T_FUNCTION","function",267],["T_WHITESPACE"," ",267],["T_STRING","_synchronizeAttributeIndexData",267],"(",["T_VARIABLE","$attributeId",267],")",["T_WHITESPACE","\n    ",267],"{",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$adapter",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_getWriteAdapter",269],"(",")",";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$adapter",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","beginTransaction",270],"(",")",";",["T_WHITESPACE","\n        ",270],["T_TRY","try",271],["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n            ",271],["T_COMMENT","\/\/ remove index by attribute\n",272],["T_WHITESPACE","            ",273],["T_VARIABLE","$where",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$adapter",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","quoteInto",273],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$attributeId",273],")",";",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$adapter",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","delete",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getMainTable",274],"(",")",",",["T_WHITESPACE"," ",274],["T_VARIABLE","$where",274],")",";",["T_WHITESPACE","\n\n            ",274],["T_COMMENT","\/\/ insert new index\n",276],["T_WHITESPACE","            ",277],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","insertFromTable",277],"(",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getIdxTable",277],"(",")",",",["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getMainTable",277],"(",")",")",";",["T_WHITESPACE","\n\n            ",277],["T_VARIABLE","$adapter",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","commit",279],"(",")",";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE"," ",280],["T_CATCH","catch",280],["T_WHITESPACE"," ",280],"(",["T_STRING","Exception",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$e",280],")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$adapter",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","rollback",281],"(",")",";",["T_WHITESPACE","\n            ",281],["T_THROW","throw",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$e",282],";",["T_WHITESPACE","\n        ",282],"}",["T_WHITESPACE","\n\n        ",283],["T_RETURN","return",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],";",["T_WHITESPACE","\n    ",285],"}",["T_WHITESPACE","\n",286],"}",["T_WHITESPACE","\n",287]]