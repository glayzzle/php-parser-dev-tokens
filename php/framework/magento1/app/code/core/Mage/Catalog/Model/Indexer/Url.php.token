[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog url rewrites index model.\n * Responsibility for system actions:\n *  - Product save (changed assigned categories list, assigned websites or url key)\n *  - Category save (changed assigned products list, category move, changed url key)\n *  - Store save (new store creation, changed store group) - require reindex all data\n *  - Store group save (changed root category or group website) - require reindex all data\n *  - Seo config settings change - require reindex all data\n *\/",27],["T_WHITESPACE","\n",35],["T_CLASS","class",36],["T_WHITESPACE"," ",36],["T_STRING","Mage_Catalog_Model_Indexer_Url",36],["T_WHITESPACE"," ",36],["T_EXTENDS","extends",36],["T_WHITESPACE"," ",36],["T_STRING","Mage_Index_Model_Indexer_Abstract",36],["T_WHITESPACE","\n",36],"{",["T_WHITESPACE","\n    ",37],["T_DOC_COMMENT","\/**\n     * Data key for matching result to be saved in\n     *\/",38],["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","EVENT_MATCH_RESULT_KEY",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'catalog_url_match_result'",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Index math: product save, category save, store save\n     * store group save, config save\n     *\n     * @var array\n     *\/",43],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_matchedEntities",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_ARRAY","array",49],"(",["T_WHITESPACE","\n        ",49],["T_STRING","Mage_Catalog_Model_Product",50],["T_DOUBLE_COLON","::",50],["T_STRING","ENTITY",50],["T_WHITESPACE"," ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_ARRAY","array",50],"(",["T_WHITESPACE","\n            ",50],["T_STRING","Mage_Index_Model_Event",51],["T_DOUBLE_COLON","::",51],["T_STRING","TYPE_SAVE",51],["T_WHITESPACE","\n        ",51],")",",",["T_WHITESPACE","\n        ",52],["T_STRING","Mage_Catalog_Model_Category",53],["T_DOUBLE_COLON","::",53],["T_STRING","ENTITY",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_ARRAY","array",53],"(",["T_WHITESPACE","\n            ",53],["T_STRING","Mage_Index_Model_Event",54],["T_DOUBLE_COLON","::",54],["T_STRING","TYPE_SAVE",54],["T_WHITESPACE","\n        ",54],")",",",["T_WHITESPACE","\n        ",55],["T_STRING","Mage_Core_Model_Store",56],["T_DOUBLE_COLON","::",56],["T_STRING","ENTITY",56],["T_WHITESPACE"," ",56],["T_DOUBLE_ARROW","=>",56],["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",["T_WHITESPACE","\n            ",56],["T_STRING","Mage_Index_Model_Event",57],["T_DOUBLE_COLON","::",57],["T_STRING","TYPE_SAVE",57],["T_WHITESPACE","\n        ",57],")",",",["T_WHITESPACE","\n        ",58],["T_STRING","Mage_Core_Model_Store_Group",59],["T_DOUBLE_COLON","::",59],["T_STRING","ENTITY",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_ARRAY","array",59],"(",["T_WHITESPACE","\n            ",59],["T_STRING","Mage_Index_Model_Event",60],["T_DOUBLE_COLON","::",60],["T_STRING","TYPE_SAVE",60],["T_WHITESPACE","\n        ",60],")",",",["T_WHITESPACE","\n        ",61],["T_STRING","Mage_Core_Model_Config_Data",62],["T_DOUBLE_COLON","::",62],["T_STRING","ENTITY",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_ARRAY","array",62],"(",["T_WHITESPACE","\n            ",62],["T_STRING","Mage_Index_Model_Event",63],["T_DOUBLE_COLON","::",63],["T_STRING","TYPE_SAVE",63],["T_WHITESPACE","\n        ",63],")",",",["T_WHITESPACE","\n        ",64],["T_STRING","Mage_Catalog_Model_Convert_Adapter_Product",65],["T_DOUBLE_COLON","::",65],["T_STRING","ENTITY",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_ARRAY","array",65],"(",["T_WHITESPACE","\n            ",65],["T_STRING","Mage_Index_Model_Event",66],["T_DOUBLE_COLON","::",66],["T_STRING","TYPE_SAVE",66],["T_WHITESPACE","\n        ",66],")",["T_WHITESPACE","\n    ",67],")",";",["T_WHITESPACE","\n\n    ",68],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_relatedConfigSettings",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",["T_WHITESPACE","\n        ",70],["T_STRING","Mage_Catalog_Helper_Category",71],["T_DOUBLE_COLON","::",71],["T_STRING","XML_PATH_CATEGORY_URL_SUFFIX",71],",",["T_WHITESPACE","\n        ",71],["T_STRING","Mage_Catalog_Helper_Product",72],["T_DOUBLE_COLON","::",72],["T_STRING","XML_PATH_PRODUCT_URL_SUFFIX",72],",",["T_WHITESPACE","\n        ",72],["T_STRING","Mage_Catalog_Helper_Product",73],["T_DOUBLE_COLON","::",73],["T_STRING","XML_PATH_PRODUCT_URL_USE_CATEGORY",73],",",["T_WHITESPACE","\n    ",73],")",";",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Get Indexer name\n     *\n     * @return string\n     *\/",76],["T_WHITESPACE","\n    ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","getName",81],"(",")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_STRING","Mage",83],["T_DOUBLE_COLON","::",83],["T_STRING","helper",83],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",83],")",["T_OBJECT_OPERATOR","->",83],["T_STRING","__",83],"(",["T_CONSTANT_ENCAPSED_STRING","'Catalog URL Rewrites'",83],")",";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Get Indexer description\n     *\n     * @return string\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PUBLIC","public",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","getDescription",91],"(",")",["T_WHITESPACE","\n    ",91],"{",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_STRING","Mage",93],["T_DOUBLE_COLON","::",93],["T_STRING","helper",93],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",93],")",["T_OBJECT_OPERATOR","->",93],["T_STRING","__",93],"(",["T_CONSTANT_ENCAPSED_STRING","'Index product and categories URL rewrites'",93],")",";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Check if event can be matched by process.\n     * Overwrote for specific config save, store and store groups save matching\n     *\n     * @param Mage_Index_Model_Event $event\n     * @return bool\n     *\/",96],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","matchEvent",103],"(",["T_STRING","Mage_Index_Model_Event",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$event",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$data",105],["T_WHITESPACE","       ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$event",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getNewData",105],"(",")",";",["T_WHITESPACE","\n        ",105],["T_IF","if",106],["T_WHITESPACE"," ",106],"(",["T_ISSET","isset",106],"(",["T_VARIABLE","$data",106],"[",["T_STRING","self",106],["T_DOUBLE_COLON","::",106],["T_STRING","EVENT_MATCH_RESULT_KEY",106],"]",")",")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$data",107],"[",["T_STRING","self",107],["T_DOUBLE_COLON","::",107],["T_STRING","EVENT_MATCH_RESULT_KEY",107],"]",";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n\n        ",108],["T_VARIABLE","$entity",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$event",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getEntity",110],"(",")",";",["T_WHITESPACE","\n        ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_VARIABLE","$entity",111],["T_WHITESPACE"," ",111],["T_IS_EQUAL","==",111],["T_WHITESPACE"," ",111],["T_STRING","Mage_Core_Model_Store",111],["T_DOUBLE_COLON","::",111],["T_STRING","ENTITY",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$store",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$event",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getDataObject",112],"(",")",";",["T_WHITESPACE","\n            ",112],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$store",113],["T_WHITESPACE"," ",113],["T_BOOLEAN_AND","&&",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$store",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","isObjectNew",113],"(",")",["T_WHITESPACE"," ",113],["T_BOOLEAN_OR","||",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$store",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","dataHasChangedFor",113],"(",["T_CONSTANT_ENCAPSED_STRING","'group_id'",113],")",")",")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$result",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","true",114],";",["T_WHITESPACE","\n            ",114],"}",["T_WHITESPACE"," ",115],["T_ELSE","else",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$result",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","false",116],";",["T_WHITESPACE","\n            ",116],"}",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE"," ",118],["T_ELSE","else",118],["T_WHITESPACE"," ",118],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$entity",118],["T_WHITESPACE"," ",118],["T_IS_EQUAL","==",118],["T_WHITESPACE"," ",118],["T_STRING","Mage_Core_Model_Store_Group",118],["T_DOUBLE_COLON","::",118],["T_STRING","ENTITY",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$storeGroup",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$event",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getDataObject",119],"(",")",";",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$hasDataChanges",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$storeGroup",120],["T_WHITESPACE"," ",120],["T_BOOLEAN_AND","&&",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$storeGroup",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","dataHasChangedFor",120],"(",["T_CONSTANT_ENCAPSED_STRING","'root_category_id'",120],")",["T_WHITESPACE","\n                ",120],["T_BOOLEAN_OR","||",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$storeGroup",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","dataHasChangedFor",121],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",121],")",")",";",["T_WHITESPACE","\n            ",121],["T_IF","if",122],["T_WHITESPACE"," ",122],"(",["T_VARIABLE","$storeGroup",122],["T_WHITESPACE"," ",122],["T_BOOLEAN_AND","&&",122],["T_WHITESPACE"," ",122],"!",["T_VARIABLE","$storeGroup",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","isObjectNew",122],"(",")",["T_WHITESPACE"," ",122],["T_BOOLEAN_AND","&&",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$hasDataChanges",122],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$result",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","true",123],";",["T_WHITESPACE","\n            ",123],"}",["T_WHITESPACE"," ",124],["T_ELSE","else",124],["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$result",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","false",125],";",["T_WHITESPACE","\n            ",125],"}",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE"," ",127],["T_ELSE","else",127],["T_WHITESPACE"," ",127],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$entity",127],["T_WHITESPACE"," ",127],["T_IS_EQUAL","==",127],["T_WHITESPACE"," ",127],["T_STRING","Mage_Core_Model_Config_Data",127],["T_DOUBLE_COLON","::",127],["T_STRING","ENTITY",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$configData",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$event",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getDataObject",128],"(",")",";",["T_WHITESPACE","\n            ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$configData",129],["T_WHITESPACE"," ",129],["T_BOOLEAN_AND","&&",129],["T_WHITESPACE"," ",129],["T_STRING","in_array",129],"(",["T_VARIABLE","$configData",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getPath",129],"(",")",",",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_relatedConfigSettings",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$result",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$configData",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","isValueChanged",130],"(",")",";",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE"," ",131],["T_ELSE","else",131],["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n                ",131],["T_VARIABLE","$result",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","false",132],";",["T_WHITESPACE","\n            ",132],"}",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE"," ",134],["T_ELSE","else",134],["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$result",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","parent",135],["T_DOUBLE_COLON","::",135],["T_STRING","matchEvent",135],"(",["T_VARIABLE","$event",135],")",";",["T_WHITESPACE","\n        ",135],"}",["T_WHITESPACE","\n\n        ",136],["T_VARIABLE","$event",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","addNewData",138],"(",["T_STRING","self",138],["T_DOUBLE_COLON","::",138],["T_STRING","EVENT_MATCH_RESULT_KEY",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$result",138],")",";",["T_WHITESPACE","\n\n        ",138],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$result",140],";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Register data required by process in event object\n     *\n     * @param Mage_Index_Model_Event $event\n     *\/",143],["T_WHITESPACE","\n    ",147],["T_PROTECTED","protected",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","_registerEvent",148],"(",["T_STRING","Mage_Index_Model_Event",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$event",148],")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$event",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","addNewData",150],"(",["T_STRING","self",150],["T_DOUBLE_COLON","::",150],["T_STRING","EVENT_MATCH_RESULT_KEY",150],",",["T_WHITESPACE"," ",150],["T_STRING","true",150],")",";",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$entity",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$event",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getEntity",151],"(",")",";",["T_WHITESPACE","\n        ",151],["T_SWITCH","switch",152],["T_WHITESPACE"," ",152],"(",["T_VARIABLE","$entity",152],")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_CASE","case",153],["T_WHITESPACE"," ",153],["T_STRING","Mage_Catalog_Model_Product",153],["T_DOUBLE_COLON","::",153],["T_STRING","ENTITY",153],":",["T_WHITESPACE","\n               ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_registerProductEvent",154],"(",["T_VARIABLE","$event",154],")",";",["T_WHITESPACE","\n                ",154],["T_BREAK","break",155],";",["T_WHITESPACE","\n\n            ",155],["T_CASE","case",157],["T_WHITESPACE"," ",157],["T_STRING","Mage_Catalog_Model_Category",157],["T_DOUBLE_COLON","::",157],["T_STRING","ENTITY",157],":",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_registerCategoryEvent",158],"(",["T_VARIABLE","$event",158],")",";",["T_WHITESPACE","\n                ",158],["T_BREAK","break",159],";",["T_WHITESPACE","\n\n            ",159],["T_CASE","case",161],["T_WHITESPACE"," ",161],["T_STRING","Mage_Catalog_Model_Convert_Adapter_Product",161],["T_DOUBLE_COLON","::",161],["T_STRING","ENTITY",161],":",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$event",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","addNewData",162],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_url_reindex_all'",162],",",["T_WHITESPACE"," ",162],["T_STRING","true",162],")",";",["T_WHITESPACE","\n                ",162],["T_BREAK","break",163],";",["T_WHITESPACE","\n\n            ",163],["T_CASE","case",165],["T_WHITESPACE"," ",165],["T_STRING","Mage_Core_Model_Store",165],["T_DOUBLE_COLON","::",165],["T_STRING","ENTITY",165],":",["T_WHITESPACE","\n            ",165],["T_CASE","case",166],["T_WHITESPACE"," ",166],["T_STRING","Mage_Core_Model_Store_Group",166],["T_DOUBLE_COLON","::",166],["T_STRING","ENTITY",166],":",["T_WHITESPACE","\n            ",166],["T_CASE","case",167],["T_WHITESPACE"," ",167],["T_STRING","Mage_Core_Model_Config_Data",167],["T_DOUBLE_COLON","::",167],["T_STRING","ENTITY",167],":",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$process",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$event",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getProcess",168],"(",")",";",["T_WHITESPACE","\n                ",168],["T_VARIABLE","$process",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","changeStatus",169],"(",["T_STRING","Mage_Index_Model_Process",169],["T_DOUBLE_COLON","::",169],["T_STRING","STATUS_REQUIRE_REINDEX",169],")",";",["T_WHITESPACE","\n                ",169],["T_BREAK","break",170],";",["T_WHITESPACE","\n        ",170],"}",["T_WHITESPACE","\n        ",171],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],";",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n\n    ",173],["T_DOC_COMMENT","\/**\n     * Register event data during product save process\n     *\n     * @param Mage_Index_Model_Event $event\n     *\/",175],["T_WHITESPACE","\n    ",179],["T_PROTECTED","protected",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","_registerProductEvent",180],"(",["T_STRING","Mage_Index_Model_Event",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$event",180],")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$product",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$event",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getDataObject",182],"(",")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$dataChange",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$product",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","dataHasChangedFor",183],"(",["T_CONSTANT_ENCAPSED_STRING","'url_key'",183],")",["T_WHITESPACE","\n            ",183],["T_BOOLEAN_OR","||",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$product",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getIsChangedCategories",184],"(",")",["T_WHITESPACE","\n            ",184],["T_BOOLEAN_OR","||",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$product",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getIsChangedWebsites",185],"(",")",";",["T_WHITESPACE","\n\n        ",185],["T_IF","if",187],["T_WHITESPACE"," ",187],"(","!",["T_VARIABLE","$product",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getExcludeUrlRewrite",187],"(",")",["T_WHITESPACE"," ",187],["T_BOOLEAN_AND","&&",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$dataChange",187],")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$event",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","addNewData",188],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite_product_ids'",188],",",["T_WHITESPACE"," ",188],["T_ARRAY","array",188],"(",["T_VARIABLE","$product",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getId",188],"(",")",")",")",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n\n    ",190],["T_DOC_COMMENT","\/**\n     * Register event data during category save process\n     *\n     * @param Mage_Index_Model_Event $event\n     *\/",192],["T_WHITESPACE","\n    ",196],["T_PROTECTED","protected",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","_registerCategoryEvent",197],"(",["T_STRING","Mage_Index_Model_Event",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$event",197],")",["T_WHITESPACE","\n    ",197],"{",["T_WHITESPACE","\n        ",198],["T_VARIABLE","$category",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$event",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getDataObject",199],"(",")",";",["T_WHITESPACE","\n        ",199],["T_IF","if",200],["T_WHITESPACE"," ",200],"(","!",["T_VARIABLE","$category",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getInitialSetupFlag",200],"(",")",["T_WHITESPACE"," ",200],["T_BOOLEAN_AND","&&",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$category",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getLevel",200],"(",")",["T_WHITESPACE"," ",200],">",["T_WHITESPACE"," ",200],["T_LNUMBER","1",200],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n            ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_VARIABLE","$category",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","dataHasChangedFor",201],"(",["T_CONSTANT_ENCAPSED_STRING","'url_key'",201],")",["T_WHITESPACE"," ",201],["T_BOOLEAN_OR","||",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$category",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getIsChangedProductList",201],"(",")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                ",201],["T_VARIABLE","$event",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","addNewData",202],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite_category_ids'",202],",",["T_WHITESPACE"," ",202],["T_ARRAY","array",202],"(",["T_VARIABLE","$category",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getId",202],"(",")",")",")",";",["T_WHITESPACE","\n            ",202],"}",["T_WHITESPACE","\n            ",203],["T_DOC_COMMENT","\/**\n             * Check if category has another affected category ids (category move result)\n             *\/",204],["T_WHITESPACE","\n            ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$category",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getAffectedCategoryIds",207],"(",")",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$event",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","addNewData",208],"(",["T_CONSTANT_ENCAPSED_STRING","'rewrite_category_ids'",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$category",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getAffectedCategoryIds",208],"(",")",")",";",["T_WHITESPACE","\n            ",208],"}",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Process event\n     *\n     * @param Mage_Index_Model_Event $event\n     *\/",213],["T_WHITESPACE","\n    ",217],["T_PROTECTED","protected",218],["T_WHITESPACE"," ",218],["T_FUNCTION","function",218],["T_WHITESPACE"," ",218],["T_STRING","_processEvent",218],"(",["T_STRING","Mage_Index_Model_Event",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$event",218],")",["T_WHITESPACE","\n    ",218],"{",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$data",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$event",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getNewData",220],"(",")",";",["T_WHITESPACE","\n        ",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(","!",["T_EMPTY","empty",221],"(",["T_VARIABLE","$data",221],"[",["T_CONSTANT_ENCAPSED_STRING","'catalog_url_reindex_all'",221],"]",")",")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n            ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","reindexAll",222],"(",")",";",["T_WHITESPACE","\n        ",222],"}",["T_WHITESPACE","\n\n        ",223],["T_COMMENT","\/* @var $urlModel Mage_Catalog_Model_Url *\/",225],["T_WHITESPACE","\n        ",225],["T_VARIABLE","$urlModel",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_STRING","Mage",226],["T_DOUBLE_COLON","::",226],["T_STRING","getSingleton",226],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/url'",226],")",";",["T_WHITESPACE","\n\n        ",226],["T_COMMENT","\/\/ Force rewrites history saving\n",228],["T_WHITESPACE","        ",229],["T_VARIABLE","$dataObject",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$event",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getDataObject",229],"(",")",";",["T_WHITESPACE","\n        ",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$dataObject",230],["T_WHITESPACE"," ",230],["T_INSTANCEOF","instanceof",230],["T_WHITESPACE"," ",230],["T_STRING","Varien_Object",230],["T_WHITESPACE"," ",230],["T_BOOLEAN_AND","&&",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$dataObject",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","hasData",230],"(",["T_CONSTANT_ENCAPSED_STRING","'save_rewrites_history'",230],")",")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$urlModel",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","setShouldSaveRewritesHistory",231],"(",["T_VARIABLE","$dataObject",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getData",231],"(",["T_CONSTANT_ENCAPSED_STRING","'save_rewrites_history'",231],")",")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_IF","if",234],"(",["T_ISSET","isset",234],"(",["T_VARIABLE","$data",234],"[",["T_CONSTANT_ENCAPSED_STRING","'rewrite_product_ids'",234],"]",")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$urlModel",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","clearStoreInvalidRewrites",235],"(",")",";",["T_WHITESPACE"," ",235],["T_COMMENT","\/\/ Maybe some products were moved or removed from website\n",235],["T_WHITESPACE","            ",236],["T_FOREACH","foreach",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$data",236],"[",["T_CONSTANT_ENCAPSED_STRING","'rewrite_product_ids'",236],"]",["T_WHITESPACE"," ",236],["T_AS","as",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$productId",236],")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n                 ",236],["T_VARIABLE","$urlModel",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","refreshProductRewrite",237],"(",["T_VARIABLE","$productId",237],")",";",["T_WHITESPACE","\n            ",237],"}",["T_WHITESPACE","\n        ",238],"}",["T_WHITESPACE","\n        ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_ISSET","isset",240],"(",["T_VARIABLE","$data",240],"[",["T_CONSTANT_ENCAPSED_STRING","'rewrite_category_ids'",240],"]",")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$urlModel",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","clearStoreInvalidRewrites",241],"(",")",";",["T_WHITESPACE"," ",241],["T_COMMENT","\/\/ Maybe some categories were moved\n",241],["T_WHITESPACE","            ",242],["T_FOREACH","foreach",242],["T_WHITESPACE"," ",242],"(",["T_VARIABLE","$data",242],"[",["T_CONSTANT_ENCAPSED_STRING","'rewrite_category_ids'",242],"]",["T_WHITESPACE"," ",242],["T_AS","as",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$categoryId",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n                ",242],["T_VARIABLE","$urlModel",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","refreshCategoryRewrite",243],"(",["T_VARIABLE","$categoryId",243],")",";",["T_WHITESPACE","\n            ",243],"}",["T_WHITESPACE","\n        ",244],"}",["T_WHITESPACE","\n    ",245],"}",["T_WHITESPACE","\n\n    ",246],["T_DOC_COMMENT","\/**\n     * Rebuild all index data\n     *\/",248],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","reindexAll",251],"(",")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_DOC_COMMENT","\/** @var $resourceModel Mage_Catalog_Model_Resource_Url *\/",253],["T_WHITESPACE","\n        ",253],["T_VARIABLE","$resourceModel",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_STRING","Mage",254],["T_DOUBLE_COLON","::",254],["T_STRING","getResourceSingleton",254],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/url'",254],")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$resourceModel",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","beginTransaction",255],"(",")",";",["T_WHITESPACE","\n        ",255],["T_TRY","try",256],["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_STRING","Mage",257],["T_DOUBLE_COLON","::",257],["T_STRING","getSingleton",257],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/url'",257],")",["T_OBJECT_OPERATOR","->",257],["T_STRING","refreshRewrites",257],"(",")",";",["T_WHITESPACE","\n            ",257],["T_VARIABLE","$resourceModel",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","commit",258],"(",")",";",["T_WHITESPACE","\n        ",258],"}",["T_WHITESPACE"," ",259],["T_CATCH","catch",259],["T_WHITESPACE"," ",259],"(",["T_STRING","Exception",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$e",259],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n            ",259],["T_VARIABLE","$resourceModel",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","rollBack",260],"(",")",";",["T_WHITESPACE","\n            ",260],["T_THROW","throw",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$e",261],";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n    ",262],"}",["T_WHITESPACE","\n",263],"}",["T_WHITESPACE","\n",264]]