[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog view layer model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Layer",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Varien_Object",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Product collections array\n     *\n     * @var array\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_productCollections",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_ARRAY","array",42],"(",")",";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Key which can be used for load\/save aggregation data\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_stateKey",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","null",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Get data aggregation object\n     *\n     * @return Mage_CatalogIndex_Model_Aggregation\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PUBLIC","public",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","getAggregator",56],"(",")",["T_WHITESPACE","\n    ",56],"{",["T_WHITESPACE","\n        ",57],["T_RETURN","return",58],["T_WHITESPACE"," ",58],["T_STRING","Mage",58],["T_DOUBLE_COLON","::",58],["T_STRING","getSingleton",58],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogindex\/aggregation'",58],")",";",["T_WHITESPACE","\n    ",58],"}",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * Get layer state key\n     *\n     * @return string\n     *\/",61],["T_WHITESPACE","\n    ",65],["T_PUBLIC","public",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","getStateKey",66],"(",")",["T_WHITESPACE","\n    ",66],"{",["T_WHITESPACE","\n        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_stateKey",68],["T_WHITESPACE"," ",68],["T_IS_IDENTICAL","===",68],["T_WHITESPACE"," ",68],["T_STRING","null",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_stateKey",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'STORE_'",69],".",["T_STRING","Mage",69],["T_DOUBLE_COLON","::",69],["T_STRING","app",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","getStore",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","getId",69],"(",")",["T_WHITESPACE","\n                ",69],".",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'_CAT_'",70],["T_WHITESPACE"," ",70],".",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getCurrentCategory",70],"(",")",["T_OBJECT_OPERATOR","->",70],["T_STRING","getId",70],"(",")",["T_WHITESPACE","\n                ",70],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'_CUSTGROUP_'",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_STRING","Mage",71],["T_DOUBLE_COLON","::",71],["T_STRING","getSingleton",71],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",71],")",["T_OBJECT_OPERATOR","->",71],["T_STRING","getCustomerGroupId",71],"(",")",";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n\n        ",72],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_stateKey",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Get default tags for current layer state\n     *\n     * @param   array $additionalTags\n     * @return  array\n     *\/",77],["T_WHITESPACE","\n    ",82],["T_PUBLIC","public",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","getStateTags",83],"(",["T_ARRAY","array",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$additionalTags",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",")",")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$additionalTags",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","array_merge",85],"(",["T_VARIABLE","$additionalTags",85],",",["T_WHITESPACE"," ",85],["T_ARRAY","array",85],"(",["T_WHITESPACE","\n            ",85],["T_STRING","Mage_Catalog_Model_Category",86],["T_DOUBLE_COLON","::",86],["T_STRING","CACHE_TAG",86],".",["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getCurrentCategory",86],"(",")",["T_OBJECT_OPERATOR","->",86],["T_STRING","getId",86],"(",")",["T_WHITESPACE","\n        ",86],")",")",";",["T_WHITESPACE","\n\n        ",87],["T_RETURN","return",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$additionalTags",89],";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Retrieve current layer product collection\n     *\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Collection\n     *\/",92],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","getProductCollection",97],"(",")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_ISSET","isset",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_productCollections",99],"[",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getCurrentCategory",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","getId",99],"(",")","]",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$collection",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","_productCollections",100],"[",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getCurrentCategory",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getId",100],"(",")","]",";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE"," ",101],["T_ELSE","else",101],["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$collection",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getCurrentCategory",102],"(",")",["T_OBJECT_OPERATOR","->",102],["T_STRING","getProductCollection",102],"(",")",";",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","prepareProductCollection",103],"(",["T_VARIABLE","$collection",103],")",";",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_productCollections",104],"[",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getCurrentCategory",104],"(",")",["T_OBJECT_OPERATOR","->",104],["T_STRING","getId",104],"(",")","]",["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$collection",104],";",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n\n        ",105],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$collection",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Initialize product collection\n     *\n     * @param Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Collection $collection\n     * @return Mage_Catalog_Model_Layer\n     *\/",110],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","prepareProductCollection",116],"(",["T_VARIABLE","$collection",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$collection",118],["T_WHITESPACE","\n            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","addAttributeToSelect",119],"(",["T_STRING","Mage",119],["T_DOUBLE_COLON","::",119],["T_STRING","getSingleton",119],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/config'",119],")",["T_OBJECT_OPERATOR","->",119],["T_STRING","getProductAttributes",119],"(",")",")",["T_WHITESPACE","\n            ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","addMinimalPrice",120],"(",")",["T_WHITESPACE","\n            ",120],["T_OBJECT_OPERATOR","->",121],["T_STRING","addFinalPrice",121],"(",")",["T_WHITESPACE","\n            ",121],["T_OBJECT_OPERATOR","->",122],["T_STRING","addTaxPercents",122],"(",")",["T_WHITESPACE","\n            ",122],["T_OBJECT_OPERATOR","->",123],["T_STRING","addUrlRewrite",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getCurrentCategory",123],"(",")",["T_OBJECT_OPERATOR","->",123],["T_STRING","getId",123],"(",")",")",";",["T_WHITESPACE","\n\n        ",123],["T_STRING","Mage",125],["T_DOUBLE_COLON","::",125],["T_STRING","getSingleton",125],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_status'",125],")",["T_OBJECT_OPERATOR","->",125],["T_STRING","addVisibleFilterToCollection",125],"(",["T_VARIABLE","$collection",125],")",";",["T_WHITESPACE","\n        ",125],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","getSingleton",126],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_visibility'",126],")",["T_OBJECT_OPERATOR","->",126],["T_STRING","addVisibleInCatalogFilterToCollection",126],"(",["T_VARIABLE","$collection",126],")",";",["T_WHITESPACE","\n\n        ",126],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * Apply layer\n     * Method is colling after apply all filters, can be used\n     * for prepare some index data before getting information\n     * about existing intexes\n     *\n     * @return Mage_Catalog_Model_Layer\n     *\/",131],["T_WHITESPACE","\n    ",138],["T_PUBLIC","public",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","apply",139],"(",")",["T_WHITESPACE","\n    ",139],"{",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$stateSuffix",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","''",141],";",["T_WHITESPACE","\n        ",141],["T_FOREACH","foreach",142],["T_WHITESPACE"," ",142],"(",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getState",142],"(",")",["T_OBJECT_OPERATOR","->",142],["T_STRING","getFilters",142],"(",")",["T_WHITESPACE"," ",142],["T_AS","as",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$filterItem",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$stateSuffix",143],["T_WHITESPACE"," ",143],["T_CONCAT_EQUAL",".=",143],["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'_'",143],["T_WHITESPACE"," ",143],".",["T_WHITESPACE"," ",143],["T_VARIABLE","$filterItem",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getFilter",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","getRequestVar",143],"(",")",["T_WHITESPACE","\n                ",143],".",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'_'",144],["T_WHITESPACE"," ",144],".",["T_WHITESPACE"," ",144],["T_VARIABLE","$filterItem",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getValueString",144],"(",")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n        ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(","!",["T_EMPTY","empty",146],"(",["T_VARIABLE","$stateSuffix",146],")",")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_stateKey",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getStateKey",147],"(",")",".",["T_VARIABLE","$stateSuffix",147],";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n\n        ",148],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],";",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Retrieve current category model\n     * If no category found in registry, the root will be taken\n     *\n     * @return Mage_Catalog_Model_Category\n     *\/",153],["T_WHITESPACE","\n    ",158],["T_PUBLIC","public",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","getCurrentCategory",159],"(",")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$category",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getData",161],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",161],")",";",["T_WHITESPACE","\n        ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_STRING","is_null",162],"(",["T_VARIABLE","$category",162],")",")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$category",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_STRING","Mage",163],["T_DOUBLE_COLON","::",163],["T_STRING","registry",163],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",163],")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setData",164],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$category",164],")",";",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE","\n            ",165],["T_ELSE","else",166],["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n                ",166],["T_VARIABLE","$category",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","Mage",167],["T_DOUBLE_COLON","::",167],["T_STRING","getModel",167],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",167],")",["T_OBJECT_OPERATOR","->",167],["T_STRING","load",167],"(",["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getCurrentStore",167],"(",")",["T_OBJECT_OPERATOR","->",167],["T_STRING","getRootCategoryId",167],"(",")",")",";",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","setData",168],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$category",168],")",";",["T_WHITESPACE","\n            ",168],"}",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE","\n\n        ",170],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$category",172],";",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n\n    ",173],["T_DOC_COMMENT","\/**\n     * Change current category object\n     *\n     * @param mixed $category\n     * @return Mage_Catalog_Model_Layer\n     *\/",175],["T_WHITESPACE","\n    ",180],["T_PUBLIC","public",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","setCurrentCategory",181],"(",["T_VARIABLE","$category",181],")",["T_WHITESPACE","\n    ",181],"{",["T_WHITESPACE","\n        ",182],["T_IF","if",183],["T_WHITESPACE"," ",183],"(",["T_STRING","is_numeric",183],"(",["T_VARIABLE","$category",183],")",")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$category",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","getModel",184],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",184],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","load",184],"(",["T_VARIABLE","$category",184],")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n        ",185],["T_IF","if",186],["T_WHITESPACE"," ",186],"(","!",["T_VARIABLE","$category",186],["T_WHITESPACE"," ",186],["T_INSTANCEOF","instanceof",186],["T_WHITESPACE"," ",186],["T_STRING","Mage_Catalog_Model_Category",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_STRING","Mage",187],["T_DOUBLE_COLON","::",187],["T_STRING","throwException",187],"(",["T_STRING","Mage",187],["T_DOUBLE_COLON","::",187],["T_STRING","helper",187],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",187],")",["T_OBJECT_OPERATOR","->",187],["T_STRING","__",187],"(",["T_CONSTANT_ENCAPSED_STRING","'Category must be an instance of Mage_Catalog_Model_Category.'",187],")",")",";",["T_WHITESPACE","\n        ",187],"}",["T_WHITESPACE","\n        ",188],["T_IF","if",189],["T_WHITESPACE"," ",189],"(","!",["T_VARIABLE","$category",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getId",189],"(",")",")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_STRING","Mage",190],["T_DOUBLE_COLON","::",190],["T_STRING","throwException",190],"(",["T_STRING","Mage",190],["T_DOUBLE_COLON","::",190],["T_STRING","helper",190],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",190],")",["T_OBJECT_OPERATOR","->",190],["T_STRING","__",190],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid category.'",190],")",")",";",["T_WHITESPACE","\n        ",190],"}",["T_WHITESPACE","\n\n        ",191],["T_IF","if",193],["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$category",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getId",193],"(",")",["T_WHITESPACE"," ",193],["T_IS_NOT_EQUAL","!=",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getCurrentCategory",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","getId",193],"(",")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","setData",194],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",194],",",["T_WHITESPACE"," ",194],["T_VARIABLE","$category",194],")",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n\n        ",195],["T_RETURN","return",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],";",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n\n    ",198],["T_DOC_COMMENT","\/**\n     * Retrieve current store model\n     *\n     * @return Mage_Core_Model_Store\n     *\/",200],["T_WHITESPACE","\n    ",204],["T_PUBLIC","public",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","getCurrentStore",205],"(",")",["T_WHITESPACE","\n    ",205],"{",["T_WHITESPACE","\n        ",206],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_STRING","Mage",207],["T_DOUBLE_COLON","::",207],["T_STRING","app",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","getStore",207],"(",")",";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n\n    ",208],["T_DOC_COMMENT","\/**\n     * Get collection of all filterable attributes for layer products set\n     *\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Attribute_Collection\n     *\/",210],["T_WHITESPACE","\n    ",214],["T_PUBLIC","public",215],["T_WHITESPACE"," ",215],["T_FUNCTION","function",215],["T_WHITESPACE"," ",215],["T_STRING","getFilterableAttributes",215],"(",")",["T_WHITESPACE","\n    ",215],"{",["T_WHITESPACE","\n",216],["T_COMMENT","\/\/        $entity = Mage::getSingleton('eav\/config')\n",217],["T_COMMENT","\/\/            ->getEntityType('catalog_product');\n",218],["T_WHITESPACE","\n        ",219],["T_VARIABLE","$setIds",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_getSetIds",220],"(",")",";",["T_WHITESPACE","\n        ",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(","!",["T_VARIABLE","$setIds",221],")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n            ",221],["T_RETURN","return",222],["T_WHITESPACE"," ",222],["T_ARRAY","array",222],"(",")",";",["T_WHITESPACE","\n        ",222],"}",["T_WHITESPACE","\n        ",223],["T_DOC_COMMENT","\/** @var $collection Mage_Catalog_Model_Resource_Product_Attribute_Collection *\/",224],["T_WHITESPACE","\n        ",224],["T_VARIABLE","$collection",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_STRING","Mage",225],["T_DOUBLE_COLON","::",225],["T_STRING","getResourceModel",225],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_collection'",225],")",";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$collection",226],["T_WHITESPACE","\n            ",226],["T_OBJECT_OPERATOR","->",227],["T_STRING","setItemObjectClass",227],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/resource_eav_attribute'",227],")",["T_WHITESPACE","\n            ",227],["T_OBJECT_OPERATOR","->",228],["T_STRING","setAttributeSetFilter",228],"(",["T_VARIABLE","$setIds",228],")",["T_WHITESPACE","\n            ",228],["T_OBJECT_OPERATOR","->",229],["T_STRING","addStoreLabel",229],"(",["T_STRING","Mage",229],["T_DOUBLE_COLON","::",229],["T_STRING","app",229],"(",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getStore",229],"(",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getId",229],"(",")",")",["T_WHITESPACE","\n            ",229],["T_OBJECT_OPERATOR","->",230],["T_STRING","setOrder",230],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",230],",",["T_WHITESPACE"," ",230],["T_CONSTANT_ENCAPSED_STRING","'ASC'",230],")",";",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$collection",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_prepareAttributeCollection",231],"(",["T_VARIABLE","$collection",231],")",";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$collection",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","load",232],"(",")",";",["T_WHITESPACE","\n\n        ",232],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$collection",234],";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Prepare attribute for use in layered navigation\n     *\n     * @param   Mage_Eav_Model_Entity_Attribute $attribute\n     * @return  Mage_Eav_Model_Entity_Attribute\n     *\/",237],["T_WHITESPACE","\n    ",242],["T_PROTECTED","protected",243],["T_WHITESPACE"," ",243],["T_FUNCTION","function",243],["T_WHITESPACE"," ",243],["T_STRING","_prepareAttribute",243],"(",["T_VARIABLE","$attribute",243],")",["T_WHITESPACE","\n    ",243],"{",["T_WHITESPACE","\n        ",244],["T_STRING","Mage",245],["T_DOUBLE_COLON","::",245],["T_STRING","getResourceSingleton",245],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",245],")",["T_OBJECT_OPERATOR","->",245],["T_STRING","getAttribute",245],"(",["T_VARIABLE","$attribute",245],")",";",["T_WHITESPACE","\n        ",245],["T_RETURN","return",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$attribute",246],";",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * Add filters to attribute collection\n     *\n     * @param   Mage_Catalog_Model_Resource_Eav_Mysql4_Attribute_Collection $collection\n     * @return  Mage_Catalog_Model_Resource_Eav_Mysql4_Attribute_Collection\n     *\/",249],["T_WHITESPACE","\n    ",254],["T_PROTECTED","protected",255],["T_WHITESPACE"," ",255],["T_FUNCTION","function",255],["T_WHITESPACE"," ",255],["T_STRING","_prepareAttributeCollection",255],"(",["T_VARIABLE","$collection",255],")",["T_WHITESPACE","\n    ",255],"{",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$collection",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","addIsFilterableFilter",257],"(",")",";",["T_WHITESPACE","\n        ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$collection",258],";",["T_WHITESPACE","\n    ",258],"}",["T_WHITESPACE","\n\n    ",259],["T_DOC_COMMENT","\/**\n     * Retrieve layer state object\n     *\n     * @return Mage_Catalog_Model_Layer_State\n     *\/",261],["T_WHITESPACE","\n    ",265],["T_PUBLIC","public",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","getState",266],"(",")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$state",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getData",268],"(",["T_CONSTANT_ENCAPSED_STRING","'state'",268],")",";",["T_WHITESPACE","\n        ",268],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_STRING","is_null",269],"(",["T_VARIABLE","$state",269],")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_STRING","Varien_Profiler",270],["T_DOUBLE_COLON","::",270],["T_STRING","start",270],"(",["T_METHOD_C","__METHOD__",270],")",";",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$state",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_STRING","Mage",271],["T_DOUBLE_COLON","::",271],["T_STRING","getModel",271],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/layer_state'",271],")",";",["T_WHITESPACE","\n            ",271],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","setData",272],"(",["T_CONSTANT_ENCAPSED_STRING","'state'",272],",",["T_WHITESPACE"," ",272],["T_VARIABLE","$state",272],")",";",["T_WHITESPACE","\n            ",272],["T_STRING","Varien_Profiler",273],["T_DOUBLE_COLON","::",273],["T_STRING","stop",273],"(",["T_METHOD_C","__METHOD__",273],")",";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE","\n\n        ",274],["T_RETURN","return",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$state",276],";",["T_WHITESPACE","\n    ",276],"}",["T_WHITESPACE","\n\n    ",277],["T_DOC_COMMENT","\/**\n     * Get attribute sets identifiers of current product set\n     *\n     * @return array\n     *\/",279],["T_WHITESPACE","\n    ",283],["T_PROTECTED","protected",284],["T_WHITESPACE"," ",284],["T_FUNCTION","function",284],["T_WHITESPACE"," ",284],["T_STRING","_getSetIds",284],"(",")",["T_WHITESPACE","\n    ",284],"{",["T_WHITESPACE","\n        ",285],["T_VARIABLE","$key",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getStateKey",286],"(",")",".",["T_CONSTANT_ENCAPSED_STRING","'_SET_IDS'",286],";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$setIds",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getAggregator",287],"(",")",["T_OBJECT_OPERATOR","->",287],["T_STRING","getCacheData",287],"(",["T_VARIABLE","$key",287],")",";",["T_WHITESPACE","\n\n        ",287],["T_IF","if",289],["T_WHITESPACE"," ",289],"(",["T_VARIABLE","$setIds",289],["T_WHITESPACE"," ",289],["T_IS_IDENTICAL","===",289],["T_WHITESPACE"," ",289],["T_STRING","null",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$setIds",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getProductCollection",290],"(",")",["T_OBJECT_OPERATOR","->",290],["T_STRING","getSetIds",290],"(",")",";",["T_WHITESPACE","\n            ",290],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getAggregator",291],"(",")",["T_OBJECT_OPERATOR","->",291],["T_STRING","saveCacheData",291],"(",["T_VARIABLE","$setIds",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$key",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getStateTags",291],"(",")",")",";",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n\n        ",292],["T_RETURN","return",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$setIds",294],";",["T_WHITESPACE","\n    ",294],"}",["T_WHITESPACE","\n",295],"}",["T_WHITESPACE","\n",296]]