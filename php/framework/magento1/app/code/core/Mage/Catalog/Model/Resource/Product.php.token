[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Product entity resource model\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Product to website linkage table\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_productWebsiteTable",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Product to category linkage table\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_productCategoryTable",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Initialize resource\n     *\/",51],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","__construct",54],"(",")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_STRING","parent",56],["T_DOUBLE_COLON","::",56],["T_STRING","__construct",56],"(",")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","setType",57],"(",["T_STRING","Mage_Catalog_Model_Product",57],["T_DOUBLE_COLON","::",57],["T_STRING","ENTITY",57],")",["T_WHITESPACE","\n             ",57],["T_OBJECT_OPERATOR","->",58],["T_STRING","setConnection",58],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_read'",58],",",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'catalog_write'",58],")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","_productWebsiteTable",59],["T_WHITESPACE","  ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getTable",59],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",59],")",";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_productCategoryTable",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getTable",60],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",60],")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Default product attributes\n     *\n     * @return array\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","_getDefaultAttributes",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_RETURN","return",70],["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'attribute_set_id'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'type_id'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'created_at'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",70],")",";",["T_WHITESPACE","\n    ",70],"}",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * Retrieve product website identifiers\n     *\n     * @param Mage_Catalog_Model_Product|int $product\n     * @return array\n     *\/",73],["T_WHITESPACE","\n    ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","getWebsiteIds",79],"(",["T_VARIABLE","$product",79],")",["T_WHITESPACE","\n    ",79],"{",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$adapter",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_getReadAdapter",81],"(",")",";",["T_WHITESPACE","\n\n        ",81],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$product",83],["T_WHITESPACE"," ",83],["T_INSTANCEOF","instanceof",83],["T_WHITESPACE"," ",83],["T_STRING","Mage_Catalog_Model_Product",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$productId",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$product",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getId",84],"(",")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE"," ",85],["T_ELSE","else",85],["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$productId",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$product",86],";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n\n        ",87],["T_VARIABLE","$select",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$adapter",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","select",89],"(",")",["T_WHITESPACE","\n            ",89],["T_OBJECT_OPERATOR","->",90],["T_STRING","from",90],"(",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_productWebsiteTable",90],",",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'website_id'",90],")",["T_WHITESPACE","\n            ",90],["T_OBJECT_OPERATOR","->",91],["T_STRING","where",91],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",91],",",["T_WHITESPACE"," ",91],["T_INT_CAST","(int)",91],["T_VARIABLE","$productId",91],")",";",["T_WHITESPACE","\n\n        ",91],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$adapter",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","fetchCol",93],"(",["T_VARIABLE","$select",93],")",";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Retrieve product website identifiers by product identifiers\n     *\n     * @param   array $productIds\n     * @return  array\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","getWebsiteIdsByProductIds",102],"(",["T_VARIABLE","$productIds",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$select",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_getWriteAdapter",104],"(",")",["T_OBJECT_OPERATOR","->",104],["T_STRING","select",104],"(",")",["T_WHITESPACE","\n            ",104],["T_OBJECT_OPERATOR","->",105],["T_STRING","from",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_productWebsiteTable",105],",",["T_WHITESPACE"," ",105],["T_ARRAY","array",105],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",105],",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'website_id'",105],")",")",["T_WHITESPACE","\n            ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","where",106],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$productIds",106],")",";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$productsWebsites",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",")",";",["T_WHITESPACE","\n        ",107],["T_FOREACH","foreach",108],["T_WHITESPACE"," ",108],"(",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_getWriteAdapter",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","fetchAll",108],"(",["T_VARIABLE","$select",108],")",["T_WHITESPACE"," ",108],["T_AS","as",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$productInfo",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$productId",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$productInfo",109],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",109],"]",";",["T_WHITESPACE","\n            ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(","!",["T_ISSET","isset",110],"(",["T_VARIABLE","$productsWebsites",110],"[",["T_VARIABLE","$productId",110],"]",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                ",110],["T_VARIABLE","$productsWebsites",111],"[",["T_VARIABLE","$productId",111],"]",["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_ARRAY","array",111],"(",")",";",["T_WHITESPACE","\n            ",111],"}",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$productsWebsites",113],"[",["T_VARIABLE","$productId",113],"]","[","]",["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$productInfo",113],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",113],"]",";",["T_WHITESPACE","\n\n        ",113],"}",["T_WHITESPACE","\n\n        ",115],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$productsWebsites",117],";",["T_WHITESPACE","\n    ",117],"}",["T_WHITESPACE","\n\n    ",118],["T_DOC_COMMENT","\/**\n     * Retrieve product category identifiers\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",120],["T_WHITESPACE","\n    ",125],["T_PUBLIC","public",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","getCategoryIds",126],"(",["T_VARIABLE","$product",126],")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$adapter",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_getReadAdapter",128],"(",")",";",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$select",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$adapter",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","select",130],"(",")",["T_WHITESPACE","\n            ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","from",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_productCategoryTable",131],",",["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'category_id'",131],")",["T_WHITESPACE","\n            ",131],["T_OBJECT_OPERATOR","->",132],["T_STRING","where",132],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",132],",",["T_WHITESPACE"," ",132],["T_INT_CAST","(int)",132],["T_VARIABLE","$product",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getId",132],"(",")",")",";",["T_WHITESPACE","\n\n        ",132],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$adapter",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","fetchCol",134],"(",["T_VARIABLE","$select",134],")",";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Get product identifier by sku\n     *\n     * @param string $sku\n     * @return int|false\n     *\/",137],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","getIdBySku",143],"(",["T_VARIABLE","$sku",143],")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$adapter",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_getReadAdapter",145],"(",")",";",["T_WHITESPACE","\n\n        ",145],["T_VARIABLE","$select",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$adapter",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","select",147],"(",")",["T_WHITESPACE","\n            ",147],["T_OBJECT_OPERATOR","->",148],["T_STRING","from",148],"(",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getEntityTable",148],"(",")",",",["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",148],")",["T_WHITESPACE","\n            ",148],["T_OBJECT_OPERATOR","->",149],["T_STRING","where",149],"(",["T_CONSTANT_ENCAPSED_STRING","'sku = :sku'",149],")",";",["T_WHITESPACE","\n\n        ",149],["T_VARIABLE","$bind",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","':sku'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_STRING_CAST","(string)",151],["T_VARIABLE","$sku",151],")",";",["T_WHITESPACE","\n\n        ",151],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$adapter",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","fetchOne",153],"(",["T_VARIABLE","$select",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$bind",153],")",";",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * Process product data before save\n     *\n     * @param Varien_Object $object\n     * @return Mage_Catalog_Model_Resource_Product\n     *\/",156],["T_WHITESPACE","\n    ",161],["T_PROTECTED","protected",162],["T_WHITESPACE"," ",162],["T_FUNCTION","function",162],["T_WHITESPACE"," ",162],["T_STRING","_beforeSave",162],"(",["T_STRING","Varien_Object",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$object",162],")",["T_WHITESPACE","\n    ",162],"{",["T_WHITESPACE","\n        ",163],["T_DOC_COMMENT","\/**\n         * Try detect product id by sku if id is not declared\n         *\/",164],["T_WHITESPACE","\n        ",166],["T_IF","if",167],["T_WHITESPACE"," ",167],"(","!",["T_VARIABLE","$object",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getId",167],"(",")",["T_WHITESPACE"," ",167],["T_BOOLEAN_AND","&&",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$object",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getSku",167],"(",")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$object",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","setId",168],"(",["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getIdBySku",168],"(",["T_VARIABLE","$object",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getSku",168],"(",")",")",")",";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n\n        ",169],["T_DOC_COMMENT","\/**\n         * Check if declared category ids in object data.\n         *\/",171],["T_WHITESPACE","\n        ",173],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_VARIABLE","$object",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","hasCategoryIds",174],"(",")",")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n            ",174],["T_VARIABLE","$categoryIds",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_STRING","Mage",175],["T_DOUBLE_COLON","::",175],["T_STRING","getResourceSingleton",175],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",175],")",["T_OBJECT_OPERATOR","->",175],["T_STRING","verifyIds",175],"(",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$object",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getCategoryIds",176],"(",")",["T_WHITESPACE","\n            ",176],")",";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$object",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","setCategoryIds",178],"(",["T_VARIABLE","$categoryIds",178],")",";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE","\n\n        ",179],["T_RETURN","return",181],["T_WHITESPACE"," ",181],["T_STRING","parent",181],["T_DOUBLE_COLON","::",181],["T_STRING","_beforeSave",181],"(",["T_VARIABLE","$object",181],")",";",["T_WHITESPACE","\n    ",181],"}",["T_WHITESPACE","\n\n    ",182],["T_DOC_COMMENT","\/**\n     * Save data related with product\n     *\n     * @param Varien_Object $product\n     * @return Mage_Catalog_Model_Resource_Product\n     *\/",184],["T_WHITESPACE","\n    ",189],["T_PROTECTED","protected",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","_afterSave",190],"(",["T_STRING","Varien_Object",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$product",190],")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_saveWebsiteIds",192],"(",["T_VARIABLE","$product",192],")",["T_WHITESPACE","\n            ",192],["T_OBJECT_OPERATOR","->",193],["T_STRING","_saveCategories",193],"(",["T_VARIABLE","$product",193],")",";",["T_WHITESPACE","\n\n        ",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_STRING","parent",195],["T_DOUBLE_COLON","::",195],["T_STRING","_afterSave",195],"(",["T_VARIABLE","$product",195],")",";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Save product website relations\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Catalog_Model_Resource_Product\n     *\/",198],["T_WHITESPACE","\n    ",203],["T_PROTECTED","protected",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","_saveWebsiteIds",204],"(",["T_VARIABLE","$product",204],")",["T_WHITESPACE","\n    ",204],"{",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$websiteIds",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$product",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getWebsiteIds",206],"(",")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$oldWebsiteIds",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_ARRAY","array",207],"(",")",";",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$product",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","setIsChangedWebsites",209],"(",["T_STRING","false",209],")",";",["T_WHITESPACE","\n\n        ",209],["T_VARIABLE","$adapter",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_getWriteAdapter",211],"(",")",";",["T_WHITESPACE","\n\n        ",211],["T_VARIABLE","$oldWebsiteIds",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getWebsiteIds",213],"(",["T_VARIABLE","$product",213],")",";",["T_WHITESPACE","\n\n        ",213],["T_VARIABLE","$insert",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_STRING","array_diff",215],"(",["T_VARIABLE","$websiteIds",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$oldWebsiteIds",215],")",";",["T_WHITESPACE","\n        ",215],["T_VARIABLE","$delete",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_STRING","array_diff",216],"(",["T_VARIABLE","$oldWebsiteIds",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$websiteIds",216],")",";",["T_WHITESPACE","\n\n        ",216],["T_IF","if",218],["T_WHITESPACE"," ",218],"(","!",["T_EMPTY","empty",218],"(",["T_VARIABLE","$insert",218],")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$data",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_ARRAY","array",219],"(",")",";",["T_WHITESPACE","\n            ",219],["T_FOREACH","foreach",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$insert",220],["T_WHITESPACE"," ",220],["T_AS","as",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$websiteId",220],")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n                ",220],["T_VARIABLE","$data",221],"[","]",["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_ARRAY","array",221],"(",["T_WHITESPACE","\n                    ",221],["T_CONSTANT_ENCAPSED_STRING","'product_id'",222],["T_WHITESPACE"," ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_INT_CAST","(int)",222],["T_VARIABLE","$product",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getId",222],"(",")",",",["T_WHITESPACE","\n                    ",222],["T_CONSTANT_ENCAPSED_STRING","'website_id'",223],["T_WHITESPACE"," ",223],["T_DOUBLE_ARROW","=>",223],["T_WHITESPACE"," ",223],["T_INT_CAST","(int)",223],["T_VARIABLE","$websiteId",223],["T_WHITESPACE","\n                ",223],")",";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$adapter",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","insertMultiple",226],"(",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_productWebsiteTable",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$data",226],")",";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE","\n\n        ",227],["T_IF","if",229],["T_WHITESPACE"," ",229],"(","!",["T_EMPTY","empty",229],"(",["T_VARIABLE","$delete",229],")",")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n            ",229],["T_FOREACH","foreach",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$delete",230],["T_WHITESPACE"," ",230],["T_AS","as",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$websiteId",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n                ",230],["T_VARIABLE","$condition",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_ARRAY","array",231],"(",["T_WHITESPACE","\n                    ",231],["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_INT_CAST","(int)",232],["T_VARIABLE","$product",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getId",232],"(",")",",",["T_WHITESPACE","\n                    ",232],["T_CONSTANT_ENCAPSED_STRING","'website_id = ?'",233],["T_WHITESPACE"," ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_INT_CAST","(int)",233],["T_VARIABLE","$websiteId",233],",",["T_WHITESPACE","\n                ",233],")",";",["T_WHITESPACE","\n\n                ",234],["T_VARIABLE","$adapter",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","delete",236],"(",["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_productWebsiteTable",236],",",["T_WHITESPACE"," ",236],["T_VARIABLE","$condition",236],")",";",["T_WHITESPACE","\n            ",236],"}",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n\n        ",238],["T_IF","if",240],["T_WHITESPACE"," ",240],"(","!",["T_EMPTY","empty",240],"(",["T_VARIABLE","$insert",240],")",["T_WHITESPACE"," ",240],["T_BOOLEAN_OR","||",240],["T_WHITESPACE"," ",240],"!",["T_EMPTY","empty",240],"(",["T_VARIABLE","$delete",240],")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$product",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setIsChangedWebsites",241],"(",["T_STRING","true",241],")",";",["T_WHITESPACE","\n        ",241],"}",["T_WHITESPACE","\n\n        ",242],["T_RETURN","return",244],["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],";",["T_WHITESPACE","\n    ",244],"}",["T_WHITESPACE","\n\n    ",245],["T_DOC_COMMENT","\/**\n     * Save product category relations\n     *\n     * @param Varien_Object $object\n     * @return Mage_Catalog_Model_Resource_Product\n     *\/",247],["T_WHITESPACE","\n    ",252],["T_PROTECTED","protected",253],["T_WHITESPACE"," ",253],["T_FUNCTION","function",253],["T_WHITESPACE"," ",253],["T_STRING","_saveCategories",253],"(",["T_STRING","Varien_Object",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$object",253],")",["T_WHITESPACE","\n    ",253],"{",["T_WHITESPACE","\n        ",254],["T_DOC_COMMENT","\/**\n         * If category ids data is not declared we haven't do manipulations\n         *\/",255],["T_WHITESPACE","\n        ",257],["T_IF","if",258],["T_WHITESPACE"," ",258],"(","!",["T_VARIABLE","$object",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","hasCategoryIds",258],"(",")",")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_RETURN","return",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],";",["T_WHITESPACE","\n        ",259],"}",["T_WHITESPACE","\n        ",260],["T_VARIABLE","$categoryIds",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$object",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getCategoryIds",261],"(",")",";",["T_WHITESPACE","\n        ",261],["T_VARIABLE","$oldCategoryIds",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getCategoryIds",262],"(",["T_VARIABLE","$object",262],")",";",["T_WHITESPACE","\n\n        ",262],["T_VARIABLE","$object",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","setIsChangedCategories",264],"(",["T_STRING","false",264],")",";",["T_WHITESPACE","\n\n        ",264],["T_VARIABLE","$insert",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_STRING","array_diff",266],"(",["T_VARIABLE","$categoryIds",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$oldCategoryIds",266],")",";",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$delete",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_STRING","array_diff",267],"(",["T_VARIABLE","$oldCategoryIds",267],",",["T_WHITESPACE"," ",267],["T_VARIABLE","$categoryIds",267],")",";",["T_WHITESPACE","\n\n        ",267],["T_VARIABLE","$write",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_getWriteAdapter",269],"(",")",";",["T_WHITESPACE","\n        ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(","!",["T_EMPTY","empty",270],"(",["T_VARIABLE","$insert",270],")",")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$data",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_ARRAY","array",271],"(",")",";",["T_WHITESPACE","\n            ",271],["T_FOREACH","foreach",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$insert",272],["T_WHITESPACE"," ",272],["T_AS","as",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$categoryId",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n                ",272],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_EMPTY","empty",273],"(",["T_VARIABLE","$categoryId",273],")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n                    ",273],["T_CONTINUE","continue",274],";",["T_WHITESPACE","\n                ",274],"}",["T_WHITESPACE","\n                ",275],["T_VARIABLE","$data",276],"[","]",["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_ARRAY","array",276],"(",["T_WHITESPACE","\n                    ",276],["T_CONSTANT_ENCAPSED_STRING","'category_id'",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_INT_CAST","(int)",277],["T_VARIABLE","$categoryId",277],",",["T_WHITESPACE","\n                    ",277],["T_CONSTANT_ENCAPSED_STRING","'product_id'",278],["T_WHITESPACE","  ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_INT_CAST","(int)",278],["T_VARIABLE","$object",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getId",278],"(",")",",",["T_WHITESPACE","\n                    ",278],["T_CONSTANT_ENCAPSED_STRING","'position'",279],["T_WHITESPACE","    ",279],["T_DOUBLE_ARROW","=>",279],["T_WHITESPACE"," ",279],["T_LNUMBER","1",279],["T_WHITESPACE","\n                ",279],")",";",["T_WHITESPACE","\n            ",280],"}",["T_WHITESPACE","\n            ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$data",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n                ",282],["T_VARIABLE","$write",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","insertMultiple",283],"(",["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_productCategoryTable",283],",",["T_WHITESPACE"," ",283],["T_VARIABLE","$data",283],")",";",["T_WHITESPACE","\n            ",283],"}",["T_WHITESPACE","\n        ",284],"}",["T_WHITESPACE","\n\n        ",285],["T_IF","if",287],["T_WHITESPACE"," ",287],"(","!",["T_EMPTY","empty",287],"(",["T_VARIABLE","$delete",287],")",")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n            ",287],["T_FOREACH","foreach",288],["T_WHITESPACE"," ",288],"(",["T_VARIABLE","$delete",288],["T_WHITESPACE"," ",288],["T_AS","as",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$categoryId",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n                ",288],["T_VARIABLE","$where",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_ARRAY","array",289],"(",["T_WHITESPACE","\n                    ",289],["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",290],["T_WHITESPACE","  ",290],["T_DOUBLE_ARROW","=>",290],["T_WHITESPACE"," ",290],["T_INT_CAST","(int)",290],["T_VARIABLE","$object",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getId",290],"(",")",",",["T_WHITESPACE","\n                    ",290],["T_CONSTANT_ENCAPSED_STRING","'category_id = ?'",291],["T_WHITESPACE"," ",291],["T_DOUBLE_ARROW","=>",291],["T_WHITESPACE"," ",291],["T_INT_CAST","(int)",291],["T_VARIABLE","$categoryId",291],",",["T_WHITESPACE","\n                ",291],")",";",["T_WHITESPACE","\n\n                ",292],["T_VARIABLE","$write",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","delete",294],"(",["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","_productCategoryTable",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$where",294],")",";",["T_WHITESPACE","\n            ",294],"}",["T_WHITESPACE","\n        ",295],"}",["T_WHITESPACE","\n\n        ",296],["T_IF","if",298],["T_WHITESPACE"," ",298],"(","!",["T_EMPTY","empty",298],"(",["T_VARIABLE","$insert",298],")",["T_WHITESPACE"," ",298],["T_BOOLEAN_OR","||",298],["T_WHITESPACE"," ",298],"!",["T_EMPTY","empty",298],"(",["T_VARIABLE","$delete",298],")",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n            ",298],["T_VARIABLE","$object",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","setAffectedCategoryIds",299],"(",["T_STRING","array_merge",299],"(",["T_VARIABLE","$insert",299],",",["T_WHITESPACE"," ",299],["T_VARIABLE","$delete",299],")",")",";",["T_WHITESPACE","\n            ",299],["T_VARIABLE","$object",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","setIsChangedCategories",300],"(",["T_STRING","true",300],")",";",["T_WHITESPACE","\n        ",300],"}",["T_WHITESPACE","\n\n        ",301],["T_RETURN","return",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],";",["T_WHITESPACE","\n    ",303],"}",["T_WHITESPACE","\n\n    ",304],["T_DOC_COMMENT","\/**\n     * Refresh Product Enabled Index\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Catalog_Model_Resource_Product\n     *\/",306],["T_WHITESPACE","\n    ",311],["T_PUBLIC","public",312],["T_WHITESPACE"," ",312],["T_FUNCTION","function",312],["T_WHITESPACE"," ",312],["T_STRING","refreshIndex",312],"(",["T_VARIABLE","$product",312],")",["T_WHITESPACE","\n    ",312],"{",["T_WHITESPACE","\n        ",313],["T_VARIABLE","$writeAdapter",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_getWriteAdapter",314],"(",")",";",["T_WHITESPACE","\n\n        ",314],["T_DOC_COMMENT","\/**\n         * Ids of all categories where product is assigned (not related with store)\n         *\/",316],["T_WHITESPACE","\n        ",318],["T_VARIABLE","$categoryIds",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_VARIABLE","$product",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getCategoryIds",319],"(",")",";",["T_WHITESPACE","\n\n        ",319],["T_DOC_COMMENT","\/**\n         * Clear previous index data related with product\n         *\/",321],["T_WHITESPACE","\n        ",323],["T_VARIABLE","$condition",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_ARRAY","array",324],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",324],["T_WHITESPACE"," ",324],["T_DOUBLE_ARROW","=>",324],["T_WHITESPACE"," ",324],["T_INT_CAST","(int)",324],["T_VARIABLE","$product",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","getId",324],"(",")",")",";",["T_WHITESPACE","\n        ",324],["T_VARIABLE","$writeAdapter",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","delete",325],"(",["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getTable",325],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",325],")",",",["T_WHITESPACE"," ",325],["T_VARIABLE","$condition",325],")",";",["T_WHITESPACE","\n\n        ",325],["T_DOC_COMMENT","\/** @var $categoryObject Mage_Catalog_Model_Resource_Category *\/",327],["T_WHITESPACE","\n        ",327],["T_VARIABLE","$categoryObject",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_STRING","Mage",328],["T_DOUBLE_COLON","::",328],["T_STRING","getResourceSingleton",328],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",328],")",";",["T_WHITESPACE","\n        ",328],["T_IF","if",329],["T_WHITESPACE"," ",329],"(","!",["T_EMPTY","empty",329],"(",["T_VARIABLE","$categoryIds",329],")",")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_VARIABLE","$categoriesSelect",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_VARIABLE","$writeAdapter",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","select",330],"(",")",["T_WHITESPACE","\n                ",330],["T_OBJECT_OPERATOR","->",331],["T_STRING","from",331],"(",["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getTable",331],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",331],")",")",["T_WHITESPACE","\n                ",331],["T_OBJECT_OPERATOR","->",332],["T_STRING","where",332],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN (?)'",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$categoryIds",332],")",";",["T_WHITESPACE","\n\n            ",332],["T_VARIABLE","$categoriesInfo",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$writeAdapter",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","fetchAll",334],"(",["T_VARIABLE","$categoriesSelect",334],")",";",["T_WHITESPACE","\n\n            ",334],["T_VARIABLE","$indexCategoryIds",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_ARRAY","array",336],"(",")",";",["T_WHITESPACE","\n            ",336],["T_FOREACH","foreach",337],["T_WHITESPACE"," ",337],"(",["T_VARIABLE","$categoriesInfo",337],["T_WHITESPACE"," ",337],["T_AS","as",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$categoryInfo",337],")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                ",337],["T_VARIABLE","$ids",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_STRING","explode",338],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",338],",",["T_WHITESPACE"," ",338],["T_VARIABLE","$categoryInfo",338],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",338],"]",")",";",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$ids",339],"[","]",["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$categoryInfo",339],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",339],"]",";",["T_WHITESPACE","\n                ",339],["T_VARIABLE","$indexCategoryIds",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_STRING","array_merge",340],"(",["T_VARIABLE","$indexCategoryIds",340],",",["T_WHITESPACE"," ",340],["T_VARIABLE","$ids",340],")",";",["T_WHITESPACE","\n            ",340],"}",["T_WHITESPACE","\n\n            ",341],["T_VARIABLE","$indexCategoryIds",343],["T_WHITESPACE","   ",343],"=",["T_WHITESPACE"," ",343],["T_STRING","array_unique",343],"(",["T_VARIABLE","$indexCategoryIds",343],")",";",["T_WHITESPACE","\n            ",343],["T_VARIABLE","$indexProductIds",344],["T_WHITESPACE","    ",344],"=",["T_WHITESPACE"," ",344],["T_ARRAY","array",344],"(",["T_VARIABLE","$product",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getId",344],"(",")",")",";",["T_WHITESPACE","\n\n           ",344],["T_VARIABLE","$categoryObject",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","refreshProductIndex",346],"(",["T_VARIABLE","$indexCategoryIds",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$indexProductIds",346],")",";",["T_WHITESPACE","\n        ",346],"}",["T_WHITESPACE"," ",347],["T_ELSE","else",347],["T_WHITESPACE"," ",347],"{",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$websites",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_VARIABLE","$product",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getWebsiteIds",348],"(",")",";",["T_WHITESPACE","\n\n            ",348],["T_IF","if",350],["T_WHITESPACE"," ",350],"(",["T_VARIABLE","$websites",350],")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                ",350],["T_VARIABLE","$storeIds",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_ARRAY","array",351],"(",")",";",["T_WHITESPACE","\n\n                ",351],["T_FOREACH","foreach",353],["T_WHITESPACE"," ",353],"(",["T_VARIABLE","$websites",353],["T_WHITESPACE"," ",353],["T_AS","as",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$websiteId",353],")",["T_WHITESPACE"," ",353],"{",["T_WHITESPACE","\n                    ",353],["T_VARIABLE","$website",354],["T_WHITESPACE","  ",354],"=",["T_WHITESPACE"," ",354],["T_STRING","Mage",354],["T_DOUBLE_COLON","::",354],["T_STRING","app",354],"(",")",["T_OBJECT_OPERATOR","->",354],["T_STRING","getWebsite",354],"(",["T_VARIABLE","$websiteId",354],")",";",["T_WHITESPACE","\n                    ",354],["T_VARIABLE","$storeIds",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_STRING","array_merge",355],"(",["T_VARIABLE","$storeIds",355],",",["T_WHITESPACE"," ",355],["T_VARIABLE","$website",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getStoreIds",355],"(",")",")",";",["T_WHITESPACE","\n                ",355],"}",["T_WHITESPACE","\n\n                ",356],["T_VARIABLE","$categoryObject",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","refreshProductIndex",358],"(",["T_ARRAY","array",358],"(",")",",",["T_WHITESPACE"," ",358],["T_ARRAY","array",358],"(",["T_VARIABLE","$product",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getId",358],"(",")",")",",",["T_WHITESPACE"," ",358],["T_VARIABLE","$storeIds",358],")",";",["T_WHITESPACE","\n            ",358],"}",["T_WHITESPACE","\n        ",359],"}",["T_WHITESPACE","\n\n        ",360],["T_DOC_COMMENT","\/**\n         * Refresh enabled products index (visibility state)\n         *\/",362],["T_WHITESPACE","\n        ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","refreshEnabledIndex",365],"(",["T_STRING","null",365],",",["T_WHITESPACE"," ",365],["T_VARIABLE","$product",365],")",";",["T_WHITESPACE","\n\n        ",365],["T_RETURN","return",367],["T_WHITESPACE"," ",367],["T_VARIABLE","$this",367],";",["T_WHITESPACE","\n    ",367],"}",["T_WHITESPACE","\n\n    ",368],["T_DOC_COMMENT","\/**\n     * Refresh index for visibility of enabled product in store\n     * if store parameter is null - index will refreshed for all stores\n     * if product parameter is null - idex will be refreshed for all products\n     *\n     * @param Mage_Core_Model_Store $store\n     * @param Mage_Catalog_Model_Product $product\n     * @throws Mage_Core_Exception\n     * @return Mage_Catalog_Model_Resource_Product\n     *\/",370],["T_WHITESPACE","\n    ",379],["T_PUBLIC","public",380],["T_WHITESPACE"," ",380],["T_FUNCTION","function",380],["T_WHITESPACE"," ",380],["T_STRING","refreshEnabledIndex",380],"(",["T_VARIABLE","$store",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_STRING","null",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$product",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_STRING","null",380],")",["T_WHITESPACE","\n    ",380],"{",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$statusAttribute",382],["T_WHITESPACE","        ",382],"=",["T_WHITESPACE"," ",382],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getAttribute",382],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",382],")",";",["T_WHITESPACE","\n        ",382],["T_VARIABLE","$visibilityAttribute",383],["T_WHITESPACE","    ",383],"=",["T_WHITESPACE"," ",383],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getAttribute",383],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",383],")",";",["T_WHITESPACE","\n        ",383],["T_VARIABLE","$statusAttributeId",384],["T_WHITESPACE","      ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$statusAttribute",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getId",384],"(",")",";",["T_WHITESPACE","\n        ",384],["T_VARIABLE","$visibilityAttributeId",385],["T_WHITESPACE","  ",385],"=",["T_WHITESPACE"," ",385],["T_VARIABLE","$visibilityAttribute",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","getId",385],"(",")",";",["T_WHITESPACE","\n        ",385],["T_VARIABLE","$statusTable",386],["T_WHITESPACE","            ",386],"=",["T_WHITESPACE"," ",386],["T_VARIABLE","$statusAttribute",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getBackend",386],"(",")",["T_OBJECT_OPERATOR","->",386],["T_STRING","getTable",386],"(",")",";",["T_WHITESPACE","\n        ",386],["T_VARIABLE","$visibilityTable",387],["T_WHITESPACE","        ",387],"=",["T_WHITESPACE"," ",387],["T_VARIABLE","$visibilityAttribute",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getBackend",387],"(",")",["T_OBJECT_OPERATOR","->",387],["T_STRING","getTable",387],"(",")",";",["T_WHITESPACE","\n\n        ",387],["T_VARIABLE","$adapter",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_getWriteAdapter",389],"(",")",";",["T_WHITESPACE","\n\n        ",389],["T_VARIABLE","$select",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_VARIABLE","$adapter",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","select",391],"(",")",";",["T_WHITESPACE","\n        ",391],["T_VARIABLE","$condition",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_ARRAY","array",392],"(",")",";",["T_WHITESPACE","\n\n        ",392],["T_VARIABLE","$indexTable",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getTable",394],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_enabled_index'",394],")",";",["T_WHITESPACE","\n        ",394],["T_IF","if",395],["T_WHITESPACE"," ",395],"(",["T_STRING","is_null",395],"(",["T_VARIABLE","$store",395],")",["T_WHITESPACE"," ",395],["T_BOOLEAN_AND","&&",395],["T_WHITESPACE"," ",395],["T_STRING","is_null",395],"(",["T_VARIABLE","$product",395],")",")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n            ",395],["T_STRING","Mage",396],["T_DOUBLE_COLON","::",396],["T_STRING","throwException",396],"(",["T_WHITESPACE","\n                ",396],["T_STRING","Mage",397],["T_DOUBLE_COLON","::",397],["T_STRING","helper",397],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",397],")",["T_OBJECT_OPERATOR","->",397],["T_STRING","__",397],"(",["T_CONSTANT_ENCAPSED_STRING","'To reindex the enabled product(s), the store or product must be specified'",397],")",["T_WHITESPACE","\n            ",397],")",";",["T_WHITESPACE","\n        ",398],"}",["T_WHITESPACE"," ",399],["T_ELSEIF","elseif",399],["T_WHITESPACE"," ",399],"(",["T_STRING","is_null",399],"(",["T_VARIABLE","$product",399],")",["T_WHITESPACE"," ",399],["T_BOOLEAN_OR","||",399],["T_WHITESPACE"," ",399],["T_STRING","is_array",399],"(",["T_VARIABLE","$product",399],")",")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n            ",399],["T_VARIABLE","$storeId",400],["T_WHITESPACE","    ",400],"=",["T_WHITESPACE"," ",400],["T_VARIABLE","$store",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getId",400],"(",")",";",["T_WHITESPACE","\n            ",400],["T_VARIABLE","$websiteId",401],["T_WHITESPACE","  ",401],"=",["T_WHITESPACE"," ",401],["T_VARIABLE","$store",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getWebsiteId",401],"(",")",";",["T_WHITESPACE","\n\n            ",401],["T_IF","if",403],["T_WHITESPACE"," ",403],"(",["T_STRING","is_array",403],"(",["T_VARIABLE","$product",403],")",["T_WHITESPACE"," ",403],["T_BOOLEAN_AND","&&",403],["T_WHITESPACE"," ",403],"!",["T_EMPTY","empty",403],"(",["T_VARIABLE","$product",403],")",")",["T_WHITESPACE"," ",403],"{",["T_WHITESPACE","\n                ",403],["T_VARIABLE","$condition",404],"[","]",["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_VARIABLE","$adapter",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","quoteInto",404],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",404],",",["T_WHITESPACE"," ",404],["T_VARIABLE","$product",404],")",";",["T_WHITESPACE","\n            ",404],"}",["T_WHITESPACE","\n\n            ",405],["T_VARIABLE","$condition",407],"[","]",["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$adapter",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","quoteInto",407],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",407],",",["T_WHITESPACE"," ",407],["T_VARIABLE","$storeId",407],")",";",["T_WHITESPACE","\n\n            ",407],["T_VARIABLE","$selectFields",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_ARRAY","array",409],"(",["T_WHITESPACE","\n                ",409],["T_CONSTANT_ENCAPSED_STRING","'t_v_default.entity_id'",410],",",["T_WHITESPACE","\n                ",410],["T_NEW","new",411],["T_WHITESPACE"," ",411],["T_STRING","Zend_Db_Expr",411],"(",["T_VARIABLE","$storeId",411],")",",",["T_WHITESPACE","\n                ",411],["T_VARIABLE","$adapter",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getCheckSql",412],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v.value_id > 0'",412],",",["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","'t_v.value'",412],",",["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","'t_v_default.value'",412],")",",",["T_WHITESPACE","\n            ",412],")",";",["T_WHITESPACE","\n\n            ",413],["T_VARIABLE","$select",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","joinInner",415],"(",["T_WHITESPACE","\n                ",415],["T_ARRAY","array",416],"(",["T_CONSTANT_ENCAPSED_STRING","'w'",416],["T_WHITESPACE"," ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getTable",416],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",416],")",")",",",["T_WHITESPACE","\n                ",416],["T_VARIABLE","$adapter",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","quoteInto",417],"(",["T_WHITESPACE","\n                    ",417],["T_CONSTANT_ENCAPSED_STRING","'w.product_id = t_v_default.entity_id AND w.website_id = ?'",418],",",["T_WHITESPACE"," ",418],["T_VARIABLE","$websiteId",418],["T_WHITESPACE","\n                ",418],")",",",["T_WHITESPACE","\n                ",419],["T_ARRAY","array",420],"(",")",["T_WHITESPACE","\n            ",420],")",";",["T_WHITESPACE","\n        ",421],"}",["T_WHITESPACE"," ",422],["T_ELSEIF","elseif",422],["T_WHITESPACE"," ",422],"(",["T_VARIABLE","$store",422],["T_WHITESPACE"," ",422],["T_IS_IDENTICAL","===",422],["T_WHITESPACE"," ",422],["T_STRING","null",422],")",["T_WHITESPACE"," ",422],"{",["T_WHITESPACE","\n            ",422],["T_FOREACH","foreach",423],["T_WHITESPACE"," ",423],"(",["T_VARIABLE","$product",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getStoreIds",423],"(",")",["T_WHITESPACE"," ",423],["T_AS","as",423],["T_WHITESPACE"," ",423],["T_VARIABLE","$storeId",423],")",["T_WHITESPACE"," ",423],"{",["T_WHITESPACE","\n                ",423],["T_VARIABLE","$store",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_STRING","Mage",424],["T_DOUBLE_COLON","::",424],["T_STRING","app",424],"(",")",["T_OBJECT_OPERATOR","->",424],["T_STRING","getStore",424],"(",["T_VARIABLE","$storeId",424],")",";",["T_WHITESPACE","\n                ",424],["T_VARIABLE","$this",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","refreshEnabledIndex",425],"(",["T_VARIABLE","$store",425],",",["T_WHITESPACE"," ",425],["T_VARIABLE","$product",425],")",";",["T_WHITESPACE","\n            ",425],"}",["T_WHITESPACE","\n            ",426],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$this",427],";",["T_WHITESPACE","\n        ",427],"}",["T_WHITESPACE"," ",428],["T_ELSE","else",428],["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n            ",428],["T_VARIABLE","$productId",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_STRING","is_numeric",429],"(",["T_VARIABLE","$product",429],")",["T_WHITESPACE"," ",429],"?",["T_WHITESPACE"," ",429],["T_VARIABLE","$product",429],["T_WHITESPACE"," ",429],":",["T_WHITESPACE"," ",429],["T_VARIABLE","$product",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getId",429],"(",")",";",["T_WHITESPACE","\n            ",429],["T_VARIABLE","$storeId",430],["T_WHITESPACE","   ",430],"=",["T_WHITESPACE"," ",430],["T_STRING","is_numeric",430],"(",["T_VARIABLE","$store",430],")",["T_WHITESPACE"," ",430],"?",["T_WHITESPACE"," ",430],["T_VARIABLE","$store",430],["T_WHITESPACE"," ",430],":",["T_WHITESPACE"," ",430],["T_VARIABLE","$store",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getId",430],"(",")",";",["T_WHITESPACE","\n\n            ",430],["T_VARIABLE","$condition",432],["T_WHITESPACE"," ",432],"=",["T_WHITESPACE"," ",432],["T_ARRAY","array",432],"(",["T_WHITESPACE","\n                ",432],["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",433],["T_WHITESPACE"," ",433],["T_DOUBLE_ARROW","=>",433],["T_WHITESPACE"," ",433],["T_INT_CAST","(int)",433],["T_VARIABLE","$productId",433],",",["T_WHITESPACE","\n                ",433],["T_CONSTANT_ENCAPSED_STRING","'store_id   = ?'",434],["T_WHITESPACE"," ",434],["T_DOUBLE_ARROW","=>",434],["T_WHITESPACE"," ",434],["T_INT_CAST","(int)",434],["T_VARIABLE","$storeId",434],",",["T_WHITESPACE","\n            ",434],")",";",["T_WHITESPACE","\n\n            ",435],["T_VARIABLE","$selectFields",437],["T_WHITESPACE"," ",437],"=",["T_WHITESPACE"," ",437],["T_ARRAY","array",437],"(",["T_WHITESPACE","\n                ",437],["T_NEW","new",438],["T_WHITESPACE"," ",438],["T_STRING","Zend_Db_Expr",438],"(",["T_VARIABLE","$productId",438],")",",",["T_WHITESPACE","\n                ",438],["T_NEW","new",439],["T_WHITESPACE"," ",439],["T_STRING","Zend_Db_Expr",439],"(",["T_VARIABLE","$storeId",439],")",",",["T_WHITESPACE","\n                ",439],["T_VARIABLE","$adapter",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getCheckSql",440],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v.value_id > 0'",440],",",["T_WHITESPACE"," ",440],["T_CONSTANT_ENCAPSED_STRING","'t_v.value'",440],",",["T_WHITESPACE"," ",440],["T_CONSTANT_ENCAPSED_STRING","'t_v_default.value'",440],")",["T_WHITESPACE","\n            ",440],")",";",["T_WHITESPACE","\n\n            ",441],["T_VARIABLE","$select",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","where",443],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v_default.entity_id = ?'",443],",",["T_WHITESPACE"," ",443],["T_VARIABLE","$productId",443],")",";",["T_WHITESPACE","\n        ",443],"}",["T_WHITESPACE","\n\n        ",444],["T_VARIABLE","$adapter",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","delete",446],"(",["T_VARIABLE","$indexTable",446],",",["T_WHITESPACE"," ",446],["T_VARIABLE","$condition",446],")",";",["T_WHITESPACE","\n\n        ",446],["T_VARIABLE","$select",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","from",448],"(",["T_ARRAY","array",448],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v_default'",448],["T_WHITESPACE"," ",448],["T_DOUBLE_ARROW","=>",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$visibilityTable",448],")",",",["T_WHITESPACE"," ",448],["T_VARIABLE","$selectFields",448],")",";",["T_WHITESPACE","\n\n        ",448],["T_VARIABLE","$visibilityTableJoinCond",450],["T_WHITESPACE"," ",450],"=",["T_WHITESPACE"," ",450],["T_ARRAY","array",450],"(",["T_WHITESPACE","\n            ",450],["T_CONSTANT_ENCAPSED_STRING","'t_v.entity_id = t_v_default.entity_id'",451],",",["T_WHITESPACE","\n            ",451],["T_VARIABLE","$adapter",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","quoteInto",452],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v.attribute_id = ?'",452],",",["T_WHITESPACE"," ",452],["T_VARIABLE","$visibilityAttributeId",452],")",",",["T_WHITESPACE","\n            ",452],["T_VARIABLE","$adapter",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","quoteInto",453],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v.store_id     = ?'",453],",",["T_WHITESPACE"," ",453],["T_VARIABLE","$storeId",453],")",",",["T_WHITESPACE","\n        ",453],")",";",["T_WHITESPACE","\n\n        ",454],["T_VARIABLE","$select",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","joinLeft",456],"(",["T_WHITESPACE","\n            ",456],["T_ARRAY","array",457],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v'",457],["T_WHITESPACE"," ",457],["T_DOUBLE_ARROW","=>",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$visibilityTable",457],")",",",["T_WHITESPACE","\n            ",457],["T_STRING","implode",458],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",458],",",["T_WHITESPACE"," ",458],["T_VARIABLE","$visibilityTableJoinCond",458],")",",",["T_WHITESPACE","\n            ",458],["T_ARRAY","array",459],"(",")",["T_WHITESPACE","\n        ",459],")",";",["T_WHITESPACE","\n\n        ",460],["T_VARIABLE","$defaultStatusJoinCond",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_ARRAY","array",462],"(",["T_WHITESPACE","\n            ",462],["T_CONSTANT_ENCAPSED_STRING","'t_s_default.entity_id = t_v_default.entity_id'",463],",",["T_WHITESPACE","\n            ",463],["T_CONSTANT_ENCAPSED_STRING","'t_s_default.store_id = 0'",464],",",["T_WHITESPACE","\n            ",464],["T_VARIABLE","$adapter",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","quoteInto",465],"(",["T_CONSTANT_ENCAPSED_STRING","'t_s_default.attribute_id = ?'",465],",",["T_WHITESPACE"," ",465],["T_VARIABLE","$statusAttributeId",465],")",",",["T_WHITESPACE","\n        ",465],")",";",["T_WHITESPACE","\n\n        ",466],["T_VARIABLE","$select",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","joinInner",468],"(",["T_WHITESPACE","\n            ",468],["T_ARRAY","array",469],"(",["T_CONSTANT_ENCAPSED_STRING","'t_s_default'",469],["T_WHITESPACE"," ",469],["T_DOUBLE_ARROW","=>",469],["T_WHITESPACE"," ",469],["T_VARIABLE","$statusTable",469],")",",",["T_WHITESPACE","\n            ",469],["T_STRING","implode",470],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",470],",",["T_WHITESPACE"," ",470],["T_VARIABLE","$defaultStatusJoinCond",470],")",",",["T_WHITESPACE","\n            ",470],["T_ARRAY","array",471],"(",")",["T_WHITESPACE","\n        ",471],")",";",["T_WHITESPACE","\n\n\n        ",472],["T_VARIABLE","$statusJoinCond",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_ARRAY","array",475],"(",["T_WHITESPACE","\n            ",475],["T_CONSTANT_ENCAPSED_STRING","'t_s.entity_id = t_v_default.entity_id'",476],",",["T_WHITESPACE","\n            ",476],["T_VARIABLE","$adapter",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","quoteInto",477],"(",["T_CONSTANT_ENCAPSED_STRING","'t_s.store_id     = ?'",477],",",["T_WHITESPACE"," ",477],["T_VARIABLE","$storeId",477],")",",",["T_WHITESPACE","\n            ",477],["T_VARIABLE","$adapter",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","quoteInto",478],"(",["T_CONSTANT_ENCAPSED_STRING","'t_s.attribute_id = ?'",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$statusAttributeId",478],")",",",["T_WHITESPACE","\n        ",478],")",";",["T_WHITESPACE","\n\n        ",479],["T_VARIABLE","$select",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","joinLeft",481],"(",["T_WHITESPACE","\n            ",481],["T_ARRAY","array",482],"(",["T_CONSTANT_ENCAPSED_STRING","'t_s'",482],["T_WHITESPACE"," ",482],["T_DOUBLE_ARROW","=>",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$statusTable",482],")",",",["T_WHITESPACE","\n            ",482],["T_STRING","implode",483],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",483],",",["T_WHITESPACE"," ",483],["T_VARIABLE","$statusJoinCond",483],")",",",["T_WHITESPACE","\n            ",483],["T_ARRAY","array",484],"(",")",["T_WHITESPACE","\n        ",484],")",";",["T_WHITESPACE","\n\n        ",485],["T_VARIABLE","$valueCondition",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_VARIABLE","$adapter",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getCheckSql",487],"(",["T_CONSTANT_ENCAPSED_STRING","'t_s.value_id > 0'",487],",",["T_WHITESPACE"," ",487],["T_CONSTANT_ENCAPSED_STRING","'t_s.value'",487],",",["T_WHITESPACE"," ",487],["T_CONSTANT_ENCAPSED_STRING","'t_s_default.value'",487],")",";",["T_WHITESPACE","\n\n        ",487],["T_VARIABLE","$select",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","where",489],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v_default.attribute_id = ?'",489],",",["T_WHITESPACE"," ",489],["T_VARIABLE","$visibilityAttributeId",489],")",["T_WHITESPACE","\n            ",489],["T_OBJECT_OPERATOR","->",490],["T_STRING","where",490],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v_default.store_id = ?'",490],",",["T_WHITESPACE"," ",490],["T_LNUMBER","0",490],")",["T_WHITESPACE","\n            ",490],["T_OBJECT_OPERATOR","->",491],["T_STRING","where",491],"(",["T_STRING","sprintf",491],"(",["T_CONSTANT_ENCAPSED_STRING","'%s = ?'",491],",",["T_WHITESPACE"," ",491],["T_VARIABLE","$valueCondition",491],")",",",["T_WHITESPACE"," ",491],["T_STRING","Mage_Catalog_Model_Product_Status",491],["T_DOUBLE_COLON","::",491],["T_STRING","STATUS_ENABLED",491],")",";",["T_WHITESPACE","\n\n        ",491],["T_IF","if",493],["T_WHITESPACE"," ",493],"(",["T_STRING","is_array",493],"(",["T_VARIABLE","$product",493],")",["T_WHITESPACE"," ",493],["T_BOOLEAN_AND","&&",493],["T_WHITESPACE"," ",493],"!",["T_EMPTY","empty",493],"(",["T_VARIABLE","$product",493],")",")",["T_WHITESPACE"," ",493],"{",["T_WHITESPACE","\n            ",493],["T_VARIABLE","$select",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","where",494],"(",["T_CONSTANT_ENCAPSED_STRING","'t_v_default.entity_id IN (?)'",494],",",["T_WHITESPACE"," ",494],["T_VARIABLE","$product",494],")",";",["T_WHITESPACE","\n        ",494],"}",["T_WHITESPACE","\n\n        ",495],["T_VARIABLE","$adapter",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","query",497],"(",["T_VARIABLE","$adapter",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","insertFromSelect",497],"(",["T_VARIABLE","$select",497],",",["T_WHITESPACE"," ",497],["T_VARIABLE","$indexTable",497],")",")",";",["T_WHITESPACE","\n\n\n        ",497],["T_RETURN","return",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$this",500],";",["T_WHITESPACE","\n    ",500],"}",["T_WHITESPACE","\n\n    ",501],["T_DOC_COMMENT","\/**\n     * Get collection of product categories\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Catalog_Model_Resource_Category_Collection\n     *\/",503],["T_WHITESPACE","\n    ",508],["T_PUBLIC","public",509],["T_WHITESPACE"," ",509],["T_FUNCTION","function",509],["T_WHITESPACE"," ",509],["T_STRING","getCategoryCollection",509],"(",["T_VARIABLE","$product",509],")",["T_WHITESPACE","\n    ",509],"{",["T_WHITESPACE","\n        ",510],["T_VARIABLE","$collection",511],["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_STRING","Mage",511],["T_DOUBLE_COLON","::",511],["T_STRING","getResourceModel",511],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_collection'",511],")",["T_WHITESPACE","\n            ",511],["T_OBJECT_OPERATOR","->",512],["T_STRING","joinField",512],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",512],",",["T_WHITESPACE","\n                ",512],["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",513],",",["T_WHITESPACE","\n                ",513],["T_CONSTANT_ENCAPSED_STRING","'product_id'",514],",",["T_WHITESPACE","\n                ",514],["T_CONSTANT_ENCAPSED_STRING","'category_id = entity_id'",515],",",["T_WHITESPACE","\n                ",515],["T_STRING","null",516],")",["T_WHITESPACE","\n            ",516],["T_OBJECT_OPERATOR","->",517],["T_STRING","addFieldToFilter",517],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",517],",",["T_WHITESPACE"," ",517],["T_INT_CAST","(int)",517],["T_VARIABLE","$product",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","getId",517],"(",")",")",";",["T_WHITESPACE","\n        ",517],["T_RETURN","return",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$collection",518],";",["T_WHITESPACE","\n    ",518],"}",["T_WHITESPACE","\n\n    ",519],["T_DOC_COMMENT","\/**\n     * Retrieve category ids where product is available\n     *\n     * @param Mage_Catalog_Model_Product $object\n     * @return array\n     *\/",521],["T_WHITESPACE","\n    ",526],["T_PUBLIC","public",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","getAvailableInCategories",527],"(",["T_VARIABLE","$object",527],")",["T_WHITESPACE","\n    ",527],"{",["T_WHITESPACE","\n        ",528],["T_COMMENT","\/\/ is_parent=1 ensures that we'll get only category IDs those are direct parents of the product, instead of\n",529],["T_WHITESPACE","        ",530],["T_COMMENT","\/\/ fetching all parent IDs, including those are higher on the tree\n",530],["T_WHITESPACE","        ",531],["T_VARIABLE","$select",531],["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","_getReadAdapter",531],"(",")",["T_OBJECT_OPERATOR","->",531],["T_STRING","select",531],"(",")",["T_OBJECT_OPERATOR","->",531],["T_STRING","distinct",531],"(",")",["T_WHITESPACE","\n            ",531],["T_OBJECT_OPERATOR","->",532],["T_STRING","from",532],"(",["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","getTable",532],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",532],")",",",["T_WHITESPACE"," ",532],["T_ARRAY","array",532],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",532],")",")",["T_WHITESPACE","\n            ",532],["T_OBJECT_OPERATOR","->",533],["T_STRING","where",533],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ? AND is_parent = 1'",533],",",["T_WHITESPACE"," ",533],["T_INT_CAST","(int)",533],["T_VARIABLE","$object",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getEntityId",533],"(",")",")",";",["T_WHITESPACE","\n\n        ",533],["T_RETURN","return",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","_getReadAdapter",535],"(",")",["T_OBJECT_OPERATOR","->",535],["T_STRING","fetchCol",535],"(",["T_VARIABLE","$select",535],")",";",["T_WHITESPACE","\n    ",535],"}",["T_WHITESPACE","\n\n    ",536],["T_DOC_COMMENT","\/**\n     * Get default attribute source model\n     *\n     * @return string\n     *\/",538],["T_WHITESPACE","\n    ",542],["T_PUBLIC","public",543],["T_WHITESPACE"," ",543],["T_FUNCTION","function",543],["T_WHITESPACE"," ",543],["T_STRING","getDefaultAttributeSourceModel",543],"(",")",["T_WHITESPACE","\n    ",543],"{",["T_WHITESPACE","\n        ",544],["T_RETURN","return",545],["T_WHITESPACE"," ",545],["T_CONSTANT_ENCAPSED_STRING","'eav\/entity_attribute_source_table'",545],";",["T_WHITESPACE","\n    ",545],"}",["T_WHITESPACE","\n\n    ",546],["T_DOC_COMMENT","\/**\n     * Check availability display product in category\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param int $categoryId\n     * @return string\n     *\/",548],["T_WHITESPACE","\n    ",554],["T_PUBLIC","public",555],["T_WHITESPACE"," ",555],["T_FUNCTION","function",555],["T_WHITESPACE"," ",555],["T_STRING","canBeShowInCategory",555],"(",["T_VARIABLE","$product",555],",",["T_WHITESPACE"," ",555],["T_VARIABLE","$categoryId",555],")",["T_WHITESPACE","\n    ",555],"{",["T_WHITESPACE","\n        ",556],["T_VARIABLE","$select",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_getReadAdapter",557],"(",")",["T_OBJECT_OPERATOR","->",557],["T_STRING","select",557],"(",")",["T_WHITESPACE","\n            ",557],["T_OBJECT_OPERATOR","->",558],["T_STRING","from",558],"(",["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getTable",558],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",558],")",",",["T_WHITESPACE"," ",558],["T_CONSTANT_ENCAPSED_STRING","'product_id'",558],")",["T_WHITESPACE","\n            ",558],["T_OBJECT_OPERATOR","->",559],["T_STRING","where",559],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",559],",",["T_WHITESPACE"," ",559],["T_INT_CAST","(int)",559],["T_VARIABLE","$product",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","getId",559],"(",")",")",["T_WHITESPACE","\n            ",559],["T_OBJECT_OPERATOR","->",560],["T_STRING","where",560],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id = ?'",560],",",["T_WHITESPACE"," ",560],["T_INT_CAST","(int)",560],["T_VARIABLE","$categoryId",560],")",";",["T_WHITESPACE","\n\n        ",560],["T_RETURN","return",562],["T_WHITESPACE"," ",562],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","_getReadAdapter",562],"(",")",["T_OBJECT_OPERATOR","->",562],["T_STRING","fetchOne",562],"(",["T_VARIABLE","$select",562],")",";",["T_WHITESPACE","\n    ",562],"}",["T_WHITESPACE","\n\n    ",563],["T_DOC_COMMENT","\/**\n     * Duplicate product store values\n     *\n     * @param int $oldId\n     * @param int $newId\n     * @return Mage_Catalog_Model_Resource_Product\n     *\/",565],["T_WHITESPACE","\n    ",571],["T_PUBLIC","public",572],["T_WHITESPACE"," ",572],["T_FUNCTION","function",572],["T_WHITESPACE"," ",572],["T_STRING","duplicate",572],"(",["T_VARIABLE","$oldId",572],",",["T_WHITESPACE"," ",572],["T_VARIABLE","$newId",572],")",["T_WHITESPACE","\n    ",572],"{",["T_WHITESPACE","\n        ",573],["T_VARIABLE","$adapter",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","_getWriteAdapter",574],"(",")",";",["T_WHITESPACE","\n        ",574],["T_VARIABLE","$eavTables",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_ARRAY","array",575],"(",["T_CONSTANT_ENCAPSED_STRING","'datetime'",575],",",["T_WHITESPACE"," ",575],["T_CONSTANT_ENCAPSED_STRING","'decimal'",575],",",["T_WHITESPACE"," ",575],["T_CONSTANT_ENCAPSED_STRING","'int'",575],",",["T_WHITESPACE"," ",575],["T_CONSTANT_ENCAPSED_STRING","'text'",575],",",["T_WHITESPACE"," ",575],["T_CONSTANT_ENCAPSED_STRING","'varchar'",575],")",";",["T_WHITESPACE","\n\n        ",575],["T_VARIABLE","$adapter",577],["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_VARIABLE","$this",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","_getWriteAdapter",577],"(",")",";",["T_WHITESPACE","\n\n        ",577],["T_COMMENT","\/\/ duplicate EAV store values\n",579],["T_WHITESPACE","        ",580],["T_FOREACH","foreach",580],["T_WHITESPACE"," ",580],"(",["T_VARIABLE","$eavTables",580],["T_WHITESPACE"," ",580],["T_AS","as",580],["T_WHITESPACE"," ",580],["T_VARIABLE","$suffix",580],")",["T_WHITESPACE"," ",580],"{",["T_WHITESPACE","\n            ",580],["T_VARIABLE","$tableName",581],["T_WHITESPACE"," ",581],"=",["T_WHITESPACE"," ",581],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","getTable",581],"(",["T_ARRAY","array",581],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",581],",",["T_WHITESPACE"," ",581],["T_VARIABLE","$suffix",581],")",")",";",["T_WHITESPACE","\n\n            ",581],["T_VARIABLE","$select",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$adapter",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","select",583],"(",")",["T_WHITESPACE","\n                ",583],["T_OBJECT_OPERATOR","->",584],["T_STRING","from",584],"(",["T_VARIABLE","$tableName",584],",",["T_WHITESPACE"," ",584],["T_ARRAY","array",584],"(",["T_WHITESPACE","\n                    ",584],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",585],",",["T_WHITESPACE","\n                    ",585],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",586],",",["T_WHITESPACE","\n                    ",586],["T_CONSTANT_ENCAPSED_STRING","'store_id'",587],",",["T_WHITESPACE","\n                    ",587],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",588],["T_WHITESPACE"," ",588],["T_DOUBLE_ARROW","=>",588],["T_WHITESPACE"," ",588],["T_NEW","new",588],["T_WHITESPACE"," ",588],["T_STRING","Zend_Db_Expr",588],"(",["T_VARIABLE","$adapter",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","quote",588],"(",["T_VARIABLE","$newId",588],")",")",",",["T_WHITESPACE","\n                    ",588],["T_CONSTANT_ENCAPSED_STRING","'value'",589],["T_WHITESPACE","\n                ",589],")",")",["T_WHITESPACE","\n                ",590],["T_OBJECT_OPERATOR","->",591],["T_STRING","where",591],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",591],",",["T_WHITESPACE"," ",591],["T_VARIABLE","$oldId",591],")",["T_WHITESPACE","\n                ",591],["T_OBJECT_OPERATOR","->",592],["T_STRING","where",592],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id > ?'",592],",",["T_WHITESPACE"," ",592],["T_LNUMBER","0",592],")",";",["T_WHITESPACE","\n\n            ",592],["T_VARIABLE","$adapter",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","query",594],"(",["T_VARIABLE","$adapter",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","insertFromSelect",594],"(",["T_WHITESPACE","\n                ",594],["T_VARIABLE","$select",595],",",["T_WHITESPACE","\n                ",595],["T_VARIABLE","$tableName",596],",",["T_WHITESPACE","\n                ",596],["T_ARRAY","array",597],"(",["T_WHITESPACE","\n                    ",597],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",598],",",["T_WHITESPACE","\n                    ",598],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",599],",",["T_WHITESPACE","\n                    ",599],["T_CONSTANT_ENCAPSED_STRING","'store_id'",600],",",["T_WHITESPACE","\n                    ",600],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",601],",",["T_WHITESPACE","\n                    ",601],["T_CONSTANT_ENCAPSED_STRING","'value'",602],["T_WHITESPACE","\n                ",602],")",",",["T_WHITESPACE","\n                ",603],["T_STRING","Varien_Db_Adapter_Interface",604],["T_DOUBLE_COLON","::",604],["T_STRING","INSERT_ON_DUPLICATE",604],["T_WHITESPACE","\n            ",604],")",")",";",["T_WHITESPACE","\n        ",605],"}",["T_WHITESPACE","\n\n        ",606],["T_COMMENT","\/\/ set status as disabled\n",608],["T_WHITESPACE","        ",609],["T_VARIABLE","$statusAttribute",609],["T_WHITESPACE","      ",609],"=",["T_WHITESPACE"," ",609],["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","getAttribute",609],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",609],")",";",["T_WHITESPACE","\n        ",609],["T_VARIABLE","$statusAttributeId",610],["T_WHITESPACE","    ",610],"=",["T_WHITESPACE"," ",610],["T_VARIABLE","$statusAttribute",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getAttributeId",610],"(",")",";",["T_WHITESPACE","\n        ",610],["T_VARIABLE","$statusAttributeTable",611],["T_WHITESPACE"," ",611],"=",["T_WHITESPACE"," ",611],["T_VARIABLE","$statusAttribute",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","getBackend",611],"(",")",["T_OBJECT_OPERATOR","->",611],["T_STRING","getTable",611],"(",")",";",["T_WHITESPACE","\n        ",611],["T_VARIABLE","$updateCond",612],"[","]",["T_WHITESPACE","         ",612],"=",["T_WHITESPACE"," ",612],["T_CONSTANT_ENCAPSED_STRING","'store_id > 0'",612],";",["T_WHITESPACE","\n        ",612],["T_VARIABLE","$updateCond",613],"[","]",["T_WHITESPACE","         ",613],"=",["T_WHITESPACE"," ",613],["T_VARIABLE","$adapter",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","quoteInto",613],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",613],",",["T_WHITESPACE"," ",613],["T_VARIABLE","$newId",613],")",";",["T_WHITESPACE","\n        ",613],["T_VARIABLE","$updateCond",614],"[","]",["T_WHITESPACE","         ",614],"=",["T_WHITESPACE"," ",614],["T_VARIABLE","$adapter",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","quoteInto",614],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id = ?'",614],",",["T_WHITESPACE"," ",614],["T_VARIABLE","$statusAttributeId",614],")",";",["T_WHITESPACE","\n        ",614],["T_VARIABLE","$adapter",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","update",615],"(",["T_WHITESPACE","\n            ",615],["T_VARIABLE","$statusAttributeTable",616],",",["T_WHITESPACE","\n            ",616],["T_ARRAY","array",617],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",617],["T_WHITESPACE"," ",617],["T_DOUBLE_ARROW","=>",617],["T_WHITESPACE"," ",617],["T_STRING","Mage_Catalog_Model_Product_Status",617],["T_DOUBLE_COLON","::",617],["T_STRING","STATUS_DISABLED",617],")",",",["T_WHITESPACE","\n            ",617],["T_VARIABLE","$updateCond",618],["T_WHITESPACE","\n        ",618],")",";",["T_WHITESPACE","\n\n        ",619],["T_RETURN","return",621],["T_WHITESPACE"," ",621],["T_VARIABLE","$this",621],";",["T_WHITESPACE","\n    ",621],"}",["T_WHITESPACE","\n\n    ",622],["T_DOC_COMMENT","\/**\n     * Get SKU through product identifiers\n     *\n     * @param  array $productIds\n     * @return array\n     *\/",624],["T_WHITESPACE","\n    ",629],["T_PUBLIC","public",630],["T_WHITESPACE"," ",630],["T_FUNCTION","function",630],["T_WHITESPACE"," ",630],["T_STRING","getProductsSku",630],"(",["T_ARRAY","array",630],["T_WHITESPACE"," ",630],["T_VARIABLE","$productIds",630],")",["T_WHITESPACE","\n    ",630],"{",["T_WHITESPACE","\n        ",631],["T_VARIABLE","$select",632],["T_WHITESPACE"," ",632],"=",["T_WHITESPACE"," ",632],["T_VARIABLE","$this",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","_getReadAdapter",632],"(",")",["T_OBJECT_OPERATOR","->",632],["T_STRING","select",632],"(",")",["T_WHITESPACE","\n            ",632],["T_OBJECT_OPERATOR","->",633],["T_STRING","from",633],"(",["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","getTable",633],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",633],")",",",["T_WHITESPACE"," ",633],["T_ARRAY","array",633],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",633],",",["T_WHITESPACE"," ",633],["T_CONSTANT_ENCAPSED_STRING","'sku'",633],")",")",["T_WHITESPACE","\n            ",633],["T_OBJECT_OPERATOR","->",634],["T_STRING","where",634],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN (?)'",634],",",["T_WHITESPACE"," ",634],["T_VARIABLE","$productIds",634],")",";",["T_WHITESPACE","\n        ",634],["T_RETURN","return",635],["T_WHITESPACE"," ",635],["T_VARIABLE","$this",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","_getReadAdapter",635],"(",")",["T_OBJECT_OPERATOR","->",635],["T_STRING","fetchAll",635],"(",["T_VARIABLE","$select",635],")",";",["T_WHITESPACE","\n    ",635],"}",["T_WHITESPACE","\n\n    ",636],["T_DOC_COMMENT","\/**\n     * @deprecated after 1.4.2.0\n     * @param  $object Mage_Catalog_Model_Product\n     * @return array\n     *\/",638],["T_WHITESPACE","\n    ",642],["T_PUBLIC","public",643],["T_WHITESPACE"," ",643],["T_FUNCTION","function",643],["T_WHITESPACE"," ",643],["T_STRING","getParentProductIds",643],"(",["T_VARIABLE","$object",643],")",["T_WHITESPACE","\n    ",643],"{",["T_WHITESPACE","\n        ",644],["T_RETURN","return",645],["T_WHITESPACE"," ",645],["T_ARRAY","array",645],"(",")",";",["T_WHITESPACE","\n    ",645],"}",["T_WHITESPACE","\n\n    ",646],["T_DOC_COMMENT","\/**\n     * Retrieve product entities info\n     *\n     * @param  array|string|null $columns\n     * @return array\n     *\/",648],["T_WHITESPACE","\n    ",653],["T_PUBLIC","public",654],["T_WHITESPACE"," ",654],["T_FUNCTION","function",654],["T_WHITESPACE"," ",654],["T_STRING","getProductEntitiesInfo",654],"(",["T_VARIABLE","$columns",654],["T_WHITESPACE"," ",654],"=",["T_WHITESPACE"," ",654],["T_STRING","null",654],")",["T_WHITESPACE","\n    ",654],"{",["T_WHITESPACE","\n        ",655],["T_IF","if",656],["T_WHITESPACE"," ",656],"(","!",["T_EMPTY","empty",656],"(",["T_VARIABLE","$columns",656],")",["T_WHITESPACE"," ",656],["T_BOOLEAN_AND","&&",656],["T_WHITESPACE"," ",656],["T_STRING","is_string",656],"(",["T_VARIABLE","$columns",656],")",")",["T_WHITESPACE"," ",656],"{",["T_WHITESPACE","\n            ",656],["T_VARIABLE","$columns",657],["T_WHITESPACE"," ",657],"=",["T_WHITESPACE"," ",657],["T_ARRAY","array",657],"(",["T_VARIABLE","$columns",657],")",";",["T_WHITESPACE","\n        ",657],"}",["T_WHITESPACE","\n        ",658],["T_IF","if",659],["T_WHITESPACE"," ",659],"(",["T_EMPTY","empty",659],"(",["T_VARIABLE","$columns",659],")",["T_WHITESPACE"," ",659],["T_BOOLEAN_OR","||",659],["T_WHITESPACE"," ",659],"!",["T_STRING","is_array",659],"(",["T_VARIABLE","$columns",659],")",")",["T_WHITESPACE"," ",659],"{",["T_WHITESPACE","\n            ",659],["T_VARIABLE","$columns",660],["T_WHITESPACE"," ",660],"=",["T_WHITESPACE"," ",660],["T_VARIABLE","$this",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","_getDefaultAttributes",660],"(",")",";",["T_WHITESPACE","\n        ",660],"}",["T_WHITESPACE","\n\n        ",661],["T_VARIABLE","$adapter",663],["T_WHITESPACE"," ",663],"=",["T_WHITESPACE"," ",663],["T_VARIABLE","$this",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","_getReadAdapter",663],"(",")",";",["T_WHITESPACE","\n        ",663],["T_VARIABLE","$select",664],["T_WHITESPACE"," ",664],"=",["T_WHITESPACE"," ",664],["T_VARIABLE","$adapter",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","select",664],"(",")",["T_WHITESPACE","\n            ",664],["T_OBJECT_OPERATOR","->",665],["T_STRING","from",665],"(",["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","getTable",665],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",665],")",",",["T_WHITESPACE"," ",665],["T_VARIABLE","$columns",665],")",";",["T_WHITESPACE","\n\n        ",665],["T_RETURN","return",667],["T_WHITESPACE"," ",667],["T_VARIABLE","$adapter",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","fetchAll",667],"(",["T_VARIABLE","$select",667],")",";",["T_WHITESPACE","\n    ",667],"}",["T_WHITESPACE","\n\n    ",668],["T_DOC_COMMENT","\/**\n     * Return assigned images for specific stores\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param int|array $storeIds\n     * @return array\n     *\n     *\/",670],["T_WHITESPACE","\n    ",677],["T_PUBLIC","public",678],["T_WHITESPACE"," ",678],["T_FUNCTION","function",678],["T_WHITESPACE"," ",678],["T_STRING","getAssignedImages",678],"(",["T_VARIABLE","$product",678],",",["T_WHITESPACE"," ",678],["T_VARIABLE","$storeIds",678],")",["T_WHITESPACE","\n    ",678],"{",["T_WHITESPACE","\n        ",679],["T_IF","if",680],["T_WHITESPACE"," ",680],"(","!",["T_STRING","is_array",680],"(",["T_VARIABLE","$storeIds",680],")",")",["T_WHITESPACE"," ",680],"{",["T_WHITESPACE","\n            ",680],["T_VARIABLE","$storeIds",681],["T_WHITESPACE"," ",681],"=",["T_WHITESPACE"," ",681],["T_ARRAY","array",681],"(",["T_VARIABLE","$storeIds",681],")",";",["T_WHITESPACE","\n        ",681],"}",["T_WHITESPACE","\n\n        ",682],["T_VARIABLE","$mainTable",684],["T_WHITESPACE"," ",684],"=",["T_WHITESPACE"," ",684],["T_VARIABLE","$product",684],["T_OBJECT_OPERATOR","->",684],["T_STRING","getResource",684],"(",")",["T_OBJECT_OPERATOR","->",684],["T_STRING","getAttribute",684],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",684],")",["T_WHITESPACE","\n            ",684],["T_OBJECT_OPERATOR","->",685],["T_STRING","getBackend",685],"(",")",["T_WHITESPACE","\n            ",685],["T_OBJECT_OPERATOR","->",686],["T_STRING","getTable",686],"(",")",";",["T_WHITESPACE","\n        ",686],["T_VARIABLE","$read",687],["T_WHITESPACE","      ",687],"=",["T_WHITESPACE"," ",687],["T_VARIABLE","$this",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","_getReadAdapter",687],"(",")",";",["T_WHITESPACE","\n        ",687],["T_VARIABLE","$select",688],["T_WHITESPACE","    ",688],"=",["T_WHITESPACE"," ",688],["T_VARIABLE","$read",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","select",688],"(",")",["T_WHITESPACE","\n            ",688],["T_OBJECT_OPERATOR","->",689],["T_STRING","from",689],"(",["T_WHITESPACE","\n                ",689],["T_ARRAY","array",690],"(",["T_CONSTANT_ENCAPSED_STRING","'images'",690],["T_WHITESPACE"," ",690],["T_DOUBLE_ARROW","=>",690],["T_WHITESPACE"," ",690],["T_VARIABLE","$mainTable",690],")",",",["T_WHITESPACE","\n                ",690],["T_ARRAY","array",691],"(",["T_CONSTANT_ENCAPSED_STRING","'value as filepath'",691],",",["T_WHITESPACE"," ",691],["T_CONSTANT_ENCAPSED_STRING","'store_id'",691],")",["T_WHITESPACE","\n            ",691],")",["T_WHITESPACE","\n            ",692],["T_OBJECT_OPERATOR","->",693],["T_STRING","joinLeft",693],"(",["T_WHITESPACE","\n                ",693],["T_ARRAY","array",694],"(",["T_CONSTANT_ENCAPSED_STRING","'attr'",694],["T_WHITESPACE"," ",694],["T_DOUBLE_ARROW","=>",694],["T_WHITESPACE"," ",694],["T_VARIABLE","$this",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","getTable",694],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/attribute'",694],")",")",",",["T_WHITESPACE","\n                ",694],["T_CONSTANT_ENCAPSED_STRING","'images.attribute_id = attr.attribute_id'",695],",",["T_WHITESPACE","\n                ",695],["T_ARRAY","array",696],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_code'",696],")",["T_WHITESPACE","\n            ",696],")",["T_WHITESPACE","\n            ",697],["T_OBJECT_OPERATOR","->",698],["T_STRING","where",698],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = ?'",698],",",["T_WHITESPACE"," ",698],["T_VARIABLE","$product",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","getId",698],"(",")",")",["T_WHITESPACE","\n            ",698],["T_OBJECT_OPERATOR","->",699],["T_STRING","where",699],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id IN (?)'",699],",",["T_WHITESPACE"," ",699],["T_VARIABLE","$storeIds",699],")",["T_WHITESPACE","\n            ",699],["T_OBJECT_OPERATOR","->",700],["T_STRING","where",700],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_code IN (?)'",700],",",["T_WHITESPACE"," ",700],["T_ARRAY","array",700],"(",["T_CONSTANT_ENCAPSED_STRING","'small_image'",700],",",["T_WHITESPACE"," ",700],["T_CONSTANT_ENCAPSED_STRING","'thumbnail'",700],",",["T_WHITESPACE"," ",700],["T_CONSTANT_ENCAPSED_STRING","'image'",700],")",")",";",["T_WHITESPACE","\n\n        ",700],["T_VARIABLE","$images",702],["T_WHITESPACE"," ",702],"=",["T_WHITESPACE"," ",702],["T_VARIABLE","$read",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","fetchAll",702],"(",["T_VARIABLE","$select",702],")",";",["T_WHITESPACE","\n        ",702],["T_RETURN","return",703],["T_WHITESPACE"," ",703],["T_VARIABLE","$images",703],";",["T_WHITESPACE","\n    ",703],"}",["T_WHITESPACE","\n\n    ",704],["T_DOC_COMMENT","\/**\n     * Retrieve product categories\n     *\n     * @param Mage_Catalog_Model_Product $object\n     * @return array\n     *\/",706],["T_WHITESPACE","\n    ",711],["T_PUBLIC","public",712],["T_WHITESPACE"," ",712],["T_FUNCTION","function",712],["T_WHITESPACE"," ",712],["T_STRING","getCategoryIdsWithAnchors",712],"(",["T_VARIABLE","$object",712],")",["T_WHITESPACE","\n    ",712],"{",["T_WHITESPACE","\n        ",713],["T_VARIABLE","$selectRootCategories",714],["T_WHITESPACE"," ",714],"=",["T_WHITESPACE"," ",714],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","_getReadAdapter",714],"(",")",["T_OBJECT_OPERATOR","->",714],["T_STRING","select",714],"(",")",["T_WHITESPACE","\n            ",714],["T_OBJECT_OPERATOR","->",715],["T_STRING","from",715],"(",["T_WHITESPACE","\n                ",715],["T_ARRAY","array",716],"(",["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","getTable",716],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",716],")",")",",",["T_WHITESPACE","\n                ",716],["T_ARRAY","array",717],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",717],")",["T_WHITESPACE","\n            ",717],")",["T_WHITESPACE","\n            ",718],["T_OBJECT_OPERATOR","->",719],["T_STRING","where",719],"(",["T_CONSTANT_ENCAPSED_STRING","'level <= 1'",719],")",";",["T_WHITESPACE","\n        ",719],["T_VARIABLE","$rootIds",720],["T_WHITESPACE"," ",720],"=",["T_WHITESPACE"," ",720],["T_VARIABLE","$this",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","_getReadAdapter",720],"(",")",["T_OBJECT_OPERATOR","->",720],["T_STRING","fetchCol",720],"(",["T_VARIABLE","$selectRootCategories",720],")",";",["T_WHITESPACE","\n        ",720],["T_VARIABLE","$select",721],["T_WHITESPACE"," ",721],"=",["T_WHITESPACE"," ",721],["T_VARIABLE","$this",721],["T_OBJECT_OPERATOR","->",721],["T_STRING","_getReadAdapter",721],"(",")",["T_OBJECT_OPERATOR","->",721],["T_STRING","select",721],"(",")",["T_WHITESPACE","\n            ",721],["T_OBJECT_OPERATOR","->",722],["T_STRING","from",722],"(",["T_WHITESPACE","\n                ",722],["T_ARRAY","array",723],"(",["T_VARIABLE","$this",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","getTable",723],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product_index'",723],")",")",",",["T_WHITESPACE","\n                ",723],["T_ARRAY","array",724],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",724],")",["T_WHITESPACE","\n            ",724],")",["T_WHITESPACE","\n            ",725],["T_OBJECT_OPERATOR","->",726],["T_STRING","where",726],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",726],",",["T_WHITESPACE"," ",726],["T_INT_CAST","(int)",726],["T_VARIABLE","$object",726],["T_OBJECT_OPERATOR","->",726],["T_STRING","getEntityId",726],"(",")",")",["T_WHITESPACE","\n            ",726],["T_OBJECT_OPERATOR","->",727],["T_STRING","where",727],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id NOT IN(?)'",727],",",["T_WHITESPACE"," ",727],["T_VARIABLE","$rootIds",727],")",";",["T_WHITESPACE","\n\n        ",727],["T_RETURN","return",729],["T_WHITESPACE"," ",729],["T_VARIABLE","$this",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","_getReadAdapter",729],"(",")",["T_OBJECT_OPERATOR","->",729],["T_STRING","fetchCol",729],"(",["T_VARIABLE","$select",729],")",";",["T_WHITESPACE","\n    ",729],"}",["T_WHITESPACE","\n",730],"}",["T_WHITESPACE","\n",731]]