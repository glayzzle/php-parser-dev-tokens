[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog product media gallery attribute backend model\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Attribute_Backend_Media",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Eav_Model_Entity_Attribute_Backend_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_renamedImages",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_ARRAY","array",36],"(",")",";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Load attribute data after product loaded\n     *\n     * @param Mage_Catalog_Model_Product $object\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PUBLIC","public",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","afterLoad",43],"(",["T_VARIABLE","$object",43],")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$attrCode",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getAttribute",45],"(",")",["T_OBJECT_OPERATOR","->",45],["T_STRING","getAttributeCode",45],"(",")",";",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$value",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_ARRAY","array",46],"(",")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$value",47],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",47],"]",["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_ARRAY","array",47],"(",")",";",["T_WHITESPACE","\n        ",47],["T_VARIABLE","$value",48],"[",["T_CONSTANT_ENCAPSED_STRING","'values'",48],"]",["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_ARRAY","array",48],"(",")",";",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$localAttributes",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_ARRAY","array",49],"(",["T_CONSTANT_ENCAPSED_STRING","'label'",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'position'",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'disabled'",49],")",";",["T_WHITESPACE","\n\n        ",49],["T_FOREACH","foreach",51],["T_WHITESPACE"," ",51],"(",["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_getResource",51],"(",")",["T_OBJECT_OPERATOR","->",51],["T_STRING","loadGallery",51],"(",["T_VARIABLE","$object",51],",",["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],")",["T_WHITESPACE"," ",51],["T_AS","as",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$image",51],")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n            ",51],["T_FOREACH","foreach",52],["T_WHITESPACE"," ",52],"(",["T_VARIABLE","$localAttributes",52],["T_WHITESPACE"," ",52],["T_AS","as",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$localAttribute",52],")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n                ",52],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_STRING","is_null",53],"(",["T_VARIABLE","$image",53],"[",["T_VARIABLE","$localAttribute",53],"]",")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n                    ",53],["T_VARIABLE","$image",54],"[",["T_VARIABLE","$localAttribute",54],"]",["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_getDefaultValue",54],"(",["T_VARIABLE","$localAttribute",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$image",54],")",";",["T_WHITESPACE","\n                ",54],"}",["T_WHITESPACE","\n            ",55],"}",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$value",57],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",57],"]","[","]",["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$image",57],";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$object",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","setData",60],"(",["T_VARIABLE","$attrCode",60],",",["T_WHITESPACE"," ",60],["T_VARIABLE","$value",60],")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","_getDefaultValue",63],"(",["T_VARIABLE","$key",63],",",["T_WHITESPACE"," ",63],"&",["T_VARIABLE","$image",63],")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_ISSET","isset",65],"(",["T_VARIABLE","$image",65],"[",["T_VARIABLE","$key",65],["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'_default'",65],"]",")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_RETURN","return",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$image",66],"[",["T_VARIABLE","$key",66],["T_WHITESPACE"," ",66],".",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'_default'",66],"]",";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE","\n\n        ",67],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","''",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Validate media_gallery attribute data\n     *\n     * @param Mage_Catalog_Model_Product $object\n     * @throws Mage_Core_Exception\n     * @return bool\n     *\/",72],["T_WHITESPACE","\n    ",78],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","validate",79],"(",["T_VARIABLE","$object",79],")",["T_WHITESPACE","\n    ",79],"{",["T_WHITESPACE","\n        ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getAttribute",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","getIsRequired",81],"(",")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$value",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$object",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getData",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getAttribute",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","getAttributeCode",82],"(",")",")",";",["T_WHITESPACE","\n            ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getAttribute",83],"(",")",["T_OBJECT_OPERATOR","->",83],["T_STRING","isValueEmpty",83],"(",["T_VARIABLE","$value",83],")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                ",83],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_WHITESPACE"," ",84],"!","(",["T_STRING","is_array",84],"(",["T_VARIABLE","$value",84],")",["T_WHITESPACE"," ",84],["T_BOOLEAN_AND","&&",84],["T_WHITESPACE"," ",84],["T_STRING","count",84],"(",["T_VARIABLE","$value",84],")",">",["T_LNUMBER","0",84],")",["T_WHITESPACE"," ",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n                    ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_STRING","false",85],";",["T_WHITESPACE","\n                ",85],"}",["T_WHITESPACE","\n            ",86],"}",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getAttribute",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","getIsUnique",89],"(",")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(","!",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getAttribute",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","getEntity",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","checkAttributeUniqueValue",90],"(",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getAttribute",90],"(",")",",",["T_WHITESPACE"," ",90],["T_VARIABLE","$object",90],")",")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$label",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getAttribute",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","getFrontend",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","getLabel",91],"(",")",";",["T_WHITESPACE","\n                ",91],["T_STRING","Mage",92],["T_DOUBLE_COLON","::",92],["T_STRING","throwException",92],"(",["T_STRING","Mage",92],["T_DOUBLE_COLON","::",92],["T_STRING","helper",92],"(",["T_CONSTANT_ENCAPSED_STRING","'eav'",92],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","__",92],"(",["T_CONSTANT_ENCAPSED_STRING","'The value of attribute \"%s\" must be unique.'",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$label",92],")",")",";",["T_WHITESPACE","\n            ",92],"}",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE","\n\n        ",94],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_STRING","true",96],";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_PUBLIC","public",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","beforeSave",99],"(",["T_VARIABLE","$object",99],")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$attrCode",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getAttribute",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","getAttributeCode",101],"(",")",";",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$value",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$object",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getData",102],"(",["T_VARIABLE","$attrCode",102],")",";",["T_WHITESPACE","\n        ",102],["T_IF","if",103],["T_WHITESPACE"," ",103],"(","!",["T_STRING","is_array",103],"(",["T_VARIABLE","$value",103],")",["T_WHITESPACE"," ",103],["T_BOOLEAN_OR","||",103],["T_WHITESPACE"," ",103],"!",["T_ISSET","isset",103],"(",["T_VARIABLE","$value",103],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",103],"]",")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_RETURN","return",104],";",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n\n        ",105],["T_IF","if",107],"(","!",["T_STRING","is_array",107],"(",["T_VARIABLE","$value",107],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",107],"]",")",["T_WHITESPACE"," ",107],["T_BOOLEAN_AND","&&",107],["T_WHITESPACE"," ",107],["T_STRING","strlen",107],"(",["T_VARIABLE","$value",107],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",107],"]",")",["T_WHITESPACE"," ",107],">",["T_WHITESPACE"," ",107],["T_LNUMBER","0",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n           ",107],["T_VARIABLE","$value",108],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",108],"]",["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","Mage",108],["T_DOUBLE_COLON","::",108],["T_STRING","helper",108],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",108],")",["T_OBJECT_OPERATOR","->",108],["T_STRING","jsonDecode",108],"(",["T_VARIABLE","$value",108],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",108],"]",")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n\n        ",109],["T_IF","if",111],["T_WHITESPACE"," ",111],"(","!",["T_STRING","is_array",111],"(",["T_VARIABLE","$value",111],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",111],"]",")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n           ",111],["T_VARIABLE","$value",112],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",112],"]",["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_ARRAY","array",112],"(",")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n\n\n        ",113],["T_VARIABLE","$clearImages",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$newImages",118],["T_WHITESPACE","   ",118],"=",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],"(",")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$existImages",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_ARRAY","array",119],"(",")",";",["T_WHITESPACE","\n        ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$object",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getIsDuplicate",120],"(",")",["T_IS_NOT_EQUAL","!=",120],["T_STRING","true",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_FOREACH","foreach",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$value",121],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",121],"]",["T_WHITESPACE"," ",121],["T_AS","as",121],["T_WHITESPACE"," ",121],"&",["T_VARIABLE","$image",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                ",121],["T_IF","if",122],"(","!",["T_EMPTY","empty",122],"(",["T_VARIABLE","$image",122],"[",["T_CONSTANT_ENCAPSED_STRING","'removed'",122],"]",")",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n                    ",122],["T_VARIABLE","$clearImages",123],"[","]",["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$image",123],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",123],"]",";",["T_WHITESPACE","\n                ",123],"}",["T_WHITESPACE"," ",124],["T_ELSE","else",124],["T_WHITESPACE"," ",124],["T_IF","if",124],["T_WHITESPACE"," ",124],"(","!",["T_ISSET","isset",124],"(",["T_VARIABLE","$image",124],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",124],"]",")",")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                    ",124],["T_VARIABLE","$newFile",125],["T_WHITESPACE","                   ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_moveImageFromTmp",125],"(",["T_VARIABLE","$image",125],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",125],"]",")",";",["T_WHITESPACE","\n                    ",125],["T_VARIABLE","$image",126],"[",["T_CONSTANT_ENCAPSED_STRING","'new_file'",126],"]",["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$newFile",126],";",["T_WHITESPACE","\n                    ",126],["T_VARIABLE","$newImages",127],"[",["T_VARIABLE","$image",127],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",127],"]","]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$image",127],";",["T_WHITESPACE","\n                    ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_renamedImages",128],"[",["T_VARIABLE","$image",128],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",128],"]","]",["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$newFile",128],";",["T_WHITESPACE","\n                    ",128],["T_VARIABLE","$image",129],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",129],"]",["T_WHITESPACE","             ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$newFile",129],";",["T_WHITESPACE","\n                ",129],"}",["T_WHITESPACE"," ",130],["T_ELSE","else",130],["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                    ",130],["T_VARIABLE","$existImages",131],"[",["T_VARIABLE","$image",131],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",131],"]","]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$image",131],";",["T_WHITESPACE","\n                ",131],"}",["T_WHITESPACE","\n            ",132],"}",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE"," ",134],["T_ELSE","else",134],["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n            ",134],["T_COMMENT","\/\/ For duplicating we need copy original images.\n",135],["T_WHITESPACE","            ",136],["T_VARIABLE","$duplicate",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_ARRAY","array",136],"(",")",";",["T_WHITESPACE","\n            ",136],["T_FOREACH","foreach",137],["T_WHITESPACE"," ",137],"(",["T_VARIABLE","$value",137],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",137],"]",["T_WHITESPACE"," ",137],["T_AS","as",137],["T_WHITESPACE"," ",137],"&",["T_VARIABLE","$image",137],")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n                ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(","!",["T_ISSET","isset",138],"(",["T_VARIABLE","$image",138],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",138],"]",")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n                    ",138],["T_CONTINUE","continue",139],";",["T_WHITESPACE","\n                ",139],"}",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$newFile",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_copyImage",141],"(",["T_VARIABLE","$image",141],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",141],"]",")",";",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$newImages",142],"[",["T_VARIABLE","$image",142],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",142],"]","]",["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_ARRAY","array",142],"(",["T_WHITESPACE","\n                    ",142],["T_CONSTANT_ENCAPSED_STRING","'new_file'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$newFile",143],",",["T_WHITESPACE","\n                    ",143],["T_CONSTANT_ENCAPSED_STRING","'label'",144],["T_WHITESPACE"," ",144],["T_DOUBLE_ARROW","=>",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$image",144],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",144],"]",["T_WHITESPACE","\n                ",144],")",";",["T_WHITESPACE","\n                ",145],["T_VARIABLE","$duplicate",146],"[",["T_VARIABLE","$image",146],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",146],"]","]",["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$newFile",146],";",["T_WHITESPACE","\n            ",146],"}",["T_WHITESPACE","\n\n            ",147],["T_VARIABLE","$value",149],"[",["T_CONSTANT_ENCAPSED_STRING","'duplicate'",149],"]",["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$duplicate",149],";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n\n        ",150],["T_FOREACH","foreach",152],["T_WHITESPACE"," ",152],"(",["T_VARIABLE","$object",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getMediaAttributes",152],"(",")",["T_WHITESPACE"," ",152],["T_AS","as",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$mediaAttribute",152],")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$mediaAttrCode",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$mediaAttribute",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getAttributeCode",153],"(",")",";",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$attrData",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$object",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getData",154],"(",["T_VARIABLE","$mediaAttrCode",154],")",";",["T_WHITESPACE","\n\n            ",154],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_STRING","in_array",156],"(",["T_VARIABLE","$attrData",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$clearImages",156],")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                ",156],["T_VARIABLE","$object",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","setData",157],"(",["T_VARIABLE","$mediaAttrCode",157],",",["T_WHITESPACE"," ",157],["T_CONSTANT_ENCAPSED_STRING","'no_selection'",157],")",";",["T_WHITESPACE","\n            ",157],"}",["T_WHITESPACE","\n\n            ",158],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_STRING","in_array",160],"(",["T_VARIABLE","$attrData",160],",",["T_WHITESPACE"," ",160],["T_STRING","array_keys",160],"(",["T_VARIABLE","$newImages",160],")",")",")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$object",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","setData",161],"(",["T_VARIABLE","$mediaAttrCode",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$newImages",161],"[",["T_VARIABLE","$attrData",161],"]","[",["T_CONSTANT_ENCAPSED_STRING","'new_file'",161],"]",")",";",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$object",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","setData",162],"(",["T_VARIABLE","$mediaAttrCode",162],".",["T_CONSTANT_ENCAPSED_STRING","'_label'",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$newImages",162],"[",["T_VARIABLE","$attrData",162],"]","[",["T_CONSTANT_ENCAPSED_STRING","'label'",162],"]",")",";",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE","\n\n            ",163],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_STRING","in_array",165],"(",["T_VARIABLE","$attrData",165],",",["T_WHITESPACE"," ",165],["T_STRING","array_keys",165],"(",["T_VARIABLE","$existImages",165],")",")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                ",165],["T_VARIABLE","$object",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","setData",166],"(",["T_VARIABLE","$mediaAttrCode",166],".",["T_CONSTANT_ENCAPSED_STRING","'_label'",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$existImages",166],"[",["T_VARIABLE","$attrData",166],"]","[",["T_CONSTANT_ENCAPSED_STRING","'label'",166],"]",")",";",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n\n        ",168],["T_STRING","Mage",170],["T_DOUBLE_COLON","::",170],["T_STRING","dispatchEvent",170],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_media_save_before'",170],",",["T_WHITESPACE"," ",170],["T_ARRAY","array",170],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$object",170],",",["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'images'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$value",170],")",")",";",["T_WHITESPACE","\n\n        ",170],["T_VARIABLE","$object",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","setData",172],"(",["T_VARIABLE","$attrCode",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$value",172],")",";",["T_WHITESPACE","\n\n        ",172],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Retrieve renamed image name\n     *\n     * @param string $file\n     * @return string\n     *\/",177],["T_WHITESPACE","\n    ",182],["T_PUBLIC","public",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","getRenamedImage",183],"(",["T_VARIABLE","$file",183],")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_IF","if",185],["T_WHITESPACE"," ",185],"(",["T_ISSET","isset",185],"(",["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_renamedImages",185],"[",["T_VARIABLE","$file",185],"]",")",")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n            ",185],["T_RETURN","return",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_renamedImages",186],"[",["T_VARIABLE","$file",186],"]",";",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n\n        ",187],["T_RETURN","return",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$file",189],";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n\n    ",190],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","afterSave",192],"(",["T_VARIABLE","$object",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_IF","if",194],["T_WHITESPACE"," ",194],"(",["T_VARIABLE","$object",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getIsDuplicate",194],"(",")",["T_WHITESPACE"," ",194],["T_IS_EQUAL","==",194],["T_WHITESPACE"," ",194],["T_STRING","true",194],")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","duplicate",195],"(",["T_VARIABLE","$object",195],")",";",["T_WHITESPACE","\n            ",195],["T_RETURN","return",196],";",["T_WHITESPACE","\n        ",196],"}",["T_WHITESPACE","\n\n        ",197],["T_VARIABLE","$attrCode",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getAttribute",199],"(",")",["T_OBJECT_OPERATOR","->",199],["T_STRING","getAttributeCode",199],"(",")",";",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$value",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$object",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getData",200],"(",["T_VARIABLE","$attrCode",200],")",";",["T_WHITESPACE","\n        ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(","!",["T_STRING","is_array",201],"(",["T_VARIABLE","$value",201],")",["T_WHITESPACE"," ",201],["T_BOOLEAN_OR","||",201],["T_WHITESPACE"," ",201],"!",["T_ISSET","isset",201],"(",["T_VARIABLE","$value",201],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",201],"]",")",["T_WHITESPACE"," ",201],["T_BOOLEAN_OR","||",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$object",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","isLockedAttribute",201],"(",["T_VARIABLE","$attrCode",201],")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_RETURN","return",202],";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n\n        ",203],["T_VARIABLE","$storeId",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$object",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getStoreId",205],"(",")",";",["T_WHITESPACE","\n\n        ",205],["T_VARIABLE","$storeIds",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$object",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getStoreIds",207],"(",")",";",["T_WHITESPACE","\n        ",207],["T_VARIABLE","$storeIds",208],"[","]",["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_STRING","Mage_Core_Model_App",208],["T_DOUBLE_COLON","::",208],["T_STRING","ADMIN_STORE_ID",208],";",["T_WHITESPACE","\n\n        ",208],["T_COMMENT","\/\/ remove current storeId\n",210],["T_WHITESPACE","        ",211],["T_VARIABLE","$storeIds",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_STRING","array_flip",211],"(",["T_VARIABLE","$storeIds",211],")",";",["T_WHITESPACE","\n        ",211],["T_UNSET","unset",212],"(",["T_VARIABLE","$storeIds",212],"[",["T_VARIABLE","$storeId",212],"]",")",";",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$storeIds",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_STRING","array_keys",213],"(",["T_VARIABLE","$storeIds",213],")",";",["T_WHITESPACE","\n\n        ",213],["T_VARIABLE","$images",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_STRING","Mage",215],["T_DOUBLE_COLON","::",215],["T_STRING","getResourceModel",215],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",215],")",["T_WHITESPACE","\n            ",215],["T_OBJECT_OPERATOR","->",216],["T_STRING","getAssignedImages",216],"(",["T_VARIABLE","$object",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$storeIds",216],")",";",["T_WHITESPACE","\n\n        ",216],["T_VARIABLE","$picturesInOtherStores",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_ARRAY","array",218],"(",")",";",["T_WHITESPACE","\n        ",218],["T_FOREACH","foreach",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$images",219],["T_WHITESPACE"," ",219],["T_AS","as",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$image",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$picturesInOtherStores",220],"[",["T_VARIABLE","$image",220],"[",["T_CONSTANT_ENCAPSED_STRING","'filepath'",220],"]","]",["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_STRING","true",220],";",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n\n        ",221],["T_VARIABLE","$toDelete",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_ARRAY","array",223],"(",")",";",["T_WHITESPACE","\n        ",223],["T_VARIABLE","$filesToValueIds",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_ARRAY","array",224],"(",")",";",["T_WHITESPACE","\n        ",224],["T_FOREACH","foreach",225],["T_WHITESPACE"," ",225],"(",["T_VARIABLE","$value",225],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",225],"]",["T_WHITESPACE"," ",225],["T_AS","as",225],["T_WHITESPACE"," ",225],"&",["T_VARIABLE","$image",225],")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n            ",225],["T_IF","if",226],"(","!",["T_EMPTY","empty",226],"(",["T_VARIABLE","$image",226],"[",["T_CONSTANT_ENCAPSED_STRING","'removed'",226],"]",")",")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n                ",226],["T_IF","if",227],"(",["T_ISSET","isset",227],"(",["T_VARIABLE","$image",227],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",227],"]",")",["T_WHITESPACE"," ",227],["T_BOOLEAN_AND","&&",227],["T_WHITESPACE"," ",227],"!",["T_ISSET","isset",227],"(",["T_VARIABLE","$picturesInOtherStores",227],"[",["T_VARIABLE","$image",227],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",227],"]","]",")",")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n                    ",227],["T_VARIABLE","$toDelete",228],"[","]",["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$image",228],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",228],"]",";",["T_WHITESPACE","\n                ",228],"}",["T_WHITESPACE","\n                ",229],["T_CONTINUE","continue",230],";",["T_WHITESPACE","\n            ",230],"}",["T_WHITESPACE","\n\n            ",231],["T_IF","if",233],"(","!",["T_ISSET","isset",233],"(",["T_VARIABLE","$image",233],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",233],"]",")",")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n                ",233],["T_VARIABLE","$data",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_ARRAY","array",234],"(",")",";",["T_WHITESPACE","\n                ",234],["T_VARIABLE","$data",235],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",235],"]",["T_WHITESPACE","      ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$object",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getId",235],"(",")",";",["T_WHITESPACE","\n                ",235],["T_VARIABLE","$data",236],"[",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",236],"]",["T_WHITESPACE","   ",236],"=",["T_WHITESPACE"," ",236],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getAttribute",236],"(",")",["T_OBJECT_OPERATOR","->",236],["T_STRING","getId",236],"(",")",";",["T_WHITESPACE","\n                ",236],["T_VARIABLE","$data",237],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",237],"]",["T_WHITESPACE","          ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$image",237],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",237],"]",";",["T_WHITESPACE","\n                ",237],["T_VARIABLE","$image",238],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",238],"]",["T_WHITESPACE","      ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_getResource",238],"(",")",["T_OBJECT_OPERATOR","->",238],["T_STRING","insertGallery",238],"(",["T_VARIABLE","$data",238],")",";",["T_WHITESPACE","\n            ",238],"}",["T_WHITESPACE","\n\n            ",239],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_getResource",241],"(",")",["T_OBJECT_OPERATOR","->",241],["T_STRING","deleteGalleryValueInStore",241],"(",["T_VARIABLE","$image",241],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",241],"]",",",["T_WHITESPACE"," ",241],["T_VARIABLE","$object",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getStoreId",241],"(",")",")",";",["T_WHITESPACE","\n\n            ",241],["T_COMMENT","\/\/ Add per store labels, position, disabled\n",243],["T_WHITESPACE","            ",244],["T_VARIABLE","$data",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_ARRAY","array",244],"(",")",";",["T_WHITESPACE","\n            ",244],["T_VARIABLE","$data",245],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",245],"]",["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$image",245],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",245],"]",";",["T_WHITESPACE","\n            ",245],["T_VARIABLE","$data",246],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",246],"]",["T_WHITESPACE","    ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$image",246],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",246],"]",";",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$data",247],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",247],"]",["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_INT_CAST","(int)",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$image",247],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",247],"]",";",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$data",248],"[",["T_CONSTANT_ENCAPSED_STRING","'disabled'",248],"]",["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_INT_CAST","(int)",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$image",248],"[",["T_CONSTANT_ENCAPSED_STRING","'disabled'",248],"]",";",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$data",249],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",249],"]",["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_INT_CAST","(int)",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$object",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getStoreId",249],"(",")",";",["T_WHITESPACE","\n\n            ",249],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","_getResource",251],"(",")",["T_OBJECT_OPERATOR","->",251],["T_STRING","insertGalleryValueInStore",251],"(",["T_VARIABLE","$data",251],")",";",["T_WHITESPACE","\n        ",251],"}",["T_WHITESPACE","\n\n        ",252],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","_getResource",254],"(",")",["T_OBJECT_OPERATOR","->",254],["T_STRING","deleteGallery",254],"(",["T_VARIABLE","$toDelete",254],")",";",["T_WHITESPACE","\n    ",254],"}",["T_WHITESPACE","\n\n    ",255],["T_DOC_COMMENT","\/**\n     * Add image to media gallery and return new filename\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param string                     $file              file path of image in file system\n     * @param string|array               $mediaAttribute    code of attribute with type 'media_image',\n     *                                                      leave blank if image should be only in gallery\n     * @param boolean                    $move              if true, it will move source file\n     * @param boolean                    $exclude           mark image as disabled in product page view\n     * @return string\n     *\/",257],["T_WHITESPACE","\n    ",267],["T_PUBLIC","public",268],["T_WHITESPACE"," ",268],["T_FUNCTION","function",268],["T_WHITESPACE"," ",268],["T_STRING","addImage",268],"(",["T_STRING","Mage_Catalog_Model_Product",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$product",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$file",268],",",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$mediaAttribute",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","null",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$move",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","false",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$exclude",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","true",269],")",["T_WHITESPACE","\n    ",269],"{",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$file",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_STRING","realpath",271],"(",["T_VARIABLE","$file",271],")",";",["T_WHITESPACE","\n\n        ",271],["T_IF","if",273],["T_WHITESPACE"," ",273],"(","!",["T_VARIABLE","$file",273],["T_WHITESPACE"," ",273],["T_BOOLEAN_OR","||",273],["T_WHITESPACE"," ",273],"!",["T_STRING","file_exists",273],"(",["T_VARIABLE","$file",273],")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","throwException",274],"(",["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","helper",274],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",274],")",["T_OBJECT_OPERATOR","->",274],["T_STRING","__",274],"(",["T_CONSTANT_ENCAPSED_STRING","'Image does not exist.'",274],")",")",";",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n\n        ",275],["T_STRING","Mage",277],["T_DOUBLE_COLON","::",277],["T_STRING","dispatchEvent",277],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_media_add_image'",277],",",["T_WHITESPACE"," ",277],["T_ARRAY","array",277],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$product",277],",",["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","'image'",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$file",277],")",")",";",["T_WHITESPACE","\n\n        ",277],["T_VARIABLE","$pathinfo",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_STRING","pathinfo",279],"(",["T_VARIABLE","$file",279],")",";",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$imgExtensions",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_ARRAY","array",280],"(",["T_CONSTANT_ENCAPSED_STRING","'jpg'",280],",",["T_CONSTANT_ENCAPSED_STRING","'jpeg'",280],",",["T_CONSTANT_ENCAPSED_STRING","'gif'",280],",",["T_CONSTANT_ENCAPSED_STRING","'png'",280],")",";",["T_WHITESPACE","\n        ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(","!",["T_ISSET","isset",281],"(",["T_VARIABLE","$pathinfo",281],"[",["T_CONSTANT_ENCAPSED_STRING","'extension'",281],"]",")",["T_WHITESPACE"," ",281],["T_BOOLEAN_OR","||",281],["T_WHITESPACE"," ",281],"!",["T_STRING","in_array",281],"(",["T_STRING","strtolower",281],"(",["T_VARIABLE","$pathinfo",281],"[",["T_CONSTANT_ENCAPSED_STRING","'extension'",281],"]",")",",",["T_WHITESPACE"," ",281],["T_VARIABLE","$imgExtensions",281],")",")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n            ",281],["T_STRING","Mage",282],["T_DOUBLE_COLON","::",282],["T_STRING","throwException",282],"(",["T_STRING","Mage",282],["T_DOUBLE_COLON","::",282],["T_STRING","helper",282],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",282],")",["T_OBJECT_OPERATOR","->",282],["T_STRING","__",282],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid image file type.'",282],")",")",";",["T_WHITESPACE","\n        ",282],"}",["T_WHITESPACE","\n\n        ",283],["T_VARIABLE","$fileName",285],["T_WHITESPACE","       ",285],"=",["T_WHITESPACE"," ",285],["T_STRING","Mage_Core_Model_File_Uploader",285],["T_DOUBLE_COLON","::",285],["T_STRING","getCorrectFileName",285],"(",["T_VARIABLE","$pathinfo",285],"[",["T_CONSTANT_ENCAPSED_STRING","'basename'",285],"]",")",";",["T_WHITESPACE","\n        ",285],["T_VARIABLE","$dispretionPath",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_STRING","Mage_Core_Model_File_Uploader",286],["T_DOUBLE_COLON","::",286],["T_STRING","getDispretionPath",286],"(",["T_VARIABLE","$fileName",286],")",";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$fileName",287],["T_WHITESPACE","       ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$dispretionPath",287],["T_WHITESPACE"," ",287],".",["T_WHITESPACE"," ",287],["T_STRING","DS",287],["T_WHITESPACE"," ",287],".",["T_WHITESPACE"," ",287],["T_VARIABLE","$fileName",287],";",["T_WHITESPACE","\n\n        ",287],["T_VARIABLE","$fileName",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","_getNotDuplicatedFilename",289],"(",["T_VARIABLE","$fileName",289],",",["T_WHITESPACE"," ",289],["T_VARIABLE","$dispretionPath",289],")",";",["T_WHITESPACE","\n\n        ",289],["T_VARIABLE","$ioAdapter",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_NEW","new",291],["T_WHITESPACE"," ",291],["T_STRING","Varien_Io_File",291],"(",")",";",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$ioAdapter",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","setAllowCreateFolders",292],"(",["T_STRING","true",292],")",";",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$distanationDirectory",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_STRING","dirname",293],"(",["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_getConfig",293],"(",")",["T_OBJECT_OPERATOR","->",293],["T_STRING","getTmpMediaPath",293],"(",["T_VARIABLE","$fileName",293],")",")",";",["T_WHITESPACE","\n\n        ",293],["T_TRY","try",295],["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$ioAdapter",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","open",296],"(",["T_ARRAY","array",296],"(",["T_WHITESPACE","\n                ",296],["T_CONSTANT_ENCAPSED_STRING","'path'",297],["T_DOUBLE_ARROW","=>",297],["T_VARIABLE","$distanationDirectory",297],["T_WHITESPACE","\n            ",297],")",")",";",["T_WHITESPACE","\n\n            ",298],["T_DOC_COMMENT","\/** @var $storageHelper Mage_Core_Helper_File_Storage_Database *\/",300],["T_WHITESPACE","\n            ",300],["T_VARIABLE","$storageHelper",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_STRING","Mage",301],["T_DOUBLE_COLON","::",301],["T_STRING","helper",301],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",301],")",";",["T_WHITESPACE","\n            ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_VARIABLE","$move",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n                ",302],["T_VARIABLE","$ioAdapter",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","mv",303],"(",["T_VARIABLE","$file",303],",",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_getConfig",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","getTmpMediaPath",303],"(",["T_VARIABLE","$fileName",303],")",")",";",["T_WHITESPACE","\n\n                ",303],["T_COMMENT","\/\/If this is used, filesystem should be configured properly\n",305],["T_WHITESPACE","                ",306],["T_VARIABLE","$storageHelper",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","saveFile",306],"(",["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_getConfig",306],"(",")",["T_OBJECT_OPERATOR","->",306],["T_STRING","getTmpMediaShortUrl",306],"(",["T_VARIABLE","$fileName",306],")",")",";",["T_WHITESPACE","\n            ",306],"}",["T_WHITESPACE"," ",307],["T_ELSE","else",307],["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n                ",307],["T_VARIABLE","$ioAdapter",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","cp",308],"(",["T_VARIABLE","$file",308],",",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_getConfig",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getTmpMediaPath",308],"(",["T_VARIABLE","$fileName",308],")",")",";",["T_WHITESPACE","\n\n                ",308],["T_VARIABLE","$storageHelper",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","saveFile",310],"(",["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_getConfig",310],"(",")",["T_OBJECT_OPERATOR","->",310],["T_STRING","getTmpMediaShortUrl",310],"(",["T_VARIABLE","$fileName",310],")",")",";",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$ioAdapter",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","chmod",311],"(",["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_getConfig",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getTmpMediaPath",311],"(",["T_VARIABLE","$fileName",311],")",",",["T_WHITESPACE"," ",311],["T_LNUMBER","0777",311],")",";",["T_WHITESPACE","\n            ",311],"}",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n        ",313],["T_CATCH","catch",314],["T_WHITESPACE"," ",314],"(",["T_STRING","Exception",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$e",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","throwException",315],"(",["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","helper",315],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",315],")",["T_OBJECT_OPERATOR","->",315],["T_STRING","__",315],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to move file: %s'",315],",",["T_WHITESPACE"," ",315],["T_VARIABLE","$e",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getMessage",315],"(",")",")",")",";",["T_WHITESPACE","\n        ",315],"}",["T_WHITESPACE","\n\n        ",316],["T_VARIABLE","$fileName",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_STRING","str_replace",318],"(",["T_STRING","DS",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'\/'",318],",",["T_WHITESPACE"," ",318],["T_VARIABLE","$fileName",318],")",";",["T_WHITESPACE","\n\n        ",318],["T_VARIABLE","$attrCode",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getAttribute",320],"(",")",["T_OBJECT_OPERATOR","->",320],["T_STRING","getAttributeCode",320],"(",")",";",["T_WHITESPACE","\n        ",320],["T_VARIABLE","$mediaGalleryData",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_VARIABLE","$product",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getData",321],"(",["T_VARIABLE","$attrCode",321],")",";",["T_WHITESPACE","\n        ",321],["T_VARIABLE","$position",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_LNUMBER","0",322],";",["T_WHITESPACE","\n        ",322],["T_IF","if",323],["T_WHITESPACE"," ",323],"(","!",["T_STRING","is_array",323],"(",["T_VARIABLE","$mediaGalleryData",323],")",")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n            ",323],["T_VARIABLE","$mediaGalleryData",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_ARRAY","array",324],"(",["T_WHITESPACE","\n                ",324],["T_CONSTANT_ENCAPSED_STRING","'images'",325],["T_WHITESPACE"," ",325],["T_DOUBLE_ARROW","=>",325],["T_WHITESPACE"," ",325],["T_ARRAY","array",325],"(",")",["T_WHITESPACE","\n            ",325],")",";",["T_WHITESPACE","\n        ",326],"}",["T_WHITESPACE","\n\n        ",327],["T_FOREACH","foreach",329],["T_WHITESPACE"," ",329],"(",["T_VARIABLE","$mediaGalleryData",329],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",329],"]",["T_WHITESPACE"," ",329],["T_AS","as",329],["T_WHITESPACE"," ",329],"&",["T_VARIABLE","$image",329],")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_IF","if",330],["T_WHITESPACE"," ",330],"(",["T_ISSET","isset",330],"(",["T_VARIABLE","$image",330],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",330],"]",")",["T_WHITESPACE"," ",330],["T_BOOLEAN_AND","&&",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$image",330],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",330],"]",["T_WHITESPACE"," ",330],">",["T_WHITESPACE"," ",330],["T_VARIABLE","$position",330],")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n                ",330],["T_VARIABLE","$position",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$image",331],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",331],"]",";",["T_WHITESPACE","\n            ",331],"}",["T_WHITESPACE","\n        ",332],"}",["T_WHITESPACE","\n\n        ",333],["T_VARIABLE","$position",335],["T_INC","++",335],";",["T_WHITESPACE","\n        ",335],["T_VARIABLE","$mediaGalleryData",336],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",336],"]","[","]",["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_ARRAY","array",336],"(",["T_WHITESPACE","\n            ",336],["T_CONSTANT_ENCAPSED_STRING","'file'",337],["T_WHITESPACE","     ",337],["T_DOUBLE_ARROW","=>",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$fileName",337],",",["T_WHITESPACE","\n            ",337],["T_CONSTANT_ENCAPSED_STRING","'position'",338],["T_WHITESPACE"," ",338],["T_DOUBLE_ARROW","=>",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$position",338],",",["T_WHITESPACE","\n            ",338],["T_CONSTANT_ENCAPSED_STRING","'label'",339],["T_WHITESPACE","    ",339],["T_DOUBLE_ARROW","=>",339],["T_WHITESPACE"," ",339],["T_CONSTANT_ENCAPSED_STRING","''",339],",",["T_WHITESPACE","\n            ",339],["T_CONSTANT_ENCAPSED_STRING","'disabled'",340],["T_WHITESPACE"," ",340],["T_DOUBLE_ARROW","=>",340],["T_WHITESPACE"," ",340],["T_INT_CAST","(int)",340],["T_WHITESPACE"," ",340],["T_VARIABLE","$exclude",340],["T_WHITESPACE","\n        ",340],")",";",["T_WHITESPACE","\n\n        ",341],["T_VARIABLE","$product",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","setData",343],"(",["T_VARIABLE","$attrCode",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$mediaGalleryData",343],")",";",["T_WHITESPACE","\n\n        ",343],["T_IF","if",345],["T_WHITESPACE"," ",345],"(","!",["T_STRING","is_null",345],"(",["T_VARIABLE","$mediaAttribute",345],")",")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n            ",345],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","setMediaAttribute",346],"(",["T_VARIABLE","$product",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$mediaAttribute",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$fileName",346],")",";",["T_WHITESPACE","\n        ",346],"}",["T_WHITESPACE","\n\n        ",347],["T_RETURN","return",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$fileName",349],";",["T_WHITESPACE","\n    ",349],"}",["T_WHITESPACE","\n\n    ",350],["T_DOC_COMMENT","\/**\n     * Add images with different media attributes.\n     * Image will be added only once if the same image is used with different media attributes\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param array $fileAndAttributesArray array of arrays of filename and corresponding media attribute\n     * @param string $filePath path, where image cand be found\n     * @param boolean $move if true, it will move source file\n     * @param boolean $exclude mark image as disabled in product page view\n     * @return array array of parallel arrays with original and renamed files\n     *\/",352],["T_WHITESPACE","\n    ",362],["T_PUBLIC","public",363],["T_WHITESPACE"," ",363],["T_FUNCTION","function",363],["T_WHITESPACE"," ",363],["T_STRING","addImagesWithDifferentMediaAttributes",363],"(",["T_STRING","Mage_Catalog_Model_Product",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$product",363],",",["T_WHITESPACE","\n        ",363],["T_VARIABLE","$fileAndAttributesArray",364],",",["T_WHITESPACE"," ",364],["T_VARIABLE","$filePath",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_CONSTANT_ENCAPSED_STRING","''",364],",",["T_WHITESPACE"," ",364],["T_VARIABLE","$move",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_STRING","false",364],",",["T_WHITESPACE"," ",364],["T_VARIABLE","$exclude",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_STRING","true",364],")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n\n        ",364],["T_VARIABLE","$alreadyAddedFiles",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_ARRAY","array",366],"(",")",";",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$alreadyAddedFilesNames",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_ARRAY","array",367],"(",")",";",["T_WHITESPACE","\n\n        ",367],["T_FOREACH","foreach",369],["T_WHITESPACE"," ",369],"(",["T_VARIABLE","$fileAndAttributesArray",369],["T_WHITESPACE"," ",369],["T_AS","as",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$key",369],["T_WHITESPACE"," ",369],["T_DOUBLE_ARROW","=>",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$value",369],")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$keyInAddedFiles",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_STRING","array_search",370],"(",["T_VARIABLE","$value",370],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",370],"]",",",["T_WHITESPACE"," ",370],["T_VARIABLE","$alreadyAddedFiles",370],",",["T_WHITESPACE"," ",370],["T_STRING","true",370],")",";",["T_WHITESPACE","\n            ",370],["T_IF","if",371],["T_WHITESPACE"," ",371],"(",["T_VARIABLE","$keyInAddedFiles",371],["T_WHITESPACE"," ",371],["T_IS_IDENTICAL","===",371],["T_WHITESPACE"," ",371],["T_STRING","false",371],")",["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n                ",371],["T_VARIABLE","$savedFileName",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","addImage",372],"(",["T_VARIABLE","$product",372],",",["T_WHITESPACE"," ",372],["T_VARIABLE","$filePath",372],["T_WHITESPACE"," ",372],".",["T_WHITESPACE"," ",372],["T_VARIABLE","$value",372],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",372],"]",",",["T_WHITESPACE"," ",372],["T_STRING","null",372],",",["T_WHITESPACE"," ",372],["T_VARIABLE","$move",372],",",["T_WHITESPACE"," ",372],["T_VARIABLE","$exclude",372],")",";",["T_WHITESPACE","\n                ",372],["T_VARIABLE","$alreadyAddedFiles",373],"[",["T_VARIABLE","$key",373],"]",["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],["T_VARIABLE","$value",373],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",373],"]",";",["T_WHITESPACE","\n                ",373],["T_VARIABLE","$alreadyAddedFilesNames",374],"[",["T_VARIABLE","$key",374],"]",["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_VARIABLE","$savedFileName",374],";",["T_WHITESPACE","\n            ",374],"}",["T_WHITESPACE"," ",375],["T_ELSE","else",375],["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n                ",375],["T_VARIABLE","$savedFileName",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_VARIABLE","$alreadyAddedFilesNames",376],"[",["T_VARIABLE","$keyInAddedFiles",376],"]",";",["T_WHITESPACE","\n            ",376],"}",["T_WHITESPACE","\n\n            ",377],["T_IF","if",379],["T_WHITESPACE"," ",379],"(","!",["T_STRING","is_null",379],"(",["T_VARIABLE","$value",379],"[",["T_CONSTANT_ENCAPSED_STRING","'mediaAttribute'",379],"]",")",")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n                ",379],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","setMediaAttribute",380],"(",["T_VARIABLE","$product",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$value",380],"[",["T_CONSTANT_ENCAPSED_STRING","'mediaAttribute'",380],"]",",",["T_WHITESPACE"," ",380],["T_VARIABLE","$savedFileName",380],")",";",["T_WHITESPACE","\n            ",380],"}",["T_WHITESPACE","\n\n        ",381],"}",["T_WHITESPACE","\n\n        ",383],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_ARRAY","array",385],"(",["T_CONSTANT_ENCAPSED_STRING","'alreadyAddedFiles'",385],["T_WHITESPACE"," ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$alreadyAddedFiles",385],",",["T_WHITESPACE"," ",385],["T_CONSTANT_ENCAPSED_STRING","'alreadyAddedFilesNames'",385],["T_WHITESPACE"," ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$alreadyAddedFilesNames",385],")",";",["T_WHITESPACE","\n    ",385],"}",["T_WHITESPACE","\n\n    ",386],["T_DOC_COMMENT","\/**\n     * Update image in gallery\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param sting $file\n     * @param array $data\n     * @return Mage_Catalog_Model_Product_Attribute_Backend_Media\n     *\/",388],["T_WHITESPACE","\n    ",395],["T_PUBLIC","public",396],["T_WHITESPACE"," ",396],["T_FUNCTION","function",396],["T_WHITESPACE"," ",396],["T_STRING","updateImage",396],"(",["T_STRING","Mage_Catalog_Model_Product",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$product",396],",",["T_WHITESPACE"," ",396],["T_VARIABLE","$file",396],",",["T_WHITESPACE"," ",396],["T_VARIABLE","$data",396],")",["T_WHITESPACE","\n    ",396],"{",["T_WHITESPACE","\n        ",397],["T_VARIABLE","$fieldsMap",398],["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_ARRAY","array",398],"(",["T_WHITESPACE","\n            ",398],["T_CONSTANT_ENCAPSED_STRING","'label'",399],["T_WHITESPACE","    ",399],["T_DOUBLE_ARROW","=>",399],["T_WHITESPACE"," ",399],["T_CONSTANT_ENCAPSED_STRING","'label'",399],",",["T_WHITESPACE","\n            ",399],["T_CONSTANT_ENCAPSED_STRING","'position'",400],["T_WHITESPACE"," ",400],["T_DOUBLE_ARROW","=>",400],["T_WHITESPACE"," ",400],["T_CONSTANT_ENCAPSED_STRING","'position'",400],",",["T_WHITESPACE","\n            ",400],["T_CONSTANT_ENCAPSED_STRING","'disabled'",401],["T_WHITESPACE"," ",401],["T_DOUBLE_ARROW","=>",401],["T_WHITESPACE"," ",401],["T_CONSTANT_ENCAPSED_STRING","'disabled'",401],",",["T_WHITESPACE","\n            ",401],["T_CONSTANT_ENCAPSED_STRING","'exclude'",402],["T_WHITESPACE","  ",402],["T_DOUBLE_ARROW","=>",402],["T_WHITESPACE"," ",402],["T_CONSTANT_ENCAPSED_STRING","'disabled'",402],["T_WHITESPACE","\n        ",402],")",";",["T_WHITESPACE","\n\n        ",403],["T_VARIABLE","$attrCode",405],["T_WHITESPACE"," ",405],"=",["T_WHITESPACE"," ",405],["T_VARIABLE","$this",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","getAttribute",405],"(",")",["T_OBJECT_OPERATOR","->",405],["T_STRING","getAttributeCode",405],"(",")",";",["T_WHITESPACE","\n\n        ",405],["T_VARIABLE","$mediaGalleryData",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$product",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getData",407],"(",["T_VARIABLE","$attrCode",407],")",";",["T_WHITESPACE","\n\n        ",407],["T_IF","if",409],["T_WHITESPACE"," ",409],"(","!",["T_ISSET","isset",409],"(",["T_VARIABLE","$mediaGalleryData",409],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",409],"]",")",["T_WHITESPACE"," ",409],["T_BOOLEAN_OR","||",409],["T_WHITESPACE"," ",409],"!",["T_STRING","is_array",409],"(",["T_VARIABLE","$mediaGalleryData",409],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",409],"]",")",")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_RETURN","return",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n\n        ",411],["T_FOREACH","foreach",413],["T_WHITESPACE"," ",413],"(",["T_VARIABLE","$mediaGalleryData",413],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",413],"]",["T_WHITESPACE"," ",413],["T_AS","as",413],["T_WHITESPACE"," ",413],"&",["T_VARIABLE","$image",413],")",["T_WHITESPACE"," ",413],"{",["T_WHITESPACE","\n            ",413],["T_IF","if",414],["T_WHITESPACE"," ",414],"(",["T_VARIABLE","$image",414],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",414],"]",["T_WHITESPACE"," ",414],["T_IS_EQUAL","==",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$file",414],")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n                ",414],["T_FOREACH","foreach",415],["T_WHITESPACE"," ",415],"(",["T_VARIABLE","$fieldsMap",415],["T_WHITESPACE"," ",415],["T_AS","as",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$mappedField",415],["T_DOUBLE_ARROW","=>",415],["T_VARIABLE","$realField",415],")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n                    ",415],["T_IF","if",416],["T_WHITESPACE"," ",416],"(",["T_ISSET","isset",416],"(",["T_VARIABLE","$data",416],"[",["T_VARIABLE","$mappedField",416],"]",")",")",["T_WHITESPACE"," ",416],"{",["T_WHITESPACE","\n                        ",416],["T_VARIABLE","$image",417],"[",["T_VARIABLE","$realField",417],"]",["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$data",417],"[",["T_VARIABLE","$mappedField",417],"]",";",["T_WHITESPACE","\n                    ",417],"}",["T_WHITESPACE","\n                ",418],"}",["T_WHITESPACE","\n            ",419],"}",["T_WHITESPACE","\n        ",420],"}",["T_WHITESPACE","\n\n        ",421],["T_VARIABLE","$product",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","setData",423],"(",["T_VARIABLE","$attrCode",423],",",["T_WHITESPACE"," ",423],["T_VARIABLE","$mediaGalleryData",423],")",";",["T_WHITESPACE","\n        ",423],["T_RETURN","return",424],["T_WHITESPACE"," ",424],["T_VARIABLE","$this",424],";",["T_WHITESPACE","\n    ",424],"}",["T_WHITESPACE","\n\n    ",425],["T_DOC_COMMENT","\/**\n     * Remove image from gallery\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param string $file\n     * @return Mage_Catalog_Model_Product_Attribute_Backend_Media\n     *\/",427],["T_WHITESPACE","\n    ",433],["T_PUBLIC","public",434],["T_WHITESPACE"," ",434],["T_FUNCTION","function",434],["T_WHITESPACE"," ",434],["T_STRING","removeImage",434],"(",["T_STRING","Mage_Catalog_Model_Product",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$product",434],",",["T_WHITESPACE"," ",434],["T_VARIABLE","$file",434],")",["T_WHITESPACE","\n    ",434],"{",["T_WHITESPACE","\n        ",435],["T_VARIABLE","$attrCode",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getAttribute",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","getAttributeCode",436],"(",")",";",["T_WHITESPACE","\n\n        ",436],["T_VARIABLE","$mediaGalleryData",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_VARIABLE","$product",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getData",438],"(",["T_VARIABLE","$attrCode",438],")",";",["T_WHITESPACE","\n\n        ",438],["T_IF","if",440],["T_WHITESPACE"," ",440],"(","!",["T_ISSET","isset",440],"(",["T_VARIABLE","$mediaGalleryData",440],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",440],"]",")",["T_WHITESPACE"," ",440],["T_BOOLEAN_OR","||",440],["T_WHITESPACE"," ",440],"!",["T_STRING","is_array",440],"(",["T_VARIABLE","$mediaGalleryData",440],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",440],"]",")",")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n            ",440],["T_RETURN","return",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],";",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE","\n\n        ",442],["T_FOREACH","foreach",444],["T_WHITESPACE"," ",444],"(",["T_VARIABLE","$mediaGalleryData",444],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",444],"]",["T_WHITESPACE"," ",444],["T_AS","as",444],["T_WHITESPACE"," ",444],"&",["T_VARIABLE","$image",444],")",["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n            ",444],["T_IF","if",445],["T_WHITESPACE"," ",445],"(",["T_VARIABLE","$image",445],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",445],"]",["T_WHITESPACE"," ",445],["T_IS_EQUAL","==",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$file",445],")",["T_WHITESPACE"," ",445],"{",["T_WHITESPACE","\n                ",445],["T_VARIABLE","$image",446],"[",["T_CONSTANT_ENCAPSED_STRING","'removed'",446],"]",["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_LNUMBER","1",446],";",["T_WHITESPACE","\n            ",446],"}",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE","\n\n        ",448],["T_VARIABLE","$product",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","setData",450],"(",["T_VARIABLE","$attrCode",450],",",["T_WHITESPACE"," ",450],["T_VARIABLE","$mediaGalleryData",450],")",";",["T_WHITESPACE","\n\n        ",450],["T_RETURN","return",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$this",452],";",["T_WHITESPACE","\n    ",452],"}",["T_WHITESPACE","\n\n    ",453],["T_DOC_COMMENT","\/**\n     * Retrive image from gallery\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param string $file\n     * @return array|boolean\n     *\/",455],["T_WHITESPACE","\n    ",461],["T_PUBLIC","public",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","getImage",462],"(",["T_STRING","Mage_Catalog_Model_Product",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$product",462],",",["T_WHITESPACE"," ",462],["T_VARIABLE","$file",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$attrCode",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getAttribute",464],"(",")",["T_OBJECT_OPERATOR","->",464],["T_STRING","getAttributeCode",464],"(",")",";",["T_WHITESPACE","\n        ",464],["T_VARIABLE","$mediaGalleryData",465],["T_WHITESPACE"," ",465],"=",["T_WHITESPACE"," ",465],["T_VARIABLE","$product",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","getData",465],"(",["T_VARIABLE","$attrCode",465],")",";",["T_WHITESPACE","\n        ",465],["T_IF","if",466],["T_WHITESPACE"," ",466],"(","!",["T_ISSET","isset",466],"(",["T_VARIABLE","$mediaGalleryData",466],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",466],"]",")",["T_WHITESPACE"," ",466],["T_BOOLEAN_OR","||",466],["T_WHITESPACE"," ",466],"!",["T_STRING","is_array",466],"(",["T_VARIABLE","$mediaGalleryData",466],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",466],"]",")",")",["T_WHITESPACE"," ",466],"{",["T_WHITESPACE","\n            ",466],["T_RETURN","return",467],["T_WHITESPACE"," ",467],["T_STRING","false",467],";",["T_WHITESPACE","\n        ",467],"}",["T_WHITESPACE","\n\n        ",468],["T_FOREACH","foreach",470],["T_WHITESPACE"," ",470],"(",["T_VARIABLE","$mediaGalleryData",470],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",470],"]",["T_WHITESPACE"," ",470],["T_AS","as",470],["T_WHITESPACE"," ",470],["T_VARIABLE","$image",470],")",["T_WHITESPACE"," ",470],"{",["T_WHITESPACE","\n            ",470],["T_IF","if",471],["T_WHITESPACE"," ",471],"(",["T_VARIABLE","$image",471],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",471],"]",["T_WHITESPACE"," ",471],["T_IS_EQUAL","==",471],["T_WHITESPACE"," ",471],["T_VARIABLE","$file",471],")",["T_WHITESPACE"," ",471],"{",["T_WHITESPACE","\n                ",471],["T_RETURN","return",472],["T_WHITESPACE"," ",472],["T_VARIABLE","$image",472],";",["T_WHITESPACE","\n            ",472],"}",["T_WHITESPACE","\n        ",473],"}",["T_WHITESPACE","\n\n        ",474],["T_RETURN","return",476],["T_WHITESPACE"," ",476],["T_STRING","false",476],";",["T_WHITESPACE","\n    ",476],"}",["T_WHITESPACE","\n\n    ",477],["T_DOC_COMMENT","\/**\n     * Clear media attribute value\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param string|array $mediaAttribute\n     * @return Mage_Catalog_Model_Product_Attribute_Backend_Media\n     *\/",479],["T_WHITESPACE","\n    ",485],["T_PUBLIC","public",486],["T_WHITESPACE"," ",486],["T_FUNCTION","function",486],["T_WHITESPACE"," ",486],["T_STRING","clearMediaAttribute",486],"(",["T_STRING","Mage_Catalog_Model_Product",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$product",486],",",["T_WHITESPACE"," ",486],["T_VARIABLE","$mediaAttribute",486],")",["T_WHITESPACE","\n    ",486],"{",["T_WHITESPACE","\n        ",487],["T_VARIABLE","$mediaAttributeCodes",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_STRING","array_keys",488],"(",["T_VARIABLE","$product",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getMediaAttributes",488],"(",")",")",";",["T_WHITESPACE","\n\n        ",488],["T_IF","if",490],["T_WHITESPACE"," ",490],"(",["T_STRING","is_array",490],"(",["T_VARIABLE","$mediaAttribute",490],")",")",["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n            ",490],["T_FOREACH","foreach",491],["T_WHITESPACE"," ",491],"(",["T_VARIABLE","$mediaAttribute",491],["T_WHITESPACE"," ",491],["T_AS","as",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$atttribute",491],")",["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n                ",491],["T_IF","if",492],["T_WHITESPACE"," ",492],"(",["T_STRING","in_array",492],"(",["T_VARIABLE","$atttribute",492],",",["T_WHITESPACE"," ",492],["T_VARIABLE","$mediaAttributeCodes",492],")",")",["T_WHITESPACE"," ",492],"{",["T_WHITESPACE","\n                    ",492],["T_VARIABLE","$product",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","setData",493],"(",["T_VARIABLE","$atttribute",493],",",["T_WHITESPACE"," ",493],["T_STRING","null",493],")",";",["T_WHITESPACE","\n                ",493],"}",["T_WHITESPACE","\n            ",494],"}",["T_WHITESPACE","\n        ",495],"}",["T_WHITESPACE"," ",496],["T_ELSEIF","elseif",496],["T_WHITESPACE"," ",496],"(",["T_STRING","in_array",496],"(",["T_VARIABLE","$mediaAttribute",496],",",["T_WHITESPACE"," ",496],["T_VARIABLE","$mediaAttributeCodes",496],")",")",["T_WHITESPACE"," ",496],"{",["T_WHITESPACE","\n            ",496],["T_VARIABLE","$product",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","setData",497],"(",["T_VARIABLE","$mediaAttribute",497],",",["T_WHITESPACE"," ",497],["T_STRING","null",497],")",";",["T_WHITESPACE","\n        ",497],"}",["T_WHITESPACE","\n\n        ",498],["T_RETURN","return",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$this",500],";",["T_WHITESPACE","\n    ",500],"}",["T_WHITESPACE","\n\n    ",501],["T_DOC_COMMENT","\/**\n     * Set media attribute value\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param string|array $mediaAttribute\n     * @param string $value\n     * @return Mage_Catalog_Model_Product_Attribute_Backend_Media\n     *\/",503],["T_WHITESPACE","\n    ",510],["T_PUBLIC","public",511],["T_WHITESPACE"," ",511],["T_FUNCTION","function",511],["T_WHITESPACE"," ",511],["T_STRING","setMediaAttribute",511],"(",["T_STRING","Mage_Catalog_Model_Product",511],["T_WHITESPACE"," ",511],["T_VARIABLE","$product",511],",",["T_WHITESPACE"," ",511],["T_VARIABLE","$mediaAttribute",511],",",["T_WHITESPACE"," ",511],["T_VARIABLE","$value",511],")",["T_WHITESPACE","\n    ",511],"{",["T_WHITESPACE","\n        ",512],["T_VARIABLE","$mediaAttributeCodes",513],["T_WHITESPACE"," ",513],"=",["T_WHITESPACE"," ",513],["T_STRING","array_keys",513],"(",["T_VARIABLE","$product",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getMediaAttributes",513],"(",")",")",";",["T_WHITESPACE","\n\n        ",513],["T_IF","if",515],["T_WHITESPACE"," ",515],"(",["T_STRING","is_array",515],"(",["T_VARIABLE","$mediaAttribute",515],")",")",["T_WHITESPACE"," ",515],"{",["T_WHITESPACE","\n            ",515],["T_FOREACH","foreach",516],["T_WHITESPACE"," ",516],"(",["T_VARIABLE","$mediaAttribute",516],["T_WHITESPACE"," ",516],["T_AS","as",516],["T_WHITESPACE"," ",516],["T_VARIABLE","$atttribute",516],")",["T_WHITESPACE"," ",516],"{",["T_WHITESPACE","\n                ",516],["T_IF","if",517],["T_WHITESPACE"," ",517],"(",["T_STRING","in_array",517],"(",["T_VARIABLE","$atttribute",517],",",["T_WHITESPACE"," ",517],["T_VARIABLE","$mediaAttributeCodes",517],")",")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n                    ",517],["T_VARIABLE","$product",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","setData",518],"(",["T_VARIABLE","$atttribute",518],",",["T_WHITESPACE"," ",518],["T_VARIABLE","$value",518],")",";",["T_WHITESPACE","\n                ",518],"}",["T_WHITESPACE","\n            ",519],"}",["T_WHITESPACE","\n        ",520],"}",["T_WHITESPACE"," ",521],["T_ELSEIF","elseif",521],["T_WHITESPACE"," ",521],"(",["T_STRING","in_array",521],"(",["T_VARIABLE","$mediaAttribute",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$mediaAttributeCodes",521],")",")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$product",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","setData",522],"(",["T_VARIABLE","$mediaAttribute",522],",",["T_WHITESPACE"," ",522],["T_VARIABLE","$value",522],")",";",["T_WHITESPACE","\n        ",522],"}",["T_WHITESPACE","\n\n        ",523],["T_RETURN","return",525],["T_WHITESPACE"," ",525],["T_VARIABLE","$this",525],";",["T_WHITESPACE","\n    ",525],"}",["T_WHITESPACE","\n\n    ",526],["T_DOC_COMMENT","\/**\n     * Retrieve resource model\n     *\n     * @return Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Attribute_Backend_Media\n     *\/",528],["T_WHITESPACE","\n    ",532],["T_PROTECTED","protected",533],["T_WHITESPACE"," ",533],["T_FUNCTION","function",533],["T_WHITESPACE"," ",533],["T_STRING","_getResource",533],"(",")",["T_WHITESPACE","\n    ",533],"{",["T_WHITESPACE","\n        ",534],["T_RETURN","return",535],["T_WHITESPACE"," ",535],["T_STRING","Mage",535],["T_DOUBLE_COLON","::",535],["T_STRING","getResourceSingleton",535],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_backend_media'",535],")",";",["T_WHITESPACE","\n    ",535],"}",["T_WHITESPACE","\n\n    ",536],["T_DOC_COMMENT","\/**\n     * Retrive media config\n     *\n     * @return Mage_Catalog_Model_Product_Media_Config\n     *\/",538],["T_WHITESPACE","\n    ",542],["T_PROTECTED","protected",543],["T_WHITESPACE"," ",543],["T_FUNCTION","function",543],["T_WHITESPACE"," ",543],["T_STRING","_getConfig",543],"(",")",["T_WHITESPACE","\n    ",543],"{",["T_WHITESPACE","\n        ",544],["T_RETURN","return",545],["T_WHITESPACE"," ",545],["T_STRING","Mage",545],["T_DOUBLE_COLON","::",545],["T_STRING","getSingleton",545],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_media_config'",545],")",";",["T_WHITESPACE","\n    ",545],"}",["T_WHITESPACE","\n\n    ",546],["T_DOC_COMMENT","\/**\n     * Move image from temporary directory to normal\n     *\n     * @param string $file\n     * @return string\n     *\/",548],["T_WHITESPACE","\n    ",553],["T_PROTECTED","protected",554],["T_WHITESPACE"," ",554],["T_FUNCTION","function",554],["T_WHITESPACE"," ",554],["T_STRING","_moveImageFromTmp",554],"(",["T_VARIABLE","$file",554],")",["T_WHITESPACE","\n    ",554],"{",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$ioObject",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_NEW","new",556],["T_WHITESPACE"," ",556],["T_STRING","Varien_Io_File",556],"(",")",";",["T_WHITESPACE","\n        ",556],["T_VARIABLE","$destDirectory",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_STRING","dirname",557],"(",["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_getConfig",557],"(",")",["T_OBJECT_OPERATOR","->",557],["T_STRING","getMediaPath",557],"(",["T_VARIABLE","$file",557],")",")",";",["T_WHITESPACE","\n        ",557],["T_TRY","try",558],["T_WHITESPACE"," ",558],"{",["T_WHITESPACE","\n            ",558],["T_VARIABLE","$ioObject",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","open",559],"(",["T_ARRAY","array",559],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",559],["T_DOUBLE_ARROW","=>",559],["T_VARIABLE","$destDirectory",559],")",")",";",["T_WHITESPACE","\n        ",559],"}",["T_WHITESPACE"," ",560],["T_CATCH","catch",560],["T_WHITESPACE"," ",560],"(",["T_STRING","Exception",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$e",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n            ",560],["T_VARIABLE","$ioObject",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","mkdir",561],"(",["T_VARIABLE","$destDirectory",561],",",["T_WHITESPACE"," ",561],["T_LNUMBER","0777",561],",",["T_WHITESPACE"," ",561],["T_STRING","true",561],")",";",["T_WHITESPACE","\n            ",561],["T_VARIABLE","$ioObject",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","open",562],"(",["T_ARRAY","array",562],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",562],["T_DOUBLE_ARROW","=>",562],["T_VARIABLE","$destDirectory",562],")",")",";",["T_WHITESPACE","\n        ",562],"}",["T_WHITESPACE","\n\n        ",563],["T_IF","if",565],["T_WHITESPACE"," ",565],"(",["T_STRING","strrpos",565],"(",["T_VARIABLE","$file",565],",",["T_WHITESPACE"," ",565],["T_CONSTANT_ENCAPSED_STRING","'.tmp'",565],")",["T_WHITESPACE"," ",565],["T_IS_EQUAL","==",565],["T_WHITESPACE"," ",565],["T_STRING","strlen",565],"(",["T_VARIABLE","$file",565],")","-",["T_LNUMBER","4",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n            ",565],["T_VARIABLE","$file",566],["T_WHITESPACE"," ",566],"=",["T_WHITESPACE"," ",566],["T_STRING","substr",566],"(",["T_VARIABLE","$file",566],",",["T_WHITESPACE"," ",566],["T_LNUMBER","0",566],",",["T_WHITESPACE"," ",566],["T_STRING","strlen",566],"(",["T_VARIABLE","$file",566],")","-",["T_LNUMBER","4",566],")",";",["T_WHITESPACE","\n        ",566],"}",["T_WHITESPACE","\n        ",567],["T_VARIABLE","$destFile",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_getUniqueFileName",568],"(",["T_VARIABLE","$file",568],",",["T_WHITESPACE"," ",568],["T_VARIABLE","$ioObject",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","dirsep",568],"(",")",")",";",["T_WHITESPACE","\n\n        ",568],["T_DOC_COMMENT","\/** @var $storageHelper Mage_Core_Helper_File_Storage_Database *\/",570],["T_WHITESPACE","\n        ",570],["T_VARIABLE","$storageHelper",571],["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_STRING","Mage",571],["T_DOUBLE_COLON","::",571],["T_STRING","helper",571],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",571],")",";",["T_WHITESPACE","\n\n        ",571],["T_IF","if",573],["T_WHITESPACE"," ",573],"(",["T_VARIABLE","$storageHelper",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","checkDbUsage",573],"(",")",")",["T_WHITESPACE"," ",573],"{",["T_WHITESPACE","\n            ",573],["T_VARIABLE","$storageHelper",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","renameFile",574],"(",["T_WHITESPACE","\n                ",574],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","_getConfig",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","getTmpMediaShortUrl",575],"(",["T_VARIABLE","$file",575],")",",",["T_WHITESPACE","\n                ",575],["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","_getConfig",576],"(",")",["T_OBJECT_OPERATOR","->",576],["T_STRING","getMediaShortUrl",576],"(",["T_VARIABLE","$destFile",576],")",")",";",["T_WHITESPACE","\n\n            ",576],["T_VARIABLE","$ioObject",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","rm",578],"(",["T_VARIABLE","$this",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","_getConfig",578],"(",")",["T_OBJECT_OPERATOR","->",578],["T_STRING","getTmpMediaPath",578],"(",["T_VARIABLE","$file",578],")",")",";",["T_WHITESPACE","\n            ",578],["T_VARIABLE","$ioObject",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","rm",579],"(",["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","_getConfig",579],"(",")",["T_OBJECT_OPERATOR","->",579],["T_STRING","getMediaPath",579],"(",["T_VARIABLE","$destFile",579],")",")",";",["T_WHITESPACE","\n        ",579],"}",["T_WHITESPACE"," ",580],["T_ELSE","else",580],["T_WHITESPACE"," ",580],"{",["T_WHITESPACE","\n            ",580],["T_VARIABLE","$ioObject",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","mv",581],"(",["T_WHITESPACE","\n                ",581],["T_VARIABLE","$this",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","_getConfig",582],"(",")",["T_OBJECT_OPERATOR","->",582],["T_STRING","getTmpMediaPath",582],"(",["T_VARIABLE","$file",582],")",",",["T_WHITESPACE","\n                ",582],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","_getConfig",583],"(",")",["T_OBJECT_OPERATOR","->",583],["T_STRING","getMediaPath",583],"(",["T_VARIABLE","$destFile",583],")",["T_WHITESPACE","\n            ",583],")",";",["T_WHITESPACE","\n        ",584],"}",["T_WHITESPACE","\n\n        ",585],["T_RETURN","return",587],["T_WHITESPACE"," ",587],["T_STRING","str_replace",587],"(",["T_VARIABLE","$ioObject",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","dirsep",587],"(",")",",",["T_WHITESPACE"," ",587],["T_CONSTANT_ENCAPSED_STRING","'\/'",587],",",["T_WHITESPACE"," ",587],["T_VARIABLE","$destFile",587],")",";",["T_WHITESPACE","\n    ",587],"}",["T_WHITESPACE","\n\n    ",588],["T_DOC_COMMENT","\/**\n     * Check whether file to move exists. Getting unique name\n     *\n     * @param <type> $file\n     * @param <type> $dirsep\n     * @return string\n     *\/",590],["T_WHITESPACE","\n    ",596],["T_PROTECTED","protected",597],["T_WHITESPACE"," ",597],["T_FUNCTION","function",597],["T_WHITESPACE"," ",597],["T_STRING","_getUniqueFileName",597],"(",["T_VARIABLE","$file",597],",",["T_WHITESPACE"," ",597],["T_VARIABLE","$dirsep",597],")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n        ",597],["T_IF","if",598],["T_WHITESPACE"," ",598],"(",["T_STRING","Mage",598],["T_DOUBLE_COLON","::",598],["T_STRING","helper",598],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",598],")",["T_OBJECT_OPERATOR","->",598],["T_STRING","checkDbUsage",598],"(",")",")",["T_WHITESPACE"," ",598],"{",["T_WHITESPACE","\n            ",598],["T_VARIABLE","$destFile",599],["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_STRING","Mage",599],["T_DOUBLE_COLON","::",599],["T_STRING","helper",599],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",599],")",["T_WHITESPACE","\n                ",599],["T_OBJECT_OPERATOR","->",600],["T_STRING","getUniqueFilename",600],"(",["T_WHITESPACE","\n                    ",600],["T_STRING","Mage",601],["T_DOUBLE_COLON","::",601],["T_STRING","getSingleton",601],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_media_config'",601],")",["T_OBJECT_OPERATOR","->",601],["T_STRING","getBaseMediaUrlAddition",601],"(",")",",",["T_WHITESPACE","\n                    ",601],["T_VARIABLE","$file",602],["T_WHITESPACE","\n                ",602],")",";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE"," ",604],["T_ELSE","else",604],["T_WHITESPACE"," ",604],"{",["T_WHITESPACE","\n            ",604],["T_VARIABLE","$destFile",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_STRING","dirname",605],"(",["T_VARIABLE","$file",605],")",["T_WHITESPACE"," ",605],".",["T_WHITESPACE"," ",605],["T_VARIABLE","$dirsep",605],["T_WHITESPACE","\n                ",605],".",["T_WHITESPACE"," ",606],["T_STRING","Mage_Core_Model_File_Uploader",606],["T_DOUBLE_COLON","::",606],["T_STRING","getNewFileName",606],"(",["T_VARIABLE","$this",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","_getConfig",606],"(",")",["T_OBJECT_OPERATOR","->",606],["T_STRING","getMediaPath",606],"(",["T_VARIABLE","$file",606],")",")",";",["T_WHITESPACE","\n        ",606],"}",["T_WHITESPACE","\n\n        ",607],["T_RETURN","return",609],["T_WHITESPACE"," ",609],["T_VARIABLE","$destFile",609],";",["T_WHITESPACE","\n    ",609],"}",["T_WHITESPACE","\n\n    ",610],["T_DOC_COMMENT","\/**\n     * Copy image and return new filename.\n     *\n     * @param string $file\n     * @return string\n     *\/",612],["T_WHITESPACE","\n    ",617],["T_PROTECTED","protected",618],["T_WHITESPACE"," ",618],["T_FUNCTION","function",618],["T_WHITESPACE"," ",618],["T_STRING","_copyImage",618],"(",["T_VARIABLE","$file",618],")",["T_WHITESPACE","\n    ",618],"{",["T_WHITESPACE","\n        ",619],["T_TRY","try",620],["T_WHITESPACE"," ",620],"{",["T_WHITESPACE","\n            ",620],["T_VARIABLE","$ioObject",621],["T_WHITESPACE"," ",621],"=",["T_WHITESPACE"," ",621],["T_NEW","new",621],["T_WHITESPACE"," ",621],["T_STRING","Varien_Io_File",621],"(",")",";",["T_WHITESPACE","\n            ",621],["T_VARIABLE","$destDirectory",622],["T_WHITESPACE"," ",622],"=",["T_WHITESPACE"," ",622],["T_STRING","dirname",622],"(",["T_VARIABLE","$this",622],["T_OBJECT_OPERATOR","->",622],["T_STRING","_getConfig",622],"(",")",["T_OBJECT_OPERATOR","->",622],["T_STRING","getMediaPath",622],"(",["T_VARIABLE","$file",622],")",")",";",["T_WHITESPACE","\n            ",622],["T_VARIABLE","$ioObject",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","open",623],"(",["T_ARRAY","array",623],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",623],["T_DOUBLE_ARROW","=>",623],["T_VARIABLE","$destDirectory",623],")",")",";",["T_WHITESPACE","\n\n            ",623],["T_VARIABLE","$destFile",625],["T_WHITESPACE"," ",625],"=",["T_WHITESPACE"," ",625],["T_VARIABLE","$this",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","_getUniqueFileName",625],"(",["T_VARIABLE","$file",625],",",["T_WHITESPACE"," ",625],["T_VARIABLE","$ioObject",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","dirsep",625],"(",")",")",";",["T_WHITESPACE","\n\n            ",625],["T_IF","if",627],["T_WHITESPACE"," ",627],"(","!",["T_VARIABLE","$ioObject",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","fileExists",627],"(",["T_VARIABLE","$this",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","_getConfig",627],"(",")",["T_OBJECT_OPERATOR","->",627],["T_STRING","getMediaPath",627],"(",["T_VARIABLE","$file",627],")",",",["T_STRING","true",627],")",")",["T_WHITESPACE"," ",627],"{",["T_WHITESPACE","\n                ",627],["T_THROW","throw",628],["T_WHITESPACE"," ",628],["T_NEW","new",628],["T_WHITESPACE"," ",628],["T_STRING","Exception",628],"(",")",";",["T_WHITESPACE","\n            ",628],"}",["T_WHITESPACE","\n\n            ",629],["T_IF","if",631],["T_WHITESPACE"," ",631],"(",["T_STRING","Mage",631],["T_DOUBLE_COLON","::",631],["T_STRING","helper",631],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",631],")",["T_OBJECT_OPERATOR","->",631],["T_STRING","checkDbUsage",631],"(",")",")",["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n                ",631],["T_STRING","Mage",632],["T_DOUBLE_COLON","::",632],["T_STRING","helper",632],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",632],")",["T_WHITESPACE","\n                    ",632],["T_OBJECT_OPERATOR","->",633],["T_STRING","copyFile",633],"(",["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","_getConfig",633],"(",")",["T_OBJECT_OPERATOR","->",633],["T_STRING","getMediaShortUrl",633],"(",["T_VARIABLE","$file",633],")",",",["T_WHITESPACE","\n                               ",633],["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","_getConfig",634],"(",")",["T_OBJECT_OPERATOR","->",634],["T_STRING","getMediaShortUrl",634],"(",["T_VARIABLE","$destFile",634],")",")",";",["T_WHITESPACE","\n\n                ",634],["T_VARIABLE","$ioObject",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","rm",636],"(",["T_VARIABLE","$this",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","_getConfig",636],"(",")",["T_OBJECT_OPERATOR","->",636],["T_STRING","getMediaPath",636],"(",["T_VARIABLE","$destFile",636],")",")",";",["T_WHITESPACE","\n            ",636],"}",["T_WHITESPACE"," ",637],["T_ELSE","else",637],["T_WHITESPACE"," ",637],"{",["T_WHITESPACE","\n                ",637],["T_VARIABLE","$ioObject",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","cp",638],"(",["T_WHITESPACE","\n                    ",638],["T_VARIABLE","$this",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","_getConfig",639],"(",")",["T_OBJECT_OPERATOR","->",639],["T_STRING","getMediaPath",639],"(",["T_VARIABLE","$file",639],")",",",["T_WHITESPACE","\n                    ",639],["T_VARIABLE","$this",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","_getConfig",640],"(",")",["T_OBJECT_OPERATOR","->",640],["T_STRING","getMediaPath",640],"(",["T_VARIABLE","$destFile",640],")",["T_WHITESPACE","\n                ",640],")",";",["T_WHITESPACE","\n            ",641],"}",["T_WHITESPACE","\n\n        ",642],"}",["T_WHITESPACE"," ",644],["T_CATCH","catch",644],["T_WHITESPACE"," ",644],"(",["T_STRING","Exception",644],["T_WHITESPACE"," ",644],["T_VARIABLE","$e",644],")",["T_WHITESPACE"," ",644],"{",["T_WHITESPACE","\n            ",644],["T_VARIABLE","$file",645],["T_WHITESPACE"," ",645],"=",["T_WHITESPACE"," ",645],["T_VARIABLE","$this",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","_getConfig",645],"(",")",["T_OBJECT_OPERATOR","->",645],["T_STRING","getMediaPath",645],"(",["T_VARIABLE","$file",645],")",";",["T_WHITESPACE","\n            ",645],["T_VARIABLE","$io",646],["T_WHITESPACE"," ",646],"=",["T_WHITESPACE"," ",646],["T_NEW","new",646],["T_WHITESPACE"," ",646],["T_STRING","Varien_Io_File",646],"(",")",";",["T_WHITESPACE","\n            ",646],["T_STRING","Mage",647],["T_DOUBLE_COLON","::",647],["T_STRING","throwException",647],"(",["T_WHITESPACE","\n                ",647],["T_STRING","Mage",648],["T_DOUBLE_COLON","::",648],["T_STRING","helper",648],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",648],")",["T_OBJECT_OPERATOR","->",648],["T_STRING","__",648],"(",["T_WHITESPACE","\n                    ",648],["T_CONSTANT_ENCAPSED_STRING","'Failed to copy file %s. Please, delete media with non-existing images and try again.'",649],",",["T_WHITESPACE","\n                    ",649],["T_VARIABLE","$io",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getFilteredPath",650],"(",["T_VARIABLE","$file",650],")",")",["T_WHITESPACE","\n            ",650],")",";",["T_WHITESPACE","\n        ",651],"}",["T_WHITESPACE","\n\n        ",652],["T_RETURN","return",654],["T_WHITESPACE"," ",654],["T_STRING","str_replace",654],"(",["T_VARIABLE","$ioObject",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","dirsep",654],"(",")",",",["T_WHITESPACE"," ",654],["T_CONSTANT_ENCAPSED_STRING","'\/'",654],",",["T_WHITESPACE"," ",654],["T_VARIABLE","$destFile",654],")",";",["T_WHITESPACE","\n    ",654],"}",["T_WHITESPACE","\n\n    ",655],["T_PUBLIC","public",657],["T_WHITESPACE"," ",657],["T_FUNCTION","function",657],["T_WHITESPACE"," ",657],["T_STRING","duplicate",657],"(",["T_VARIABLE","$object",657],")",["T_WHITESPACE","\n    ",657],"{",["T_WHITESPACE","\n        ",658],["T_VARIABLE","$attrCode",659],["T_WHITESPACE"," ",659],"=",["T_WHITESPACE"," ",659],["T_VARIABLE","$this",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","getAttribute",659],"(",")",["T_OBJECT_OPERATOR","->",659],["T_STRING","getAttributeCode",659],"(",")",";",["T_WHITESPACE","\n        ",659],["T_VARIABLE","$mediaGalleryData",660],["T_WHITESPACE"," ",660],"=",["T_WHITESPACE"," ",660],["T_VARIABLE","$object",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","getData",660],"(",["T_VARIABLE","$attrCode",660],")",";",["T_WHITESPACE","\n\n        ",660],["T_IF","if",662],["T_WHITESPACE"," ",662],"(","!",["T_ISSET","isset",662],"(",["T_VARIABLE","$mediaGalleryData",662],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",662],"]",")",["T_WHITESPACE"," ",662],["T_BOOLEAN_OR","||",662],["T_WHITESPACE"," ",662],"!",["T_STRING","is_array",662],"(",["T_VARIABLE","$mediaGalleryData",662],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",662],"]",")",")",["T_WHITESPACE"," ",662],"{",["T_WHITESPACE","\n            ",662],["T_RETURN","return",663],["T_WHITESPACE"," ",663],["T_VARIABLE","$this",663],";",["T_WHITESPACE","\n        ",663],"}",["T_WHITESPACE","\n\n        ",664],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","_getResource",666],"(",")",["T_OBJECT_OPERATOR","->",666],["T_STRING","duplicate",666],"(",["T_WHITESPACE","\n            ",666],["T_VARIABLE","$this",667],",",["T_WHITESPACE","\n            ",667],"(",["T_ISSET","isset",668],"(",["T_VARIABLE","$mediaGalleryData",668],"[",["T_CONSTANT_ENCAPSED_STRING","'duplicate'",668],"]",")",["T_WHITESPACE"," ",668],"?",["T_WHITESPACE"," ",668],["T_VARIABLE","$mediaGalleryData",668],"[",["T_CONSTANT_ENCAPSED_STRING","'duplicate'",668],"]",["T_WHITESPACE"," ",668],":",["T_WHITESPACE"," ",668],["T_ARRAY","array",668],"(",")",")",",",["T_WHITESPACE","\n            ",668],["T_VARIABLE","$object",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getOriginalId",669],"(",")",",",["T_WHITESPACE","\n            ",669],["T_VARIABLE","$object",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getId",670],"(",")",["T_WHITESPACE","\n        ",670],")",";",["T_WHITESPACE","\n\n        ",671],["T_RETURN","return",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$this",673],";",["T_WHITESPACE","\n    ",673],"}",["T_WHITESPACE","\n\n    ",674],["T_DOC_COMMENT","\/**\n     * Get filename which is not duplicated with other files in media temporary and media directories\n     *\n     * @param String $fileName\n     * @param String $dispretionPath\n     * @return String\n     *\/",676],["T_WHITESPACE","\n    ",682],["T_PROTECTED","protected",683],["T_WHITESPACE"," ",683],["T_FUNCTION","function",683],["T_WHITESPACE"," ",683],["T_STRING","_getNotDuplicatedFilename",683],"(",["T_VARIABLE","$fileName",683],",",["T_WHITESPACE"," ",683],["T_VARIABLE","$dispretionPath",683],")",["T_WHITESPACE","\n    ",683],"{",["T_WHITESPACE","\n        ",684],["T_VARIABLE","$fileMediaName",685],["T_WHITESPACE"," ",685],"=",["T_WHITESPACE"," ",685],["T_VARIABLE","$dispretionPath",685],["T_WHITESPACE"," ",685],".",["T_WHITESPACE"," ",685],["T_STRING","DS",685],["T_WHITESPACE","\n                  ",685],".",["T_WHITESPACE"," ",686],["T_STRING","Mage_Core_Model_File_Uploader",686],["T_DOUBLE_COLON","::",686],["T_STRING","getNewFileName",686],"(",["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","_getConfig",686],"(",")",["T_OBJECT_OPERATOR","->",686],["T_STRING","getMediaPath",686],"(",["T_VARIABLE","$fileName",686],")",")",";",["T_WHITESPACE","\n        ",686],["T_VARIABLE","$fileTmpMediaName",687],["T_WHITESPACE"," ",687],"=",["T_WHITESPACE"," ",687],["T_VARIABLE","$dispretionPath",687],["T_WHITESPACE"," ",687],".",["T_WHITESPACE"," ",687],["T_STRING","DS",687],["T_WHITESPACE","\n                  ",687],".",["T_WHITESPACE"," ",688],["T_STRING","Mage_Core_Model_File_Uploader",688],["T_DOUBLE_COLON","::",688],["T_STRING","getNewFileName",688],"(",["T_VARIABLE","$this",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","_getConfig",688],"(",")",["T_OBJECT_OPERATOR","->",688],["T_STRING","getTmpMediaPath",688],"(",["T_VARIABLE","$fileName",688],")",")",";",["T_WHITESPACE","\n\n        ",688],["T_IF","if",690],["T_WHITESPACE"," ",690],"(",["T_VARIABLE","$fileMediaName",690],["T_WHITESPACE"," ",690],["T_IS_NOT_EQUAL","!=",690],["T_WHITESPACE"," ",690],["T_VARIABLE","$fileTmpMediaName",690],")",["T_WHITESPACE"," ",690],"{",["T_WHITESPACE","\n            ",690],["T_IF","if",691],["T_WHITESPACE"," ",691],"(",["T_VARIABLE","$fileMediaName",691],["T_WHITESPACE"," ",691],["T_IS_NOT_EQUAL","!=",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$fileName",691],")",["T_WHITESPACE"," ",691],"{",["T_WHITESPACE","\n                ",691],["T_RETURN","return",692],["T_WHITESPACE"," ",692],["T_VARIABLE","$this",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","_getNotDuplicatedFileName",692],"(",["T_VARIABLE","$fileMediaName",692],",",["T_WHITESPACE"," ",692],["T_VARIABLE","$dispretionPath",692],")",";",["T_WHITESPACE","\n            ",692],"}",["T_WHITESPACE"," ",693],["T_ELSEIF","elseif",693],["T_WHITESPACE"," ",693],"(",["T_VARIABLE","$fileTmpMediaName",693],["T_WHITESPACE"," ",693],["T_IS_NOT_EQUAL","!=",693],["T_WHITESPACE"," ",693],["T_VARIABLE","$fileName",693],")",["T_WHITESPACE"," ",693],"{",["T_WHITESPACE","\n                ",693],["T_RETURN","return",694],["T_WHITESPACE"," ",694],["T_VARIABLE","$this",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","_getNotDuplicatedFilename",694],"(",["T_VARIABLE","$fileTmpMediaName",694],",",["T_WHITESPACE"," ",694],["T_VARIABLE","$dispretionPath",694],")",";",["T_WHITESPACE","\n            ",694],"}",["T_WHITESPACE","\n        ",695],"}",["T_WHITESPACE","\n\n        ",696],["T_RETURN","return",698],["T_WHITESPACE"," ",698],["T_VARIABLE","$fileMediaName",698],";",["T_WHITESPACE","\n    ",698],"}",["T_WHITESPACE","\n",699],"}",["T_WHITESPACE"," ",700],["T_COMMENT","\/\/ Class Mage_Catalog_Model_Product_Attribute_Backend_Media End\n",700]]