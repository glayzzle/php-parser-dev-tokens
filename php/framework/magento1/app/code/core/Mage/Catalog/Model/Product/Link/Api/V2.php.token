[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog product link api V2\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Link_Api_V2",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Link_Api",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Add product link association\n     *\n     * @param string $type\n     * @param int|string $productId\n     * @param int|string $linkedProductId\n     * @param array $data\n     * @return boolean\n     *\/",36],["T_WHITESPACE","\n    ",44],["T_PUBLIC","public",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","assign",45],"(",["T_VARIABLE","$type",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$productId",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$linkedProductId",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$data",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],"(",")",",",["T_WHITESPACE"," ",45],["T_VARIABLE","$identifierType",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","null",45],")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$typeId",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_getTypeId",47],"(",["T_VARIABLE","$type",47],")",";",["T_WHITESPACE","\n\n        ",47],["T_VARIABLE","$product",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_initProduct",49],"(",["T_VARIABLE","$productId",49],",",["T_WHITESPACE"," ",49],["T_VARIABLE","$identifierType",49],")",";",["T_WHITESPACE","\n\n        ",49],["T_VARIABLE","$link",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$product",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getLinkInstance",51],"(",")",["T_WHITESPACE","\n            ",51],["T_OBJECT_OPERATOR","->",52],["T_STRING","setLinkTypeId",52],"(",["T_VARIABLE","$typeId",52],")",";",["T_WHITESPACE","\n\n        ",52],["T_VARIABLE","$collection",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_initCollection",54],"(",["T_VARIABLE","$link",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$product",54],")",";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$idBySku",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$product",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getIdBySku",55],"(",["T_VARIABLE","$linkedProductId",55],")",";",["T_WHITESPACE","\n        ",55],["T_IF","if",56],["T_WHITESPACE"," ",56],"(",["T_VARIABLE","$idBySku",56],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$linkedProductId",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$idBySku",57],";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$links",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_collectionToEditableArray",60],"(",["T_VARIABLE","$collection",60],")",";",["T_WHITESPACE","\n\n        ",60],["T_VARIABLE","$links",62],"[",["T_INT_CAST","(int)",62],["T_VARIABLE","$linkedProductId",62],"]",["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_ARRAY","array",62],"(",")",";",["T_WHITESPACE","\n        ",62],["T_FOREACH","foreach",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$collection",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getLinkModel",63],"(",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","getAttributes",63],"(",")",["T_WHITESPACE"," ",63],["T_AS","as",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$attribute",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_IF","if",64],["T_WHITESPACE"," ",64],"(",["T_ISSET","isset",64],"(",["T_VARIABLE","$data",64],["T_OBJECT_OPERATOR","->",64],"{",["T_VARIABLE","$attribute",64],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",64],"]","}",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n                ",64],["T_VARIABLE","$links",65],"[",["T_INT_CAST","(int)",65],["T_VARIABLE","$linkedProductId",65],"]","[",["T_VARIABLE","$attribute",65],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",65],"]","]",["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$data",65],["T_OBJECT_OPERATOR","->",65],"{",["T_VARIABLE","$attribute",65],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",65],"]","}",";",["T_WHITESPACE","\n            ",65],"}",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE","\n\n        ",67],["T_TRY","try",69],["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$type",70],["T_WHITESPACE"," ",70],["T_IS_EQUAL","==",70],["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'grouped'",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$link",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getResource",71],"(",")",["T_OBJECT_OPERATOR","->",71],["T_STRING","saveGroupedLinks",71],"(",["T_VARIABLE","$product",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$links",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$typeId",71],")",";",["T_WHITESPACE","\n            ",71],"}",["T_WHITESPACE"," ",72],["T_ELSE","else",72],["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n                ",72],["T_VARIABLE","$link",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getResource",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","saveProductLinks",73],"(",["T_VARIABLE","$product",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$links",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$typeId",73],")",";",["T_WHITESPACE","\n            ",73],"}",["T_WHITESPACE","\n\n            ",74],["T_VARIABLE","$_linkInstance",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","Mage",76],["T_DOUBLE_COLON","::",76],["T_STRING","getSingleton",76],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_link'",76],")",";",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$_linkInstance",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","saveProductRelations",77],"(",["T_VARIABLE","$product",77],")",";",["T_WHITESPACE","\n\n            ",77],["T_VARIABLE","$indexerStock",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_STRING","Mage",79],["T_DOUBLE_COLON","::",79],["T_STRING","getModel",79],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",79],")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$indexerStock",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","updateStatus",80],"(",["T_VARIABLE","$productId",80],")",";",["T_WHITESPACE","\n\n            ",80],["T_VARIABLE","$indexerPrice",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","Mage",82],["T_DOUBLE_COLON","::",82],["T_STRING","getResourceModel",82],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_indexer_price'",82],")",";",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$indexerPrice",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","reindexProductIds",83],"(",["T_VARIABLE","$productId",83],")",";",["T_WHITESPACE","\n\n        ",83],"}",["T_WHITESPACE"," ",85],["T_CATCH","catch",85],["T_WHITESPACE"," ",85],"(",["T_STRING","Exception",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$e",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_fault",86],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$e",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getMessage",86],"(",")",")",";",["T_WHITESPACE","\n            ",86],["T_COMMENT","\/\/$this->_fault('data_invalid', Mage::helper('catalog')->__('Link product does not exist.'));\n",87],["T_WHITESPACE","        ",88],"}",["T_WHITESPACE","\n\n        ",88],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_STRING","true",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Update product link association info\n     *\n     * @param string $type\n     * @param int|string $productId\n     * @param int|string $linkedProductId\n     * @param array $data\n     * @return boolean\n     *\/",93],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","update",102],"(",["T_VARIABLE","$type",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$productId",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$linkedProductId",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$data",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_ARRAY","array",102],"(",")",",",["T_WHITESPACE"," ",102],["T_VARIABLE","$identifierType",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","null",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$typeId",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_getTypeId",104],"(",["T_VARIABLE","$type",104],")",";",["T_WHITESPACE","\n\n        ",104],["T_VARIABLE","$product",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_initProduct",106],"(",["T_VARIABLE","$productId",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$identifierType",106],")",";",["T_WHITESPACE","\n\n        ",106],["T_VARIABLE","$link",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$product",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getLinkInstance",108],"(",")",["T_WHITESPACE","\n            ",108],["T_OBJECT_OPERATOR","->",109],["T_STRING","setLinkTypeId",109],"(",["T_VARIABLE","$typeId",109],")",";",["T_WHITESPACE","\n\n        ",109],["T_VARIABLE","$collection",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_initCollection",111],"(",["T_VARIABLE","$link",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$product",111],")",";",["T_WHITESPACE","\n\n        ",111],["T_VARIABLE","$links",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_collectionToEditableArray",113],"(",["T_VARIABLE","$collection",113],")",";",["T_WHITESPACE","\n\n        ",113],["T_VARIABLE","$idBySku",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$product",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getIdBySku",115],"(",["T_VARIABLE","$linkedProductId",115],")",";",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$idBySku",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$linkedProductId",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$idBySku",117],";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n\n        ",118],["T_FOREACH","foreach",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$collection",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getLinkModel",120],"(",")",["T_OBJECT_OPERATOR","->",120],["T_STRING","getAttributes",120],"(",")",["T_WHITESPACE"," ",120],["T_AS","as",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$attribute",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_ISSET","isset",121],"(",["T_VARIABLE","$data",121],["T_OBJECT_OPERATOR","->",121],"{",["T_VARIABLE","$attribute",121],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",121],"]","}",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                ",121],["T_VARIABLE","$links",122],"[",["T_INT_CAST","(int)",122],["T_VARIABLE","$linkedProductId",122],"]","[",["T_VARIABLE","$attribute",122],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",122],"]","]",["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$data",122],["T_OBJECT_OPERATOR","->",122],"{",["T_VARIABLE","$attribute",122],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",122],"]","}",";",["T_WHITESPACE","\n            ",122],"}",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n\n        ",124],["T_TRY","try",126],["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$type",127],["T_WHITESPACE"," ",127],["T_IS_EQUAL","==",127],["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'grouped'",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n                ",127],["T_VARIABLE","$link",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getResource",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","saveGroupedLinks",128],"(",["T_VARIABLE","$product",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$links",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$typeId",128],")",";",["T_WHITESPACE","\n            ",128],"}",["T_WHITESPACE"," ",129],["T_ELSE","else",129],["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$link",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getResource",130],"(",")",["T_OBJECT_OPERATOR","->",130],["T_STRING","saveProductLinks",130],"(",["T_VARIABLE","$product",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$links",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$typeId",130],")",";",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE","\n\n            ",131],["T_VARIABLE","$_linkInstance",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","Mage",133],["T_DOUBLE_COLON","::",133],["T_STRING","getSingleton",133],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_link'",133],")",";",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$_linkInstance",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","saveProductRelations",134],"(",["T_VARIABLE","$product",134],")",";",["T_WHITESPACE","\n\n            ",134],["T_VARIABLE","$indexerStock",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","Mage",136],["T_DOUBLE_COLON","::",136],["T_STRING","getModel",136],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",136],")",";",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$indexerStock",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","updateStatus",137],"(",["T_VARIABLE","$productId",137],")",";",["T_WHITESPACE","\n\n            ",137],["T_VARIABLE","$indexerPrice",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","Mage",139],["T_DOUBLE_COLON","::",139],["T_STRING","getResourceModel",139],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_indexer_price'",139],")",";",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$indexerPrice",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","reindexProductIds",140],"(",["T_VARIABLE","$productId",140],")",";",["T_WHITESPACE","\n\n        ",140],"}",["T_WHITESPACE"," ",142],["T_CATCH","catch",142],["T_WHITESPACE"," ",142],"(",["T_STRING","Exception",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$e",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_fault",143],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",143],",",["T_WHITESPACE"," ",143],["T_STRING","Mage",143],["T_DOUBLE_COLON","::",143],["T_STRING","helper",143],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",143],")",["T_OBJECT_OPERATOR","->",143],["T_STRING","__",143],"(",["T_CONSTANT_ENCAPSED_STRING","'Link product does not exist.'",143],")",")",";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n\n        ",144],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_STRING","true",146],";",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n",147],"}",["T_WHITESPACE","\n",148]]