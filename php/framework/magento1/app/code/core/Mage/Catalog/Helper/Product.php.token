[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog category helper\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Catalog_Helper_Product",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Core_Helper_Url",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_CONST","const",34],["T_WHITESPACE"," ",34],["T_STRING","XML_PATH_PRODUCT_URL_SUFFIX",34],["T_WHITESPACE","           ",34],"=",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'catalog\/seo\/product_url_suffix'",34],";",["T_WHITESPACE","\n    ",34],["T_CONST","const",35],["T_WHITESPACE"," ",35],["T_STRING","XML_PATH_PRODUCT_URL_USE_CATEGORY",35],["T_WHITESPACE","     ",35],"=",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'catalog\/seo\/product_use_categories'",35],";",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","XML_PATH_USE_PRODUCT_CANONICAL_TAG",36],["T_WHITESPACE","    ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'catalog\/seo\/product_canonical_tag'",36],";",["T_WHITESPACE","\n\n    ",36],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","DEFAULT_QTY",38],["T_WHITESPACE","                           ",38],"=",["T_WHITESPACE"," ",38],["T_LNUMBER","1",38],";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Flag that shows if Magento has to check product to be saleable (enabled and\/or inStock)\n     *\n     * @var boolean\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_skipSaleableCheck",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","false",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Cache for product rewrite suffix\n     *\n     * @var array\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_productUrlSuffix",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_ARRAY","array",52],"(",")",";",["T_WHITESPACE","\n\n    ",52],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_statuses",54],";",["T_WHITESPACE","\n\n    ",54],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_priceBlock",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Retrieve product view page url\n     *\n     * @param   mixed $product\n     * @return  string\n     *\/",58],["T_WHITESPACE","\n    ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","getProductUrl",64],"(",["T_VARIABLE","$product",64],")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_IF","if",66],["T_WHITESPACE"," ",66],"(",["T_VARIABLE","$product",66],["T_WHITESPACE"," ",66],["T_INSTANCEOF","instanceof",66],["T_WHITESPACE"," ",66],["T_STRING","Mage_Catalog_Model_Product",66],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$product",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getProductUrl",67],"(",")",";",["T_WHITESPACE","\n        ",67],"}",["T_WHITESPACE","\n        ",68],["T_ELSEIF","elseif",69],["T_WHITESPACE"," ",69],"(",["T_STRING","is_numeric",69],"(",["T_VARIABLE","$product",69],")",")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_RETURN","return",70],["T_WHITESPACE"," ",70],["T_STRING","Mage",70],["T_DOUBLE_COLON","::",70],["T_STRING","getModel",70],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",70],")",["T_OBJECT_OPERATOR","->",70],["T_STRING","load",70],"(",["T_VARIABLE","$product",70],")",["T_OBJECT_OPERATOR","->",70],["T_STRING","getProductUrl",70],"(",")",";",["T_WHITESPACE","\n        ",70],"}",["T_WHITESPACE","\n        ",71],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_STRING","false",72],";",["T_WHITESPACE","\n    ",72],"}",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Retrieve product view page url including provided category Id\n     *\n     * @param   int $productId\n     * @param   int $categoryId\n     * @return  string\n     *\/",75],["T_WHITESPACE","\n    ",81],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","getFullProductUrl",82],"(",["T_VARIABLE","$productId",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$categoryId",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","null",82],")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$product",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","getModel",84],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",84],")",["T_OBJECT_OPERATOR","->",84],["T_STRING","load",84],"(",["T_VARIABLE","$productId",84],")",";",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$categoryId",85],["T_WHITESPACE"," ",85],["T_BOOLEAN_AND","&&",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$product",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","canBeShowInCategory",85],"(",["T_VARIABLE","$categoryId",85],")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$category",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","getModel",86],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",86],")",["T_OBJECT_OPERATOR","->",86],["T_STRING","load",86],"(",["T_VARIABLE","$categoryId",86],")",";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$product",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","setCategory",87],"(",["T_VARIABLE","$category",87],")",";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n        ",88],["T_RETURN","return",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$product",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getProductUrl",89],"(",")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Retrieve product price\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  float\n     *\/",92],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","getPrice",98],"(",["T_VARIABLE","$product",98],")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$product",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getPrice",100],"(",")",";",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Retrieve product final price\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  float\n     *\/",103],["T_WHITESPACE","\n    ",108],["T_PUBLIC","public",109],["T_WHITESPACE"," ",109],["T_FUNCTION","function",109],["T_WHITESPACE"," ",109],["T_STRING","getFinalPrice",109],"(",["T_VARIABLE","$product",109],")",["T_WHITESPACE","\n    ",109],"{",["T_WHITESPACE","\n        ",110],["T_RETURN","return",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$product",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getFinalPrice",111],"(",")",";",["T_WHITESPACE","\n    ",111],"}",["T_WHITESPACE","\n\n    ",112],["T_DOC_COMMENT","\/**\n     * Retrieve base image url\n     *\n     * @return string\n     *\/",114],["T_WHITESPACE","\n    ",118],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","getImageUrl",119],"(",["T_VARIABLE","$product",119],")",["T_WHITESPACE","\n    ",119],"{",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$url",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_STRING","false",121],";",["T_WHITESPACE","\n        ",121],["T_IF","if",122],["T_WHITESPACE"," ",122],"(","!",["T_VARIABLE","$product",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getImage",122],"(",")",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$url",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","Mage",123],["T_DOUBLE_COLON","::",123],["T_STRING","getDesign",123],"(",")",["T_OBJECT_OPERATOR","->",123],["T_STRING","getSkinUrl",123],"(",["T_CONSTANT_ENCAPSED_STRING","'images\/no_image.jpg'",123],")",";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n        ",124],["T_ELSEIF","elseif",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$attribute",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$product",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getResource",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","getAttribute",125],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",125],")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$url",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$attribute",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getFrontend",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getUrl",126],"(",["T_VARIABLE","$product",126],")",";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n        ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$url",128],";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * Retrieve small image url\n     *\n     * @return unknown\n     *\/",131],["T_WHITESPACE","\n    ",135],["T_PUBLIC","public",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","getSmallImageUrl",136],"(",["T_VARIABLE","$product",136],")",["T_WHITESPACE","\n    ",136],"{",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$url",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_STRING","false",138],";",["T_WHITESPACE","\n        ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(","!",["T_VARIABLE","$product",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getSmallImage",139],"(",")",")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$url",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","Mage",140],["T_DOUBLE_COLON","::",140],["T_STRING","getDesign",140],"(",")",["T_OBJECT_OPERATOR","->",140],["T_STRING","getSkinUrl",140],"(",["T_CONSTANT_ENCAPSED_STRING","'images\/no_image.jpg'",140],")",";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n        ",141],["T_ELSEIF","elseif",142],["T_WHITESPACE"," ",142],"(",["T_VARIABLE","$attribute",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$product",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getResource",142],"(",")",["T_OBJECT_OPERATOR","->",142],["T_STRING","getAttribute",142],"(",["T_CONSTANT_ENCAPSED_STRING","'small_image'",142],")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$url",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$attribute",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getFrontend",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","getUrl",143],"(",["T_VARIABLE","$product",143],")",";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$url",145],";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Retrieve thumbnail image url\n     *\n     * @return unknown\n     *\/",148],["T_WHITESPACE","\n    ",152],["T_PUBLIC","public",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","getThumbnailUrl",153],"(",["T_VARIABLE","$product",153],")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","''",155],";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_PUBLIC","public",158],["T_WHITESPACE"," ",158],["T_FUNCTION","function",158],["T_WHITESPACE"," ",158],["T_STRING","getEmailToFriendUrl",158],"(",["T_VARIABLE","$product",158],")",["T_WHITESPACE","\n    ",158],"{",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$categoryId",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","null",160],";",["T_WHITESPACE","\n        ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$category",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","Mage",161],["T_DOUBLE_COLON","::",161],["T_STRING","registry",161],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",161],")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$categoryId",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$category",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getId",162],"(",")",";",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n        ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_getUrl",164],"(",["T_CONSTANT_ENCAPSED_STRING","'sendfriend\/product\/send'",164],",",["T_WHITESPACE"," ",164],["T_ARRAY","array",164],"(",["T_WHITESPACE","\n            ",164],["T_CONSTANT_ENCAPSED_STRING","'id'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$product",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getId",165],"(",")",",",["T_WHITESPACE","\n            ",165],["T_CONSTANT_ENCAPSED_STRING","'cat_id'",166],["T_WHITESPACE"," ",166],["T_DOUBLE_ARROW","=>",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$categoryId",166],["T_WHITESPACE","\n        ",166],")",")",";",["T_WHITESPACE","\n    ",167],"}",["T_WHITESPACE","\n\n    ",168],["T_PUBLIC","public",170],["T_WHITESPACE"," ",170],["T_FUNCTION","function",170],["T_WHITESPACE"," ",170],["T_STRING","getStatuses",170],"(",")",["T_WHITESPACE","\n    ",170],"{",["T_WHITESPACE","\n        ",171],["T_IF","if",172],"(",["T_STRING","is_null",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_statuses",172],")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_statuses",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_ARRAY","array",173],"(",")",";",["T_COMMENT","\/\/Mage::getModel('catalog\/product_status')->getResourceCollection()->load();\n",173],["T_WHITESPACE","        ",174],"}",["T_WHITESPACE","\n\n        ",174],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_statuses",176],";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n\n    ",177],["T_DOC_COMMENT","\/**\n     * Check if a product can be shown\n     *\n     * @param  Mage_Catalog_Model_Product|int $product\n     * @return boolean\n     *\/",179],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","canShow",185],"(",["T_VARIABLE","$product",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$where",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'catalog'",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_STRING","is_int",187],"(",["T_VARIABLE","$product",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$product",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","Mage",188],["T_DOUBLE_COLON","::",188],["T_STRING","getModel",188],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",188],")",["T_OBJECT_OPERATOR","->",188],["T_STRING","load",188],"(",["T_VARIABLE","$product",188],")",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE","\n\n        ",189],["T_COMMENT","\/* @var $product Mage_Catalog_Model_Product *\/",191],["T_WHITESPACE","\n\n        ",191],["T_IF","if",193],["T_WHITESPACE"," ",193],"(","!",["T_VARIABLE","$product",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getId",193],"(",")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_RETURN","return",194],["T_WHITESPACE"," ",194],["T_STRING","false",194],";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n\n        ",195],["T_RETURN","return",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$product",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","isVisibleInCatalog",197],"(",")",["T_WHITESPACE"," ",197],["T_BOOLEAN_AND","&&",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$product",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","isVisibleInSiteVisibility",197],"(",")",";",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n\n    ",198],["T_DOC_COMMENT","\/**\n     * Retrieve product rewrite sufix for store\n     *\n     * @param int $storeId\n     * @return string\n     *\/",200],["T_WHITESPACE","\n    ",205],["T_PUBLIC","public",206],["T_WHITESPACE"," ",206],["T_FUNCTION","function",206],["T_WHITESPACE"," ",206],["T_STRING","getProductUrlSuffix",206],"(",["T_VARIABLE","$storeId",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_STRING","null",206],")",["T_WHITESPACE","\n    ",206],"{",["T_WHITESPACE","\n        ",207],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_STRING","is_null",208],"(",["T_VARIABLE","$storeId",208],")",")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$storeId",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_STRING","Mage",209],["T_DOUBLE_COLON","::",209],["T_STRING","app",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","getStore",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","getId",209],"(",")",";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n\n        ",210],["T_IF","if",212],["T_WHITESPACE"," ",212],"(","!",["T_ISSET","isset",212],"(",["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","_productUrlSuffix",212],"[",["T_VARIABLE","$storeId",212],"]",")",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_productUrlSuffix",213],"[",["T_VARIABLE","$storeId",213],"]",["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_STRING","Mage",213],["T_DOUBLE_COLON","::",213],["T_STRING","getStoreConfig",213],"(",["T_STRING","self",213],["T_DOUBLE_COLON","::",213],["T_STRING","XML_PATH_PRODUCT_URL_SUFFIX",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$storeId",213],")",";",["T_WHITESPACE","\n        ",213],"}",["T_WHITESPACE","\n        ",214],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_productUrlSuffix",215],"[",["T_VARIABLE","$storeId",215],"]",";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Check if <link rel=\"canonical\"> can be used for product\n     *\n     * @param $store\n     * @return bool\n     *\/",218],["T_WHITESPACE","\n    ",223],["T_PUBLIC","public",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","canUseCanonicalTag",224],"(",["T_VARIABLE","$store",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","null",224],")",["T_WHITESPACE","\n    ",224],"{",["T_WHITESPACE","\n        ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_STRING","Mage",226],["T_DOUBLE_COLON","::",226],["T_STRING","getStoreConfig",226],"(",["T_STRING","self",226],["T_DOUBLE_COLON","::",226],["T_STRING","XML_PATH_USE_PRODUCT_CANONICAL_TAG",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$store",226],")",";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_DOC_COMMENT","\/**\n     * Return information array of product attribute input types\n     * Only a small number of settings returned, so we won't break anything in current dataflow\n     * As soon as development process goes on we need to add there all possible settings\n     *\n     * @param string $inputType\n     * @return array\n     *\/",229],["T_WHITESPACE","\n    ",236],["T_PUBLIC","public",237],["T_WHITESPACE"," ",237],["T_FUNCTION","function",237],["T_WHITESPACE"," ",237],["T_STRING","getAttributeInputTypes",237],"(",["T_VARIABLE","$inputType",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_STRING","null",237],")",["T_WHITESPACE","\n    ",237],"{",["T_WHITESPACE","\n        ",238],["T_DOC_COMMENT","\/**\n        * @todo specify there all relations for properties depending on input type\n        *\/",239],["T_WHITESPACE","\n        ",241],["T_VARIABLE","$inputTypes",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_ARRAY","array",242],"(",["T_WHITESPACE","\n            ",242],["T_CONSTANT_ENCAPSED_STRING","'multiselect'",243],["T_WHITESPACE","   ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_ARRAY","array",243],"(",["T_WHITESPACE","\n                ",243],["T_CONSTANT_ENCAPSED_STRING","'backend_model'",244],["T_WHITESPACE","     ",244],["T_DOUBLE_ARROW","=>",244],["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'eav\/entity_attribute_backend_array'",244],["T_WHITESPACE","\n            ",244],")",",",["T_WHITESPACE","\n            ",245],["T_CONSTANT_ENCAPSED_STRING","'boolean'",246],["T_WHITESPACE","       ",246],["T_DOUBLE_ARROW","=>",246],["T_WHITESPACE"," ",246],["T_ARRAY","array",246],"(",["T_WHITESPACE","\n                ",246],["T_CONSTANT_ENCAPSED_STRING","'source_model'",247],["T_WHITESPACE","      ",247],["T_DOUBLE_ARROW","=>",247],["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","'eav\/entity_attribute_source_boolean'",247],["T_WHITESPACE","\n            ",247],")",["T_WHITESPACE","\n        ",248],")",";",["T_WHITESPACE","\n\n        ",249],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_STRING","is_null",251],"(",["T_VARIABLE","$inputType",251],")",")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n            ",251],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$inputTypes",252],";",["T_WHITESPACE","\n        ",252],"}",["T_WHITESPACE"," ",253],["T_ELSE","else",253],["T_WHITESPACE"," ",253],["T_IF","if",253],["T_WHITESPACE"," ",253],"(",["T_ISSET","isset",253],"(",["T_VARIABLE","$inputTypes",253],"[",["T_VARIABLE","$inputType",253],"]",")",")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n            ",253],["T_RETURN","return",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$inputTypes",254],"[",["T_VARIABLE","$inputType",254],"]",";",["T_WHITESPACE","\n        ",254],"}",["T_WHITESPACE","\n        ",255],["T_RETURN","return",256],["T_WHITESPACE"," ",256],["T_ARRAY","array",256],"(",")",";",["T_WHITESPACE","\n    ",256],"}",["T_WHITESPACE","\n\n    ",257],["T_DOC_COMMENT","\/**\n     * Return default attribute backend model by input type\n     *\n     * @param string $inputType\n     * @return string|null\n     *\/",259],["T_WHITESPACE","\n    ",264],["T_PUBLIC","public",265],["T_WHITESPACE"," ",265],["T_FUNCTION","function",265],["T_WHITESPACE"," ",265],["T_STRING","getAttributeBackendModelByInputType",265],"(",["T_VARIABLE","$inputType",265],")",["T_WHITESPACE","\n    ",265],"{",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$inputTypes",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getAttributeInputTypes",267],"(",")",";",["T_WHITESPACE","\n        ",267],["T_IF","if",268],["T_WHITESPACE"," ",268],"(","!",["T_EMPTY","empty",268],"(",["T_VARIABLE","$inputTypes",268],"[",["T_VARIABLE","$inputType",268],"]","[",["T_CONSTANT_ENCAPSED_STRING","'backend_model'",268],"]",")",")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n            ",268],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$inputTypes",269],"[",["T_VARIABLE","$inputType",269],"]","[",["T_CONSTANT_ENCAPSED_STRING","'backend_model'",269],"]",";",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE","\n        ",270],["T_RETURN","return",271],["T_WHITESPACE"," ",271],["T_STRING","null",271],";",["T_WHITESPACE","\n    ",271],"}",["T_WHITESPACE","\n\n    ",272],["T_DOC_COMMENT","\/**\n     * Return default attribute source model by input type\n     *\n     * @param string $inputType\n     * @return string|null\n     *\/",274],["T_WHITESPACE","\n    ",279],["T_PUBLIC","public",280],["T_WHITESPACE"," ",280],["T_FUNCTION","function",280],["T_WHITESPACE"," ",280],["T_STRING","getAttributeSourceModelByInputType",280],"(",["T_VARIABLE","$inputType",280],")",["T_WHITESPACE","\n    ",280],"{",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$inputTypes",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getAttributeInputTypes",282],"(",")",";",["T_WHITESPACE","\n        ",282],["T_IF","if",283],["T_WHITESPACE"," ",283],"(","!",["T_EMPTY","empty",283],"(",["T_VARIABLE","$inputTypes",283],"[",["T_VARIABLE","$inputType",283],"]","[",["T_CONSTANT_ENCAPSED_STRING","'source_model'",283],"]",")",")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_RETURN","return",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$inputTypes",284],"[",["T_VARIABLE","$inputType",284],"]","[",["T_CONSTANT_ENCAPSED_STRING","'source_model'",284],"]",";",["T_WHITESPACE","\n        ",284],"}",["T_WHITESPACE","\n        ",285],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_STRING","null",286],";",["T_WHITESPACE","\n    ",286],"}",["T_WHITESPACE","\n\n    ",287],["T_DOC_COMMENT","\/**\n     * Inits product to be used for product controller actions and layouts\n     * $params can have following data:\n     *   'category_id' - id of category to check and append to product as current.\n     *     If empty (except FALSE) - will be guessed (e.g. from last visited) to load as current.\n     *\n     * @param int $productId\n     * @param Mage_Core_Controller_Front_Action $controller\n     * @param Varien_Object $params\n     *\n     * @return false|Mage_Catalog_Model_Product\n     *\/",289],["T_WHITESPACE","\n    ",300],["T_PUBLIC","public",301],["T_WHITESPACE"," ",301],["T_FUNCTION","function",301],["T_WHITESPACE"," ",301],["T_STRING","initProduct",301],"(",["T_VARIABLE","$productId",301],",",["T_WHITESPACE"," ",301],["T_VARIABLE","$controller",301],",",["T_WHITESPACE"," ",301],["T_VARIABLE","$params",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_STRING","null",301],")",["T_WHITESPACE","\n    ",301],"{",["T_WHITESPACE","\n        ",302],["T_COMMENT","\/\/ Prepare data for routine\n",303],["T_WHITESPACE","        ",304],["T_IF","if",304],["T_WHITESPACE"," ",304],"(","!",["T_VARIABLE","$params",304],")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n            ",304],["T_VARIABLE","$params",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_NEW","new",305],["T_WHITESPACE"," ",305],["T_STRING","Varien_Object",305],"(",")",";",["T_WHITESPACE","\n        ",305],"}",["T_WHITESPACE","\n\n        ",306],["T_COMMENT","\/\/ Init and load product\n",308],["T_WHITESPACE","        ",309],["T_STRING","Mage",309],["T_DOUBLE_COLON","::",309],["T_STRING","dispatchEvent",309],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_controller_product_init_before'",309],",",["T_WHITESPACE"," ",309],["T_ARRAY","array",309],"(",["T_WHITESPACE","\n            ",309],["T_CONSTANT_ENCAPSED_STRING","'controller_action'",310],["T_WHITESPACE"," ",310],["T_DOUBLE_ARROW","=>",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$controller",310],",",["T_WHITESPACE","\n            ",310],["T_CONSTANT_ENCAPSED_STRING","'params'",311],["T_WHITESPACE"," ",311],["T_DOUBLE_ARROW","=>",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$params",311],",",["T_WHITESPACE","\n        ",311],")",")",";",["T_WHITESPACE","\n\n        ",312],["T_IF","if",314],["T_WHITESPACE"," ",314],"(","!",["T_VARIABLE","$productId",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_RETURN","return",315],["T_WHITESPACE"," ",315],["T_STRING","false",315],";",["T_WHITESPACE","\n        ",315],"}",["T_WHITESPACE","\n\n        ",316],["T_VARIABLE","$product",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_STRING","Mage",318],["T_DOUBLE_COLON","::",318],["T_STRING","getModel",318],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",318],")",["T_WHITESPACE","\n            ",318],["T_OBJECT_OPERATOR","->",319],["T_STRING","setStoreId",319],"(",["T_STRING","Mage",319],["T_DOUBLE_COLON","::",319],["T_STRING","app",319],"(",")",["T_OBJECT_OPERATOR","->",319],["T_STRING","getStore",319],"(",")",["T_OBJECT_OPERATOR","->",319],["T_STRING","getId",319],"(",")",")",["T_WHITESPACE","\n            ",319],["T_OBJECT_OPERATOR","->",320],["T_STRING","load",320],"(",["T_VARIABLE","$productId",320],")",";",["T_WHITESPACE","\n\n        ",320],["T_IF","if",322],["T_WHITESPACE"," ",322],"(","!",["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","canShow",322],"(",["T_VARIABLE","$product",322],")",")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n            ",322],["T_RETURN","return",323],["T_WHITESPACE"," ",323],["T_STRING","false",323],";",["T_WHITESPACE","\n        ",323],"}",["T_WHITESPACE","\n        ",324],["T_IF","if",325],["T_WHITESPACE"," ",325],"(","!",["T_STRING","in_array",325],"(",["T_STRING","Mage",325],["T_DOUBLE_COLON","::",325],["T_STRING","app",325],"(",")",["T_OBJECT_OPERATOR","->",325],["T_STRING","getStore",325],"(",")",["T_OBJECT_OPERATOR","->",325],["T_STRING","getWebsiteId",325],"(",")",",",["T_WHITESPACE"," ",325],["T_VARIABLE","$product",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getWebsiteIds",325],"(",")",")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_RETURN","return",326],["T_WHITESPACE"," ",326],["T_STRING","false",326],";",["T_WHITESPACE","\n        ",326],"}",["T_WHITESPACE","\n\n        ",327],["T_COMMENT","\/\/ Load product current category\n",329],["T_WHITESPACE","        ",330],["T_VARIABLE","$categoryId",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_VARIABLE","$params",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getCategoryId",330],"(",")",";",["T_WHITESPACE","\n        ",330],["T_IF","if",331],["T_WHITESPACE"," ",331],"(","!",["T_VARIABLE","$categoryId",331],["T_WHITESPACE"," ",331],["T_BOOLEAN_AND","&&",331],["T_WHITESPACE"," ",331],"(",["T_VARIABLE","$categoryId",331],["T_WHITESPACE"," ",331],["T_IS_NOT_IDENTICAL","!==",331],["T_WHITESPACE"," ",331],["T_STRING","false",331],")",")",["T_WHITESPACE"," ",331],"{",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$lastId",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_STRING","Mage",332],["T_DOUBLE_COLON","::",332],["T_STRING","getSingleton",332],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",332],")",["T_OBJECT_OPERATOR","->",332],["T_STRING","getLastVisitedCategoryId",332],"(",")",";",["T_WHITESPACE","\n            ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$product",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","canBeShowInCategory",333],"(",["T_VARIABLE","$lastId",333],")",")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n                ",333],["T_VARIABLE","$categoryId",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$lastId",334],";",["T_WHITESPACE","\n            ",334],"}",["T_WHITESPACE","\n        ",335],"}",["T_WHITESPACE"," ",336],["T_ELSEIF","elseif",336],["T_WHITESPACE"," ",336],"(","!",["T_VARIABLE","$product",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","canBeShowInCategory",336],"(",["T_VARIABLE","$categoryId",336],")",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_VARIABLE","$categoryId",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_STRING","null",337],";",["T_WHITESPACE","\n        ",337],"}",["T_WHITESPACE","\n\n        ",338],["T_IF","if",340],["T_WHITESPACE"," ",340],"(",["T_VARIABLE","$categoryId",340],")",["T_WHITESPACE"," ",340],"{",["T_WHITESPACE","\n            ",340],["T_VARIABLE","$category",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_STRING","Mage",341],["T_DOUBLE_COLON","::",341],["T_STRING","getModel",341],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",341],")",["T_OBJECT_OPERATOR","->",341],["T_STRING","load",341],"(",["T_VARIABLE","$categoryId",341],")",";",["T_WHITESPACE","\n            ",341],["T_VARIABLE","$product",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","setCategory",342],"(",["T_VARIABLE","$category",342],")",";",["T_WHITESPACE","\n            ",342],["T_STRING","Mage",343],["T_DOUBLE_COLON","::",343],["T_STRING","register",343],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$category",343],")",";",["T_WHITESPACE","\n        ",343],"}",["T_WHITESPACE","\n\n        ",344],["T_COMMENT","\/\/ Register current data and dispatch final events\n",346],["T_WHITESPACE","        ",347],["T_STRING","Mage",347],["T_DOUBLE_COLON","::",347],["T_STRING","register",347],"(",["T_CONSTANT_ENCAPSED_STRING","'current_product'",347],",",["T_WHITESPACE"," ",347],["T_VARIABLE","$product",347],")",";",["T_WHITESPACE","\n        ",347],["T_STRING","Mage",348],["T_DOUBLE_COLON","::",348],["T_STRING","register",348],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",348],",",["T_WHITESPACE"," ",348],["T_VARIABLE","$product",348],")",";",["T_WHITESPACE","\n\n        ",348],["T_TRY","try",350],["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n            ",350],["T_STRING","Mage",351],["T_DOUBLE_COLON","::",351],["T_STRING","dispatchEvent",351],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_controller_product_init'",351],",",["T_WHITESPACE"," ",351],["T_ARRAY","array",351],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",351],["T_WHITESPACE"," ",351],["T_DOUBLE_ARROW","=>",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$product",351],")",")",";",["T_WHITESPACE","\n            ",351],["T_STRING","Mage",352],["T_DOUBLE_COLON","::",352],["T_STRING","dispatchEvent",352],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_controller_product_init_after'",352],",",["T_WHITESPACE","\n                            ",352],["T_ARRAY","array",353],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",353],["T_WHITESPACE"," ",353],["T_DOUBLE_ARROW","=>",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$product",353],",",["T_WHITESPACE","\n                                ",353],["T_CONSTANT_ENCAPSED_STRING","'controller_action'",354],["T_WHITESPACE"," ",354],["T_DOUBLE_ARROW","=>",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$controller",354],["T_WHITESPACE","\n                            ",354],")",["T_WHITESPACE","\n            ",355],")",";",["T_WHITESPACE","\n        ",356],"}",["T_WHITESPACE"," ",357],["T_CATCH","catch",357],["T_WHITESPACE"," ",357],"(",["T_STRING","Mage_Core_Exception",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$e",357],")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n            ",357],["T_STRING","Mage",358],["T_DOUBLE_COLON","::",358],["T_STRING","logException",358],"(",["T_VARIABLE","$e",358],")",";",["T_WHITESPACE","\n            ",358],["T_RETURN","return",359],["T_WHITESPACE"," ",359],["T_STRING","false",359],";",["T_WHITESPACE","\n        ",359],"}",["T_WHITESPACE","\n\n        ",360],["T_RETURN","return",362],["T_WHITESPACE"," ",362],["T_VARIABLE","$product",362],";",["T_WHITESPACE","\n    ",362],"}",["T_WHITESPACE","\n\n    ",363],["T_DOC_COMMENT","\/**\n     * Prepares product options by buyRequest: retrieves values and assigns them as default.\n     * Also parses and adds product management related values - e.g. qty\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @param  Varien_Object $buyRequest\n     * @return Mage_Catalog_Helper_Product\n     *\/",365],["T_WHITESPACE","\n    ",372],["T_PUBLIC","public",373],["T_WHITESPACE"," ",373],["T_FUNCTION","function",373],["T_WHITESPACE"," ",373],["T_STRING","prepareProductOptions",373],"(",["T_VARIABLE","$product",373],",",["T_WHITESPACE"," ",373],["T_VARIABLE","$buyRequest",373],")",["T_WHITESPACE","\n    ",373],"{",["T_WHITESPACE","\n        ",374],["T_VARIABLE","$optionValues",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$product",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","processBuyRequest",375],"(",["T_VARIABLE","$buyRequest",375],")",";",["T_WHITESPACE","\n        ",375],["T_VARIABLE","$optionValues",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","setQty",376],"(",["T_VARIABLE","$buyRequest",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getQty",376],"(",")",")",";",["T_WHITESPACE","\n        ",376],["T_VARIABLE","$product",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","setPreconfiguredValues",377],"(",["T_VARIABLE","$optionValues",377],")",";",["T_WHITESPACE","\n\n        ",377],["T_RETURN","return",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],";",["T_WHITESPACE","\n    ",379],"}",["T_WHITESPACE","\n\n    ",380],["T_DOC_COMMENT","\/**\n     * Process $buyRequest and sets its options before saving configuration to some product item.\n     * This method is used to attach additional parameters to processed buyRequest.\n     *\n     * $params holds parameters of what operation must be performed:\n     * - 'current_config', Varien_Object or array - current buyRequest that configures product in this item,\n     *   used to restore currently attached files\n     * - 'files_prefix': string[a-z0-9_] - prefix that was added at frontend to names of file inputs,\n     *   so they won't intersect with other submitted options\n     *\n     * @param Varien_Object|array $buyRequest\n     * @param Varien_Object|array $params\n     * @return Varien_Object\n     *\/",382],["T_WHITESPACE","\n    ",395],["T_PUBLIC","public",396],["T_WHITESPACE"," ",396],["T_FUNCTION","function",396],["T_WHITESPACE"," ",396],["T_STRING","addParamsToBuyRequest",396],"(",["T_VARIABLE","$buyRequest",396],",",["T_WHITESPACE"," ",396],["T_VARIABLE","$params",396],")",["T_WHITESPACE","\n    ",396],"{",["T_WHITESPACE","\n        ",397],["T_IF","if",398],["T_WHITESPACE"," ",398],"(",["T_STRING","is_array",398],"(",["T_VARIABLE","$buyRequest",398],")",")",["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n            ",398],["T_VARIABLE","$buyRequest",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_NEW","new",399],["T_WHITESPACE"," ",399],["T_STRING","Varien_Object",399],"(",["T_VARIABLE","$buyRequest",399],")",";",["T_WHITESPACE","\n        ",399],"}",["T_WHITESPACE","\n        ",400],["T_IF","if",401],["T_WHITESPACE"," ",401],"(",["T_STRING","is_array",401],"(",["T_VARIABLE","$params",401],")",")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n            ",401],["T_VARIABLE","$params",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_NEW","new",402],["T_WHITESPACE"," ",402],["T_STRING","Varien_Object",402],"(",["T_VARIABLE","$params",402],")",";",["T_WHITESPACE","\n        ",402],"}",["T_WHITESPACE","\n\n\n        ",403],["T_COMMENT","\/\/ Ensure that currentConfig goes as Varien_Object - for easier work with it later\n",406],["T_WHITESPACE","        ",407],["T_VARIABLE","$currentConfig",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$params",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getCurrentConfig",407],"(",")",";",["T_WHITESPACE","\n        ",407],["T_IF","if",408],["T_WHITESPACE"," ",408],"(",["T_VARIABLE","$currentConfig",408],")",["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n            ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(",["T_STRING","is_array",409],"(",["T_VARIABLE","$currentConfig",409],")",")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n                ",409],["T_VARIABLE","$params",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","setCurrentConfig",410],"(",["T_NEW","new",410],["T_WHITESPACE"," ",410],["T_STRING","Varien_Object",410],"(",["T_VARIABLE","$currentConfig",410],")",")",";",["T_WHITESPACE","\n            ",410],"}",["T_WHITESPACE"," ",411],["T_ELSE","else",411],["T_WHITESPACE"," ",411],["T_IF","if",411],["T_WHITESPACE"," ",411],"(","!","(",["T_VARIABLE","$currentConfig",411],["T_WHITESPACE"," ",411],["T_INSTANCEOF","instanceof",411],["T_WHITESPACE"," ",411],["T_STRING","Varien_Object",411],")",")",["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n                ",411],["T_VARIABLE","$params",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","unsCurrentConfig",412],"(",")",";",["T_WHITESPACE","\n            ",412],"}",["T_WHITESPACE","\n        ",413],"}",["T_WHITESPACE","\n\n        ",414],["T_COMMENT","\/*\n         * Notice that '_processing_params' must always be object to protect processing forged requests\n         * where '_processing_params' comes in $buyRequest as array from user input\n         *\/",416],["T_WHITESPACE","\n        ",419],["T_VARIABLE","$processingParams",420],["T_WHITESPACE"," ",420],"=",["T_WHITESPACE"," ",420],["T_VARIABLE","$buyRequest",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getData",420],"(",["T_CONSTANT_ENCAPSED_STRING","'_processing_params'",420],")",";",["T_WHITESPACE","\n        ",420],["T_IF","if",421],["T_WHITESPACE"," ",421],"(","!",["T_VARIABLE","$processingParams",421],["T_WHITESPACE"," ",421],["T_BOOLEAN_OR","||",421],["T_WHITESPACE"," ",421],"!","(",["T_VARIABLE","$processingParams",421],["T_WHITESPACE"," ",421],["T_INSTANCEOF","instanceof",421],["T_WHITESPACE"," ",421],["T_STRING","Varien_Object",421],")",")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n            ",421],["T_VARIABLE","$processingParams",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_NEW","new",422],["T_WHITESPACE"," ",422],["T_STRING","Varien_Object",422],"(",")",";",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$buyRequest",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","setData",423],"(",["T_CONSTANT_ENCAPSED_STRING","'_processing_params'",423],",",["T_WHITESPACE"," ",423],["T_VARIABLE","$processingParams",423],")",";",["T_WHITESPACE","\n        ",423],"}",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$processingParams",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","addData",425],"(",["T_VARIABLE","$params",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getData",425],"(",")",")",";",["T_WHITESPACE","\n\n        ",425],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$buyRequest",427],";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n\n    ",428],["T_DOC_COMMENT","\/**\n     * Return loaded product instance\n     *\n     * @param  int|string $productId (SKU or ID)\n     * @param  int $store\n     * @param  string $identifierType\n     * @return Mage_Catalog_Model_Product\n     *\/",430],["T_WHITESPACE","\n    ",437],["T_PUBLIC","public",438],["T_WHITESPACE"," ",438],["T_FUNCTION","function",438],["T_WHITESPACE"," ",438],["T_STRING","getProduct",438],"(",["T_VARIABLE","$productId",438],",",["T_WHITESPACE"," ",438],["T_VARIABLE","$store",438],",",["T_WHITESPACE"," ",438],["T_VARIABLE","$identifierType",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_STRING","null",438],")",["T_WHITESPACE","\n    ",438],"{",["T_WHITESPACE","\n        ",439],["T_DOC_COMMENT","\/** @var $product Mage_Catalog_Model_Product *\/",440],["T_WHITESPACE","\n        ",440],["T_VARIABLE","$product",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_STRING","Mage",441],["T_DOUBLE_COLON","::",441],["T_STRING","getModel",441],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",441],")",["T_OBJECT_OPERATOR","->",441],["T_STRING","setStoreId",441],"(",["T_STRING","Mage",441],["T_DOUBLE_COLON","::",441],["T_STRING","app",441],"(",")",["T_OBJECT_OPERATOR","->",441],["T_STRING","getStore",441],"(",["T_VARIABLE","$store",441],")",["T_OBJECT_OPERATOR","->",441],["T_STRING","getId",441],"(",")",")",";",["T_WHITESPACE","\n\n        ",441],["T_VARIABLE","$expectedIdType",443],["T_WHITESPACE"," ",443],"=",["T_WHITESPACE"," ",443],["T_STRING","false",443],";",["T_WHITESPACE","\n        ",443],["T_IF","if",444],["T_WHITESPACE"," ",444],"(",["T_VARIABLE","$identifierType",444],["T_WHITESPACE"," ",444],["T_IS_IDENTICAL","===",444],["T_WHITESPACE"," ",444],["T_STRING","null",444],")",["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n            ",444],["T_IF","if",445],["T_WHITESPACE"," ",445],"(",["T_STRING","is_string",445],"(",["T_VARIABLE","$productId",445],")",["T_WHITESPACE"," ",445],["T_BOOLEAN_AND","&&",445],["T_WHITESPACE"," ",445],"!",["T_STRING","preg_match",445],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/^[+-]?[1-9][0-9]*$|^0$\/\"",445],",",["T_WHITESPACE"," ",445],["T_VARIABLE","$productId",445],")",")",["T_WHITESPACE"," ",445],"{",["T_WHITESPACE","\n                ",445],["T_VARIABLE","$expectedIdType",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_CONSTANT_ENCAPSED_STRING","'sku'",446],";",["T_WHITESPACE","\n            ",446],"}",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE","\n\n        ",448],["T_IF","if",450],["T_WHITESPACE"," ",450],"(",["T_VARIABLE","$identifierType",450],["T_WHITESPACE"," ",450],["T_IS_EQUAL","==",450],["T_WHITESPACE"," ",450],["T_CONSTANT_ENCAPSED_STRING","'sku'",450],["T_WHITESPACE"," ",450],["T_BOOLEAN_OR","||",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$expectedIdType",450],["T_WHITESPACE"," ",450],["T_IS_EQUAL","==",450],["T_WHITESPACE"," ",450],["T_CONSTANT_ENCAPSED_STRING","'sku'",450],")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n            ",450],["T_VARIABLE","$idBySku",451],["T_WHITESPACE"," ",451],"=",["T_WHITESPACE"," ",451],["T_VARIABLE","$product",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getIdBySku",451],"(",["T_VARIABLE","$productId",451],")",";",["T_WHITESPACE","\n            ",451],["T_IF","if",452],["T_WHITESPACE"," ",452],"(",["T_VARIABLE","$idBySku",452],")",["T_WHITESPACE"," ",452],"{",["T_WHITESPACE","\n                ",452],["T_VARIABLE","$productId",453],["T_WHITESPACE"," ",453],"=",["T_WHITESPACE"," ",453],["T_VARIABLE","$idBySku",453],";",["T_WHITESPACE","\n            ",453],"}",["T_WHITESPACE"," ",454],["T_ELSE","else",454],["T_WHITESPACE"," ",454],["T_IF","if",454],["T_WHITESPACE"," ",454],"(",["T_VARIABLE","$identifierType",454],["T_WHITESPACE"," ",454],["T_IS_EQUAL","==",454],["T_WHITESPACE"," ",454],["T_CONSTANT_ENCAPSED_STRING","'sku'",454],")",["T_WHITESPACE"," ",454],"{",["T_WHITESPACE","\n                ",454],["T_COMMENT","\/\/ Return empty product because it was not found by originally specified SKU identifier\n",455],["T_WHITESPACE","                ",456],["T_RETURN","return",456],["T_WHITESPACE"," ",456],["T_VARIABLE","$product",456],";",["T_WHITESPACE","\n            ",456],"}",["T_WHITESPACE","\n        ",457],"}",["T_WHITESPACE","\n\n        ",458],["T_IF","if",460],["T_WHITESPACE"," ",460],"(",["T_VARIABLE","$productId",460],["T_WHITESPACE"," ",460],["T_BOOLEAN_AND","&&",460],["T_WHITESPACE"," ",460],["T_STRING","is_numeric",460],"(",["T_VARIABLE","$productId",460],")",")",["T_WHITESPACE"," ",460],"{",["T_WHITESPACE","\n            ",460],["T_VARIABLE","$product",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","load",461],"(",["T_INT_CAST","(int)",461],["T_WHITESPACE"," ",461],["T_VARIABLE","$productId",461],")",";",["T_WHITESPACE","\n        ",461],"}",["T_WHITESPACE","\n\n        ",462],["T_RETURN","return",464],["T_WHITESPACE"," ",464],["T_VARIABLE","$product",464],";",["T_WHITESPACE","\n    ",464],"}",["T_WHITESPACE","\n\n    ",465],["T_DOC_COMMENT","\/**\n     * Set flag that shows if Magento has to check product to be saleable (enabled and\/or inStock)\n     *\n     * For instance, during order creation in the backend admin has ability to add any products to order\n     *\n     * @param bool $skipSaleableCheck\n     * @return Mage_Catalog_Helper_Product\n     *\/",467],["T_WHITESPACE","\n    ",474],["T_PUBLIC","public",475],["T_WHITESPACE"," ",475],["T_FUNCTION","function",475],["T_WHITESPACE"," ",475],["T_STRING","setSkipSaleableCheck",475],"(",["T_VARIABLE","$skipSaleableCheck",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_STRING","false",475],")",["T_WHITESPACE","\n    ",475],"{",["T_WHITESPACE","\n        ",476],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","_skipSaleableCheck",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$skipSaleableCheck",477],";",["T_WHITESPACE","\n        ",477],["T_RETURN","return",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],";",["T_WHITESPACE","\n    ",478],"}",["T_WHITESPACE","\n\n    ",479],["T_DOC_COMMENT","\/**\n     * Get flag that shows if Magento has to check product to be saleable (enabled and\/or inStock)\n     *\n     * @return boolean\n     *\/",481],["T_WHITESPACE","\n    ",485],["T_PUBLIC","public",486],["T_WHITESPACE"," ",486],["T_FUNCTION","function",486],["T_WHITESPACE"," ",486],["T_STRING","getSkipSaleableCheck",486],"(",")",["T_WHITESPACE","\n    ",486],"{",["T_WHITESPACE","\n        ",487],["T_RETURN","return",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","_skipSaleableCheck",488],";",["T_WHITESPACE","\n    ",488],"}",["T_WHITESPACE","\n\n    ",489],["T_DOC_COMMENT","\/**\n     * Gets minimal sales quantity\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return int|null\n     *\/",491],["T_WHITESPACE","\n    ",496],["T_PUBLIC","public",497],["T_WHITESPACE"," ",497],["T_FUNCTION","function",497],["T_WHITESPACE"," ",497],["T_STRING","getMinimalQty",497],"(",["T_VARIABLE","$product",497],")",["T_WHITESPACE","\n    ",497],"{",["T_WHITESPACE","\n        ",498],["T_VARIABLE","$stockItem",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_VARIABLE","$product",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","getStockItem",499],"(",")",";",["T_WHITESPACE","\n        ",499],["T_IF","if",500],["T_WHITESPACE"," ",500],"(",["T_VARIABLE","$stockItem",500],["T_WHITESPACE"," ",500],["T_BOOLEAN_AND","&&",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$stockItem",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getMinSaleQty",500],"(",")",")",["T_WHITESPACE"," ",500],"{",["T_WHITESPACE","\n            ",500],["T_RETURN","return",501],["T_WHITESPACE"," ",501],["T_VARIABLE","$stockItem",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getMinSaleQty",501],"(",")",["T_WHITESPACE"," ",501],"*",["T_WHITESPACE"," ",501],["T_LNUMBER","1",501],";",["T_WHITESPACE","\n        ",501],"}",["T_WHITESPACE","\n        ",502],["T_RETURN","return",503],["T_WHITESPACE"," ",503],["T_STRING","null",503],";",["T_WHITESPACE","\n    ",503],"}",["T_WHITESPACE","\n\n    ",504],["T_DOC_COMMENT","\/**\n     * Get default qty - either as preconfigured, or as 1.\n     * Also restricts it by minimal qty.\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return int|float\n     *\/",506],["T_WHITESPACE","\n    ",512],["T_PUBLIC","public",513],["T_WHITESPACE"," ",513],["T_FUNCTION","function",513],["T_WHITESPACE"," ",513],["T_STRING","getDefaultQty",513],"(",["T_VARIABLE","$product",513],")",["T_WHITESPACE","\n    ",513],"{",["T_WHITESPACE","\n        ",514],["T_VARIABLE","$qty",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","getMinimalQty",515],"(",["T_VARIABLE","$product",515],")",";",["T_WHITESPACE","\n        ",515],["T_VARIABLE","$configQty",516],["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_VARIABLE","$product",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","getPreconfiguredValues",516],"(",")",["T_OBJECT_OPERATOR","->",516],["T_STRING","getQty",516],"(",")",";",["T_WHITESPACE","\n\n        ",516],["T_IF","if",518],["T_WHITESPACE"," ",518],"(",["T_VARIABLE","$product",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","isConfigurable",518],"(",")",["T_WHITESPACE"," ",518],["T_BOOLEAN_OR","||",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$configQty",518],["T_WHITESPACE"," ",518],">",["T_WHITESPACE"," ",518],["T_VARIABLE","$qty",518],")",["T_WHITESPACE"," ",518],"{",["T_WHITESPACE","\n            ",518],["T_VARIABLE","$qty",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_VARIABLE","$configQty",519],";",["T_WHITESPACE","\n        ",519],"}",["T_WHITESPACE","\n\n        ",520],["T_IF","if",522],["T_WHITESPACE"," ",522],"(",["T_STRING","is_null",522],"(",["T_VARIABLE","$qty",522],")",")",["T_WHITESPACE"," ",522],"{",["T_WHITESPACE","\n            ",522],["T_VARIABLE","$qty",523],["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_STRING","self",523],["T_DOUBLE_COLON","::",523],["T_STRING","DEFAULT_QTY",523],";",["T_WHITESPACE","\n        ",523],"}",["T_WHITESPACE","\n\n        ",524],["T_RETURN","return",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$qty",526],";",["T_WHITESPACE","\n    ",526],"}",["T_WHITESPACE","\n",527],"}",["T_WHITESPACE","\n",528]]