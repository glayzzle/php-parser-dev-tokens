[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Abstract API2 class for product instance\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_ABSTRACT","abstract",34],["T_WHITESPACE"," ",34],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Api2_Product_Rest",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Api2_Product",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Current loaded product\n     *\n     * @var Mage_Catalog_Model_Product\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_product",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Retrieve product data\n     *\n     * @return array\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","_retrieve",48],"(",")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$product",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_getProduct",50],"(",")",";",["T_WHITESPACE","\n\n        ",50],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_prepareProductForResponse",52],"(",["T_VARIABLE","$product",52],")",";",["T_WHITESPACE","\n        ",52],["T_RETURN","return",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$product",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getData",53],"(",")",";",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Retrieve list of products\n     *\n     * @return array\n     *\/",56],["T_WHITESPACE","\n    ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","_retrieveCollection",61],"(",")",["T_WHITESPACE","\n    ",61],"{",["T_WHITESPACE","\n        ",62],["T_DOC_COMMENT","\/** @var $collection Mage_Catalog_Model_Resource_Product_Collection *\/",63],["T_WHITESPACE","\n        ",63],["T_VARIABLE","$collection",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","Mage",64],["T_DOUBLE_COLON","::",64],["T_STRING","getResourceModel",64],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_collection'",64],")",";",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$store",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","_getStore",65],"(",")",";",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$entityOnlyAttributes",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getEntityOnlyAttributes",66],"(",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getUserType",66],"(",")",",",["T_WHITESPACE","\n            ",66],["T_STRING","Mage_Api2_Model_Resource",67],["T_DOUBLE_COLON","::",67],["T_STRING","OPERATION_ATTRIBUTE_READ",67],")",";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$availableAttributes",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","array_keys",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getAvailableAttributes",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getUserType",68],"(",")",",",["T_WHITESPACE","\n            ",68],["T_STRING","Mage_Api2_Model_Resource",69],["T_DOUBLE_COLON","::",69],["T_STRING","OPERATION_ATTRIBUTE_READ",69],")",")",";",["T_WHITESPACE","\n        ",69],["T_COMMENT","\/\/ available attributes not contain image attribute, but it needed for get image_url\n",70],["T_WHITESPACE","        ",71],["T_VARIABLE","$availableAttributes",71],"[","]",["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'image'",71],";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$collection",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","addStoreFilter",72],"(",["T_VARIABLE","$store",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getId",72],"(",")",")",["T_WHITESPACE","\n            ",72],["T_OBJECT_OPERATOR","->",73],["T_STRING","addPriceData",73],"(",["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_getCustomerGroupId",73],"(",")",",",["T_WHITESPACE"," ",73],["T_VARIABLE","$store",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getWebsiteId",73],"(",")",")",["T_WHITESPACE","\n            ",73],["T_OBJECT_OPERATOR","->",74],["T_STRING","addAttributeToSelect",74],"(",["T_STRING","array_diff",74],"(",["T_VARIABLE","$availableAttributes",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$entityOnlyAttributes",74],")",")",["T_WHITESPACE","\n            ",74],["T_OBJECT_OPERATOR","->",75],["T_STRING","addAttributeToFilter",75],"(",["T_CONSTANT_ENCAPSED_STRING","'visibility'",75],",",["T_WHITESPACE"," ",75],["T_ARRAY","array",75],"(",["T_WHITESPACE","\n                ",75],["T_CONSTANT_ENCAPSED_STRING","'neq'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_STRING","Mage_Catalog_Model_Product_Visibility",76],["T_DOUBLE_COLON","::",76],["T_STRING","VISIBILITY_NOT_VISIBLE",76],")",")",["T_WHITESPACE","\n            ",76],["T_OBJECT_OPERATOR","->",77],["T_STRING","addAttributeToFilter",77],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",77],",",["T_WHITESPACE"," ",77],["T_ARRAY","array",77],"(",["T_CONSTANT_ENCAPSED_STRING","'eq'",77],["T_WHITESPACE"," ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_STRING","Mage_Catalog_Model_Product_Status",77],["T_DOUBLE_COLON","::",77],["T_STRING","STATUS_ENABLED",77],")",")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_applyCategoryFilter",78],"(",["T_VARIABLE","$collection",78],")",";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_applyCollectionModifiers",79],"(",["T_VARIABLE","$collection",79],")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$products",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$collection",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","load",80],"(",")",";",["T_WHITESPACE","\n\n        ",80],["T_DOC_COMMENT","\/** @var Mage_Catalog_Model_Product $product *\/",82],["T_WHITESPACE","\n        ",82],["T_FOREACH","foreach",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$products",83],["T_WHITESPACE"," ",83],["T_AS","as",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$product",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_setProduct",84],"(",["T_VARIABLE","$product",84],")",";",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_prepareProductForResponse",85],"(",["T_VARIABLE","$product",85],")",";",["T_WHITESPACE","\n        ",85],"}",["T_WHITESPACE","\n        ",86],["T_RETURN","return",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$products",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","toArray",87],"(",")",";",["T_WHITESPACE","\n    ",87],"}",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Apply filter by category id\n     *\n     * @param Mage_Catalog_Model_Resource_Product_Collection $collection\n     *\/",90],["T_WHITESPACE","\n    ",94],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","_applyCategoryFilter",95],"(",["T_STRING","Mage_Catalog_Model_Resource_Product_Collection",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$collection",95],")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$categoryId",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getRequest",97],"(",")",["T_OBJECT_OPERATOR","->",97],["T_STRING","getParam",97],"(",["T_CONSTANT_ENCAPSED_STRING","'category_id'",97],")",";",["T_WHITESPACE","\n        ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$categoryId",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$category",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_getCategoryById",99],"(",["T_VARIABLE","$categoryId",99],")",";",["T_WHITESPACE","\n            ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(","!",["T_VARIABLE","$category",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getId",100],"(",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_critical",101],"(",["T_CONSTANT_ENCAPSED_STRING","'Category not found.'",101],",",["T_WHITESPACE"," ",101],["T_STRING","Mage_Api2_Model_Server",101],["T_DOUBLE_COLON","::",101],["T_STRING","HTTP_BAD_REQUEST",101],")",";",["T_WHITESPACE","\n            ",101],"}",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$collection",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","addCategoryFilter",103],"(",["T_VARIABLE","$category",103],")",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Add special fields to product get response\n     *\n     * @param Mage_Catalog_Model_Product $product\n     *\/",107],["T_WHITESPACE","\n    ",111],["T_PROTECTED","protected",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","_prepareProductForResponse",112],"(",["T_STRING","Mage_Catalog_Model_Product",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$product",112],")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_DOC_COMMENT","\/** @var $productHelper Mage_Catalog_Helper_Product *\/",114],["T_WHITESPACE","\n        ",114],["T_VARIABLE","$productHelper",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","Mage",115],["T_DOUBLE_COLON","::",115],["T_STRING","helper",115],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",115],")",";",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$productData",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$product",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getData",116],"(",")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$product",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","setWebsiteId",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_getStore",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getWebsiteId",117],"(",")",")",";",["T_WHITESPACE","\n        ",117],["T_COMMENT","\/\/ customer group is required in product for correct prices calculation\n",118],["T_WHITESPACE","        ",119],["T_VARIABLE","$product",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","setCustomerGroupId",119],"(",["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_getCustomerGroupId",119],"(",")",")",";",["T_WHITESPACE","\n        ",119],["T_COMMENT","\/\/ calculate prices\n",120],["T_WHITESPACE","        ",121],["T_VARIABLE","$finalPrice",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$product",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getFinalPrice",121],"(",")",";",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$productData",122],"[",["T_CONSTANT_ENCAPSED_STRING","'regular_price_with_tax'",122],"]",["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_applyTaxToPrice",122],"(",["T_VARIABLE","$product",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getPrice",122],"(",")",",",["T_WHITESPACE"," ",122],["T_STRING","true",122],")",";",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$productData",123],"[",["T_CONSTANT_ENCAPSED_STRING","'regular_price_without_tax'",123],"]",["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_applyTaxToPrice",123],"(",["T_VARIABLE","$product",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getPrice",123],"(",")",",",["T_WHITESPACE"," ",123],["T_STRING","false",123],")",";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$productData",124],"[",["T_CONSTANT_ENCAPSED_STRING","'final_price_with_tax'",124],"]",["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_applyTaxToPrice",124],"(",["T_VARIABLE","$finalPrice",124],",",["T_WHITESPACE"," ",124],["T_STRING","true",124],")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$productData",125],"[",["T_CONSTANT_ENCAPSED_STRING","'final_price_without_tax'",125],"]",["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_applyTaxToPrice",125],"(",["T_VARIABLE","$finalPrice",125],",",["T_WHITESPACE"," ",125],["T_STRING","false",125],")",";",["T_WHITESPACE","\n\n        ",125],["T_VARIABLE","$productData",127],"[",["T_CONSTANT_ENCAPSED_STRING","'is_saleable'",127],"]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$product",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getIsSalable",127],"(",")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$productData",128],"[",["T_CONSTANT_ENCAPSED_STRING","'image_url'",128],"]",["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_STRING_CAST","(string)",128],["T_WHITESPACE"," ",128],["T_STRING","Mage",128],["T_DOUBLE_COLON","::",128],["T_STRING","helper",128],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/image'",128],")",["T_OBJECT_OPERATOR","->",128],["T_STRING","init",128],"(",["T_VARIABLE","$product",128],",",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'image'",128],")",";",["T_WHITESPACE","\n\n        ",128],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getActionType",130],"(",")",["T_WHITESPACE"," ",130],["T_IS_EQUAL","==",130],["T_WHITESPACE"," ",130],["T_STRING","self",130],["T_DOUBLE_COLON","::",130],["T_STRING","ACTION_TYPE_ENTITY",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_COMMENT","\/\/ define URLs\n",131],["T_WHITESPACE","            ",132],["T_VARIABLE","$productData",132],"[",["T_CONSTANT_ENCAPSED_STRING","'url'",132],"]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$productHelper",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getProductUrl",132],"(",["T_VARIABLE","$product",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getId",132],"(",")",")",";",["T_WHITESPACE","\n            ",132],["T_DOC_COMMENT","\/** @var $cartHelper Mage_Checkout_Helper_Cart *\/",133],["T_WHITESPACE","\n            ",133],["T_VARIABLE","$cartHelper",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_STRING","Mage",134],["T_DOUBLE_COLON","::",134],["T_STRING","helper",134],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",134],")",";",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$productData",135],"[",["T_CONSTANT_ENCAPSED_STRING","'buy_now_url'",135],"]",["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$cartHelper",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getAddUrl",135],"(",["T_VARIABLE","$product",135],")",";",["T_WHITESPACE","\n\n            ",135],["T_DOC_COMMENT","\/** @var $stockItem Mage_CatalogInventory_Model_Stock_Item *\/",137],["T_WHITESPACE","\n            ",137],["T_VARIABLE","$stockItem",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$product",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getStockItem",138],"(",")",";",["T_WHITESPACE","\n            ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(","!",["T_VARIABLE","$stockItem",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$stockItem",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","Mage",140],["T_DOUBLE_COLON","::",140],["T_STRING","getModel",140],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",140],")",";",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$stockItem",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","loadByProduct",141],"(",["T_VARIABLE","$product",141],")",";",["T_WHITESPACE","\n            ",141],"}",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$productData",143],"[",["T_CONSTANT_ENCAPSED_STRING","'is_in_stock'",143],"]",["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$stockItem",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getIsInStock",143],"(",")",";",["T_WHITESPACE","\n\n            ",143],["T_DOC_COMMENT","\/** @var $reviewModel Mage_Review_Model_Review *\/",145],["T_WHITESPACE","\n            ",145],["T_VARIABLE","$reviewModel",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","Mage",146],["T_DOUBLE_COLON","::",146],["T_STRING","getModel",146],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review'",146],")",";",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$productData",147],"[",["T_CONSTANT_ENCAPSED_STRING","'total_reviews_count'",147],"]",["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$reviewModel",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getTotalReviews",147],"(",["T_VARIABLE","$product",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getId",147],"(",")",",",["T_WHITESPACE"," ",147],["T_STRING","true",147],",",["T_WHITESPACE","\n                ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_getStore",148],"(",")",["T_OBJECT_OPERATOR","->",148],["T_STRING","getId",148],"(",")",")",";",["T_WHITESPACE","\n\n            ",148],["T_VARIABLE","$productData",150],"[",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",150],"]",["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_getTierPrices",150],"(",")",";",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$productData",151],"[",["T_CONSTANT_ENCAPSED_STRING","'has_custom_options'",151],"]",["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_STRING","count",151],"(",["T_VARIABLE","$product",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getOptions",151],"(",")",")",["T_WHITESPACE"," ",151],">",["T_WHITESPACE"," ",151],["T_LNUMBER","0",151],";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE"," ",152],["T_ELSE","else",152],["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_COMMENT","\/\/ remove tier price from response\n",153],["T_WHITESPACE","            ",154],["T_VARIABLE","$product",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","unsetData",154],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",154],")",";",["T_WHITESPACE","\n            ",154],["T_UNSET","unset",155],"(",["T_VARIABLE","$productData",155],"[",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",155],"]",")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$product",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","addData",157],"(",["T_VARIABLE","$productData",157],")",";",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * Product create only available for admin\n     *\n     * @param array $data\n     *\/",160],["T_WHITESPACE","\n    ",164],["T_PROTECTED","protected",165],["T_WHITESPACE"," ",165],["T_FUNCTION","function",165],["T_WHITESPACE"," ",165],["T_STRING","_create",165],"(",["T_ARRAY","array",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$data",165],")",["T_WHITESPACE","\n    ",165],"{",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","_critical",167],"(",["T_STRING","self",167],["T_DOUBLE_COLON","::",167],["T_STRING","RESOURCE_METHOD_NOT_ALLOWED",167],")",";",["T_WHITESPACE","\n    ",167],"}",["T_WHITESPACE","\n\n    ",168],["T_DOC_COMMENT","\/**\n     * Product update only available for admin\n     *\n     * @param array $data\n     *\/",170],["T_WHITESPACE","\n    ",174],["T_PROTECTED","protected",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","_update",175],"(",["T_ARRAY","array",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$data",175],")",["T_WHITESPACE","\n    ",175],"{",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_critical",177],"(",["T_STRING","self",177],["T_DOUBLE_COLON","::",177],["T_STRING","RESOURCE_METHOD_NOT_ALLOWED",177],")",";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n\n    ",178],["T_DOC_COMMENT","\/**\n     * Product delete only available for admin\n     *\/",180],["T_WHITESPACE","\n    ",182],["T_PROTECTED","protected",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","_delete",183],"(",")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_critical",185],"(",["T_STRING","self",185],["T_DOUBLE_COLON","::",185],["T_STRING","RESOURCE_METHOD_NOT_ALLOWED",185],")",";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Load product by its SKU or ID provided in request\n     *\n     * @return Mage_Catalog_Model_Product\n     *\/",188],["T_WHITESPACE","\n    ",192],["T_PROTECTED","protected",193],["T_WHITESPACE"," ",193],["T_FUNCTION","function",193],["T_WHITESPACE"," ",193],["T_STRING","_getProduct",193],"(",")",["T_WHITESPACE","\n    ",193],"{",["T_WHITESPACE","\n        ",194],["T_IF","if",195],["T_WHITESPACE"," ",195],"(",["T_STRING","is_null",195],"(",["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","_product",195],")",")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$productId",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getRequest",196],"(",")",["T_OBJECT_OPERATOR","->",196],["T_STRING","getParam",196],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",196],")",";",["T_WHITESPACE","\n            ",196],["T_DOC_COMMENT","\/** @var $productHelper Mage_Catalog_Helper_Product *\/",197],["T_WHITESPACE","\n            ",197],["T_VARIABLE","$productHelper",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_STRING","Mage",198],["T_DOUBLE_COLON","::",198],["T_STRING","helper",198],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",198],")",";",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$product",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$productHelper",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getProduct",199],"(",["T_VARIABLE","$productId",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_getStore",199],"(",")",["T_OBJECT_OPERATOR","->",199],["T_STRING","getId",199],"(",")",")",";",["T_WHITESPACE","\n            ",199],["T_IF","if",200],["T_WHITESPACE"," ",200],"(","!","(",["T_VARIABLE","$product",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getId",200],"(",")",")",")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n                ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_critical",201],"(",["T_STRING","self",201],["T_DOUBLE_COLON","::",201],["T_STRING","RESOURCE_NOT_FOUND",201],")",";",["T_WHITESPACE","\n            ",201],"}",["T_WHITESPACE","\n            ",202],["T_COMMENT","\/\/ check if product belongs to website current\n",203],["T_WHITESPACE","            ",204],["T_IF","if",204],["T_WHITESPACE"," ",204],"(",["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_getStore",204],"(",")",["T_OBJECT_OPERATOR","->",204],["T_STRING","getId",204],"(",")",")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n                ",204],["T_VARIABLE","$isValidWebsite",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_STRING","in_array",205],"(",["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_getStore",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getWebsiteId",205],"(",")",",",["T_WHITESPACE"," ",205],["T_VARIABLE","$product",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getWebsiteIds",205],"(",")",")",";",["T_WHITESPACE","\n                ",205],["T_IF","if",206],["T_WHITESPACE"," ",206],"(","!",["T_VARIABLE","$isValidWebsite",206],")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n                    ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_critical",207],"(",["T_STRING","self",207],["T_DOUBLE_COLON","::",207],["T_STRING","RESOURCE_NOT_FOUND",207],")",";",["T_WHITESPACE","\n                ",207],"}",["T_WHITESPACE","\n            ",208],"}",["T_WHITESPACE","\n            ",209],["T_COMMENT","\/\/ Check display settings for customers & guests\n",210],["T_WHITESPACE","            ",211],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getApiUser",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","getType",211],"(",")",["T_WHITESPACE"," ",211],["T_IS_NOT_EQUAL","!=",211],["T_WHITESPACE"," ",211],["T_STRING","Mage_Api2_Model_Auth_User_Admin",211],["T_DOUBLE_COLON","::",211],["T_STRING","USER_TYPE",211],")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n                ",211],["T_COMMENT","\/\/ check if product assigned to any website and can be shown\n",212],["T_WHITESPACE","                ",213],["T_IF","if",213],["T_WHITESPACE"," ",213],"(","(","!",["T_STRING","Mage",213],["T_DOUBLE_COLON","::",213],["T_STRING","app",213],"(",")",["T_OBJECT_OPERATOR","->",213],["T_STRING","isSingleStoreMode",213],"(",")",["T_WHITESPACE"," ",213],["T_BOOLEAN_AND","&&",213],["T_WHITESPACE"," ",213],"!",["T_STRING","count",213],"(",["T_VARIABLE","$product",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getWebsiteIds",213],"(",")",")",")",["T_WHITESPACE","\n                    ",213],["T_BOOLEAN_OR","||",214],["T_WHITESPACE"," ",214],"!",["T_VARIABLE","$productHelper",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","canShow",214],"(",["T_VARIABLE","$product",214],")",["T_WHITESPACE","\n                ",214],")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n                    ",215],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_critical",216],"(",["T_STRING","self",216],["T_DOUBLE_COLON","::",216],["T_STRING","RESOURCE_NOT_FOUND",216],")",";",["T_WHITESPACE","\n                ",216],"}",["T_WHITESPACE","\n            ",217],"}",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_product",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$product",219],";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n        ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","_product",221],";",["T_WHITESPACE","\n    ",221],"}",["T_WHITESPACE","\n\n    ",222],["T_DOC_COMMENT","\/**\n     * Set product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     *\/",224],["T_WHITESPACE","\n    ",228],["T_PROTECTED","protected",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","_setProduct",229],"(",["T_STRING","Mage_Catalog_Model_Product",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$product",229],")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_product",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$product",231],";",["T_WHITESPACE","\n    ",231],"}",["T_WHITESPACE","\n\n    ",232],["T_DOC_COMMENT","\/**\n     * Load category by id\n     *\n     * @param int $categoryId\n     * @return Mage_Catalog_Model_Category\n     *\/",234],["T_WHITESPACE","\n    ",239],["T_PROTECTED","protected",240],["T_WHITESPACE"," ",240],["T_FUNCTION","function",240],["T_WHITESPACE"," ",240],["T_STRING","_getCategoryById",240],"(",["T_VARIABLE","$categoryId",240],")",["T_WHITESPACE","\n    ",240],"{",["T_WHITESPACE","\n        ",241],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_STRING","Mage",242],["T_DOUBLE_COLON","::",242],["T_STRING","getModel",242],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",242],")",["T_OBJECT_OPERATOR","->",242],["T_STRING","load",242],"(",["T_VARIABLE","$categoryId",242],")",";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * Get product price with all tax settings processing\n     *\n     * @param float $price inputed product price\n     * @param bool $includingTax return price include tax flag\n     * @param null|Mage_Customer_Model_Address $shippingAddress\n     * @param null|Mage_Customer_Model_Address $billingAddress\n     * @param null|int $ctc customer tax class\n     * @param bool $priceIncludesTax flag that price parameter contain tax\n     * @return float\n     * @see Mage_Tax_Helper_Data::getPrice()\n     *\/",245],["T_WHITESPACE","\n    ",256],["T_PROTECTED","protected",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","_getPrice",257],"(",["T_VARIABLE","$price",257],",",["T_WHITESPACE"," ",257],["T_VARIABLE","$includingTax",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","null",257],",",["T_WHITESPACE"," ",257],["T_VARIABLE","$shippingAddress",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","null",257],",",["T_WHITESPACE","\n        ",257],["T_VARIABLE","$billingAddress",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_STRING","null",258],",",["T_WHITESPACE"," ",258],["T_VARIABLE","$ctc",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_STRING","null",258],",",["T_WHITESPACE"," ",258],["T_VARIABLE","$priceIncludesTax",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_STRING","null",258],["T_WHITESPACE","\n    ",258],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n        ",259],["T_VARIABLE","$product",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","_getProduct",260],"(",")",";",["T_WHITESPACE","\n        ",260],["T_VARIABLE","$store",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_getStore",261],"(",")",";",["T_WHITESPACE","\n\n        ",261],["T_IF","if",263],["T_WHITESPACE"," ",263],"(",["T_STRING","is_null",263],"(",["T_VARIABLE","$priceIncludesTax",263],")",")",["T_WHITESPACE"," ",263],"{",["T_WHITESPACE","\n            ",263],["T_DOC_COMMENT","\/** @var $config Mage_Tax_Model_Config *\/",264],["T_WHITESPACE","\n            ",264],["T_VARIABLE","$config",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","Mage",265],["T_DOUBLE_COLON","::",265],["T_STRING","getSingleton",265],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/config'",265],")",";",["T_WHITESPACE","\n            ",265],["T_VARIABLE","$priceIncludesTax",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$config",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","priceIncludesTax",266],"(",["T_VARIABLE","$store",266],")",["T_WHITESPACE"," ",266],["T_BOOLEAN_OR","||",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$config",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getNeedUseShippingExcludeTax",266],"(",")",";",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n\n        ",267],["T_VARIABLE","$percent",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$product",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getTaxPercent",269],"(",")",";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$includingPercent",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_STRING","null",270],";",["T_WHITESPACE","\n\n        ",270],["T_VARIABLE","$taxClassId",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$product",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getTaxClassId",272],"(",")",";",["T_WHITESPACE","\n        ",272],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_STRING","is_null",273],"(",["T_VARIABLE","$percent",273],")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_IF","if",274],["T_WHITESPACE"," ",274],"(",["T_VARIABLE","$taxClassId",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n                ",274],["T_VARIABLE","$request",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_STRING","Mage",275],["T_DOUBLE_COLON","::",275],["T_STRING","getSingleton",275],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",275],")",["T_WHITESPACE","\n                    ",275],["T_OBJECT_OPERATOR","->",276],["T_STRING","getRateRequest",276],"(",["T_VARIABLE","$shippingAddress",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$billingAddress",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$ctc",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$store",276],")",";",["T_WHITESPACE","\n                ",276],["T_VARIABLE","$percent",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_STRING","Mage",277],["T_DOUBLE_COLON","::",277],["T_STRING","getSingleton",277],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",277],")",["T_OBJECT_OPERATOR","->",277],["T_STRING","getRate",277],"(",["T_VARIABLE","$request",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","setProductClassId",277],"(",["T_VARIABLE","$taxClassId",277],")",")",";",["T_WHITESPACE","\n            ",277],"}",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n        ",279],["T_IF","if",280],["T_WHITESPACE"," ",280],"(",["T_VARIABLE","$taxClassId",280],["T_WHITESPACE"," ",280],["T_BOOLEAN_AND","&&",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$priceIncludesTax",280],")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$taxHelper",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","Mage",281],["T_DOUBLE_COLON","::",281],["T_STRING","helper",281],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",281],")",";",["T_WHITESPACE","\n            ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$taxHelper",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","isCrossBorderTradeEnabled",282],"(",["T_VARIABLE","$store",282],")",")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n                ",282],["T_VARIABLE","$includingPercent",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$percent",283],";",["T_WHITESPACE","\n            ",283],"}",["T_WHITESPACE"," ",284],["T_ELSE","else",284],["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                ",284],["T_VARIABLE","$request",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_STRING","Mage",285],["T_DOUBLE_COLON","::",285],["T_STRING","getSingleton",285],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",285],")",["T_OBJECT_OPERATOR","->",285],["T_STRING","getDefaultRateRequest",285],"(",["T_VARIABLE","$store",285],")",";",["T_WHITESPACE","\n                ",285],["T_VARIABLE","$includingPercent",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_STRING","Mage",286],["T_DOUBLE_COLON","::",286],["T_STRING","getSingleton",286],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",286],")",["T_WHITESPACE","\n                    ",286],["T_OBJECT_OPERATOR","->",287],["T_STRING","getRate",287],"(",["T_VARIABLE","$request",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","setProductClassId",287],"(",["T_VARIABLE","$taxClassId",287],")",")",";",["T_WHITESPACE","\n            ",287],"}",["T_WHITESPACE","\n        ",288],"}",["T_WHITESPACE","\n\n        ",289],["T_IF","if",291],["T_WHITESPACE"," ",291],"(",["T_VARIABLE","$percent",291],["T_WHITESPACE"," ",291],["T_IS_IDENTICAL","===",291],["T_WHITESPACE"," ",291],["T_STRING","false",291],["T_WHITESPACE"," ",291],["T_BOOLEAN_OR","||",291],["T_WHITESPACE"," ",291],["T_STRING","is_null",291],"(",["T_VARIABLE","$percent",291],")",")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n            ",291],["T_IF","if",292],["T_WHITESPACE"," ",292],"(",["T_VARIABLE","$priceIncludesTax",292],["T_WHITESPACE"," ",292],["T_BOOLEAN_AND","&&",292],["T_WHITESPACE"," ",292],"!",["T_VARIABLE","$includingPercent",292],")",["T_WHITESPACE"," ",292],"{",["T_WHITESPACE","\n                ",292],["T_RETURN","return",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$price",293],";",["T_WHITESPACE","\n            ",293],"}",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE","\n        ",295],["T_VARIABLE","$product",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","setTaxPercent",296],"(",["T_VARIABLE","$percent",296],")",";",["T_WHITESPACE","\n\n        ",296],["T_IF","if",298],["T_WHITESPACE"," ",298],"(","!",["T_STRING","is_null",298],"(",["T_VARIABLE","$includingTax",298],")",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n            ",298],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$priceIncludesTax",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                ",299],["T_IF","if",300],["T_WHITESPACE"," ",300],"(",["T_VARIABLE","$includingTax",300],")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n                    ",300],["T_DOC_COMMENT","\/**\n                     * Recalculate price include tax in case of different rates\n                     *\/",301],["T_WHITESPACE","\n                    ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_VARIABLE","$includingPercent",304],["T_WHITESPACE"," ",304],["T_IS_NOT_EQUAL","!=",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$percent",304],")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n                        ",304],["T_VARIABLE","$price",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_calculatePrice",305],"(",["T_VARIABLE","$price",305],",",["T_WHITESPACE"," ",305],["T_VARIABLE","$includingPercent",305],",",["T_WHITESPACE"," ",305],["T_STRING","false",305],")",";",["T_WHITESPACE","\n                        ",305],["T_DOC_COMMENT","\/**\n                         * Using regular rounding. Ex:\n                         * price incl tax   = 52.76\n                         * store tax rate   = 19.6%\n                         * customer tax rate= 19%\n                         *\n                         * price excl tax = 52.76 \/ 1.196 = 44.11371237 ~ 44.11\n                         * tax = 44.11371237 * 0.19 = 8.381605351 ~ 8.38\n                         * price incl tax = 52.49531773 ~ 52.50 != 52.49\n                         *\n                         * that why we need round prices excluding tax before applying tax\n                         * this calculation is used for showing prices on catalog pages\n                         *\/",306],["T_WHITESPACE","\n                        ",318],["T_IF","if",319],["T_WHITESPACE"," ",319],"(",["T_VARIABLE","$percent",319],["T_WHITESPACE"," ",319],["T_IS_NOT_EQUAL","!=",319],["T_WHITESPACE"," ",319],["T_LNUMBER","0",319],")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n                            ",319],["T_VARIABLE","$price",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_STRING","Mage",320],["T_DOUBLE_COLON","::",320],["T_STRING","getSingleton",320],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",320],")",["T_OBJECT_OPERATOR","->",320],["T_STRING","round",320],"(",["T_VARIABLE","$price",320],")",";",["T_WHITESPACE","\n                            ",320],["T_VARIABLE","$price",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_calculatePrice",321],"(",["T_VARIABLE","$price",321],",",["T_WHITESPACE"," ",321],["T_VARIABLE","$percent",321],",",["T_WHITESPACE"," ",321],["T_STRING","true",321],")",";",["T_WHITESPACE","\n                        ",321],"}",["T_WHITESPACE","\n                    ",322],"}",["T_WHITESPACE","\n                ",323],"}",["T_WHITESPACE"," ",324],["T_ELSE","else",324],["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n                    ",324],["T_VARIABLE","$price",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_calculatePrice",325],"(",["T_VARIABLE","$price",325],",",["T_WHITESPACE"," ",325],["T_VARIABLE","$includingPercent",325],",",["T_WHITESPACE"," ",325],["T_STRING","false",325],")",";",["T_WHITESPACE","\n                ",325],"}",["T_WHITESPACE","\n            ",326],"}",["T_WHITESPACE"," ",327],["T_ELSE","else",327],["T_WHITESPACE"," ",327],"{",["T_WHITESPACE","\n                ",327],["T_IF","if",328],["T_WHITESPACE"," ",328],"(",["T_VARIABLE","$includingTax",328],")",["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n                    ",328],["T_VARIABLE","$price",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_calculatePrice",329],"(",["T_VARIABLE","$price",329],",",["T_WHITESPACE"," ",329],["T_VARIABLE","$percent",329],",",["T_WHITESPACE"," ",329],["T_STRING","true",329],")",";",["T_WHITESPACE","\n                ",329],"}",["T_WHITESPACE","\n            ",330],"}",["T_WHITESPACE","\n        ",331],"}",["T_WHITESPACE"," ",332],["T_ELSE","else",332],["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n            ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$priceIncludesTax",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n                ",333],["T_IF","if",334],["T_WHITESPACE"," ",334],"(",["T_VARIABLE","$includingTax",334],")",["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n                    ",334],["T_VARIABLE","$price",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","_calculatePrice",335],"(",["T_VARIABLE","$price",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$includingPercent",335],",",["T_WHITESPACE"," ",335],["T_STRING","false",335],")",";",["T_WHITESPACE","\n                    ",335],["T_VARIABLE","$price",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_calculatePrice",336],"(",["T_VARIABLE","$price",336],",",["T_WHITESPACE"," ",336],["T_VARIABLE","$percent",336],",",["T_WHITESPACE"," ",336],["T_STRING","true",336],")",";",["T_WHITESPACE","\n                ",336],"}",["T_WHITESPACE"," ",337],["T_ELSE","else",337],["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                    ",337],["T_VARIABLE","$price",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_calculatePrice",338],"(",["T_VARIABLE","$price",338],",",["T_WHITESPACE"," ",338],["T_VARIABLE","$includingPercent",338],",",["T_WHITESPACE"," ",338],["T_STRING","false",338],")",";",["T_WHITESPACE","\n                ",338],"}",["T_WHITESPACE","\n            ",339],"}",["T_WHITESPACE"," ",340],["T_ELSE","else",340],["T_WHITESPACE"," ",340],"{",["T_WHITESPACE","\n                ",340],["T_IF","if",341],["T_WHITESPACE"," ",341],"(",["T_VARIABLE","$includingTax",341],")",["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n                    ",341],["T_VARIABLE","$price",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","_calculatePrice",342],"(",["T_VARIABLE","$price",342],",",["T_WHITESPACE"," ",342],["T_VARIABLE","$percent",342],",",["T_WHITESPACE"," ",342],["T_STRING","true",342],")",";",["T_WHITESPACE","\n                ",342],"}",["T_WHITESPACE","\n            ",343],"}",["T_WHITESPACE","\n        ",344],"}",["T_WHITESPACE","\n\n        ",345],["T_RETURN","return",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$store",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","roundPrice",347],"(",["T_VARIABLE","$price",347],")",";",["T_WHITESPACE","\n    ",347],"}",["T_WHITESPACE","\n\n    ",348],["T_DOC_COMMENT","\/**\n     * Calculate price imcluding\/excluding tax base on tax rate percent\n     *\n     * @param float $price\n     * @param float $percent\n     * @param bool $includeTax true - for calculate price including tax and false if price excluding tax\n     * @return float\n     *\/",350],["T_WHITESPACE","\n    ",357],["T_PROTECTED","protected",358],["T_WHITESPACE"," ",358],["T_FUNCTION","function",358],["T_WHITESPACE"," ",358],["T_STRING","_calculatePrice",358],"(",["T_VARIABLE","$price",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$percent",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$includeTax",358],")",["T_WHITESPACE","\n    ",358],"{",["T_WHITESPACE","\n        ",359],["T_DOC_COMMENT","\/** @var $calculator Mage_Tax_Model_Calculation *\/",360],["T_WHITESPACE","\n        ",360],["T_VARIABLE","$calculator",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_STRING","Mage",361],["T_DOUBLE_COLON","::",361],["T_STRING","getSingleton",361],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",361],")",";",["T_WHITESPACE","\n        ",361],["T_VARIABLE","$taxAmount",362],["T_WHITESPACE"," ",362],"=",["T_WHITESPACE"," ",362],["T_VARIABLE","$calculator",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","calcTaxAmount",362],"(",["T_VARIABLE","$price",362],",",["T_WHITESPACE"," ",362],["T_VARIABLE","$percent",362],",",["T_WHITESPACE"," ",362],"!",["T_VARIABLE","$includeTax",362],",",["T_WHITESPACE"," ",362],["T_STRING","false",362],")",";",["T_WHITESPACE","\n\n        ",362],["T_RETURN","return",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$includeTax",364],["T_WHITESPACE"," ",364],"?",["T_WHITESPACE"," ",364],["T_VARIABLE","$price",364],["T_WHITESPACE"," ",364],"+",["T_WHITESPACE"," ",364],["T_VARIABLE","$taxAmount",364],["T_WHITESPACE"," ",364],":",["T_WHITESPACE"," ",364],["T_VARIABLE","$price",364],["T_WHITESPACE"," ",364],"-",["T_WHITESPACE"," ",364],["T_VARIABLE","$taxAmount",364],";",["T_WHITESPACE","\n    ",364],"}",["T_WHITESPACE","\n\n    ",365],["T_DOC_COMMENT","\/**\n     * Retrive tier prices in special format\n     *\n     * @return array\n     *\/",367],["T_WHITESPACE","\n    ",371],["T_PROTECTED","protected",372],["T_WHITESPACE"," ",372],["T_FUNCTION","function",372],["T_WHITESPACE"," ",372],["T_STRING","_getTierPrices",372],"(",")",["T_WHITESPACE","\n    ",372],"{",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$tierPrices",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_ARRAY","array",374],"(",")",";",["T_WHITESPACE","\n        ",374],["T_FOREACH","foreach",375],["T_WHITESPACE"," ",375],"(",["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","_getProduct",375],"(",")",["T_OBJECT_OPERATOR","->",375],["T_STRING","getTierPrice",375],"(",")",["T_WHITESPACE"," ",375],["T_AS","as",375],["T_WHITESPACE"," ",375],["T_VARIABLE","$tierPrice",375],")",["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n            ",375],["T_VARIABLE","$tierPrices",376],"[","]",["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_ARRAY","array",376],"(",["T_WHITESPACE","\n                ",376],["T_CONSTANT_ENCAPSED_STRING","'qty'",377],["T_WHITESPACE"," ",377],["T_DOUBLE_ARROW","=>",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$tierPrice",377],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",377],"]",",",["T_WHITESPACE","\n                ",377],["T_CONSTANT_ENCAPSED_STRING","'price_with_tax'",378],["T_WHITESPACE"," ",378],["T_DOUBLE_ARROW","=>",378],["T_WHITESPACE"," ",378],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_applyTaxToPrice",378],"(",["T_VARIABLE","$tierPrice",378],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",378],"]",")",",",["T_WHITESPACE","\n                ",378],["T_CONSTANT_ENCAPSED_STRING","'price_without_tax'",379],["T_WHITESPACE"," ",379],["T_DOUBLE_ARROW","=>",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","_applyTaxToPrice",379],"(",["T_VARIABLE","$tierPrice",379],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",379],"]",",",["T_WHITESPACE"," ",379],["T_STRING","false",379],")",["T_WHITESPACE","\n            ",379],")",";",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE","\n        ",381],["T_RETURN","return",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$tierPrices",382],";",["T_WHITESPACE","\n    ",382],"}",["T_WHITESPACE","\n\n    ",383],["T_DOC_COMMENT","\/**\n     * Default implementation. May be different for customer\/guest\/admin role.\n     *\n     * @return null\n     *\/",385],["T_WHITESPACE","\n    ",389],["T_PROTECTED","protected",390],["T_WHITESPACE"," ",390],["T_FUNCTION","function",390],["T_WHITESPACE"," ",390],["T_STRING","_getCustomerGroupId",390],"(",")",["T_WHITESPACE","\n    ",390],"{",["T_WHITESPACE","\n        ",391],["T_RETURN","return",392],["T_WHITESPACE"," ",392],["T_STRING","null",392],";",["T_WHITESPACE","\n    ",392],"}",["T_WHITESPACE","\n\n    ",393],["T_DOC_COMMENT","\/**\n     * Default implementation. May be different for customer\/guest\/admin role.\n     *\n     * @param float $price\n     * @param bool $withTax\n     * @return float\n     *\/",395],["T_WHITESPACE","\n    ",401],["T_PROTECTED","protected",402],["T_WHITESPACE"," ",402],["T_FUNCTION","function",402],["T_WHITESPACE"," ",402],["T_STRING","_applyTaxToPrice",402],"(",["T_VARIABLE","$price",402],",",["T_WHITESPACE"," ",402],["T_VARIABLE","$withTax",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_STRING","true",402],")",["T_WHITESPACE","\n    ",402],"{",["T_WHITESPACE","\n        ",403],["T_RETURN","return",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$price",404],";",["T_WHITESPACE","\n    ",404],"}",["T_WHITESPACE","\n",405],"}",["T_WHITESPACE","\n",406]]