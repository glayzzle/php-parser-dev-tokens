[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Catalog\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog product media api\n *\n * @category   Mage\n * @package    Mage_Catalog\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Attribute_Media_Api",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Api_Resource",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Attribute code for media gallery\n     *\n     *\/",36],["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","ATTRIBUTE_CODE",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'media_gallery'",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Allowed mime types for image\n     *\n     * @var array\n     *\/",42],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$_mimeTypes",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_ARRAY","array",47],"(",["T_WHITESPACE","\n        ",47],["T_CONSTANT_ENCAPSED_STRING","'image\/jpeg'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'jpg'",48],",",["T_WHITESPACE","\n        ",48],["T_CONSTANT_ENCAPSED_STRING","'image\/gif'",49],["T_WHITESPACE","  ",49],["T_DOUBLE_ARROW","=>",49],["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'gif'",49],",",["T_WHITESPACE","\n        ",49],["T_CONSTANT_ENCAPSED_STRING","'image\/png'",50],["T_WHITESPACE","  ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'png'",50],["T_WHITESPACE","\n    ",50],")",";",["T_WHITESPACE","\n\n    ",51],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","__construct",53],"(",")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_storeIdSessionField",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'product_store_id'",55],";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Retrieve images for product\n     *\n     * @param int|string $productId\n     * @param string|int $store\n     * @return array\n     *\/",58],["T_WHITESPACE","\n    ",64],["T_PUBLIC","public",65],["T_WHITESPACE"," ",65],["T_FUNCTION","function",65],["T_WHITESPACE"," ",65],["T_STRING","items",65],"(",["T_VARIABLE","$productId",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$store",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","null",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$identifierType",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","null",65],")",["T_WHITESPACE","\n    ",65],"{",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$product",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","_initProduct",67],"(",["T_VARIABLE","$productId",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$store",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$identifierType",67],")",";",["T_WHITESPACE","\n\n        ",67],["T_VARIABLE","$gallery",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_getGalleryAttribute",69],"(",["T_VARIABLE","$product",69],")",";",["T_WHITESPACE","\n\n        ",69],["T_VARIABLE","$galleryData",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$product",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getData",71],"(",["T_STRING","self",71],["T_DOUBLE_COLON","::",71],["T_STRING","ATTRIBUTE_CODE",71],")",";",["T_WHITESPACE","\n\n        ",71],["T_IF","if",73],["T_WHITESPACE"," ",73],"(","!",["T_ISSET","isset",73],"(",["T_VARIABLE","$galleryData",73],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",73],"]",")",["T_WHITESPACE"," ",73],["T_BOOLEAN_OR","||",73],["T_WHITESPACE"," ",73],"!",["T_STRING","is_array",73],"(",["T_VARIABLE","$galleryData",73],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",73],"]",")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_ARRAY","array",74],"(",")",";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n\n        ",75],["T_VARIABLE","$result",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_ARRAY","array",77],"(",")",";",["T_WHITESPACE","\n\n        ",77],["T_FOREACH","foreach",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$galleryData",79],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",79],"]",["T_WHITESPACE"," ",79],["T_AS","as",79],["T_WHITESPACE"," ",79],"&",["T_VARIABLE","$image",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$result",80],"[","]",["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_imageToArray",80],"(",["T_VARIABLE","$image",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$product",80],")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n\n        ",81],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$result",83],";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Retrieve image data\n     *\n     * @param int|string $productId\n     * @param string $file\n     * @param string|int $store\n     * @return array\n     *\/",86],["T_WHITESPACE","\n    ",93],["T_PUBLIC","public",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","info",94],"(",["T_VARIABLE","$productId",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$file",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$store",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","null",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$identifierType",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","null",94],")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$product",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_initProduct",96],"(",["T_VARIABLE","$productId",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$store",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$identifierType",96],")",";",["T_WHITESPACE","\n\n        ",96],["T_VARIABLE","$gallery",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_getGalleryAttribute",98],"(",["T_VARIABLE","$product",98],")",";",["T_WHITESPACE","\n\n        ",98],["T_IF","if",100],["T_WHITESPACE"," ",100],"(","!",["T_VARIABLE","$image",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$gallery",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getBackend",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getImage",100],"(",["T_VARIABLE","$product",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$file",100],")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_fault",101],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",101],")",";",["T_WHITESPACE","\n        ",101],"}",["T_WHITESPACE","\n\n        ",102],["T_RETURN","return",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_imageToArray",104],"(",["T_VARIABLE","$image",104],",",["T_WHITESPACE"," ",104],["T_VARIABLE","$product",104],")",";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Create new image for product and return image filename\n     *\n     * @param int|string $productId\n     * @param array $data\n     * @param string|int $store\n     * @return string\n     *\/",107],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","create",115],"(",["T_VARIABLE","$productId",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$data",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$store",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","null",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$identifierType",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","null",115],")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$data",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_prepareImageData",117],"(",["T_VARIABLE","$data",117],")",";",["T_WHITESPACE","\n\n        ",117],["T_VARIABLE","$product",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_initProduct",119],"(",["T_VARIABLE","$productId",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$store",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$identifierType",119],")",";",["T_WHITESPACE","\n\n        ",119],["T_VARIABLE","$gallery",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_getGalleryAttribute",121],"(",["T_VARIABLE","$product",121],")",";",["T_WHITESPACE","\n\n        ",121],["T_IF","if",123],["T_WHITESPACE"," ",123],"(","!",["T_ISSET","isset",123],"(",["T_VARIABLE","$data",123],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",123],"]",")",["T_WHITESPACE"," ",123],["T_BOOLEAN_OR","||",123],["T_WHITESPACE"," ",123],"!",["T_ISSET","isset",123],"(",["T_VARIABLE","$data",123],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",123],"]","[",["T_CONSTANT_ENCAPSED_STRING","'mime'",123],"]",")",["T_WHITESPACE"," ",123],["T_BOOLEAN_OR","||",123],["T_WHITESPACE"," ",123],"!",["T_ISSET","isset",123],"(",["T_VARIABLE","$data",123],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",123],"]","[",["T_CONSTANT_ENCAPSED_STRING","'content'",123],"]",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_fault",124],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",124],",",["T_WHITESPACE"," ",124],["T_STRING","Mage",124],["T_DOUBLE_COLON","::",124],["T_STRING","helper",124],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",124],")",["T_OBJECT_OPERATOR","->",124],["T_STRING","__",124],"(",["T_CONSTANT_ENCAPSED_STRING","'The image is not specified.'",124],")",")",";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n\n        ",125],["T_IF","if",127],["T_WHITESPACE"," ",127],"(","!",["T_ISSET","isset",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_mimeTypes",127],"[",["T_VARIABLE","$data",127],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",127],"]","[",["T_CONSTANT_ENCAPSED_STRING","'mime'",127],"]","]",")",")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_fault",128],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",128],",",["T_WHITESPACE"," ",128],["T_STRING","Mage",128],["T_DOUBLE_COLON","::",128],["T_STRING","helper",128],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",128],")",["T_OBJECT_OPERATOR","->",128],["T_STRING","__",128],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid image type.'",128],")",")",";",["T_WHITESPACE","\n        ",128],"}",["T_WHITESPACE","\n\n        ",129],["T_VARIABLE","$fileContent",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],"@",["T_STRING","base64_decode",131],"(",["T_VARIABLE","$data",131],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",131],"]","[",["T_CONSTANT_ENCAPSED_STRING","'content'",131],"]",",",["T_WHITESPACE"," ",131],["T_STRING","true",131],")",";",["T_WHITESPACE","\n        ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(","!",["T_VARIABLE","$fileContent",132],")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_fault",133],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",133],",",["T_WHITESPACE"," ",133],["T_STRING","Mage",133],["T_DOUBLE_COLON","::",133],["T_STRING","helper",133],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",133],")",["T_OBJECT_OPERATOR","->",133],["T_STRING","__",133],"(",["T_CONSTANT_ENCAPSED_STRING","'The image contents is not valid base64 data.'",133],")",")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n\n        ",134],["T_UNSET","unset",136],"(",["T_VARIABLE","$data",136],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",136],"]","[",["T_CONSTANT_ENCAPSED_STRING","'content'",136],"]",")",";",["T_WHITESPACE","\n\n        ",136],["T_VARIABLE","$tmpDirectory",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_STRING","Mage",138],["T_DOUBLE_COLON","::",138],["T_STRING","getBaseDir",138],"(",["T_CONSTANT_ENCAPSED_STRING","'var'",138],")",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_STRING","DS",138],["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","'api'",138],["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_STRING","DS",138],["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_getSession",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","getSessionId",138],"(",")",";",["T_WHITESPACE","\n\n        ",138],["T_IF","if",140],["T_WHITESPACE"," ",140],"(",["T_ISSET","isset",140],"(",["T_VARIABLE","$data",140],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",140],"]","[",["T_CONSTANT_ENCAPSED_STRING","'name'",140],"]",")",["T_WHITESPACE"," ",140],["T_BOOLEAN_AND","&&",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$data",140],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",140],"]","[",["T_CONSTANT_ENCAPSED_STRING","'name'",140],"]",")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$fileName",141],["T_WHITESPACE","  ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$data",141],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",141],"]","[",["T_CONSTANT_ENCAPSED_STRING","'name'",141],"]",";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE"," ",142],["T_ELSE","else",142],["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$fileName",143],["T_WHITESPACE","  ",143],"=",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'image'",143],";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$fileName",145],["T_WHITESPACE"," ",145],["T_CONCAT_EQUAL",".=",145],["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'.'",145],["T_WHITESPACE"," ",145],".",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_mimeTypes",145],"[",["T_VARIABLE","$data",145],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",145],"]","[",["T_CONSTANT_ENCAPSED_STRING","'mime'",145],"]","]",";",["T_WHITESPACE","\n\n        ",145],["T_VARIABLE","$ioAdapter",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_NEW","new",147],["T_WHITESPACE"," ",147],["T_STRING","Varien_Io_File",147],"(",")",";",["T_WHITESPACE","\n        ",147],["T_TRY","try",148],["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_COMMENT","\/\/ Create temporary directory for api\n",149],["T_WHITESPACE","            ",150],["T_VARIABLE","$ioAdapter",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","checkAndCreateFolder",150],"(",["T_VARIABLE","$tmpDirectory",150],")",";",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$ioAdapter",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","open",151],"(",["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",151],["T_DOUBLE_ARROW","=>",151],["T_VARIABLE","$tmpDirectory",151],")",")",";",["T_WHITESPACE","\n            ",151],["T_COMMENT","\/\/ Write image file\n",152],["T_WHITESPACE","            ",153],["T_VARIABLE","$ioAdapter",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","write",153],"(",["T_VARIABLE","$fileName",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$fileContent",153],",",["T_WHITESPACE"," ",153],["T_LNUMBER","0666",153],")",";",["T_WHITESPACE","\n            ",153],["T_UNSET","unset",154],"(",["T_VARIABLE","$fileContent",154],")",";",["T_WHITESPACE","\n\n            ",154],["T_COMMENT","\/\/ try to create Image object - it fails with Exception if image is not supported\n",156],["T_WHITESPACE","            ",157],["T_TRY","try",157],["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n                ",157],["T_NEW","new",158],["T_WHITESPACE"," ",158],["T_STRING","Varien_Image",158],"(",["T_VARIABLE","$tmpDirectory",158],["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_STRING","DS",158],["T_WHITESPACE"," ",158],".",["T_WHITESPACE"," ",158],["T_VARIABLE","$fileName",158],")",";",["T_WHITESPACE","\n            ",158],"}",["T_WHITESPACE"," ",159],["T_CATCH","catch",159],["T_WHITESPACE"," ",159],"(",["T_STRING","Exception",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$e",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                ",159],["T_COMMENT","\/\/ Remove temporary directory\n",160],["T_WHITESPACE","                ",161],["T_VARIABLE","$ioAdapter",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","rmdir",161],"(",["T_VARIABLE","$tmpDirectory",161],",",["T_WHITESPACE"," ",161],["T_STRING","true",161],")",";",["T_WHITESPACE","\n\n                ",161],["T_THROW","throw",163],["T_WHITESPACE"," ",163],["T_NEW","new",163],["T_WHITESPACE"," ",163],["T_STRING","Mage_Core_Exception",163],"(",["T_VARIABLE","$e",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getMessage",163],"(",")",")",";",["T_WHITESPACE","\n            ",163],"}",["T_WHITESPACE","\n\n            ",164],["T_COMMENT","\/\/ Adding image to gallery\n",166],["T_WHITESPACE","            ",167],["T_VARIABLE","$file",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$gallery",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getBackend",167],"(",")",["T_OBJECT_OPERATOR","->",167],["T_STRING","addImage",167],"(",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$product",168],",",["T_WHITESPACE","\n                ",168],["T_VARIABLE","$tmpDirectory",169],["T_WHITESPACE"," ",169],".",["T_WHITESPACE"," ",169],["T_STRING","DS",169],["T_WHITESPACE"," ",169],".",["T_WHITESPACE"," ",169],["T_VARIABLE","$fileName",169],",",["T_WHITESPACE","\n                ",169],["T_STRING","null",170],",",["T_WHITESPACE","\n                ",170],["T_STRING","true",171],["T_WHITESPACE","\n            ",171],")",";",["T_WHITESPACE","\n\n            ",172],["T_COMMENT","\/\/ Remove temporary directory\n",174],["T_WHITESPACE","            ",175],["T_VARIABLE","$ioAdapter",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","rmdir",175],"(",["T_VARIABLE","$tmpDirectory",175],",",["T_WHITESPACE"," ",175],["T_STRING","true",175],")",";",["T_WHITESPACE","\n\n            ",175],["T_VARIABLE","$gallery",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getBackend",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","updateImage",177],"(",["T_VARIABLE","$product",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$file",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$data",177],")",";",["T_WHITESPACE","\n\n            ",177],["T_IF","if",179],["T_WHITESPACE"," ",179],"(",["T_ISSET","isset",179],"(",["T_VARIABLE","$data",179],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",179],"]",")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$gallery",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getBackend",180],"(",")",["T_OBJECT_OPERATOR","->",180],["T_STRING","setMediaAttribute",180],"(",["T_VARIABLE","$product",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$data",180],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",180],"]",",",["T_WHITESPACE"," ",180],["T_VARIABLE","$file",180],")",";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE","\n\n            ",181],["T_VARIABLE","$product",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","save",183],"(",")",";",["T_WHITESPACE","\n        ",183],"}",["T_WHITESPACE"," ",184],["T_CATCH","catch",184],["T_WHITESPACE"," ",184],"(",["T_STRING","Mage_Core_Exception",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$e",184],")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_fault",185],"(",["T_CONSTANT_ENCAPSED_STRING","'not_created'",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$e",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getMessage",185],"(",")",")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE"," ",186],["T_CATCH","catch",186],["T_WHITESPACE"," ",186],"(",["T_STRING","Exception",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$e",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_fault",187],"(",["T_CONSTANT_ENCAPSED_STRING","'not_created'",187],",",["T_WHITESPACE"," ",187],["T_STRING","Mage",187],["T_DOUBLE_COLON","::",187],["T_STRING","helper",187],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",187],")",["T_OBJECT_OPERATOR","->",187],["T_STRING","__",187],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot create image.'",187],")",")",";",["T_WHITESPACE","\n        ",187],"}",["T_WHITESPACE","\n\n        ",188],["T_RETURN","return",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$gallery",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getBackend",190],"(",")",["T_OBJECT_OPERATOR","->",190],["T_STRING","getRenamedImage",190],"(",["T_VARIABLE","$file",190],")",";",["T_WHITESPACE","\n    ",190],"}",["T_WHITESPACE","\n\n    ",191],["T_DOC_COMMENT","\/**\n     * Update image data\n     *\n     * @param int|string $productId\n     * @param string $file\n     * @param array $data\n     * @param string|int $store\n     * @return boolean\n     *\/",193],["T_WHITESPACE","\n    ",201],["T_PUBLIC","public",202],["T_WHITESPACE"," ",202],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","update",202],"(",["T_VARIABLE","$productId",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$file",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$data",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$store",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","null",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$identifierType",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","null",202],")",["T_WHITESPACE","\n    ",202],"{",["T_WHITESPACE","\n        ",203],["T_VARIABLE","$data",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_prepareImageData",204],"(",["T_VARIABLE","$data",204],")",";",["T_WHITESPACE","\n\n        ",204],["T_VARIABLE","$product",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_initProduct",206],"(",["T_VARIABLE","$productId",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$store",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$identifierType",206],")",";",["T_WHITESPACE","\n\n        ",206],["T_VARIABLE","$gallery",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_getGalleryAttribute",208],"(",["T_VARIABLE","$product",208],")",";",["T_WHITESPACE","\n\n        ",208],["T_IF","if",210],["T_WHITESPACE"," ",210],"(","!",["T_VARIABLE","$gallery",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getBackend",210],"(",")",["T_OBJECT_OPERATOR","->",210],["T_STRING","getImage",210],"(",["T_VARIABLE","$product",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$file",210],")",")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_fault",211],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",211],")",";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE","\n\n        ",212],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_ISSET","isset",214],"(",["T_VARIABLE","$data",214],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",214],"]","[",["T_CONSTANT_ENCAPSED_STRING","'mime'",214],"]",")",["T_WHITESPACE"," ",214],["T_BOOLEAN_AND","&&",214],["T_WHITESPACE"," ",214],["T_ISSET","isset",214],"(",["T_VARIABLE","$data",214],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",214],"]","[",["T_CONSTANT_ENCAPSED_STRING","'content'",214],"]",")",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_IF","if",215],["T_WHITESPACE"," ",215],"(","!",["T_ISSET","isset",215],"(",["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_mimeTypes",215],"[",["T_VARIABLE","$data",215],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",215],"]","[",["T_CONSTANT_ENCAPSED_STRING","'mime'",215],"]","]",")",")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n                ",215],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_fault",216],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",216],",",["T_WHITESPACE"," ",216],["T_STRING","Mage",216],["T_DOUBLE_COLON","::",216],["T_STRING","helper",216],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",216],")",["T_OBJECT_OPERATOR","->",216],["T_STRING","__",216],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid image type.'",216],")",")",";",["T_WHITESPACE","\n            ",216],"}",["T_WHITESPACE","\n\n            ",217],["T_VARIABLE","$fileContent",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],"@",["T_STRING","base64_decode",219],"(",["T_VARIABLE","$data",219],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",219],"]","[",["T_CONSTANT_ENCAPSED_STRING","'content'",219],"]",",",["T_WHITESPACE"," ",219],["T_STRING","true",219],")",";",["T_WHITESPACE","\n            ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(","!",["T_VARIABLE","$fileContent",220],")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n                ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","_fault",221],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",221],",",["T_WHITESPACE"," ",221],["T_STRING","Mage",221],["T_DOUBLE_COLON","::",221],["T_STRING","helper",221],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",221],")",["T_OBJECT_OPERATOR","->",221],["T_STRING","__",221],"(",["T_CONSTANT_ENCAPSED_STRING","'Image content is not valid base64 data.'",221],")",")",";",["T_WHITESPACE","\n            ",221],"}",["T_WHITESPACE","\n\n            ",222],["T_UNSET","unset",224],"(",["T_VARIABLE","$data",224],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",224],"]","[",["T_CONSTANT_ENCAPSED_STRING","'content'",224],"]",")",";",["T_WHITESPACE","\n\n            ",224],["T_VARIABLE","$ioAdapter",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_NEW","new",226],["T_WHITESPACE"," ",226],["T_STRING","Varien_Io_File",226],"(",")",";",["T_WHITESPACE","\n            ",226],["T_TRY","try",227],["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n                ",227],["T_VARIABLE","$fileName",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_STRING","Mage",228],["T_DOUBLE_COLON","::",228],["T_STRING","getBaseDir",228],"(",["T_CONSTANT_ENCAPSED_STRING","'media'",228],")",".",["T_WHITESPACE"," ",228],["T_STRING","DS",228],["T_WHITESPACE"," ",228],".",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'catalog'",228],["T_WHITESPACE"," ",228],".",["T_WHITESPACE"," ",228],["T_STRING","DS",228],["T_WHITESPACE"," ",228],".",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'product'",228],["T_WHITESPACE"," ",228],".",["T_WHITESPACE"," ",228],["T_VARIABLE","$file",228],";",["T_WHITESPACE","\n                ",228],["T_VARIABLE","$ioAdapter",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","open",229],"(",["T_ARRAY","array",229],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",229],["T_DOUBLE_ARROW","=>",229],["T_STRING","dirname",229],"(",["T_VARIABLE","$fileName",229],")",")",")",";",["T_WHITESPACE","\n                ",229],["T_VARIABLE","$ioAdapter",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","write",230],"(",["T_STRING","basename",230],"(",["T_VARIABLE","$fileName",230],")",",",["T_WHITESPACE"," ",230],["T_VARIABLE","$fileContent",230],",",["T_WHITESPACE"," ",230],["T_LNUMBER","0666",230],")",";",["T_WHITESPACE","\n\n            ",230],"}",["T_WHITESPACE"," ",232],["T_CATCH","catch",232],"(",["T_STRING","Exception",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$e",232],")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n                ",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_fault",233],"(",["T_CONSTANT_ENCAPSED_STRING","'not_created'",233],",",["T_WHITESPACE"," ",233],["T_STRING","Mage",233],["T_DOUBLE_COLON","::",233],["T_STRING","helper",233],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",233],")",["T_OBJECT_OPERATOR","->",233],["T_STRING","__",233],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t create image.'",233],")",")",";",["T_WHITESPACE","\n            ",233],"}",["T_WHITESPACE","\n        ",234],"}",["T_WHITESPACE","\n\n        ",235],["T_VARIABLE","$gallery",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getBackend",237],"(",")",["T_OBJECT_OPERATOR","->",237],["T_STRING","updateImage",237],"(",["T_VARIABLE","$product",237],",",["T_WHITESPACE"," ",237],["T_VARIABLE","$file",237],",",["T_WHITESPACE"," ",237],["T_VARIABLE","$data",237],")",";",["T_WHITESPACE","\n\n        ",237],["T_IF","if",239],["T_WHITESPACE"," ",239],"(",["T_ISSET","isset",239],"(",["T_VARIABLE","$data",239],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",239],"]",")",["T_WHITESPACE"," ",239],["T_BOOLEAN_AND","&&",239],["T_WHITESPACE"," ",239],["T_STRING","is_array",239],"(",["T_VARIABLE","$data",239],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",239],"]",")",")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$oldTypes",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_ARRAY","array",240],"(",")",";",["T_WHITESPACE","\n            ",240],["T_FOREACH","foreach",241],["T_WHITESPACE"," ",241],"(",["T_VARIABLE","$product",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getMediaAttributes",241],"(",")",["T_WHITESPACE"," ",241],["T_AS","as",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$attribute",241],")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n                ",241],["T_IF","if",242],["T_WHITESPACE"," ",242],"(",["T_VARIABLE","$product",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getData",242],"(",["T_VARIABLE","$attribute",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getAttributeCode",242],"(",")",")",["T_WHITESPACE"," ",242],["T_IS_EQUAL","==",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$file",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n                     ",242],["T_VARIABLE","$oldTypes",243],"[","]",["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$attribute",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getAttributeCode",243],"(",")",";",["T_WHITESPACE","\n                ",243],"}",["T_WHITESPACE","\n            ",244],"}",["T_WHITESPACE","\n\n            ",245],["T_VARIABLE","$clear",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_STRING","array_diff",247],"(",["T_VARIABLE","$oldTypes",247],",",["T_WHITESPACE"," ",247],["T_VARIABLE","$data",247],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",247],"]",")",";",["T_WHITESPACE","\n\n            ",247],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_STRING","count",249],"(",["T_VARIABLE","$clear",249],")",["T_WHITESPACE"," ",249],">",["T_WHITESPACE"," ",249],["T_LNUMBER","0",249],")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                ",249],["T_VARIABLE","$gallery",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getBackend",250],"(",")",["T_OBJECT_OPERATOR","->",250],["T_STRING","clearMediaAttribute",250],"(",["T_VARIABLE","$product",250],",",["T_WHITESPACE"," ",250],["T_VARIABLE","$clear",250],")",";",["T_WHITESPACE","\n            ",250],"}",["T_WHITESPACE","\n\n            ",251],["T_VARIABLE","$gallery",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getBackend",253],"(",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","setMediaAttribute",253],"(",["T_VARIABLE","$product",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$data",253],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",253],"]",",",["T_WHITESPACE"," ",253],["T_VARIABLE","$file",253],")",";",["T_WHITESPACE","\n        ",253],"}",["T_WHITESPACE","\n\n        ",254],["T_TRY","try",256],["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$product",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","save",257],"(",")",";",["T_WHITESPACE","\n        ",257],"}",["T_WHITESPACE"," ",258],["T_CATCH","catch",258],["T_WHITESPACE"," ",258],"(",["T_STRING","Mage_Core_Exception",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$e",258],")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_fault",259],"(",["T_CONSTANT_ENCAPSED_STRING","'not_updated'",259],",",["T_WHITESPACE"," ",259],["T_VARIABLE","$e",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getMessage",259],"(",")",")",";",["T_WHITESPACE","\n        ",259],"}",["T_WHITESPACE","\n\n        ",260],["T_RETURN","return",262],["T_WHITESPACE"," ",262],["T_STRING","true",262],";",["T_WHITESPACE","\n    ",262],"}",["T_WHITESPACE","\n\n    ",263],["T_DOC_COMMENT","\/**\n     * Remove image from product\n     *\n     * @param int|string $productId\n     * @param string $file\n     * @return boolean\n     *\/",265],["T_WHITESPACE","\n    ",271],["T_PUBLIC","public",272],["T_WHITESPACE"," ",272],["T_FUNCTION","function",272],["T_WHITESPACE"," ",272],["T_STRING","remove",272],"(",["T_VARIABLE","$productId",272],",",["T_WHITESPACE"," ",272],["T_VARIABLE","$file",272],",",["T_WHITESPACE"," ",272],["T_VARIABLE","$identifierType",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_STRING","null",272],")",["T_WHITESPACE","\n    ",272],"{",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$product",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_initProduct",274],"(",["T_VARIABLE","$productId",274],",",["T_WHITESPACE"," ",274],["T_STRING","null",274],",",["T_WHITESPACE"," ",274],["T_VARIABLE","$identifierType",274],")",";",["T_WHITESPACE","\n\n        ",274],["T_VARIABLE","$gallery",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_getGalleryAttribute",276],"(",["T_VARIABLE","$product",276],")",";",["T_WHITESPACE","\n\n        ",276],["T_IF","if",278],["T_WHITESPACE"," ",278],"(","!",["T_VARIABLE","$gallery",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getBackend",278],"(",")",["T_OBJECT_OPERATOR","->",278],["T_STRING","getImage",278],"(",["T_VARIABLE","$product",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$file",278],")",")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n            ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_fault",279],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",279],")",";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n\n        ",280],["T_VARIABLE","$gallery",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getBackend",282],"(",")",["T_OBJECT_OPERATOR","->",282],["T_STRING","removeImage",282],"(",["T_VARIABLE","$product",282],",",["T_WHITESPACE"," ",282],["T_VARIABLE","$file",282],")",";",["T_WHITESPACE","\n\n        ",282],["T_TRY","try",284],["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$product",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","save",285],"(",")",";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE"," ",286],["T_CATCH","catch",286],["T_WHITESPACE"," ",286],"(",["T_STRING","Mage_Core_Exception",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$e",286],")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_fault",287],"(",["T_CONSTANT_ENCAPSED_STRING","'not_removed'",287],",",["T_WHITESPACE"," ",287],["T_VARIABLE","$e",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getMessage",287],"(",")",")",";",["T_WHITESPACE","\n        ",287],"}",["T_WHITESPACE","\n\n        ",288],["T_RETURN","return",290],["T_WHITESPACE"," ",290],["T_STRING","true",290],";",["T_WHITESPACE","\n    ",290],"}",["T_WHITESPACE","\n\n\n    ",291],["T_DOC_COMMENT","\/**\n     * Retrieve image types (image, small_image, thumbnail, etc...)\n     *\n     * @param int $setId\n     * @return array\n     *\/",294],["T_WHITESPACE","\n    ",299],["T_PUBLIC","public",300],["T_WHITESPACE"," ",300],["T_FUNCTION","function",300],["T_WHITESPACE"," ",300],["T_STRING","types",300],"(",["T_VARIABLE","$setId",300],")",["T_WHITESPACE","\n    ",300],"{",["T_WHITESPACE","\n        ",301],["T_VARIABLE","$attributes",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_STRING","Mage",302],["T_DOUBLE_COLON","::",302],["T_STRING","getModel",302],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",302],")",["T_OBJECT_OPERATOR","->",302],["T_STRING","getResource",302],"(",")",["T_WHITESPACE","\n                ",302],["T_OBJECT_OPERATOR","->",303],["T_STRING","loadAllAttributes",303],"(",")",["T_WHITESPACE","\n                ",303],["T_OBJECT_OPERATOR","->",304],["T_STRING","getSortedAttributes",304],"(",["T_VARIABLE","$setId",304],")",";",["T_WHITESPACE","\n\n        ",304],["T_VARIABLE","$result",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_ARRAY","array",306],"(",")",";",["T_WHITESPACE","\n\n        ",306],["T_FOREACH","foreach",308],["T_WHITESPACE"," ",308],"(",["T_VARIABLE","$attributes",308],["T_WHITESPACE"," ",308],["T_AS","as",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$attribute",308],")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n            ",308],["T_COMMENT","\/* @var $attribute Mage_Catalog_Model_Resource_Eav_Attribute *\/",309],["T_WHITESPACE","\n            ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(",["T_VARIABLE","$attribute",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","isInSet",310],"(",["T_VARIABLE","$setId",310],")",["T_WHITESPACE","\n                ",310],["T_BOOLEAN_AND","&&",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$attribute",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getFrontendInput",311],"(",")",["T_WHITESPACE"," ",311],["T_IS_EQUAL","==",311],["T_WHITESPACE"," ",311],["T_CONSTANT_ENCAPSED_STRING","'media_image'",311],")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n                ",311],["T_IF","if",312],["T_WHITESPACE"," ",312],"(",["T_VARIABLE","$attribute",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","isScopeGlobal",312],"(",")",")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n                    ",312],["T_VARIABLE","$scope",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_CONSTANT_ENCAPSED_STRING","'global'",313],";",["T_WHITESPACE","\n                ",313],"}",["T_WHITESPACE"," ",314],["T_ELSEIF","elseif",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$attribute",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","isScopeWebsite",314],"(",")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n                    ",314],["T_VARIABLE","$scope",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_CONSTANT_ENCAPSED_STRING","'website'",315],";",["T_WHITESPACE","\n                ",315],"}",["T_WHITESPACE"," ",316],["T_ELSE","else",316],["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n                    ",316],["T_VARIABLE","$scope",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_CONSTANT_ENCAPSED_STRING","'store'",317],";",["T_WHITESPACE","\n                ",317],"}",["T_WHITESPACE","\n\n                ",318],["T_VARIABLE","$result",320],"[","]",["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_ARRAY","array",320],"(",["T_WHITESPACE","\n                    ",320],["T_CONSTANT_ENCAPSED_STRING","'code'",321],["T_WHITESPACE","         ",321],["T_DOUBLE_ARROW","=>",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$attribute",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getAttributeCode",321],"(",")",",",["T_WHITESPACE","\n                    ",321],["T_CONSTANT_ENCAPSED_STRING","'scope'",322],["T_WHITESPACE","        ",322],["T_DOUBLE_ARROW","=>",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$scope",322],["T_WHITESPACE","\n                ",322],")",";",["T_WHITESPACE","\n            ",323],"}",["T_WHITESPACE","\n        ",324],"}",["T_WHITESPACE","\n\n        ",325],["T_RETURN","return",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$result",327],";",["T_WHITESPACE","\n    ",327],"}",["T_WHITESPACE","\n\n    ",328],["T_DOC_COMMENT","\/**\n     * Prepare data to create or update image\n     *\n     * @param array $data\n     * @return array\n     *\/",330],["T_WHITESPACE","\n    ",335],["T_PROTECTED","protected",336],["T_WHITESPACE"," ",336],["T_FUNCTION","function",336],["T_WHITESPACE"," ",336],["T_STRING","_prepareImageData",336],"(",["T_VARIABLE","$data",336],")",["T_WHITESPACE","\n    ",336],"{",["T_WHITESPACE","\n        ",337],["T_RETURN","return",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$data",338],";",["T_WHITESPACE","\n    ",338],"}",["T_WHITESPACE","\n\n    ",339],["T_DOC_COMMENT","\/**\n     * Retrieve gallery attribute from product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param Mage_Catalog_Model_Resource_Eav_Mysql4_Attribute|boolean\n     *\/",341],["T_WHITESPACE","\n    ",346],["T_PROTECTED","protected",347],["T_WHITESPACE"," ",347],["T_FUNCTION","function",347],["T_WHITESPACE"," ",347],["T_STRING","_getGalleryAttribute",347],"(",["T_VARIABLE","$product",347],")",["T_WHITESPACE","\n    ",347],"{",["T_WHITESPACE","\n        ",348],["T_VARIABLE","$attributes",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$product",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getTypeInstance",349],"(",["T_STRING","true",349],")",["T_WHITESPACE","\n            ",349],["T_OBJECT_OPERATOR","->",350],["T_STRING","getSetAttributes",350],"(",["T_VARIABLE","$product",350],")",";",["T_WHITESPACE","\n\n        ",350],["T_IF","if",352],["T_WHITESPACE"," ",352],"(","!",["T_ISSET","isset",352],"(",["T_VARIABLE","$attributes",352],"[",["T_STRING","self",352],["T_DOUBLE_COLON","::",352],["T_STRING","ATTRIBUTE_CODE",352],"]",")",")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_fault",353],"(",["T_CONSTANT_ENCAPSED_STRING","'not_media'",353],")",";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE","\n\n        ",354],["T_RETURN","return",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$attributes",356],"[",["T_STRING","self",356],["T_DOUBLE_COLON","::",356],["T_STRING","ATTRIBUTE_CODE",356],"]",";",["T_WHITESPACE","\n    ",356],"}",["T_WHITESPACE","\n\n    ",357],["T_DOC_COMMENT","\/**\n     * Retrie\n     * ve media config\n     *\n     * @return Mage_Catalog_Model_Product_Media_Config\n     *\/",359],["T_WHITESPACE","\n    ",364],["T_PROTECTED","protected",365],["T_WHITESPACE"," ",365],["T_FUNCTION","function",365],["T_WHITESPACE"," ",365],["T_STRING","_getMediaConfig",365],"(",")",["T_WHITESPACE","\n    ",365],"{",["T_WHITESPACE","\n        ",366],["T_RETURN","return",367],["T_WHITESPACE"," ",367],["T_STRING","Mage",367],["T_DOUBLE_COLON","::",367],["T_STRING","getSingleton",367],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_media_config'",367],")",";",["T_WHITESPACE","\n    ",367],"}",["T_WHITESPACE","\n\n    ",368],["T_DOC_COMMENT","\/**\n     * Converts image to api array data\n     *\n     * @param array $image\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",370],["T_WHITESPACE","\n    ",376],["T_PROTECTED","protected",377],["T_WHITESPACE"," ",377],["T_FUNCTION","function",377],["T_WHITESPACE"," ",377],["T_STRING","_imageToArray",377],"(","&",["T_VARIABLE","$image",377],",",["T_WHITESPACE"," ",377],["T_VARIABLE","$product",377],")",["T_WHITESPACE","\n    ",377],"{",["T_WHITESPACE","\n        ",378],["T_VARIABLE","$result",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_ARRAY","array",379],"(",["T_WHITESPACE","\n            ",379],["T_CONSTANT_ENCAPSED_STRING","'file'",380],["T_WHITESPACE","      ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$image",380],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",380],"]",",",["T_WHITESPACE","\n            ",380],["T_CONSTANT_ENCAPSED_STRING","'label'",381],["T_WHITESPACE","     ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$image",381],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",381],"]",",",["T_WHITESPACE","\n            ",381],["T_CONSTANT_ENCAPSED_STRING","'position'",382],["T_WHITESPACE","  ",382],["T_DOUBLE_ARROW","=>",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$image",382],"[",["T_CONSTANT_ENCAPSED_STRING","'position'",382],"]",",",["T_WHITESPACE","\n            ",382],["T_CONSTANT_ENCAPSED_STRING","'exclude'",383],["T_WHITESPACE","   ",383],["T_DOUBLE_ARROW","=>",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$image",383],"[",["T_CONSTANT_ENCAPSED_STRING","'disabled'",383],"]",",",["T_WHITESPACE","\n            ",383],["T_CONSTANT_ENCAPSED_STRING","'url'",384],["T_WHITESPACE","       ",384],["T_DOUBLE_ARROW","=>",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_getMediaConfig",384],"(",")",["T_OBJECT_OPERATOR","->",384],["T_STRING","getMediaUrl",384],"(",["T_VARIABLE","$image",384],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",384],"]",")",",",["T_WHITESPACE","\n            ",384],["T_CONSTANT_ENCAPSED_STRING","'types'",385],["T_WHITESPACE","     ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_ARRAY","array",385],"(",")",["T_WHITESPACE","\n        ",385],")",";",["T_WHITESPACE","\n\n\n        ",386],["T_FOREACH","foreach",389],["T_WHITESPACE"," ",389],"(",["T_VARIABLE","$product",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getMediaAttributes",389],"(",")",["T_WHITESPACE"," ",389],["T_AS","as",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$attribute",389],")",["T_WHITESPACE"," ",389],"{",["T_WHITESPACE","\n            ",389],["T_IF","if",390],["T_WHITESPACE"," ",390],"(",["T_VARIABLE","$product",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getData",390],"(",["T_VARIABLE","$attribute",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getAttributeCode",390],"(",")",")",["T_WHITESPACE"," ",390],["T_IS_EQUAL","==",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$image",390],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",390],"]",")",["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n                ",390],["T_VARIABLE","$result",391],"[",["T_CONSTANT_ENCAPSED_STRING","'types'",391],"]","[","]",["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_VARIABLE","$attribute",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getAttributeCode",391],"(",")",";",["T_WHITESPACE","\n            ",391],"}",["T_WHITESPACE","\n        ",392],"}",["T_WHITESPACE","\n\n        ",393],["T_RETURN","return",395],["T_WHITESPACE"," ",395],["T_VARIABLE","$result",395],";",["T_WHITESPACE","\n    ",395],"}",["T_WHITESPACE","\n\n    ",396],["T_DOC_COMMENT","\/**\n     * Retrieve product\n     *\n     * @param int|string $productId\n     * @param string|int $store\n     * @param  string $identifierType\n     * @return Mage_Catalog_Model_Product\n     *\/",398],["T_WHITESPACE","\n    ",405],["T_PROTECTED","protected",406],["T_WHITESPACE"," ",406],["T_FUNCTION","function",406],["T_WHITESPACE"," ",406],["T_STRING","_initProduct",406],"(",["T_VARIABLE","$productId",406],",",["T_WHITESPACE"," ",406],["T_VARIABLE","$store",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_STRING","null",406],",",["T_WHITESPACE"," ",406],["T_VARIABLE","$identifierType",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_STRING","null",406],")",["T_WHITESPACE","\n    ",406],"{",["T_WHITESPACE","\n        ",407],["T_VARIABLE","$product",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_STRING","Mage",408],["T_DOUBLE_COLON","::",408],["T_STRING","helper",408],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",408],")",["T_OBJECT_OPERATOR","->",408],["T_STRING","getProduct",408],"(",["T_VARIABLE","$productId",408],",",["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","_getStoreId",408],"(",["T_VARIABLE","$store",408],")",",",["T_WHITESPACE"," ",408],["T_VARIABLE","$identifierType",408],")",";",["T_WHITESPACE","\n        ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(","!",["T_VARIABLE","$product",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getId",409],"(",")",")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_fault",410],"(",["T_CONSTANT_ENCAPSED_STRING","'product_not_exists'",410],")",";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n\n        ",411],["T_RETURN","return",413],["T_WHITESPACE"," ",413],["T_VARIABLE","$product",413],";",["T_WHITESPACE","\n    ",413],"}",["T_WHITESPACE","\n",414],"}",["T_WHITESPACE"," ",415],["T_COMMENT","\/\/ Class Mage_Catalog_Model_Product_Attribute_Media_Api End\n",415]]