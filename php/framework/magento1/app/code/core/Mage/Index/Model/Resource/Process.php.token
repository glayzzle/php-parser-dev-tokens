[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Index\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Index Process Resource Model\n *\n * @category    Mage\n * @package     Mage_Index\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Index_Model_Resource_Process",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Initialize  table and table pk\n     *\n     *\/",37],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_init",43],"(",["T_CONSTANT_ENCAPSED_STRING","'index\/process'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'process_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Update process\/event association row status\n     *\n     * @param int $processId\n     * @param int $eventId\n     * @param string $status\n     * @return Mage_Index_Model_Resource_Process\n     *\/",46],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","updateEventStatus",54],"(",["T_VARIABLE","$processId",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$eventId",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$status",54],")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$adapter",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_getWriteAdapter",56],"(",")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$condition",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_ARRAY","array",57],"(",["T_WHITESPACE","\n            ",57],["T_CONSTANT_ENCAPSED_STRING","'process_id = ?'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$processId",58],",",["T_WHITESPACE","\n            ",58],["T_CONSTANT_ENCAPSED_STRING","'event_id = ?'",59],["T_WHITESPACE","   ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$eventId",59],["T_WHITESPACE","\n        ",59],")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$adapter",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","update",61],"(",["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getTable",61],"(",["T_CONSTANT_ENCAPSED_STRING","'index\/process_event'",61],")",",",["T_WHITESPACE"," ",61],["T_ARRAY","array",61],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",61],["T_WHITESPACE"," ",61],["T_DOUBLE_ARROW","=>",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$status",61],")",",",["T_WHITESPACE"," ",61],["T_VARIABLE","$condition",61],")",";",["T_WHITESPACE","\n        ",61],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],";",["T_WHITESPACE","\n    ",62],"}",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Register process end\n     *\n     * @param Mage_Index_Model_Process $process\n     * @return Mage_Index_Model_Resource_Process\n     *\/",65],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","endProcess",71],"(",["T_STRING","Mage_Index_Model_Process",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$process",71],")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$data",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",["T_WHITESPACE","\n            ",73],["T_CONSTANT_ENCAPSED_STRING","'status'",74],["T_WHITESPACE","    ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_STRING","Mage_Index_Model_Process",74],["T_DOUBLE_COLON","::",74],["T_STRING","STATUS_PENDING",74],",",["T_WHITESPACE","\n            ",74],["T_CONSTANT_ENCAPSED_STRING","'ended_at'",75],["T_WHITESPACE","  ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","formatDate",75],"(",["T_STRING","time",75],"(",")",")",",",["T_WHITESPACE","\n        ",75],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_updateProcessData",77],"(",["T_VARIABLE","$process",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getId",77],"(",")",",",["T_WHITESPACE"," ",77],["T_VARIABLE","$data",77],")",";",["T_WHITESPACE","\n        ",77],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Register process start\n     *\n     * @param Mage_Index_Model_Process $process\n     * @return Mage_Index_Model_Resource_Process\n     *\/",81],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","startProcess",87],"(",["T_STRING","Mage_Index_Model_Process",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$process",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$data",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_ARRAY","array",89],"(",["T_WHITESPACE","\n            ",89],["T_CONSTANT_ENCAPSED_STRING","'status'",90],["T_WHITESPACE","        ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_STRING","Mage_Index_Model_Process",90],["T_DOUBLE_COLON","::",90],["T_STRING","STATUS_RUNNING",90],",",["T_WHITESPACE","\n            ",90],["T_CONSTANT_ENCAPSED_STRING","'started_at'",91],["T_WHITESPACE","    ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","formatDate",91],"(",["T_STRING","time",91],"(",")",")",",",["T_WHITESPACE","\n        ",91],")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_updateProcessData",93],"(",["T_VARIABLE","$process",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getId",93],"(",")",",",["T_WHITESPACE"," ",93],["T_VARIABLE","$data",93],")",";",["T_WHITESPACE","\n        ",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Register process fail\n     *\n     * @param Mage_Index_Model_Process $process\n     * @return Mage_Index_Model_Resource_Process\n     *\/",97],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","failProcess",103],"(",["T_STRING","Mage_Index_Model_Process",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$process",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$data",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_ARRAY","array",105],"(",["T_WHITESPACE","\n            ",105],["T_CONSTANT_ENCAPSED_STRING","'status'",106],["T_WHITESPACE","   ",106],["T_DOUBLE_ARROW","=>",106],["T_WHITESPACE"," ",106],["T_STRING","Mage_Index_Model_Process",106],["T_DOUBLE_COLON","::",106],["T_STRING","STATUS_REQUIRE_REINDEX",106],",",["T_WHITESPACE","\n            ",106],["T_CONSTANT_ENCAPSED_STRING","'ended_at'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","formatDate",107],"(",["T_STRING","time",107],"(",")",")",",",["T_WHITESPACE","\n        ",107],")",";",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_updateProcessData",109],"(",["T_VARIABLE","$process",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getId",109],"(",")",",",["T_WHITESPACE"," ",109],["T_VARIABLE","$data",109],")",";",["T_WHITESPACE","\n        ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Update process status field\n     *\n     *\n     * @param Mage_Index_Model_Process $process\n     * @param string $status\n     * @return Mage_Index_Model_Resource_Process\n     *\/",113],["T_WHITESPACE","\n    ",120],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","updateStatus",121],"(",["T_VARIABLE","$process",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$status",121],")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$data",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_ARRAY","array",123],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$status",123],")",";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_updateProcessData",124],"(",["T_VARIABLE","$process",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getId",124],"(",")",",",["T_WHITESPACE"," ",124],["T_VARIABLE","$data",124],")",";",["T_WHITESPACE","\n        ",124],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Updates process data\n     * @param int $processId\n     * @param array $data\n     * @return Mage_Index_Model_Resource_Process\n     *\/",128],["T_WHITESPACE","\n    ",133],["T_PROTECTED","protected",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","_updateProcessData",134],"(",["T_VARIABLE","$processId",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$data",134],")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$bind",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_ARRAY","array",136],"(",["T_CONSTANT_ENCAPSED_STRING","'process_id=?'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$processId",136],")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_getWriteAdapter",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","update",137],"(",["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getMainTable",137],"(",")",",",["T_WHITESPACE"," ",137],["T_VARIABLE","$data",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$bind",137],")",";",["T_WHITESPACE","\n\n        ",137],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n\n    ",140],["T_DOC_COMMENT","\/**\n     * Update process start date\n     *\n     * @param Mage_Index_Model_Process $process\n     * @return Mage_Index_Model_Resource_Process\n     *\/",142],["T_WHITESPACE","\n    ",147],["T_PUBLIC","public",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","updateProcessStartDate",148],"(",["T_STRING","Mage_Index_Model_Process",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$process",148],")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_updateProcessData",150],"(",["T_VARIABLE","$process",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getId",150],"(",")",",",["T_WHITESPACE"," ",150],["T_ARRAY","array",150],"(",["T_CONSTANT_ENCAPSED_STRING","'started_at'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","formatDate",150],"(",["T_STRING","time",150],"(",")",")",")",")",";",["T_WHITESPACE","\n        ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Update process end date\n     *\n     * @param Mage_Index_Model_Process $process\n     * @return Mage_Index_Model_Resource_Process\n     *\/",154],["T_WHITESPACE","\n    ",159],["T_PUBLIC","public",160],["T_WHITESPACE"," ",160],["T_FUNCTION","function",160],["T_WHITESPACE"," ",160],["T_STRING","updateProcessEndDate",160],"(",["T_STRING","Mage_Index_Model_Process",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$process",160],")",["T_WHITESPACE","\n    ",160],"{",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_updateProcessData",162],"(",["T_VARIABLE","$process",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getId",162],"(",")",",",["T_WHITESPACE"," ",162],["T_ARRAY","array",162],"(",["T_CONSTANT_ENCAPSED_STRING","'ended_at'",162],["T_WHITESPACE"," ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","formatDate",162],"(",["T_STRING","time",162],"(",")",")",")",")",";",["T_WHITESPACE","\n        ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Whether transaction is already started\n     *\n     * @return bool\n     *\/",166],["T_WHITESPACE","\n    ",170],["T_PUBLIC","public",171],["T_WHITESPACE"," ",171],["T_FUNCTION","function",171],["T_WHITESPACE"," ",171],["T_STRING","isInTransaction",171],"(",")",["T_WHITESPACE","\n    ",171],"{",["T_WHITESPACE","\n        ",172],["T_RETURN","return",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_getWriteAdapter",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","getTransactionLevel",173],"(",")",["T_WHITESPACE"," ",173],">",["T_WHITESPACE"," ",173],["T_LNUMBER","0",173],";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n",174],"}",["T_WHITESPACE","\n",175]]