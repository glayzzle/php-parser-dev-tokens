[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sendfriend\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Email to a Friend Product Controller\n *\n * @category    Mage\n * @package     Mage_Sedfriend\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Sendfriend_ProductController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Controller_Front_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Predispatch: check is enable module\n     * If allow only for customer - redirect to login page\n     *\n     * @return Mage_Sendfriend_ProductController\n     *\/",36],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","preDispatch",42],"(",")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_STRING","parent",44],["T_DOUBLE_COLON","::",44],["T_STRING","preDispatch",44],"(",")",";",["T_WHITESPACE","\n\n        ",44],["T_COMMENT","\/* @var $helper Mage_Sendfriend_Helper_Data *\/",46],["T_WHITESPACE","\n        ",46],["T_VARIABLE","$helper",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","Mage",47],["T_DOUBLE_COLON","::",47],["T_STRING","helper",47],"(",["T_CONSTANT_ENCAPSED_STRING","'sendfriend'",47],")",";",["T_WHITESPACE","\n        ",47],["T_COMMENT","\/* @var $session Mage_Customer_Model_Session *\/",48],["T_WHITESPACE","\n        ",48],["T_VARIABLE","$session",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","Mage",49],["T_DOUBLE_COLON","::",49],["T_STRING","getSingleton",49],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",49],")",";",["T_WHITESPACE","\n\n        ",49],["T_IF","if",51],["T_WHITESPACE"," ",51],"(","!",["T_VARIABLE","$helper",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","isEnabled",51],"(",")",")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","norouteAction",52],"(",")",";",["T_WHITESPACE","\n            ",52],["T_RETURN","return",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$this",53],";",["T_WHITESPACE","\n        ",53],"}",["T_WHITESPACE","\n\n        ",54],["T_IF","if",56],["T_WHITESPACE"," ",56],"(","!",["T_VARIABLE","$helper",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","isAllowForGuest",56],"(",")",["T_WHITESPACE"," ",56],["T_BOOLEAN_AND","&&",56],["T_WHITESPACE"," ",56],"!",["T_VARIABLE","$session",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","authenticate",56],"(",["T_VARIABLE","$this",56],")",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","setFlag",57],"(",["T_CONSTANT_ENCAPSED_STRING","''",57],",",["T_WHITESPACE"," ",57],["T_STRING","self",57],["T_DOUBLE_COLON","::",57],["T_STRING","FLAG_NO_DISPATCH",57],",",["T_WHITESPACE"," ",57],["T_STRING","true",57],")",";",["T_WHITESPACE","\n            ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getRequest",58],"(",")",["T_OBJECT_OPERATOR","->",58],["T_STRING","getActionName",58],"(",")",["T_WHITESPACE"," ",58],["T_IS_EQUAL","==",58],["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'sendemail'",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n                ",58],["T_VARIABLE","$session",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","setBeforeAuthUrl",59],"(",["T_STRING","Mage",59],["T_DOUBLE_COLON","::",59],["T_STRING","getUrl",59],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/send'",59],",",["T_WHITESPACE"," ",59],["T_ARRAY","array",59],"(",["T_WHITESPACE","\n                    ",59],["T_CONSTANT_ENCAPSED_STRING","'_current'",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_STRING","true",60],["T_WHITESPACE","\n                ",60],")",")",")",";",["T_WHITESPACE","\n                ",61],["T_STRING","Mage",62],["T_DOUBLE_COLON","::",62],["T_STRING","getSingleton",62],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",62],")",["T_WHITESPACE","\n                    ",62],["T_OBJECT_OPERATOR","->",63],["T_STRING","setSendfriendFormData",63],"(",["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getRequest",63],"(",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","getPost",63],"(",")",")",";",["T_WHITESPACE","\n            ",63],"}",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE","\n\n        ",65],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],";",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Initialize Product Instance\n     *\n     * @return Mage_Catalog_Model_Product\n     *\/",70],["T_WHITESPACE","\n    ",74],["T_PROTECTED","protected",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","_initProduct",75],"(",")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$productId",77],["T_WHITESPACE","  ",77],"=",["T_WHITESPACE"," ",77],["T_INT_CAST","(int)",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getRequest",77],"(",")",["T_OBJECT_OPERATOR","->",77],["T_STRING","getParam",77],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",77],")",";",["T_WHITESPACE","\n        ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(","!",["T_VARIABLE","$productId",78],")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_STRING","false",79],";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$product",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","Mage",81],["T_DOUBLE_COLON","::",81],["T_STRING","getModel",81],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",81],")",["T_WHITESPACE","\n            ",81],["T_OBJECT_OPERATOR","->",82],["T_STRING","load",82],"(",["T_VARIABLE","$productId",82],")",";",["T_WHITESPACE","\n        ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(","!",["T_VARIABLE","$product",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getId",83],"(",")",["T_WHITESPACE"," ",83],["T_BOOLEAN_OR","||",83],["T_WHITESPACE"," ",83],"!",["T_VARIABLE","$product",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","isVisibleInCatalog",83],"(",")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_RETURN","return",84],["T_WHITESPACE"," ",84],["T_STRING","false",84],";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n\n        ",85],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","register",87],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$product",87],")",";",["T_WHITESPACE","\n        ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$product",88],";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Initialize send friend model\n     *\n     * @return Mage_Sendfriend_Model_Sendfriend\n     *\/",91],["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","_initSendToFriendModel",96],"(",")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$model",98],["T_WHITESPACE","  ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","Mage",98],["T_DOUBLE_COLON","::",98],["T_STRING","getModel",98],"(",["T_CONSTANT_ENCAPSED_STRING","'sendfriend\/sendfriend'",98],")",";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$model",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","setRemoteAddr",99],"(",["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","helper",99],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/http'",99],")",["T_OBJECT_OPERATOR","->",99],["T_STRING","getRemoteAddr",99],"(",["T_STRING","true",99],")",")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$model",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","setCookie",100],"(",["T_STRING","Mage",100],["T_DOUBLE_COLON","::",100],["T_STRING","app",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getCookie",100],"(",")",")",";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$model",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","setWebsiteId",101],"(",["T_STRING","Mage",101],["T_DOUBLE_COLON","::",101],["T_STRING","app",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","getStore",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","getWebsiteId",101],"(",")",")",";",["T_WHITESPACE","\n\n        ",101],["T_STRING","Mage",103],["T_DOUBLE_COLON","::",103],["T_STRING","register",103],"(",["T_CONSTANT_ENCAPSED_STRING","'send_to_friend_model'",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$model",103],")",";",["T_WHITESPACE","\n\n        ",103],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$model",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Show Send to a Friend Form\n     *\n     *\/",108],["T_WHITESPACE","\n    ",111],["T_PUBLIC","public",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","sendAction",112],"(",")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$product",114],["T_WHITESPACE","    ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_initProduct",114],"(",")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$model",115],["T_WHITESPACE","      ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_initSendToFriendModel",115],"(",")",";",["T_WHITESPACE","\n\n        ",115],["T_IF","if",117],["T_WHITESPACE"," ",117],"(","!",["T_VARIABLE","$product",117],")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_forward",118],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",118],")",";",["T_WHITESPACE","\n            ",118],["T_RETURN","return",119],";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_IF","if",122],["T_WHITESPACE"," ",122],"(",["T_VARIABLE","$model",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getMaxSendsToFriend",122],"(",")",["T_WHITESPACE"," ",122],["T_BOOLEAN_AND","&&",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$model",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","isExceedLimit",122],"(",")",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_STRING","Mage",123],["T_DOUBLE_COLON","::",123],["T_STRING","getSingleton",123],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",123],")",["T_OBJECT_OPERATOR","->",123],["T_STRING","addNotice",123],"(",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","__",124],"(",["T_CONSTANT_ENCAPSED_STRING","'The messages cannot be sent more than %d times in an hour'",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$model",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getMaxSendsToFriend",124],"(",")",")",["T_WHITESPACE","\n            ",124],")",";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","loadLayout",128],"(",")",";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_initLayoutMessages",129],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",129],")",";",["T_WHITESPACE","\n\n        ",129],["T_STRING","Mage",131],["T_DOUBLE_COLON","::",131],["T_STRING","dispatchEvent",131],"(",["T_CONSTANT_ENCAPSED_STRING","'sendfriend_product'",131],",",["T_WHITESPACE"," ",131],["T_ARRAY","array",131],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$product",131],")",")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$data",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","Mage",132],["T_DOUBLE_COLON","::",132],["T_STRING","getSingleton",132],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",132],")",["T_OBJECT_OPERATOR","->",132],["T_STRING","getSendfriendFormData",132],"(",")",";",["T_WHITESPACE","\n        ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$data",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_STRING","Mage",134],["T_DOUBLE_COLON","::",134],["T_STRING","getSingleton",134],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",134],")",["T_OBJECT_OPERATOR","->",134],["T_STRING","setSendfriendFormData",134],"(",["T_STRING","true",134],")",";",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$block",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getLayout",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getBlock",135],"(",["T_CONSTANT_ENCAPSED_STRING","'sendfriend.send'",135],")",";",["T_WHITESPACE","\n            ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$block",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$block",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","setFormData",137],"(",["T_VARIABLE","$data",137],")",";",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n\n        ",139],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","renderLayout",141],"(",")",";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Send Email Post Action\n     *\n     *\/",144],["T_WHITESPACE","\n    ",147],["T_PUBLIC","public",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","sendmailAction",148],"(",")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(","!",["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_validateFormKey",150],"(",")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_redirect",151],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/send'",151],",",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_STRING","true",151],")",")",";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE","\n\n        ",152],["T_VARIABLE","$product",154],["T_WHITESPACE","    ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_initProduct",154],"(",")",";",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$model",155],["T_WHITESPACE","      ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_initSendToFriendModel",155],"(",")",";",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$data",156],["T_WHITESPACE","       ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getRequest",156],"(",")",["T_OBJECT_OPERATOR","->",156],["T_STRING","getPost",156],"(",")",";",["T_WHITESPACE","\n\n        ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(","!",["T_VARIABLE","$product",158],["T_WHITESPACE"," ",158],["T_BOOLEAN_OR","||",158],["T_WHITESPACE"," ",158],"!",["T_VARIABLE","$data",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_forward",159],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",159],")",";",["T_WHITESPACE","\n            ",159],["T_RETURN","return",160],";",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n\n        ",161],["T_VARIABLE","$categoryId",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getRequest",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","getParam",163],"(",["T_CONSTANT_ENCAPSED_STRING","'cat_id'",163],",",["T_WHITESPACE"," ",163],["T_STRING","null",163],")",";",["T_WHITESPACE","\n        ",163],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$categoryId",164],")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$category",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_STRING","Mage",165],["T_DOUBLE_COLON","::",165],["T_STRING","getModel",165],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category'",165],")",["T_WHITESPACE","\n                ",165],["T_OBJECT_OPERATOR","->",166],["T_STRING","load",166],"(",["T_VARIABLE","$categoryId",166],")",";",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$product",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","setCategory",167],"(",["T_VARIABLE","$category",167],")",";",["T_WHITESPACE","\n            ",167],["T_STRING","Mage",168],["T_DOUBLE_COLON","::",168],["T_STRING","register",168],"(",["T_CONSTANT_ENCAPSED_STRING","'current_category'",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$category",168],")",";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$model",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setSender",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getRequest",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","getPost",171],"(",["T_CONSTANT_ENCAPSED_STRING","'sender'",171],")",")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$model",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","setRecipients",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getRequest",172],"(",")",["T_OBJECT_OPERATOR","->",172],["T_STRING","getPost",172],"(",["T_CONSTANT_ENCAPSED_STRING","'recipients'",172],")",")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$model",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","setProduct",173],"(",["T_VARIABLE","$product",173],")",";",["T_WHITESPACE","\n\n        ",173],["T_TRY","try",175],["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$validate",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$model",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","validate",176],"(",")",";",["T_WHITESPACE","\n            ",176],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_VARIABLE","$validate",177],["T_WHITESPACE"," ",177],["T_IS_IDENTICAL","===",177],["T_WHITESPACE"," ",177],["T_STRING","true",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$model",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","send",178],"(",")",";",["T_WHITESPACE","\n                ",178],["T_STRING","Mage",179],["T_DOUBLE_COLON","::",179],["T_STRING","getSingleton",179],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",179],")",["T_OBJECT_OPERATOR","->",179],["T_STRING","addSuccess",179],"(",["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","__",179],"(",["T_CONSTANT_ENCAPSED_STRING","'The link to a friend was sent.'",179],")",")",";",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_redirectSuccess",180],"(",["T_VARIABLE","$product",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getProductUrl",180],"(",")",")",";",["T_WHITESPACE","\n                ",180],["T_RETURN","return",181],";",["T_WHITESPACE","\n            ",181],"}",["T_WHITESPACE","\n            ",182],["T_ELSE","else",183],["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n                ",183],["T_IF","if",184],["T_WHITESPACE"," ",184],"(",["T_STRING","is_array",184],"(",["T_VARIABLE","$validate",184],")",")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n                    ",184],["T_FOREACH","foreach",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$validate",185],["T_WHITESPACE"," ",185],["T_AS","as",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$errorMessage",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                        ",185],["T_STRING","Mage",186],["T_DOUBLE_COLON","::",186],["T_STRING","getSingleton",186],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",186],")",["T_OBJECT_OPERATOR","->",186],["T_STRING","addError",186],"(",["T_VARIABLE","$errorMessage",186],")",";",["T_WHITESPACE","\n                    ",186],"}",["T_WHITESPACE","\n                ",187],"}",["T_WHITESPACE","\n                ",188],["T_ELSE","else",189],["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n                    ",189],["T_STRING","Mage",190],["T_DOUBLE_COLON","::",190],["T_STRING","getSingleton",190],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",190],")",["T_OBJECT_OPERATOR","->",190],["T_STRING","addError",190],"(",["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","__",190],"(",["T_CONSTANT_ENCAPSED_STRING","'There were some problems with the data.'",190],")",")",";",["T_WHITESPACE","\n                ",190],"}",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n        ",193],["T_CATCH","catch",194],["T_WHITESPACE"," ",194],"(",["T_STRING","Mage_Core_Exception",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$e",194],")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_STRING","Mage",195],["T_DOUBLE_COLON","::",195],["T_STRING","getSingleton",195],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",195],")",["T_OBJECT_OPERATOR","->",195],["T_STRING","addError",195],"(",["T_VARIABLE","$e",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getMessage",195],"(",")",")",";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n        ",196],["T_CATCH","catch",197],["T_WHITESPACE"," ",197],"(",["T_STRING","Exception",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$e",197],")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n            ",197],["T_STRING","Mage",198],["T_DOUBLE_COLON","::",198],["T_STRING","getSingleton",198],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",198],")",["T_WHITESPACE","\n                ",198],["T_OBJECT_OPERATOR","->",199],["T_STRING","addException",199],"(",["T_VARIABLE","$e",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","__",199],"(",["T_CONSTANT_ENCAPSED_STRING","'Some emails were not sent.'",199],")",")",";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n\n        ",200],["T_COMMENT","\/\/ save form data\n",202],["T_WHITESPACE","        ",203],["T_STRING","Mage",203],["T_DOUBLE_COLON","::",203],["T_STRING","getSingleton",203],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",203],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","setSendfriendFormData",203],"(",["T_VARIABLE","$data",203],")",";",["T_WHITESPACE","\n\n        ",203],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_redirectError",205],"(",["T_STRING","Mage",205],["T_DOUBLE_COLON","::",205],["T_STRING","getURL",205],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/send'",205],",",["T_WHITESPACE"," ",205],["T_ARRAY","array",205],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",205],["T_WHITESPACE"," ",205],["T_DOUBLE_ARROW","=>",205],["T_WHITESPACE"," ",205],["T_STRING","true",205],")",")",")",";",["T_WHITESPACE","\n    ",205],"}",["T_WHITESPACE","\n",206],"}",["T_WHITESPACE","\n",207]]