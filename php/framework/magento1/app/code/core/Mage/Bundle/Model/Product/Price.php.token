[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Bundle Price Model\n *\n * @category Mage\n * @package  Mage_Bundle\n * @author   Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Bundle_Model_Product_Price",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Type_Price",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Fixed price type\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","PRICE_TYPE_FIXED",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_LNUMBER","1",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Dynamic price type\n     *\/",41],["T_WHITESPACE","\n    ",43],["T_CONST","const",44],["T_WHITESPACE"," ",44],["T_STRING","PRICE_TYPE_DYNAMIC",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_LNUMBER","0",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Flag which indicates - is min\/max prices have been calculated by index\n     *\n     * @var bool\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_isPricesCalculatedByIndex",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Is min\/max prices have been calculated by index\n     *\n     * @return bool\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","getIsPricesCalculatedByIndex",58],"(",")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_RETURN","return",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_isPricesCalculatedByIndex",60],";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Return product base price\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return string\n     *\/",63],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","getPrice",69],"(",["T_VARIABLE","$product",69],")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(",["T_VARIABLE","$product",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getPriceType",71],"(",")",["T_WHITESPACE"," ",71],["T_IS_EQUAL","==",71],["T_WHITESPACE"," ",71],["T_STRING","self",71],["T_DOUBLE_COLON","::",71],["T_STRING","PRICE_TYPE_FIXED",71],")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$product",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getData",72],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",72],")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE"," ",73],["T_ELSE","else",73],["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_LNUMBER","0",74],";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n    ",75],"}",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Get Total price  for Bundle items\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param null|float $qty\n     * @return float\n     *\/",78],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","getTotalBundleItemsPrice",85],"(",["T_VARIABLE","$product",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$qty",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","null",85],")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$price",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_DNUMBER","0.0",87],";",["T_WHITESPACE","\n        ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$product",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","hasCustomOptions",88],"(",")",")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$customOption",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$product",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getCustomOption",89],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_ids'",89],")",";",["T_WHITESPACE","\n            ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$customOption",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$selectionIds",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_STRING","unserialize",91],"(",["T_VARIABLE","$customOption",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getValue",91],"(",")",")",";",["T_WHITESPACE","\n                ",91],["T_VARIABLE","$selections",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$product",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTypeInstance",92],"(",["T_STRING","true",92],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","getSelectionsByIds",92],"(",["T_VARIABLE","$selectionIds",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$product",92],")",";",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$selections",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","addTierPriceData",93],"(",")",";",["T_WHITESPACE","\n                ",93],["T_STRING","Mage",94],["T_DOUBLE_COLON","::",94],["T_STRING","dispatchEvent",94],"(",["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_collection_prices'",94],",",["T_WHITESPACE"," ",94],["T_ARRAY","array",94],"(",["T_WHITESPACE","\n                    ",94],["T_CONSTANT_ENCAPSED_STRING","'collection'",95],["T_WHITESPACE"," ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$selections",95],",",["T_WHITESPACE","\n                    ",95],["T_CONSTANT_ENCAPSED_STRING","'store_id'",96],["T_WHITESPACE"," ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$product",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getStoreId",96],"(",")",",",["T_WHITESPACE","\n                ",96],")",")",";",["T_WHITESPACE","\n                ",97],["T_FOREACH","foreach",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$selections",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getItems",98],"(",")",["T_WHITESPACE"," ",98],["T_AS","as",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$selection",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                    ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$selection",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","isSalable",99],"(",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n                        ",99],["T_VARIABLE","$selectionQty",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$product",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getCustomOption",100],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_qty_'",100],["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_VARIABLE","$selection",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getSelectionId",100],"(",")",")",";",["T_WHITESPACE","\n                        ",100],["T_IF","if",101],["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$selectionQty",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n                            ",101],["T_VARIABLE","$price",102],["T_WHITESPACE"," ",102],["T_PLUS_EQUAL","+=",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getSelectionFinalTotalPrice",102],"(",["T_VARIABLE","$product",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$selection",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$qty",102],",",["T_WHITESPACE","\n                                ",102],["T_VARIABLE","$selectionQty",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getValue",103],"(",")",")",";",["T_WHITESPACE","\n                        ",103],"}",["T_WHITESPACE","\n                    ",104],"}",["T_WHITESPACE","\n                ",105],"}",["T_WHITESPACE","\n            ",106],"}",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n        ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$price",109],";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Get product final price\n     *\n     * @param   double $qty\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  double\n     *\/",112],["T_WHITESPACE","\n    ",118],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","getFinalPrice",119],"(",["T_VARIABLE","$qty",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","null",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$product",119],")",["T_WHITESPACE","\n    ",119],"{",["T_WHITESPACE","\n        ",120],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_STRING","is_null",121],"(",["T_VARIABLE","$qty",121],")",["T_WHITESPACE"," ",121],["T_BOOLEAN_AND","&&",121],["T_WHITESPACE"," ",121],"!",["T_STRING","is_null",121],"(",["T_VARIABLE","$product",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getCalculatedFinalPrice",121],"(",")",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$product",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getCalculatedFinalPrice",122],"(",")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE","\n\n        ",123],["T_VARIABLE","$finalPrice",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getBasePrice",125],"(",["T_VARIABLE","$product",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$qty",125],")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$product",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","setFinalPrice",126],"(",["T_VARIABLE","$finalPrice",126],")",";",["T_WHITESPACE","\n        ",126],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","dispatchEvent",127],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_get_final_price'",127],",",["T_WHITESPACE"," ",127],["T_ARRAY","array",127],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$product",127],",",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'qty'",127],["T_WHITESPACE"," ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$qty",127],")",")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$finalPrice",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$product",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getData",128],"(",["T_CONSTANT_ENCAPSED_STRING","'final_price'",128],")",";",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$finalPrice",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_applyOptionsPrice",130],"(",["T_VARIABLE","$product",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$qty",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$finalPrice",130],")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$finalPrice",131],["T_WHITESPACE"," ",131],["T_PLUS_EQUAL","+=",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getTotalBundleItemsPrice",131],"(",["T_VARIABLE","$product",131],",",["T_WHITESPACE"," ",131],["T_VARIABLE","$qty",131],")",";",["T_WHITESPACE","\n\n        ",131],["T_VARIABLE","$product",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","setFinalPrice",133],"(",["T_VARIABLE","$finalPrice",133],")",";",["T_WHITESPACE","\n        ",133],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_STRING","max",134],"(",["T_LNUMBER","0",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$product",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getData",134],"(",["T_CONSTANT_ENCAPSED_STRING","'final_price'",134],")",")",";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Returns final price of a child product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param float $productQty\n     * @param Mage_Catalog_Model_Product $childProduct\n     * @param float $childProductQty\n     * @return decimal\n     *\/",137],["T_WHITESPACE","\n    ",145],["T_PUBLIC","public",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","getChildFinalPrice",146],"(",["T_VARIABLE","$product",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$productQty",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$childProduct",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$childProductQty",146],")",["T_WHITESPACE","\n    ",146],"{",["T_WHITESPACE","\n        ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getSelectionFinalTotalPrice",148],"(",["T_VARIABLE","$product",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$childProduct",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$productQty",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$childProductQty",148],",",["T_WHITESPACE"," ",148],["T_STRING","false",148],")",";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Retrieve Price\n     *\n     * @deprecated after 1.5.1.0\n     * @see Mage_Bundle_Model_Product_Price::getTotalPrices()\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @param  string $which\n     * @return decimal|array\n     *\/",151],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","getPrices",161],"(",["T_VARIABLE","$product",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$which",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","null",161],")",["T_WHITESPACE","\n    ",161],"{",["T_WHITESPACE","\n        ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getTotalPrices",163],"(",["T_VARIABLE","$product",163],",",["T_WHITESPACE"," ",163],["T_VARIABLE","$which",163],")",";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Retrieve Prices depending on tax\n     *\n     * @deprecated after 1.5.1.0\n     * @see Mage_Bundle_Model_Product_Price::getTotalPrices()\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @param  string $which\n     * @param  bool|null $includeTax\n     * @return decimal|array\n     *\/",166],["T_WHITESPACE","\n    ",176],["T_PUBLIC","public",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","getPricesDependingOnTax",177],"(",["T_VARIABLE","$product",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$which",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","null",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$includeTax",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","null",177],")",["T_WHITESPACE","\n    ",177],"{",["T_WHITESPACE","\n        ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getTotalPrices",179],"(",["T_VARIABLE","$product",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$which",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$includeTax",179],")",";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n\n    ",180],["T_DOC_COMMENT","\/**\n     * Retrieve Price considering tier price\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @param  string|null $which\n     * @param  bool|null $includeTax\n     * @param  bool $takeTierPrice\n     * @return decimal|array\n     *\/",182],["T_WHITESPACE","\n    ",190],["T_PUBLIC","public",191],["T_WHITESPACE"," ",191],["T_FUNCTION","function",191],["T_WHITESPACE"," ",191],["T_STRING","getTotalPrices",191],"(",["T_VARIABLE","$product",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$which",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","null",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$includeTax",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","null",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$takeTierPrice",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","true",191],")",["T_WHITESPACE","\n    ",191],"{",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_isPricesCalculatedByIndex",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$product",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getData",193],"(",["T_CONSTANT_ENCAPSED_STRING","'min_price'",193],")",["T_WHITESPACE"," ",193],["T_BOOLEAN_AND","&&",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$product",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getData",193],"(",["T_CONSTANT_ENCAPSED_STRING","'max_price'",193],")",")",";",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$taxHelper",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_getHelperData",194],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",194],")",";",["T_WHITESPACE","\n\n        ",194],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_isPricesCalculatedByIndex",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$minimalPrice",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$taxHelper",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getPrice",197],"(",["T_VARIABLE","$product",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$product",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getData",197],"(",["T_CONSTANT_ENCAPSED_STRING","'min_price'",197],")",",",["T_WHITESPACE"," ",197],["T_VARIABLE","$includeTax",197],",",["T_WHITESPACE","\n                ",197],["T_STRING","null",198],",",["T_WHITESPACE"," ",198],["T_STRING","null",198],",",["T_WHITESPACE"," ",198],["T_STRING","null",198],",",["T_WHITESPACE"," ",198],["T_STRING","null",198],",",["T_WHITESPACE"," ",198],["T_STRING","null",198],",",["T_WHITESPACE"," ",198],["T_STRING","false",198],")",";",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$maximalPrice",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$taxHelper",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getPrice",199],"(",["T_VARIABLE","$product",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$product",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getData",199],"(",["T_CONSTANT_ENCAPSED_STRING","'max_price'",199],")",",",["T_WHITESPACE"," ",199],["T_VARIABLE","$includeTax",199],",",["T_WHITESPACE","\n                ",199],["T_STRING","null",200],",",["T_WHITESPACE"," ",200],["T_STRING","null",200],",",["T_WHITESPACE"," ",200],["T_STRING","null",200],",",["T_WHITESPACE"," ",200],["T_STRING","null",200],",",["T_WHITESPACE"," ",200],["T_STRING","null",200],",",["T_WHITESPACE"," ",200],["T_STRING","false",200],")",";",["T_WHITESPACE","\n        ",200],"}",["T_WHITESPACE"," ",201],["T_ELSE","else",201],["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$isPriceFixedType",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],"(",["T_VARIABLE","$product",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getPriceType",202],"(",")",["T_WHITESPACE"," ",202],["T_IS_EQUAL","==",202],["T_WHITESPACE"," ",202],["T_STRING","self",202],["T_DOUBLE_COLON","::",202],["T_STRING","PRICE_TYPE_FIXED",202],")",";",["T_WHITESPACE","\n            ",202],["T_DOC_COMMENT","\/**\n             * Check if product price is fixed\n             *\/",203],["T_WHITESPACE","\n            ",205],["T_VARIABLE","$finalPrice",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$product",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getFinalPrice",206],"(",")",";",["T_WHITESPACE","\n            ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$isPriceFixedType",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$minimalPrice",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_VARIABLE","$maximalPrice",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_VARIABLE","$taxHelper",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getPrice",208],"(",["T_VARIABLE","$product",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$finalPrice",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$includeTax",208],",",["T_WHITESPACE","\n                    ",208],["T_STRING","null",209],",",["T_WHITESPACE"," ",209],["T_STRING","null",209],",",["T_WHITESPACE"," ",209],["T_STRING","null",209],",",["T_WHITESPACE"," ",209],["T_STRING","null",209],",",["T_WHITESPACE"," ",209],["T_STRING","null",209],",",["T_WHITESPACE"," ",209],["T_STRING","false",209],")",";",["T_WHITESPACE","\n            ",209],"}",["T_WHITESPACE"," ",210],["T_ELSE","else",210],["T_WHITESPACE"," ",210],"{",["T_WHITESPACE"," ",210],["T_COMMENT","\/\/ PRICE_TYPE_DYNAMIC\n",210],["T_WHITESPACE","                ",211],["T_VARIABLE","$minimalPrice",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$maximalPrice",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_LNUMBER","0",211],";",["T_WHITESPACE","\n            ",211],"}",["T_WHITESPACE","\n\n            ",212],["T_VARIABLE","$minimalPrice",214],["T_WHITESPACE"," ",214],["T_PLUS_EQUAL","+=",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_getMinimalBundleOptionsPrice",214],"(",["T_VARIABLE","$product",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$includeTax",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$takeTierPrice",214],")",";",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$maximalPrice",215],["T_WHITESPACE"," ",215],["T_PLUS_EQUAL","+=",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_getMaximalBundleOptionsPrice",215],"(",["T_VARIABLE","$product",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$includeTax",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$takeTierPrice",215],")",";",["T_WHITESPACE","\n\n            ",215],["T_VARIABLE","$customOptions",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$product",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getOptions",217],"(",")",";",["T_WHITESPACE","\n            ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$isPriceFixedType",218],["T_WHITESPACE"," ",218],["T_BOOLEAN_AND","&&",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$customOptions",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n                ",218],["T_FOREACH","foreach",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$customOptions",219],["T_WHITESPACE"," ",219],["T_AS","as",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$customOption",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n                    ",219],["T_COMMENT","\/* @var $customOption Mage_Catalog_Model_Product_Option *\/",220],["T_WHITESPACE","\n                    ",220],["T_VARIABLE","$minimalPrice",221],["T_WHITESPACE"," ",221],["T_PLUS_EQUAL","+=",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$taxHelper",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getPrice",221],"(",["T_WHITESPACE","\n                        ",221],["T_VARIABLE","$product",222],",",["T_WHITESPACE","\n                        ",222],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_getMinimalCustomOptionPrice",223],"(",["T_VARIABLE","$customOption",223],")",",",["T_WHITESPACE","\n                        ",223],["T_VARIABLE","$includeTax",224],")",";",["T_WHITESPACE","\n                    ",224],["T_VARIABLE","$maximalPrice",225],["T_WHITESPACE"," ",225],["T_PLUS_EQUAL","+=",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$taxHelper",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getPrice",225],"(",["T_WHITESPACE","\n                        ",225],["T_VARIABLE","$product",226],",",["T_WHITESPACE","\n                        ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_getMaximalCustomOptionPrice",227],"(",["T_VARIABLE","$customOption",227],")",",",["T_WHITESPACE","\n                        ",227],["T_VARIABLE","$includeTax",228],")",";",["T_WHITESPACE","\n                ",228],"}",["T_WHITESPACE","\n            ",229],"}",["T_WHITESPACE","\n        ",230],"}",["T_WHITESPACE","\n\n        ",231],["T_VARIABLE","$minimalPrice",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$product",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getStore",233],"(",")",["T_OBJECT_OPERATOR","->",233],["T_STRING","roundPrice",233],"(",["T_VARIABLE","$minimalPrice",233],")",";",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$maximalPrice",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$product",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getStore",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","roundPrice",234],"(",["T_VARIABLE","$maximalPrice",234],")",";",["T_WHITESPACE","\n\n        ",234],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_CONSTANT_ENCAPSED_STRING","'max'",236],["T_WHITESPACE"," ",236],["T_IS_EQUAL","==",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$which",236],")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$maximalPrice",237],";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE"," ",238],["T_ELSEIF","elseif",238],["T_WHITESPACE"," ",238],"(",["T_CONSTANT_ENCAPSED_STRING","'min'",238],["T_WHITESPACE"," ",238],["T_IS_EQUAL","==",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$which",238],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_RETURN","return",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$minimalPrice",239],";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n\n        ",240],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_ARRAY","array",242],"(",["T_VARIABLE","$minimalPrice",242],",",["T_WHITESPACE"," ",242],["T_VARIABLE","$maximalPrice",242],")",";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * Get minimal possible price for bundle option\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param bool|null $includeTax\n     * @param bool $takeTierPrice\n     * @return int|mixed\n     *\/",245],["T_WHITESPACE","\n    ",252],["T_PROTECTED","protected",253],["T_WHITESPACE"," ",253],["T_FUNCTION","function",253],["T_WHITESPACE"," ",253],["T_STRING","_getMinimalBundleOptionsPrice",253],"(",["T_VARIABLE","$product",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$includeTax",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$takeTierPrice",253],")",["T_WHITESPACE","\n    ",253],"{",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$options",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getOptions",255],"(",["T_VARIABLE","$product",255],")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$minimalPrice",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_LNUMBER","0",256],";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$minimalPriceWithTax",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_LNUMBER","0",257],";",["T_WHITESPACE","\n        ",257],["T_VARIABLE","$hasRequiredOptions",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","_hasRequiredOptions",258],"(",["T_VARIABLE","$product",258],")",";",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$selectionMinimalPrices",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_ARRAY","array",259],"(",")",";",["T_WHITESPACE","\n        ",259],["T_VARIABLE","$selectionMinimalPricesWithTax",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_ARRAY","array",260],"(",")",";",["T_WHITESPACE","\n\n        ",260],["T_IF","if",262],["T_WHITESPACE"," ",262],"(","!",["T_VARIABLE","$options",262],")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n            ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$minimalPrice",263],";",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n\n        ",264],["T_FOREACH","foreach",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$options",266],["T_WHITESPACE"," ",266],["T_AS","as",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$option",266],")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_COMMENT","\/* @var $option Mage_Bundle_Model_Option *\/",267],["T_WHITESPACE","\n            ",267],["T_VARIABLE","$selectionPrices",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_getSelectionPrices",268],"(",["T_VARIABLE","$product",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$option",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$takeTierPrice",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$includeTax",268],")",";",["T_WHITESPACE","\n            ",268],["T_VARIABLE","$selectionPricesWithTax",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_getSelectionPrices",269],"(",["T_VARIABLE","$product",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$option",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$takeTierPrice",269],",",["T_WHITESPACE"," ",269],["T_STRING","true",269],")",";",["T_WHITESPACE","\n\n            ",269],["T_IF","if",271],["T_WHITESPACE"," ",271],"(",["T_STRING","count",271],"(",["T_VARIABLE","$selectionPrices",271],")",")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n                ",271],["T_VARIABLE","$selectionMinPrice",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_STRING","is_array",272],"(",["T_VARIABLE","$selectionPrices",272],")",["T_WHITESPACE"," ",272],"?",["T_WHITESPACE"," ",272],["T_STRING","min",272],"(",["T_VARIABLE","$selectionPrices",272],")",["T_WHITESPACE"," ",272],":",["T_WHITESPACE"," ",272],["T_VARIABLE","$selectionPrices",272],";",["T_WHITESPACE","\n                ",272],["T_VARIABLE","$selectMinPriceWithTax",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","is_array",273],"(",["T_VARIABLE","$selectionPricesWithTax",273],")",["T_WHITESPACE"," ",273],"?",["T_WHITESPACE","\n                    ",273],["T_STRING","min",274],"(",["T_VARIABLE","$selectionPricesWithTax",274],")",["T_WHITESPACE"," ",274],":",["T_WHITESPACE"," ",274],["T_VARIABLE","$selectionPricesWithTax",274],";",["T_WHITESPACE","\n                ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$option",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getRequired",275],"(",")",")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n                    ",275],["T_VARIABLE","$minimalPrice",276],["T_WHITESPACE"," ",276],["T_PLUS_EQUAL","+=",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$selectionMinPrice",276],";",["T_WHITESPACE","\n                    ",276],["T_VARIABLE","$minimalPriceWithTax",277],["T_WHITESPACE"," ",277],["T_PLUS_EQUAL","+=",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$selectMinPriceWithTax",277],";",["T_WHITESPACE","\n                ",277],"}",["T_WHITESPACE"," ",278],["T_ELSEIF","elseif",278],["T_WHITESPACE"," ",278],"(","!",["T_VARIABLE","$hasRequiredOptions",278],")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n                    ",278],["T_VARIABLE","$selectionMinimalPrices",279],"[","]",["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$selectionMinPrice",279],";",["T_WHITESPACE","\n                    ",279],["T_VARIABLE","$selectionMinimalPricesWithTax",280],"[","]",["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$selectMinPriceWithTax",280],";",["T_WHITESPACE","\n                ",280],"}",["T_WHITESPACE","\n            ",281],"}",["T_WHITESPACE","\n        ",282],"}",["T_WHITESPACE","\n        ",283],["T_COMMENT","\/\/ condition is TRUE when all product options are NOT required\n",284],["T_WHITESPACE","        ",285],["T_IF","if",285],["T_WHITESPACE"," ",285],"(","!",["T_VARIABLE","$hasRequiredOptions",285],")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n            ",285],["T_VARIABLE","$minimalPrice",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_STRING","min",286],"(",["T_VARIABLE","$selectionMinimalPrices",286],")",";",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$minimalPriceWithTax",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_STRING","min",287],"(",["T_VARIABLE","$selectionMinimalPricesWithTax",287],")",";",["T_WHITESPACE","\n        ",287],"}",["T_WHITESPACE","\n\n        ",288],["T_VARIABLE","$taxConfig",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_getHelperData",290],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",290],")",["T_OBJECT_OPERATOR","->",290],["T_STRING","getConfig",290],"(",")",";",["T_WHITESPACE","\n\n        ",290],["T_COMMENT","\/\/In the case of total base calculation we round the tax first and\n",292],["T_WHITESPACE","        ",293],["T_COMMENT","\/\/deduct the tax from the price including tax\n",293],["T_WHITESPACE","        ",294],["T_IF","if",294],["T_WHITESPACE"," ",294],"(",["T_VARIABLE","$taxConfig",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","priceIncludesTax",294],"(",["T_VARIABLE","$product",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getStore",294],"(",")",")",["T_WHITESPACE","\n            ",294],["T_BOOLEAN_AND","&&",295],["T_WHITESPACE"," ",295],["T_STRING","Mage_Tax_Model_Calculation",295],["T_DOUBLE_COLON","::",295],["T_STRING","CALC_TOTAL_BASE",295],["T_WHITESPACE"," ",295],["T_IS_EQUAL","==",295],["T_WHITESPACE","\n            ",295],["T_VARIABLE","$taxConfig",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getAlgorithm",296],"(",["T_VARIABLE","$product",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getStore",296],"(",")",")",["T_WHITESPACE","\n            ",296],["T_BOOLEAN_AND","&&",297],["T_WHITESPACE"," ",297],"(",["T_VARIABLE","$minimalPriceWithTax",297],["T_WHITESPACE"," ",297],">",["T_WHITESPACE"," ",297],["T_VARIABLE","$minimalPrice",297],")",["T_WHITESPACE","\n        ",297],")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n            ",298],["T_COMMENT","\/\/We convert the value to string to maintain the precision\n",299],["T_WHITESPACE","            ",300],["T_VARIABLE","$tax",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_STRING_CAST","(String)",300],"(",["T_VARIABLE","$minimalPriceWithTax",300],["T_WHITESPACE"," ",300],"-",["T_WHITESPACE"," ",300],["T_VARIABLE","$minimalPrice",300],")",";",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$roundedTax",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_getApp",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","getStore",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","roundPrice",301],"(",["T_VARIABLE","$tax",301],")",";",["T_WHITESPACE","\n            ",301],["T_VARIABLE","$minimalPrice",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$minimalPriceWithTax",302],["T_WHITESPACE"," ",302],"-",["T_WHITESPACE"," ",302],["T_VARIABLE","$roundedTax",302],";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE","\n        ",303],["T_RETURN","return",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$minimalPrice",304],";",["T_WHITESPACE","\n    ",304],"}",["T_WHITESPACE","\n\n    ",305],["T_DOC_COMMENT","\/**\n     * Get maximal possible price for bundle option\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param bool|null $includeTax\n     * @param bool $takeTierPrice\n     * @return float\n     *\/",307],["T_WHITESPACE","\n    ",314],["T_PROTECTED","protected",315],["T_WHITESPACE"," ",315],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","_getMaximalBundleOptionsPrice",315],"(",["T_VARIABLE","$product",315],",",["T_WHITESPACE"," ",315],["T_VARIABLE","$includeTax",315],",",["T_WHITESPACE"," ",315],["T_VARIABLE","$takeTierPrice",315],")",["T_WHITESPACE","\n    ",315],"{",["T_WHITESPACE","\n        ",316],["T_VARIABLE","$maximalPrice",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_LNUMBER","0",317],";",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$options",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getOptions",318],"(",["T_VARIABLE","$product",318],")",";",["T_WHITESPACE","\n\n        ",318],["T_IF","if",320],["T_WHITESPACE"," ",320],"(","!",["T_VARIABLE","$options",320],")",["T_WHITESPACE"," ",320],"{",["T_WHITESPACE","\n            ",320],["T_RETURN","return",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$maximalPrice",321],";",["T_WHITESPACE","\n        ",321],"}",["T_WHITESPACE","\n\n        ",322],["T_FOREACH","foreach",324],["T_WHITESPACE"," ",324],"(",["T_VARIABLE","$options",324],["T_WHITESPACE"," ",324],["T_AS","as",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$option",324],")",["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n            ",324],["T_VARIABLE","$selectionPrices",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_getSelectionPrices",325],"(",["T_VARIABLE","$product",325],",",["T_WHITESPACE"," ",325],["T_VARIABLE","$option",325],",",["T_WHITESPACE"," ",325],["T_VARIABLE","$takeTierPrice",325],",",["T_WHITESPACE"," ",325],["T_VARIABLE","$includeTax",325],")",";",["T_WHITESPACE","\n            ",325],["T_IF","if",326],["T_WHITESPACE"," ",326],"(",["T_STRING","count",326],"(",["T_VARIABLE","$selectionPrices",326],")",")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n                ",326],["T_VARIABLE","$maximalPrice",327],["T_WHITESPACE"," ",327],["T_PLUS_EQUAL","+=",327],["T_WHITESPACE"," ",327],"(",["T_VARIABLE","$option",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","isMultiSelection",327],"(",")",")",["T_WHITESPACE","\n                    ",327],"?",["T_WHITESPACE"," ",328],["T_STRING","array_sum",328],"(",["T_VARIABLE","$selectionPrices",328],")",["T_WHITESPACE","\n                    ",328],":",["T_WHITESPACE"," ",329],["T_STRING","max",329],"(",["T_VARIABLE","$selectionPrices",329],")",";",["T_WHITESPACE","\n            ",329],"}",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n        ",331],["T_RETURN","return",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$maximalPrice",332],";",["T_WHITESPACE","\n    ",332],"}",["T_WHITESPACE","\n\n    ",333],["T_DOC_COMMENT","\/**\n     * Get all prices for bundle option selection\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param Mage_Bundle_Model_Option $option\n     * @param bool $takeTierPrice\n     * @param bool|null $includeTax\n     * @return array\n     *\/",335],["T_WHITESPACE","\n    ",343],["T_PROTECTED","protected",344],["T_WHITESPACE"," ",344],["T_FUNCTION","function",344],["T_WHITESPACE"," ",344],["T_STRING","_getSelectionPrices",344],"(",["T_VARIABLE","$product",344],",",["T_WHITESPACE"," ",344],["T_VARIABLE","$option",344],",",["T_WHITESPACE"," ",344],["T_VARIABLE","$takeTierPrice",344],",",["T_WHITESPACE"," ",344],["T_VARIABLE","$includeTax",344],")",["T_WHITESPACE","\n    ",344],"{",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$selectionPrices",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_ARRAY","array",346],"(",")",";",["T_WHITESPACE","\n        ",346],["T_VARIABLE","$taxHelper",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_getHelperData",347],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",347],")",";",["T_WHITESPACE","\n        ",347],["T_VARIABLE","$taxCalcMethod",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_VARIABLE","$taxHelper",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getConfig",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","getAlgorithm",348],"(",["T_VARIABLE","$product",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getStore",348],"(",")",")",";",["T_WHITESPACE","\n        ",348],["T_VARIABLE","$isPriceFixedType",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],"(",["T_VARIABLE","$product",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getPriceType",349],"(",")",["T_WHITESPACE"," ",349],["T_IS_EQUAL","==",349],["T_WHITESPACE"," ",349],["T_STRING","self",349],["T_DOUBLE_COLON","::",349],["T_STRING","PRICE_TYPE_FIXED",349],")",";",["T_WHITESPACE","\n\n        ",349],["T_VARIABLE","$selections",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_VARIABLE","$option",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getSelections",351],"(",")",";",["T_WHITESPACE","\n        ",351],["T_IF","if",352],["T_WHITESPACE"," ",352],"(","!",["T_VARIABLE","$selections",352],")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n            ",352],["T_RETURN","return",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$selectionPrices",353],";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE","\n\n        ",354],["T_FOREACH","foreach",356],["T_WHITESPACE"," ",356],"(",["T_VARIABLE","$selections",356],["T_WHITESPACE"," ",356],["T_AS","as",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$selection",356],")",["T_WHITESPACE"," ",356],"{",["T_WHITESPACE","\n            ",356],["T_COMMENT","\/* @var $selection Mage_Bundle_Model_Selection *\/",357],["T_WHITESPACE","\n            ",357],["T_IF","if",358],["T_WHITESPACE"," ",358],"(","!",["T_VARIABLE","$selection",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","isSalable",358],"(",")",")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n                ",358],["T_DOC_COMMENT","\/**\n                 * @todo CatalogInventory Show out of stock Products\n                 *\/",359],["T_WHITESPACE","\n                ",361],["T_CONTINUE","continue",362],";",["T_WHITESPACE","\n            ",362],"}",["T_WHITESPACE","\n\n            ",363],["T_VARIABLE","$item",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_VARIABLE","$isPriceFixedType",365],["T_WHITESPACE"," ",365],"?",["T_WHITESPACE"," ",365],["T_VARIABLE","$product",365],["T_WHITESPACE"," ",365],":",["T_WHITESPACE"," ",365],["T_VARIABLE","$selection",365],";",["T_WHITESPACE","\n\n            ",365],["T_VARIABLE","$selectionUnitPrice",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getSelectionFinalTotalPrice",367],"(",["T_WHITESPACE","\n                ",367],["T_VARIABLE","$product",368],",",["T_WHITESPACE"," ",368],["T_VARIABLE","$selection",368],",",["T_WHITESPACE"," ",368],["T_LNUMBER","1",368],",",["T_WHITESPACE"," ",368],["T_STRING","null",368],",",["T_WHITESPACE"," ",368],["T_STRING","false",368],",",["T_WHITESPACE"," ",368],["T_VARIABLE","$takeTierPrice",368],")",";",["T_WHITESPACE","\n            ",368],["T_VARIABLE","$selectionQty",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_VARIABLE","$selection",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getSelectionQty",369],"(",")",";",["T_WHITESPACE","\n            ",369],["T_IF","if",370],["T_WHITESPACE"," ",370],"(",["T_VARIABLE","$isPriceFixedType",370],["T_WHITESPACE"," ",370],["T_BOOLEAN_OR","||",370],["T_WHITESPACE"," ",370],["T_VARIABLE","$taxCalcMethod",370],["T_WHITESPACE"," ",370],["T_IS_EQUAL","==",370],["T_WHITESPACE"," ",370],["T_STRING","Mage_Tax_Model_Calculation",370],["T_DOUBLE_COLON","::",370],["T_STRING","CALC_TOTAL_BASE",370],")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n                ",370],["T_VARIABLE","$selectionPrice",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_VARIABLE","$selectionQty",371],["T_WHITESPACE"," ",371],"*",["T_WHITESPACE"," ",371],["T_VARIABLE","$taxHelper",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getPrice",371],"(",["T_VARIABLE","$item",371],",",["T_WHITESPACE"," ",371],["T_VARIABLE","$selectionUnitPrice",371],",",["T_WHITESPACE"," ",371],["T_VARIABLE","$includeTax",371],",",["T_WHITESPACE","\n                        ",371],["T_STRING","null",372],",",["T_WHITESPACE"," ",372],["T_STRING","null",372],",",["T_WHITESPACE"," ",372],["T_STRING","null",372],",",["T_WHITESPACE"," ",372],["T_STRING","null",372],",",["T_WHITESPACE"," ",372],["T_STRING","null",372],",",["T_WHITESPACE"," ",372],["T_STRING","false",372],")",";",["T_WHITESPACE","\n                ",372],["T_VARIABLE","$selectionPrices",373],"[","]",["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],["T_VARIABLE","$selectionPrice",373],";",["T_WHITESPACE","\n            ",373],"}",["T_WHITESPACE"," ",374],["T_ELSE","else",374],["T_WHITESPACE"," ",374],["T_IF","if",374],["T_WHITESPACE"," ",374],"(",["T_VARIABLE","$taxCalcMethod",374],["T_WHITESPACE"," ",374],["T_IS_EQUAL","==",374],["T_WHITESPACE"," ",374],["T_STRING","Mage_Tax_Model_Calculation",374],["T_DOUBLE_COLON","::",374],["T_STRING","CALC_ROW_BASE",374],")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n                ",374],["T_VARIABLE","$selectionPrice",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$taxHelper",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getPrice",375],"(",["T_VARIABLE","$item",375],",",["T_WHITESPACE"," ",375],["T_VARIABLE","$selectionUnitPrice",375],["T_WHITESPACE"," ",375],"*",["T_WHITESPACE"," ",375],["T_VARIABLE","$selectionQty",375],",",["T_WHITESPACE"," ",375],["T_VARIABLE","$includeTax",375],")",";",["T_WHITESPACE","\n                ",375],["T_VARIABLE","$selectionPrices",376],"[","]",["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_VARIABLE","$selectionPrice",376],";",["T_WHITESPACE","\n            ",376],"}",["T_WHITESPACE"," ",377],["T_ELSE","else",377],["T_WHITESPACE"," ",377],"{",["T_WHITESPACE"," ",377],["T_COMMENT","\/\/dynamic price and Mage_Tax_Model_Calculation::CALC_UNIT_BASE\n",377],["T_WHITESPACE","                ",378],["T_VARIABLE","$selectionPrice",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$taxHelper",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getPrice",378],"(",["T_VARIABLE","$item",378],",",["T_WHITESPACE"," ",378],["T_VARIABLE","$selectionUnitPrice",378],",",["T_WHITESPACE"," ",378],["T_VARIABLE","$includeTax",378],")",["T_WHITESPACE"," ",378],"*",["T_WHITESPACE"," ",378],["T_VARIABLE","$selectionQty",378],";",["T_WHITESPACE","\n                ",378],["T_VARIABLE","$selectionPrices",379],"[","]",["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_VARIABLE","$selectionPrice",379],";",["T_WHITESPACE","\n            ",379],"}",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE","\n        ",381],["T_RETURN","return",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$selectionPrices",382],";",["T_WHITESPACE","\n    ",382],"}",["T_WHITESPACE","\n\n    ",383],["T_DOC_COMMENT","\/**\n     * Calculate Minimal price of bundle (counting all required options)\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @return decimal\n     *\/",385],["T_WHITESPACE","\n    ",390],["T_PUBLIC","public",391],["T_WHITESPACE"," ",391],["T_FUNCTION","function",391],["T_WHITESPACE"," ",391],["T_STRING","getMinimalPrice",391],"(",["T_VARIABLE","$product",391],")",["T_WHITESPACE","\n    ",391],"{",["T_WHITESPACE","\n        ",392],["T_RETURN","return",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getPricesTierPrice",393],"(",["T_VARIABLE","$product",393],",",["T_WHITESPACE"," ",393],["T_CONSTANT_ENCAPSED_STRING","'min'",393],")",";",["T_WHITESPACE","\n    ",393],"}",["T_WHITESPACE","\n\n    ",394],["T_DOC_COMMENT","\/**\n     * Calculate maximal price of bundle\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return decimal\n     *\/",396],["T_WHITESPACE","\n    ",401],["T_PUBLIC","public",402],["T_WHITESPACE"," ",402],["T_FUNCTION","function",402],["T_WHITESPACE"," ",402],["T_STRING","getMaximalPrice",402],"(",["T_VARIABLE","$product",402],")",["T_WHITESPACE","\n    ",402],"{",["T_WHITESPACE","\n        ",403],["T_RETURN","return",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","getPricesTierPrice",404],"(",["T_VARIABLE","$product",404],",",["T_WHITESPACE"," ",404],["T_CONSTANT_ENCAPSED_STRING","'max'",404],")",";",["T_WHITESPACE","\n    ",404],"}",["T_WHITESPACE","\n\n    ",405],["T_DOC_COMMENT","\/**\n     * Get Options with attached Selections collection\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Mysql4_Option_Collection\n     *\/",407],["T_WHITESPACE","\n    ",412],["T_PUBLIC","public",413],["T_WHITESPACE"," ",413],["T_FUNCTION","function",413],["T_WHITESPACE"," ",413],["T_STRING","getOptions",413],"(",["T_VARIABLE","$product",413],")",["T_WHITESPACE","\n    ",413],"{",["T_WHITESPACE","\n        ",414],["T_VARIABLE","$product",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getTypeInstance",415],"(",["T_STRING","true",415],")",["T_WHITESPACE","\n            ",415],["T_OBJECT_OPERATOR","->",416],["T_STRING","setStoreFilter",416],"(",["T_VARIABLE","$product",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getStoreId",416],"(",")",",",["T_WHITESPACE"," ",416],["T_VARIABLE","$product",416],")",";",["T_WHITESPACE","\n\n        ",416],["T_VARIABLE","$optionCollection",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_VARIABLE","$product",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getTypeInstance",418],"(",["T_STRING","true",418],")",["T_WHITESPACE","\n            ",418],["T_OBJECT_OPERATOR","->",419],["T_STRING","getOptionsCollection",419],"(",["T_VARIABLE","$product",419],")",";",["T_WHITESPACE","\n\n        ",419],["T_VARIABLE","$selectionCollection",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_VARIABLE","$product",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getTypeInstance",421],"(",["T_STRING","true",421],")",["T_WHITESPACE","\n            ",421],["T_OBJECT_OPERATOR","->",422],["T_STRING","getSelectionsCollection",422],"(",["T_WHITESPACE","\n                ",422],["T_VARIABLE","$product",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getTypeInstance",423],"(",["T_STRING","true",423],")",["T_OBJECT_OPERATOR","->",423],["T_STRING","getOptionsIds",423],"(",["T_VARIABLE","$product",423],")",",",["T_WHITESPACE","\n                ",423],["T_VARIABLE","$product",424],["T_WHITESPACE","\n            ",424],")",";",["T_WHITESPACE","\n\n        ",425],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$optionCollection",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","appendSelections",427],"(",["T_VARIABLE","$selectionCollection",427],",",["T_WHITESPACE"," ",427],["T_STRING","false",427],",",["T_WHITESPACE"," ",427],["T_STRING","false",427],")",";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n\n    ",428],["T_DOC_COMMENT","\/**\n     * Calculate price of selection\n     *\n     * @deprecated after 1.6.2.0\n     * @see Mage_Bundle_Model_Product_Price::getSelectionFinalTotalPrice()\n     *\n     * @param Mage_Catalog_Model_Product $bundleProduct\n     * @param Mage_Catalog_Model_Product $selectionProduct\n     * @param float|null $selectionQty\n     * @param null|bool $multiplyQty      Whether to multiply selection's price by its quantity\n     * @return float\n     *\/",430],["T_WHITESPACE","\n    ",441],["T_PUBLIC","public",442],["T_WHITESPACE"," ",442],["T_FUNCTION","function",442],["T_WHITESPACE"," ",442],["T_STRING","getSelectionPrice",442],"(",["T_VARIABLE","$bundleProduct",442],",",["T_WHITESPACE"," ",442],["T_VARIABLE","$selectionProduct",442],",",["T_WHITESPACE"," ",442],["T_VARIABLE","$selectionQty",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_STRING","null",442],",",["T_WHITESPACE"," ",442],["T_VARIABLE","$multiplyQty",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_STRING","true",442],")",["T_WHITESPACE","\n    ",442],"{",["T_WHITESPACE","\n        ",443],["T_RETURN","return",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getSelectionFinalTotalPrice",444],"(",["T_VARIABLE","$bundleProduct",444],",",["T_WHITESPACE"," ",444],["T_VARIABLE","$selectionProduct",444],",",["T_WHITESPACE"," ",444],["T_LNUMBER","0",444],",",["T_WHITESPACE"," ",444],["T_VARIABLE","$selectionQty",444],",",["T_WHITESPACE"," ",444],["T_VARIABLE","$multiplyQty",444],")",";",["T_WHITESPACE","\n    ",444],"}",["T_WHITESPACE","\n\n    ",445],["T_DOC_COMMENT","\/**\n     * Calculate selection price for front view (with applied special of bundle)\n     *\n     * @param Mage_Catalog_Model_Product $bundleProduct\n     * @param Mage_Catalog_Model_Product $selectionProduct\n     * @param decimal $qty\n     * @return decimal\n     *\/",447],["T_WHITESPACE","\n    ",454],["T_PUBLIC","public",455],["T_WHITESPACE"," ",455],["T_FUNCTION","function",455],["T_WHITESPACE"," ",455],["T_STRING","getSelectionPreFinalPrice",455],"(",["T_VARIABLE","$bundleProduct",455],",",["T_WHITESPACE"," ",455],["T_VARIABLE","$selectionProduct",455],",",["T_WHITESPACE"," ",455],["T_VARIABLE","$qty",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_STRING","null",455],")",["T_WHITESPACE","\n    ",455],"{",["T_WHITESPACE","\n        ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getSelectionPrice",457],"(",["T_VARIABLE","$bundleProduct",457],",",["T_WHITESPACE"," ",457],["T_VARIABLE","$selectionProduct",457],",",["T_WHITESPACE"," ",457],["T_VARIABLE","$qty",457],")",";",["T_WHITESPACE","\n    ",457],"}",["T_WHITESPACE","\n\n    ",458],["T_DOC_COMMENT","\/**\n     * Calculate final price of selection\n     *\n     * @deprecated after 1.5.1.0\n     * @see Mage_Bundle_Model_Product_Price::getSelectionFinalTotalPrice()\n     *\n     * @param  Mage_Catalog_Model_Product $bundleProduct\n     * @param  Mage_Catalog_Model_Product $selectionProduct\n     * @param  decimal $bundleQty\n     * @param  decimal $selectionQty\n     * @param  bool $multiplyQty\n     * @return decimal\n     *\/",460],["T_WHITESPACE","\n    ",472],["T_PUBLIC","public",473],["T_WHITESPACE"," ",473],["T_FUNCTION","function",473],["T_WHITESPACE"," ",473],["T_STRING","getSelectionFinalPrice",473],"(",["T_VARIABLE","$bundleProduct",473],",",["T_WHITESPACE"," ",473],["T_VARIABLE","$selectionProduct",473],",",["T_WHITESPACE"," ",473],["T_VARIABLE","$bundleQty",473],",",["T_WHITESPACE"," ",473],["T_VARIABLE","$selectionQty",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_STRING","null",473],",",["T_WHITESPACE","\n                                           ",473],["T_VARIABLE","$multiplyQty",474],["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],["T_STRING","true",474],")",["T_WHITESPACE","\n    ",474],"{",["T_WHITESPACE","\n        ",475],["T_RETURN","return",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getSelectionFinalTotalPrice",476],"(",["T_VARIABLE","$bundleProduct",476],",",["T_WHITESPACE"," ",476],["T_VARIABLE","$selectionProduct",476],",",["T_WHITESPACE"," ",476],["T_VARIABLE","$bundleQty",476],",",["T_WHITESPACE"," ",476],["T_VARIABLE","$selectionQty",476],",",["T_WHITESPACE","\n            ",476],["T_VARIABLE","$multiplyQty",477],")",";",["T_WHITESPACE","\n    ",477],"}",["T_WHITESPACE","\n\n    ",478],["T_DOC_COMMENT","\/**\n     * Calculate final price of selection\n     * with take into account tier price\n     *\n     * @param  Mage_Catalog_Model_Product $bundleProduct\n     * @param  Mage_Catalog_Model_Product $selectionProduct\n     * @param  float $bundleQty\n     * @param  float $selectionQty\n     * @param  bool $multiplyQty\n     * @param  bool $takeTierPrice\n     * @return float\n     *\/",480],["T_WHITESPACE","\n    ",491],["T_PUBLIC","public",492],["T_WHITESPACE"," ",492],["T_FUNCTION","function",492],["T_WHITESPACE"," ",492],["T_STRING","getSelectionFinalTotalPrice",492],"(",["T_VARIABLE","$bundleProduct",492],",",["T_WHITESPACE"," ",492],["T_VARIABLE","$selectionProduct",492],",",["T_WHITESPACE"," ",492],["T_VARIABLE","$bundleQty",492],",",["T_WHITESPACE"," ",492],["T_VARIABLE","$selectionQty",492],",",["T_WHITESPACE","\n                                                ",492],["T_VARIABLE","$multiplyQty",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_STRING","true",493],",",["T_WHITESPACE"," ",493],["T_VARIABLE","$takeTierPrice",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_STRING","true",493],")",["T_WHITESPACE","\n    ",493],"{",["T_WHITESPACE","\n        ",494],["T_IF","if",495],["T_WHITESPACE"," ",495],"(",["T_STRING","is_null",495],"(",["T_VARIABLE","$selectionQty",495],")",")",["T_WHITESPACE"," ",495],"{",["T_WHITESPACE","\n            ",495],["T_VARIABLE","$selectionQty",496],["T_WHITESPACE"," ",496],"=",["T_WHITESPACE"," ",496],["T_VARIABLE","$selectionProduct",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getSelectionQty",496],"(",")",";",["T_WHITESPACE","\n        ",496],"}",["T_WHITESPACE","\n\n        ",497],["T_IF","if",499],["T_WHITESPACE"," ",499],"(",["T_VARIABLE","$bundleProduct",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","getPriceType",499],"(",")",["T_WHITESPACE"," ",499],["T_IS_EQUAL","==",499],["T_WHITESPACE"," ",499],["T_STRING","self",499],["T_DOUBLE_COLON","::",499],["T_STRING","PRICE_TYPE_DYNAMIC",499],")",["T_WHITESPACE"," ",499],"{",["T_WHITESPACE","\n            ",499],["T_VARIABLE","$price",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_VARIABLE","$selectionProduct",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getFinalPrice",500],"(",["T_VARIABLE","$takeTierPrice",500],["T_WHITESPACE"," ",500],"?",["T_WHITESPACE"," ",500],["T_VARIABLE","$selectionQty",500],["T_WHITESPACE"," ",500],":",["T_WHITESPACE"," ",500],["T_LNUMBER","1",500],")",";",["T_WHITESPACE","\n        ",500],"}",["T_WHITESPACE"," ",501],["T_ELSE","else",501],["T_WHITESPACE"," ",501],"{",["T_WHITESPACE","\n            ",501],["T_IF","if",502],["T_WHITESPACE"," ",502],"(",["T_VARIABLE","$selectionProduct",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getSelectionPriceType",502],"(",")",")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE"," ",502],["T_COMMENT","\/\/ percent\n",502],["T_WHITESPACE","                ",503],["T_VARIABLE","$product",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_CLONE","clone",503],["T_WHITESPACE"," ",503],["T_VARIABLE","$bundleProduct",503],";",["T_WHITESPACE","\n                ",503],["T_VARIABLE","$product",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","setFinalPrice",504],"(",["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","getPrice",504],"(",["T_VARIABLE","$product",504],")",")",";",["T_WHITESPACE","\n                ",504],["T_STRING","Mage",505],["T_DOUBLE_COLON","::",505],["T_STRING","dispatchEvent",505],"(",["T_WHITESPACE","\n                    ",505],["T_CONSTANT_ENCAPSED_STRING","'catalog_product_get_final_price'",506],",",["T_WHITESPACE","\n                    ",506],["T_ARRAY","array",507],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",507],["T_WHITESPACE"," ",507],["T_DOUBLE_ARROW","=>",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$product",507],",",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","'qty'",507],["T_WHITESPACE"," ",507],["T_DOUBLE_ARROW","=>",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$bundleQty",507],")",["T_WHITESPACE","\n                ",507],")",";",["T_WHITESPACE","\n                ",508],["T_VARIABLE","$price",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$product",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getData",509],"(",["T_CONSTANT_ENCAPSED_STRING","'final_price'",509],")",["T_WHITESPACE"," ",509],"*",["T_WHITESPACE"," ",509],"(",["T_VARIABLE","$selectionProduct",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getSelectionPriceValue",509],"(",")",["T_WHITESPACE"," ",509],"\/",["T_WHITESPACE"," ",509],["T_LNUMBER","100",509],")",";",["T_WHITESPACE","\n\n            ",509],"}",["T_WHITESPACE"," ",511],["T_ELSE","else",511],["T_WHITESPACE"," ",511],"{",["T_WHITESPACE"," ",511],["T_COMMENT","\/\/ fixed\n",511],["T_WHITESPACE","                ",512],["T_VARIABLE","$price",512],["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],["T_VARIABLE","$selectionProduct",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getSelectionPriceValue",512],"(",")",";",["T_WHITESPACE","\n            ",512],"}",["T_WHITESPACE","\n        ",513],"}",["T_WHITESPACE","\n\n        ",514],["T_VARIABLE","$price",516],["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","getLowestPrice",516],"(",["T_VARIABLE","$bundleProduct",516],",",["T_WHITESPACE"," ",516],["T_VARIABLE","$price",516],",",["T_WHITESPACE"," ",516],["T_VARIABLE","$bundleQty",516],")",";",["T_WHITESPACE","\n\n        ",516],["T_IF","if",518],["T_WHITESPACE"," ",518],"(",["T_VARIABLE","$multiplyQty",518],")",["T_WHITESPACE"," ",518],"{",["T_WHITESPACE","\n            ",518],["T_VARIABLE","$price",519],["T_WHITESPACE"," ",519],["T_MUL_EQUAL","*=",519],["T_WHITESPACE"," ",519],["T_VARIABLE","$selectionQty",519],";",["T_WHITESPACE","\n        ",519],"}",["T_WHITESPACE","\n\n        ",520],["T_RETURN","return",522],["T_WHITESPACE"," ",522],["T_VARIABLE","$price",522],";",["T_WHITESPACE","\n    ",522],"}",["T_WHITESPACE","\n\n    ",523],["T_DOC_COMMENT","\/**\n     * Returns the lowest price after applying any applicable bundle discounts\n     *\n     * @param Mage_Catalog_Model_Product $bundleProduct\n     * @param float|string $price\n     * @param int $bundleQty\n     * @return float\n     *\/",525],["T_WHITESPACE","\n    ",532],["T_PUBLIC","public",533],["T_WHITESPACE"," ",533],["T_FUNCTION","function",533],["T_WHITESPACE"," ",533],["T_STRING","getLowestPrice",533],"(",["T_VARIABLE","$bundleProduct",533],",",["T_WHITESPACE"," ",533],["T_VARIABLE","$price",533],",",["T_WHITESPACE"," ",533],["T_VARIABLE","$bundleQty",533],["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_LNUMBER","1",533],")",["T_WHITESPACE","\n    ",533],"{",["T_WHITESPACE","\n        ",534],["T_VARIABLE","$price",535],["T_WHITESPACE"," ",535],["T_MUL_EQUAL","*=",535],["T_WHITESPACE"," ",535],["T_LNUMBER","1",535],";",["T_WHITESPACE","\n        ",535],["T_RETURN","return",536],["T_WHITESPACE"," ",536],["T_STRING","min",536],"(",["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","_getApp",536],"(",")",["T_OBJECT_OPERATOR","->",536],["T_STRING","getStore",536],"(",")",["T_OBJECT_OPERATOR","->",536],["T_STRING","roundPrice",536],"(",["T_VARIABLE","$price",536],")",",",["T_WHITESPACE","\n            ",536],["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","_applyGroupPrice",537],"(",["T_VARIABLE","$bundleProduct",537],",",["T_WHITESPACE"," ",537],["T_VARIABLE","$price",537],")",",",["T_WHITESPACE","\n            ",537],["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","_applyTierPrice",538],"(",["T_VARIABLE","$bundleProduct",538],",",["T_WHITESPACE"," ",538],["T_VARIABLE","$bundleQty",538],",",["T_WHITESPACE"," ",538],["T_VARIABLE","$price",538],")",",",["T_WHITESPACE","\n            ",538],["T_VARIABLE","$this",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","_applySpecialPrice",539],"(",["T_VARIABLE","$bundleProduct",539],",",["T_WHITESPACE"," ",539],["T_VARIABLE","$price",539],")",["T_WHITESPACE","\n        ",539],")",";",["T_WHITESPACE","\n    ",540],"}",["T_WHITESPACE","\n\n    ",541],["T_DOC_COMMENT","\/**\n     * Apply group price for bundle product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param float $finalPrice\n     * @return float\n     *\/",543],["T_WHITESPACE","\n    ",549],["T_PROTECTED","protected",550],["T_WHITESPACE"," ",550],["T_FUNCTION","function",550],["T_WHITESPACE"," ",550],["T_STRING","_applyGroupPrice",550],"(",["T_VARIABLE","$product",550],",",["T_WHITESPACE"," ",550],["T_VARIABLE","$finalPrice",550],")",["T_WHITESPACE","\n    ",550],"{",["T_WHITESPACE","\n        ",551],["T_VARIABLE","$result",552],["T_WHITESPACE"," ",552],"=",["T_WHITESPACE"," ",552],["T_VARIABLE","$finalPrice",552],";",["T_WHITESPACE","\n        ",552],["T_VARIABLE","$groupPrice",553],["T_WHITESPACE"," ",553],"=",["T_WHITESPACE"," ",553],["T_VARIABLE","$product",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","getGroupPrice",553],"(",")",";",["T_WHITESPACE","\n\n        ",553],["T_IF","if",555],["T_WHITESPACE"," ",555],"(",["T_STRING","is_numeric",555],"(",["T_VARIABLE","$groupPrice",555],")",")",["T_WHITESPACE"," ",555],"{",["T_WHITESPACE","\n            ",555],["T_VARIABLE","$groupPrice",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_VARIABLE","$finalPrice",556],["T_WHITESPACE"," ",556],"-",["T_WHITESPACE"," ",556],"(",["T_VARIABLE","$finalPrice",556],["T_WHITESPACE"," ",556],"*",["T_WHITESPACE"," ",556],"(",["T_VARIABLE","$groupPrice",556],["T_WHITESPACE"," ",556],"\/",["T_WHITESPACE"," ",556],["T_LNUMBER","100",556],")",")",";",["T_WHITESPACE","\n            ",556],["T_VARIABLE","$groupPrice",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_getApp",557],"(",")",["T_OBJECT_OPERATOR","->",557],["T_STRING","getStore",557],"(",")",["T_OBJECT_OPERATOR","->",557],["T_STRING","roundPrice",557],"(",["T_VARIABLE","$groupPrice",557],")",";",["T_WHITESPACE","\n            ",557],["T_VARIABLE","$result",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_STRING","min",558],"(",["T_VARIABLE","$finalPrice",558],",",["T_WHITESPACE"," ",558],["T_VARIABLE","$groupPrice",558],")",";",["T_WHITESPACE","\n        ",558],"}",["T_WHITESPACE","\n\n        ",559],["T_RETURN","return",561],["T_WHITESPACE"," ",561],["T_VARIABLE","$result",561],";",["T_WHITESPACE","\n    ",561],"}",["T_WHITESPACE","\n\n    ",562],["T_DOC_COMMENT","\/**\n     * Get product group price\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return float|null\n     *\/",564],["T_WHITESPACE","\n    ",569],["T_PUBLIC","public",570],["T_WHITESPACE"," ",570],["T_FUNCTION","function",570],["T_WHITESPACE"," ",570],["T_STRING","getGroupPrice",570],"(",["T_VARIABLE","$product",570],")",["T_WHITESPACE","\n    ",570],"{",["T_WHITESPACE","\n        ",571],["T_VARIABLE","$groupPrices",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$product",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","getData",572],"(",["T_CONSTANT_ENCAPSED_STRING","'group_price'",572],")",";",["T_WHITESPACE","\n\n        ",572],["T_IF","if",574],["T_WHITESPACE"," ",574],"(",["T_STRING","is_null",574],"(",["T_VARIABLE","$groupPrices",574],")",")",["T_WHITESPACE"," ",574],"{",["T_WHITESPACE","\n            ",574],["T_VARIABLE","$attribute",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_VARIABLE","$product",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","getResource",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","getAttribute",575],"(",["T_CONSTANT_ENCAPSED_STRING","'group_price'",575],")",";",["T_WHITESPACE","\n            ",575],["T_IF","if",576],["T_WHITESPACE"," ",576],"(",["T_VARIABLE","$attribute",576],")",["T_WHITESPACE"," ",576],"{",["T_WHITESPACE","\n                ",576],["T_VARIABLE","$attribute",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","getBackend",577],"(",")",["T_OBJECT_OPERATOR","->",577],["T_STRING","afterLoad",577],"(",["T_VARIABLE","$product",577],")",";",["T_WHITESPACE","\n                ",577],["T_VARIABLE","$groupPrices",578],["T_WHITESPACE"," ",578],"=",["T_WHITESPACE"," ",578],["T_VARIABLE","$product",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getData",578],"(",["T_CONSTANT_ENCAPSED_STRING","'group_price'",578],")",";",["T_WHITESPACE","\n            ",578],"}",["T_WHITESPACE","\n        ",579],"}",["T_WHITESPACE","\n\n        ",580],["T_IF","if",582],["T_WHITESPACE"," ",582],"(",["T_STRING","is_null",582],"(",["T_VARIABLE","$groupPrices",582],")",["T_WHITESPACE"," ",582],["T_BOOLEAN_OR","||",582],["T_WHITESPACE"," ",582],"!",["T_STRING","is_array",582],"(",["T_VARIABLE","$groupPrices",582],")",")",["T_WHITESPACE"," ",582],"{",["T_WHITESPACE","\n            ",582],["T_RETURN","return",583],["T_WHITESPACE"," ",583],["T_STRING","null",583],";",["T_WHITESPACE","\n        ",583],"}",["T_WHITESPACE","\n\n        ",584],["T_VARIABLE","$customerGroup",586],["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","_getCustomerGroupId",586],"(",["T_VARIABLE","$product",586],")",";",["T_WHITESPACE","\n\n        ",586],["T_VARIABLE","$matchedPrice",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_LNUMBER","0",588],";",["T_WHITESPACE","\n\n        ",588],["T_FOREACH","foreach",590],["T_WHITESPACE"," ",590],"(",["T_VARIABLE","$groupPrices",590],["T_WHITESPACE"," ",590],["T_AS","as",590],["T_WHITESPACE"," ",590],["T_VARIABLE","$groupPrice",590],")",["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n            ",590],["T_IF","if",591],["T_WHITESPACE"," ",591],"(",["T_VARIABLE","$groupPrice",591],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",591],"]",["T_WHITESPACE"," ",591],["T_IS_EQUAL","==",591],["T_WHITESPACE"," ",591],["T_VARIABLE","$customerGroup",591],["T_WHITESPACE"," ",591],["T_BOOLEAN_AND","&&",591],["T_WHITESPACE"," ",591],["T_VARIABLE","$groupPrice",591],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",591],"]",["T_WHITESPACE"," ",591],">",["T_WHITESPACE"," ",591],["T_VARIABLE","$matchedPrice",591],")",["T_WHITESPACE"," ",591],"{",["T_WHITESPACE","\n                ",591],["T_VARIABLE","$matchedPrice",592],["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_VARIABLE","$groupPrice",592],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",592],"]",";",["T_WHITESPACE","\n                ",592],["T_BREAK","break",593],";",["T_WHITESPACE","\n            ",593],"}",["T_WHITESPACE","\n        ",594],"}",["T_WHITESPACE","\n\n        ",595],["T_RETURN","return",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$matchedPrice",597],";",["T_WHITESPACE","\n    ",597],"}",["T_WHITESPACE","\n\n    ",598],["T_DOC_COMMENT","\/**\n     * Apply tier price for bundle\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @param   decimal $qty\n     * @param   decimal $finalPrice\n     * @return  decimal\n     *\/",600],["T_WHITESPACE","\n    ",607],["T_PROTECTED","protected",608],["T_WHITESPACE"," ",608],["T_FUNCTION","function",608],["T_WHITESPACE"," ",608],["T_STRING","_applyTierPrice",608],"(",["T_VARIABLE","$product",608],",",["T_WHITESPACE"," ",608],["T_VARIABLE","$qty",608],",",["T_WHITESPACE"," ",608],["T_VARIABLE","$finalPrice",608],")",["T_WHITESPACE","\n    ",608],"{",["T_WHITESPACE","\n        ",609],["T_IF","if",610],["T_WHITESPACE"," ",610],"(",["T_STRING","is_null",610],"(",["T_VARIABLE","$qty",610],")",")",["T_WHITESPACE"," ",610],"{",["T_WHITESPACE","\n            ",610],["T_RETURN","return",611],["T_WHITESPACE"," ",611],["T_VARIABLE","$finalPrice",611],";",["T_WHITESPACE","\n        ",611],"}",["T_WHITESPACE","\n\n        ",612],["T_VARIABLE","$tierPrice",614],["T_WHITESPACE"," ",614],"=",["T_WHITESPACE"," ",614],["T_VARIABLE","$product",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","getTierPrice",614],"(",["T_VARIABLE","$qty",614],")",";",["T_WHITESPACE","\n\n        ",614],["T_IF","if",616],["T_WHITESPACE"," ",616],"(",["T_STRING","is_numeric",616],"(",["T_VARIABLE","$tierPrice",616],")",")",["T_WHITESPACE"," ",616],"{",["T_WHITESPACE","\n            ",616],["T_VARIABLE","$tierPrice",617],["T_WHITESPACE"," ",617],"=",["T_WHITESPACE"," ",617],["T_VARIABLE","$finalPrice",617],["T_WHITESPACE"," ",617],"-",["T_WHITESPACE"," ",617],"(",["T_VARIABLE","$finalPrice",617],["T_WHITESPACE"," ",617],"*",["T_WHITESPACE"," ",617],"(",["T_VARIABLE","$tierPrice",617],["T_WHITESPACE"," ",617],"\/",["T_WHITESPACE"," ",617],["T_LNUMBER","100",617],")",")",";",["T_WHITESPACE","\n            ",617],["T_VARIABLE","$tierPrice",618],["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","_getApp",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","getStore",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","roundPrice",618],"(",["T_VARIABLE","$tierPrice",618],")",";",["T_WHITESPACE","\n            ",618],["T_VARIABLE","$finalPrice",619],["T_WHITESPACE"," ",619],"=",["T_WHITESPACE"," ",619],["T_STRING","min",619],"(",["T_VARIABLE","$finalPrice",619],",",["T_WHITESPACE"," ",619],["T_VARIABLE","$tierPrice",619],")",";",["T_WHITESPACE","\n        ",619],"}",["T_WHITESPACE","\n\n        ",620],["T_RETURN","return",622],["T_WHITESPACE"," ",622],["T_VARIABLE","$finalPrice",622],";",["T_WHITESPACE","\n    ",622],"}",["T_WHITESPACE","\n\n    ",623],["T_DOC_COMMENT","\/**\n     * Get product tier price by qty\n     *\n     * @param   decimal $qty\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  decimal\n     *\/",625],["T_WHITESPACE","\n    ",631],["T_PUBLIC","public",632],["T_WHITESPACE"," ",632],["T_FUNCTION","function",632],["T_WHITESPACE"," ",632],["T_STRING","getTierPrice",632],"(",["T_VARIABLE","$qty",632],["T_WHITESPACE"," ",632],"=",["T_WHITESPACE"," ",632],["T_STRING","null",632],",",["T_WHITESPACE"," ",632],["T_VARIABLE","$product",632],")",["T_WHITESPACE","\n    ",632],"{",["T_WHITESPACE","\n        ",633],["T_VARIABLE","$allGroups",634],["T_WHITESPACE"," ",634],"=",["T_WHITESPACE"," ",634],["T_STRING","Mage_Customer_Model_Group",634],["T_DOUBLE_COLON","::",634],["T_STRING","CUST_GROUP_ALL",634],";",["T_WHITESPACE","\n        ",634],["T_VARIABLE","$prices",635],["T_WHITESPACE"," ",635],"=",["T_WHITESPACE"," ",635],["T_VARIABLE","$product",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","getData",635],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",635],")",";",["T_WHITESPACE","\n\n        ",635],["T_IF","if",637],["T_WHITESPACE"," ",637],"(",["T_STRING","is_null",637],"(",["T_VARIABLE","$prices",637],")",")",["T_WHITESPACE"," ",637],"{",["T_WHITESPACE","\n            ",637],["T_VARIABLE","$attribute",638],["T_WHITESPACE"," ",638],"=",["T_WHITESPACE"," ",638],["T_VARIABLE","$product",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","getResource",638],"(",")",["T_OBJECT_OPERATOR","->",638],["T_STRING","getAttribute",638],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",638],")",";",["T_WHITESPACE","\n            ",638],["T_IF","if",639],["T_WHITESPACE"," ",639],"(",["T_VARIABLE","$attribute",639],")",["T_WHITESPACE"," ",639],"{",["T_WHITESPACE","\n                ",639],["T_VARIABLE","$attribute",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","getBackend",640],"(",")",["T_OBJECT_OPERATOR","->",640],["T_STRING","afterLoad",640],"(",["T_VARIABLE","$product",640],")",";",["T_WHITESPACE","\n                ",640],["T_VARIABLE","$prices",641],["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_VARIABLE","$product",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","getData",641],"(",["T_CONSTANT_ENCAPSED_STRING","'tier_price'",641],")",";",["T_WHITESPACE","\n            ",641],"}",["T_WHITESPACE","\n        ",642],"}",["T_WHITESPACE","\n\n        ",643],["T_IF","if",645],["T_WHITESPACE"," ",645],"(",["T_STRING","is_null",645],"(",["T_VARIABLE","$prices",645],")",["T_WHITESPACE"," ",645],["T_BOOLEAN_OR","||",645],["T_WHITESPACE"," ",645],"!",["T_STRING","is_array",645],"(",["T_VARIABLE","$prices",645],")",")",["T_WHITESPACE"," ",645],"{",["T_WHITESPACE","\n            ",645],["T_IF","if",646],["T_WHITESPACE"," ",646],"(","!",["T_STRING","is_null",646],"(",["T_VARIABLE","$qty",646],")",")",["T_WHITESPACE"," ",646],"{",["T_WHITESPACE","\n                ",646],["T_RETURN","return",647],["T_WHITESPACE"," ",647],["T_LNUMBER","0",647],";",["T_WHITESPACE","\n            ",647],"}",["T_WHITESPACE","\n            ",648],["T_RETURN","return",649],["T_WHITESPACE"," ",649],["T_ARRAY","array",649],"(",["T_ARRAY","array",649],"(",["T_WHITESPACE","\n                ",649],["T_CONSTANT_ENCAPSED_STRING","'price'",650],["T_WHITESPACE"," ",650],["T_DOUBLE_ARROW","=>",650],["T_WHITESPACE"," ",650],["T_LNUMBER","0",650],",",["T_WHITESPACE","\n                ",650],["T_CONSTANT_ENCAPSED_STRING","'website_price'",651],["T_WHITESPACE"," ",651],["T_DOUBLE_ARROW","=>",651],["T_WHITESPACE"," ",651],["T_LNUMBER","0",651],",",["T_WHITESPACE","\n                ",651],["T_CONSTANT_ENCAPSED_STRING","'price_qty'",652],["T_WHITESPACE"," ",652],["T_DOUBLE_ARROW","=>",652],["T_WHITESPACE"," ",652],["T_LNUMBER","1",652],",",["T_WHITESPACE","\n                ",652],["T_CONSTANT_ENCAPSED_STRING","'cust_group'",653],["T_WHITESPACE"," ",653],["T_DOUBLE_ARROW","=>",653],["T_WHITESPACE"," ",653],["T_VARIABLE","$allGroups",653],["T_WHITESPACE","\n            ",653],")",")",";",["T_WHITESPACE","\n        ",654],"}",["T_WHITESPACE","\n\n        ",655],["T_VARIABLE","$custGroup",657],["T_WHITESPACE"," ",657],"=",["T_WHITESPACE"," ",657],["T_VARIABLE","$this",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","_getCustomerGroupId",657],"(",["T_VARIABLE","$product",657],")",";",["T_WHITESPACE","\n        ",657],["T_IF","if",658],["T_WHITESPACE"," ",658],"(",["T_VARIABLE","$qty",658],")",["T_WHITESPACE"," ",658],"{",["T_WHITESPACE","\n            ",658],["T_VARIABLE","$prevQty",659],["T_WHITESPACE"," ",659],"=",["T_WHITESPACE"," ",659],["T_LNUMBER","1",659],";",["T_WHITESPACE","\n            ",659],["T_VARIABLE","$prevPrice",660],["T_WHITESPACE"," ",660],"=",["T_WHITESPACE"," ",660],["T_LNUMBER","0",660],";",["T_WHITESPACE","\n            ",660],["T_VARIABLE","$prevGroup",661],["T_WHITESPACE"," ",661],"=",["T_WHITESPACE"," ",661],["T_VARIABLE","$allGroups",661],";",["T_WHITESPACE","\n\n            ",661],["T_FOREACH","foreach",663],["T_WHITESPACE"," ",663],"(",["T_VARIABLE","$prices",663],["T_WHITESPACE"," ",663],["T_AS","as",663],["T_WHITESPACE"," ",663],["T_VARIABLE","$price",663],")",["T_WHITESPACE"," ",663],"{",["T_WHITESPACE","\n                ",663],["T_IF","if",664],["T_WHITESPACE"," ",664],"(",["T_VARIABLE","$price",664],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",664],"]",["T_WHITESPACE"," ",664],["T_IS_NOT_EQUAL","!=",664],["T_WHITESPACE"," ",664],["T_VARIABLE","$custGroup",664],["T_WHITESPACE"," ",664],["T_BOOLEAN_AND","&&",664],["T_WHITESPACE"," ",664],["T_VARIABLE","$price",664],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",664],"]",["T_WHITESPACE"," ",664],["T_IS_NOT_EQUAL","!=",664],["T_WHITESPACE"," ",664],["T_VARIABLE","$allGroups",664],")",["T_WHITESPACE"," ",664],"{",["T_WHITESPACE","\n                    ",664],["T_COMMENT","\/\/ tier not for current customer group nor is for all groups\n",665],["T_WHITESPACE","                    ",666],["T_CONTINUE","continue",666],";",["T_WHITESPACE","\n                ",666],"}",["T_WHITESPACE","\n                ",667],["T_IF","if",668],["T_WHITESPACE"," ",668],"(",["T_VARIABLE","$qty",668],["T_WHITESPACE"," ",668],"<",["T_WHITESPACE"," ",668],["T_VARIABLE","$price",668],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",668],"]",")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n                    ",668],["T_COMMENT","\/\/ tier is higher than product qty\n",669],["T_WHITESPACE","                    ",670],["T_CONTINUE","continue",670],";",["T_WHITESPACE","\n                ",670],"}",["T_WHITESPACE","\n                ",671],["T_IF","if",672],["T_WHITESPACE"," ",672],"(",["T_VARIABLE","$price",672],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",672],"]",["T_WHITESPACE"," ",672],"<",["T_WHITESPACE"," ",672],["T_VARIABLE","$prevQty",672],")",["T_WHITESPACE"," ",672],"{",["T_WHITESPACE","\n                    ",672],["T_COMMENT","\/\/ higher tier qty already found\n",673],["T_WHITESPACE","                    ",674],["T_CONTINUE","continue",674],";",["T_WHITESPACE","\n                ",674],"}",["T_WHITESPACE","\n                ",675],["T_IF","if",676],["T_WHITESPACE"," ",676],"(",["T_VARIABLE","$price",676],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",676],"]",["T_WHITESPACE"," ",676],["T_IS_EQUAL","==",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$prevQty",676],["T_WHITESPACE"," ",676],["T_BOOLEAN_AND","&&",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$prevGroup",676],["T_WHITESPACE"," ",676],["T_IS_NOT_EQUAL","!=",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$allGroups",676],["T_WHITESPACE"," ",676],["T_BOOLEAN_AND","&&",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$price",676],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",676],"]",["T_WHITESPACE"," ",676],["T_IS_EQUAL","==",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$allGroups",676],")",["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n                    ",676],["T_COMMENT","\/\/ found tier qty is same as current tier qty but current tier group is ALL_GROUPS\n",677],["T_WHITESPACE","                    ",678],["T_CONTINUE","continue",678],";",["T_WHITESPACE","\n                ",678],"}",["T_WHITESPACE","\n\n                ",679],["T_IF","if",681],["T_WHITESPACE"," ",681],"(",["T_VARIABLE","$price",681],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",681],"]",["T_WHITESPACE"," ",681],">",["T_WHITESPACE"," ",681],["T_VARIABLE","$prevPrice",681],")",["T_WHITESPACE"," ",681],"{",["T_WHITESPACE","\n                    ",681],["T_VARIABLE","$prevPrice",682],["T_WHITESPACE"," ",682],"=",["T_WHITESPACE"," ",682],["T_VARIABLE","$price",682],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",682],"]",";",["T_WHITESPACE","\n                    ",682],["T_VARIABLE","$prevQty",683],["T_WHITESPACE"," ",683],"=",["T_WHITESPACE"," ",683],["T_VARIABLE","$price",683],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",683],"]",";",["T_WHITESPACE","\n                    ",683],["T_VARIABLE","$prevGroup",684],["T_WHITESPACE"," ",684],"=",["T_WHITESPACE"," ",684],["T_VARIABLE","$price",684],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",684],"]",";",["T_WHITESPACE","\n                ",684],"}",["T_WHITESPACE","\n            ",685],"}",["T_WHITESPACE","\n\n            ",686],["T_RETURN","return",688],["T_WHITESPACE"," ",688],["T_VARIABLE","$prevPrice",688],";",["T_WHITESPACE","\n        ",688],"}",["T_WHITESPACE"," ",689],["T_ELSE","else",689],["T_WHITESPACE"," ",689],"{",["T_WHITESPACE","\n            ",689],["T_VARIABLE","$qtyCache",690],["T_WHITESPACE"," ",690],"=",["T_WHITESPACE"," ",690],["T_ARRAY","array",690],"(",")",";",["T_WHITESPACE","\n            ",690],["T_FOREACH","foreach",691],["T_WHITESPACE"," ",691],"(",["T_VARIABLE","$prices",691],["T_WHITESPACE"," ",691],["T_AS","as",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$i",691],["T_WHITESPACE"," ",691],["T_DOUBLE_ARROW","=>",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$price",691],")",["T_WHITESPACE"," ",691],"{",["T_WHITESPACE","\n                ",691],["T_IF","if",692],["T_WHITESPACE"," ",692],"(",["T_VARIABLE","$price",692],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",692],"]",["T_WHITESPACE"," ",692],["T_IS_NOT_EQUAL","!=",692],["T_WHITESPACE"," ",692],["T_VARIABLE","$custGroup",692],["T_WHITESPACE"," ",692],["T_BOOLEAN_AND","&&",692],["T_WHITESPACE"," ",692],["T_VARIABLE","$price",692],"[",["T_CONSTANT_ENCAPSED_STRING","'cust_group'",692],"]",["T_WHITESPACE"," ",692],["T_IS_NOT_EQUAL","!=",692],["T_WHITESPACE"," ",692],["T_VARIABLE","$allGroups",692],")",["T_WHITESPACE"," ",692],"{",["T_WHITESPACE","\n                    ",692],["T_UNSET","unset",693],"(",["T_VARIABLE","$prices",693],"[",["T_VARIABLE","$i",693],"]",")",";",["T_WHITESPACE","\n                ",693],"}",["T_WHITESPACE"," ",694],["T_ELSE","else",694],["T_WHITESPACE"," ",694],["T_IF","if",694],["T_WHITESPACE"," ",694],"(",["T_ISSET","isset",694],"(",["T_VARIABLE","$qtyCache",694],"[",["T_VARIABLE","$price",694],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",694],"]","]",")",")",["T_WHITESPACE"," ",694],"{",["T_WHITESPACE","\n                    ",694],["T_VARIABLE","$j",695],["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_VARIABLE","$qtyCache",695],"[",["T_VARIABLE","$price",695],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",695],"]","]",";",["T_WHITESPACE","\n                    ",695],["T_IF","if",696],["T_WHITESPACE"," ",696],"(",["T_VARIABLE","$prices",696],"[",["T_VARIABLE","$j",696],"]","[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",696],"]",["T_WHITESPACE"," ",696],"<",["T_WHITESPACE"," ",696],["T_VARIABLE","$price",696],"[",["T_CONSTANT_ENCAPSED_STRING","'website_price'",696],"]",")",["T_WHITESPACE"," ",696],"{",["T_WHITESPACE","\n                        ",696],["T_UNSET","unset",697],"(",["T_VARIABLE","$prices",697],"[",["T_VARIABLE","$j",697],"]",")",";",["T_WHITESPACE","\n                        ",697],["T_VARIABLE","$qtyCache",698],"[",["T_VARIABLE","$price",698],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",698],"]","]",["T_WHITESPACE"," ",698],"=",["T_WHITESPACE"," ",698],["T_VARIABLE","$i",698],";",["T_WHITESPACE","\n                    ",698],"}",["T_WHITESPACE"," ",699],["T_ELSE","else",699],["T_WHITESPACE"," ",699],"{",["T_WHITESPACE","\n                        ",699],["T_UNSET","unset",700],"(",["T_VARIABLE","$prices",700],"[",["T_VARIABLE","$i",700],"]",")",";",["T_WHITESPACE","\n                    ",700],"}",["T_WHITESPACE","\n                ",701],"}",["T_WHITESPACE"," ",702],["T_ELSE","else",702],["T_WHITESPACE"," ",702],"{",["T_WHITESPACE","\n                    ",702],["T_VARIABLE","$qtyCache",703],"[",["T_VARIABLE","$price",703],"[",["T_CONSTANT_ENCAPSED_STRING","'price_qty'",703],"]","]",["T_WHITESPACE"," ",703],"=",["T_WHITESPACE"," ",703],["T_VARIABLE","$i",703],";",["T_WHITESPACE","\n                ",703],"}",["T_WHITESPACE","\n            ",704],"}",["T_WHITESPACE","\n        ",705],"}",["T_WHITESPACE","\n\n        ",706],["T_RETURN","return",708],["T_WHITESPACE"," ",708],"(",["T_VARIABLE","$prices",708],")",["T_WHITESPACE"," ",708],"?",["T_WHITESPACE"," ",708],["T_VARIABLE","$prices",708],["T_WHITESPACE"," ",708],":",["T_WHITESPACE"," ",708],["T_ARRAY","array",708],"(",")",";",["T_WHITESPACE","\n    ",708],"}",["T_WHITESPACE","\n\n    ",709],["T_DOC_COMMENT","\/**\n     * Calculate product price based on special price data and price rules\n     *\n     * @param   float $basePrice\n     * @param   float $specialPrice\n     * @param   string $specialPriceFrom\n     * @param   string $specialPriceTo\n     * @param   float|null|false $rulePrice\n     * @param   mixed $wId\n     * @param   mixed $gId\n     * @param   null|int $productId\n     * @return  float\n     *\/",711],["T_WHITESPACE","\n    ",723],["T_PUBLIC","public",724],["T_WHITESPACE"," ",724],["T_STATIC","static",724],["T_WHITESPACE"," ",724],["T_FUNCTION","function",724],["T_WHITESPACE"," ",724],["T_STRING","calculatePrice",724],"(",["T_VARIABLE","$basePrice",724],",",["T_WHITESPACE"," ",724],["T_VARIABLE","$specialPrice",724],",",["T_WHITESPACE"," ",724],["T_VARIABLE","$specialPriceFrom",724],",",["T_WHITESPACE"," ",724],["T_VARIABLE","$specialPriceTo",724],",",["T_WHITESPACE","\n                                          ",724],["T_VARIABLE","$rulePrice",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","false",725],",",["T_WHITESPACE"," ",725],["T_VARIABLE","$wId",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","null",725],",",["T_WHITESPACE"," ",725],["T_VARIABLE","$gId",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","null",725],",",["T_WHITESPACE"," ",725],["T_VARIABLE","$productId",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","null",725],")",["T_WHITESPACE","\n    ",725],"{",["T_WHITESPACE","\n        ",726],["T_VARIABLE","$resource",727],["T_WHITESPACE"," ",727],"=",["T_WHITESPACE"," ",727],["T_STRING","Mage",727],["T_DOUBLE_COLON","::",727],["T_STRING","getResourceSingleton",727],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/bundle'",727],")",";",["T_WHITESPACE","\n        ",727],["T_VARIABLE","$selectionResource",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_STRING","Mage",728],["T_DOUBLE_COLON","::",728],["T_STRING","getResourceSingleton",728],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",728],")",";",["T_WHITESPACE","\n        ",728],["T_VARIABLE","$productPriceTypeId",729],["T_WHITESPACE"," ",729],"=",["T_WHITESPACE"," ",729],["T_STRING","Mage",729],["T_DOUBLE_COLON","::",729],["T_STRING","getSingleton",729],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/entity_attribute'",729],")",["T_OBJECT_OPERATOR","->",729],["T_STRING","getIdByCode",729],"(",["T_WHITESPACE","\n            ",729],["T_STRING","Mage_Catalog_Model_Product",730],["T_DOUBLE_COLON","::",730],["T_STRING","ENTITY",730],",",["T_WHITESPACE","\n            ",730],["T_CONSTANT_ENCAPSED_STRING","'price_type'",731],["T_WHITESPACE","\n        ",731],")",";",["T_WHITESPACE","\n\n        ",732],["T_IF","if",734],["T_WHITESPACE"," ",734],"(",["T_VARIABLE","$wId",734],["T_WHITESPACE"," ",734],["T_INSTANCEOF","instanceof",734],["T_WHITESPACE"," ",734],["T_STRING","Mage_Core_Model_Store",734],")",["T_WHITESPACE"," ",734],"{",["T_WHITESPACE","\n            ",734],["T_VARIABLE","$store",735],["T_WHITESPACE"," ",735],"=",["T_WHITESPACE"," ",735],["T_VARIABLE","$wId",735],["T_OBJECT_OPERATOR","->",735],["T_STRING","getId",735],"(",")",";",["T_WHITESPACE","\n            ",735],["T_VARIABLE","$wId",736],["T_WHITESPACE"," ",736],"=",["T_WHITESPACE"," ",736],["T_VARIABLE","$wId",736],["T_OBJECT_OPERATOR","->",736],["T_STRING","getWebsiteId",736],"(",")",";",["T_WHITESPACE","\n        ",736],"}",["T_WHITESPACE"," ",737],["T_ELSE","else",737],["T_WHITESPACE"," ",737],"{",["T_WHITESPACE","\n            ",737],["T_VARIABLE","$store",738],["T_WHITESPACE"," ",738],"=",["T_WHITESPACE"," ",738],["T_STRING","Mage",738],["T_DOUBLE_COLON","::",738],["T_STRING","app",738],"(",")",["T_OBJECT_OPERATOR","->",738],["T_STRING","getStore",738],"(",["T_VARIABLE","$wId",738],")",["T_OBJECT_OPERATOR","->",738],["T_STRING","getId",738],"(",")",";",["T_WHITESPACE","\n            ",738],["T_VARIABLE","$wId",739],["T_WHITESPACE"," ",739],"=",["T_WHITESPACE"," ",739],["T_STRING","Mage",739],["T_DOUBLE_COLON","::",739],["T_STRING","app",739],"(",")",["T_OBJECT_OPERATOR","->",739],["T_STRING","getStore",739],"(",["T_VARIABLE","$wId",739],")",["T_OBJECT_OPERATOR","->",739],["T_STRING","getWebsiteId",739],"(",")",";",["T_WHITESPACE","\n        ",739],"}",["T_WHITESPACE","\n\n        ",740],["T_IF","if",742],["T_WHITESPACE"," ",742],"(","!",["T_VARIABLE","$gId",742],")",["T_WHITESPACE"," ",742],"{",["T_WHITESPACE","\n            ",742],["T_VARIABLE","$gId",743],["T_WHITESPACE"," ",743],"=",["T_WHITESPACE"," ",743],["T_STRING","Mage",743],["T_DOUBLE_COLON","::",743],["T_STRING","getSingleton",743],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",743],")",["T_OBJECT_OPERATOR","->",743],["T_STRING","getCustomerGroupId",743],"(",")",";",["T_WHITESPACE","\n        ",743],"}",["T_WHITESPACE"," ",744],["T_ELSE","else",744],["T_WHITESPACE"," ",744],["T_IF","if",744],["T_WHITESPACE"," ",744],"(",["T_VARIABLE","$gId",744],["T_WHITESPACE"," ",744],["T_INSTANCEOF","instanceof",744],["T_WHITESPACE"," ",744],["T_STRING","Mage_Customer_Model_Group",744],")",["T_WHITESPACE"," ",744],"{",["T_WHITESPACE","\n            ",744],["T_VARIABLE","$gId",745],["T_WHITESPACE"," ",745],"=",["T_WHITESPACE"," ",745],["T_VARIABLE","$gId",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","getId",745],"(",")",";",["T_WHITESPACE","\n        ",745],"}",["T_WHITESPACE","\n\n        ",746],["T_IF","if",748],["T_WHITESPACE"," ",748],"(","!",["T_ISSET","isset",748],"(",["T_STRING","self",748],["T_DOUBLE_COLON","::",748],["T_VARIABLE","$attributeCache",748],"[",["T_VARIABLE","$productId",748],"]","[",["T_CONSTANT_ENCAPSED_STRING","'price_type'",748],"]",")",")",["T_WHITESPACE"," ",748],"{",["T_WHITESPACE","\n            ",748],["T_VARIABLE","$attributes",749],["T_WHITESPACE"," ",749],"=",["T_WHITESPACE"," ",749],["T_VARIABLE","$resource",749],["T_OBJECT_OPERATOR","->",749],["T_STRING","getAttributeData",749],"(",["T_VARIABLE","$productId",749],",",["T_WHITESPACE"," ",749],["T_VARIABLE","$productPriceTypeId",749],",",["T_WHITESPACE"," ",749],["T_VARIABLE","$store",749],")",";",["T_WHITESPACE","\n            ",749],["T_STRING","self",750],["T_DOUBLE_COLON","::",750],["T_VARIABLE","$attributeCache",750],"[",["T_VARIABLE","$productId",750],"]","[",["T_CONSTANT_ENCAPSED_STRING","'price_type'",750],"]",["T_WHITESPACE"," ",750],"=",["T_WHITESPACE"," ",750],["T_VARIABLE","$attributes",750],";",["T_WHITESPACE","\n        ",750],"}",["T_WHITESPACE"," ",751],["T_ELSE","else",751],["T_WHITESPACE"," ",751],"{",["T_WHITESPACE","\n            ",751],["T_VARIABLE","$attributes",752],["T_WHITESPACE"," ",752],"=",["T_WHITESPACE"," ",752],["T_STRING","self",752],["T_DOUBLE_COLON","::",752],["T_VARIABLE","$attributeCache",752],"[",["T_VARIABLE","$productId",752],"]","[",["T_CONSTANT_ENCAPSED_STRING","'price_type'",752],"]",";",["T_WHITESPACE","\n        ",752],"}",["T_WHITESPACE","\n\n        ",753],["T_VARIABLE","$options",755],["T_WHITESPACE"," ",755],"=",["T_WHITESPACE"," ",755],["T_ARRAY","array",755],"(",["T_LNUMBER","0",755],")",";",["T_WHITESPACE","\n        ",755],["T_VARIABLE","$results",756],["T_WHITESPACE"," ",756],"=",["T_WHITESPACE"," ",756],["T_VARIABLE","$resource",756],["T_OBJECT_OPERATOR","->",756],["T_STRING","getSelectionsData",756],"(",["T_VARIABLE","$productId",756],")",";",["T_WHITESPACE","\n\n        ",756],["T_IF","if",758],["T_WHITESPACE"," ",758],"(","!",["T_VARIABLE","$attributes",758],["T_WHITESPACE"," ",758],["T_BOOLEAN_OR","||",758],["T_WHITESPACE"," ",758],"!",["T_VARIABLE","$attributes",758],"[",["T_LNUMBER","0",758],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",758],"]",")",["T_WHITESPACE"," ",758],"{",["T_WHITESPACE"," ",758],["T_COMMENT","\/\/dynamic\n",758],["T_WHITESPACE","            ",759],["T_FOREACH","foreach",759],["T_WHITESPACE"," ",759],"(",["T_VARIABLE","$results",759],["T_WHITESPACE"," ",759],["T_AS","as",759],["T_WHITESPACE"," ",759],["T_VARIABLE","$result",759],")",["T_WHITESPACE"," ",759],"{",["T_WHITESPACE","\n                ",759],["T_IF","if",760],["T_WHITESPACE"," ",760],"(","!",["T_VARIABLE","$result",760],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",760],"]",")",["T_WHITESPACE"," ",760],"{",["T_WHITESPACE","\n                    ",760],["T_CONTINUE","continue",761],";",["T_WHITESPACE","\n                ",761],"}",["T_WHITESPACE","\n\n                ",762],["T_IF","if",764],["T_WHITESPACE"," ",764],"(",["T_VARIABLE","$result",764],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_can_change_qty'",764],"]",["T_WHITESPACE"," ",764],["T_BOOLEAN_AND","&&",764],["T_WHITESPACE"," ",764],["T_VARIABLE","$result",764],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",764],"]",["T_WHITESPACE"," ",764],["T_IS_NOT_EQUAL","!=",764],["T_WHITESPACE"," ",764],["T_CONSTANT_ENCAPSED_STRING","'multi'",764],["T_WHITESPACE","\n                    ",764],["T_BOOLEAN_AND","&&",765],["T_WHITESPACE"," ",765],["T_VARIABLE","$result",765],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",765],"]",["T_WHITESPACE"," ",765],["T_IS_NOT_EQUAL","!=",765],["T_WHITESPACE"," ",765],["T_CONSTANT_ENCAPSED_STRING","'checkbox'",765],["T_WHITESPACE","\n                ",765],")",["T_WHITESPACE"," ",766],"{",["T_WHITESPACE","\n                    ",766],["T_VARIABLE","$qty",767],["T_WHITESPACE"," ",767],"=",["T_WHITESPACE"," ",767],["T_LNUMBER","1",767],";",["T_WHITESPACE","\n                ",767],"}",["T_WHITESPACE"," ",768],["T_ELSE","else",768],["T_WHITESPACE"," ",768],"{",["T_WHITESPACE","\n                    ",768],["T_VARIABLE","$qty",769],["T_WHITESPACE"," ",769],"=",["T_WHITESPACE"," ",769],["T_VARIABLE","$result",769],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_qty'",769],"]",";",["T_WHITESPACE","\n                ",769],"}",["T_WHITESPACE","\n\n                ",770],["T_VARIABLE","$result",772],"[",["T_CONSTANT_ENCAPSED_STRING","'final_price'",772],"]",["T_WHITESPACE"," ",772],"=",["T_WHITESPACE"," ",772],["T_VARIABLE","$selectionResource",772],["T_OBJECT_OPERATOR","->",772],["T_STRING","getPriceFromIndex",772],"(",["T_VARIABLE","$result",772],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",772],"]",",",["T_WHITESPACE"," ",772],["T_VARIABLE","$qty",772],",",["T_WHITESPACE"," ",772],["T_VARIABLE","$store",772],",",["T_WHITESPACE","\n                    ",772],["T_VARIABLE","$gId",773],")",";",["T_WHITESPACE","\n\n                ",773],["T_VARIABLE","$selectionPrice",775],["T_WHITESPACE"," ",775],"=",["T_WHITESPACE"," ",775],["T_VARIABLE","$result",775],"[",["T_CONSTANT_ENCAPSED_STRING","'final_price'",775],"]",["T_WHITESPACE"," ",775],"*",["T_WHITESPACE"," ",775],["T_VARIABLE","$qty",775],";",["T_WHITESPACE","\n\n                ",775],["T_IF","if",777],["T_WHITESPACE"," ",777],"(",["T_ISSET","isset",777],"(",["T_VARIABLE","$options",777],"[",["T_VARIABLE","$result",777],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",777],"]","]",")",")",["T_WHITESPACE"," ",777],"{",["T_WHITESPACE","\n                    ",777],["T_VARIABLE","$options",778],"[",["T_VARIABLE","$result",778],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",778],"]","]",["T_WHITESPACE"," ",778],"=",["T_WHITESPACE"," ",778],["T_STRING","min",778],"(",["T_VARIABLE","$options",778],"[",["T_VARIABLE","$result",778],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",778],"]","]",",",["T_WHITESPACE"," ",778],["T_VARIABLE","$selectionPrice",778],")",";",["T_WHITESPACE","\n                ",778],"}",["T_WHITESPACE"," ",779],["T_ELSE","else",779],["T_WHITESPACE"," ",779],"{",["T_WHITESPACE","\n                    ",779],["T_VARIABLE","$options",780],"[",["T_VARIABLE","$result",780],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",780],"]","]",["T_WHITESPACE"," ",780],"=",["T_WHITESPACE"," ",780],["T_VARIABLE","$selectionPrice",780],";",["T_WHITESPACE","\n                ",780],"}",["T_WHITESPACE","\n            ",781],"}",["T_WHITESPACE","\n            ",782],["T_VARIABLE","$basePrice",783],["T_WHITESPACE"," ",783],"=",["T_WHITESPACE"," ",783],["T_STRING","array_sum",783],"(",["T_VARIABLE","$options",783],")",";",["T_WHITESPACE","\n        ",783],"}",["T_WHITESPACE"," ",784],["T_ELSE","else",784],["T_WHITESPACE"," ",784],"{",["T_WHITESPACE","\n            ",784],["T_FOREACH","foreach",785],["T_WHITESPACE"," ",785],"(",["T_VARIABLE","$results",785],["T_WHITESPACE"," ",785],["T_AS","as",785],["T_WHITESPACE"," ",785],["T_VARIABLE","$result",785],")",["T_WHITESPACE"," ",785],"{",["T_WHITESPACE","\n                ",785],["T_IF","if",786],["T_WHITESPACE"," ",786],"(","!",["T_VARIABLE","$result",786],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",786],"]",")",["T_WHITESPACE"," ",786],"{",["T_WHITESPACE","\n                    ",786],["T_CONTINUE","continue",787],";",["T_WHITESPACE","\n                ",787],"}",["T_WHITESPACE","\n                ",788],["T_IF","if",789],["T_WHITESPACE"," ",789],"(",["T_VARIABLE","$result",789],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_price_type'",789],"]",")",["T_WHITESPACE"," ",789],"{",["T_WHITESPACE","\n                    ",789],["T_VARIABLE","$selectionPrice",790],["T_WHITESPACE"," ",790],"=",["T_WHITESPACE"," ",790],["T_VARIABLE","$basePrice",790],["T_WHITESPACE"," ",790],"*",["T_WHITESPACE"," ",790],["T_VARIABLE","$result",790],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_price_value'",790],"]",["T_WHITESPACE"," ",790],"\/",["T_WHITESPACE"," ",790],["T_LNUMBER","100",790],";",["T_WHITESPACE","\n                ",790],"}",["T_WHITESPACE"," ",791],["T_ELSE","else",791],["T_WHITESPACE"," ",791],"{",["T_WHITESPACE","\n                    ",791],["T_VARIABLE","$selectionPrice",792],["T_WHITESPACE"," ",792],"=",["T_WHITESPACE"," ",792],["T_VARIABLE","$result",792],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_price_value'",792],"]",";",["T_WHITESPACE","\n                ",792],"}",["T_WHITESPACE","\n\n                ",793],["T_IF","if",795],["T_WHITESPACE"," ",795],"(",["T_VARIABLE","$result",795],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_can_change_qty'",795],"]",["T_WHITESPACE"," ",795],["T_BOOLEAN_AND","&&",795],["T_WHITESPACE"," ",795],["T_VARIABLE","$result",795],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",795],"]",["T_WHITESPACE"," ",795],["T_IS_NOT_EQUAL","!=",795],["T_WHITESPACE"," ",795],["T_CONSTANT_ENCAPSED_STRING","'multi'",795],["T_WHITESPACE","\n                    ",795],["T_BOOLEAN_AND","&&",796],["T_WHITESPACE"," ",796],["T_VARIABLE","$result",796],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",796],"]",["T_WHITESPACE"," ",796],["T_IS_NOT_EQUAL","!=",796],["T_WHITESPACE"," ",796],["T_CONSTANT_ENCAPSED_STRING","'checkbox'",796],["T_WHITESPACE","\n                ",796],")",["T_WHITESPACE"," ",797],"{",["T_WHITESPACE","\n                    ",797],["T_VARIABLE","$qty",798],["T_WHITESPACE"," ",798],"=",["T_WHITESPACE"," ",798],["T_LNUMBER","1",798],";",["T_WHITESPACE","\n                ",798],"}",["T_WHITESPACE"," ",799],["T_ELSE","else",799],["T_WHITESPACE"," ",799],"{",["T_WHITESPACE","\n                    ",799],["T_VARIABLE","$qty",800],["T_WHITESPACE"," ",800],"=",["T_WHITESPACE"," ",800],["T_VARIABLE","$result",800],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_qty'",800],"]",";",["T_WHITESPACE","\n                ",800],"}",["T_WHITESPACE","\n\n                ",801],["T_VARIABLE","$selectionPrice",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_VARIABLE","$selectionPrice",803],["T_WHITESPACE"," ",803],"*",["T_WHITESPACE"," ",803],["T_VARIABLE","$qty",803],";",["T_WHITESPACE","\n\n                ",803],["T_IF","if",805],["T_WHITESPACE"," ",805],"(",["T_ISSET","isset",805],"(",["T_VARIABLE","$options",805],"[",["T_VARIABLE","$result",805],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",805],"]","]",")",")",["T_WHITESPACE"," ",805],"{",["T_WHITESPACE","\n                    ",805],["T_VARIABLE","$options",806],"[",["T_VARIABLE","$result",806],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",806],"]","]",["T_WHITESPACE"," ",806],"=",["T_WHITESPACE"," ",806],["T_STRING","min",806],"(",["T_VARIABLE","$options",806],"[",["T_VARIABLE","$result",806],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",806],"]","]",",",["T_WHITESPACE"," ",806],["T_VARIABLE","$selectionPrice",806],")",";",["T_WHITESPACE","\n                ",806],"}",["T_WHITESPACE"," ",807],["T_ELSE","else",807],["T_WHITESPACE"," ",807],"{",["T_WHITESPACE","\n                    ",807],["T_VARIABLE","$options",808],"[",["T_VARIABLE","$result",808],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",808],"]","]",["T_WHITESPACE"," ",808],"=",["T_WHITESPACE"," ",808],["T_VARIABLE","$selectionPrice",808],";",["T_WHITESPACE","\n                ",808],"}",["T_WHITESPACE","\n            ",809],"}",["T_WHITESPACE","\n\n            ",810],["T_VARIABLE","$basePrice",812],["T_WHITESPACE"," ",812],"=",["T_WHITESPACE"," ",812],["T_VARIABLE","$basePrice",812],["T_WHITESPACE"," ",812],"+",["T_WHITESPACE"," ",812],["T_STRING","array_sum",812],"(",["T_VARIABLE","$options",812],")",";",["T_WHITESPACE","\n        ",812],"}",["T_WHITESPACE","\n\n        ",813],["T_VARIABLE","$finalPrice",815],["T_WHITESPACE"," ",815],"=",["T_WHITESPACE"," ",815],["T_STRING","self",815],["T_DOUBLE_COLON","::",815],["T_STRING","calculateSpecialPrice",815],"(",["T_VARIABLE","$basePrice",815],",",["T_WHITESPACE"," ",815],["T_VARIABLE","$specialPrice",815],",",["T_WHITESPACE"," ",815],["T_VARIABLE","$specialPriceFrom",815],",",["T_WHITESPACE"," ",815],["T_VARIABLE","$specialPriceTo",815],",",["T_WHITESPACE","\n            ",815],["T_VARIABLE","$store",816],")",";",["T_WHITESPACE","\n\n        ",816],["T_DOC_COMMENT","\/**\n         * adding customer defined options price\n         *\/",818],["T_WHITESPACE","\n        ",820],["T_VARIABLE","$customOptions",821],["T_WHITESPACE"," ",821],"=",["T_WHITESPACE"," ",821],["T_STRING","Mage",821],["T_DOUBLE_COLON","::",821],["T_STRING","getResourceSingleton",821],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_collection'",821],")",["T_OBJECT_OPERATOR","->",821],["T_STRING","reset",821],"(",")",";",["T_WHITESPACE","\n        ",821],["T_VARIABLE","$customOptions",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","addFieldToFilter",822],"(",["T_CONSTANT_ENCAPSED_STRING","'is_require'",822],",",["T_WHITESPACE"," ",822],["T_CONSTANT_ENCAPSED_STRING","'1'",822],")",["T_WHITESPACE","\n            ",822],["T_OBJECT_OPERATOR","->",823],["T_STRING","addProductToFilter",823],"(",["T_VARIABLE","$productId",823],")",["T_WHITESPACE","\n            ",823],["T_OBJECT_OPERATOR","->",824],["T_STRING","addPriceToResult",824],"(",["T_VARIABLE","$store",824],",",["T_WHITESPACE"," ",824],["T_CONSTANT_ENCAPSED_STRING","'price'",824],")",["T_WHITESPACE","\n            ",824],["T_OBJECT_OPERATOR","->",825],["T_STRING","addValuesToResult",825],"(",")",";",["T_WHITESPACE","\n\n        ",825],["T_FOREACH","foreach",827],["T_WHITESPACE"," ",827],"(",["T_VARIABLE","$customOptions",827],["T_WHITESPACE"," ",827],["T_AS","as",827],["T_WHITESPACE"," ",827],["T_VARIABLE","$customOption",827],")",["T_WHITESPACE"," ",827],"{",["T_WHITESPACE","\n            ",827],["T_VARIABLE","$values",828],["T_WHITESPACE"," ",828],"=",["T_WHITESPACE"," ",828],["T_VARIABLE","$customOption",828],["T_OBJECT_OPERATOR","->",828],["T_STRING","getValues",828],"(",")",";",["T_WHITESPACE","\n            ",828],["T_IF","if",829],["T_WHITESPACE"," ",829],"(",["T_VARIABLE","$values",829],")",["T_WHITESPACE"," ",829],"{",["T_WHITESPACE","\n                ",829],["T_VARIABLE","$prices",830],["T_WHITESPACE"," ",830],"=",["T_WHITESPACE"," ",830],["T_ARRAY","array",830],"(",")",";",["T_WHITESPACE","\n                ",830],["T_FOREACH","foreach",831],["T_WHITESPACE"," ",831],"(",["T_VARIABLE","$values",831],["T_WHITESPACE"," ",831],["T_AS","as",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$value",831],")",["T_WHITESPACE"," ",831],"{",["T_WHITESPACE","\n                    ",831],["T_VARIABLE","$prices",832],"[","]",["T_WHITESPACE"," ",832],"=",["T_WHITESPACE"," ",832],["T_VARIABLE","$value",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","getPrice",832],"(",")",";",["T_WHITESPACE","\n                ",832],"}",["T_WHITESPACE","\n                ",833],["T_IF","if",834],["T_WHITESPACE"," ",834],"(",["T_STRING","count",834],"(",["T_VARIABLE","$prices",834],")",")",["T_WHITESPACE"," ",834],"{",["T_WHITESPACE","\n                    ",834],["T_VARIABLE","$finalPrice",835],["T_WHITESPACE"," ",835],["T_PLUS_EQUAL","+=",835],["T_WHITESPACE"," ",835],["T_STRING","min",835],"(",["T_VARIABLE","$prices",835],")",";",["T_WHITESPACE","\n                ",835],"}",["T_WHITESPACE","\n            ",836],"}",["T_WHITESPACE"," ",837],["T_ELSE","else",837],["T_WHITESPACE"," ",837],"{",["T_WHITESPACE","\n                ",837],["T_VARIABLE","$finalPrice",838],["T_WHITESPACE"," ",838],["T_PLUS_EQUAL","+=",838],["T_WHITESPACE"," ",838],["T_VARIABLE","$customOption",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","getPrice",838],"(",")",";",["T_WHITESPACE","\n            ",838],"}",["T_WHITESPACE","\n        ",839],"}",["T_WHITESPACE","\n\n        ",840],["T_IF","if",842],["T_WHITESPACE"," ",842],"(",["T_VARIABLE","$rulePrice",842],["T_WHITESPACE"," ",842],["T_IS_IDENTICAL","===",842],["T_WHITESPACE"," ",842],["T_STRING","false",842],")",["T_WHITESPACE"," ",842],"{",["T_WHITESPACE","\n            ",842],["T_VARIABLE","$rulePrice",843],["T_WHITESPACE"," ",843],"=",["T_WHITESPACE"," ",843],["T_STRING","Mage",843],["T_DOUBLE_COLON","::",843],["T_STRING","getResourceModel",843],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",843],")",["T_WHITESPACE","\n                ",843],["T_OBJECT_OPERATOR","->",844],["T_STRING","getRulePrice",844],"(",["T_STRING","Mage",844],["T_DOUBLE_COLON","::",844],["T_STRING","app",844],"(",")",["T_OBJECT_OPERATOR","->",844],["T_STRING","getLocale",844],"(",")",["T_OBJECT_OPERATOR","->",844],["T_STRING","storeTimeStamp",844],"(",["T_VARIABLE","$store",844],")",",",["T_WHITESPACE"," ",844],["T_VARIABLE","$wId",844],",",["T_WHITESPACE"," ",844],["T_VARIABLE","$gId",844],",",["T_WHITESPACE"," ",844],["T_VARIABLE","$productId",844],")",";",["T_WHITESPACE","\n        ",844],"}",["T_WHITESPACE","\n\n        ",845],["T_IF","if",847],["T_WHITESPACE"," ",847],"(",["T_VARIABLE","$rulePrice",847],["T_WHITESPACE"," ",847],["T_IS_NOT_IDENTICAL","!==",847],["T_WHITESPACE"," ",847],["T_STRING","null",847],["T_WHITESPACE"," ",847],["T_BOOLEAN_AND","&&",847],["T_WHITESPACE"," ",847],["T_VARIABLE","$rulePrice",847],["T_WHITESPACE"," ",847],["T_IS_NOT_IDENTICAL","!==",847],["T_WHITESPACE"," ",847],["T_STRING","false",847],")",["T_WHITESPACE"," ",847],"{",["T_WHITESPACE","\n            ",847],["T_VARIABLE","$finalPrice",848],["T_WHITESPACE"," ",848],"=",["T_WHITESPACE"," ",848],["T_STRING","min",848],"(",["T_VARIABLE","$finalPrice",848],",",["T_WHITESPACE"," ",848],["T_VARIABLE","$rulePrice",848],")",";",["T_WHITESPACE","\n        ",848],"}",["T_WHITESPACE","\n\n        ",849],["T_VARIABLE","$finalPrice",851],["T_WHITESPACE"," ",851],"=",["T_WHITESPACE"," ",851],["T_STRING","max",851],"(",["T_VARIABLE","$finalPrice",851],",",["T_WHITESPACE"," ",851],["T_LNUMBER","0",851],")",";",["T_WHITESPACE","\n\n        ",851],["T_RETURN","return",853],["T_WHITESPACE"," ",853],["T_VARIABLE","$finalPrice",853],";",["T_WHITESPACE","\n    ",853],"}",["T_WHITESPACE","\n\n    ",854],["T_DOC_COMMENT","\/**\n     * Calculate and apply special price\n     *\n     * @param float $finalPrice\n     * @param float $specialPrice\n     * @param string $specialPriceFrom\n     * @param string $specialPriceTo\n     * @param mixed $store\n     * @return float\n     *\/",856],["T_WHITESPACE","\n    ",865],["T_PUBLIC","public",866],["T_WHITESPACE"," ",866],["T_STATIC","static",866],["T_WHITESPACE"," ",866],["T_FUNCTION","function",866],["T_WHITESPACE"," ",866],["T_STRING","calculateSpecialPrice",866],"(",["T_VARIABLE","$finalPrice",866],",",["T_WHITESPACE"," ",866],["T_VARIABLE","$specialPrice",866],",",["T_WHITESPACE"," ",866],["T_VARIABLE","$specialPriceFrom",866],",",["T_WHITESPACE"," ",866],["T_VARIABLE","$specialPriceTo",866],",",["T_WHITESPACE","\n                                                 ",866],["T_VARIABLE","$store",867],["T_WHITESPACE"," ",867],"=",["T_WHITESPACE"," ",867],["T_STRING","null",867],")",["T_WHITESPACE","\n    ",867],"{",["T_WHITESPACE","\n        ",868],["T_IF","if",869],["T_WHITESPACE"," ",869],"(","!",["T_STRING","is_null",869],"(",["T_VARIABLE","$specialPrice",869],")",["T_WHITESPACE"," ",869],["T_BOOLEAN_AND","&&",869],["T_WHITESPACE"," ",869],["T_VARIABLE","$specialPrice",869],["T_WHITESPACE"," ",869],["T_IS_NOT_EQUAL","!=",869],["T_WHITESPACE"," ",869],["T_STRING","false",869],")",["T_WHITESPACE"," ",869],"{",["T_WHITESPACE","\n            ",869],["T_IF","if",870],["T_WHITESPACE"," ",870],"(",["T_STRING","Mage",870],["T_DOUBLE_COLON","::",870],["T_STRING","app",870],"(",")",["T_OBJECT_OPERATOR","->",870],["T_STRING","getLocale",870],"(",")",["T_OBJECT_OPERATOR","->",870],["T_STRING","isStoreDateInInterval",870],"(",["T_VARIABLE","$store",870],",",["T_WHITESPACE"," ",870],["T_VARIABLE","$specialPriceFrom",870],",",["T_WHITESPACE"," ",870],["T_VARIABLE","$specialPriceTo",870],")",")",["T_WHITESPACE"," ",870],"{",["T_WHITESPACE","\n                ",870],["T_VARIABLE","$specialPrice",871],["T_WHITESPACE"," ",871],"=",["T_WHITESPACE"," ",871],["T_STRING","Mage",871],["T_DOUBLE_COLON","::",871],["T_STRING","app",871],"(",")",["T_OBJECT_OPERATOR","->",871],["T_STRING","getStore",871],"(",")",["T_OBJECT_OPERATOR","->",871],["T_STRING","roundPrice",871],"(",["T_VARIABLE","$finalPrice",871],["T_WHITESPACE"," ",871],"*",["T_WHITESPACE"," ",871],["T_VARIABLE","$specialPrice",871],["T_WHITESPACE"," ",871],"\/",["T_WHITESPACE"," ",871],["T_LNUMBER","100",871],")",";",["T_WHITESPACE","\n                ",871],["T_VARIABLE","$finalPrice",872],["T_WHITESPACE"," ",872],"=",["T_WHITESPACE"," ",872],["T_STRING","min",872],"(",["T_VARIABLE","$finalPrice",872],",",["T_WHITESPACE"," ",872],["T_VARIABLE","$specialPrice",872],")",";",["T_WHITESPACE","\n            ",872],"}",["T_WHITESPACE","\n        ",873],"}",["T_WHITESPACE","\n\n        ",874],["T_RETURN","return",876],["T_WHITESPACE"," ",876],["T_VARIABLE","$finalPrice",876],";",["T_WHITESPACE","\n    ",876],"}",["T_WHITESPACE","\n\n    ",877],["T_DOC_COMMENT","\/**\n     * Check is group price value fixed or percent of original price\n     *\n     * @return bool\n     *\/",879],["T_WHITESPACE","\n    ",883],["T_PUBLIC","public",884],["T_WHITESPACE"," ",884],["T_FUNCTION","function",884],["T_WHITESPACE"," ",884],["T_STRING","isGroupPriceFixed",884],"(",")",["T_WHITESPACE","\n    ",884],"{",["T_WHITESPACE","\n        ",885],["T_RETURN","return",886],["T_WHITESPACE"," ",886],["T_STRING","false",886],";",["T_WHITESPACE","\n    ",886],"}",["T_WHITESPACE","\n\n    ",887],["T_DOC_COMMENT","\/**\n     * Get data helper\n     *\n     * @param string $name\n     * @return Mage_Core_Helper_Abstract\n     *\/",889],["T_WHITESPACE","\n    ",894],["T_PROTECTED","protected",895],["T_WHITESPACE"," ",895],["T_FUNCTION","function",895],["T_WHITESPACE"," ",895],["T_STRING","_getHelperData",895],"(",["T_VARIABLE","$name",895],")",["T_WHITESPACE","\n    ",895],"{",["T_WHITESPACE","\n        ",896],["T_RETURN","return",897],["T_WHITESPACE"," ",897],["T_STRING","Mage",897],["T_DOUBLE_COLON","::",897],["T_STRING","helper",897],"(",["T_VARIABLE","$name",897],")",";",["T_WHITESPACE","\n    ",897],"}",["T_WHITESPACE","\n\n    ",898],["T_DOC_COMMENT","\/**\n     * Get Magento App instance\n     *\n     * @return Mage_Core_Model_App\n     *\/",900],["T_WHITESPACE","\n    ",904],["T_PROTECTED","protected",905],["T_WHITESPACE"," ",905],["T_FUNCTION","function",905],["T_WHITESPACE"," ",905],["T_STRING","_getApp",905],"(",")",["T_WHITESPACE","\n    ",905],"{",["T_WHITESPACE","\n        ",906],["T_RETURN","return",907],["T_WHITESPACE"," ",907],["T_STRING","Mage",907],["T_DOUBLE_COLON","::",907],["T_STRING","app",907],"(",")",";",["T_WHITESPACE","\n    ",907],"}",["T_WHITESPACE","\n\n    ",908],["T_DOC_COMMENT","\/**\n     * Check if product has required options\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",910],["T_WHITESPACE","\n    ",915],["T_PROTECTED","protected",916],["T_WHITESPACE"," ",916],["T_FUNCTION","function",916],["T_WHITESPACE"," ",916],["T_STRING","_hasRequiredOptions",916],"(",["T_VARIABLE","$product",916],")",["T_WHITESPACE","\n    ",916],"{",["T_WHITESPACE","\n        ",917],["T_VARIABLE","$options",918],["T_WHITESPACE"," ",918],"=",["T_WHITESPACE"," ",918],["T_VARIABLE","$this",918],["T_OBJECT_OPERATOR","->",918],["T_STRING","getOptions",918],"(",["T_VARIABLE","$product",918],")",";",["T_WHITESPACE","\n        ",918],["T_IF","if",919],["T_WHITESPACE"," ",919],"(",["T_VARIABLE","$options",919],")",["T_WHITESPACE"," ",919],"{",["T_WHITESPACE","\n            ",919],["T_FOREACH","foreach",920],["T_WHITESPACE"," ",920],"(",["T_VARIABLE","$options",920],["T_WHITESPACE"," ",920],["T_AS","as",920],["T_WHITESPACE"," ",920],["T_VARIABLE","$option",920],")",["T_WHITESPACE"," ",920],"{",["T_WHITESPACE","\n                ",920],["T_IF","if",921],["T_WHITESPACE"," ",921],"(",["T_VARIABLE","$option",921],["T_OBJECT_OPERATOR","->",921],["T_STRING","getRequired",921],"(",")",")",["T_WHITESPACE"," ",921],"{",["T_WHITESPACE","\n                    ",921],["T_RETURN","return",922],["T_WHITESPACE"," ",922],["T_STRING","true",922],";",["T_WHITESPACE","\n                ",922],"}",["T_WHITESPACE","\n            ",923],"}",["T_WHITESPACE","\n        ",924],"}",["T_WHITESPACE","\n        ",925],["T_RETURN","return",926],["T_WHITESPACE"," ",926],["T_STRING","false",926],";",["T_WHITESPACE","\n    ",926],"}",["T_WHITESPACE","\n\n    ",927],["T_DOC_COMMENT","\/**\n     * Get minimum possible price of custom options\n     *\n     * @param Mage_Catalog_Model_Product_Option $option\n     * @return float\n     *\/",929],["T_WHITESPACE","\n    ",934],["T_PROTECTED","protected",935],["T_WHITESPACE"," ",935],["T_FUNCTION","function",935],["T_WHITESPACE"," ",935],["T_STRING","_getMinimalCustomOptionPrice",935],"(",["T_VARIABLE","$option",935],")",["T_WHITESPACE","\n    ",935],"{",["T_WHITESPACE","\n        ",936],["T_VARIABLE","$prices",937],["T_WHITESPACE"," ",937],"=",["T_WHITESPACE"," ",937],["T_VARIABLE","$this",937],["T_OBJECT_OPERATOR","->",937],["T_STRING","_getCustomOptionValuesPrices",937],"(",["T_VARIABLE","$option",937],")",";",["T_WHITESPACE","\n        ",937],["T_VARIABLE","$minimalOptionPrice",938],["T_WHITESPACE"," ",938],"=",["T_WHITESPACE"," ",938],"(",["T_VARIABLE","$prices",938],")",["T_WHITESPACE"," ",938],"?",["T_WHITESPACE"," ",938],["T_STRING","min",938],"(",["T_VARIABLE","$prices",938],")",["T_WHITESPACE"," ",938],":",["T_WHITESPACE"," ",938],["T_DOUBLE_CAST","(float)",938],["T_VARIABLE","$option",938],["T_OBJECT_OPERATOR","->",938],["T_STRING","getPrice",938],"(",["T_STRING","true",938],")",";",["T_WHITESPACE","\n        ",938],["T_VARIABLE","$minimalPrice",939],["T_WHITESPACE"," ",939],"=",["T_WHITESPACE"," ",939],"(",["T_VARIABLE","$option",939],["T_OBJECT_OPERATOR","->",939],["T_STRING","getIsRequire",939],"(",")",")",["T_WHITESPACE"," ",939],"?",["T_WHITESPACE"," ",939],["T_VARIABLE","$minimalOptionPrice",939],["T_WHITESPACE"," ",939],":",["T_WHITESPACE"," ",939],["T_LNUMBER","0",939],";",["T_WHITESPACE","\n        ",939],["T_RETURN","return",940],["T_WHITESPACE"," ",940],["T_VARIABLE","$minimalPrice",940],";",["T_WHITESPACE","\n    ",940],"}",["T_WHITESPACE","\n\n    ",941],["T_DOC_COMMENT","\/**\n     * Get maximum possible price of custom options\n     *\n     * @param Mage_Catalog_Model_Product_Option $option\n     * @return float\n     *\/",943],["T_WHITESPACE","\n    ",948],["T_PROTECTED","protected",949],["T_WHITESPACE"," ",949],["T_FUNCTION","function",949],["T_WHITESPACE"," ",949],["T_STRING","_getMaximalCustomOptionPrice",949],"(",["T_VARIABLE","$option",949],")",["T_WHITESPACE","\n    ",949],"{",["T_WHITESPACE","\n        ",950],["T_VARIABLE","$prices",951],["T_WHITESPACE"," ",951],"=",["T_WHITESPACE"," ",951],["T_VARIABLE","$this",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","_getCustomOptionValuesPrices",951],"(",["T_VARIABLE","$option",951],")",";",["T_WHITESPACE","\n        ",951],["T_IF","if",952],["T_WHITESPACE"," ",952],"(",["T_VARIABLE","$prices",952],")",["T_WHITESPACE"," ",952],"{",["T_WHITESPACE","\n            ",952],["T_VARIABLE","$maximalPrice",953],["T_WHITESPACE"," ",953],"=",["T_WHITESPACE"," ",953],"(",["T_VARIABLE","$option",953],["T_OBJECT_OPERATOR","->",953],["T_STRING","isMultipleType",953],"(",")",")",["T_WHITESPACE"," ",953],"?",["T_WHITESPACE"," ",953],["T_STRING","array_sum",953],"(",["T_VARIABLE","$prices",953],")",["T_WHITESPACE"," ",953],":",["T_WHITESPACE"," ",953],["T_STRING","max",953],"(",["T_VARIABLE","$prices",953],")",";",["T_WHITESPACE","\n        ",953],"}",["T_WHITESPACE"," ",954],["T_ELSE","else",954],["T_WHITESPACE"," ",954],"{",["T_WHITESPACE","\n            ",954],["T_VARIABLE","$maximalPrice",955],["T_WHITESPACE"," ",955],"=",["T_WHITESPACE"," ",955],["T_DOUBLE_CAST","(float)",955],"(",["T_VARIABLE","$option",955],["T_OBJECT_OPERATOR","->",955],["T_STRING","getPrice",955],"(",["T_STRING","true",955],")",")",";",["T_WHITESPACE","\n        ",955],"}",["T_WHITESPACE","\n        ",956],["T_RETURN","return",957],["T_WHITESPACE"," ",957],["T_VARIABLE","$maximalPrice",957],";",["T_WHITESPACE","\n    ",957],"}",["T_WHITESPACE","\n\n    ",958],["T_DOC_COMMENT","\/**\n     * Get all custom option values prices\n     *\n     * @param Mage_Catalog_Model_Product_Option $option\n     * @return array\n     *\/",960],["T_WHITESPACE","\n    ",965],["T_PROTECTED","protected",966],["T_WHITESPACE"," ",966],["T_FUNCTION","function",966],["T_WHITESPACE"," ",966],["T_STRING","_getCustomOptionValuesPrices",966],"(",["T_VARIABLE","$option",966],")",["T_WHITESPACE","\n    ",966],"{",["T_WHITESPACE","\n        ",967],["T_VARIABLE","$values",968],["T_WHITESPACE"," ",968],"=",["T_WHITESPACE"," ",968],["T_VARIABLE","$option",968],["T_OBJECT_OPERATOR","->",968],["T_STRING","getValues",968],"(",")",";",["T_WHITESPACE","\n        ",968],["T_VARIABLE","$prices",969],["T_WHITESPACE"," ",969],"=",["T_WHITESPACE"," ",969],["T_ARRAY","array",969],"(",")",";",["T_WHITESPACE","\n        ",969],["T_IF","if",970],["T_WHITESPACE"," ",970],"(",["T_VARIABLE","$values",970],")",["T_WHITESPACE"," ",970],"{",["T_WHITESPACE","\n            ",970],["T_FOREACH","foreach",971],["T_WHITESPACE"," ",971],"(",["T_VARIABLE","$values",971],["T_WHITESPACE"," ",971],["T_AS","as",971],["T_WHITESPACE"," ",971],["T_VARIABLE","$value",971],")",["T_WHITESPACE"," ",971],"{",["T_WHITESPACE","\n                ",971],["T_COMMENT","\/* @var $value Mage_Catalog_Model_Product_Option_Value *\/",972],["T_WHITESPACE","\n                ",972],["T_VARIABLE","$prices",973],"[","]",["T_WHITESPACE"," ",973],"=",["T_WHITESPACE"," ",973],["T_VARIABLE","$value",973],["T_OBJECT_OPERATOR","->",973],["T_STRING","getPrice",973],"(",["T_STRING","true",973],")",";",["T_WHITESPACE","\n            ",973],"}",["T_WHITESPACE","\n        ",974],"}",["T_WHITESPACE","\n        ",975],["T_RETURN","return",976],["T_WHITESPACE"," ",976],["T_VARIABLE","$prices",976],";",["T_WHITESPACE","\n    ",976],"}",["T_WHITESPACE","\n",977],"}",["T_WHITESPACE","\n",978]]