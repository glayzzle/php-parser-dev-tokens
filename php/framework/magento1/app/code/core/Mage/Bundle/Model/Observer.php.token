[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Bundle Products Observer\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Bundle_Model_Observer",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Setting Bundle Items Data to product for father processing\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",36],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","prepareProductSave",42],"(",["T_VARIABLE","$observer",42],")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$request",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$observer",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getEvent",44],"(",")",["T_OBJECT_OPERATOR","->",44],["T_STRING","getRequest",44],"(",")",";",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$product",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$observer",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getEvent",45],"(",")",["T_OBJECT_OPERATOR","->",45],["T_STRING","getProduct",45],"(",")",";",["T_WHITESPACE","\n\n        ",45],["T_IF","if",47],["T_WHITESPACE"," ",47],"(","(",["T_VARIABLE","$items",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$request",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getPost",47],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_options'",47],")",")",["T_WHITESPACE"," ",47],["T_BOOLEAN_AND","&&",47],["T_WHITESPACE"," ",47],"!",["T_VARIABLE","$product",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getCompositeReadonly",47],"(",")",")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n            ",47],["T_VARIABLE","$product",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","setBundleOptionsData",48],"(",["T_VARIABLE","$items",48],")",";",["T_WHITESPACE","\n        ",48],"}",["T_WHITESPACE","\n\n        ",49],["T_IF","if",51],["T_WHITESPACE"," ",51],"(","(",["T_VARIABLE","$selections",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$request",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getPost",51],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selections'",51],")",")",["T_WHITESPACE"," ",51],["T_BOOLEAN_AND","&&",51],["T_WHITESPACE"," ",51],"!",["T_VARIABLE","$product",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getCompositeReadonly",51],"(",")",")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$product",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","setBundleSelectionsData",52],"(",["T_VARIABLE","$selections",52],")",";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE","\n\n        ",53],["T_IF","if",55],["T_WHITESPACE"," ",55],"(",["T_VARIABLE","$product",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getPriceType",55],"(",")",["T_WHITESPACE"," ",55],["T_IS_EQUAL","==",55],["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'0'",55],["T_WHITESPACE"," ",55],["T_BOOLEAN_AND","&&",55],["T_WHITESPACE"," ",55],"!",["T_VARIABLE","$product",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getOptionsReadonly",55],"(",")",")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n            ",55],["T_VARIABLE","$product",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","setCanSaveCustomOptions",56],"(",["T_STRING","true",56],")",";",["T_WHITESPACE","\n            ",56],["T_IF","if",57],["T_WHITESPACE"," ",57],"(",["T_VARIABLE","$customOptions",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$product",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getProductOptions",57],"(",")",")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n                ",57],["T_FOREACH","foreach",58],["T_WHITESPACE"," ",58],"(",["T_STRING","array_keys",58],"(",["T_VARIABLE","$customOptions",58],")",["T_WHITESPACE"," ",58],["T_AS","as",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$key",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n                    ",58],["T_VARIABLE","$customOptions",59],"[",["T_VARIABLE","$key",59],"]","[",["T_CONSTANT_ENCAPSED_STRING","'is_delete'",59],"]",["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_LNUMBER","1",59],";",["T_WHITESPACE","\n                ",59],"}",["T_WHITESPACE","\n                ",60],["T_VARIABLE","$product",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","setProductOptions",61],"(",["T_VARIABLE","$customOptions",61],")",";",["T_WHITESPACE","\n            ",61],"}",["T_WHITESPACE","\n        ",62],"}",["T_WHITESPACE","\n\n        ",63],["T_VARIABLE","$product",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","setCanSaveBundleSelections",65],"(",["T_WHITESPACE","\n            ",65],["T_BOOL_CAST","(bool)",66],["T_VARIABLE","$request",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getPost",66],"(",["T_CONSTANT_ENCAPSED_STRING","'affect_bundle_product_selections'",66],")",["T_WHITESPACE"," ",66],["T_BOOLEAN_AND","&&",66],["T_WHITESPACE"," ",66],"!",["T_VARIABLE","$product",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getCompositeReadonly",66],"(",")",["T_WHITESPACE","\n        ",66],")",";",["T_WHITESPACE","\n\n        ",67],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Append bundles in upsell list for current product\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",72],["T_WHITESPACE","\n    ",77],["T_PUBLIC","public",78],["T_WHITESPACE"," ",78],["T_FUNCTION","function",78],["T_WHITESPACE"," ",78],["T_STRING","appendUpsellProducts",78],"(",["T_VARIABLE","$observer",78],")",["T_WHITESPACE","\n    ",78],"{",["T_WHITESPACE","\n        ",79],["T_COMMENT","\/* @var $product Mage_Catalog_Model_Product *\/",80],["T_WHITESPACE","\n        ",80],["T_VARIABLE","$product",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$observer",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getEvent",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","getProduct",81],"(",")",";",["T_WHITESPACE","\n\n        ",81],["T_DOC_COMMENT","\/**\n         * Check is current product type is allowed for bundle selection product type\n         *\/",83],["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(","!",["T_STRING","in_array",86],"(",["T_VARIABLE","$product",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getTypeId",86],"(",")",",",["T_WHITESPACE"," ",86],["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","helper",86],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",86],")",["T_OBJECT_OPERATOR","->",86],["T_STRING","getAllowedSelectionTypes",86],"(",")",")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_RETURN","return",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n\n        ",88],["T_COMMENT","\/* @var $collection Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Link_Product_Collection *\/",90],["T_WHITESPACE","\n        ",90],["T_VARIABLE","$collection",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$observer",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getEvent",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","getCollection",91],"(",")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$limit",92],["T_WHITESPACE","      ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$observer",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getEvent",92],"(",")",["T_OBJECT_OPERATOR","->",92],["T_STRING","getLimit",92],"(",")",";",["T_WHITESPACE","\n        ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_STRING","is_array",93],"(",["T_VARIABLE","$limit",93],")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_ISSET","isset",94],"(",["T_VARIABLE","$limit",94],"[",["T_CONSTANT_ENCAPSED_STRING","'upsell'",94],"]",")",")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n                ",94],["T_VARIABLE","$limit",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$limit",95],"[",["T_CONSTANT_ENCAPSED_STRING","'upsell'",95],"]",";",["T_WHITESPACE","\n            ",95],"}",["T_WHITESPACE"," ",96],["T_ELSE","else",96],["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n                ",96],["T_VARIABLE","$limit",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_LNUMBER","0",97],";",["T_WHITESPACE","\n            ",97],"}",["T_WHITESPACE","\n        ",98],"}",["T_WHITESPACE","\n\n        ",99],["T_COMMENT","\/* @var $resource Mage_Bundle_Model_Mysql4_Selection *\/",101],["T_WHITESPACE","\n        ",101],["T_VARIABLE","$resource",102],["T_WHITESPACE","   ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","Mage",102],["T_DOUBLE_COLON","::",102],["T_STRING","getResourceSingleton",102],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",102],")",";",["T_WHITESPACE","\n\n        ",102],["T_VARIABLE","$productIds",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_STRING","array_keys",104],"(",["T_VARIABLE","$collection",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getItems",104],"(",")",")",";",["T_WHITESPACE","\n        ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(","!",["T_STRING","is_null",105],"(",["T_VARIABLE","$limit",105],")",["T_WHITESPACE"," ",105],["T_BOOLEAN_AND","&&",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$limit",105],["T_WHITESPACE"," ",105],["T_IS_SMALLER_OR_EQUAL","<=",105],["T_WHITESPACE"," ",105],["T_STRING","count",105],"(",["T_VARIABLE","$productIds",105],")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n\n        ",107],["T_COMMENT","\/\/ retrieve bundle product ids\n",109],["T_WHITESPACE","        ",110],["T_VARIABLE","$bundleIds",110],["T_WHITESPACE","  ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$resource",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getParentIdsByChild",110],"(",["T_VARIABLE","$product",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getId",110],"(",")",")",";",["T_WHITESPACE","\n        ",110],["T_COMMENT","\/\/ exclude up-sell product ids\n",111],["T_WHITESPACE","        ",112],["T_VARIABLE","$bundleIds",112],["T_WHITESPACE","  ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","array_diff",112],"(",["T_VARIABLE","$bundleIds",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$productIds",112],")",";",["T_WHITESPACE","\n\n        ",112],["T_IF","if",114],["T_WHITESPACE"," ",114],"(","!",["T_VARIABLE","$bundleIds",114],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],";",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE","\n\n        ",116],["T_COMMENT","\/* @var $bundleCollection Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Collection *\/",118],["T_WHITESPACE","\n        ",118],["T_VARIABLE","$bundleCollection",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$product",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getCollection",119],"(",")",["T_WHITESPACE","\n            ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","addAttributeToSelect",120],"(",["T_STRING","Mage",120],["T_DOUBLE_COLON","::",120],["T_STRING","getSingleton",120],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/config'",120],")",["T_OBJECT_OPERATOR","->",120],["T_STRING","getProductAttributes",120],"(",")",")",["T_WHITESPACE","\n            ",120],["T_OBJECT_OPERATOR","->",121],["T_STRING","addStoreFilter",121],"(",")",["T_WHITESPACE","\n            ",121],["T_OBJECT_OPERATOR","->",122],["T_STRING","addMinimalPrice",122],"(",")",["T_WHITESPACE","\n            ",122],["T_OBJECT_OPERATOR","->",123],["T_STRING","addFinalPrice",123],"(",")",["T_WHITESPACE","\n            ",123],["T_OBJECT_OPERATOR","->",124],["T_STRING","addTaxPercents",124],"(",")",";",["T_WHITESPACE","\n\n        ",124],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","getSingleton",126],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_visibility'",126],")",["T_WHITESPACE","\n            ",126],["T_OBJECT_OPERATOR","->",127],["T_STRING","addVisibleInCatalogFilterToCollection",127],"(",["T_VARIABLE","$bundleCollection",127],")",";",["T_WHITESPACE","\n\n        ",127],["T_IF","if",129],["T_WHITESPACE"," ",129],"(","!",["T_STRING","is_null",129],"(",["T_VARIABLE","$limit",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$bundleCollection",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","setPageSize",130],"(",["T_VARIABLE","$limit",130],")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$bundleCollection",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","addFieldToFilter",132],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",132],",",["T_WHITESPACE"," ",132],["T_ARRAY","array",132],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$bundleIds",132],")",")",["T_WHITESPACE","\n            ",132],["T_OBJECT_OPERATOR","->",133],["T_STRING","setFlag",133],"(",["T_CONSTANT_ENCAPSED_STRING","'do_not_use_category_id'",133],",",["T_WHITESPACE"," ",133],["T_STRING","true",133],")",";",["T_WHITESPACE","\n\n        ",133],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$collection",135],["T_WHITESPACE"," ",135],["T_INSTANCEOF","instanceof",135],["T_WHITESPACE"," ",135],["T_STRING","Varien_Data_Collection",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_FOREACH","foreach",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$bundleCollection",136],["T_WHITESPACE"," ",136],["T_AS","as",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$item",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$collection",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","addItem",137],"(",["T_VARIABLE","$item",137],")",";",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE"," ",139],["T_ELSEIF","elseif",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$collection",139],["T_WHITESPACE"," ",139],["T_INSTANCEOF","instanceof",139],["T_WHITESPACE"," ",139],["T_STRING","Varien_Object",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$items",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$collection",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getItems",140],"(",")",";",["T_WHITESPACE","\n            ",140],["T_FOREACH","foreach",141],["T_WHITESPACE"," ",141],"(",["T_VARIABLE","$bundleCollection",141],["T_WHITESPACE"," ",141],["T_AS","as",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$item",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$items",142],"[",["T_VARIABLE","$item",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getEntityId",142],"(",")","]",["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$item",142],";",["T_WHITESPACE","\n            ",142],"}",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$collection",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","setItems",144],"(",["T_VARIABLE","$items",144],")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n\n        ",145],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Append selection attributes to selection's order item\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",150],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","appendBundleSelectionData",156],"(",["T_VARIABLE","$observer",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$orderItem",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$observer",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getEvent",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getOrderItem",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$quoteItem",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$observer",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getEvent",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getItem",159],"(",")",";",["T_WHITESPACE","\n\n        ",159],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$attributes",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$quoteItem",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getProduct",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","getCustomOption",161],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_attributes'",161],")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$productOptions",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$orderItem",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getProductOptions",162],"(",")",";",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$productOptions",163],"[",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_attributes'",163],"]",["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$attributes",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getValue",163],"(",")",";",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$orderItem",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setProductOptions",164],"(",["T_VARIABLE","$productOptions",164],")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_RETURN","return",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],";",["T_WHITESPACE","\n    ",167],"}",["T_WHITESPACE","\n\n    ",168],["T_DOC_COMMENT","\/**\n     * Add price index data for catalog product collection\n     * only for front end\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",170],["T_WHITESPACE","\n    ",176],["T_PUBLIC","public",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","loadProductOptions",177],"(",["T_VARIABLE","$observer",177],")",["T_WHITESPACE","\n    ",177],"{",["T_WHITESPACE","\n        ",178],["T_VARIABLE","$collection",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$observer",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getEvent",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","getCollection",179],"(",")",";",["T_WHITESPACE","\n        ",179],["T_COMMENT","\/* @var $collection Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Collection *\/",180],["T_WHITESPACE","\n        ",180],["T_VARIABLE","$collection",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","addPriceData",181],"(",")",";",["T_WHITESPACE","\n\n        ",181],["T_RETURN","return",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],";",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n\n    ",184],["T_DOC_COMMENT","\/**\n     * duplicating bundle options and selections\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",186],["T_WHITESPACE","\n    ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","duplicateProduct",192],"(",["T_VARIABLE","$observer",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$product",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$observer",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getEvent",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","getCurrentProduct",194],"(",")",";",["T_WHITESPACE","\n\n        ",194],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_VARIABLE","$product",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getTypeId",196],"(",")",["T_WHITESPACE"," ",196],["T_IS_NOT_EQUAL","!=",196],["T_WHITESPACE"," ",196],["T_STRING","Mage_Catalog_Model_Product_Type",196],["T_DOUBLE_COLON","::",196],["T_STRING","TYPE_BUNDLE",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_COMMENT","\/\/do nothing if not bundle\n",197],["T_WHITESPACE","            ",198],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],";",["T_WHITESPACE","\n        ",198],"}",["T_WHITESPACE","\n\n        ",199],["T_VARIABLE","$newProduct",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_VARIABLE","$observer",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getEvent",201],"(",")",["T_OBJECT_OPERATOR","->",201],["T_STRING","getNewProduct",201],"(",")",";",["T_WHITESPACE","\n\n        ",201],["T_VARIABLE","$product",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getTypeInstance",203],"(",["T_STRING","true",203],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","setStoreFilter",203],"(",["T_VARIABLE","$product",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getStoreId",203],"(",")",",",["T_WHITESPACE"," ",203],["T_VARIABLE","$product",203],")",";",["T_WHITESPACE","\n        ",203],["T_VARIABLE","$optionCollection",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$product",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getTypeInstance",204],"(",["T_STRING","true",204],")",["T_OBJECT_OPERATOR","->",204],["T_STRING","getOptionsCollection",204],"(",["T_VARIABLE","$product",204],")",";",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$selectionCollection",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$product",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getTypeInstance",205],"(",["T_STRING","true",205],")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getSelectionsCollection",205],"(",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$product",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getTypeInstance",206],"(",["T_STRING","true",206],")",["T_OBJECT_OPERATOR","->",206],["T_STRING","getOptionsIds",206],"(",["T_VARIABLE","$product",206],")",",",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$product",207],["T_WHITESPACE","\n        ",207],")",";",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$optionCollection",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","appendSelections",209],"(",["T_VARIABLE","$selectionCollection",209],")",";",["T_WHITESPACE","\n\n        ",209],["T_VARIABLE","$optionRawData",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_ARRAY","array",211],"(",")",";",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$selectionRawData",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_ARRAY","array",212],"(",")",";",["T_WHITESPACE","\n\n        ",212],["T_VARIABLE","$i",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_LNUMBER","0",214],";",["T_WHITESPACE","\n        ",214],["T_FOREACH","foreach",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$optionCollection",215],["T_WHITESPACE"," ",215],["T_AS","as",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$option",215],")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$optionRawData",216],"[",["T_VARIABLE","$i",216],"]",["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_ARRAY","array",216],"(",["T_WHITESPACE","\n                    ",216],["T_CONSTANT_ENCAPSED_STRING","'required'",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$option",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getData",217],"(",["T_CONSTANT_ENCAPSED_STRING","'required'",217],")",",",["T_WHITESPACE","\n                    ",217],["T_CONSTANT_ENCAPSED_STRING","'position'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$option",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getData",218],"(",["T_CONSTANT_ENCAPSED_STRING","'position'",218],")",",",["T_WHITESPACE","\n                    ",218],["T_CONSTANT_ENCAPSED_STRING","'type'",219],["T_WHITESPACE"," ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$option",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getData",219],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",219],")",",",["T_WHITESPACE","\n                    ",219],["T_CONSTANT_ENCAPSED_STRING","'title'",220],["T_WHITESPACE"," ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$option",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getData",220],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",220],")","?",["T_VARIABLE","$option",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getData",220],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",220],")",":",["T_VARIABLE","$option",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getData",220],"(",["T_CONSTANT_ENCAPSED_STRING","'default_title'",220],")",",",["T_WHITESPACE","\n                    ",220],["T_CONSTANT_ENCAPSED_STRING","'delete'",221],["T_WHITESPACE"," ",221],["T_DOUBLE_ARROW","=>",221],["T_WHITESPACE"," ",221],["T_CONSTANT_ENCAPSED_STRING","''",221],["T_WHITESPACE","\n                ",221],")",";",["T_WHITESPACE","\n            ",222],["T_FOREACH","foreach",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$option",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getSelections",223],"(",")",["T_WHITESPACE"," ",223],["T_AS","as",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$selection",223],")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$selectionRawData",224],"[",["T_VARIABLE","$i",224],"]","[","]",["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_ARRAY","array",224],"(",["T_WHITESPACE","\n                    ",224],["T_CONSTANT_ENCAPSED_STRING","'product_id'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$selection",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getProductId",225],"(",")",",",["T_WHITESPACE","\n                    ",225],["T_CONSTANT_ENCAPSED_STRING","'position'",226],["T_WHITESPACE"," ",226],["T_DOUBLE_ARROW","=>",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$selection",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getPosition",226],"(",")",",",["T_WHITESPACE","\n                    ",226],["T_CONSTANT_ENCAPSED_STRING","'is_default'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$selection",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getIsDefault",227],"(",")",",",["T_WHITESPACE","\n                    ",227],["T_CONSTANT_ENCAPSED_STRING","'selection_price_type'",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$selection",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getSelectionPriceType",228],"(",")",",",["T_WHITESPACE","\n                    ",228],["T_CONSTANT_ENCAPSED_STRING","'selection_price_value'",229],["T_WHITESPACE"," ",229],["T_DOUBLE_ARROW","=>",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$selection",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getSelectionPriceValue",229],"(",")",",",["T_WHITESPACE","\n                    ",229],["T_CONSTANT_ENCAPSED_STRING","'selection_qty'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$selection",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getSelectionQty",230],"(",")",",",["T_WHITESPACE","\n                    ",230],["T_CONSTANT_ENCAPSED_STRING","'selection_can_change_qty'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$selection",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getSelectionCanChangeQty",231],"(",")",",",["T_WHITESPACE","\n                    ",231],["T_CONSTANT_ENCAPSED_STRING","'delete'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_CONSTANT_ENCAPSED_STRING","''",232],["T_WHITESPACE","\n                ",232],")",";",["T_WHITESPACE","\n            ",233],"}",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$i",235],["T_INC","++",235],";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE","\n\n        ",236],["T_VARIABLE","$newProduct",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","setBundleOptionsData",238],"(",["T_VARIABLE","$optionRawData",238],")",";",["T_WHITESPACE","\n        ",238],["T_VARIABLE","$newProduct",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","setBundleSelectionsData",239],"(",["T_VARIABLE","$selectionRawData",239],")",";",["T_WHITESPACE","\n        ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n\n    ",241],["T_DOC_COMMENT","\/**\n     * Setting attribute tab block for bundle\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",243],["T_WHITESPACE","\n    ",248],["T_PUBLIC","public",249],["T_WHITESPACE"," ",249],["T_FUNCTION","function",249],["T_WHITESPACE"," ",249],["T_STRING","setAttributeTabBlock",249],"(",["T_VARIABLE","$observer",249],")",["T_WHITESPACE","\n    ",249],"{",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$product",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_VARIABLE","$observer",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getEvent",251],"(",")",["T_OBJECT_OPERATOR","->",251],["T_STRING","getProduct",251],"(",")",";",["T_WHITESPACE","\n        ",251],["T_IF","if",252],["T_WHITESPACE"," ",252],"(",["T_VARIABLE","$product",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getTypeId",252],"(",")",["T_WHITESPACE"," ",252],["T_IS_EQUAL","==",252],["T_WHITESPACE"," ",252],["T_STRING","Mage_Catalog_Model_Product_Type",252],["T_DOUBLE_COLON","::",252],["T_STRING","TYPE_BUNDLE",252],")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n            ",252],["T_STRING","Mage",253],["T_DOUBLE_COLON","::",253],["T_STRING","helper",253],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/catalog'",253],")",["T_WHITESPACE","\n                ",253],["T_OBJECT_OPERATOR","->",254],["T_STRING","setAttributeTabBlock",254],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/adminhtml_catalog_product_edit_tab_attributes'",254],")",";",["T_WHITESPACE","\n        ",254],"}",["T_WHITESPACE","\n        ",255],["T_RETURN","return",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],";",["T_WHITESPACE","\n    ",256],"}",["T_WHITESPACE","\n\n    ",257],["T_DOC_COMMENT","\/**\n     * Initialize product options renderer with bundle specific params\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",259],["T_WHITESPACE","\n    ",264],["T_PUBLIC","public",265],["T_WHITESPACE"," ",265],["T_FUNCTION","function",265],["T_WHITESPACE"," ",265],["T_STRING","initOptionRenderer",265],"(",["T_STRING","Varien_Event_Observer",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$observer",265],")",["T_WHITESPACE","\n    ",265],"{",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$block",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$observer",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getBlock",267],"(",")",";",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$block",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","addOptionsRenderCfg",268],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",268],",",["T_WHITESPACE"," ",268],["T_CONSTANT_ENCAPSED_STRING","'bundle\/catalog_product_configuration'",268],")",";",["T_WHITESPACE","\n        ",268],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],";",["T_WHITESPACE","\n    ",269],"}",["T_WHITESPACE","\n\n    ",270],["T_DOC_COMMENT","\/**\n     * Add price index to bundle product after load\n     *\n     * @deprecated since 1.4.0.0\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",272],["T_WHITESPACE","\n    ",279],["T_PUBLIC","public",280],["T_WHITESPACE"," ",280],["T_FUNCTION","function",280],["T_WHITESPACE"," ",280],["T_STRING","catalogProductLoadAfter",280],"(",["T_STRING","Varien_Event_Observer",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$observer",280],")",["T_WHITESPACE","\n    ",280],"{",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$product",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$observer",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getEvent",282],"(",")",["T_OBJECT_OPERATOR","->",282],["T_STRING","getProduct",282],"(",")",";",["T_WHITESPACE","\n        ",282],["T_IF","if",283],["T_WHITESPACE"," ",283],"(",["T_VARIABLE","$product",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getTypeId",283],"(",")",["T_WHITESPACE"," ",283],["T_IS_EQUAL","==",283],["T_WHITESPACE"," ",283],["T_STRING","Mage_Catalog_Model_Product_Type",283],["T_DOUBLE_COLON","::",283],["T_STRING","TYPE_BUNDLE",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_STRING","Mage",284],["T_DOUBLE_COLON","::",284],["T_STRING","getSingleton",284],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/price_index'",284],")",["T_WHITESPACE","\n                ",284],["T_OBJECT_OPERATOR","->",285],["T_STRING","addPriceIndexToProduct",285],"(",["T_VARIABLE","$product",285],")",";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n\n        ",286],["T_RETURN","return",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],";",["T_WHITESPACE","\n    ",288],"}",["T_WHITESPACE","\n\n    ",289],["T_DOC_COMMENT","\/**\n     * CatalogIndex Indexer after plain reindex process\n     *\n     * @deprecated since 1.4.0.0\n     * @see Mage_Bundle_Model_Mysql4_Indexer_Price\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Bundle_Model_Observer\n     *\/",291],["T_WHITESPACE","\n    ",299],["T_PUBLIC","public",300],["T_WHITESPACE"," ",300],["T_FUNCTION","function",300],["T_WHITESPACE"," ",300],["T_STRING","catalogIndexPlainReindexAfter",300],"(",["T_STRING","Varien_Event_Observer",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$observer",300],")",["T_WHITESPACE","\n    ",300],"{",["T_WHITESPACE","\n        ",301],["T_VARIABLE","$products",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$observer",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getEvent",302],"(",")",["T_OBJECT_OPERATOR","->",302],["T_STRING","getProducts",302],"(",")",";",["T_WHITESPACE","\n        ",302],["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","getSingleton",303],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/price_index'",303],")",["T_OBJECT_OPERATOR","->",303],["T_STRING","reindex",303],"(",["T_VARIABLE","$products",303],")",";",["T_WHITESPACE","\n\n        ",303],["T_RETURN","return",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$this",305],";",["T_WHITESPACE","\n    ",305],"}",["T_WHITESPACE","\n",306],"}",["T_WHITESPACE","\n",307]]