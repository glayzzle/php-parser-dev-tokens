[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Bundle Product Price Index Resource model\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Bundle_Model_Resource_Price_Index",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * EAV attributes cache\n     *\n     * @var array\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_attributes",42],["T_WHITESPACE","       ",42],"=",["T_WHITESPACE"," ",42],["T_ARRAY","array",42],"(",")",";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Websites cache\n     *\n     * @var array\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_websites",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Customer Groups cache\n     *\n     * @var array\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_customerGroups",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Initialize connection and define main table\n     *\n     *\/",58],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","_construct",62],"(",")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_init",64],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/price_index'",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",64],")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Retrieve attribute object\n     *\n     * @param string $attributeCode\n     * @return Mage_Catalog_Model_Resource_Eav_Attribute\n     *\/",67],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],["T_STRING","_getAttribute",73],"(",["T_VARIABLE","$attributeCode",73],")",["T_WHITESPACE","\n    ",73],"{",["T_WHITESPACE","\n        ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(","!",["T_ISSET","isset",75],"(",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_attributes",75],"[",["T_VARIABLE","$attributeCode",75],"]",")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_attributes",76],"[",["T_VARIABLE","$attributeCode",76],"]",["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","Mage",76],["T_DOUBLE_COLON","::",76],["T_STRING","getSingleton",76],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/config'",76],")",["T_WHITESPACE","\n                ",76],["T_OBJECT_OPERATOR","->",77],["T_STRING","getAttribute",77],"(",["T_STRING","Mage_Catalog_Model_Product",77],["T_DOUBLE_COLON","::",77],["T_STRING","ENTITY",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$attributeCode",77],")",";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n        ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_attributes",79],"[",["T_VARIABLE","$attributeCode",79],"]",";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Retrieve websites collection array\n     *\n     * @return array\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","_getWebsites",87],"(",")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_STRING","is_null",89],"(",["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_websites",89],")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_websites",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","Mage",90],["T_DOUBLE_COLON","::",90],["T_STRING","app",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","getWebsites",90],"(",["T_STRING","false",90],")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n        ",91],["T_RETURN","return",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_websites",92],";",["T_WHITESPACE","\n    ",92],"}",["T_WHITESPACE","\n\n    ",93],["T_DOC_COMMENT","\/**\n     * Retrieve customer groups collection array\n     *\n     * @return array\n     *\/",95],["T_WHITESPACE","\n    ",99],["T_PROTECTED","protected",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","_getCustomerGroups",100],"(",")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_STRING","is_null",102],"(",["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_customerGroups",102],")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_customerGroups",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",")",";",["T_WHITESPACE","\n            ",103],["T_FOREACH","foreach",104],["T_WHITESPACE"," ",104],"(",["T_STRING","Mage",104],["T_DOUBLE_COLON","::",104],["T_STRING","getModel",104],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/group'",104],")",["T_OBJECT_OPERATOR","->",104],["T_STRING","getCollection",104],"(",")",["T_WHITESPACE"," ",104],["T_AS","as",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$group",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n                ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_customerGroups",105],"[",["T_VARIABLE","$group",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getId",105],"(",")","]",["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$group",105],";",["T_WHITESPACE","\n            ",105],"}",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_customerGroups",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Retrieve product ids array by product condition\n     *\n     * @param Mage_Core_Model_Product|Mage_Catalog_Model_Product_Condition_Interface|array|int $product\n     * @param int $lastEntityId\n     * @param int $limit\n     * @return array\n     *\/",111],["T_WHITESPACE","\n    ",118],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","getProducts",119],"(",["T_VARIABLE","$product",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","null",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$lastEntityId",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_LNUMBER","0",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$limit",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_LNUMBER","100",119],")",["T_WHITESPACE","\n    ",119],"{",["T_WHITESPACE","\n\n        ",120],["T_VARIABLE","$select",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_getReadAdapter",122],"(",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","select",122],"(",")",["T_WHITESPACE","\n            ",122],["T_OBJECT_OPERATOR","->",123],["T_STRING","from",123],"(",["T_WHITESPACE","\n                ",123],["T_ARRAY","array",124],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getTable",124],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",124],")",")",",",["T_WHITESPACE","\n                ",124],["T_ARRAY","array",125],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",125],")",["T_WHITESPACE","\n            ",125],")",["T_WHITESPACE","\n            ",126],["T_OBJECT_OPERATOR","->",127],["T_STRING","where",127],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",127],",",["T_WHITESPACE"," ",127],["T_STRING","Mage_Catalog_Model_Product_Type",127],["T_DOUBLE_COLON","::",127],["T_STRING","TYPE_BUNDLE",127],")",";",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$product",128],["T_WHITESPACE"," ",128],["T_INSTANCEOF","instanceof",128],["T_WHITESPACE"," ",128],["T_STRING","Mage_Catalog_Model_Product",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$select",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","where",129],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id=?'",129],",",["T_WHITESPACE"," ",129],["T_VARIABLE","$product",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getId",129],"(",")",")",";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE"," ",130],["T_ELSEIF","elseif",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$product",130],["T_WHITESPACE"," ",130],["T_INSTANCEOF","instanceof",130],["T_WHITESPACE"," ",130],["T_STRING","Mage_Catalog_Model_Product_Condition_Interface",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$value",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_NEW","new",131],["T_WHITESPACE"," ",131],["T_STRING","Zend_Db_Expr",131],"(",["T_VARIABLE","$product",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getIdsSelect",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_getReadAdapter",131],"(",")",")",")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$select",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","where",132],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$value",132],")",";",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE"," ",133],["T_ELSEIF","elseif",133],["T_WHITESPACE"," ",133],"(",["T_STRING","is_numeric",133],"(",["T_VARIABLE","$product",133],")",["T_WHITESPACE"," ",133],["T_BOOLEAN_OR","||",133],["T_WHITESPACE"," ",133],["T_STRING","is_array",133],"(",["T_VARIABLE","$product",133],")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$select",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","where",134],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$product",134],")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n\n        ",135],["T_VARIABLE","$priceType",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_getAttribute",137],"(",["T_CONSTANT_ENCAPSED_STRING","'price_type'",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$priceTypeAlias",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","'t_'",138],["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$priceType",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getAttributeCode",138],"(",")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$joinConds",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_ARRAY","array",139],"(",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$priceTypeAlias",140],["T_WHITESPACE"," ",140],".",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'.attribute_id=:attribute_id'",140],",",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$priceTypeAlias",141],["T_WHITESPACE"," ",141],".",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","'.store_id=0'",141],",",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$priceTypeAlias",142],["T_WHITESPACE"," ",142],".",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'.entity_id=e.entity_id'",142],["T_WHITESPACE","\n        ",142],")",";",["T_WHITESPACE","\n\n        ",143],["T_VARIABLE","$select",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","joinLeft",145],"(",["T_WHITESPACE","\n            ",145],["T_ARRAY","array",146],"(",["T_VARIABLE","$priceTypeAlias",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$priceType",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getBackend",146],"(",")",["T_OBJECT_OPERATOR","->",146],["T_STRING","getTable",146],"(",")",")",",",["T_WHITESPACE","\n            ",146],["T_STRING","join",147],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$joinConds",147],")",",",["T_WHITESPACE","\n            ",147],["T_ARRAY","array",148],"(",["T_CONSTANT_ENCAPSED_STRING","'price_type'",148],["T_WHITESPACE"," ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$priceTypeAlias",148],["T_WHITESPACE"," ",148],".",["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","'.value'",148],")",["T_WHITESPACE","\n        ",148],")",";",["T_WHITESPACE","\n\n        ",149],["T_VARIABLE","$select",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","where",151],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id>:last_entity_id'",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$lastEntityId",151],")",["T_WHITESPACE","\n            ",151],["T_OBJECT_OPERATOR","->",152],["T_STRING","order",152],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",152],")",["T_WHITESPACE","\n            ",152],["T_OBJECT_OPERATOR","->",153],["T_STRING","limit",153],"(",["T_VARIABLE","$limit",153],")",";",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$bind",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_ARRAY","array",154],"(",["T_WHITESPACE","\n            ",154],["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",155],["T_WHITESPACE","   ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$priceType",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getAttributeId",155],"(",")",",",["T_WHITESPACE","\n            ",155],["T_CONSTANT_ENCAPSED_STRING","'last_entity_id'",156],["T_WHITESPACE"," ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$lastEntityId",156],["T_WHITESPACE","\n        ",156],")",";",["T_WHITESPACE","\n        ",157],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getReadAdapter",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","fetchPairs",158],"(",["T_VARIABLE","$select",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$bind",158],")",";",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * Reindex Bundle product Price Index\n     *\n     * @param Mage_Core_Model_Product|Mage_Catalog_Model_Product_Condition_Interface|array|int $products\n     * @return Mage_Bundle_Model_Resource_Price_Index\n     *\/",161],["T_WHITESPACE","\n    ",166],["T_PUBLIC","public",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","reindex",167],"(",["T_VARIABLE","$products",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","null",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$lastEntityId",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_LNUMBER","0",169],";",["T_WHITESPACE","\n        ",169],["T_WHILE","while",170],["T_WHITESPACE"," ",170],"(",["T_STRING","true",170],")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$productsData",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getProducts",171],"(",["T_VARIABLE","$products",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$lastEntityId",171],")",";",["T_WHITESPACE","\n            ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(","!",["T_VARIABLE","$productsData",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n                ",172],["T_BREAK","break",173],";",["T_WHITESPACE","\n            ",173],"}",["T_WHITESPACE","\n\n            ",174],["T_FOREACH","foreach",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$productsData",176],["T_WHITESPACE"," ",176],["T_AS","as",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$productId",176],["T_WHITESPACE"," ",176],["T_DOUBLE_ARROW","=>",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$priceType",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_reindexProduct",177],"(",["T_VARIABLE","$productId",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$priceType",177],")",";",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$lastEntityId",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$productId",178],";",["T_WHITESPACE","\n            ",178],"}",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE","\n\n        ",180],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Reindex product price\n     *\n     * @param int $productId\n     * @param int $priceType\n     * @return Mage_Bundle_Model_Resource_Price_Index\n     *\/",185],["T_WHITESPACE","\n    ",191],["T_PROTECTED","protected",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","_reindexProduct",192],"(",["T_VARIABLE","$productId",192],",",["T_WHITESPACE"," ",192],["T_VARIABLE","$priceType",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$options",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getSelections",194],"(",["T_VARIABLE","$productId",194],")",";",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$selectionProducts",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_ARRAY","array",195],"(",")",";",["T_WHITESPACE","\n        ",195],["T_FOREACH","foreach",196],["T_WHITESPACE"," ",196],"(",["T_VARIABLE","$options",196],["T_WHITESPACE"," ",196],["T_AS","as",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$option",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_FOREACH","foreach",197],["T_WHITESPACE"," ",197],"(",["T_VARIABLE","$option",197],"[",["T_CONSTANT_ENCAPSED_STRING","'selections'",197],"]",["T_WHITESPACE"," ",197],["T_AS","as",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$selection",197],")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n                ",197],["T_VARIABLE","$selectionProducts",198],"[",["T_VARIABLE","$selection",198],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",198],"]","]",["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_VARIABLE","$selection",198],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",198],"]",";",["T_WHITESPACE","\n            ",198],"}",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n\n        ",200],["T_VARIABLE","$priceIndex",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_ARRAY","array",202],"(",")",";",["T_WHITESPACE","\n        ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(",["T_VARIABLE","$priceType",203],["T_WHITESPACE"," ",203],["T_IS_EQUAL","==",203],["T_WHITESPACE"," ",203],["T_STRING","Mage_Bundle_Model_Product_Price",203],["T_DOUBLE_COLON","::",203],["T_STRING","PRICE_TYPE_DYNAMIC",203],")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_COMMENT","\/\/ load selection product prices from index for dynamic bundle\n",204],["T_WHITESPACE","            ",205],["T_VARIABLE","$priceIndex",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getProductsPriceFromIndex",205],"(",["T_VARIABLE","$selectionProducts",205],")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n\n        ",206],["T_FOREACH","foreach",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_getWebsites",208],"(",")",["T_WHITESPACE"," ",208],["T_AS","as",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$website",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_IF","if",209],["T_WHITESPACE"," ",209],"(","!",["T_VARIABLE","$website",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getDefaultStore",209],"(",")",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n                ",209],["T_CONTINUE","continue",210],";",["T_WHITESPACE","\n            ",210],"}",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$salableStatus",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getProductsSalableStatus",212],"(",["T_VARIABLE","$selectionProducts",212],",",["T_WHITESPACE"," ",212],["T_VARIABLE","$website",212],")",";",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$priceData",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getProductsPriceData",213],"(",["T_VARIABLE","$productId",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$website",213],")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$priceData",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$priceData",214],"[",["T_VARIABLE","$productId",214],"]",";",["T_WHITESPACE","\n\n            ",214],["T_COMMENT","\/* @var $website Mage_Core_Model_Website *\/",216],["T_WHITESPACE","\n            ",216],["T_FOREACH","foreach",217],["T_WHITESPACE"," ",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_getCustomerGroups",217],"(",")",["T_WHITESPACE"," ",217],["T_AS","as",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$group",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n                ",217],["T_COMMENT","\/* @var $group Mage_Customer_Model_Group *\/",218],["T_WHITESPACE","\n                ",218],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$priceType",219],["T_WHITESPACE"," ",219],["T_IS_EQUAL","==",219],["T_WHITESPACE"," ",219],["T_STRING","Mage_Bundle_Model_Product_Price",219],["T_DOUBLE_COLON","::",219],["T_STRING","PRICE_TYPE_FIXED",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n                    ",219],["T_VARIABLE","$basePrice",220],["T_WHITESPACE","     ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_getBasePrice",220],"(",["T_VARIABLE","$productId",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$priceData",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$website",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$group",220],")",";",["T_WHITESPACE","\n                    ",220],["T_VARIABLE","$customOptions",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getCustomOptions",221],"(",["T_VARIABLE","$productId",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$website",221],")",";",["T_WHITESPACE","\n                ",221],"}",["T_WHITESPACE"," ",222],["T_ELSEIF","elseif",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$priceType",222],["T_WHITESPACE"," ",222],["T_IS_EQUAL","==",222],["T_WHITESPACE"," ",222],["T_STRING","Mage_Bundle_Model_Product_Price",222],["T_DOUBLE_COLON","::",222],["T_STRING","PRICE_TYPE_DYNAMIC",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n                    ",222],["T_VARIABLE","$basePrice",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_LNUMBER","0",223],";",["T_WHITESPACE","\n                ",223],"}",["T_WHITESPACE","\n\n                ",224],["T_LIST","list",226],"(",["T_VARIABLE","$minPrice",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$maxPrice",226],")",["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_calculateBundleSelections",226],"(",["T_VARIABLE","$options",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$salableStatus",226],",",["T_WHITESPACE","\n                    ",226],["T_VARIABLE","$productId",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$priceType",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$basePrice",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$priceData",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$priceIndex",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$website",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$group",227],["T_WHITESPACE","\n                ",227],")",";",["T_WHITESPACE","\n\n                ",228],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$priceType",230],["T_WHITESPACE"," ",230],["T_IS_EQUAL","==",230],["T_WHITESPACE"," ",230],["T_STRING","Mage_Bundle_Model_Product_Price",230],["T_DOUBLE_COLON","::",230],["T_STRING","PRICE_TYPE_FIXED",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n                    ",230],["T_LIST","list",231],"(",["T_VARIABLE","$minPrice",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$maxPrice",231],")",["T_WHITESPACE"," ",231],"=",["T_WHITESPACE","\n                        ",231],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","_calculateCustomOptions",232],"(",["T_VARIABLE","$customOptions",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$basePrice",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$minPrice",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$maxPrice",232],")",";",["T_WHITESPACE","\n                ",232],"}",["T_WHITESPACE","\n\n                ",233],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_savePriceIndex",235],"(",["T_VARIABLE","$productId",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$website",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getId",235],"(",")",",",["T_WHITESPACE"," ",235],["T_VARIABLE","$group",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getId",235],"(",")",",",["T_WHITESPACE"," ",235],["T_VARIABLE","$minPrice",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$maxPrice",235],")",";",["T_WHITESPACE","\n            ",235],"}",["T_WHITESPACE","\n        ",236],"}",["T_WHITESPACE","\n\n        ",237],["T_RETURN","return",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],";",["T_WHITESPACE","\n    ",239],"}",["T_WHITESPACE","\n\n    ",240],["T_DOC_COMMENT","\/**\n     * Save price index\n     *\n     * @param int $productId\n     * @param int $websiteId\n     * @param int $groupId\n     * @param float $minPrice\n     * @param float $maxPrice\n     * @return Mage_Bundle_Model_Resource_Price_Index\n     *\/",242],["T_WHITESPACE","\n    ",251],["T_PROTECTED","protected",252],["T_WHITESPACE"," ",252],["T_FUNCTION","function",252],["T_WHITESPACE"," ",252],["T_STRING","_savePriceIndex",252],"(",["T_VARIABLE","$productId",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$websiteId",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$groupId",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$minPrice",252],",",["T_WHITESPACE"," ",252],["T_VARIABLE","$maxPrice",252],")",["T_WHITESPACE","\n    ",252],"{",["T_WHITESPACE","\n        ",253],["T_VARIABLE","$adapter",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","_getWriteAdapter",254],"(",")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$adapter",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","beginTransaction",255],"(",")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$bind",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_ARRAY","array",256],"(",["T_VARIABLE","$productId",256],",",["T_WHITESPACE"," ",256],["T_VARIABLE","$websiteId",256],",",["T_WHITESPACE"," ",256],["T_VARIABLE","$groupId",256],",",["T_WHITESPACE"," ",256],["T_VARIABLE","$minPrice",256],",",["T_WHITESPACE"," ",256],["T_VARIABLE","$maxPrice",256],")",";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$adapter",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","insertOnDuplicate",257],"(",["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getMainTable",257],"(",")",",",["T_WHITESPACE"," ",257],["T_VARIABLE","$bind",257],",",["T_WHITESPACE"," ",257],["T_ARRAY","array",257],"(",["T_CONSTANT_ENCAPSED_STRING","'min_price'",257],",",["T_WHITESPACE"," ",257],["T_CONSTANT_ENCAPSED_STRING","'max_price'",257],")",")",";",["T_WHITESPACE","\n        ",257],["T_VARIABLE","$adapter",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","commit",258],"(",")",";",["T_WHITESPACE","\n\n        ",258],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n\n    ",261],["T_DOC_COMMENT","\/**\n     * Retrieve bundle options with selections and prices by product\n     *\n     * @param int $productId\n     * @return array\n     *\/",263],["T_WHITESPACE","\n    ",268],["T_PUBLIC","public",269],["T_WHITESPACE"," ",269],["T_FUNCTION","function",269],["T_WHITESPACE"," ",269],["T_STRING","getSelections",269],"(",["T_VARIABLE","$productId",269],")",["T_WHITESPACE","\n    ",269],"{",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$options",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_ARRAY","array",271],"(",")",";",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$read",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","_getReadAdapter",272],"(",")",";",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$select",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$read",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","select",273],"(",")",["T_WHITESPACE","\n            ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","from",274],"(",["T_WHITESPACE","\n                ",274],["T_ARRAY","array",275],"(",["T_CONSTANT_ENCAPSED_STRING","'option_table'",275],["T_WHITESPACE"," ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getTable",275],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option'",275],")",")",",",["T_WHITESPACE","\n                ",275],["T_ARRAY","array",276],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",276],",",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'required'",276],",",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'type'",276],")",["T_WHITESPACE","\n            ",276],")",["T_WHITESPACE","\n            ",277],["T_OBJECT_OPERATOR","->",278],["T_STRING","join",278],"(",["T_WHITESPACE","\n                ",278],["T_ARRAY","array",279],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_table'",279],["T_WHITESPACE"," ",279],["T_DOUBLE_ARROW","=>",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","getTable",279],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",279],")",")",",",["T_WHITESPACE","\n                ",279],["T_CONSTANT_ENCAPSED_STRING","'selection_table.option_id=option_table.option_id'",280],",",["T_WHITESPACE","\n                ",280],["T_ARRAY","array",281],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",281],",",["T_WHITESPACE"," ",281],["T_CONSTANT_ENCAPSED_STRING","'product_id'",281],",",["T_WHITESPACE"," ",281],["T_CONSTANT_ENCAPSED_STRING","'selection_price_type'",281],",",["T_WHITESPACE","\n                    ",281],["T_CONSTANT_ENCAPSED_STRING","'selection_price_value'",282],",",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","'selection_qty'",282],",",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","'selection_can_change_qty'",282],")",["T_WHITESPACE","\n            ",282],")",["T_WHITESPACE","\n            ",283],["T_OBJECT_OPERATOR","->",284],["T_STRING","join",284],"(",["T_WHITESPACE","\n                ",284],["T_ARRAY","array",285],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",285],["T_WHITESPACE"," ",285],["T_DOUBLE_ARROW","=>",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getTable",285],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",285],")",")",",",["T_WHITESPACE","\n                ",285],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id=selection_table.product_id AND e.required_options=0'",286],",",["T_WHITESPACE","\n                ",286],["T_ARRAY","array",287],"(",")",["T_WHITESPACE","\n            ",287],")",["T_WHITESPACE","\n            ",288],["T_OBJECT_OPERATOR","->",289],["T_STRING","where",289],"(",["T_CONSTANT_ENCAPSED_STRING","'option_table.parent_id=:product_id'",289],")",";",["T_WHITESPACE","\n\n        ",289],["T_VARIABLE","$query",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$read",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","query",291],"(",["T_VARIABLE","$select",291],",",["T_WHITESPACE"," ",291],["T_ARRAY","array",291],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",291],["T_WHITESPACE"," ",291],["T_DOUBLE_ARROW","=>",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$productId",291],")",")",";",["T_WHITESPACE","\n        ",291],["T_WHILE","while",292],["T_WHITESPACE"," ",292],"(",["T_VARIABLE","$row",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$query",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","fetch",292],"(",")",")",["T_WHITESPACE"," ",292],"{",["T_WHITESPACE","\n            ",292],["T_IF","if",293],["T_WHITESPACE"," ",293],"(","!",["T_ISSET","isset",293],"(",["T_VARIABLE","$options",293],"[",["T_VARIABLE","$row",293],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",293],"]","]",")",")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n                ",293],["T_VARIABLE","$options",294],"[",["T_VARIABLE","$row",294],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",294],"]","]",["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_ARRAY","array",294],"(",["T_WHITESPACE","\n                    ",294],["T_CONSTANT_ENCAPSED_STRING","'option_id'",295],["T_WHITESPACE","     ",295],["T_DOUBLE_ARROW","=>",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$row",295],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",295],"]",",",["T_WHITESPACE","\n                    ",295],["T_CONSTANT_ENCAPSED_STRING","'required'",296],["T_WHITESPACE","      ",296],["T_DOUBLE_ARROW","=>",296],["T_WHITESPACE"," ",296],["T_VARIABLE","$row",296],"[",["T_CONSTANT_ENCAPSED_STRING","'required'",296],"]",",",["T_WHITESPACE","\n                    ",296],["T_CONSTANT_ENCAPSED_STRING","'type'",297],["T_WHITESPACE","          ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$row",297],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",297],"]",",",["T_WHITESPACE","\n                    ",297],["T_CONSTANT_ENCAPSED_STRING","'selections'",298],["T_WHITESPACE","    ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_ARRAY","array",298],"(",")",["T_WHITESPACE","\n                ",298],")",";",["T_WHITESPACE","\n            ",299],"}",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$options",301],"[",["T_VARIABLE","$row",301],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",301],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'selections'",301],"]","[",["T_VARIABLE","$row",301],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",301],"]","]",["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_ARRAY","array",301],"(",["T_WHITESPACE","\n                ",301],["T_CONSTANT_ENCAPSED_STRING","'selection_id'",302],["T_WHITESPACE","      ",302],["T_DOUBLE_ARROW","=>",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$row",302],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",302],"]",",",["T_WHITESPACE","\n                ",302],["T_CONSTANT_ENCAPSED_STRING","'product_id'",303],["T_WHITESPACE","        ",303],["T_DOUBLE_ARROW","=>",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$row",303],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",303],"]",",",["T_WHITESPACE","\n                ",303],["T_CONSTANT_ENCAPSED_STRING","'price_type'",304],["T_WHITESPACE","        ",304],["T_DOUBLE_ARROW","=>",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$row",304],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_price_type'",304],"]",",",["T_WHITESPACE","\n                ",304],["T_CONSTANT_ENCAPSED_STRING","'price_value'",305],["T_WHITESPACE","       ",305],["T_DOUBLE_ARROW","=>",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$row",305],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_price_value'",305],"]",",",["T_WHITESPACE","\n                ",305],["T_CONSTANT_ENCAPSED_STRING","'qty'",306],["T_WHITESPACE","               ",306],["T_DOUBLE_ARROW","=>",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$row",306],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_qty'",306],"]",",",["T_WHITESPACE","\n                ",306],["T_CONSTANT_ENCAPSED_STRING","'can_change_qty'",307],["T_WHITESPACE","    ",307],["T_DOUBLE_ARROW","=>",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$row",307],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_can_change_qty'",307],"]",["T_WHITESPACE","\n            ",307],")",";",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n\n        ",309],["T_RETURN","return",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$options",311],";",["T_WHITESPACE","\n    ",311],"}",["T_WHITESPACE","\n\n    ",312],["T_DOC_COMMENT","\/**\n     * Retrieve salable product statuses\n     *\n     * @param int|array $products\n     * @param Mage_Core_Model_Website $website\n     * @return array\n     *\/",314],["T_WHITESPACE","\n    ",320],["T_PUBLIC","public",321],["T_WHITESPACE"," ",321],["T_FUNCTION","function",321],["T_WHITESPACE"," ",321],["T_STRING","getProductsSalableStatus",321],"(",["T_VARIABLE","$products",321],",",["T_WHITESPACE"," ",321],["T_STRING","Mage_Core_Model_Website",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$website",321],")",["T_WHITESPACE","\n    ",321],"{",["T_WHITESPACE","\n        ",322],["T_VARIABLE","$read",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","_getReadAdapter",323],"(",")",";",["T_WHITESPACE","\n        ",323],["T_VARIABLE","$productsData",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_ARRAY","array",324],"(",")",";",["T_WHITESPACE","\n        ",324],["T_VARIABLE","$select",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_VARIABLE","$read",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","select",325],"(",")",["T_WHITESPACE","\n            ",325],["T_OBJECT_OPERATOR","->",326],["T_STRING","from",326],"(",["T_ARRAY","array",326],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",326],["T_WHITESPACE"," ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getTable",326],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",326],")",")",",",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",326],")",["T_WHITESPACE","\n            ",326],["T_OBJECT_OPERATOR","->",327],["T_STRING","where",327],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",327],",",["T_WHITESPACE"," ",327],["T_VARIABLE","$products",327],")",";",["T_WHITESPACE","\n        ",327],["T_COMMENT","\/\/ add belong to website\n",328],["T_WHITESPACE","        ",329],["T_VARIABLE","$select",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","joinLeft",329],"(",["T_WHITESPACE","\n            ",329],["T_ARRAY","array",330],"(",["T_CONSTANT_ENCAPSED_STRING","'pw'",330],["T_WHITESPACE"," ",330],["T_DOUBLE_ARROW","=>",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getTable",330],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_website'",330],")",")",",",["T_WHITESPACE","\n            ",330],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id=pw.product_id AND pw.website_id=:website_id'",331],",",["T_WHITESPACE","\n            ",331],["T_ARRAY","array",332],"(",["T_CONSTANT_ENCAPSED_STRING","'pw.website_id'",332],")",["T_WHITESPACE","\n        ",332],")",";",["T_WHITESPACE","\n\n        ",333],["T_VARIABLE","$store",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$website",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getDefaultStore",335],"(",")",";",["T_WHITESPACE","\n\n        ",335],["T_COMMENT","\/\/ add product status\n",337],["T_WHITESPACE","        ",338],["T_VARIABLE","$status",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_getAttribute",338],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",338],")",";",["T_WHITESPACE","\n        ",338],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$status",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","isScopeGlobal",339],"(",")",")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$select",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","join",340],"(",["T_WHITESPACE","\n                ",340],["T_ARRAY","array",341],"(",["T_CONSTANT_ENCAPSED_STRING","'t_status'",341],["T_WHITESPACE"," ",341],["T_DOUBLE_ARROW","=>",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$status",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getBackend",341],"(",")",["T_OBJECT_OPERATOR","->",341],["T_STRING","getTable",341],"(",")",")",",",["T_WHITESPACE","\n                ",341],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id=t_status.entity_id'",342],["T_WHITESPACE","\n                ",342],".",["T_WHITESPACE"," ",343],["T_CONSTANT_ENCAPSED_STRING","' AND t_status.attribute_id=:status_attribute_id'",343],["T_WHITESPACE","\n                ",343],".",["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","' AND t_status.store_id=0'",344],",",["T_WHITESPACE","\n                ",344],["T_ARRAY","array",345],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",345],["T_WHITESPACE"," ",345],["T_DOUBLE_ARROW","=>",345],["T_WHITESPACE"," ",345],["T_CONSTANT_ENCAPSED_STRING","'t_status.value'",345],")",["T_WHITESPACE","\n            ",345],")",";",["T_WHITESPACE","\n        ",346],"}",["T_WHITESPACE"," ",347],["T_ELSE","else",347],["T_WHITESPACE"," ",347],"{",["T_WHITESPACE","\n\n            ",347],["T_VARIABLE","$statusField",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$read",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getCheckSql",349],"(",["T_WHITESPACE","\n                ",349],["T_CONSTANT_ENCAPSED_STRING","'t2_status.value_id > 0'",350],",",["T_WHITESPACE","\n                ",350],["T_CONSTANT_ENCAPSED_STRING","'t2_status.value'",351],",",["T_WHITESPACE","\n                ",351],["T_CONSTANT_ENCAPSED_STRING","'t1_status.value'",352],["T_WHITESPACE","\n            ",352],")",";",["T_WHITESPACE","\n\n            ",353],["T_VARIABLE","$statusTable",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_VARIABLE","$status",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getBackend",355],"(",")",["T_OBJECT_OPERATOR","->",355],["T_STRING","getTable",355],"(",")",";",["T_WHITESPACE","\n            ",355],["T_VARIABLE","$select",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","join",356],"(",["T_WHITESPACE","\n                ",356],["T_ARRAY","array",357],"(",["T_CONSTANT_ENCAPSED_STRING","'t1_status'",357],["T_WHITESPACE"," ",357],["T_DOUBLE_ARROW","=>",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$statusTable",357],")",",",["T_WHITESPACE","\n                ",357],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id=t1_status.entity_id'",358],["T_WHITESPACE","\n                ",358],".",["T_WHITESPACE"," ",359],["T_CONSTANT_ENCAPSED_STRING","' AND t1_status.attribute_id=:status_attribute_id'",359],["T_WHITESPACE","\n                ",359],".",["T_WHITESPACE"," ",360],["T_CONSTANT_ENCAPSED_STRING","' AND t1_status.store_id=0'",360],",",["T_WHITESPACE","\n                ",360],["T_ARRAY","array",361],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",361],["T_WHITESPACE"," ",361],["T_DOUBLE_ARROW","=>",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$statusField",361],")",["T_WHITESPACE","\n            ",361],")",["T_WHITESPACE","\n            ",362],["T_OBJECT_OPERATOR","->",363],["T_STRING","joinLeft",363],"(",["T_WHITESPACE","\n                ",363],["T_ARRAY","array",364],"(",["T_CONSTANT_ENCAPSED_STRING","'t2_status'",364],["T_WHITESPACE"," ",364],["T_DOUBLE_ARROW","=>",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$statusTable",364],")",",",["T_WHITESPACE","\n                ",364],["T_CONSTANT_ENCAPSED_STRING","'t1_status.entity_id = t2_status.entity_id'",365],["T_WHITESPACE","\n                ",365],".",["T_WHITESPACE"," ",366],["T_CONSTANT_ENCAPSED_STRING","' AND t1_status.attribute_id = t2_status.attribute_id'",366],["T_WHITESPACE","\n                ",366],".",["T_WHITESPACE"," ",367],["T_CONSTANT_ENCAPSED_STRING","' AND t2_status.store_id=:store_id'",367],",",["T_WHITESPACE","\n                ",367],["T_ARRAY","array",368],"(",")",["T_WHITESPACE","\n            ",368],")",";",["T_WHITESPACE","\n        ",369],"}",["T_WHITESPACE","\n\n        ",370],["T_VARIABLE","$bind",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_ARRAY","array",372],"(",["T_WHITESPACE","\n            ",372],["T_CONSTANT_ENCAPSED_STRING","'status_attribute_id'",373],["T_WHITESPACE"," ",373],["T_DOUBLE_ARROW","=>",373],["T_WHITESPACE"," ",373],["T_VARIABLE","$status",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getAttributeId",373],"(",")",",",["T_WHITESPACE","\n            ",373],["T_CONSTANT_ENCAPSED_STRING","'website_id'",374],["T_WHITESPACE","   ",374],["T_DOUBLE_ARROW","=>",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$website",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getId",374],"(",")",",",["T_WHITESPACE","\n            ",374],["T_CONSTANT_ENCAPSED_STRING","'store_id'",375],["T_WHITESPACE","     ",375],["T_DOUBLE_ARROW","=>",375],["T_WHITESPACE"," ",375],["T_VARIABLE","$store",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getId",375],"(",")",["T_WHITESPACE","\n        ",375],")",";",["T_WHITESPACE","\n\n        ",376],["T_STRING","Mage",378],["T_DOUBLE_COLON","::",378],["T_STRING","dispatchEvent",378],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_prepare_index_select'",378],",",["T_WHITESPACE"," ",378],["T_ARRAY","array",378],"(",["T_WHITESPACE","\n            ",378],["T_CONSTANT_ENCAPSED_STRING","'website'",379],["T_WHITESPACE","   ",379],["T_DOUBLE_ARROW","=>",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$website",379],",",["T_WHITESPACE","\n            ",379],["T_CONSTANT_ENCAPSED_STRING","'select'",380],["T_WHITESPACE","    ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$select",380],",",["T_WHITESPACE","\n            ",380],["T_CONSTANT_ENCAPSED_STRING","'bind'",381],["T_WHITESPACE","      ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$bind",381],["T_WHITESPACE","\n        ",381],")",")",";",["T_WHITESPACE","\n\n        ",382],["T_VARIABLE","$query",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$read",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","query",384],"(",["T_VARIABLE","$select",384],",",["T_WHITESPACE"," ",384],["T_VARIABLE","$bind",384],")",";",["T_WHITESPACE","\n        ",384],["T_WHILE","while",385],["T_WHITESPACE"," ",385],"(",["T_VARIABLE","$row",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_VARIABLE","$query",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","fetch",385],"(",")",")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n            ",385],["T_VARIABLE","$salable",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_ISSET","isset",386],"(",["T_VARIABLE","$row",386],"[",["T_CONSTANT_ENCAPSED_STRING","'salable'",386],"]",")",["T_WHITESPACE"," ",386],"?",["T_WHITESPACE"," ",386],["T_VARIABLE","$row",386],"[",["T_CONSTANT_ENCAPSED_STRING","'salable'",386],"]",["T_WHITESPACE"," ",386],":",["T_WHITESPACE"," ",386],["T_STRING","true",386],";",["T_WHITESPACE","\n            ",386],["T_VARIABLE","$website",387],["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],["T_VARIABLE","$row",387],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",387],"]",["T_WHITESPACE"," ",387],">",["T_WHITESPACE"," ",387],["T_LNUMBER","0",387],["T_WHITESPACE"," ",387],"?",["T_WHITESPACE"," ",387],["T_STRING","true",387],["T_WHITESPACE"," ",387],":",["T_WHITESPACE"," ",387],["T_STRING","false",387],";",["T_WHITESPACE","\n            ",387],["T_VARIABLE","$status",388],["T_WHITESPACE","  ",388],"=",["T_WHITESPACE"," ",388],["T_VARIABLE","$row",388],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",388],"]",";",["T_WHITESPACE","\n\n            ",388],["T_VARIABLE","$productsData",390],"[",["T_VARIABLE","$row",390],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",390],"]","]",["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_VARIABLE","$salable",390],["T_WHITESPACE"," ",390],["T_BOOLEAN_AND","&&",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$status",390],["T_WHITESPACE"," ",390],["T_BOOLEAN_AND","&&",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$website",390],";",["T_WHITESPACE","\n        ",390],"}",["T_WHITESPACE","\n\n        ",391],["T_RETURN","return",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$productsData",393],";",["T_WHITESPACE","\n    ",393],"}",["T_WHITESPACE","\n\n    ",394],["T_DOC_COMMENT","\/**\n     * Retrieve Selection Product price from Price Index\n     * Return index key {entity_id}-{website_id}-{customer_group_id}\n     *\n     * @param int|array $productIds\n     * @return array\n     *\/",396],["T_WHITESPACE","\n    ",402],["T_PUBLIC","public",403],["T_WHITESPACE"," ",403],["T_FUNCTION","function",403],["T_WHITESPACE"," ",403],["T_STRING","getProductsPriceFromIndex",403],"(",["T_VARIABLE","$productIds",403],")",["T_WHITESPACE","\n    ",403],"{",["T_WHITESPACE","\n        ",404],["T_VARIABLE","$price",405],["T_WHITESPACE","  ",405],"=",["T_WHITESPACE"," ",405],["T_VARIABLE","$this",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","_getAttribute",405],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",405],")",";",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$read",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_getReadAdapter",406],"(",")",";",["T_WHITESPACE","\n        ",406],["T_VARIABLE","$key",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$read",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getConcatSql",407],"(",["T_ARRAY","array",407],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",407],",",["T_WHITESPACE"," ",407],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",407],",",["T_WHITESPACE"," ",407],["T_CONSTANT_ENCAPSED_STRING","'website_id'",407],")",",",["T_WHITESPACE"," ",407],["T_CONSTANT_ENCAPSED_STRING","'-'",407],")",";",["T_WHITESPACE","\n\n        ",407],["T_VARIABLE","$select",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_VARIABLE","$read",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","select",409],"(",")",["T_WHITESPACE","\n            ",409],["T_OBJECT_OPERATOR","->",410],["T_STRING","from",410],"(",["T_WHITESPACE","\n                ",410],["T_ARRAY","array",411],"(",["T_CONSTANT_ENCAPSED_STRING","'price_index'",411],["T_WHITESPACE"," ",411],["T_DOUBLE_ARROW","=>",411],["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getTable",411],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogindex\/price'",411],")",")",",",["T_WHITESPACE","\n                ",411],["T_ARRAY","array",412],"(",["T_CONSTANT_ENCAPSED_STRING","'index_key'",412],["T_WHITESPACE"," ",412],["T_DOUBLE_ARROW","=>",412],["T_WHITESPACE"," ",412],["T_VARIABLE","$key",412],",",["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","'value'",412],")",["T_WHITESPACE","\n            ",412],")",["T_WHITESPACE","\n            ",413],["T_OBJECT_OPERATOR","->",414],["T_STRING","where",414],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",414],",",["T_WHITESPACE"," ",414],["T_VARIABLE","$productIds",414],")",["T_WHITESPACE","\n            ",414],["T_OBJECT_OPERATOR","->",415],["T_STRING","where",415],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id= :attribute_id'",415],")",";",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$index",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$read",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","fetchPairs",416],"(",["T_VARIABLE","$select",416],",",["T_WHITESPACE"," ",416],["T_ARRAY","array",416],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute_id'",416],["T_WHITESPACE"," ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$price",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getAttributeId",416],"(",")",")",")",";",["T_WHITESPACE","\n        ",416],["T_RETURN","return",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$index",417],";",["T_WHITESPACE","\n    ",417],"}",["T_WHITESPACE","\n\n    ",418],["T_DOC_COMMENT","\/**\n     * Retrieve product(s) price data\n     *\n     * @param int|array $products\n     * @param Mage_Core_Model_Website $website\n     * @return array\n     *\/",420],["T_WHITESPACE","\n    ",426],["T_PUBLIC","public",427],["T_WHITESPACE"," ",427],["T_FUNCTION","function",427],["T_WHITESPACE"," ",427],["T_STRING","getProductsPriceData",427],"(",["T_VARIABLE","$products",427],",",["T_WHITESPACE"," ",427],["T_STRING","Mage_Core_Model_Website",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$website",427],")",["T_WHITESPACE","\n    ",427],"{",["T_WHITESPACE","\n        ",428],["T_VARIABLE","$productsData",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_ARRAY","array",429],"(",")",";",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$read",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","_getReadAdapter",430],"(",")",";",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$select",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$read",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","select",431],"(",")",["T_WHITESPACE","\n            ",431],["T_OBJECT_OPERATOR","->",432],["T_STRING","from",432],"(",["T_ARRAY","array",432],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",432],["T_WHITESPACE"," ",432],["T_DOUBLE_ARROW","=>",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getTable",432],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",432],")",")",",",["T_WHITESPACE"," ",432],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",432],")",["T_WHITESPACE","\n            ",432],["T_OBJECT_OPERATOR","->",433],["T_STRING","where",433],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",433],",",["T_WHITESPACE"," ",433],["T_VARIABLE","$products",433],")",";",["T_WHITESPACE","\n\n        ",433],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","_addAttributeDataToSelect",435],"(",["T_VARIABLE","$select",435],",",["T_WHITESPACE"," ",435],["T_CONSTANT_ENCAPSED_STRING","'price'",435],",",["T_WHITESPACE"," ",435],["T_VARIABLE","$website",435],")",";",["T_WHITESPACE","\n        ",435],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","_addAttributeDataToSelect",436],"(",["T_VARIABLE","$select",436],",",["T_WHITESPACE"," ",436],["T_CONSTANT_ENCAPSED_STRING","'special_price'",436],",",["T_WHITESPACE"," ",436],["T_VARIABLE","$website",436],")",";",["T_WHITESPACE","\n        ",436],["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","_addAttributeDataToSelect",437],"(",["T_VARIABLE","$select",437],",",["T_WHITESPACE"," ",437],["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",437],",",["T_WHITESPACE"," ",437],["T_VARIABLE","$website",437],")",";",["T_WHITESPACE","\n        ",437],["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","_addAttributeDataToSelect",438],"(",["T_VARIABLE","$select",438],",",["T_WHITESPACE"," ",438],["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",438],",",["T_WHITESPACE"," ",438],["T_VARIABLE","$website",438],")",";",["T_WHITESPACE","\n\n        ",438],["T_VARIABLE","$query",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_VARIABLE","$read",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","query",440],"(",["T_VARIABLE","$select",440],")",";",["T_WHITESPACE","\n        ",440],["T_WHILE","while",441],["T_WHITESPACE"," ",441],"(",["T_VARIABLE","$row",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$query",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","fetch",441],"(",")",")",["T_WHITESPACE"," ",441],"{",["T_WHITESPACE","\n            ",441],["T_VARIABLE","$productsData",442],"[",["T_VARIABLE","$row",442],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",442],"]","]",["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_ARRAY","array",442],"(",["T_WHITESPACE","\n                ",442],["T_CONSTANT_ENCAPSED_STRING","'price'",443],["T_WHITESPACE","             ",443],["T_DOUBLE_ARROW","=>",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$row",443],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",443],"]",",",["T_WHITESPACE","\n                ",443],["T_CONSTANT_ENCAPSED_STRING","'special_price'",444],["T_WHITESPACE","     ",444],["T_DOUBLE_ARROW","=>",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$row",444],"[",["T_CONSTANT_ENCAPSED_STRING","'special_price'",444],"]",",",["T_WHITESPACE","\n                ",444],["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",445],["T_WHITESPACE"," ",445],["T_DOUBLE_ARROW","=>",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$row",445],"[",["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",445],"]",",",["T_WHITESPACE","\n                ",445],["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",446],["T_WHITESPACE","   ",446],["T_DOUBLE_ARROW","=>",446],["T_WHITESPACE"," ",446],["T_VARIABLE","$row",446],"[",["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",446],"]",["T_WHITESPACE","\n            ",446],")",";",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE","\n\n        ",448],["T_RETURN","return",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$productsData",450],";",["T_WHITESPACE","\n    ",450],"}",["T_WHITESPACE","\n\n    ",451],["T_DOC_COMMENT","\/**\n     * Add attribute data to select\n     *\n     * @param Varien_Db_Select $select\n     * @param string $attributeCode\n     * @param Mage_Core_Model_Website $website\n     * @return Mage_Bundle_Model_Resource_Price_Index\n     *\/",453],["T_WHITESPACE","\n    ",460],["T_PROTECTED","protected",461],["T_WHITESPACE"," ",461],["T_FUNCTION","function",461],["T_WHITESPACE"," ",461],["T_STRING","_addAttributeDataToSelect",461],"(",["T_STRING","Varien_Db_Select",461],["T_WHITESPACE"," ",461],["T_VARIABLE","$select",461],",",["T_WHITESPACE"," ",461],["T_VARIABLE","$attributeCode",461],",",["T_WHITESPACE","\n        ",461],["T_STRING","Mage_Core_Model_Website",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$website",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$attribute",464],["T_WHITESPACE","  ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_getAttribute",464],"(",["T_VARIABLE","$attributeCode",464],")",";",["T_WHITESPACE","\n        ",464],["T_VARIABLE","$store",465],["T_WHITESPACE","      ",465],"=",["T_WHITESPACE"," ",465],["T_VARIABLE","$website",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","getDefaultStore",465],"(",")",";",["T_WHITESPACE","\n        ",465],["T_IF","if",466],["T_WHITESPACE"," ",466],"(",["T_VARIABLE","$attribute",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","isScopeGlobal",466],"(",")",")",["T_WHITESPACE"," ",466],"{",["T_WHITESPACE","\n            ",466],["T_VARIABLE","$table",467],["T_WHITESPACE"," ",467],"=",["T_WHITESPACE"," ",467],["T_CONSTANT_ENCAPSED_STRING","'t_'",467],["T_WHITESPACE"," ",467],".",["T_WHITESPACE"," ",467],["T_VARIABLE","$attribute",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","getAttributeCode",467],"(",")",";",["T_WHITESPACE","\n            ",467],["T_VARIABLE","$select",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","joinLeft",468],"(",["T_WHITESPACE","\n                ",468],["T_ARRAY","array",469],"(",["T_VARIABLE","$table",469],["T_WHITESPACE"," ",469],["T_DOUBLE_ARROW","=>",469],["T_WHITESPACE"," ",469],["T_VARIABLE","$attribute",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getBackend",469],"(",")",["T_OBJECT_OPERATOR","->",469],["T_STRING","getTable",469],"(",")",")",",",["T_WHITESPACE","\n                ",469],"\"",["T_ENCAPSED_AND_WHITESPACE","e.entity_id=",470],["T_CURLY_OPEN","{",470],["T_VARIABLE","$table",470],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_id",470],"\"",["T_WHITESPACE","\n                ",470],".",["T_WHITESPACE"," ",471],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",471],["T_CURLY_OPEN","{",471],["T_VARIABLE","$table",471],"}",["T_ENCAPSED_AND_WHITESPACE",".attribute_id=",471],["T_CURLY_OPEN","{",471],["T_VARIABLE","$attribute",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getAttributeId",471],"(",")","}","\"",["T_WHITESPACE","\n                ",471],".",["T_WHITESPACE"," ",472],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",472],["T_CURLY_OPEN","{",472],["T_VARIABLE","$table",472],"}",["T_ENCAPSED_AND_WHITESPACE",".store_id=0",472],"\"",",",["T_WHITESPACE","\n                ",472],["T_ARRAY","array",473],"(",["T_VARIABLE","$attribute",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getAttributeCode",473],"(",")",["T_WHITESPACE"," ",473],["T_DOUBLE_ARROW","=>",473],["T_WHITESPACE"," ",473],["T_VARIABLE","$table",473],["T_WHITESPACE"," ",473],".",["T_WHITESPACE"," ",473],["T_CONSTANT_ENCAPSED_STRING","'.value'",473],")",["T_WHITESPACE","\n            ",473],")",";",["T_WHITESPACE","\n        ",474],"}",["T_WHITESPACE"," ",475],["T_ELSE","else",475],["T_WHITESPACE"," ",475],"{",["T_WHITESPACE","\n            ",475],["T_VARIABLE","$tableName",476],["T_WHITESPACE","   ",476],"=",["T_WHITESPACE"," ",476],["T_VARIABLE","$attribute",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getBackend",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","getTable",476],"(",")",";",["T_WHITESPACE","\n            ",476],["T_VARIABLE","$tableGlobal",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_CONSTANT_ENCAPSED_STRING","'t1_'",477],["T_WHITESPACE"," ",477],".",["T_WHITESPACE"," ",477],["T_VARIABLE","$attribute",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getAttributeCode",477],"(",")",";",["T_WHITESPACE","\n            ",477],["T_VARIABLE","$tableStore",478],["T_WHITESPACE","  ",478],"=",["T_WHITESPACE"," ",478],["T_CONSTANT_ENCAPSED_STRING","'t2_'",478],["T_WHITESPACE"," ",478],".",["T_WHITESPACE"," ",478],["T_VARIABLE","$attribute",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getAttributeCode",478],"(",")",";",["T_WHITESPACE","\n\n            ",478],["T_VARIABLE","$attributeCond",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getReadConnection",480],"(",")",["T_OBJECT_OPERATOR","->",480],["T_STRING","getCheckSql",480],"(",["T_WHITESPACE","\n                ",480],["T_VARIABLE","$tableStore",481],["T_WHITESPACE"," ",481],".",["T_WHITESPACE"," ",481],["T_CONSTANT_ENCAPSED_STRING","'.value_id > 0'",481],",",["T_WHITESPACE","\n                ",481],["T_VARIABLE","$tableStore",482],["T_WHITESPACE"," ",482],".",["T_WHITESPACE"," ",482],["T_CONSTANT_ENCAPSED_STRING","'.value'",482],",",["T_WHITESPACE","\n                ",482],["T_VARIABLE","$tableGlobal",483],["T_WHITESPACE"," ",483],".",["T_WHITESPACE"," ",483],["T_CONSTANT_ENCAPSED_STRING","'.value'",483],["T_WHITESPACE","\n            ",483],")",";",["T_WHITESPACE","\n            ",484],["T_VARIABLE","$select",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","joinLeft",485],"(",["T_WHITESPACE","\n                ",485],["T_ARRAY","array",486],"(",["T_VARIABLE","$tableGlobal",486],["T_WHITESPACE"," ",486],["T_DOUBLE_ARROW","=>",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$tableName",486],")",",",["T_WHITESPACE","\n                ",486],"\"",["T_ENCAPSED_AND_WHITESPACE","e.entity_id = ",487],["T_CURLY_OPEN","{",487],["T_VARIABLE","$tableGlobal",487],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_id",487],"\"",["T_WHITESPACE","\n                ",487],".",["T_WHITESPACE"," ",488],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",488],["T_CURLY_OPEN","{",488],["T_VARIABLE","$tableGlobal",488],"}",["T_ENCAPSED_AND_WHITESPACE",".attribute_id = ",488],["T_CURLY_OPEN","{",488],["T_VARIABLE","$attribute",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getAttributeId",488],"(",")","}","\"",["T_WHITESPACE","\n                ",488],".",["T_WHITESPACE"," ",489],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",489],["T_CURLY_OPEN","{",489],["T_VARIABLE","$tableGlobal",489],"}",["T_ENCAPSED_AND_WHITESPACE",".store_id = 0",489],"\"",",",["T_WHITESPACE","\n                ",489],["T_ARRAY","array",490],"(",["T_VARIABLE","$attribute",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","getAttributeCode",490],"(",")",["T_WHITESPACE"," ",490],["T_DOUBLE_ARROW","=>",490],["T_WHITESPACE"," ",490],["T_VARIABLE","$attributeCond",490],")",["T_WHITESPACE","\n            ",490],")",["T_WHITESPACE","\n            ",491],["T_OBJECT_OPERATOR","->",492],["T_STRING","joinLeft",492],"(",["T_WHITESPACE","\n                ",492],["T_ARRAY","array",493],"(",["T_VARIABLE","$tableStore",493],["T_WHITESPACE"," ",493],["T_DOUBLE_ARROW","=>",493],["T_WHITESPACE"," ",493],["T_VARIABLE","$tableName",493],")",",",["T_WHITESPACE","\n                ",493],"\"",["T_CURLY_OPEN","{",494],["T_VARIABLE","$tableGlobal",494],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_id = ",494],["T_CURLY_OPEN","{",494],["T_VARIABLE","$tableStore",494],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_id",494],"\"",["T_WHITESPACE","\n                ",494],".",["T_WHITESPACE"," ",495],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",495],["T_CURLY_OPEN","{",495],["T_VARIABLE","$tableGlobal",495],"}",["T_ENCAPSED_AND_WHITESPACE",".attribute_id = ",495],["T_CURLY_OPEN","{",495],["T_VARIABLE","$tableStore",495],"}",["T_ENCAPSED_AND_WHITESPACE",".attribute_id",495],"\"",["T_WHITESPACE","\n                ",495],".",["T_WHITESPACE"," ",496],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND ",496],["T_CURLY_OPEN","{",496],["T_VARIABLE","$tableStore",496],"}",["T_ENCAPSED_AND_WHITESPACE",".store_id = ",496],"\"",["T_WHITESPACE"," ",496],".",["T_WHITESPACE"," ",496],["T_VARIABLE","$store",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getId",496],"(",")",",",["T_WHITESPACE","\n                ",496],["T_ARRAY","array",497],"(",")",["T_WHITESPACE","\n            ",497],")",";",["T_WHITESPACE","\n        ",498],"}",["T_WHITESPACE","\n        ",499],["T_RETURN","return",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$this",500],";",["T_WHITESPACE","\n    ",500],"}",["T_WHITESPACE","\n\n    ",501],["T_DOC_COMMENT","\/**\n     * Retrieve fixed bundle base price (with special price and rules)\n     *\n     * @param int $productId\n     * @param array $priceData\n     * @param Mage_Core_Model_Website $website\n     * @param Mage_Customer_Model_Group $customerGroup\n     * @return float\n     *\/",503],["T_WHITESPACE","\n    ",511],["T_PROTECTED","protected",512],["T_WHITESPACE"," ",512],["T_FUNCTION","function",512],["T_WHITESPACE"," ",512],["T_STRING","_getBasePrice",512],"(",["T_VARIABLE","$productId",512],",",["T_WHITESPACE"," ",512],["T_ARRAY","array",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$priceData",512],",",["T_WHITESPACE"," ",512],["T_VARIABLE","$website",512],",",["T_WHITESPACE"," ",512],["T_VARIABLE","$customerGroup",512],")",["T_WHITESPACE","\n    ",512],"{",["T_WHITESPACE","\n        ",513],["T_VARIABLE","$store",514],["T_WHITESPACE","          ",514],"=",["T_WHITESPACE"," ",514],["T_VARIABLE","$website",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","getDefaultStore",514],"(",")",";",["T_WHITESPACE","\n        ",514],["T_VARIABLE","$storeTimeStamp",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_STRING","Mage",515],["T_DOUBLE_COLON","::",515],["T_STRING","app",515],"(",")",["T_OBJECT_OPERATOR","->",515],["T_STRING","getLocale",515],"(",")",["T_OBJECT_OPERATOR","->",515],["T_STRING","storeTimeStamp",515],"(",["T_VARIABLE","$store",515],")",";",["T_WHITESPACE","\n        ",515],["T_VARIABLE","$finalPrice",516],["T_WHITESPACE","     ",516],"=",["T_WHITESPACE"," ",516],["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","_calculateSpecialPrice",516],"(",["T_VARIABLE","$priceData",516],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",516],"]",",",["T_WHITESPACE"," ",516],["T_VARIABLE","$priceData",516],",",["T_WHITESPACE"," ",516],["T_VARIABLE","$website",516],")",";",["T_WHITESPACE","\n\n        ",516],["T_VARIABLE","$rulePrice",518],["T_WHITESPACE"," ",518],"=",["T_WHITESPACE"," ",518],["T_STRING","Mage",518],["T_DOUBLE_COLON","::",518],["T_STRING","getResourceModel",518],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",518],")",["T_WHITESPACE","\n            ",518],["T_OBJECT_OPERATOR","->",519],["T_STRING","getRulePrice",519],"(",["T_VARIABLE","$storeTimeStamp",519],",",["T_WHITESPACE"," ",519],["T_VARIABLE","$website",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getId",519],"(",")",",",["T_WHITESPACE"," ",519],["T_VARIABLE","$customerGroup",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getId",519],"(",")",",",["T_WHITESPACE"," ",519],["T_VARIABLE","$productId",519],")",";",["T_WHITESPACE","\n\n        ",519],["T_IF","if",521],["T_WHITESPACE"," ",521],"(",["T_VARIABLE","$rulePrice",521],["T_WHITESPACE"," ",521],["T_IS_NOT_IDENTICAL","!==",521],["T_WHITESPACE"," ",521],["T_STRING","null",521],["T_WHITESPACE"," ",521],["T_BOOLEAN_AND","&&",521],["T_WHITESPACE"," ",521],["T_VARIABLE","$rulePrice",521],["T_WHITESPACE"," ",521],["T_IS_NOT_IDENTICAL","!==",521],["T_WHITESPACE"," ",521],["T_STRING","false",521],")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$finalPrice",522],["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_STRING","min",522],"(",["T_VARIABLE","$finalPrice",522],",",["T_WHITESPACE"," ",522],["T_VARIABLE","$rulePrice",522],")",";",["T_WHITESPACE","\n        ",522],"}",["T_WHITESPACE","\n\n        ",523],["T_RETURN","return",525],["T_WHITESPACE"," ",525],["T_VARIABLE","$finalPrice",525],";",["T_WHITESPACE","\n    ",525],"}",["T_WHITESPACE","\n\n    ",526],["T_DOC_COMMENT","\/**\n     * Retrieve custom options for product\n     *\n     * @param int $productId\n     * @param Mage_Core_Model_Website $website\n     * @return array\n     *\/",528],["T_WHITESPACE","\n    ",534],["T_PUBLIC","public",535],["T_WHITESPACE"," ",535],["T_FUNCTION","function",535],["T_WHITESPACE"," ",535],["T_STRING","getCustomOptions",535],"(",["T_VARIABLE","$productId",535],",",["T_WHITESPACE"," ",535],["T_STRING","Mage_Core_Model_Website",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$website",535],")",["T_WHITESPACE","\n    ",535],"{",["T_WHITESPACE","\n        ",536],["T_VARIABLE","$options",537],["T_WHITESPACE"," ",537],"=",["T_WHITESPACE"," ",537],["T_ARRAY","array",537],"(",")",";",["T_WHITESPACE","\n        ",537],["T_VARIABLE","$store",538],["T_WHITESPACE","   ",538],"=",["T_WHITESPACE"," ",538],["T_VARIABLE","$website",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getDefaultStore",538],"(",")",";",["T_WHITESPACE","\n        ",538],["T_VARIABLE","$price",539],["T_WHITESPACE","   ",539],"=",["T_WHITESPACE"," ",539],["T_VARIABLE","$this",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","_getAttribute",539],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",539],")",";",["T_WHITESPACE","\n        ",539],["T_VARIABLE","$adapter",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","_getReadAdapter",540],"(",")",";",["T_WHITESPACE","\n\n        ",540],["T_VARIABLE","$bind",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_ARRAY","array",542],"(",["T_WHITESPACE","\n            ",542],["T_CONSTANT_ENCAPSED_STRING","':product_id'",543],["T_WHITESPACE"," ",543],["T_DOUBLE_ARROW","=>",543],["T_WHITESPACE"," ",543],["T_VARIABLE","$productId",543],",",["T_WHITESPACE","\n            ",543],["T_CONSTANT_ENCAPSED_STRING","':store_id'",544],["T_WHITESPACE","   ",544],["T_DOUBLE_ARROW","=>",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$store",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getId",544],"(",")",",",["T_WHITESPACE","\n\n        ",544],")",";",["T_WHITESPACE","\n        ",546],["T_VARIABLE","$select",547],["T_WHITESPACE"," ",547],"=",["T_WHITESPACE"," ",547],["T_VARIABLE","$adapter",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","select",547],"(",")",["T_WHITESPACE","\n            ",547],["T_OBJECT_OPERATOR","->",548],["T_STRING","from",548],"(",["T_WHITESPACE","\n                ",548],["T_ARRAY","array",549],"(",["T_CONSTANT_ENCAPSED_STRING","'option_table'",549],["T_WHITESPACE"," ",549],["T_DOUBLE_ARROW","=>",549],["T_WHITESPACE"," ",549],["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getTable",549],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",549],")",")",",",["T_WHITESPACE","\n                ",549],["T_ARRAY","array",550],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",550],",",["T_WHITESPACE"," ",550],["T_CONSTANT_ENCAPSED_STRING","'is_require'",550],",",["T_WHITESPACE"," ",550],["T_CONSTANT_ENCAPSED_STRING","'type'",550],")",["T_WHITESPACE","\n            ",550],")",["T_WHITESPACE","\n            ",551],["T_OBJECT_OPERATOR","->",552],["T_STRING","where",552],"(",["T_CONSTANT_ENCAPSED_STRING","'option_table.product_id=:product_id'",552],")",";",["T_WHITESPACE","\n\n        ",552],["T_IF","if",554],["T_WHITESPACE"," ",554],"(",["T_VARIABLE","$price",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","isScopeGlobal",554],"(",")",")",["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n            ",554],["T_VARIABLE","$select",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","join",555],"(",["T_WHITESPACE","\n                ",555],["T_ARRAY","array",556],"(",["T_CONSTANT_ENCAPSED_STRING","'price_table'",556],["T_WHITESPACE"," ",556],["T_DOUBLE_ARROW","=>",556],["T_WHITESPACE"," ",556],["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","getTable",556],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_price'",556],")",")",",",["T_WHITESPACE","\n                ",556],["T_CONSTANT_ENCAPSED_STRING","'option_table.option_id = price_table.option_id'",557],["T_WHITESPACE"," ",557],".",["T_WHITESPACE","\n                ",557],["T_CONSTANT_ENCAPSED_STRING","' AND price_table.store_id = 0'",558],",",["T_WHITESPACE","\n                ",558],["T_ARRAY","array",559],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id'",559],["T_WHITESPACE"," ",559],["T_DOUBLE_ARROW","=>",559],["T_WHITESPACE"," ",559],["T_CONSTANT_ENCAPSED_STRING","'option_price_id'",559],",",["T_WHITESPACE"," ",559],["T_CONSTANT_ENCAPSED_STRING","'price'",559],",",["T_WHITESPACE"," ",559],["T_CONSTANT_ENCAPSED_STRING","'price_type'",559],")",["T_WHITESPACE","\n            ",559],")",";",["T_WHITESPACE","\n        ",560],"}",["T_WHITESPACE"," ",561],["T_ELSE","else",561],["T_WHITESPACE"," ",561],"{",["T_WHITESPACE","\n            ",561],["T_VARIABLE","$valueIdCond",562],["T_WHITESPACE"," ",562],"=",["T_WHITESPACE"," ",562],["T_VARIABLE","$adapter",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","getCheckSql",562],"(",["T_WHITESPACE","\n                ",562],["T_CONSTANT_ENCAPSED_STRING","'price_store_table.option_price_id IS NOT NULL'",563],",",["T_WHITESPACE","\n                ",563],["T_CONSTANT_ENCAPSED_STRING","'price_store_table.option_price_id'",564],",",["T_WHITESPACE","\n                ",564],["T_CONSTANT_ENCAPSED_STRING","'price_global_table.option_price_id'",565],["T_WHITESPACE","\n            ",565],")",";",["T_WHITESPACE","\n            ",566],["T_VARIABLE","$priceCond",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$adapter",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getCheckSql",567],"(",["T_WHITESPACE","\n                ",567],["T_CONSTANT_ENCAPSED_STRING","'price_store_table.price IS NOT NULL'",568],",",["T_WHITESPACE","\n                ",568],["T_CONSTANT_ENCAPSED_STRING","'price_store_table.price'",569],",",["T_WHITESPACE","\n                ",569],["T_CONSTANT_ENCAPSED_STRING","'price_global_table.price'",570],["T_WHITESPACE","\n            ",570],")",";",["T_WHITESPACE","\n            ",571],["T_VARIABLE","$priceTypeCond",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$adapter",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","getCheckSql",572],"(",["T_WHITESPACE","\n                ",572],["T_CONSTANT_ENCAPSED_STRING","'price_store_table.price_type IS NOT NULL'",573],",",["T_WHITESPACE","\n                ",573],["T_CONSTANT_ENCAPSED_STRING","'price_store_table.price_type'",574],",",["T_WHITESPACE","\n                ",574],["T_CONSTANT_ENCAPSED_STRING","'price_global_table.price_type'",575],["T_WHITESPACE","\n            ",575],")",";",["T_WHITESPACE","\n\n            ",576],["T_VARIABLE","$select",578],["T_WHITESPACE","\n                ",578],["T_OBJECT_OPERATOR","->",579],["T_STRING","join",579],"(",["T_WHITESPACE","\n                    ",579],["T_ARRAY","array",580],"(",["T_CONSTANT_ENCAPSED_STRING","'price_global_table'",580],["T_WHITESPACE"," ",580],["T_DOUBLE_ARROW","=>",580],["T_WHITESPACE"," ",580],["T_VARIABLE","$this",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getTable",580],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_price'",580],")",")",",",["T_WHITESPACE","\n                    ",580],["T_CONSTANT_ENCAPSED_STRING","'option_table.option_id=price_global_table.option_id'",581],["T_WHITESPACE"," ",581],".",["T_WHITESPACE","\n                    ",581],["T_CONSTANT_ENCAPSED_STRING","' AND price_global_table.store_id=0'",582],",",["T_WHITESPACE","\n                    ",582],["T_ARRAY","array",583],"(",["T_WHITESPACE","\n                        ",583],["T_CONSTANT_ENCAPSED_STRING","'value_id'",584],["T_WHITESPACE","   ",584],["T_DOUBLE_ARROW","=>",584],["T_WHITESPACE"," ",584],["T_VARIABLE","$valueIdCond",584],",",["T_WHITESPACE","\n                        ",584],["T_CONSTANT_ENCAPSED_STRING","'price'",585],["T_WHITESPACE","      ",585],["T_DOUBLE_ARROW","=>",585],["T_WHITESPACE"," ",585],["T_VARIABLE","$priceCond",585],",",["T_WHITESPACE","\n                        ",585],["T_CONSTANT_ENCAPSED_STRING","'price_type'",586],["T_WHITESPACE"," ",586],["T_DOUBLE_ARROW","=>",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$priceTypeCond",586],["T_WHITESPACE","\n                    ",586],")",")",["T_WHITESPACE","\n                ",587],["T_OBJECT_OPERATOR","->",588],["T_STRING","joinLeft",588],"(",["T_WHITESPACE","\n                    ",588],["T_ARRAY","array",589],"(",["T_CONSTANT_ENCAPSED_STRING","'price_store_table'",589],["T_WHITESPACE"," ",589],["T_DOUBLE_ARROW","=>",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$this",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getTable",589],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_price'",589],")",")",",",["T_WHITESPACE","\n                    ",589],["T_CONSTANT_ENCAPSED_STRING","'option_table.option_id = price_store_table.option_id'",590],["T_WHITESPACE"," ",590],".",["T_WHITESPACE","\n                    ",590],["T_CONSTANT_ENCAPSED_STRING","' AND price_store_table.store_id=:store_id'",591],",",["T_WHITESPACE","\n                    ",591],["T_ARRAY","array",592],"(",")",["T_WHITESPACE","\n                ",592],")",";",["T_WHITESPACE","\n        ",593],"}",["T_WHITESPACE","\n\n        ",594],["T_VARIABLE","$query",596],["T_WHITESPACE"," ",596],"=",["T_WHITESPACE"," ",596],["T_VARIABLE","$adapter",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","query",596],"(",["T_VARIABLE","$select",596],",",["T_WHITESPACE"," ",596],["T_VARIABLE","$bind",596],")",";",["T_WHITESPACE","\n        ",596],["T_WHILE","while",597],["T_WHITESPACE"," ",597],"(",["T_VARIABLE","$row",597],["T_WHITESPACE"," ",597],"=",["T_WHITESPACE"," ",597],["T_VARIABLE","$query",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","fetch",597],"(",")",")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n            ",597],["T_IF","if",598],["T_WHITESPACE"," ",598],"(","!",["T_ISSET","isset",598],"(",["T_VARIABLE","$options",598],"[",["T_VARIABLE","$row",598],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",598],"]","]",")",")",["T_WHITESPACE"," ",598],"{",["T_WHITESPACE","\n                ",598],["T_VARIABLE","$options",599],"[",["T_VARIABLE","$row",599],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",599],"]","]",["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_ARRAY","array",599],"(",["T_WHITESPACE","\n                    ",599],["T_CONSTANT_ENCAPSED_STRING","'option_id'",600],["T_WHITESPACE","     ",600],["T_DOUBLE_ARROW","=>",600],["T_WHITESPACE"," ",600],["T_VARIABLE","$row",600],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",600],"]",",",["T_WHITESPACE","\n                    ",600],["T_CONSTANT_ENCAPSED_STRING","'is_require'",601],["T_WHITESPACE","    ",601],["T_DOUBLE_ARROW","=>",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$row",601],"[",["T_CONSTANT_ENCAPSED_STRING","'is_require'",601],"]",",",["T_WHITESPACE","\n                    ",601],["T_CONSTANT_ENCAPSED_STRING","'type'",602],["T_WHITESPACE","          ",602],["T_DOUBLE_ARROW","=>",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$row",602],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",602],"]",",",["T_WHITESPACE","\n                    ",602],["T_CONSTANT_ENCAPSED_STRING","'values'",603],["T_WHITESPACE","        ",603],["T_DOUBLE_ARROW","=>",603],["T_WHITESPACE"," ",603],["T_ARRAY","array",603],"(",")",["T_WHITESPACE","\n                ",603],")",";",["T_WHITESPACE","\n            ",604],"}",["T_WHITESPACE","\n            ",605],["T_VARIABLE","$options",606],"[",["T_VARIABLE","$row",606],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",606],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'values'",606],"]","[",["T_VARIABLE","$row",606],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",606],"]","]",["T_WHITESPACE"," ",606],"=",["T_WHITESPACE"," ",606],["T_ARRAY","array",606],"(",["T_WHITESPACE","\n                ",606],["T_CONSTANT_ENCAPSED_STRING","'price_type'",607],["T_WHITESPACE","        ",607],["T_DOUBLE_ARROW","=>",607],["T_WHITESPACE"," ",607],["T_VARIABLE","$row",607],"[",["T_CONSTANT_ENCAPSED_STRING","'price_type'",607],"]",",",["T_WHITESPACE","\n                ",607],["T_CONSTANT_ENCAPSED_STRING","'price_value'",608],["T_WHITESPACE","       ",608],["T_DOUBLE_ARROW","=>",608],["T_WHITESPACE"," ",608],["T_VARIABLE","$row",608],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",608],"]",["T_WHITESPACE","\n            ",608],")",";",["T_WHITESPACE","\n        ",609],"}",["T_WHITESPACE","\n\n        ",610],["T_VARIABLE","$select",612],["T_WHITESPACE"," ",612],"=",["T_WHITESPACE"," ",612],["T_VARIABLE","$adapter",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","select",612],"(",")",["T_WHITESPACE","\n            ",612],["T_OBJECT_OPERATOR","->",613],["T_STRING","from",613],"(",["T_WHITESPACE","\n                ",613],["T_ARRAY","array",614],"(",["T_CONSTANT_ENCAPSED_STRING","'option_table'",614],["T_WHITESPACE"," ",614],["T_DOUBLE_ARROW","=>",614],["T_WHITESPACE"," ",614],["T_VARIABLE","$this",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","getTable",614],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",614],")",")",",",["T_WHITESPACE","\n                ",614],["T_ARRAY","array",615],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",615],",",["T_WHITESPACE"," ",615],["T_CONSTANT_ENCAPSED_STRING","'is_require'",615],",",["T_WHITESPACE"," ",615],["T_CONSTANT_ENCAPSED_STRING","'type'",615],")",["T_WHITESPACE","\n            ",615],")",["T_WHITESPACE","\n            ",616],["T_OBJECT_OPERATOR","->",617],["T_STRING","join",617],"(",["T_WHITESPACE","\n                ",617],["T_ARRAY","array",618],"(",["T_CONSTANT_ENCAPSED_STRING","'type_table'",618],["T_WHITESPACE"," ",618],["T_DOUBLE_ARROW","=>",618],["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getTable",618],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_value'",618],")",")",",",["T_WHITESPACE","\n                ",618],["T_CONSTANT_ENCAPSED_STRING","'option_table.option_id=type_table.option_id'",619],",",["T_WHITESPACE","\n                ",619],["T_ARRAY","array",620],"(",")",["T_WHITESPACE","\n            ",620],")",["T_WHITESPACE","\n            ",621],["T_OBJECT_OPERATOR","->",622],["T_STRING","where",622],"(",["T_CONSTANT_ENCAPSED_STRING","'option_table.product_id=:product_id'",622],")",";",["T_WHITESPACE","\n\n        ",622],["T_IF","if",624],["T_WHITESPACE"," ",624],"(",["T_VARIABLE","$price",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","isScopeGlobal",624],"(",")",")",["T_WHITESPACE"," ",624],"{",["T_WHITESPACE","\n            ",624],["T_VARIABLE","$select",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","join",625],"(",["T_WHITESPACE","\n                ",625],["T_ARRAY","array",626],"(",["T_CONSTANT_ENCAPSED_STRING","'price_table'",626],["T_WHITESPACE"," ",626],["T_DOUBLE_ARROW","=>",626],["T_WHITESPACE"," ",626],["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getTable",626],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_price'",626],")",")",",",["T_WHITESPACE","\n                ",626],["T_CONSTANT_ENCAPSED_STRING","'type_table.option_type_id=price_table.option_type_id'",627],["T_WHITESPACE"," ",627],".",["T_WHITESPACE","\n                ",627],["T_CONSTANT_ENCAPSED_STRING","' AND price_table.store_id=0'",628],",",["T_WHITESPACE","\n                ",628],["T_ARRAY","array",629],"(",["T_CONSTANT_ENCAPSED_STRING","'value_id'",629],["T_WHITESPACE"," ",629],["T_DOUBLE_ARROW","=>",629],["T_WHITESPACE"," ",629],["T_CONSTANT_ENCAPSED_STRING","'option_type_id'",629],",",["T_WHITESPACE"," ",629],["T_CONSTANT_ENCAPSED_STRING","'price'",629],",",["T_WHITESPACE"," ",629],["T_CONSTANT_ENCAPSED_STRING","'price_type'",629],")",["T_WHITESPACE","\n            ",629],")",";",["T_WHITESPACE","\n        ",630],"}",["T_WHITESPACE"," ",631],["T_ELSE","else",631],["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n            ",631],["T_VARIABLE","$select",632],["T_WHITESPACE","\n                ",632],["T_OBJECT_OPERATOR","->",633],["T_STRING","join",633],"(",["T_WHITESPACE","\n                    ",633],["T_ARRAY","array",634],"(",["T_CONSTANT_ENCAPSED_STRING","'price_global_table'",634],["T_WHITESPACE"," ",634],["T_DOUBLE_ARROW","=>",634],["T_WHITESPACE"," ",634],["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","getTable",634],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_price'",634],")",")",",",["T_WHITESPACE","\n                    ",634],["T_CONSTANT_ENCAPSED_STRING","'type_table.option_type_id=price_global_table.option_type_id'",635],["T_WHITESPACE"," ",635],".",["T_WHITESPACE","\n                    ",635],["T_CONSTANT_ENCAPSED_STRING","' AND price_global_table.store_id=0'",636],",",["T_WHITESPACE","\n                    ",636],["T_ARRAY","array",637],"(",["T_WHITESPACE","\n                        ",637],["T_CONSTANT_ENCAPSED_STRING","'value_id'",638],["T_WHITESPACE","   ",638],["T_DOUBLE_ARROW","=>",638],["T_WHITESPACE"," ",638],["T_VARIABLE","$valueIdCond",638],",",["T_WHITESPACE","\n                        ",638],["T_CONSTANT_ENCAPSED_STRING","'price'",639],["T_WHITESPACE","      ",639],["T_DOUBLE_ARROW","=>",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$priceCond",639],",",["T_WHITESPACE","\n                        ",639],["T_CONSTANT_ENCAPSED_STRING","'price_type'",640],["T_WHITESPACE"," ",640],["T_DOUBLE_ARROW","=>",640],["T_WHITESPACE"," ",640],["T_VARIABLE","$priceTypeCond",640],["T_WHITESPACE","\n                    ",640],")",["T_WHITESPACE","\n                ",641],")",["T_WHITESPACE","\n                ",642],["T_OBJECT_OPERATOR","->",643],["T_STRING","joinLeft",643],"(",["T_WHITESPACE","\n                    ",643],["T_ARRAY","array",644],"(",["T_CONSTANT_ENCAPSED_STRING","'price_store_table'",644],["T_WHITESPACE"," ",644],["T_DOUBLE_ARROW","=>",644],["T_WHITESPACE"," ",644],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getTable",644],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_price'",644],")",")",",",["T_WHITESPACE","\n                    ",644],["T_CONSTANT_ENCAPSED_STRING","'type_table.option_type_id=price_store_table.option_type_id'",645],["T_WHITESPACE"," ",645],".",["T_WHITESPACE","\n                    ",645],["T_CONSTANT_ENCAPSED_STRING","' AND price_store_table.store_id=:store_id'",646],",",["T_WHITESPACE","\n                    ",646],["T_ARRAY","array",647],"(",")",["T_WHITESPACE","\n                ",647],")",";",["T_WHITESPACE","\n        ",648],"}",["T_WHITESPACE","\n\n        ",649],["T_VARIABLE","$query",651],["T_WHITESPACE"," ",651],"=",["T_WHITESPACE"," ",651],["T_VARIABLE","$adapter",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","query",651],"(",["T_VARIABLE","$select",651],",",["T_WHITESPACE"," ",651],["T_VARIABLE","$bind",651],")",";",["T_WHITESPACE","\n        ",651],["T_WHILE","while",652],["T_WHITESPACE"," ",652],"(",["T_VARIABLE","$row",652],["T_WHITESPACE"," ",652],"=",["T_WHITESPACE"," ",652],["T_VARIABLE","$query",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","fetch",652],"(",")",")",["T_WHITESPACE"," ",652],"{",["T_WHITESPACE","\n            ",652],["T_IF","if",653],["T_WHITESPACE"," ",653],"(","!",["T_ISSET","isset",653],"(",["T_VARIABLE","$options",653],"[",["T_VARIABLE","$row",653],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",653],"]","]",")",")",["T_WHITESPACE"," ",653],"{",["T_WHITESPACE","\n                ",653],["T_VARIABLE","$options",654],"[",["T_VARIABLE","$row",654],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",654],"]","]",["T_WHITESPACE"," ",654],"=",["T_WHITESPACE"," ",654],["T_ARRAY","array",654],"(",["T_WHITESPACE","\n                    ",654],["T_CONSTANT_ENCAPSED_STRING","'option_id'",655],["T_WHITESPACE","     ",655],["T_DOUBLE_ARROW","=>",655],["T_WHITESPACE"," ",655],["T_VARIABLE","$row",655],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",655],"]",",",["T_WHITESPACE","\n                    ",655],["T_CONSTANT_ENCAPSED_STRING","'is_require'",656],["T_WHITESPACE","    ",656],["T_DOUBLE_ARROW","=>",656],["T_WHITESPACE"," ",656],["T_VARIABLE","$row",656],"[",["T_CONSTANT_ENCAPSED_STRING","'is_require'",656],"]",",",["T_WHITESPACE","\n                    ",656],["T_CONSTANT_ENCAPSED_STRING","'type'",657],["T_WHITESPACE","          ",657],["T_DOUBLE_ARROW","=>",657],["T_WHITESPACE"," ",657],["T_VARIABLE","$row",657],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",657],"]",",",["T_WHITESPACE","\n                    ",657],["T_CONSTANT_ENCAPSED_STRING","'values'",658],["T_WHITESPACE","        ",658],["T_DOUBLE_ARROW","=>",658],["T_WHITESPACE"," ",658],["T_ARRAY","array",658],"(",")",["T_WHITESPACE","\n                ",658],")",";",["T_WHITESPACE","\n            ",659],"}",["T_WHITESPACE","\n            ",660],["T_VARIABLE","$options",661],"[",["T_VARIABLE","$row",661],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",661],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'values'",661],"]","[",["T_VARIABLE","$row",661],"[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",661],"]","]",["T_WHITESPACE"," ",661],"=",["T_WHITESPACE"," ",661],["T_ARRAY","array",661],"(",["T_WHITESPACE","\n                ",661],["T_CONSTANT_ENCAPSED_STRING","'price_type'",662],["T_WHITESPACE","        ",662],["T_DOUBLE_ARROW","=>",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$row",662],"[",["T_CONSTANT_ENCAPSED_STRING","'price_type'",662],"]",",",["T_WHITESPACE","\n                ",662],["T_CONSTANT_ENCAPSED_STRING","'price_value'",663],["T_WHITESPACE","       ",663],["T_DOUBLE_ARROW","=>",663],["T_WHITESPACE"," ",663],["T_VARIABLE","$row",663],"[",["T_CONSTANT_ENCAPSED_STRING","'price'",663],"]",["T_WHITESPACE","\n            ",663],")",";",["T_WHITESPACE","\n        ",664],"}",["T_WHITESPACE","\n\n        ",665],["T_RETURN","return",667],["T_WHITESPACE"," ",667],["T_VARIABLE","$options",667],";",["T_WHITESPACE","\n    ",667],"}",["T_WHITESPACE","\n\n    ",668],["T_DOC_COMMENT","\/**\n     * Calculate custom options price\n     * Return array with indexes(0 -> min_price, 1 -> max_price)\n     *\n     * @param array $options\n     * @param float $basePrice\n     * @param float $minPrice\n     * @param float $maxPrice\n     * @return array\n     *\/",670],["T_WHITESPACE","\n    ",679],["T_PUBLIC","public",680],["T_WHITESPACE"," ",680],["T_FUNCTION","function",680],["T_WHITESPACE"," ",680],["T_STRING","_calculateCustomOptions",680],"(",["T_ARRAY","array",680],["T_WHITESPACE"," ",680],["T_VARIABLE","$options",680],",",["T_WHITESPACE"," ",680],["T_VARIABLE","$basePrice",680],",",["T_WHITESPACE"," ",680],["T_VARIABLE","$minPrice",680],",",["T_WHITESPACE"," ",680],["T_VARIABLE","$maxPrice",680],")",["T_WHITESPACE","\n    ",680],"{",["T_WHITESPACE","\n        ",681],["T_FOREACH","foreach",682],["T_WHITESPACE"," ",682],"(",["T_VARIABLE","$options",682],["T_WHITESPACE"," ",682],["T_AS","as",682],["T_WHITESPACE"," ",682],["T_VARIABLE","$option",682],")",["T_WHITESPACE"," ",682],"{",["T_WHITESPACE","\n            ",682],["T_VARIABLE","$optionPrices",683],["T_WHITESPACE"," ",683],"=",["T_WHITESPACE"," ",683],["T_ARRAY","array",683],"(",")",";",["T_WHITESPACE","\n            ",683],["T_FOREACH","foreach",684],["T_WHITESPACE"," ",684],"(",["T_VARIABLE","$option",684],"[",["T_CONSTANT_ENCAPSED_STRING","'values'",684],"]",["T_WHITESPACE"," ",684],["T_AS","as",684],["T_WHITESPACE"," ",684],["T_VARIABLE","$value",684],")",["T_WHITESPACE"," ",684],"{",["T_WHITESPACE","\n                ",684],["T_IF","if",685],["T_WHITESPACE"," ",685],"(",["T_VARIABLE","$value",685],"[",["T_CONSTANT_ENCAPSED_STRING","'price_type'",685],"]",["T_WHITESPACE"," ",685],["T_IS_EQUAL","==",685],["T_WHITESPACE"," ",685],["T_CONSTANT_ENCAPSED_STRING","'percent'",685],")",["T_WHITESPACE"," ",685],"{",["T_WHITESPACE","\n                    ",685],["T_VARIABLE","$valuePrice",686],["T_WHITESPACE"," ",686],"=",["T_WHITESPACE"," ",686],["T_VARIABLE","$basePrice",686],["T_WHITESPACE"," ",686],"*",["T_WHITESPACE"," ",686],["T_VARIABLE","$value",686],"[",["T_CONSTANT_ENCAPSED_STRING","'price_value'",686],"]",["T_WHITESPACE"," ",686],"\/",["T_WHITESPACE"," ",686],["T_LNUMBER","100",686],";",["T_WHITESPACE","\n                ",686],"}",["T_WHITESPACE"," ",687],["T_ELSE","else",687],["T_WHITESPACE"," ",687],"{",["T_WHITESPACE","\n                    ",687],["T_VARIABLE","$valuePrice",688],["T_WHITESPACE"," ",688],"=",["T_WHITESPACE"," ",688],["T_VARIABLE","$value",688],"[",["T_CONSTANT_ENCAPSED_STRING","'price_value'",688],"]",";",["T_WHITESPACE","\n                ",688],"}",["T_WHITESPACE","\n                ",689],["T_VARIABLE","$optionPrices",690],"[","]",["T_WHITESPACE"," ",690],"=",["T_WHITESPACE"," ",690],["T_VARIABLE","$valuePrice",690],";",["T_WHITESPACE","\n            ",690],"}",["T_WHITESPACE","\n            ",691],["T_IF","if",692],["T_WHITESPACE"," ",692],"(",["T_VARIABLE","$option",692],"[",["T_CONSTANT_ENCAPSED_STRING","'is_require'",692],"]",")",["T_WHITESPACE"," ",692],"{",["T_WHITESPACE","\n                ",692],["T_VARIABLE","$minPrice",693],["T_WHITESPACE"," ",693],["T_PLUS_EQUAL","+=",693],["T_WHITESPACE"," ",693],["T_STRING","min",693],"(",["T_VARIABLE","$optionPrices",693],")",";",["T_WHITESPACE","\n            ",693],"}",["T_WHITESPACE","\n            ",694],["T_VARIABLE","$multiTypes",695],["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_ARRAY","array",695],"(",["T_WHITESPACE","\n                ",695],["T_STRING","Mage_Catalog_Model_Product_Option",696],["T_DOUBLE_COLON","::",696],["T_STRING","OPTION_TYPE_DROP_DOWN",696],",",["T_WHITESPACE","\n                ",696],["T_STRING","Mage_Catalog_Model_Product_Option",697],["T_DOUBLE_COLON","::",697],["T_STRING","OPTION_TYPE_CHECKBOX",697],",",["T_WHITESPACE","\n                ",697],["T_STRING","Mage_Catalog_Model_Product_Option",698],["T_DOUBLE_COLON","::",698],["T_STRING","OPTION_TYPE_MULTIPLE",698],["T_WHITESPACE","\n            ",698],")",";",["T_WHITESPACE","\n            ",699],["T_IF","if",700],["T_WHITESPACE"," ",700],"(",["T_VARIABLE","$optionPrices",700],")",["T_WHITESPACE"," ",700],"{",["T_WHITESPACE","\n                ",700],["T_IF","if",701],["T_WHITESPACE"," ",701],"(",["T_STRING","in_array",701],"(",["T_VARIABLE","$option",701],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",701],"]",",",["T_WHITESPACE"," ",701],["T_VARIABLE","$multiTypes",701],")",")",["T_WHITESPACE"," ",701],"{",["T_WHITESPACE","\n                    ",701],["T_VARIABLE","$maxPrice",702],["T_WHITESPACE"," ",702],["T_PLUS_EQUAL","+=",702],["T_WHITESPACE"," ",702],["T_STRING","array_sum",702],"(",["T_VARIABLE","$optionPrices",702],")",";",["T_WHITESPACE","\n                ",702],"}",["T_WHITESPACE"," ",703],["T_ELSE","else",703],["T_WHITESPACE"," ",703],"{",["T_WHITESPACE","\n                    ",703],["T_VARIABLE","$maxPrice",704],["T_WHITESPACE"," ",704],["T_PLUS_EQUAL","+=",704],["T_WHITESPACE"," ",704],["T_STRING","max",704],"(",["T_VARIABLE","$optionPrices",704],")",";",["T_WHITESPACE","\n                ",704],"}",["T_WHITESPACE","\n            ",705],"}",["T_WHITESPACE","\n        ",706],"}",["T_WHITESPACE","\n\n        ",707],["T_RETURN","return",709],["T_WHITESPACE"," ",709],["T_ARRAY","array",709],"(",["T_VARIABLE","$minPrice",709],",",["T_WHITESPACE"," ",709],["T_VARIABLE","$maxPrice",709],")",";",["T_WHITESPACE","\n    ",709],"}",["T_WHITESPACE","\n\n    ",710],["T_DOC_COMMENT","\/**\n     * Calculate minimal and maximal price for bundle selections\n     * Return array with prices (0 -> min_price, 1 -> max_price)\n     *\n     * @param array $options\n     * @param array $salableStatus\n     * @param int $productId\n     * @param int $priceType\n     * @param float $basePrice\n     * @param array $priceData\n     * @param array $priceIndex\n     * @param Mage_Core_Model_Website $website\n     * @param Mage_Customer_Model_Group $group\n     * @return array\n     *\/",712],["T_WHITESPACE","\n    ",726],["T_PUBLIC","public",727],["T_WHITESPACE"," ",727],["T_FUNCTION","function",727],["T_WHITESPACE"," ",727],["T_STRING","_calculateBundleSelections",727],"(",["T_ARRAY","array",727],["T_WHITESPACE"," ",727],["T_VARIABLE","$options",727],",",["T_WHITESPACE"," ",727],["T_ARRAY","array",727],["T_WHITESPACE"," ",727],["T_VARIABLE","$salableStatus",727],",",["T_WHITESPACE"," ",727],["T_VARIABLE","$productId",727],",",["T_WHITESPACE"," ",727],["T_VARIABLE","$priceType",727],",",["T_WHITESPACE"," ",727],["T_VARIABLE","$basePrice",727],",",["T_WHITESPACE","\n        ",727],["T_VARIABLE","$priceData",728],",",["T_WHITESPACE"," ",728],["T_VARIABLE","$priceIndex",728],",",["T_WHITESPACE"," ",728],["T_VARIABLE","$website",728],",",["T_WHITESPACE"," ",728],["T_VARIABLE","$group",728],")",["T_WHITESPACE","\n    ",728],"{",["T_WHITESPACE","\n        ",729],["T_VARIABLE","$minPrice",730],["T_WHITESPACE"," ",730],"=",["T_WHITESPACE"," ",730],["T_VARIABLE","$maxPrice",730],["T_WHITESPACE"," ",730],"=",["T_WHITESPACE"," ",730],["T_VARIABLE","$basePrice",730],";",["T_WHITESPACE","\n        ",730],["T_VARIABLE","$optPrice",731],["T_WHITESPACE"," ",731],"=",["T_WHITESPACE"," ",731],["T_LNUMBER","0",731],";",["T_WHITESPACE","\n\n        ",731],["T_FOREACH","foreach",733],["T_WHITESPACE"," ",733],"(",["T_VARIABLE","$options",733],["T_WHITESPACE"," ",733],["T_AS","as",733],["T_WHITESPACE"," ",733],["T_VARIABLE","$option",733],")",["T_WHITESPACE"," ",733],"{",["T_WHITESPACE","\n            ",733],["T_VARIABLE","$optionPrices",734],["T_WHITESPACE"," ",734],"=",["T_WHITESPACE"," ",734],["T_ARRAY","array",734],"(",")",";",["T_WHITESPACE","\n            ",734],["T_FOREACH","foreach",735],["T_WHITESPACE"," ",735],"(",["T_VARIABLE","$option",735],"[",["T_CONSTANT_ENCAPSED_STRING","'selections'",735],"]",["T_WHITESPACE"," ",735],["T_AS","as",735],["T_WHITESPACE"," ",735],["T_VARIABLE","$selection",735],")",["T_WHITESPACE"," ",735],"{",["T_WHITESPACE","\n                ",735],["T_IF","if",736],["T_WHITESPACE"," ",736],"(","!",["T_VARIABLE","$selection",736],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",736],"]",")",["T_WHITESPACE"," ",736],"{",["T_WHITESPACE","\n                    ",736],["T_CONTINUE","continue",737],";",["T_WHITESPACE","\n                ",737],"}",["T_WHITESPACE","\n\n                ",738],["T_IF","if",740],["T_WHITESPACE"," ",740],"(","!",["T_VARIABLE","$salableStatus",740],"[",["T_VARIABLE","$selection",740],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",740],"]","]",")",["T_WHITESPACE"," ",740],"{",["T_WHITESPACE","\n                    ",740],["T_CONTINUE","continue",741],";",["T_WHITESPACE","\n                ",741],"}",["T_WHITESPACE","\n\n                ",742],["T_IF","if",744],["T_WHITESPACE"," ",744],"(",["T_VARIABLE","$priceType",744],["T_WHITESPACE"," ",744],["T_IS_EQUAL","==",744],["T_WHITESPACE"," ",744],["T_STRING","Mage_Bundle_Model_Product_Price",744],["T_DOUBLE_COLON","::",744],["T_STRING","PRICE_TYPE_FIXED",744],")",["T_WHITESPACE"," ",744],"{",["T_WHITESPACE","\n                    ",744],["T_VARIABLE","$basePrice",745],["T_WHITESPACE"," ",745],"=",["T_WHITESPACE"," ",745],["T_VARIABLE","$this",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","_getBasePrice",745],"(",["T_VARIABLE","$productId",745],",",["T_WHITESPACE"," ",745],["T_VARIABLE","$priceData",745],",",["T_WHITESPACE"," ",745],["T_VARIABLE","$website",745],",",["T_WHITESPACE"," ",745],["T_VARIABLE","$group",745],")",";",["T_WHITESPACE","\n                ",745],"}",["T_WHITESPACE","\n\n                ",746],["T_COMMENT","\/\/ calculate selection price\n",748],["T_WHITESPACE","                ",749],["T_IF","if",749],["T_WHITESPACE"," ",749],"(",["T_VARIABLE","$priceType",749],["T_WHITESPACE"," ",749],["T_IS_EQUAL","==",749],["T_WHITESPACE"," ",749],["T_STRING","Mage_Bundle_Model_Product_Price",749],["T_DOUBLE_COLON","::",749],["T_STRING","PRICE_TYPE_DYNAMIC",749],")",["T_WHITESPACE"," ",749],"{",["T_WHITESPACE","\n                    ",749],["T_VARIABLE","$priceIndexKey",750],["T_WHITESPACE"," ",750],"=",["T_WHITESPACE"," ",750],["T_STRING","join",750],"(",["T_CONSTANT_ENCAPSED_STRING","'-'",750],",",["T_WHITESPACE"," ",750],["T_ARRAY","array",750],"(",["T_WHITESPACE","\n                        ",750],["T_VARIABLE","$selection",751],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",751],"]",",",["T_WHITESPACE","\n                        ",751],["T_VARIABLE","$website",752],["T_OBJECT_OPERATOR","->",752],["T_STRING","getId",752],"(",")",",",["T_WHITESPACE","\n                        ",752],["T_VARIABLE","$group",753],["T_OBJECT_OPERATOR","->",753],["T_STRING","getId",753],"(",")",["T_WHITESPACE","\n                    ",753],")",")",";",["T_WHITESPACE","\n\n                    ",754],["T_VARIABLE","$selectionPrice",756],["T_WHITESPACE"," ",756],"=",["T_WHITESPACE"," ",756],["T_ISSET","isset",756],"(",["T_VARIABLE","$priceIndex",756],"[",["T_VARIABLE","$priceIndexKey",756],"]",")",["T_WHITESPACE"," ",756],"?",["T_WHITESPACE"," ",756],["T_VARIABLE","$priceIndex",756],"[",["T_VARIABLE","$priceIndexKey",756],"]",["T_WHITESPACE"," ",756],":",["T_WHITESPACE"," ",756],["T_LNUMBER","0",756],";",["T_WHITESPACE","\n                    ",756],["T_VARIABLE","$selectionPrice",757],["T_WHITESPACE"," ",757],"=",["T_WHITESPACE"," ",757],["T_VARIABLE","$this",757],["T_OBJECT_OPERATOR","->",757],["T_STRING","_calculateSpecialPrice",757],"(",["T_VARIABLE","$selectionPrice",757],",",["T_WHITESPACE"," ",757],["T_VARIABLE","$priceData",757],",",["T_WHITESPACE"," ",757],["T_VARIABLE","$website",757],")",";",["T_WHITESPACE","\n                ",757],"}",["T_WHITESPACE"," ",758],["T_ELSE","else",758],["T_WHITESPACE"," ",758],"{",["T_WHITESPACE","\n                    ",758],["T_IF","if",759],["T_WHITESPACE"," ",759],"(",["T_VARIABLE","$selection",759],"[",["T_CONSTANT_ENCAPSED_STRING","'price_type'",759],"]",")",["T_WHITESPACE"," ",759],"{",["T_WHITESPACE"," ",759],["T_COMMENT","\/\/ percent\n",759],["T_WHITESPACE","                        ",760],["T_VARIABLE","$selectionPrice",760],["T_WHITESPACE"," ",760],"=",["T_WHITESPACE"," ",760],["T_VARIABLE","$basePrice",760],["T_WHITESPACE"," ",760],"*",["T_WHITESPACE"," ",760],["T_VARIABLE","$selection",760],"[",["T_CONSTANT_ENCAPSED_STRING","'price_value'",760],"]",["T_WHITESPACE"," ",760],"\/",["T_WHITESPACE"," ",760],["T_LNUMBER","100",760],";",["T_WHITESPACE","\n                    ",760],"}",["T_WHITESPACE"," ",761],["T_ELSE","else",761],["T_WHITESPACE"," ",761],"{",["T_WHITESPACE","\n                        ",761],["T_VARIABLE","$selectionPrice",762],["T_WHITESPACE"," ",762],"=",["T_WHITESPACE"," ",762],["T_VARIABLE","$this",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","_calculateSpecialPrice",762],"(",["T_VARIABLE","$selection",762],"[",["T_CONSTANT_ENCAPSED_STRING","'price_value'",762],"]",",",["T_WHITESPACE","\n                        ",762],["T_VARIABLE","$priceData",763],",",["T_WHITESPACE"," ",763],["T_VARIABLE","$website",763],")",";",["T_WHITESPACE","\n                    ",763],"}",["T_WHITESPACE","\n                ",764],"}",["T_WHITESPACE","\n\n                ",765],["T_COMMENT","\/\/ calculate selection qty\n",767],["T_WHITESPACE","                ",768],["T_IF","if",768],["T_WHITESPACE"," ",768],"(",["T_VARIABLE","$selection",768],"[",["T_CONSTANT_ENCAPSED_STRING","'can_change_qty'",768],"]",["T_WHITESPACE"," ",768],["T_BOOLEAN_AND","&&",768],["T_WHITESPACE"," ",768],["T_VARIABLE","$option",768],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",768],"]",["T_WHITESPACE"," ",768],["T_IS_NOT_EQUAL","!=",768],["T_WHITESPACE"," ",768],["T_CONSTANT_ENCAPSED_STRING","'multi'",768],["T_WHITESPACE"," ",768],["T_BOOLEAN_AND","&&",768],["T_WHITESPACE"," ",768],["T_VARIABLE","$option",768],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",768],"]",["T_WHITESPACE"," ",768],["T_IS_NOT_EQUAL","!=",768],["T_WHITESPACE"," ",768],["T_CONSTANT_ENCAPSED_STRING","'checkbox'",768],")",["T_WHITESPACE"," ",768],"{",["T_WHITESPACE","\n                    ",768],["T_VARIABLE","$qty",769],["T_WHITESPACE"," ",769],"=",["T_WHITESPACE"," ",769],["T_LNUMBER","1",769],";",["T_WHITESPACE","\n                ",769],"}",["T_WHITESPACE"," ",770],["T_ELSE","else",770],["T_WHITESPACE"," ",770],"{",["T_WHITESPACE","\n                    ",770],["T_VARIABLE","$qty",771],["T_WHITESPACE"," ",771],"=",["T_WHITESPACE"," ",771],["T_VARIABLE","$selection",771],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",771],"]",";",["T_WHITESPACE","\n                ",771],"}",["T_WHITESPACE","\n\n                ",772],["T_VARIABLE","$selectionPrice",774],["T_WHITESPACE"," ",774],"=",["T_WHITESPACE"," ",774],["T_VARIABLE","$selectionPrice",774],["T_WHITESPACE"," ",774],"*",["T_WHITESPACE"," ",774],["T_VARIABLE","$qty",774],";",["T_WHITESPACE","\n                ",774],["T_VARIABLE","$optionPrices",775],"[",["T_VARIABLE","$selection",775],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",775],"]","]",["T_WHITESPACE"," ",775],"=",["T_WHITESPACE"," ",775],["T_VARIABLE","$selectionPrice",775],";",["T_WHITESPACE","\n            ",775],"}",["T_WHITESPACE","\n\n            ",776],["T_IF","if",778],["T_WHITESPACE"," ",778],"(",["T_VARIABLE","$optionPrices",778],")",["T_WHITESPACE"," ",778],"{",["T_WHITESPACE","\n                ",778],["T_IF","if",779],["T_WHITESPACE"," ",779],"(",["T_VARIABLE","$option",779],"[",["T_CONSTANT_ENCAPSED_STRING","'required'",779],"]",")",["T_WHITESPACE"," ",779],"{",["T_WHITESPACE","\n                    ",779],["T_VARIABLE","$minPrice",780],["T_WHITESPACE"," ",780],["T_PLUS_EQUAL","+=",780],["T_WHITESPACE"," ",780],["T_STRING","min",780],"(",["T_VARIABLE","$optionPrices",780],")",";",["T_WHITESPACE","\n                ",780],"}",["T_WHITESPACE"," ",781],["T_ELSE","else",781],["T_WHITESPACE"," ",781],"{",["T_WHITESPACE","\n                    ",781],["T_VARIABLE","$optPrice",782],["T_WHITESPACE"," ",782],"=",["T_WHITESPACE"," ",782],["T_VARIABLE","$optPrice",782],["T_WHITESPACE"," ",782],["T_BOOLEAN_AND","&&",782],["T_WHITESPACE"," ",782],["T_VARIABLE","$optPrice",782],["T_WHITESPACE"," ",782],"<",["T_WHITESPACE"," ",782],["T_STRING","min",782],"(",["T_VARIABLE","$optionPrices",782],")",["T_WHITESPACE"," ",782],"?",["T_WHITESPACE"," ",782],["T_VARIABLE","$optPrice",782],["T_WHITESPACE"," ",782],":",["T_WHITESPACE"," ",782],["T_STRING","min",782],"(",["T_VARIABLE","$optionPrices",782],")",";",["T_WHITESPACE","\n                ",782],"}",["T_WHITESPACE","\n                ",783],["T_IF","if",784],["T_WHITESPACE"," ",784],"(",["T_STRING","in_array",784],"(",["T_VARIABLE","$option",784],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",784],"]",",",["T_WHITESPACE"," ",784],["T_ARRAY","array",784],"(",["T_CONSTANT_ENCAPSED_STRING","'multi'",784],",",["T_WHITESPACE"," ",784],["T_CONSTANT_ENCAPSED_STRING","'checkbox'",784],")",")",")",["T_WHITESPACE"," ",784],"{",["T_WHITESPACE","\n                    ",784],["T_VARIABLE","$maxPrice",785],["T_WHITESPACE"," ",785],["T_PLUS_EQUAL","+=",785],["T_WHITESPACE"," ",785],["T_STRING","array_sum",785],"(",["T_VARIABLE","$optionPrices",785],")",";",["T_WHITESPACE","\n                ",785],"}",["T_WHITESPACE"," ",786],["T_ELSE","else",786],["T_WHITESPACE"," ",786],"{",["T_WHITESPACE","\n                    ",786],["T_VARIABLE","$maxPrice",787],["T_WHITESPACE"," ",787],["T_PLUS_EQUAL","+=",787],["T_WHITESPACE"," ",787],["T_STRING","max",787],"(",["T_VARIABLE","$optionPrices",787],")",";",["T_WHITESPACE","\n                ",787],"}",["T_WHITESPACE","\n            ",788],"}",["T_WHITESPACE","\n        ",789],"}",["T_WHITESPACE","\n\n        ",790],["T_IF","if",792],["T_WHITESPACE"," ",792],"(",["T_VARIABLE","$minPrice",792],["T_WHITESPACE"," ",792],["T_IS_EQUAL","==",792],["T_WHITESPACE"," ",792],["T_LNUMBER","0",792],")",["T_WHITESPACE"," ",792],"{",["T_WHITESPACE","\n            ",792],["T_VARIABLE","$minPrice",793],["T_WHITESPACE"," ",793],"=",["T_WHITESPACE"," ",793],["T_VARIABLE","$optPrice",793],";",["T_WHITESPACE","\n        ",793],"}",["T_WHITESPACE","\n        ",794],["T_RETURN","return",795],["T_WHITESPACE"," ",795],["T_ARRAY","array",795],"(",["T_VARIABLE","$minPrice",795],",",["T_WHITESPACE"," ",795],["T_VARIABLE","$maxPrice",795],")",";",["T_WHITESPACE","\n    ",795],"}",["T_WHITESPACE","\n\n    ",796],["T_DOC_COMMENT","\/**\n     * Apply special price\n     *\n     * @param float $finalPrice\n     * @param array $priceData\n     * @param Mage_Core_Model_Website $website\n     * @return float\n     *\/",798],["T_WHITESPACE","\n    ",805],["T_PUBLIC","public",806],["T_WHITESPACE"," ",806],["T_FUNCTION","function",806],["T_WHITESPACE"," ",806],["T_STRING","_calculateSpecialPrice",806],"(",["T_VARIABLE","$finalPrice",806],",",["T_WHITESPACE"," ",806],["T_ARRAY","array",806],["T_WHITESPACE"," ",806],["T_VARIABLE","$priceData",806],",",["T_WHITESPACE"," ",806],["T_STRING","Mage_Core_Model_Website",806],["T_WHITESPACE"," ",806],["T_VARIABLE","$website",806],")",["T_WHITESPACE","\n    ",806],"{",["T_WHITESPACE","\n        ",807],["T_VARIABLE","$store",808],["T_WHITESPACE","              ",808],"=",["T_WHITESPACE"," ",808],["T_VARIABLE","$website",808],["T_OBJECT_OPERATOR","->",808],["T_STRING","getDefaultStore",808],"(",")",";",["T_WHITESPACE","\n        ",808],["T_VARIABLE","$specialPrice",809],["T_WHITESPACE","       ",809],"=",["T_WHITESPACE"," ",809],["T_VARIABLE","$priceData",809],"[",["T_CONSTANT_ENCAPSED_STRING","'special_price'",809],"]",";",["T_WHITESPACE","\n\n        ",809],["T_IF","if",811],["T_WHITESPACE"," ",811],"(","!",["T_STRING","is_null",811],"(",["T_VARIABLE","$specialPrice",811],")",["T_WHITESPACE"," ",811],["T_BOOLEAN_AND","&&",811],["T_WHITESPACE"," ",811],["T_VARIABLE","$specialPrice",811],["T_WHITESPACE"," ",811],["T_IS_NOT_EQUAL","!=",811],["T_WHITESPACE"," ",811],["T_STRING","false",811],")",["T_WHITESPACE"," ",811],"{",["T_WHITESPACE","\n            ",811],["T_IF","if",812],["T_WHITESPACE"," ",812],"(",["T_STRING","Mage",812],["T_DOUBLE_COLON","::",812],["T_STRING","app",812],"(",")",["T_OBJECT_OPERATOR","->",812],["T_STRING","getLocale",812],"(",")",["T_OBJECT_OPERATOR","->",812],["T_STRING","isStoreDateInInterval",812],"(",["T_VARIABLE","$store",812],",",["T_WHITESPACE"," ",812],["T_VARIABLE","$priceData",812],"[",["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",812],"]",",",["T_WHITESPACE","\n            ",812],["T_VARIABLE","$priceData",813],"[",["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",813],"]",")",")",["T_WHITESPACE"," ",813],"{",["T_WHITESPACE","\n                ",813],["T_VARIABLE","$specialPrice",814],["T_WHITESPACE","   ",814],"=",["T_WHITESPACE"," ",814],"(",["T_VARIABLE","$finalPrice",814],["T_WHITESPACE"," ",814],"*",["T_WHITESPACE"," ",814],["T_VARIABLE","$specialPrice",814],")",["T_WHITESPACE"," ",814],"\/",["T_WHITESPACE"," ",814],["T_LNUMBER","100",814],";",["T_WHITESPACE","\n                ",814],["T_VARIABLE","$finalPrice",815],["T_WHITESPACE","     ",815],"=",["T_WHITESPACE"," ",815],["T_STRING","min",815],"(",["T_VARIABLE","$finalPrice",815],",",["T_WHITESPACE"," ",815],["T_VARIABLE","$specialPrice",815],")",";",["T_WHITESPACE","\n            ",815],"}",["T_WHITESPACE","\n        ",816],"}",["T_WHITESPACE","\n\n        ",817],["T_RETURN","return",819],["T_WHITESPACE"," ",819],["T_VARIABLE","$finalPrice",819],";",["T_WHITESPACE","\n    ",819],"}",["T_WHITESPACE","\n\n    ",820],["T_DOC_COMMENT","\/**\n     * Retrieve price index for products\n     *\n     * @param int|array $productIds\n     * @param int $websiteId\n     * @param int $groupId\n     * @return array\n     *\/",822],["T_WHITESPACE","\n    ",829],["T_PUBLIC","public",830],["T_WHITESPACE"," ",830],["T_FUNCTION","function",830],["T_WHITESPACE"," ",830],["T_STRING","loadPriceIndex",830],"(",["T_VARIABLE","$productIds",830],",",["T_WHITESPACE"," ",830],["T_VARIABLE","$websiteId",830],",",["T_WHITESPACE"," ",830],["T_VARIABLE","$groupId",830],")",["T_WHITESPACE","\n    ",830],"{",["T_WHITESPACE","\n        ",831],["T_VARIABLE","$prices",832],["T_WHITESPACE"," ",832],"=",["T_WHITESPACE"," ",832],["T_ARRAY","array",832],"(",")",";",["T_WHITESPACE","\n        ",832],["T_VARIABLE","$adapter",833],["T_WHITESPACE"," ",833],"=",["T_WHITESPACE"," ",833],["T_VARIABLE","$this",833],["T_OBJECT_OPERATOR","->",833],["T_STRING","_getReadAdapter",833],"(",")",";",["T_WHITESPACE","\n        ",833],["T_VARIABLE","$select",834],["T_WHITESPACE"," ",834],"=",["T_WHITESPACE"," ",834],["T_VARIABLE","$adapter",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","select",834],"(",")",["T_WHITESPACE","\n            ",834],["T_OBJECT_OPERATOR","->",835],["T_STRING","from",835],"(",["T_WHITESPACE","\n                ",835],["T_ARRAY","array",836],"(",["T_CONSTANT_ENCAPSED_STRING","'pi'",836],["T_WHITESPACE"," ",836],["T_DOUBLE_ARROW","=>",836],["T_WHITESPACE"," ",836],["T_VARIABLE","$this",836],["T_OBJECT_OPERATOR","->",836],["T_STRING","getMainTable",836],"(",")",")",",",["T_WHITESPACE","\n                ",836],["T_ARRAY","array",837],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",837],",",["T_WHITESPACE"," ",837],["T_CONSTANT_ENCAPSED_STRING","'min_price'",837],",",["T_WHITESPACE"," ",837],["T_CONSTANT_ENCAPSED_STRING","'max_price'",837],")",["T_WHITESPACE","\n            ",837],")",["T_WHITESPACE","\n            ",838],["T_OBJECT_OPERATOR","->",839],["T_STRING","where",839],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id IN(?)'",839],",",["T_WHITESPACE"," ",839],["T_VARIABLE","$productIds",839],")",["T_WHITESPACE","\n            ",839],["T_OBJECT_OPERATOR","->",840],["T_STRING","where",840],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id=:website_id'",840],")",["T_WHITESPACE","\n            ",840],["T_OBJECT_OPERATOR","->",841],["T_STRING","where",841],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id=:group_id'",841],")",";",["T_WHITESPACE","\n        ",841],["T_VARIABLE","$bind",842],["T_WHITESPACE"," ",842],"=",["T_WHITESPACE"," ",842],["T_ARRAY","array",842],"(",["T_WHITESPACE","\n            ",842],["T_CONSTANT_ENCAPSED_STRING","'website_id'",843],["T_WHITESPACE"," ",843],["T_DOUBLE_ARROW","=>",843],["T_WHITESPACE"," ",843],["T_VARIABLE","$websiteId",843],",",["T_WHITESPACE","\n            ",843],["T_CONSTANT_ENCAPSED_STRING","'group_id'",844],["T_WHITESPACE","   ",844],["T_DOUBLE_ARROW","=>",844],["T_WHITESPACE"," ",844],["T_VARIABLE","$groupId",844],["T_WHITESPACE","\n        ",844],")",";",["T_WHITESPACE","\n        ",845],["T_VARIABLE","$query",846],["T_WHITESPACE"," ",846],"=",["T_WHITESPACE"," ",846],["T_VARIABLE","$adapter",846],["T_OBJECT_OPERATOR","->",846],["T_STRING","query",846],"(",["T_VARIABLE","$select",846],",",["T_WHITESPACE"," ",846],["T_VARIABLE","$bind",846],")",";",["T_WHITESPACE","\n        ",846],["T_WHILE","while",847],["T_WHITESPACE"," ",847],"(",["T_VARIABLE","$row",847],["T_WHITESPACE"," ",847],"=",["T_WHITESPACE"," ",847],["T_VARIABLE","$query",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","fetch",847],"(",")",")",["T_WHITESPACE"," ",847],"{",["T_WHITESPACE","\n            ",847],["T_VARIABLE","$prices",848],"[",["T_VARIABLE","$row",848],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",848],"]","]",["T_WHITESPACE"," ",848],"=",["T_WHITESPACE"," ",848],["T_ARRAY","array",848],"(",["T_WHITESPACE","\n                ",848],["T_CONSTANT_ENCAPSED_STRING","'min_price'",849],["T_WHITESPACE"," ",849],["T_DOUBLE_ARROW","=>",849],["T_WHITESPACE"," ",849],["T_VARIABLE","$row",849],"[",["T_CONSTANT_ENCAPSED_STRING","'min_price'",849],"]",",",["T_WHITESPACE","\n                ",849],["T_CONSTANT_ENCAPSED_STRING","'max_price'",850],["T_WHITESPACE"," ",850],["T_DOUBLE_ARROW","=>",850],["T_WHITESPACE"," ",850],["T_VARIABLE","$row",850],"[",["T_CONSTANT_ENCAPSED_STRING","'max_price'",850],"]",["T_WHITESPACE","\n            ",850],")",";",["T_WHITESPACE","\n        ",851],"}",["T_WHITESPACE","\n\n        ",852],["T_RETURN","return",854],["T_WHITESPACE"," ",854],["T_VARIABLE","$prices",854],";",["T_WHITESPACE","\n    ",854],"}",["T_WHITESPACE","\n",855],"}",["T_WHITESPACE","\n",856]]