[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Bundle Type Model\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Bundle_Model_Product_Type",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Product is composite\n     *\n     * @var bool\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_isComposite",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","true",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Cache key for Options Collection\n     *\n     * @var string\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_keyOptionsCollection",48],["T_WHITESPACE","        ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'_cache_instance_options_collection'",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Cache key for Selections Collection\n     *\n     * @var string\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_keySelectionsCollection",55],["T_WHITESPACE","     ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'_cache_instance_selections_collection'",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Cache key for used Selections\n     *\n     * @var string\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_keyUsedSelections",62],["T_WHITESPACE","           ",62],"=",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'_cache_instance_used_selections'",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Cache key for used selections ids\n     *\n     * @var string\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$_keyUsedSelectionsIds",69],["T_WHITESPACE","        ",69],"=",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'_cache_instance_used_selections_ids'",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Cache key for used options\n     *\n     * @var string\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$_keyUsedOptions",76],["T_WHITESPACE","              ",76],"=",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'_cache_instance_used_options'",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Cache key for used options ids\n     *\n     * @var string\n     *\/",78],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$_keyUsedOptionsIds",83],["T_WHITESPACE","           ",83],"=",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'_cache_instance_used_options_ids'",83],";",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Product is configurable\n     *\n     * @var bool\n     *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$_canConfigure",90],["T_WHITESPACE","                ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","true",90],";",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Return relation info about used products\n     *\n     * @return Varien_Object Object with information data\n     *\/",92],["T_WHITESPACE","\n    ",96],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","getRelationInfo",97],"(",")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$info",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_NEW","new",99],["T_WHITESPACE"," ",99],["T_STRING","Varien_Object",99],"(",")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$info",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","setTable",100],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",100],")",["T_WHITESPACE","\n            ",100],["T_OBJECT_OPERATOR","->",101],["T_STRING","setParentFieldName",101],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_product_id'",101],")",["T_WHITESPACE","\n            ",101],["T_OBJECT_OPERATOR","->",102],["T_STRING","setChildFieldName",102],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",102],")",";",["T_WHITESPACE","\n        ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$info",103],";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Retrieve Required children ids\n     * Return grouped array, ex array(\n     *   group => array(ids)\n     * )\n     *\n     * @param int $parentId\n     * @param bool $required\n     * @return array\n     *\/",106],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","getChildrenIds",116],"(",["T_VARIABLE","$parentId",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$required",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","true",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","getResourceSingleton",118],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",118],")",["T_WHITESPACE","\n            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","getChildrenIds",119],"(",["T_VARIABLE","$parentId",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$required",119],")",";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Retrieve parent ids array by requered child\n     *\n     * @param int|array $childId\n     * @return array\n     *\/",122],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","getParentIdsByChild",128],"(",["T_VARIABLE","$childId",128],")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_STRING","Mage",130],["T_DOUBLE_COLON","::",130],["T_STRING","getResourceSingleton",130],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",130],")",["T_WHITESPACE","\n            ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","getParentIdsByChild",131],"(",["T_VARIABLE","$childId",131],")",";",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Return product sku based on sku_type attribute\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return string\n     *\/",134],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","getSku",140],"(",["T_VARIABLE","$product",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","null",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$sku",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","parent",142],["T_DOUBLE_COLON","::",142],["T_STRING","getSku",142],"(",["T_VARIABLE","$product",142],")",";",["T_WHITESPACE","\n\n        ",142],["T_IF","if",144],["T_WHITESPACE"," ",144],"(",["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getProduct",144],"(",["T_VARIABLE","$product",144],")",["T_OBJECT_OPERATOR","->",144],["T_STRING","getData",144],"(",["T_CONSTANT_ENCAPSED_STRING","'sku_type'",144],")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n            ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$sku",145],";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE"," ",146],["T_ELSE","else",146],["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$skuParts",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_ARRAY","array",147],"(",["T_VARIABLE","$sku",147],")",";",["T_WHITESPACE","\n\n            ",147],["T_IF","if",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getProduct",149],"(",["T_VARIABLE","$product",149],")",["T_OBJECT_OPERATOR","->",149],["T_STRING","hasCustomOptions",149],"(",")",")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n                ",149],["T_VARIABLE","$customOption",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getProduct",150],"(",["T_VARIABLE","$product",150],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","getCustomOption",150],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_ids'",150],")",";",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$selectionIds",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_STRING","unserialize",151],"(",["T_VARIABLE","$customOption",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getValue",151],"(",")",")",";",["T_WHITESPACE","\n                ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(","!",["T_EMPTY","empty",152],"(",["T_VARIABLE","$selectionIds",152],")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n                    ",152],["T_VARIABLE","$selections",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getSelectionsByIds",153],"(",["T_VARIABLE","$selectionIds",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$product",153],")",";",["T_WHITESPACE","\n                    ",153],["T_FOREACH","foreach",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$selections",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getItems",154],"(",")",["T_WHITESPACE"," ",154],["T_AS","as",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$selection",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n                        ",154],["T_VARIABLE","$skuParts",155],"[","]",["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$selection",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getSku",155],"(",")",";",["T_WHITESPACE","\n                    ",155],"}",["T_WHITESPACE","\n                ",156],"}",["T_WHITESPACE","\n            ",157],"}",["T_WHITESPACE","\n\n            ",158],["T_RETURN","return",160],["T_WHITESPACE"," ",160],["T_STRING","implode",160],"(",["T_CONSTANT_ENCAPSED_STRING","'-'",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$skuParts",160],")",";",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * Return product weight based on weight_type attribute\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return decimal\n     *\/",164],["T_WHITESPACE","\n    ",169],["T_PUBLIC","public",170],["T_WHITESPACE"," ",170],["T_FUNCTION","function",170],["T_WHITESPACE"," ",170],["T_STRING","getWeight",170],"(",["T_VARIABLE","$product",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_STRING","null",170],")",["T_WHITESPACE","\n    ",170],"{",["T_WHITESPACE","\n        ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getProduct",172],"(",["T_VARIABLE","$product",172],")",["T_OBJECT_OPERATOR","->",172],["T_STRING","getData",172],"(",["T_CONSTANT_ENCAPSED_STRING","'weight_type'",172],")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_RETURN","return",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getProduct",173],"(",["T_VARIABLE","$product",173],")",["T_OBJECT_OPERATOR","->",173],["T_STRING","getData",173],"(",["T_CONSTANT_ENCAPSED_STRING","'weight'",173],")",";",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE"," ",174],["T_ELSE","else",174],["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n            ",174],["T_VARIABLE","$weight",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_LNUMBER","0",175],";",["T_WHITESPACE","\n\n            ",175],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getProduct",177],"(",["T_VARIABLE","$product",177],")",["T_OBJECT_OPERATOR","->",177],["T_STRING","hasCustomOptions",177],"(",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$customOption",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getProduct",178],"(",["T_VARIABLE","$product",178],")",["T_OBJECT_OPERATOR","->",178],["T_STRING","getCustomOption",178],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_ids'",178],")",";",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$selectionIds",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_STRING","unserialize",179],"(",["T_VARIABLE","$customOption",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getValue",179],"(",")",")",";",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$selections",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getSelectionsByIds",180],"(",["T_VARIABLE","$selectionIds",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$product",180],")",";",["T_WHITESPACE","\n                ",180],["T_FOREACH","foreach",181],["T_WHITESPACE"," ",181],"(",["T_VARIABLE","$selections",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getItems",181],"(",")",["T_WHITESPACE"," ",181],["T_AS","as",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$selection",181],")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                    ",181],["T_VARIABLE","$qtyOption",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getProduct",182],"(",["T_VARIABLE","$product",182],")",["T_WHITESPACE","\n                        ",182],["T_OBJECT_OPERATOR","->",183],["T_STRING","getCustomOption",183],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_qty_'",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_VARIABLE","$selection",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getSelectionId",183],"(",")",")",";",["T_WHITESPACE","\n                    ",183],["T_IF","if",184],["T_WHITESPACE"," ",184],"(",["T_VARIABLE","$qtyOption",184],")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n                        ",184],["T_VARIABLE","$weight",185],["T_WHITESPACE"," ",185],["T_PLUS_EQUAL","+=",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$selection",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getWeight",185],"(",")",["T_WHITESPACE"," ",185],"*",["T_WHITESPACE"," ",185],["T_VARIABLE","$qtyOption",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getValue",185],"(",")",";",["T_WHITESPACE","\n                    ",185],"}",["T_WHITESPACE"," ",186],["T_ELSE","else",186],["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n                        ",186],["T_VARIABLE","$weight",187],["T_WHITESPACE"," ",187],["T_PLUS_EQUAL","+=",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$selection",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getWeight",187],"(",")",";",["T_WHITESPACE","\n                    ",187],"}",["T_WHITESPACE","\n                ",188],"}",["T_WHITESPACE","\n            ",189],"}",["T_WHITESPACE","\n            ",190],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$weight",191],";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n\n    ",193],["T_DOC_COMMENT","\/**\n     * Check is virtual product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",195],["T_WHITESPACE","\n    ",200],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","isVirtual",201],"(",["T_VARIABLE","$product",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","null",201],")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(",["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getProduct",203],"(",["T_VARIABLE","$product",203],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","hasCustomOptions",203],"(",")",")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$customOption",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getProduct",204],"(",["T_VARIABLE","$product",204],")",["T_OBJECT_OPERATOR","->",204],["T_STRING","getCustomOption",204],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_ids'",204],")",";",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$selectionIds",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_STRING","unserialize",205],"(",["T_VARIABLE","$customOption",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getValue",205],"(",")",")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$selections",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getSelectionsByIds",206],"(",["T_VARIABLE","$selectionIds",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$product",206],")",";",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$virtualCount",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_LNUMBER","0",207],";",["T_WHITESPACE","\n            ",207],["T_FOREACH","foreach",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$selections",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getItems",208],"(",")",["T_WHITESPACE"," ",208],["T_AS","as",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$selection",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n                ",208],["T_IF","if",209],["T_WHITESPACE"," ",209],"(",["T_VARIABLE","$selection",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","isVirtual",209],"(",")",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n                    ",209],["T_VARIABLE","$virtualCount",210],["T_INC","++",210],";",["T_WHITESPACE","\n                ",210],"}",["T_WHITESPACE","\n            ",211],"}",["T_WHITESPACE","\n            ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_VARIABLE","$virtualCount",213],["T_WHITESPACE"," ",213],["T_IS_EQUAL","==",213],["T_WHITESPACE"," ",213],["T_STRING","count",213],"(",["T_VARIABLE","$selections",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n                ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_STRING","true",214],";",["T_WHITESPACE","\n            ",214],"}",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n        ",216],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_STRING","false",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n\n    ",218],["T_DOC_COMMENT","\/**\n     * Before save type related data\n     *\n     * @param Mage_Catalog_Model_Product $product\n     *\/",220],["T_WHITESPACE","\n    ",224],["T_PUBLIC","public",225],["T_WHITESPACE"," ",225],["T_FUNCTION","function",225],["T_WHITESPACE"," ",225],["T_STRING","beforeSave",225],"(",["T_VARIABLE","$product",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_STRING","null",225],")",["T_WHITESPACE","\n    ",225],"{",["T_WHITESPACE","\n        ",226],["T_STRING","parent",227],["T_DOUBLE_COLON","::",227],["T_STRING","beforeSave",227],"(",["T_VARIABLE","$product",227],")",";",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$product",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getProduct",228],"(",["T_VARIABLE","$product",228],")",";",["T_WHITESPACE","\n\n        ",228],["T_COMMENT","\/\/ If bundle product has dynamic weight, than delete weight attribute\n",230],["T_WHITESPACE","        ",231],["T_IF","if",231],["T_WHITESPACE"," ",231],"(","!",["T_VARIABLE","$product",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getData",231],"(",["T_CONSTANT_ENCAPSED_STRING","'weight_type'",231],")",["T_WHITESPACE"," ",231],["T_BOOLEAN_AND","&&",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$product",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","hasData",231],"(",["T_CONSTANT_ENCAPSED_STRING","'weight'",231],")",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n            ",231],["T_VARIABLE","$product",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","setData",232],"(",["T_CONSTANT_ENCAPSED_STRING","'weight'",232],",",["T_WHITESPACE"," ",232],["T_STRING","false",232],")",";",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE","\n\n        ",233],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$product",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getPriceType",235],"(",")",["T_WHITESPACE"," ",235],["T_IS_EQUAL","==",235],["T_WHITESPACE"," ",235],["T_STRING","Mage_Bundle_Model_Product_Price",235],["T_DOUBLE_COLON","::",235],["T_STRING","PRICE_TYPE_DYNAMIC",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$product",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","setData",236],"(",["T_WHITESPACE","\n                ",236],["T_CONSTANT_ENCAPSED_STRING","'msrp_enabled'",237],",",["T_WHITESPACE"," ",237],["T_STRING","Mage_Catalog_Model_Product_Attribute_Source_Msrp_Type_Enabled",237],["T_DOUBLE_COLON","::",237],["T_STRING","MSRP_ENABLE_NO",237],["T_WHITESPACE","\n            ",237],")",";",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$product",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","unsetData",239],"(",["T_CONSTANT_ENCAPSED_STRING","'msrp'",239],")",";",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$product",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","unsetData",240],"(",["T_CONSTANT_ENCAPSED_STRING","'msrp_display_actual_price_type'",240],")",";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n\n        ",241],["T_VARIABLE","$product",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","canAffectOptions",243],"(",["T_STRING","false",243],")",";",["T_WHITESPACE","\n\n        ",243],["T_IF","if",245],["T_WHITESPACE"," ",245],"(",["T_VARIABLE","$product",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getCanSaveBundleSelections",245],"(",")",")",["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n            ",245],["T_VARIABLE","$product",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","canAffectOptions",246],"(",["T_STRING","true",246],")",";",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$selections",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$product",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getBundleSelectionsData",247],"(",")",";",["T_WHITESPACE","\n            ",247],["T_IF","if",248],["T_WHITESPACE"," ",248],"(",["T_VARIABLE","$selections",248],")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n                ",248],["T_IF","if",249],["T_WHITESPACE"," ",249],"(","!",["T_EMPTY","empty",249],"(",["T_VARIABLE","$selections",249],")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                    ",249],["T_VARIABLE","$options",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$product",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getBundleOptionsData",250],"(",")",";",["T_WHITESPACE","\n                    ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_VARIABLE","$options",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n                        ",251],["T_FOREACH","foreach",252],["T_WHITESPACE"," ",252],"(",["T_VARIABLE","$options",252],["T_WHITESPACE"," ",252],["T_AS","as",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$option",252],")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n                            ",252],["T_IF","if",253],["T_WHITESPACE"," ",253],"(",["T_EMPTY","empty",253],"(",["T_VARIABLE","$option",253],"[",["T_CONSTANT_ENCAPSED_STRING","'delete'",253],"]",")",["T_WHITESPACE"," ",253],["T_BOOLEAN_OR","||",253],["T_WHITESPACE"," ",253],["T_LNUMBER","1",253],["T_WHITESPACE"," ",253],["T_IS_NOT_EQUAL","!=",253],["T_WHITESPACE"," ",253],["T_INT_CAST","(int)",253],["T_VARIABLE","$option",253],"[",["T_CONSTANT_ENCAPSED_STRING","'delete'",253],"]",")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n                                ",253],["T_VARIABLE","$product",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","setTypeHasOptions",254],"(",["T_STRING","true",254],")",";",["T_WHITESPACE","\n                                ",254],["T_IF","if",255],["T_WHITESPACE"," ",255],"(",["T_LNUMBER","1",255],["T_WHITESPACE"," ",255],["T_IS_EQUAL","==",255],["T_WHITESPACE"," ",255],["T_INT_CAST","(int)",255],["T_VARIABLE","$option",255],"[",["T_CONSTANT_ENCAPSED_STRING","'required'",255],"]",")",["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n                                    ",255],["T_VARIABLE","$product",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","setTypeHasRequiredOptions",256],"(",["T_STRING","true",256],")",";",["T_WHITESPACE","\n                                    ",256],["T_BREAK","break",257],";",["T_WHITESPACE","\n                                ",257],"}",["T_WHITESPACE","\n                            ",258],"}",["T_WHITESPACE","\n                        ",259],"}",["T_WHITESPACE","\n                    ",260],"}",["T_WHITESPACE","\n                ",261],"}",["T_WHITESPACE","\n            ",262],"}",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n\n    ",265],["T_DOC_COMMENT","\/**\n     * Save type related data\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Product_Type\n     *\/",267],["T_WHITESPACE","\n    ",272],["T_PUBLIC","public",273],["T_WHITESPACE"," ",273],["T_FUNCTION","function",273],["T_WHITESPACE"," ",273],["T_STRING","save",273],"(",["T_VARIABLE","$product",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","null",273],")",["T_WHITESPACE","\n    ",273],"{",["T_WHITESPACE","\n        ",274],["T_STRING","parent",275],["T_DOUBLE_COLON","::",275],["T_STRING","save",275],"(",["T_VARIABLE","$product",275],")",";",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$product",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getProduct",276],"(",["T_VARIABLE","$product",276],")",";",["T_WHITESPACE","\n        ",276],["T_COMMENT","\/* @var $resource Mage_Bundle_Model_Mysql4_Bundle *\/",277],["T_WHITESPACE","\n        ",277],["T_VARIABLE","$resource",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_STRING","Mage",278],["T_DOUBLE_COLON","::",278],["T_STRING","getResourceModel",278],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/bundle'",278],")",";",["T_WHITESPACE","\n\n        ",278],["T_VARIABLE","$options",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$product",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getBundleOptionsData",280],"(",")",";",["T_WHITESPACE","\n        ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$options",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n            ",281],["T_VARIABLE","$product",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","setIsRelationsChanged",282],"(",["T_STRING","true",282],")",";",["T_WHITESPACE","\n\n            ",282],["T_FOREACH","foreach",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$options",284],["T_WHITESPACE"," ",284],["T_AS","as",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$key",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$option",284],")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                ",284],["T_IF","if",285],["T_WHITESPACE"," ",285],"(",["T_ISSET","isset",285],"(",["T_VARIABLE","$option",285],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",285],"]",")",["T_WHITESPACE"," ",285],["T_BOOLEAN_AND","&&",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$option",285],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",285],"]",["T_WHITESPACE"," ",285],["T_IS_EQUAL","==",285],["T_WHITESPACE"," ",285],["T_CONSTANT_ENCAPSED_STRING","''",285],")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n                    ",285],["T_UNSET","unset",286],"(",["T_VARIABLE","$option",286],"[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",286],"]",")",";",["T_WHITESPACE","\n                ",286],"}",["T_WHITESPACE","\n\n                ",287],["T_VARIABLE","$optionModel",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","getModel",289],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option'",289],")",["T_WHITESPACE","\n                    ",289],["T_OBJECT_OPERATOR","->",290],["T_STRING","setData",290],"(",["T_VARIABLE","$option",290],")",["T_WHITESPACE","\n                    ",290],["T_OBJECT_OPERATOR","->",291],["T_STRING","setParentId",291],"(",["T_VARIABLE","$product",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getId",291],"(",")",")",["T_WHITESPACE","\n                    ",291],["T_OBJECT_OPERATOR","->",292],["T_STRING","setStoreId",292],"(",["T_VARIABLE","$product",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getStoreId",292],"(",")",")",";",["T_WHITESPACE","\n\n                ",292],["T_VARIABLE","$optionModel",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","isDeleted",294],"(",["T_BOOL_CAST","(bool)",294],["T_VARIABLE","$option",294],"[",["T_CONSTANT_ENCAPSED_STRING","'delete'",294],"]",")",";",["T_WHITESPACE","\n                ",294],["T_VARIABLE","$optionModel",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","save",295],"(",")",";",["T_WHITESPACE","\n\n                ",295],["T_VARIABLE","$options",297],"[",["T_VARIABLE","$key",297],"]","[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",297],"]",["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$optionModel",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getOptionId",297],"(",")",";",["T_WHITESPACE","\n            ",297],"}",["T_WHITESPACE","\n\n            ",298],["T_VARIABLE","$usedProductIds",300],["T_WHITESPACE","      ",300],"=",["T_WHITESPACE"," ",300],["T_ARRAY","array",300],"(",")",";",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$excludeSelectionIds",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_ARRAY","array",301],"(",")",";",["T_WHITESPACE","\n\n            ",301],["T_VARIABLE","$selections",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$product",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getBundleSelectionsData",303],"(",")",";",["T_WHITESPACE","\n            ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_VARIABLE","$selections",304],")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n                ",304],["T_FOREACH","foreach",305],["T_WHITESPACE"," ",305],"(",["T_VARIABLE","$selections",305],["T_WHITESPACE"," ",305],["T_AS","as",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$index",305],["T_WHITESPACE"," ",305],["T_DOUBLE_ARROW","=>",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$group",305],")",["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n                    ",305],["T_FOREACH","foreach",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$group",306],["T_WHITESPACE"," ",306],["T_AS","as",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$key",306],["T_WHITESPACE"," ",306],["T_DOUBLE_ARROW","=>",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$selection",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n                        ",306],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_ISSET","isset",307],"(",["T_VARIABLE","$selection",307],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",307],"]",")",["T_WHITESPACE"," ",307],["T_BOOLEAN_AND","&&",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$selection",307],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",307],"]",["T_WHITESPACE"," ",307],["T_IS_EQUAL","==",307],["T_WHITESPACE"," ",307],["T_CONSTANT_ENCAPSED_STRING","''",307],")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n                            ",307],["T_UNSET","unset",308],"(",["T_VARIABLE","$selection",308],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",308],"]",")",";",["T_WHITESPACE","\n                        ",308],"}",["T_WHITESPACE","\n\n                        ",309],["T_IF","if",311],["T_WHITESPACE"," ",311],"(","!",["T_ISSET","isset",311],"(",["T_VARIABLE","$selection",311],"[",["T_CONSTANT_ENCAPSED_STRING","'is_default'",311],"]",")",")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n                            ",311],["T_VARIABLE","$selection",312],"[",["T_CONSTANT_ENCAPSED_STRING","'is_default'",312],"]",["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_LNUMBER","0",312],";",["T_WHITESPACE","\n                        ",312],"}",["T_WHITESPACE","\n\n                        ",313],["T_VARIABLE","$selectionModel",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","getModel",315],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",315],")",["T_WHITESPACE","\n                            ",315],["T_OBJECT_OPERATOR","->",316],["T_STRING","setData",316],"(",["T_VARIABLE","$selection",316],")",["T_WHITESPACE","\n                            ",316],["T_OBJECT_OPERATOR","->",317],["T_STRING","setOptionId",317],"(",["T_VARIABLE","$options",317],"[",["T_VARIABLE","$index",317],"]","[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",317],"]",")",["T_WHITESPACE","\n                            ",317],["T_OBJECT_OPERATOR","->",318],["T_STRING","setParentProductId",318],"(",["T_VARIABLE","$product",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getId",318],"(",")",")",";",["T_WHITESPACE","\n\n                        ",318],["T_VARIABLE","$selectionModel",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","isDeleted",320],"(",["T_BOOL_CAST","(bool)",320],["T_VARIABLE","$selection",320],"[",["T_CONSTANT_ENCAPSED_STRING","'delete'",320],"]",")",";",["T_WHITESPACE","\n                        ",320],["T_VARIABLE","$selectionModel",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","save",321],"(",")",";",["T_WHITESPACE","\n\n                        ",321],["T_VARIABLE","$selection",323],"[",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",323],"]",["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$selectionModel",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","getSelectionId",323],"(",")",";",["T_WHITESPACE","\n\n                        ",323],["T_IF","if",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$selectionModel",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getSelectionId",325],"(",")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n                            ",325],["T_VARIABLE","$excludeSelectionIds",326],"[","]",["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$selectionModel",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getSelectionId",326],"(",")",";",["T_WHITESPACE","\n                            ",326],["T_VARIABLE","$usedProductIds",327],"[","]",["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$selectionModel",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getProductId",327],"(",")",";",["T_WHITESPACE","\n                        ",327],"}",["T_WHITESPACE","\n                    ",328],"}",["T_WHITESPACE","\n                ",329],"}",["T_WHITESPACE","\n\n                ",330],["T_VARIABLE","$resource",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","dropAllUnneededSelections",332],"(",["T_VARIABLE","$product",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getId",332],"(",")",",",["T_WHITESPACE"," ",332],["T_VARIABLE","$excludeSelectionIds",332],")",";",["T_WHITESPACE","\n                ",332],["T_VARIABLE","$resource",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","saveProductRelations",333],"(",["T_VARIABLE","$product",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getId",333],"(",")",",",["T_WHITESPACE"," ",333],["T_STRING","array_unique",333],"(",["T_VARIABLE","$usedProductIds",333],")",")",";",["T_WHITESPACE","\n            ",333],"}",["T_WHITESPACE","\n\n            ",334],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$product",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getData",336],"(",["T_CONSTANT_ENCAPSED_STRING","'price_type'",336],")",["T_WHITESPACE"," ",336],["T_IS_NOT_EQUAL","!=",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$product",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getOrigData",336],"(",["T_CONSTANT_ENCAPSED_STRING","'price_type'",336],")",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n                ",336],["T_VARIABLE","$resource",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","dropAllQuoteChildItems",337],"(",["T_VARIABLE","$product",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getId",337],"(",")",")",";",["T_WHITESPACE","\n            ",337],"}",["T_WHITESPACE","\n        ",338],"}",["T_WHITESPACE","\n\n        ",339],["T_RETURN","return",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_DOC_COMMENT","\/**\n     * Retrieve bundle options items\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",344],["T_WHITESPACE","\n    ",349],["T_PUBLIC","public",350],["T_WHITESPACE"," ",350],["T_FUNCTION","function",350],["T_WHITESPACE"," ",350],["T_STRING","getOptions",350],"(",["T_VARIABLE","$product",350],["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_STRING","null",350],")",["T_WHITESPACE","\n    ",350],"{",["T_WHITESPACE","\n        ",351],["T_RETURN","return",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getOptionsCollection",352],"(",["T_VARIABLE","$product",352],")",["T_OBJECT_OPERATOR","->",352],["T_STRING","getItems",352],"(",")",";",["T_WHITESPACE","\n    ",352],"}",["T_WHITESPACE","\n\n    ",353],["T_DOC_COMMENT","\/**\n     * Retrieve bundle options ids\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",355],["T_WHITESPACE","\n    ",360],["T_PUBLIC","public",361],["T_WHITESPACE"," ",361],["T_FUNCTION","function",361],["T_WHITESPACE"," ",361],["T_STRING","getOptionsIds",361],"(",["T_VARIABLE","$product",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_STRING","null",361],")",["T_WHITESPACE","\n    ",361],"{",["T_WHITESPACE","\n        ",362],["T_RETURN","return",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getOptionsCollection",363],"(",["T_VARIABLE","$product",363],")",["T_OBJECT_OPERATOR","->",363],["T_STRING","getAllIds",363],"(",")",";",["T_WHITESPACE","\n    ",363],"}",["T_WHITESPACE","\n\n    ",364],["T_DOC_COMMENT","\/**\n     * Retrieve bundle option collection\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Mysql4_Option_Collection\n     *\/",366],["T_WHITESPACE","\n    ",371],["T_PUBLIC","public",372],["T_WHITESPACE"," ",372],["T_FUNCTION","function",372],["T_WHITESPACE"," ",372],["T_STRING","getOptionsCollection",372],"(",["T_VARIABLE","$product",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_STRING","null",372],")",["T_WHITESPACE","\n    ",372],"{",["T_WHITESPACE","\n        ",373],["T_IF","if",374],["T_WHITESPACE"," ",374],"(","!",["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getProduct",374],"(",["T_VARIABLE","$product",374],")",["T_OBJECT_OPERATOR","->",374],["T_STRING","hasData",374],"(",["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_keyOptionsCollection",374],")",")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n            ",374],["T_VARIABLE","$optionsCollection",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_STRING","Mage",375],["T_DOUBLE_COLON","::",375],["T_STRING","getModel",375],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option'",375],")",["T_OBJECT_OPERATOR","->",375],["T_STRING","getResourceCollection",375],"(",")",["T_WHITESPACE","\n                ",375],["T_OBJECT_OPERATOR","->",376],["T_STRING","setProductIdFilter",376],"(",["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getProduct",376],"(",["T_VARIABLE","$product",376],")",["T_OBJECT_OPERATOR","->",376],["T_STRING","getId",376],"(",")",")",["T_WHITESPACE","\n                ",376],["T_OBJECT_OPERATOR","->",377],["T_STRING","setPositionOrder",377],"(",")",";",["T_WHITESPACE","\n\n            ",377],["T_VARIABLE","$storeId",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","getStoreFilter",379],"(",["T_VARIABLE","$product",379],")",";",["T_WHITESPACE","\n            ",379],["T_IF","if",380],["T_WHITESPACE"," ",380],"(",["T_VARIABLE","$storeId",380],["T_WHITESPACE"," ",380],["T_INSTANCEOF","instanceof",380],["T_WHITESPACE"," ",380],["T_STRING","Mage_Core_Model_Store",380],")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n                ",380],["T_VARIABLE","$storeId",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_VARIABLE","$storeId",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getId",381],"(",")",";",["T_WHITESPACE","\n            ",381],"}",["T_WHITESPACE","\n\n            ",382],["T_VARIABLE","$optionsCollection",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","joinValues",384],"(",["T_VARIABLE","$storeId",384],")",";",["T_WHITESPACE","\n            ",384],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","getProduct",385],"(",["T_VARIABLE","$product",385],")",["T_OBJECT_OPERATOR","->",385],["T_STRING","setData",385],"(",["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","_keyOptionsCollection",385],",",["T_WHITESPACE"," ",385],["T_VARIABLE","$optionsCollection",385],")",";",["T_WHITESPACE","\n        ",385],"}",["T_WHITESPACE","\n        ",386],["T_RETURN","return",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getProduct",387],"(",["T_VARIABLE","$product",387],")",["T_OBJECT_OPERATOR","->",387],["T_STRING","getData",387],"(",["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_keyOptionsCollection",387],")",";",["T_WHITESPACE","\n    ",387],"}",["T_WHITESPACE","\n\n    ",388],["T_DOC_COMMENT","\/**\n     * Retrive bundle selections collection based on used options\n     *\n     * @param array $optionIds\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Mysql4_Selection_Collection\n     *\/",390],["T_WHITESPACE","\n    ",396],["T_PUBLIC","public",397],["T_WHITESPACE"," ",397],["T_FUNCTION","function",397],["T_WHITESPACE"," ",397],["T_STRING","getSelectionsCollection",397],"(",["T_VARIABLE","$optionIds",397],",",["T_WHITESPACE"," ",397],["T_VARIABLE","$product",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_STRING","null",397],")",["T_WHITESPACE","\n    ",397],"{",["T_WHITESPACE","\n        ",398],["T_VARIABLE","$keyOptionIds",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],"(",["T_STRING","is_array",399],"(",["T_VARIABLE","$optionIds",399],")",["T_WHITESPACE"," ",399],"?",["T_WHITESPACE"," ",399],["T_STRING","implode",399],"(",["T_CONSTANT_ENCAPSED_STRING","'_'",399],",",["T_WHITESPACE"," ",399],["T_VARIABLE","$optionIds",399],")",["T_WHITESPACE"," ",399],":",["T_WHITESPACE"," ",399],["T_CONSTANT_ENCAPSED_STRING","''",399],")",";",["T_WHITESPACE","\n        ",399],["T_VARIABLE","$key",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","_keySelectionsCollection",400],["T_WHITESPACE"," ",400],".",["T_WHITESPACE"," ",400],["T_VARIABLE","$keyOptionIds",400],";",["T_WHITESPACE","\n        ",400],["T_IF","if",401],["T_WHITESPACE"," ",401],"(","!",["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getProduct",401],"(",["T_VARIABLE","$product",401],")",["T_OBJECT_OPERATOR","->",401],["T_STRING","hasData",401],"(",["T_VARIABLE","$key",401],")",")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n            ",401],["T_VARIABLE","$storeId",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_VARIABLE","$this",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","getProduct",402],"(",["T_VARIABLE","$product",402],")",["T_OBJECT_OPERATOR","->",402],["T_STRING","getStoreId",402],"(",")",";",["T_WHITESPACE","\n            ",402],["T_VARIABLE","$selectionsCollection",403],["T_WHITESPACE"," ",403],"=",["T_WHITESPACE"," ",403],["T_STRING","Mage",403],["T_DOUBLE_COLON","::",403],["T_STRING","getResourceModel",403],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection_collection'",403],")",["T_WHITESPACE","\n                ",403],["T_OBJECT_OPERATOR","->",404],["T_STRING","addAttributeToSelect",404],"(",["T_STRING","Mage",404],["T_DOUBLE_COLON","::",404],["T_STRING","getSingleton",404],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/config'",404],")",["T_OBJECT_OPERATOR","->",404],["T_STRING","getProductAttributes",404],"(",")",")",["T_WHITESPACE","\n                ",404],["T_OBJECT_OPERATOR","->",405],["T_STRING","addAttributeToSelect",405],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",405],")",["T_WHITESPACE"," ",405],["T_COMMENT","\/\/used for calculation item taxes in Bundle with Dynamic Price\n",405],["T_WHITESPACE","                ",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","setFlag",406],"(",["T_CONSTANT_ENCAPSED_STRING","'require_stock_items'",406],",",["T_WHITESPACE"," ",406],["T_STRING","true",406],")",["T_WHITESPACE","\n                ",406],["T_OBJECT_OPERATOR","->",407],["T_STRING","setFlag",407],"(",["T_CONSTANT_ENCAPSED_STRING","'product_children'",407],",",["T_WHITESPACE"," ",407],["T_STRING","true",407],")",["T_WHITESPACE","\n                ",407],["T_OBJECT_OPERATOR","->",408],["T_STRING","setPositionOrder",408],"(",")",["T_WHITESPACE","\n                ",408],["T_OBJECT_OPERATOR","->",409],["T_STRING","addStoreFilter",409],"(",["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getStoreFilter",409],"(",["T_VARIABLE","$product",409],")",")",["T_WHITESPACE","\n                ",409],["T_OBJECT_OPERATOR","->",410],["T_STRING","setStoreId",410],"(",["T_VARIABLE","$storeId",410],")",["T_WHITESPACE","\n                ",410],["T_OBJECT_OPERATOR","->",411],["T_STRING","addFilterByRequiredOptions",411],"(",")",["T_WHITESPACE","\n                ",411],["T_OBJECT_OPERATOR","->",412],["T_STRING","setOptionIdsFilter",412],"(",["T_VARIABLE","$optionIds",412],")",";",["T_WHITESPACE","\n\n            ",412],["T_IF","if",414],["T_WHITESPACE"," ",414],"(","!",["T_STRING","Mage",414],["T_DOUBLE_COLON","::",414],["T_STRING","helper",414],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",414],")",["T_OBJECT_OPERATOR","->",414],["T_STRING","isPriceGlobal",414],"(",")",["T_WHITESPACE"," ",414],["T_BOOLEAN_AND","&&",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$storeId",414],")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n                ",414],["T_VARIABLE","$websiteId",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_STRING","Mage",415],["T_DOUBLE_COLON","::",415],["T_STRING","app",415],"(",")",["T_OBJECT_OPERATOR","->",415],["T_STRING","getStore",415],"(",["T_VARIABLE","$storeId",415],")",["T_OBJECT_OPERATOR","->",415],["T_STRING","getWebsiteId",415],"(",")",";",["T_WHITESPACE","\n                ",415],["T_VARIABLE","$selectionsCollection",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","joinPrices",416],"(",["T_VARIABLE","$websiteId",416],")",";",["T_WHITESPACE","\n            ",416],"}",["T_WHITESPACE","\n\n            ",417],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getProduct",419],"(",["T_VARIABLE","$product",419],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","setData",419],"(",["T_VARIABLE","$key",419],",",["T_WHITESPACE"," ",419],["T_VARIABLE","$selectionsCollection",419],")",";",["T_WHITESPACE","\n        ",419],"}",["T_WHITESPACE","\n        ",420],["T_RETURN","return",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getProduct",421],"(",["T_VARIABLE","$product",421],")",["T_OBJECT_OPERATOR","->",421],["T_STRING","getData",421],"(",["T_VARIABLE","$key",421],")",";",["T_WHITESPACE","\n    ",421],"}",["T_WHITESPACE","\n\n    ",422],["T_DOC_COMMENT","\/**\n     * Method is needed for specific actions to change given quote options values\n     * according current product type logic\n     * Example: the cataloginventory validation of decimal qty can change qty to int,\n     * so need to change quote item qty option value too.\n     *\n     * @param   array           $options\n     * @param   Varien_Object   $option\n     * @param   mixed           $value\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  Mage_Bundle_Model_Product_Type\n     *\/",424],["T_WHITESPACE","\n    ",435],["T_PUBLIC","public",436],["T_WHITESPACE"," ",436],["T_FUNCTION","function",436],["T_WHITESPACE"," ",436],["T_STRING","updateQtyOption",436],"(",["T_VARIABLE","$options",436],",",["T_WHITESPACE"," ",436],["T_STRING","Varien_Object",436],["T_WHITESPACE"," ",436],["T_VARIABLE","$option",436],",",["T_WHITESPACE"," ",436],["T_VARIABLE","$value",436],",",["T_WHITESPACE"," ",436],["T_VARIABLE","$product",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_STRING","null",436],")",["T_WHITESPACE","\n    ",436],"{",["T_WHITESPACE","\n        ",437],["T_VARIABLE","$optionProduct",438],["T_WHITESPACE","      ",438],"=",["T_WHITESPACE"," ",438],["T_VARIABLE","$option",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getProduct",438],"(",["T_VARIABLE","$product",438],")",";",["T_WHITESPACE","\n        ",438],["T_VARIABLE","$optionUpdateFlag",439],["T_WHITESPACE","   ",439],"=",["T_WHITESPACE"," ",439],["T_VARIABLE","$option",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getHasQtyOptionUpdate",439],"(",")",";",["T_WHITESPACE","\n        ",439],["T_VARIABLE","$optionCollection",440],["T_WHITESPACE","   ",440],"=",["T_WHITESPACE"," ",440],["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getOptionsCollection",440],"(",["T_VARIABLE","$product",440],")",";",["T_WHITESPACE","\n\n        ",440],["T_VARIABLE","$selections",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getSelectionsCollection",442],"(",["T_VARIABLE","$optionCollection",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getAllIds",442],"(",")",",",["T_WHITESPACE"," ",442],["T_VARIABLE","$product",442],")",";",["T_WHITESPACE","\n\n        ",442],["T_FOREACH","foreach",444],["T_WHITESPACE"," ",444],"(",["T_VARIABLE","$selections",444],["T_WHITESPACE"," ",444],["T_AS","as",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$selection",444],")",["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n            ",444],["T_IF","if",445],["T_WHITESPACE"," ",445],"(",["T_VARIABLE","$selection",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getProductId",445],"(",")",["T_WHITESPACE"," ",445],["T_IS_EQUAL","==",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$optionProduct",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getId",445],"(",")",")",["T_WHITESPACE"," ",445],"{",["T_WHITESPACE","\n                ",445],["T_FOREACH","foreach",446],["T_WHITESPACE"," ",446],"(",["T_VARIABLE","$options",446],["T_WHITESPACE"," ",446],["T_AS","as",446],["T_WHITESPACE"," ",446],"&",["T_VARIABLE","$option",446],")",["T_WHITESPACE"," ",446],"{",["T_WHITESPACE","\n                    ",446],["T_IF","if",447],["T_WHITESPACE"," ",447],"(",["T_VARIABLE","$option",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getCode",447],"(",")",["T_WHITESPACE"," ",447],["T_IS_EQUAL","==",447],["T_WHITESPACE"," ",447],["T_CONSTANT_ENCAPSED_STRING","'selection_qty_'",447],".",["T_VARIABLE","$selection",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getSelectionId",447],"(",")",")",["T_WHITESPACE"," ",447],"{",["T_WHITESPACE","\n                        ",447],["T_IF","if",448],["T_WHITESPACE"," ",448],"(",["T_VARIABLE","$optionUpdateFlag",448],")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n                            ",448],["T_VARIABLE","$option",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","setValue",449],"(",["T_STRING","intval",449],"(",["T_VARIABLE","$option",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getValue",449],"(",")",")",")",";",["T_WHITESPACE","\n                        ",449],"}",["T_WHITESPACE","\n                        ",450],["T_ELSE","else",451],["T_WHITESPACE"," ",451],"{",["T_WHITESPACE","\n                            ",451],["T_VARIABLE","$option",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","setValue",452],"(",["T_VARIABLE","$value",452],")",";",["T_WHITESPACE","\n                        ",452],"}",["T_WHITESPACE","\n                    ",453],"}",["T_WHITESPACE","\n                ",454],"}",["T_WHITESPACE","\n            ",455],"}",["T_WHITESPACE","\n        ",456],"}",["T_WHITESPACE","\n\n        ",457],["T_RETURN","return",459],["T_WHITESPACE"," ",459],["T_VARIABLE","$this",459],";",["T_WHITESPACE","\n    ",459],"}",["T_WHITESPACE","\n\n    ",460],["T_DOC_COMMENT","\/**\n     * Prepare Quote Item Quantity\n     *\n     * @param mixed $qty\n     * @param Mage_Catalog_Model_Product $product\n     * @return int\n     *\/",462],["T_WHITESPACE","\n    ",468],["T_PUBLIC","public",469],["T_WHITESPACE"," ",469],["T_FUNCTION","function",469],["T_WHITESPACE"," ",469],["T_STRING","prepareQuoteItemQty",469],"(",["T_VARIABLE","$qty",469],",",["T_WHITESPACE"," ",469],["T_VARIABLE","$product",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_STRING","null",469],")",["T_WHITESPACE","\n    ",469],"{",["T_WHITESPACE","\n        ",470],["T_RETURN","return",471],["T_WHITESPACE"," ",471],["T_STRING","intval",471],"(",["T_VARIABLE","$qty",471],")",";",["T_WHITESPACE","\n    ",471],"}",["T_WHITESPACE","\n\n    ",472],["T_DOC_COMMENT","\/**\n     * Checking if we can sale this bundle\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",474],["T_WHITESPACE","\n    ",479],["T_PUBLIC","public",480],["T_WHITESPACE"," ",480],["T_FUNCTION","function",480],["T_WHITESPACE"," ",480],["T_STRING","isSalable",480],"(",["T_VARIABLE","$product",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_STRING","null",480],")",["T_WHITESPACE","\n    ",480],"{",["T_WHITESPACE","\n        ",481],["T_VARIABLE","$salable",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_STRING","parent",482],["T_DOUBLE_COLON","::",482],["T_STRING","isSalable",482],"(",["T_VARIABLE","$product",482],")",";",["T_WHITESPACE","\n        ",482],["T_IF","if",483],["T_WHITESPACE"," ",483],"(","!",["T_STRING","is_null",483],"(",["T_VARIABLE","$salable",483],")",")",["T_WHITESPACE"," ",483],"{",["T_WHITESPACE","\n            ",483],["T_RETURN","return",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$salable",484],";",["T_WHITESPACE","\n        ",484],"}",["T_WHITESPACE","\n\n        ",485],["T_VARIABLE","$optionCollection",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getOptionsCollection",487],"(",["T_VARIABLE","$product",487],")",";",["T_WHITESPACE","\n\n        ",487],["T_IF","if",489],["T_WHITESPACE"," ",489],"(","!",["T_STRING","count",489],"(",["T_VARIABLE","$optionCollection",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getItems",489],"(",")",")",")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n            ",489],["T_RETURN","return",490],["T_WHITESPACE"," ",490],["T_STRING","false",490],";",["T_WHITESPACE","\n        ",490],"}",["T_WHITESPACE","\n\n        ",491],["T_VARIABLE","$requiredOptionIds",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_ARRAY","array",493],"(",")",";",["T_WHITESPACE","\n\n        ",493],["T_FOREACH","foreach",495],["T_WHITESPACE"," ",495],"(",["T_VARIABLE","$optionCollection",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getItems",495],"(",")",["T_WHITESPACE"," ",495],["T_AS","as",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$option",495],")",["T_WHITESPACE"," ",495],"{",["T_WHITESPACE","\n            ",495],["T_IF","if",496],["T_WHITESPACE"," ",496],"(",["T_VARIABLE","$option",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getRequired",496],"(",")",")",["T_WHITESPACE"," ",496],"{",["T_WHITESPACE","\n                ",496],["T_VARIABLE","$requiredOptionIds",497],"[",["T_VARIABLE","$option",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getId",497],"(",")","]",["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_LNUMBER","0",497],";",["T_WHITESPACE","\n            ",497],"}",["T_WHITESPACE","\n        ",498],"}",["T_WHITESPACE","\n\n        ",499],["T_VARIABLE","$selectionCollection",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getSelectionsCollection",501],"(",["T_VARIABLE","$optionCollection",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getAllIds",501],"(",")",",",["T_WHITESPACE"," ",501],["T_VARIABLE","$product",501],")",";",["T_WHITESPACE","\n\n        ",501],["T_IF","if",503],["T_WHITESPACE"," ",503],"(","!",["T_STRING","count",503],"(",["T_VARIABLE","$selectionCollection",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","getItems",503],"(",")",")",")",["T_WHITESPACE"," ",503],"{",["T_WHITESPACE","\n            ",503],["T_RETURN","return",504],["T_WHITESPACE"," ",504],["T_STRING","false",504],";",["T_WHITESPACE","\n        ",504],"}",["T_WHITESPACE","\n        ",505],["T_VARIABLE","$salableSelectionCount",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_LNUMBER","0",506],";",["T_WHITESPACE","\n        ",506],["T_FOREACH","foreach",507],["T_WHITESPACE"," ",507],"(",["T_VARIABLE","$selectionCollection",507],["T_WHITESPACE"," ",507],["T_AS","as",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$selection",507],")",["T_WHITESPACE"," ",507],"{",["T_WHITESPACE","\n            ",507],["T_IF","if",508],["T_WHITESPACE"," ",508],"(",["T_VARIABLE","$selection",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","isSalable",508],"(",")",")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n                ",508],["T_VARIABLE","$requiredOptionIds",509],"[",["T_VARIABLE","$selection",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getOptionId",509],"(",")","]",["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_LNUMBER","1",509],";",["T_WHITESPACE","\n                ",509],["T_VARIABLE","$salableSelectionCount",510],["T_INC","++",510],";",["T_WHITESPACE","\n            ",510],"}",["T_WHITESPACE","\n\n        ",511],"}",["T_WHITESPACE","\n\n        ",513],["T_RETURN","return",515],["T_WHITESPACE"," ",515],"(",["T_STRING","array_sum",515],"(",["T_VARIABLE","$requiredOptionIds",515],")",["T_WHITESPACE"," ",515],["T_IS_EQUAL","==",515],["T_WHITESPACE"," ",515],["T_STRING","count",515],"(",["T_VARIABLE","$requiredOptionIds",515],")",["T_WHITESPACE"," ",515],["T_BOOLEAN_AND","&&",515],["T_WHITESPACE"," ",515],["T_VARIABLE","$salableSelectionCount",515],")",";",["T_WHITESPACE","\n    ",515],"}",["T_WHITESPACE","\n\n    ",516],["T_DOC_COMMENT","\/**\n     * Prepare product and its configuration to be added to some products list.\n     * Perform standard preparation process and then prepare of bundle selections options.\n     *\n     * @param Varien_Object $buyRequest\n     * @param Mage_Catalog_Model_Product $product\n     * @param string $processMode\n     * @return array|string\n     *\/",518],["T_WHITESPACE","\n    ",526],["T_PROTECTED","protected",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","_prepareProduct",527],"(",["T_STRING","Varien_Object",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$buyRequest",527],",",["T_WHITESPACE"," ",527],["T_VARIABLE","$product",527],",",["T_WHITESPACE"," ",527],["T_VARIABLE","$processMode",527],")",["T_WHITESPACE","\n    ",527],"{",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$result",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_STRING","parent",529],["T_DOUBLE_COLON","::",529],["T_STRING","_prepareProduct",529],"(",["T_VARIABLE","$buyRequest",529],",",["T_WHITESPACE"," ",529],["T_VARIABLE","$product",529],",",["T_WHITESPACE"," ",529],["T_VARIABLE","$processMode",529],")",";",["T_WHITESPACE","\n\n        ",529],["T_IF","if",531],["T_WHITESPACE"," ",531],"(",["T_STRING","is_string",531],"(",["T_VARIABLE","$result",531],")",")",["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n            ",531],["T_RETURN","return",532],["T_WHITESPACE"," ",532],["T_VARIABLE","$result",532],";",["T_WHITESPACE","\n        ",532],"}",["T_WHITESPACE","\n\n        ",533],["T_VARIABLE","$selections",535],["T_WHITESPACE"," ",535],"=",["T_WHITESPACE"," ",535],["T_ARRAY","array",535],"(",")",";",["T_WHITESPACE","\n        ",535],["T_VARIABLE","$product",536],["T_WHITESPACE"," ",536],"=",["T_WHITESPACE"," ",536],["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","getProduct",536],"(",["T_VARIABLE","$product",536],")",";",["T_WHITESPACE","\n        ",536],["T_VARIABLE","$isStrictProcessMode",537],["T_WHITESPACE"," ",537],"=",["T_WHITESPACE"," ",537],["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","_isStrictProcessMode",537],"(",["T_VARIABLE","$processMode",537],")",";",["T_WHITESPACE","\n\n        ",537],["T_VARIABLE","$skipSaleableCheck",539],["T_WHITESPACE"," ",539],"=",["T_WHITESPACE"," ",539],["T_STRING","Mage",539],["T_DOUBLE_COLON","::",539],["T_STRING","helper",539],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",539],")",["T_OBJECT_OPERATOR","->",539],["T_STRING","getSkipSaleableCheck",539],"(",")",";",["T_WHITESPACE","\n        ",539],["T_VARIABLE","$_appendAllSelections",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_BOOL_CAST","(bool)",540],["T_VARIABLE","$product",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","getSkipCheckRequiredOption",540],"(",")",["T_WHITESPACE"," ",540],["T_BOOLEAN_OR","||",540],["T_WHITESPACE"," ",540],["T_VARIABLE","$skipSaleableCheck",540],";",["T_WHITESPACE","\n\n        ",540],["T_VARIABLE","$options",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_VARIABLE","$buyRequest",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getBundleOption",542],"(",")",";",["T_WHITESPACE","\n        ",542],["T_IF","if",543],["T_WHITESPACE"," ",543],"(",["T_STRING","is_array",543],"(",["T_VARIABLE","$options",543],")",")",["T_WHITESPACE"," ",543],"{",["T_WHITESPACE","\n            ",543],["T_VARIABLE","$options",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],["T_STRING","array_filter",544],"(",["T_VARIABLE","$options",544],",",["T_WHITESPACE"," ",544],["T_CONSTANT_ENCAPSED_STRING","'intval'",544],")",";",["T_WHITESPACE","\n            ",544],["T_VARIABLE","$qtys",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$buyRequest",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","getBundleOptionQty",545],"(",")",";",["T_WHITESPACE","\n            ",545],["T_FOREACH","foreach",546],["T_WHITESPACE"," ",546],"(",["T_VARIABLE","$options",546],["T_WHITESPACE"," ",546],["T_AS","as",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$_optionId",546],["T_WHITESPACE"," ",546],["T_DOUBLE_ARROW","=>",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$_selections",546],")",["T_WHITESPACE"," ",546],"{",["T_WHITESPACE","\n                ",546],["T_IF","if",547],["T_WHITESPACE"," ",547],"(",["T_EMPTY","empty",547],"(",["T_VARIABLE","$_selections",547],")",")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n                    ",547],["T_UNSET","unset",548],"(",["T_VARIABLE","$options",548],"[",["T_VARIABLE","$_optionId",548],"]",")",";",["T_WHITESPACE","\n                ",548],"}",["T_WHITESPACE","\n            ",549],"}",["T_WHITESPACE","\n            ",550],["T_VARIABLE","$optionIds",551],["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_STRING","array_keys",551],"(",["T_VARIABLE","$options",551],")",";",["T_WHITESPACE","\n\n            ",551],["T_IF","if",553],["T_WHITESPACE"," ",553],"(",["T_EMPTY","empty",553],"(",["T_VARIABLE","$optionIds",553],")",["T_WHITESPACE"," ",553],["T_BOOLEAN_AND","&&",553],["T_WHITESPACE"," ",553],["T_VARIABLE","$isStrictProcessMode",553],")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n                ",553],["T_RETURN","return",554],["T_WHITESPACE"," ",554],["T_STRING","Mage",554],["T_DOUBLE_COLON","::",554],["T_STRING","helper",554],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",554],")",["T_OBJECT_OPERATOR","->",554],["T_STRING","__",554],"(",["T_CONSTANT_ENCAPSED_STRING","'Please select options for product.'",554],")",";",["T_WHITESPACE","\n            ",554],"}",["T_WHITESPACE","\n\n            ",555],["T_VARIABLE","$product",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getTypeInstance",557],"(",["T_STRING","true",557],")",["T_OBJECT_OPERATOR","->",557],["T_STRING","setStoreFilter",557],"(",["T_VARIABLE","$product",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getStoreId",557],"(",")",",",["T_WHITESPACE"," ",557],["T_VARIABLE","$product",557],")",";",["T_WHITESPACE","\n            ",557],["T_VARIABLE","$optionsCollection",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getOptionsCollection",558],"(",["T_VARIABLE","$product",558],")",";",["T_WHITESPACE","\n            ",558],["T_IF","if",559],["T_WHITESPACE"," ",559],"(","!",["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","getProduct",559],"(",["T_VARIABLE","$product",559],")",["T_OBJECT_OPERATOR","->",559],["T_STRING","getSkipCheckRequiredOption",559],"(",")",["T_WHITESPACE"," ",559],["T_BOOLEAN_AND","&&",559],["T_WHITESPACE"," ",559],["T_VARIABLE","$isStrictProcessMode",559],")",["T_WHITESPACE"," ",559],"{",["T_WHITESPACE","\n                ",559],["T_FOREACH","foreach",560],["T_WHITESPACE"," ",560],"(",["T_VARIABLE","$optionsCollection",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getItems",560],"(",")",["T_WHITESPACE"," ",560],["T_AS","as",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$option",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n                    ",560],["T_IF","if",561],["T_WHITESPACE"," ",561],"(",["T_VARIABLE","$option",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","getRequired",561],"(",")",["T_WHITESPACE"," ",561],["T_BOOLEAN_AND","&&",561],["T_WHITESPACE"," ",561],"!",["T_ISSET","isset",561],"(",["T_VARIABLE","$options",561],"[",["T_VARIABLE","$option",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","getId",561],"(",")","]",")",")",["T_WHITESPACE"," ",561],"{",["T_WHITESPACE","\n                        ",561],["T_RETURN","return",562],["T_WHITESPACE"," ",562],["T_STRING","Mage",562],["T_DOUBLE_COLON","::",562],["T_STRING","helper",562],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",562],")",["T_OBJECT_OPERATOR","->",562],["T_STRING","__",562],"(",["T_CONSTANT_ENCAPSED_STRING","'Required options are not selected.'",562],")",";",["T_WHITESPACE","\n                    ",562],"}",["T_WHITESPACE","\n                ",563],"}",["T_WHITESPACE","\n            ",564],"}",["T_WHITESPACE","\n            ",565],["T_VARIABLE","$selectionIds",566],["T_WHITESPACE"," ",566],"=",["T_WHITESPACE"," ",566],["T_ARRAY","array",566],"(",")",";",["T_WHITESPACE","\n\n            ",566],["T_FOREACH","foreach",568],["T_WHITESPACE"," ",568],"(",["T_VARIABLE","$options",568],["T_WHITESPACE"," ",568],["T_AS","as",568],["T_WHITESPACE"," ",568],["T_VARIABLE","$optionId",568],["T_WHITESPACE"," ",568],["T_DOUBLE_ARROW","=>",568],["T_WHITESPACE"," ",568],["T_VARIABLE","$selectionId",568],")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n                ",568],["T_IF","if",569],["T_WHITESPACE"," ",569],"(","!",["T_STRING","is_array",569],"(",["T_VARIABLE","$selectionId",569],")",")",["T_WHITESPACE"," ",569],"{",["T_WHITESPACE","\n                    ",569],["T_IF","if",570],["T_WHITESPACE"," ",570],"(",["T_VARIABLE","$selectionId",570],["T_WHITESPACE"," ",570],["T_IS_NOT_EQUAL","!=",570],["T_WHITESPACE"," ",570],["T_CONSTANT_ENCAPSED_STRING","''",570],")",["T_WHITESPACE"," ",570],"{",["T_WHITESPACE","\n                        ",570],["T_VARIABLE","$selectionIds",571],"[","]",["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_INT_CAST","(int)",571],["T_VARIABLE","$selectionId",571],";",["T_WHITESPACE","\n                    ",571],"}",["T_WHITESPACE","\n                ",572],"}",["T_WHITESPACE"," ",573],["T_ELSE","else",573],["T_WHITESPACE"," ",573],"{",["T_WHITESPACE","\n                    ",573],["T_FOREACH","foreach",574],["T_WHITESPACE"," ",574],"(",["T_VARIABLE","$selectionId",574],["T_WHITESPACE"," ",574],["T_AS","as",574],["T_WHITESPACE"," ",574],["T_VARIABLE","$id",574],")",["T_WHITESPACE"," ",574],"{",["T_WHITESPACE","\n                        ",574],["T_IF","if",575],["T_WHITESPACE"," ",575],"(",["T_VARIABLE","$id",575],["T_WHITESPACE"," ",575],["T_IS_NOT_EQUAL","!=",575],["T_WHITESPACE"," ",575],["T_CONSTANT_ENCAPSED_STRING","''",575],")",["T_WHITESPACE"," ",575],"{",["T_WHITESPACE","\n                            ",575],["T_VARIABLE","$selectionIds",576],"[","]",["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_INT_CAST","(int)",576],["T_VARIABLE","$id",576],";",["T_WHITESPACE","\n                        ",576],"}",["T_WHITESPACE","\n                    ",577],"}",["T_WHITESPACE","\n                ",578],"}",["T_WHITESPACE","\n            ",579],"}",["T_WHITESPACE","\n            ",580],["T_COMMENT","\/\/ If product has not been configured yet then $selections array should be empty\n",581],["T_WHITESPACE","            ",582],["T_IF","if",582],["T_WHITESPACE"," ",582],"(","!",["T_EMPTY","empty",582],"(",["T_VARIABLE","$selectionIds",582],")",")",["T_WHITESPACE"," ",582],"{",["T_WHITESPACE","\n                ",582],["T_VARIABLE","$selections",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","getSelectionsByIds",583],"(",["T_VARIABLE","$selectionIds",583],",",["T_WHITESPACE"," ",583],["T_VARIABLE","$product",583],")",";",["T_WHITESPACE","\n\n                ",583],["T_COMMENT","\/\/ Check if added selections are still on sale\n",585],["T_WHITESPACE","                ",586],["T_FOREACH","foreach",586],["T_WHITESPACE"," ",586],"(",["T_VARIABLE","$selections",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","getItems",586],"(",")",["T_WHITESPACE"," ",586],["T_AS","as",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$key",586],["T_WHITESPACE"," ",586],["T_DOUBLE_ARROW","=>",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$selection",586],")",["T_WHITESPACE"," ",586],"{",["T_WHITESPACE","\n                    ",586],["T_IF","if",587],["T_WHITESPACE"," ",587],"(","!",["T_VARIABLE","$selection",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","isSalable",587],"(",")",["T_WHITESPACE"," ",587],["T_BOOLEAN_AND","&&",587],["T_WHITESPACE"," ",587],"!",["T_VARIABLE","$skipSaleableCheck",587],")",["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n                        ",587],["T_VARIABLE","$_option",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_VARIABLE","$optionsCollection",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","getItemById",588],"(",["T_VARIABLE","$selection",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","getOptionId",588],"(",")",")",";",["T_WHITESPACE","\n                        ",588],["T_IF","if",589],["T_WHITESPACE"," ",589],"(",["T_STRING","is_array",589],"(",["T_VARIABLE","$options",589],"[",["T_VARIABLE","$_option",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getId",589],"(",")","]",")",["T_WHITESPACE"," ",589],["T_BOOLEAN_AND","&&",589],["T_WHITESPACE"," ",589],["T_STRING","count",589],"(",["T_VARIABLE","$options",589],"[",["T_VARIABLE","$_option",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getId",589],"(",")","]",")",["T_WHITESPACE"," ",589],">",["T_WHITESPACE"," ",589],["T_LNUMBER","1",589],")",["T_WHITESPACE"," ",589],"{",["T_WHITESPACE","\n                            ",589],["T_VARIABLE","$moreSelections",590],["T_WHITESPACE"," ",590],"=",["T_WHITESPACE"," ",590],["T_STRING","true",590],";",["T_WHITESPACE","\n                        ",590],"}",["T_WHITESPACE"," ",591],["T_ELSE","else",591],["T_WHITESPACE"," ",591],"{",["T_WHITESPACE","\n                            ",591],["T_VARIABLE","$moreSelections",592],["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_STRING","false",592],";",["T_WHITESPACE","\n                        ",592],"}",["T_WHITESPACE","\n                        ",593],["T_IF","if",594],["T_WHITESPACE"," ",594],"(",["T_VARIABLE","$_option",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","getRequired",594],"(",")",["T_WHITESPACE","\n                            ",594],["T_BOOLEAN_AND","&&",595],["T_WHITESPACE"," ",595],"(","!",["T_VARIABLE","$_option",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","isMultiSelection",595],"(",")",["T_WHITESPACE"," ",595],["T_BOOLEAN_OR","||",595],["T_WHITESPACE"," ",595],"(",["T_VARIABLE","$_option",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","isMultiSelection",595],"(",")",["T_WHITESPACE"," ",595],["T_BOOLEAN_AND","&&",595],["T_WHITESPACE"," ",595],"!",["T_VARIABLE","$moreSelections",595],")",")",["T_WHITESPACE","\n                        ",595],")",["T_WHITESPACE"," ",596],"{",["T_WHITESPACE","\n                            ",596],["T_RETURN","return",597],["T_WHITESPACE"," ",597],["T_STRING","Mage",597],["T_DOUBLE_COLON","::",597],["T_STRING","helper",597],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",597],")",["T_OBJECT_OPERATOR","->",597],["T_STRING","__",597],"(",["T_CONSTANT_ENCAPSED_STRING","'Selected required options are not available.'",597],")",";",["T_WHITESPACE","\n                        ",597],"}",["T_WHITESPACE","\n                    ",598],"}",["T_WHITESPACE","\n                ",599],"}",["T_WHITESPACE","\n\n                ",600],["T_VARIABLE","$optionsCollection",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","appendSelections",602],"(",["T_VARIABLE","$selections",602],",",["T_WHITESPACE"," ",602],["T_STRING","false",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$_appendAllSelections",602],")",";",["T_WHITESPACE","\n\n                ",602],["T_VARIABLE","$selections",604],["T_WHITESPACE"," ",604],"=",["T_WHITESPACE"," ",604],["T_VARIABLE","$selections",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","getItems",604],"(",")",";",["T_WHITESPACE","\n            ",604],"}",["T_WHITESPACE"," ",605],["T_ELSE","else",605],["T_WHITESPACE"," ",605],"{",["T_WHITESPACE","\n                ",605],["T_VARIABLE","$selections",606],["T_WHITESPACE"," ",606],"=",["T_WHITESPACE"," ",606],["T_ARRAY","array",606],"(",")",";",["T_WHITESPACE","\n            ",606],"}",["T_WHITESPACE","\n        ",607],"}",["T_WHITESPACE"," ",608],["T_ELSE","else",608],["T_WHITESPACE"," ",608],"{",["T_WHITESPACE","\n            ",608],["T_VARIABLE","$product",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","setOptionsValidationFail",609],"(",["T_STRING","true",609],")",";",["T_WHITESPACE","\n            ",609],["T_VARIABLE","$product",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getTypeInstance",610],"(",["T_STRING","true",610],")",["T_OBJECT_OPERATOR","->",610],["T_STRING","setStoreFilter",610],"(",["T_VARIABLE","$product",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getStoreId",610],"(",")",",",["T_WHITESPACE"," ",610],["T_VARIABLE","$product",610],")",";",["T_WHITESPACE","\n\n            ",610],["T_VARIABLE","$optionCollection",612],["T_WHITESPACE"," ",612],"=",["T_WHITESPACE"," ",612],["T_VARIABLE","$product",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","getTypeInstance",612],"(",["T_STRING","true",612],")",["T_OBJECT_OPERATOR","->",612],["T_STRING","getOptionsCollection",612],"(",["T_VARIABLE","$product",612],")",";",["T_WHITESPACE","\n\n            ",612],["T_VARIABLE","$optionIds",614],["T_WHITESPACE"," ",614],"=",["T_WHITESPACE"," ",614],["T_VARIABLE","$product",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","getTypeInstance",614],"(",["T_STRING","true",614],")",["T_OBJECT_OPERATOR","->",614],["T_STRING","getOptionsIds",614],"(",["T_VARIABLE","$product",614],")",";",["T_WHITESPACE","\n            ",614],["T_VARIABLE","$selectionIds",615],["T_WHITESPACE"," ",615],"=",["T_WHITESPACE"," ",615],["T_ARRAY","array",615],"(",")",";",["T_WHITESPACE","\n\n            ",615],["T_VARIABLE","$selectionCollection",617],["T_WHITESPACE"," ",617],"=",["T_WHITESPACE"," ",617],["T_VARIABLE","$product",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getTypeInstance",617],"(",["T_STRING","true",617],")",["T_WHITESPACE","\n                ",617],["T_OBJECT_OPERATOR","->",618],["T_STRING","getSelectionsCollection",618],"(",["T_WHITESPACE","\n                    ",618],["T_VARIABLE","$optionIds",619],",",["T_WHITESPACE","\n                    ",619],["T_VARIABLE","$product",620],["T_WHITESPACE","\n                ",620],")",";",["T_WHITESPACE","\n\n            ",621],["T_VARIABLE","$options",623],["T_WHITESPACE"," ",623],"=",["T_WHITESPACE"," ",623],["T_VARIABLE","$optionCollection",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","appendSelections",623],"(",["T_VARIABLE","$selectionCollection",623],",",["T_WHITESPACE"," ",623],["T_STRING","false",623],",",["T_WHITESPACE"," ",623],["T_VARIABLE","$_appendAllSelections",623],")",";",["T_WHITESPACE","\n\n            ",623],["T_FOREACH","foreach",625],["T_WHITESPACE"," ",625],"(",["T_VARIABLE","$options",625],["T_WHITESPACE"," ",625],["T_AS","as",625],["T_WHITESPACE"," ",625],["T_VARIABLE","$option",625],")",["T_WHITESPACE"," ",625],"{",["T_WHITESPACE","\n                ",625],["T_IF","if",626],["T_WHITESPACE"," ",626],"(",["T_VARIABLE","$option",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getRequired",626],"(",")",["T_WHITESPACE"," ",626],["T_BOOLEAN_AND","&&",626],["T_WHITESPACE"," ",626],["T_STRING","count",626],"(",["T_VARIABLE","$option",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getSelections",626],"(",")",")",["T_WHITESPACE"," ",626],["T_IS_EQUAL","==",626],["T_WHITESPACE"," ",626],["T_LNUMBER","1",626],")",["T_WHITESPACE"," ",626],"{",["T_WHITESPACE","\n                    ",626],["T_VARIABLE","$selections",627],["T_WHITESPACE"," ",627],"=",["T_WHITESPACE"," ",627],["T_STRING","array_merge",627],"(",["T_VARIABLE","$selections",627],",",["T_WHITESPACE"," ",627],["T_VARIABLE","$option",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","getSelections",627],"(",")",")",";",["T_WHITESPACE","\n                ",627],"}",["T_WHITESPACE"," ",628],["T_ELSE","else",628],["T_WHITESPACE"," ",628],"{",["T_WHITESPACE","\n                    ",628],["T_VARIABLE","$selections",629],["T_WHITESPACE"," ",629],"=",["T_WHITESPACE"," ",629],["T_ARRAY","array",629],"(",")",";",["T_WHITESPACE","\n                    ",629],["T_BREAK","break",630],";",["T_WHITESPACE","\n                ",630],"}",["T_WHITESPACE","\n            ",631],"}",["T_WHITESPACE","\n        ",632],"}",["T_WHITESPACE","\n        ",633],["T_IF","if",634],["T_WHITESPACE"," ",634],"(",["T_STRING","count",634],"(",["T_VARIABLE","$selections",634],")",["T_WHITESPACE"," ",634],">",["T_WHITESPACE"," ",634],["T_LNUMBER","0",634],["T_WHITESPACE"," ",634],["T_BOOLEAN_OR","||",634],["T_WHITESPACE"," ",634],"!",["T_VARIABLE","$isStrictProcessMode",634],")",["T_WHITESPACE"," ",634],"{",["T_WHITESPACE","\n            ",634],["T_VARIABLE","$uniqueKey",635],["T_WHITESPACE"," ",635],"=",["T_WHITESPACE"," ",635],["T_ARRAY","array",635],"(",["T_VARIABLE","$product",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","getId",635],"(",")",")",";",["T_WHITESPACE","\n            ",635],["T_VARIABLE","$selectionIds",636],["T_WHITESPACE"," ",636],"=",["T_WHITESPACE"," ",636],["T_ARRAY","array",636],"(",")",";",["T_WHITESPACE","\n\n            ",636],["T_COMMENT","\/\/ Shuffle selection array by option position\n",638],["T_WHITESPACE","            ",639],["T_STRING","usort",639],"(",["T_VARIABLE","$selections",639],",",["T_WHITESPACE"," ",639],["T_ARRAY","array",639],"(",["T_VARIABLE","$this",639],",",["T_WHITESPACE"," ",639],["T_CONSTANT_ENCAPSED_STRING","'shakeSelections'",639],")",")",";",["T_WHITESPACE","\n\n            ",639],["T_FOREACH","foreach",641],["T_WHITESPACE"," ",641],"(",["T_VARIABLE","$selections",641],["T_WHITESPACE"," ",641],["T_AS","as",641],["T_WHITESPACE"," ",641],["T_VARIABLE","$selection",641],")",["T_WHITESPACE"," ",641],"{",["T_WHITESPACE","\n                ",641],["T_IF","if",642],["T_WHITESPACE"," ",642],"(",["T_VARIABLE","$selection",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","getSelectionCanChangeQty",642],"(",")",["T_WHITESPACE"," ",642],["T_BOOLEAN_AND","&&",642],["T_WHITESPACE"," ",642],["T_ISSET","isset",642],"(",["T_VARIABLE","$qtys",642],"[",["T_VARIABLE","$selection",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","getOptionId",642],"(",")","]",")",")",["T_WHITESPACE"," ",642],"{",["T_WHITESPACE","\n                    ",642],["T_VARIABLE","$qty",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_DOUBLE_CAST","(float)",643],["T_VARIABLE","$qtys",643],"[",["T_VARIABLE","$selection",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","getOptionId",643],"(",")","]",["T_WHITESPACE"," ",643],">",["T_WHITESPACE"," ",643],["T_LNUMBER","0",643],["T_WHITESPACE"," ",643],"?",["T_WHITESPACE"," ",643],["T_VARIABLE","$qtys",643],"[",["T_VARIABLE","$selection",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","getOptionId",643],"(",")","]",["T_WHITESPACE"," ",643],":",["T_WHITESPACE"," ",643],["T_LNUMBER","1",643],";",["T_WHITESPACE","\n                ",643],"}",["T_WHITESPACE"," ",644],["T_ELSE","else",644],["T_WHITESPACE"," ",644],"{",["T_WHITESPACE","\n                    ",644],["T_VARIABLE","$qty",645],["T_WHITESPACE"," ",645],"=",["T_WHITESPACE"," ",645],["T_DOUBLE_CAST","(float)",645],["T_VARIABLE","$selection",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","getSelectionQty",645],"(",")",["T_WHITESPACE"," ",645],"?",["T_WHITESPACE"," ",645],["T_VARIABLE","$selection",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","getSelectionQty",645],"(",")",["T_WHITESPACE"," ",645],":",["T_WHITESPACE"," ",645],["T_LNUMBER","1",645],";",["T_WHITESPACE","\n                ",645],"}",["T_WHITESPACE","\n                ",646],["T_VARIABLE","$qty",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_DOUBLE_CAST","(float)",647],["T_VARIABLE","$qty",647],";",["T_WHITESPACE","\n\n                ",647],["T_VARIABLE","$product",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","addCustomOption",649],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_qty_'",649],["T_WHITESPACE"," ",649],".",["T_WHITESPACE"," ",649],["T_VARIABLE","$selection",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","getSelectionId",649],"(",")",",",["T_WHITESPACE"," ",649],["T_VARIABLE","$qty",649],",",["T_WHITESPACE"," ",649],["T_VARIABLE","$selection",649],")",";",["T_WHITESPACE","\n                ",649],["T_VARIABLE","$selection",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","addCustomOption",650],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",650],",",["T_WHITESPACE"," ",650],["T_VARIABLE","$selection",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getSelectionId",650],"(",")",")",";",["T_WHITESPACE","\n                ",650],["T_VARIABLE","$product",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","addCustomOption",651],"(",["T_CONSTANT_ENCAPSED_STRING","'product_qty_'",651],["T_WHITESPACE"," ",651],".",["T_WHITESPACE"," ",651],["T_VARIABLE","$selection",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","getId",651],"(",")",",",["T_WHITESPACE"," ",651],["T_VARIABLE","$qty",651],",",["T_WHITESPACE"," ",651],["T_VARIABLE","$selection",651],")",";",["T_WHITESPACE","\n\n                ",651],["T_COMMENT","\/*\n                 * Create extra attributes that will be converted to product options in order item\n                 * for selection (not for all bundle)\n                 *\/",653],["T_WHITESPACE","\n                ",656],["T_VARIABLE","$price",657],["T_WHITESPACE"," ",657],"=",["T_WHITESPACE"," ",657],["T_VARIABLE","$product",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","getPriceModel",657],"(",")",["T_OBJECT_OPERATOR","->",657],["T_STRING","getSelectionFinalTotalPrice",657],"(",["T_VARIABLE","$product",657],",",["T_WHITESPACE"," ",657],["T_VARIABLE","$selection",657],",",["T_WHITESPACE"," ",657],["T_LNUMBER","0",657],",",["T_WHITESPACE"," ",657],["T_VARIABLE","$qty",657],")",";",["T_WHITESPACE","\n                ",657],["T_VARIABLE","$attributes",658],["T_WHITESPACE"," ",658],"=",["T_WHITESPACE"," ",658],["T_ARRAY","array",658],"(",["T_WHITESPACE","\n                    ",658],["T_CONSTANT_ENCAPSED_STRING","'price'",659],["T_WHITESPACE","         ",659],["T_DOUBLE_ARROW","=>",659],["T_WHITESPACE"," ",659],["T_STRING","Mage",659],["T_DOUBLE_COLON","::",659],["T_STRING","app",659],"(",")",["T_OBJECT_OPERATOR","->",659],["T_STRING","getStore",659],"(",")",["T_OBJECT_OPERATOR","->",659],["T_STRING","convertPrice",659],"(",["T_VARIABLE","$price",659],")",",",["T_WHITESPACE","\n                    ",659],["T_CONSTANT_ENCAPSED_STRING","'qty'",660],["T_WHITESPACE","           ",660],["T_DOUBLE_ARROW","=>",660],["T_WHITESPACE"," ",660],["T_VARIABLE","$qty",660],",",["T_WHITESPACE","\n                    ",660],["T_CONSTANT_ENCAPSED_STRING","'option_label'",661],["T_WHITESPACE","  ",661],["T_DOUBLE_ARROW","=>",661],["T_WHITESPACE"," ",661],["T_VARIABLE","$selection",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","getOption",661],"(",")",["T_OBJECT_OPERATOR","->",661],["T_STRING","getTitle",661],"(",")",",",["T_WHITESPACE","\n                    ",661],["T_CONSTANT_ENCAPSED_STRING","'option_id'",662],["T_WHITESPACE","     ",662],["T_DOUBLE_ARROW","=>",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$selection",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","getOption",662],"(",")",["T_OBJECT_OPERATOR","->",662],["T_STRING","getId",662],"(",")",["T_WHITESPACE","\n                ",662],")",";",["T_WHITESPACE","\n\n                ",663],["T_VARIABLE","$_result",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$selection",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","getTypeInstance",665],"(",["T_STRING","true",665],")",["T_OBJECT_OPERATOR","->",665],["T_STRING","prepareForCart",665],"(",["T_VARIABLE","$buyRequest",665],",",["T_WHITESPACE"," ",665],["T_VARIABLE","$selection",665],")",";",["T_WHITESPACE","\n                ",665],["T_IF","if",666],["T_WHITESPACE"," ",666],"(",["T_STRING","is_string",666],"(",["T_VARIABLE","$_result",666],")",["T_WHITESPACE"," ",666],["T_BOOLEAN_AND","&&",666],["T_WHITESPACE"," ",666],"!",["T_STRING","is_array",666],"(",["T_VARIABLE","$_result",666],")",")",["T_WHITESPACE"," ",666],"{",["T_WHITESPACE","\n                    ",666],["T_RETURN","return",667],["T_WHITESPACE"," ",667],["T_VARIABLE","$_result",667],";",["T_WHITESPACE","\n                ",667],"}",["T_WHITESPACE","\n\n                ",668],["T_IF","if",670],["T_WHITESPACE"," ",670],"(","!",["T_ISSET","isset",670],"(",["T_VARIABLE","$_result",670],"[",["T_LNUMBER","0",670],"]",")",")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n                    ",670],["T_RETURN","return",671],["T_WHITESPACE"," ",671],["T_STRING","Mage",671],["T_DOUBLE_COLON","::",671],["T_STRING","helper",671],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",671],")",["T_OBJECT_OPERATOR","->",671],["T_STRING","__",671],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot add item to the shopping cart.'",671],")",";",["T_WHITESPACE","\n                ",671],"}",["T_WHITESPACE","\n\n                ",672],["T_VARIABLE","$result",674],"[","]",["T_WHITESPACE"," ",674],"=",["T_WHITESPACE"," ",674],["T_VARIABLE","$_result",674],"[",["T_LNUMBER","0",674],"]",["T_OBJECT_OPERATOR","->",674],["T_STRING","setParentProductId",674],"(",["T_VARIABLE","$product",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","getId",674],"(",")",")",["T_WHITESPACE","\n                    ",674],["T_OBJECT_OPERATOR","->",675],["T_STRING","addCustomOption",675],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_option_ids'",675],",",["T_WHITESPACE"," ",675],["T_STRING","serialize",675],"(",["T_STRING","array_map",675],"(",["T_CONSTANT_ENCAPSED_STRING","'intval'",675],",",["T_WHITESPACE"," ",675],["T_VARIABLE","$optionIds",675],")",")",")",["T_WHITESPACE","\n                    ",675],["T_OBJECT_OPERATOR","->",676],["T_STRING","addCustomOption",676],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_attributes'",676],",",["T_WHITESPACE"," ",676],["T_STRING","serialize",676],"(",["T_VARIABLE","$attributes",676],")",")",";",["T_WHITESPACE","\n\n                ",676],["T_IF","if",678],["T_WHITESPACE"," ",678],"(",["T_VARIABLE","$isStrictProcessMode",678],")",["T_WHITESPACE"," ",678],"{",["T_WHITESPACE","\n                    ",678],["T_VARIABLE","$_result",679],"[",["T_LNUMBER","0",679],"]",["T_OBJECT_OPERATOR","->",679],["T_STRING","setCartQty",679],"(",["T_VARIABLE","$qty",679],")",";",["T_WHITESPACE","\n                ",679],"}",["T_WHITESPACE","\n\n                ",680],["T_VARIABLE","$selectionIds",682],"[","]",["T_WHITESPACE"," ",682],"=",["T_WHITESPACE"," ",682],["T_VARIABLE","$_result",682],"[",["T_LNUMBER","0",682],"]",["T_OBJECT_OPERATOR","->",682],["T_STRING","getSelectionId",682],"(",")",";",["T_WHITESPACE","\n                ",682],["T_VARIABLE","$uniqueKey",683],"[","]",["T_WHITESPACE"," ",683],"=",["T_WHITESPACE"," ",683],["T_VARIABLE","$_result",683],"[",["T_LNUMBER","0",683],"]",["T_OBJECT_OPERATOR","->",683],["T_STRING","getSelectionId",683],"(",")",";",["T_WHITESPACE","\n                ",683],["T_VARIABLE","$uniqueKey",684],"[","]",["T_WHITESPACE"," ",684],"=",["T_WHITESPACE"," ",684],["T_VARIABLE","$qty",684],";",["T_WHITESPACE","\n            ",684],"}",["T_WHITESPACE","\n\n            ",685],["T_COMMENT","\/\/ \"unique\" key for bundle selection and add it to selections and bundle for selections\n",687],["T_WHITESPACE","            ",688],["T_VARIABLE","$uniqueKey",688],["T_WHITESPACE"," ",688],"=",["T_WHITESPACE"," ",688],["T_STRING","implode",688],"(",["T_CONSTANT_ENCAPSED_STRING","'_'",688],",",["T_WHITESPACE"," ",688],["T_VARIABLE","$uniqueKey",688],")",";",["T_WHITESPACE","\n            ",688],["T_FOREACH","foreach",689],["T_WHITESPACE"," ",689],"(",["T_VARIABLE","$result",689],["T_WHITESPACE"," ",689],["T_AS","as",689],["T_WHITESPACE"," ",689],["T_VARIABLE","$item",689],")",["T_WHITESPACE"," ",689],"{",["T_WHITESPACE","\n                ",689],["T_VARIABLE","$item",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","addCustomOption",690],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_identity'",690],",",["T_WHITESPACE"," ",690],["T_VARIABLE","$uniqueKey",690],")",";",["T_WHITESPACE","\n            ",690],"}",["T_WHITESPACE","\n            ",691],["T_VARIABLE","$product",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","addCustomOption",692],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_option_ids'",692],",",["T_WHITESPACE"," ",692],["T_STRING","serialize",692],"(",["T_STRING","array_map",692],"(",["T_CONSTANT_ENCAPSED_STRING","'intval'",692],",",["T_WHITESPACE"," ",692],["T_VARIABLE","$optionIds",692],")",")",")",";",["T_WHITESPACE","\n            ",692],["T_VARIABLE","$product",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","addCustomOption",693],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_ids'",693],",",["T_WHITESPACE"," ",693],["T_STRING","serialize",693],"(",["T_VARIABLE","$selectionIds",693],")",")",";",["T_WHITESPACE","\n\n            ",693],["T_RETURN","return",695],["T_WHITESPACE"," ",695],["T_VARIABLE","$result",695],";",["T_WHITESPACE","\n        ",695],"}",["T_WHITESPACE","\n\n        ",696],["T_RETURN","return",698],["T_WHITESPACE"," ",698],["T_VARIABLE","$this",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","getSpecifyOptionMessage",698],"(",")",";",["T_WHITESPACE","\n    ",698],"}",["T_WHITESPACE","\n\n    ",699],["T_DOC_COMMENT","\/**\n     * Retrieve message for specify option(s)\n     *\n     * @return string\n     *\/",701],["T_WHITESPACE","\n    ",705],["T_PUBLIC","public",706],["T_WHITESPACE"," ",706],["T_FUNCTION","function",706],["T_WHITESPACE"," ",706],["T_STRING","getSpecifyOptionMessage",706],"(",")",["T_WHITESPACE","\n    ",706],"{",["T_WHITESPACE","\n        ",707],["T_RETURN","return",708],["T_WHITESPACE"," ",708],["T_STRING","Mage",708],["T_DOUBLE_COLON","::",708],["T_STRING","helper",708],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",708],")",["T_OBJECT_OPERATOR","->",708],["T_STRING","__",708],"(",["T_CONSTANT_ENCAPSED_STRING","'Please specify product option(s).'",708],")",";",["T_WHITESPACE","\n    ",708],"}",["T_WHITESPACE","\n\n    ",709],["T_DOC_COMMENT","\/**\n     * Retrieve bundle selections collection based on ids\n     *\n     * @param array $selectionIds\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Mysql4_Selection_Collection\n     *\/",711],["T_WHITESPACE","\n    ",717],["T_PUBLIC","public",718],["T_WHITESPACE"," ",718],["T_FUNCTION","function",718],["T_WHITESPACE"," ",718],["T_STRING","getSelectionsByIds",718],"(",["T_VARIABLE","$selectionIds",718],",",["T_WHITESPACE"," ",718],["T_VARIABLE","$product",718],["T_WHITESPACE"," ",718],"=",["T_WHITESPACE"," ",718],["T_STRING","null",718],")",["T_WHITESPACE","\n    ",718],"{",["T_WHITESPACE","\n        ",719],["T_STRING","sort",720],"(",["T_VARIABLE","$selectionIds",720],")",";",["T_WHITESPACE","\n\n        ",720],["T_VARIABLE","$usedSelections",722],["T_WHITESPACE","     ",722],"=",["T_WHITESPACE"," ",722],["T_VARIABLE","$this",722],["T_OBJECT_OPERATOR","->",722],["T_STRING","getProduct",722],"(",["T_VARIABLE","$product",722],")",["T_OBJECT_OPERATOR","->",722],["T_STRING","getData",722],"(",["T_VARIABLE","$this",722],["T_OBJECT_OPERATOR","->",722],["T_STRING","_keyUsedSelections",722],")",";",["T_WHITESPACE","\n        ",722],["T_VARIABLE","$usedSelectionsIds",723],["T_WHITESPACE","  ",723],"=",["T_WHITESPACE"," ",723],["T_VARIABLE","$this",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","getProduct",723],"(",["T_VARIABLE","$product",723],")",["T_OBJECT_OPERATOR","->",723],["T_STRING","getData",723],"(",["T_VARIABLE","$this",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","_keyUsedSelectionsIds",723],")",";",["T_WHITESPACE","\n\n        ",723],["T_IF","if",725],["T_WHITESPACE"," ",725],"(","!",["T_VARIABLE","$usedSelections",725],["T_WHITESPACE"," ",725],["T_BOOLEAN_OR","||",725],["T_WHITESPACE"," ",725],["T_STRING","serialize",725],"(",["T_VARIABLE","$usedSelectionsIds",725],")",["T_WHITESPACE"," ",725],["T_IS_NOT_EQUAL","!=",725],["T_WHITESPACE"," ",725],["T_STRING","serialize",725],"(",["T_VARIABLE","$selectionIds",725],")",")",["T_WHITESPACE"," ",725],"{",["T_WHITESPACE","\n            ",725],["T_VARIABLE","$storeId",726],["T_WHITESPACE"," ",726],"=",["T_WHITESPACE"," ",726],["T_VARIABLE","$this",726],["T_OBJECT_OPERATOR","->",726],["T_STRING","getProduct",726],"(",["T_VARIABLE","$product",726],")",["T_OBJECT_OPERATOR","->",726],["T_STRING","getStoreId",726],"(",")",";",["T_WHITESPACE","\n            ",726],["T_VARIABLE","$usedSelections",727],["T_WHITESPACE"," ",727],"=",["T_WHITESPACE"," ",727],["T_STRING","Mage",727],["T_DOUBLE_COLON","::",727],["T_STRING","getResourceModel",727],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection_collection'",727],")",["T_WHITESPACE","\n                ",727],["T_OBJECT_OPERATOR","->",728],["T_STRING","addAttributeToSelect",728],"(",["T_CONSTANT_ENCAPSED_STRING","'*'",728],")",["T_WHITESPACE","\n                ",728],["T_OBJECT_OPERATOR","->",729],["T_STRING","setFlag",729],"(",["T_CONSTANT_ENCAPSED_STRING","'require_stock_items'",729],",",["T_WHITESPACE"," ",729],["T_STRING","true",729],")",["T_WHITESPACE","\n                ",729],["T_OBJECT_OPERATOR","->",730],["T_STRING","setFlag",730],"(",["T_CONSTANT_ENCAPSED_STRING","'product_children'",730],",",["T_WHITESPACE"," ",730],["T_STRING","true",730],")",["T_WHITESPACE","\n                ",730],["T_OBJECT_OPERATOR","->",731],["T_STRING","addStoreFilter",731],"(",["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getStoreFilter",731],"(",["T_VARIABLE","$product",731],")",")",["T_WHITESPACE","\n                ",731],["T_OBJECT_OPERATOR","->",732],["T_STRING","setStoreId",732],"(",["T_VARIABLE","$storeId",732],")",["T_WHITESPACE","\n                ",732],["T_OBJECT_OPERATOR","->",733],["T_STRING","setPositionOrder",733],"(",")",["T_WHITESPACE","\n                ",733],["T_OBJECT_OPERATOR","->",734],["T_STRING","addFilterByRequiredOptions",734],"(",")",["T_WHITESPACE","\n                ",734],["T_OBJECT_OPERATOR","->",735],["T_STRING","setSelectionIdsFilter",735],"(",["T_VARIABLE","$selectionIds",735],")",";",["T_WHITESPACE","\n\n                ",735],["T_IF","if",737],["T_WHITESPACE"," ",737],"(","!",["T_STRING","Mage",737],["T_DOUBLE_COLON","::",737],["T_STRING","helper",737],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",737],")",["T_OBJECT_OPERATOR","->",737],["T_STRING","isPriceGlobal",737],"(",")",["T_WHITESPACE"," ",737],["T_BOOLEAN_AND","&&",737],["T_WHITESPACE"," ",737],["T_VARIABLE","$storeId",737],")",["T_WHITESPACE"," ",737],"{",["T_WHITESPACE","\n                    ",737],["T_VARIABLE","$websiteId",738],["T_WHITESPACE"," ",738],"=",["T_WHITESPACE"," ",738],["T_STRING","Mage",738],["T_DOUBLE_COLON","::",738],["T_STRING","app",738],"(",")",["T_OBJECT_OPERATOR","->",738],["T_STRING","getStore",738],"(",["T_VARIABLE","$storeId",738],")",["T_OBJECT_OPERATOR","->",738],["T_STRING","getWebsiteId",738],"(",")",";",["T_WHITESPACE","\n                    ",738],["T_VARIABLE","$usedSelections",739],["T_OBJECT_OPERATOR","->",739],["T_STRING","joinPrices",739],"(",["T_VARIABLE","$websiteId",739],")",";",["T_WHITESPACE","\n                ",739],"}",["T_WHITESPACE","\n            ",740],["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","getProduct",741],"(",["T_VARIABLE","$product",741],")",["T_OBJECT_OPERATOR","->",741],["T_STRING","setData",741],"(",["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","_keyUsedSelections",741],",",["T_WHITESPACE"," ",741],["T_VARIABLE","$usedSelections",741],")",";",["T_WHITESPACE","\n            ",741],["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","getProduct",742],"(",["T_VARIABLE","$product",742],")",["T_OBJECT_OPERATOR","->",742],["T_STRING","setData",742],"(",["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","_keyUsedSelectionsIds",742],",",["T_WHITESPACE"," ",742],["T_VARIABLE","$selectionIds",742],")",";",["T_WHITESPACE","\n        ",742],"}",["T_WHITESPACE","\n        ",743],["T_RETURN","return",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$usedSelections",744],";",["T_WHITESPACE","\n    ",744],"}",["T_WHITESPACE","\n\n    ",745],["T_DOC_COMMENT","\/**\n     * Retrieve bundle options collection based on ids\n     *\n     * @param array $optionIds\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Mysql4_Option_Collection\n     *\/",747],["T_WHITESPACE","\n    ",753],["T_PUBLIC","public",754],["T_WHITESPACE"," ",754],["T_FUNCTION","function",754],["T_WHITESPACE"," ",754],["T_STRING","getOptionsByIds",754],"(",["T_VARIABLE","$optionIds",754],",",["T_WHITESPACE"," ",754],["T_VARIABLE","$product",754],["T_WHITESPACE"," ",754],"=",["T_WHITESPACE"," ",754],["T_STRING","null",754],")",["T_WHITESPACE","\n    ",754],"{",["T_WHITESPACE","\n        ",755],["T_STRING","sort",756],"(",["T_VARIABLE","$optionIds",756],")",";",["T_WHITESPACE","\n\n        ",756],["T_VARIABLE","$usedOptions",758],["T_WHITESPACE","     ",758],"=",["T_WHITESPACE"," ",758],["T_VARIABLE","$this",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","getProduct",758],"(",["T_VARIABLE","$product",758],")",["T_OBJECT_OPERATOR","->",758],["T_STRING","getData",758],"(",["T_VARIABLE","$this",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","_keyUsedOptions",758],")",";",["T_WHITESPACE","\n        ",758],["T_VARIABLE","$usedOptionsIds",759],["T_WHITESPACE","  ",759],"=",["T_WHITESPACE"," ",759],["T_VARIABLE","$this",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","getProduct",759],"(",["T_VARIABLE","$product",759],")",["T_OBJECT_OPERATOR","->",759],["T_STRING","getData",759],"(",["T_VARIABLE","$this",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","_keyUsedOptionsIds",759],")",";",["T_WHITESPACE","\n\n        ",759],["T_IF","if",761],["T_WHITESPACE"," ",761],"(","!",["T_VARIABLE","$usedOptions",761],["T_WHITESPACE"," ",761],["T_BOOLEAN_OR","||",761],["T_WHITESPACE"," ",761],["T_STRING","serialize",761],"(",["T_VARIABLE","$usedOptionsIds",761],")",["T_WHITESPACE"," ",761],["T_IS_NOT_EQUAL","!=",761],["T_WHITESPACE"," ",761],["T_STRING","serialize",761],"(",["T_VARIABLE","$optionIds",761],")",")",["T_WHITESPACE"," ",761],"{",["T_WHITESPACE","\n            ",761],["T_VARIABLE","$usedOptions",762],["T_WHITESPACE"," ",762],"=",["T_WHITESPACE"," ",762],["T_STRING","Mage",762],["T_DOUBLE_COLON","::",762],["T_STRING","getModel",762],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option'",762],")",["T_OBJECT_OPERATOR","->",762],["T_STRING","getResourceCollection",762],"(",")",["T_WHITESPACE","\n                ",762],["T_OBJECT_OPERATOR","->",763],["T_STRING","setProductIdFilter",763],"(",["T_VARIABLE","$this",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","getProduct",763],"(",["T_VARIABLE","$product",763],")",["T_OBJECT_OPERATOR","->",763],["T_STRING","getId",763],"(",")",")",["T_WHITESPACE","\n                ",763],["T_OBJECT_OPERATOR","->",764],["T_STRING","setPositionOrder",764],"(",")",["T_WHITESPACE","\n                ",764],["T_OBJECT_OPERATOR","->",765],["T_STRING","joinValues",765],"(",["T_STRING","Mage",765],["T_DOUBLE_COLON","::",765],["T_STRING","app",765],"(",")",["T_OBJECT_OPERATOR","->",765],["T_STRING","getStore",765],"(",")",["T_OBJECT_OPERATOR","->",765],["T_STRING","getId",765],"(",")",")",["T_WHITESPACE","\n                ",765],["T_OBJECT_OPERATOR","->",766],["T_STRING","setIdFilter",766],"(",["T_VARIABLE","$optionIds",766],")",";",["T_WHITESPACE","\n            ",766],["T_VARIABLE","$this",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","getProduct",767],"(",["T_VARIABLE","$product",767],")",["T_OBJECT_OPERATOR","->",767],["T_STRING","setData",767],"(",["T_VARIABLE","$this",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","_keyUsedOptions",767],",",["T_WHITESPACE"," ",767],["T_VARIABLE","$usedOptions",767],")",";",["T_WHITESPACE","\n            ",767],["T_VARIABLE","$this",768],["T_OBJECT_OPERATOR","->",768],["T_STRING","getProduct",768],"(",["T_VARIABLE","$product",768],")",["T_OBJECT_OPERATOR","->",768],["T_STRING","setData",768],"(",["T_VARIABLE","$this",768],["T_OBJECT_OPERATOR","->",768],["T_STRING","_keyUsedOptionsIds",768],",",["T_WHITESPACE"," ",768],["T_VARIABLE","$optionIds",768],")",";",["T_WHITESPACE","\n        ",768],"}",["T_WHITESPACE","\n        ",769],["T_RETURN","return",770],["T_WHITESPACE"," ",770],["T_VARIABLE","$usedOptions",770],";",["T_WHITESPACE","\n    ",770],"}",["T_WHITESPACE","\n\n    ",771],["T_DOC_COMMENT","\/**\n     * Prepare additional options\/information for order item which will be\n     * created from this product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",773],["T_WHITESPACE","\n    ",779],["T_PUBLIC","public",780],["T_WHITESPACE"," ",780],["T_FUNCTION","function",780],["T_WHITESPACE"," ",780],["T_STRING","getOrderOptions",780],"(",["T_VARIABLE","$product",780],["T_WHITESPACE"," ",780],"=",["T_WHITESPACE"," ",780],["T_STRING","null",780],")",["T_WHITESPACE","\n    ",780],"{",["T_WHITESPACE","\n        ",781],["T_VARIABLE","$optionArr",782],["T_WHITESPACE"," ",782],"=",["T_WHITESPACE"," ",782],["T_STRING","parent",782],["T_DOUBLE_COLON","::",782],["T_STRING","getOrderOptions",782],"(",["T_VARIABLE","$product",782],")",";",["T_WHITESPACE","\n\n        ",782],["T_VARIABLE","$bundleOptions",784],["T_WHITESPACE"," ",784],"=",["T_WHITESPACE"," ",784],["T_ARRAY","array",784],"(",")",";",["T_WHITESPACE","\n\n        ",784],["T_VARIABLE","$product",786],["T_WHITESPACE"," ",786],"=",["T_WHITESPACE"," ",786],["T_VARIABLE","$this",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","getProduct",786],"(",["T_VARIABLE","$product",786],")",";",["T_WHITESPACE","\n\n        ",786],["T_IF","if",788],["T_WHITESPACE"," ",788],"(",["T_VARIABLE","$product",788],["T_OBJECT_OPERATOR","->",788],["T_STRING","hasCustomOptions",788],"(",")",")",["T_WHITESPACE"," ",788],"{",["T_WHITESPACE","\n            ",788],["T_VARIABLE","$customOption",789],["T_WHITESPACE"," ",789],"=",["T_WHITESPACE"," ",789],["T_VARIABLE","$product",789],["T_OBJECT_OPERATOR","->",789],["T_STRING","getCustomOption",789],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_option_ids'",789],")",";",["T_WHITESPACE","\n            ",789],["T_VARIABLE","$optionIds",790],["T_WHITESPACE"," ",790],"=",["T_WHITESPACE"," ",790],["T_STRING","unserialize",790],"(",["T_VARIABLE","$customOption",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","getValue",790],"(",")",")",";",["T_WHITESPACE","\n            ",790],["T_VARIABLE","$options",791],["T_WHITESPACE"," ",791],"=",["T_WHITESPACE"," ",791],["T_VARIABLE","$this",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","getOptionsByIds",791],"(",["T_VARIABLE","$optionIds",791],",",["T_WHITESPACE"," ",791],["T_VARIABLE","$product",791],")",";",["T_WHITESPACE","\n            ",791],["T_VARIABLE","$customOption",792],["T_WHITESPACE"," ",792],"=",["T_WHITESPACE"," ",792],["T_VARIABLE","$product",792],["T_OBJECT_OPERATOR","->",792],["T_STRING","getCustomOption",792],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_ids'",792],")",";",["T_WHITESPACE","\n            ",792],["T_VARIABLE","$selectionIds",793],["T_WHITESPACE"," ",793],"=",["T_WHITESPACE"," ",793],["T_STRING","unserialize",793],"(",["T_VARIABLE","$customOption",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","getValue",793],"(",")",")",";",["T_WHITESPACE","\n            ",793],["T_VARIABLE","$selections",794],["T_WHITESPACE"," ",794],"=",["T_WHITESPACE"," ",794],["T_VARIABLE","$this",794],["T_OBJECT_OPERATOR","->",794],["T_STRING","getSelectionsByIds",794],"(",["T_VARIABLE","$selectionIds",794],",",["T_WHITESPACE"," ",794],["T_VARIABLE","$product",794],")",";",["T_WHITESPACE","\n            ",794],["T_FOREACH","foreach",795],["T_WHITESPACE"," ",795],"(",["T_VARIABLE","$selections",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","getItems",795],"(",")",["T_WHITESPACE"," ",795],["T_AS","as",795],["T_WHITESPACE"," ",795],["T_VARIABLE","$selection",795],")",["T_WHITESPACE"," ",795],"{",["T_WHITESPACE","\n                ",795],["T_IF","if",796],["T_WHITESPACE"," ",796],"(",["T_VARIABLE","$selection",796],["T_OBJECT_OPERATOR","->",796],["T_STRING","isSalable",796],"(",")",")",["T_WHITESPACE"," ",796],"{",["T_WHITESPACE","\n                    ",796],["T_VARIABLE","$selectionQty",797],["T_WHITESPACE"," ",797],"=",["T_WHITESPACE"," ",797],["T_VARIABLE","$product",797],["T_OBJECT_OPERATOR","->",797],["T_STRING","getCustomOption",797],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_qty_'",797],["T_WHITESPACE"," ",797],".",["T_WHITESPACE"," ",797],["T_VARIABLE","$selection",797],["T_OBJECT_OPERATOR","->",797],["T_STRING","getSelectionId",797],"(",")",")",";",["T_WHITESPACE","\n                    ",797],["T_IF","if",798],["T_WHITESPACE"," ",798],"(",["T_VARIABLE","$selectionQty",798],")",["T_WHITESPACE"," ",798],"{",["T_WHITESPACE","\n                        ",798],["T_VARIABLE","$price",799],["T_WHITESPACE"," ",799],"=",["T_WHITESPACE"," ",799],["T_VARIABLE","$product",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","getPriceModel",799],"(",")",["T_OBJECT_OPERATOR","->",799],["T_STRING","getSelectionFinalTotalPrice",799],"(",["T_VARIABLE","$product",799],",",["T_WHITESPACE"," ",799],["T_VARIABLE","$selection",799],",",["T_WHITESPACE"," ",799],["T_LNUMBER","0",799],",",["T_WHITESPACE","\n                            ",799],["T_VARIABLE","$selectionQty",800],["T_OBJECT_OPERATOR","->",800],["T_STRING","getValue",800],"(",")",["T_WHITESPACE","\n                        ",800],")",";",["T_WHITESPACE","\n\n                        ",801],["T_VARIABLE","$option",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_VARIABLE","$options",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","getItemById",803],"(",["T_VARIABLE","$selection",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","getOptionId",803],"(",")",")",";",["T_WHITESPACE","\n                        ",803],["T_IF","if",804],["T_WHITESPACE"," ",804],"(","!",["T_ISSET","isset",804],"(",["T_VARIABLE","$bundleOptions",804],"[",["T_VARIABLE","$option",804],["T_OBJECT_OPERATOR","->",804],["T_STRING","getId",804],"(",")","]",")",")",["T_WHITESPACE"," ",804],"{",["T_WHITESPACE","\n                            ",804],["T_VARIABLE","$bundleOptions",805],"[",["T_VARIABLE","$option",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","getId",805],"(",")","]",["T_WHITESPACE"," ",805],"=",["T_WHITESPACE"," ",805],["T_ARRAY","array",805],"(",["T_WHITESPACE","\n                                ",805],["T_CONSTANT_ENCAPSED_STRING","'option_id'",806],["T_WHITESPACE"," ",806],["T_DOUBLE_ARROW","=>",806],["T_WHITESPACE"," ",806],["T_VARIABLE","$option",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getId",806],"(",")",",",["T_WHITESPACE","\n                                ",806],["T_CONSTANT_ENCAPSED_STRING","'label'",807],["T_WHITESPACE"," ",807],["T_DOUBLE_ARROW","=>",807],["T_WHITESPACE"," ",807],["T_VARIABLE","$option",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","getTitle",807],"(",")",",",["T_WHITESPACE","\n                                ",807],["T_CONSTANT_ENCAPSED_STRING","'value'",808],["T_WHITESPACE"," ",808],["T_DOUBLE_ARROW","=>",808],["T_WHITESPACE"," ",808],["T_ARRAY","array",808],"(",")",["T_WHITESPACE","\n                            ",808],")",";",["T_WHITESPACE","\n                        ",809],"}",["T_WHITESPACE","\n\n                        ",810],["T_VARIABLE","$bundleOptions",812],"[",["T_VARIABLE","$option",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","getId",812],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'value'",812],"]","[","]",["T_WHITESPACE"," ",812],"=",["T_WHITESPACE"," ",812],["T_ARRAY","array",812],"(",["T_WHITESPACE","\n                            ",812],["T_CONSTANT_ENCAPSED_STRING","'title'",813],["T_WHITESPACE"," ",813],["T_DOUBLE_ARROW","=>",813],["T_WHITESPACE"," ",813],["T_VARIABLE","$selection",813],["T_OBJECT_OPERATOR","->",813],["T_STRING","getName",813],"(",")",",",["T_WHITESPACE","\n                            ",813],["T_CONSTANT_ENCAPSED_STRING","'qty'",814],["T_WHITESPACE","   ",814],["T_DOUBLE_ARROW","=>",814],["T_WHITESPACE"," ",814],["T_VARIABLE","$selectionQty",814],["T_OBJECT_OPERATOR","->",814],["T_STRING","getValue",814],"(",")",",",["T_WHITESPACE","\n                            ",814],["T_CONSTANT_ENCAPSED_STRING","'price'",815],["T_WHITESPACE"," ",815],["T_DOUBLE_ARROW","=>",815],["T_WHITESPACE"," ",815],["T_STRING","Mage",815],["T_DOUBLE_COLON","::",815],["T_STRING","app",815],"(",")",["T_OBJECT_OPERATOR","->",815],["T_STRING","getStore",815],"(",")",["T_OBJECT_OPERATOR","->",815],["T_STRING","convertPrice",815],"(",["T_VARIABLE","$price",815],")",["T_WHITESPACE","\n                        ",815],")",";",["T_WHITESPACE","\n\n                    ",816],"}",["T_WHITESPACE","\n                ",818],"}",["T_WHITESPACE","\n            ",819],"}",["T_WHITESPACE","\n        ",820],"}",["T_WHITESPACE","\n\n        ",821],["T_VARIABLE","$optionArr",823],"[",["T_CONSTANT_ENCAPSED_STRING","'bundle_options'",823],"]",["T_WHITESPACE"," ",823],"=",["T_WHITESPACE"," ",823],["T_VARIABLE","$bundleOptions",823],";",["T_WHITESPACE","\n\n        ",823],["T_DOC_COMMENT","\/**\n         * Product Prices calculations save\n         *\/",825],["T_WHITESPACE","\n        ",827],["T_IF","if",828],["T_WHITESPACE"," ",828],"(",["T_VARIABLE","$product",828],["T_OBJECT_OPERATOR","->",828],["T_STRING","getPriceType",828],"(",")",")",["T_WHITESPACE"," ",828],"{",["T_WHITESPACE","\n            ",828],["T_VARIABLE","$optionArr",829],"[",["T_CONSTANT_ENCAPSED_STRING","'product_calculations'",829],"]",["T_WHITESPACE"," ",829],"=",["T_WHITESPACE"," ",829],["T_STRING","self",829],["T_DOUBLE_COLON","::",829],["T_STRING","CALCULATE_PARENT",829],";",["T_WHITESPACE","\n        ",829],"}",["T_WHITESPACE"," ",830],["T_ELSE","else",830],["T_WHITESPACE"," ",830],"{",["T_WHITESPACE","\n            ",830],["T_VARIABLE","$optionArr",831],"[",["T_CONSTANT_ENCAPSED_STRING","'product_calculations'",831],"]",["T_WHITESPACE"," ",831],"=",["T_WHITESPACE"," ",831],["T_STRING","self",831],["T_DOUBLE_COLON","::",831],["T_STRING","CALCULATE_CHILD",831],";",["T_WHITESPACE","\n        ",831],"}",["T_WHITESPACE","\n\n        ",832],["T_VARIABLE","$optionArr",834],"[",["T_CONSTANT_ENCAPSED_STRING","'shipment_type'",834],"]",["T_WHITESPACE"," ",834],"=",["T_WHITESPACE"," ",834],["T_VARIABLE","$product",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","getShipmentType",834],"(",")",";",["T_WHITESPACE","\n\n        ",834],["T_RETURN","return",836],["T_WHITESPACE"," ",836],["T_VARIABLE","$optionArr",836],";",["T_WHITESPACE","\n    ",836],"}",["T_WHITESPACE","\n\n    ",837],["T_DOC_COMMENT","\/**\n     * Sort selections method for usort function\n     * Sort selections by option position, selection position and selection id\n     *\n     * @param  Mage_Catalog_Model_Product $a\n     * @param  Mage_Catalog_Model_Product $b\n     * @return int\n     *\/",839],["T_WHITESPACE","\n    ",846],["T_PUBLIC","public",847],["T_WHITESPACE"," ",847],["T_FUNCTION","function",847],["T_WHITESPACE"," ",847],["T_STRING","shakeSelections",847],"(",["T_VARIABLE","$a",847],",",["T_WHITESPACE"," ",847],["T_VARIABLE","$b",847],")",["T_WHITESPACE","\n    ",847],"{",["T_WHITESPACE","\n        ",848],["T_VARIABLE","$aPosition",849],["T_WHITESPACE"," ",849],"=",["T_WHITESPACE"," ",849],["T_ARRAY","array",849],"(",["T_WHITESPACE","\n            ",849],["T_VARIABLE","$a",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","getOption",850],"(",")",["T_OBJECT_OPERATOR","->",850],["T_STRING","getPosition",850],"(",")",",",["T_WHITESPACE","\n            ",850],["T_VARIABLE","$a",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","getOptionId",851],"(",")",",",["T_WHITESPACE","\n            ",851],["T_VARIABLE","$a",852],["T_OBJECT_OPERATOR","->",852],["T_STRING","getPosition",852],"(",")",",",["T_WHITESPACE","\n            ",852],["T_VARIABLE","$a",853],["T_OBJECT_OPERATOR","->",853],["T_STRING","getSelectionId",853],"(",")",["T_WHITESPACE","\n        ",853],")",";",["T_WHITESPACE","\n        ",854],["T_VARIABLE","$bPosition",855],["T_WHITESPACE"," ",855],"=",["T_WHITESPACE"," ",855],["T_ARRAY","array",855],"(",["T_WHITESPACE","\n            ",855],["T_VARIABLE","$b",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","getOption",856],"(",")",["T_OBJECT_OPERATOR","->",856],["T_STRING","getPosition",856],"(",")",",",["T_WHITESPACE","\n            ",856],["T_VARIABLE","$b",857],["T_OBJECT_OPERATOR","->",857],["T_STRING","getOptionId",857],"(",")",",",["T_WHITESPACE","\n            ",857],["T_VARIABLE","$b",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","getPosition",858],"(",")",",",["T_WHITESPACE","\n            ",858],["T_VARIABLE","$b",859],["T_OBJECT_OPERATOR","->",859],["T_STRING","getSelectionId",859],"(",")",["T_WHITESPACE","\n        ",859],")",";",["T_WHITESPACE","\n        ",860],["T_IF","if",861],["T_WHITESPACE"," ",861],"(",["T_VARIABLE","$aPosition",861],["T_WHITESPACE"," ",861],["T_IS_EQUAL","==",861],["T_WHITESPACE"," ",861],["T_VARIABLE","$bPosition",861],")",["T_WHITESPACE"," ",861],"{",["T_WHITESPACE","\n            ",861],["T_RETURN","return",862],["T_WHITESPACE"," ",862],["T_LNUMBER","0",862],";",["T_WHITESPACE","\n        ",862],"}",["T_WHITESPACE"," ",863],["T_ELSE","else",863],["T_WHITESPACE"," ",863],"{",["T_WHITESPACE","\n            ",863],["T_RETURN","return",864],["T_WHITESPACE"," ",864],["T_VARIABLE","$aPosition",864],["T_WHITESPACE"," ",864],"<",["T_WHITESPACE"," ",864],["T_VARIABLE","$bPosition",864],["T_WHITESPACE"," ",864],"?",["T_WHITESPACE"," ",864],"-",["T_LNUMBER","1",864],["T_WHITESPACE"," ",864],":",["T_WHITESPACE"," ",864],["T_LNUMBER","1",864],";",["T_WHITESPACE","\n        ",864],"}",["T_WHITESPACE","\n    ",865],"}",["T_WHITESPACE","\n\n    ",866],["T_DOC_COMMENT","\/**\n     * Return true if product has options\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",868],["T_WHITESPACE","\n    ",873],["T_PUBLIC","public",874],["T_WHITESPACE"," ",874],["T_FUNCTION","function",874],["T_WHITESPACE"," ",874],["T_STRING","hasOptions",874],"(",["T_VARIABLE","$product",874],["T_WHITESPACE"," ",874],"=",["T_WHITESPACE"," ",874],["T_STRING","null",874],")",["T_WHITESPACE","\n    ",874],"{",["T_WHITESPACE","\n        ",875],["T_VARIABLE","$product",876],["T_WHITESPACE","    ",876],"=",["T_WHITESPACE"," ",876],["T_VARIABLE","$this",876],["T_OBJECT_OPERATOR","->",876],["T_STRING","getProduct",876],"(",["T_VARIABLE","$product",876],")",";",["T_WHITESPACE","\n        ",876],["T_VARIABLE","$this",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","setStoreFilter",877],"(",["T_VARIABLE","$product",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","getStoreId",877],"(",")",",",["T_WHITESPACE"," ",877],["T_VARIABLE","$product",877],")",";",["T_WHITESPACE","\n        ",877],["T_VARIABLE","$optionIds",878],["T_WHITESPACE","  ",878],"=",["T_WHITESPACE"," ",878],["T_VARIABLE","$this",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","getOptionsCollection",878],"(",["T_VARIABLE","$product",878],")",["T_OBJECT_OPERATOR","->",878],["T_STRING","getAllIds",878],"(",")",";",["T_WHITESPACE","\n        ",878],["T_VARIABLE","$collection",879],["T_WHITESPACE"," ",879],"=",["T_WHITESPACE"," ",879],["T_VARIABLE","$this",879],["T_OBJECT_OPERATOR","->",879],["T_STRING","getSelectionsCollection",879],"(",["T_VARIABLE","$optionIds",879],",",["T_WHITESPACE"," ",879],["T_VARIABLE","$product",879],")",";",["T_WHITESPACE","\n\n        ",879],["T_IF","if",881],["T_WHITESPACE"," ",881],"(",["T_STRING","count",881],"(",["T_VARIABLE","$collection",881],")",["T_WHITESPACE"," ",881],">",["T_WHITESPACE"," ",881],["T_LNUMBER","0",881],["T_WHITESPACE"," ",881],["T_BOOLEAN_OR","||",881],["T_WHITESPACE"," ",881],["T_VARIABLE","$product",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","getOptions",881],"(",")",")",["T_WHITESPACE"," ",881],"{",["T_WHITESPACE","\n            ",881],["T_RETURN","return",882],["T_WHITESPACE"," ",882],["T_STRING","true",882],";",["T_WHITESPACE","\n        ",882],"}",["T_WHITESPACE","\n\n        ",883],["T_RETURN","return",885],["T_WHITESPACE"," ",885],["T_STRING","false",885],";",["T_WHITESPACE","\n    ",885],"}",["T_WHITESPACE","\n\n    ",886],["T_DOC_COMMENT","\/**\n     * Allow for updates of chidren qty's\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return boolean true\n     *\/",888],["T_WHITESPACE","\n    ",893],["T_PUBLIC","public",894],["T_WHITESPACE"," ",894],["T_FUNCTION","function",894],["T_WHITESPACE"," ",894],["T_STRING","getForceChildItemQtyChanges",894],"(",["T_VARIABLE","$product",894],["T_WHITESPACE"," ",894],"=",["T_WHITESPACE"," ",894],["T_STRING","null",894],")",["T_WHITESPACE","\n    ",894],"{",["T_WHITESPACE","\n        ",895],["T_RETURN","return",896],["T_WHITESPACE"," ",896],["T_STRING","true",896],";",["T_WHITESPACE","\n    ",896],"}",["T_WHITESPACE","\n\n    ",897],["T_DOC_COMMENT","\/**\n     * Retrieve additional searchable data from type instance\n     * Using based on product id and store_id data\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",899],["T_WHITESPACE","\n    ",905],["T_PUBLIC","public",906],["T_WHITESPACE"," ",906],["T_FUNCTION","function",906],["T_WHITESPACE"," ",906],["T_STRING","getSearchableData",906],"(",["T_VARIABLE","$product",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],["T_STRING","null",906],")",["T_WHITESPACE","\n    ",906],"{",["T_WHITESPACE","\n        ",907],["T_VARIABLE","$searchData",908],["T_WHITESPACE"," ",908],"=",["T_WHITESPACE"," ",908],["T_STRING","parent",908],["T_DOUBLE_COLON","::",908],["T_STRING","getSearchableData",908],"(",["T_VARIABLE","$product",908],")",";",["T_WHITESPACE","\n        ",908],["T_VARIABLE","$product",909],["T_WHITESPACE"," ",909],"=",["T_WHITESPACE"," ",909],["T_VARIABLE","$this",909],["T_OBJECT_OPERATOR","->",909],["T_STRING","getProduct",909],"(",["T_VARIABLE","$product",909],")",";",["T_WHITESPACE","\n\n        ",909],["T_VARIABLE","$optionSearchData",911],["T_WHITESPACE"," ",911],"=",["T_WHITESPACE"," ",911],["T_STRING","Mage",911],["T_DOUBLE_COLON","::",911],["T_STRING","getSingleton",911],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option'",911],")",["T_WHITESPACE","\n            ",911],["T_OBJECT_OPERATOR","->",912],["T_STRING","getSearchableData",912],"(",["T_VARIABLE","$product",912],["T_OBJECT_OPERATOR","->",912],["T_STRING","getId",912],"(",")",",",["T_WHITESPACE"," ",912],["T_VARIABLE","$product",912],["T_OBJECT_OPERATOR","->",912],["T_STRING","getStoreId",912],"(",")",")",";",["T_WHITESPACE","\n        ",912],["T_IF","if",913],["T_WHITESPACE"," ",913],"(",["T_VARIABLE","$optionSearchData",913],")",["T_WHITESPACE"," ",913],"{",["T_WHITESPACE","\n            ",913],["T_VARIABLE","$searchData",914],["T_WHITESPACE"," ",914],"=",["T_WHITESPACE"," ",914],["T_STRING","array_merge",914],"(",["T_VARIABLE","$searchData",914],",",["T_WHITESPACE"," ",914],["T_VARIABLE","$optionSearchData",914],")",";",["T_WHITESPACE","\n        ",914],"}",["T_WHITESPACE","\n\n        ",915],["T_RETURN","return",917],["T_WHITESPACE"," ",917],["T_VARIABLE","$searchData",917],";",["T_WHITESPACE","\n    ",917],"}",["T_WHITESPACE","\n\n    ",918],["T_DOC_COMMENT","\/**\n     * Check if product can be bought\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Product_Type\n     * @throws Mage_Core_Exception\n     *\/",920],["T_WHITESPACE","\n    ",926],["T_PUBLIC","public",927],["T_WHITESPACE"," ",927],["T_FUNCTION","function",927],["T_WHITESPACE"," ",927],["T_STRING","checkProductBuyState",927],"(",["T_VARIABLE","$product",927],["T_WHITESPACE"," ",927],"=",["T_WHITESPACE"," ",927],["T_STRING","null",927],")",["T_WHITESPACE","\n    ",927],"{",["T_WHITESPACE","\n        ",928],["T_STRING","parent",929],["T_DOUBLE_COLON","::",929],["T_STRING","checkProductBuyState",929],"(",["T_VARIABLE","$product",929],")",";",["T_WHITESPACE","\n        ",929],["T_VARIABLE","$product",930],["T_WHITESPACE","            ",930],"=",["T_WHITESPACE"," ",930],["T_VARIABLE","$this",930],["T_OBJECT_OPERATOR","->",930],["T_STRING","getProduct",930],"(",["T_VARIABLE","$product",930],")",";",["T_WHITESPACE","\n        ",930],["T_VARIABLE","$productOptionIds",931],["T_WHITESPACE","   ",931],"=",["T_WHITESPACE"," ",931],["T_VARIABLE","$this",931],["T_OBJECT_OPERATOR","->",931],["T_STRING","getOptionsIds",931],"(",["T_VARIABLE","$product",931],")",";",["T_WHITESPACE","\n        ",931],["T_VARIABLE","$productSelections",932],["T_WHITESPACE","  ",932],"=",["T_WHITESPACE"," ",932],["T_VARIABLE","$this",932],["T_OBJECT_OPERATOR","->",932],["T_STRING","getSelectionsCollection",932],"(",["T_VARIABLE","$productOptionIds",932],",",["T_WHITESPACE"," ",932],["T_VARIABLE","$product",932],")",";",["T_WHITESPACE","\n        ",932],["T_VARIABLE","$selectionIds",933],["T_WHITESPACE","       ",933],"=",["T_WHITESPACE"," ",933],["T_VARIABLE","$product",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","getCustomOption",933],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_ids'",933],")",";",["T_WHITESPACE","\n        ",933],["T_VARIABLE","$selectionIds",934],["T_WHITESPACE","       ",934],"=",["T_WHITESPACE"," ",934],["T_ARRAY_CAST","(array)",934],["T_WHITESPACE"," ",934],["T_STRING","unserialize",934],"(",["T_VARIABLE","$selectionIds",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","getValue",934],"(",")",")",";",["T_WHITESPACE","\n        ",934],["T_VARIABLE","$buyRequest",935],["T_WHITESPACE","         ",935],"=",["T_WHITESPACE"," ",935],["T_VARIABLE","$product",935],["T_OBJECT_OPERATOR","->",935],["T_STRING","getCustomOption",935],"(",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",935],")",";",["T_WHITESPACE","\n        ",935],["T_VARIABLE","$buyRequest",936],["T_WHITESPACE","         ",936],"=",["T_WHITESPACE"," ",936],["T_NEW","new",936],["T_WHITESPACE"," ",936],["T_STRING","Varien_Object",936],"(",["T_STRING","unserialize",936],"(",["T_VARIABLE","$buyRequest",936],["T_OBJECT_OPERATOR","->",936],["T_STRING","getValue",936],"(",")",")",")",";",["T_WHITESPACE","\n        ",936],["T_VARIABLE","$bundleOption",937],["T_WHITESPACE","       ",937],"=",["T_WHITESPACE"," ",937],["T_VARIABLE","$buyRequest",937],["T_OBJECT_OPERATOR","->",937],["T_STRING","getBundleOption",937],"(",")",";",["T_WHITESPACE","\n\n        ",937],["T_IF","if",939],["T_WHITESPACE"," ",939],"(",["T_EMPTY","empty",939],"(",["T_VARIABLE","$bundleOption",939],")",["T_WHITESPACE"," ",939],["T_BOOLEAN_AND","&&",939],["T_WHITESPACE"," ",939],["T_EMPTY","empty",939],"(",["T_VARIABLE","$selectionIds",939],")",")",["T_WHITESPACE"," ",939],"{",["T_WHITESPACE","\n            ",939],["T_STRING","Mage",940],["T_DOUBLE_COLON","::",940],["T_STRING","throwException",940],"(",["T_VARIABLE","$this",940],["T_OBJECT_OPERATOR","->",940],["T_STRING","getSpecifyOptionMessage",940],"(",")",")",";",["T_WHITESPACE","\n        ",940],"}",["T_WHITESPACE","\n\n        ",941],["T_VARIABLE","$skipSaleableCheck",943],["T_WHITESPACE"," ",943],"=",["T_WHITESPACE"," ",943],["T_STRING","Mage",943],["T_DOUBLE_COLON","::",943],["T_STRING","helper",943],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",943],")",["T_OBJECT_OPERATOR","->",943],["T_STRING","getSkipSaleableCheck",943],"(",")",";",["T_WHITESPACE","\n        ",943],["T_FOREACH","foreach",944],["T_WHITESPACE"," ",944],"(",["T_VARIABLE","$selectionIds",944],["T_WHITESPACE"," ",944],["T_AS","as",944],["T_WHITESPACE"," ",944],["T_VARIABLE","$selectionId",944],")",["T_WHITESPACE"," ",944],"{",["T_WHITESPACE","\n            ",944],["T_COMMENT","\/* @var $selection Mage_Bundle_Model_Selection *\/",945],["T_WHITESPACE","\n            ",945],["T_VARIABLE","$selection",946],["T_WHITESPACE"," ",946],"=",["T_WHITESPACE"," ",946],["T_VARIABLE","$productSelections",946],["T_OBJECT_OPERATOR","->",946],["T_STRING","getItemById",946],"(",["T_VARIABLE","$selectionId",946],")",";",["T_WHITESPACE","\n            ",946],["T_IF","if",947],["T_WHITESPACE"," ",947],"(","!",["T_VARIABLE","$selection",947],["T_WHITESPACE"," ",947],["T_BOOLEAN_OR","||",947],["T_WHITESPACE"," ",947],"(","!",["T_VARIABLE","$selection",947],["T_OBJECT_OPERATOR","->",947],["T_STRING","isSalable",947],"(",")",["T_WHITESPACE"," ",947],["T_BOOLEAN_AND","&&",947],["T_WHITESPACE"," ",947],"!",["T_VARIABLE","$skipSaleableCheck",947],")",")",["T_WHITESPACE"," ",947],"{",["T_WHITESPACE","\n                ",947],["T_STRING","Mage",948],["T_DOUBLE_COLON","::",948],["T_STRING","throwException",948],"(",["T_WHITESPACE","\n                    ",948],["T_STRING","Mage",949],["T_DOUBLE_COLON","::",949],["T_STRING","helper",949],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",949],")",["T_OBJECT_OPERATOR","->",949],["T_STRING","__",949],"(",["T_CONSTANT_ENCAPSED_STRING","'Selected required options are not available.'",949],")",["T_WHITESPACE","\n                ",949],")",";",["T_WHITESPACE","\n            ",950],"}",["T_WHITESPACE","\n        ",951],"}",["T_WHITESPACE","\n\n        ",952],["T_VARIABLE","$product",954],["T_OBJECT_OPERATOR","->",954],["T_STRING","getTypeInstance",954],"(",["T_STRING","true",954],")",["T_OBJECT_OPERATOR","->",954],["T_STRING","setStoreFilter",954],"(",["T_VARIABLE","$product",954],["T_OBJECT_OPERATOR","->",954],["T_STRING","getStoreId",954],"(",")",",",["T_WHITESPACE"," ",954],["T_VARIABLE","$product",954],")",";",["T_WHITESPACE","\n        ",954],["T_VARIABLE","$optionsCollection",955],["T_WHITESPACE"," ",955],"=",["T_WHITESPACE"," ",955],["T_VARIABLE","$this",955],["T_OBJECT_OPERATOR","->",955],["T_STRING","getOptionsCollection",955],"(",["T_VARIABLE","$product",955],")",";",["T_WHITESPACE","\n        ",955],["T_FOREACH","foreach",956],["T_WHITESPACE"," ",956],"(",["T_VARIABLE","$optionsCollection",956],["T_OBJECT_OPERATOR","->",956],["T_STRING","getItems",956],"(",")",["T_WHITESPACE"," ",956],["T_AS","as",956],["T_WHITESPACE"," ",956],["T_VARIABLE","$option",956],")",["T_WHITESPACE"," ",956],"{",["T_WHITESPACE","\n            ",956],["T_IF","if",957],["T_WHITESPACE"," ",957],"(",["T_VARIABLE","$option",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getRequired",957],"(",")",["T_WHITESPACE"," ",957],["T_BOOLEAN_AND","&&",957],["T_WHITESPACE"," ",957],["T_EMPTY","empty",957],"(",["T_VARIABLE","$selectionIds",957],")",["T_WHITESPACE"," ",957],["T_BOOLEAN_AND","&&",957],["T_WHITESPACE"," ",957],["T_EMPTY","empty",957],"(",["T_VARIABLE","$bundleOption",957],"[",["T_VARIABLE","$option",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getId",957],"(",")","]",")",")",["T_WHITESPACE"," ",957],"{",["T_WHITESPACE","\n                ",957],["T_STRING","Mage",958],["T_DOUBLE_COLON","::",958],["T_STRING","throwException",958],"(",["T_WHITESPACE","\n                    ",958],["T_STRING","Mage",959],["T_DOUBLE_COLON","::",959],["T_STRING","helper",959],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle'",959],")",["T_OBJECT_OPERATOR","->",959],["T_STRING","__",959],"(",["T_CONSTANT_ENCAPSED_STRING","'Required options are not selected.'",959],")",["T_WHITESPACE","\n                ",959],")",";",["T_WHITESPACE","\n            ",960],"}",["T_WHITESPACE","\n        ",961],"}",["T_WHITESPACE","\n\n        ",962],["T_RETURN","return",964],["T_WHITESPACE"," ",964],["T_VARIABLE","$this",964],";",["T_WHITESPACE","\n    ",964],"}",["T_WHITESPACE","\n\n    ",965],["T_DOC_COMMENT","\/**\n     * Retrieve products divided into groups required to purchase\n     * At least one product in each group has to be purchased\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",967],["T_WHITESPACE","\n    ",973],["T_PUBLIC","public",974],["T_WHITESPACE"," ",974],["T_FUNCTION","function",974],["T_WHITESPACE"," ",974],["T_STRING","getProductsToPurchaseByReqGroups",974],"(",["T_VARIABLE","$product",974],["T_WHITESPACE"," ",974],"=",["T_WHITESPACE"," ",974],["T_STRING","null",974],")",["T_WHITESPACE","\n    ",974],"{",["T_WHITESPACE","\n        ",975],["T_VARIABLE","$product",976],["T_WHITESPACE"," ",976],"=",["T_WHITESPACE"," ",976],["T_VARIABLE","$this",976],["T_OBJECT_OPERATOR","->",976],["T_STRING","getProduct",976],"(",["T_VARIABLE","$product",976],")",";",["T_WHITESPACE","\n        ",976],["T_VARIABLE","$groups",977],["T_WHITESPACE"," ",977],"=",["T_WHITESPACE"," ",977],["T_ARRAY","array",977],"(",")",";",["T_WHITESPACE","\n        ",977],["T_VARIABLE","$allProducts",978],["T_WHITESPACE"," ",978],"=",["T_WHITESPACE"," ",978],["T_ARRAY","array",978],"(",")",";",["T_WHITESPACE","\n        ",978],["T_VARIABLE","$hasRequiredOptions",979],["T_WHITESPACE"," ",979],"=",["T_WHITESPACE"," ",979],["T_STRING","false",979],";",["T_WHITESPACE","\n        ",979],["T_FOREACH","foreach",980],["T_WHITESPACE"," ",980],"(",["T_VARIABLE","$this",980],["T_OBJECT_OPERATOR","->",980],["T_STRING","getOptions",980],"(",["T_VARIABLE","$product",980],")",["T_WHITESPACE"," ",980],["T_AS","as",980],["T_WHITESPACE"," ",980],["T_VARIABLE","$option",980],")",["T_WHITESPACE"," ",980],"{",["T_WHITESPACE","\n            ",980],["T_VARIABLE","$groupProducts",981],["T_WHITESPACE"," ",981],"=",["T_WHITESPACE"," ",981],["T_ARRAY","array",981],"(",")",";",["T_WHITESPACE","\n            ",981],["T_FOREACH","foreach",982],["T_WHITESPACE"," ",982],"(",["T_VARIABLE","$this",982],["T_OBJECT_OPERATOR","->",982],["T_STRING","getSelectionsCollection",982],"(",["T_ARRAY","array",982],"(",["T_VARIABLE","$option",982],["T_OBJECT_OPERATOR","->",982],["T_STRING","getId",982],"(",")",")",",",["T_WHITESPACE"," ",982],["T_VARIABLE","$product",982],")",["T_WHITESPACE"," ",982],["T_AS","as",982],["T_WHITESPACE"," ",982],["T_VARIABLE","$childProduct",982],")",["T_WHITESPACE"," ",982],"{",["T_WHITESPACE","\n                ",982],["T_VARIABLE","$groupProducts",983],"[","]",["T_WHITESPACE"," ",983],"=",["T_WHITESPACE"," ",983],["T_VARIABLE","$childProduct",983],";",["T_WHITESPACE","\n                ",983],["T_VARIABLE","$allProducts",984],"[","]",["T_WHITESPACE"," ",984],"=",["T_WHITESPACE"," ",984],["T_VARIABLE","$childProduct",984],";",["T_WHITESPACE","\n            ",984],"}",["T_WHITESPACE","\n            ",985],["T_IF","if",986],["T_WHITESPACE"," ",986],"(",["T_VARIABLE","$option",986],["T_OBJECT_OPERATOR","->",986],["T_STRING","getRequired",986],"(",")",")",["T_WHITESPACE"," ",986],"{",["T_WHITESPACE","\n                ",986],["T_VARIABLE","$groups",987],"[","]",["T_WHITESPACE"," ",987],"=",["T_WHITESPACE"," ",987],["T_VARIABLE","$groupProducts",987],";",["T_WHITESPACE","\n                ",987],["T_VARIABLE","$hasRequiredOptions",988],["T_WHITESPACE"," ",988],"=",["T_WHITESPACE"," ",988],["T_STRING","true",988],";",["T_WHITESPACE","\n            ",988],"}",["T_WHITESPACE","\n        ",989],"}",["T_WHITESPACE","\n        ",990],["T_IF","if",991],["T_WHITESPACE"," ",991],"(","!",["T_VARIABLE","$hasRequiredOptions",991],")",["T_WHITESPACE"," ",991],"{",["T_WHITESPACE","\n            ",991],["T_VARIABLE","$groups",992],["T_WHITESPACE"," ",992],"=",["T_WHITESPACE"," ",992],["T_ARRAY","array",992],"(",["T_VARIABLE","$allProducts",992],")",";",["T_WHITESPACE","\n        ",992],"}",["T_WHITESPACE","\n        ",993],["T_RETURN","return",994],["T_WHITESPACE"," ",994],["T_VARIABLE","$groups",994],";",["T_WHITESPACE","\n    ",994],"}",["T_WHITESPACE","\n\n    ",995],["T_DOC_COMMENT","\/**\n     * Prepare selected options for bundle product\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @param  Varien_Object $buyRequest\n     * @return array\n     *\/",997],["T_WHITESPACE","\n    ",1003],["T_PUBLIC","public",1004],["T_WHITESPACE"," ",1004],["T_FUNCTION","function",1004],["T_WHITESPACE"," ",1004],["T_STRING","processBuyRequest",1004],"(",["T_VARIABLE","$product",1004],",",["T_WHITESPACE"," ",1004],["T_VARIABLE","$buyRequest",1004],")",["T_WHITESPACE","\n    ",1004],"{",["T_WHITESPACE","\n        ",1005],["T_VARIABLE","$option",1006],["T_WHITESPACE","     ",1006],"=",["T_WHITESPACE"," ",1006],["T_VARIABLE","$buyRequest",1006],["T_OBJECT_OPERATOR","->",1006],["T_STRING","getBundleOption",1006],"(",")",";",["T_WHITESPACE","\n        ",1006],["T_VARIABLE","$optionQty",1007],["T_WHITESPACE","  ",1007],"=",["T_WHITESPACE"," ",1007],["T_VARIABLE","$buyRequest",1007],["T_OBJECT_OPERATOR","->",1007],["T_STRING","getBundleOptionQty",1007],"(",")",";",["T_WHITESPACE","\n\n        ",1007],["T_VARIABLE","$option",1009],["T_WHITESPACE","     ",1009],"=",["T_WHITESPACE"," ",1009],"(",["T_STRING","is_array",1009],"(",["T_VARIABLE","$option",1009],")",")",["T_WHITESPACE"," ",1009],"?",["T_WHITESPACE"," ",1009],["T_STRING","array_filter",1009],"(",["T_VARIABLE","$option",1009],",",["T_WHITESPACE"," ",1009],["T_CONSTANT_ENCAPSED_STRING","'intval'",1009],")",["T_WHITESPACE"," ",1009],":",["T_WHITESPACE"," ",1009],["T_ARRAY","array",1009],"(",")",";",["T_WHITESPACE","\n        ",1009],["T_VARIABLE","$optionQty",1010],["T_WHITESPACE","  ",1010],"=",["T_WHITESPACE"," ",1010],"(",["T_STRING","is_array",1010],"(",["T_VARIABLE","$optionQty",1010],")",")",["T_WHITESPACE"," ",1010],"?",["T_WHITESPACE"," ",1010],["T_STRING","array_filter",1010],"(",["T_VARIABLE","$optionQty",1010],",",["T_WHITESPACE"," ",1010],["T_CONSTANT_ENCAPSED_STRING","'intval'",1010],")",["T_WHITESPACE"," ",1010],":",["T_WHITESPACE"," ",1010],["T_ARRAY","array",1010],"(",")",";",["T_WHITESPACE","\n\n        ",1010],["T_VARIABLE","$options",1012],["T_WHITESPACE"," ",1012],"=",["T_WHITESPACE"," ",1012],["T_ARRAY","array",1012],"(",["T_WHITESPACE","\n            ",1012],["T_CONSTANT_ENCAPSED_STRING","'bundle_option'",1013],["T_WHITESPACE","     ",1013],["T_DOUBLE_ARROW","=>",1013],["T_WHITESPACE"," ",1013],["T_VARIABLE","$option",1013],",",["T_WHITESPACE","\n            ",1013],["T_CONSTANT_ENCAPSED_STRING","'bundle_option_qty'",1014],["T_WHITESPACE"," ",1014],["T_DOUBLE_ARROW","=>",1014],["T_WHITESPACE"," ",1014],["T_VARIABLE","$optionQty",1014],["T_WHITESPACE","\n        ",1014],")",";",["T_WHITESPACE","\n\n        ",1015],["T_RETURN","return",1017],["T_WHITESPACE"," ",1017],["T_VARIABLE","$options",1017],";",["T_WHITESPACE","\n    ",1017],"}",["T_WHITESPACE","\n\n    ",1018],["T_DOC_COMMENT","\/**\n     * Check if product can be configured\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",1020],["T_WHITESPACE","\n    ",1025],["T_PUBLIC","public",1026],["T_WHITESPACE"," ",1026],["T_FUNCTION","function",1026],["T_WHITESPACE"," ",1026],["T_STRING","canConfigure",1026],"(",["T_VARIABLE","$product",1026],["T_WHITESPACE"," ",1026],"=",["T_WHITESPACE"," ",1026],["T_STRING","null",1026],")",["T_WHITESPACE","\n    ",1026],"{",["T_WHITESPACE","\n        ",1027],["T_RETURN","return",1028],["T_WHITESPACE"," ",1028],["T_VARIABLE","$product",1028],["T_WHITESPACE"," ",1028],["T_INSTANCEOF","instanceof",1028],["T_WHITESPACE"," ",1028],["T_STRING","Mage_Catalog_Model_Product",1028],["T_WHITESPACE","\n            ",1028],["T_BOOLEAN_AND","&&",1029],["T_WHITESPACE"," ",1029],["T_VARIABLE","$product",1029],["T_OBJECT_OPERATOR","->",1029],["T_STRING","isAvailable",1029],"(",")",["T_WHITESPACE","\n            ",1029],["T_BOOLEAN_AND","&&",1030],["T_WHITESPACE"," ",1030],["T_STRING","parent",1030],["T_DOUBLE_COLON","::",1030],["T_STRING","canConfigure",1030],"(",")",";",["T_WHITESPACE","\n    ",1030],"}",["T_WHITESPACE","\n\n    ",1031],["T_DOC_COMMENT","\/**\n     * Check if Minimum Advertise Price is enabled at least in one option\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param int $visibility\n     * @return bool|null\n     *\/",1033],["T_WHITESPACE","\n    ",1039],["T_PUBLIC","public",1040],["T_WHITESPACE"," ",1040],["T_FUNCTION","function",1040],["T_WHITESPACE"," ",1040],["T_STRING","isMapEnabledInOptions",1040],"(",["T_VARIABLE","$product",1040],",",["T_WHITESPACE"," ",1040],["T_VARIABLE","$visibility",1040],["T_WHITESPACE"," ",1040],"=",["T_WHITESPACE"," ",1040],["T_STRING","null",1040],")",["T_WHITESPACE","\n    ",1040],"{",["T_WHITESPACE","\n        ",1041],["T_DOC_COMMENT","\/**\n         * @TODO: In order to clarify is MAP enabled for product we can check associated products.\n         * Commented for future improvements.\n         *\/",1042],["T_WHITESPACE","\n        ",1045],["T_COMMENT","\/*\n        $collection = $this->getUsedProductCollection($product);\n        $helper = Mage::helper('catalog');\n\n        $result = null;\n        $parentVisibility = $product->getMsrpDisplayActualPriceType();\n        if ($parentVisibility === null) {\n            $parentVisibility = $helper->getMsrpDisplayActualPriceType();\n        }\n        $visibilities = array($parentVisibility);\n        foreach ($collection as $item) {\n            if ($helper->canApplyMsrp($item)) {\n                $productVisibility = $item->getMsrpDisplayActualPriceType();\n                if ($productVisibility === null) {\n                    $productVisibility = $helper->getMsrpDisplayActualPriceType();\n                }\n                $visibilities[] = $productVisibility;\n                $result = true;\n            }\n        }\n\n        if ($result && $visibility !== null) {\n            if ($visibilities) {\n                $maxVisibility = max($visibilities);\n                $result = $result && $maxVisibility == $visibility;\n            } else {\n                $result = false;\n            }\n        }\n\n        return $result;\n        *\/",1046],["T_WHITESPACE","\n\n        ",1077],["T_RETURN","return",1079],["T_WHITESPACE"," ",1079],["T_STRING","null",1079],";",["T_WHITESPACE","\n    ",1079],"}",["T_WHITESPACE","\n",1080],"}",["T_WHITESPACE","\n",1081]]