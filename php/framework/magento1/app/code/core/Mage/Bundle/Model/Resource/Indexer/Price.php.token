[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Bundle products Price indexer resource model\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Bundle_Model_Resource_Indexer_Price",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Price_Default",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for all products\n     *\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","reindexAll",42],"(",")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","useIdxTable",44],"(",["T_STRING","true",44],")",";",["T_WHITESPACE","\n\n        ",44],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","beginTransaction",46],"(",")",";",["T_WHITESPACE","\n        ",46],["T_TRY","try",47],["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n            ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","_prepareBundlePrice",48],"(",")",";",["T_WHITESPACE","\n            ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","commit",49],"(",")",";",["T_WHITESPACE","\n        ",49],"}",["T_WHITESPACE"," ",50],["T_CATCH","catch",50],["T_WHITESPACE"," ",50],"(",["T_STRING","Exception",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$e",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","rollBack",51],"(",")",";",["T_WHITESPACE","\n            ",51],["T_THROW","throw",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$e",52],";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE","\n\n        ",53],["T_RETURN","return",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for defined product(s)\n     *\n     * @param int|array $entityIds\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",58],["T_WHITESPACE","\n    ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","reindexEntity",64],"(",["T_VARIABLE","$entityIds",64],")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_prepareBundlePrice",66],"(",["T_VARIABLE","$entityIds",66],")",";",["T_WHITESPACE","\n\n        ",66],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Retrieve temporary price index table name for fixed bundle products\n     *\n     * @return string\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","_getBundlePriceTable",76],"(",")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","useIdxTable",78],"(",")",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getTable",79],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/price_indexer_idx'",79],")",";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n        ",80],["T_RETURN","return",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getTable",81],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/price_indexer_tmp'",81],")",";",["T_WHITESPACE","\n    ",81],"}",["T_WHITESPACE","\n\n    ",82],["T_DOC_COMMENT","\/**\n     * Retrieve table name for temporary bundle selection prices index\n     *\n     * @return string\n     *\/",84],["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","_getBundleSelectionTable",89],"(",")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_IF","if",91],["T_WHITESPACE"," ",91],"(",["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","useIdxTable",91],"(",")",")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_RETURN","return",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTable",92],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection_indexer_idx'",92],")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n        ",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getTable",94],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection_indexer_tmp'",94],")",";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Retrieve table name for temporary bundle option prices index\n     *\n     * @return string\n     *\/",97],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","_getBundleOptionTable",102],"(",")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","useIdxTable",104],"(",")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getTable",105],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option_indexer_idx'",105],")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n        ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getTable",107],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option_indexer_tmp'",107],")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Prepare temporary price index table for fixed bundle products\n     *\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",110],["T_WHITESPACE","\n    ",114],["T_PROTECTED","protected",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","_prepareBundlePriceTable",115],"(",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_getWriteAdapter",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","delete",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_getBundlePriceTable",117],"(",")",")",";",["T_WHITESPACE","\n        ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Prepare table structure for temporary bundle selection prices index\n     *\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",121],["T_WHITESPACE","\n    ",125],["T_PROTECTED","protected",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","_prepareBundleSelectionTable",126],"(",")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_getWriteAdapter",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","delete",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_getBundleSelectionTable",128],"(",")",")",";",["T_WHITESPACE","\n        ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Prepare table structure for temporary bundle option prices index\n     *\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",132],["T_WHITESPACE","\n    ",136],["T_PROTECTED","protected",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","_prepareBundleOptionTable",137],"(",")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_getWriteAdapter",139],"(",")",["T_OBJECT_OPERATOR","->",139],["T_STRING","delete",139],"(",["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_getBundleOptionTable",139],"(",")",")",";",["T_WHITESPACE","\n        ",139],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Prepare temporary price index data for bundle products by price type\n     *\n     * @param int $priceType\n     * @param int|array $entityIds the entity ids limitatation\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",143],["T_WHITESPACE","\n    ",149],["T_PROTECTED","protected",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","_prepareBundlePriceByType",150],"(",["T_VARIABLE","$priceType",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$entityIds",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","null",150],")",["T_WHITESPACE","\n    ",150],"{",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$write",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_getWriteAdapter",152],"(",")",";",["T_WHITESPACE","\n        ",152],["T_VARIABLE","$table",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_getBundlePriceTable",153],"(",")",";",["T_WHITESPACE","\n\n        ",153],["T_VARIABLE","$select",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$write",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","select",155],"(",")",["T_WHITESPACE","\n            ",155],["T_OBJECT_OPERATOR","->",156],["T_STRING","from",156],"(",["T_ARRAY","array",156],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",156],["T_WHITESPACE"," ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getTable",156],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",156],")",")",",",["T_WHITESPACE"," ",156],["T_ARRAY","array",156],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",156],")",")",["T_WHITESPACE","\n            ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","join",157],"(",["T_WHITESPACE","\n                ",157],["T_ARRAY","array",158],"(",["T_CONSTANT_ENCAPSED_STRING","'cg'",158],["T_WHITESPACE"," ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getTable",158],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",158],")",")",",",["T_WHITESPACE","\n                ",158],["T_CONSTANT_ENCAPSED_STRING","''",159],",",["T_WHITESPACE","\n                ",159],["T_ARRAY","array",160],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",160],")",["T_WHITESPACE","\n            ",160],")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_addWebsiteJoinToSelect",162],"(",["T_VARIABLE","$select",162],",",["T_WHITESPACE"," ",162],["T_STRING","true",162],")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_addProductWebsiteJoinToSelect",163],"(",["T_VARIABLE","$select",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",163],")",";",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$select",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","columns",164],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",164],",",["T_WHITESPACE"," ",164],["T_CONSTANT_ENCAPSED_STRING","'cw'",164],")",["T_WHITESPACE","\n            ",164],["T_OBJECT_OPERATOR","->",165],["T_STRING","join",165],"(",["T_WHITESPACE","\n                ",165],["T_ARRAY","array",166],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd'",166],["T_WHITESPACE"," ",166],["T_DOUBLE_ARROW","=>",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_getWebsiteDateTable",166],"(",")",")",",",["T_WHITESPACE","\n                ",166],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id = cwd.website_id'",167],",",["T_WHITESPACE","\n                ",167],["T_ARRAY","array",168],"(",")",["T_WHITESPACE","\n            ",168],")",["T_WHITESPACE","\n            ",169],["T_OBJECT_OPERATOR","->",170],["T_STRING","joinLeft",170],"(",["T_WHITESPACE","\n                ",170],["T_ARRAY","array",171],"(",["T_CONSTANT_ENCAPSED_STRING","'tp'",171],["T_WHITESPACE"," ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_getTierPriceIndexTable",171],"(",")",")",",",["T_WHITESPACE","\n                ",171],["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id = e.entity_id AND tp.website_id = cw.website_id'",172],["T_WHITESPACE","\n                    ",172],".",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","' AND tp.customer_group_id = cg.customer_group_id'",173],",",["T_WHITESPACE","\n                ",173],["T_ARRAY","array",174],"(",")",["T_WHITESPACE","\n            ",174],")",["T_WHITESPACE","\n            ",175],["T_OBJECT_OPERATOR","->",176],["T_STRING","joinLeft",176],"(",["T_WHITESPACE","\n                ",176],["T_ARRAY","array",177],"(",["T_CONSTANT_ENCAPSED_STRING","'gp'",177],["T_WHITESPACE"," ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_getGroupPriceIndexTable",177],"(",")",")",",",["T_WHITESPACE","\n                ",177],["T_CONSTANT_ENCAPSED_STRING","'gp.entity_id = e.entity_id AND gp.website_id = cw.website_id'",178],["T_WHITESPACE","\n                    ",178],".",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","' AND gp.customer_group_id = cg.customer_group_id'",179],",",["T_WHITESPACE","\n                ",179],["T_ARRAY","array",180],"(",")",["T_WHITESPACE","\n            ",180],")",["T_WHITESPACE","\n            ",181],["T_OBJECT_OPERATOR","->",182],["T_STRING","where",182],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getTypeId",182],"(",")",")",";",["T_WHITESPACE","\n\n        ",182],["T_COMMENT","\/\/ add enable products limitation\n",184],["T_WHITESPACE","        ",185],["T_VARIABLE","$statusCond",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$write",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","quoteInto",185],"(",["T_CONSTANT_ENCAPSED_STRING","'=?'",185],",",["T_WHITESPACE"," ",185],["T_STRING","Mage_Catalog_Model_Product_Status",185],["T_DOUBLE_COLON","::",185],["T_STRING","STATUS_ENABLED",185],")",";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_addAttributeToSelect",186],"(",["T_VARIABLE","$select",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'status'",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$statusCond",186],",",["T_WHITESPACE"," ",186],["T_STRING","true",186],")",";",["T_WHITESPACE","\n        ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_STRING","Mage",187],["T_DOUBLE_COLON","::",187],["T_STRING","helper",187],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",187],")",["T_OBJECT_OPERATOR","->",187],["T_STRING","isModuleEnabled",187],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Tax'",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$taxClassId",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_addAttributeToSelect",188],"(",["T_VARIABLE","$select",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",188],")",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE"," ",189],["T_ELSE","else",189],["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_VARIABLE","$taxClassId",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_NEW","new",190],["T_WHITESPACE"," ",190],["T_STRING","Zend_Db_Expr",190],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",190],")",";",["T_WHITESPACE","\n        ",190],"}",["T_WHITESPACE","\n\n        ",191],["T_IF","if",193],["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$priceType",193],["T_WHITESPACE"," ",193],["T_IS_EQUAL","==",193],["T_WHITESPACE"," ",193],["T_STRING","Mage_Bundle_Model_Product_Price",193],["T_DOUBLE_COLON","::",193],["T_STRING","PRICE_TYPE_DYNAMIC",193],")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$select",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","columns",194],"(",["T_ARRAY","array",194],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_NEW","new",194],["T_WHITESPACE"," ",194],["T_STRING","Zend_Db_Expr",194],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",194],")",")",")",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE"," ",195],["T_ELSE","else",195],["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$select",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","columns",196],"(",["T_WHITESPACE","\n                ",196],["T_ARRAY","array",197],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",197],["T_WHITESPACE"," ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$write",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getCheckSql",197],"(",["T_VARIABLE","$taxClassId",197],["T_WHITESPACE"," ",197],".",["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$taxClassId",197],",",["T_WHITESPACE"," ",197],["T_LNUMBER","0",197],")",")",["T_WHITESPACE","\n            ",197],")",";",["T_WHITESPACE","\n        ",198],"}",["T_WHITESPACE","\n\n        ",199],["T_VARIABLE","$priceTypeCond",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_VARIABLE","$write",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","quoteInto",201],"(",["T_CONSTANT_ENCAPSED_STRING","'=?'",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$priceType",201],")",";",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_addAttributeToSelect",202],"(",["T_VARIABLE","$select",202],",",["T_WHITESPACE"," ",202],["T_CONSTANT_ENCAPSED_STRING","'price_type'",202],",",["T_WHITESPACE"," ",202],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",202],",",["T_WHITESPACE"," ",202],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$priceTypeCond",202],")",";",["T_WHITESPACE","\n\n        ",202],["T_VARIABLE","$price",204],["T_WHITESPACE","          ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_addAttributeToSelect",204],"(",["T_VARIABLE","$select",204],",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'price'",204],",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",204],",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",204],")",";",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$specialPrice",205],["T_WHITESPACE","   ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_addAttributeToSelect",205],"(",["T_VARIABLE","$select",205],",",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'special_price'",205],",",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",205],",",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",205],")",";",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$specialFrom",206],["T_WHITESPACE","    ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_addAttributeToSelect",206],"(",["T_VARIABLE","$select",206],",",["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'special_from_date'",206],",",["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",206],",",["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",206],")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$specialTo",207],["T_WHITESPACE","      ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_addAttributeToSelect",207],"(",["T_VARIABLE","$select",207],",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'special_to_date'",207],",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",207],",",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",207],")",";",["T_WHITESPACE","\n        ",207],["T_VARIABLE","$curentDate",208],["T_WHITESPACE","     ",208],"=",["T_WHITESPACE"," ",208],["T_NEW","new",208],["T_WHITESPACE"," ",208],["T_STRING","Zend_Db_Expr",208],"(",["T_CONSTANT_ENCAPSED_STRING","'cwd.website_date'",208],")",";",["T_WHITESPACE","\n\n        ",208],["T_VARIABLE","$specialExpr",210],["T_WHITESPACE","    ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$write",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getCheckSql",210],"(",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$write",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getCheckSql",211],"(",["T_WHITESPACE","\n                ",211],["T_VARIABLE","$specialFrom",212],["T_WHITESPACE"," ",212],".",["T_WHITESPACE"," ",212],["T_CONSTANT_ENCAPSED_STRING","' IS NULL'",212],",",["T_WHITESPACE","\n                ",212],["T_CONSTANT_ENCAPSED_STRING","'1'",213],",",["T_WHITESPACE","\n                ",213],["T_VARIABLE","$write",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getCheckSql",214],"(",["T_WHITESPACE","\n                    ",214],["T_VARIABLE","$specialFrom",215],["T_WHITESPACE"," ",215],".",["T_WHITESPACE"," ",215],["T_CONSTANT_ENCAPSED_STRING","' <= '",215],["T_WHITESPACE"," ",215],".",["T_WHITESPACE"," ",215],["T_VARIABLE","$curentDate",215],",",["T_WHITESPACE","\n                    ",215],["T_CONSTANT_ENCAPSED_STRING","'1'",216],",",["T_WHITESPACE","\n                    ",216],["T_CONSTANT_ENCAPSED_STRING","'0'",217],["T_WHITESPACE","\n                ",217],")",["T_WHITESPACE","\n            ",218],")",["T_WHITESPACE"," ",219],".",["T_WHITESPACE"," ",219],["T_CONSTANT_ENCAPSED_STRING","\" > 0 AND \"",219],".",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$write",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getCheckSql",220],"(",["T_WHITESPACE","\n                ",220],["T_VARIABLE","$specialTo",221],["T_WHITESPACE"," ",221],".",["T_WHITESPACE"," ",221],["T_CONSTANT_ENCAPSED_STRING","' IS NULL'",221],",",["T_WHITESPACE","\n                ",221],["T_CONSTANT_ENCAPSED_STRING","'1'",222],",",["T_WHITESPACE","\n                ",222],["T_VARIABLE","$write",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getCheckSql",223],"(",["T_WHITESPACE","\n                    ",223],["T_VARIABLE","$specialTo",224],["T_WHITESPACE"," ",224],".",["T_WHITESPACE"," ",224],["T_CONSTANT_ENCAPSED_STRING","' >= '",224],["T_WHITESPACE"," ",224],".",["T_WHITESPACE"," ",224],["T_VARIABLE","$curentDate",224],",",["T_WHITESPACE","\n                    ",224],["T_CONSTANT_ENCAPSED_STRING","'1'",225],",",["T_WHITESPACE","\n                    ",225],["T_CONSTANT_ENCAPSED_STRING","'0'",226],["T_WHITESPACE","\n                ",226],")",["T_WHITESPACE","\n            ",227],")",["T_WHITESPACE","\n            ",228],".",["T_WHITESPACE"," ",229],"\"",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND ",229],["T_CURLY_OPEN","{",229],["T_VARIABLE","$specialPrice",229],"}",["T_ENCAPSED_AND_WHITESPACE"," > 0 AND ",229],["T_CURLY_OPEN","{",229],["T_VARIABLE","$specialPrice",229],"}",["T_ENCAPSED_AND_WHITESPACE"," < 100 ",229],"\"",",",["T_WHITESPACE","\n            ",229],["T_VARIABLE","$specialPrice",230],",",["T_WHITESPACE","\n            ",230],["T_CONSTANT_ENCAPSED_STRING","'0'",231],["T_WHITESPACE","\n        ",231],")",";",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$groupPriceExpr",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$write",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getCheckSql",234],"(",["T_WHITESPACE","\n            ",234],["T_CONSTANT_ENCAPSED_STRING","'gp.price IS NOT NULL AND gp.price > 0 AND gp.price < 100'",235],",",["T_WHITESPACE","\n            ",235],["T_CONSTANT_ENCAPSED_STRING","'gp.price'",236],",",["T_WHITESPACE","\n            ",236],["T_CONSTANT_ENCAPSED_STRING","'0'",237],["T_WHITESPACE","\n        ",237],")",";",["T_WHITESPACE","\n\n        ",238],["T_VARIABLE","$tierExpr",240],["T_WHITESPACE","       ",240],"=",["T_WHITESPACE"," ",240],["T_NEW","new",240],["T_WHITESPACE"," ",240],["T_STRING","Zend_Db_Expr",240],"(",["T_CONSTANT_ENCAPSED_STRING","\"tp.min_price\"",240],")",";",["T_WHITESPACE","\n\n        ",240],["T_IF","if",242],["T_WHITESPACE"," ",242],"(",["T_VARIABLE","$priceType",242],["T_WHITESPACE"," ",242],["T_IS_EQUAL","==",242],["T_WHITESPACE"," ",242],["T_STRING","Mage_Bundle_Model_Product_Price",242],["T_DOUBLE_COLON","::",242],["T_STRING","PRICE_TYPE_FIXED",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$finalPrice",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$write",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getCheckSql",243],"(",["T_WHITESPACE","\n                ",243],["T_VARIABLE","$specialExpr",244],["T_WHITESPACE"," ",244],".",["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","' > 0'",244],",",["T_WHITESPACE","\n                ",244],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",245],["T_WHITESPACE"," ",245],".",["T_WHITESPACE"," ",245],["T_VARIABLE","$price",245],["T_WHITESPACE"," ",245],".",["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","' * ('",245],["T_WHITESPACE"," ",245],".",["T_WHITESPACE"," ",245],["T_VARIABLE","$specialExpr",245],["T_WHITESPACE"," ",245],".",["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'  \/ 100), 2)'",245],",",["T_WHITESPACE","\n                ",245],["T_VARIABLE","$price",246],["T_WHITESPACE","\n            ",246],")",";",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$tierPrice",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_VARIABLE","$write",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getCheckSql",248],"(",["T_WHITESPACE","\n                ",248],["T_VARIABLE","$tierExpr",249],["T_WHITESPACE"," ",249],".",["T_WHITESPACE"," ",249],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",249],",",["T_WHITESPACE","\n                ",249],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",250],["T_WHITESPACE"," ",250],".",["T_WHITESPACE"," ",250],["T_VARIABLE","$price",250],["T_WHITESPACE"," ",250],".",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","' - '",250],["T_WHITESPACE"," ",250],".",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","'('",250],["T_WHITESPACE"," ",250],".",["T_WHITESPACE"," ",250],["T_VARIABLE","$price",250],["T_WHITESPACE"," ",250],".",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","' * ('",250],["T_WHITESPACE"," ",250],".",["T_WHITESPACE"," ",250],["T_VARIABLE","$tierExpr",250],["T_WHITESPACE"," ",250],".",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","' \/ 100)), 2)'",250],",",["T_WHITESPACE","\n                ",250],["T_CONSTANT_ENCAPSED_STRING","'NULL'",251],["T_WHITESPACE","\n            ",251],")",";",["T_WHITESPACE","\n            ",252],["T_VARIABLE","$groupPrice",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$write",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getCheckSql",253],"(",["T_WHITESPACE","\n                ",253],["T_VARIABLE","$groupPriceExpr",254],["T_WHITESPACE"," ",254],".",["T_WHITESPACE"," ",254],["T_CONSTANT_ENCAPSED_STRING","' > 0'",254],",",["T_WHITESPACE","\n                ",254],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",255],["T_WHITESPACE"," ",255],".",["T_WHITESPACE"," ",255],["T_VARIABLE","$price",255],["T_WHITESPACE"," ",255],".",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","' - '",255],["T_WHITESPACE"," ",255],".",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'('",255],["T_WHITESPACE"," ",255],".",["T_WHITESPACE"," ",255],["T_VARIABLE","$price",255],["T_WHITESPACE"," ",255],".",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","' * ('",255],["T_WHITESPACE"," ",255],".",["T_WHITESPACE"," ",255],["T_VARIABLE","$groupPriceExpr",255],["T_WHITESPACE"," ",255],".",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","' \/ 100)), 2)'",255],",",["T_WHITESPACE","\n                ",255],["T_CONSTANT_ENCAPSED_STRING","'NULL'",256],["T_WHITESPACE","\n            ",256],")",";",["T_WHITESPACE","\n            ",257],["T_VARIABLE","$finalPrice",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_VARIABLE","$write",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getCheckSql",258],"(",["T_WHITESPACE","\n                ",258],"\"",["T_CURLY_OPEN","{",259],["T_VARIABLE","$groupPrice",259],"}",["T_ENCAPSED_AND_WHITESPACE"," IS NOT NULL AND ",259],["T_CURLY_OPEN","{",259],["T_VARIABLE","$groupPrice",259],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",259],["T_CURLY_OPEN","{",259],["T_VARIABLE","$finalPrice",259],"}","\"",",",["T_WHITESPACE","\n                ",259],["T_VARIABLE","$groupPrice",260],",",["T_WHITESPACE","\n                ",260],["T_VARIABLE","$finalPrice",261],["T_WHITESPACE","\n            ",261],")",";",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE"," ",263],["T_ELSE","else",263],["T_WHITESPACE"," ",263],"{",["T_WHITESPACE","\n            ",263],["T_VARIABLE","$finalPrice",264],["T_WHITESPACE","     ",264],"=",["T_WHITESPACE"," ",264],["T_NEW","new",264],["T_WHITESPACE"," ",264],["T_STRING","Zend_Db_Expr",264],"(",["T_CONSTANT_ENCAPSED_STRING","\"0\"",264],")",";",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$tierPrice",265],["T_WHITESPACE","      ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$write",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getCheckSql",265],"(",["T_VARIABLE","$tierExpr",265],["T_WHITESPACE"," ",265],".",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","' IS NOT NULL'",265],",",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","'0'",265],",",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","'NULL'",265],")",";",["T_WHITESPACE","\n            ",265],["T_VARIABLE","$groupPrice",266],["T_WHITESPACE","     ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$write",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getCheckSql",266],"(",["T_VARIABLE","$groupPriceExpr",266],["T_WHITESPACE"," ",266],".",["T_WHITESPACE"," ",266],["T_CONSTANT_ENCAPSED_STRING","' > 0'",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$groupPriceExpr",266],",",["T_WHITESPACE"," ",266],["T_CONSTANT_ENCAPSED_STRING","'NULL'",266],")",";",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n\n        ",267],["T_VARIABLE","$select",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","columns",269],"(",["T_ARRAY","array",269],"(",["T_WHITESPACE","\n            ",269],["T_CONSTANT_ENCAPSED_STRING","'price_type'",270],["T_WHITESPACE","          ",270],["T_DOUBLE_ARROW","=>",270],["T_WHITESPACE"," ",270],["T_NEW","new",270],["T_WHITESPACE"," ",270],["T_STRING","Zend_Db_Expr",270],"(",["T_VARIABLE","$priceType",270],")",",",["T_WHITESPACE","\n            ",270],["T_CONSTANT_ENCAPSED_STRING","'special_price'",271],["T_WHITESPACE","       ",271],["T_DOUBLE_ARROW","=>",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$specialExpr",271],",",["T_WHITESPACE","\n            ",271],["T_CONSTANT_ENCAPSED_STRING","'tier_percent'",272],["T_WHITESPACE","        ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$tierExpr",272],",",["T_WHITESPACE","\n            ",272],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",273],["T_WHITESPACE","          ",273],["T_DOUBLE_ARROW","=>",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$write",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getCheckSql",273],"(",["T_VARIABLE","$price",273],["T_WHITESPACE"," ",273],".",["T_WHITESPACE"," ",273],["T_CONSTANT_ENCAPSED_STRING","' IS NULL'",273],",",["T_WHITESPACE"," ",273],["T_CONSTANT_ENCAPSED_STRING","'0'",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$price",273],")",",",["T_WHITESPACE","\n            ",273],["T_CONSTANT_ENCAPSED_STRING","'price'",274],["T_WHITESPACE","               ",274],["T_DOUBLE_ARROW","=>",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$finalPrice",274],",",["T_WHITESPACE","\n            ",274],["T_CONSTANT_ENCAPSED_STRING","'min_price'",275],["T_WHITESPACE","           ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$finalPrice",275],",",["T_WHITESPACE","\n            ",275],["T_CONSTANT_ENCAPSED_STRING","'max_price'",276],["T_WHITESPACE","           ",276],["T_DOUBLE_ARROW","=>",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$finalPrice",276],",",["T_WHITESPACE","\n            ",276],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",277],["T_WHITESPACE","          ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$tierPrice",277],",",["T_WHITESPACE","\n            ",277],["T_CONSTANT_ENCAPSED_STRING","'base_tier'",278],["T_WHITESPACE","           ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$tierPrice",278],",",["T_WHITESPACE","\n            ",278],["T_CONSTANT_ENCAPSED_STRING","'group_price'",279],["T_WHITESPACE","         ",279],["T_DOUBLE_ARROW","=>",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$groupPrice",279],",",["T_WHITESPACE","\n            ",279],["T_CONSTANT_ENCAPSED_STRING","'base_group_price'",280],["T_WHITESPACE","    ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$groupPrice",280],",",["T_WHITESPACE","\n            ",280],["T_CONSTANT_ENCAPSED_STRING","'group_price_percent'",281],["T_WHITESPACE"," ",281],["T_DOUBLE_ARROW","=>",281],["T_WHITESPACE"," ",281],["T_NEW","new",281],["T_WHITESPACE"," ",281],["T_STRING","Zend_Db_Expr",281],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.price'",281],")",",",["T_WHITESPACE","\n        ",281],")",")",";",["T_WHITESPACE","\n\n        ",282],["T_IF","if",284],["T_WHITESPACE"," ",284],"(","!",["T_STRING","is_null",284],"(",["T_VARIABLE","$entityIds",284],")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$select",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","where",285],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",285],",",["T_WHITESPACE"," ",285],["T_VARIABLE","$entityIds",285],")",";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n\n        ",286],["T_DOC_COMMENT","\/**\n         * Add additional external limitation\n         *\/",288],["T_WHITESPACE","\n        ",290],["T_STRING","Mage",291],["T_DOUBLE_COLON","::",291],["T_STRING","dispatchEvent",291],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_prepare_index_select'",291],",",["T_WHITESPACE"," ",291],["T_ARRAY","array",291],"(",["T_WHITESPACE","\n            ",291],["T_CONSTANT_ENCAPSED_STRING","'select'",292],["T_WHITESPACE","        ",292],["T_DOUBLE_ARROW","=>",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$select",292],",",["T_WHITESPACE","\n            ",292],["T_CONSTANT_ENCAPSED_STRING","'entity_field'",293],["T_WHITESPACE","  ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_NEW","new",293],["T_WHITESPACE"," ",293],["T_STRING","Zend_Db_Expr",293],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",293],")",",",["T_WHITESPACE","\n            ",293],["T_CONSTANT_ENCAPSED_STRING","'website_field'",294],["T_WHITESPACE"," ",294],["T_DOUBLE_ARROW","=>",294],["T_WHITESPACE"," ",294],["T_NEW","new",294],["T_WHITESPACE"," ",294],["T_STRING","Zend_Db_Expr",294],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",294],")",",",["T_WHITESPACE","\n            ",294],["T_CONSTANT_ENCAPSED_STRING","'store_field'",295],["T_WHITESPACE","   ",295],["T_DOUBLE_ARROW","=>",295],["T_WHITESPACE"," ",295],["T_NEW","new",295],["T_WHITESPACE"," ",295],["T_STRING","Zend_Db_Expr",295],"(",["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",295],")",["T_WHITESPACE","\n        ",295],")",")",";",["T_WHITESPACE","\n\n        ",296],["T_VARIABLE","$query",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$select",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","insertFromSelect",298],"(",["T_VARIABLE","$table",298],")",";",["T_WHITESPACE","\n        ",298],["T_VARIABLE","$write",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","query",299],"(",["T_VARIABLE","$query",299],")",";",["T_WHITESPACE","\n\n        ",299],["T_RETURN","return",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],";",["T_WHITESPACE","\n    ",301],"}",["T_WHITESPACE","\n\n    ",302],["T_DOC_COMMENT","\/**\n     * Calculate fixed bundle product selections price\n     *\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",304],["T_WHITESPACE","\n    ",308],["T_PROTECTED","protected",309],["T_WHITESPACE"," ",309],["T_FUNCTION","function",309],["T_WHITESPACE"," ",309],["T_STRING","_calculateBundleOptionPrice",309],"(",")",["T_WHITESPACE","\n    ",309],"{",["T_WHITESPACE","\n        ",310],["T_VARIABLE","$write",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_getWriteAdapter",311],"(",")",";",["T_WHITESPACE","\n\n        ",311],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_prepareBundleSelectionTable",313],"(",")",";",["T_WHITESPACE","\n        ",313],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_calculateBundleSelectionPrice",314],"(",["T_STRING","Mage_Bundle_Model_Product_Price",314],["T_DOUBLE_COLON","::",314],["T_STRING","PRICE_TYPE_FIXED",314],")",";",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_calculateBundleSelectionPrice",315],"(",["T_STRING","Mage_Bundle_Model_Product_Price",315],["T_DOUBLE_COLON","::",315],["T_STRING","PRICE_TYPE_DYNAMIC",315],")",";",["T_WHITESPACE","\n\n        ",315],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_prepareBundleOptionTable",317],"(",")",";",["T_WHITESPACE","\n\n        ",317],["T_VARIABLE","$select",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_VARIABLE","$write",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","select",319],"(",")",["T_WHITESPACE","\n            ",319],["T_OBJECT_OPERATOR","->",320],["T_STRING","from",320],"(",["T_WHITESPACE","\n                ",320],["T_ARRAY","array",321],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",321],["T_WHITESPACE"," ",321],["T_DOUBLE_ARROW","=>",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_getBundleSelectionTable",321],"(",")",")",",",["T_WHITESPACE","\n                ",321],["T_ARRAY","array",322],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",322],",",["T_WHITESPACE"," ",322],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",322],",",["T_WHITESPACE"," ",322],["T_CONSTANT_ENCAPSED_STRING","'website_id'",322],",",["T_WHITESPACE"," ",322],["T_CONSTANT_ENCAPSED_STRING","'option_id'",322],")",["T_WHITESPACE","\n            ",322],")",["T_WHITESPACE","\n            ",323],["T_OBJECT_OPERATOR","->",324],["T_STRING","group",324],"(",["T_ARRAY","array",324],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",324],",",["T_WHITESPACE"," ",324],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",324],",",["T_WHITESPACE"," ",324],["T_CONSTANT_ENCAPSED_STRING","'website_id'",324],",",["T_WHITESPACE"," ",324],["T_CONSTANT_ENCAPSED_STRING","'option_id'",324],",",["T_WHITESPACE"," ",324],["T_CONSTANT_ENCAPSED_STRING","'is_required'",324],",",["T_WHITESPACE"," ",324],["T_CONSTANT_ENCAPSED_STRING","'group_type'",324],")",")",["T_WHITESPACE","\n            ",324],["T_OBJECT_OPERATOR","->",325],["T_STRING","columns",325],"(",["T_ARRAY","array",325],"(",["T_WHITESPACE","\n                ",325],["T_CONSTANT_ENCAPSED_STRING","'min_price'",326],["T_WHITESPACE"," ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$write",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getCheckSql",326],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 1'",326],",",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.price)'",326],",",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","'0'",326],")",",",["T_WHITESPACE","\n                ",326],["T_CONSTANT_ENCAPSED_STRING","'alt_price'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$write",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getCheckSql",327],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 0'",327],",",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.price)'",327],",",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'0'",327],")",",",["T_WHITESPACE","\n                ",327],["T_CONSTANT_ENCAPSED_STRING","'max_price'",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$write",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","getCheckSql",328],"(",["T_CONSTANT_ENCAPSED_STRING","'i.group_type = 1'",328],",",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'SUM(i.price)'",328],",",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'MAX(i.price)'",328],")",",",["T_WHITESPACE","\n                ",328],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",329],["T_WHITESPACE"," ",329],["T_DOUBLE_ARROW","=>",329],["T_WHITESPACE"," ",329],["T_VARIABLE","$write",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getCheckSql",329],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 1'",329],",",["T_WHITESPACE"," ",329],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.tier_price)'",329],",",["T_WHITESPACE"," ",329],["T_CONSTANT_ENCAPSED_STRING","'0'",329],")",",",["T_WHITESPACE","\n                ",329],["T_CONSTANT_ENCAPSED_STRING","'alt_tier_price'",330],["T_WHITESPACE"," ",330],["T_DOUBLE_ARROW","=>",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$write",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getCheckSql",330],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 0'",330],",",["T_WHITESPACE"," ",330],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.tier_price)'",330],",",["T_WHITESPACE"," ",330],["T_CONSTANT_ENCAPSED_STRING","'0'",330],")",",",["T_WHITESPACE","\n                ",330],["T_CONSTANT_ENCAPSED_STRING","'group_price'",331],["T_WHITESPACE"," ",331],["T_DOUBLE_ARROW","=>",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$write",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getCheckSql",331],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 1'",331],",",["T_WHITESPACE"," ",331],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.group_price)'",331],",",["T_WHITESPACE"," ",331],["T_CONSTANT_ENCAPSED_STRING","'0'",331],")",",",["T_WHITESPACE","\n                ",331],["T_CONSTANT_ENCAPSED_STRING","'alt_group_price'",332],["T_WHITESPACE"," ",332],["T_DOUBLE_ARROW","=>",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$write",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getCheckSql",332],"(",["T_CONSTANT_ENCAPSED_STRING","'i.is_required = 0'",332],",",["T_WHITESPACE"," ",332],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.group_price)'",332],",",["T_WHITESPACE"," ",332],["T_CONSTANT_ENCAPSED_STRING","'0'",332],")",",",["T_WHITESPACE","\n            ",332],")",")",";",["T_WHITESPACE","\n\n        ",333],["T_VARIABLE","$query",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$select",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","insertFromSelect",335],"(",["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","_getBundleOptionTable",335],"(",")",")",";",["T_WHITESPACE","\n        ",335],["T_VARIABLE","$write",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","query",336],"(",["T_VARIABLE","$query",336],")",";",["T_WHITESPACE","\n\n        ",336],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_prepareDefaultFinalPriceTable",338],"(",")",";",["T_WHITESPACE","\n\n        ",338],["T_VARIABLE","$minPrice",340],["T_WHITESPACE","  ",340],"=",["T_WHITESPACE"," ",340],["T_NEW","new",340],["T_WHITESPACE"," ",340],["T_STRING","Zend_Db_Expr",340],"(",["T_VARIABLE","$write",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getCheckSql",340],"(",["T_WHITESPACE","\n            ",340],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.min_price) = 0'",341],",",["T_WHITESPACE","\n            ",341],["T_CONSTANT_ENCAPSED_STRING","'MIN(io.alt_price)'",342],",",["T_WHITESPACE","\n            ",342],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.min_price)'",343],["T_WHITESPACE","\n        ",343],")",["T_WHITESPACE"," ",344],".",["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","' + i.price'",344],")",";",["T_WHITESPACE","\n        ",344],["T_VARIABLE","$maxPrice",345],["T_WHITESPACE","  ",345],"=",["T_WHITESPACE"," ",345],["T_NEW","new",345],["T_WHITESPACE"," ",345],["T_STRING","Zend_Db_Expr",345],"(",["T_CONSTANT_ENCAPSED_STRING","\"SUM(io.max_price) + i.price\"",345],")",";",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$tierPrice",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$write",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getCheckSql",346],"(",["T_WHITESPACE","\n            ",346],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.tier_percent) IS NOT NULL'",347],",",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$write",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getCheckSql",348],"(",["T_WHITESPACE","\n                ",348],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.tier_price) = 0'",349],",",["T_WHITESPACE","\n                ",349],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.alt_tier_price)'",350],",",["T_WHITESPACE","\n                ",350],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.tier_price)'",351],["T_WHITESPACE","\n            ",351],")",["T_WHITESPACE"," ",352],".",["T_WHITESPACE"," ",352],["T_CONSTANT_ENCAPSED_STRING","' + MIN(i.tier_price)'",352],",",["T_WHITESPACE","\n            ",352],["T_CONSTANT_ENCAPSED_STRING","'NULL'",353],["T_WHITESPACE","\n        ",353],")",";",["T_WHITESPACE","\n        ",354],["T_VARIABLE","$groupPrice",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_VARIABLE","$write",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getCheckSql",355],"(",["T_WHITESPACE","\n            ",355],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.group_price_percent) IS NOT NULL'",356],",",["T_WHITESPACE","\n            ",356],["T_VARIABLE","$write",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getCheckSql",357],"(",["T_WHITESPACE","\n                ",357],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.group_price) = 0'",358],",",["T_WHITESPACE","\n                ",358],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.alt_group_price)'",359],",",["T_WHITESPACE","\n                ",359],["T_CONSTANT_ENCAPSED_STRING","'SUM(io.group_price)'",360],["T_WHITESPACE","\n            ",360],")",["T_WHITESPACE"," ",361],".",["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","' + MIN(i.group_price)'",361],",",["T_WHITESPACE","\n            ",361],["T_CONSTANT_ENCAPSED_STRING","'NULL'",362],["T_WHITESPACE","\n        ",362],")",";",["T_WHITESPACE","\n\n        ",363],["T_VARIABLE","$select",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_VARIABLE","$write",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","select",365],"(",")",["T_WHITESPACE","\n            ",365],["T_OBJECT_OPERATOR","->",366],["T_STRING","from",366],"(",["T_WHITESPACE","\n                ",366],["T_ARRAY","array",367],"(",["T_CONSTANT_ENCAPSED_STRING","'io'",367],["T_WHITESPACE"," ",367],["T_DOUBLE_ARROW","=>",367],["T_WHITESPACE"," ",367],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","_getBundleOptionTable",367],"(",")",")",",",["T_WHITESPACE","\n                ",367],["T_ARRAY","array",368],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",368],",",["T_WHITESPACE"," ",368],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",368],",",["T_WHITESPACE"," ",368],["T_CONSTANT_ENCAPSED_STRING","'website_id'",368],")",["T_WHITESPACE","\n            ",368],")",["T_WHITESPACE","\n            ",369],["T_OBJECT_OPERATOR","->",370],["T_STRING","join",370],"(",["T_WHITESPACE","\n                ",370],["T_ARRAY","array",371],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",371],["T_WHITESPACE"," ",371],["T_DOUBLE_ARROW","=>",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","_getBundlePriceTable",371],"(",")",")",",",["T_WHITESPACE","\n                ",371],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id = io.entity_id AND i.customer_group_id = io.customer_group_id'",372],["T_WHITESPACE","\n                ",372],".",["T_WHITESPACE"," ",373],["T_CONSTANT_ENCAPSED_STRING","' AND i.website_id = io.website_id'",373],",",["T_WHITESPACE","\n                ",373],["T_ARRAY","array",374],"(",")",["T_WHITESPACE","\n            ",374],")",["T_WHITESPACE","\n            ",375],["T_OBJECT_OPERATOR","->",376],["T_STRING","group",376],"(",["T_ARRAY","array",376],"(",["T_CONSTANT_ENCAPSED_STRING","'io.entity_id'",376],",",["T_WHITESPACE"," ",376],["T_CONSTANT_ENCAPSED_STRING","'io.customer_group_id'",376],",",["T_WHITESPACE"," ",376],["T_CONSTANT_ENCAPSED_STRING","'io.website_id'",376],",",["T_WHITESPACE","\n                ",376],["T_CONSTANT_ENCAPSED_STRING","'i.tax_class_id'",377],",",["T_WHITESPACE"," ",377],["T_CONSTANT_ENCAPSED_STRING","'i.orig_price'",377],",",["T_WHITESPACE"," ",377],["T_CONSTANT_ENCAPSED_STRING","'i.price'",377],")",")",["T_WHITESPACE","\n            ",377],["T_OBJECT_OPERATOR","->",378],["T_STRING","columns",378],"(",["T_ARRAY","array",378],"(",["T_CONSTANT_ENCAPSED_STRING","'i.tax_class_id'",378],",",["T_WHITESPACE","\n                ",378],["T_CONSTANT_ENCAPSED_STRING","'orig_price'",379],["T_WHITESPACE","       ",379],["T_DOUBLE_ARROW","=>",379],["T_WHITESPACE"," ",379],["T_CONSTANT_ENCAPSED_STRING","'i.orig_price'",379],",",["T_WHITESPACE","\n                ",379],["T_CONSTANT_ENCAPSED_STRING","'price'",380],["T_WHITESPACE","            ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_CONSTANT_ENCAPSED_STRING","'i.price'",380],",",["T_WHITESPACE","\n                ",380],["T_CONSTANT_ENCAPSED_STRING","'min_price'",381],["T_WHITESPACE","        ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$minPrice",381],",",["T_WHITESPACE","\n                ",381],["T_CONSTANT_ENCAPSED_STRING","'max_price'",382],["T_WHITESPACE","        ",382],["T_DOUBLE_ARROW","=>",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$maxPrice",382],",",["T_WHITESPACE","\n                ",382],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",383],["T_WHITESPACE","       ",383],["T_DOUBLE_ARROW","=>",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$tierPrice",383],",",["T_WHITESPACE","\n                ",383],["T_CONSTANT_ENCAPSED_STRING","'base_tier'",384],["T_WHITESPACE","        ",384],["T_DOUBLE_ARROW","=>",384],["T_WHITESPACE"," ",384],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.base_tier)'",384],",",["T_WHITESPACE","\n                ",384],["T_CONSTANT_ENCAPSED_STRING","'group_price'",385],["T_WHITESPACE","      ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$groupPrice",385],",",["T_WHITESPACE","\n                ",385],["T_CONSTANT_ENCAPSED_STRING","'base_group_price'",386],["T_WHITESPACE"," ",386],["T_DOUBLE_ARROW","=>",386],["T_WHITESPACE"," ",386],["T_CONSTANT_ENCAPSED_STRING","'MIN(i.base_group_price)'",386],",",["T_WHITESPACE","\n            ",386],")",")",";",["T_WHITESPACE","\n\n        ",387],["T_VARIABLE","$query",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_VARIABLE","$select",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","insertFromSelect",389],"(",["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_getDefaultFinalPriceTable",389],"(",")",")",";",["T_WHITESPACE","\n        ",389],["T_VARIABLE","$write",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","query",390],"(",["T_VARIABLE","$query",390],")",";",["T_WHITESPACE","\n\n        ",390],["T_RETURN","return",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],";",["T_WHITESPACE","\n    ",392],"}",["T_WHITESPACE","\n\n    ",393],["T_DOC_COMMENT","\/**\n     * Calculate bundle product selections price by product type\n     *\n     * @param int $priceType\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",395],["T_WHITESPACE","\n    ",400],["T_PROTECTED","protected",401],["T_WHITESPACE"," ",401],["T_FUNCTION","function",401],["T_WHITESPACE"," ",401],["T_STRING","_calculateBundleSelectionPrice",401],"(",["T_VARIABLE","$priceType",401],")",["T_WHITESPACE","\n    ",401],"{",["T_WHITESPACE","\n        ",402],["T_VARIABLE","$write",403],["T_WHITESPACE"," ",403],"=",["T_WHITESPACE"," ",403],["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_getWriteAdapter",403],"(",")",";",["T_WHITESPACE","\n\n        ",403],["T_IF","if",405],["T_WHITESPACE"," ",405],"(",["T_VARIABLE","$priceType",405],["T_WHITESPACE"," ",405],["T_IS_EQUAL","==",405],["T_WHITESPACE"," ",405],["T_STRING","Mage_Bundle_Model_Product_Price",405],["T_DOUBLE_COLON","::",405],["T_STRING","PRICE_TYPE_FIXED",405],")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n\n            ",405],["T_VARIABLE","$selectionPriceValue",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$write",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getCheckSql",407],"(",["T_WHITESPACE","\n                ",407],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_value IS NULL'",408],",",["T_WHITESPACE","\n                ",408],["T_CONSTANT_ENCAPSED_STRING","'bs.selection_price_value'",409],",",["T_WHITESPACE","\n                ",409],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_value'",410],["T_WHITESPACE","\n            ",410],")",";",["T_WHITESPACE","\n            ",411],["T_VARIABLE","$selectionPriceType",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_VARIABLE","$write",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getCheckSql",412],"(",["T_WHITESPACE","\n                ",412],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_type IS NULL'",413],",",["T_WHITESPACE","\n                ",413],["T_CONSTANT_ENCAPSED_STRING","'bs.selection_price_type'",414],",",["T_WHITESPACE","\n                ",414],["T_CONSTANT_ENCAPSED_STRING","'bsp.selection_price_type'",415],["T_WHITESPACE","\n            ",415],")",";",["T_WHITESPACE","\n            ",416],["T_VARIABLE","$priceExpr",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_NEW","new",417],["T_WHITESPACE"," ",417],["T_STRING","Zend_Db_Expr",417],"(",["T_WHITESPACE","\n                ",417],["T_VARIABLE","$write",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getCheckSql",418],"(",["T_WHITESPACE","\n                    ",418],["T_VARIABLE","$selectionPriceType",419],["T_WHITESPACE"," ",419],".",["T_WHITESPACE"," ",419],["T_CONSTANT_ENCAPSED_STRING","' = 1'",419],",",["T_WHITESPACE","\n                    ",419],["T_CONSTANT_ENCAPSED_STRING","'ROUND(i.price * ('",420],["T_WHITESPACE"," ",420],".",["T_WHITESPACE"," ",420],["T_VARIABLE","$selectionPriceValue",420],["T_WHITESPACE"," ",420],".",["T_WHITESPACE"," ",420],["T_CONSTANT_ENCAPSED_STRING","' \/ 100),2)'",420],",",["T_WHITESPACE","\n                    ",420],["T_VARIABLE","$write",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getCheckSql",421],"(",["T_WHITESPACE","\n                        ",421],["T_CONSTANT_ENCAPSED_STRING","'i.special_price > 0 AND i.special_price < 100'",422],",",["T_WHITESPACE","\n                        ",422],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",423],["T_WHITESPACE"," ",423],".",["T_WHITESPACE"," ",423],["T_VARIABLE","$selectionPriceValue",423],["T_WHITESPACE"," ",423],".",["T_WHITESPACE"," ",423],["T_CONSTANT_ENCAPSED_STRING","' * (i.special_price \/ 100),2)'",423],",",["T_WHITESPACE","\n                        ",423],["T_VARIABLE","$selectionPriceValue",424],["T_WHITESPACE","\n                    ",424],")",["T_WHITESPACE","\n                ",425],")",["T_WHITESPACE"," ",426],".",["T_WHITESPACE"," ",426],["T_CONSTANT_ENCAPSED_STRING","'* bs.selection_qty'",426],["T_WHITESPACE","\n            ",426],")",";",["T_WHITESPACE","\n\n            ",427],["T_VARIABLE","$tierExpr",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$write",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getCheckSql",429],"(",["T_WHITESPACE","\n                ",429],["T_CONSTANT_ENCAPSED_STRING","'i.base_tier IS NOT NULL'",430],",",["T_WHITESPACE","\n                ",430],["T_VARIABLE","$write",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getCheckSql",431],"(",["T_WHITESPACE","\n                    ",431],["T_VARIABLE","$selectionPriceType",432],["T_WHITESPACE"," ",432],".",["T_CONSTANT_ENCAPSED_STRING","' = 1'",432],",",["T_WHITESPACE","\n                    ",432],["T_CONSTANT_ENCAPSED_STRING","'ROUND(i.base_tier - (i.base_tier * ('",433],["T_WHITESPACE"," ",433],".",["T_WHITESPACE"," ",433],["T_VARIABLE","$selectionPriceValue",433],["T_WHITESPACE"," ",433],".",["T_WHITESPACE"," ",433],["T_CONSTANT_ENCAPSED_STRING","' \/ 100)),2)'",433],",",["T_WHITESPACE","\n                    ",433],["T_VARIABLE","$write",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getCheckSql",434],"(",["T_WHITESPACE","\n                        ",434],["T_CONSTANT_ENCAPSED_STRING","'i.tier_percent > 0'",435],",",["T_WHITESPACE","\n                        ",435],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",436],["T_WHITESPACE"," ",436],".",["T_WHITESPACE"," ",436],["T_VARIABLE","$selectionPriceValue",436],["T_WHITESPACE","\n                        ",436],".",["T_WHITESPACE"," ",437],["T_CONSTANT_ENCAPSED_STRING","' - ('",437],["T_WHITESPACE"," ",437],".",["T_WHITESPACE"," ",437],["T_VARIABLE","$selectionPriceValue",437],["T_WHITESPACE"," ",437],".",["T_WHITESPACE"," ",437],["T_CONSTANT_ENCAPSED_STRING","' * (i.tier_percent \/ 100)),2)'",437],",",["T_WHITESPACE","\n                        ",437],["T_VARIABLE","$selectionPriceValue",438],["T_WHITESPACE","\n                    ",438],")",["T_WHITESPACE","\n                ",439],")",["T_WHITESPACE"," ",440],".",["T_WHITESPACE"," ",440],["T_CONSTANT_ENCAPSED_STRING","' * bs.selection_qty'",440],",",["T_WHITESPACE","\n                ",440],["T_CONSTANT_ENCAPSED_STRING","'NULL'",441],["T_WHITESPACE","\n            ",441],")",";",["T_WHITESPACE","\n\n            ",442],["T_VARIABLE","$groupExpr",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_VARIABLE","$write",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getCheckSql",444],"(",["T_WHITESPACE","\n                ",444],["T_CONSTANT_ENCAPSED_STRING","'i.base_group_price IS NOT NULL'",445],",",["T_WHITESPACE","\n                ",445],["T_VARIABLE","$write",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getCheckSql",446],"(",["T_WHITESPACE","\n                    ",446],["T_VARIABLE","$selectionPriceType",447],["T_WHITESPACE"," ",447],".",["T_CONSTANT_ENCAPSED_STRING","' = 1'",447],",",["T_WHITESPACE","\n                    ",447],["T_VARIABLE","$priceExpr",448],",",["T_WHITESPACE","\n                    ",448],["T_VARIABLE","$write",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getCheckSql",449],"(",["T_WHITESPACE","\n                        ",449],["T_CONSTANT_ENCAPSED_STRING","'i.group_price_percent > 0'",450],",",["T_WHITESPACE","\n                        ",450],["T_CONSTANT_ENCAPSED_STRING","'ROUND('",451],["T_WHITESPACE"," ",451],".",["T_WHITESPACE"," ",451],["T_VARIABLE","$selectionPriceValue",451],["T_WHITESPACE","\n                        ",451],".",["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","' - ('",452],["T_WHITESPACE"," ",452],".",["T_WHITESPACE"," ",452],["T_VARIABLE","$selectionPriceValue",452],["T_WHITESPACE"," ",452],".",["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","' * (i.group_price_percent \/ 100)),2)'",452],",",["T_WHITESPACE","\n                        ",452],["T_VARIABLE","$selectionPriceValue",453],["T_WHITESPACE","\n                    ",453],")",["T_WHITESPACE","\n                ",454],")",["T_WHITESPACE"," ",455],".",["T_WHITESPACE"," ",455],["T_CONSTANT_ENCAPSED_STRING","' * bs.selection_qty'",455],",",["T_WHITESPACE","\n                ",455],["T_CONSTANT_ENCAPSED_STRING","'NULL'",456],["T_WHITESPACE","\n            ",456],")",";",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$priceExpr",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_NEW","new",458],["T_WHITESPACE"," ",458],["T_STRING","Zend_Db_Expr",458],"(",["T_WHITESPACE","\n                ",458],["T_VARIABLE","$write",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","getCheckSql",459],"(","\"",["T_CURLY_OPEN","{",459],["T_VARIABLE","$groupExpr",459],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",459],["T_CURLY_OPEN","{",459],["T_VARIABLE","$priceExpr",459],"}","\"",",",["T_WHITESPACE"," ",459],["T_VARIABLE","$groupExpr",459],",",["T_WHITESPACE"," ",459],["T_VARIABLE","$priceExpr",459],")",["T_WHITESPACE","\n            ",459],")",";",["T_WHITESPACE","\n        ",460],"}",["T_WHITESPACE"," ",461],["T_ELSE","else",461],["T_WHITESPACE"," ",461],"{",["T_WHITESPACE","\n            ",461],["T_VARIABLE","$priceExpr",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_NEW","new",462],["T_WHITESPACE"," ",462],["T_STRING","Zend_Db_Expr",462],"(",["T_WHITESPACE","\n                ",462],["T_VARIABLE","$write",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getCheckSql",463],"(",["T_WHITESPACE","\n                    ",463],["T_CONSTANT_ENCAPSED_STRING","'i.special_price > 0 AND i.special_price < 100'",464],",",["T_WHITESPACE","\n                    ",464],["T_CONSTANT_ENCAPSED_STRING","'ROUND(idx.min_price * (i.special_price \/ 100), 2)'",465],",",["T_WHITESPACE","\n                    ",465],["T_CONSTANT_ENCAPSED_STRING","'idx.min_price'",466],["T_WHITESPACE","\n                ",466],")",["T_WHITESPACE"," ",467],".",["T_WHITESPACE"," ",467],["T_CONSTANT_ENCAPSED_STRING","' * bs.selection_qty'",467],["T_WHITESPACE","\n            ",467],")",";",["T_WHITESPACE","\n            ",468],["T_VARIABLE","$tierExpr",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$write",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getCheckSql",469],"(",["T_WHITESPACE","\n                ",469],["T_CONSTANT_ENCAPSED_STRING","'i.base_tier IS NOT NULL'",470],",",["T_WHITESPACE","\n                ",470],["T_CONSTANT_ENCAPSED_STRING","'ROUND(idx.min_price * (i.base_tier \/ 100), 2)* bs.selection_qty'",471],",",["T_WHITESPACE","\n                ",471],["T_CONSTANT_ENCAPSED_STRING","'NULL'",472],["T_WHITESPACE","\n            ",472],")",";",["T_WHITESPACE","\n            ",473],["T_VARIABLE","$groupExpr",474],["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],["T_VARIABLE","$write",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getCheckSql",474],"(",["T_WHITESPACE","\n                ",474],["T_CONSTANT_ENCAPSED_STRING","'i.base_group_price IS NOT NULL'",475],",",["T_WHITESPACE","\n                ",475],["T_CONSTANT_ENCAPSED_STRING","'ROUND(idx.min_price * (i.base_group_price \/ 100), 2)* bs.selection_qty'",476],",",["T_WHITESPACE","\n                ",476],["T_CONSTANT_ENCAPSED_STRING","'NULL'",477],["T_WHITESPACE","\n            ",477],")",";",["T_WHITESPACE","\n            ",478],["T_VARIABLE","$groupPriceExpr",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_NEW","new",479],["T_WHITESPACE"," ",479],["T_STRING","Zend_Db_Expr",479],"(",["T_WHITESPACE","\n                ",479],["T_VARIABLE","$write",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getCheckSql",480],"(",["T_WHITESPACE","\n                    ",480],["T_CONSTANT_ENCAPSED_STRING","'i.base_group_price IS NOT NULL AND i.base_group_price > 0 AND i.base_group_price < 100'",481],",",["T_WHITESPACE","\n                    ",481],["T_CONSTANT_ENCAPSED_STRING","'ROUND(idx.min_price - idx.min_price * (i.base_group_price \/ 100), 2)'",482],",",["T_WHITESPACE","\n                    ",482],["T_CONSTANT_ENCAPSED_STRING","'idx.min_price'",483],["T_WHITESPACE","\n                ",483],")",["T_WHITESPACE"," ",484],".",["T_WHITESPACE"," ",484],["T_CONSTANT_ENCAPSED_STRING","' * bs.selection_qty'",484],["T_WHITESPACE","\n            ",484],")",";",["T_WHITESPACE","\n            ",485],["T_VARIABLE","$priceExpr",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_NEW","new",486],["T_WHITESPACE"," ",486],["T_STRING","Zend_Db_Expr",486],"(",["T_WHITESPACE","\n                ",486],["T_VARIABLE","$write",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getCheckSql",487],"(","\"",["T_CURLY_OPEN","{",487],["T_VARIABLE","$groupPriceExpr",487],"}",["T_ENCAPSED_AND_WHITESPACE"," < ",487],["T_CURLY_OPEN","{",487],["T_VARIABLE","$priceExpr",487],"}","\"",",",["T_WHITESPACE"," ",487],["T_VARIABLE","$groupPriceExpr",487],",",["T_WHITESPACE"," ",487],["T_VARIABLE","$priceExpr",487],")",["T_WHITESPACE","\n            ",487],")",";",["T_WHITESPACE","\n        ",488],"}",["T_WHITESPACE","\n\n        ",489],["T_VARIABLE","$select",491],["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_VARIABLE","$write",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","select",491],"(",")",["T_WHITESPACE","\n            ",491],["T_OBJECT_OPERATOR","->",492],["T_STRING","from",492],"(",["T_WHITESPACE","\n                ",492],["T_ARRAY","array",493],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",493],["T_WHITESPACE"," ",493],["T_DOUBLE_ARROW","=>",493],["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","_getBundlePriceTable",493],"(",")",")",",",["T_WHITESPACE","\n                ",493],["T_ARRAY","array",494],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",494],",",["T_WHITESPACE"," ",494],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",494],",",["T_WHITESPACE"," ",494],["T_CONSTANT_ENCAPSED_STRING","'website_id'",494],")",["T_WHITESPACE","\n            ",494],")",["T_WHITESPACE","\n            ",495],["T_OBJECT_OPERATOR","->",496],["T_STRING","join",496],"(",["T_WHITESPACE","\n                ",496],["T_ARRAY","array",497],"(",["T_CONSTANT_ENCAPSED_STRING","'bo'",497],["T_WHITESPACE"," ",497],["T_DOUBLE_ARROW","=>",497],["T_WHITESPACE"," ",497],["T_VARIABLE","$this",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getTable",497],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option'",497],")",")",",",["T_WHITESPACE","\n                ",497],["T_CONSTANT_ENCAPSED_STRING","'bo.parent_id = i.entity_id'",498],",",["T_WHITESPACE","\n                ",498],["T_ARRAY","array",499],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",499],")",["T_WHITESPACE","\n            ",499],")",["T_WHITESPACE","\n            ",500],["T_OBJECT_OPERATOR","->",501],["T_STRING","join",501],"(",["T_WHITESPACE","\n                ",501],["T_ARRAY","array",502],"(",["T_CONSTANT_ENCAPSED_STRING","'bs'",502],["T_WHITESPACE"," ",502],["T_DOUBLE_ARROW","=>",502],["T_WHITESPACE"," ",502],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getTable",502],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",502],")",")",",",["T_WHITESPACE","\n                ",502],["T_CONSTANT_ENCAPSED_STRING","'bs.option_id = bo.option_id'",503],",",["T_WHITESPACE","\n                ",503],["T_ARRAY","array",504],"(",["T_CONSTANT_ENCAPSED_STRING","'selection_id'",504],")",["T_WHITESPACE","\n            ",504],")",["T_WHITESPACE","\n            ",505],["T_OBJECT_OPERATOR","->",506],["T_STRING","joinLeft",506],"(",["T_WHITESPACE","\n                ",506],["T_ARRAY","array",507],"(",["T_CONSTANT_ENCAPSED_STRING","'bsp'",507],["T_WHITESPACE"," ",507],["T_DOUBLE_ARROW","=>",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getTable",507],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection_price'",507],")",")",",",["T_WHITESPACE","\n                ",507],["T_CONSTANT_ENCAPSED_STRING","'bs.selection_id = bsp.selection_id AND bsp.website_id = i.website_id'",508],",",["T_WHITESPACE","\n                ",508],["T_ARRAY","array",509],"(",["T_CONSTANT_ENCAPSED_STRING","''",509],")",["T_WHITESPACE","\n            ",509],")",["T_WHITESPACE","\n            ",510],["T_OBJECT_OPERATOR","->",511],["T_STRING","join",511],"(",["T_WHITESPACE","\n                ",511],["T_ARRAY","array",512],"(",["T_CONSTANT_ENCAPSED_STRING","'idx'",512],["T_WHITESPACE"," ",512],["T_DOUBLE_ARROW","=>",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getIdxTable",512],"(",")",")",",",["T_WHITESPACE","\n                ",512],["T_CONSTANT_ENCAPSED_STRING","'bs.product_id = idx.entity_id AND i.customer_group_id = idx.customer_group_id'",513],["T_WHITESPACE","\n                ",513],".",["T_WHITESPACE"," ",514],["T_CONSTANT_ENCAPSED_STRING","' AND i.website_id = idx.website_id'",514],",",["T_WHITESPACE","\n                ",514],["T_ARRAY","array",515],"(",")",["T_WHITESPACE","\n            ",515],")",["T_WHITESPACE","\n            ",516],["T_OBJECT_OPERATOR","->",517],["T_STRING","join",517],"(",["T_WHITESPACE","\n                ",517],["T_ARRAY","array",518],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",518],["T_WHITESPACE"," ",518],["T_DOUBLE_ARROW","=>",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getTable",518],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",518],")",")",",",["T_WHITESPACE","\n                ",518],["T_CONSTANT_ENCAPSED_STRING","'bs.product_id = e.entity_id AND e.required_options=0'",519],",",["T_WHITESPACE","\n                ",519],["T_ARRAY","array",520],"(",")",["T_WHITESPACE","\n            ",520],")",["T_WHITESPACE","\n            ",521],["T_OBJECT_OPERATOR","->",522],["T_STRING","where",522],"(",["T_CONSTANT_ENCAPSED_STRING","'i.price_type=?'",522],",",["T_WHITESPACE"," ",522],["T_VARIABLE","$priceType",522],")",["T_WHITESPACE","\n            ",522],["T_OBJECT_OPERATOR","->",523],["T_STRING","columns",523],"(",["T_ARRAY","array",523],"(",["T_WHITESPACE","\n                ",523],["T_CONSTANT_ENCAPSED_STRING","'group_type'",524],["T_WHITESPACE","    ",524],["T_DOUBLE_ARROW","=>",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$write",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","getCheckSql",524],"(",["T_WHITESPACE","\n                    ",524],["T_CONSTANT_ENCAPSED_STRING","\"bo.type = 'select' OR bo.type = 'radio'\"",525],",",["T_WHITESPACE","\n                    ",525],["T_CONSTANT_ENCAPSED_STRING","'0'",526],",",["T_WHITESPACE","\n                    ",526],["T_CONSTANT_ENCAPSED_STRING","'1'",527],["T_WHITESPACE","\n                ",527],")",",",["T_WHITESPACE","\n                ",528],["T_CONSTANT_ENCAPSED_STRING","'is_required'",529],["T_WHITESPACE","   ",529],["T_DOUBLE_ARROW","=>",529],["T_WHITESPACE"," ",529],["T_CONSTANT_ENCAPSED_STRING","'bo.required'",529],",",["T_WHITESPACE","\n                ",529],["T_CONSTANT_ENCAPSED_STRING","'price'",530],["T_WHITESPACE","         ",530],["T_DOUBLE_ARROW","=>",530],["T_WHITESPACE"," ",530],["T_VARIABLE","$priceExpr",530],",",["T_WHITESPACE","\n                ",530],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",531],["T_WHITESPACE","    ",531],["T_DOUBLE_ARROW","=>",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$tierExpr",531],",",["T_WHITESPACE","\n                ",531],["T_CONSTANT_ENCAPSED_STRING","'group_price'",532],["T_WHITESPACE","   ",532],["T_DOUBLE_ARROW","=>",532],["T_WHITESPACE"," ",532],["T_VARIABLE","$groupExpr",532],",",["T_WHITESPACE","\n            ",532],")",")",";",["T_WHITESPACE","\n\n        ",533],["T_VARIABLE","$query",535],["T_WHITESPACE"," ",535],"=",["T_WHITESPACE"," ",535],["T_VARIABLE","$select",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","insertFromSelect",535],"(",["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","_getBundleSelectionTable",535],"(",")",")",";",["T_WHITESPACE","\n        ",535],["T_VARIABLE","$write",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","query",536],"(",["T_VARIABLE","$query",536],")",";",["T_WHITESPACE","\n\n        ",536],["T_RETURN","return",538],["T_WHITESPACE"," ",538],["T_VARIABLE","$this",538],";",["T_WHITESPACE","\n    ",538],"}",["T_WHITESPACE","\n\n    ",539],["T_DOC_COMMENT","\/**\n     * Prepare temporary index price for bundle products\n     *\n     * @param int|array $entityIds  the entity ids limitation\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",541],["T_WHITESPACE","\n    ",546],["T_PROTECTED","protected",547],["T_WHITESPACE"," ",547],["T_FUNCTION","function",547],["T_WHITESPACE"," ",547],["T_STRING","_prepareBundlePrice",547],"(",["T_VARIABLE","$entityIds",547],["T_WHITESPACE"," ",547],"=",["T_WHITESPACE"," ",547],["T_STRING","null",547],")",["T_WHITESPACE","\n    ",547],"{",["T_WHITESPACE","\n        ",548],["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","_prepareTierPriceIndex",549],"(",["T_VARIABLE","$entityIds",549],")",";",["T_WHITESPACE","\n        ",549],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_prepareGroupPriceIndex",550],"(",["T_VARIABLE","$entityIds",550],")",";",["T_WHITESPACE","\n        ",550],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_prepareBundlePriceTable",551],"(",")",";",["T_WHITESPACE","\n        ",551],["T_VARIABLE","$this",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","_prepareBundlePriceByType",552],"(",["T_STRING","Mage_Bundle_Model_Product_Price",552],["T_DOUBLE_COLON","::",552],["T_STRING","PRICE_TYPE_FIXED",552],",",["T_WHITESPACE"," ",552],["T_VARIABLE","$entityIds",552],")",";",["T_WHITESPACE","\n        ",552],["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","_prepareBundlePriceByType",553],"(",["T_STRING","Mage_Bundle_Model_Product_Price",553],["T_DOUBLE_COLON","::",553],["T_STRING","PRICE_TYPE_DYNAMIC",553],",",["T_WHITESPACE"," ",553],["T_VARIABLE","$entityIds",553],")",";",["T_WHITESPACE","\n\n        ",553],["T_DOC_COMMENT","\/**\n         * Add possibility modify prices from external events\n         *\/",555],["T_WHITESPACE","\n        ",557],["T_VARIABLE","$select",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","_getWriteAdapter",558],"(",")",["T_OBJECT_OPERATOR","->",558],["T_STRING","select",558],"(",")",["T_WHITESPACE","\n            ",558],["T_OBJECT_OPERATOR","->",559],["T_STRING","join",559],"(",["T_ARRAY","array",559],"(",["T_CONSTANT_ENCAPSED_STRING","'wd'",559],["T_WHITESPACE"," ",559],["T_DOUBLE_ARROW","=>",559],["T_WHITESPACE"," ",559],["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","_getWebsiteDateTable",559],"(",")",")",",",["T_WHITESPACE","\n                ",559],["T_CONSTANT_ENCAPSED_STRING","'i.website_id = wd.website_id'",560],",",["T_WHITESPACE","\n                ",560],["T_ARRAY","array",561],"(",")",["T_WHITESPACE","\n            ",561],")",";",["T_WHITESPACE","\n        ",562],["T_STRING","Mage",563],["T_DOUBLE_COLON","::",563],["T_STRING","dispatchEvent",563],"(",["T_CONSTANT_ENCAPSED_STRING","'prepare_catalog_product_price_index_table'",563],",",["T_WHITESPACE"," ",563],["T_ARRAY","array",563],"(",["T_WHITESPACE","\n            ",563],["T_CONSTANT_ENCAPSED_STRING","'index_table'",564],["T_WHITESPACE","       ",564],["T_DOUBLE_ARROW","=>",564],["T_WHITESPACE"," ",564],["T_ARRAY","array",564],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",564],["T_WHITESPACE"," ",564],["T_DOUBLE_ARROW","=>",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","_getBundlePriceTable",564],"(",")",")",",",["T_WHITESPACE","\n            ",564],["T_CONSTANT_ENCAPSED_STRING","'select'",565],["T_WHITESPACE","            ",565],["T_DOUBLE_ARROW","=>",565],["T_WHITESPACE"," ",565],["T_VARIABLE","$select",565],",",["T_WHITESPACE","\n            ",565],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",566],["T_WHITESPACE","         ",566],["T_DOUBLE_ARROW","=>",566],["T_WHITESPACE"," ",566],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id'",566],",",["T_WHITESPACE","\n            ",566],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",567],["T_WHITESPACE"," ",567],["T_DOUBLE_ARROW","=>",567],["T_WHITESPACE"," ",567],["T_CONSTANT_ENCAPSED_STRING","'i.customer_group_id'",567],",",["T_WHITESPACE","\n            ",567],["T_CONSTANT_ENCAPSED_STRING","'website_id'",568],["T_WHITESPACE","        ",568],["T_DOUBLE_ARROW","=>",568],["T_WHITESPACE"," ",568],["T_CONSTANT_ENCAPSED_STRING","'i.website_id'",568],",",["T_WHITESPACE","\n            ",568],["T_CONSTANT_ENCAPSED_STRING","'website_date'",569],["T_WHITESPACE","      ",569],["T_DOUBLE_ARROW","=>",569],["T_WHITESPACE"," ",569],["T_CONSTANT_ENCAPSED_STRING","'wd.website_date'",569],",",["T_WHITESPACE","\n            ",569],["T_CONSTANT_ENCAPSED_STRING","'update_fields'",570],["T_WHITESPACE","     ",570],["T_DOUBLE_ARROW","=>",570],["T_WHITESPACE"," ",570],["T_ARRAY","array",570],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",570],",",["T_WHITESPACE"," ",570],["T_CONSTANT_ENCAPSED_STRING","'min_price'",570],",",["T_WHITESPACE"," ",570],["T_CONSTANT_ENCAPSED_STRING","'max_price'",570],")",["T_WHITESPACE","\n        ",570],")",")",";",["T_WHITESPACE","\n\n        ",571],["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","_calculateBundleOptionPrice",573],"(",")",";",["T_WHITESPACE","\n        ",573],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","_applyCustomOption",574],"(",")",";",["T_WHITESPACE","\n\n        ",574],["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","_movePriceDataToIndexTable",576],"(",")",";",["T_WHITESPACE","\n\n        ",576],["T_RETURN","return",578],["T_WHITESPACE"," ",578],["T_VARIABLE","$this",578],";",["T_WHITESPACE","\n    ",578],"}",["T_WHITESPACE","\n\n    ",579],["T_DOC_COMMENT","\/**\n     * Prepare percentage tier price for bundle products\n     *\n     * @see Mage_Catalog_Model_Resource_Product_Indexer_Price::_prepareTierPriceIndex\n     *\n     * @param int|array $entityIds\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",581],["T_WHITESPACE","\n    ",588],["T_PROTECTED","protected",589],["T_WHITESPACE"," ",589],["T_FUNCTION","function",589],["T_WHITESPACE"," ",589],["T_STRING","_prepareTierPriceIndex",589],"(",["T_VARIABLE","$entityIds",589],["T_WHITESPACE"," ",589],"=",["T_WHITESPACE"," ",589],["T_STRING","null",589],")",["T_WHITESPACE","\n    ",589],"{",["T_WHITESPACE","\n        ",590],["T_VARIABLE","$adapter",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_getWriteAdapter",591],"(",")",";",["T_WHITESPACE","\n\n        ",591],["T_COMMENT","\/\/ remove index by bundle products\n",593],["T_WHITESPACE","        ",594],["T_VARIABLE","$select",594],["T_WHITESPACE","  ",594],"=",["T_WHITESPACE"," ",594],["T_VARIABLE","$adapter",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","select",594],"(",")",["T_WHITESPACE","\n            ",594],["T_OBJECT_OPERATOR","->",595],["T_STRING","from",595],"(",["T_ARRAY","array",595],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",595],["T_WHITESPACE"," ",595],["T_DOUBLE_ARROW","=>",595],["T_WHITESPACE"," ",595],["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","_getTierPriceIndexTable",595],"(",")",")",",",["T_WHITESPACE"," ",595],["T_STRING","null",595],")",["T_WHITESPACE","\n            ",595],["T_OBJECT_OPERATOR","->",596],["T_STRING","join",596],"(",["T_WHITESPACE","\n                ",596],["T_ARRAY","array",597],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",597],["T_WHITESPACE"," ",597],["T_DOUBLE_ARROW","=>",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","getTable",597],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",597],")",")",",",["T_WHITESPACE","\n                ",597],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id=e.entity_id'",598],",",["T_WHITESPACE","\n                ",598],["T_ARRAY","array",599],"(",")",["T_WHITESPACE","\n            ",599],")",["T_WHITESPACE","\n            ",600],["T_OBJECT_OPERATOR","->",601],["T_STRING","where",601],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",601],",",["T_WHITESPACE"," ",601],["T_VARIABLE","$this",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","getTypeId",601],"(",")",")",";",["T_WHITESPACE","\n        ",601],["T_VARIABLE","$query",602],["T_WHITESPACE","   ",602],"=",["T_WHITESPACE"," ",602],["T_VARIABLE","$select",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","deleteFromSelect",602],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",602],")",";",["T_WHITESPACE","\n        ",602],["T_VARIABLE","$adapter",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","query",603],"(",["T_VARIABLE","$query",603],")",";",["T_WHITESPACE","\n\n        ",603],["T_VARIABLE","$select",605],["T_WHITESPACE","  ",605],"=",["T_WHITESPACE"," ",605],["T_VARIABLE","$adapter",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","select",605],"(",")",["T_WHITESPACE","\n            ",605],["T_OBJECT_OPERATOR","->",606],["T_STRING","from",606],"(",["T_WHITESPACE","\n                ",606],["T_ARRAY","array",607],"(",["T_CONSTANT_ENCAPSED_STRING","'tp'",607],["T_WHITESPACE"," ",607],["T_DOUBLE_ARROW","=>",607],["T_WHITESPACE"," ",607],["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","getValueTable",607],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",607],",",["T_WHITESPACE"," ",607],["T_CONSTANT_ENCAPSED_STRING","'tier_price'",607],")",")",",",["T_WHITESPACE","\n                ",607],["T_ARRAY","array",608],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",608],")",["T_WHITESPACE","\n            ",608],")",["T_WHITESPACE","\n            ",609],["T_OBJECT_OPERATOR","->",610],["T_STRING","join",610],"(",["T_WHITESPACE","\n                ",610],["T_ARRAY","array",611],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",611],["T_WHITESPACE"," ",611],["T_DOUBLE_ARROW","=>",611],["T_WHITESPACE"," ",611],["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","getTable",611],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",611],")",")",",",["T_WHITESPACE","\n                ",611],["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id=e.entity_id'",612],",",["T_WHITESPACE","\n                ",612],["T_ARRAY","array",613],"(",")",["T_WHITESPACE","\n            ",613],")",["T_WHITESPACE","\n            ",614],["T_OBJECT_OPERATOR","->",615],["T_STRING","join",615],"(",["T_WHITESPACE","\n                ",615],["T_ARRAY","array",616],"(",["T_CONSTANT_ENCAPSED_STRING","'cg'",616],["T_WHITESPACE"," ",616],["T_DOUBLE_ARROW","=>",616],["T_WHITESPACE"," ",616],["T_VARIABLE","$this",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","getTable",616],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",616],")",")",",",["T_WHITESPACE","\n                ",616],["T_CONSTANT_ENCAPSED_STRING","'tp.all_groups = 1 OR (tp.all_groups = 0 AND tp.customer_group_id = cg.customer_group_id)'",617],",",["T_WHITESPACE","\n                ",617],["T_ARRAY","array",618],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",618],")",["T_WHITESPACE","\n            ",618],")",["T_WHITESPACE","\n            ",619],["T_OBJECT_OPERATOR","->",620],["T_STRING","join",620],"(",["T_WHITESPACE","\n                ",620],["T_ARRAY","array",621],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",621],["T_WHITESPACE"," ",621],["T_DOUBLE_ARROW","=>",621],["T_WHITESPACE"," ",621],["T_VARIABLE","$this",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","getTable",621],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",621],")",")",",",["T_WHITESPACE","\n                ",621],["T_CONSTANT_ENCAPSED_STRING","'tp.website_id = 0 OR tp.website_id = cw.website_id'",622],",",["T_WHITESPACE","\n                ",622],["T_ARRAY","array",623],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",623],")",["T_WHITESPACE","\n            ",623],")",["T_WHITESPACE","\n            ",624],["T_OBJECT_OPERATOR","->",625],["T_STRING","where",625],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",625],")",["T_WHITESPACE","\n            ",625],["T_OBJECT_OPERATOR","->",626],["T_STRING","where",626],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",626],",",["T_WHITESPACE"," ",626],["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getTypeId",626],"(",")",")",["T_WHITESPACE","\n            ",626],["T_OBJECT_OPERATOR","->",627],["T_STRING","columns",627],"(",["T_NEW","new",627],["T_WHITESPACE"," ",627],["T_STRING","Zend_Db_Expr",627],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(tp.value)'",627],")",")",["T_WHITESPACE","\n            ",627],["T_OBJECT_OPERATOR","->",628],["T_STRING","group",628],"(",["T_ARRAY","array",628],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id'",628],",",["T_WHITESPACE"," ",628],["T_CONSTANT_ENCAPSED_STRING","'cg.customer_group_id'",628],",",["T_WHITESPACE"," ",628],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",628],")",")",";",["T_WHITESPACE","\n\n        ",628],["T_IF","if",630],["T_WHITESPACE"," ",630],"(","!",["T_EMPTY","empty",630],"(",["T_VARIABLE","$entityIds",630],")",")",["T_WHITESPACE"," ",630],"{",["T_WHITESPACE","\n            ",630],["T_VARIABLE","$select",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","where",631],"(",["T_CONSTANT_ENCAPSED_STRING","'tp.entity_id IN(?)'",631],",",["T_WHITESPACE"," ",631],["T_VARIABLE","$entityIds",631],")",";",["T_WHITESPACE","\n        ",631],"}",["T_WHITESPACE","\n\n        ",632],["T_VARIABLE","$query",634],["T_WHITESPACE","   ",634],"=",["T_WHITESPACE"," ",634],["T_VARIABLE","$select",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","insertFromSelect",634],"(",["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","_getTierPriceIndexTable",634],"(",")",")",";",["T_WHITESPACE","\n        ",634],["T_VARIABLE","$adapter",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","query",635],"(",["T_VARIABLE","$query",635],")",";",["T_WHITESPACE","\n\n        ",635],["T_RETURN","return",637],["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],";",["T_WHITESPACE","\n    ",637],"}",["T_WHITESPACE","\n\n    ",638],["T_DOC_COMMENT","\/**\n     * Prepare percentage group price for bundle products\n     *\n     * @see Mage_Catalog_Model_Resource_Product_Indexer_Price::_prepareGroupPriceIndex\n     *\n     * @param int|array $entityIds\n     * @return Mage_Bundle_Model_Resource_Indexer_Price\n     *\/",640],["T_WHITESPACE","\n    ",647],["T_PROTECTED","protected",648],["T_WHITESPACE"," ",648],["T_FUNCTION","function",648],["T_WHITESPACE"," ",648],["T_STRING","_prepareGroupPriceIndex",648],"(",["T_VARIABLE","$entityIds",648],["T_WHITESPACE"," ",648],"=",["T_WHITESPACE"," ",648],["T_STRING","null",648],")",["T_WHITESPACE","\n    ",648],"{",["T_WHITESPACE","\n        ",649],["T_VARIABLE","$adapter",650],["T_WHITESPACE"," ",650],"=",["T_WHITESPACE"," ",650],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","_getWriteAdapter",650],"(",")",";",["T_WHITESPACE","\n\n        ",650],["T_COMMENT","\/\/ remove index by bundle products\n",652],["T_WHITESPACE","        ",653],["T_VARIABLE","$select",653],["T_WHITESPACE","  ",653],"=",["T_WHITESPACE"," ",653],["T_VARIABLE","$adapter",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","select",653],"(",")",["T_WHITESPACE","\n            ",653],["T_OBJECT_OPERATOR","->",654],["T_STRING","from",654],"(",["T_ARRAY","array",654],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",654],["T_WHITESPACE"," ",654],["T_DOUBLE_ARROW","=>",654],["T_WHITESPACE"," ",654],["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","_getGroupPriceIndexTable",654],"(",")",")",",",["T_WHITESPACE"," ",654],["T_STRING","null",654],")",["T_WHITESPACE","\n            ",654],["T_OBJECT_OPERATOR","->",655],["T_STRING","join",655],"(",["T_WHITESPACE","\n                ",655],["T_ARRAY","array",656],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",656],["T_WHITESPACE"," ",656],["T_DOUBLE_ARROW","=>",656],["T_WHITESPACE"," ",656],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getTable",656],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",656],")",")",",",["T_WHITESPACE","\n                ",656],["T_CONSTANT_ENCAPSED_STRING","'i.entity_id=e.entity_id'",657],",",["T_WHITESPACE","\n                ",657],["T_ARRAY","array",658],"(",")",["T_WHITESPACE","\n            ",658],")",["T_WHITESPACE","\n            ",659],["T_OBJECT_OPERATOR","->",660],["T_STRING","where",660],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",660],",",["T_WHITESPACE"," ",660],["T_VARIABLE","$this",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","getTypeId",660],"(",")",")",";",["T_WHITESPACE","\n        ",660],["T_VARIABLE","$query",661],["T_WHITESPACE","   ",661],"=",["T_WHITESPACE"," ",661],["T_VARIABLE","$select",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","deleteFromSelect",661],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",661],")",";",["T_WHITESPACE","\n        ",661],["T_VARIABLE","$adapter",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","query",662],"(",["T_VARIABLE","$query",662],")",";",["T_WHITESPACE","\n\n        ",662],["T_VARIABLE","$select",664],["T_WHITESPACE","  ",664],"=",["T_WHITESPACE"," ",664],["T_VARIABLE","$adapter",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","select",664],"(",")",["T_WHITESPACE","\n            ",664],["T_OBJECT_OPERATOR","->",665],["T_STRING","from",665],"(",["T_WHITESPACE","\n                ",665],["T_ARRAY","array",666],"(",["T_CONSTANT_ENCAPSED_STRING","'gp'",666],["T_WHITESPACE"," ",666],["T_DOUBLE_ARROW","=>",666],["T_WHITESPACE"," ",666],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getValueTable",666],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",666],",",["T_WHITESPACE"," ",666],["T_CONSTANT_ENCAPSED_STRING","'group_price'",666],")",")",",",["T_WHITESPACE","\n                ",666],["T_ARRAY","array",667],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",667],")",["T_WHITESPACE","\n            ",667],")",["T_WHITESPACE","\n            ",668],["T_OBJECT_OPERATOR","->",669],["T_STRING","join",669],"(",["T_WHITESPACE","\n                ",669],["T_ARRAY","array",670],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",670],["T_WHITESPACE"," ",670],["T_DOUBLE_ARROW","=>",670],["T_WHITESPACE"," ",670],["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getTable",670],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",670],")",")",",",["T_WHITESPACE","\n                ",670],["T_CONSTANT_ENCAPSED_STRING","'gp.entity_id=e.entity_id'",671],",",["T_WHITESPACE","\n                ",671],["T_ARRAY","array",672],"(",")",["T_WHITESPACE","\n            ",672],")",["T_WHITESPACE","\n            ",673],["T_OBJECT_OPERATOR","->",674],["T_STRING","join",674],"(",["T_WHITESPACE","\n                ",674],["T_ARRAY","array",675],"(",["T_CONSTANT_ENCAPSED_STRING","'cg'",675],["T_WHITESPACE"," ",675],["T_DOUBLE_ARROW","=>",675],["T_WHITESPACE"," ",675],["T_VARIABLE","$this",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getTable",675],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",675],")",")",",",["T_WHITESPACE","\n                ",675],["T_CONSTANT_ENCAPSED_STRING","'gp.all_groups = 1 OR (gp.all_groups = 0 AND gp.customer_group_id = cg.customer_group_id)'",676],",",["T_WHITESPACE","\n                ",676],["T_ARRAY","array",677],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",677],")",["T_WHITESPACE","\n            ",677],")",["T_WHITESPACE","\n            ",678],["T_OBJECT_OPERATOR","->",679],["T_STRING","join",679],"(",["T_WHITESPACE","\n                ",679],["T_ARRAY","array",680],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",680],["T_WHITESPACE"," ",680],["T_DOUBLE_ARROW","=>",680],["T_WHITESPACE"," ",680],["T_VARIABLE","$this",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","getTable",680],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",680],")",")",",",["T_WHITESPACE","\n                ",680],["T_CONSTANT_ENCAPSED_STRING","'gp.website_id = 0 OR gp.website_id = cw.website_id'",681],",",["T_WHITESPACE","\n                ",681],["T_ARRAY","array",682],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",682],")",["T_WHITESPACE","\n            ",682],")",["T_WHITESPACE","\n            ",683],["T_OBJECT_OPERATOR","->",684],["T_STRING","where",684],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",684],")",["T_WHITESPACE","\n            ",684],["T_OBJECT_OPERATOR","->",685],["T_STRING","where",685],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id=?'",685],",",["T_WHITESPACE"," ",685],["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","getTypeId",685],"(",")",")",["T_WHITESPACE","\n            ",685],["T_OBJECT_OPERATOR","->",686],["T_STRING","columns",686],"(",["T_NEW","new",686],["T_WHITESPACE"," ",686],["T_STRING","Zend_Db_Expr",686],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(gp.value)'",686],")",")",["T_WHITESPACE","\n            ",686],["T_OBJECT_OPERATOR","->",687],["T_STRING","group",687],"(",["T_ARRAY","array",687],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.entity_id'",687],",",["T_WHITESPACE"," ",687],["T_CONSTANT_ENCAPSED_STRING","'cg.customer_group_id'",687],",",["T_WHITESPACE"," ",687],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",687],")",")",";",["T_WHITESPACE","\n\n        ",687],["T_IF","if",689],["T_WHITESPACE"," ",689],"(","!",["T_EMPTY","empty",689],"(",["T_VARIABLE","$entityIds",689],")",")",["T_WHITESPACE"," ",689],"{",["T_WHITESPACE","\n            ",689],["T_VARIABLE","$select",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","where",690],"(",["T_CONSTANT_ENCAPSED_STRING","'gp.entity_id IN(?)'",690],",",["T_WHITESPACE"," ",690],["T_VARIABLE","$entityIds",690],")",";",["T_WHITESPACE","\n        ",690],"}",["T_WHITESPACE","\n\n        ",691],["T_VARIABLE","$query",693],["T_WHITESPACE","   ",693],"=",["T_WHITESPACE"," ",693],["T_VARIABLE","$select",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","insertFromSelect",693],"(",["T_VARIABLE","$this",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","_getGroupPriceIndexTable",693],"(",")",")",";",["T_WHITESPACE","\n        ",693],["T_VARIABLE","$adapter",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","query",694],"(",["T_VARIABLE","$query",694],")",";",["T_WHITESPACE","\n\n        ",694],["T_RETURN","return",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$this",696],";",["T_WHITESPACE","\n    ",696],"}",["T_WHITESPACE","\n",697],"}",["T_WHITESPACE","\n",698]]