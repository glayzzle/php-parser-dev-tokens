[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Bundle Stock Status Indexer Resource Model\n *\n * @category    Mage\n * @package     Mage_Bundle\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Bundle_Model_Resource_Indexer_Stock",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Reindex temporary (price result data) for defined product(s)\n     *\n     * @param int|array $entityIds\n     * @return Mage_Bundle_Model_Resource_Indexer_Stock\n     *\/",37],["T_WHITESPACE","\n    ",42],["T_PUBLIC","public",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","reindexEntity",43],"(",["T_VARIABLE","$entityIds",43],")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","_updateIndex",45],"(",["T_VARIABLE","$entityIds",45],")",";",["T_WHITESPACE","\n\n        ",45],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Retrieve table name for temporary bundle option stock index\n     *\n     * @return string\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","_getBundleOptionTable",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_RETURN","return",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getTable",57],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/stock_index'",57],")",";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Prepare stock status per Bundle options, website and stock\n     *\n     * @param int|array $entityIds\n     * @param bool $usePrimaryTable use primary or temporary index table\n     * @return Mage_Bundle_Model_Resource_Indexer_Stock\n     *\/",60],["T_WHITESPACE","\n    ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","_prepareBundleOptionStockData",67],"(",["T_VARIABLE","$entityIds",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","null",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$usePrimaryTable",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","false",67],")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_cleanBundleOptionStockData",69],"(",")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$idxTable",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$usePrimaryTable",70],["T_WHITESPACE"," ",70],"?",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getMainTable",70],"(",")",["T_WHITESPACE"," ",70],":",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getIdxTable",70],"(",")",";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$adapter",71],["T_WHITESPACE","  ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_getWriteAdapter",71],"(",")",";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$select",72],["T_WHITESPACE","   ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$adapter",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","select",72],"(",")",["T_WHITESPACE","\n            ",72],["T_OBJECT_OPERATOR","->",73],["T_STRING","from",73],"(",["T_ARRAY","array",73],"(",["T_CONSTANT_ENCAPSED_STRING","'bo'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getTable",73],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/option'",73],")",")",",",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id'",73],")",")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_addWebsiteJoinToSelect",74],"(",["T_VARIABLE","$select",74],",",["T_WHITESPACE"," ",74],["T_STRING","false",74],")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$status",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_NEW","new",75],["T_WHITESPACE"," ",75],["T_STRING","Zend_Db_Expr",75],"(",["T_CONSTANT_ENCAPSED_STRING","'MAX('",75],["T_WHITESPACE"," ",75],".",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$adapter",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getCheckSql",76],"(",["T_CONSTANT_ENCAPSED_STRING","'e.required_options = 0'",76],",",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'i.stock_status'",76],",",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'0'",76],")",["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","')'",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$select",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","columns",77],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",77],",",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'cw'",77],")",["T_WHITESPACE","\n            ",77],["T_OBJECT_OPERATOR","->",78],["T_STRING","join",78],"(",["T_WHITESPACE","\n                ",78],["T_ARRAY","array",79],"(",["T_CONSTANT_ENCAPSED_STRING","'cis'",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getTable",79],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",79],")",")",",",["T_WHITESPACE","\n                ",79],["T_CONSTANT_ENCAPSED_STRING","''",80],",",["T_WHITESPACE","\n                ",80],["T_ARRAY","array",81],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_id'",81],")",["T_WHITESPACE","\n            ",81],")",["T_WHITESPACE","\n            ",82],["T_OBJECT_OPERATOR","->",83],["T_STRING","joinLeft",83],"(",["T_WHITESPACE","\n                ",83],["T_ARRAY","array",84],"(",["T_CONSTANT_ENCAPSED_STRING","'bs'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getTable",84],"(",["T_CONSTANT_ENCAPSED_STRING","'bundle\/selection'",84],")",")",",",["T_WHITESPACE","\n                ",84],["T_CONSTANT_ENCAPSED_STRING","'bs.option_id = bo.option_id'",85],",",["T_WHITESPACE","\n                ",85],["T_ARRAY","array",86],"(",")",["T_WHITESPACE","\n            ",86],")",["T_WHITESPACE","\n            ",87],["T_OBJECT_OPERATOR","->",88],["T_STRING","joinLeft",88],"(",["T_WHITESPACE","\n                ",88],["T_ARRAY","array",89],"(",["T_CONSTANT_ENCAPSED_STRING","'i'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$idxTable",89],")",",",["T_WHITESPACE","\n                ",89],["T_CONSTANT_ENCAPSED_STRING","'i.product_id = bs.product_id AND i.website_id = cw.website_id AND i.stock_id = cis.stock_id'",90],",",["T_WHITESPACE","\n                ",90],["T_ARRAY","array",91],"(",")",["T_WHITESPACE","\n            ",91],")",["T_WHITESPACE","\n            ",92],["T_OBJECT_OPERATOR","->",93],["T_STRING","joinLeft",93],"(",["T_WHITESPACE","\n                ",93],["T_ARRAY","array",94],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getTable",94],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",94],")",")",",",["T_WHITESPACE","\n                ",94],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id = bs.product_id'",95],",",["T_WHITESPACE","\n                ",95],["T_ARRAY","array",96],"(",")",["T_WHITESPACE","\n            ",96],")",["T_WHITESPACE","\n            ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","where",98],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",98],")",["T_WHITESPACE","\n            ",98],["T_OBJECT_OPERATOR","->",99],["T_STRING","group",99],"(",["T_ARRAY","array",99],"(",["T_CONSTANT_ENCAPSED_STRING","'bo.parent_id'",99],",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",99],",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'cis.stock_id'",99],",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'bo.option_id'",99],")",")",["T_WHITESPACE","\n            ",99],["T_OBJECT_OPERATOR","->",100],["T_STRING","columns",100],"(",["T_ARRAY","array",100],"(",["T_WHITESPACE","\n                ",100],["T_CONSTANT_ENCAPSED_STRING","'option_id'",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'bo.option_id'",101],",",["T_WHITESPACE","\n                ",101],["T_CONSTANT_ENCAPSED_STRING","'status'",102],["T_WHITESPACE","    ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$status",102],["T_WHITESPACE","\n            ",102],")",")",";",["T_WHITESPACE","\n\n        ",103],["T_IF","if",105],["T_WHITESPACE"," ",105],"(","!",["T_STRING","is_null",105],"(",["T_VARIABLE","$entityIds",105],")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$select",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","where",106],"(",["T_CONSTANT_ENCAPSED_STRING","'bo.parent_id IN(?)'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$entityIds",106],")",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n\n        ",107],["T_COMMENT","\/\/ clone select for bundle product without required bundle options\n",109],["T_WHITESPACE","        ",110],["T_VARIABLE","$selectNonRequired",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_CLONE","clone",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$select",110],";",["T_WHITESPACE","\n\n        ",110],["T_VARIABLE","$select",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","where",112],"(",["T_CONSTANT_ENCAPSED_STRING","'bo.required = ?'",112],",",["T_WHITESPACE"," ",112],["T_LNUMBER","1",112],")",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$selectNonRequired",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","where",113],"(",["T_CONSTANT_ENCAPSED_STRING","'bo.required = ?'",113],",",["T_WHITESPACE"," ",113],["T_LNUMBER","0",113],")",["T_WHITESPACE","\n            ",113],["T_OBJECT_OPERATOR","->",114],["T_STRING","having",114],"(",["T_VARIABLE","$status",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","' = 1'",114],")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$query",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$select",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","insertFromSelect",115],"(",["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_getBundleOptionTable",115],"(",")",")",";",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$adapter",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","query",116],"(",["T_VARIABLE","$query",116],")",";",["T_WHITESPACE","\n\n        ",116],["T_VARIABLE","$query",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$selectNonRequired",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","insertFromSelect",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_getBundleOptionTable",118],"(",")",")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$adapter",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","query",119],"(",["T_VARIABLE","$query",119],")",";",["T_WHITESPACE","\n\n        ",119],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Get the select object for get stock status by product ids\n     *\n     * @param int|array $entityIds\n     * @param bool $usePrimaryTable use primary or temporary index table\n     * @return Varien_Db_Select\n     *\/",124],["T_WHITESPACE","\n    ",130],["T_PROTECTED","protected",131],["T_WHITESPACE"," ",131],["T_FUNCTION","function",131],["T_WHITESPACE"," ",131],["T_STRING","_getStockStatusSelect",131],"(",["T_VARIABLE","$entityIds",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","null",131],",",["T_WHITESPACE"," ",131],["T_VARIABLE","$usePrimaryTable",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","false",131],")",["T_WHITESPACE","\n    ",131],"{",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_prepareBundleOptionStockData",133],"(",["T_VARIABLE","$entityIds",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$usePrimaryTable",133],")",";",["T_WHITESPACE","\n\n        ",133],["T_VARIABLE","$adapter",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_getWriteAdapter",135],"(",")",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$select",136],["T_WHITESPACE","  ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$adapter",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","select",136],"(",")",["T_WHITESPACE","\n            ",136],["T_OBJECT_OPERATOR","->",137],["T_STRING","from",137],"(",["T_ARRAY","array",137],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",137],["T_WHITESPACE"," ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getTable",137],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",137],")",")",",",["T_WHITESPACE"," ",137],["T_ARRAY","array",137],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",137],")",")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_addWebsiteJoinToSelect",138],"(",["T_VARIABLE","$select",138],",",["T_WHITESPACE"," ",138],["T_STRING","true",138],")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_addProductWebsiteJoinToSelect",139],"(",["T_VARIABLE","$select",139],",",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",139],",",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$select",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","columns",140],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",140],")",["T_WHITESPACE","\n            ",140],["T_OBJECT_OPERATOR","->",141],["T_STRING","join",141],"(",["T_WHITESPACE","\n                ",141],["T_ARRAY","array",142],"(",["T_CONSTANT_ENCAPSED_STRING","'cis'",142],["T_WHITESPACE"," ",142],["T_DOUBLE_ARROW","=>",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getTable",142],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",142],")",")",",",["T_WHITESPACE","\n                ",142],["T_CONSTANT_ENCAPSED_STRING","''",143],",",["T_WHITESPACE","\n                ",143],["T_ARRAY","array",144],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_id'",144],")",["T_WHITESPACE","\n            ",144],")",["T_WHITESPACE","\n            ",145],["T_OBJECT_OPERATOR","->",146],["T_STRING","joinLeft",146],"(",["T_WHITESPACE","\n                ",146],["T_ARRAY","array",147],"(",["T_CONSTANT_ENCAPSED_STRING","'cisi'",147],["T_WHITESPACE"," ",147],["T_DOUBLE_ARROW","=>",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getTable",147],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",147],")",")",",",["T_WHITESPACE","\n                ",147],["T_CONSTANT_ENCAPSED_STRING","'cisi.stock_id = cis.stock_id AND cisi.product_id = e.entity_id'",148],",",["T_WHITESPACE","\n                ",148],["T_ARRAY","array",149],"(",")",["T_WHITESPACE","\n            ",149],")",["T_WHITESPACE","\n            ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","joinLeft",151],"(",["T_WHITESPACE","\n                ",151],["T_ARRAY","array",152],"(",["T_CONSTANT_ENCAPSED_STRING","'o'",152],["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_getBundleOptionTable",152],"(",")",")",",",["T_WHITESPACE","\n                ",152],["T_CONSTANT_ENCAPSED_STRING","'o.entity_id = e.entity_id AND o.website_id = cw.website_id AND o.stock_id = cis.stock_id'",153],",",["T_WHITESPACE","\n                ",153],["T_ARRAY","array",154],"(",")",["T_WHITESPACE","\n            ",154],")",["T_WHITESPACE","\n            ",155],["T_OBJECT_OPERATOR","->",156],["T_STRING","columns",156],"(",["T_ARRAY","array",156],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",156],["T_WHITESPACE"," ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_NEW","new",156],["T_WHITESPACE"," ",156],["T_STRING","Zend_Db_Expr",156],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",156],")",")",")",["T_WHITESPACE","\n            ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","where",157],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",157],")",["T_WHITESPACE","\n            ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","where",158],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id = ?'",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getTypeId",158],"(",")",")",["T_WHITESPACE","\n            ",158],["T_OBJECT_OPERATOR","->",159],["T_STRING","group",159],"(",["T_ARRAY","array",159],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",159],",",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",159],",",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'cis.stock_id'",159],")",")",";",["T_WHITESPACE","\n\n        ",159],["T_COMMENT","\/\/ add limitation of status\n",161],["T_WHITESPACE","        ",162],["T_VARIABLE","$condition",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$adapter",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","quoteInto",162],"(",["T_CONSTANT_ENCAPSED_STRING","'=?'",162],",",["T_WHITESPACE"," ",162],["T_STRING","Mage_Catalog_Model_Product_Status",162],["T_DOUBLE_COLON","::",162],["T_STRING","STATUS_ENABLED",162],")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_addAttributeToSelect",163],"(",["T_VARIABLE","$select",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'status'",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",163],",",["T_WHITESPACE"," ",163],["T_VARIABLE","$condition",163],")",";",["T_WHITESPACE","\n\n        ",163],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_isManageStock",165],"(",")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$statusExpr",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$adapter",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getCheckSql",166],"(",["T_WHITESPACE","\n                ",166],["T_CONSTANT_ENCAPSED_STRING","'cisi.use_config_manage_stock = 0 AND cisi.manage_stock = 0'",167],",",["T_WHITESPACE","\n                ",167],["T_CONSTANT_ENCAPSED_STRING","'1'",168],",",["T_WHITESPACE","\n                ",168],["T_CONSTANT_ENCAPSED_STRING","'cisi.is_in_stock'",169],["T_WHITESPACE","\n            ",169],")",";",["T_WHITESPACE","\n        ",170],"}",["T_WHITESPACE"," ",171],["T_ELSE","else",171],["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$statusExpr",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$adapter",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getCheckSql",172],"(",["T_WHITESPACE","\n                ",172],["T_CONSTANT_ENCAPSED_STRING","'cisi.use_config_manage_stock = 0 AND cisi.manage_stock = 1'",173],",",["T_WHITESPACE","\n                ",173],["T_CONSTANT_ENCAPSED_STRING","'cisi.is_in_stock'",174],",",["T_WHITESPACE","\n                ",174],["T_CONSTANT_ENCAPSED_STRING","'1'",175],["T_WHITESPACE","\n            ",175],")",";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n\n        ",177],["T_VARIABLE","$select",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","columns",179],"(",["T_ARRAY","array",179],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",179],["T_WHITESPACE"," ",179],["T_DOUBLE_ARROW","=>",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$adapter",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getLeastSql",179],"(",["T_ARRAY","array",179],"(",["T_WHITESPACE","\n            ",179],["T_NEW","new",180],["T_WHITESPACE"," ",180],["T_STRING","Zend_Db_Expr",180],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN('",180],["T_WHITESPACE"," ",180],".",["T_WHITESPACE"," ",180],["T_VARIABLE","$adapter",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getCheckSql",180],"(",["T_CONSTANT_ENCAPSED_STRING","'o.stock_status IS NOT NULL'",180],",",["T_CONSTANT_ENCAPSED_STRING","'o.stock_status'",180],",",["T_WHITESPACE"," ",180],["T_CONSTANT_ENCAPSED_STRING","'0'",180],")",["T_WHITESPACE"," ",180],".",["T_CONSTANT_ENCAPSED_STRING","')'",180],")",",",["T_WHITESPACE","\n            ",180],["T_NEW","new",181],["T_WHITESPACE"," ",181],["T_STRING","Zend_Db_Expr",181],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN('",181],["T_WHITESPACE"," ",181],".",["T_WHITESPACE"," ",181],["T_VARIABLE","$statusExpr",181],["T_WHITESPACE"," ",181],".",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","')'",181],")",",",["T_WHITESPACE","\n        ",181],")",")",")",")",";",["T_WHITESPACE","\n\n        ",182],["T_IF","if",184],["T_WHITESPACE"," ",184],"(","!",["T_STRING","is_null",184],"(",["T_VARIABLE","$entityIds",184],")",")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$select",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","where",185],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$entityIds",185],")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n\n        ",186],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$select",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Prepare stock status data in temporary index table\n     *\n     * @param int|array $entityIds  the product limitation\n     * @return Mage_Bundle_Model_Resource_Indexer_Stock\n     *\/",191],["T_WHITESPACE","\n    ",196],["T_PROTECTED","protected",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","_prepareIndexTable",197],"(",["T_VARIABLE","$entityIds",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","null",197],")",["T_WHITESPACE","\n    ",197],"{",["T_WHITESPACE","\n        ",198],["T_STRING","parent",199],["T_DOUBLE_COLON","::",199],["T_STRING","_prepareIndexTable",199],"(",["T_VARIABLE","$entityIds",199],")",";",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_cleanBundleOptionStockData",200],"(",")",";",["T_WHITESPACE","\n\n        ",200],["T_RETURN","return",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],";",["T_WHITESPACE","\n    ",202],"}",["T_WHITESPACE","\n\n    ",203],["T_DOC_COMMENT","\/**\n     * Update Stock status index by product ids\n     *\n     * @param array|int $entityIds\n     * @return Mage_Bundle_Model_Resource_Indexer_Stock\n     *\/",205],["T_WHITESPACE","\n    ",210],["T_PROTECTED","protected",211],["T_WHITESPACE"," ",211],["T_FUNCTION","function",211],["T_WHITESPACE"," ",211],["T_STRING","_updateIndex",211],"(",["T_VARIABLE","$entityIds",211],")",["T_WHITESPACE","\n    ",211],"{",["T_WHITESPACE","\n        ",212],["T_STRING","parent",213],["T_DOUBLE_COLON","::",213],["T_STRING","_updateIndex",213],"(",["T_VARIABLE","$entityIds",213],")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_cleanBundleOptionStockData",214],"(",")",";",["T_WHITESPACE","\n\n        ",214],["T_RETURN","return",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n\n    ",217],["T_DOC_COMMENT","\/**\n     * Clean temporary bundle options stock data\n     *\n     * @return Mage_Bundle_Model_Resource_Indexer_Stock\n     *\/",219],["T_WHITESPACE","\n    ",223],["T_PROTECTED","protected",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","_cleanBundleOptionStockData",224],"(",")",["T_WHITESPACE","\n    ",224],"{",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_getWriteAdapter",226],"(",")",["T_OBJECT_OPERATOR","->",226],["T_STRING","delete",226],"(",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_getBundleOptionTable",226],"(",")",")",";",["T_WHITESPACE","\n        ",226],["T_RETURN","return",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$this",227],";",["T_WHITESPACE","\n    ",227],"}",["T_WHITESPACE","\n",228],"}",["T_WHITESPACE","\n",229]]