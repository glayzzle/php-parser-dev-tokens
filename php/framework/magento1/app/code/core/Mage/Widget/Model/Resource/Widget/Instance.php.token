[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Widget\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Widget Instance Resource Model\n *\n * @category    Mage\n * @package     Mage_Widget\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Widget_Model_Resource_Widget_Instance",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Define main table\n     *\n     *\/",37],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_init",43],"(",["T_CONSTANT_ENCAPSED_STRING","'widget\/widget_instance'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'instance_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Perform actions after object load\n     *\n     * @param Mage_Widget_Model_Widget_Instance $object\n     * @return Mage_Widget_Model_Resource_Widget_Instance\n     *\/",46],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","_afterLoad",52],"(",["T_STRING","Mage_Core_Model_Abstract",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$object",52],")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$adapter",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_getReadAdapter",54],"(",")",";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$select",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$adapter",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","select",55],"(",")",["T_WHITESPACE","\n            ",55],["T_OBJECT_OPERATOR","->",56],["T_STRING","from",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getTable",56],"(",["T_CONSTANT_ENCAPSED_STRING","'widget\/widget_instance_page'",56],")",")",["T_WHITESPACE","\n            ",56],["T_OBJECT_OPERATOR","->",57],["T_STRING","where",57],"(",["T_CONSTANT_ENCAPSED_STRING","'instance_id = ?'",57],",",["T_WHITESPACE"," ",57],["T_INT_CAST","(int)",57],["T_VARIABLE","$object",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getId",57],"(",")",")",";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$result",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$adapter",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","fetchAll",58],"(",["T_VARIABLE","$select",58],")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$object",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","setData",59],"(",["T_CONSTANT_ENCAPSED_STRING","'page_groups'",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$result",59],")",";",["T_WHITESPACE","\n        ",59],["T_RETURN","return",60],["T_WHITESPACE"," ",60],["T_STRING","parent",60],["T_DOUBLE_COLON","::",60],["T_STRING","_afterLoad",60],"(",["T_VARIABLE","$object",60],")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Perform actions after object save\n     *\n     * @param Mage_Widget_Model_Widget_Instance $object\n     * @return Mage_Widget_Model_Resource_Widget_Instance\n     *\/",63],["T_WHITESPACE","\n    ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","_afterSave",69],"(",["T_STRING","Mage_Core_Model_Abstract",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$object",69],")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$pageTable",71],["T_WHITESPACE","         ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getTable",71],"(",["T_CONSTANT_ENCAPSED_STRING","'widget\/widget_instance_page'",71],")",";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$pageLayoutTable",72],["T_WHITESPACE","   ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getTable",72],"(",["T_CONSTANT_ENCAPSED_STRING","'widget\/widget_instance_page_layout'",72],")",";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$readAdapter",73],["T_WHITESPACE","       ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_getReadAdapter",73],"(",")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$writeAdapter",74],["T_WHITESPACE","      ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_getWriteAdapter",74],"(",")",";",["T_WHITESPACE","\n\n        ",74],["T_VARIABLE","$select",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$readAdapter",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","select",76],"(",")",["T_WHITESPACE","\n            ",76],["T_OBJECT_OPERATOR","->",77],["T_STRING","from",77],"(",["T_VARIABLE","$pageTable",77],",",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'page_id'",77],")",["T_WHITESPACE","\n            ",77],["T_OBJECT_OPERATOR","->",78],["T_STRING","where",78],"(",["T_CONSTANT_ENCAPSED_STRING","'instance_id = ?'",78],",",["T_WHITESPACE"," ",78],["T_INT_CAST","(int)",78],["T_VARIABLE","$object",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getId",78],"(",")",")",";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$pageIds",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$readAdapter",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","fetchCol",79],"(",["T_VARIABLE","$select",79],")",";",["T_WHITESPACE","\n\n        ",79],["T_VARIABLE","$removePageIds",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","array_diff",81],"(",["T_VARIABLE","$pageIds",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$object",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getData",81],"(",["T_CONSTANT_ENCAPSED_STRING","'page_group_ids'",81],")",")",";",["T_WHITESPACE","\n\n        ",81],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_STRING","is_array",83],"(",["T_VARIABLE","$pageIds",83],")",["T_WHITESPACE"," ",83],["T_BOOLEAN_AND","&&",83],["T_WHITESPACE"," ",83],["T_STRING","count",83],"(",["T_VARIABLE","$pageIds",83],")",["T_WHITESPACE"," ",83],">",["T_WHITESPACE"," ",83],["T_LNUMBER","0",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$inCond",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$readAdapter",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","prepareSqlCondition",84],"(",["T_CONSTANT_ENCAPSED_STRING","'page_id'",84],",",["T_WHITESPACE"," ",84],["T_ARRAY","array",84],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$pageIds",84],")",")",";",["T_WHITESPACE","\n\n            ",84],["T_VARIABLE","$select",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$readAdapter",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","select",86],"(",")",["T_WHITESPACE","\n                ",86],["T_OBJECT_OPERATOR","->",87],["T_STRING","from",87],"(",["T_VARIABLE","$pageLayoutTable",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",87],")",["T_WHITESPACE","\n                ",87],["T_OBJECT_OPERATOR","->",88],["T_STRING","where",88],"(",["T_VARIABLE","$inCond",88],")",";",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$removeLayoutUpdateIds",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$readAdapter",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","fetchCol",89],"(",["T_VARIABLE","$select",89],")",";",["T_WHITESPACE","\n\n            ",89],["T_VARIABLE","$writeAdapter",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","delete",91],"(",["T_VARIABLE","$pageLayoutTable",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$inCond",91],")",";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_deleteLayoutUpdates",92],"(",["T_VARIABLE","$removeLayoutUpdateIds",92],")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n\n        ",93],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_deleteWidgetInstancePages",95],"(",["T_VARIABLE","$removePageIds",95],")",";",["T_WHITESPACE","\n\n        ",95],["T_FOREACH","foreach",97],["T_WHITESPACE"," ",97],"(",["T_VARIABLE","$object",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getData",97],"(",["T_CONSTANT_ENCAPSED_STRING","'page_groups'",97],")",["T_WHITESPACE"," ",97],["T_AS","as",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$pageGroup",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$pageLayoutUpdateIds",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_saveLayoutUpdates",98],"(",["T_VARIABLE","$object",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$pageGroup",98],")",";",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$data",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",["T_WHITESPACE","\n                ",99],["T_CONSTANT_ENCAPSED_STRING","'page_group'",100],["T_WHITESPACE","      ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$pageGroup",100],"[",["T_CONSTANT_ENCAPSED_STRING","'group'",100],"]",",",["T_WHITESPACE","\n                ",100],["T_CONSTANT_ENCAPSED_STRING","'layout_handle'",101],["T_WHITESPACE","   ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$pageGroup",101],"[",["T_CONSTANT_ENCAPSED_STRING","'layout_handle'",101],"]",",",["T_WHITESPACE","\n                ",101],["T_CONSTANT_ENCAPSED_STRING","'block_reference'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$pageGroup",102],"[",["T_CONSTANT_ENCAPSED_STRING","'block_reference'",102],"]",",",["T_WHITESPACE","\n                ",102],["T_CONSTANT_ENCAPSED_STRING","'page_for'",103],["T_WHITESPACE","        ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$pageGroup",103],"[",["T_CONSTANT_ENCAPSED_STRING","'for'",103],"]",",",["T_WHITESPACE","\n                ",103],["T_CONSTANT_ENCAPSED_STRING","'entities'",104],["T_WHITESPACE","        ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$pageGroup",104],"[",["T_CONSTANT_ENCAPSED_STRING","'entities'",104],"]",",",["T_WHITESPACE","\n                ",104],["T_CONSTANT_ENCAPSED_STRING","'page_template'",105],["T_WHITESPACE","   ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$pageGroup",105],"[",["T_CONSTANT_ENCAPSED_STRING","'template'",105],"]",",",["T_WHITESPACE","\n            ",105],")",";",["T_WHITESPACE","\n            ",106],["T_VARIABLE","$pageId",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$pageGroup",107],"[",["T_CONSTANT_ENCAPSED_STRING","'page_id'",107],"]",";",["T_WHITESPACE","\n            ",107],["T_IF","if",108],["T_WHITESPACE"," ",108],"(",["T_STRING","in_array",108],"(",["T_VARIABLE","$pageGroup",108],"[",["T_CONSTANT_ENCAPSED_STRING","'page_id'",108],"]",",",["T_WHITESPACE"," ",108],["T_VARIABLE","$pageIds",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n                ",108],["T_VARIABLE","$writeAdapter",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","update",109],"(",["T_VARIABLE","$pageTable",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$data",109],",",["T_WHITESPACE"," ",109],["T_ARRAY","array",109],"(",["T_CONSTANT_ENCAPSED_STRING","'page_id = ?'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_INT_CAST","(int)",109],["T_VARIABLE","$pageId",109],")",")",";",["T_WHITESPACE","\n            ",109],"}",["T_WHITESPACE"," ",110],["T_ELSE","else",110],["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                ",110],["T_VARIABLE","$writeAdapter",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","insert",111],"(",["T_VARIABLE","$pageTable",111],",",["T_WHITESPACE","\n                    ",111],["T_STRING","array_merge",112],"(",["T_ARRAY","array",112],"(",["T_CONSTANT_ENCAPSED_STRING","'instance_id'",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$object",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getId",112],"(",")",")",",",["T_WHITESPACE","\n                    ",112],["T_VARIABLE","$data",113],")",")",";",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$pageId",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$writeAdapter",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","lastInsertId",114],"(",["T_VARIABLE","$pageTable",114],")",";",["T_WHITESPACE","\n            ",114],"}",["T_WHITESPACE","\n            ",115],["T_FOREACH","foreach",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$pageLayoutUpdateIds",116],["T_WHITESPACE"," ",116],["T_AS","as",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$layoutUpdateId",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n                ",116],["T_VARIABLE","$writeAdapter",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","insert",117],"(",["T_VARIABLE","$pageLayoutTable",117],",",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",["T_WHITESPACE","\n                    ",117],["T_CONSTANT_ENCAPSED_STRING","'page_id'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$pageId",118],",",["T_WHITESPACE","\n                    ",118],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$layoutUpdateId",119],["T_WHITESPACE","\n                ",119],")",")",";",["T_WHITESPACE","\n            ",120],"}",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n\n        ",122],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_STRING","parent",124],["T_DOUBLE_COLON","::",124],["T_STRING","_afterSave",124],"(",["T_VARIABLE","$object",124],")",";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * Prepare and save layout updates data\n     *\n     * @param Mage_Widget_Model_Widget_Instance $widgetInstance\n     * @param array $pageGroupData\n     * @return array of inserted layout updates ids\n     *\/",127],["T_WHITESPACE","\n    ",133],["T_PROTECTED","protected",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","_saveLayoutUpdates",134],"(",["T_VARIABLE","$widgetInstance",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$pageGroupData",134],")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$writeAdapter",136],["T_WHITESPACE","          ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_getWriteAdapter",136],"(",")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$pageLayoutUpdateIds",137],["T_WHITESPACE","   ",137],"=",["T_WHITESPACE"," ",137],["T_ARRAY","array",137],"(",")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$storeIds",138],["T_WHITESPACE","              ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_prepareStoreIds",138],"(",["T_VARIABLE","$widgetInstance",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getStoreIds",138],"(",")",")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$layoutUpdateTable",139],["T_WHITESPACE","     ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getTable",139],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/layout_update'",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$layoutUpdateLinkTable",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getTable",140],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/layout_link'",140],")",";",["T_WHITESPACE","\n\n        ",140],["T_FOREACH","foreach",142],["T_WHITESPACE"," ",142],"(",["T_VARIABLE","$pageGroupData",142],"[",["T_CONSTANT_ENCAPSED_STRING","'layout_handle_updates'",142],"]",["T_WHITESPACE"," ",142],["T_AS","as",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$handle",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$xml",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$widgetInstance",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","generateLayoutUpdateXml",143],"(",["T_WHITESPACE","\n                ",143],["T_VARIABLE","$pageGroupData",144],"[",["T_CONSTANT_ENCAPSED_STRING","'block_reference'",144],"]",",",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$pageGroupData",145],"[",["T_CONSTANT_ENCAPSED_STRING","'template'",145],"]",["T_WHITESPACE","\n            ",145],")",";",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$insert",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_ARRAY","array",147],"(",["T_WHITESPACE","\n                    ",147],["T_CONSTANT_ENCAPSED_STRING","'handle'",148],["T_WHITESPACE","     ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$handle",148],",",["T_WHITESPACE","\n                    ",148],["T_CONSTANT_ENCAPSED_STRING","'xml'",149],["T_WHITESPACE","        ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$xml",149],["T_WHITESPACE","\n            ",149],")",";",["T_WHITESPACE","\n            ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(",["T_STRING","strlen",151],"(",["T_VARIABLE","$widgetInstance",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getSortOrder",151],"(",")",")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                ",151],["T_VARIABLE","$insert",152],"[",["T_CONSTANT_ENCAPSED_STRING","'sort_order'",152],"]",["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$widgetInstance",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getSortOrder",152],"(",")",";",["T_WHITESPACE","\n            ",152],"}",";",["T_WHITESPACE","\n\n            ",153],["T_VARIABLE","$writeAdapter",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","insert",155],"(",["T_VARIABLE","$layoutUpdateTable",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$insert",155],")",";",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$layoutUpdateId",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$writeAdapter",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","lastInsertId",156],"(",["T_VARIABLE","$layoutUpdateTable",156],")",";",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$pageLayoutUpdateIds",157],"[","]",["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$layoutUpdateId",157],";",["T_WHITESPACE","\n\n            ",157],["T_VARIABLE","$data",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_ARRAY","array",159],"(",")",";",["T_WHITESPACE","\n            ",159],["T_FOREACH","foreach",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$storeIds",160],["T_WHITESPACE"," ",160],["T_AS","as",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$storeId",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$data",161],"[","]",["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_ARRAY","array",161],"(",["T_WHITESPACE","\n                    ",161],["T_CONSTANT_ENCAPSED_STRING","'store_id'",162],["T_WHITESPACE","         ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$storeId",162],",",["T_WHITESPACE","\n                    ",162],["T_CONSTANT_ENCAPSED_STRING","'area'",163],["T_WHITESPACE","             ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$widgetInstance",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getArea",163],"(",")",",",["T_WHITESPACE","\n                    ",163],["T_CONSTANT_ENCAPSED_STRING","'package'",164],["T_WHITESPACE","          ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$widgetInstance",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getPackage",164],"(",")",",",["T_WHITESPACE","\n                    ",164],["T_CONSTANT_ENCAPSED_STRING","'theme'",165],["T_WHITESPACE","            ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$widgetInstance",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getTheme",165],"(",")",",",["T_WHITESPACE","\n                    ",165],["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",166],["T_WHITESPACE"," ",166],["T_DOUBLE_ARROW","=>",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$layoutUpdateId",166],")",";",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$writeAdapter",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","insertMultiple",168],"(",["T_VARIABLE","$layoutUpdateLinkTable",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$data",168],")",";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n        ",169],["T_RETURN","return",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$pageLayoutUpdateIds",170],";",["T_WHITESPACE","\n    ",170],"}",["T_WHITESPACE","\n\n    ",171],["T_DOC_COMMENT","\/**\n     * Prepare store ids.\n     * If one of store id is default (0) return all store ids\n     *\n     * @param array $storeIds\n     * @return array\n     *\/",173],["T_WHITESPACE","\n    ",179],["T_PROTECTED","protected",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","_prepareStoreIds",180],"(",["T_VARIABLE","$storeIds",180],")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(",["T_STRING","in_array",182],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$storeIds",182],")",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$storeIds",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_ARRAY","array",183],"(",["T_LNUMBER","0",183],")",";",["T_WHITESPACE","\n        ",183],"}",["T_WHITESPACE","\n        ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$storeIds",185],";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Perform actions before object delete.\n     * Collect page ids and layout update ids and set to object for further delete\n     *\n     * @param Varien_Object $object\n     * @return Mage_Widget_Model_Resource_Widget_Instance\n     *\/",188],["T_WHITESPACE","\n    ",194],["T_PROTECTED","protected",195],["T_WHITESPACE"," ",195],["T_FUNCTION","function",195],["T_WHITESPACE"," ",195],["T_STRING","_beforeDelete",195],"(",["T_STRING","Mage_Core_Model_Abstract",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$object",195],")",["T_WHITESPACE","\n    ",195],"{",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$writeAdapter",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_getWriteAdapter",197],"(",")",";",["T_WHITESPACE","\n        ",197],["T_VARIABLE","$select",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_VARIABLE","$writeAdapter",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","select",198],"(",")",["T_WHITESPACE","\n            ",198],["T_OBJECT_OPERATOR","->",199],["T_STRING","from",199],"(",["T_ARRAY","array",199],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table'",199],["T_WHITESPACE"," ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getTable",199],"(",["T_CONSTANT_ENCAPSED_STRING","'widget\/widget_instance_page'",199],")",")",",",["T_WHITESPACE"," ",199],["T_ARRAY","array",199],"(",")",")",["T_WHITESPACE","\n            ",199],["T_OBJECT_OPERATOR","->",200],["T_STRING","joinInner",200],"(",["T_WHITESPACE","\n                ",200],["T_ARRAY","array",201],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_page_table'",201],["T_WHITESPACE"," ",201],["T_DOUBLE_ARROW","=>",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getTable",201],"(",["T_CONSTANT_ENCAPSED_STRING","'widget\/widget_instance_page_layout'",201],")",")",",",["T_WHITESPACE","\n                ",201],["T_CONSTANT_ENCAPSED_STRING","'layout_page_table.page_id = main_table.page_id'",202],",",["T_WHITESPACE","\n                ",202],["T_ARRAY","array",203],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",203],")",["T_WHITESPACE","\n            ",203],")",["T_WHITESPACE","\n            ",204],["T_OBJECT_OPERATOR","->",205],["T_STRING","where",205],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.instance_id=?'",205],",",["T_WHITESPACE"," ",205],["T_VARIABLE","$object",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getId",205],"(",")",")",";",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$result",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$writeAdapter",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","fetchCol",206],"(",["T_VARIABLE","$select",206],")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$object",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","setLayoutUpdateIdsToDelete",207],"(",["T_VARIABLE","$result",207],")",";",["T_WHITESPACE","\n        ",207],["T_RETURN","return",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],";",["T_WHITESPACE","\n    ",208],"}",["T_WHITESPACE","\n\n    ",209],["T_DOC_COMMENT","\/**\n     * Perform actions after object delete.\n     * Delete layout updates by layout update ids collected in _beforeSave\n     *\n     * @param Mage_Widget_Model_Widget_Instance $object\n     * @return Mage_Widget_Model_Resource_Widget_Instance\n     *\/",211],["T_WHITESPACE","\n    ",217],["T_PROTECTED","protected",218],["T_WHITESPACE"," ",218],["T_FUNCTION","function",218],["T_WHITESPACE"," ",218],["T_STRING","_afterDelete",218],"(",["T_STRING","Mage_Core_Model_Abstract",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$object",218],")",["T_WHITESPACE","\n    ",218],"{",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_deleteLayoutUpdates",220],"(",["T_VARIABLE","$object",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getLayoutUpdateIdsToDelete",220],"(",")",")",";",["T_WHITESPACE","\n        ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_STRING","parent",221],["T_DOUBLE_COLON","::",221],["T_STRING","_afterDelete",221],"(",["T_VARIABLE","$object",221],")",";",["T_WHITESPACE","\n    ",221],"}",["T_WHITESPACE","\n\n    ",222],["T_DOC_COMMENT","\/**\n     * Delete widget instance pages by given ids\n     *\n     * @param array $pageIds\n     * @return Mage_Widget_Model_Resource_Widget_Instance\n     *\/",224],["T_WHITESPACE","\n    ",229],["T_PROTECTED","protected",230],["T_WHITESPACE"," ",230],["T_FUNCTION","function",230],["T_WHITESPACE"," ",230],["T_STRING","_deleteWidgetInstancePages",230],"(",["T_VARIABLE","$pageIds",230],")",["T_WHITESPACE","\n    ",230],"{",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$writeAdapter",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","_getWriteAdapter",232],"(",")",";",["T_WHITESPACE","\n        ",232],["T_IF","if",233],["T_WHITESPACE"," ",233],"(",["T_VARIABLE","$pageIds",233],")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n            ",233],["T_VARIABLE","$inCond",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$writeAdapter",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","prepareSqlCondition",234],"(",["T_CONSTANT_ENCAPSED_STRING","'page_id'",234],",",["T_WHITESPACE"," ",234],["T_ARRAY","array",234],"(",["T_WHITESPACE","\n                ",234],["T_CONSTANT_ENCAPSED_STRING","'in'",235],["T_WHITESPACE"," ",235],["T_DOUBLE_ARROW","=>",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$pageIds",235],["T_WHITESPACE","\n            ",235],")",")",";",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$writeAdapter",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","delete",237],"(",["T_WHITESPACE","\n                ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getTable",238],"(",["T_CONSTANT_ENCAPSED_STRING","'widget\/widget_instance_page'",238],")",",",["T_WHITESPACE","\n                ",238],["T_VARIABLE","$inCond",239],["T_WHITESPACE","\n            ",239],")",";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n        ",241],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$this",242],";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * Delete layout updates by given ids\n     *\n     * @param array $layoutUpdateIds\n     * @return Mage_Widget_Model_Resource_Widget_Instance\n     *\/",245],["T_WHITESPACE","\n    ",250],["T_PROTECTED","protected",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","_deleteLayoutUpdates",251],"(",["T_VARIABLE","$layoutUpdateIds",251],")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$writeAdapter",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_getWriteAdapter",253],"(",")",";",["T_WHITESPACE","\n        ",253],["T_IF","if",254],["T_WHITESPACE"," ",254],"(",["T_VARIABLE","$layoutUpdateIds",254],")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n            ",254],["T_VARIABLE","$inCond",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$writeAdapter",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","prepareSqlCondition",255],"(",["T_CONSTANT_ENCAPSED_STRING","'layout_update_id'",255],",",["T_WHITESPACE"," ",255],["T_ARRAY","array",255],"(",["T_WHITESPACE","\n                ",255],["T_CONSTANT_ENCAPSED_STRING","'in'",256],["T_WHITESPACE"," ",256],["T_DOUBLE_ARROW","=>",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$layoutUpdateIds",256],["T_WHITESPACE","\n            ",256],")",")",";",["T_WHITESPACE","\n            ",257],["T_VARIABLE","$writeAdapter",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","delete",258],"(",["T_WHITESPACE","\n                ",258],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getTable",259],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/layout_update'",259],")",",",["T_WHITESPACE","\n                ",259],["T_VARIABLE","$inCond",260],["T_WHITESPACE","\n            ",260],")",";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n        ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],";",["T_WHITESPACE","\n    ",263],"}",["T_WHITESPACE","\n\n    ",264],["T_DOC_COMMENT","\/**\n     * Get store ids to which specified item is assigned\n     *\n     * @param int $id\n     * @return array\n     *\/",266],["T_WHITESPACE","\n    ",271],["T_PUBLIC","public",272],["T_WHITESPACE"," ",272],["T_FUNCTION","function",272],["T_WHITESPACE"," ",272],["T_STRING","lookupStoreIds",272],"(",["T_VARIABLE","$id",272],")",["T_WHITESPACE","\n    ",272],"{",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$adapter",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_getReadAdapter",274],"(",")",";",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$select",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$adapter",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","select",275],"(",")",["T_WHITESPACE","\n            ",275],["T_OBJECT_OPERATOR","->",276],["T_STRING","from",276],"(",["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getMainTable",276],"(",")",",",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'store_ids'",276],")",["T_WHITESPACE","\n            ",276],["T_OBJECT_OPERATOR","->",277],["T_STRING","where",277],"(","\"",["T_CURLY_OPEN","{",277],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getIdFieldName",277],"(",")","}",["T_ENCAPSED_AND_WHITESPACE"," = ?",277],"\"",",",["T_WHITESPACE"," ",277],["T_INT_CAST","(int)",277],["T_VARIABLE","$id",277],")",";",["T_WHITESPACE","\n        ",277],["T_VARIABLE","$storeIds",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$adapter",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","fetchOne",278],"(",["T_VARIABLE","$select",278],")",";",["T_WHITESPACE","\n        ",278],["T_RETURN","return",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$storeIds",279],["T_WHITESPACE"," ",279],"?",["T_WHITESPACE"," ",279],["T_STRING","explode",279],"(",["T_CONSTANT_ENCAPSED_STRING","','",279],",",["T_WHITESPACE"," ",279],["T_VARIABLE","$storeIds",279],")",["T_WHITESPACE"," ",279],":",["T_WHITESPACE"," ",279],["T_ARRAY","array",279],"(",")",";",["T_WHITESPACE","\n    ",279],"}",["T_WHITESPACE","\n\n",280],"}",["T_WHITESPACE","\n",282]]