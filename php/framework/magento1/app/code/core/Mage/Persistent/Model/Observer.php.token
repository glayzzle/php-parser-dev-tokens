[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Persistent\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Persistent Observer\n *\n * @category   Mage\n * @package    Mage_Persistent\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Persistent_Model_Observer",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Whether set quote to be persistent in workflow\n     *\n     * @var bool\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_setQuotePersistent",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","true",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Apply persistent data\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Persistent_Model_Observer\n     *\/",44],["T_WHITESPACE","\n    ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","applyPersistentData",50],"(",["T_VARIABLE","$observer",50],")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_IF","if",52],["T_WHITESPACE"," ",52],"(","!",["T_STRING","Mage",52],["T_DOUBLE_COLON","::",52],["T_STRING","helper",52],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",52],")",["T_OBJECT_OPERATOR","->",52],["T_STRING","canProcess",52],"(",["T_VARIABLE","$observer",52],")",["T_WHITESPACE","\n            ",52],["T_BOOLEAN_OR","||",53],["T_WHITESPACE"," ",53],"!",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_getPersistentHelper",53],"(",")",["T_OBJECT_OPERATOR","->",53],["T_STRING","isPersistent",53],"(",")",["T_WHITESPACE"," ",53],["T_BOOLEAN_OR","||",53],["T_WHITESPACE"," ",53],["T_STRING","Mage",53],["T_DOUBLE_COLON","::",53],["T_STRING","getSingleton",53],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",53],")",["T_OBJECT_OPERATOR","->",53],["T_STRING","isLoggedIn",53],"(",")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_RETURN","return",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],";",["T_WHITESPACE","\n        ",54],"}",["T_WHITESPACE","\n        ",55],["T_STRING","Mage",56],["T_DOUBLE_COLON","::",56],["T_STRING","getModel",56],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent\/persistent_config'",56],")",["T_WHITESPACE","\n            ",56],["T_OBJECT_OPERATOR","->",57],["T_STRING","setConfigFilePath",57],"(",["T_STRING","Mage",57],["T_DOUBLE_COLON","::",57],["T_STRING","helper",57],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",57],")",["T_OBJECT_OPERATOR","->",57],["T_STRING","getPersistentConfigFilePath",57],"(",")",")",["T_WHITESPACE","\n            ",57],["T_OBJECT_OPERATOR","->",58],["T_STRING","fire",58],"(",")",";",["T_WHITESPACE","\n        ",58],["T_RETURN","return",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],";",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Apply persistent data to specific block\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Persistent_Model_Observer\n     *\/",62],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","applyBlockPersistentData",68],"(",["T_VARIABLE","$observer",68],")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(","!",["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_getPersistentHelper",70],"(",")",["T_OBJECT_OPERATOR","->",70],["T_STRING","isPersistent",70],"(",")",["T_WHITESPACE"," ",70],["T_BOOLEAN_OR","||",70],["T_WHITESPACE"," ",70],["T_STRING","Mage",70],["T_DOUBLE_COLON","::",70],["T_STRING","getSingleton",70],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",70],")",["T_OBJECT_OPERATOR","->",70],["T_STRING","isLoggedIn",70],"(",")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_RETURN","return",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n\n        ",72],["T_DOC_COMMENT","\/** @var $block Mage_Core_Block_Abstract *\/",74],["T_WHITESPACE","\n        ",74],["T_VARIABLE","$block",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$observer",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getEvent",75],"(",")",["T_OBJECT_OPERATOR","->",75],["T_STRING","getBlock",75],"(",")",";",["T_WHITESPACE","\n\n        ",75],["T_IF","if",77],["T_WHITESPACE"," ",77],"(","!",["T_VARIABLE","$block",77],")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],";",["T_WHITESPACE","\n        ",78],"}",["T_WHITESPACE","\n\n        ",79],["T_VARIABLE","$xPath",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'\/\/instances\/blocks\/*[block_type=\"'",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_STRING","get_class",81],"(",["T_VARIABLE","$block",81],")",["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'\"]'",81],";",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$configFilePath",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$observer",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getEvent",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","getConfigFilePath",82],"(",")",";",["T_WHITESPACE","\n\n        ",82],["T_DOC_COMMENT","\/** @var $persistentConfig Mage_Persistent_Model_Persistent_Config *\/",84],["T_WHITESPACE","\n        ",84],["T_VARIABLE","$persistentConfig",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","getModel",85],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent\/persistent_config'",85],")",["T_WHITESPACE","\n            ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","setConfigFilePath",86],"(",["T_WHITESPACE","\n                ",86],["T_VARIABLE","$configFilePath",87],["T_WHITESPACE"," ",87],"?",["T_WHITESPACE"," ",87],["T_VARIABLE","$configFilePath",87],["T_WHITESPACE"," ",87],":",["T_WHITESPACE"," ",87],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","helper",87],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",87],")",["T_OBJECT_OPERATOR","->",87],["T_STRING","getPersistentConfigFilePath",87],"(",")",["T_WHITESPACE","\n            ",87],")",";",["T_WHITESPACE","\n\n        ",88],["T_FOREACH","foreach",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$persistentConfig",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getXmlConfig",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","xpath",90],"(",["T_VARIABLE","$xPath",90],")",["T_WHITESPACE"," ",90],["T_AS","as",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$persistentConfigInfo",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$persistentConfig",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","fireOne",91],"(",["T_VARIABLE","$persistentConfigInfo",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","asArray",91],"(",")",",",["T_WHITESPACE"," ",91],["T_VARIABLE","$block",91],")",";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n    ",95],["T_DOC_COMMENT","\/**\n     * Emulate welcome message with persistent data\n     *\n     * @param Mage_Core_Block_Abstract $block\n     * @return Mage_Persistent_Model_Observer\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","emulateWelcomeMessageBlock",102],"(",["T_VARIABLE","$block",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$block",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","setWelcome",104],"(",["T_WHITESPACE","\n            ",104],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","helper",105],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",105],")",["T_OBJECT_OPERATOR","->",105],["T_STRING","__",105],"(",["T_CONSTANT_ENCAPSED_STRING","'Welcome, %s!'",105],",",["T_WHITESPACE"," ",105],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","helper",105],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",105],")",["T_OBJECT_OPERATOR","->",105],["T_STRING","escapeHtml",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_getPersistentCustomer",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getName",105],"(",")",",",["T_WHITESPACE"," ",105],["T_STRING","null",105],")",")",["T_WHITESPACE","\n        ",105],")",";",["T_WHITESPACE","\n        ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n    ",108],["T_DOC_COMMENT","\/**\n     * Emulate 'welcome' block with persistent data\n     *\n     * @param Mage_Core_Block_Abstract $block\n     * @return Mage_Persistent_Model_Observer\n     *\/",109],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","emulateWelcomeBlock",115],"(",["T_VARIABLE","$block",115],")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_applyAccountLinksPersistentData",117],"(",")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$block",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","setAdditionalHtml",118],"(",["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","app",118],"(",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","getLayout",118],"(",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","getBlock",118],"(",["T_CONSTANT_ENCAPSED_STRING","'header.additional'",118],")",["T_OBJECT_OPERATOR","->",118],["T_STRING","toHtml",118],"(",")",")",";",["T_WHITESPACE","\n\n        ",118],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Emulate 'account links' block with persistent data\n     *\/",123],["T_WHITESPACE","\n    ",125],["T_PROTECTED","protected",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","_applyAccountLinksPersistentData",126],"(",")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(","!",["T_STRING","Mage",128],["T_DOUBLE_COLON","::",128],["T_STRING","app",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getLayout",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getBlock",128],"(",["T_CONSTANT_ENCAPSED_STRING","'header.additional'",128],")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_STRING","Mage",129],["T_DOUBLE_COLON","::",129],["T_STRING","app",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","getLayout",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","addBlock",129],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent\/header_additional'",129],",",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'header.additional'",129],")",";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Emulate 'account links' block with persistent data\n     *\n     * @param Mage_Core_Block_Abstract $block\n     *\/",133],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","emulateAccountLinks",138],"(",["T_VARIABLE","$block",138],")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_applyAccountLinksPersistentData",140],"(",")",";",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$block",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getCacheKeyInfo",141],"(",")",";",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$block",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","addLink",142],"(",["T_WHITESPACE","\n            ",142],["T_STRING","Mage",143],["T_DOUBLE_COLON","::",143],["T_STRING","helper",143],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",143],")",["T_OBJECT_OPERATOR","->",143],["T_STRING","getPersistentName",143],"(",")",",",["T_WHITESPACE","\n            ",143],["T_STRING","Mage",144],["T_DOUBLE_COLON","::",144],["T_STRING","helper",144],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",144],")",["T_OBJECT_OPERATOR","->",144],["T_STRING","getUnsetCookieUrl",144],"(",")",",",["T_WHITESPACE","\n            ",144],["T_STRING","Mage",145],["T_DOUBLE_COLON","::",145],["T_STRING","helper",145],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",145],")",["T_OBJECT_OPERATOR","->",145],["T_STRING","getPersistentName",145],"(",")",",",["T_WHITESPACE","\n            ",145],["T_STRING","false",146],",",["T_WHITESPACE","\n            ",146],["T_ARRAY","array",147],"(",")",",",["T_WHITESPACE","\n            ",147],["T_LNUMBER","110",148],["T_WHITESPACE","\n        ",148],")",";",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$block",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","removeLinkByUrl",150],"(",["T_STRING","Mage",150],["T_DOUBLE_COLON","::",150],["T_STRING","helper",150],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",150],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","getRegisterUrl",150],"(",")",")",";",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$block",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","removeLinkByUrl",151],"(",["T_STRING","Mage",151],["T_DOUBLE_COLON","::",151],["T_STRING","helper",151],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",151],")",["T_OBJECT_OPERATOR","->",151],["T_STRING","getLoginUrl",151],"(",")",")",";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Emulate 'top links' block with persistent data\n     *\n     * @param Mage_Core_Block_Abstract $block\n     *\/",154],["T_WHITESPACE","\n    ",158],["T_PUBLIC","public",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","emulateTopLinks",159],"(",["T_VARIABLE","$block",159],")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_applyAccountLinksPersistentData",161],"(",")",";",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * Emulate quote by persistent data\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",164],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","emulateQuote",169],"(",["T_VARIABLE","$observer",169],")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$stopActions",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_ARRAY","array",171],"(",["T_WHITESPACE","\n            ",171],["T_CONSTANT_ENCAPSED_STRING","'persistent_index_saveMethod'",172],",",["T_WHITESPACE","\n            ",172],["T_CONSTANT_ENCAPSED_STRING","'customer_account_createpost'",173],["T_WHITESPACE","\n        ",173],")",";",["T_WHITESPACE","\n\n        ",174],["T_IF","if",176],["T_WHITESPACE"," ",176],"(","!",["T_STRING","Mage",176],["T_DOUBLE_COLON","::",176],["T_STRING","helper",176],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",176],")",["T_OBJECT_OPERATOR","->",176],["T_STRING","canProcess",176],"(",["T_VARIABLE","$observer",176],")",["T_WHITESPACE","\n            ",176],["T_BOOLEAN_OR","||",177],["T_WHITESPACE"," ",177],"!",["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_getPersistentHelper",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","isPersistent",177],"(",")",["T_WHITESPACE"," ",177],["T_BOOLEAN_OR","||",177],["T_WHITESPACE"," ",177],["T_STRING","Mage",177],["T_DOUBLE_COLON","::",177],["T_STRING","getSingleton",177],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",177],")",["T_OBJECT_OPERATOR","->",177],["T_STRING","isLoggedIn",177],"(",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_RETURN","return",178],";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE","\n\n        ",179],["T_DOC_COMMENT","\/** @var $action Mage_Checkout_OnepageController *\/",181],["T_WHITESPACE","\n        ",181],["T_VARIABLE","$action",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$observer",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getEvent",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","getControllerAction",182],"(",")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$actionName",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$action",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getFullActionName",183],"(",")",";",["T_WHITESPACE","\n\n        ",183],["T_IF","if",185],["T_WHITESPACE"," ",185],"(",["T_STRING","in_array",185],"(",["T_VARIABLE","$actionName",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$stopActions",185],")",")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n            ",185],["T_RETURN","return",186],";",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n\n        ",187],["T_DOC_COMMENT","\/** @var $checkoutSession Mage_Checkout_Model_Session *\/",189],["T_WHITESPACE","\n        ",189],["T_VARIABLE","$checkoutSession",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_STRING","Mage",190],["T_DOUBLE_COLON","::",190],["T_STRING","getSingleton",190],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",190],")",";",["T_WHITESPACE","\n        ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_isShoppingCartPersist",191],"(",")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$checkoutSession",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","setCustomer",192],"(",["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_getPersistentCustomer",192],"(",")",")",";",["T_WHITESPACE","\n            ",192],["T_IF","if",193],["T_WHITESPACE"," ",193],"(","!",["T_VARIABLE","$checkoutSession",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","hasQuote",193],"(",")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n                ",193],["T_VARIABLE","$checkoutSession",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getQuote",194],"(",")",";",["T_WHITESPACE","\n            ",194],"}",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n\n    ",197],["T_DOC_COMMENT","\/**\n     * Set persistent data into quote\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",199],["T_WHITESPACE","\n    ",203],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","setQuotePersistentData",204],"(",["T_VARIABLE","$observer",204],")",["T_WHITESPACE","\n    ",204],"{",["T_WHITESPACE","\n        ",205],["T_IF","if",206],["T_WHITESPACE"," ",206],"(","!",["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_isPersistent",206],"(",")",")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n            ",206],["T_RETURN","return",207],";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n\n        ",208],["T_DOC_COMMENT","\/** @var $quote Mage_Sales_Model_Quote *\/",210],["T_WHITESPACE","\n        ",210],["T_VARIABLE","$quote",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$observer",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getEvent",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","getQuote",211],"(",")",";",["T_WHITESPACE","\n        ",211],["T_IF","if",212],["T_WHITESPACE"," ",212],"(","!",["T_VARIABLE","$quote",212],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_RETURN","return",213],";",["T_WHITESPACE","\n        ",213],"}",["T_WHITESPACE","\n\n        ",214],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_isGuestShoppingCart",216],"(",")",["T_WHITESPACE"," ",216],["T_BOOLEAN_AND","&&",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_setQuotePersistent",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_COMMENT","\/\/Quote is not actual customer's quote, just persistent\n",217],["T_WHITESPACE","            ",218],["T_VARIABLE","$quote",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","setIsActive",218],"(",["T_STRING","false",218],")",["T_OBJECT_OPERATOR","->",218],["T_STRING","setIsPersistent",218],"(",["T_STRING","true",218],")",";",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n\n    ",220],["T_DOC_COMMENT","\/**\n     * Set quote to be loaded even if not active\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",222],["T_WHITESPACE","\n    ",226],["T_PUBLIC","public",227],["T_WHITESPACE"," ",227],["T_FUNCTION","function",227],["T_WHITESPACE"," ",227],["T_STRING","setLoadPersistentQuote",227],"(",["T_VARIABLE","$observer",227],")",["T_WHITESPACE","\n    ",227],"{",["T_WHITESPACE","\n        ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(","!",["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","_isGuestShoppingCart",229],"(",")",")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n            ",229],["T_RETURN","return",230],";",["T_WHITESPACE","\n        ",230],"}",["T_WHITESPACE","\n\n        ",231],["T_DOC_COMMENT","\/** @var $checkoutSession Mage_Checkout_Model_Session *\/",233],["T_WHITESPACE","\n        ",233],["T_VARIABLE","$checkoutSession",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$observer",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getEvent",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","getCheckoutSession",234],"(",")",";",["T_WHITESPACE","\n        ",234],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$checkoutSession",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$checkoutSession",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","setLoadInactive",236],"(",")",";",["T_WHITESPACE","\n        ",236],"}",["T_WHITESPACE","\n    ",237],"}",["T_WHITESPACE","\n\n    ",238],["T_DOC_COMMENT","\/**\n     * Prevent clear checkout session\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",240],["T_WHITESPACE","\n    ",244],["T_PUBLIC","public",245],["T_WHITESPACE"," ",245],["T_FUNCTION","function",245],["T_WHITESPACE"," ",245],["T_STRING","preventClearCheckoutSession",245],"(",["T_VARIABLE","$observer",245],")",["T_WHITESPACE","\n    ",245],"{",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$action",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_checkClearCheckoutSessionNecessity",247],"(",["T_VARIABLE","$observer",247],")",";",["T_WHITESPACE","\n\n        ",247],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_VARIABLE","$action",249],")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n            ",249],["T_VARIABLE","$action",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","setClearCheckoutSession",250],"(",["T_STRING","false",250],")",";",["T_WHITESPACE","\n        ",250],"}",["T_WHITESPACE","\n    ",251],"}",["T_WHITESPACE","\n\n    ",252],["T_DOC_COMMENT","\/**\n     * Make persistent quote to be guest\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",254],["T_WHITESPACE","\n    ",258],["T_PUBLIC","public",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","makePersistentQuoteGuest",259],"(",["T_VARIABLE","$observer",259],")",["T_WHITESPACE","\n    ",259],"{",["T_WHITESPACE","\n        ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(","!",["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_checkClearCheckoutSessionNecessity",261],"(",["T_VARIABLE","$observer",261],")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_RETURN","return",262],";",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n\n        ",263],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","setQuoteGuest",265],"(",["T_STRING","true",265],")",";",["T_WHITESPACE","\n    ",265],"}",["T_WHITESPACE","\n\n    ",266],["T_DOC_COMMENT","\/**\n     * Check if checkout session should NOT be cleared\n     *\n     * @param Varien_Event_Observer $observer\n     * @return bool|Mage_Persistent_IndexController\n     *\/",268],["T_WHITESPACE","\n    ",273],["T_PROTECTED","protected",274],["T_WHITESPACE"," ",274],["T_FUNCTION","function",274],["T_WHITESPACE"," ",274],["T_STRING","_checkClearCheckoutSessionNecessity",274],"(",["T_VARIABLE","$observer",274],")",["T_WHITESPACE","\n    ",274],"{",["T_WHITESPACE","\n        ",275],["T_IF","if",276],["T_WHITESPACE"," ",276],"(","!",["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_isGuestShoppingCart",276],"(",")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n            ",276],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_STRING","false",277],";",["T_WHITESPACE","\n        ",277],"}",["T_WHITESPACE","\n\n        ",278],["T_DOC_COMMENT","\/** @var $action Mage_Persistent_IndexController *\/",280],["T_WHITESPACE","\n        ",280],["T_VARIABLE","$action",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$observer",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getEvent",281],"(",")",["T_OBJECT_OPERATOR","->",281],["T_STRING","getControllerAction",281],"(",")",";",["T_WHITESPACE","\n        ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$action",282],["T_WHITESPACE"," ",282],["T_INSTANCEOF","instanceof",282],["T_WHITESPACE"," ",282],["T_STRING","Mage_Persistent_IndexController",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_RETURN","return",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$action",283],";",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE","\n\n        ",284],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_STRING","false",286],";",["T_WHITESPACE","\n    ",286],"}",["T_WHITESPACE","\n\n    ",287],["T_DOC_COMMENT","\/**\n     * Reset session data when customer re-authenticates\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",289],["T_WHITESPACE","\n    ",293],["T_PUBLIC","public",294],["T_WHITESPACE"," ",294],["T_FUNCTION","function",294],["T_WHITESPACE"," ",294],["T_STRING","customerAuthenticatedEvent",294],"(",["T_VARIABLE","$observer",294],")",["T_WHITESPACE","\n    ",294],"{",["T_WHITESPACE","\n        ",295],["T_DOC_COMMENT","\/** @var $customerSession Mage_Customer_Model_Session *\/",296],["T_WHITESPACE","\n        ",296],["T_VARIABLE","$customerSession",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_STRING","Mage",297],["T_DOUBLE_COLON","::",297],["T_STRING","getSingleton",297],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",297],")",";",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$customerSession",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","setCustomerId",298],"(",["T_STRING","null",298],")",["T_OBJECT_OPERATOR","->",298],["T_STRING","setCustomerGroupId",298],"(",["T_STRING","null",298],")",";",["T_WHITESPACE","\n\n        ",298],["T_IF","if",300],["T_WHITESPACE"," ",300],"(",["T_STRING","Mage",300],["T_DOUBLE_COLON","::",300],["T_STRING","app",300],"(",")",["T_OBJECT_OPERATOR","->",300],["T_STRING","getRequest",300],"(",")",["T_OBJECT_OPERATOR","->",300],["T_STRING","getParam",300],"(",["T_CONSTANT_ENCAPSED_STRING","'context'",300],")",["T_WHITESPACE"," ",300],["T_IS_NOT_EQUAL","!=",300],["T_WHITESPACE"," ",300],["T_CONSTANT_ENCAPSED_STRING","'checkout'",300],")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_expirePersistentSession",301],"(",")",";",["T_WHITESPACE","\n            ",301],["T_RETURN","return",302],";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE","\n\n        ",303],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","setQuoteGuest",305],"(",")",";",["T_WHITESPACE","\n    ",305],"}",["T_WHITESPACE","\n\n    ",306],["T_DOC_COMMENT","\/**\n     * Unset persistent cookie and make customer's quote as a guest\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",308],["T_WHITESPACE","\n    ",312],["T_PUBLIC","public",313],["T_WHITESPACE"," ",313],["T_FUNCTION","function",313],["T_WHITESPACE"," ",313],["T_STRING","removePersistentCookie",313],"(",["T_VARIABLE","$observer",313],")",["T_WHITESPACE","\n    ",313],"{",["T_WHITESPACE","\n        ",314],["T_IF","if",315],["T_WHITESPACE"," ",315],"(","!",["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","helper",315],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",315],")",["T_OBJECT_OPERATOR","->",315],["T_STRING","canProcess",315],"(",["T_VARIABLE","$observer",315],")",["T_WHITESPACE"," ",315],["T_BOOLEAN_OR","||",315],["T_WHITESPACE"," ",315],"!",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_isPersistent",315],"(",")",")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_RETURN","return",316],";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE","\n\n        ",317],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_getPersistentHelper",319],"(",")",["T_OBJECT_OPERATOR","->",319],["T_STRING","getSession",319],"(",")",["T_OBJECT_OPERATOR","->",319],["T_STRING","removePersistentCookie",319],"(",")",";",["T_WHITESPACE","\n        ",319],["T_DOC_COMMENT","\/** @var $customerSession Mage_Customer_Model_Session *\/",320],["T_WHITESPACE","\n        ",320],["T_VARIABLE","$customerSession",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_STRING","Mage",321],["T_DOUBLE_COLON","::",321],["T_STRING","getSingleton",321],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",321],")",";",["T_WHITESPACE","\n        ",321],["T_IF","if",322],["T_WHITESPACE"," ",322],"(","!",["T_VARIABLE","$customerSession",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","isLoggedIn",322],"(",")",")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n            ",322],["T_VARIABLE","$customerSession",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","setCustomerId",323],"(",["T_STRING","null",323],")",["T_OBJECT_OPERATOR","->",323],["T_STRING","setCustomerGroupId",323],"(",["T_STRING","null",323],")",";",["T_WHITESPACE","\n        ",323],"}",["T_WHITESPACE","\n\n        ",324],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","setQuoteGuest",326],"(",")",";",["T_WHITESPACE","\n    ",326],"}",["T_WHITESPACE","\n\n    ",327],["T_DOC_COMMENT","\/**\n     * Disable guest checkout if we are in persistent mode\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",329],["T_WHITESPACE","\n    ",333],["T_PUBLIC","public",334],["T_WHITESPACE"," ",334],["T_FUNCTION","function",334],["T_WHITESPACE"," ",334],["T_STRING","disableGuestCheckout",334],"(",["T_VARIABLE","$observer",334],")",["T_WHITESPACE","\n    ",334],"{",["T_WHITESPACE","\n        ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_getPersistentHelper",336],"(",")",["T_OBJECT_OPERATOR","->",336],["T_STRING","isPersistent",336],"(",")",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_VARIABLE","$observer",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getEvent",337],"(",")",["T_OBJECT_OPERATOR","->",337],["T_STRING","getResult",337],"(",")",["T_OBJECT_OPERATOR","->",337],["T_STRING","setIsAllowed",337],"(",["T_STRING","false",337],")",";",["T_WHITESPACE","\n        ",337],"}",["T_WHITESPACE","\n    ",338],"}",["T_WHITESPACE","\n\n    ",339],["T_DOC_COMMENT","\/**\n     * Prevent express checkout with PayPal Express checkout\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",341],["T_WHITESPACE","\n    ",345],["T_PUBLIC","public",346],["T_WHITESPACE"," ",346],["T_FUNCTION","function",346],["T_WHITESPACE"," ",346],["T_STRING","preventExpressCheckout",346],"(",["T_VARIABLE","$observer",346],")",["T_WHITESPACE","\n    ",346],"{",["T_WHITESPACE","\n        ",347],["T_IF","if",348],["T_WHITESPACE"," ",348],"(","!",["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","_isLoggedOut",348],"(",")",")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n            ",348],["T_RETURN","return",349],";",["T_WHITESPACE","\n        ",349],"}",["T_WHITESPACE","\n\n        ",350],["T_DOC_COMMENT","\/** @var $controllerAction Mage_Core_Controller_Front_Action *\/",352],["T_WHITESPACE","\n        ",352],["T_VARIABLE","$controllerAction",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_VARIABLE","$observer",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getEvent",353],"(",")",["T_OBJECT_OPERATOR","->",353],["T_STRING","getControllerAction",353],"(",")",";",["T_WHITESPACE","\n        ",353],["T_IF","if",354],["T_WHITESPACE"," ",354],"(",["T_STRING","method_exists",354],"(",["T_VARIABLE","$controllerAction",354],",",["T_WHITESPACE"," ",354],["T_CONSTANT_ENCAPSED_STRING","'redirectLogin'",354],")",")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n            ",354],["T_STRING","Mage",355],["T_DOUBLE_COLON","::",355],["T_STRING","getSingleton",355],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/session'",355],")",["T_OBJECT_OPERATOR","->",355],["T_STRING","addNotice",355],"(",["T_WHITESPACE","\n                ",355],["T_STRING","Mage",356],["T_DOUBLE_COLON","::",356],["T_STRING","helper",356],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",356],")",["T_OBJECT_OPERATOR","->",356],["T_STRING","__",356],"(",["T_CONSTANT_ENCAPSED_STRING","'To proceed to Checkout, please log in using your email address.'",356],")",["T_WHITESPACE","\n            ",356],")",";",["T_WHITESPACE","\n            ",357],["T_VARIABLE","$controllerAction",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","redirectLogin",358],"(",")",";",["T_WHITESPACE","\n            ",358],["T_IF","if",359],["T_WHITESPACE"," ",359],"(",["T_VARIABLE","$controllerAction",359],["T_WHITESPACE"," ",359],["T_INSTANCEOF","instanceof",359],["T_WHITESPACE"," ",359],["T_STRING","Mage_Paypal_Controller_Express_Abstract",359],")",["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n                ",359],["T_STRING","Mage",360],["T_DOUBLE_COLON","::",360],["T_STRING","getSingleton",360],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",360],")",["T_WHITESPACE","\n                    ",360],["T_OBJECT_OPERATOR","->",361],["T_STRING","setBeforeAuthUrl",361],"(",["T_STRING","Mage",361],["T_DOUBLE_COLON","::",361],["T_STRING","getUrl",361],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent\/index\/expressCheckout'",361],")",")",";",["T_WHITESPACE","\n            ",361],"}",["T_WHITESPACE","\n        ",362],"}",["T_WHITESPACE","\n    ",363],"}",["T_WHITESPACE","\n\n    ",364],["T_DOC_COMMENT","\/**\n     * Retrieve persistent customer instance\n     *\n     * @return Mage_Customer_Model_Customer\n     *\/",366],["T_WHITESPACE","\n    ",370],["T_PROTECTED","protected",371],["T_WHITESPACE"," ",371],["T_FUNCTION","function",371],["T_WHITESPACE"," ",371],["T_STRING","_getPersistentCustomer",371],"(",")",["T_WHITESPACE","\n    ",371],"{",["T_WHITESPACE","\n        ",372],["T_RETURN","return",373],["T_WHITESPACE"," ",373],["T_STRING","Mage",373],["T_DOUBLE_COLON","::",373],["T_STRING","getModel",373],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",373],")",["T_OBJECT_OPERATOR","->",373],["T_STRING","load",373],"(",["T_WHITESPACE","\n            ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_getPersistentHelper",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","getSession",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","getCustomerId",374],"(",")",["T_WHITESPACE","\n        ",374],")",";",["T_WHITESPACE","\n    ",375],"}",["T_WHITESPACE","\n\n    ",376],["T_DOC_COMMENT","\/**\n     * Retrieve persistent helper\n     *\n     * @return Mage_Persistent_Helper_Session\n     *\/",378],["T_WHITESPACE","\n    ",382],["T_PROTECTED","protected",383],["T_WHITESPACE"," ",383],["T_FUNCTION","function",383],["T_WHITESPACE"," ",383],["T_STRING","_getPersistentHelper",383],"(",")",["T_WHITESPACE","\n    ",383],"{",["T_WHITESPACE","\n        ",384],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_STRING","Mage",385],["T_DOUBLE_COLON","::",385],["T_STRING","helper",385],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent\/session'",385],")",";",["T_WHITESPACE","\n    ",385],"}",["T_WHITESPACE","\n\n    ",386],["T_DOC_COMMENT","\/**\n     * Return current active quote for persistent customer\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",388],["T_WHITESPACE","\n    ",392],["T_PROTECTED","protected",393],["T_WHITESPACE"," ",393],["T_FUNCTION","function",393],["T_WHITESPACE"," ",393],["T_STRING","_getQuote",393],"(",")",["T_WHITESPACE","\n    ",393],"{",["T_WHITESPACE","\n        ",394],["T_VARIABLE","$quote",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_STRING","Mage",395],["T_DOUBLE_COLON","::",395],["T_STRING","getModel",395],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",395],")",";",["T_WHITESPACE","\n        ",395],["T_VARIABLE","$quote",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","loadByCustomer",396],"(",["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","_getPersistentCustomer",396],"(",")",")",";",["T_WHITESPACE","\n        ",396],["T_RETURN","return",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$quote",397],";",["T_WHITESPACE","\n    ",397],"}",["T_WHITESPACE","\n\n    ",398],["T_DOC_COMMENT","\/**\n     * Check whether shopping cart is persistent\n     *\n     * @return bool\n     *\/",400],["T_WHITESPACE","\n    ",404],["T_PROTECTED","protected",405],["T_WHITESPACE"," ",405],["T_FUNCTION","function",405],["T_WHITESPACE"," ",405],["T_STRING","_isShoppingCartPersist",405],"(",")",["T_WHITESPACE","\n    ",405],"{",["T_WHITESPACE","\n        ",406],["T_RETURN","return",407],["T_WHITESPACE"," ",407],["T_STRING","Mage",407],["T_DOUBLE_COLON","::",407],["T_STRING","helper",407],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",407],")",["T_OBJECT_OPERATOR","->",407],["T_STRING","isShoppingCartPersist",407],"(",")",";",["T_WHITESPACE","\n    ",407],"}",["T_WHITESPACE","\n\n    ",408],["T_DOC_COMMENT","\/**\n     * Check whether persistent mode is running\n     *\n     * @return bool\n     *\/",410],["T_WHITESPACE","\n    ",414],["T_PROTECTED","protected",415],["T_WHITESPACE"," ",415],["T_FUNCTION","function",415],["T_WHITESPACE"," ",415],["T_STRING","_isPersistent",415],"(",")",["T_WHITESPACE","\n    ",415],"{",["T_WHITESPACE","\n        ",416],["T_RETURN","return",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","_getPersistentHelper",417],"(",")",["T_OBJECT_OPERATOR","->",417],["T_STRING","isPersistent",417],"(",")",";",["T_WHITESPACE","\n    ",417],"}",["T_WHITESPACE","\n\n    ",418],["T_DOC_COMMENT","\/**\n     * Check if persistent mode is running and customer is logged out\n     *\n     * @return bool\n     *\/",420],["T_WHITESPACE","\n    ",424],["T_PROTECTED","protected",425],["T_WHITESPACE"," ",425],["T_FUNCTION","function",425],["T_WHITESPACE"," ",425],["T_STRING","_isLoggedOut",425],"(",")",["T_WHITESPACE","\n    ",425],"{",["T_WHITESPACE","\n        ",426],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_isPersistent",427],"(",")",["T_WHITESPACE"," ",427],["T_BOOLEAN_AND","&&",427],["T_WHITESPACE"," ",427],"!",["T_STRING","Mage",427],["T_DOUBLE_COLON","::",427],["T_STRING","getSingleton",427],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",427],")",["T_OBJECT_OPERATOR","->",427],["T_STRING","isLoggedIn",427],"(",")",";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n\n    ",428],["T_DOC_COMMENT","\/**\n     * Check if shopping cart is guest while persistent session and user is logged out\n     *\n     * @return bool\n     *\/",430],["T_WHITESPACE","\n    ",434],["T_PROTECTED","protected",435],["T_WHITESPACE"," ",435],["T_FUNCTION","function",435],["T_WHITESPACE"," ",435],["T_STRING","_isGuestShoppingCart",435],"(",")",["T_WHITESPACE","\n    ",435],"{",["T_WHITESPACE","\n        ",436],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","_isLoggedOut",437],"(",")",["T_WHITESPACE"," ",437],["T_BOOLEAN_AND","&&",437],["T_WHITESPACE"," ",437],"!",["T_STRING","Mage",437],["T_DOUBLE_COLON","::",437],["T_STRING","helper",437],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",437],")",["T_OBJECT_OPERATOR","->",437],["T_STRING","isShoppingCartPersist",437],"(",")",";",["T_WHITESPACE","\n    ",437],"}",["T_WHITESPACE","\n\n    ",438],["T_DOC_COMMENT","\/**\n     * Make quote to be guest\n     *\n     * @param bool $checkQuote Check quote to be persistent (not stolen)\n     *\/",440],["T_WHITESPACE","\n    ",444],["T_PUBLIC","public",445],["T_WHITESPACE"," ",445],["T_FUNCTION","function",445],["T_WHITESPACE"," ",445],["T_STRING","setQuoteGuest",445],"(",["T_VARIABLE","$checkQuote",445],["T_WHITESPACE"," ",445],"=",["T_WHITESPACE"," ",445],["T_STRING","false",445],")",["T_WHITESPACE","\n    ",445],"{",["T_WHITESPACE","\n        ",446],["T_DOC_COMMENT","\/** @var $quote Mage_Sales_Model_Quote *\/",447],["T_WHITESPACE","\n        ",447],["T_VARIABLE","$quote",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_STRING","Mage",448],["T_DOUBLE_COLON","::",448],["T_STRING","getSingleton",448],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",448],")",["T_OBJECT_OPERATOR","->",448],["T_STRING","getQuote",448],"(",")",";",["T_WHITESPACE","\n        ",448],["T_IF","if",449],["T_WHITESPACE"," ",449],"(",["T_VARIABLE","$quote",449],["T_WHITESPACE"," ",449],["T_BOOLEAN_AND","&&",449],["T_WHITESPACE"," ",449],["T_VARIABLE","$quote",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getId",449],"(",")",")",["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_IF","if",450],["T_WHITESPACE"," ",450],"(",["T_VARIABLE","$checkQuote",450],["T_WHITESPACE"," ",450],["T_BOOLEAN_AND","&&",450],["T_WHITESPACE"," ",450],"!",["T_STRING","Mage",450],["T_DOUBLE_COLON","::",450],["T_STRING","helper",450],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",450],")",["T_OBJECT_OPERATOR","->",450],["T_STRING","isShoppingCartPersist",450],"(",")",["T_WHITESPACE"," ",450],["T_BOOLEAN_AND","&&",450],["T_WHITESPACE"," ",450],"!",["T_VARIABLE","$quote",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getIsPersistent",450],"(",")",")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n                ",450],["T_STRING","Mage",451],["T_DOUBLE_COLON","::",451],["T_STRING","getSingleton",451],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",451],")",["T_OBJECT_OPERATOR","->",451],["T_STRING","unsetAll",451],"(",")",";",["T_WHITESPACE","\n                ",451],["T_RETURN","return",452],";",["T_WHITESPACE","\n            ",452],"}",["T_WHITESPACE","\n\n            ",453],["T_VARIABLE","$quote",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","getPaymentsCollection",455],"(",")",["T_OBJECT_OPERATOR","->",455],["T_STRING","walk",455],"(",["T_CONSTANT_ENCAPSED_STRING","'delete'",455],")",";",["T_WHITESPACE","\n            ",455],["T_VARIABLE","$quote",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","getAddressesCollection",456],"(",")",["T_OBJECT_OPERATOR","->",456],["T_STRING","walk",456],"(",["T_CONSTANT_ENCAPSED_STRING","'delete'",456],")",";",["T_WHITESPACE","\n            ",456],["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","_setQuotePersistent",457],["T_WHITESPACE"," ",457],"=",["T_WHITESPACE"," ",457],["T_STRING","false",457],";",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$quote",458],["T_WHITESPACE","\n                ",458],["T_OBJECT_OPERATOR","->",459],["T_STRING","setIsActive",459],"(",["T_STRING","true",459],")",["T_WHITESPACE","\n                ",459],["T_OBJECT_OPERATOR","->",460],["T_STRING","setCustomerId",460],"(",["T_STRING","null",460],")",["T_WHITESPACE","\n                ",460],["T_OBJECT_OPERATOR","->",461],["T_STRING","setCustomerEmail",461],"(",["T_STRING","null",461],")",["T_WHITESPACE","\n                ",461],["T_OBJECT_OPERATOR","->",462],["T_STRING","setCustomerFirstname",462],"(",["T_STRING","null",462],")",["T_WHITESPACE","\n                ",462],["T_OBJECT_OPERATOR","->",463],["T_STRING","setCustomerMiddlename",463],"(",["T_STRING","null",463],")",["T_WHITESPACE","\n                ",463],["T_OBJECT_OPERATOR","->",464],["T_STRING","setCustomerLastname",464],"(",["T_STRING","null",464],")",["T_WHITESPACE","\n                ",464],["T_OBJECT_OPERATOR","->",465],["T_STRING","setCustomerGroupId",465],"(",["T_STRING","Mage_Customer_Model_Group",465],["T_DOUBLE_COLON","::",465],["T_STRING","NOT_LOGGED_IN_ID",465],")",["T_WHITESPACE","\n                ",465],["T_OBJECT_OPERATOR","->",466],["T_STRING","setIsPersistent",466],"(",["T_STRING","false",466],")",["T_WHITESPACE","\n                ",466],["T_OBJECT_OPERATOR","->",467],["T_STRING","removeAllAddresses",467],"(",")",";",["T_WHITESPACE","\n            ",467],["T_COMMENT","\/\/Create guest addresses\n",468],["T_WHITESPACE","            ",469],["T_VARIABLE","$quote",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getShippingAddress",469],"(",")",";",["T_WHITESPACE","\n            ",469],["T_VARIABLE","$quote",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","getBillingAddress",470],"(",")",";",["T_WHITESPACE","\n            ",470],["T_VARIABLE","$quote",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","collectTotals",471],"(",")",["T_OBJECT_OPERATOR","->",471],["T_STRING","save",471],"(",")",";",["T_WHITESPACE","\n        ",471],"}",["T_WHITESPACE","\n\n        ",472],["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","_getPersistentHelper",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","getSession",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","removePersistentCookie",474],"(",")",";",["T_WHITESPACE","\n    ",474],"}",["T_WHITESPACE","\n\n    ",475],["T_DOC_COMMENT","\/**\n     * Check and clear session data if persistent session expired\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",477],["T_WHITESPACE","\n    ",481],["T_PUBLIC","public",482],["T_WHITESPACE"," ",482],["T_FUNCTION","function",482],["T_WHITESPACE"," ",482],["T_STRING","checkExpirePersistentQuote",482],"(",["T_STRING","Varien_Event_Observer",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$observer",482],")",["T_WHITESPACE","\n    ",482],"{",["T_WHITESPACE","\n        ",483],["T_IF","if",484],["T_WHITESPACE"," ",484],"(","!",["T_STRING","Mage",484],["T_DOUBLE_COLON","::",484],["T_STRING","helper",484],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",484],")",["T_OBJECT_OPERATOR","->",484],["T_STRING","canProcess",484],"(",["T_VARIABLE","$observer",484],")",")",["T_WHITESPACE"," ",484],"{",["T_WHITESPACE","\n            ",484],["T_RETURN","return",485],";",["T_WHITESPACE","\n        ",485],"}",["T_WHITESPACE","\n\n        ",486],["T_DOC_COMMENT","\/** @var $customerSession Mage_Customer_Model_Session *\/",488],["T_WHITESPACE","\n        ",488],["T_VARIABLE","$customerSession",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_STRING","Mage",489],["T_DOUBLE_COLON","::",489],["T_STRING","getSingleton",489],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",489],")",";",["T_WHITESPACE","\n\n        ",489],["T_IF","if",491],["T_WHITESPACE"," ",491],"(",["T_STRING","Mage",491],["T_DOUBLE_COLON","::",491],["T_STRING","helper",491],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",491],")",["T_OBJECT_OPERATOR","->",491],["T_STRING","isEnabled",491],"(",")",["T_WHITESPACE","\n            ",491],["T_BOOLEAN_AND","&&",492],["T_WHITESPACE"," ",492],"!",["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","_isPersistent",492],"(",")",["T_WHITESPACE","\n            ",492],["T_BOOLEAN_AND","&&",493],["T_WHITESPACE"," ",493],"!",["T_VARIABLE","$customerSession",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","isLoggedIn",493],"(",")",["T_WHITESPACE","\n            ",493],["T_BOOLEAN_AND","&&",494],["T_WHITESPACE"," ",494],["T_STRING","Mage",494],["T_DOUBLE_COLON","::",494],["T_STRING","getSingleton",494],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",494],")",["T_OBJECT_OPERATOR","->",494],["T_STRING","getQuoteId",494],"(",")",["T_WHITESPACE","\n            ",494],["T_BOOLEAN_AND","&&",495],["T_WHITESPACE"," ",495],"!","(",["T_VARIABLE","$observer",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getControllerAction",495],"(",")",["T_WHITESPACE"," ",495],["T_INSTANCEOF","instanceof",495],["T_WHITESPACE"," ",495],["T_STRING","Mage_Checkout_OnepageController",495],")",["T_WHITESPACE","\n            ",495],["T_COMMENT","\/\/ persistent session does not expire on onepage checkout page to not spoil customer group id\n",496],["T_WHITESPACE","        ",497],")",["T_WHITESPACE"," ",497],"{",["T_WHITESPACE","\n            ",497],["T_STRING","Mage",498],["T_DOUBLE_COLON","::",498],["T_STRING","dispatchEvent",498],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent_session_expired'",498],")",";",["T_WHITESPACE","\n            ",498],["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","_expirePersistentSession",499],"(",")",";",["T_WHITESPACE","\n            ",499],["T_VARIABLE","$customerSession",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","setCustomerId",500],"(",["T_STRING","null",500],")",["T_OBJECT_OPERATOR","->",500],["T_STRING","setCustomerGroupId",500],"(",["T_STRING","null",500],")",";",["T_WHITESPACE","\n        ",500],"}",["T_WHITESPACE","\n    ",501],"}",["T_WHITESPACE","\n    ",502],["T_DOC_COMMENT","\/**\n     * Active Persistent Sessions\n     *\/",503],["T_WHITESPACE","\n    ",505],["T_PROTECTED","protected",506],["T_WHITESPACE"," ",506],["T_FUNCTION","function",506],["T_WHITESPACE"," ",506],["T_STRING","_expirePersistentSession",506],"(",")",["T_WHITESPACE","\n    ",506],"{",["T_WHITESPACE","\n        ",507],["T_DOC_COMMENT","\/** @var $checkoutSession Mage_Checkout_Model_Session *\/",508],["T_WHITESPACE","\n        ",508],["T_VARIABLE","$checkoutSession",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_STRING","Mage",509],["T_DOUBLE_COLON","::",509],["T_STRING","getSingleton",509],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",509],")",";",["T_WHITESPACE","\n\n        ",509],["T_VARIABLE","$quote",511],["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_VARIABLE","$checkoutSession",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","setLoadInactive",511],"(",")",["T_OBJECT_OPERATOR","->",511],["T_STRING","getQuote",511],"(",")",";",["T_WHITESPACE","\n        ",511],["T_IF","if",512],["T_WHITESPACE"," ",512],"(",["T_VARIABLE","$quote",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getIsActive",512],"(",")",["T_WHITESPACE"," ",512],["T_BOOLEAN_AND","&&",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$quote",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getCustomerId",512],"(",")",")",["T_WHITESPACE"," ",512],"{",["T_WHITESPACE","\n            ",512],["T_VARIABLE","$checkoutSession",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","setCustomer",513],"(",["T_STRING","null",513],")",["T_OBJECT_OPERATOR","->",513],["T_STRING","unsetAll",513],"(",")",";",["T_WHITESPACE","\n        ",513],"}",["T_WHITESPACE"," ",514],["T_ELSE","else",514],["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n            ",514],["T_VARIABLE","$quote",515],["T_WHITESPACE","\n                ",515],["T_OBJECT_OPERATOR","->",516],["T_STRING","setIsActive",516],"(",["T_STRING","true",516],")",["T_WHITESPACE","\n                ",516],["T_OBJECT_OPERATOR","->",517],["T_STRING","setIsPersistent",517],"(",["T_STRING","false",517],")",["T_WHITESPACE","\n                ",517],["T_OBJECT_OPERATOR","->",518],["T_STRING","setCustomerId",518],"(",["T_STRING","null",518],")",["T_WHITESPACE","\n                ",518],["T_OBJECT_OPERATOR","->",519],["T_STRING","setCustomerGroupId",519],"(",["T_STRING","Mage_Customer_Model_Group",519],["T_DOUBLE_COLON","::",519],["T_STRING","NOT_LOGGED_IN_ID",519],")",";",["T_WHITESPACE","\n        ",519],"}",["T_WHITESPACE","\n    ",520],"}",["T_WHITESPACE","\n\n    ",521],["T_DOC_COMMENT","\/**\n     * Clear expired persistent sessions\n     *\n     * @param Mage_Cron_Model_Schedule $schedule\n     * @return Mage_Persistent_Model_Observer_Cron\n     *\/",523],["T_WHITESPACE","\n    ",528],["T_PUBLIC","public",529],["T_WHITESPACE"," ",529],["T_FUNCTION","function",529],["T_WHITESPACE"," ",529],["T_STRING","clearExpiredCronJob",529],"(",["T_STRING","Mage_Cron_Model_Schedule",529],["T_WHITESPACE"," ",529],["T_VARIABLE","$schedule",529],")",["T_WHITESPACE","\n    ",529],"{",["T_WHITESPACE","\n        ",530],["T_VARIABLE","$websiteIds",531],["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_STRING","Mage",531],["T_DOUBLE_COLON","::",531],["T_STRING","getResourceModel",531],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website_collection'",531],")",["T_OBJECT_OPERATOR","->",531],["T_STRING","getAllIds",531],"(",")",";",["T_WHITESPACE","\n        ",531],["T_IF","if",532],["T_WHITESPACE"," ",532],"(","!",["T_STRING","is_array",532],"(",["T_VARIABLE","$websiteIds",532],")",")",["T_WHITESPACE"," ",532],"{",["T_WHITESPACE","\n            ",532],["T_RETURN","return",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$this",533],";",["T_WHITESPACE","\n        ",533],"}",["T_WHITESPACE","\n\n        ",534],["T_FOREACH","foreach",536],["T_WHITESPACE"," ",536],"(",["T_VARIABLE","$websiteIds",536],["T_WHITESPACE"," ",536],["T_AS","as",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$websiteId",536],")",["T_WHITESPACE"," ",536],"{",["T_WHITESPACE","\n            ",536],["T_STRING","Mage",537],["T_DOUBLE_COLON","::",537],["T_STRING","getModel",537],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent\/session'",537],")",["T_OBJECT_OPERATOR","->",537],["T_STRING","deleteExpired",537],"(",["T_VARIABLE","$websiteId",537],")",";",["T_WHITESPACE","\n        ",537],"}",["T_WHITESPACE","\n\n        ",538],["T_RETURN","return",540],["T_WHITESPACE"," ",540],["T_VARIABLE","$this",540],";",["T_WHITESPACE","\n    ",540],"}",["T_WHITESPACE","\n\n    ",541],["T_DOC_COMMENT","\/**\n     * Create handle for persistent session if persistent cookie and customer not logged in\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",543],["T_WHITESPACE","\n    ",547],["T_PUBLIC","public",548],["T_WHITESPACE"," ",548],["T_FUNCTION","function",548],["T_WHITESPACE"," ",548],["T_STRING","createPersistentHandleLayout",548],"(",["T_STRING","Varien_Event_Observer",548],["T_WHITESPACE"," ",548],["T_VARIABLE","$observer",548],")",["T_WHITESPACE","\n    ",548],"{",["T_WHITESPACE","\n        ",549],["T_DOC_COMMENT","\/** @var $layout Mage_Core_Model_Layout *\/",550],["T_WHITESPACE","\n        ",550],["T_VARIABLE","$layout",551],["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_VARIABLE","$observer",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","getEvent",551],"(",")",["T_OBJECT_OPERATOR","->",551],["T_STRING","getLayout",551],"(",")",";",["T_WHITESPACE","\n        ",551],["T_IF","if",552],["T_WHITESPACE"," ",552],"(",["T_STRING","Mage",552],["T_DOUBLE_COLON","::",552],["T_STRING","helper",552],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",552],")",["T_OBJECT_OPERATOR","->",552],["T_STRING","canProcess",552],"(",["T_VARIABLE","$observer",552],")",["T_WHITESPACE"," ",552],["T_BOOLEAN_AND","&&",552],["T_WHITESPACE"," ",552],["T_VARIABLE","$layout",552],["T_WHITESPACE"," ",552],["T_BOOLEAN_AND","&&",552],["T_WHITESPACE"," ",552],["T_STRING","Mage",552],["T_DOUBLE_COLON","::",552],["T_STRING","helper",552],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",552],")",["T_OBJECT_OPERATOR","->",552],["T_STRING","isEnabled",552],"(",")",["T_WHITESPACE","\n            ",552],["T_BOOLEAN_AND","&&",553],["T_WHITESPACE"," ",553],["T_STRING","Mage",553],["T_DOUBLE_COLON","::",553],["T_STRING","helper",553],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent\/session'",553],")",["T_OBJECT_OPERATOR","->",553],["T_STRING","isPersistent",553],"(",")",["T_WHITESPACE","\n        ",553],")",["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n            ",554],["T_VARIABLE","$handle",555],["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],"(",["T_STRING","Mage",555],["T_DOUBLE_COLON","::",555],["T_STRING","getSingleton",555],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",555],")",["T_OBJECT_OPERATOR","->",555],["T_STRING","isLoggedIn",555],"(",")",")",["T_WHITESPACE","\n                ",555],"?",["T_WHITESPACE"," ",556],["T_STRING","Mage_Persistent_Helper_Data",556],["T_DOUBLE_COLON","::",556],["T_STRING","LOGGED_IN_LAYOUT_HANDLE",556],["T_WHITESPACE","\n                ",556],":",["T_WHITESPACE"," ",557],["T_STRING","Mage_Persistent_Helper_Data",557],["T_DOUBLE_COLON","::",557],["T_STRING","LOGGED_OUT_LAYOUT_HANDLE",557],";",["T_WHITESPACE","\n            ",557],["T_VARIABLE","$layout",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getUpdate",558],"(",")",["T_OBJECT_OPERATOR","->",558],["T_STRING","addHandle",558],"(",["T_VARIABLE","$handle",558],")",";",["T_WHITESPACE","\n        ",558],"}",["T_WHITESPACE","\n    ",559],"}",["T_WHITESPACE","\n\n    ",560],["T_DOC_COMMENT","\/**\n     * Update customer id and customer group id if user is in persistent session\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",562],["T_WHITESPACE","\n    ",566],["T_PUBLIC","public",567],["T_WHITESPACE"," ",567],["T_FUNCTION","function",567],["T_WHITESPACE"," ",567],["T_STRING","updateCustomerCookies",567],"(",["T_STRING","Varien_Event_Observer",567],["T_WHITESPACE"," ",567],["T_VARIABLE","$observer",567],")",["T_WHITESPACE","\n    ",567],"{",["T_WHITESPACE","\n        ",568],["T_IF","if",569],["T_WHITESPACE"," ",569],"(","!",["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_isPersistent",569],"(",")",")",["T_WHITESPACE"," ",569],"{",["T_WHITESPACE","\n            ",569],["T_RETURN","return",570],";",["T_WHITESPACE","\n        ",570],"}",["T_WHITESPACE","\n\n        ",571],["T_VARIABLE","$customerCookies",573],["T_WHITESPACE"," ",573],"=",["T_WHITESPACE"," ",573],["T_VARIABLE","$observer",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","getEvent",573],"(",")",["T_OBJECT_OPERATOR","->",573],["T_STRING","getCustomerCookies",573],"(",")",";",["T_WHITESPACE","\n        ",573],["T_IF","if",574],["T_WHITESPACE"," ",574],"(",["T_VARIABLE","$customerCookies",574],["T_WHITESPACE"," ",574],["T_INSTANCEOF","instanceof",574],["T_WHITESPACE"," ",574],["T_STRING","Varien_Object",574],")",["T_WHITESPACE"," ",574],"{",["T_WHITESPACE","\n            ",574],["T_VARIABLE","$persistentCustomer",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","_getPersistentCustomer",575],"(",")",";",["T_WHITESPACE","\n            ",575],["T_VARIABLE","$customerCookies",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","setCustomerId",576],"(",["T_VARIABLE","$persistentCustomer",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","getId",576],"(",")",")",";",["T_WHITESPACE","\n            ",576],["T_VARIABLE","$customerCookies",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","setCustomerGroupId",577],"(",["T_VARIABLE","$persistentCustomer",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","getGroupId",577],"(",")",")",";",["T_WHITESPACE","\n        ",577],"}",["T_WHITESPACE","\n    ",578],"}",["T_WHITESPACE","\n\n    ",579],["T_DOC_COMMENT","\/**\n     * Set persistent data to customer session\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Persistent_Model_Observer\n     *\/",581],["T_WHITESPACE","\n    ",586],["T_PUBLIC","public",587],["T_WHITESPACE"," ",587],["T_FUNCTION","function",587],["T_WHITESPACE"," ",587],["T_STRING","emulateCustomer",587],"(",["T_VARIABLE","$observer",587],")",["T_WHITESPACE","\n    ",587],"{",["T_WHITESPACE","\n        ",588],["T_IF","if",589],["T_WHITESPACE"," ",589],"(","!",["T_STRING","Mage",589],["T_DOUBLE_COLON","::",589],["T_STRING","helper",589],"(",["T_CONSTANT_ENCAPSED_STRING","'persistent'",589],")",["T_OBJECT_OPERATOR","->",589],["T_STRING","canProcess",589],"(",["T_VARIABLE","$observer",589],")",["T_WHITESPACE","\n            ",589],["T_BOOLEAN_OR","||",590],["T_WHITESPACE"," ",590],"!",["T_VARIABLE","$this",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","_isShoppingCartPersist",590],"(",")",["T_WHITESPACE","\n        ",590],")",["T_WHITESPACE"," ",591],"{",["T_WHITESPACE","\n            ",591],["T_RETURN","return",592],["T_WHITESPACE"," ",592],["T_VARIABLE","$this",592],";",["T_WHITESPACE","\n        ",592],"}",["T_WHITESPACE","\n\n        ",593],["T_IF","if",595],["T_WHITESPACE"," ",595],"(",["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","_isLoggedOut",595],"(",")",")",["T_WHITESPACE"," ",595],"{",["T_WHITESPACE","\n            ",595],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",596],["T_WHITESPACE","\n            ",596],["T_VARIABLE","$customer",597],["T_WHITESPACE"," ",597],"=",["T_WHITESPACE"," ",597],["T_STRING","Mage",597],["T_DOUBLE_COLON","::",597],["T_STRING","getModel",597],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",597],")",["T_OBJECT_OPERATOR","->",597],["T_STRING","load",597],"(",["T_WHITESPACE","\n                ",597],["T_VARIABLE","$this",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","_getPersistentHelper",598],"(",")",["T_OBJECT_OPERATOR","->",598],["T_STRING","getSession",598],"(",")",["T_OBJECT_OPERATOR","->",598],["T_STRING","getCustomerId",598],"(",")",["T_WHITESPACE","\n            ",598],")",";",["T_WHITESPACE","\n            ",599],["T_STRING","Mage",600],["T_DOUBLE_COLON","::",600],["T_STRING","getSingleton",600],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",600],")",["T_WHITESPACE","\n                ",600],["T_OBJECT_OPERATOR","->",601],["T_STRING","setCustomerId",601],"(",["T_VARIABLE","$customer",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","getId",601],"(",")",")",["T_WHITESPACE","\n                ",601],["T_OBJECT_OPERATOR","->",602],["T_STRING","setCustomerGroupId",602],"(",["T_VARIABLE","$customer",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getGroupId",602],"(",")",")",";",["T_WHITESPACE","\n        ",602],"}",["T_WHITESPACE","\n        ",603],["T_RETURN","return",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$this",604],";",["T_WHITESPACE","\n    ",604],"}",["T_WHITESPACE","\n",605],"}",["T_WHITESPACE","\n",606]]