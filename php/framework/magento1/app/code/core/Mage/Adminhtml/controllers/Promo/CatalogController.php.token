[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Backend Catalog Price Rules controller\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Promo_CatalogController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Controller_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Dirty rules notice message\n     *\n     * @var string\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_dirtyRulesNoticeMessage",41],";",["T_WHITESPACE","\n\n    ",41],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","_initAction",43],"(",")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","loadLayout",45],"(",")",["T_WHITESPACE","\n            ",45],["T_OBJECT_OPERATOR","->",46],["T_STRING","_setActiveMenu",46],"(",["T_CONSTANT_ENCAPSED_STRING","'promo\/catalog'",46],")",["T_WHITESPACE","\n            ",46],["T_OBJECT_OPERATOR","->",47],["T_STRING","_addBreadcrumb",47],"(",["T_WHITESPACE","\n                ",47],["T_STRING","Mage",48],["T_DOUBLE_COLON","::",48],["T_STRING","helper",48],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",48],")",["T_OBJECT_OPERATOR","->",48],["T_STRING","__",48],"(",["T_CONSTANT_ENCAPSED_STRING","'Promotions'",48],")",",",["T_WHITESPACE","\n                ",48],["T_STRING","Mage",49],["T_DOUBLE_COLON","::",49],["T_STRING","helper",49],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",49],")",["T_OBJECT_OPERATOR","->",49],["T_STRING","__",49],"(",["T_CONSTANT_ENCAPSED_STRING","'Promotions'",49],")",["T_WHITESPACE","\n            ",49],")",";",["T_WHITESPACE","\n        ",50],["T_RETURN","return",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],";",["T_WHITESPACE","\n    ",51],"}",["T_WHITESPACE","\n\n    ",52],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","indexAction",54],"(",")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_title",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","__",56],"(",["T_CONSTANT_ENCAPSED_STRING","'Promotions'",56],")",")",["T_OBJECT_OPERATOR","->",56],["T_STRING","_title",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","__",56],"(",["T_CONSTANT_ENCAPSED_STRING","'Catalog Price Rules'",56],")",")",";",["T_WHITESPACE","\n\n        ",56],["T_VARIABLE","$dirtyRules",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","Mage",58],["T_DOUBLE_COLON","::",58],["T_STRING","getModel",58],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/flag'",58],")",["T_OBJECT_OPERATOR","->",58],["T_STRING","loadSelf",58],"(",")",";",["T_WHITESPACE","\n        ",58],["T_IF","if",59],["T_WHITESPACE"," ",59],"(",["T_VARIABLE","$dirtyRules",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getState",59],"(",")",")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n            ",59],["T_STRING","Mage",60],["T_DOUBLE_COLON","::",60],["T_STRING","getSingleton",60],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",60],")",["T_OBJECT_OPERATOR","->",60],["T_STRING","addNotice",60],"(",["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getDirtyRulesNoticeMessage",60],"(",")",")",";",["T_WHITESPACE","\n        ",60],"}",["T_WHITESPACE","\n\n        ",61],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","_initAction",63],"(",")",["T_WHITESPACE","\n            ",63],["T_OBJECT_OPERATOR","->",64],["T_STRING","_addBreadcrumb",64],"(",["T_WHITESPACE","\n                ",64],["T_STRING","Mage",65],["T_DOUBLE_COLON","::",65],["T_STRING","helper",65],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",65],")",["T_OBJECT_OPERATOR","->",65],["T_STRING","__",65],"(",["T_CONSTANT_ENCAPSED_STRING","'Catalog'",65],")",",",["T_WHITESPACE","\n                ",65],["T_STRING","Mage",66],["T_DOUBLE_COLON","::",66],["T_STRING","helper",66],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",66],")",["T_OBJECT_OPERATOR","->",66],["T_STRING","__",66],"(",["T_CONSTANT_ENCAPSED_STRING","'Catalog'",66],")",["T_WHITESPACE","\n            ",66],")",["T_WHITESPACE","\n            ",67],["T_OBJECT_OPERATOR","->",68],["T_STRING","renderLayout",68],"(",")",";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n\n    ",69],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","newAction",71],"(",")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_forward",73],"(",["T_CONSTANT_ENCAPSED_STRING","'edit'",73],")",";",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","editAction",76],"(",")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_title",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","__",78],"(",["T_CONSTANT_ENCAPSED_STRING","'Promotions'",78],")",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","_title",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","__",78],"(",["T_CONSTANT_ENCAPSED_STRING","'Catalog Price Rules'",78],")",")",";",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$id",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getRequest",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","getParam",80],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",80],")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$model",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","Mage",81],["T_DOUBLE_COLON","::",81],["T_STRING","getModel",81],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",81],")",";",["T_WHITESPACE","\n\n        ",81],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$id",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$model",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","load",84],"(",["T_VARIABLE","$id",84],")",";",["T_WHITESPACE","\n            ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(","!",["T_WHITESPACE"," ",85],["T_VARIABLE","$model",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getRuleId",85],"(",")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                ",85],["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","getSingleton",86],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",86],")",["T_OBJECT_OPERATOR","->",86],["T_STRING","addError",86],"(",["T_WHITESPACE","\n                    ",86],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","helper",87],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",87],")",["T_OBJECT_OPERATOR","->",87],["T_STRING","__",87],"(",["T_CONSTANT_ENCAPSED_STRING","'This rule no longer exists.'",87],")",["T_WHITESPACE","\n                ",87],")",";",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_redirect",89],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",89],")",";",["T_WHITESPACE","\n                ",89],["T_RETURN","return",90],";",["T_WHITESPACE","\n            ",90],"}",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_title",94],"(",["T_VARIABLE","$model",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getRuleId",94],"(",")",["T_WHITESPACE"," ",94],"?",["T_WHITESPACE"," ",94],["T_VARIABLE","$model",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getName",94],"(",")",["T_WHITESPACE"," ",94],":",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","__",94],"(",["T_CONSTANT_ENCAPSED_STRING","'New Rule'",94],")",")",";",["T_WHITESPACE","\n\n        ",94],["T_COMMENT","\/\/ set entered data if was error when we do save\n",96],["T_WHITESPACE","        ",97],["T_VARIABLE","$data",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","Mage",97],["T_DOUBLE_COLON","::",97],["T_STRING","getSingleton",97],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",97],")",["T_OBJECT_OPERATOR","->",97],["T_STRING","getPageData",97],"(",["T_STRING","true",97],")",";",["T_WHITESPACE","\n        ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_EMPTY","empty",98],"(",["T_VARIABLE","$data",98],")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$model",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","addData",99],"(",["T_VARIABLE","$data",99],")",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$model",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getConditions",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","setJsFormObject",101],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_conditions_fieldset'",101],")",";",["T_WHITESPACE","\n\n        ",101],["T_STRING","Mage",103],["T_DOUBLE_COLON","::",103],["T_STRING","register",103],"(",["T_CONSTANT_ENCAPSED_STRING","'current_promo_catalog_rule'",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$model",103],")",";",["T_WHITESPACE","\n\n        ",103],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_initAction",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getLayout",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getBlock",105],"(",["T_CONSTANT_ENCAPSED_STRING","'promo_catalog_edit'",105],")",["T_WHITESPACE","\n             ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","setData",106],"(",["T_CONSTANT_ENCAPSED_STRING","'action'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getUrl",106],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/promo_catalog\/save'",106],")",")",";",["T_WHITESPACE","\n\n        ",106],["T_VARIABLE","$breadcrumb",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$id",108],["T_WHITESPACE","\n            ",108],"?",["T_WHITESPACE"," ",109],["T_STRING","Mage",109],["T_DOUBLE_COLON","::",109],["T_STRING","helper",109],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",109],")",["T_OBJECT_OPERATOR","->",109],["T_STRING","__",109],"(",["T_CONSTANT_ENCAPSED_STRING","'Edit Rule'",109],")",["T_WHITESPACE","\n            ",109],":",["T_WHITESPACE"," ",110],["T_STRING","Mage",110],["T_DOUBLE_COLON","::",110],["T_STRING","helper",110],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",110],")",["T_OBJECT_OPERATOR","->",110],["T_STRING","__",110],"(",["T_CONSTANT_ENCAPSED_STRING","'New Rule'",110],")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_addBreadcrumb",111],"(",["T_VARIABLE","$breadcrumb",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$breadcrumb",111],")",["T_OBJECT_OPERATOR","->",111],["T_STRING","renderLayout",111],"(",")",";",["T_WHITESPACE","\n\n    ",111],"}",["T_WHITESPACE","\n\n    ",113],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","saveAction",115],"(",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getRequest",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getPost",117],"(",")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_TRY","try",118],["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n                ",118],["T_VARIABLE","$model",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","Mage",119],["T_DOUBLE_COLON","::",119],["T_STRING","getModel",119],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",119],")",";",["T_WHITESPACE","\n                ",119],["T_STRING","Mage",120],["T_DOUBLE_COLON","::",120],["T_STRING","dispatchEvent",120],"(",["T_WHITESPACE","\n                    ",120],["T_CONSTANT_ENCAPSED_STRING","'adminhtml_controller_catalogrule_prepare_save'",121],",",["T_WHITESPACE","\n                    ",121],["T_ARRAY","array",122],"(",["T_CONSTANT_ENCAPSED_STRING","'request'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getRequest",122],"(",")",")",["T_WHITESPACE","\n                ",122],")",";",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$data",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getRequest",124],"(",")",["T_OBJECT_OPERATOR","->",124],["T_STRING","getPost",124],"(",")",";",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$data",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_filterDates",125],"(",["T_VARIABLE","$data",125],",",["T_WHITESPACE"," ",125],["T_ARRAY","array",125],"(",["T_CONSTANT_ENCAPSED_STRING","'from_date'",125],",",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'to_date'",125],")",")",";",["T_WHITESPACE","\n                ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$id",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getRequest",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getParam",126],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                    ",126],["T_VARIABLE","$model",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","load",127],"(",["T_VARIABLE","$id",127],")",";",["T_WHITESPACE","\n                    ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$id",128],["T_WHITESPACE"," ",128],["T_IS_NOT_EQUAL","!=",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$model",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getId",128],"(",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                        ",128],["T_STRING","Mage",129],["T_DOUBLE_COLON","::",129],["T_STRING","throwException",129],"(",["T_STRING","Mage",129],["T_DOUBLE_COLON","::",129],["T_STRING","helper",129],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",129],")",["T_OBJECT_OPERATOR","->",129],["T_STRING","__",129],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong rule specified.'",129],")",")",";",["T_WHITESPACE","\n                    ",129],"}",["T_WHITESPACE","\n                ",130],"}",["T_WHITESPACE","\n\n                ",131],["T_VARIABLE","$validateResult",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$model",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","validateData",133],"(",["T_NEW","new",133],["T_WHITESPACE"," ",133],["T_STRING","Varien_Object",133],"(",["T_VARIABLE","$data",133],")",")",";",["T_WHITESPACE","\n                ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$validateResult",134],["T_WHITESPACE"," ",134],["T_IS_NOT_IDENTICAL","!==",134],["T_WHITESPACE"," ",134],["T_STRING","true",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                    ",134],["T_FOREACH","foreach",135],"(",["T_VARIABLE","$validateResult",135],["T_WHITESPACE"," ",135],["T_AS","as",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$errorMessage",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                        ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_getSession",136],"(",")",["T_OBJECT_OPERATOR","->",136],["T_STRING","addError",136],"(",["T_VARIABLE","$errorMessage",136],")",";",["T_WHITESPACE","\n                    ",136],"}",["T_WHITESPACE","\n                    ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_getSession",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","setPageData",138],"(",["T_VARIABLE","$data",138],")",";",["T_WHITESPACE","\n                    ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_redirect",139],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/edit'",139],",",["T_WHITESPACE"," ",139],["T_ARRAY","array",139],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",139],["T_DOUBLE_ARROW","=>",139],["T_VARIABLE","$model",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getId",139],"(",")",")",")",";",["T_WHITESPACE","\n                    ",139],["T_RETURN","return",140],";",["T_WHITESPACE","\n                ",140],"}",["T_WHITESPACE","\n\n                ",141],["T_VARIABLE","$data",143],"[",["T_CONSTANT_ENCAPSED_STRING","'conditions'",143],"]",["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$data",143],"[",["T_CONSTANT_ENCAPSED_STRING","'rule'",143],"]","[",["T_CONSTANT_ENCAPSED_STRING","'conditions'",143],"]",";",["T_WHITESPACE","\n                ",143],["T_UNSET","unset",144],"(",["T_VARIABLE","$data",144],"[",["T_CONSTANT_ENCAPSED_STRING","'rule'",144],"]",")",";",["T_WHITESPACE","\n\n                ",144],["T_VARIABLE","$autoApply",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","false",146],";",["T_WHITESPACE","\n                ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(","!",["T_EMPTY","empty",147],"(",["T_VARIABLE","$data",147],"[",["T_CONSTANT_ENCAPSED_STRING","'auto_apply'",147],"]",")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                    ",147],["T_VARIABLE","$autoApply",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_STRING","true",148],";",["T_WHITESPACE","\n                    ",148],["T_UNSET","unset",149],"(",["T_VARIABLE","$data",149],"[",["T_CONSTANT_ENCAPSED_STRING","'auto_apply'",149],"]",")",";",["T_WHITESPACE","\n                ",149],"}",["T_WHITESPACE","\n\n                ",150],["T_VARIABLE","$model",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","loadPost",152],"(",["T_VARIABLE","$data",152],")",";",["T_WHITESPACE","\n\n                ",152],["T_STRING","Mage",154],["T_DOUBLE_COLON","::",154],["T_STRING","getSingleton",154],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",154],")",["T_OBJECT_OPERATOR","->",154],["T_STRING","setPageData",154],"(",["T_VARIABLE","$model",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getData",154],"(",")",")",";",["T_WHITESPACE","\n\n                ",154],["T_VARIABLE","$model",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","save",156],"(",")",";",["T_WHITESPACE","\n\n                ",156],["T_STRING","Mage",158],["T_DOUBLE_COLON","::",158],["T_STRING","getSingleton",158],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",158],")",["T_OBJECT_OPERATOR","->",158],["T_STRING","addSuccess",158],"(",["T_WHITESPACE","\n                    ",158],["T_STRING","Mage",159],["T_DOUBLE_COLON","::",159],["T_STRING","helper",159],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",159],")",["T_OBJECT_OPERATOR","->",159],["T_STRING","__",159],"(",["T_CONSTANT_ENCAPSED_STRING","'The rule has been saved.'",159],")",["T_WHITESPACE","\n                ",159],")",";",["T_WHITESPACE","\n                ",160],["T_STRING","Mage",161],["T_DOUBLE_COLON","::",161],["T_STRING","getSingleton",161],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",161],")",["T_OBJECT_OPERATOR","->",161],["T_STRING","setPageData",161],"(",["T_STRING","false",161],")",";",["T_WHITESPACE","\n                ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_VARIABLE","$autoApply",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n                    ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getRequest",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","setParam",163],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",163],",",["T_WHITESPACE"," ",163],["T_VARIABLE","$model",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getId",163],"(",")",")",";",["T_WHITESPACE","\n                    ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_forward",164],"(",["T_CONSTANT_ENCAPSED_STRING","'applyRules'",164],")",";",["T_WHITESPACE","\n                ",164],"}",["T_WHITESPACE"," ",165],["T_ELSE","else",165],["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                    ",165],["T_STRING","Mage",166],["T_DOUBLE_COLON","::",166],["T_STRING","getModel",166],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/flag'",166],")",["T_OBJECT_OPERATOR","->",166],["T_STRING","loadSelf",166],"(",")",["T_WHITESPACE","\n                        ",166],["T_OBJECT_OPERATOR","->",167],["T_STRING","setState",167],"(",["T_LNUMBER","1",167],")",["T_WHITESPACE","\n                        ",167],["T_OBJECT_OPERATOR","->",168],["T_STRING","save",168],"(",")",";",["T_WHITESPACE","\n                    ",168],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getRequest",169],"(",")",["T_OBJECT_OPERATOR","->",169],["T_STRING","getParam",169],"(",["T_CONSTANT_ENCAPSED_STRING","'back'",169],")",")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n                        ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_redirect",170],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/edit'",170],",",["T_WHITESPACE"," ",170],["T_ARRAY","array",170],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$model",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getId",170],"(",")",")",")",";",["T_WHITESPACE","\n                        ",170],["T_RETURN","return",171],";",["T_WHITESPACE","\n                    ",171],"}",["T_WHITESPACE","\n                    ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_redirect",173],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",173],")",";",["T_WHITESPACE","\n                ",173],"}",["T_WHITESPACE","\n                ",174],["T_RETURN","return",175],";",["T_WHITESPACE","\n            ",175],"}",["T_WHITESPACE"," ",176],["T_CATCH","catch",176],["T_WHITESPACE"," ",176],"(",["T_STRING","Mage_Core_Exception",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$e",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_getSession",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","addError",177],"(",["T_VARIABLE","$e",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getMessage",177],"(",")",")",";",["T_WHITESPACE","\n            ",177],"}",["T_WHITESPACE"," ",178],["T_CATCH","catch",178],["T_WHITESPACE"," ",178],"(",["T_STRING","Exception",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$e",178],")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_getSession",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","addError",179],"(",["T_WHITESPACE","\n                    ",179],["T_STRING","Mage",180],["T_DOUBLE_COLON","::",180],["T_STRING","helper",180],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",180],")",["T_OBJECT_OPERATOR","->",180],["T_STRING","__",180],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while saving the rule data. Please review the log and try again.'",180],")",["T_WHITESPACE","\n                ",180],")",";",["T_WHITESPACE","\n                ",181],["T_STRING","Mage",182],["T_DOUBLE_COLON","::",182],["T_STRING","logException",182],"(",["T_VARIABLE","$e",182],")",";",["T_WHITESPACE","\n                ",182],["T_STRING","Mage",183],["T_DOUBLE_COLON","::",183],["T_STRING","getSingleton",183],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",183],")",["T_OBJECT_OPERATOR","->",183],["T_STRING","setPageData",183],"(",["T_VARIABLE","$data",183],")",";",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","_redirect",184],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/edit'",184],",",["T_WHITESPACE"," ",184],["T_ARRAY","array",184],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",184],["T_WHITESPACE"," ",184],["T_DOUBLE_ARROW","=>",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getRequest",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","getParam",184],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",184],")",")",")",";",["T_WHITESPACE","\n                ",184],["T_RETURN","return",185],";",["T_WHITESPACE","\n            ",185],"}",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_redirect",188],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",188],")",";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_PUBLIC","public",191],["T_WHITESPACE"," ",191],["T_FUNCTION","function",191],["T_WHITESPACE"," ",191],["T_STRING","deleteAction",191],"(",")",["T_WHITESPACE","\n    ",191],"{",["T_WHITESPACE","\n        ",192],["T_IF","if",193],["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$id",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getRequest",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","getParam",193],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",193],")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_TRY","try",194],["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n                ",194],["T_VARIABLE","$model",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_STRING","Mage",195],["T_DOUBLE_COLON","::",195],["T_STRING","getModel",195],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",195],")",";",["T_WHITESPACE","\n                ",195],["T_VARIABLE","$model",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","load",196],"(",["T_VARIABLE","$id",196],")",";",["T_WHITESPACE","\n                ",196],["T_VARIABLE","$model",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","delete",197],"(",")",";",["T_WHITESPACE","\n                ",197],["T_STRING","Mage",198],["T_DOUBLE_COLON","::",198],["T_STRING","getModel",198],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/flag'",198],")",["T_OBJECT_OPERATOR","->",198],["T_STRING","loadSelf",198],"(",")",["T_WHITESPACE","\n                    ",198],["T_OBJECT_OPERATOR","->",199],["T_STRING","setState",199],"(",["T_LNUMBER","1",199],")",["T_WHITESPACE","\n                    ",199],["T_OBJECT_OPERATOR","->",200],["T_STRING","save",200],"(",")",";",["T_WHITESPACE","\n                ",200],["T_STRING","Mage",201],["T_DOUBLE_COLON","::",201],["T_STRING","getSingleton",201],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",201],")",["T_OBJECT_OPERATOR","->",201],["T_STRING","addSuccess",201],"(",["T_WHITESPACE","\n                    ",201],["T_STRING","Mage",202],["T_DOUBLE_COLON","::",202],["T_STRING","helper",202],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",202],")",["T_OBJECT_OPERATOR","->",202],["T_STRING","__",202],"(",["T_CONSTANT_ENCAPSED_STRING","'The rule has been deleted.'",202],")",["T_WHITESPACE","\n                ",202],")",";",["T_WHITESPACE","\n                ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_redirect",204],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",204],")",";",["T_WHITESPACE","\n                ",204],["T_RETURN","return",205],";",["T_WHITESPACE","\n            ",205],"}",["T_WHITESPACE"," ",206],["T_CATCH","catch",206],["T_WHITESPACE"," ",206],"(",["T_STRING","Mage_Core_Exception",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$e",206],")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n                ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_getSession",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","addError",207],"(",["T_VARIABLE","$e",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getMessage",207],"(",")",")",";",["T_WHITESPACE","\n            ",207],"}",["T_WHITESPACE"," ",208],["T_CATCH","catch",208],["T_WHITESPACE"," ",208],"(",["T_STRING","Exception",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$e",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n                ",208],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_getSession",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","addError",209],"(",["T_WHITESPACE","\n                    ",209],["T_STRING","Mage",210],["T_DOUBLE_COLON","::",210],["T_STRING","helper",210],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",210],")",["T_OBJECT_OPERATOR","->",210],["T_STRING","__",210],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while deleting the rule. Please review the log and try again.'",210],")",["T_WHITESPACE","\n                ",210],")",";",["T_WHITESPACE","\n                ",211],["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","logException",212],"(",["T_VARIABLE","$e",212],")",";",["T_WHITESPACE","\n                ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_redirect",213],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/edit'",213],",",["T_WHITESPACE"," ",213],["T_ARRAY","array",213],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",213],["T_WHITESPACE"," ",213],["T_DOUBLE_ARROW","=>",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getRequest",213],"(",")",["T_OBJECT_OPERATOR","->",213],["T_STRING","getParam",213],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",213],")",")",")",";",["T_WHITESPACE","\n                ",213],["T_RETURN","return",214],";",["T_WHITESPACE","\n            ",214],"}",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n        ",216],["T_STRING","Mage",217],["T_DOUBLE_COLON","::",217],["T_STRING","getSingleton",217],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",217],")",["T_OBJECT_OPERATOR","->",217],["T_STRING","addError",217],"(",["T_WHITESPACE","\n            ",217],["T_STRING","Mage",218],["T_DOUBLE_COLON","::",218],["T_STRING","helper",218],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",218],")",["T_OBJECT_OPERATOR","->",218],["T_STRING","__",218],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to find a rule to delete.'",218],")",["T_WHITESPACE","\n        ",218],")",";",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_redirect",220],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",220],")",";",["T_WHITESPACE","\n    ",220],"}",["T_WHITESPACE","\n\n    ",221],["T_PUBLIC","public",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","newConditionHtmlAction",223],"(",")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$id",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getRequest",225],"(",")",["T_OBJECT_OPERATOR","->",225],["T_STRING","getParam",225],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",225],")",";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$typeArr",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_STRING","explode",226],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",226],",",["T_WHITESPACE"," ",226],["T_STRING","str_replace",226],"(",["T_CONSTANT_ENCAPSED_STRING","'-'",226],",",["T_WHITESPACE"," ",226],["T_CONSTANT_ENCAPSED_STRING","'\/'",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getRequest",226],"(",")",["T_OBJECT_OPERATOR","->",226],["T_STRING","getParam",226],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",226],")",")",")",";",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$type",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$typeArr",227],"[",["T_LNUMBER","0",227],"]",";",["T_WHITESPACE","\n\n        ",227],["T_VARIABLE","$model",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_STRING","Mage",229],["T_DOUBLE_COLON","::",229],["T_STRING","getModel",229],"(",["T_VARIABLE","$type",229],")",["T_WHITESPACE","\n            ",229],["T_OBJECT_OPERATOR","->",230],["T_STRING","setId",230],"(",["T_VARIABLE","$id",230],")",["T_WHITESPACE","\n            ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","setType",231],"(",["T_VARIABLE","$type",231],")",["T_WHITESPACE","\n            ",231],["T_OBJECT_OPERATOR","->",232],["T_STRING","setRule",232],"(",["T_STRING","Mage",232],["T_DOUBLE_COLON","::",232],["T_STRING","getModel",232],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",232],")",")",["T_WHITESPACE","\n            ",232],["T_OBJECT_OPERATOR","->",233],["T_STRING","setPrefix",233],"(",["T_CONSTANT_ENCAPSED_STRING","'conditions'",233],")",";",["T_WHITESPACE","\n        ",233],["T_IF","if",234],["T_WHITESPACE"," ",234],"(","!",["T_EMPTY","empty",234],"(",["T_VARIABLE","$typeArr",234],"[",["T_LNUMBER","1",234],"]",")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$model",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","setAttribute",235],"(",["T_VARIABLE","$typeArr",235],"[",["T_LNUMBER","1",235],"]",")",";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE","\n\n        ",236],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_VARIABLE","$model",238],["T_WHITESPACE"," ",238],["T_INSTANCEOF","instanceof",238],["T_WHITESPACE"," ",238],["T_STRING","Mage_Rule_Model_Condition_Abstract",238],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$model",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","setJsFormObject",239],"(",["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getRequest",239],"(",")",["T_OBJECT_OPERATOR","->",239],["T_STRING","getParam",239],"(",["T_CONSTANT_ENCAPSED_STRING","'form'",239],")",")",";",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$html",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$model",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","asHtmlRecursive",240],"(",")",";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE"," ",241],["T_ELSE","else",241],["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n            ",241],["T_VARIABLE","$html",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_CONSTANT_ENCAPSED_STRING","''",242],";",["T_WHITESPACE","\n        ",242],"}",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getResponse",244],"(",")",["T_OBJECT_OPERATOR","->",244],["T_STRING","setBody",244],"(",["T_VARIABLE","$html",244],")",";",["T_WHITESPACE","\n    ",244],"}",["T_WHITESPACE","\n\n    ",245],["T_PUBLIC","public",247],["T_WHITESPACE"," ",247],["T_FUNCTION","function",247],["T_WHITESPACE"," ",247],["T_STRING","chooserAction",247],"(",")",["T_WHITESPACE","\n    ",247],"{",["T_WHITESPACE","\n        ",248],["T_SWITCH","switch",249],["T_WHITESPACE"," ",249],"(",["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getRequest",249],"(",")",["T_OBJECT_OPERATOR","->",249],["T_STRING","getParam",249],"(",["T_CONSTANT_ENCAPSED_STRING","'attribute'",249],")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n            ",249],["T_CASE","case",250],["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","'sku'",250],":",["T_WHITESPACE","\n                ",250],["T_VARIABLE","$type",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/promo_widget_chooser_sku'",251],";",["T_WHITESPACE","\n                ",251],["T_BREAK","break",252],";",["T_WHITESPACE","\n\n            ",252],["T_CASE","case",254],["T_WHITESPACE"," ",254],["T_CONSTANT_ENCAPSED_STRING","'categories'",254],":",["T_WHITESPACE","\n                ",254],["T_VARIABLE","$type",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/promo_widget_chooser_categories'",255],";",["T_WHITESPACE","\n                ",255],["T_BREAK","break",256],";",["T_WHITESPACE","\n        ",256],"}",["T_WHITESPACE","\n        ",257],["T_IF","if",258],["T_WHITESPACE"," ",258],"(","!",["T_EMPTY","empty",258],"(",["T_VARIABLE","$type",258],")",")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_VARIABLE","$block",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getLayout",259],"(",")",["T_OBJECT_OPERATOR","->",259],["T_STRING","createBlock",259],"(",["T_VARIABLE","$type",259],")",";",["T_WHITESPACE","\n            ",259],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$block",260],")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n                ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getResponse",261],"(",")",["T_OBJECT_OPERATOR","->",261],["T_STRING","setBody",261],"(",["T_VARIABLE","$block",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","toHtml",261],"(",")",")",";",["T_WHITESPACE","\n            ",261],"}",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n    ",263],"}",["T_WHITESPACE","\n\n    ",264],["T_PUBLIC","public",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","newActionHtmlAction",266],"(",")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$id",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getRequest",268],"(",")",["T_OBJECT_OPERATOR","->",268],["T_STRING","getParam",268],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",268],")",";",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$typeArr",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","explode",269],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",269],",",["T_WHITESPACE"," ",269],["T_STRING","str_replace",269],"(",["T_CONSTANT_ENCAPSED_STRING","'-'",269],",",["T_WHITESPACE"," ",269],["T_CONSTANT_ENCAPSED_STRING","'\/'",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getRequest",269],"(",")",["T_OBJECT_OPERATOR","->",269],["T_STRING","getParam",269],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",269],")",")",")",";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$type",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$typeArr",270],"[",["T_LNUMBER","0",270],"]",";",["T_WHITESPACE","\n\n        ",270],["T_VARIABLE","$model",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_STRING","Mage",272],["T_DOUBLE_COLON","::",272],["T_STRING","getModel",272],"(",["T_VARIABLE","$type",272],")",["T_WHITESPACE","\n            ",272],["T_OBJECT_OPERATOR","->",273],["T_STRING","setId",273],"(",["T_VARIABLE","$id",273],")",["T_WHITESPACE","\n            ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","setType",274],"(",["T_VARIABLE","$type",274],")",["T_WHITESPACE","\n            ",274],["T_OBJECT_OPERATOR","->",275],["T_STRING","setRule",275],"(",["T_STRING","Mage",275],["T_DOUBLE_COLON","::",275],["T_STRING","getModel",275],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",275],")",")",["T_WHITESPACE","\n            ",275],["T_OBJECT_OPERATOR","->",276],["T_STRING","setPrefix",276],"(",["T_CONSTANT_ENCAPSED_STRING","'actions'",276],")",";",["T_WHITESPACE","\n        ",276],["T_IF","if",277],["T_WHITESPACE"," ",277],"(","!",["T_EMPTY","empty",277],"(",["T_VARIABLE","$typeArr",277],"[",["T_LNUMBER","1",277],"]",")",")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$model",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","setAttribute",278],"(",["T_VARIABLE","$typeArr",278],"[",["T_LNUMBER","1",278],"]",")",";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n\n        ",279],["T_IF","if",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$model",281],["T_WHITESPACE"," ",281],["T_INSTANCEOF","instanceof",281],["T_WHITESPACE"," ",281],["T_STRING","Mage_Rule_Model_Action_Abstract",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n            ",281],["T_VARIABLE","$model",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","setJsFormObject",282],"(",["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getRequest",282],"(",")",["T_OBJECT_OPERATOR","->",282],["T_STRING","getParam",282],"(",["T_CONSTANT_ENCAPSED_STRING","'form'",282],")",")",";",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$html",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$model",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","asHtmlRecursive",283],"(",")",";",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE"," ",284],["T_ELSE","else",284],["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$html",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_CONSTANT_ENCAPSED_STRING","''",285],";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getResponse",287],"(",")",["T_OBJECT_OPERATOR","->",287],["T_STRING","setBody",287],"(",["T_VARIABLE","$html",287],")",";",["T_WHITESPACE","\n    ",287],"}",["T_WHITESPACE","\n\n    ",288],["T_DOC_COMMENT","\/**\n     * Apply all active catalog price rules\n     *\/",290],["T_WHITESPACE","\n    ",292],["T_PUBLIC","public",293],["T_WHITESPACE"," ",293],["T_FUNCTION","function",293],["T_WHITESPACE"," ",293],["T_STRING","applyRulesAction",293],"(",")",["T_WHITESPACE","\n    ",293],"{",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$errorMessage",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_STRING","Mage",295],["T_DOUBLE_COLON","::",295],["T_STRING","helper",295],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",295],")",["T_OBJECT_OPERATOR","->",295],["T_STRING","__",295],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to apply rules.'",295],")",";",["T_WHITESPACE","\n        ",295],["T_TRY","try",296],["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n            ",296],["T_STRING","Mage",297],["T_DOUBLE_COLON","::",297],["T_STRING","getModel",297],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",297],")",["T_OBJECT_OPERATOR","->",297],["T_STRING","applyAll",297],"(",")",";",["T_WHITESPACE","\n            ",297],["T_STRING","Mage",298],["T_DOUBLE_COLON","::",298],["T_STRING","getModel",298],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/flag'",298],")",["T_OBJECT_OPERATOR","->",298],["T_STRING","loadSelf",298],"(",")",["T_WHITESPACE","\n                ",298],["T_OBJECT_OPERATOR","->",299],["T_STRING","setState",299],"(",["T_LNUMBER","0",299],")",["T_WHITESPACE","\n                ",299],["T_OBJECT_OPERATOR","->",300],["T_STRING","save",300],"(",")",";",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_getSession",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","addSuccess",301],"(",["T_STRING","Mage",301],["T_DOUBLE_COLON","::",301],["T_STRING","helper",301],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",301],")",["T_OBJECT_OPERATOR","->",301],["T_STRING","__",301],"(",["T_CONSTANT_ENCAPSED_STRING","'The rules have been applied.'",301],")",")",";",["T_WHITESPACE","\n        ",301],"}",["T_WHITESPACE"," ",302],["T_CATCH","catch",302],["T_WHITESPACE"," ",302],"(",["T_STRING","Mage_Core_Exception",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$e",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_getSession",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","addError",303],"(",["T_VARIABLE","$errorMessage",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","' '",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_VARIABLE","$e",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getMessage",303],"(",")",")",";",["T_WHITESPACE","\n        ",303],"}",["T_WHITESPACE"," ",304],["T_CATCH","catch",304],["T_WHITESPACE"," ",304],"(",["T_STRING","Exception",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$e",304],")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n            ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_getSession",305],"(",")",["T_OBJECT_OPERATOR","->",305],["T_STRING","addError",305],"(",["T_VARIABLE","$errorMessage",305],")",";",["T_WHITESPACE","\n            ",305],["T_STRING","Mage",306],["T_DOUBLE_COLON","::",306],["T_STRING","logException",306],"(",["T_VARIABLE","$e",306],")",";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_redirect",308],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",308],")",";",["T_WHITESPACE","\n    ",308],"}",["T_WHITESPACE","\n\n    ",309],["T_DOC_COMMENT","\/**\n     * @deprecated since 1.5.0.0\n     *\/",311],["T_WHITESPACE","\n    ",313],["T_PUBLIC","public",314],["T_WHITESPACE"," ",314],["T_FUNCTION","function",314],["T_WHITESPACE"," ",314],["T_STRING","addToAlersAction",314],"(",")",["T_WHITESPACE","\n    ",314],"{",["T_WHITESPACE","\n    ",315],"}",["T_WHITESPACE","\n\n    ",316],["T_PROTECTED","protected",318],["T_WHITESPACE"," ",318],["T_FUNCTION","function",318],["T_WHITESPACE"," ",318],["T_STRING","_isAllowed",318],"(",")",["T_WHITESPACE","\n    ",318],"{",["T_WHITESPACE","\n        ",319],["T_RETURN","return",320],["T_WHITESPACE"," ",320],["T_STRING","Mage",320],["T_DOUBLE_COLON","::",320],["T_STRING","getSingleton",320],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/session'",320],")",["T_OBJECT_OPERATOR","->",320],["T_STRING","isAllowed",320],"(",["T_CONSTANT_ENCAPSED_STRING","'promo\/catalog'",320],")",";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * Set dirty rules notice message\n     *\n     * @param string $dirtyRulesNoticeMessage\n     *\/",323],["T_WHITESPACE","\n    ",327],["T_PUBLIC","public",328],["T_WHITESPACE"," ",328],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","setDirtyRulesNoticeMessage",328],"(",["T_VARIABLE","$dirtyRulesNoticeMessage",328],")",["T_WHITESPACE","\n    ",328],"{",["T_WHITESPACE","\n        ",329],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_dirtyRulesNoticeMessage",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_VARIABLE","$dirtyRulesNoticeMessage",330],";",["T_WHITESPACE","\n    ",330],"}",["T_WHITESPACE","\n\n    ",331],["T_DOC_COMMENT","\/**\n     * Get dirty rules notice message\n     *\n     * @return string\n     *\/",333],["T_WHITESPACE","\n    ",337],["T_PUBLIC","public",338],["T_WHITESPACE"," ",338],["T_FUNCTION","function",338],["T_WHITESPACE"," ",338],["T_STRING","getDirtyRulesNoticeMessage",338],"(",")",["T_WHITESPACE","\n    ",338],"{",["T_WHITESPACE","\n        ",339],["T_VARIABLE","$defaultMessage",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_STRING","Mage",340],["T_DOUBLE_COLON","::",340],["T_STRING","helper",340],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",340],")",["T_OBJECT_OPERATOR","->",340],["T_STRING","__",340],"(",["T_CONSTANT_ENCAPSED_STRING","'There are rules that have been changed but were not applied. Please, click Apply Rules in order to see immediate effect in the catalog.'",340],")",";",["T_WHITESPACE","\n        ",340],["T_RETURN","return",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_dirtyRulesNoticeMessage",341],["T_WHITESPACE"," ",341],"?",["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_dirtyRulesNoticeMessage",341],["T_WHITESPACE"," ",341],":",["T_WHITESPACE"," ",341],["T_VARIABLE","$defaultMessage",341],";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n",342],"}",["T_WHITESPACE","\n",343]]