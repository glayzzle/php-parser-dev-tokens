[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Images manage controller for Cms WYSIWYG editor\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Cms_Wysiwyg_ImagesController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Controller_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Init storage\n     *\n     * @return Mage_Adminhtml_Cms_Page_Wysiwyg_ImagesController\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_initAction",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getStorage",43],"(",")",";",["T_WHITESPACE","\n        ",43],["T_RETURN","return",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$this",44],";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","indexAction",47],"(",")",["T_WHITESPACE","\n    ",47],"{",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$storeId",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_INT_CAST","(int)",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getRequest",49],"(",")",["T_OBJECT_OPERATOR","->",49],["T_STRING","getParam",49],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",49],")",";",["T_WHITESPACE","\n\n        ",49],["T_TRY","try",51],["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n            ",51],["T_STRING","Mage",52],["T_DOUBLE_COLON","::",52],["T_STRING","helper",52],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images'",52],")",["T_OBJECT_OPERATOR","->",52],["T_STRING","getCurrentPath",52],"(",")",";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE"," ",53],["T_CATCH","catch",53],["T_WHITESPACE"," ",53],"(",["T_STRING","Exception",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$e",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_getSession",54],"(",")",["T_OBJECT_OPERATOR","->",54],["T_STRING","addError",54],"(",["T_VARIABLE","$e",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getMessage",54],"(",")",")",";",["T_WHITESPACE","\n        ",54],"}",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_initAction",56],"(",")",["T_OBJECT_OPERATOR","->",56],["T_STRING","loadLayout",56],"(",["T_CONSTANT_ENCAPSED_STRING","'overlay_popup'",56],")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$block",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getLayout",57],"(",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","getBlock",57],"(",["T_CONSTANT_ENCAPSED_STRING","'wysiwyg_images.js'",57],")",";",["T_WHITESPACE","\n        ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_VARIABLE","$block",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_VARIABLE","$block",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","setStoreId",59],"(",["T_VARIABLE","$storeId",59],")",";",["T_WHITESPACE","\n        ",59],"}",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","renderLayout",61],"(",")",";",["T_WHITESPACE","\n    ",61],"}",["T_WHITESPACE","\n\n    ",62],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","treeJsonAction",64],"(",")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_TRY","try",66],["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","_initAction",67],"(",")",";",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getResponse",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","setBody",68],"(",["T_WHITESPACE","\n                ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getLayout",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","createBlock",69],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/cms_wysiwyg_images_tree'",69],")",["T_WHITESPACE","\n                    ",69],["T_OBJECT_OPERATOR","->",70],["T_STRING","getTreeJson",70],"(",")",["T_WHITESPACE","\n            ",70],")",";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE"," ",72],["T_CATCH","catch",72],["T_WHITESPACE"," ",72],"(",["T_STRING","Exception",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$e",72],")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getResponse",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","setBody",73],"(",["T_STRING","Mage",73],["T_DOUBLE_COLON","::",73],["T_STRING","helper",73],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","jsonEncode",73],"(",["T_ARRAY","array",73],"(",")",")",")",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","contentsAction",77],"(",")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_TRY","try",79],["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_initAction",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","_saveSessionCurrentPath",80],"(",")",";",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","loadLayout",81],"(",["T_CONSTANT_ENCAPSED_STRING","'empty'",81],")",";",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","renderLayout",82],"(",")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE"," ",83],["T_CATCH","catch",83],["T_WHITESPACE"," ",83],"(",["T_STRING","Exception",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$e",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$result",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_ARRAY","array",84],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_STRING","true",84],",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'message'",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$e",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getMessage",84],"(",")",")",";",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getResponse",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","setBody",85],"(",["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","helper",85],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",85],")",["T_OBJECT_OPERATOR","->",85],["T_STRING","jsonEncode",85],"(",["T_VARIABLE","$result",85],")",")",";",["T_WHITESPACE","\n        ",85],"}",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_PUBLIC","public",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","newFolderAction",89],"(",")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_TRY","try",91],["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_initAction",92],"(",")",";",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$name",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getRequest",93],"(",")",["T_OBJECT_OPERATOR","->",93],["T_STRING","getPost",93],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",93],")",";",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$path",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getStorage",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","getSession",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","getCurrentPath",94],"(",")",";",["T_WHITESPACE","\n            ",94],["T_VARIABLE","$result",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getStorage",95],"(",")",["T_OBJECT_OPERATOR","->",95],["T_STRING","createDirectory",95],"(",["T_VARIABLE","$name",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$path",95],")",";",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE"," ",96],["T_CATCH","catch",96],["T_WHITESPACE"," ",96],"(",["T_STRING","Exception",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$e",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n            ",96],["T_VARIABLE","$result",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_ARRAY","array",97],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_STRING","true",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'message'",97],["T_WHITESPACE"," ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$e",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getMessage",97],"(",")",")",";",["T_WHITESPACE","\n        ",97],"}",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getResponse",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","setBody",99],"(",["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","helper",99],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",99],")",["T_OBJECT_OPERATOR","->",99],["T_STRING","jsonEncode",99],"(",["T_VARIABLE","$result",99],")",")",";",["T_WHITESPACE","\n    ",99],"}",["T_WHITESPACE","\n\n    ",100],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","deleteFolderAction",102],"(",")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_TRY","try",104],["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$path",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getStorage",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getSession",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getCurrentPath",105],"(",")",";",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getStorage",106],"(",")",["T_OBJECT_OPERATOR","->",106],["T_STRING","deleteDirectory",106],"(",["T_VARIABLE","$path",106],")",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE"," ",107],["T_CATCH","catch",107],["T_WHITESPACE"," ",107],"(",["T_STRING","Exception",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$e",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$result",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_ARRAY","array",108],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],["T_STRING","true",108],",",["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'message'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$e",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getMessage",108],"(",")",")",";",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getResponse",109],"(",")",["T_OBJECT_OPERATOR","->",109],["T_STRING","setBody",109],"(",["T_STRING","Mage",109],["T_DOUBLE_COLON","::",109],["T_STRING","helper",109],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",109],")",["T_OBJECT_OPERATOR","->",109],["T_STRING","jsonEncode",109],"(",["T_VARIABLE","$result",109],")",")",";",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Delete file from media storage\n     *\n     * @return void\n     *\/",113],["T_WHITESPACE","\n    ",117],["T_PUBLIC","public",118],["T_WHITESPACE"," ",118],["T_FUNCTION","function",118],["T_WHITESPACE"," ",118],["T_STRING","deleteFilesAction",118],"(",")",["T_WHITESPACE","\n    ",118],"{",["T_WHITESPACE","\n        ",119],["T_TRY","try",120],["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_IF","if",121],["T_WHITESPACE"," ",121],"(","!",["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getRequest",121],"(",")",["T_OBJECT_OPERATOR","->",121],["T_STRING","isPost",121],"(",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                ",121],["T_THROW","throw",122],["T_WHITESPACE"," ",122],["T_NEW","new",122],["T_WHITESPACE"," ",122],["T_STRING","Exception",122],["T_WHITESPACE"," ",122],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong request.'",122],")",";",["T_WHITESPACE","\n            ",122],"}",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$files",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","Mage",124],["T_DOUBLE_COLON","::",124],["T_STRING","helper",124],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",124],")",["T_OBJECT_OPERATOR","->",124],["T_STRING","jsonDecode",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getRequest",124],"(",")",["T_OBJECT_OPERATOR","->",124],["T_STRING","getParam",124],"(",["T_CONSTANT_ENCAPSED_STRING","'files'",124],")",")",";",["T_WHITESPACE","\n\n            ",124],["T_DOC_COMMENT","\/** @var $helper Mage_Cms_Helper_Wysiwyg_Images *\/",126],["T_WHITESPACE","\n            ",126],["T_VARIABLE","$helper",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","helper",127],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images'",127],")",";",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$path",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getStorage",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getSession",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getCurrentPath",128],"(",")",";",["T_WHITESPACE","\n            ",128],["T_FOREACH","foreach",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$files",129],["T_WHITESPACE"," ",129],["T_AS","as",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$file",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$file",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$helper",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","idDecode",130],"(",["T_VARIABLE","$file",130],")",";",["T_WHITESPACE","\n                ",130],["T_VARIABLE","$_filePath",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","realpath",131],"(",["T_VARIABLE","$path",131],["T_WHITESPACE"," ",131],".",["T_WHITESPACE"," ",131],["T_STRING","DS",131],["T_WHITESPACE"," ",131],".",["T_WHITESPACE"," ",131],["T_VARIABLE","$file",131],")",";",["T_WHITESPACE","\n                ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_STRING","strpos",132],"(",["T_VARIABLE","$_filePath",132],",",["T_WHITESPACE"," ",132],["T_STRING","realpath",132],"(",["T_VARIABLE","$path",132],")",")",["T_WHITESPACE"," ",132],["T_IS_IDENTICAL","===",132],["T_WHITESPACE"," ",132],["T_LNUMBER","0",132],["T_WHITESPACE"," ",132],["T_BOOLEAN_AND","&&",132],["T_WHITESPACE","\n                    ",132],["T_STRING","strpos",133],"(",["T_VARIABLE","$_filePath",133],",",["T_WHITESPACE"," ",133],["T_STRING","realpath",133],"(",["T_VARIABLE","$helper",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getStorageRoot",133],"(",")",")",")",["T_WHITESPACE"," ",133],["T_IS_IDENTICAL","===",133],["T_WHITESPACE"," ",133],["T_LNUMBER","0",133],["T_WHITESPACE","\n                ",133],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                    ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getStorage",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","deleteFile",135],"(",["T_VARIABLE","$path",135],["T_WHITESPACE"," ",135],".",["T_WHITESPACE"," ",135],["T_STRING","DS",135],["T_WHITESPACE"," ",135],".",["T_WHITESPACE"," ",135],["T_VARIABLE","$file",135],")",";",["T_WHITESPACE","\n                ",135],"}",["T_WHITESPACE","\n            ",136],"}",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE"," ",138],["T_CATCH","catch",138],["T_WHITESPACE"," ",138],"(",["T_STRING","Exception",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$e",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$result",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_ARRAY","array",139],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_STRING","true",139],",",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'message'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$e",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getMessage",139],"(",")",")",";",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getResponse",140],"(",")",["T_OBJECT_OPERATOR","->",140],["T_STRING","setBody",140],"(",["T_STRING","Mage",140],["T_DOUBLE_COLON","::",140],["T_STRING","helper",140],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",140],")",["T_OBJECT_OPERATOR","->",140],["T_STRING","jsonEncode",140],"(",["T_VARIABLE","$result",140],")",")",";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Files upload processing\n     *\/",144],["T_WHITESPACE","\n    ",146],["T_PUBLIC","public",147],["T_WHITESPACE"," ",147],["T_FUNCTION","function",147],["T_WHITESPACE"," ",147],["T_STRING","uploadAction",147],"(",")",["T_WHITESPACE","\n    ",147],"{",["T_WHITESPACE","\n        ",148],["T_TRY","try",149],["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$result",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_ARRAY","array",150],"(",")",";",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_initAction",151],"(",")",";",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$targetPath",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getStorage",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","getSession",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","getCurrentPath",152],"(",")",";",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$result",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getStorage",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","uploadFile",153],"(",["T_VARIABLE","$targetPath",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getRequest",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","getParam",153],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",153],")",")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE"," ",154],["T_CATCH","catch",154],["T_WHITESPACE"," ",154],"(",["T_STRING","Exception",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$e",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$result",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_ARRAY","array",155],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$e",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getMessage",155],"(",")",",",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'errorcode'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$e",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getCode",155],"(",")",")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getResponse",157],"(",")",["T_OBJECT_OPERATOR","->",157],["T_STRING","setBody",157],"(",["T_STRING","Mage",157],["T_DOUBLE_COLON","::",157],["T_STRING","helper",157],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",157],")",["T_OBJECT_OPERATOR","->",157],["T_STRING","jsonEncode",157],"(",["T_VARIABLE","$result",157],")",")",";",["T_WHITESPACE","\n\n    ",157],"}",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * Fire when select image\n     *\/",161],["T_WHITESPACE","\n    ",163],["T_PUBLIC","public",164],["T_WHITESPACE"," ",164],["T_FUNCTION","function",164],["T_WHITESPACE"," ",164],["T_STRING","onInsertAction",164],"(",")",["T_WHITESPACE","\n    ",164],"{",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$helper",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_STRING","Mage",166],["T_DOUBLE_COLON","::",166],["T_STRING","helper",166],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images'",166],")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$storeId",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getRequest",167],"(",")",["T_OBJECT_OPERATOR","->",167],["T_STRING","getParam",167],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",167],")",";",["T_WHITESPACE","\n\n        ",167],["T_VARIABLE","$filename",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getRequest",169],"(",")",["T_OBJECT_OPERATOR","->",169],["T_STRING","getParam",169],"(",["T_CONSTANT_ENCAPSED_STRING","'filename'",169],")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$filename",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$helper",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","idDecode",170],"(",["T_VARIABLE","$filename",170],")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$asIs",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getRequest",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","getParam",171],"(",["T_CONSTANT_ENCAPSED_STRING","'as_is'",171],")",";",["T_WHITESPACE","\n\n        ",171],["T_STRING","Mage",173],["T_DOUBLE_COLON","::",173],["T_STRING","helper",173],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog'",173],")",["T_OBJECT_OPERATOR","->",173],["T_STRING","setStoreId",173],"(",["T_VARIABLE","$storeId",173],")",";",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$helper",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","setStoreId",174],"(",["T_VARIABLE","$storeId",174],")",";",["T_WHITESPACE","\n\n        ",174],["T_VARIABLE","$image",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$helper",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getImageHtmlDeclaration",176],"(",["T_VARIABLE","$filename",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$asIs",176],")",";",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getResponse",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","setBody",177],"(",["T_VARIABLE","$image",177],")",";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n\n    ",178],["T_DOC_COMMENT","\/**\n     * Generate image thumbnail on the fly\n     *\/",180],["T_WHITESPACE","\n    ",182],["T_PUBLIC","public",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","thumbnailAction",183],"(",")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$file",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getRequest",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","getParam",185],"(",["T_CONSTANT_ENCAPSED_STRING","'file'",185],")",";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$file",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","Mage",186],["T_DOUBLE_COLON","::",186],["T_STRING","helper",186],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images'",186],")",["T_OBJECT_OPERATOR","->",186],["T_STRING","idDecode",186],"(",["T_VARIABLE","$file",186],")",";",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$thumb",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getStorage",187],"(",")",["T_OBJECT_OPERATOR","->",187],["T_STRING","resizeOnTheFly",187],"(",["T_VARIABLE","$file",187],")",";",["T_WHITESPACE","\n        ",187],["T_IF","if",188],["T_WHITESPACE"," ",188],"(",["T_VARIABLE","$thumb",188],["T_WHITESPACE"," ",188],["T_IS_NOT_IDENTICAL","!==",188],["T_WHITESPACE"," ",188],["T_STRING","false",188],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$image",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_STRING","Varien_Image_Adapter",189],["T_DOUBLE_COLON","::",189],["T_STRING","factory",189],"(",["T_CONSTANT_ENCAPSED_STRING","'GD2'",189],")",";",["T_WHITESPACE","\n            ",189],["T_VARIABLE","$image",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","open",190],"(",["T_VARIABLE","$thumb",190],")",";",["T_WHITESPACE","\n            ",190],["T_STRING","ob_start",191],"(",")",";",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$image",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","display",192],"(",")",";",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getResponse",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","setBody",193],"(",["T_STRING","ob_get_contents",193],"(",")",")",";",["T_WHITESPACE","\n            ",193],["T_STRING","ob_end_clean",194],"(",")",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE"," ",195],["T_ELSE","else",195],["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_COMMENT","\/\/ todo: genearte some placeholder\n",196],["T_WHITESPACE","        ",197],"}",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n\n    ",198],["T_DOC_COMMENT","\/**\n     * Register storage model and return it\n     *\n     * @return Mage_Cms_Model_Wysiwyg_Images_Storage\n     *\/",200],["T_WHITESPACE","\n    ",204],["T_PUBLIC","public",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","getStorage",205],"(",")",["T_WHITESPACE","\n    ",205],"{",["T_WHITESPACE","\n        ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(","!",["T_STRING","Mage",207],["T_DOUBLE_COLON","::",207],["T_STRING","registry",207],"(",["T_CONSTANT_ENCAPSED_STRING","'storage'",207],")",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$storage",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_STRING","Mage",208],["T_DOUBLE_COLON","::",208],["T_STRING","getModel",208],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images_storage'",208],")",";",["T_WHITESPACE","\n            ",208],["T_STRING","Mage",209],["T_DOUBLE_COLON","::",209],["T_STRING","register",209],"(",["T_CONSTANT_ENCAPSED_STRING","'storage'",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$storage",209],")",";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n        ",210],["T_RETURN","return",211],["T_WHITESPACE"," ",211],["T_STRING","Mage",211],["T_DOUBLE_COLON","::",211],["T_STRING","registry",211],"(",["T_CONSTANT_ENCAPSED_STRING","'storage'",211],")",";",["T_WHITESPACE","\n    ",211],"}",["T_WHITESPACE","\n\n    ",212],["T_DOC_COMMENT","\/**\n     * Save current path in session\n     *\n     * @return Mage_Adminhtml_Cms_Page_Wysiwyg_ImagesController\n     *\/",214],["T_WHITESPACE","\n    ",218],["T_PROTECTED","protected",219],["T_WHITESPACE"," ",219],["T_FUNCTION","function",219],["T_WHITESPACE"," ",219],["T_STRING","_saveSessionCurrentPath",219],"(",")",["T_WHITESPACE","\n    ",219],"{",["T_WHITESPACE","\n        ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getStorage",221],"(",")",["T_WHITESPACE","\n            ",221],["T_OBJECT_OPERATOR","->",222],["T_STRING","getSession",222],"(",")",["T_WHITESPACE","\n            ",222],["T_OBJECT_OPERATOR","->",223],["T_STRING","setCurrentPath",223],"(",["T_STRING","Mage",223],["T_DOUBLE_COLON","::",223],["T_STRING","helper",223],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images'",223],")",["T_OBJECT_OPERATOR","->",223],["T_STRING","getCurrentPath",223],"(",")",")",";",["T_WHITESPACE","\n        ",223],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$this",224],";",["T_WHITESPACE","\n    ",224],"}",["T_WHITESPACE","\n\n    ",225],["T_DOC_COMMENT","\/**\n     * Check current user permission on resource and privilege\n     *\n     * @return bool\n     *\/",227],["T_WHITESPACE","\n    ",231],["T_PROTECTED","protected",232],["T_WHITESPACE"," ",232],["T_FUNCTION","function",232],["T_WHITESPACE"," ",232],["T_STRING","_isAllowed",232],"(",")",["T_WHITESPACE","\n    ",232],"{",["T_WHITESPACE","\n        ",233],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_STRING","Mage",234],["T_DOUBLE_COLON","::",234],["T_STRING","getSingleton",234],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/session'",234],")",["T_OBJECT_OPERATOR","->",234],["T_STRING","isAllowed",234],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/media_gallery'",234],")",";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n",235],"}",["T_WHITESPACE","\n",236]]