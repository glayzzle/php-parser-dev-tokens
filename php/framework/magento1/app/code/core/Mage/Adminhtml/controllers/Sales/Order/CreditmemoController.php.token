[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Adminhtml sales order creditmemo controller\n *\n * @category   Mage\n * @package    Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Sales_Order_CreditmemoController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Controller_Sales_Creditmemo",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Get requested items qtys and return to stock flags\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","_getItemData",39],"(",")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$data",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getRequest",41],"(",")",["T_OBJECT_OPERATOR","->",41],["T_STRING","getParam",41],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",41],")",";",["T_WHITESPACE","\n        ",41],["T_IF","if",42],["T_WHITESPACE"," ",42],"(","!",["T_VARIABLE","$data",42],")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n            ",42],["T_VARIABLE","$data",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","Mage",43],["T_DOUBLE_COLON","::",43],["T_STRING","getSingleton",43],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",43],")",["T_OBJECT_OPERATOR","->",43],["T_STRING","getFormData",43],"(",["T_STRING","true",43],")",";",["T_WHITESPACE","\n        ",43],"}",["T_WHITESPACE","\n\n        ",44],["T_IF","if",46],["T_WHITESPACE"," ",46],"(",["T_ISSET","isset",46],"(",["T_VARIABLE","$data",46],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",46],"]",")",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n            ",46],["T_VARIABLE","$qtys",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$data",47],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",47],"]",";",["T_WHITESPACE","\n        ",47],"}",["T_WHITESPACE"," ",48],["T_ELSE","else",48],["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n            ",48],["T_VARIABLE","$qtys",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_ARRAY","array",49],"(",")",";",["T_WHITESPACE","\n        ",49],"}",["T_WHITESPACE","\n        ",50],["T_RETURN","return",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$qtys",51],";",["T_WHITESPACE","\n    ",51],"}",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Check if creditmeno can be created for order\n     * @param Mage_Sales_Model_Order $order\n     * @return bool\n     *\/",54],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_FUNCTION","function",59],["T_WHITESPACE"," ",59],["T_STRING","_canCreditmemo",59],"(",["T_VARIABLE","$order",59],")",["T_WHITESPACE","\n    ",59],"{",["T_WHITESPACE","\n        ",60],["T_DOC_COMMENT","\/**\n         * Check order existing\n         *\/",61],["T_WHITESPACE","\n        ",63],["T_IF","if",64],["T_WHITESPACE"," ",64],"(","!",["T_VARIABLE","$order",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getId",64],"(",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","_getSession",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","addError",65],"(",["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","__",65],"(",["T_CONSTANT_ENCAPSED_STRING","'The order no longer exists.'",65],")",")",";",["T_WHITESPACE","\n            ",65],["T_RETURN","return",66],["T_WHITESPACE"," ",66],["T_STRING","false",66],";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE","\n\n        ",67],["T_DOC_COMMENT","\/**\n         * Check creditmemo create availability\n         *\/",69],["T_WHITESPACE","\n        ",71],["T_IF","if",72],["T_WHITESPACE"," ",72],"(","!",["T_VARIABLE","$order",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","canCreditmemo",72],"(",")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_getSession",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","addError",73],"(",["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","__",73],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot create credit memo for the order.'",73],")",")",";",["T_WHITESPACE","\n            ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_STRING","false",74],";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n        ",75],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_STRING","true",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Initialize requested invoice instance\n     * @param unknown_type $order\n     *\/",79],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","_initInvoice",83],"(",["T_VARIABLE","$order",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$invoiceId",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getRequest",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","getParam",85],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice_id'",85],")",";",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$invoiceId",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$invoice",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","getModel",87],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice'",87],")",["T_WHITESPACE","\n                ",87],["T_OBJECT_OPERATOR","->",88],["T_STRING","load",88],"(",["T_VARIABLE","$invoiceId",88],")",["T_WHITESPACE","\n                ",88],["T_OBJECT_OPERATOR","->",89],["T_STRING","setOrder",89],"(",["T_VARIABLE","$order",89],")",";",["T_WHITESPACE","\n            ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$invoice",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getId",90],"(",")",")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n                ",90],["T_RETURN","return",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$invoice",91],";",["T_WHITESPACE","\n            ",91],"}",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n        ",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_STRING","false",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Initialize creditmemo model instance\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",97],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","_initCreditmemo",102],"(",["T_VARIABLE","$update",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","false",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_title",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","__",104],"(",["T_CONSTANT_ENCAPSED_STRING","'Sales'",104],")",")",["T_OBJECT_OPERATOR","->",104],["T_STRING","_title",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","__",104],"(",["T_CONSTANT_ENCAPSED_STRING","'Credit Memos'",104],")",")",";",["T_WHITESPACE","\n\n        ",104],["T_VARIABLE","$creditmemo",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","false",106],";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$creditmemoId",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getRequest",107],"(",")",["T_OBJECT_OPERATOR","->",107],["T_STRING","getParam",107],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",107],")",";",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$orderId",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getRequest",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","getParam",108],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",108],")",";",["T_WHITESPACE","\n        ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$creditmemoId",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$creditmemo",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_STRING","Mage",110],["T_DOUBLE_COLON","::",110],["T_STRING","getModel",110],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo'",110],")",["T_OBJECT_OPERATOR","->",110],["T_STRING","load",110],"(",["T_VARIABLE","$creditmemoId",110],")",";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE"," ",111],["T_ELSEIF","elseif",111],["T_WHITESPACE"," ",111],"(",["T_VARIABLE","$orderId",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$data",112],["T_WHITESPACE","   ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getRequest",112],"(",")",["T_OBJECT_OPERATOR","->",112],["T_STRING","getParam",112],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",112],")",";",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$order",113],["T_WHITESPACE","  ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","Mage",113],["T_DOUBLE_COLON","::",113],["T_STRING","getModel",113],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",113],")",["T_OBJECT_OPERATOR","->",113],["T_STRING","load",113],"(",["T_VARIABLE","$orderId",113],")",";",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$invoice",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_initInvoice",114],"(",["T_VARIABLE","$order",114],")",";",["T_WHITESPACE","\n\n            ",114],["T_IF","if",116],["T_WHITESPACE"," ",116],"(","!",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_canCreditmemo",116],"(",["T_VARIABLE","$order",116],")",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n                ",116],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_STRING","false",117],";",["T_WHITESPACE","\n            ",117],"}",["T_WHITESPACE","\n\n            ",118],["T_VARIABLE","$savedData",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_getItemData",120],"(",")",";",["T_WHITESPACE","\n\n            ",120],["T_VARIABLE","$qtys",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_ARRAY","array",122],"(",")",";",["T_WHITESPACE","\n            ",122],["T_VARIABLE","$backToStock",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_ARRAY","array",123],"(",")",";",["T_WHITESPACE","\n            ",123],["T_FOREACH","foreach",124],["T_WHITESPACE"," ",124],"(",["T_VARIABLE","$savedData",124],["T_WHITESPACE"," ",124],["T_AS","as",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$orderItemId",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_VARIABLE","$itemData",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_ISSET","isset",125],"(",["T_VARIABLE","$itemData",125],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",125],"]",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n                    ",125],["T_VARIABLE","$qtys",126],"[",["T_VARIABLE","$orderItemId",126],"]",["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$itemData",126],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",126],"]",";",["T_WHITESPACE","\n                ",126],"}",["T_WHITESPACE","\n                ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_ISSET","isset",128],"(",["T_VARIABLE","$itemData",128],"[",["T_CONSTANT_ENCAPSED_STRING","'back_to_stock'",128],"]",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                    ",128],["T_VARIABLE","$backToStock",129],"[",["T_VARIABLE","$orderItemId",129],"]",["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_STRING","true",129],";",["T_WHITESPACE","\n                ",129],"}",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$data",132],"[",["T_CONSTANT_ENCAPSED_STRING","'qtys'",132],"]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$qtys",132],";",["T_WHITESPACE","\n\n            ",132],["T_VARIABLE","$service",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_STRING","Mage",134],["T_DOUBLE_COLON","::",134],["T_STRING","getModel",134],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_order'",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$order",134],")",";",["T_WHITESPACE","\n            ",134],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$invoice",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                ",135],["T_VARIABLE","$creditmemo",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$service",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","prepareInvoiceCreditmemo",136],"(",["T_VARIABLE","$invoice",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$data",136],")",";",["T_WHITESPACE","\n            ",136],"}",["T_WHITESPACE"," ",137],["T_ELSE","else",137],["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n                ",137],["T_VARIABLE","$creditmemo",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$service",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","prepareCreditmemo",138],"(",["T_VARIABLE","$data",138],")",";",["T_WHITESPACE","\n            ",138],"}",["T_WHITESPACE","\n\n            ",139],["T_DOC_COMMENT","\/**\n             * Process back to stock flags\n             *\/",141],["T_WHITESPACE","\n            ",143],["T_FOREACH","foreach",144],["T_WHITESPACE"," ",144],"(",["T_VARIABLE","$creditmemo",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getAllItems",144],"(",")",["T_WHITESPACE"," ",144],["T_AS","as",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$creditmemoItem",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$orderItem",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$creditmemoItem",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getOrderItem",145],"(",")",";",["T_WHITESPACE","\n                ",145],["T_VARIABLE","$parentId",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$orderItem",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getParentItemId",146],"(",")",";",["T_WHITESPACE","\n                ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_ISSET","isset",147],"(",["T_VARIABLE","$backToStock",147],"[",["T_VARIABLE","$orderItem",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getId",147],"(",")","]",")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                    ",147],["T_VARIABLE","$creditmemoItem",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","setBackToStock",148],"(",["T_STRING","true",148],")",";",["T_WHITESPACE","\n                ",148],"}",["T_WHITESPACE"," ",149],["T_ELSEIF","elseif",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$orderItem",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getParentItem",149],"(",")",["T_WHITESPACE"," ",149],["T_BOOLEAN_AND","&&",149],["T_WHITESPACE"," ",149],["T_ISSET","isset",149],"(",["T_VARIABLE","$backToStock",149],"[",["T_VARIABLE","$parentId",149],"]",")",["T_WHITESPACE"," ",149],["T_BOOLEAN_AND","&&",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$backToStock",149],"[",["T_VARIABLE","$parentId",149],"]",")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n                    ",149],["T_VARIABLE","$creditmemoItem",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","setBackToStock",150],"(",["T_STRING","true",150],")",";",["T_WHITESPACE","\n                ",150],"}",["T_WHITESPACE"," ",151],["T_ELSEIF","elseif",151],["T_WHITESPACE"," ",151],"(",["T_EMPTY","empty",151],"(",["T_VARIABLE","$savedData",151],")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                    ",151],["T_VARIABLE","$creditmemoItem",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","setBackToStock",152],"(",["T_STRING","Mage",152],["T_DOUBLE_COLON","::",152],["T_STRING","helper",152],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",152],")",["T_OBJECT_OPERATOR","->",152],["T_STRING","isAutoReturnEnabled",152],"(",")",")",";",["T_WHITESPACE","\n                ",152],"}",["T_WHITESPACE"," ",153],["T_ELSE","else",153],["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                    ",153],["T_VARIABLE","$creditmemoItem",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","setBackToStock",154],"(",["T_STRING","false",154],")",";",["T_WHITESPACE","\n                ",154],"}",["T_WHITESPACE","\n            ",155],"}",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE","\n\n        ",157],["T_VARIABLE","$args",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_ARRAY","array",159],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",159],["T_WHITESPACE"," ",159],["T_DOUBLE_ARROW","=>",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$creditmemo",159],",",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'request'",159],["T_WHITESPACE"," ",159],["T_DOUBLE_ARROW","=>",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getRequest",159],"(",")",")",";",["T_WHITESPACE","\n        ",159],["T_STRING","Mage",160],["T_DOUBLE_COLON","::",160],["T_STRING","dispatchEvent",160],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml_sales_order_creditmemo_register_before'",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$args",160],")",";",["T_WHITESPACE","\n\n        ",160],["T_STRING","Mage",162],["T_DOUBLE_COLON","::",162],["T_STRING","register",162],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$creditmemo",162],")",";",["T_WHITESPACE","\n        ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$creditmemo",163],";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Save creditmemo and related order, invoice in one transaction\n     * @param Mage_Sales_Model_Order_Creditmemo $creditmemo\n     *\/",166],["T_WHITESPACE","\n    ",169],["T_PROTECTED","protected",170],["T_WHITESPACE"," ",170],["T_FUNCTION","function",170],["T_WHITESPACE"," ",170],["T_STRING","_saveCreditmemo",170],"(",["T_VARIABLE","$creditmemo",170],")",["T_WHITESPACE","\n    ",170],"{",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$transactionSave",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","Mage",172],["T_DOUBLE_COLON","::",172],["T_STRING","getModel",172],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource_transaction'",172],")",["T_WHITESPACE","\n            ",172],["T_OBJECT_OPERATOR","->",173],["T_STRING","addObject",173],"(",["T_VARIABLE","$creditmemo",173],")",["T_WHITESPACE","\n            ",173],["T_OBJECT_OPERATOR","->",174],["T_STRING","addObject",174],"(",["T_VARIABLE","$creditmemo",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getOrder",174],"(",")",")",";",["T_WHITESPACE","\n        ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_VARIABLE","$creditmemo",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getInvoice",175],"(",")",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$transactionSave",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","addObject",176],"(",["T_VARIABLE","$creditmemo",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getInvoice",176],"(",")",")",";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$transactionSave",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","save",178],"(",")",";",["T_WHITESPACE","\n\n        ",178],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n\n    ",181],["T_DOC_COMMENT","\/**\n     * creditmemo information page\n     *\/",183],["T_WHITESPACE","\n    ",185],["T_PUBLIC","public",186],["T_WHITESPACE"," ",186],["T_FUNCTION","function",186],["T_WHITESPACE"," ",186],["T_STRING","viewAction",186],"(",")",["T_WHITESPACE","\n    ",186],"{",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$creditmemo",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_initCreditmemo",188],"(",")",";",["T_WHITESPACE","\n        ",188],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_VARIABLE","$creditmemo",189],")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(",["T_VARIABLE","$creditmemo",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getInvoice",190],"(",")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_title",191],"(",["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","__",191],"(",["T_CONSTANT_ENCAPSED_STRING","\"View Memo for #%s\"",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$creditmemo",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getInvoice",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","getIncrementId",191],"(",")",")",")",";",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE"," ",192],["T_ELSE","else",192],["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n                ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_title",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","__",193],"(",["T_CONSTANT_ENCAPSED_STRING","\"View Memo\"",193],")",")",";",["T_WHITESPACE","\n            ",193],"}",["T_WHITESPACE","\n\n            ",194],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","loadLayout",196],"(",")",";",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getLayout",197],"(",")",["T_OBJECT_OPERATOR","->",197],["T_STRING","getBlock",197],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_creditmemo_view'",197],")",["T_WHITESPACE","\n                ",197],["T_OBJECT_OPERATOR","->",198],["T_STRING","updateBackButtonUrl",198],"(",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getRequest",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","getParam",198],"(",["T_CONSTANT_ENCAPSED_STRING","'come_from'",198],")",")",";",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_setActiveMenu",199],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",199],")",["T_WHITESPACE","\n                ",199],["T_OBJECT_OPERATOR","->",200],["T_STRING","renderLayout",200],"(",")",";",["T_WHITESPACE","\n        ",200],"}",["T_WHITESPACE"," ",201],["T_ELSE","else",201],["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_forward",202],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",202],")",";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n    ",203],"}",["T_WHITESPACE","\n\n    ",204],["T_DOC_COMMENT","\/**\n     * Start create creditmemo action\n     *\/",206],["T_WHITESPACE","\n    ",208],["T_PUBLIC","public",209],["T_WHITESPACE"," ",209],["T_FUNCTION","function",209],["T_WHITESPACE"," ",209],["T_STRING","startAction",209],"(",")",["T_WHITESPACE","\n    ",209],"{",["T_WHITESPACE","\n        ",210],["T_DOC_COMMENT","\/**\n         * Clear old values for creditmemo qty's\n         *\/",211],["T_WHITESPACE","\n        ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_redirect",214],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",214],",",["T_WHITESPACE"," ",214],["T_ARRAY","array",214],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",214],["T_DOUBLE_ARROW","=>",214],["T_STRING","true",214],")",")",";",["T_WHITESPACE","\n    ",214],"}",["T_WHITESPACE","\n\n    ",215],["T_DOC_COMMENT","\/**\n     * creditmemo create page\n     *\/",217],["T_WHITESPACE","\n    ",219],["T_PUBLIC","public",220],["T_WHITESPACE"," ",220],["T_FUNCTION","function",220],["T_WHITESPACE"," ",220],["T_STRING","newAction",220],"(",")",["T_WHITESPACE","\n    ",220],"{",["T_WHITESPACE","\n        ",221],["T_IF","if",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$creditmemo",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_initCreditmemo",222],"(",")",")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$creditmemo",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getInvoice",223],"(",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_title",224],"(",["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","__",224],"(",["T_CONSTANT_ENCAPSED_STRING","\"New Memo for #%s\"",224],",",["T_WHITESPACE"," ",224],["T_VARIABLE","$creditmemo",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getInvoice",224],"(",")",["T_OBJECT_OPERATOR","->",224],["T_STRING","getIncrementId",224],"(",")",")",")",";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE"," ",225],["T_ELSE","else",225],["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n                ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_title",226],"(",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","__",226],"(",["T_CONSTANT_ENCAPSED_STRING","\"New Memo\"",226],")",")",";",["T_WHITESPACE","\n            ",226],"}",["T_WHITESPACE","\n\n            ",227],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_VARIABLE","$comment",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_STRING","Mage",229],["T_DOUBLE_COLON","::",229],["T_STRING","getSingleton",229],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",229],")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getCommentText",229],"(",["T_STRING","true",229],")",")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                ",229],["T_VARIABLE","$creditmemo",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","setCommentText",230],"(",["T_VARIABLE","$comment",230],")",";",["T_WHITESPACE","\n            ",230],"}",["T_WHITESPACE","\n\n            ",231],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","loadLayout",233],"(",")",["T_WHITESPACE","\n                ",233],["T_OBJECT_OPERATOR","->",234],["T_STRING","_setActiveMenu",234],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",234],")",["T_WHITESPACE","\n                ",234],["T_OBJECT_OPERATOR","->",235],["T_STRING","renderLayout",235],"(",")",";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE"," ",236],["T_ELSE","else",236],["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_forward",237],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",237],")",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n    ",238],"}",["T_WHITESPACE","\n\n    ",239],["T_DOC_COMMENT","\/**\n     * Update items qty action\n     *\/",241],["T_WHITESPACE","\n    ",243],["T_PUBLIC","public",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","updateQtyAction",244],"(",")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_TRY","try",246],["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$creditmemo",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_initCreditmemo",247],"(",["T_STRING","true",247],")",";",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","loadLayout",248],"(",")",";",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$response",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getLayout",249],"(",")",["T_OBJECT_OPERATOR","->",249],["T_STRING","getBlock",249],"(",["T_CONSTANT_ENCAPSED_STRING","'order_items'",249],")",["T_OBJECT_OPERATOR","->",249],["T_STRING","toHtml",249],"(",")",";",["T_WHITESPACE","\n        ",249],"}",["T_WHITESPACE"," ",250],["T_CATCH","catch",250],["T_WHITESPACE"," ",250],"(",["T_STRING","Mage_Core_Exception",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$e",250],")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n            ",250],["T_VARIABLE","$response",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_ARRAY","array",251],"(",["T_WHITESPACE","\n                ",251],["T_CONSTANT_ENCAPSED_STRING","'error'",252],["T_WHITESPACE","     ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_STRING","true",252],",",["T_WHITESPACE","\n                ",252],["T_CONSTANT_ENCAPSED_STRING","'message'",253],["T_WHITESPACE","   ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$e",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getMessage",253],"(",")",["T_WHITESPACE","\n            ",253],")",";",["T_WHITESPACE","\n            ",254],["T_VARIABLE","$response",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_STRING","Mage",255],["T_DOUBLE_COLON","::",255],["T_STRING","helper",255],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",255],")",["T_OBJECT_OPERATOR","->",255],["T_STRING","jsonEncode",255],"(",["T_VARIABLE","$response",255],")",";",["T_WHITESPACE","\n        ",255],"}",["T_WHITESPACE"," ",256],["T_CATCH","catch",256],["T_WHITESPACE"," ",256],"(",["T_STRING","Exception",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$e",256],")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$response",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_ARRAY","array",257],"(",["T_WHITESPACE","\n                ",257],["T_CONSTANT_ENCAPSED_STRING","'error'",258],["T_WHITESPACE","     ",258],["T_DOUBLE_ARROW","=>",258],["T_WHITESPACE"," ",258],["T_STRING","true",258],",",["T_WHITESPACE","\n                ",258],["T_CONSTANT_ENCAPSED_STRING","'message'",259],["T_WHITESPACE","   ",259],["T_DOUBLE_ARROW","=>",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","__",259],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot update the item\\'s quantity.'",259],")",["T_WHITESPACE","\n            ",259],")",";",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$response",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_STRING","Mage",261],["T_DOUBLE_COLON","::",261],["T_STRING","helper",261],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",261],")",["T_OBJECT_OPERATOR","->",261],["T_STRING","jsonEncode",261],"(",["T_VARIABLE","$response",261],")",";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getResponse",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","setBody",263],"(",["T_VARIABLE","$response",263],")",";",["T_WHITESPACE","\n    ",263],"}",["T_WHITESPACE","\n\n    ",264],["T_DOC_COMMENT","\/**\n     * Save creditmemo\n     * We can save only new creditmemo. Existing creditmemos are not editable\n     *\/",266],["T_WHITESPACE","\n    ",269],["T_PUBLIC","public",270],["T_WHITESPACE"," ",270],["T_FUNCTION","function",270],["T_WHITESPACE"," ",270],["T_STRING","saveAction",270],"(",")",["T_WHITESPACE","\n    ",270],"{",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$data",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getRequest",272],"(",")",["T_OBJECT_OPERATOR","->",272],["T_STRING","getPost",272],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",272],")",";",["T_WHITESPACE","\n        ",272],["T_IF","if",273],["T_WHITESPACE"," ",273],"(","!",["T_EMPTY","empty",273],"(",["T_VARIABLE","$data",273],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",273],"]",")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","getSingleton",274],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",274],")",["T_OBJECT_OPERATOR","->",274],["T_STRING","setCommentText",274],"(",["T_VARIABLE","$data",274],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",274],"]",")",";",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n\n        ",275],["T_TRY","try",277],["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$creditmemo",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_initCreditmemo",278],"(",")",";",["T_WHITESPACE","\n            ",278],["T_IF","if",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$creditmemo",279],")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n                ",279],["T_IF","if",280],["T_WHITESPACE"," ",280],"(","(",["T_VARIABLE","$creditmemo",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getGrandTotal",280],"(",")",["T_WHITESPACE"," ",280],["T_IS_SMALLER_OR_EQUAL","<=",280],["T_LNUMBER","0",280],")",["T_WHITESPACE"," ",280],["T_BOOLEAN_AND","&&",280],["T_WHITESPACE"," ",280],"(","!",["T_VARIABLE","$creditmemo",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getAllowZeroGrandTotal",280],"(",")",")",")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n                    ",280],["T_STRING","Mage",281],["T_DOUBLE_COLON","::",281],["T_STRING","throwException",281],"(",["T_WHITESPACE","\n                        ",281],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","__",282],"(",["T_CONSTANT_ENCAPSED_STRING","'Credit memo\\'s total must be positive.'",282],")",["T_WHITESPACE","\n                    ",282],")",";",["T_WHITESPACE","\n                ",283],"}",["T_WHITESPACE","\n\n                ",284],["T_VARIABLE","$comment",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","''",286],";",["T_WHITESPACE","\n                ",286],["T_IF","if",287],["T_WHITESPACE"," ",287],"(","!",["T_EMPTY","empty",287],"(",["T_VARIABLE","$data",287],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",287],"]",")",")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n                    ",287],["T_VARIABLE","$creditmemo",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","addComment",288],"(",["T_WHITESPACE","\n                        ",288],["T_VARIABLE","$data",289],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",289],"]",",",["T_WHITESPACE","\n                        ",289],["T_ISSET","isset",290],"(",["T_VARIABLE","$data",290],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_customer_notify'",290],"]",")",",",["T_WHITESPACE","\n                        ",290],["T_ISSET","isset",291],"(",["T_VARIABLE","$data",291],"[",["T_CONSTANT_ENCAPSED_STRING","'is_visible_on_front'",291],"]",")",["T_WHITESPACE","\n                    ",291],")",";",["T_WHITESPACE","\n                    ",292],["T_IF","if",293],["T_WHITESPACE"," ",293],"(",["T_ISSET","isset",293],"(",["T_VARIABLE","$data",293],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_customer_notify'",293],"]",")",")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n                        ",293],["T_VARIABLE","$comment",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$data",294],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",294],"]",";",["T_WHITESPACE","\n                    ",294],"}",["T_WHITESPACE","\n                ",295],"}",["T_WHITESPACE","\n\n                ",296],["T_IF","if",298],["T_WHITESPACE"," ",298],"(",["T_ISSET","isset",298],"(",["T_VARIABLE","$data",298],"[",["T_CONSTANT_ENCAPSED_STRING","'do_refund'",298],"]",")",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n                    ",298],["T_VARIABLE","$creditmemo",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","setRefundRequested",299],"(",["T_STRING","true",299],")",";",["T_WHITESPACE","\n                ",299],"}",["T_WHITESPACE","\n                ",300],["T_IF","if",301],["T_WHITESPACE"," ",301],"(",["T_ISSET","isset",301],"(",["T_VARIABLE","$data",301],"[",["T_CONSTANT_ENCAPSED_STRING","'do_offline'",301],"]",")",")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n                    ",301],["T_VARIABLE","$creditmemo",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","setOfflineRequested",302],"(",["T_BOOL_CAST","(bool)",302],["T_INT_CAST","(int)",302],["T_VARIABLE","$data",302],"[",["T_CONSTANT_ENCAPSED_STRING","'do_offline'",302],"]",")",";",["T_WHITESPACE","\n                ",302],"}",["T_WHITESPACE","\n\n                ",303],["T_VARIABLE","$creditmemo",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","register",305],"(",")",";",["T_WHITESPACE","\n                ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(","!",["T_EMPTY","empty",306],"(",["T_VARIABLE","$data",306],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",306],"]",")",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n                    ",306],["T_VARIABLE","$creditmemo",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","setEmailSent",307],"(",["T_STRING","true",307],")",";",["T_WHITESPACE","\n                ",307],"}",["T_WHITESPACE","\n\n                ",308],["T_VARIABLE","$creditmemo",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getOrder",310],"(",")",["T_OBJECT_OPERATOR","->",310],["T_STRING","setCustomerNoteNotify",310],"(","!",["T_EMPTY","empty",310],"(",["T_VARIABLE","$data",310],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",310],"]",")",")",";",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_saveCreditmemo",311],"(",["T_VARIABLE","$creditmemo",311],")",";",["T_WHITESPACE","\n                ",311],["T_VARIABLE","$creditmemo",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","sendEmail",312],"(","!",["T_EMPTY","empty",312],"(",["T_VARIABLE","$data",312],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",312],"]",")",",",["T_WHITESPACE"," ",312],["T_VARIABLE","$comment",312],")",";",["T_WHITESPACE","\n                ",312],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_getSession",313],"(",")",["T_OBJECT_OPERATOR","->",313],["T_STRING","addSuccess",313],"(",["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","__",313],"(",["T_CONSTANT_ENCAPSED_STRING","'The credit memo has been created.'",313],")",")",";",["T_WHITESPACE","\n                ",313],["T_STRING","Mage",314],["T_DOUBLE_COLON","::",314],["T_STRING","getSingleton",314],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",314],")",["T_OBJECT_OPERATOR","->",314],["T_STRING","getCommentText",314],"(",["T_STRING","true",314],")",";",["T_WHITESPACE","\n                ",314],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_redirect",315],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order\/view'",315],",",["T_WHITESPACE"," ",315],["T_ARRAY","array",315],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",315],["T_WHITESPACE"," ",315],["T_DOUBLE_ARROW","=>",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$creditmemo",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getOrderId",315],"(",")",")",")",";",["T_WHITESPACE","\n                ",315],["T_RETURN","return",316],";",["T_WHITESPACE","\n            ",316],"}",["T_WHITESPACE"," ",317],["T_ELSE","else",317],["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n                ",317],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","_forward",318],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",318],")",";",["T_WHITESPACE","\n                ",318],["T_RETURN","return",319],";",["T_WHITESPACE","\n            ",319],"}",["T_WHITESPACE","\n        ",320],"}",["T_WHITESPACE"," ",321],["T_CATCH","catch",321],["T_WHITESPACE"," ",321],"(",["T_STRING","Mage_Core_Exception",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$e",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","_getSession",322],"(",")",["T_OBJECT_OPERATOR","->",322],["T_STRING","addError",322],"(",["T_VARIABLE","$e",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getMessage",322],"(",")",")",";",["T_WHITESPACE","\n            ",322],["T_STRING","Mage",323],["T_DOUBLE_COLON","::",323],["T_STRING","getSingleton",323],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",323],")",["T_OBJECT_OPERATOR","->",323],["T_STRING","setFormData",323],"(",["T_VARIABLE","$data",323],")",";",["T_WHITESPACE","\n        ",323],"}",["T_WHITESPACE"," ",324],["T_CATCH","catch",324],["T_WHITESPACE"," ",324],"(",["T_STRING","Exception",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$e",324],")",["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n            ",324],["T_STRING","Mage",325],["T_DOUBLE_COLON","::",325],["T_STRING","logException",325],"(",["T_VARIABLE","$e",325],")",";",["T_WHITESPACE","\n            ",325],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_getSession",326],"(",")",["T_OBJECT_OPERATOR","->",326],["T_STRING","addError",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","__",326],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot save the credit memo.'",326],")",")",";",["T_WHITESPACE","\n        ",326],"}",["T_WHITESPACE","\n        ",327],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_redirect",328],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",328],",",["T_WHITESPACE"," ",328],["T_ARRAY","array",328],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_STRING","true",328],")",")",";",["T_WHITESPACE","\n    ",328],"}",["T_WHITESPACE","\n\n    ",329],["T_DOC_COMMENT","\/**\n     * Cancel creditmemo action\n     *\/",331],["T_WHITESPACE","\n    ",333],["T_PUBLIC","public",334],["T_WHITESPACE"," ",334],["T_FUNCTION","function",334],["T_WHITESPACE"," ",334],["T_STRING","cancelAction",334],"(",")",["T_WHITESPACE","\n    ",334],"{",["T_WHITESPACE","\n        ",335],["T_VARIABLE","$creditmemo",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_initCreditmemo",336],"(",")",";",["T_WHITESPACE","\n        ",336],["T_IF","if",337],["T_WHITESPACE"," ",337],"(",["T_VARIABLE","$creditmemo",337],")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n            ",337],["T_TRY","try",338],["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$creditmemo",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","cancel",339],"(",")",";",["T_WHITESPACE","\n                ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","_saveCreditmemo",340],"(",["T_VARIABLE","$creditmemo",340],")",";",["T_WHITESPACE","\n                ",340],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_getSession",341],"(",")",["T_OBJECT_OPERATOR","->",341],["T_STRING","addSuccess",341],"(",["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","__",341],"(",["T_CONSTANT_ENCAPSED_STRING","'The credit memo has been canceled.'",341],")",")",";",["T_WHITESPACE","\n            ",341],"}",["T_WHITESPACE"," ",342],["T_CATCH","catch",342],["T_WHITESPACE"," ",342],"(",["T_STRING","Mage_Core_Exception",342],["T_WHITESPACE"," ",342],["T_VARIABLE","$e",342],")",["T_WHITESPACE"," ",342],"{",["T_WHITESPACE","\n                ",342],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_getSession",343],"(",")",["T_OBJECT_OPERATOR","->",343],["T_STRING","addError",343],"(",["T_VARIABLE","$e",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getMessage",343],"(",")",")",";",["T_WHITESPACE","\n            ",343],"}",["T_WHITESPACE"," ",344],["T_CATCH","catch",344],["T_WHITESPACE"," ",344],"(",["T_STRING","Exception",344],["T_WHITESPACE"," ",344],["T_VARIABLE","$e",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n                ",344],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_getSession",345],"(",")",["T_OBJECT_OPERATOR","->",345],["T_STRING","addError",345],"(",["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","__",345],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to cancel the credit memo.'",345],")",")",";",["T_WHITESPACE","\n            ",345],"}",["T_WHITESPACE","\n            ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_redirect",347],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",347],",",["T_WHITESPACE"," ",347],["T_ARRAY","array",347],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",347],["T_DOUBLE_ARROW","=>",347],["T_VARIABLE","$creditmemo",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getId",347],"(",")",")",")",";",["T_WHITESPACE","\n        ",347],"}",["T_WHITESPACE"," ",348],["T_ELSE","else",348],["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n            ",348],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_forward",349],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",349],")",";",["T_WHITESPACE","\n        ",349],"}",["T_WHITESPACE","\n    ",350],"}",["T_WHITESPACE","\n\n    ",351],["T_DOC_COMMENT","\/**\n     * Void creditmemo action\n     *\/",353],["T_WHITESPACE","\n    ",355],["T_PUBLIC","public",356],["T_WHITESPACE"," ",356],["T_FUNCTION","function",356],["T_WHITESPACE"," ",356],["T_STRING","voidAction",356],"(",")",["T_WHITESPACE","\n    ",356],"{",["T_WHITESPACE","\n        ",357],["T_VARIABLE","$creditmemo",358],["T_WHITESPACE"," ",358],"=",["T_WHITESPACE"," ",358],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","_initCreditmemo",358],"(",")",";",["T_WHITESPACE","\n        ",358],["T_IF","if",359],["T_WHITESPACE"," ",359],"(",["T_VARIABLE","$creditmemo",359],")",["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n            ",359],["T_TRY","try",360],["T_WHITESPACE"," ",360],"{",["T_WHITESPACE","\n                ",360],["T_VARIABLE","$creditmemo",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","void",361],"(",")",";",["T_WHITESPACE","\n                ",361],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","_saveCreditmemo",362],"(",["T_VARIABLE","$creditmemo",362],")",";",["T_WHITESPACE","\n                ",362],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","_getSession",363],"(",")",["T_OBJECT_OPERATOR","->",363],["T_STRING","addSuccess",363],"(",["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","__",363],"(",["T_CONSTANT_ENCAPSED_STRING","'The credit memo has been voided.'",363],")",")",";",["T_WHITESPACE","\n            ",363],"}",["T_WHITESPACE"," ",364],["T_CATCH","catch",364],["T_WHITESPACE"," ",364],"(",["T_STRING","Mage_Core_Exception",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$e",364],")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n                ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_getSession",365],"(",")",["T_OBJECT_OPERATOR","->",365],["T_STRING","addError",365],"(",["T_VARIABLE","$e",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getMessage",365],"(",")",")",";",["T_WHITESPACE","\n            ",365],"}",["T_WHITESPACE"," ",366],["T_CATCH","catch",366],["T_WHITESPACE"," ",366],"(",["T_STRING","Exception",366],["T_WHITESPACE"," ",366],["T_VARIABLE","$e",366],")",["T_WHITESPACE"," ",366],"{",["T_WHITESPACE","\n                ",366],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","_getSession",367],"(",")",["T_OBJECT_OPERATOR","->",367],["T_STRING","addError",367],"(",["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","__",367],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to void the credit memo.'",367],")",")",";",["T_WHITESPACE","\n            ",367],"}",["T_WHITESPACE","\n            ",368],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_redirect",369],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",369],",",["T_WHITESPACE"," ",369],["T_ARRAY","array",369],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",369],["T_DOUBLE_ARROW","=>",369],["T_VARIABLE","$creditmemo",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getId",369],"(",")",")",")",";",["T_WHITESPACE","\n        ",369],"}",["T_WHITESPACE"," ",370],["T_ELSE","else",370],["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n            ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","_forward",371],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",371],")",";",["T_WHITESPACE","\n        ",371],"}",["T_WHITESPACE","\n    ",372],"}",["T_WHITESPACE","\n\n    ",373],["T_DOC_COMMENT","\/**\n     * Add comment to creditmemo history\n     *\/",375],["T_WHITESPACE","\n    ",377],["T_PUBLIC","public",378],["T_WHITESPACE"," ",378],["T_FUNCTION","function",378],["T_WHITESPACE"," ",378],["T_STRING","addCommentAction",378],"(",")",["T_WHITESPACE","\n    ",378],"{",["T_WHITESPACE","\n        ",379],["T_TRY","try",380],["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n            ",380],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getRequest",381],"(",")",["T_OBJECT_OPERATOR","->",381],["T_STRING","setParam",381],"(",["T_WHITESPACE","\n                ",381],["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",382],",",["T_WHITESPACE","\n                ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getRequest",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","getParam",383],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",383],")",["T_WHITESPACE","\n            ",383],")",";",["T_WHITESPACE","\n            ",384],["T_VARIABLE","$data",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","getRequest",385],"(",")",["T_OBJECT_OPERATOR","->",385],["T_STRING","getPost",385],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",385],")",";",["T_WHITESPACE","\n            ",385],["T_IF","if",386],["T_WHITESPACE"," ",386],"(",["T_EMPTY","empty",386],"(",["T_VARIABLE","$data",386],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",386],"]",")",")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n                ",386],["T_STRING","Mage",387],["T_DOUBLE_COLON","::",387],["T_STRING","throwException",387],"(",["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","__",387],"(",["T_CONSTANT_ENCAPSED_STRING","'The Comment Text field cannot be empty.'",387],")",")",";",["T_WHITESPACE","\n            ",387],"}",["T_WHITESPACE","\n            ",388],["T_VARIABLE","$creditmemo",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_initCreditmemo",389],"(",")",";",["T_WHITESPACE","\n            ",389],["T_VARIABLE","$creditmemo",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","addComment",390],"(",["T_WHITESPACE","\n                ",390],["T_VARIABLE","$data",391],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",391],"]",",",["T_WHITESPACE","\n                ",391],["T_ISSET","isset",392],"(",["T_VARIABLE","$data",392],"[",["T_CONSTANT_ENCAPSED_STRING","'is_customer_notified'",392],"]",")",",",["T_WHITESPACE","\n                ",392],["T_ISSET","isset",393],"(",["T_VARIABLE","$data",393],"[",["T_CONSTANT_ENCAPSED_STRING","'is_visible_on_front'",393],"]",")",["T_WHITESPACE","\n            ",393],")",";",["T_WHITESPACE","\n            ",394],["T_VARIABLE","$creditmemo",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getCommentsCollection",395],"(",")",["T_OBJECT_OPERATOR","->",395],["T_STRING","save",395],"(",")",";",["T_WHITESPACE","\n            ",395],["T_VARIABLE","$creditmemo",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","sendUpdateEmail",396],"(","!",["T_EMPTY","empty",396],"(",["T_VARIABLE","$data",396],"[",["T_CONSTANT_ENCAPSED_STRING","'is_customer_notified'",396],"]",")",",",["T_WHITESPACE"," ",396],["T_VARIABLE","$data",396],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",396],"]",")",";",["T_WHITESPACE","\n\n            ",396],["T_VARIABLE","$this",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","loadLayout",398],"(",")",";",["T_WHITESPACE","\n            ",398],["T_VARIABLE","$response",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getLayout",399],"(",")",["T_OBJECT_OPERATOR","->",399],["T_STRING","getBlock",399],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_comments'",399],")",["T_OBJECT_OPERATOR","->",399],["T_STRING","toHtml",399],"(",")",";",["T_WHITESPACE","\n        ",399],"}",["T_WHITESPACE"," ",400],["T_CATCH","catch",400],["T_WHITESPACE"," ",400],"(",["T_STRING","Mage_Core_Exception",400],["T_WHITESPACE"," ",400],["T_VARIABLE","$e",400],")",["T_WHITESPACE"," ",400],"{",["T_WHITESPACE","\n            ",400],["T_VARIABLE","$response",401],["T_WHITESPACE"," ",401],"=",["T_WHITESPACE"," ",401],["T_ARRAY","array",401],"(",["T_WHITESPACE","\n                ",401],["T_CONSTANT_ENCAPSED_STRING","'error'",402],["T_WHITESPACE","     ",402],["T_DOUBLE_ARROW","=>",402],["T_WHITESPACE"," ",402],["T_STRING","true",402],",",["T_WHITESPACE","\n                ",402],["T_CONSTANT_ENCAPSED_STRING","'message'",403],["T_WHITESPACE","   ",403],["T_DOUBLE_ARROW","=>",403],["T_WHITESPACE"," ",403],["T_VARIABLE","$e",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getMessage",403],"(",")",["T_WHITESPACE","\n            ",403],")",";",["T_WHITESPACE","\n            ",404],["T_VARIABLE","$response",405],["T_WHITESPACE"," ",405],"=",["T_WHITESPACE"," ",405],["T_STRING","Mage",405],["T_DOUBLE_COLON","::",405],["T_STRING","helper",405],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",405],")",["T_OBJECT_OPERATOR","->",405],["T_STRING","jsonEncode",405],"(",["T_VARIABLE","$response",405],")",";",["T_WHITESPACE","\n        ",405],"}",["T_WHITESPACE"," ",406],["T_CATCH","catch",406],["T_WHITESPACE"," ",406],"(",["T_STRING","Exception",406],["T_WHITESPACE"," ",406],["T_VARIABLE","$e",406],")",["T_WHITESPACE"," ",406],"{",["T_WHITESPACE","\n            ",406],["T_VARIABLE","$response",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_ARRAY","array",407],"(",["T_WHITESPACE","\n                ",407],["T_CONSTANT_ENCAPSED_STRING","'error'",408],["T_WHITESPACE","     ",408],["T_DOUBLE_ARROW","=>",408],["T_WHITESPACE"," ",408],["T_STRING","true",408],",",["T_WHITESPACE","\n                ",408],["T_CONSTANT_ENCAPSED_STRING","'message'",409],["T_WHITESPACE","   ",409],["T_DOUBLE_ARROW","=>",409],["T_WHITESPACE"," ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","__",409],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot add new comment.'",409],")",["T_WHITESPACE","\n            ",409],")",";",["T_WHITESPACE","\n            ",410],["T_VARIABLE","$response",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_STRING","Mage",411],["T_DOUBLE_COLON","::",411],["T_STRING","helper",411],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",411],")",["T_OBJECT_OPERATOR","->",411],["T_STRING","jsonEncode",411],"(",["T_VARIABLE","$response",411],")",";",["T_WHITESPACE","\n        ",411],"}",["T_WHITESPACE","\n        ",412],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getResponse",413],"(",")",["T_OBJECT_OPERATOR","->",413],["T_STRING","setBody",413],"(",["T_VARIABLE","$response",413],")",";",["T_WHITESPACE","\n    ",413],"}",["T_WHITESPACE","\n\n    ",414],["T_DOC_COMMENT","\/**\n     * Decides if we need to create dummy invoice item or not\n     * for eaxample we don't need create dummy parent if all\n     * children are not in process\n     *\n     * @deprecated after 1.4, Mage_Sales_Model_Service_Order used\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $qtys\n     * @return bool\n     *\/",416],["T_WHITESPACE","\n    ",425],["T_PROTECTED","protected",426],["T_WHITESPACE"," ",426],["T_FUNCTION","function",426],["T_WHITESPACE"," ",426],["T_STRING","_needToAddDummy",426],"(",["T_VARIABLE","$item",426],",",["T_WHITESPACE"," ",426],["T_VARIABLE","$qtys",426],")",["T_WHITESPACE"," ",426],"{",["T_WHITESPACE","\n        ",426],["T_IF","if",427],["T_WHITESPACE"," ",427],"(",["T_VARIABLE","$item",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getHasChildren",427],"(",")",")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n            ",427],["T_FOREACH","foreach",428],["T_WHITESPACE"," ",428],"(",["T_VARIABLE","$item",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getChildrenItems",428],"(",")",["T_WHITESPACE"," ",428],["T_AS","as",428],["T_WHITESPACE"," ",428],["T_VARIABLE","$child",428],")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n                ",428],["T_IF","if",429],["T_WHITESPACE"," ",429],"(",["T_ISSET","isset",429],"(",["T_VARIABLE","$qtys",429],"[",["T_VARIABLE","$child",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getId",429],"(",")","]",")",["T_WHITESPACE","\n                    ",429],["T_BOOLEAN_AND","&&",430],["T_WHITESPACE"," ",430],["T_ISSET","isset",430],"(",["T_VARIABLE","$qtys",430],"[",["T_VARIABLE","$child",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getId",430],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",430],"]",")",["T_WHITESPACE","\n                    ",430],["T_BOOLEAN_AND","&&",431],["T_WHITESPACE"," ",431],["T_VARIABLE","$qtys",431],"[",["T_VARIABLE","$child",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getId",431],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",431],"]",["T_WHITESPACE"," ",431],">",["T_WHITESPACE"," ",431],["T_LNUMBER","0",431],")",["T_WHITESPACE","\n                ",431],"{",["T_WHITESPACE","\n                    ",432],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_STRING","true",433],";",["T_WHITESPACE","\n                ",433],"}",["T_WHITESPACE","\n            ",434],"}",["T_WHITESPACE","\n            ",435],["T_RETURN","return",436],["T_WHITESPACE"," ",436],["T_STRING","false",436],";",["T_WHITESPACE","\n        ",436],"}",["T_WHITESPACE"," ",437],["T_ELSE","else",437],["T_WHITESPACE"," ",437],["T_IF","if",437],"(",["T_VARIABLE","$item",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","getParentItem",437],"(",")",")",["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n            ",437],["T_IF","if",438],["T_WHITESPACE"," ",438],"(",["T_ISSET","isset",438],"(",["T_VARIABLE","$qtys",438],"[",["T_VARIABLE","$item",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getParentItem",438],"(",")",["T_OBJECT_OPERATOR","->",438],["T_STRING","getId",438],"(",")","]",")",["T_WHITESPACE","\n                ",438],["T_BOOLEAN_AND","&&",439],["T_WHITESPACE"," ",439],["T_ISSET","isset",439],"(",["T_VARIABLE","$qtys",439],"[",["T_VARIABLE","$item",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getParentItem",439],"(",")",["T_OBJECT_OPERATOR","->",439],["T_STRING","getId",439],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",439],"]",")",["T_WHITESPACE","\n                ",439],["T_BOOLEAN_AND","&&",440],["T_WHITESPACE"," ",440],["T_VARIABLE","$qtys",440],"[",["T_VARIABLE","$item",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getParentItem",440],"(",")",["T_OBJECT_OPERATOR","->",440],["T_STRING","getId",440],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",440],"]",["T_WHITESPACE"," ",440],">",["T_WHITESPACE"," ",440],["T_LNUMBER","0",440],")",["T_WHITESPACE","\n            ",440],"{",["T_WHITESPACE","\n                ",441],["T_RETURN","return",442],["T_WHITESPACE"," ",442],["T_STRING","true",442],";",["T_WHITESPACE","\n            ",442],"}",["T_WHITESPACE","\n            ",443],["T_RETURN","return",444],["T_WHITESPACE"," ",444],["T_STRING","false",444],";",["T_WHITESPACE","\n        ",444],"}",["T_WHITESPACE","\n    ",445],"}",["T_WHITESPACE","\n\n    ",446],["T_DOC_COMMENT","\/**\n     * Create pdf for current creditmemo\n     *\/",448],["T_WHITESPACE","\n    ",450],["T_PUBLIC","public",451],["T_WHITESPACE"," ",451],["T_FUNCTION","function",451],["T_WHITESPACE"," ",451],["T_STRING","printAction",451],"(",")",["T_WHITESPACE","\n    ",451],"{",["T_WHITESPACE","\n        ",452],["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","_initCreditmemo",453],"(",")",";",["T_WHITESPACE","\n        ",453],["T_STRING","parent",454],["T_DOUBLE_COLON","::",454],["T_STRING","printAction",454],"(",")",";",["T_WHITESPACE","\n    ",454],"}",["T_WHITESPACE","\n",455],"}",["T_WHITESPACE","\n",456]]