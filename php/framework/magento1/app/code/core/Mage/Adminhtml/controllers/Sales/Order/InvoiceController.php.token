[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Adminhtml sales order edit controller\n *\n * @category   Mage\n * @package    Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Sales_Order_InvoiceController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Controller_Sales_Invoice",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Get requested items qty's from request\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","_getItemQtys",39],"(",")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$data",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getRequest",41],"(",")",["T_OBJECT_OPERATOR","->",41],["T_STRING","getParam",41],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice'",41],")",";",["T_WHITESPACE","\n        ",41],["T_IF","if",42],["T_WHITESPACE"," ",42],"(",["T_ISSET","isset",42],"(",["T_VARIABLE","$data",42],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",42],"]",")",")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n            ",42],["T_VARIABLE","$qtys",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$data",43],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",43],"]",";",["T_WHITESPACE","\n        ",43],"}",["T_WHITESPACE"," ",44],["T_ELSE","else",44],["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n            ",44],["T_VARIABLE","$qtys",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],"(",")",";",["T_WHITESPACE","\n        ",45],"}",["T_WHITESPACE","\n        ",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$qtys",47],";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Initialize invoice model instance\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","_initInvoice",55],"(",["T_VARIABLE","$update",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","false",55],")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_title",57],"(",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","__",57],"(",["T_CONSTANT_ENCAPSED_STRING","'Sales'",57],")",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","_title",57],"(",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","__",57],"(",["T_CONSTANT_ENCAPSED_STRING","'Invoices'",57],")",")",";",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$invoice",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","false",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$itemsToInvoice",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_LNUMBER","0",60],";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$invoiceId",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getRequest",61],"(",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","getParam",61],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice_id'",61],")",";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$orderId",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getRequest",62],"(",")",["T_OBJECT_OPERATOR","->",62],["T_STRING","getParam",62],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",62],")",";",["T_WHITESPACE","\n        ",62],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$invoiceId",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$invoice",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","Mage",64],["T_DOUBLE_COLON","::",64],["T_STRING","getModel",64],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice'",64],")",["T_OBJECT_OPERATOR","->",64],["T_STRING","load",64],"(",["T_VARIABLE","$invoiceId",64],")",";",["T_WHITESPACE","\n            ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(","!",["T_VARIABLE","$invoice",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getId",65],"(",")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n                ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_getSession",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","addError",66],"(",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","__",66],"(",["T_CONSTANT_ENCAPSED_STRING","'The invoice no longer exists.'",66],")",")",";",["T_WHITESPACE","\n                ",66],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_STRING","false",67],";",["T_WHITESPACE","\n            ",67],"}",["T_WHITESPACE","\n        ",68],"}",["T_WHITESPACE"," ",69],["T_ELSEIF","elseif",69],["T_WHITESPACE"," ",69],"(",["T_VARIABLE","$orderId",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$order",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_STRING","Mage",70],["T_DOUBLE_COLON","::",70],["T_STRING","getModel",70],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",70],")",["T_OBJECT_OPERATOR","->",70],["T_STRING","load",70],"(",["T_VARIABLE","$orderId",70],")",";",["T_WHITESPACE","\n            ",70],["T_DOC_COMMENT","\/**\n             * Check order existing\n             *\/",71],["T_WHITESPACE","\n            ",73],["T_IF","if",74],["T_WHITESPACE"," ",74],"(","!",["T_VARIABLE","$order",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getId",74],"(",")",")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n                ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_getSession",75],"(",")",["T_OBJECT_OPERATOR","->",75],["T_STRING","addError",75],"(",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","__",75],"(",["T_CONSTANT_ENCAPSED_STRING","'The order no longer exists.'",75],")",")",";",["T_WHITESPACE","\n                ",75],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_STRING","false",76],";",["T_WHITESPACE","\n            ",76],"}",["T_WHITESPACE","\n            ",77],["T_DOC_COMMENT","\/**\n             * Check invoice create availability\n             *\/",78],["T_WHITESPACE","\n            ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(","!",["T_VARIABLE","$order",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","canInvoice",81],"(",")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n                ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_getSession",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","addError",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","__",82],"(",["T_CONSTANT_ENCAPSED_STRING","'The order does not allow creating an invoice.'",82],")",")",";",["T_WHITESPACE","\n                ",82],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_STRING","false",83],";",["T_WHITESPACE","\n            ",83],"}",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$savedQtys",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_getItemQtys",85],"(",")",";",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$invoice",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","getModel",86],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_order'",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$order",86],")",["T_OBJECT_OPERATOR","->",86],["T_STRING","prepareInvoice",86],"(",["T_VARIABLE","$savedQtys",86],")",";",["T_WHITESPACE","\n            ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(","!",["T_VARIABLE","$invoice",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getTotalQty",87],"(",")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n                ",87],["T_STRING","Mage",88],["T_DOUBLE_COLON","::",88],["T_STRING","throwException",88],"(",["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","__",88],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot create an invoice without products.'",88],")",")",";",["T_WHITESPACE","\n            ",88],"}",["T_WHITESPACE","\n        ",89],"}",["T_WHITESPACE","\n\n        ",90],["T_STRING","Mage",92],["T_DOUBLE_COLON","::",92],["T_STRING","register",92],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$invoice",92],")",";",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$invoice",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Save data for invoice and related order\n     *\n     * @param   Mage_Sales_Model_Order_Invoice $invoice\n     * @return  Mage_Adminhtml_Sales_Order_InvoiceController\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","_saveInvoice",102],"(",["T_VARIABLE","$invoice",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$invoice",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getOrder",104],"(",")",["T_OBJECT_OPERATOR","->",104],["T_STRING","setIsInProcess",104],"(",["T_STRING","true",104],")",";",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$transactionSave",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","getModel",105],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource_transaction'",105],")",["T_WHITESPACE","\n            ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","addObject",106],"(",["T_VARIABLE","$invoice",106],")",["T_WHITESPACE","\n            ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","addObject",107],"(",["T_VARIABLE","$invoice",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getOrder",107],"(",")",")",["T_WHITESPACE","\n            ",107],["T_OBJECT_OPERATOR","->",108],["T_STRING","save",108],"(",")",";",["T_WHITESPACE","\n\n        ",108],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Prepare shipment\n     *\n     * @param Mage_Sales_Model_Order_Invoice $invoice\n     * @return Mage_Sales_Model_Order_Shipment\n     *\/",113],["T_WHITESPACE","\n    ",118],["T_PROTECTED","protected",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","_prepareShipment",119],"(",["T_VARIABLE","$invoice",119],")",["T_WHITESPACE","\n    ",119],"{",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$savedQtys",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_getItemQtys",121],"(",")",";",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$shipment",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","Mage",122],["T_DOUBLE_COLON","::",122],["T_STRING","getModel",122],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_order'",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$invoice",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getOrder",122],"(",")",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","prepareShipment",122],"(",["T_VARIABLE","$savedQtys",122],")",";",["T_WHITESPACE","\n        ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(","!",["T_VARIABLE","$shipment",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getTotalQty",123],"(",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_STRING","false",124],";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n\n\n        ",125],["T_VARIABLE","$shipment",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","register",128],"(",")",";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$tracks",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getRequest",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","getPost",129],"(",["T_CONSTANT_ENCAPSED_STRING","'tracking'",129],")",";",["T_WHITESPACE","\n        ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$tracks",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_FOREACH","foreach",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$tracks",131],["T_WHITESPACE"," ",131],["T_AS","as",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$data",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n                ",131],["T_VARIABLE","$track",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","Mage",132],["T_DOUBLE_COLON","::",132],["T_STRING","getModel",132],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track'",132],")",["T_WHITESPACE","\n                    ",132],["T_OBJECT_OPERATOR","->",133],["T_STRING","addData",133],"(",["T_VARIABLE","$data",133],")",";",["T_WHITESPACE","\n                ",133],["T_VARIABLE","$shipment",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","addTrack",134],"(",["T_VARIABLE","$track",134],")",";",["T_WHITESPACE","\n            ",134],"}",["T_WHITESPACE","\n        ",135],"}",["T_WHITESPACE","\n        ",136],["T_RETURN","return",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$shipment",137],";",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n\n    ",138],["T_DOC_COMMENT","\/**\n     * Invoice information page\n     *\/",140],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","viewAction",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$invoice",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_initInvoice",145],"(",")",";",["T_WHITESPACE","\n        ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$invoice",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_title",147],"(",["T_STRING","sprintf",147],"(",["T_CONSTANT_ENCAPSED_STRING","\"#%s\"",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$invoice",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getIncrementId",147],"(",")",")",")",";",["T_WHITESPACE","\n\n            ",147],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","loadLayout",149],"(",")",["T_WHITESPACE","\n                ",149],["T_OBJECT_OPERATOR","->",150],["T_STRING","_setActiveMenu",150],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",150],")",";",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getLayout",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","getBlock",151],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_invoice_view'",151],")",["T_WHITESPACE","\n                ",151],["T_OBJECT_OPERATOR","->",152],["T_STRING","updateBackButtonUrl",152],"(",["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getRequest",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","getParam",152],"(",["T_CONSTANT_ENCAPSED_STRING","'come_from'",152],")",")",";",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","renderLayout",153],"(",")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n        ",154],["T_ELSE","else",155],["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_forward",156],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",156],")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * Start create invoice action\n     *\/",160],["T_WHITESPACE","\n    ",162],["T_PUBLIC","public",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","startAction",163],"(",")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_DOC_COMMENT","\/**\n         * Clear old values for invoice qty's\n         *\/",165],["T_WHITESPACE","\n        ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_getSession",168],"(",")",["T_OBJECT_OPERATOR","->",168],["T_STRING","getInvoiceItemQtys",168],"(",["T_STRING","true",168],")",";",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_redirect",169],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",169],",",["T_WHITESPACE"," ",169],["T_ARRAY","array",169],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",169],["T_DOUBLE_ARROW","=>",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getRequest",169],"(",")",["T_OBJECT_OPERATOR","->",169],["T_STRING","getParam",169],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",169],")",")",")",";",["T_WHITESPACE","\n    ",169],"}",["T_WHITESPACE","\n\n    ",170],["T_DOC_COMMENT","\/**\n     * Invoice create page\n     *\/",172],["T_WHITESPACE","\n    ",174],["T_PUBLIC","public",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","newAction",175],"(",")",["T_WHITESPACE","\n    ",175],"{",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$invoice",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_initInvoice",177],"(",")",";",["T_WHITESPACE","\n        ",177],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_VARIABLE","$invoice",178],")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_title",179],"(",["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","__",179],"(",["T_CONSTANT_ENCAPSED_STRING","'New Invoice'",179],")",")",";",["T_WHITESPACE","\n\n            ",179],["T_IF","if",181],["T_WHITESPACE"," ",181],"(",["T_VARIABLE","$comment",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_STRING","Mage",181],["T_DOUBLE_COLON","::",181],["T_STRING","getSingleton",181],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",181],")",["T_OBJECT_OPERATOR","->",181],["T_STRING","getCommentText",181],"(",["T_STRING","true",181],")",")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$invoice",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","setCommentText",182],"(",["T_VARIABLE","$comment",182],")",";",["T_WHITESPACE","\n            ",182],"}",["T_WHITESPACE","\n\n            ",183],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","loadLayout",185],"(",")",["T_WHITESPACE","\n                ",185],["T_OBJECT_OPERATOR","->",186],["T_STRING","_setActiveMenu",186],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",186],")",["T_WHITESPACE","\n                ",186],["T_OBJECT_OPERATOR","->",187],["T_STRING","renderLayout",187],"(",")",";",["T_WHITESPACE","\n        ",187],"}",["T_WHITESPACE"," ",188],["T_ELSE","else",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_redirect",189],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order\/view'",189],",",["T_WHITESPACE"," ",189],["T_ARRAY","array",189],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",189],["T_DOUBLE_ARROW","=>",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getRequest",189],"(",")",["T_OBJECT_OPERATOR","->",189],["T_STRING","getParam",189],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",189],")",")",")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n    ",190],"}",["T_WHITESPACE","\n\n    ",191],["T_DOC_COMMENT","\/**\n     * Update items qty action\n     *\/",193],["T_WHITESPACE","\n    ",195],["T_PUBLIC","public",196],["T_WHITESPACE"," ",196],["T_FUNCTION","function",196],["T_WHITESPACE"," ",196],["T_STRING","updateQtyAction",196],"(",")",["T_WHITESPACE","\n    ",196],"{",["T_WHITESPACE","\n        ",197],["T_TRY","try",198],["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$invoice",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_initInvoice",199],"(",["T_STRING","true",199],")",";",["T_WHITESPACE","\n            ",199],["T_COMMENT","\/\/ Save invoice comment text in current invoice object in order to display it in corresponding view\n",200],["T_WHITESPACE","            ",201],["T_VARIABLE","$invoiceRawData",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getRequest",201],"(",")",["T_OBJECT_OPERATOR","->",201],["T_STRING","getParam",201],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice'",201],")",";",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$invoiceRawCommentText",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$invoiceRawData",202],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",202],"]",";",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$invoice",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","setCommentText",203],"(",["T_VARIABLE","$invoiceRawCommentText",203],")",";",["T_WHITESPACE","\n\n            ",203],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","loadLayout",205],"(",")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$response",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getLayout",206],"(",")",["T_OBJECT_OPERATOR","->",206],["T_STRING","getBlock",206],"(",["T_CONSTANT_ENCAPSED_STRING","'order_items'",206],")",["T_OBJECT_OPERATOR","->",206],["T_STRING","toHtml",206],"(",")",";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE"," ",207],["T_CATCH","catch",207],["T_WHITESPACE"," ",207],"(",["T_STRING","Mage_Core_Exception",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$e",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$response",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_ARRAY","array",208],"(",["T_WHITESPACE","\n                ",208],["T_CONSTANT_ENCAPSED_STRING","'error'",209],["T_WHITESPACE","     ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_STRING","true",209],",",["T_WHITESPACE","\n                ",209],["T_CONSTANT_ENCAPSED_STRING","'message'",210],["T_WHITESPACE","   ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$e",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getMessage",210],"(",")",["T_WHITESPACE","\n            ",210],")",";",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$response",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","helper",212],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",212],")",["T_OBJECT_OPERATOR","->",212],["T_STRING","jsonEncode",212],"(",["T_VARIABLE","$response",212],")",";",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE"," ",213],["T_CATCH","catch",213],["T_WHITESPACE"," ",213],"(",["T_STRING","Exception",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$e",213],")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$response",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_ARRAY","array",214],"(",["T_WHITESPACE","\n                ",214],["T_CONSTANT_ENCAPSED_STRING","'error'",215],["T_WHITESPACE","     ",215],["T_DOUBLE_ARROW","=>",215],["T_WHITESPACE"," ",215],["T_STRING","true",215],",",["T_WHITESPACE","\n                ",215],["T_CONSTANT_ENCAPSED_STRING","'message'",216],["T_WHITESPACE","   ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","__",216],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot update item quantity.'",216],")",["T_WHITESPACE","\n            ",216],")",";",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$response",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_STRING","Mage",218],["T_DOUBLE_COLON","::",218],["T_STRING","helper",218],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",218],")",["T_OBJECT_OPERATOR","->",218],["T_STRING","jsonEncode",218],"(",["T_VARIABLE","$response",218],")",";",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getResponse",220],"(",")",["T_OBJECT_OPERATOR","->",220],["T_STRING","setBody",220],"(",["T_VARIABLE","$response",220],")",";",["T_WHITESPACE","\n    ",220],"}",["T_WHITESPACE","\n\n    ",221],["T_DOC_COMMENT","\/**\n     * Save invoice\n     * We can save only new invoice. Existing invoices are not editable\n     *\/",223],["T_WHITESPACE","\n    ",226],["T_PUBLIC","public",227],["T_WHITESPACE"," ",227],["T_FUNCTION","function",227],["T_WHITESPACE"," ",227],["T_STRING","saveAction",227],"(",")",["T_WHITESPACE","\n    ",227],"{",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$data",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getRequest",229],"(",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getPost",229],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice'",229],")",";",["T_WHITESPACE","\n        ",229],["T_VARIABLE","$orderId",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getRequest",230],"(",")",["T_OBJECT_OPERATOR","->",230],["T_STRING","getParam",230],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",230],")",";",["T_WHITESPACE","\n\n        ",230],["T_IF","if",232],["T_WHITESPACE"," ",232],"(","!",["T_EMPTY","empty",232],"(",["T_VARIABLE","$data",232],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",232],"]",")",")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n            ",232],["T_STRING","Mage",233],["T_DOUBLE_COLON","::",233],["T_STRING","getSingleton",233],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",233],")",["T_OBJECT_OPERATOR","->",233],["T_STRING","setCommentText",233],"(",["T_VARIABLE","$data",233],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",233],"]",")",";",["T_WHITESPACE","\n        ",233],"}",["T_WHITESPACE","\n\n        ",234],["T_TRY","try",236],["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$invoice",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_initInvoice",237],"(",")",";",["T_WHITESPACE","\n            ",237],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_VARIABLE","$invoice",238],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n\n                ",238],["T_IF","if",240],["T_WHITESPACE"," ",240],"(","!",["T_EMPTY","empty",240],"(",["T_VARIABLE","$data",240],"[",["T_CONSTANT_ENCAPSED_STRING","'capture_case'",240],"]",")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n                    ",240],["T_VARIABLE","$invoice",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setRequestedCaptureCase",241],"(",["T_VARIABLE","$data",241],"[",["T_CONSTANT_ENCAPSED_STRING","'capture_case'",241],"]",")",";",["T_WHITESPACE","\n                ",241],"}",["T_WHITESPACE","\n\n                ",242],["T_IF","if",244],["T_WHITESPACE"," ",244],"(","!",["T_EMPTY","empty",244],"(",["T_VARIABLE","$data",244],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",244],"]",")",")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n                    ",244],["T_VARIABLE","$invoice",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","addComment",245],"(",["T_WHITESPACE","\n                        ",245],["T_VARIABLE","$data",246],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",246],"]",",",["T_WHITESPACE","\n                        ",246],["T_ISSET","isset",247],"(",["T_VARIABLE","$data",247],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_customer_notify'",247],"]",")",",",["T_WHITESPACE","\n                        ",247],["T_ISSET","isset",248],"(",["T_VARIABLE","$data",248],"[",["T_CONSTANT_ENCAPSED_STRING","'is_visible_on_front'",248],"]",")",["T_WHITESPACE","\n                    ",248],")",";",["T_WHITESPACE","\n                ",249],"}",["T_WHITESPACE","\n\n                ",250],["T_VARIABLE","$invoice",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","register",252],"(",")",";",["T_WHITESPACE","\n\n                ",252],["T_IF","if",254],["T_WHITESPACE"," ",254],"(","!",["T_EMPTY","empty",254],"(",["T_VARIABLE","$data",254],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",254],"]",")",")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n                    ",254],["T_VARIABLE","$invoice",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","setEmailSent",255],"(",["T_STRING","true",255],")",";",["T_WHITESPACE","\n                ",255],"}",["T_WHITESPACE","\n\n                ",256],["T_VARIABLE","$invoice",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getOrder",258],"(",")",["T_OBJECT_OPERATOR","->",258],["T_STRING","setCustomerNoteNotify",258],"(","!",["T_EMPTY","empty",258],"(",["T_VARIABLE","$data",258],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",258],"]",")",")",";",["T_WHITESPACE","\n                ",258],["T_VARIABLE","$invoice",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getOrder",259],"(",")",["T_OBJECT_OPERATOR","->",259],["T_STRING","setIsInProcess",259],"(",["T_STRING","true",259],")",";",["T_WHITESPACE","\n\n                ",259],["T_VARIABLE","$transactionSave",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_STRING","Mage",261],["T_DOUBLE_COLON","::",261],["T_STRING","getModel",261],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource_transaction'",261],")",["T_WHITESPACE","\n                    ",261],["T_OBJECT_OPERATOR","->",262],["T_STRING","addObject",262],"(",["T_VARIABLE","$invoice",262],")",["T_WHITESPACE","\n                    ",262],["T_OBJECT_OPERATOR","->",263],["T_STRING","addObject",263],"(",["T_VARIABLE","$invoice",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getOrder",263],"(",")",")",";",["T_WHITESPACE","\n                ",263],["T_VARIABLE","$shipment",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_STRING","false",264],";",["T_WHITESPACE","\n                ",264],["T_IF","if",265],["T_WHITESPACE"," ",265],"(","!",["T_EMPTY","empty",265],"(",["T_VARIABLE","$data",265],"[",["T_CONSTANT_ENCAPSED_STRING","'do_shipment'",265],"]",")",["T_WHITESPACE"," ",265],["T_BOOLEAN_OR","||",265],["T_WHITESPACE"," ",265],["T_INT_CAST","(int)",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$invoice",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getOrder",265],"(",")",["T_OBJECT_OPERATOR","->",265],["T_STRING","getForcedDoShipmentWithInvoice",265],"(",")",")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n                    ",265],["T_VARIABLE","$shipment",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","_prepareShipment",266],"(",["T_VARIABLE","$invoice",266],")",";",["T_WHITESPACE","\n                    ",266],["T_IF","if",267],["T_WHITESPACE"," ",267],"(",["T_VARIABLE","$shipment",267],")",["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n                        ",267],["T_VARIABLE","$shipment",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","setEmailSent",268],"(",["T_VARIABLE","$invoice",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getEmailSent",268],"(",")",")",";",["T_WHITESPACE","\n                        ",268],["T_VARIABLE","$transactionSave",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","addObject",269],"(",["T_VARIABLE","$shipment",269],")",";",["T_WHITESPACE","\n                    ",269],"}",["T_WHITESPACE","\n                ",270],"}",["T_WHITESPACE","\n                ",271],["T_VARIABLE","$transactionSave",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","save",272],"(",")",";",["T_WHITESPACE","\n\n                ",272],["T_IF","if",274],["T_WHITESPACE"," ",274],"(",["T_ISSET","isset",274],"(",["T_VARIABLE","$shippingResponse",274],")",["T_WHITESPACE"," ",274],["T_BOOLEAN_AND","&&",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$shippingResponse",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","hasErrors",274],"(",")",")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n                    ",274],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_getSession",275],"(",")",["T_OBJECT_OPERATOR","->",275],["T_STRING","addError",275],"(",["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","__",275],"(",["T_CONSTANT_ENCAPSED_STRING","'The invoice and the shipment  have been created. The shipping label cannot be created at the moment.'",275],")",")",";",["T_WHITESPACE","\n                ",275],"}",["T_WHITESPACE"," ",276],["T_ELSEIF","elseif",276],["T_WHITESPACE"," ",276],"(","!",["T_EMPTY","empty",276],"(",["T_VARIABLE","$data",276],"[",["T_CONSTANT_ENCAPSED_STRING","'do_shipment'",276],"]",")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n                    ",276],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_getSession",277],"(",")",["T_OBJECT_OPERATOR","->",277],["T_STRING","addSuccess",277],"(",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","__",277],"(",["T_CONSTANT_ENCAPSED_STRING","'The invoice and shipment have been created.'",277],")",")",";",["T_WHITESPACE","\n                ",277],"}",["T_WHITESPACE"," ",278],["T_ELSE","else",278],["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n                    ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_getSession",279],"(",")",["T_OBJECT_OPERATOR","->",279],["T_STRING","addSuccess",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","__",279],"(",["T_CONSTANT_ENCAPSED_STRING","'The invoice has been created.'",279],")",")",";",["T_WHITESPACE","\n                ",279],"}",["T_WHITESPACE","\n\n                ",280],["T_COMMENT","\/\/ send invoice\/shipment emails\n",282],["T_WHITESPACE","                ",283],["T_VARIABLE","$comment",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","''",283],";",["T_WHITESPACE","\n                ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_ISSET","isset",284],"(",["T_VARIABLE","$data",284],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_customer_notify'",284],"]",")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                    ",284],["T_VARIABLE","$comment",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$data",285],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",285],"]",";",["T_WHITESPACE","\n                ",285],"}",["T_WHITESPACE","\n                ",286],["T_TRY","try",287],["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n                    ",287],["T_VARIABLE","$invoice",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","sendEmail",288],"(","!",["T_EMPTY","empty",288],"(",["T_VARIABLE","$data",288],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",288],"]",")",",",["T_WHITESPACE"," ",288],["T_VARIABLE","$comment",288],")",";",["T_WHITESPACE","\n                ",288],"}",["T_WHITESPACE"," ",289],["T_CATCH","catch",289],["T_WHITESPACE"," ",289],"(",["T_STRING","Exception",289],["T_WHITESPACE"," ",289],["T_VARIABLE","$e",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n                    ",289],["T_STRING","Mage",290],["T_DOUBLE_COLON","::",290],["T_STRING","logException",290],"(",["T_VARIABLE","$e",290],")",";",["T_WHITESPACE","\n                    ",290],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","_getSession",291],"(",")",["T_OBJECT_OPERATOR","->",291],["T_STRING","addError",291],"(",["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","__",291],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to send the invoice email.'",291],")",")",";",["T_WHITESPACE","\n                ",291],"}",["T_WHITESPACE","\n                ",292],["T_IF","if",293],["T_WHITESPACE"," ",293],"(",["T_VARIABLE","$shipment",293],")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n                    ",293],["T_TRY","try",294],["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n                        ",294],["T_VARIABLE","$shipment",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","sendEmail",295],"(","!",["T_EMPTY","empty",295],"(",["T_VARIABLE","$data",295],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",295],"]",")",")",";",["T_WHITESPACE","\n                    ",295],"}",["T_WHITESPACE"," ",296],["T_CATCH","catch",296],["T_WHITESPACE"," ",296],"(",["T_STRING","Exception",296],["T_WHITESPACE"," ",296],["T_VARIABLE","$e",296],")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n                        ",296],["T_STRING","Mage",297],["T_DOUBLE_COLON","::",297],["T_STRING","logException",297],"(",["T_VARIABLE","$e",297],")",";",["T_WHITESPACE","\n                        ",297],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_getSession",298],"(",")",["T_OBJECT_OPERATOR","->",298],["T_STRING","addError",298],"(",["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","__",298],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to send the shipment email.'",298],")",")",";",["T_WHITESPACE","\n                    ",298],"}",["T_WHITESPACE","\n                ",299],"}",["T_WHITESPACE","\n                ",300],["T_STRING","Mage",301],["T_DOUBLE_COLON","::",301],["T_STRING","getSingleton",301],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",301],")",["T_OBJECT_OPERATOR","->",301],["T_STRING","getCommentText",301],"(",["T_STRING","true",301],")",";",["T_WHITESPACE","\n                ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_redirect",302],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order\/view'",302],",",["T_WHITESPACE"," ",302],["T_ARRAY","array",302],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",302],["T_WHITESPACE"," ",302],["T_DOUBLE_ARROW","=>",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$orderId",302],")",")",";",["T_WHITESPACE","\n            ",302],"}",["T_WHITESPACE"," ",303],["T_ELSE","else",303],["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n                ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_redirect",304],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",304],",",["T_WHITESPACE"," ",304],["T_ARRAY","array",304],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",304],["T_WHITESPACE"," ",304],["T_DOUBLE_ARROW","=>",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$orderId",304],")",")",";",["T_WHITESPACE","\n            ",304],"}",["T_WHITESPACE","\n            ",305],["T_RETURN","return",306],";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE"," ",307],["T_CATCH","catch",307],["T_WHITESPACE"," ",307],"(",["T_STRING","Mage_Core_Exception",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$e",307],")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n            ",307],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_getSession",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","addError",308],"(",["T_VARIABLE","$e",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getMessage",308],"(",")",")",";",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE"," ",309],["T_CATCH","catch",309],["T_WHITESPACE"," ",309],"(",["T_STRING","Exception",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$e",309],")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n            ",309],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_getSession",310],"(",")",["T_OBJECT_OPERATOR","->",310],["T_STRING","addError",310],"(",["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","__",310],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to save the invoice.'",310],")",")",";",["T_WHITESPACE","\n            ",310],["T_STRING","Mage",311],["T_DOUBLE_COLON","::",311],["T_STRING","logException",311],"(",["T_VARIABLE","$e",311],")",";",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n        ",312],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_redirect",313],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",313],",",["T_WHITESPACE"," ",313],["T_ARRAY","array",313],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",313],["T_WHITESPACE"," ",313],["T_DOUBLE_ARROW","=>",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$orderId",313],")",")",";",["T_WHITESPACE","\n    ",313],"}",["T_WHITESPACE","\n\n\n    ",314],["T_DOC_COMMENT","\/**\n     * Capture invoice action\n     *\/",317],["T_WHITESPACE","\n    ",319],["T_PUBLIC","public",320],["T_WHITESPACE"," ",320],["T_FUNCTION","function",320],["T_WHITESPACE"," ",320],["T_STRING","captureAction",320],"(",")",["T_WHITESPACE","\n    ",320],"{",["T_WHITESPACE","\n        ",321],["T_IF","if",322],["T_WHITESPACE"," ",322],"(",["T_VARIABLE","$invoice",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","_initInvoice",322],"(",")",")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n            ",322],["T_TRY","try",323],["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n                ",323],["T_VARIABLE","$invoice",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","capture",324],"(",")",";",["T_WHITESPACE","\n                ",324],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_saveInvoice",325],"(",["T_VARIABLE","$invoice",325],")",";",["T_WHITESPACE","\n                ",325],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_getSession",326],"(",")",["T_OBJECT_OPERATOR","->",326],["T_STRING","addSuccess",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","__",326],"(",["T_CONSTANT_ENCAPSED_STRING","'The invoice has been captured.'",326],")",")",";",["T_WHITESPACE","\n            ",326],"}",["T_WHITESPACE"," ",327],["T_CATCH","catch",327],["T_WHITESPACE"," ",327],"(",["T_STRING","Mage_Core_Exception",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$e",327],")",["T_WHITESPACE"," ",327],"{",["T_WHITESPACE","\n                ",327],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_getSession",328],"(",")",["T_OBJECT_OPERATOR","->",328],["T_STRING","addError",328],"(",["T_VARIABLE","$e",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","getMessage",328],"(",")",")",";",["T_WHITESPACE","\n            ",328],"}",["T_WHITESPACE"," ",329],["T_CATCH","catch",329],["T_WHITESPACE"," ",329],"(",["T_STRING","Exception",329],["T_WHITESPACE"," ",329],["T_VARIABLE","$e",329],")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n                ",329],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_getSession",330],"(",")",["T_OBJECT_OPERATOR","->",330],["T_STRING","addError",330],"(",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","__",330],"(",["T_CONSTANT_ENCAPSED_STRING","'Invoice capturing error.'",330],")",")",";",["T_WHITESPACE","\n            ",330],"}",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","_redirect",332],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",332],",",["T_WHITESPACE"," ",332],["T_ARRAY","array",332],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice_id'",332],["T_DOUBLE_ARROW","=>",332],["T_VARIABLE","$invoice",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getId",332],"(",")",")",")",";",["T_WHITESPACE","\n        ",332],"}",["T_WHITESPACE"," ",333],["T_ELSE","else",333],["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","_forward",334],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",334],")",";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n    ",335],"}",["T_WHITESPACE","\n\n    ",336],["T_DOC_COMMENT","\/**\n     * Cancel invoice action\n     *\/",338],["T_WHITESPACE","\n    ",340],["T_PUBLIC","public",341],["T_WHITESPACE"," ",341],["T_FUNCTION","function",341],["T_WHITESPACE"," ",341],["T_STRING","cancelAction",341],"(",")",["T_WHITESPACE","\n    ",341],"{",["T_WHITESPACE","\n        ",342],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_VARIABLE","$invoice",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_initInvoice",343],"(",")",")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n            ",343],["T_TRY","try",344],["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n                ",344],["T_VARIABLE","$invoice",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","cancel",345],"(",")",";",["T_WHITESPACE","\n                ",345],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_saveInvoice",346],"(",["T_VARIABLE","$invoice",346],")",";",["T_WHITESPACE","\n                ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_getSession",347],"(",")",["T_OBJECT_OPERATOR","->",347],["T_STRING","addSuccess",347],"(",["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","__",347],"(",["T_CONSTANT_ENCAPSED_STRING","'The invoice has been canceled.'",347],")",")",";",["T_WHITESPACE","\n            ",347],"}",["T_WHITESPACE"," ",348],["T_CATCH","catch",348],["T_WHITESPACE"," ",348],"(",["T_STRING","Mage_Core_Exception",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$e",348],")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n                ",348],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_getSession",349],"(",")",["T_OBJECT_OPERATOR","->",349],["T_STRING","addError",349],"(",["T_VARIABLE","$e",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getMessage",349],"(",")",")",";",["T_WHITESPACE","\n            ",349],"}",["T_WHITESPACE"," ",350],["T_CATCH","catch",350],["T_WHITESPACE"," ",350],"(",["T_STRING","Exception",350],["T_WHITESPACE"," ",350],["T_VARIABLE","$e",350],")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                ",350],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","_getSession",351],"(",")",["T_OBJECT_OPERATOR","->",351],["T_STRING","addError",351],"(",["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","__",351],"(",["T_CONSTANT_ENCAPSED_STRING","'Invoice canceling error.'",351],")",")",";",["T_WHITESPACE","\n            ",351],"}",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_redirect",353],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",353],",",["T_WHITESPACE"," ",353],["T_ARRAY","array",353],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice_id'",353],["T_DOUBLE_ARROW","=>",353],["T_VARIABLE","$invoice",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getId",353],"(",")",")",")",";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE"," ",354],["T_ELSE","else",354],["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n            ",354],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","_forward",355],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",355],")",";",["T_WHITESPACE","\n        ",355],"}",["T_WHITESPACE","\n    ",356],"}",["T_WHITESPACE","\n\n    ",357],["T_DOC_COMMENT","\/**\n     * Void invoice action\n     *\/",359],["T_WHITESPACE","\n    ",361],["T_PUBLIC","public",362],["T_WHITESPACE"," ",362],["T_FUNCTION","function",362],["T_WHITESPACE"," ",362],["T_STRING","voidAction",362],"(",")",["T_WHITESPACE","\n    ",362],"{",["T_WHITESPACE","\n        ",363],["T_IF","if",364],["T_WHITESPACE"," ",364],"(",["T_VARIABLE","$invoice",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_initInvoice",364],"(",")",")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n            ",364],["T_TRY","try",365],["T_WHITESPACE"," ",365],"{",["T_WHITESPACE","\n                ",365],["T_VARIABLE","$invoice",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","void",366],"(",")",";",["T_WHITESPACE","\n                ",366],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","_saveInvoice",367],"(",["T_VARIABLE","$invoice",367],")",";",["T_WHITESPACE","\n                ",367],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_getSession",368],"(",")",["T_OBJECT_OPERATOR","->",368],["T_STRING","addSuccess",368],"(",["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","__",368],"(",["T_CONSTANT_ENCAPSED_STRING","'The invoice has been voided.'",368],")",")",";",["T_WHITESPACE","\n            ",368],"}",["T_WHITESPACE"," ",369],["T_CATCH","catch",369],["T_WHITESPACE"," ",369],"(",["T_STRING","Mage_Core_Exception",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$e",369],")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n                ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","_getSession",370],"(",")",["T_OBJECT_OPERATOR","->",370],["T_STRING","addError",370],"(",["T_VARIABLE","$e",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getMessage",370],"(",")",")",";",["T_WHITESPACE","\n            ",370],"}",["T_WHITESPACE"," ",371],["T_CATCH","catch",371],["T_WHITESPACE"," ",371],"(",["T_STRING","Exception",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$e",371],")",["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n                ",371],["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","_getSession",372],"(",")",["T_OBJECT_OPERATOR","->",372],["T_STRING","addError",372],"(",["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","__",372],"(",["T_CONSTANT_ENCAPSED_STRING","'Invoice voiding error.'",372],")",")",";",["T_WHITESPACE","\n            ",372],"}",["T_WHITESPACE","\n            ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_redirect",374],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",374],",",["T_WHITESPACE"," ",374],["T_ARRAY","array",374],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice_id'",374],["T_DOUBLE_ARROW","=>",374],["T_VARIABLE","$invoice",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getId",374],"(",")",")",")",";",["T_WHITESPACE","\n        ",374],"}",["T_WHITESPACE"," ",375],["T_ELSE","else",375],["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n            ",375],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","_forward",376],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",376],")",";",["T_WHITESPACE","\n        ",376],"}",["T_WHITESPACE","\n    ",377],"}",["T_WHITESPACE","\n\n    ",378],["T_PUBLIC","public",380],["T_WHITESPACE"," ",380],["T_FUNCTION","function",380],["T_WHITESPACE"," ",380],["T_STRING","addCommentAction",380],"(",")",["T_WHITESPACE","\n    ",380],"{",["T_WHITESPACE","\n        ",381],["T_TRY","try",382],["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getRequest",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","setParam",383],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice_id'",383],",",["T_WHITESPACE"," ",383],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getRequest",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","getParam",383],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",383],")",")",";",["T_WHITESPACE","\n            ",383],["T_VARIABLE","$data",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getRequest",384],"(",")",["T_OBJECT_OPERATOR","->",384],["T_STRING","getPost",384],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",384],")",";",["T_WHITESPACE","\n            ",384],["T_IF","if",385],["T_WHITESPACE"," ",385],"(",["T_EMPTY","empty",385],"(",["T_VARIABLE","$data",385],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",385],"]",")",")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n                ",385],["T_STRING","Mage",386],["T_DOUBLE_COLON","::",386],["T_STRING","throwException",386],"(",["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","__",386],"(",["T_CONSTANT_ENCAPSED_STRING","'The Comment Text field cannot be empty.'",386],")",")",";",["T_WHITESPACE","\n            ",386],"}",["T_WHITESPACE","\n            ",387],["T_VARIABLE","$invoice",388],["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","_initInvoice",388],"(",")",";",["T_WHITESPACE","\n            ",388],["T_VARIABLE","$invoice",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","addComment",389],"(",["T_WHITESPACE","\n                ",389],["T_VARIABLE","$data",390],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",390],"]",",",["T_WHITESPACE","\n                ",390],["T_ISSET","isset",391],"(",["T_VARIABLE","$data",391],"[",["T_CONSTANT_ENCAPSED_STRING","'is_customer_notified'",391],"]",")",",",["T_WHITESPACE","\n                ",391],["T_ISSET","isset",392],"(",["T_VARIABLE","$data",392],"[",["T_CONSTANT_ENCAPSED_STRING","'is_visible_on_front'",392],"]",")",["T_WHITESPACE","\n            ",392],")",";",["T_WHITESPACE","\n            ",393],["T_VARIABLE","$invoice",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","sendUpdateEmail",394],"(","!",["T_EMPTY","empty",394],"(",["T_VARIABLE","$data",394],"[",["T_CONSTANT_ENCAPSED_STRING","'is_customer_notified'",394],"]",")",",",["T_WHITESPACE"," ",394],["T_VARIABLE","$data",394],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",394],"]",")",";",["T_WHITESPACE","\n            ",394],["T_VARIABLE","$invoice",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","save",395],"(",")",";",["T_WHITESPACE","\n\n            ",395],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","loadLayout",397],"(",")",";",["T_WHITESPACE","\n            ",397],["T_VARIABLE","$response",398],["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_VARIABLE","$this",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","getLayout",398],"(",")",["T_OBJECT_OPERATOR","->",398],["T_STRING","getBlock",398],"(",["T_CONSTANT_ENCAPSED_STRING","'invoice_comments'",398],")",["T_OBJECT_OPERATOR","->",398],["T_STRING","toHtml",398],"(",")",";",["T_WHITESPACE","\n        ",398],"}",["T_WHITESPACE"," ",399],["T_CATCH","catch",399],["T_WHITESPACE"," ",399],"(",["T_STRING","Mage_Core_Exception",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$e",399],")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n            ",399],["T_VARIABLE","$response",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_ARRAY","array",400],"(",["T_WHITESPACE","\n                ",400],["T_CONSTANT_ENCAPSED_STRING","'error'",401],["T_WHITESPACE","     ",401],["T_DOUBLE_ARROW","=>",401],["T_WHITESPACE"," ",401],["T_STRING","true",401],",",["T_WHITESPACE","\n                ",401],["T_CONSTANT_ENCAPSED_STRING","'message'",402],["T_WHITESPACE","   ",402],["T_DOUBLE_ARROW","=>",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$e",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","getMessage",402],"(",")",["T_WHITESPACE","\n            ",402],")",";",["T_WHITESPACE","\n            ",403],["T_VARIABLE","$response",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_STRING","Mage",404],["T_DOUBLE_COLON","::",404],["T_STRING","helper",404],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",404],")",["T_OBJECT_OPERATOR","->",404],["T_STRING","jsonEncode",404],"(",["T_VARIABLE","$response",404],")",";",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE"," ",405],["T_CATCH","catch",405],["T_WHITESPACE"," ",405],"(",["T_STRING","Exception",405],["T_WHITESPACE"," ",405],["T_VARIABLE","$e",405],")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n            ",405],["T_VARIABLE","$response",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_ARRAY","array",406],"(",["T_WHITESPACE","\n                ",406],["T_CONSTANT_ENCAPSED_STRING","'error'",407],["T_WHITESPACE","     ",407],["T_DOUBLE_ARROW","=>",407],["T_WHITESPACE"," ",407],["T_STRING","true",407],",",["T_WHITESPACE","\n                ",407],["T_CONSTANT_ENCAPSED_STRING","'message'",408],["T_WHITESPACE","   ",408],["T_DOUBLE_ARROW","=>",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","__",408],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot add new comment.'",408],")",["T_WHITESPACE","\n            ",408],")",";",["T_WHITESPACE","\n            ",409],["T_VARIABLE","$response",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_STRING","Mage",410],["T_DOUBLE_COLON","::",410],["T_STRING","helper",410],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",410],")",["T_OBJECT_OPERATOR","->",410],["T_STRING","jsonEncode",410],"(",["T_VARIABLE","$response",410],")",";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n        ",411],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getResponse",412],"(",")",["T_OBJECT_OPERATOR","->",412],["T_STRING","setBody",412],"(",["T_VARIABLE","$response",412],")",";",["T_WHITESPACE","\n    ",412],"}",["T_WHITESPACE","\n\n\n\n\n\n\n\n\n    ",413],["T_DOC_COMMENT","\/**\n     * Decides if we need to create dummy invoice item or not\n     * for eaxample we don't need create dummy parent if all\n     * children are not in process\n     *\n     * @deprecated after 1.4, Mage_Sales_Model_Service_Order used\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $qtys\n     * @return bool\n     *\/",422],["T_WHITESPACE","\n    ",431],["T_PROTECTED","protected",432],["T_WHITESPACE"," ",432],["T_FUNCTION","function",432],["T_WHITESPACE"," ",432],["T_STRING","_needToAddDummy",432],"(",["T_VARIABLE","$item",432],",",["T_WHITESPACE"," ",432],["T_VARIABLE","$qtys",432],")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n        ",432],["T_IF","if",433],["T_WHITESPACE"," ",433],"(",["T_VARIABLE","$item",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getHasChildren",433],"(",")",")",["T_WHITESPACE"," ",433],"{",["T_WHITESPACE","\n            ",433],["T_FOREACH","foreach",434],["T_WHITESPACE"," ",434],"(",["T_VARIABLE","$item",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getChildrenItems",434],"(",")",["T_WHITESPACE"," ",434],["T_AS","as",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$child",434],")",["T_WHITESPACE"," ",434],"{",["T_WHITESPACE","\n                ",434],["T_IF","if",435],["T_WHITESPACE"," ",435],"(",["T_ISSET","isset",435],"(",["T_VARIABLE","$qtys",435],"[",["T_VARIABLE","$child",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getId",435],"(",")","]",")",["T_WHITESPACE"," ",435],["T_BOOLEAN_AND","&&",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$qtys",435],"[",["T_VARIABLE","$child",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getId",435],"(",")","]",["T_WHITESPACE"," ",435],">",["T_WHITESPACE"," ",435],["T_LNUMBER","0",435],")",["T_WHITESPACE"," ",435],"{",["T_WHITESPACE","\n                    ",435],["T_RETURN","return",436],["T_WHITESPACE"," ",436],["T_STRING","true",436],";",["T_WHITESPACE","\n                ",436],"}",["T_WHITESPACE","\n            ",437],"}",["T_WHITESPACE","\n            ",438],["T_RETURN","return",439],["T_WHITESPACE"," ",439],["T_STRING","false",439],";",["T_WHITESPACE","\n        ",439],"}",["T_WHITESPACE"," ",440],["T_ELSE","else",440],["T_WHITESPACE"," ",440],["T_IF","if",440],"(",["T_VARIABLE","$item",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getParentItem",440],"(",")",")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n            ",440],["T_IF","if",441],["T_WHITESPACE"," ",441],"(",["T_ISSET","isset",441],"(",["T_VARIABLE","$qtys",441],"[",["T_VARIABLE","$item",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getParentItem",441],"(",")",["T_OBJECT_OPERATOR","->",441],["T_STRING","getId",441],"(",")","]",")",["T_WHITESPACE"," ",441],["T_BOOLEAN_AND","&&",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$qtys",441],"[",["T_VARIABLE","$item",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getParentItem",441],"(",")",["T_OBJECT_OPERATOR","->",441],["T_STRING","getId",441],"(",")","]",["T_WHITESPACE"," ",441],">",["T_WHITESPACE"," ",441],["T_LNUMBER","0",441],")",["T_WHITESPACE"," ",441],"{",["T_WHITESPACE","\n                ",441],["T_RETURN","return",442],["T_WHITESPACE"," ",442],["T_STRING","true",442],";",["T_WHITESPACE","\n            ",442],"}",["T_WHITESPACE","\n            ",443],["T_RETURN","return",444],["T_WHITESPACE"," ",444],["T_STRING","false",444],";",["T_WHITESPACE","\n        ",444],"}",["T_WHITESPACE","\n    ",445],"}",["T_WHITESPACE","\n\n    ",446],["T_DOC_COMMENT","\/**\n     * Decides if we need to create dummy shipment item or not\n     * for eaxample we don't need create dummy parent if all\n     * children are not in process\n     *\n     * @deprecated after 1.4, Mage_Sales_Model_Service_Order used\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $qtys\n     * @return bool\n     *\/",448],["T_WHITESPACE","\n    ",457],["T_PROTECTED","protected",458],["T_WHITESPACE"," ",458],["T_FUNCTION","function",458],["T_WHITESPACE"," ",458],["T_STRING","_needToAddDummyForShipment",458],"(",["T_VARIABLE","$item",458],",",["T_WHITESPACE"," ",458],["T_VARIABLE","$qtys",458],")",["T_WHITESPACE"," ",458],"{",["T_WHITESPACE","\n        ",458],["T_IF","if",459],["T_WHITESPACE"," ",459],"(",["T_VARIABLE","$item",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","getHasChildren",459],"(",")",")",["T_WHITESPACE"," ",459],"{",["T_WHITESPACE","\n            ",459],["T_FOREACH","foreach",460],["T_WHITESPACE"," ",460],"(",["T_VARIABLE","$item",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getChildrenItems",460],"(",")",["T_WHITESPACE"," ",460],["T_AS","as",460],["T_WHITESPACE"," ",460],["T_VARIABLE","$child",460],")",["T_WHITESPACE"," ",460],"{",["T_WHITESPACE","\n                ",460],["T_IF","if",461],["T_WHITESPACE"," ",461],"(",["T_VARIABLE","$child",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getIsVirtual",461],"(",")",")",["T_WHITESPACE"," ",461],"{",["T_WHITESPACE","\n                    ",461],["T_CONTINUE","continue",462],";",["T_WHITESPACE","\n                ",462],"}",["T_WHITESPACE","\n                ",463],["T_IF","if",464],["T_WHITESPACE"," ",464],"(",["T_ISSET","isset",464],"(",["T_VARIABLE","$qtys",464],"[",["T_VARIABLE","$child",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getId",464],"(",")","]",")",["T_WHITESPACE"," ",464],["T_BOOLEAN_AND","&&",464],["T_WHITESPACE"," ",464],["T_VARIABLE","$qtys",464],"[",["T_VARIABLE","$child",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getId",464],"(",")","]",["T_WHITESPACE"," ",464],">",["T_WHITESPACE"," ",464],["T_LNUMBER","0",464],")",["T_WHITESPACE"," ",464],"{",["T_WHITESPACE","\n                    ",464],["T_RETURN","return",465],["T_WHITESPACE"," ",465],["T_STRING","true",465],";",["T_WHITESPACE","\n                ",465],"}",["T_WHITESPACE","\n            ",466],"}",["T_WHITESPACE","\n            ",467],["T_IF","if",468],["T_WHITESPACE"," ",468],"(",["T_VARIABLE","$item",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","isShipSeparately",468],"(",")",")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n                ",468],["T_RETURN","return",469],["T_WHITESPACE"," ",469],["T_STRING","true",469],";",["T_WHITESPACE","\n            ",469],"}",["T_WHITESPACE","\n            ",470],["T_RETURN","return",471],["T_WHITESPACE"," ",471],["T_STRING","false",471],";",["T_WHITESPACE","\n        ",471],"}",["T_WHITESPACE"," ",472],["T_ELSE","else",472],["T_WHITESPACE"," ",472],["T_IF","if",472],"(",["T_VARIABLE","$item",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getParentItem",472],"(",")",")",["T_WHITESPACE"," ",472],"{",["T_WHITESPACE","\n            ",472],["T_IF","if",473],["T_WHITESPACE"," ",473],"(",["T_VARIABLE","$item",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getIsVirtual",473],"(",")",")",["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n                ",473],["T_RETURN","return",474],["T_WHITESPACE"," ",474],["T_STRING","false",474],";",["T_WHITESPACE","\n            ",474],"}",["T_WHITESPACE","\n            ",475],["T_IF","if",476],["T_WHITESPACE"," ",476],"(",["T_ISSET","isset",476],"(",["T_VARIABLE","$qtys",476],"[",["T_VARIABLE","$item",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getParentItem",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","getId",476],"(",")","]",")",["T_WHITESPACE"," ",476],["T_BOOLEAN_AND","&&",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$qtys",476],"[",["T_VARIABLE","$item",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getParentItem",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","getId",476],"(",")","]",["T_WHITESPACE"," ",476],">",["T_WHITESPACE"," ",476],["T_LNUMBER","0",476],")",["T_WHITESPACE"," ",476],"{",["T_WHITESPACE","\n                ",476],["T_RETURN","return",477],["T_WHITESPACE"," ",477],["T_STRING","true",477],";",["T_WHITESPACE","\n            ",477],"}",["T_WHITESPACE","\n            ",478],["T_RETURN","return",479],["T_WHITESPACE"," ",479],["T_STRING","false",479],";",["T_WHITESPACE","\n        ",479],"}",["T_WHITESPACE","\n    ",480],"}",["T_WHITESPACE","\n\n    ",481],["T_DOC_COMMENT","\/**\n     * Create pdf for current invoice\n     *\/",483],["T_WHITESPACE","\n    ",485],["T_PUBLIC","public",486],["T_WHITESPACE"," ",486],["T_FUNCTION","function",486],["T_WHITESPACE"," ",486],["T_STRING","printAction",486],"(",")",["T_WHITESPACE","\n    ",486],"{",["T_WHITESPACE","\n        ",487],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","_initInvoice",488],"(",")",";",["T_WHITESPACE","\n        ",488],["T_STRING","parent",489],["T_DOUBLE_COLON","::",489],["T_STRING","printAction",489],"(",")",";",["T_WHITESPACE","\n    ",489],"}",["T_WHITESPACE","\n\n",490],"}",["T_WHITESPACE","\n",492]]