[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Adminhtml giftmessage save model\n *\n * @category   Mage\n * @package    Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Adminhtml_Model_Giftmessage_Save",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Varien_Object",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_saved",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","false",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Save all seted giftmessages\n     *\n     * @return Mage_Adminhtml_Model_Giftmessage_Save\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","saveAllInQuote",44],"(",")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$giftmessages",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getGiftmessages",46],"(",")",";",["T_WHITESPACE","\n\n        ",46],["T_IF","if",48],["T_WHITESPACE"," ",48],"(","!",["T_STRING","is_array",48],"(",["T_VARIABLE","$giftmessages",48],")",")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n            ",48],["T_RETURN","return",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],";",["T_WHITESPACE","\n        ",49],"}",["T_WHITESPACE","\n\n        ",50],["T_FOREACH","foreach",52],["T_WHITESPACE"," ",52],"(",["T_VARIABLE","$giftmessages",52],["T_WHITESPACE"," ",52],["T_AS","as",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$entityId",52],["T_DOUBLE_ARROW","=>",52],["T_VARIABLE","$giftmessage",52],")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n            ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_saveOne",53],"(",["T_VARIABLE","$entityId",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$giftmessage",53],")",";",["T_WHITESPACE","\n        ",53],"}",["T_WHITESPACE","\n\n        ",54],["T_RETURN","return",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_PUBLIC","public",59],["T_WHITESPACE"," ",59],["T_FUNCTION","function",59],["T_WHITESPACE"," ",59],["T_STRING","getSaved",59],"(",")",["T_WHITESPACE","\n    ",59],"{",["T_WHITESPACE","\n        ",60],["T_RETURN","return",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_saved",61],";",["T_WHITESPACE","\n    ",61],"}",["T_WHITESPACE","\n\n    ",62],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","saveAllInOrder",64],"(",")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$giftmessages",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getGiftmessages",66],"(",")",";",["T_WHITESPACE","\n\n        ",66],["T_IF","if",68],["T_WHITESPACE"," ",68],"(","!",["T_STRING","is_array",68],"(",["T_VARIABLE","$giftmessages",68],")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n\n        ",70],["T_FOREACH","foreach",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$giftmessages",72],["T_WHITESPACE"," ",72],["T_AS","as",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$entityId",72],["T_DOUBLE_ARROW","=>",72],["T_VARIABLE","$giftmessage",72],")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_saveOne",73],"(",["T_VARIABLE","$entityId",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$giftmessage",73],")",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE","\n\n        ",74],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Save a single gift message\n     *\n     * @param integer $entityId\n     * @param array $giftmessage\n     * @return Mage_Adminhtml_Model_Giftmessage_Save\n     *\/",79],["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","_saveOne",86],"(",["T_VARIABLE","$entityId",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$giftmessage",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n        ",86],["T_COMMENT","\/* @var $giftmessageModel Mage_Giftmessage_Model_Message *\/",87],["T_WHITESPACE","\n        ",87],["T_VARIABLE","$giftmessageModel",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_STRING","Mage",88],["T_DOUBLE_COLON","::",88],["T_STRING","getModel",88],"(",["T_CONSTANT_ENCAPSED_STRING","'giftmessage\/message'",88],")",";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$entityType",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_getMappedType",89],"(",["T_VARIABLE","$giftmessage",89],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",89],"]",")",";",["T_WHITESPACE","\n\n        ",89],["T_SWITCH","switch",91],"(",["T_VARIABLE","$entityType",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_CASE","case",92],["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'quote'",92],":",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$entityModel",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_getQuote",93],"(",")",";",["T_WHITESPACE","\n                ",93],["T_BREAK","break",94],";",["T_WHITESPACE","\n\n            ",94],["T_CASE","case",96],["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'quote_item'",96],":",["T_WHITESPACE","\n                ",96],["T_VARIABLE","$entityModel",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_getQuote",97],"(",")",["T_OBJECT_OPERATOR","->",97],["T_STRING","getItemById",97],"(",["T_VARIABLE","$entityId",97],")",";",["T_WHITESPACE","\n                ",97],["T_BREAK","break",98],";",["T_WHITESPACE","\n\n            ",98],["T_DEFAULT","default",100],":",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$entityModel",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$giftmessageModel",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getEntityModelByType",101],"(",["T_VARIABLE","$entityType",101],")",["T_WHITESPACE","\n                    ",101],["T_OBJECT_OPERATOR","->",102],["T_STRING","load",102],"(",["T_VARIABLE","$entityId",102],")",";",["T_WHITESPACE","\n                ",102],["T_BREAK","break",103],";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n\n        ",104],["T_IF","if",106],["T_WHITESPACE"," ",106],"(","!",["T_VARIABLE","$entityModel",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n\n        ",108],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$entityModel",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getGiftMessageId",110],"(",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$giftmessageModel",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","load",111],"(",["T_VARIABLE","$entityModel",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getGiftMessageId",111],"(",")",")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n\n        ",112],["T_VARIABLE","$giftmessageModel",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","addData",114],"(",["T_VARIABLE","$giftmessage",114],")",";",["T_WHITESPACE","\n\n        ",114],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$giftmessageModel",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","isMessageEmpty",116],"(",")",["T_WHITESPACE"," ",116],["T_BOOLEAN_AND","&&",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$giftmessageModel",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getId",116],"(",")",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_COMMENT","\/\/ remove empty giftmessage\n",117],["T_WHITESPACE","            ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_deleteOne",118],"(",["T_VARIABLE","$entityModel",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$giftmessageModel",118],")",";",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_saved",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","false",119],";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE"," ",120],["T_ELSEIF","elseif",120],["T_WHITESPACE"," ",120],"(","!",["T_VARIABLE","$giftmessageModel",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","isMessageEmpty",120],"(",")",")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$giftmessageModel",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","save",121],"(",")",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$entityModel",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","setGiftMessageId",122],"(",["T_VARIABLE","$giftmessageModel",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getId",122],"(",")",")",";",["T_WHITESPACE","\n            ",122],["T_IF","if",123],"(",["T_VARIABLE","$entityType",123],["T_WHITESPACE"," ",123],["T_IS_NOT_EQUAL","!=",123],["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'quote'",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$entityModel",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","save",124],"(",")",";",["T_WHITESPACE","\n            ",124],"}",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_saved",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","true",126],";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Delete a single gift message from entity\n     *\n     * @param Mage_GiftMessage_Model_Message|null $giftmessageModel\n     * @param Varien_Object $entityModel\n     * @return Mage_Adminhtml_Model_Giftmessage_Save\n     *\/",132],["T_WHITESPACE","\n    ",138],["T_PROTECTED","protected",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","_deleteOne",139],"(",["T_VARIABLE","$entityModel",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$giftmessageModel",139],"=",["T_STRING","null",139],")",["T_WHITESPACE","\n    ",139],"{",["T_WHITESPACE","\n        ",140],["T_IF","if",141],"(",["T_STRING","is_null",141],"(",["T_VARIABLE","$giftmessageModel",141],")",")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$giftmessageModel",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","Mage",142],["T_DOUBLE_COLON","::",142],["T_STRING","getModel",142],"(",["T_CONSTANT_ENCAPSED_STRING","'giftmessage\/message'",142],")",["T_WHITESPACE","\n                ",142],["T_OBJECT_OPERATOR","->",143],["T_STRING","load",143],"(",["T_VARIABLE","$entityModel",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getGiftMessageId",143],"(",")",")",";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$giftmessageModel",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","delete",145],"(",")",";",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$entityModel",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","setGiftMessageId",146],"(",["T_LNUMBER","0",146],")",["T_WHITESPACE","\n            ",146],["T_OBJECT_OPERATOR","->",147],["T_STRING","save",147],"(",")",";",["T_WHITESPACE","\n        ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Set allowed quote items for gift messages\n     *\n     * @param array $items\n     * @return Mage_Adminhtml_Model_Giftmessage_Save\n     *\/",151],["T_WHITESPACE","\n    ",156],["T_PUBLIC","public",157],["T_WHITESPACE"," ",157],["T_FUNCTION","function",157],["T_WHITESPACE"," ",157],["T_STRING","setAllowQuoteItems",157],"(",["T_VARIABLE","$items",157],")",["T_WHITESPACE","\n    ",157],"{",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_getSession",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","setAllowQuoteItemsGiftMessage",159],"(",["T_VARIABLE","$items",159],")",";",["T_WHITESPACE","\n        ",159],["T_RETURN","return",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Add allowed quote item for gift messages\n     *\n     * @param int $item\n     * @return Mage_Adminhtml_Model_Giftmessage_Save\n     *\/",163],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","addAllowQuoteItem",169],"(",["T_VARIABLE","$item",169],")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$items",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getAllowQuoteItems",171],"(",")",";",["T_WHITESPACE","\n        ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(","!",["T_STRING","in_array",172],"(",["T_VARIABLE","$item",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$items",172],")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$items",173],"[","]",["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$item",173],";",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","setAllowQuoteItems",175],"(",["T_VARIABLE","$items",175],")",";",["T_WHITESPACE","\n\n        ",175],["T_RETURN","return",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n\n    ",178],["T_DOC_COMMENT","\/**\n     * Retrive allowed quote items for gift messages\n     *\n     * @return array\n     *\/",180],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","getAllowQuoteItems",185],"(",")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_IF","if",187],"(","!",["T_STRING","is_array",187],"(",["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_getSession",187],"(",")",["T_OBJECT_OPERATOR","->",187],["T_STRING","getAllowQuoteItemsGiftMessage",187],"(",")",")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","setAllowQuoteItems",188],"(",["T_ARRAY","array",188],"(",")",")",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE","\n\n        ",189],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_getSession",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","getAllowQuoteItemsGiftMessage",191],"(",")",";",["T_WHITESPACE","\n    ",191],"}",["T_WHITESPACE","\n\n    ",192],["T_DOC_COMMENT","\/**\n     * Retrive allowed quote items products for gift messages\n     *\n     * @return array\n     *\/",194],["T_WHITESPACE","\n    ",198],["T_PUBLIC","public",199],["T_WHITESPACE"," ",199],["T_FUNCTION","function",199],["T_WHITESPACE"," ",199],["T_STRING","getAllowQuoteItemsProducts",199],"(",")",["T_WHITESPACE","\n    ",199],"{",["T_WHITESPACE","\n        ",200],["T_VARIABLE","$result",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_ARRAY","array",201],"(",")",";",["T_WHITESPACE","\n        ",201],["T_FOREACH","foreach",202],["T_WHITESPACE"," ",202],"(",["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getAllowQuoteItems",202],"(",")",["T_WHITESPACE"," ",202],["T_AS","as",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$itemId",202],")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$item",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_getQuote",203],"(",")",["T_OBJECT_OPERATOR","->",203],["T_STRING","getItemById",203],"(",["T_VARIABLE","$itemId",203],")",";",["T_WHITESPACE","\n            ",203],["T_IF","if",204],"(","!",["T_VARIABLE","$item",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n                ",204],["T_CONTINUE","continue",205],";",["T_WHITESPACE","\n            ",205],"}",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$result",207],"[","]",["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$item",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getProduct",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","getId",207],"(",")",";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n        ",208],["T_RETURN","return",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$result",209],";",["T_WHITESPACE","\n    ",209],"}",["T_WHITESPACE","\n\n    ",210],["T_DOC_COMMENT","\/**\n     * Checks allowed quote item for gift messages\n     *\n     * @param  Varien_Object $item\n     * @return boolean\n     *\/",212],["T_WHITESPACE","\n    ",217],["T_PUBLIC","public",218],["T_WHITESPACE"," ",218],["T_FUNCTION","function",218],["T_WHITESPACE"," ",218],["T_STRING","getIsAllowedQuoteItem",218],"(",["T_VARIABLE","$item",218],")",["T_WHITESPACE","\n    ",218],"{",["T_WHITESPACE","\n        ",219],["T_IF","if",220],"(","!",["T_STRING","in_array",220],"(",["T_VARIABLE","$item",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getId",220],"(",")",",",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getAllowQuoteItems",220],"(",")",")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(",["T_VARIABLE","$item",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getGiftMessageId",221],"(",")",["T_WHITESPACE"," ",221],["T_BOOLEAN_AND","&&",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","isGiftMessagesAvailable",221],"(",["T_VARIABLE","$item",221],")",")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n                ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","addAllowQuoteItem",222],"(",["T_VARIABLE","$item",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getId",222],"(",")",")",";",["T_WHITESPACE","\n                ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_STRING","true",223],";",["T_WHITESPACE","\n            ",223],"}",["T_WHITESPACE","\n            ",224],["T_RETURN","return",225],["T_WHITESPACE"," ",225],["T_STRING","false",225],";",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE","\n\n        ",226],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_STRING","true",228],";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_DOC_COMMENT","\/**\n     * Retrieve is gift message available for item (product)\n     *\n     * @param Varien_Object $item\n     * @return bool\n     *\/",231],["T_WHITESPACE","\n    ",236],["T_PUBLIC","public",237],["T_WHITESPACE"," ",237],["T_FUNCTION","function",237],["T_WHITESPACE"," ",237],["T_STRING","isGiftMessagesAvailable",237],"(",["T_VARIABLE","$item",237],")",["T_WHITESPACE","\n    ",237],"{",["T_WHITESPACE","\n        ",238],["T_RETURN","return",239],["T_WHITESPACE"," ",239],["T_STRING","Mage",239],["T_DOUBLE_COLON","::",239],["T_STRING","helper",239],"(",["T_CONSTANT_ENCAPSED_STRING","'giftmessage\/message'",239],")",["T_OBJECT_OPERATOR","->",239],["T_STRING","getIsMessagesAvailable",239],"(",["T_WHITESPACE","\n            ",239],["T_CONSTANT_ENCAPSED_STRING","'item'",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$item",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$item",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getStore",240],"(",")",["T_WHITESPACE","\n        ",240],")",";",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n\n    ",242],["T_DOC_COMMENT","\/**\n     * Imports quote items for gift messages from products data\n     *\n     * @param unknown_type $products\n     * @return unknown\n     *\/",244],["T_WHITESPACE","\n    ",249],["T_PUBLIC","public",250],["T_WHITESPACE"," ",250],["T_FUNCTION","function",250],["T_WHITESPACE"," ",250],["T_STRING","importAllowQuoteItemsFromProducts",250],"(",["T_VARIABLE","$products",250],")",["T_WHITESPACE","\n    ",250],"{",["T_WHITESPACE","\n        ",251],["T_VARIABLE","$allowedItems",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getAllowQuoteItems",252],"(",")",";",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$deleteAllowedItems",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_ARRAY","array",253],"(",")",";",["T_WHITESPACE","\n        ",253],["T_FOREACH","foreach",254],["T_WHITESPACE"," ",254],"(",["T_VARIABLE","$products",254],["T_WHITESPACE"," ",254],["T_AS","as",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$productId",254],["T_DOUBLE_ARROW","=>",254],["T_VARIABLE","$data",254],")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n            ",254],["T_VARIABLE","$product",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_STRING","Mage",255],["T_DOUBLE_COLON","::",255],["T_STRING","getModel",255],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",255],")",["T_WHITESPACE","\n                ",255],["T_OBJECT_OPERATOR","->",256],["T_STRING","setStore",256],"(",["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_getSession",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getStore",256],"(",")",")",["T_WHITESPACE","\n                ",256],["T_OBJECT_OPERATOR","->",257],["T_STRING","load",257],"(",["T_VARIABLE","$productId",257],")",";",["T_WHITESPACE","\n            ",257],["T_VARIABLE","$item",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","_getQuote",258],"(",")",["T_OBJECT_OPERATOR","->",258],["T_STRING","getItemByProduct",258],"(",["T_VARIABLE","$product",258],")",";",["T_WHITESPACE","\n\n            ",258],["T_IF","if",260],"(","!",["T_VARIABLE","$item",260],")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n                ",260],["T_CONTINUE","continue",261],";",["T_WHITESPACE","\n            ",261],"}",["T_WHITESPACE","\n\n            ",262],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_STRING","in_array",264],"(",["T_VARIABLE","$item",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getId",264],"(",")",",",["T_WHITESPACE"," ",264],["T_VARIABLE","$allowedItems",264],")",["T_WHITESPACE","\n                ",264],["T_BOOLEAN_AND","&&",265],["T_WHITESPACE"," ",265],"!",["T_ISSET","isset",265],"(",["T_VARIABLE","$data",265],"[",["T_CONSTANT_ENCAPSED_STRING","'giftmessage'",265],"]",")",")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n                ",265],["T_VARIABLE","$deleteAllowedItems",266],"[","]",["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$item",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getId",266],"(",")",";",["T_WHITESPACE","\n            ",266],"}",["T_WHITESPACE"," ",267],["T_ELSEIF","elseif",267],["T_WHITESPACE"," ",267],"(","!",["T_STRING","in_array",267],"(",["T_VARIABLE","$item",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getId",267],"(",")",",",["T_WHITESPACE"," ",267],["T_VARIABLE","$allowedItems",267],")",["T_WHITESPACE","\n                      ",267],["T_BOOLEAN_AND","&&",268],["T_WHITESPACE"," ",268],["T_ISSET","isset",268],"(",["T_VARIABLE","$data",268],"[",["T_CONSTANT_ENCAPSED_STRING","'giftmessage'",268],"]",")",")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n                ",268],["T_VARIABLE","$allowedItems",269],"[","]",["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$item",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getId",269],"(",")",";",["T_WHITESPACE","\n            ",269],"}",["T_WHITESPACE","\n\n        ",270],"}",["T_WHITESPACE","\n\n        ",272],["T_VARIABLE","$allowedItems",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_STRING","array_diff",274],"(",["T_VARIABLE","$allowedItems",274],",",["T_WHITESPACE"," ",274],["T_VARIABLE","$deleteAllowedItems",274],")",";",["T_WHITESPACE","\n\n        ",274],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","setAllowQuoteItems",276],"(",["T_VARIABLE","$allowedItems",276],")",";",["T_WHITESPACE","\n        ",276],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],";",["T_WHITESPACE","\n    ",277],"}",["T_WHITESPACE","\n\n    ",278],["T_PUBLIC","public",280],["T_WHITESPACE"," ",280],["T_FUNCTION","function",280],["T_WHITESPACE"," ",280],["T_STRING","importAllowQuoteItemsFromItems",280],"(",["T_VARIABLE","$items",280],")",["T_WHITESPACE","\n    ",280],"{",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$allowedItems",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getAllowQuoteItems",282],"(",")",";",["T_WHITESPACE","\n        ",282],["T_VARIABLE","$deleteAllowedItems",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_ARRAY","array",283],"(",")",";",["T_WHITESPACE","\n        ",283],["T_FOREACH","foreach",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$items",284],["T_WHITESPACE"," ",284],["T_AS","as",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$itemId",284],["T_DOUBLE_ARROW","=>",284],["T_VARIABLE","$data",284],")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n\n            ",284],["T_VARIABLE","$item",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_getQuote",286],"(",")",["T_OBJECT_OPERATOR","->",286],["T_STRING","getItemById",286],"(",["T_VARIABLE","$itemId",286],")",";",["T_WHITESPACE","\n\n            ",286],["T_IF","if",288],"(","!",["T_VARIABLE","$item",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n                ",288],["T_COMMENT","\/\/ Clean not exists items\n",289],["T_WHITESPACE","                ",290],["T_VARIABLE","$deleteAllowedItems",290],"[","]",["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$itemId",290],";",["T_WHITESPACE","\n                ",290],["T_CONTINUE","continue",291],";",["T_WHITESPACE","\n            ",291],"}",["T_WHITESPACE","\n\n            ",292],["T_IF","if",294],["T_WHITESPACE"," ",294],"(",["T_STRING","in_array",294],"(",["T_VARIABLE","$item",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getId",294],"(",")",",",["T_WHITESPACE"," ",294],["T_VARIABLE","$allowedItems",294],")",["T_WHITESPACE","\n                ",294],["T_BOOLEAN_AND","&&",295],["T_WHITESPACE"," ",295],"!",["T_ISSET","isset",295],"(",["T_VARIABLE","$data",295],"[",["T_CONSTANT_ENCAPSED_STRING","'giftmessage'",295],"]",")",")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n                ",295],["T_VARIABLE","$deleteAllowedItems",296],"[","]",["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$item",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getId",296],"(",")",";",["T_WHITESPACE","\n            ",296],"}",["T_WHITESPACE"," ",297],["T_ELSEIF","elseif",297],["T_WHITESPACE"," ",297],"(","!",["T_STRING","in_array",297],"(",["T_VARIABLE","$item",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getId",297],"(",")",",",["T_WHITESPACE"," ",297],["T_VARIABLE","$allowedItems",297],")",["T_WHITESPACE","\n                      ",297],["T_BOOLEAN_AND","&&",298],["T_WHITESPACE"," ",298],["T_ISSET","isset",298],"(",["T_VARIABLE","$data",298],"[",["T_CONSTANT_ENCAPSED_STRING","'giftmessage'",298],"]",")",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n                ",298],["T_VARIABLE","$allowedItems",299],"[","]",["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_VARIABLE","$item",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getId",299],"(",")",";",["T_WHITESPACE","\n            ",299],"}",["T_WHITESPACE","\n\n        ",300],"}",["T_WHITESPACE","\n\n        ",302],["T_VARIABLE","$allowedItems",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_STRING","array_diff",304],"(",["T_VARIABLE","$allowedItems",304],",",["T_WHITESPACE"," ",304],["T_VARIABLE","$deleteAllowedItems",304],")",";",["T_WHITESPACE","\n        ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","setAllowQuoteItems",305],"(",["T_VARIABLE","$allowedItems",305],")",";",["T_WHITESPACE","\n        ",305],["T_RETURN","return",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],";",["T_WHITESPACE","\n    ",306],"}",["T_WHITESPACE","\n\n    ",307],["T_DOC_COMMENT","\/**\n     * Retrive mapped type for entity\n     *\n     * @param string $type\n     * @return string\n     *\/",309],["T_WHITESPACE","\n    ",314],["T_PROTECTED","protected",315],["T_WHITESPACE"," ",315],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","_getMappedType",315],"(",["T_VARIABLE","$type",315],")",["T_WHITESPACE","\n    ",315],"{",["T_WHITESPACE","\n        ",316],["T_VARIABLE","$map",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_ARRAY","array",317],"(",["T_WHITESPACE","\n            ",317],["T_CONSTANT_ENCAPSED_STRING","'main'",318],["T_WHITESPACE","          ",318],["T_DOUBLE_ARROW","=>",318],["T_WHITESPACE","  ",318],["T_CONSTANT_ENCAPSED_STRING","'quote'",318],",",["T_WHITESPACE","\n            ",318],["T_CONSTANT_ENCAPSED_STRING","'item'",319],["T_WHITESPACE","          ",319],["T_DOUBLE_ARROW","=>",319],["T_WHITESPACE","  ",319],["T_CONSTANT_ENCAPSED_STRING","'quote_item'",319],",",["T_WHITESPACE","\n            ",319],["T_CONSTANT_ENCAPSED_STRING","'order'",320],["T_WHITESPACE","         ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE","  ",320],["T_CONSTANT_ENCAPSED_STRING","'order'",320],",",["T_WHITESPACE","\n            ",320],["T_CONSTANT_ENCAPSED_STRING","'order_item'",321],["T_WHITESPACE","    ",321],["T_DOUBLE_ARROW","=>",321],["T_WHITESPACE","  ",321],["T_CONSTANT_ENCAPSED_STRING","'order_item'",321],["T_WHITESPACE","\n        ",321],")",";",["T_WHITESPACE","\n\n        ",322],["T_IF","if",324],["T_WHITESPACE"," ",324],"(",["T_ISSET","isset",324],"(",["T_VARIABLE","$map",324],"[",["T_VARIABLE","$type",324],"]",")",")",["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n            ",324],["T_RETURN","return",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$map",325],"[",["T_VARIABLE","$type",325],"]",";",["T_WHITESPACE","\n        ",325],"}",["T_WHITESPACE","\n\n        ",326],["T_RETURN","return",328],["T_WHITESPACE"," ",328],["T_STRING","null",328],";",["T_WHITESPACE","\n    ",328],"}",["T_WHITESPACE","\n\n    ",329],["T_DOC_COMMENT","\/**\n     * Retrieve session object\n     *\n     * @return Mage_Adminhtml_Model_Session_Quote\n     *\/",331],["T_WHITESPACE","\n    ",335],["T_PROTECTED","protected",336],["T_WHITESPACE"," ",336],["T_FUNCTION","function",336],["T_WHITESPACE"," ",336],["T_STRING","_getSession",336],"(",")",["T_WHITESPACE","\n    ",336],"{",["T_WHITESPACE","\n        ",337],["T_RETURN","return",338],["T_WHITESPACE"," ",338],["T_STRING","Mage",338],["T_DOUBLE_COLON","::",338],["T_STRING","getSingleton",338],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session_quote'",338],")",";",["T_WHITESPACE","\n    ",338],"}",["T_WHITESPACE","\n\n    ",339],["T_DOC_COMMENT","\/**\n     * Retrieve quote object\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",341],["T_WHITESPACE","\n    ",345],["T_PROTECTED","protected",346],["T_WHITESPACE"," ",346],["T_FUNCTION","function",346],["T_WHITESPACE"," ",346],["T_STRING","_getQuote",346],"(",")",["T_WHITESPACE","\n    ",346],"{",["T_WHITESPACE","\n        ",347],["T_RETURN","return",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","_getSession",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","getQuote",348],"(",")",";",["T_WHITESPACE","\n    ",348],"}",["T_WHITESPACE","\n\n",349],"}",["T_WHITESPACE","\n",351]]