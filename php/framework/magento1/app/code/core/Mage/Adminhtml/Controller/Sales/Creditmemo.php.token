[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Adminhtml sales orders controller\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Adminhtml_Controller_Sales_Creditmemo",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Adminhtml_Controller_Action",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_DOC_COMMENT","\/**\n     * Additional initialization\n     *\n     *\/",34],["T_WHITESPACE","\n    ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","_construct",38],"(",")",["T_WHITESPACE","\n    ",38],"{",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","setUsedModuleName",40],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Sales'",40],")",";",["T_WHITESPACE","\n    ",40],"}",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Init layout, menu and breadcrumb\n     *\n     * @return Mage_Adminhtml_Sales_CreditmemoController\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_FUNCTION","function",48],["T_WHITESPACE"," ",48],["T_STRING","_initAction",48],"(",")",["T_WHITESPACE","\n    ",48],"{",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","loadLayout",50],"(",")",["T_WHITESPACE","\n            ",50],["T_OBJECT_OPERATOR","->",51],["T_STRING","_setActiveMenu",51],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",51],")",["T_WHITESPACE","\n            ",51],["T_OBJECT_OPERATOR","->",52],["T_STRING","_addBreadcrumb",52],"(",["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","__",52],"(",["T_CONSTANT_ENCAPSED_STRING","'Sales'",52],")",",",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","__",52],"(",["T_CONSTANT_ENCAPSED_STRING","'Sales'",52],")",")",["T_WHITESPACE","\n            ",52],["T_OBJECT_OPERATOR","->",53],["T_STRING","_addBreadcrumb",53],"(",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","__",53],"(",["T_CONSTANT_ENCAPSED_STRING","'Credit Memos'",53],")",",",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","__",53],"(",["T_CONSTANT_ENCAPSED_STRING","'Credit Memos'",53],")",")",";",["T_WHITESPACE","\n        ",53],["T_RETURN","return",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Creditmemos grid\n     *\/",57],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","indexAction",60],"(",")",["T_WHITESPACE","\n    ",60],"{",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_initAction",62],"(",")",["T_WHITESPACE","\n            ",62],["T_OBJECT_OPERATOR","->",63],["T_STRING","_addContent",63],"(",["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getLayout",63],"(",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","createBlock",63],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/sales_creditmemo'",63],")",")",["T_WHITESPACE","\n            ",63],["T_OBJECT_OPERATOR","->",64],["T_STRING","renderLayout",64],"(",")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Creditmemo information page\n     *\/",67],["T_WHITESPACE","\n    ",69],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","viewAction",70],"(",")",["T_WHITESPACE","\n    ",70],"{",["T_WHITESPACE","\n        ",71],["T_IF","if",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$creditmemoId",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getRequest",72],"(",")",["T_OBJECT_OPERATOR","->",72],["T_STRING","getParam",72],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",72],")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_forward",73],"(",["T_CONSTANT_ENCAPSED_STRING","'view'",73],",",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'sales_order_creditmemo'",73],",",["T_WHITESPACE"," ",73],["T_STRING","null",73],",",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",["T_CONSTANT_ENCAPSED_STRING","'come_from'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'sales_creditmemo'",73],")",")",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE"," ",74],["T_ELSE","else",74],["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_forward",75],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",75],")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Notify user\n     *\/",79],["T_WHITESPACE","\n    ",81],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","emailAction",82],"(",")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_VARIABLE","$creditmemoId",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getRequest",84],"(",")",["T_OBJECT_OPERATOR","->",84],["T_STRING","getParam",84],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",84],")",")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n            ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$creditmemo",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","getModel",85],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo'",85],")",["T_OBJECT_OPERATOR","->",85],["T_STRING","load",85],"(",["T_VARIABLE","$creditmemoId",85],")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                ",85],["T_VARIABLE","$creditmemo",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","sendEmail",86],"(",")",";",["T_WHITESPACE","\n                ",86],["T_VARIABLE","$historyItem",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","getResourceModel",87],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_status_history_collection'",87],")",["T_WHITESPACE","\n                    ",87],["T_OBJECT_OPERATOR","->",88],["T_STRING","getUnnotifiedForInstance",88],"(",["T_VARIABLE","$creditmemo",88],",",["T_WHITESPACE"," ",88],["T_STRING","Mage_Sales_Model_Order_Creditmemo",88],["T_DOUBLE_COLON","::",88],["T_STRING","HISTORY_ENTITY_NAME",88],")",";",["T_WHITESPACE","\n                ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$historyItem",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n                    ",89],["T_VARIABLE","$historyItem",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setIsCustomerNotified",90],"(",["T_LNUMBER","1",90],")",";",["T_WHITESPACE","\n                    ",90],["T_VARIABLE","$historyItem",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","save",91],"(",")",";",["T_WHITESPACE","\n                ",91],"}",["T_WHITESPACE","\n\n                ",92],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_getSession",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","addSuccess",94],"(",["T_STRING","Mage",94],["T_DOUBLE_COLON","::",94],["T_STRING","helper",94],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",94],")",["T_OBJECT_OPERATOR","->",94],["T_STRING","__",94],"(",["T_CONSTANT_ENCAPSED_STRING","'The message was sent.'",94],")",")",";",["T_WHITESPACE","\n                ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_redirect",95],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order_creditmemo\/view'",95],",",["T_WHITESPACE"," ",95],["T_ARRAY","array",95],"(",["T_WHITESPACE","\n                    ",95],["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",96],["T_WHITESPACE"," ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$creditmemoId",96],["T_WHITESPACE","\n                ",96],")",")",";",["T_WHITESPACE","\n            ",97],"}",["T_WHITESPACE","\n        ",98],"}",["T_WHITESPACE","\n    ",99],"}",["T_WHITESPACE","\n\n    ",100],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","pdfcreditmemosAction",102],"(",")","{",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$creditmemosIds",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getRequest",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","getPost",103],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_ids'",103],")",";",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(","!",["T_EMPTY","empty",104],"(",["T_VARIABLE","$creditmemosIds",104],")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$invoices",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","getResourceModel",105],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo_collection'",105],")",["T_WHITESPACE","\n                ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","addAttributeToSelect",106],"(",["T_CONSTANT_ENCAPSED_STRING","'*'",106],")",["T_WHITESPACE","\n                ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","addAttributeToFilter",107],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",107],",",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$creditmemosIds",107],")",")",["T_WHITESPACE","\n                ",107],["T_OBJECT_OPERATOR","->",108],["T_STRING","load",108],"(",")",";",["T_WHITESPACE","\n            ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(","!",["T_ISSET","isset",109],"(",["T_VARIABLE","$pdf",109],")",")","{",["T_WHITESPACE","\n                ",109],["T_VARIABLE","$pdf",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_STRING","Mage",110],["T_DOUBLE_COLON","::",110],["T_STRING","getModel",110],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_pdf_creditmemo'",110],")",["T_OBJECT_OPERATOR","->",110],["T_STRING","getPdf",110],"(",["T_VARIABLE","$invoices",110],")",";",["T_WHITESPACE","\n            ",110],"}",["T_WHITESPACE"," ",111],["T_ELSE","else",111],["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n                ",111],["T_VARIABLE","$pages",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","Mage",112],["T_DOUBLE_COLON","::",112],["T_STRING","getModel",112],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_pdf_creditmemo'",112],")",["T_OBJECT_OPERATOR","->",112],["T_STRING","getPdf",112],"(",["T_VARIABLE","$invoices",112],")",";",["T_WHITESPACE","\n                ",112],["T_VARIABLE","$pdf",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","pages",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","array_merge",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$pdf",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","pages",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$pages",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","pages",113],")",";",["T_WHITESPACE","\n            ",113],"}",["T_WHITESPACE","\n\n            ",114],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_prepareDownloadResponse",116],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",116],".",["T_STRING","Mage",116],["T_DOUBLE_COLON","::",116],["T_STRING","getSingleton",116],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",116],")",["T_OBJECT_OPERATOR","->",116],["T_STRING","date",116],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d_H-i-s'",116],")",".",["T_WHITESPACE","\n                ",116],["T_CONSTANT_ENCAPSED_STRING","'.pdf'",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$pdf",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","render",117],"(",")",",",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'application\/pdf'",117],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_redirect",119],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",119],")",";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_PUBLIC","public",122],["T_WHITESPACE"," ",122],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","printAction",122],"(",")",["T_WHITESPACE","\n    ",122],"{",["T_WHITESPACE","\n        ",123],["T_DOC_COMMENT","\/** @see Mage_Adminhtml_Sales_Order_InvoiceController *\/",124],["T_WHITESPACE","\n        ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$creditmemoId",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getRequest",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","getParam",125],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo_id'",125],")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$creditmemo",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","getModel",126],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo'",126],")",["T_OBJECT_OPERATOR","->",126],["T_STRING","load",126],"(",["T_VARIABLE","$creditmemoId",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                ",126],["T_VARIABLE","$pdf",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","getModel",127],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_pdf_creditmemo'",127],")",["T_OBJECT_OPERATOR","->",127],["T_STRING","getPdf",127],"(",["T_ARRAY","array",127],"(",["T_VARIABLE","$creditmemo",127],")",")",";",["T_WHITESPACE","\n                ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_prepareDownloadResponse",128],"(",["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",128],".",["T_STRING","Mage",128],["T_DOUBLE_COLON","::",128],["T_STRING","getSingleton",128],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",128],")",["T_OBJECT_OPERATOR","->",128],["T_STRING","date",128],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d_H-i-s'",128],")",".",["T_WHITESPACE","\n                    ",128],["T_CONSTANT_ENCAPSED_STRING","'.pdf'",129],",",["T_WHITESPACE"," ",129],["T_VARIABLE","$pdf",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","render",129],"(",")",",",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'application\/pdf'",129],")",";",["T_WHITESPACE","\n            ",129],"}",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n        ",131],["T_ELSE","else",132],["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_forward",133],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",133],")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_PROTECTED","protected",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","_isAllowed",137],"(",")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_STRING","Mage",139],["T_DOUBLE_COLON","::",139],["T_STRING","getSingleton",139],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/session'",139],")",["T_OBJECT_OPERATOR","->",139],["T_STRING","isAllowed",139],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/creditmemo'",139],")",";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n",140],"}",["T_WHITESPACE","\n",141]]