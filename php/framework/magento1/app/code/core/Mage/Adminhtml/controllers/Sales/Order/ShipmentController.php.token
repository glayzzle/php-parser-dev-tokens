[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Adminhtml sales order shipment controller\n *\n * @category   Mage\n * @package    Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Sales_Order_ShipmentController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Controller_Sales_Shipment",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Initialize shipment items QTY\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","_getItemQtys",39],"(",")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$data",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","getRequest",41],"(",")",["T_OBJECT_OPERATOR","->",41],["T_STRING","getParam",41],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment'",41],")",";",["T_WHITESPACE","\n        ",41],["T_IF","if",42],["T_WHITESPACE"," ",42],"(",["T_ISSET","isset",42],"(",["T_VARIABLE","$data",42],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",42],"]",")",")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n            ",42],["T_VARIABLE","$qtys",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$data",43],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",43],"]",";",["T_WHITESPACE","\n        ",43],"}",["T_WHITESPACE"," ",44],["T_ELSE","else",44],["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n            ",44],["T_VARIABLE","$qtys",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],"(",")",";",["T_WHITESPACE","\n        ",45],"}",["T_WHITESPACE","\n        ",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$qtys",47],";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Initialize shipment model instance\n     *\n     * @return Mage_Sales_Model_Order_Shipment|bool\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","_initShipment",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_title",57],"(",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","__",57],"(",["T_CONSTANT_ENCAPSED_STRING","'Sales'",57],")",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","_title",57],"(",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","__",57],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipments'",57],")",")",";",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$shipment",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","false",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$shipmentId",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getRequest",60],"(",")",["T_OBJECT_OPERATOR","->",60],["T_STRING","getParam",60],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",60],")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$orderId",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getRequest",61],"(",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","getParam",61],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",61],")",";",["T_WHITESPACE","\n        ",61],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$shipmentId",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$shipment",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","Mage",63],["T_DOUBLE_COLON","::",63],["T_STRING","getModel",63],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment'",63],")",["T_OBJECT_OPERATOR","->",63],["T_STRING","load",63],"(",["T_VARIABLE","$shipmentId",63],")",";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE"," ",64],["T_ELSEIF","elseif",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$orderId",64],")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$order",65],["T_WHITESPACE","      ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","Mage",65],["T_DOUBLE_COLON","::",65],["T_STRING","getModel",65],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",65],")",["T_OBJECT_OPERATOR","->",65],["T_STRING","load",65],"(",["T_VARIABLE","$orderId",65],")",";",["T_WHITESPACE","\n\n            ",65],["T_DOC_COMMENT","\/**\n             * Check order existing\n             *\/",67],["T_WHITESPACE","\n            ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(","!",["T_VARIABLE","$order",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getId",70],"(",")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_getSession",71],"(",")",["T_OBJECT_OPERATOR","->",71],["T_STRING","addError",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","__",71],"(",["T_CONSTANT_ENCAPSED_STRING","'The order no longer exists.'",71],")",")",";",["T_WHITESPACE","\n                ",71],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_STRING","false",72],";",["T_WHITESPACE","\n            ",72],"}",["T_WHITESPACE","\n            ",73],["T_DOC_COMMENT","\/**\n             * Check shipment is available to create separate from invoice\n             *\/",74],["T_WHITESPACE","\n            ",76],["T_IF","if",77],["T_WHITESPACE"," ",77],"(",["T_VARIABLE","$order",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getForcedDoShipmentWithInvoice",77],"(",")",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getSession",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","addError",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","__",78],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot do shipment for the order separately from invoice.'",78],")",")",";",["T_WHITESPACE","\n                ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_STRING","false",79],";",["T_WHITESPACE","\n            ",79],"}",["T_WHITESPACE","\n            ",80],["T_DOC_COMMENT","\/**\n             * Check shipment create availability\n             *\/",81],["T_WHITESPACE","\n            ",83],["T_IF","if",84],["T_WHITESPACE"," ",84],"(","!",["T_VARIABLE","$order",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","canShip",84],"(",")",")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n                ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_getSession",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","addError",85],"(",["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","__",85],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot do shipment for the order.'",85],")",")",";",["T_WHITESPACE","\n                ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_STRING","false",86],";",["T_WHITESPACE","\n            ",86],"}",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$savedQtys",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_getItemQtys",88],"(",")",";",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$shipment",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","Mage",89],["T_DOUBLE_COLON","::",89],["T_STRING","getModel",89],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_order'",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$order",89],")",["T_OBJECT_OPERATOR","->",89],["T_STRING","prepareShipment",89],"(",["T_VARIABLE","$savedQtys",89],")",";",["T_WHITESPACE","\n\n            ",89],["T_VARIABLE","$tracks",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getRequest",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","getPost",91],"(",["T_CONSTANT_ENCAPSED_STRING","'tracking'",91],")",";",["T_WHITESPACE","\n            ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$tracks",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                ",92],["T_FOREACH","foreach",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$tracks",93],["T_WHITESPACE"," ",93],["T_AS","as",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$data",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                    ",93],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_EMPTY","empty",94],"(",["T_VARIABLE","$data",94],"[",["T_CONSTANT_ENCAPSED_STRING","'number'",94],"]",")",")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n                        ",94],["T_STRING","Mage",95],["T_DOUBLE_COLON","::",95],["T_STRING","throwException",95],"(",["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","__",95],"(",["T_CONSTANT_ENCAPSED_STRING","'Tracking number cannot be empty.'",95],")",")",";",["T_WHITESPACE","\n                    ",95],"}",["T_WHITESPACE","\n                    ",96],["T_VARIABLE","$track",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","Mage",97],["T_DOUBLE_COLON","::",97],["T_STRING","getModel",97],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track'",97],")",["T_WHITESPACE","\n                        ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","addData",98],"(",["T_VARIABLE","$data",98],")",";",["T_WHITESPACE","\n                    ",98],["T_VARIABLE","$shipment",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","addTrack",99],"(",["T_VARIABLE","$track",99],")",";",["T_WHITESPACE","\n                ",99],"}",["T_WHITESPACE","\n            ",100],"}",["T_WHITESPACE","\n        ",101],"}",["T_WHITESPACE","\n\n        ",102],["T_STRING","Mage",104],["T_DOUBLE_COLON","::",104],["T_STRING","register",104],"(",["T_CONSTANT_ENCAPSED_STRING","'current_shipment'",104],",",["T_WHITESPACE"," ",104],["T_VARIABLE","$shipment",104],")",";",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$shipment",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Save shipment and order in one transaction\n     *\n     * @param Mage_Sales_Model_Order_Shipment $shipment\n     * @return Mage_Adminhtml_Sales_Order_ShipmentController\n     *\/",108],["T_WHITESPACE","\n    ",113],["T_PROTECTED","protected",114],["T_WHITESPACE"," ",114],["T_FUNCTION","function",114],["T_WHITESPACE"," ",114],["T_STRING","_saveShipment",114],"(",["T_VARIABLE","$shipment",114],")",["T_WHITESPACE","\n    ",114],"{",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$shipment",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getOrder",116],"(",")",["T_OBJECT_OPERATOR","->",116],["T_STRING","setIsInProcess",116],"(",["T_STRING","true",116],")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$transactionSave",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","Mage",117],["T_DOUBLE_COLON","::",117],["T_STRING","getModel",117],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource_transaction'",117],")",["T_WHITESPACE","\n            ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","addObject",118],"(",["T_VARIABLE","$shipment",118],")",["T_WHITESPACE","\n            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","addObject",119],"(",["T_VARIABLE","$shipment",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getOrder",119],"(",")",")",["T_WHITESPACE","\n            ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","save",120],"(",")",";",["T_WHITESPACE","\n\n        ",120],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * Shipment information page\n     *\/",125],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","viewAction",128],"(",")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_initShipment",130],"(",")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_title",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","__",131],"(",["T_CONSTANT_ENCAPSED_STRING","'View Shipment'",131],")",")",";",["T_WHITESPACE","\n\n            ",131],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","loadLayout",133],"(",")",";",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getLayout",134],"(",")",["T_OBJECT_OPERATOR","->",134],["T_STRING","getBlock",134],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_shipment_view'",134],")",["T_WHITESPACE","\n                ",134],["T_OBJECT_OPERATOR","->",135],["T_STRING","updateBackButtonUrl",135],"(",["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getRequest",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getParam",135],"(",["T_CONSTANT_ENCAPSED_STRING","'come_from'",135],")",")",";",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_setActiveMenu",136],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",136],")",["T_WHITESPACE","\n                ",136],["T_OBJECT_OPERATOR","->",137],["T_STRING","renderLayout",137],"(",")",";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE"," ",138],["T_ELSE","else",138],["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_forward",139],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",139],")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Start create shipment action\n     *\/",143],["T_WHITESPACE","\n    ",145],["T_PUBLIC","public",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","startAction",146],"(",")",["T_WHITESPACE","\n    ",146],"{",["T_WHITESPACE","\n        ",147],["T_DOC_COMMENT","\/**\n         * Clear old values for shipment qty's\n         *\/",148],["T_WHITESPACE","\n        ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_redirect",151],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",151],",",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",151],["T_DOUBLE_ARROW","=>",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getRequest",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","getParam",151],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",151],")",")",")",";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Shipment create page\n     *\/",154],["T_WHITESPACE","\n    ",156],["T_PUBLIC","public",157],["T_WHITESPACE"," ",157],["T_FUNCTION","function",157],["T_WHITESPACE"," ",157],["T_STRING","newAction",157],"(",")",["T_WHITESPACE","\n    ",157],"{",["T_WHITESPACE","\n        ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$shipment",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_initShipment",159],"(",")",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_title",160],"(",["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","__",160],"(",["T_CONSTANT_ENCAPSED_STRING","'New Shipment'",160],")",")",";",["T_WHITESPACE","\n\n            ",160],["T_VARIABLE","$comment",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","Mage",162],["T_DOUBLE_COLON","::",162],["T_STRING","getSingleton",162],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",162],")",["T_OBJECT_OPERATOR","->",162],["T_STRING","getCommentText",162],"(",["T_STRING","true",162],")",";",["T_WHITESPACE","\n            ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$comment",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_VARIABLE","$shipment",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setCommentText",164],"(",["T_VARIABLE","$comment",164],")",";",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE","\n\n            ",165],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","loadLayout",167],"(",")",["T_WHITESPACE","\n                ",167],["T_OBJECT_OPERATOR","->",168],["T_STRING","_setActiveMenu",168],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",168],")",["T_WHITESPACE","\n                ",168],["T_OBJECT_OPERATOR","->",169],["T_STRING","renderLayout",169],"(",")",";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE"," ",170],["T_ELSE","else",170],["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_redirect",171],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order\/view'",171],",",["T_WHITESPACE"," ",171],["T_ARRAY","array",171],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",171],["T_DOUBLE_ARROW","=>",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getRequest",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","getParam",171],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",171],")",")",")",";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n\n    ",173],["T_DOC_COMMENT","\/**\n     * Save shipment\n     * We can save only new shipment. Existing shipments are not editable\n     *\n     * @return null\n     *\/",175],["T_WHITESPACE","\n    ",180],["T_PUBLIC","public",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","saveAction",181],"(",")",["T_WHITESPACE","\n    ",181],"{",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$data",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getRequest",183],"(",")",["T_OBJECT_OPERATOR","->",183],["T_STRING","getPost",183],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment'",183],")",";",["T_WHITESPACE","\n        ",183],["T_IF","if",184],["T_WHITESPACE"," ",184],"(","!",["T_EMPTY","empty",184],"(",["T_VARIABLE","$data",184],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",184],"]",")",")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_STRING","Mage",185],["T_DOUBLE_COLON","::",185],["T_STRING","getSingleton",185],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",185],")",["T_OBJECT_OPERATOR","->",185],["T_STRING","setCommentText",185],"(",["T_VARIABLE","$data",185],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",185],"]",")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n\n        ",186],["T_TRY","try",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$shipment",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_initShipment",189],"(",")",";",["T_WHITESPACE","\n            ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_VARIABLE","$shipment",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_forward",191],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",191],")",";",["T_WHITESPACE","\n                ",191],["T_RETURN","return",192],";",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE","\n\n            ",193],["T_VARIABLE","$shipment",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","register",195],"(",")",";",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$comment",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_CONSTANT_ENCAPSED_STRING","''",196],";",["T_WHITESPACE","\n            ",196],["T_IF","if",197],["T_WHITESPACE"," ",197],"(","!",["T_EMPTY","empty",197],"(",["T_VARIABLE","$data",197],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",197],"]",")",")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n                ",197],["T_VARIABLE","$shipment",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","addComment",198],"(",["T_WHITESPACE","\n                    ",198],["T_VARIABLE","$data",199],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",199],"]",",",["T_WHITESPACE","\n                    ",199],["T_ISSET","isset",200],"(",["T_VARIABLE","$data",200],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_customer_notify'",200],"]",")",",",["T_WHITESPACE","\n                    ",200],["T_ISSET","isset",201],"(",["T_VARIABLE","$data",201],"[",["T_CONSTANT_ENCAPSED_STRING","'is_visible_on_front'",201],"]",")",["T_WHITESPACE","\n                ",201],")",";",["T_WHITESPACE","\n                ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(",["T_ISSET","isset",203],"(",["T_VARIABLE","$data",203],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_customer_notify'",203],"]",")",")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n                    ",203],["T_VARIABLE","$comment",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$data",204],"[",["T_CONSTANT_ENCAPSED_STRING","'comment_text'",204],"]",";",["T_WHITESPACE","\n                ",204],"}",["T_WHITESPACE","\n            ",205],"}",["T_WHITESPACE","\n\n            ",206],["T_IF","if",208],["T_WHITESPACE"," ",208],"(","!",["T_EMPTY","empty",208],"(",["T_VARIABLE","$data",208],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",208],"]",")",")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n                ",208],["T_VARIABLE","$shipment",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","setEmailSent",209],"(",["T_STRING","true",209],")",";",["T_WHITESPACE","\n            ",209],"}",["T_WHITESPACE","\n\n            ",210],["T_VARIABLE","$shipment",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getOrder",212],"(",")",["T_OBJECT_OPERATOR","->",212],["T_STRING","setCustomerNoteNotify",212],"(","!",["T_EMPTY","empty",212],"(",["T_VARIABLE","$data",212],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",212],"]",")",")",";",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$responseAjax",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_NEW","new",213],["T_WHITESPACE"," ",213],["T_STRING","Varien_Object",213],"(",")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$isNeedCreateLabel",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_ISSET","isset",214],"(",["T_VARIABLE","$data",214],"[",["T_CONSTANT_ENCAPSED_STRING","'create_shipping_label'",214],"]",")",["T_WHITESPACE"," ",214],["T_BOOLEAN_AND","&&",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$data",214],"[",["T_CONSTANT_ENCAPSED_STRING","'create_shipping_label'",214],"]",";",["T_WHITESPACE","\n\n            ",214],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$isNeedCreateLabel",216],["T_WHITESPACE"," ",216],["T_BOOLEAN_AND","&&",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_createShippingLabel",216],"(",["T_VARIABLE","$shipment",216],")",")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n                ",216],["T_VARIABLE","$responseAjax",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","setOk",217],"(",["T_STRING","true",217],")",";",["T_WHITESPACE","\n            ",217],"}",["T_WHITESPACE","\n\n            ",218],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_saveShipment",220],"(",["T_VARIABLE","$shipment",220],")",";",["T_WHITESPACE","\n\n            ",220],["T_VARIABLE","$shipment",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","sendEmail",222],"(","!",["T_EMPTY","empty",222],"(",["T_VARIABLE","$data",222],"[",["T_CONSTANT_ENCAPSED_STRING","'send_email'",222],"]",")",",",["T_WHITESPACE"," ",222],["T_VARIABLE","$comment",222],")",";",["T_WHITESPACE","\n\n            ",222],["T_VARIABLE","$shipmentCreatedMessage",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","__",224],"(",["T_CONSTANT_ENCAPSED_STRING","'The shipment has been created.'",224],")",";",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$labelCreatedMessage",225],["T_WHITESPACE","    ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","__",225],"(",["T_CONSTANT_ENCAPSED_STRING","'The shipping label has been created.'",225],")",";",["T_WHITESPACE","\n\n            ",225],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_getSession",227],"(",")",["T_OBJECT_OPERATOR","->",227],["T_STRING","addSuccess",227],"(",["T_VARIABLE","$isNeedCreateLabel",227],["T_WHITESPACE"," ",227],"?",["T_WHITESPACE"," ",227],["T_VARIABLE","$shipmentCreatedMessage",227],["T_WHITESPACE"," ",227],".",["T_WHITESPACE"," ",227],["T_CONSTANT_ENCAPSED_STRING","' '",227],["T_WHITESPACE"," ",227],".",["T_WHITESPACE"," ",227],["T_VARIABLE","$labelCreatedMessage",227],["T_WHITESPACE","\n                ",227],":",["T_WHITESPACE"," ",228],["T_VARIABLE","$shipmentCreatedMessage",228],")",";",["T_WHITESPACE","\n            ",228],["T_STRING","Mage",229],["T_DOUBLE_COLON","::",229],["T_STRING","getSingleton",229],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",229],")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getCommentText",229],"(",["T_STRING","true",229],")",";",["T_WHITESPACE","\n        ",229],"}",["T_WHITESPACE"," ",230],["T_CATCH","catch",230],["T_WHITESPACE"," ",230],"(",["T_STRING","Mage_Core_Exception",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$e",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_IF","if",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$isNeedCreateLabel",231],")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n                ",231],["T_VARIABLE","$responseAjax",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","setError",232],"(",["T_STRING","true",232],")",";",["T_WHITESPACE","\n                ",232],["T_VARIABLE","$responseAjax",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","setMessage",233],"(",["T_VARIABLE","$e",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getMessage",233],"(",")",")",";",["T_WHITESPACE","\n            ",233],"}",["T_WHITESPACE"," ",234],["T_ELSE","else",234],["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n                ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_getSession",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","addError",235],"(",["T_VARIABLE","$e",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getMessage",235],"(",")",")",";",["T_WHITESPACE","\n                ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_redirect",236],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",236],",",["T_WHITESPACE"," ",236],["T_ARRAY","array",236],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",236],["T_WHITESPACE"," ",236],["T_DOUBLE_ARROW","=>",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getRequest",236],"(",")",["T_OBJECT_OPERATOR","->",236],["T_STRING","getParam",236],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",236],")",")",")",";",["T_WHITESPACE","\n            ",236],"}",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE"," ",238],["T_CATCH","catch",238],["T_WHITESPACE"," ",238],"(",["T_STRING","Exception",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$e",238],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_STRING","Mage",239],["T_DOUBLE_COLON","::",239],["T_STRING","logException",239],"(",["T_VARIABLE","$e",239],")",";",["T_WHITESPACE","\n            ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_VARIABLE","$isNeedCreateLabel",240],")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n                ",240],["T_VARIABLE","$responseAjax",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setError",241],"(",["T_STRING","true",241],")",";",["T_WHITESPACE","\n                ",241],["T_VARIABLE","$responseAjax",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","setMessage",242],"(",["T_WHITESPACE","\n                    ",242],["T_STRING","Mage",243],["T_DOUBLE_COLON","::",243],["T_STRING","helper",243],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",243],")",["T_OBJECT_OPERATOR","->",243],["T_STRING","__",243],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while creating shipping label.'",243],")",")",";",["T_WHITESPACE","\n            ",243],"}",["T_WHITESPACE"," ",244],["T_ELSE","else",244],["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n                ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","_getSession",245],"(",")",["T_OBJECT_OPERATOR","->",245],["T_STRING","addError",245],"(",["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","__",245],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot save shipment.'",245],")",")",";",["T_WHITESPACE","\n                ",245],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_redirect",246],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/new'",246],",",["T_WHITESPACE"," ",246],["T_ARRAY","array",246],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",246],["T_WHITESPACE"," ",246],["T_DOUBLE_ARROW","=>",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getRequest",246],"(",")",["T_OBJECT_OPERATOR","->",246],["T_STRING","getParam",246],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",246],")",")",")",";",["T_WHITESPACE","\n            ",246],"}",["T_WHITESPACE","\n\n        ",247],"}",["T_WHITESPACE","\n        ",249],["T_IF","if",250],["T_WHITESPACE"," ",250],"(",["T_VARIABLE","$isNeedCreateLabel",250],")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n            ",250],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getResponse",251],"(",")",["T_OBJECT_OPERATOR","->",251],["T_STRING","setBody",251],"(",["T_VARIABLE","$responseAjax",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","toJson",251],"(",")",")",";",["T_WHITESPACE","\n        ",251],"}",["T_WHITESPACE"," ",252],["T_ELSE","else",252],["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n            ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_redirect",253],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order\/view'",253],",",["T_WHITESPACE"," ",253],["T_ARRAY","array",253],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",253],["T_WHITESPACE"," ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$shipment",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getOrderId",253],"(",")",")",")",";",["T_WHITESPACE","\n        ",253],"}",["T_WHITESPACE","\n    ",254],"}",["T_WHITESPACE","\n\n    ",255],["T_DOC_COMMENT","\/**\n     * Send email with shipment data to customer\n     *\/",257],["T_WHITESPACE","\n    ",259],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","emailAction",260],"(",")",["T_WHITESPACE","\n    ",260],"{",["T_WHITESPACE","\n        ",261],["T_TRY","try",262],["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$shipment",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_initShipment",263],"(",")",";",["T_WHITESPACE","\n            ",263],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$shipment",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n                ",264],["T_VARIABLE","$shipment",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","sendEmail",265],"(",["T_STRING","true",265],")",["T_WHITESPACE","\n                    ",265],["T_OBJECT_OPERATOR","->",266],["T_STRING","setEmailSent",266],"(",["T_STRING","true",266],")",["T_WHITESPACE","\n                    ",266],["T_OBJECT_OPERATOR","->",267],["T_STRING","save",267],"(",")",";",["T_WHITESPACE","\n                ",267],["T_VARIABLE","$historyItem",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_STRING","Mage",268],["T_DOUBLE_COLON","::",268],["T_STRING","getResourceModel",268],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_status_history_collection'",268],")",["T_WHITESPACE","\n                    ",268],["T_OBJECT_OPERATOR","->",269],["T_STRING","getUnnotifiedForInstance",269],"(",["T_VARIABLE","$shipment",269],",",["T_WHITESPACE"," ",269],["T_STRING","Mage_Sales_Model_Order_Shipment",269],["T_DOUBLE_COLON","::",269],["T_STRING","HISTORY_ENTITY_NAME",269],")",";",["T_WHITESPACE","\n                ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$historyItem",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n                    ",270],["T_VARIABLE","$historyItem",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","setIsCustomerNotified",271],"(",["T_LNUMBER","1",271],")",";",["T_WHITESPACE","\n                    ",271],["T_VARIABLE","$historyItem",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","save",272],"(",")",";",["T_WHITESPACE","\n                ",272],"}",["T_WHITESPACE","\n                ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_getSession",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","addSuccess",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","__",274],"(",["T_CONSTANT_ENCAPSED_STRING","'The shipment has been sent.'",274],")",")",";",["T_WHITESPACE","\n            ",274],"}",["T_WHITESPACE","\n        ",275],"}",["T_WHITESPACE"," ",276],["T_CATCH","catch",276],["T_WHITESPACE"," ",276],"(",["T_STRING","Mage_Core_Exception",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$e",276],")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n            ",276],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_getSession",277],"(",")",["T_OBJECT_OPERATOR","->",277],["T_STRING","addError",277],"(",["T_VARIABLE","$e",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getMessage",277],"(",")",")",";",["T_WHITESPACE","\n        ",277],"}",["T_WHITESPACE"," ",278],["T_CATCH","catch",278],["T_WHITESPACE"," ",278],"(",["T_STRING","Exception",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$e",278],")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n            ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_getSession",279],"(",")",["T_OBJECT_OPERATOR","->",279],["T_STRING","addError",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","__",279],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot send shipment information.'",279],")",")",";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n        ",280],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","_redirect",281],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",281],",",["T_WHITESPACE"," ",281],["T_ARRAY","array",281],"(",["T_WHITESPACE","\n            ",281],["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",282],["T_WHITESPACE"," ",282],["T_DOUBLE_ARROW","=>",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getRequest",282],"(",")",["T_OBJECT_OPERATOR","->",282],["T_STRING","getParam",282],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",282],")",["T_WHITESPACE","\n        ",282],")",")",";",["T_WHITESPACE","\n    ",283],"}",["T_WHITESPACE","\n\n    ",284],["T_DOC_COMMENT","\/**\n     * Add new tracking number action\n     *\/",286],["T_WHITESPACE","\n    ",288],["T_PUBLIC","public",289],["T_WHITESPACE"," ",289],["T_FUNCTION","function",289],["T_WHITESPACE"," ",289],["T_STRING","addTrackAction",289],"(",")",["T_WHITESPACE","\n    ",289],"{",["T_WHITESPACE","\n        ",290],["T_TRY","try",291],["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$carrier",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getRequest",292],"(",")",["T_OBJECT_OPERATOR","->",292],["T_STRING","getPost",292],"(",["T_CONSTANT_ENCAPSED_STRING","'carrier'",292],")",";",["T_WHITESPACE","\n            ",292],["T_VARIABLE","$number",293],["T_WHITESPACE","  ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","getRequest",293],"(",")",["T_OBJECT_OPERATOR","->",293],["T_STRING","getPost",293],"(",["T_CONSTANT_ENCAPSED_STRING","'number'",293],")",";",["T_WHITESPACE","\n            ",293],["T_VARIABLE","$title",294],["T_WHITESPACE","  ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getRequest",294],"(",")",["T_OBJECT_OPERATOR","->",294],["T_STRING","getPost",294],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",294],")",";",["T_WHITESPACE","\n            ",294],["T_IF","if",295],["T_WHITESPACE"," ",295],"(",["T_EMPTY","empty",295],"(",["T_VARIABLE","$carrier",295],")",")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n                ",295],["T_STRING","Mage",296],["T_DOUBLE_COLON","::",296],["T_STRING","throwException",296],"(",["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","__",296],"(",["T_CONSTANT_ENCAPSED_STRING","'The carrier needs to be specified.'",296],")",")",";",["T_WHITESPACE","\n            ",296],"}",["T_WHITESPACE","\n            ",297],["T_IF","if",298],["T_WHITESPACE"," ",298],"(",["T_EMPTY","empty",298],"(",["T_VARIABLE","$number",298],")",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n                ",298],["T_STRING","Mage",299],["T_DOUBLE_COLON","::",299],["T_STRING","throwException",299],"(",["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","__",299],"(",["T_CONSTANT_ENCAPSED_STRING","'Tracking number cannot be empty.'",299],")",")",";",["T_WHITESPACE","\n            ",299],"}",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$shipment",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_initShipment",301],"(",")",";",["T_WHITESPACE","\n            ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_VARIABLE","$shipment",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n                ",302],["T_VARIABLE","$track",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","getModel",303],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track'",303],")",["T_WHITESPACE","\n                    ",303],["T_OBJECT_OPERATOR","->",304],["T_STRING","setNumber",304],"(",["T_VARIABLE","$number",304],")",["T_WHITESPACE","\n                    ",304],["T_OBJECT_OPERATOR","->",305],["T_STRING","setCarrierCode",305],"(",["T_VARIABLE","$carrier",305],")",["T_WHITESPACE","\n                    ",305],["T_OBJECT_OPERATOR","->",306],["T_STRING","setTitle",306],"(",["T_VARIABLE","$title",306],")",";",["T_WHITESPACE","\n                ",306],["T_VARIABLE","$shipment",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","addTrack",307],"(",["T_VARIABLE","$track",307],")",["T_WHITESPACE","\n                    ",307],["T_OBJECT_OPERATOR","->",308],["T_STRING","save",308],"(",")",";",["T_WHITESPACE","\n\n                ",308],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","loadLayout",310],"(",")",";",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$response",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getLayout",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getBlock",311],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_tracking'",311],")",["T_OBJECT_OPERATOR","->",311],["T_STRING","toHtml",311],"(",")",";",["T_WHITESPACE","\n            ",311],"}",["T_WHITESPACE"," ",312],["T_ELSE","else",312],["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n                ",312],["T_VARIABLE","$response",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_ARRAY","array",313],"(",["T_WHITESPACE","\n                    ",313],["T_CONSTANT_ENCAPSED_STRING","'error'",314],["T_WHITESPACE","     ",314],["T_DOUBLE_ARROW","=>",314],["T_WHITESPACE"," ",314],["T_STRING","true",314],",",["T_WHITESPACE","\n                    ",314],["T_CONSTANT_ENCAPSED_STRING","'message'",315],["T_WHITESPACE","   ",315],["T_DOUBLE_ARROW","=>",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","__",315],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot initialize shipment for adding tracking number.'",315],")",",",["T_WHITESPACE","\n                ",315],")",";",["T_WHITESPACE","\n            ",316],"}",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE"," ",318],["T_CATCH","catch",318],["T_WHITESPACE"," ",318],"(",["T_STRING","Mage_Core_Exception",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$e",318],")",["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n            ",318],["T_VARIABLE","$response",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_ARRAY","array",319],"(",["T_WHITESPACE","\n                ",319],["T_CONSTANT_ENCAPSED_STRING","'error'",320],["T_WHITESPACE","     ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE"," ",320],["T_STRING","true",320],",",["T_WHITESPACE","\n                ",320],["T_CONSTANT_ENCAPSED_STRING","'message'",321],["T_WHITESPACE","   ",321],["T_DOUBLE_ARROW","=>",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$e",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getMessage",321],"(",")",",",["T_WHITESPACE","\n            ",321],")",";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE"," ",323],["T_CATCH","catch",323],["T_WHITESPACE"," ",323],"(",["T_STRING","Exception",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$e",323],")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n            ",323],["T_VARIABLE","$response",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_ARRAY","array",324],"(",["T_WHITESPACE","\n                ",324],["T_CONSTANT_ENCAPSED_STRING","'error'",325],["T_WHITESPACE","     ",325],["T_DOUBLE_ARROW","=>",325],["T_WHITESPACE"," ",325],["T_STRING","true",325],",",["T_WHITESPACE","\n                ",325],["T_CONSTANT_ENCAPSED_STRING","'message'",326],["T_WHITESPACE","   ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","__",326],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot add tracking number.'",326],")",",",["T_WHITESPACE","\n            ",326],")",";",["T_WHITESPACE","\n        ",327],"}",["T_WHITESPACE","\n        ",328],["T_IF","if",329],["T_WHITESPACE"," ",329],"(",["T_STRING","is_array",329],"(",["T_VARIABLE","$response",329],")",")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_VARIABLE","$response",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_STRING","Mage",330],["T_DOUBLE_COLON","::",330],["T_STRING","helper",330],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",330],")",["T_OBJECT_OPERATOR","->",330],["T_STRING","jsonEncode",330],"(",["T_VARIABLE","$response",330],")",";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getResponse",332],"(",")",["T_OBJECT_OPERATOR","->",332],["T_STRING","setBody",332],"(",["T_VARIABLE","$response",332],")",";",["T_WHITESPACE","\n    ",332],"}",["T_WHITESPACE","\n\n    ",333],["T_DOC_COMMENT","\/**\n     * Remove tracking number from shipment\n     *\/",335],["T_WHITESPACE","\n    ",337],["T_PUBLIC","public",338],["T_WHITESPACE"," ",338],["T_FUNCTION","function",338],["T_WHITESPACE"," ",338],["T_STRING","removeTrackAction",338],"(",")",["T_WHITESPACE","\n    ",338],"{",["T_WHITESPACE","\n        ",339],["T_VARIABLE","$trackId",340],["T_WHITESPACE","    ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getRequest",340],"(",")",["T_OBJECT_OPERATOR","->",340],["T_STRING","getParam",340],"(",["T_CONSTANT_ENCAPSED_STRING","'track_id'",340],")",";",["T_WHITESPACE","\n        ",340],["T_VARIABLE","$shipmentId",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getRequest",341],"(",")",["T_OBJECT_OPERATOR","->",341],["T_STRING","getParam",341],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",341],")",";",["T_WHITESPACE","\n        ",341],["T_VARIABLE","$track",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_STRING","Mage",342],["T_DOUBLE_COLON","::",342],["T_STRING","getModel",342],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track'",342],")",["T_OBJECT_OPERATOR","->",342],["T_STRING","load",342],"(",["T_VARIABLE","$trackId",342],")",";",["T_WHITESPACE","\n        ",342],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_VARIABLE","$track",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getId",343],"(",")",")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n            ",343],["T_TRY","try",344],["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n                ",344],["T_IF","if",345],["T_WHITESPACE"," ",345],"(",["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_initShipment",345],"(",")",")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n                    ",345],["T_VARIABLE","$track",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","delete",346],"(",")",";",["T_WHITESPACE","\n\n                    ",346],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","loadLayout",348],"(",")",";",["T_WHITESPACE","\n                    ",348],["T_VARIABLE","$response",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getLayout",349],"(",")",["T_OBJECT_OPERATOR","->",349],["T_STRING","getBlock",349],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_tracking'",349],")",["T_OBJECT_OPERATOR","->",349],["T_STRING","toHtml",349],"(",")",";",["T_WHITESPACE","\n                ",349],"}",["T_WHITESPACE"," ",350],["T_ELSE","else",350],["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                    ",350],["T_VARIABLE","$response",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_ARRAY","array",351],"(",["T_WHITESPACE","\n                        ",351],["T_CONSTANT_ENCAPSED_STRING","'error'",352],["T_WHITESPACE","     ",352],["T_DOUBLE_ARROW","=>",352],["T_WHITESPACE"," ",352],["T_STRING","true",352],",",["T_WHITESPACE","\n                        ",352],["T_CONSTANT_ENCAPSED_STRING","'message'",353],["T_WHITESPACE","   ",353],["T_DOUBLE_ARROW","=>",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","__",353],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot initialize shipment for delete tracking number.'",353],")",",",["T_WHITESPACE","\n                    ",353],")",";",["T_WHITESPACE","\n                ",354],"}",["T_WHITESPACE","\n            ",355],"}",["T_WHITESPACE"," ",356],["T_CATCH","catch",356],["T_WHITESPACE"," ",356],"(",["T_STRING","Exception",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$e",356],")",["T_WHITESPACE"," ",356],"{",["T_WHITESPACE","\n                ",356],["T_VARIABLE","$response",357],["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_ARRAY","array",357],"(",["T_WHITESPACE","\n                    ",357],["T_CONSTANT_ENCAPSED_STRING","'error'",358],["T_WHITESPACE","     ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_STRING","true",358],",",["T_WHITESPACE","\n                    ",358],["T_CONSTANT_ENCAPSED_STRING","'message'",359],["T_WHITESPACE","   ",359],["T_DOUBLE_ARROW","=>",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","__",359],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot delete tracking number.'",359],")",",",["T_WHITESPACE","\n                ",359],")",";",["T_WHITESPACE","\n            ",360],"}",["T_WHITESPACE","\n        ",361],"}",["T_WHITESPACE"," ",362],["T_ELSE","else",362],["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n            ",362],["T_VARIABLE","$response",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_ARRAY","array",363],"(",["T_WHITESPACE","\n                ",363],["T_CONSTANT_ENCAPSED_STRING","'error'",364],["T_WHITESPACE","     ",364],["T_DOUBLE_ARROW","=>",364],["T_WHITESPACE"," ",364],["T_STRING","true",364],",",["T_WHITESPACE","\n                ",364],["T_CONSTANT_ENCAPSED_STRING","'message'",365],["T_WHITESPACE","   ",365],["T_DOUBLE_ARROW","=>",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","__",365],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot load track with retrieving identifier.'",365],")",",",["T_WHITESPACE","\n            ",365],")",";",["T_WHITESPACE","\n        ",366],"}",["T_WHITESPACE","\n        ",367],["T_IF","if",368],["T_WHITESPACE"," ",368],"(",["T_STRING","is_array",368],"(",["T_VARIABLE","$response",368],")",")",["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n            ",368],["T_VARIABLE","$response",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_STRING","Mage",369],["T_DOUBLE_COLON","::",369],["T_STRING","helper",369],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",369],")",["T_OBJECT_OPERATOR","->",369],["T_STRING","jsonEncode",369],"(",["T_VARIABLE","$response",369],")",";",["T_WHITESPACE","\n        ",369],"}",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getResponse",371],"(",")",["T_OBJECT_OPERATOR","->",371],["T_STRING","setBody",371],"(",["T_VARIABLE","$response",371],")",";",["T_WHITESPACE","\n    ",371],"}",["T_WHITESPACE","\n\n    ",372],["T_DOC_COMMENT","\/**\n     * View shipment tracking information\n     *\/",374],["T_WHITESPACE","\n    ",376],["T_PUBLIC","public",377],["T_WHITESPACE"," ",377],["T_FUNCTION","function",377],["T_WHITESPACE"," ",377],["T_STRING","viewTrackAction",377],"(",")",["T_WHITESPACE","\n    ",377],"{",["T_WHITESPACE","\n        ",378],["T_VARIABLE","$trackId",379],["T_WHITESPACE","    ",379],"=",["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","getRequest",379],"(",")",["T_OBJECT_OPERATOR","->",379],["T_STRING","getParam",379],"(",["T_CONSTANT_ENCAPSED_STRING","'track_id'",379],")",";",["T_WHITESPACE","\n        ",379],["T_VARIABLE","$shipmentId",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getRequest",380],"(",")",["T_OBJECT_OPERATOR","->",380],["T_STRING","getParam",380],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",380],")",";",["T_WHITESPACE","\n        ",380],["T_VARIABLE","$track",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_STRING","Mage",381],["T_DOUBLE_COLON","::",381],["T_STRING","getModel",381],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track'",381],")",["T_OBJECT_OPERATOR","->",381],["T_STRING","load",381],"(",["T_VARIABLE","$trackId",381],")",";",["T_WHITESPACE","\n        ",381],["T_IF","if",382],["T_WHITESPACE"," ",382],"(",["T_VARIABLE","$track",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getId",382],"(",")",")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_TRY","try",383],["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n                ",383],["T_VARIABLE","$response",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$track",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getNumberDetail",384],"(",")",";",["T_WHITESPACE","\n            ",384],"}",["T_WHITESPACE"," ",385],["T_CATCH","catch",385],["T_WHITESPACE"," ",385],"(",["T_STRING","Exception",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$e",385],")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n                ",385],["T_VARIABLE","$response",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_ARRAY","array",386],"(",["T_WHITESPACE","\n                    ",386],["T_CONSTANT_ENCAPSED_STRING","'error'",387],["T_WHITESPACE","     ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_STRING","true",387],",",["T_WHITESPACE","\n                    ",387],["T_CONSTANT_ENCAPSED_STRING","'message'",388],["T_WHITESPACE","   ",388],["T_DOUBLE_ARROW","=>",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","__",388],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot retrieve tracking number detail.'",388],")",",",["T_WHITESPACE","\n                ",388],")",";",["T_WHITESPACE","\n            ",389],"}",["T_WHITESPACE","\n        ",390],"}",["T_WHITESPACE"," ",391],["T_ELSE","else",391],["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n            ",391],["T_VARIABLE","$response",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_ARRAY","array",392],"(",["T_WHITESPACE","\n                ",392],["T_CONSTANT_ENCAPSED_STRING","'error'",393],["T_WHITESPACE","     ",393],["T_DOUBLE_ARROW","=>",393],["T_WHITESPACE"," ",393],["T_STRING","true",393],",",["T_WHITESPACE","\n                ",393],["T_CONSTANT_ENCAPSED_STRING","'message'",394],["T_WHITESPACE","   ",394],["T_DOUBLE_ARROW","=>",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","__",394],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot load track with retrieving identifier.'",394],")",",",["T_WHITESPACE","\n            ",394],")",";",["T_WHITESPACE","\n        ",395],"}",["T_WHITESPACE","\n\n        ",396],["T_IF","if",398],["T_WHITESPACE"," ",398],"(",["T_WHITESPACE"," ",398],["T_STRING","is_object",398],"(",["T_VARIABLE","$response",398],")",")","{",["T_WHITESPACE","\n            ",398],["T_VARIABLE","$className",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_STRING","Mage",399],["T_DOUBLE_COLON","::",399],["T_STRING","getConfig",399],"(",")",["T_OBJECT_OPERATOR","->",399],["T_STRING","getBlockClassName",399],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/template'",399],")",";",["T_WHITESPACE","\n            ",399],["T_VARIABLE","$block",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_NEW","new",400],["T_WHITESPACE"," ",400],["T_VARIABLE","$className",400],"(",")",";",["T_WHITESPACE","\n            ",400],["T_VARIABLE","$block",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","setType",401],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/template'",401],")",["T_WHITESPACE","\n                ",401],["T_OBJECT_OPERATOR","->",402],["T_STRING","setIsAnonymous",402],"(",["T_STRING","true",402],")",["T_WHITESPACE","\n                ",402],["T_OBJECT_OPERATOR","->",403],["T_STRING","setTemplate",403],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order\/shipment\/tracking\/info.phtml'",403],")",";",["T_WHITESPACE","\n\n            ",403],["T_VARIABLE","$block",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","setTrackingInfo",405],"(",["T_VARIABLE","$response",405],")",";",["T_WHITESPACE","\n\n            ",405],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getResponse",407],"(",")",["T_OBJECT_OPERATOR","->",407],["T_STRING","setBody",407],"(",["T_VARIABLE","$block",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","toHtml",407],"(",")",")",";",["T_WHITESPACE","\n        ",407],"}",["T_WHITESPACE"," ",408],["T_ELSE","else",408],["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n            ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(",["T_STRING","is_array",409],"(",["T_VARIABLE","$response",409],")",")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n                ",409],["T_VARIABLE","$response",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_STRING","Mage",410],["T_DOUBLE_COLON","::",410],["T_STRING","helper",410],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",410],")",["T_OBJECT_OPERATOR","->",410],["T_STRING","jsonEncode",410],"(",["T_VARIABLE","$response",410],")",";",["T_WHITESPACE","\n            ",410],"}",["T_WHITESPACE","\n\n            ",411],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getResponse",413],"(",")",["T_OBJECT_OPERATOR","->",413],["T_STRING","setBody",413],"(",["T_VARIABLE","$response",413],")",";",["T_WHITESPACE","\n        ",413],"}",["T_WHITESPACE","\n    ",414],"}",["T_WHITESPACE","\n\n    ",415],["T_DOC_COMMENT","\/**\n     * Add comment to shipment history\n     *\/",417],["T_WHITESPACE","\n    ",419],["T_PUBLIC","public",420],["T_WHITESPACE"," ",420],["T_FUNCTION","function",420],["T_WHITESPACE"," ",420],["T_STRING","addCommentAction",420],"(",")",["T_WHITESPACE","\n    ",420],"{",["T_WHITESPACE","\n        ",421],["T_TRY","try",422],["T_WHITESPACE"," ",422],"{",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getRequest",423],"(",")",["T_OBJECT_OPERATOR","->",423],["T_STRING","setParam",423],"(",["T_WHITESPACE","\n                ",423],["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",424],",",["T_WHITESPACE","\n                ",424],["T_VARIABLE","$this",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getRequest",425],"(",")",["T_OBJECT_OPERATOR","->",425],["T_STRING","getParam",425],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",425],")",["T_WHITESPACE","\n            ",425],")",";",["T_WHITESPACE","\n            ",426],["T_VARIABLE","$data",427],["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getRequest",427],"(",")",["T_OBJECT_OPERATOR","->",427],["T_STRING","getPost",427],"(",["T_CONSTANT_ENCAPSED_STRING","'comment'",427],")",";",["T_WHITESPACE","\n            ",427],["T_IF","if",428],["T_WHITESPACE"," ",428],"(",["T_EMPTY","empty",428],"(",["T_VARIABLE","$data",428],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",428],"]",")",")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n                ",428],["T_STRING","Mage",429],["T_DOUBLE_COLON","::",429],["T_STRING","throwException",429],"(",["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","__",429],"(",["T_CONSTANT_ENCAPSED_STRING","'Comment text field cannot be empty.'",429],")",")",";",["T_WHITESPACE","\n            ",429],"}",["T_WHITESPACE","\n            ",430],["T_VARIABLE","$shipment",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_initShipment",431],"(",")",";",["T_WHITESPACE","\n            ",431],["T_VARIABLE","$shipment",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","addComment",432],"(",["T_WHITESPACE","\n                ",432],["T_VARIABLE","$data",433],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",433],"]",",",["T_WHITESPACE","\n                ",433],["T_ISSET","isset",434],"(",["T_VARIABLE","$data",434],"[",["T_CONSTANT_ENCAPSED_STRING","'is_customer_notified'",434],"]",")",",",["T_WHITESPACE","\n                ",434],["T_ISSET","isset",435],"(",["T_VARIABLE","$data",435],"[",["T_CONSTANT_ENCAPSED_STRING","'is_visible_on_front'",435],"]",")",["T_WHITESPACE","\n            ",435],")",";",["T_WHITESPACE","\n            ",436],["T_VARIABLE","$shipment",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","sendUpdateEmail",437],"(","!",["T_EMPTY","empty",437],"(",["T_VARIABLE","$data",437],"[",["T_CONSTANT_ENCAPSED_STRING","'is_customer_notified'",437],"]",")",",",["T_WHITESPACE"," ",437],["T_VARIABLE","$data",437],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",437],"]",")",";",["T_WHITESPACE","\n            ",437],["T_VARIABLE","$shipment",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","save",438],"(",")",";",["T_WHITESPACE","\n\n            ",438],["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","loadLayout",440],"(",["T_STRING","false",440],")",";",["T_WHITESPACE","\n            ",440],["T_VARIABLE","$response",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getLayout",441],"(",")",["T_OBJECT_OPERATOR","->",441],["T_STRING","getBlock",441],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_comments'",441],")",["T_OBJECT_OPERATOR","->",441],["T_STRING","toHtml",441],"(",")",";",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE"," ",442],["T_CATCH","catch",442],["T_WHITESPACE"," ",442],"(",["T_STRING","Mage_Core_Exception",442],["T_WHITESPACE"," ",442],["T_VARIABLE","$e",442],")",["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n            ",442],["T_VARIABLE","$response",443],["T_WHITESPACE"," ",443],"=",["T_WHITESPACE"," ",443],["T_ARRAY","array",443],"(",["T_WHITESPACE","\n                ",443],["T_CONSTANT_ENCAPSED_STRING","'error'",444],["T_WHITESPACE","     ",444],["T_DOUBLE_ARROW","=>",444],["T_WHITESPACE"," ",444],["T_STRING","true",444],",",["T_WHITESPACE","\n                ",444],["T_CONSTANT_ENCAPSED_STRING","'message'",445],["T_WHITESPACE","   ",445],["T_DOUBLE_ARROW","=>",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$e",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getMessage",445],"(",")",["T_WHITESPACE","\n            ",445],")",";",["T_WHITESPACE","\n            ",446],["T_VARIABLE","$response",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_STRING","Mage",447],["T_DOUBLE_COLON","::",447],["T_STRING","helper",447],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",447],")",["T_OBJECT_OPERATOR","->",447],["T_STRING","jsonEncode",447],"(",["T_VARIABLE","$response",447],")",";",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE"," ",448],["T_CATCH","catch",448],["T_WHITESPACE"," ",448],"(",["T_STRING","Exception",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$e",448],")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$response",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_ARRAY","array",449],"(",["T_WHITESPACE","\n                ",449],["T_CONSTANT_ENCAPSED_STRING","'error'",450],["T_WHITESPACE","     ",450],["T_DOUBLE_ARROW","=>",450],["T_WHITESPACE"," ",450],["T_STRING","true",450],",",["T_WHITESPACE","\n                ",450],["T_CONSTANT_ENCAPSED_STRING","'message'",451],["T_WHITESPACE","   ",451],["T_DOUBLE_ARROW","=>",451],["T_WHITESPACE"," ",451],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","__",451],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot add new comment.'",451],")",["T_WHITESPACE","\n            ",451],")",";",["T_WHITESPACE","\n            ",452],["T_VARIABLE","$response",453],["T_WHITESPACE"," ",453],"=",["T_WHITESPACE"," ",453],["T_STRING","Mage",453],["T_DOUBLE_COLON","::",453],["T_STRING","helper",453],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",453],")",["T_OBJECT_OPERATOR","->",453],["T_STRING","jsonEncode",453],"(",["T_VARIABLE","$response",453],")",";",["T_WHITESPACE","\n        ",453],"}",["T_WHITESPACE","\n        ",454],["T_VARIABLE","$this",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","getResponse",455],"(",")",["T_OBJECT_OPERATOR","->",455],["T_STRING","setBody",455],"(",["T_VARIABLE","$response",455],")",";",["T_WHITESPACE","\n    ",455],"}",["T_WHITESPACE","\n\n\n\n    ",456],["T_DOC_COMMENT","\/**\n     * Decides if we need to create dummy shipment item or not\n     * for eaxample we don't need create dummy parent if all\n     * children are not in process\n     *\n     * @deprecated after 1.4, Mage_Sales_Model_Service_Order used\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $qtys\n     * @return bool\n     *\/",460],["T_WHITESPACE","\n    ",469],["T_PROTECTED","protected",470],["T_WHITESPACE"," ",470],["T_FUNCTION","function",470],["T_WHITESPACE"," ",470],["T_STRING","_needToAddDummy",470],"(",["T_VARIABLE","$item",470],",",["T_WHITESPACE"," ",470],["T_VARIABLE","$qtys",470],")",["T_WHITESPACE"," ",470],"{",["T_WHITESPACE","\n        ",470],["T_IF","if",471],["T_WHITESPACE"," ",471],"(",["T_VARIABLE","$item",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getHasChildren",471],"(",")",")",["T_WHITESPACE"," ",471],"{",["T_WHITESPACE","\n            ",471],["T_FOREACH","foreach",472],["T_WHITESPACE"," ",472],"(",["T_VARIABLE","$item",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getChildrenItems",472],"(",")",["T_WHITESPACE"," ",472],["T_AS","as",472],["T_WHITESPACE"," ",472],["T_VARIABLE","$child",472],")",["T_WHITESPACE"," ",472],"{",["T_WHITESPACE","\n                ",472],["T_IF","if",473],["T_WHITESPACE"," ",473],"(",["T_VARIABLE","$child",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getIsVirtual",473],"(",")",")",["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n                    ",473],["T_CONTINUE","continue",474],";",["T_WHITESPACE","\n                ",474],"}",["T_WHITESPACE","\n                ",475],["T_IF","if",476],["T_WHITESPACE"," ",476],"(","(",["T_ISSET","isset",476],"(",["T_VARIABLE","$qtys",476],"[",["T_VARIABLE","$child",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getId",476],"(",")","]",")",["T_WHITESPACE"," ",476],["T_BOOLEAN_AND","&&",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$qtys",476],"[",["T_VARIABLE","$child",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getId",476],"(",")","]",["T_WHITESPACE"," ",476],">",["T_WHITESPACE"," ",476],["T_LNUMBER","0",476],")",["T_WHITESPACE","\n                        ",476],["T_BOOLEAN_OR","||",477],["T_WHITESPACE"," ",477],"(","!",["T_ISSET","isset",477],"(",["T_VARIABLE","$qtys",477],"[",["T_VARIABLE","$child",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getId",477],"(",")","]",")",["T_WHITESPACE"," ",477],["T_BOOLEAN_AND","&&",477],["T_WHITESPACE"," ",477],["T_VARIABLE","$child",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getQtyToShip",477],"(",")",")",")",["T_WHITESPACE"," ",477],"{",["T_WHITESPACE","\n                    ",477],["T_RETURN","return",478],["T_WHITESPACE"," ",478],["T_STRING","true",478],";",["T_WHITESPACE","\n                ",478],"}",["T_WHITESPACE","\n            ",479],"}",["T_WHITESPACE","\n            ",480],["T_RETURN","return",481],["T_WHITESPACE"," ",481],["T_STRING","false",481],";",["T_WHITESPACE","\n        ",481],"}",["T_WHITESPACE"," ",482],["T_ELSE","else",482],["T_WHITESPACE"," ",482],["T_IF","if",482],"(",["T_VARIABLE","$item",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getParentItem",482],"(",")",")",["T_WHITESPACE"," ",482],"{",["T_WHITESPACE","\n            ",482],["T_IF","if",483],["T_WHITESPACE"," ",483],"(",["T_VARIABLE","$item",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getIsVirtual",483],"(",")",")",["T_WHITESPACE"," ",483],"{",["T_WHITESPACE","\n                ",483],["T_RETURN","return",484],["T_WHITESPACE"," ",484],["T_STRING","false",484],";",["T_WHITESPACE","\n            ",484],"}",["T_WHITESPACE","\n            ",485],["T_IF","if",486],["T_WHITESPACE"," ",486],"(","(",["T_ISSET","isset",486],"(",["T_VARIABLE","$qtys",486],"[",["T_VARIABLE","$item",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getParentItem",486],"(",")",["T_OBJECT_OPERATOR","->",486],["T_STRING","getId",486],"(",")","]",")",["T_WHITESPACE"," ",486],["T_BOOLEAN_AND","&&",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$qtys",486],"[",["T_VARIABLE","$item",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getParentItem",486],"(",")",["T_OBJECT_OPERATOR","->",486],["T_STRING","getId",486],"(",")","]",["T_WHITESPACE"," ",486],">",["T_WHITESPACE"," ",486],["T_LNUMBER","0",486],")",["T_WHITESPACE","\n                ",486],["T_BOOLEAN_OR","||",487],["T_WHITESPACE"," ",487],"(","!",["T_ISSET","isset",487],"(",["T_VARIABLE","$qtys",487],"[",["T_VARIABLE","$item",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getParentItem",487],"(",")",["T_OBJECT_OPERATOR","->",487],["T_STRING","getId",487],"(",")","]",")",["T_WHITESPACE"," ",487],["T_BOOLEAN_AND","&&",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$item",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getParentItem",487],"(",")",["T_OBJECT_OPERATOR","->",487],["T_STRING","getQtyToShip",487],"(",")",")",")",["T_WHITESPACE"," ",487],"{",["T_WHITESPACE","\n                ",487],["T_RETURN","return",488],["T_WHITESPACE"," ",488],["T_STRING","true",488],";",["T_WHITESPACE","\n            ",488],"}",["T_WHITESPACE","\n            ",489],["T_RETURN","return",490],["T_WHITESPACE"," ",490],["T_STRING","false",490],";",["T_WHITESPACE","\n        ",490],"}",["T_WHITESPACE","\n    ",491],"}",["T_WHITESPACE","\n\n    ",492],["T_DOC_COMMENT","\/**\n     * Create shipping label for specific shipment with validation.\n     *\n     * @param Mage_Sales_Model_Order_Shipment $shipment\n     * @return bool\n     *\/",494],["T_WHITESPACE","\n    ",499],["T_PROTECTED","protected",500],["T_WHITESPACE"," ",500],["T_FUNCTION","function",500],["T_WHITESPACE"," ",500],["T_STRING","_createShippingLabel",500],"(",["T_STRING","Mage_Sales_Model_Order_Shipment",500],["T_WHITESPACE"," ",500],["T_VARIABLE","$shipment",500],")",["T_WHITESPACE","\n    ",500],"{",["T_WHITESPACE","\n        ",501],["T_IF","if",502],["T_WHITESPACE"," ",502],"(","!",["T_VARIABLE","$shipment",502],")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE","\n            ",502],["T_RETURN","return",503],["T_WHITESPACE"," ",503],["T_STRING","false",503],";",["T_WHITESPACE","\n        ",503],"}",["T_WHITESPACE","\n        ",504],["T_VARIABLE","$carrier",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_VARIABLE","$shipment",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getOrder",505],"(",")",["T_OBJECT_OPERATOR","->",505],["T_STRING","getShippingCarrier",505],"(",")",";",["T_WHITESPACE","\n        ",505],["T_IF","if",506],["T_WHITESPACE"," ",506],"(","!",["T_VARIABLE","$carrier",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","isShippingLabelsAvailable",506],"(",")",")",["T_WHITESPACE"," ",506],"{",["T_WHITESPACE","\n            ",506],["T_RETURN","return",507],["T_WHITESPACE"," ",507],["T_STRING","false",507],";",["T_WHITESPACE","\n        ",507],"}",["T_WHITESPACE","\n        ",508],["T_VARIABLE","$shipment",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","setPackages",509],"(",["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getRequest",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","getParam",509],"(",["T_CONSTANT_ENCAPSED_STRING","'packages'",509],")",")",";",["T_WHITESPACE","\n        ",509],["T_VARIABLE","$response",510],["T_WHITESPACE"," ",510],"=",["T_WHITESPACE"," ",510],["T_STRING","Mage",510],["T_DOUBLE_COLON","::",510],["T_STRING","getModel",510],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping\/shipping'",510],")",["T_OBJECT_OPERATOR","->",510],["T_STRING","requestToShipment",510],"(",["T_VARIABLE","$shipment",510],")",";",["T_WHITESPACE","\n        ",510],["T_IF","if",511],["T_WHITESPACE"," ",511],"(",["T_VARIABLE","$response",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","hasErrors",511],"(",")",")",["T_WHITESPACE"," ",511],"{",["T_WHITESPACE","\n            ",511],["T_STRING","Mage",512],["T_DOUBLE_COLON","::",512],["T_STRING","throwException",512],"(",["T_VARIABLE","$response",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getErrors",512],"(",")",")",";",["T_WHITESPACE","\n        ",512],"}",["T_WHITESPACE","\n        ",513],["T_IF","if",514],["T_WHITESPACE"," ",514],"(","!",["T_VARIABLE","$response",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","hasInfo",514],"(",")",")",["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n            ",514],["T_RETURN","return",515],["T_WHITESPACE"," ",515],["T_STRING","false",515],";",["T_WHITESPACE","\n        ",515],"}",["T_WHITESPACE","\n        ",516],["T_VARIABLE","$labelsContent",517],["T_WHITESPACE"," ",517],"=",["T_WHITESPACE"," ",517],["T_ARRAY","array",517],"(",")",";",["T_WHITESPACE","\n        ",517],["T_VARIABLE","$trackingNumbers",518],["T_WHITESPACE"," ",518],"=",["T_WHITESPACE"," ",518],["T_ARRAY","array",518],"(",")",";",["T_WHITESPACE","\n        ",518],["T_VARIABLE","$info",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_VARIABLE","$response",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getInfo",519],"(",")",";",["T_WHITESPACE","\n        ",519],["T_FOREACH","foreach",520],["T_WHITESPACE"," ",520],"(",["T_VARIABLE","$info",520],["T_WHITESPACE"," ",520],["T_AS","as",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$inf",520],")",["T_WHITESPACE"," ",520],"{",["T_WHITESPACE","\n            ",520],["T_IF","if",521],["T_WHITESPACE"," ",521],"(","!",["T_EMPTY","empty",521],"(",["T_VARIABLE","$inf",521],"[",["T_CONSTANT_ENCAPSED_STRING","'tracking_number'",521],"]",")",["T_WHITESPACE"," ",521],["T_BOOLEAN_AND","&&",521],["T_WHITESPACE"," ",521],"!",["T_EMPTY","empty",521],"(",["T_VARIABLE","$inf",521],"[",["T_CONSTANT_ENCAPSED_STRING","'label_content'",521],"]",")",")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n                ",521],["T_VARIABLE","$labelsContent",522],"[","]",["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_VARIABLE","$inf",522],"[",["T_CONSTANT_ENCAPSED_STRING","'label_content'",522],"]",";",["T_WHITESPACE","\n                ",522],["T_VARIABLE","$trackingNumbers",523],"[","]",["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_VARIABLE","$inf",523],"[",["T_CONSTANT_ENCAPSED_STRING","'tracking_number'",523],"]",";",["T_WHITESPACE","\n            ",523],"}",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n        ",525],["T_VARIABLE","$outputPdf",526],["T_WHITESPACE"," ",526],"=",["T_WHITESPACE"," ",526],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","_combineLabelsPdf",526],"(",["T_VARIABLE","$labelsContent",526],")",";",["T_WHITESPACE","\n        ",526],["T_VARIABLE","$shipment",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","setShippingLabel",527],"(",["T_VARIABLE","$outputPdf",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","render",527],"(",")",")",";",["T_WHITESPACE","\n        ",527],["T_VARIABLE","$carrierCode",528],["T_WHITESPACE"," ",528],"=",["T_WHITESPACE"," ",528],["T_VARIABLE","$carrier",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getCarrierCode",528],"(",")",";",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$carrierTitle",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_STRING","Mage",529],["T_DOUBLE_COLON","::",529],["T_STRING","getStoreConfig",529],"(",["T_CONSTANT_ENCAPSED_STRING","'carriers\/'",529],".",["T_VARIABLE","$carrierCode",529],".",["T_CONSTANT_ENCAPSED_STRING","'\/title'",529],",",["T_WHITESPACE"," ",529],["T_VARIABLE","$shipment",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getStoreId",529],"(",")",")",";",["T_WHITESPACE","\n        ",529],["T_IF","if",530],["T_WHITESPACE"," ",530],"(",["T_VARIABLE","$trackingNumbers",530],")",["T_WHITESPACE"," ",530],"{",["T_WHITESPACE","\n            ",530],["T_FOREACH","foreach",531],["T_WHITESPACE"," ",531],"(",["T_VARIABLE","$trackingNumbers",531],["T_WHITESPACE"," ",531],["T_AS","as",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$trackingNumber",531],")",["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n                ",531],["T_VARIABLE","$track",532],["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],["T_STRING","Mage",532],["T_DOUBLE_COLON","::",532],["T_STRING","getModel",532],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track'",532],")",["T_WHITESPACE","\n                        ",532],["T_OBJECT_OPERATOR","->",533],["T_STRING","setNumber",533],"(",["T_VARIABLE","$trackingNumber",533],")",["T_WHITESPACE","\n                        ",533],["T_OBJECT_OPERATOR","->",534],["T_STRING","setCarrierCode",534],"(",["T_VARIABLE","$carrierCode",534],")",["T_WHITESPACE","\n                        ",534],["T_OBJECT_OPERATOR","->",535],["T_STRING","setTitle",535],"(",["T_VARIABLE","$carrierTitle",535],")",";",["T_WHITESPACE","\n                ",535],["T_VARIABLE","$shipment",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","addTrack",536],"(",["T_VARIABLE","$track",536],")",";",["T_WHITESPACE","\n            ",536],"}",["T_WHITESPACE","\n        ",537],"}",["T_WHITESPACE","\n        ",538],["T_RETURN","return",539],["T_WHITESPACE"," ",539],["T_STRING","true",539],";",["T_WHITESPACE","\n    ",539],"}",["T_WHITESPACE","\n\n    ",540],["T_DOC_COMMENT","\/**\n     * Create shipping label action for specific shipment\n     *\n     *\/",542],["T_WHITESPACE","\n    ",545],["T_PUBLIC","public",546],["T_WHITESPACE"," ",546],["T_FUNCTION","function",546],["T_WHITESPACE"," ",546],["T_STRING","createLabelAction",546],"(",")",["T_WHITESPACE","\n    ",546],"{",["T_WHITESPACE","\n        ",547],["T_VARIABLE","$response",548],["T_WHITESPACE"," ",548],"=",["T_WHITESPACE"," ",548],["T_NEW","new",548],["T_WHITESPACE"," ",548],["T_STRING","Varien_Object",548],"(",")",";",["T_WHITESPACE","\n        ",548],["T_TRY","try",549],["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_VARIABLE","$shipment",550],["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_initShipment",550],"(",")",";",["T_WHITESPACE","\n            ",550],["T_IF","if",551],["T_WHITESPACE"," ",551],"(",["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_createShippingLabel",551],"(",["T_VARIABLE","$shipment",551],")",")",["T_WHITESPACE"," ",551],"{",["T_WHITESPACE","\n                ",551],["T_VARIABLE","$shipment",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","save",552],"(",")",";",["T_WHITESPACE","\n                ",552],["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","_getSession",553],"(",")",["T_OBJECT_OPERATOR","->",553],["T_STRING","addSuccess",553],"(",["T_STRING","Mage",553],["T_DOUBLE_COLON","::",553],["T_STRING","helper",553],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",553],")",["T_OBJECT_OPERATOR","->",553],["T_STRING","__",553],"(",["T_CONSTANT_ENCAPSED_STRING","'The shipping label has been created.'",553],")",")",";",["T_WHITESPACE","\n                ",553],["T_VARIABLE","$response",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","setOk",554],"(",["T_STRING","true",554],")",";",["T_WHITESPACE","\n            ",554],"}",["T_WHITESPACE","\n        ",555],"}",["T_WHITESPACE"," ",556],["T_CATCH","catch",556],["T_WHITESPACE"," ",556],"(",["T_STRING","Mage_Core_Exception",556],["T_WHITESPACE"," ",556],["T_VARIABLE","$e",556],")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n            ",556],["T_VARIABLE","$response",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","setError",557],"(",["T_STRING","true",557],")",";",["T_WHITESPACE","\n            ",557],["T_VARIABLE","$response",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","setMessage",558],"(",["T_VARIABLE","$e",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getMessage",558],"(",")",")",";",["T_WHITESPACE","\n        ",558],"}",["T_WHITESPACE"," ",559],["T_CATCH","catch",559],["T_WHITESPACE"," ",559],"(",["T_STRING","Exception",559],["T_WHITESPACE"," ",559],["T_VARIABLE","$e",559],")",["T_WHITESPACE"," ",559],"{",["T_WHITESPACE","\n            ",559],["T_STRING","Mage",560],["T_DOUBLE_COLON","::",560],["T_STRING","logException",560],"(",["T_VARIABLE","$e",560],")",";",["T_WHITESPACE","\n            ",560],["T_VARIABLE","$response",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","setError",561],"(",["T_STRING","true",561],")",";",["T_WHITESPACE","\n            ",561],["T_VARIABLE","$response",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","setMessage",562],"(",["T_STRING","Mage",562],["T_DOUBLE_COLON","::",562],["T_STRING","helper",562],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",562],")",["T_OBJECT_OPERATOR","->",562],["T_STRING","__",562],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while creating shipping label.'",562],")",")",";",["T_WHITESPACE","\n        ",562],"}",["T_WHITESPACE","\n\n        ",563],["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","getResponse",565],"(",")",["T_OBJECT_OPERATOR","->",565],["T_STRING","setBody",565],"(",["T_VARIABLE","$response",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","toJson",565],"(",")",")",";",["T_WHITESPACE","\n    ",565],"}",["T_WHITESPACE","\n\n    ",566],["T_DOC_COMMENT","\/**\n     * Print label for one specific shipment\n     *\n     *\/",568],["T_WHITESPACE","\n    ",571],["T_PUBLIC","public",572],["T_WHITESPACE"," ",572],["T_FUNCTION","function",572],["T_WHITESPACE"," ",572],["T_STRING","printLabelAction",572],"(",")",["T_WHITESPACE","\n    ",572],"{",["T_WHITESPACE","\n        ",573],["T_TRY","try",574],["T_WHITESPACE"," ",574],"{",["T_WHITESPACE","\n            ",574],["T_VARIABLE","$shipment",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","_initShipment",575],"(",")",";",["T_WHITESPACE","\n            ",575],["T_VARIABLE","$labelContent",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_VARIABLE","$shipment",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","getShippingLabel",576],"(",")",";",["T_WHITESPACE","\n            ",576],["T_IF","if",577],["T_WHITESPACE"," ",577],"(",["T_VARIABLE","$labelContent",577],")",["T_WHITESPACE"," ",577],"{",["T_WHITESPACE","\n                ",577],["T_VARIABLE","$pdfContent",578],["T_WHITESPACE"," ",578],"=",["T_WHITESPACE"," ",578],["T_STRING","null",578],";",["T_WHITESPACE","\n                ",578],["T_IF","if",579],["T_WHITESPACE"," ",579],"(",["T_STRING","stripos",579],"(",["T_VARIABLE","$labelContent",579],",",["T_WHITESPACE"," ",579],["T_CONSTANT_ENCAPSED_STRING","'%PDF-'",579],")",["T_WHITESPACE"," ",579],["T_IS_NOT_IDENTICAL","!==",579],["T_WHITESPACE"," ",579],["T_STRING","false",579],")",["T_WHITESPACE"," ",579],"{",["T_WHITESPACE","\n                    ",579],["T_VARIABLE","$pdfContent",580],["T_WHITESPACE"," ",580],"=",["T_WHITESPACE"," ",580],["T_VARIABLE","$labelContent",580],";",["T_WHITESPACE","\n                ",580],"}",["T_WHITESPACE"," ",581],["T_ELSE","else",581],["T_WHITESPACE"," ",581],"{",["T_WHITESPACE","\n                    ",581],["T_VARIABLE","$pdf",582],["T_WHITESPACE"," ",582],"=",["T_WHITESPACE"," ",582],["T_NEW","new",582],["T_WHITESPACE"," ",582],["T_STRING","Zend_Pdf",582],"(",")",";",["T_WHITESPACE","\n                    ",582],["T_VARIABLE","$page",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","_createPdfPageFromImageString",583],"(",["T_VARIABLE","$labelContent",583],")",";",["T_WHITESPACE","\n                    ",583],["T_IF","if",584],["T_WHITESPACE"," ",584],"(","!",["T_VARIABLE","$page",584],")",["T_WHITESPACE"," ",584],"{",["T_WHITESPACE","\n                        ",584],["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","_getSession",585],"(",")",["T_OBJECT_OPERATOR","->",585],["T_STRING","addError",585],"(",["T_STRING","Mage",585],["T_DOUBLE_COLON","::",585],["T_STRING","helper",585],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",585],")",["T_OBJECT_OPERATOR","->",585],["T_STRING","__",585],"(",["T_CONSTANT_ENCAPSED_STRING","'File extension not known or unsupported type in the following shipment: %s'",585],",",["T_WHITESPACE"," ",585],["T_VARIABLE","$shipment",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","getIncrementId",585],"(",")",")",")",";",["T_WHITESPACE","\n                    ",585],"}",["T_WHITESPACE","\n                    ",586],["T_VARIABLE","$pdf",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","pages",587],"[","]",["T_WHITESPACE"," ",587],"=",["T_WHITESPACE"," ",587],["T_VARIABLE","$page",587],";",["T_WHITESPACE","\n                    ",587],["T_VARIABLE","$pdfContent",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_VARIABLE","$pdf",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","render",588],"(",")",";",["T_WHITESPACE","\n                ",588],"}",["T_WHITESPACE","\n\n                ",589],["T_RETURN","return",591],["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_prepareDownloadResponse",591],"(",["T_WHITESPACE","\n                    ",591],["T_CONSTANT_ENCAPSED_STRING","'ShippingLabel('",592],["T_WHITESPACE"," ",592],".",["T_WHITESPACE"," ",592],["T_VARIABLE","$shipment",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","getIncrementId",592],"(",")",["T_WHITESPACE"," ",592],".",["T_WHITESPACE"," ",592],["T_CONSTANT_ENCAPSED_STRING","').pdf'",592],",",["T_WHITESPACE","\n                    ",592],["T_VARIABLE","$pdfContent",593],",",["T_WHITESPACE","\n                    ",593],["T_CONSTANT_ENCAPSED_STRING","'application\/pdf'",594],["T_WHITESPACE","\n                ",594],")",";",["T_WHITESPACE","\n            ",595],"}",["T_WHITESPACE","\n        ",596],"}",["T_WHITESPACE"," ",597],["T_CATCH","catch",597],["T_WHITESPACE"," ",597],"(",["T_STRING","Mage_Core_Exception",597],["T_WHITESPACE"," ",597],["T_VARIABLE","$e",597],")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n            ",597],["T_VARIABLE","$this",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","_getSession",598],"(",")",["T_OBJECT_OPERATOR","->",598],["T_STRING","addError",598],"(",["T_VARIABLE","$e",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getMessage",598],"(",")",")",";",["T_WHITESPACE","\n        ",598],"}",["T_WHITESPACE"," ",599],["T_CATCH","catch",599],["T_WHITESPACE"," ",599],"(",["T_STRING","Exception",599],["T_WHITESPACE"," ",599],["T_VARIABLE","$e",599],")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n            ",599],["T_STRING","Mage",600],["T_DOUBLE_COLON","::",600],["T_STRING","logException",600],"(",["T_VARIABLE","$e",600],")",";",["T_WHITESPACE","\n            ",600],["T_VARIABLE","$this",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","_getSession",601],"(",")",["T_WHITESPACE","\n                ",601],["T_OBJECT_OPERATOR","->",602],["T_STRING","addError",602],"(",["T_STRING","Mage",602],["T_DOUBLE_COLON","::",602],["T_STRING","helper",602],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",602],")",["T_OBJECT_OPERATOR","->",602],["T_STRING","__",602],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while creating shipping label.'",602],")",")",";",["T_WHITESPACE","\n       ",602],"}",["T_WHITESPACE","\n       ",603],["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","_redirect",604],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order_shipment\/view'",604],",",["T_WHITESPACE"," ",604],["T_ARRAY","array",604],"(",["T_WHITESPACE","\n           ",604],["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",605],["T_WHITESPACE"," ",605],["T_DOUBLE_ARROW","=>",605],["T_WHITESPACE"," ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","getRequest",605],"(",")",["T_OBJECT_OPERATOR","->",605],["T_STRING","getParam",605],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",605],")",["T_WHITESPACE","\n       ",605],")",")",";",["T_WHITESPACE","\n    ",606],"}",["T_WHITESPACE","\n\n    ",607],["T_DOC_COMMENT","\/**\n     * Create pdf document with information about packages\n     *\n     * @return void\n     *\/",609],["T_WHITESPACE","\n    ",613],["T_PUBLIC","public",614],["T_WHITESPACE"," ",614],["T_FUNCTION","function",614],["T_WHITESPACE"," ",614],["T_STRING","printPackageAction",614],"(",")",["T_WHITESPACE","\n    ",614],"{",["T_WHITESPACE","\n        ",615],["T_VARIABLE","$shipment",616],["T_WHITESPACE"," ",616],"=",["T_WHITESPACE"," ",616],["T_VARIABLE","$this",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","_initShipment",616],"(",")",";",["T_WHITESPACE","\n\n        ",616],["T_IF","if",618],["T_WHITESPACE"," ",618],"(",["T_VARIABLE","$shipment",618],")",["T_WHITESPACE"," ",618],"{",["T_WHITESPACE","\n            ",618],["T_VARIABLE","$pdf",619],["T_WHITESPACE"," ",619],"=",["T_WHITESPACE"," ",619],["T_STRING","Mage",619],["T_DOUBLE_COLON","::",619],["T_STRING","getModel",619],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_pdf_shipment_packaging'",619],")",["T_OBJECT_OPERATOR","->",619],["T_STRING","getPdf",619],"(",["T_VARIABLE","$shipment",619],")",";",["T_WHITESPACE","\n            ",619],["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","_prepareDownloadResponse",620],"(",["T_CONSTANT_ENCAPSED_STRING","'packingslip'",620],".",["T_STRING","Mage",620],["T_DOUBLE_COLON","::",620],["T_STRING","getSingleton",620],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",620],")",["T_OBJECT_OPERATOR","->",620],["T_STRING","date",620],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d_H-i-s'",620],")",".",["T_CONSTANT_ENCAPSED_STRING","'.pdf'",620],",",["T_WHITESPACE","\n                ",620],["T_VARIABLE","$pdf",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","render",621],"(",")",",",["T_WHITESPACE"," ",621],["T_CONSTANT_ENCAPSED_STRING","'application\/pdf'",621],["T_WHITESPACE","\n            ",621],")",";",["T_WHITESPACE","\n        ",622],"}",["T_WHITESPACE","\n        ",623],["T_ELSE","else",624],["T_WHITESPACE"," ",624],"{",["T_WHITESPACE","\n            ",624],["T_VARIABLE","$this",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","_forward",625],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",625],")",";",["T_WHITESPACE","\n        ",625],"}",["T_WHITESPACE","\n    ",626],"}",["T_WHITESPACE","\n\n    ",627],["T_DOC_COMMENT","\/**\n     * Batch print shipping labels for whole shipments.\n     * Push pdf document with shipping labels to user browser\n     *\n     * @return null\n     *\/",629],["T_WHITESPACE","\n    ",634],["T_PUBLIC","public",635],["T_WHITESPACE"," ",635],["T_FUNCTION","function",635],["T_WHITESPACE"," ",635],["T_STRING","massPrintShippingLabelAction",635],"(",")",["T_WHITESPACE","\n    ",635],"{",["T_WHITESPACE","\n        ",636],["T_VARIABLE","$request",637],["T_WHITESPACE"," ",637],"=",["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","getRequest",637],"(",")",";",["T_WHITESPACE","\n        ",637],["T_VARIABLE","$ids",638],["T_WHITESPACE"," ",638],"=",["T_WHITESPACE"," ",638],["T_VARIABLE","$request",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","getParam",638],"(",["T_CONSTANT_ENCAPSED_STRING","'order_ids'",638],")",";",["T_WHITESPACE","\n        ",638],["T_VARIABLE","$createdFromOrders",639],["T_WHITESPACE"," ",639],"=",["T_WHITESPACE"," ",639],"!",["T_EMPTY","empty",639],"(",["T_VARIABLE","$ids",639],")",";",["T_WHITESPACE","\n        ",639],["T_VARIABLE","$shipments",640],["T_WHITESPACE"," ",640],"=",["T_WHITESPACE"," ",640],["T_STRING","null",640],";",["T_WHITESPACE","\n        ",640],["T_VARIABLE","$labelsContent",641],["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_ARRAY","array",641],"(",")",";",["T_WHITESPACE","\n        ",641],["T_SWITCH","switch",642],["T_WHITESPACE"," ",642],"(",["T_VARIABLE","$request",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","getParam",642],"(",["T_CONSTANT_ENCAPSED_STRING","'massaction_prepare_key'",642],")",")",["T_WHITESPACE"," ",642],"{",["T_WHITESPACE","\n            ",642],["T_CASE","case",643],["T_WHITESPACE"," ",643],["T_CONSTANT_ENCAPSED_STRING","'shipment_ids'",643],":",["T_WHITESPACE","\n                ",643],["T_VARIABLE","$ids",644],["T_WHITESPACE"," ",644],"=",["T_WHITESPACE"," ",644],["T_VARIABLE","$request",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getParam",644],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_ids'",644],")",";",["T_WHITESPACE","\n                ",644],["T_STRING","array_filter",645],"(",["T_VARIABLE","$ids",645],",",["T_WHITESPACE"," ",645],["T_CONSTANT_ENCAPSED_STRING","'intval'",645],")",";",["T_WHITESPACE","\n                ",645],["T_IF","if",646],["T_WHITESPACE"," ",646],"(","!",["T_EMPTY","empty",646],"(",["T_VARIABLE","$ids",646],")",")",["T_WHITESPACE"," ",646],"{",["T_WHITESPACE","\n                    ",646],["T_VARIABLE","$shipments",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_STRING","Mage",647],["T_DOUBLE_COLON","::",647],["T_STRING","getResourceModel",647],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_collection'",647],")",["T_WHITESPACE","\n                        ",647],["T_OBJECT_OPERATOR","->",648],["T_STRING","addFieldToFilter",648],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",648],",",["T_WHITESPACE"," ",648],["T_ARRAY","array",648],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",648],["T_WHITESPACE"," ",648],["T_DOUBLE_ARROW","=>",648],["T_WHITESPACE"," ",648],["T_VARIABLE","$ids",648],")",")",";",["T_WHITESPACE","\n                ",648],"}",["T_WHITESPACE","\n                ",649],["T_BREAK","break",650],";",["T_WHITESPACE","\n            ",650],["T_CASE","case",651],["T_WHITESPACE"," ",651],["T_CONSTANT_ENCAPSED_STRING","'order_ids'",651],":",["T_WHITESPACE","\n                ",651],["T_VARIABLE","$ids",652],["T_WHITESPACE"," ",652],"=",["T_WHITESPACE"," ",652],["T_VARIABLE","$request",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","getParam",652],"(",["T_CONSTANT_ENCAPSED_STRING","'order_ids'",652],")",";",["T_WHITESPACE","\n                ",652],["T_STRING","array_filter",653],"(",["T_VARIABLE","$ids",653],",",["T_WHITESPACE"," ",653],["T_CONSTANT_ENCAPSED_STRING","'intval'",653],")",";",["T_WHITESPACE","\n                ",653],["T_IF","if",654],["T_WHITESPACE"," ",654],"(","!",["T_EMPTY","empty",654],"(",["T_VARIABLE","$ids",654],")",")",["T_WHITESPACE"," ",654],"{",["T_WHITESPACE","\n                    ",654],["T_VARIABLE","$shipments",655],["T_WHITESPACE"," ",655],"=",["T_WHITESPACE"," ",655],["T_STRING","Mage",655],["T_DOUBLE_COLON","::",655],["T_STRING","getResourceModel",655],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_collection'",655],")",["T_WHITESPACE","\n                        ",655],["T_OBJECT_OPERATOR","->",656],["T_STRING","setOrderFilter",656],"(",["T_ARRAY","array",656],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",656],["T_WHITESPACE"," ",656],["T_DOUBLE_ARROW","=>",656],["T_WHITESPACE"," ",656],["T_VARIABLE","$ids",656],")",")",";",["T_WHITESPACE","\n                ",656],"}",["T_WHITESPACE","\n                ",657],["T_BREAK","break",658],";",["T_WHITESPACE","\n        ",658],"}",["T_WHITESPACE","\n\n        ",659],["T_IF","if",661],["T_WHITESPACE"," ",661],"(",["T_VARIABLE","$shipments",661],["T_WHITESPACE"," ",661],["T_BOOLEAN_AND","&&",661],["T_WHITESPACE"," ",661],["T_VARIABLE","$shipments",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","getSize",661],"(",")",")",["T_WHITESPACE"," ",661],"{",["T_WHITESPACE","\n            ",661],["T_FOREACH","foreach",662],["T_WHITESPACE"," ",662],"(",["T_VARIABLE","$shipments",662],["T_WHITESPACE"," ",662],["T_AS","as",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$shipment",662],")",["T_WHITESPACE"," ",662],"{",["T_WHITESPACE","\n                ",662],["T_VARIABLE","$labelContent",663],["T_WHITESPACE"," ",663],"=",["T_WHITESPACE"," ",663],["T_VARIABLE","$shipment",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","getShippingLabel",663],"(",")",";",["T_WHITESPACE","\n                ",663],["T_IF","if",664],["T_WHITESPACE"," ",664],"(",["T_VARIABLE","$labelContent",664],")",["T_WHITESPACE"," ",664],"{",["T_WHITESPACE","\n                    ",664],["T_VARIABLE","$labelsContent",665],"[","]",["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$labelContent",665],";",["T_WHITESPACE","\n                ",665],"}",["T_WHITESPACE","\n            ",666],"}",["T_WHITESPACE","\n        ",667],"}",["T_WHITESPACE","\n\n        ",668],["T_IF","if",670],["T_WHITESPACE"," ",670],"(","!",["T_EMPTY","empty",670],"(",["T_VARIABLE","$labelsContent",670],")",")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n            ",670],["T_VARIABLE","$outputPdf",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","_combineLabelsPdf",671],"(",["T_VARIABLE","$labelsContent",671],")",";",["T_WHITESPACE","\n            ",671],["T_VARIABLE","$this",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","_prepareDownloadResponse",672],"(",["T_CONSTANT_ENCAPSED_STRING","'ShippingLabels.pdf'",672],",",["T_WHITESPACE"," ",672],["T_VARIABLE","$outputPdf",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","render",672],"(",")",",",["T_WHITESPACE"," ",672],["T_CONSTANT_ENCAPSED_STRING","'application\/pdf'",672],")",";",["T_WHITESPACE","\n            ",672],["T_RETURN","return",673],";",["T_WHITESPACE","\n        ",673],"}",["T_WHITESPACE","\n\n        ",674],["T_IF","if",676],["T_WHITESPACE"," ",676],"(",["T_VARIABLE","$createdFromOrders",676],")",["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n            ",676],["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","_getSession",677],"(",")",["T_WHITESPACE","\n                ",677],["T_OBJECT_OPERATOR","->",678],["T_STRING","addError",678],"(",["T_STRING","Mage",678],["T_DOUBLE_COLON","::",678],["T_STRING","helper",678],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",678],")",["T_OBJECT_OPERATOR","->",678],["T_STRING","__",678],"(",["T_CONSTANT_ENCAPSED_STRING","'There are no shipping labels related to selected orders.'",678],")",")",";",["T_WHITESPACE","\n            ",678],["T_VARIABLE","$this",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","_redirect",679],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order\/index'",679],")",";",["T_WHITESPACE","\n        ",679],"}",["T_WHITESPACE"," ",680],["T_ELSE","else",680],["T_WHITESPACE"," ",680],"{",["T_WHITESPACE","\n            ",680],["T_VARIABLE","$this",681],["T_OBJECT_OPERATOR","->",681],["T_STRING","_getSession",681],"(",")",["T_WHITESPACE","\n                ",681],["T_OBJECT_OPERATOR","->",682],["T_STRING","addError",682],"(",["T_STRING","Mage",682],["T_DOUBLE_COLON","::",682],["T_STRING","helper",682],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",682],")",["T_OBJECT_OPERATOR","->",682],["T_STRING","__",682],"(",["T_CONSTANT_ENCAPSED_STRING","'There are no shipping labels related to selected shipments.'",682],")",")",";",["T_WHITESPACE","\n            ",682],["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","_redirect",683],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/sales_order_shipment\/index'",683],")",";",["T_WHITESPACE","\n        ",683],"}",["T_WHITESPACE","\n    ",684],"}",["T_WHITESPACE","\n\n    ",685],["T_DOC_COMMENT","\/**\n     * Combine array of labels as instance PDF\n     *\n     * @param array $labelsContent\n     * @return Zend_Pdf\n     *\/",687],["T_WHITESPACE","\n    ",692],["T_PROTECTED","protected",693],["T_WHITESPACE"," ",693],["T_FUNCTION","function",693],["T_WHITESPACE"," ",693],["T_STRING","_combineLabelsPdf",693],"(",["T_ARRAY","array",693],["T_WHITESPACE"," ",693],["T_VARIABLE","$labelsContent",693],")",["T_WHITESPACE","\n    ",693],"{",["T_WHITESPACE","\n        ",694],["T_VARIABLE","$outputPdf",695],["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_NEW","new",695],["T_WHITESPACE"," ",695],["T_STRING","Zend_Pdf",695],"(",")",";",["T_WHITESPACE","\n        ",695],["T_FOREACH","foreach",696],["T_WHITESPACE"," ",696],"(",["T_VARIABLE","$labelsContent",696],["T_WHITESPACE"," ",696],["T_AS","as",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$content",696],")",["T_WHITESPACE"," ",696],"{",["T_WHITESPACE","\n            ",696],["T_IF","if",697],["T_WHITESPACE"," ",697],"(",["T_STRING","stripos",697],"(",["T_VARIABLE","$content",697],",",["T_WHITESPACE"," ",697],["T_CONSTANT_ENCAPSED_STRING","'%PDF-'",697],")",["T_WHITESPACE"," ",697],["T_IS_NOT_IDENTICAL","!==",697],["T_WHITESPACE"," ",697],["T_STRING","false",697],")",["T_WHITESPACE"," ",697],"{",["T_WHITESPACE","\n                ",697],["T_VARIABLE","$pdfLabel",698],["T_WHITESPACE"," ",698],"=",["T_WHITESPACE"," ",698],["T_STRING","Zend_Pdf",698],["T_DOUBLE_COLON","::",698],["T_STRING","parse",698],"(",["T_VARIABLE","$content",698],")",";",["T_WHITESPACE","\n                ",698],["T_FOREACH","foreach",699],["T_WHITESPACE"," ",699],"(",["T_VARIABLE","$pdfLabel",699],["T_OBJECT_OPERATOR","->",699],["T_STRING","pages",699],["T_WHITESPACE"," ",699],["T_AS","as",699],["T_WHITESPACE"," ",699],["T_VARIABLE","$page",699],")",["T_WHITESPACE"," ",699],"{",["T_WHITESPACE","\n                    ",699],["T_VARIABLE","$outputPdf",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","pages",700],"[","]",["T_WHITESPACE"," ",700],"=",["T_WHITESPACE"," ",700],["T_CLONE","clone",700],["T_WHITESPACE"," ",700],["T_VARIABLE","$page",700],";",["T_WHITESPACE","\n                ",700],"}",["T_WHITESPACE","\n            ",701],"}",["T_WHITESPACE"," ",702],["T_ELSE","else",702],["T_WHITESPACE"," ",702],"{",["T_WHITESPACE","\n                ",702],["T_VARIABLE","$page",703],["T_WHITESPACE"," ",703],"=",["T_WHITESPACE"," ",703],["T_VARIABLE","$this",703],["T_OBJECT_OPERATOR","->",703],["T_STRING","_createPdfPageFromImageString",703],"(",["T_VARIABLE","$content",703],")",";",["T_WHITESPACE","\n                ",703],["T_IF","if",704],["T_WHITESPACE"," ",704],"(",["T_VARIABLE","$page",704],")",["T_WHITESPACE"," ",704],"{",["T_WHITESPACE","\n                    ",704],["T_VARIABLE","$outputPdf",705],["T_OBJECT_OPERATOR","->",705],["T_STRING","pages",705],"[","]",["T_WHITESPACE"," ",705],"=",["T_WHITESPACE"," ",705],["T_VARIABLE","$page",705],";",["T_WHITESPACE","\n                ",705],"}",["T_WHITESPACE","\n            ",706],"}",["T_WHITESPACE","\n        ",707],"}",["T_WHITESPACE","\n        ",708],["T_RETURN","return",709],["T_WHITESPACE"," ",709],["T_VARIABLE","$outputPdf",709],";",["T_WHITESPACE","\n    ",709],"}",["T_WHITESPACE","\n\n    ",710],["T_DOC_COMMENT","\/**\n     * Create Zend_Pdf_Page instance with image from $imageString. Supports JPEG, PNG, GIF, WBMP, and GD2 formats.\n     *\n     * @param string $imageString\n     * @return Zend_Pdf_Page|bool\n     *\/",712],["T_WHITESPACE","\n    ",717],["T_PROTECTED","protected",718],["T_WHITESPACE"," ",718],["T_FUNCTION","function",718],["T_WHITESPACE"," ",718],["T_STRING","_createPdfPageFromImageString",718],"(",["T_VARIABLE","$imageString",718],")",["T_WHITESPACE","\n    ",718],"{",["T_WHITESPACE","\n        ",719],["T_VARIABLE","$image",720],["T_WHITESPACE"," ",720],"=",["T_WHITESPACE"," ",720],["T_STRING","imagecreatefromstring",720],"(",["T_VARIABLE","$imageString",720],")",";",["T_WHITESPACE","\n        ",720],["T_IF","if",721],["T_WHITESPACE"," ",721],"(","!",["T_VARIABLE","$image",721],")",["T_WHITESPACE"," ",721],"{",["T_WHITESPACE","\n            ",721],["T_RETURN","return",722],["T_WHITESPACE"," ",722],["T_STRING","false",722],";",["T_WHITESPACE","\n        ",722],"}",["T_WHITESPACE","\n\n        ",723],["T_VARIABLE","$xSize",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","imagesx",725],"(",["T_VARIABLE","$image",725],")",";",["T_WHITESPACE","\n        ",725],["T_VARIABLE","$ySize",726],["T_WHITESPACE"," ",726],"=",["T_WHITESPACE"," ",726],["T_STRING","imagesy",726],"(",["T_VARIABLE","$image",726],")",";",["T_WHITESPACE","\n        ",726],["T_VARIABLE","$page",727],["T_WHITESPACE"," ",727],"=",["T_WHITESPACE"," ",727],["T_NEW","new",727],["T_WHITESPACE"," ",727],["T_STRING","Zend_Pdf_Page",727],"(",["T_VARIABLE","$xSize",727],",",["T_WHITESPACE"," ",727],["T_VARIABLE","$ySize",727],")",";",["T_WHITESPACE","\n\n        ",727],["T_STRING","imageinterlace",729],"(",["T_VARIABLE","$image",729],",",["T_WHITESPACE"," ",729],["T_LNUMBER","0",729],")",";",["T_WHITESPACE","\n        ",729],["T_VARIABLE","$tmpFileName",730],["T_WHITESPACE"," ",730],"=",["T_WHITESPACE"," ",730],["T_STRING","sys_get_temp_dir",730],"(",")",["T_WHITESPACE"," ",730],".",["T_WHITESPACE"," ",730],["T_STRING","DS",730],["T_WHITESPACE"," ",730],".",["T_WHITESPACE"," ",730],["T_CONSTANT_ENCAPSED_STRING","'shipping_labels_'",730],["T_WHITESPACE","\n                     ",730],".",["T_WHITESPACE"," ",731],["T_STRING","uniqid",731],"(",["T_STRING","mt_rand",731],"(",")",")",["T_WHITESPACE"," ",731],".",["T_WHITESPACE"," ",731],["T_STRING","time",731],"(",")",["T_WHITESPACE"," ",731],".",["T_WHITESPACE"," ",731],["T_CONSTANT_ENCAPSED_STRING","'.png'",731],";",["T_WHITESPACE","\n        ",731],["T_STRING","imagepng",732],"(",["T_VARIABLE","$image",732],",",["T_WHITESPACE"," ",732],["T_VARIABLE","$tmpFileName",732],")",";",["T_WHITESPACE","\n        ",732],["T_VARIABLE","$pdfImage",733],["T_WHITESPACE"," ",733],"=",["T_WHITESPACE"," ",733],["T_STRING","Zend_Pdf_Image",733],["T_DOUBLE_COLON","::",733],["T_STRING","imageWithPath",733],"(",["T_VARIABLE","$tmpFileName",733],")",";",["T_WHITESPACE","\n        ",733],["T_VARIABLE","$page",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","drawImage",734],"(",["T_VARIABLE","$pdfImage",734],",",["T_WHITESPACE"," ",734],["T_LNUMBER","0",734],",",["T_WHITESPACE"," ",734],["T_LNUMBER","0",734],",",["T_WHITESPACE"," ",734],["T_VARIABLE","$xSize",734],",",["T_WHITESPACE"," ",734],["T_VARIABLE","$ySize",734],")",";",["T_WHITESPACE","\n        ",734],["T_STRING","unlink",735],"(",["T_VARIABLE","$tmpFileName",735],")",";",["T_WHITESPACE","\n        ",735],["T_RETURN","return",736],["T_WHITESPACE"," ",736],["T_VARIABLE","$page",736],";",["T_WHITESPACE","\n    ",736],"}",["T_WHITESPACE","\n\n    ",737],["T_DOC_COMMENT","\/**\n     * Return grid with shipping items for Ajax request\n     *\n     * @return Mage_Core_Controller_Response_Http\n     *\/",739],["T_WHITESPACE","\n    ",743],["T_PUBLIC","public",744],["T_WHITESPACE"," ",744],["T_FUNCTION","function",744],["T_WHITESPACE"," ",744],["T_STRING","getShippingItemsGridAction",744],"(",")",["T_WHITESPACE","\n    ",744],"{",["T_WHITESPACE","\n        ",745],["T_VARIABLE","$this",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","_initShipment",746],"(",")",";",["T_WHITESPACE","\n        ",746],["T_RETURN","return",747],["T_WHITESPACE"," ",747],["T_VARIABLE","$this",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","getResponse",747],"(",")",["T_OBJECT_OPERATOR","->",747],["T_STRING","setBody",747],"(",["T_WHITESPACE","\n            ",747],["T_VARIABLE","$this",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","getLayout",748],"(",")",["T_WHITESPACE","\n                ",748],["T_OBJECT_OPERATOR","->",749],["T_STRING","createBlock",749],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/sales_order_shipment_packaging_grid'",749],")",["T_WHITESPACE","\n                ",749],["T_OBJECT_OPERATOR","->",750],["T_STRING","setIndex",750],"(",["T_VARIABLE","$this",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","getRequest",750],"(",")",["T_OBJECT_OPERATOR","->",750],["T_STRING","getParam",750],"(",["T_CONSTANT_ENCAPSED_STRING","'index'",750],")",")",["T_WHITESPACE","\n                ",750],["T_OBJECT_OPERATOR","->",751],["T_STRING","toHtml",751],"(",")",["T_WHITESPACE","\n           ",751],")",";",["T_WHITESPACE","\n    ",752],"}",["T_WHITESPACE","\n",753],"}",["T_WHITESPACE","\n",754]]