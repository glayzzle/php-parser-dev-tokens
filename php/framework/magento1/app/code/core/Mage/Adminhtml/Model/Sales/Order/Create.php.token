[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Order create model\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Adminhtml_Model_Sales_Order_Create",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Varien_Object",35],["T_WHITESPACE"," ",35],["T_IMPLEMENTS","implements",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Cart_Interface",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Quote session object\n     *\n     * @var Mage_Adminhtml_Model_Session_Quote\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_session",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Quote customer wishlist model object\n     *\n     * @var Mage_Wishlist_Model_Wishlist\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_wishlist",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Sales Quote instance\n     *\n     * @var Mage_Sales_Model_Quote\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_cart",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Catalog Compare List instance\n     *\n     * @var Mage_Catalog_Model_Product_Compare_List\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_compareList",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Re-collect quote flag\n     *\n     * @var boolean\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_needCollect",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Re-collect cart flag\n     *\n     * @var boolean\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_needCollectCart",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","false",77],";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Collect (import) data and validate it flag\n     *\n     * @var boolean\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$_isValidate",84],["T_WHITESPACE","              ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","false",84],";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Customer instance\n     *\n     * @var Mage_Customer_Model_Customer\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$_customer",91],";",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Customer Address Form instance\n     *\n     * @var Mage_Customer_Model_Form\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PROTECTED","protected",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$_customerAddressForm",98],";",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Customer Form instance\n     *\n     * @var Mage_Customer_Model_Form\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$_customerForm",105],";",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Array of validate errors\n     *\n     * @var array\n     *\/",107],["T_WHITESPACE","\n    ",111],["T_PROTECTED","protected",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$_errors",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_ARRAY","array",112],"(",")",";",["T_WHITESPACE","\n\n    ",112],["T_DOC_COMMENT","\/**\n     * Quote associated with the model\n     *\n     * @var Mage_Sales_Model_Quote\n     *\/",114],["T_WHITESPACE","\n    ",118],["T_PROTECTED","protected",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$_quote",119],";",["T_WHITESPACE","\n\n    ",119],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","__construct",121],"(",")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_session",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","Mage",123],["T_DOUBLE_COLON","::",123],["T_STRING","getSingleton",123],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session_quote'",123],")",";",["T_WHITESPACE","\n    ",123],"}",["T_WHITESPACE","\n\n    ",124],["T_DOC_COMMENT","\/**\n     * Set validate data in import data flag\n     *\n     * @param boolean $flag\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",126],["T_WHITESPACE","\n    ",131],["T_PUBLIC","public",132],["T_WHITESPACE"," ",132],["T_FUNCTION","function",132],["T_WHITESPACE"," ",132],["T_STRING","setIsValidate",132],"(",["T_VARIABLE","$flag",132],")",["T_WHITESPACE","\n    ",132],"{",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_isValidate",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_BOOL_CAST","(bool)",134],["T_VARIABLE","$flag",134],";",["T_WHITESPACE","\n        ",134],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Return is validate data in import flag\n     *\n     * @return boolean\n     *\/",138],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","getIsValidate",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_isValidate",145],";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Retrieve quote item\n     *\n     * @param   int|Mage_Sales_Model_Quote_Item $item\n     * @return  Mage_Sales_Model_Quote_Item\n     *\/",148],["T_WHITESPACE","\n    ",153],["T_PROTECTED","protected",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","_getQuoteItem",154],"(",["T_VARIABLE","$item",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$item",156],["T_WHITESPACE"," ",156],["T_INSTANCEOF","instanceof",156],["T_WHITESPACE"," ",156],["T_STRING","Mage_Sales_Model_Quote_Item",156],")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_RETURN","return",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$item",157],";",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE"," ",158],["T_ELSEIF","elseif",158],["T_WHITESPACE"," ",158],"(",["T_STRING","is_numeric",158],"(",["T_VARIABLE","$item",158],")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getSession",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getQuote",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getItemById",159],"(",["T_VARIABLE","$item",159],")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n        ",160],["T_RETURN","return",161],["T_WHITESPACE"," ",161],["T_STRING","false",161],";",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * Initialize data for price rules\n     *\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",164],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","initRuleData",169],"(",")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_STRING","Mage",171],["T_DOUBLE_COLON","::",171],["T_STRING","register",171],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_data'",171],",",["T_WHITESPACE"," ",171],["T_NEW","new",171],["T_WHITESPACE"," ",171],["T_STRING","Varien_Object",171],"(",["T_ARRAY","array",171],"(",["T_WHITESPACE","\n            ",171],["T_CONSTANT_ENCAPSED_STRING","'store_id'",172],["T_WHITESPACE","  ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_session",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getStore",172],"(",")",["T_OBJECT_OPERATOR","->",172],["T_STRING","getId",172],"(",")",",",["T_WHITESPACE","\n            ",172],["T_CONSTANT_ENCAPSED_STRING","'website_id'",173],["T_WHITESPACE","  ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_session",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getStore",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","getWebsiteId",173],"(",")",",",["T_WHITESPACE","\n            ",173],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getCustomerGroupId",174],"(",")",",",["T_WHITESPACE","\n        ",174],")",")",")",";",["T_WHITESPACE","\n        ",175],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n\n    ",177],["T_DOC_COMMENT","\/**\n     * Set collect totals flag for quote\n     *\n     * @param   bool $flag\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",179],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","setRecollect",185],"(",["T_VARIABLE","$flag",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_needCollect",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$flag",187],";",["T_WHITESPACE","\n        ",187],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Recollect totals for customer cart.\n     * Set recollect totals flag for quote\n     *\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",191],["T_WHITESPACE","\n    ",196],["T_PUBLIC","public",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","recollectCart",197],"(",")","{",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_needCollectCart",198],["T_WHITESPACE"," ",198],["T_IS_IDENTICAL","===",198],["T_WHITESPACE"," ",198],["T_STRING","true",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getCustomerCart",199],"(",")",["T_WHITESPACE","\n                ",199],["T_OBJECT_OPERATOR","->",200],["T_STRING","collectTotals",200],"(",")",["T_WHITESPACE","\n                ",200],["T_OBJECT_OPERATOR","->",201],["T_STRING","save",201],"(",")",";",["T_WHITESPACE","\n        ",201],"}",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","setRecollect",203],"(",["T_STRING","true",203],")",";",["T_WHITESPACE","\n        ",203],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Quote saving\n     *\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",207],["T_WHITESPACE","\n    ",211],["T_PUBLIC","public",212],["T_WHITESPACE"," ",212],["T_FUNCTION","function",212],["T_WHITESPACE"," ",212],["T_STRING","saveQuote",212],"(",")",["T_WHITESPACE","\n    ",212],"{",["T_WHITESPACE","\n        ",213],["T_IF","if",214],["T_WHITESPACE"," ",214],"(","!",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getQuote",214],"(",")",["T_OBJECT_OPERATOR","->",214],["T_STRING","getId",214],"(",")",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],";",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n\n        ",216],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_needCollect",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getQuote",219],"(",")",["T_OBJECT_OPERATOR","->",219],["T_STRING","collectTotals",219],"(",")",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n\n        ",220],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getQuote",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","save",222],"(",")",";",["T_WHITESPACE","\n        ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Retrieve session model object of quote\n     *\n     * @return Mage_Adminhtml_Model_Session_Quote\n     *\/",226],["T_WHITESPACE","\n    ",230],["T_PUBLIC","public",231],["T_WHITESPACE"," ",231],["T_FUNCTION","function",231],["T_WHITESPACE"," ",231],["T_STRING","getSession",231],"(",")",["T_WHITESPACE","\n    ",231],"{",["T_WHITESPACE","\n        ",232],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_session",233],";",["T_WHITESPACE","\n    ",233],"}",["T_WHITESPACE","\n\n    ",234],["T_DOC_COMMENT","\/**\n     * Retrieve quote object model\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",236],["T_WHITESPACE","\n    ",240],["T_PUBLIC","public",241],["T_WHITESPACE"," ",241],["T_FUNCTION","function",241],["T_WHITESPACE"," ",241],["T_STRING","getQuote",241],"(",")",["T_WHITESPACE","\n    ",241],"{",["T_WHITESPACE","\n        ",242],["T_IF","if",243],["T_WHITESPACE"," ",243],"(","!",["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_quote",243],")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_quote",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getSession",244],"(",")",["T_OBJECT_OPERATOR","->",244],["T_STRING","getQuote",244],"(",")",";",["T_WHITESPACE","\n        ",244],"}",["T_WHITESPACE","\n        ",245],["T_RETURN","return",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_quote",246],";",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * Set quote object\n     *\n     * @param Mage_Sales_Model_Quote $quote\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",249],["T_WHITESPACE","\n    ",254],["T_PUBLIC","public",255],["T_WHITESPACE"," ",255],["T_FUNCTION","function",255],["T_WHITESPACE"," ",255],["T_STRING","setQuote",255],"(",["T_STRING","Mage_Sales_Model_Quote",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$quote",255],")",["T_WHITESPACE","\n    ",255],"{",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","_quote",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$quote",257],";",["T_WHITESPACE","\n        ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],";",["T_WHITESPACE","\n    ",258],"}",["T_WHITESPACE","\n\n    ",259],["T_DOC_COMMENT","\/**\n     * Initialize creation data from existing order\n     *\n     * @param Mage_Sales_Model_Order $order\n     * @return unknown\n     *\/",261],["T_WHITESPACE","\n    ",266],["T_PUBLIC","public",267],["T_WHITESPACE"," ",267],["T_FUNCTION","function",267],["T_WHITESPACE"," ",267],["T_STRING","initFromOrder",267],"(",["T_STRING","Mage_Sales_Model_Order",267],["T_WHITESPACE"," ",267],["T_VARIABLE","$order",267],")",["T_WHITESPACE","\n    ",267],"{",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$session",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getSession",269],"(",")",";",["T_WHITESPACE","\n        ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(","!",["T_VARIABLE","$order",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getReordered",270],"(",")",")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$session",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","setOrderId",271],"(",["T_VARIABLE","$order",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getId",271],"(",")",")",";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE"," ",272],["T_ELSE","else",272],["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$session",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","setReordered",273],"(",["T_VARIABLE","$order",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getId",273],"(",")",")",";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE","\n\n        ",274],["T_DOC_COMMENT","\/**\n         * Check if we edit quest order\n         *\/",276],["T_WHITESPACE","\n        ",278],["T_VARIABLE","$session",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","setCurrencyId",279],"(",["T_VARIABLE","$order",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","getOrderCurrencyCode",279],"(",")",")",";",["T_WHITESPACE","\n        ",279],["T_IF","if",280],["T_WHITESPACE"," ",280],"(",["T_VARIABLE","$order",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getCustomerId",280],"(",")",")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$session",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","setCustomerId",281],"(",["T_VARIABLE","$order",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getCustomerId",281],"(",")",")",";",["T_WHITESPACE","\n        ",281],"}",["T_WHITESPACE"," ",282],["T_ELSE","else",282],["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$session",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","setCustomerId",283],"(",["T_STRING","false",283],")",";",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE","\n\n        ",284],["T_VARIABLE","$session",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","setStoreId",286],"(",["T_VARIABLE","$order",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getStoreId",286],"(",")",")",";",["T_WHITESPACE","\n\n        ",286],["T_COMMENT","\/\/Notify other modules about the session quote\n",288],["T_WHITESPACE","        ",289],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","dispatchEvent",289],"(",["T_CONSTANT_ENCAPSED_STRING","'init_from_order_session_quote_initialized'",289],",",["T_WHITESPACE","\n                ",289],["T_ARRAY","array",290],"(",["T_CONSTANT_ENCAPSED_STRING","'session_quote'",290],["T_WHITESPACE"," ",290],["T_DOUBLE_ARROW","=>",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$session",290],")",")",";",["T_WHITESPACE","\n\n        ",290],["T_DOC_COMMENT","\/**\n         * Initialize catalog rule data with new session values\n         *\/",292],["T_WHITESPACE","\n        ",294],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","initRuleData",295],"(",")",";",["T_WHITESPACE","\n        ",295],["T_FOREACH","foreach",296],["T_WHITESPACE"," ",296],"(",["T_VARIABLE","$order",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getItemsCollection",296],"(",["T_WHITESPACE","\n            ",296],["T_STRING","array_keys",297],"(",["T_STRING","Mage",297],["T_DOUBLE_COLON","::",297],["T_STRING","getConfig",297],"(",")",["T_OBJECT_OPERATOR","->",297],["T_STRING","getNode",297],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/sales\/order\/create\/available_product_types'",297],")",["T_OBJECT_OPERATOR","->",297],["T_STRING","asArray",297],"(",")",")",",",["T_WHITESPACE","\n            ",297],["T_STRING","true",298],["T_WHITESPACE","\n            ",298],")",["T_WHITESPACE"," ",299],["T_AS","as",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$orderItem",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n            ",299],["T_COMMENT","\/* @var $orderItem Mage_Sales_Model_Order_Item *\/",300],["T_WHITESPACE","\n            ",300],["T_IF","if",301],["T_WHITESPACE"," ",301],"(","!",["T_VARIABLE","$orderItem",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getParentItem",301],"(",")",")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n                ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_VARIABLE","$order",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getReordered",302],"(",")",")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n                    ",302],["T_VARIABLE","$qty",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$orderItem",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getQtyOrdered",303],"(",")",";",["T_WHITESPACE","\n                ",303],"}",["T_WHITESPACE"," ",304],["T_ELSE","else",304],["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n                    ",304],["T_VARIABLE","$qty",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$orderItem",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getQtyOrdered",305],"(",")",["T_WHITESPACE"," ",305],"-",["T_WHITESPACE"," ",305],["T_VARIABLE","$orderItem",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getQtyShipped",305],"(",")",["T_WHITESPACE"," ",305],"-",["T_WHITESPACE"," ",305],["T_VARIABLE","$orderItem",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getQtyInvoiced",305],"(",")",";",["T_WHITESPACE","\n                ",305],"}",["T_WHITESPACE","\n\n                ",306],["T_IF","if",308],["T_WHITESPACE"," ",308],"(",["T_VARIABLE","$qty",308],["T_WHITESPACE"," ",308],">",["T_WHITESPACE"," ",308],["T_LNUMBER","0",308],")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n                    ",308],["T_VARIABLE","$item",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","initFromOrderItem",309],"(",["T_VARIABLE","$orderItem",309],",",["T_WHITESPACE"," ",309],["T_VARIABLE","$qty",309],")",";",["T_WHITESPACE","\n                    ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(",["T_STRING","is_string",310],"(",["T_VARIABLE","$item",310],")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                        ",310],["T_STRING","Mage",311],["T_DOUBLE_COLON","::",311],["T_STRING","throwException",311],"(",["T_VARIABLE","$item",311],")",";",["T_WHITESPACE","\n                    ",311],"}",["T_WHITESPACE","\n                ",312],"}",["T_WHITESPACE","\n            ",313],"}",["T_WHITESPACE","\n        ",314],"}",["T_WHITESPACE","\n\n        ",315],["T_VARIABLE","$orderShippingAddress",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_VARIABLE","$order",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getShippingAddress",317],"(",")",";",["T_WHITESPACE","\n        ",317],["T_IF","if",318],["T_WHITESPACE"," ",318],"(",["T_VARIABLE","$orderShippingAddress",318],")",["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n            ",318],["T_VARIABLE","$addressDiff",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_STRING","array_diff_assoc",319],"(",["T_VARIABLE","$orderShippingAddress",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getData",319],"(",")",",",["T_WHITESPACE"," ",319],["T_VARIABLE","$order",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getBillingAddress",319],"(",")",["T_OBJECT_OPERATOR","->",319],["T_STRING","getData",319],"(",")",")",";",["T_WHITESPACE","\n            ",319],["T_UNSET","unset",320],"(",["T_VARIABLE","$addressDiff",320],"[",["T_CONSTANT_ENCAPSED_STRING","'address_type'",320],"]",",",["T_WHITESPACE"," ",320],["T_VARIABLE","$addressDiff",320],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",320],"]",")",";",["T_WHITESPACE","\n            ",320],["T_VARIABLE","$orderShippingAddress",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","setSameAsBilling",321],"(",["T_EMPTY","empty",321],"(",["T_VARIABLE","$addressDiff",321],")",")",";",["T_WHITESPACE","\n        ",321],"}",["T_WHITESPACE","\n\n        ",322],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_initBillingAddressFromOrder",324],"(",["T_VARIABLE","$order",324],")",";",["T_WHITESPACE","\n        ",324],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_initShippingAddressFromOrder",325],"(",["T_VARIABLE","$order",325],")",";",["T_WHITESPACE","\n\n        ",325],["T_VARIABLE","$quote",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getQuote",327],"(",")",";",["T_WHITESPACE","\n        ",327],["T_IF","if",328],["T_WHITESPACE"," ",328],"(","!",["T_VARIABLE","$quote",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","isVirtual",328],"(",")",["T_WHITESPACE"," ",328],["T_BOOLEAN_AND","&&",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","getShippingAddress",328],"(",")",["T_OBJECT_OPERATOR","->",328],["T_STRING","getSameAsBilling",328],"(",")",")",["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n            ",328],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","setShippingAsBilling",329],"(",["T_LNUMBER","1",329],")",";",["T_WHITESPACE","\n        ",329],"}",["T_WHITESPACE","\n\n        ",330],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","setShippingMethod",332],"(",["T_VARIABLE","$order",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getShippingMethod",332],"(",")",")",";",["T_WHITESPACE","\n        ",332],["T_VARIABLE","$quote",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getShippingAddress",333],"(",")",["T_OBJECT_OPERATOR","->",333],["T_STRING","setShippingDescription",333],"(",["T_VARIABLE","$order",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getShippingDescription",333],"(",")",")",";",["T_WHITESPACE","\n\n        ",333],["T_VARIABLE","$quote",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getPayment",335],"(",")",["T_OBJECT_OPERATOR","->",335],["T_STRING","addData",335],"(",["T_VARIABLE","$order",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getPayment",335],"(",")",["T_OBJECT_OPERATOR","->",335],["T_STRING","getData",335],"(",")",")",";",["T_WHITESPACE","\n\n\n        ",335],["T_VARIABLE","$orderCouponCode",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$order",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getCouponCode",338],"(",")",";",["T_WHITESPACE","\n        ",338],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$orderCouponCode",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$quote",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","setCouponCode",340],"(",["T_VARIABLE","$orderCouponCode",340],")",";",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n\n        ",341],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_VARIABLE","$quote",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getCouponCode",343],"(",")",")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n            ",343],["T_VARIABLE","$quote",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","collectTotals",344],"(",")",";",["T_WHITESPACE","\n        ",344],"}",["T_WHITESPACE","\n\n        ",345],["T_STRING","Mage",347],["T_DOUBLE_COLON","::",347],["T_STRING","helper",347],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",347],")",["T_OBJECT_OPERATOR","->",347],["T_STRING","copyFieldset",347],"(",["T_WHITESPACE","\n            ",347],["T_CONSTANT_ENCAPSED_STRING","'sales_copy_order'",348],",",["T_WHITESPACE","\n            ",348],["T_CONSTANT_ENCAPSED_STRING","'to_edit'",349],",",["T_WHITESPACE","\n            ",349],["T_VARIABLE","$order",350],",",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$quote",351],["T_WHITESPACE","\n        ",351],")",";",["T_WHITESPACE","\n\n        ",352],["T_STRING","Mage",354],["T_DOUBLE_COLON","::",354],["T_STRING","dispatchEvent",354],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_convert_order_to_quote'",354],",",["T_WHITESPACE"," ",354],["T_ARRAY","array",354],"(",["T_WHITESPACE","\n            ",354],["T_CONSTANT_ENCAPSED_STRING","'order'",355],["T_WHITESPACE"," ",355],["T_DOUBLE_ARROW","=>",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$order",355],",",["T_WHITESPACE","\n            ",355],["T_CONSTANT_ENCAPSED_STRING","'quote'",356],["T_WHITESPACE"," ",356],["T_DOUBLE_ARROW","=>",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$quote",356],["T_WHITESPACE","\n        ",356],")",")",";",["T_WHITESPACE","\n\n        ",357],["T_IF","if",359],["T_WHITESPACE"," ",359],"(","!",["T_VARIABLE","$order",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getCustomerId",359],"(",")",")",["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n            ",359],["T_VARIABLE","$quote",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","setCustomerIsGuest",360],"(",["T_STRING","true",360],")",";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n\n        ",361],["T_IF","if",363],["T_WHITESPACE"," ",363],"(",["T_VARIABLE","$session",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getUseOldShippingMethod",363],"(",["T_STRING","true",363],")",")",["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n            ",363],["T_COMMENT","\/*\n             * if we are making reorder or editing old order\n             * we need to show old shipping as preselected\n             * so for this we need to collect shipping rates\n             *\/",364],["T_WHITESPACE","\n            ",368],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","collectShippingRates",369],"(",")",";",["T_WHITESPACE","\n        ",369],"}",["T_WHITESPACE"," ",370],["T_ELSE","else",370],["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n            ",370],["T_COMMENT","\/*\n             * if we are creating new order then we don't need to collect\n             * shipping rates before customer hit appropriate button\n             *\/",371],["T_WHITESPACE","\n            ",374],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","collectRates",375],"(",")",";",["T_WHITESPACE","\n        ",375],"}",["T_WHITESPACE","\n\n        ",376],["T_COMMENT","\/\/ Make collect rates when user click \"Get shipping methods and rates\" in order creating\n",378],["T_WHITESPACE","        ",379],["T_COMMENT","\/\/ $this->getQuote()->getShippingAddress()->setCollectShippingRates(true);\n",379],["T_WHITESPACE","        ",380],["T_COMMENT","\/\/ $this->getQuote()->getShippingAddress()->collectShippingRates();\n",380],["T_WHITESPACE","\n        ",381],["T_VARIABLE","$quote",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","save",382],"(",")",";",["T_WHITESPACE","\n\n        ",382],["T_RETURN","return",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],";",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n\n    ",385],["T_PROTECTED","protected",387],["T_WHITESPACE"," ",387],["T_FUNCTION","function",387],["T_WHITESPACE"," ",387],["T_STRING","_initBillingAddressFromOrder",387],"(",["T_STRING","Mage_Sales_Model_Order",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$order",387],")",["T_WHITESPACE","\n    ",387],"{",["T_WHITESPACE","\n        ",388],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getQuote",389],"(",")",["T_OBJECT_OPERATOR","->",389],["T_STRING","getBillingAddress",389],"(",")",["T_OBJECT_OPERATOR","->",389],["T_STRING","setCustomerAddressId",389],"(",["T_CONSTANT_ENCAPSED_STRING","''",389],")",";",["T_WHITESPACE","\n        ",389],["T_STRING","Mage",390],["T_DOUBLE_COLON","::",390],["T_STRING","helper",390],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",390],")",["T_OBJECT_OPERATOR","->",390],["T_STRING","copyFieldset",390],"(",["T_WHITESPACE","\n            ",390],["T_CONSTANT_ENCAPSED_STRING","'sales_copy_order_billing_address'",391],",",["T_WHITESPACE","\n            ",391],["T_CONSTANT_ENCAPSED_STRING","'to_order'",392],",",["T_WHITESPACE","\n            ",392],["T_VARIABLE","$order",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getBillingAddress",393],"(",")",",",["T_WHITESPACE","\n            ",393],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getQuote",394],"(",")",["T_OBJECT_OPERATOR","->",394],["T_STRING","getBillingAddress",394],"(",")",["T_WHITESPACE","\n        ",394],")",";",["T_WHITESPACE","\n    ",395],"}",["T_WHITESPACE","\n\n    ",396],["T_PROTECTED","protected",398],["T_WHITESPACE"," ",398],["T_FUNCTION","function",398],["T_WHITESPACE"," ",398],["T_STRING","_initShippingAddressFromOrder",398],"(",["T_STRING","Mage_Sales_Model_Order",398],["T_WHITESPACE"," ",398],["T_VARIABLE","$order",398],")",["T_WHITESPACE","\n    ",398],"{",["T_WHITESPACE","\n        ",399],["T_VARIABLE","$orderShippingAddress",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_VARIABLE","$order",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getShippingAddress",400],"(",")",";",["T_WHITESPACE","\n        ",400],["T_VARIABLE","$quoteShippingAddress",401],["T_WHITESPACE"," ",401],"=",["T_WHITESPACE"," ",401],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getQuote",401],"(",")",["T_OBJECT_OPERATOR","->",401],["T_STRING","getShippingAddress",401],"(",")",["T_WHITESPACE","\n            ",401],["T_OBJECT_OPERATOR","->",402],["T_STRING","setCustomerAddressId",402],"(",["T_CONSTANT_ENCAPSED_STRING","''",402],")",["T_WHITESPACE","\n            ",402],["T_OBJECT_OPERATOR","->",403],["T_STRING","setSameAsBilling",403],"(",["T_VARIABLE","$orderShippingAddress",403],["T_WHITESPACE"," ",403],["T_BOOLEAN_AND","&&",403],["T_WHITESPACE"," ",403],["T_VARIABLE","$orderShippingAddress",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getSameAsBilling",403],"(",")",")",";",["T_WHITESPACE","\n        ",403],["T_STRING","Mage",404],["T_DOUBLE_COLON","::",404],["T_STRING","helper",404],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",404],")",["T_OBJECT_OPERATOR","->",404],["T_STRING","copyFieldset",404],"(",["T_WHITESPACE","\n            ",404],["T_CONSTANT_ENCAPSED_STRING","'sales_copy_order_shipping_address'",405],",",["T_WHITESPACE","\n            ",405],["T_CONSTANT_ENCAPSED_STRING","'to_order'",406],",",["T_WHITESPACE","\n            ",406],["T_VARIABLE","$orderShippingAddress",407],",",["T_WHITESPACE","\n            ",407],["T_VARIABLE","$quoteShippingAddress",408],["T_WHITESPACE","\n        ",408],")",";",["T_WHITESPACE","\n    ",409],"}",["T_WHITESPACE","\n\n    ",410],["T_DOC_COMMENT","\/**\n     * Initialize creation data from existing order Item\n     *\n     * @param Mage_Sales_Model_Order_Item $orderItem\n     * @param int $qty\n     * @return Mage_Sales_Model_Quote_Item | string\n     *\/",412],["T_WHITESPACE","\n    ",418],["T_PUBLIC","public",419],["T_WHITESPACE"," ",419],["T_FUNCTION","function",419],["T_WHITESPACE"," ",419],["T_STRING","initFromOrderItem",419],"(",["T_STRING","Mage_Sales_Model_Order_Item",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$orderItem",419],",",["T_WHITESPACE"," ",419],["T_VARIABLE","$qty",419],["T_WHITESPACE"," ",419],"=",["T_WHITESPACE"," ",419],["T_STRING","null",419],")",["T_WHITESPACE","\n    ",419],"{",["T_WHITESPACE","\n        ",420],["T_IF","if",421],["T_WHITESPACE"," ",421],"(","!",["T_VARIABLE","$orderItem",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getId",421],"(",")",")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n            ",421],["T_RETURN","return",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],";",["T_WHITESPACE","\n        ",422],"}",["T_WHITESPACE","\n\n        ",423],["T_VARIABLE","$product",425],["T_WHITESPACE"," ",425],"=",["T_WHITESPACE"," ",425],["T_STRING","Mage",425],["T_DOUBLE_COLON","::",425],["T_STRING","getModel",425],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",425],")",["T_WHITESPACE","\n            ",425],["T_OBJECT_OPERATOR","->",426],["T_STRING","setStoreId",426],"(",["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getSession",426],"(",")",["T_OBJECT_OPERATOR","->",426],["T_STRING","getStoreId",426],"(",")",")",["T_WHITESPACE","\n            ",426],["T_OBJECT_OPERATOR","->",427],["T_STRING","load",427],"(",["T_VARIABLE","$orderItem",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getProductId",427],"(",")",")",";",["T_WHITESPACE","\n\n        ",427],["T_IF","if",429],["T_WHITESPACE"," ",429],"(",["T_VARIABLE","$product",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getId",429],"(",")",")",["T_WHITESPACE"," ",429],"{",["T_WHITESPACE","\n            ",429],["T_VARIABLE","$product",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","setSkipCheckRequiredOption",430],"(",["T_STRING","true",430],")",";",["T_WHITESPACE","\n            ",430],["T_VARIABLE","$buyRequest",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$orderItem",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getBuyRequest",431],"(",")",";",["T_WHITESPACE","\n            ",431],["T_IF","if",432],["T_WHITESPACE"," ",432],"(",["T_STRING","is_numeric",432],"(",["T_VARIABLE","$qty",432],")",")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n                ",432],["T_VARIABLE","$buyRequest",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","setQty",433],"(",["T_VARIABLE","$qty",433],")",";",["T_WHITESPACE","\n            ",433],"}",["T_WHITESPACE","\n            ",434],["T_VARIABLE","$item",435],["T_WHITESPACE"," ",435],"=",["T_WHITESPACE"," ",435],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getQuote",435],"(",")",["T_OBJECT_OPERATOR","->",435],["T_STRING","addProduct",435],"(",["T_VARIABLE","$product",435],",",["T_WHITESPACE"," ",435],["T_VARIABLE","$buyRequest",435],")",";",["T_WHITESPACE","\n            ",435],["T_IF","if",436],["T_WHITESPACE"," ",436],"(",["T_STRING","is_string",436],"(",["T_VARIABLE","$item",436],")",")",["T_WHITESPACE"," ",436],"{",["T_WHITESPACE","\n                ",436],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$item",437],";",["T_WHITESPACE","\n            ",437],"}",["T_WHITESPACE","\n\n            ",438],["T_IF","if",440],["T_WHITESPACE"," ",440],"(",["T_VARIABLE","$additionalOptions",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_VARIABLE","$orderItem",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getProductOptionByCode",440],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",440],")",")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n                ",440],["T_VARIABLE","$item",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","addOption",441],"(",["T_NEW","new",441],["T_WHITESPACE"," ",441],["T_STRING","Varien_Object",441],"(",["T_WHITESPACE","\n                    ",441],["T_ARRAY","array",442],"(",["T_WHITESPACE","\n                        ",442],["T_CONSTANT_ENCAPSED_STRING","'product'",443],["T_WHITESPACE"," ",443],["T_DOUBLE_ARROW","=>",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$item",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getProduct",443],"(",")",",",["T_WHITESPACE","\n                        ",443],["T_CONSTANT_ENCAPSED_STRING","'code'",444],["T_WHITESPACE"," ",444],["T_DOUBLE_ARROW","=>",444],["T_WHITESPACE"," ",444],["T_CONSTANT_ENCAPSED_STRING","'additional_options'",444],",",["T_WHITESPACE","\n                        ",444],["T_CONSTANT_ENCAPSED_STRING","'value'",445],["T_WHITESPACE"," ",445],["T_DOUBLE_ARROW","=>",445],["T_WHITESPACE"," ",445],["T_STRING","serialize",445],"(",["T_VARIABLE","$additionalOptions",445],")",["T_WHITESPACE","\n                    ",445],")",["T_WHITESPACE","\n                ",446],")",")",";",["T_WHITESPACE","\n            ",447],"}",["T_WHITESPACE","\n\n            ",448],["T_STRING","Mage",450],["T_DOUBLE_COLON","::",450],["T_STRING","dispatchEvent",450],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_convert_order_item_to_quote_item'",450],",",["T_WHITESPACE"," ",450],["T_ARRAY","array",450],"(",["T_WHITESPACE","\n                ",450],["T_CONSTANT_ENCAPSED_STRING","'order_item'",451],["T_WHITESPACE"," ",451],["T_DOUBLE_ARROW","=>",451],["T_WHITESPACE"," ",451],["T_VARIABLE","$orderItem",451],",",["T_WHITESPACE","\n                ",451],["T_CONSTANT_ENCAPSED_STRING","'quote_item'",452],["T_WHITESPACE"," ",452],["T_DOUBLE_ARROW","=>",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$item",452],["T_WHITESPACE","\n            ",452],")",")",";",["T_WHITESPACE","\n            ",453],["T_RETURN","return",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$item",454],";",["T_WHITESPACE","\n        ",454],"}",["T_WHITESPACE","\n\n        ",455],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],";",["T_WHITESPACE","\n    ",457],"}",["T_WHITESPACE","\n\n    ",458],["T_DOC_COMMENT","\/**\n     * Retrieve customer wishlist model object\n     *\n     * @params bool $cacheReload pass cached wishlist object and get new one\n     * @return Mage_Wishlist_Model_Wishlist\n     *\/",460],["T_WHITESPACE","\n    ",465],["T_PUBLIC","public",466],["T_WHITESPACE"," ",466],["T_FUNCTION","function",466],["T_WHITESPACE"," ",466],["T_STRING","getCustomerWishlist",466],"(",["T_VARIABLE","$cacheReload",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_STRING","false",466],")",["T_WHITESPACE","\n    ",466],"{",["T_WHITESPACE","\n        ",467],["T_IF","if",468],["T_WHITESPACE"," ",468],"(","!",["T_STRING","is_null",468],"(",["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","_wishlist",468],")",["T_WHITESPACE"," ",468],["T_BOOLEAN_AND","&&",468],["T_WHITESPACE"," ",468],"!",["T_VARIABLE","$cacheReload",468],")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n            ",468],["T_RETURN","return",469],["T_WHITESPACE"," ",469],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_wishlist",469],";",["T_WHITESPACE","\n        ",469],"}",["T_WHITESPACE","\n\n        ",470],["T_IF","if",472],["T_WHITESPACE"," ",472],"(",["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getSession",472],"(",")",["T_OBJECT_OPERATOR","->",472],["T_STRING","getCustomer",472],"(",")",["T_OBJECT_OPERATOR","->",472],["T_STRING","getId",472],"(",")",")",["T_WHITESPACE"," ",472],"{",["T_WHITESPACE","\n            ",472],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","_wishlist",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_STRING","Mage",473],["T_DOUBLE_COLON","::",473],["T_STRING","getModel",473],"(",["T_CONSTANT_ENCAPSED_STRING","'wishlist\/wishlist'",473],")",["T_OBJECT_OPERATOR","->",473],["T_STRING","loadByCustomer",473],"(",["T_WHITESPACE","\n                ",473],["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getSession",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","getCustomer",474],"(",")",",",["T_WHITESPACE"," ",474],["T_STRING","true",474],["T_WHITESPACE","\n            ",474],")",";",["T_WHITESPACE","\n            ",475],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","_wishlist",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","setStore",476],"(",["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getSession",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","getStore",476],"(",")",")",["T_WHITESPACE","\n                ",476],["T_OBJECT_OPERATOR","->",477],["T_STRING","setSharedStoreIds",477],"(",["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getSession",477],"(",")",["T_OBJECT_OPERATOR","->",477],["T_STRING","getStore",477],"(",")",["T_OBJECT_OPERATOR","->",477],["T_STRING","getWebsite",477],"(",")",["T_OBJECT_OPERATOR","->",477],["T_STRING","getStoreIds",477],"(",")",")",";",["T_WHITESPACE","\n        ",477],"}",["T_WHITESPACE"," ",478],["T_ELSE","else",478],["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n            ",478],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_wishlist",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_STRING","false",479],";",["T_WHITESPACE","\n        ",479],"}",["T_WHITESPACE","\n\n        ",480],["T_RETURN","return",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","_wishlist",482],";",["T_WHITESPACE","\n    ",482],"}",["T_WHITESPACE","\n\n    ",483],["T_DOC_COMMENT","\/**\n     * Retrieve customer cart quote object model\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",485],["T_WHITESPACE","\n    ",489],["T_PUBLIC","public",490],["T_WHITESPACE"," ",490],["T_FUNCTION","function",490],["T_WHITESPACE"," ",490],["T_STRING","getCustomerCart",490],"(",")",["T_WHITESPACE","\n    ",490],"{",["T_WHITESPACE","\n        ",491],["T_IF","if",492],["T_WHITESPACE"," ",492],"(","!",["T_STRING","is_null",492],"(",["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","_cart",492],")",")",["T_WHITESPACE"," ",492],"{",["T_WHITESPACE","\n            ",492],["T_RETURN","return",493],["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","_cart",493],";",["T_WHITESPACE","\n        ",493],"}",["T_WHITESPACE","\n\n        ",494],["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","_cart",496],["T_WHITESPACE"," ",496],"=",["T_WHITESPACE"," ",496],["T_STRING","Mage",496],["T_DOUBLE_COLON","::",496],["T_STRING","getModel",496],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",496],")",";",["T_WHITESPACE","\n\n        ",496],["T_IF","if",498],["T_WHITESPACE"," ",498],"(",["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getSession",498],"(",")",["T_OBJECT_OPERATOR","->",498],["T_STRING","getCustomer",498],"(",")",["T_OBJECT_OPERATOR","->",498],["T_STRING","getId",498],"(",")",")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n            ",498],["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","_cart",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","setStore",499],"(",["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","getSession",499],"(",")",["T_OBJECT_OPERATOR","->",499],["T_STRING","getStore",499],"(",")",")",["T_WHITESPACE","\n                ",499],["T_OBJECT_OPERATOR","->",500],["T_STRING","loadByCustomer",500],"(",["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getSession",500],"(",")",["T_OBJECT_OPERATOR","->",500],["T_STRING","getCustomer",500],"(",")",["T_OBJECT_OPERATOR","->",500],["T_STRING","getId",500],"(",")",")",";",["T_WHITESPACE","\n            ",500],["T_IF","if",501],["T_WHITESPACE"," ",501],"(","!",["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","_cart",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getId",501],"(",")",")",["T_WHITESPACE"," ",501],"{",["T_WHITESPACE","\n                ",501],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","_cart",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","assignCustomer",502],"(",["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getSession",502],"(",")",["T_OBJECT_OPERATOR","->",502],["T_STRING","getCustomer",502],"(",")",")",";",["T_WHITESPACE","\n                ",502],["T_VARIABLE","$this",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","_cart",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","save",503],"(",")",";",["T_WHITESPACE","\n            ",503],"}",["T_WHITESPACE","\n        ",504],"}",["T_WHITESPACE","\n\n        ",505],["T_RETURN","return",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","_cart",507],";",["T_WHITESPACE","\n    ",507],"}",["T_WHITESPACE","\n\n    ",508],["T_DOC_COMMENT","\/**\n     * Retrieve customer compare list model object\n     *\n     * @return Mage_Catalog_Model_Product_Compare_List\n     *\/",510],["T_WHITESPACE","\n    ",514],["T_PUBLIC","public",515],["T_WHITESPACE"," ",515],["T_FUNCTION","function",515],["T_WHITESPACE"," ",515],["T_STRING","getCustomerCompareList",515],"(",")",["T_WHITESPACE","\n    ",515],"{",["T_WHITESPACE","\n        ",516],["T_IF","if",517],["T_WHITESPACE"," ",517],"(","!",["T_STRING","is_null",517],"(",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","_compareList",517],")",")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n            ",517],["T_RETURN","return",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","_compareList",518],";",["T_WHITESPACE","\n        ",518],"}",["T_WHITESPACE","\n\n        ",519],["T_IF","if",521],["T_WHITESPACE"," ",521],"(",["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getSession",521],"(",")",["T_OBJECT_OPERATOR","->",521],["T_STRING","getCustomer",521],"(",")",["T_OBJECT_OPERATOR","->",521],["T_STRING","getId",521],"(",")",")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_compareList",522],["T_WHITESPACE"," ",522],"=",["T_WHITESPACE"," ",522],["T_STRING","Mage",522],["T_DOUBLE_COLON","::",522],["T_STRING","getModel",522],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_compare_list'",522],")",";",["T_WHITESPACE","\n        ",522],"}",["T_WHITESPACE"," ",523],["T_ELSE","else",523],["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n            ",523],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","_compareList",524],["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_STRING","false",524],";",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n        ",525],["T_RETURN","return",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","_compareList",526],";",["T_WHITESPACE","\n    ",526],"}",["T_WHITESPACE","\n\n    ",527],["T_PUBLIC","public",529],["T_WHITESPACE"," ",529],["T_FUNCTION","function",529],["T_WHITESPACE"," ",529],["T_STRING","getCustomerGroupId",529],"(",")",["T_WHITESPACE","\n    ",529],"{",["T_WHITESPACE","\n        ",530],["T_VARIABLE","$groupId",531],["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","getQuote",531],"(",")",["T_OBJECT_OPERATOR","->",531],["T_STRING","getCustomerGroupId",531],"(",")",";",["T_WHITESPACE","\n        ",531],["T_IF","if",532],["T_WHITESPACE"," ",532],"(","!",["T_VARIABLE","$groupId",532],")",["T_WHITESPACE"," ",532],"{",["T_WHITESPACE","\n            ",532],["T_VARIABLE","$groupId",533],["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getSession",533],"(",")",["T_OBJECT_OPERATOR","->",533],["T_STRING","getCustomerGroupId",533],"(",")",";",["T_WHITESPACE","\n        ",533],"}",["T_WHITESPACE","\n        ",534],["T_RETURN","return",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$groupId",535],";",["T_WHITESPACE","\n    ",535],"}",["T_WHITESPACE","\n\n    ",536],["T_DOC_COMMENT","\/**\n     * Move quote item to another items list\n     *\n     * @param   int|Mage_Sales_Model_Quote_Item $item\n     * @param   string $moveTo\n     * @param   int $qty\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",538],["T_WHITESPACE","\n    ",545],["T_PUBLIC","public",546],["T_WHITESPACE"," ",546],["T_FUNCTION","function",546],["T_WHITESPACE"," ",546],["T_STRING","moveQuoteItem",546],"(",["T_VARIABLE","$item",546],",",["T_WHITESPACE"," ",546],["T_VARIABLE","$moveTo",546],",",["T_WHITESPACE"," ",546],["T_VARIABLE","$qty",546],")",["T_WHITESPACE","\n    ",546],"{",["T_WHITESPACE","\n        ",547],["T_VARIABLE","$item",548],["T_WHITESPACE"," ",548],"=",["T_WHITESPACE"," ",548],["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","_getQuoteItem",548],"(",["T_VARIABLE","$item",548],")",";",["T_WHITESPACE","\n        ",548],["T_IF","if",549],["T_WHITESPACE"," ",549],"(",["T_VARIABLE","$item",549],")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_VARIABLE","$removeItem",550],["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_STRING","false",550],";",["T_WHITESPACE","\n            ",550],["T_VARIABLE","$moveTo",551],["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_STRING","explode",551],"(",["T_CONSTANT_ENCAPSED_STRING","'_'",551],",",["T_WHITESPACE"," ",551],["T_VARIABLE","$moveTo",551],")",";",["T_WHITESPACE","\n            ",551],["T_SWITCH","switch",552],["T_WHITESPACE"," ",552],"(",["T_VARIABLE","$moveTo",552],"[",["T_LNUMBER","0",552],"]",")",["T_WHITESPACE"," ",552],"{",["T_WHITESPACE","\n                ",552],["T_CASE","case",553],["T_WHITESPACE"," ",553],["T_CONSTANT_ENCAPSED_STRING","'order'",553],":",["T_WHITESPACE","\n                    ",553],["T_VARIABLE","$info",554],["T_WHITESPACE"," ",554],"=",["T_WHITESPACE"," ",554],["T_VARIABLE","$item",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","getBuyRequest",554],"(",")",";",["T_WHITESPACE","\n                    ",554],["T_VARIABLE","$info",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","setOptions",555],"(",["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","_prepareOptionsForRequest",555],"(",["T_VARIABLE","$item",555],")",")",["T_WHITESPACE","\n                        ",555],["T_OBJECT_OPERATOR","->",556],["T_STRING","setQty",556],"(",["T_VARIABLE","$qty",556],")",";",["T_WHITESPACE","\n\n                    ",556],["T_VARIABLE","$product",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_STRING","Mage",558],["T_DOUBLE_COLON","::",558],["T_STRING","getModel",558],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",558],")",["T_WHITESPACE","\n                        ",558],["T_OBJECT_OPERATOR","->",559],["T_STRING","setStoreId",559],"(",["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","getQuote",559],"(",")",["T_OBJECT_OPERATOR","->",559],["T_STRING","getStoreId",559],"(",")",")",["T_WHITESPACE","\n                        ",559],["T_OBJECT_OPERATOR","->",560],["T_STRING","load",560],"(",["T_VARIABLE","$item",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getProduct",560],"(",")",["T_OBJECT_OPERATOR","->",560],["T_STRING","getId",560],"(",")",")",";",["T_WHITESPACE","\n\n                    ",560],["T_VARIABLE","$product",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","setSkipCheckRequiredOption",562],"(",["T_STRING","true",562],")",";",["T_WHITESPACE","\n                    ",562],["T_VARIABLE","$newItem",563],["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","getQuote",563],"(",")",["T_OBJECT_OPERATOR","->",563],["T_STRING","addProduct",563],"(",["T_VARIABLE","$product",563],",",["T_WHITESPACE"," ",563],["T_VARIABLE","$info",563],")",";",["T_WHITESPACE","\n\n                    ",563],["T_IF","if",565],["T_WHITESPACE"," ",565],"(",["T_STRING","is_string",565],"(",["T_VARIABLE","$newItem",565],")",")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n                        ",565],["T_STRING","Mage",566],["T_DOUBLE_COLON","::",566],["T_STRING","throwException",566],"(",["T_VARIABLE","$newItem",566],")",";",["T_WHITESPACE","\n                    ",566],"}",["T_WHITESPACE","\n                    ",567],["T_VARIABLE","$product",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","unsSkipCheckRequiredOption",568],"(",")",";",["T_WHITESPACE","\n                    ",568],["T_VARIABLE","$newItem",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","checkData",569],"(",")",";",["T_WHITESPACE","\n                    ",569],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","_needCollectCart",570],["T_WHITESPACE"," ",570],"=",["T_WHITESPACE"," ",570],["T_STRING","true",570],";",["T_WHITESPACE","\n                    ",570],["T_BREAK","break",571],";",["T_WHITESPACE","\n                ",571],["T_CASE","case",572],["T_WHITESPACE"," ",572],["T_CONSTANT_ENCAPSED_STRING","'cart'",572],":",["T_WHITESPACE","\n                    ",572],["T_VARIABLE","$cart",573],["T_WHITESPACE"," ",573],"=",["T_WHITESPACE"," ",573],["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","getCustomerCart",573],"(",")",";",["T_WHITESPACE","\n                    ",573],["T_IF","if",574],["T_WHITESPACE"," ",574],"(",["T_VARIABLE","$cart",574],["T_WHITESPACE"," ",574],["T_BOOLEAN_AND","&&",574],["T_WHITESPACE"," ",574],["T_STRING","is_null",574],"(",["T_VARIABLE","$item",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","getOptionByCode",574],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",574],")",")",")",["T_WHITESPACE"," ",574],"{",["T_WHITESPACE","\n                        ",574],["T_COMMENT","\/\/options and info buy request\n",575],["T_WHITESPACE","                        ",576],["T_VARIABLE","$product",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_STRING","Mage",576],["T_DOUBLE_COLON","::",576],["T_STRING","getModel",576],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",576],")",["T_WHITESPACE","\n                            ",576],["T_OBJECT_OPERATOR","->",577],["T_STRING","setStoreId",577],"(",["T_VARIABLE","$this",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","getQuote",577],"(",")",["T_OBJECT_OPERATOR","->",577],["T_STRING","getStoreId",577],"(",")",")",["T_WHITESPACE","\n                            ",577],["T_OBJECT_OPERATOR","->",578],["T_STRING","load",578],"(",["T_VARIABLE","$item",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getProduct",578],"(",")",["T_OBJECT_OPERATOR","->",578],["T_STRING","getId",578],"(",")",")",";",["T_WHITESPACE","\n\n                        ",578],["T_VARIABLE","$info",580],["T_WHITESPACE"," ",580],"=",["T_WHITESPACE"," ",580],["T_VARIABLE","$item",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getOptionByCode",580],"(",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",580],")",";",["T_WHITESPACE","\n                        ",580],["T_IF","if",581],["T_WHITESPACE"," ",581],"(",["T_VARIABLE","$info",581],")",["T_WHITESPACE"," ",581],"{",["T_WHITESPACE","\n                            ",581],["T_VARIABLE","$info",582],["T_WHITESPACE"," ",582],"=",["T_WHITESPACE"," ",582],["T_NEW","new",582],["T_WHITESPACE"," ",582],["T_STRING","Varien_Object",582],"(",["T_WHITESPACE","\n                                ",582],["T_STRING","unserialize",583],"(",["T_VARIABLE","$info",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","getValue",583],"(",")",")",["T_WHITESPACE","\n                            ",583],")",";",["T_WHITESPACE","\n                            ",584],["T_VARIABLE","$info",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","setQty",585],"(",["T_VARIABLE","$qty",585],")",";",["T_WHITESPACE","\n                            ",585],["T_VARIABLE","$info",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","setOptions",586],"(",["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","_prepareOptionsForRequest",586],"(",["T_VARIABLE","$item",586],")",")",";",["T_WHITESPACE","\n                        ",586],"}",["T_WHITESPACE"," ",587],["T_ELSE","else",587],["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n                            ",587],["T_VARIABLE","$info",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_NEW","new",588],["T_WHITESPACE"," ",588],["T_STRING","Varien_Object",588],"(",["T_ARRAY","array",588],"(",["T_WHITESPACE","\n                                ",588],["T_CONSTANT_ENCAPSED_STRING","'product_id'",589],["T_WHITESPACE"," ",589],["T_DOUBLE_ARROW","=>",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$product",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getId",589],"(",")",",",["T_WHITESPACE","\n                                ",589],["T_CONSTANT_ENCAPSED_STRING","'qty'",590],["T_WHITESPACE"," ",590],["T_DOUBLE_ARROW","=>",590],["T_WHITESPACE"," ",590],["T_VARIABLE","$qty",590],",",["T_WHITESPACE","\n                                ",590],["T_CONSTANT_ENCAPSED_STRING","'options'",591],["T_WHITESPACE"," ",591],["T_DOUBLE_ARROW","=>",591],["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_prepareOptionsForRequest",591],"(",["T_VARIABLE","$item",591],")",["T_WHITESPACE","\n                            ",591],")",")",";",["T_WHITESPACE","\n                        ",592],"}",["T_WHITESPACE","\n\n                        ",593],["T_VARIABLE","$cartItem",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],["T_VARIABLE","$cart",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","addProduct",595],"(",["T_VARIABLE","$product",595],",",["T_WHITESPACE"," ",595],["T_VARIABLE","$info",595],")",";",["T_WHITESPACE","\n                        ",595],["T_IF","if",596],["T_WHITESPACE"," ",596],"(",["T_STRING","is_string",596],"(",["T_VARIABLE","$cartItem",596],")",")",["T_WHITESPACE"," ",596],"{",["T_WHITESPACE","\n                            ",596],["T_STRING","Mage",597],["T_DOUBLE_COLON","::",597],["T_STRING","throwException",597],"(",["T_VARIABLE","$cartItem",597],")",";",["T_WHITESPACE","\n                        ",597],"}",["T_WHITESPACE","\n                        ",598],["T_IF","if",599],["T_WHITESPACE"," ",599],"(",["T_VARIABLE","$cartItem",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","getParentItem",599],"(",")",")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n                            ",599],["T_VARIABLE","$cartItem",600],["T_WHITESPACE"," ",600],"=",["T_WHITESPACE"," ",600],["T_VARIABLE","$cartItem",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","getParentItem",600],"(",")",";",["T_WHITESPACE","\n                        ",600],"}",["T_WHITESPACE","\n                        ",601],["T_VARIABLE","$cartItem",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","setPrice",602],"(",["T_VARIABLE","$item",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getProduct",602],"(",")",["T_OBJECT_OPERATOR","->",602],["T_STRING","getPrice",602],"(",")",")",";",["T_WHITESPACE","\n                        ",602],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","_needCollectCart",603],["T_WHITESPACE"," ",603],"=",["T_WHITESPACE"," ",603],["T_STRING","true",603],";",["T_WHITESPACE","\n                        ",603],["T_VARIABLE","$removeItem",604],["T_WHITESPACE"," ",604],"=",["T_WHITESPACE"," ",604],["T_STRING","true",604],";",["T_WHITESPACE","\n                    ",604],"}",["T_WHITESPACE","\n                    ",605],["T_BREAK","break",606],";",["T_WHITESPACE","\n                ",606],["T_CASE","case",607],["T_WHITESPACE"," ",607],["T_CONSTANT_ENCAPSED_STRING","'wishlist'",607],":",["T_WHITESPACE","\n                    ",607],["T_VARIABLE","$wishlist",608],["T_WHITESPACE"," ",608],"=",["T_WHITESPACE"," ",608],["T_STRING","null",608],";",["T_WHITESPACE","\n                    ",608],["T_IF","if",609],["T_WHITESPACE"," ",609],"(","!",["T_ISSET","isset",609],"(",["T_VARIABLE","$moveTo",609],"[",["T_LNUMBER","1",609],"]",")",")",["T_WHITESPACE"," ",609],"{",["T_WHITESPACE","\n                        ",609],["T_VARIABLE","$wishlist",610],["T_WHITESPACE"," ",610],"=",["T_WHITESPACE"," ",610],["T_STRING","Mage",610],["T_DOUBLE_COLON","::",610],["T_STRING","getModel",610],"(",["T_CONSTANT_ENCAPSED_STRING","'wishlist\/wishlist'",610],")",["T_OBJECT_OPERATOR","->",610],["T_STRING","loadByCustomer",610],"(",["T_WHITESPACE","\n                            ",610],["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","getSession",611],"(",")",["T_OBJECT_OPERATOR","->",611],["T_STRING","getCustomer",611],"(",")",",",["T_WHITESPACE","\n                            ",611],["T_STRING","true",612],["T_WHITESPACE","\n                        ",612],")",";",["T_WHITESPACE","\n                    ",613],"}",["T_WHITESPACE"," ",614],["T_ELSE","else",614],["T_WHITESPACE"," ",614],"{",["T_WHITESPACE","\n                        ",614],["T_VARIABLE","$wishlist",615],["T_WHITESPACE"," ",615],"=",["T_WHITESPACE"," ",615],["T_STRING","Mage",615],["T_DOUBLE_COLON","::",615],["T_STRING","getModel",615],"(",["T_CONSTANT_ENCAPSED_STRING","'wishlist\/wishlist'",615],")",["T_OBJECT_OPERATOR","->",615],["T_STRING","load",615],"(",["T_VARIABLE","$moveTo",615],"[",["T_LNUMBER","1",615],"]",")",";",["T_WHITESPACE","\n                        ",615],["T_IF","if",616],["T_WHITESPACE"," ",616],"(","!",["T_VARIABLE","$wishlist",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","getId",616],"(",")",["T_WHITESPACE","\n                            ",616],["T_BOOLEAN_OR","||",617],["T_WHITESPACE"," ",617],["T_VARIABLE","$wishlist",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getCustomerId",617],"(",")",["T_WHITESPACE"," ",617],["T_IS_NOT_EQUAL","!=",617],["T_WHITESPACE"," ",617],["T_VARIABLE","$this",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getSession",617],"(",")",["T_OBJECT_OPERATOR","->",617],["T_STRING","getCustomerId",617],"(",")",["T_WHITESPACE","\n                        ",617],")",["T_WHITESPACE"," ",618],"{",["T_WHITESPACE","\n                            ",618],["T_VARIABLE","$wishlist",619],["T_WHITESPACE"," ",619],"=",["T_WHITESPACE"," ",619],["T_STRING","null",619],";",["T_WHITESPACE","\n                        ",619],"}",["T_WHITESPACE","\n                    ",620],"}",["T_WHITESPACE","\n                    ",621],["T_IF","if",622],["T_WHITESPACE"," ",622],"(","!",["T_VARIABLE","$wishlist",622],")",["T_WHITESPACE"," ",622],"{",["T_WHITESPACE","\n                        ",622],["T_STRING","Mage",623],["T_DOUBLE_COLON","::",623],["T_STRING","throwException",623],"(",["T_STRING","Mage",623],["T_DOUBLE_COLON","::",623],["T_STRING","helper",623],"(",["T_CONSTANT_ENCAPSED_STRING","'wishlist'",623],")",["T_OBJECT_OPERATOR","->",623],["T_STRING","__",623],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not find wishlist'",623],")",")",";",["T_WHITESPACE","\n                    ",623],"}",["T_WHITESPACE","\n                    ",624],["T_VARIABLE","$wishlist",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","setStore",625],"(",["T_VARIABLE","$this",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","getSession",625],"(",")",["T_OBJECT_OPERATOR","->",625],["T_STRING","getStore",625],"(",")",")",["T_WHITESPACE","\n                        ",625],["T_OBJECT_OPERATOR","->",626],["T_STRING","setSharedStoreIds",626],"(",["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getSession",626],"(",")",["T_OBJECT_OPERATOR","->",626],["T_STRING","getStore",626],"(",")",["T_OBJECT_OPERATOR","->",626],["T_STRING","getWebsite",626],"(",")",["T_OBJECT_OPERATOR","->",626],["T_STRING","getStoreIds",626],"(",")",")",";",["T_WHITESPACE","\n\n                    ",626],["T_IF","if",628],["T_WHITESPACE"," ",628],"(",["T_VARIABLE","$wishlist",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","getId",628],"(",")",["T_WHITESPACE"," ",628],["T_BOOLEAN_AND","&&",628],["T_WHITESPACE"," ",628],["T_VARIABLE","$item",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","getProduct",628],"(",")",["T_OBJECT_OPERATOR","->",628],["T_STRING","isVisibleInSiteVisibility",628],"(",")",")",["T_WHITESPACE"," ",628],"{",["T_WHITESPACE","\n                        ",628],["T_VARIABLE","$info",629],["T_WHITESPACE"," ",629],"=",["T_WHITESPACE"," ",629],["T_VARIABLE","$item",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","getBuyRequest",629],"(",")",";",["T_WHITESPACE","\n                        ",629],["T_VARIABLE","$info",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","setOptions",630],"(",["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","_prepareOptionsForRequest",630],"(",["T_VARIABLE","$item",630],")",")",["T_WHITESPACE","\n                            ",630],["T_OBJECT_OPERATOR","->",631],["T_STRING","setQty",631],"(",["T_VARIABLE","$qty",631],")",["T_WHITESPACE","\n                            ",631],["T_OBJECT_OPERATOR","->",632],["T_STRING","setStoreId",632],"(",["T_VARIABLE","$this",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","getSession",632],"(",")",["T_OBJECT_OPERATOR","->",632],["T_STRING","getStoreId",632],"(",")",")",";",["T_WHITESPACE","\n                        ",632],["T_VARIABLE","$wishlist",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","addNewItem",633],"(",["T_VARIABLE","$item",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","getProduct",633],"(",")",",",["T_WHITESPACE"," ",633],["T_VARIABLE","$info",633],")",";",["T_WHITESPACE","\n                        ",633],["T_VARIABLE","$removeItem",634],["T_WHITESPACE"," ",634],"=",["T_WHITESPACE"," ",634],["T_STRING","true",634],";",["T_WHITESPACE","\n                    ",634],"}",["T_WHITESPACE","\n                    ",635],["T_BREAK","break",636],";",["T_WHITESPACE","\n                ",636],["T_CASE","case",637],["T_WHITESPACE"," ",637],["T_CONSTANT_ENCAPSED_STRING","'remove'",637],":",["T_WHITESPACE","\n                    ",637],["T_VARIABLE","$removeItem",638],["T_WHITESPACE"," ",638],"=",["T_WHITESPACE"," ",638],["T_STRING","true",638],";",["T_WHITESPACE","\n                    ",638],["T_BREAK","break",639],";",["T_WHITESPACE","\n                ",639],["T_DEFAULT","default",640],":",["T_WHITESPACE","\n                    ",640],["T_BREAK","break",641],";",["T_WHITESPACE","\n            ",641],"}",["T_WHITESPACE","\n            ",642],["T_IF","if",643],["T_WHITESPACE"," ",643],"(",["T_VARIABLE","$removeItem",643],")",["T_WHITESPACE"," ",643],"{",["T_WHITESPACE","\n                ",643],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getQuote",644],"(",")",["T_OBJECT_OPERATOR","->",644],["T_STRING","deleteItem",644],"(",["T_VARIABLE","$item",644],")",";",["T_WHITESPACE","\n            ",644],"}",["T_WHITESPACE","\n            ",645],["T_VARIABLE","$this",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","setRecollect",646],"(",["T_STRING","true",646],")",";",["T_WHITESPACE","\n        ",646],"}",["T_WHITESPACE","\n        ",647],["T_RETURN","return",648],["T_WHITESPACE"," ",648],["T_VARIABLE","$this",648],";",["T_WHITESPACE","\n    ",648],"}",["T_WHITESPACE","\n\n    ",649],["T_DOC_COMMENT","\/**\n     * Handle data sent from sidebar\n     *\n     * @param array $data\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",651],["T_WHITESPACE","\n    ",656],["T_PUBLIC","public",657],["T_WHITESPACE"," ",657],["T_FUNCTION","function",657],["T_WHITESPACE"," ",657],["T_STRING","applySidebarData",657],"(",["T_VARIABLE","$data",657],")",["T_WHITESPACE","\n    ",657],"{",["T_WHITESPACE","\n        ",658],["T_IF","if",659],["T_WHITESPACE"," ",659],"(",["T_ISSET","isset",659],"(",["T_VARIABLE","$data",659],"[",["T_CONSTANT_ENCAPSED_STRING","'add_order_item'",659],"]",")",")",["T_WHITESPACE"," ",659],"{",["T_WHITESPACE","\n            ",659],["T_FOREACH","foreach",660],["T_WHITESPACE"," ",660],"(",["T_VARIABLE","$data",660],"[",["T_CONSTANT_ENCAPSED_STRING","'add_order_item'",660],"]",["T_WHITESPACE"," ",660],["T_AS","as",660],["T_WHITESPACE"," ",660],["T_VARIABLE","$orderItemId",660],["T_WHITESPACE"," ",660],["T_DOUBLE_ARROW","=>",660],["T_WHITESPACE"," ",660],["T_VARIABLE","$value",660],")",["T_WHITESPACE"," ",660],"{",["T_WHITESPACE","\n                ",660],["T_COMMENT","\/* @var $orderItem Mage_Sales_Model_Order_Item *\/",661],["T_WHITESPACE","\n                ",661],["T_VARIABLE","$orderItem",662],["T_WHITESPACE"," ",662],"=",["T_WHITESPACE"," ",662],["T_STRING","Mage",662],["T_DOUBLE_COLON","::",662],["T_STRING","getModel",662],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_item'",662],")",["T_OBJECT_OPERATOR","->",662],["T_STRING","load",662],"(",["T_VARIABLE","$orderItemId",662],")",";",["T_WHITESPACE","\n                ",662],["T_VARIABLE","$item",663],["T_WHITESPACE"," ",663],"=",["T_WHITESPACE"," ",663],["T_VARIABLE","$this",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","initFromOrderItem",663],"(",["T_VARIABLE","$orderItem",663],")",";",["T_WHITESPACE","\n                ",663],["T_IF","if",664],["T_WHITESPACE"," ",664],"(",["T_STRING","is_string",664],"(",["T_VARIABLE","$item",664],")",")",["T_WHITESPACE"," ",664],"{",["T_WHITESPACE","\n                    ",664],["T_STRING","Mage",665],["T_DOUBLE_COLON","::",665],["T_STRING","throwException",665],"(",["T_VARIABLE","$item",665],")",";",["T_WHITESPACE","\n                ",665],"}",["T_WHITESPACE","\n            ",666],"}",["T_WHITESPACE","\n        ",667],"}",["T_WHITESPACE","\n        ",668],["T_IF","if",669],["T_WHITESPACE"," ",669],"(",["T_ISSET","isset",669],"(",["T_VARIABLE","$data",669],"[",["T_CONSTANT_ENCAPSED_STRING","'add_cart_item'",669],"]",")",")",["T_WHITESPACE"," ",669],"{",["T_WHITESPACE","\n            ",669],["T_FOREACH","foreach",670],["T_WHITESPACE"," ",670],"(",["T_VARIABLE","$data",670],"[",["T_CONSTANT_ENCAPSED_STRING","'add_cart_item'",670],"]",["T_WHITESPACE"," ",670],["T_AS","as",670],["T_WHITESPACE"," ",670],["T_VARIABLE","$itemId",670],["T_WHITESPACE"," ",670],["T_DOUBLE_ARROW","=>",670],["T_WHITESPACE"," ",670],["T_VARIABLE","$qty",670],")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n                ",670],["T_VARIABLE","$item",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","getCustomerCart",671],"(",")",["T_OBJECT_OPERATOR","->",671],["T_STRING","getItemById",671],"(",["T_VARIABLE","$itemId",671],")",";",["T_WHITESPACE","\n                ",671],["T_IF","if",672],["T_WHITESPACE"," ",672],"(",["T_VARIABLE","$item",672],")",["T_WHITESPACE"," ",672],"{",["T_WHITESPACE","\n                    ",672],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","moveQuoteItem",673],"(",["T_VARIABLE","$item",673],",",["T_WHITESPACE"," ",673],["T_CONSTANT_ENCAPSED_STRING","'order'",673],",",["T_WHITESPACE"," ",673],["T_VARIABLE","$qty",673],")",";",["T_WHITESPACE","\n                    ",673],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","removeItem",674],"(",["T_VARIABLE","$itemId",674],",",["T_WHITESPACE"," ",674],["T_CONSTANT_ENCAPSED_STRING","'cart'",674],")",";",["T_WHITESPACE","\n                ",674],"}",["T_WHITESPACE","\n            ",675],"}",["T_WHITESPACE","\n        ",676],"}",["T_WHITESPACE","\n        ",677],["T_IF","if",678],["T_WHITESPACE"," ",678],"(",["T_ISSET","isset",678],"(",["T_VARIABLE","$data",678],"[",["T_CONSTANT_ENCAPSED_STRING","'add_wishlist_item'",678],"]",")",")",["T_WHITESPACE"," ",678],"{",["T_WHITESPACE","\n            ",678],["T_FOREACH","foreach",679],["T_WHITESPACE"," ",679],"(",["T_VARIABLE","$data",679],"[",["T_CONSTANT_ENCAPSED_STRING","'add_wishlist_item'",679],"]",["T_WHITESPACE"," ",679],["T_AS","as",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$itemId",679],["T_WHITESPACE"," ",679],["T_DOUBLE_ARROW","=>",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$qty",679],")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n                ",679],["T_VARIABLE","$item",680],["T_WHITESPACE"," ",680],"=",["T_WHITESPACE"," ",680],["T_STRING","Mage",680],["T_DOUBLE_COLON","::",680],["T_STRING","getModel",680],"(",["T_CONSTANT_ENCAPSED_STRING","'wishlist\/item'",680],")",["T_WHITESPACE","\n                    ",680],["T_OBJECT_OPERATOR","->",681],["T_STRING","loadWithOptions",681],"(",["T_VARIABLE","$itemId",681],",",["T_WHITESPACE"," ",681],["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",681],")",";",["T_WHITESPACE","\n                ",681],["T_IF","if",682],["T_WHITESPACE"," ",682],"(",["T_VARIABLE","$item",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getId",682],"(",")",")",["T_WHITESPACE"," ",682],"{",["T_WHITESPACE","\n                    ",682],["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","addProduct",683],"(",["T_VARIABLE","$item",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getProduct",683],"(",")",",",["T_WHITESPACE"," ",683],["T_VARIABLE","$item",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getBuyRequest",683],"(",")",["T_OBJECT_OPERATOR","->",683],["T_STRING","toArray",683],"(",")",")",";",["T_WHITESPACE","\n                ",683],"}",["T_WHITESPACE","\n            ",684],"}",["T_WHITESPACE","\n        ",685],"}",["T_WHITESPACE","\n        ",686],["T_IF","if",687],["T_WHITESPACE"," ",687],"(",["T_ISSET","isset",687],"(",["T_VARIABLE","$data",687],"[",["T_CONSTANT_ENCAPSED_STRING","'add'",687],"]",")",")",["T_WHITESPACE"," ",687],"{",["T_WHITESPACE","\n            ",687],["T_FOREACH","foreach",688],["T_WHITESPACE"," ",688],"(",["T_VARIABLE","$data",688],"[",["T_CONSTANT_ENCAPSED_STRING","'add'",688],"]",["T_WHITESPACE"," ",688],["T_AS","as",688],["T_WHITESPACE"," ",688],["T_VARIABLE","$productId",688],["T_WHITESPACE"," ",688],["T_DOUBLE_ARROW","=>",688],["T_WHITESPACE"," ",688],["T_VARIABLE","$qty",688],")",["T_WHITESPACE"," ",688],"{",["T_WHITESPACE","\n                ",688],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","addProduct",689],"(",["T_VARIABLE","$productId",689],",",["T_WHITESPACE"," ",689],["T_ARRAY","array",689],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",689],["T_WHITESPACE"," ",689],["T_DOUBLE_ARROW","=>",689],["T_WHITESPACE"," ",689],["T_VARIABLE","$qty",689],")",")",";",["T_WHITESPACE","\n            ",689],"}",["T_WHITESPACE","\n        ",690],"}",["T_WHITESPACE","\n        ",691],["T_IF","if",692],["T_WHITESPACE"," ",692],"(",["T_ISSET","isset",692],"(",["T_VARIABLE","$data",692],"[",["T_CONSTANT_ENCAPSED_STRING","'remove'",692],"]",")",")",["T_WHITESPACE"," ",692],"{",["T_WHITESPACE","\n            ",692],["T_FOREACH","foreach",693],["T_WHITESPACE"," ",693],"(",["T_VARIABLE","$data",693],"[",["T_CONSTANT_ENCAPSED_STRING","'remove'",693],"]",["T_WHITESPACE"," ",693],["T_AS","as",693],["T_WHITESPACE"," ",693],["T_VARIABLE","$itemId",693],["T_WHITESPACE"," ",693],["T_DOUBLE_ARROW","=>",693],["T_WHITESPACE"," ",693],["T_VARIABLE","$from",693],")",["T_WHITESPACE"," ",693],"{",["T_WHITESPACE","\n                ",693],["T_VARIABLE","$this",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","removeItem",694],"(",["T_VARIABLE","$itemId",694],",",["T_WHITESPACE"," ",694],["T_VARIABLE","$from",694],")",";",["T_WHITESPACE","\n            ",694],"}",["T_WHITESPACE","\n        ",695],"}",["T_WHITESPACE","\n        ",696],["T_IF","if",697],["T_WHITESPACE"," ",697],"(",["T_ISSET","isset",697],"(",["T_VARIABLE","$data",697],"[",["T_CONSTANT_ENCAPSED_STRING","'empty_customer_cart'",697],"]",")",["T_WHITESPACE"," ",697],["T_BOOLEAN_AND","&&",697],["T_WHITESPACE"," ",697],["T_INT_CAST","(int)",697],["T_VARIABLE","$data",697],"[",["T_CONSTANT_ENCAPSED_STRING","'empty_customer_cart'",697],"]",["T_WHITESPACE"," ",697],["T_IS_EQUAL","==",697],["T_WHITESPACE"," ",697],["T_LNUMBER","1",697],")",["T_WHITESPACE"," ",697],"{",["T_WHITESPACE","\n            ",697],["T_VARIABLE","$this",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","getCustomerCart",698],"(",")",["T_OBJECT_OPERATOR","->",698],["T_STRING","removeAllItems",698],"(",")",["T_OBJECT_OPERATOR","->",698],["T_STRING","collectTotals",698],"(",")",["T_OBJECT_OPERATOR","->",698],["T_STRING","save",698],"(",")",";",["T_WHITESPACE","\n        ",698],"}",["T_WHITESPACE","\n        ",699],["T_RETURN","return",700],["T_WHITESPACE"," ",700],["T_VARIABLE","$this",700],";",["T_WHITESPACE","\n    ",700],"}",["T_WHITESPACE","\n\n    ",701],["T_DOC_COMMENT","\/**\n     * Remove item from some of customer items storage (shopping cart, wishlist etc.)\n     *\n     * @param   int $itemId\n     * @param   string $from\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",703],["T_WHITESPACE","\n    ",709],["T_PUBLIC","public",710],["T_WHITESPACE"," ",710],["T_FUNCTION","function",710],["T_WHITESPACE"," ",710],["T_STRING","removeItem",710],"(",["T_VARIABLE","$itemId",710],",",["T_WHITESPACE"," ",710],["T_VARIABLE","$from",710],")",["T_WHITESPACE","\n    ",710],"{",["T_WHITESPACE","\n        ",711],["T_SWITCH","switch",712],["T_WHITESPACE"," ",712],"(",["T_VARIABLE","$from",712],")",["T_WHITESPACE"," ",712],"{",["T_WHITESPACE","\n            ",712],["T_CASE","case",713],["T_WHITESPACE"," ",713],["T_CONSTANT_ENCAPSED_STRING","'quote'",713],":",["T_WHITESPACE","\n                ",713],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","removeQuoteItem",714],"(",["T_VARIABLE","$itemId",714],")",";",["T_WHITESPACE","\n                ",714],["T_BREAK","break",715],";",["T_WHITESPACE","\n            ",715],["T_CASE","case",716],["T_WHITESPACE"," ",716],["T_CONSTANT_ENCAPSED_STRING","'cart'",716],":",["T_WHITESPACE","\n                ",716],["T_IF","if",717],["T_WHITESPACE"," ",717],"(",["T_VARIABLE","$cart",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_VARIABLE","$this",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","getCustomerCart",717],"(",")",")",["T_WHITESPACE"," ",717],"{",["T_WHITESPACE","\n                    ",717],["T_VARIABLE","$cart",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","removeItem",718],"(",["T_VARIABLE","$itemId",718],")",";",["T_WHITESPACE","\n                    ",718],["T_VARIABLE","$cart",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","collectTotals",719],"(",")",["T_WHITESPACE","\n                        ",719],["T_OBJECT_OPERATOR","->",720],["T_STRING","save",720],"(",")",";",["T_WHITESPACE","\n                ",720],"}",["T_WHITESPACE","\n                ",721],["T_BREAK","break",722],";",["T_WHITESPACE","\n            ",722],["T_CASE","case",723],["T_WHITESPACE"," ",723],["T_CONSTANT_ENCAPSED_STRING","'wishlist'",723],":",["T_WHITESPACE","\n                ",723],["T_IF","if",724],["T_WHITESPACE"," ",724],"(",["T_VARIABLE","$wishlist",724],["T_WHITESPACE"," ",724],"=",["T_WHITESPACE"," ",724],["T_VARIABLE","$this",724],["T_OBJECT_OPERATOR","->",724],["T_STRING","getCustomerWishlist",724],"(",")",")",["T_WHITESPACE"," ",724],"{",["T_WHITESPACE","\n                    ",724],["T_VARIABLE","$item",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","Mage",725],["T_DOUBLE_COLON","::",725],["T_STRING","getModel",725],"(",["T_CONSTANT_ENCAPSED_STRING","'wishlist\/item'",725],")",["T_OBJECT_OPERATOR","->",725],["T_STRING","load",725],"(",["T_VARIABLE","$itemId",725],")",";",["T_WHITESPACE","\n                    ",725],["T_VARIABLE","$item",726],["T_OBJECT_OPERATOR","->",726],["T_STRING","delete",726],"(",")",";",["T_WHITESPACE","\n                ",726],"}",["T_WHITESPACE","\n                ",727],["T_BREAK","break",728],";",["T_WHITESPACE","\n            ",728],["T_CASE","case",729],["T_WHITESPACE"," ",729],["T_CONSTANT_ENCAPSED_STRING","'compared'",729],":",["T_WHITESPACE","\n                ",729],["T_VARIABLE","$item",730],["T_WHITESPACE"," ",730],"=",["T_WHITESPACE"," ",730],["T_STRING","Mage",730],["T_DOUBLE_COLON","::",730],["T_STRING","getModel",730],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_compare_item'",730],")",["T_WHITESPACE","\n                    ",730],["T_OBJECT_OPERATOR","->",731],["T_STRING","load",731],"(",["T_VARIABLE","$itemId",731],")",["T_WHITESPACE","\n                    ",731],["T_OBJECT_OPERATOR","->",732],["T_STRING","delete",732],"(",")",";",["T_WHITESPACE","\n                ",732],["T_BREAK","break",733],";",["T_WHITESPACE","\n        ",733],"}",["T_WHITESPACE","\n        ",734],["T_RETURN","return",735],["T_WHITESPACE"," ",735],["T_VARIABLE","$this",735],";",["T_WHITESPACE","\n    ",735],"}",["T_WHITESPACE","\n\n    ",736],["T_DOC_COMMENT","\/**\n     * Remove quote item\n     *\n     * @param   int $item\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",738],["T_WHITESPACE","\n    ",743],["T_PUBLIC","public",744],["T_WHITESPACE"," ",744],["T_FUNCTION","function",744],["T_WHITESPACE"," ",744],["T_STRING","removeQuoteItem",744],"(",["T_VARIABLE","$item",744],")",["T_WHITESPACE","\n    ",744],"{",["T_WHITESPACE","\n        ",745],["T_VARIABLE","$this",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","getQuote",746],"(",")",["T_OBJECT_OPERATOR","->",746],["T_STRING","removeItem",746],"(",["T_VARIABLE","$item",746],")",";",["T_WHITESPACE","\n        ",746],["T_VARIABLE","$this",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","setRecollect",747],"(",["T_STRING","true",747],")",";",["T_WHITESPACE","\n        ",747],["T_RETURN","return",748],["T_WHITESPACE"," ",748],["T_VARIABLE","$this",748],";",["T_WHITESPACE","\n    ",748],"}",["T_WHITESPACE","\n\n    ",749],["T_DOC_COMMENT","\/**\n     * Add product to current order quote\n     * $product can be either product id or product model\n     * $config can be either buyRequest config, or just qty\n     *\n     * @param   int|Mage_Catalog_Model_Product $product\n     * @param   float|array|Varien_Object $config\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",751],["T_WHITESPACE","\n    ",759],["T_PUBLIC","public",760],["T_WHITESPACE"," ",760],["T_FUNCTION","function",760],["T_WHITESPACE"," ",760],["T_STRING","addProduct",760],"(",["T_VARIABLE","$product",760],",",["T_WHITESPACE"," ",760],["T_VARIABLE","$config",760],["T_WHITESPACE"," ",760],"=",["T_WHITESPACE"," ",760],["T_LNUMBER","1",760],")",["T_WHITESPACE","\n    ",760],"{",["T_WHITESPACE","\n        ",761],["T_IF","if",762],["T_WHITESPACE"," ",762],"(","!",["T_STRING","is_array",762],"(",["T_VARIABLE","$config",762],")",["T_WHITESPACE"," ",762],["T_BOOLEAN_AND","&&",762],["T_WHITESPACE"," ",762],"!","(",["T_VARIABLE","$config",762],["T_WHITESPACE"," ",762],["T_INSTANCEOF","instanceof",762],["T_WHITESPACE"," ",762],["T_STRING","Varien_Object",762],")",")",["T_WHITESPACE"," ",762],"{",["T_WHITESPACE","\n            ",762],["T_VARIABLE","$config",763],["T_WHITESPACE"," ",763],"=",["T_WHITESPACE"," ",763],["T_ARRAY","array",763],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",763],["T_WHITESPACE"," ",763],["T_DOUBLE_ARROW","=>",763],["T_WHITESPACE"," ",763],["T_VARIABLE","$config",763],")",";",["T_WHITESPACE","\n        ",763],"}",["T_WHITESPACE","\n        ",764],["T_VARIABLE","$config",765],["T_WHITESPACE"," ",765],"=",["T_WHITESPACE"," ",765],["T_NEW","new",765],["T_WHITESPACE"," ",765],["T_STRING","Varien_Object",765],"(",["T_VARIABLE","$config",765],")",";",["T_WHITESPACE","\n\n        ",765],["T_IF","if",767],["T_WHITESPACE"," ",767],"(","!","(",["T_VARIABLE","$product",767],["T_WHITESPACE"," ",767],["T_INSTANCEOF","instanceof",767],["T_WHITESPACE"," ",767],["T_STRING","Mage_Catalog_Model_Product",767],")",")",["T_WHITESPACE"," ",767],"{",["T_WHITESPACE","\n            ",767],["T_VARIABLE","$productId",768],["T_WHITESPACE"," ",768],"=",["T_WHITESPACE"," ",768],["T_VARIABLE","$product",768],";",["T_WHITESPACE","\n            ",768],["T_VARIABLE","$product",769],["T_WHITESPACE"," ",769],"=",["T_WHITESPACE"," ",769],["T_STRING","Mage",769],["T_DOUBLE_COLON","::",769],["T_STRING","getModel",769],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",769],")",["T_WHITESPACE","\n                ",769],["T_OBJECT_OPERATOR","->",770],["T_STRING","setStore",770],"(",["T_VARIABLE","$this",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","getSession",770],"(",")",["T_OBJECT_OPERATOR","->",770],["T_STRING","getStore",770],"(",")",")",["T_WHITESPACE","\n                ",770],["T_OBJECT_OPERATOR","->",771],["T_STRING","setStoreId",771],"(",["T_VARIABLE","$this",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getSession",771],"(",")",["T_OBJECT_OPERATOR","->",771],["T_STRING","getStoreId",771],"(",")",")",["T_WHITESPACE","\n                ",771],["T_OBJECT_OPERATOR","->",772],["T_STRING","load",772],"(",["T_VARIABLE","$product",772],")",";",["T_WHITESPACE","\n            ",772],["T_IF","if",773],["T_WHITESPACE"," ",773],"(","!",["T_VARIABLE","$product",773],["T_OBJECT_OPERATOR","->",773],["T_STRING","getId",773],"(",")",")",["T_WHITESPACE"," ",773],"{",["T_WHITESPACE","\n                ",773],["T_STRING","Mage",774],["T_DOUBLE_COLON","::",774],["T_STRING","throwException",774],"(",["T_WHITESPACE","\n                    ",774],["T_STRING","Mage",775],["T_DOUBLE_COLON","::",775],["T_STRING","helper",775],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",775],")",["T_OBJECT_OPERATOR","->",775],["T_STRING","__",775],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to add a product to cart by id \"%s\".'",775],",",["T_WHITESPACE"," ",775],["T_VARIABLE","$productId",775],")",["T_WHITESPACE","\n                ",775],")",";",["T_WHITESPACE","\n            ",776],"}",["T_WHITESPACE","\n        ",777],"}",["T_WHITESPACE","\n\n        ",778],["T_VARIABLE","$stockItem",780],["T_WHITESPACE"," ",780],"=",["T_WHITESPACE"," ",780],["T_VARIABLE","$product",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","getStockItem",780],"(",")",";",["T_WHITESPACE","\n        ",780],["T_IF","if",781],["T_WHITESPACE"," ",781],"(",["T_VARIABLE","$stockItem",781],["T_WHITESPACE"," ",781],["T_BOOLEAN_AND","&&",781],["T_WHITESPACE"," ",781],["T_VARIABLE","$stockItem",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","getIsQtyDecimal",781],"(",")",")",["T_WHITESPACE"," ",781],"{",["T_WHITESPACE","\n            ",781],["T_VARIABLE","$product",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","setIsQtyDecimal",782],"(",["T_LNUMBER","1",782],")",";",["T_WHITESPACE","\n        ",782],"}",["T_WHITESPACE"," ",783],["T_ELSE","else",783],["T_WHITESPACE"," ",783],"{",["T_WHITESPACE","\n            ",783],["T_VARIABLE","$config",784],["T_OBJECT_OPERATOR","->",784],["T_STRING","setQty",784],"(",["T_INT_CAST","(int)",784],["T_WHITESPACE"," ",784],["T_VARIABLE","$config",784],["T_OBJECT_OPERATOR","->",784],["T_STRING","getQty",784],"(",")",")",";",["T_WHITESPACE","\n        ",784],"}",["T_WHITESPACE","\n\n        ",785],["T_VARIABLE","$product",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","setCartQty",787],"(",["T_VARIABLE","$config",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","getQty",787],"(",")",")",";",["T_WHITESPACE","\n        ",787],["T_VARIABLE","$item",788],["T_WHITESPACE"," ",788],"=",["T_WHITESPACE"," ",788],["T_VARIABLE","$this",788],["T_OBJECT_OPERATOR","->",788],["T_STRING","getQuote",788],"(",")",["T_OBJECT_OPERATOR","->",788],["T_STRING","addProductAdvanced",788],"(",["T_WHITESPACE","\n            ",788],["T_VARIABLE","$product",789],",",["T_WHITESPACE","\n            ",789],["T_VARIABLE","$config",790],",",["T_WHITESPACE","\n            ",790],["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",791],["T_DOUBLE_COLON","::",791],["T_STRING","PROCESS_MODE_FULL",791],["T_WHITESPACE","\n        ",791],")",";",["T_WHITESPACE","\n        ",792],["T_IF","if",793],["T_WHITESPACE"," ",793],"(",["T_STRING","is_string",793],"(",["T_VARIABLE","$item",793],")",")",["T_WHITESPACE"," ",793],"{",["T_WHITESPACE","\n            ",793],["T_IF","if",794],["T_WHITESPACE"," ",794],"(",["T_VARIABLE","$product",794],["T_OBJECT_OPERATOR","->",794],["T_STRING","getTypeId",794],"(",")",["T_WHITESPACE"," ",794],["T_IS_NOT_EQUAL","!=",794],["T_WHITESPACE"," ",794],["T_STRING","Mage_Catalog_Model_Product_Type_Grouped",794],["T_DOUBLE_COLON","::",794],["T_STRING","TYPE_CODE",794],")",["T_WHITESPACE"," ",794],"{",["T_WHITESPACE","\n                ",794],["T_VARIABLE","$item",795],["T_WHITESPACE"," ",795],"=",["T_WHITESPACE"," ",795],["T_VARIABLE","$this",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","getQuote",795],"(",")",["T_OBJECT_OPERATOR","->",795],["T_STRING","addProductAdvanced",795],"(",["T_WHITESPACE","\n                    ",795],["T_VARIABLE","$product",796],",",["T_WHITESPACE","\n                    ",796],["T_VARIABLE","$config",797],",",["T_WHITESPACE","\n                    ",797],["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",798],["T_DOUBLE_COLON","::",798],["T_STRING","PROCESS_MODE_LITE",798],["T_WHITESPACE","\n                ",798],")",";",["T_WHITESPACE","\n            ",799],"}",["T_WHITESPACE","\n            ",800],["T_IF","if",801],["T_WHITESPACE"," ",801],"(",["T_STRING","is_string",801],"(",["T_VARIABLE","$item",801],")",")",["T_WHITESPACE"," ",801],"{",["T_WHITESPACE","\n                ",801],["T_STRING","Mage",802],["T_DOUBLE_COLON","::",802],["T_STRING","throwException",802],"(",["T_VARIABLE","$item",802],")",";",["T_WHITESPACE","\n            ",802],"}",["T_WHITESPACE","\n        ",803],"}",["T_WHITESPACE","\n        ",804],["T_VARIABLE","$item",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","checkData",805],"(",")",";",["T_WHITESPACE","\n\n        ",805],["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","setRecollect",807],"(",["T_STRING","true",807],")",";",["T_WHITESPACE","\n        ",807],["T_RETURN","return",808],["T_WHITESPACE"," ",808],["T_VARIABLE","$this",808],";",["T_WHITESPACE","\n    ",808],"}",["T_WHITESPACE","\n\n    ",809],["T_DOC_COMMENT","\/**\n     * Add multiple products to current order quote\n     *\n     * @param   array $products\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create|Exception\n     *\/",811],["T_WHITESPACE","\n    ",816],["T_PUBLIC","public",817],["T_WHITESPACE"," ",817],["T_FUNCTION","function",817],["T_WHITESPACE"," ",817],["T_STRING","addProducts",817],"(",["T_ARRAY","array",817],["T_WHITESPACE"," ",817],["T_VARIABLE","$products",817],")",["T_WHITESPACE","\n    ",817],"{",["T_WHITESPACE","\n        ",818],["T_FOREACH","foreach",819],["T_WHITESPACE"," ",819],"(",["T_VARIABLE","$products",819],["T_WHITESPACE"," ",819],["T_AS","as",819],["T_WHITESPACE"," ",819],["T_VARIABLE","$productId",819],["T_WHITESPACE"," ",819],["T_DOUBLE_ARROW","=>",819],["T_WHITESPACE"," ",819],["T_VARIABLE","$config",819],")",["T_WHITESPACE"," ",819],"{",["T_WHITESPACE","\n            ",819],["T_VARIABLE","$config",820],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",820],"]",["T_WHITESPACE"," ",820],"=",["T_WHITESPACE"," ",820],["T_ISSET","isset",820],"(",["T_VARIABLE","$config",820],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",820],"]",")",["T_WHITESPACE"," ",820],"?",["T_WHITESPACE"," ",820],["T_DOUBLE_CAST","(float)",820],["T_VARIABLE","$config",820],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",820],"]",["T_WHITESPACE"," ",820],":",["T_WHITESPACE"," ",820],["T_LNUMBER","1",820],";",["T_WHITESPACE","\n            ",820],["T_TRY","try",821],["T_WHITESPACE"," ",821],"{",["T_WHITESPACE","\n                ",821],["T_VARIABLE","$this",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","addProduct",822],"(",["T_VARIABLE","$productId",822],",",["T_WHITESPACE"," ",822],["T_VARIABLE","$config",822],")",";",["T_WHITESPACE","\n            ",822],"}",["T_WHITESPACE","\n            ",823],["T_CATCH","catch",824],["T_WHITESPACE"," ",824],"(",["T_STRING","Mage_Core_Exception",824],["T_WHITESPACE"," ",824],["T_VARIABLE","$e",824],")","{",["T_WHITESPACE","\n                ",824],["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","getSession",825],"(",")",["T_OBJECT_OPERATOR","->",825],["T_STRING","addError",825],"(",["T_VARIABLE","$e",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","getMessage",825],"(",")",")",";",["T_WHITESPACE","\n            ",825],"}",["T_WHITESPACE","\n            ",826],["T_CATCH","catch",827],["T_WHITESPACE"," ",827],"(",["T_STRING","Exception",827],["T_WHITESPACE"," ",827],["T_VARIABLE","$e",827],")","{",["T_WHITESPACE","\n                ",827],["T_RETURN","return",828],["T_WHITESPACE"," ",828],["T_VARIABLE","$e",828],";",["T_WHITESPACE","\n            ",828],"}",["T_WHITESPACE","\n        ",829],"}",["T_WHITESPACE","\n        ",830],["T_RETURN","return",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$this",831],";",["T_WHITESPACE","\n    ",831],"}",["T_WHITESPACE","\n\n    ",832],["T_DOC_COMMENT","\/**\n     * Update quantity of order quote items\n     *\n     * @param   array $data\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",834],["T_WHITESPACE","\n    ",839],["T_PUBLIC","public",840],["T_WHITESPACE"," ",840],["T_FUNCTION","function",840],["T_WHITESPACE"," ",840],["T_STRING","updateQuoteItems",840],"(",["T_VARIABLE","$data",840],")",["T_WHITESPACE","\n    ",840],"{",["T_WHITESPACE","\n        ",841],["T_IF","if",842],["T_WHITESPACE"," ",842],"(",["T_STRING","is_array",842],"(",["T_VARIABLE","$data",842],")",")",["T_WHITESPACE"," ",842],"{",["T_WHITESPACE","\n            ",842],["T_TRY","try",843],["T_WHITESPACE"," ",843],"{",["T_WHITESPACE","\n                ",843],["T_FOREACH","foreach",844],["T_WHITESPACE"," ",844],"(",["T_VARIABLE","$data",844],["T_WHITESPACE"," ",844],["T_AS","as",844],["T_WHITESPACE"," ",844],["T_VARIABLE","$itemId",844],["T_WHITESPACE"," ",844],["T_DOUBLE_ARROW","=>",844],["T_WHITESPACE"," ",844],["T_VARIABLE","$info",844],")",["T_WHITESPACE"," ",844],"{",["T_WHITESPACE","\n                    ",844],["T_IF","if",845],["T_WHITESPACE"," ",845],"(","!",["T_EMPTY","empty",845],"(",["T_VARIABLE","$info",845],"[",["T_CONSTANT_ENCAPSED_STRING","'configured'",845],"]",")",")",["T_WHITESPACE"," ",845],"{",["T_WHITESPACE","\n                        ",845],["T_VARIABLE","$item",846],["T_WHITESPACE"," ",846],"=",["T_WHITESPACE"," ",846],["T_VARIABLE","$this",846],["T_OBJECT_OPERATOR","->",846],["T_STRING","getQuote",846],"(",")",["T_OBJECT_OPERATOR","->",846],["T_STRING","updateItem",846],"(",["T_VARIABLE","$itemId",846],",",["T_WHITESPACE"," ",846],["T_NEW","new",846],["T_WHITESPACE"," ",846],["T_STRING","Varien_Object",846],"(",["T_VARIABLE","$info",846],")",")",";",["T_WHITESPACE","\n                        ",846],["T_VARIABLE","$itemQty",847],["T_WHITESPACE"," ",847],"=",["T_WHITESPACE"," ",847],["T_DOUBLE_CAST","(float)",847],["T_VARIABLE","$item",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","getQty",847],"(",")",";",["T_WHITESPACE","\n                    ",847],"}",["T_WHITESPACE"," ",848],["T_ELSE","else",848],["T_WHITESPACE"," ",848],"{",["T_WHITESPACE","\n                        ",848],["T_VARIABLE","$item",849],["T_WHITESPACE","       ",849],"=",["T_WHITESPACE"," ",849],["T_VARIABLE","$this",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","getQuote",849],"(",")",["T_OBJECT_OPERATOR","->",849],["T_STRING","getItemById",849],"(",["T_VARIABLE","$itemId",849],")",";",["T_WHITESPACE","\n                        ",849],["T_VARIABLE","$itemQty",850],["T_WHITESPACE","    ",850],"=",["T_WHITESPACE"," ",850],["T_DOUBLE_CAST","(float)",850],["T_VARIABLE","$info",850],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",850],"]",";",["T_WHITESPACE","\n                    ",850],"}",["T_WHITESPACE","\n\n                    ",851],["T_IF","if",853],["T_WHITESPACE"," ",853],"(",["T_VARIABLE","$item",853],")",["T_WHITESPACE"," ",853],"{",["T_WHITESPACE","\n                        ",853],["T_IF","if",854],["T_WHITESPACE"," ",854],"(",["T_VARIABLE","$item",854],["T_OBJECT_OPERATOR","->",854],["T_STRING","getProduct",854],"(",")",["T_OBJECT_OPERATOR","->",854],["T_STRING","getStockItem",854],"(",")",")",["T_WHITESPACE"," ",854],"{",["T_WHITESPACE","\n                            ",854],["T_IF","if",855],["T_WHITESPACE"," ",855],"(","!",["T_VARIABLE","$item",855],["T_OBJECT_OPERATOR","->",855],["T_STRING","getProduct",855],"(",")",["T_OBJECT_OPERATOR","->",855],["T_STRING","getStockItem",855],"(",")",["T_OBJECT_OPERATOR","->",855],["T_STRING","getIsQtyDecimal",855],"(",")",")",["T_WHITESPACE"," ",855],"{",["T_WHITESPACE","\n                                ",855],["T_VARIABLE","$itemQty",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_INT_CAST","(int)",856],["T_VARIABLE","$itemQty",856],";",["T_WHITESPACE","\n                            ",856],"}",["T_WHITESPACE"," ",857],["T_ELSE","else",857],["T_WHITESPACE"," ",857],"{",["T_WHITESPACE","\n                                ",857],["T_VARIABLE","$item",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","setIsQtyDecimal",858],"(",["T_LNUMBER","1",858],")",";",["T_WHITESPACE","\n                            ",858],"}",["T_WHITESPACE","\n                        ",859],"}",["T_WHITESPACE","\n                        ",860],["T_VARIABLE","$itemQty",861],["T_WHITESPACE","    ",861],"=",["T_WHITESPACE"," ",861],["T_VARIABLE","$itemQty",861],["T_WHITESPACE"," ",861],">",["T_WHITESPACE"," ",861],["T_LNUMBER","0",861],["T_WHITESPACE"," ",861],"?",["T_WHITESPACE"," ",861],["T_VARIABLE","$itemQty",861],["T_WHITESPACE"," ",861],":",["T_WHITESPACE"," ",861],["T_LNUMBER","1",861],";",["T_WHITESPACE","\n                        ",861],["T_IF","if",862],["T_WHITESPACE"," ",862],"(",["T_ISSET","isset",862],"(",["T_VARIABLE","$info",862],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_price'",862],"]",")",")",["T_WHITESPACE"," ",862],"{",["T_WHITESPACE","\n                            ",862],["T_VARIABLE","$itemPrice",863],["T_WHITESPACE","  ",863],"=",["T_WHITESPACE"," ",863],["T_VARIABLE","$this",863],["T_OBJECT_OPERATOR","->",863],["T_STRING","_parseCustomPrice",863],"(",["T_VARIABLE","$info",863],"[",["T_CONSTANT_ENCAPSED_STRING","'custom_price'",863],"]",")",";",["T_WHITESPACE","\n                        ",863],"}",["T_WHITESPACE"," ",864],["T_ELSE","else",864],["T_WHITESPACE"," ",864],"{",["T_WHITESPACE","\n                            ",864],["T_VARIABLE","$itemPrice",865],["T_WHITESPACE"," ",865],"=",["T_WHITESPACE"," ",865],["T_STRING","null",865],";",["T_WHITESPACE","\n                        ",865],"}",["T_WHITESPACE","\n                        ",866],["T_VARIABLE","$noDiscount",867],["T_WHITESPACE"," ",867],"=",["T_WHITESPACE"," ",867],"!",["T_ISSET","isset",867],"(",["T_VARIABLE","$info",867],"[",["T_CONSTANT_ENCAPSED_STRING","'use_discount'",867],"]",")",";",["T_WHITESPACE","\n\n                        ",867],["T_IF","if",869],["T_WHITESPACE"," ",869],"(",["T_EMPTY","empty",869],"(",["T_VARIABLE","$info",869],"[",["T_CONSTANT_ENCAPSED_STRING","'action'",869],"]",")",["T_WHITESPACE"," ",869],["T_BOOLEAN_OR","||",869],["T_WHITESPACE"," ",869],"!",["T_EMPTY","empty",869],"(",["T_VARIABLE","$info",869],"[",["T_CONSTANT_ENCAPSED_STRING","'configured'",869],"]",")",")",["T_WHITESPACE"," ",869],"{",["T_WHITESPACE","\n                            ",869],["T_VARIABLE","$item",870],["T_OBJECT_OPERATOR","->",870],["T_STRING","setQty",870],"(",["T_VARIABLE","$itemQty",870],")",";",["T_WHITESPACE","\n                            ",870],["T_VARIABLE","$item",871],["T_OBJECT_OPERATOR","->",871],["T_STRING","setCustomPrice",871],"(",["T_VARIABLE","$itemPrice",871],")",";",["T_WHITESPACE","\n                            ",871],["T_VARIABLE","$item",872],["T_OBJECT_OPERATOR","->",872],["T_STRING","setOriginalCustomPrice",872],"(",["T_VARIABLE","$itemPrice",872],")",";",["T_WHITESPACE","\n                            ",872],["T_VARIABLE","$item",873],["T_OBJECT_OPERATOR","->",873],["T_STRING","setNoDiscount",873],"(",["T_VARIABLE","$noDiscount",873],")",";",["T_WHITESPACE","\n                            ",873],["T_VARIABLE","$item",874],["T_OBJECT_OPERATOR","->",874],["T_STRING","getProduct",874],"(",")",["T_OBJECT_OPERATOR","->",874],["T_STRING","setIsSuperMode",874],"(",["T_STRING","true",874],")",";",["T_WHITESPACE","\n                            ",874],["T_VARIABLE","$item",875],["T_OBJECT_OPERATOR","->",875],["T_STRING","getProduct",875],"(",")",["T_OBJECT_OPERATOR","->",875],["T_STRING","unsSkipCheckRequiredOption",875],"(",")",";",["T_WHITESPACE","\n                            ",875],["T_VARIABLE","$item",876],["T_OBJECT_OPERATOR","->",876],["T_STRING","checkData",876],"(",")",";",["T_WHITESPACE","\n                        ",876],"}",["T_WHITESPACE","\n                        ",877],["T_IF","if",878],["T_WHITESPACE"," ",878],"(","!",["T_EMPTY","empty",878],"(",["T_VARIABLE","$info",878],"[",["T_CONSTANT_ENCAPSED_STRING","'action'",878],"]",")",")",["T_WHITESPACE"," ",878],"{",["T_WHITESPACE","\n                            ",878],["T_VARIABLE","$this",879],["T_OBJECT_OPERATOR","->",879],["T_STRING","moveQuoteItem",879],"(",["T_VARIABLE","$item",879],",",["T_WHITESPACE"," ",879],["T_VARIABLE","$info",879],"[",["T_CONSTANT_ENCAPSED_STRING","'action'",879],"]",",",["T_WHITESPACE"," ",879],["T_VARIABLE","$itemQty",879],")",";",["T_WHITESPACE","\n                        ",879],"}",["T_WHITESPACE","\n                    ",880],"}",["T_WHITESPACE","\n                ",881],"}",["T_WHITESPACE","\n            ",882],"}",["T_WHITESPACE"," ",883],["T_CATCH","catch",883],["T_WHITESPACE"," ",883],"(",["T_STRING","Mage_Core_Exception",883],["T_WHITESPACE"," ",883],["T_VARIABLE","$e",883],")",["T_WHITESPACE"," ",883],"{",["T_WHITESPACE","\n                ",883],["T_VARIABLE","$this",884],["T_OBJECT_OPERATOR","->",884],["T_STRING","recollectCart",884],"(",")",";",["T_WHITESPACE","\n                ",884],["T_THROW","throw",885],["T_WHITESPACE"," ",885],["T_VARIABLE","$e",885],";",["T_WHITESPACE","\n            ",885],"}",["T_WHITESPACE"," ",886],["T_CATCH","catch",886],["T_WHITESPACE"," ",886],"(",["T_STRING","Exception",886],["T_WHITESPACE"," ",886],["T_VARIABLE","$e",886],")",["T_WHITESPACE"," ",886],"{",["T_WHITESPACE","\n                ",886],["T_STRING","Mage",887],["T_DOUBLE_COLON","::",887],["T_STRING","logException",887],"(",["T_VARIABLE","$e",887],")",";",["T_WHITESPACE","\n            ",887],"}",["T_WHITESPACE","\n            ",888],["T_VARIABLE","$this",889],["T_OBJECT_OPERATOR","->",889],["T_STRING","recollectCart",889],"(",")",";",["T_WHITESPACE","\n        ",889],"}",["T_WHITESPACE","\n        ",890],["T_RETURN","return",891],["T_WHITESPACE"," ",891],["T_VARIABLE","$this",891],";",["T_WHITESPACE","\n    ",891],"}",["T_WHITESPACE","\n\n    ",892],["T_DOC_COMMENT","\/**\n     * Parse additional options and sync them with product options\n     *\n     * @param Mage_Sales_Model_Quote_Item $product\n     * @param array $options\n     *\/",894],["T_WHITESPACE","\n    ",899],["T_PROTECTED","protected",900],["T_WHITESPACE"," ",900],["T_FUNCTION","function",900],["T_WHITESPACE"," ",900],["T_STRING","_parseOptions",900],"(",["T_STRING","Mage_Sales_Model_Quote_Item",900],["T_WHITESPACE"," ",900],["T_VARIABLE","$item",900],",",["T_WHITESPACE"," ",900],["T_VARIABLE","$additionalOptions",900],")",["T_WHITESPACE","\n    ",900],"{",["T_WHITESPACE","\n        ",901],["T_VARIABLE","$productOptions",902],["T_WHITESPACE"," ",902],"=",["T_WHITESPACE"," ",902],["T_STRING","Mage",902],["T_DOUBLE_COLON","::",902],["T_STRING","getSingleton",902],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_default'",902],")",["T_WHITESPACE","\n            ",902],["T_OBJECT_OPERATOR","->",903],["T_STRING","setProduct",903],"(",["T_VARIABLE","$item",903],["T_OBJECT_OPERATOR","->",903],["T_STRING","getProduct",903],"(",")",")",["T_WHITESPACE","\n            ",903],["T_OBJECT_OPERATOR","->",904],["T_STRING","getProductOptions",904],"(",")",";",["T_WHITESPACE","\n\n        ",904],["T_VARIABLE","$newOptions",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],["T_ARRAY","array",906],"(",")",";",["T_WHITESPACE","\n        ",906],["T_VARIABLE","$newAdditionalOptions",907],["T_WHITESPACE"," ",907],"=",["T_WHITESPACE"," ",907],["T_ARRAY","array",907],"(",")",";",["T_WHITESPACE","\n\n        ",907],["T_FOREACH","foreach",909],["T_WHITESPACE"," ",909],"(",["T_STRING","explode",909],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",909],",",["T_WHITESPACE"," ",909],["T_VARIABLE","$additionalOptions",909],")",["T_WHITESPACE"," ",909],["T_AS","as",909],["T_WHITESPACE"," ",909],["T_VARIABLE","$_additionalOption",909],")",["T_WHITESPACE"," ",909],"{",["T_WHITESPACE","\n            ",909],["T_IF","if",910],["T_WHITESPACE"," ",910],"(",["T_STRING","strlen",910],"(",["T_STRING","trim",910],"(",["T_VARIABLE","$_additionalOption",910],")",")",")",["T_WHITESPACE"," ",910],"{",["T_WHITESPACE","\n                ",910],["T_TRY","try",911],["T_WHITESPACE"," ",911],"{",["T_WHITESPACE","\n                    ",911],["T_IF","if",912],["T_WHITESPACE"," ",912],"(",["T_STRING","strpos",912],"(",["T_VARIABLE","$_additionalOption",912],",",["T_WHITESPACE"," ",912],["T_CONSTANT_ENCAPSED_STRING","':'",912],")",["T_WHITESPACE"," ",912],["T_IS_IDENTICAL","===",912],["T_WHITESPACE"," ",912],["T_STRING","false",912],")",["T_WHITESPACE"," ",912],"{",["T_WHITESPACE","\n                        ",912],["T_STRING","Mage",913],["T_DOUBLE_COLON","::",913],["T_STRING","throwException",913],"(",["T_WHITESPACE","\n                            ",913],["T_STRING","Mage",914],["T_DOUBLE_COLON","::",914],["T_STRING","helper",914],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",914],")",["T_OBJECT_OPERATOR","->",914],["T_STRING","__",914],"(",["T_CONSTANT_ENCAPSED_STRING","'There is an error in one of the option rows.'",914],")",["T_WHITESPACE","\n                        ",914],")",";",["T_WHITESPACE","\n                    ",915],"}",["T_WHITESPACE","\n                    ",916],["T_LIST","list",917],"(",["T_VARIABLE","$label",917],",",["T_VARIABLE","$value",917],")",["T_WHITESPACE"," ",917],"=",["T_WHITESPACE"," ",917],["T_STRING","explode",917],"(",["T_CONSTANT_ENCAPSED_STRING","':'",917],",",["T_WHITESPACE"," ",917],["T_VARIABLE","$_additionalOption",917],",",["T_WHITESPACE"," ",917],["T_LNUMBER","2",917],")",";",["T_WHITESPACE","\n                ",917],"}",["T_WHITESPACE"," ",918],["T_CATCH","catch",918],["T_WHITESPACE"," ",918],"(",["T_STRING","Exception",918],["T_WHITESPACE"," ",918],["T_VARIABLE","$e",918],")",["T_WHITESPACE"," ",918],"{",["T_WHITESPACE","\n                    ",918],["T_STRING","Mage",919],["T_DOUBLE_COLON","::",919],["T_STRING","throwException",919],"(",["T_STRING","Mage",919],["T_DOUBLE_COLON","::",919],["T_STRING","helper",919],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",919],")",["T_OBJECT_OPERATOR","->",919],["T_STRING","__",919],"(",["T_CONSTANT_ENCAPSED_STRING","'There is an error in one of the option rows.'",919],")",")",";",["T_WHITESPACE","\n                ",919],"}",["T_WHITESPACE","\n                ",920],["T_VARIABLE","$label",921],["T_WHITESPACE"," ",921],"=",["T_WHITESPACE"," ",921],["T_STRING","trim",921],"(",["T_VARIABLE","$label",921],")",";",["T_WHITESPACE","\n                ",921],["T_VARIABLE","$value",922],["T_WHITESPACE"," ",922],"=",["T_WHITESPACE"," ",922],["T_STRING","trim",922],"(",["T_VARIABLE","$value",922],")",";",["T_WHITESPACE","\n                ",922],["T_IF","if",923],["T_WHITESPACE"," ",923],"(",["T_EMPTY","empty",923],"(",["T_VARIABLE","$value",923],")",")",["T_WHITESPACE"," ",923],"{",["T_WHITESPACE","\n                    ",923],["T_CONTINUE","continue",924],";",["T_WHITESPACE","\n                ",924],"}",["T_WHITESPACE","\n\n                ",925],["T_IF","if",927],["T_WHITESPACE"," ",927],"(",["T_STRING","array_key_exists",927],"(",["T_VARIABLE","$label",927],",",["T_WHITESPACE"," ",927],["T_VARIABLE","$productOptions",927],")",")",["T_WHITESPACE"," ",927],"{",["T_WHITESPACE","\n                    ",927],["T_VARIABLE","$optionId",928],["T_WHITESPACE"," ",928],"=",["T_WHITESPACE"," ",928],["T_VARIABLE","$productOptions",928],"[",["T_VARIABLE","$label",928],"]","[",["T_CONSTANT_ENCAPSED_STRING","'option_id'",928],"]",";",["T_WHITESPACE","\n                    ",928],["T_VARIABLE","$option",929],["T_WHITESPACE"," ",929],"=",["T_WHITESPACE"," ",929],["T_VARIABLE","$item",929],["T_OBJECT_OPERATOR","->",929],["T_STRING","getProduct",929],"(",")",["T_OBJECT_OPERATOR","->",929],["T_STRING","getOptionById",929],"(",["T_VARIABLE","$optionId",929],")",";",["T_WHITESPACE","\n\n                    ",929],["T_VARIABLE","$group",931],["T_WHITESPACE"," ",931],"=",["T_WHITESPACE"," ",931],["T_STRING","Mage",931],["T_DOUBLE_COLON","::",931],["T_STRING","getSingleton",931],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",931],")",["T_OBJECT_OPERATOR","->",931],["T_STRING","groupFactory",931],"(",["T_VARIABLE","$option",931],["T_OBJECT_OPERATOR","->",931],["T_STRING","getType",931],"(",")",")",["T_WHITESPACE","\n                        ",931],["T_OBJECT_OPERATOR","->",932],["T_STRING","setOption",932],"(",["T_VARIABLE","$option",932],")",["T_WHITESPACE","\n                        ",932],["T_OBJECT_OPERATOR","->",933],["T_STRING","setProduct",933],"(",["T_VARIABLE","$item",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","getProduct",933],"(",")",")",";",["T_WHITESPACE","\n\n                    ",933],["T_VARIABLE","$parsedValue",935],["T_WHITESPACE"," ",935],"=",["T_WHITESPACE"," ",935],["T_VARIABLE","$group",935],["T_OBJECT_OPERATOR","->",935],["T_STRING","parseOptionValue",935],"(",["T_VARIABLE","$value",935],",",["T_WHITESPACE"," ",935],["T_VARIABLE","$productOptions",935],"[",["T_VARIABLE","$label",935],"]","[",["T_CONSTANT_ENCAPSED_STRING","'values'",935],"]",")",";",["T_WHITESPACE","\n\n                    ",935],["T_IF","if",937],["T_WHITESPACE"," ",937],"(",["T_VARIABLE","$parsedValue",937],["T_WHITESPACE"," ",937],["T_IS_NOT_IDENTICAL","!==",937],["T_WHITESPACE"," ",937],["T_STRING","null",937],")",["T_WHITESPACE"," ",937],"{",["T_WHITESPACE","\n                        ",937],["T_VARIABLE","$newOptions",938],"[",["T_VARIABLE","$optionId",938],"]",["T_WHITESPACE"," ",938],"=",["T_WHITESPACE"," ",938],["T_VARIABLE","$parsedValue",938],";",["T_WHITESPACE","\n                    ",938],"}",["T_WHITESPACE"," ",939],["T_ELSE","else",939],["T_WHITESPACE"," ",939],"{",["T_WHITESPACE","\n                        ",939],["T_VARIABLE","$newAdditionalOptions",940],"[","]",["T_WHITESPACE"," ",940],"=",["T_WHITESPACE"," ",940],["T_ARRAY","array",940],"(",["T_WHITESPACE","\n                            ",940],["T_CONSTANT_ENCAPSED_STRING","'label'",941],["T_WHITESPACE"," ",941],["T_DOUBLE_ARROW","=>",941],["T_WHITESPACE"," ",941],["T_VARIABLE","$label",941],",",["T_WHITESPACE","\n                            ",941],["T_CONSTANT_ENCAPSED_STRING","'value'",942],["T_WHITESPACE"," ",942],["T_DOUBLE_ARROW","=>",942],["T_WHITESPACE"," ",942],["T_VARIABLE","$value",942],["T_WHITESPACE","\n                        ",942],")",";",["T_WHITESPACE","\n                    ",943],"}",["T_WHITESPACE","\n                ",944],"}",["T_WHITESPACE"," ",945],["T_ELSE","else",945],["T_WHITESPACE"," ",945],"{",["T_WHITESPACE","\n                    ",945],["T_VARIABLE","$newAdditionalOptions",946],"[","]",["T_WHITESPACE"," ",946],"=",["T_WHITESPACE"," ",946],["T_ARRAY","array",946],"(",["T_WHITESPACE","\n                        ",946],["T_CONSTANT_ENCAPSED_STRING","'label'",947],["T_WHITESPACE"," ",947],["T_DOUBLE_ARROW","=>",947],["T_WHITESPACE"," ",947],["T_VARIABLE","$label",947],",",["T_WHITESPACE","\n                        ",947],["T_CONSTANT_ENCAPSED_STRING","'value'",948],["T_WHITESPACE"," ",948],["T_DOUBLE_ARROW","=>",948],["T_WHITESPACE"," ",948],["T_VARIABLE","$value",948],["T_WHITESPACE","\n                    ",948],")",";",["T_WHITESPACE","\n                ",949],"}",["T_WHITESPACE","\n            ",950],"}",["T_WHITESPACE","\n        ",951],"}",["T_WHITESPACE","\n\n        ",952],["T_RETURN","return",954],["T_WHITESPACE"," ",954],["T_ARRAY","array",954],"(",["T_WHITESPACE","\n            ",954],["T_CONSTANT_ENCAPSED_STRING","'options'",955],["T_WHITESPACE"," ",955],["T_DOUBLE_ARROW","=>",955],["T_WHITESPACE"," ",955],["T_VARIABLE","$newOptions",955],",",["T_WHITESPACE","\n            ",955],["T_CONSTANT_ENCAPSED_STRING","'additional_options'",956],["T_WHITESPACE"," ",956],["T_DOUBLE_ARROW","=>",956],["T_WHITESPACE"," ",956],["T_VARIABLE","$newAdditionalOptions",956],["T_WHITESPACE","\n        ",956],")",";",["T_WHITESPACE","\n    ",957],"}",["T_WHITESPACE","\n\n    ",958],["T_DOC_COMMENT","\/**\n     * Assign options to item\n     *\n     * @param Mage_Sales_Model_Quote_Item $item\n     * @param array $options\n     *\/",960],["T_WHITESPACE","\n    ",965],["T_PROTECTED","protected",966],["T_WHITESPACE"," ",966],["T_FUNCTION","function",966],["T_WHITESPACE"," ",966],["T_STRING","_assignOptionsToItem",966],"(",["T_STRING","Mage_Sales_Model_Quote_Item",966],["T_WHITESPACE"," ",966],["T_VARIABLE","$item",966],",",["T_WHITESPACE"," ",966],["T_VARIABLE","$options",966],")",["T_WHITESPACE","\n    ",966],"{",["T_WHITESPACE","\n        ",967],["T_IF","if",968],["T_WHITESPACE"," ",968],"(",["T_VARIABLE","$optionIds",968],["T_WHITESPACE"," ",968],"=",["T_WHITESPACE"," ",968],["T_VARIABLE","$item",968],["T_OBJECT_OPERATOR","->",968],["T_STRING","getOptionByCode",968],"(",["T_CONSTANT_ENCAPSED_STRING","'option_ids'",968],")",")",["T_WHITESPACE"," ",968],"{",["T_WHITESPACE","\n            ",968],["T_FOREACH","foreach",969],["T_WHITESPACE"," ",969],"(",["T_STRING","explode",969],"(",["T_CONSTANT_ENCAPSED_STRING","','",969],",",["T_WHITESPACE"," ",969],["T_VARIABLE","$optionIds",969],["T_OBJECT_OPERATOR","->",969],["T_STRING","getValue",969],"(",")",")",["T_WHITESPACE"," ",969],["T_AS","as",969],["T_WHITESPACE"," ",969],["T_VARIABLE","$optionId",969],")",["T_WHITESPACE"," ",969],"{",["T_WHITESPACE","\n                ",969],["T_VARIABLE","$item",970],["T_OBJECT_OPERATOR","->",970],["T_STRING","removeOption",970],"(",["T_CONSTANT_ENCAPSED_STRING","'option_'",970],".",["T_VARIABLE","$optionId",970],")",";",["T_WHITESPACE","\n            ",970],"}",["T_WHITESPACE","\n            ",971],["T_VARIABLE","$item",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","removeOption",972],"(",["T_CONSTANT_ENCAPSED_STRING","'option_ids'",972],")",";",["T_WHITESPACE","\n        ",972],"}",["T_WHITESPACE","\n        ",973],["T_IF","if",974],["T_WHITESPACE"," ",974],"(",["T_VARIABLE","$item",974],["T_OBJECT_OPERATOR","->",974],["T_STRING","getOptionByCode",974],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",974],")",")",["T_WHITESPACE"," ",974],"{",["T_WHITESPACE","\n            ",974],["T_VARIABLE","$item",975],["T_OBJECT_OPERATOR","->",975],["T_STRING","removeOption",975],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",975],")",";",["T_WHITESPACE","\n        ",975],"}",["T_WHITESPACE","\n        ",976],["T_VARIABLE","$item",977],["T_OBJECT_OPERATOR","->",977],["T_STRING","save",977],"(",")",";",["T_WHITESPACE","\n        ",977],["T_IF","if",978],["T_WHITESPACE"," ",978],"(","!",["T_EMPTY","empty",978],"(",["T_VARIABLE","$options",978],"[",["T_CONSTANT_ENCAPSED_STRING","'options'",978],"]",")",")",["T_WHITESPACE"," ",978],"{",["T_WHITESPACE","\n            ",978],["T_VARIABLE","$item",979],["T_OBJECT_OPERATOR","->",979],["T_STRING","addOption",979],"(",["T_NEW","new",979],["T_WHITESPACE"," ",979],["T_STRING","Varien_Object",979],"(",["T_WHITESPACE","\n                ",979],["T_ARRAY","array",980],"(",["T_WHITESPACE","\n                    ",980],["T_CONSTANT_ENCAPSED_STRING","'product'",981],["T_WHITESPACE"," ",981],["T_DOUBLE_ARROW","=>",981],["T_WHITESPACE"," ",981],["T_VARIABLE","$item",981],["T_OBJECT_OPERATOR","->",981],["T_STRING","getProduct",981],"(",")",",",["T_WHITESPACE","\n                    ",981],["T_CONSTANT_ENCAPSED_STRING","'code'",982],["T_WHITESPACE"," ",982],["T_DOUBLE_ARROW","=>",982],["T_WHITESPACE"," ",982],["T_CONSTANT_ENCAPSED_STRING","'option_ids'",982],",",["T_WHITESPACE","\n                    ",982],["T_CONSTANT_ENCAPSED_STRING","'value'",983],["T_WHITESPACE"," ",983],["T_DOUBLE_ARROW","=>",983],["T_WHITESPACE"," ",983],["T_STRING","implode",983],"(",["T_CONSTANT_ENCAPSED_STRING","','",983],",",["T_WHITESPACE"," ",983],["T_STRING","array_keys",983],"(",["T_VARIABLE","$options",983],"[",["T_CONSTANT_ENCAPSED_STRING","'options'",983],"]",")",")",["T_WHITESPACE","\n                ",983],")",["T_WHITESPACE","\n            ",984],")",")",";",["T_WHITESPACE","\n\n            ",985],["T_FOREACH","foreach",987],["T_WHITESPACE"," ",987],"(",["T_VARIABLE","$options",987],"[",["T_CONSTANT_ENCAPSED_STRING","'options'",987],"]",["T_WHITESPACE"," ",987],["T_AS","as",987],["T_WHITESPACE"," ",987],["T_VARIABLE","$optionId",987],["T_WHITESPACE"," ",987],["T_DOUBLE_ARROW","=>",987],["T_WHITESPACE"," ",987],["T_VARIABLE","$optionValue",987],")",["T_WHITESPACE"," ",987],"{",["T_WHITESPACE","\n                ",987],["T_VARIABLE","$item",988],["T_OBJECT_OPERATOR","->",988],["T_STRING","addOption",988],"(",["T_NEW","new",988],["T_WHITESPACE"," ",988],["T_STRING","Varien_Object",988],"(",["T_WHITESPACE","\n                    ",988],["T_ARRAY","array",989],"(",["T_WHITESPACE","\n                        ",989],["T_CONSTANT_ENCAPSED_STRING","'product'",990],["T_WHITESPACE"," ",990],["T_DOUBLE_ARROW","=>",990],["T_WHITESPACE"," ",990],["T_VARIABLE","$item",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","getProduct",990],"(",")",",",["T_WHITESPACE","\n                        ",990],["T_CONSTANT_ENCAPSED_STRING","'code'",991],["T_WHITESPACE"," ",991],["T_DOUBLE_ARROW","=>",991],["T_WHITESPACE"," ",991],["T_CONSTANT_ENCAPSED_STRING","'option_'",991],".",["T_VARIABLE","$optionId",991],",",["T_WHITESPACE","\n                        ",991],["T_CONSTANT_ENCAPSED_STRING","'value'",992],["T_WHITESPACE"," ",992],["T_DOUBLE_ARROW","=>",992],["T_WHITESPACE"," ",992],["T_VARIABLE","$optionValue",992],["T_WHITESPACE","\n                    ",992],")",["T_WHITESPACE","\n                ",993],")",")",";",["T_WHITESPACE","\n            ",994],"}",["T_WHITESPACE","\n        ",995],"}",["T_WHITESPACE","\n        ",996],["T_IF","if",997],["T_WHITESPACE"," ",997],"(","!",["T_EMPTY","empty",997],"(",["T_VARIABLE","$options",997],"[",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",997],"]",")",")",["T_WHITESPACE"," ",997],"{",["T_WHITESPACE","\n            ",997],["T_VARIABLE","$item",998],["T_OBJECT_OPERATOR","->",998],["T_STRING","addOption",998],"(",["T_NEW","new",998],["T_WHITESPACE"," ",998],["T_STRING","Varien_Object",998],"(",["T_WHITESPACE","\n                ",998],["T_ARRAY","array",999],"(",["T_WHITESPACE","\n                    ",999],["T_CONSTANT_ENCAPSED_STRING","'product'",1000],["T_WHITESPACE"," ",1000],["T_DOUBLE_ARROW","=>",1000],["T_WHITESPACE"," ",1000],["T_VARIABLE","$item",1000],["T_OBJECT_OPERATOR","->",1000],["T_STRING","getProduct",1000],"(",")",",",["T_WHITESPACE","\n                    ",1000],["T_CONSTANT_ENCAPSED_STRING","'code'",1001],["T_WHITESPACE"," ",1001],["T_DOUBLE_ARROW","=>",1001],["T_WHITESPACE"," ",1001],["T_CONSTANT_ENCAPSED_STRING","'additional_options'",1001],",",["T_WHITESPACE","\n                    ",1001],["T_CONSTANT_ENCAPSED_STRING","'value'",1002],["T_WHITESPACE"," ",1002],["T_DOUBLE_ARROW","=>",1002],["T_WHITESPACE"," ",1002],["T_STRING","serialize",1002],"(",["T_VARIABLE","$options",1002],"[",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",1002],"]",")",["T_WHITESPACE","\n                ",1002],")",["T_WHITESPACE","\n            ",1003],")",")",";",["T_WHITESPACE","\n        ",1004],"}",["T_WHITESPACE","\n\n        ",1005],["T_RETURN","return",1007],["T_WHITESPACE"," ",1007],["T_VARIABLE","$this",1007],";",["T_WHITESPACE","\n    ",1007],"}",["T_WHITESPACE","\n\n    ",1008],["T_DOC_COMMENT","\/**\n     * Prepare options array for info buy request\n     *\n     * @param Mage_Sales_Model_Quote_Item $item\n     * @return array\n     *\/",1010],["T_WHITESPACE","\n    ",1015],["T_PROTECTED","protected",1016],["T_WHITESPACE"," ",1016],["T_FUNCTION","function",1016],["T_WHITESPACE"," ",1016],["T_STRING","_prepareOptionsForRequest",1016],"(",["T_VARIABLE","$item",1016],")",["T_WHITESPACE","\n    ",1016],"{",["T_WHITESPACE","\n        ",1017],["T_VARIABLE","$newInfoOptions",1018],["T_WHITESPACE"," ",1018],"=",["T_WHITESPACE"," ",1018],["T_ARRAY","array",1018],"(",")",";",["T_WHITESPACE","\n        ",1018],["T_IF","if",1019],["T_WHITESPACE"," ",1019],"(",["T_VARIABLE","$optionIds",1019],["T_WHITESPACE"," ",1019],"=",["T_WHITESPACE"," ",1019],["T_VARIABLE","$item",1019],["T_OBJECT_OPERATOR","->",1019],["T_STRING","getOptionByCode",1019],"(",["T_CONSTANT_ENCAPSED_STRING","'option_ids'",1019],")",")",["T_WHITESPACE"," ",1019],"{",["T_WHITESPACE","\n            ",1019],["T_FOREACH","foreach",1020],["T_WHITESPACE"," ",1020],"(",["T_STRING","explode",1020],"(",["T_CONSTANT_ENCAPSED_STRING","','",1020],",",["T_WHITESPACE"," ",1020],["T_VARIABLE","$optionIds",1020],["T_OBJECT_OPERATOR","->",1020],["T_STRING","getValue",1020],"(",")",")",["T_WHITESPACE"," ",1020],["T_AS","as",1020],["T_WHITESPACE"," ",1020],["T_VARIABLE","$optionId",1020],")",["T_WHITESPACE"," ",1020],"{",["T_WHITESPACE","\n                ",1020],["T_VARIABLE","$option",1021],["T_WHITESPACE"," ",1021],"=",["T_WHITESPACE"," ",1021],["T_VARIABLE","$item",1021],["T_OBJECT_OPERATOR","->",1021],["T_STRING","getProduct",1021],"(",")",["T_OBJECT_OPERATOR","->",1021],["T_STRING","getOptionById",1021],"(",["T_VARIABLE","$optionId",1021],")",";",["T_WHITESPACE","\n                ",1021],["T_VARIABLE","$optionValue",1022],["T_WHITESPACE"," ",1022],"=",["T_WHITESPACE"," ",1022],["T_VARIABLE","$item",1022],["T_OBJECT_OPERATOR","->",1022],["T_STRING","getOptionByCode",1022],"(",["T_CONSTANT_ENCAPSED_STRING","'option_'",1022],".",["T_VARIABLE","$optionId",1022],")",["T_OBJECT_OPERATOR","->",1022],["T_STRING","getValue",1022],"(",")",";",["T_WHITESPACE","\n\n                ",1022],["T_VARIABLE","$group",1024],["T_WHITESPACE"," ",1024],"=",["T_WHITESPACE"," ",1024],["T_STRING","Mage",1024],["T_DOUBLE_COLON","::",1024],["T_STRING","getSingleton",1024],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",1024],")",["T_OBJECT_OPERATOR","->",1024],["T_STRING","groupFactory",1024],"(",["T_VARIABLE","$option",1024],["T_OBJECT_OPERATOR","->",1024],["T_STRING","getType",1024],"(",")",")",["T_WHITESPACE","\n                    ",1024],["T_OBJECT_OPERATOR","->",1025],["T_STRING","setOption",1025],"(",["T_VARIABLE","$option",1025],")",["T_WHITESPACE","\n                    ",1025],["T_OBJECT_OPERATOR","->",1026],["T_STRING","setQuoteItem",1026],"(",["T_VARIABLE","$item",1026],")",";",["T_WHITESPACE","\n\n                ",1026],["T_VARIABLE","$newInfoOptions",1028],"[",["T_VARIABLE","$optionId",1028],"]",["T_WHITESPACE"," ",1028],"=",["T_WHITESPACE"," ",1028],["T_VARIABLE","$group",1028],["T_OBJECT_OPERATOR","->",1028],["T_STRING","prepareOptionValueForRequest",1028],"(",["T_VARIABLE","$optionValue",1028],")",";",["T_WHITESPACE","\n            ",1028],"}",["T_WHITESPACE","\n        ",1029],"}",["T_WHITESPACE","\n        ",1030],["T_RETURN","return",1031],["T_WHITESPACE"," ",1031],["T_VARIABLE","$newInfoOptions",1031],";",["T_WHITESPACE","\n    ",1031],"}",["T_WHITESPACE","\n\n    ",1032],["T_PROTECTED","protected",1034],["T_WHITESPACE"," ",1034],["T_FUNCTION","function",1034],["T_WHITESPACE"," ",1034],["T_STRING","_parseCustomPrice",1034],"(",["T_VARIABLE","$price",1034],")",["T_WHITESPACE","\n    ",1034],"{",["T_WHITESPACE","\n        ",1035],["T_VARIABLE","$price",1036],["T_WHITESPACE"," ",1036],"=",["T_WHITESPACE"," ",1036],["T_STRING","Mage",1036],["T_DOUBLE_COLON","::",1036],["T_STRING","app",1036],"(",")",["T_OBJECT_OPERATOR","->",1036],["T_STRING","getLocale",1036],"(",")",["T_OBJECT_OPERATOR","->",1036],["T_STRING","getNumber",1036],"(",["T_VARIABLE","$price",1036],")",";",["T_WHITESPACE","\n        ",1036],["T_VARIABLE","$price",1037],["T_WHITESPACE"," ",1037],"=",["T_WHITESPACE"," ",1037],["T_VARIABLE","$price",1037],">",["T_LNUMBER","0",1037],["T_WHITESPACE"," ",1037],"?",["T_WHITESPACE"," ",1037],["T_VARIABLE","$price",1037],["T_WHITESPACE"," ",1037],":",["T_WHITESPACE"," ",1037],["T_LNUMBER","0",1037],";",["T_WHITESPACE","\n        ",1037],["T_RETURN","return",1038],["T_WHITESPACE"," ",1038],["T_VARIABLE","$price",1038],";",["T_WHITESPACE","\n    ",1038],"}",["T_WHITESPACE","\n\n    ",1039],["T_DOC_COMMENT","\/**\n     * Retrieve oreder quote shipping address\n     *\n     * @return Mage_Sales_Model_Quote_Address\n     *\/",1041],["T_WHITESPACE","\n    ",1045],["T_PUBLIC","public",1046],["T_WHITESPACE"," ",1046],["T_FUNCTION","function",1046],["T_WHITESPACE"," ",1046],["T_STRING","getShippingAddress",1046],"(",")",["T_WHITESPACE","\n    ",1046],"{",["T_WHITESPACE","\n        ",1047],["T_RETURN","return",1048],["T_WHITESPACE"," ",1048],["T_VARIABLE","$this",1048],["T_OBJECT_OPERATOR","->",1048],["T_STRING","getQuote",1048],"(",")",["T_OBJECT_OPERATOR","->",1048],["T_STRING","getShippingAddress",1048],"(",")",";",["T_WHITESPACE","\n    ",1048],"}",["T_WHITESPACE","\n\n    ",1049],["T_DOC_COMMENT","\/**\n     * Return Customer (Checkout) Form instance\n     *\n     * @return Mage_Customer_Model_Form\n     *\/",1051],["T_WHITESPACE","\n    ",1055],["T_PROTECTED","protected",1056],["T_WHITESPACE"," ",1056],["T_FUNCTION","function",1056],["T_WHITESPACE"," ",1056],["T_STRING","_getCustomerForm",1056],"(",")",["T_WHITESPACE","\n    ",1056],"{",["T_WHITESPACE","\n        ",1057],["T_IF","if",1058],["T_WHITESPACE"," ",1058],"(",["T_STRING","is_null",1058],"(",["T_VARIABLE","$this",1058],["T_OBJECT_OPERATOR","->",1058],["T_STRING","_customerForm",1058],")",")",["T_WHITESPACE"," ",1058],"{",["T_WHITESPACE","\n            ",1058],["T_VARIABLE","$this",1059],["T_OBJECT_OPERATOR","->",1059],["T_STRING","_customerForm",1059],["T_WHITESPACE"," ",1059],"=",["T_WHITESPACE"," ",1059],["T_STRING","Mage",1059],["T_DOUBLE_COLON","::",1059],["T_STRING","getModel",1059],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",1059],")",["T_WHITESPACE","\n                ",1059],["T_OBJECT_OPERATOR","->",1060],["T_STRING","setFormCode",1060],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml_checkout'",1060],")",["T_WHITESPACE","\n                ",1060],["T_OBJECT_OPERATOR","->",1061],["T_STRING","ignoreInvisible",1061],"(",["T_STRING","false",1061],")",";",["T_WHITESPACE","\n        ",1061],"}",["T_WHITESPACE","\n        ",1062],["T_RETURN","return",1063],["T_WHITESPACE"," ",1063],["T_VARIABLE","$this",1063],["T_OBJECT_OPERATOR","->",1063],["T_STRING","_customerForm",1063],";",["T_WHITESPACE","\n    ",1063],"}",["T_WHITESPACE","\n\n    ",1064],["T_DOC_COMMENT","\/**\n     * Return Customer Address Form instance\n     *\n     * @return Mage_Customer_Model_Form\n     *\/",1066],["T_WHITESPACE","\n    ",1070],["T_PROTECTED","protected",1071],["T_WHITESPACE"," ",1071],["T_FUNCTION","function",1071],["T_WHITESPACE"," ",1071],["T_STRING","_getCustomerAddressForm",1071],"(",")",["T_WHITESPACE","\n    ",1071],"{",["T_WHITESPACE","\n        ",1072],["T_IF","if",1073],["T_WHITESPACE"," ",1073],"(",["T_STRING","is_null",1073],"(",["T_VARIABLE","$this",1073],["T_OBJECT_OPERATOR","->",1073],["T_STRING","_customerAddressForm",1073],")",")",["T_WHITESPACE"," ",1073],"{",["T_WHITESPACE","\n            ",1073],["T_VARIABLE","$this",1074],["T_OBJECT_OPERATOR","->",1074],["T_STRING","_customerAddressForm",1074],["T_WHITESPACE"," ",1074],"=",["T_WHITESPACE"," ",1074],["T_STRING","Mage",1074],["T_DOUBLE_COLON","::",1074],["T_STRING","getModel",1074],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",1074],")",["T_WHITESPACE","\n                ",1074],["T_OBJECT_OPERATOR","->",1075],["T_STRING","setFormCode",1075],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml_customer_address'",1075],")",["T_WHITESPACE","\n                ",1075],["T_OBJECT_OPERATOR","->",1076],["T_STRING","ignoreInvisible",1076],"(",["T_STRING","false",1076],")",";",["T_WHITESPACE","\n        ",1076],"}",["T_WHITESPACE","\n        ",1077],["T_RETURN","return",1078],["T_WHITESPACE"," ",1078],["T_VARIABLE","$this",1078],["T_OBJECT_OPERATOR","->",1078],["T_STRING","_customerAddressForm",1078],";",["T_WHITESPACE","\n    ",1078],"}",["T_WHITESPACE","\n\n    ",1079],["T_DOC_COMMENT","\/**\n     * Set and validate Quote address\n     * All errors added to _errors\n     *\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @param array $data\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",1081],["T_WHITESPACE","\n    ",1088],["T_PROTECTED","protected",1089],["T_WHITESPACE"," ",1089],["T_FUNCTION","function",1089],["T_WHITESPACE"," ",1089],["T_STRING","_setQuoteAddress",1089],"(",["T_STRING","Mage_Sales_Model_Quote_Address",1089],["T_WHITESPACE"," ",1089],["T_VARIABLE","$address",1089],",",["T_WHITESPACE"," ",1089],["T_ARRAY","array",1089],["T_WHITESPACE"," ",1089],["T_VARIABLE","$data",1089],")",["T_WHITESPACE","\n    ",1089],"{",["T_WHITESPACE","\n        ",1090],["T_VARIABLE","$addressForm",1091],["T_WHITESPACE","    ",1091],"=",["T_WHITESPACE"," ",1091],["T_VARIABLE","$this",1091],["T_OBJECT_OPERATOR","->",1091],["T_STRING","_getCustomerAddressForm",1091],"(",")",["T_WHITESPACE","\n            ",1091],["T_OBJECT_OPERATOR","->",1092],["T_STRING","setEntity",1092],"(",["T_VARIABLE","$address",1092],")",["T_WHITESPACE","\n            ",1092],["T_OBJECT_OPERATOR","->",1093],["T_STRING","setEntityType",1093],"(",["T_STRING","Mage",1093],["T_DOUBLE_COLON","::",1093],["T_STRING","getSingleton",1093],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",1093],")",["T_OBJECT_OPERATOR","->",1093],["T_STRING","getEntityType",1093],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_address'",1093],")",")",["T_WHITESPACE","\n            ",1093],["T_OBJECT_OPERATOR","->",1094],["T_STRING","setIsAjaxRequest",1094],"(","!",["T_VARIABLE","$this",1094],["T_OBJECT_OPERATOR","->",1094],["T_STRING","getIsValidate",1094],"(",")",")",";",["T_WHITESPACE","\n\n        ",1094],["T_COMMENT","\/\/ prepare request\n",1096],["T_WHITESPACE","        ",1097],["T_COMMENT","\/\/ save original request structure for files\n",1097],["T_WHITESPACE","        ",1098],["T_IF","if",1098],["T_WHITESPACE"," ",1098],"(",["T_VARIABLE","$address",1098],["T_OBJECT_OPERATOR","->",1098],["T_STRING","getAddressType",1098],"(",")",["T_WHITESPACE"," ",1098],["T_IS_EQUAL","==",1098],["T_WHITESPACE"," ",1098],["T_STRING","Mage_Sales_Model_Quote_Address",1098],["T_DOUBLE_COLON","::",1098],["T_STRING","TYPE_SHIPPING",1098],")",["T_WHITESPACE"," ",1098],"{",["T_WHITESPACE","\n            ",1098],["T_VARIABLE","$requestData",1099],["T_WHITESPACE","  ",1099],"=",["T_WHITESPACE"," ",1099],["T_ARRAY","array",1099],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",1099],["T_WHITESPACE"," ",1099],["T_DOUBLE_ARROW","=>",1099],["T_WHITESPACE"," ",1099],["T_ARRAY","array",1099],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_address'",1099],["T_WHITESPACE"," ",1099],["T_DOUBLE_ARROW","=>",1099],["T_WHITESPACE"," ",1099],["T_VARIABLE","$data",1099],")",")",";",["T_WHITESPACE","\n            ",1099],["T_VARIABLE","$requestScope",1100],["T_WHITESPACE"," ",1100],"=",["T_WHITESPACE"," ",1100],["T_CONSTANT_ENCAPSED_STRING","'order\/shipping_address'",1100],";",["T_WHITESPACE","\n        ",1100],"}",["T_WHITESPACE"," ",1101],["T_ELSE","else",1101],["T_WHITESPACE"," ",1101],"{",["T_WHITESPACE","\n            ",1101],["T_VARIABLE","$requestData",1102],["T_WHITESPACE"," ",1102],"=",["T_WHITESPACE"," ",1102],["T_ARRAY","array",1102],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",1102],["T_WHITESPACE"," ",1102],["T_DOUBLE_ARROW","=>",1102],["T_WHITESPACE"," ",1102],["T_ARRAY","array",1102],"(",["T_CONSTANT_ENCAPSED_STRING","'billing_address'",1102],["T_WHITESPACE"," ",1102],["T_DOUBLE_ARROW","=>",1102],["T_WHITESPACE"," ",1102],["T_VARIABLE","$data",1102],")",")",";",["T_WHITESPACE","\n            ",1102],["T_VARIABLE","$requestScope",1103],["T_WHITESPACE"," ",1103],"=",["T_WHITESPACE"," ",1103],["T_CONSTANT_ENCAPSED_STRING","'order\/billing_address'",1103],";",["T_WHITESPACE","\n        ",1103],"}",["T_WHITESPACE","\n        ",1104],["T_VARIABLE","$request",1105],["T_WHITESPACE","        ",1105],"=",["T_WHITESPACE"," ",1105],["T_VARIABLE","$addressForm",1105],["T_OBJECT_OPERATOR","->",1105],["T_STRING","prepareRequest",1105],"(",["T_VARIABLE","$requestData",1105],")",";",["T_WHITESPACE","\n        ",1105],["T_VARIABLE","$addressData",1106],["T_WHITESPACE","    ",1106],"=",["T_WHITESPACE"," ",1106],["T_VARIABLE","$addressForm",1106],["T_OBJECT_OPERATOR","->",1106],["T_STRING","extractData",1106],"(",["T_VARIABLE","$request",1106],",",["T_WHITESPACE"," ",1106],["T_VARIABLE","$requestScope",1106],")",";",["T_WHITESPACE","\n        ",1106],["T_IF","if",1107],["T_WHITESPACE"," ",1107],"(",["T_VARIABLE","$this",1107],["T_OBJECT_OPERATOR","->",1107],["T_STRING","getIsValidate",1107],"(",")",")",["T_WHITESPACE"," ",1107],"{",["T_WHITESPACE","\n            ",1107],["T_VARIABLE","$errors",1108],["T_WHITESPACE"," ",1108],"=",["T_WHITESPACE"," ",1108],["T_VARIABLE","$addressForm",1108],["T_OBJECT_OPERATOR","->",1108],["T_STRING","validateData",1108],"(",["T_VARIABLE","$addressData",1108],")",";",["T_WHITESPACE","\n            ",1108],["T_IF","if",1109],["T_WHITESPACE"," ",1109],"(",["T_VARIABLE","$errors",1109],["T_WHITESPACE"," ",1109],["T_IS_NOT_IDENTICAL","!==",1109],["T_WHITESPACE"," ",1109],["T_STRING","true",1109],")",["T_WHITESPACE"," ",1109],"{",["T_WHITESPACE","\n                ",1109],["T_IF","if",1110],["T_WHITESPACE"," ",1110],"(",["T_VARIABLE","$address",1110],["T_OBJECT_OPERATOR","->",1110],["T_STRING","getAddressType",1110],"(",")",["T_WHITESPACE"," ",1110],["T_IS_EQUAL","==",1110],["T_WHITESPACE"," ",1110],["T_STRING","Mage_Sales_Model_Quote_Address",1110],["T_DOUBLE_COLON","::",1110],["T_STRING","TYPE_SHIPPING",1110],")",["T_WHITESPACE"," ",1110],"{",["T_WHITESPACE","\n                    ",1110],["T_VARIABLE","$typeName",1111],["T_WHITESPACE"," ",1111],"=",["T_WHITESPACE"," ",1111],["T_STRING","Mage",1111],["T_DOUBLE_COLON","::",1111],["T_STRING","helper",1111],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1111],")",["T_OBJECT_OPERATOR","->",1111],["T_STRING","__",1111],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping Address: '",1111],")",";",["T_WHITESPACE","\n                ",1111],"}",["T_WHITESPACE"," ",1112],["T_ELSE","else",1112],["T_WHITESPACE"," ",1112],"{",["T_WHITESPACE","\n                    ",1112],["T_VARIABLE","$typeName",1113],["T_WHITESPACE"," ",1113],"=",["T_WHITESPACE"," ",1113],["T_STRING","Mage",1113],["T_DOUBLE_COLON","::",1113],["T_STRING","helper",1113],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1113],")",["T_OBJECT_OPERATOR","->",1113],["T_STRING","__",1113],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Address: '",1113],")",";",["T_WHITESPACE","\n                ",1113],"}",["T_WHITESPACE","\n                ",1114],["T_FOREACH","foreach",1115],["T_WHITESPACE"," ",1115],"(",["T_VARIABLE","$errors",1115],["T_WHITESPACE"," ",1115],["T_AS","as",1115],["T_WHITESPACE"," ",1115],["T_VARIABLE","$error",1115],")",["T_WHITESPACE"," ",1115],"{",["T_WHITESPACE","\n                    ",1115],["T_VARIABLE","$this",1116],["T_OBJECT_OPERATOR","->",1116],["T_STRING","_errors",1116],"[","]",["T_WHITESPACE"," ",1116],"=",["T_WHITESPACE"," ",1116],["T_VARIABLE","$typeName",1116],["T_WHITESPACE"," ",1116],".",["T_WHITESPACE"," ",1116],["T_VARIABLE","$error",1116],";",["T_WHITESPACE","\n                ",1116],"}",["T_WHITESPACE","\n                ",1117],["T_VARIABLE","$addressForm",1118],["T_OBJECT_OPERATOR","->",1118],["T_STRING","restoreData",1118],"(",["T_VARIABLE","$addressData",1118],")",";",["T_WHITESPACE","\n            ",1118],"}",["T_WHITESPACE"," ",1119],["T_ELSE","else",1119],["T_WHITESPACE"," ",1119],"{",["T_WHITESPACE","\n                ",1119],["T_VARIABLE","$addressForm",1120],["T_OBJECT_OPERATOR","->",1120],["T_STRING","compactData",1120],"(",["T_VARIABLE","$addressData",1120],")",";",["T_WHITESPACE","\n            ",1120],"}",["T_WHITESPACE","\n        ",1121],"}",["T_WHITESPACE"," ",1122],["T_ELSE","else",1122],["T_WHITESPACE"," ",1122],"{",["T_WHITESPACE","\n            ",1122],["T_VARIABLE","$addressForm",1123],["T_OBJECT_OPERATOR","->",1123],["T_STRING","restoreData",1123],"(",["T_VARIABLE","$addressData",1123],")",";",["T_WHITESPACE","\n        ",1123],"}",["T_WHITESPACE","\n\n        ",1124],["T_RETURN","return",1126],["T_WHITESPACE"," ",1126],["T_VARIABLE","$this",1126],";",["T_WHITESPACE","\n    ",1126],"}",["T_WHITESPACE","\n\n    ",1127],["T_PUBLIC","public",1129],["T_WHITESPACE"," ",1129],["T_FUNCTION","function",1129],["T_WHITESPACE"," ",1129],["T_STRING","setShippingAddress",1129],"(",["T_VARIABLE","$address",1129],")",["T_WHITESPACE","\n    ",1129],"{",["T_WHITESPACE","\n        ",1130],["T_IF","if",1131],["T_WHITESPACE"," ",1131],"(",["T_STRING","is_array",1131],"(",["T_VARIABLE","$address",1131],")",")",["T_WHITESPACE"," ",1131],"{",["T_WHITESPACE","\n            ",1131],["T_VARIABLE","$address",1132],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",1132],"]",["T_WHITESPACE"," ",1132],"=",["T_WHITESPACE"," ",1132],["T_ISSET","isset",1132],"(",["T_VARIABLE","$address",1132],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",1132],"]",")",["T_WHITESPACE","\n                ",1132],["T_BOOLEAN_AND","&&",1133],["T_WHITESPACE"," ",1133],"!",["T_EMPTY","empty",1133],"(",["T_VARIABLE","$address",1133],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",1133],"]",")",";",["T_WHITESPACE","\n            ",1133],["T_VARIABLE","$shippingAddress",1134],["T_WHITESPACE"," ",1134],"=",["T_WHITESPACE"," ",1134],["T_STRING","Mage",1134],["T_DOUBLE_COLON","::",1134],["T_STRING","getModel",1134],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",1134],")",["T_WHITESPACE","\n                ",1134],["T_OBJECT_OPERATOR","->",1135],["T_STRING","setData",1135],"(",["T_VARIABLE","$address",1135],")",["T_WHITESPACE","\n                ",1135],["T_OBJECT_OPERATOR","->",1136],["T_STRING","setAddressType",1136],"(",["T_STRING","Mage_Sales_Model_Quote_Address",1136],["T_DOUBLE_COLON","::",1136],["T_STRING","TYPE_SHIPPING",1136],")",";",["T_WHITESPACE","\n            ",1136],["T_IF","if",1137],["T_WHITESPACE"," ",1137],"(","!",["T_VARIABLE","$this",1137],["T_OBJECT_OPERATOR","->",1137],["T_STRING","getQuote",1137],"(",")",["T_OBJECT_OPERATOR","->",1137],["T_STRING","isVirtual",1137],"(",")",")",["T_WHITESPACE"," ",1137],"{",["T_WHITESPACE","\n                ",1137],["T_VARIABLE","$this",1138],["T_OBJECT_OPERATOR","->",1138],["T_STRING","_setQuoteAddress",1138],"(",["T_VARIABLE","$shippingAddress",1138],",",["T_WHITESPACE"," ",1138],["T_VARIABLE","$address",1138],")",";",["T_WHITESPACE","\n            ",1138],"}",["T_WHITESPACE","\n            ",1139],["T_VARIABLE","$shippingAddress",1140],["T_OBJECT_OPERATOR","->",1140],["T_STRING","implodeStreetAddress",1140],"(",")",";",["T_WHITESPACE","\n        ",1140],"}",["T_WHITESPACE","\n        ",1141],["T_IF","if",1142],["T_WHITESPACE"," ",1142],"(",["T_VARIABLE","$address",1142],["T_WHITESPACE"," ",1142],["T_INSTANCEOF","instanceof",1142],["T_WHITESPACE"," ",1142],["T_STRING","Mage_Sales_Model_Quote_Address",1142],")",["T_WHITESPACE"," ",1142],"{",["T_WHITESPACE","\n            ",1142],["T_VARIABLE","$shippingAddress",1143],["T_WHITESPACE"," ",1143],"=",["T_WHITESPACE"," ",1143],["T_VARIABLE","$address",1143],";",["T_WHITESPACE","\n        ",1143],"}",["T_WHITESPACE","\n\n        ",1144],["T_VARIABLE","$this",1146],["T_OBJECT_OPERATOR","->",1146],["T_STRING","setRecollect",1146],"(",["T_STRING","true",1146],")",";",["T_WHITESPACE","\n        ",1146],["T_VARIABLE","$this",1147],["T_OBJECT_OPERATOR","->",1147],["T_STRING","getQuote",1147],"(",")",["T_OBJECT_OPERATOR","->",1147],["T_STRING","setShippingAddress",1147],"(",["T_VARIABLE","$shippingAddress",1147],")",";",["T_WHITESPACE","\n        ",1147],["T_RETURN","return",1148],["T_WHITESPACE"," ",1148],["T_VARIABLE","$this",1148],";",["T_WHITESPACE","\n    ",1148],"}",["T_WHITESPACE","\n\n    ",1149],["T_PUBLIC","public",1151],["T_WHITESPACE"," ",1151],["T_FUNCTION","function",1151],["T_WHITESPACE"," ",1151],["T_STRING","setShippingAsBilling",1151],"(",["T_VARIABLE","$flag",1151],")",["T_WHITESPACE","\n    ",1151],"{",["T_WHITESPACE","\n        ",1152],["T_IF","if",1153],["T_WHITESPACE"," ",1153],"(",["T_VARIABLE","$flag",1153],")",["T_WHITESPACE"," ",1153],"{",["T_WHITESPACE","\n            ",1153],["T_VARIABLE","$tmpAddress",1154],["T_WHITESPACE"," ",1154],"=",["T_WHITESPACE"," ",1154],["T_CLONE","clone",1154],["T_WHITESPACE"," ",1154],["T_VARIABLE","$this",1154],["T_OBJECT_OPERATOR","->",1154],["T_STRING","getBillingAddress",1154],"(",")",";",["T_WHITESPACE","\n            ",1154],["T_VARIABLE","$tmpAddress",1155],["T_OBJECT_OPERATOR","->",1155],["T_STRING","unsAddressId",1155],"(",")",["T_WHITESPACE","\n                ",1155],["T_OBJECT_OPERATOR","->",1156],["T_STRING","unsAddressType",1156],"(",")",";",["T_WHITESPACE","\n            ",1156],["T_VARIABLE","$data",1157],["T_WHITESPACE"," ",1157],"=",["T_WHITESPACE"," ",1157],["T_VARIABLE","$tmpAddress",1157],["T_OBJECT_OPERATOR","->",1157],["T_STRING","getData",1157],"(",")",";",["T_WHITESPACE","\n            ",1157],["T_VARIABLE","$data",1158],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",1158],"]",["T_WHITESPACE"," ",1158],"=",["T_WHITESPACE"," ",1158],["T_LNUMBER","0",1158],";",["T_WHITESPACE"," ",1158],["T_COMMENT","\/\/ Do not duplicate address (billing address will do saving too)\n",1158],["T_WHITESPACE","            ",1159],["T_UNSET","unset",1159],"(",["T_VARIABLE","$data",1159],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",1159],"]",")",";",["T_WHITESPACE"," ",1159],["T_COMMENT","\/\/ Do not reset shipping method to be able to recollect totals\n",1159],["T_WHITESPACE","            ",1160],["T_VARIABLE","$this",1160],["T_OBJECT_OPERATOR","->",1160],["T_STRING","getShippingAddress",1160],"(",")",["T_OBJECT_OPERATOR","->",1160],["T_STRING","addData",1160],"(",["T_VARIABLE","$data",1160],")",";",["T_WHITESPACE","\n        ",1160],"}",["T_WHITESPACE","\n        ",1161],["T_VARIABLE","$this",1162],["T_OBJECT_OPERATOR","->",1162],["T_STRING","getShippingAddress",1162],"(",")",["T_OBJECT_OPERATOR","->",1162],["T_STRING","setSameAsBilling",1162],"(",["T_VARIABLE","$flag",1162],")",";",["T_WHITESPACE","\n        ",1162],["T_VARIABLE","$this",1163],["T_OBJECT_OPERATOR","->",1163],["T_STRING","setRecollect",1163],"(",["T_STRING","true",1163],")",";",["T_WHITESPACE","\n        ",1163],["T_RETURN","return",1164],["T_WHITESPACE"," ",1164],["T_VARIABLE","$this",1164],";",["T_WHITESPACE","\n    ",1164],"}",["T_WHITESPACE","\n\n    ",1165],["T_DOC_COMMENT","\/**\n     * Retrieve quote billing address\n     *\n     * @return Mage_Sales_Model_Quote_Address\n     *\/",1167],["T_WHITESPACE","\n    ",1171],["T_PUBLIC","public",1172],["T_WHITESPACE"," ",1172],["T_FUNCTION","function",1172],["T_WHITESPACE"," ",1172],["T_STRING","getBillingAddress",1172],"(",")",["T_WHITESPACE","\n    ",1172],"{",["T_WHITESPACE","\n        ",1173],["T_RETURN","return",1174],["T_WHITESPACE"," ",1174],["T_VARIABLE","$this",1174],["T_OBJECT_OPERATOR","->",1174],["T_STRING","getQuote",1174],"(",")",["T_OBJECT_OPERATOR","->",1174],["T_STRING","getBillingAddress",1174],"(",")",";",["T_WHITESPACE","\n    ",1174],"}",["T_WHITESPACE","\n\n    ",1175],["T_PUBLIC","public",1177],["T_WHITESPACE"," ",1177],["T_FUNCTION","function",1177],["T_WHITESPACE"," ",1177],["T_STRING","setBillingAddress",1177],"(",["T_VARIABLE","$address",1177],")",["T_WHITESPACE","\n    ",1177],"{",["T_WHITESPACE","\n        ",1178],["T_IF","if",1179],["T_WHITESPACE"," ",1179],"(",["T_STRING","is_array",1179],"(",["T_VARIABLE","$address",1179],")",")",["T_WHITESPACE"," ",1179],"{",["T_WHITESPACE","\n            ",1179],["T_VARIABLE","$address",1180],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",1180],"]",["T_WHITESPACE"," ",1180],"=",["T_WHITESPACE"," ",1180],["T_ISSET","isset",1180],"(",["T_VARIABLE","$address",1180],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",1180],"]",")",["T_WHITESPACE"," ",1180],"?",["T_WHITESPACE"," ",1180],["T_LNUMBER","1",1180],["T_WHITESPACE"," ",1180],":",["T_WHITESPACE"," ",1180],["T_LNUMBER","0",1180],";",["T_WHITESPACE","\n            ",1180],["T_VARIABLE","$billingAddress",1181],["T_WHITESPACE"," ",1181],"=",["T_WHITESPACE"," ",1181],["T_STRING","Mage",1181],["T_DOUBLE_COLON","::",1181],["T_STRING","getModel",1181],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",1181],")",["T_WHITESPACE","\n                ",1181],["T_OBJECT_OPERATOR","->",1182],["T_STRING","setData",1182],"(",["T_VARIABLE","$address",1182],")",["T_WHITESPACE","\n                ",1182],["T_OBJECT_OPERATOR","->",1183],["T_STRING","setAddressType",1183],"(",["T_STRING","Mage_Sales_Model_Quote_Address",1183],["T_DOUBLE_COLON","::",1183],["T_STRING","TYPE_BILLING",1183],")",";",["T_WHITESPACE","\n            ",1183],["T_VARIABLE","$this",1184],["T_OBJECT_OPERATOR","->",1184],["T_STRING","_setQuoteAddress",1184],"(",["T_VARIABLE","$billingAddress",1184],",",["T_WHITESPACE"," ",1184],["T_VARIABLE","$address",1184],")",";",["T_WHITESPACE","\n            ",1184],["T_VARIABLE","$billingAddress",1185],["T_OBJECT_OPERATOR","->",1185],["T_STRING","implodeStreetAddress",1185],"(",")",";",["T_WHITESPACE","\n        ",1185],"}",["T_WHITESPACE","\n\n        ",1186],["T_IF","if",1188],["T_WHITESPACE"," ",1188],"(",["T_VARIABLE","$this",1188],["T_OBJECT_OPERATOR","->",1188],["T_STRING","getShippingAddress",1188],"(",")",["T_OBJECT_OPERATOR","->",1188],["T_STRING","getSameAsBilling",1188],"(",")",")",["T_WHITESPACE"," ",1188],"{",["T_WHITESPACE","\n            ",1188],["T_VARIABLE","$shippingAddress",1189],["T_WHITESPACE"," ",1189],"=",["T_WHITESPACE"," ",1189],["T_CLONE","clone",1189],["T_WHITESPACE"," ",1189],["T_VARIABLE","$billingAddress",1189],";",["T_WHITESPACE","\n            ",1189],["T_VARIABLE","$shippingAddress",1190],["T_OBJECT_OPERATOR","->",1190],["T_STRING","setSameAsBilling",1190],"(",["T_STRING","true",1190],")",";",["T_WHITESPACE","\n            ",1190],["T_VARIABLE","$shippingAddress",1191],["T_OBJECT_OPERATOR","->",1191],["T_STRING","setSaveInAddressBook",1191],"(",["T_STRING","false",1191],")",";",["T_WHITESPACE","\n            ",1191],["T_VARIABLE","$address",1192],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",1192],"]",["T_WHITESPACE"," ",1192],"=",["T_WHITESPACE"," ",1192],["T_LNUMBER","0",1192],";",["T_WHITESPACE","\n            ",1192],["T_VARIABLE","$this",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","setShippingAddress",1193],"(",["T_VARIABLE","$address",1193],")",";",["T_WHITESPACE","\n        ",1193],"}",["T_WHITESPACE","\n\n        ",1194],["T_VARIABLE","$this",1196],["T_OBJECT_OPERATOR","->",1196],["T_STRING","getQuote",1196],"(",")",["T_OBJECT_OPERATOR","->",1196],["T_STRING","setBillingAddress",1196],"(",["T_VARIABLE","$billingAddress",1196],")",";",["T_WHITESPACE","\n        ",1196],["T_RETURN","return",1197],["T_WHITESPACE"," ",1197],["T_VARIABLE","$this",1197],";",["T_WHITESPACE","\n    ",1197],"}",["T_WHITESPACE","\n\n    ",1198],["T_PUBLIC","public",1200],["T_WHITESPACE"," ",1200],["T_FUNCTION","function",1200],["T_WHITESPACE"," ",1200],["T_STRING","setShippingMethod",1200],"(",["T_VARIABLE","$method",1200],")",["T_WHITESPACE","\n    ",1200],"{",["T_WHITESPACE","\n        ",1201],["T_VARIABLE","$this",1202],["T_OBJECT_OPERATOR","->",1202],["T_STRING","getShippingAddress",1202],"(",")",["T_OBJECT_OPERATOR","->",1202],["T_STRING","setShippingMethod",1202],"(",["T_VARIABLE","$method",1202],")",";",["T_WHITESPACE","\n        ",1202],["T_VARIABLE","$this",1203],["T_OBJECT_OPERATOR","->",1203],["T_STRING","setRecollect",1203],"(",["T_STRING","true",1203],")",";",["T_WHITESPACE","\n        ",1203],["T_RETURN","return",1204],["T_WHITESPACE"," ",1204],["T_VARIABLE","$this",1204],";",["T_WHITESPACE","\n    ",1204],"}",["T_WHITESPACE","\n\n    ",1205],["T_PUBLIC","public",1207],["T_WHITESPACE"," ",1207],["T_FUNCTION","function",1207],["T_WHITESPACE"," ",1207],["T_STRING","resetShippingMethod",1207],"(",")",["T_WHITESPACE","\n    ",1207],"{",["T_WHITESPACE","\n        ",1208],["T_VARIABLE","$this",1209],["T_OBJECT_OPERATOR","->",1209],["T_STRING","getShippingAddress",1209],"(",")",["T_OBJECT_OPERATOR","->",1209],["T_STRING","setShippingMethod",1209],"(",["T_STRING","false",1209],")",";",["T_WHITESPACE","\n        ",1209],["T_VARIABLE","$this",1210],["T_OBJECT_OPERATOR","->",1210],["T_STRING","getShippingAddress",1210],"(",")",["T_OBJECT_OPERATOR","->",1210],["T_STRING","removeAllShippingRates",1210],"(",")",";",["T_WHITESPACE","\n        ",1210],["T_RETURN","return",1211],["T_WHITESPACE"," ",1211],["T_VARIABLE","$this",1211],";",["T_WHITESPACE","\n    ",1211],"}",["T_WHITESPACE","\n\n    ",1212],["T_DOC_COMMENT","\/**\n     * Collect shipping data for quote shipping address\n     *\/",1214],["T_WHITESPACE","\n    ",1216],["T_PUBLIC","public",1217],["T_WHITESPACE"," ",1217],["T_FUNCTION","function",1217],["T_WHITESPACE"," ",1217],["T_STRING","collectShippingRates",1217],"(",")",["T_WHITESPACE","\n    ",1217],"{",["T_WHITESPACE","\n        ",1218],["T_VARIABLE","$this",1219],["T_OBJECT_OPERATOR","->",1219],["T_STRING","getQuote",1219],"(",")",["T_OBJECT_OPERATOR","->",1219],["T_STRING","getShippingAddress",1219],"(",")",["T_OBJECT_OPERATOR","->",1219],["T_STRING","setCollectShippingRates",1219],"(",["T_STRING","true",1219],")",";",["T_WHITESPACE","\n        ",1219],["T_VARIABLE","$this",1220],["T_OBJECT_OPERATOR","->",1220],["T_STRING","collectRates",1220],"(",")",";",["T_WHITESPACE","\n        ",1220],["T_RETURN","return",1221],["T_WHITESPACE"," ",1221],["T_VARIABLE","$this",1221],";",["T_WHITESPACE","\n    ",1221],"}",["T_WHITESPACE","\n\n    ",1222],["T_PUBLIC","public",1224],["T_WHITESPACE"," ",1224],["T_FUNCTION","function",1224],["T_WHITESPACE"," ",1224],["T_STRING","collectRates",1224],"(",")",["T_WHITESPACE","\n    ",1224],"{",["T_WHITESPACE","\n        ",1225],["T_VARIABLE","$this",1226],["T_OBJECT_OPERATOR","->",1226],["T_STRING","getQuote",1226],"(",")",["T_OBJECT_OPERATOR","->",1226],["T_STRING","collectTotals",1226],"(",")",";",["T_WHITESPACE","\n    ",1226],"}",["T_WHITESPACE","\n\n    ",1227],["T_PUBLIC","public",1229],["T_WHITESPACE"," ",1229],["T_FUNCTION","function",1229],["T_WHITESPACE"," ",1229],["T_STRING","setPaymentMethod",1229],"(",["T_VARIABLE","$method",1229],")",["T_WHITESPACE","\n    ",1229],"{",["T_WHITESPACE","\n        ",1230],["T_VARIABLE","$this",1231],["T_OBJECT_OPERATOR","->",1231],["T_STRING","getQuote",1231],"(",")",["T_OBJECT_OPERATOR","->",1231],["T_STRING","getPayment",1231],"(",")",["T_OBJECT_OPERATOR","->",1231],["T_STRING","setMethod",1231],"(",["T_VARIABLE","$method",1231],")",";",["T_WHITESPACE","\n        ",1231],["T_RETURN","return",1232],["T_WHITESPACE"," ",1232],["T_VARIABLE","$this",1232],";",["T_WHITESPACE","\n    ",1232],"}",["T_WHITESPACE","\n\n    ",1233],["T_PUBLIC","public",1235],["T_WHITESPACE"," ",1235],["T_FUNCTION","function",1235],["T_WHITESPACE"," ",1235],["T_STRING","setPaymentData",1235],"(",["T_VARIABLE","$data",1235],")",["T_WHITESPACE","\n    ",1235],"{",["T_WHITESPACE","\n        ",1236],["T_IF","if",1237],["T_WHITESPACE"," ",1237],"(","!",["T_ISSET","isset",1237],"(",["T_VARIABLE","$data",1237],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",1237],"]",")",")",["T_WHITESPACE"," ",1237],"{",["T_WHITESPACE","\n            ",1237],["T_VARIABLE","$data",1238],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",1238],"]",["T_WHITESPACE"," ",1238],"=",["T_WHITESPACE"," ",1238],["T_VARIABLE","$this",1238],["T_OBJECT_OPERATOR","->",1238],["T_STRING","getQuote",1238],"(",")",["T_OBJECT_OPERATOR","->",1238],["T_STRING","getPayment",1238],"(",")",["T_OBJECT_OPERATOR","->",1238],["T_STRING","getMethod",1238],"(",")",";",["T_WHITESPACE","\n        ",1238],"}",["T_WHITESPACE","\n        ",1239],["T_VARIABLE","$this",1240],["T_OBJECT_OPERATOR","->",1240],["T_STRING","getQuote",1240],"(",")",["T_OBJECT_OPERATOR","->",1240],["T_STRING","getPayment",1240],"(",")",["T_OBJECT_OPERATOR","->",1240],["T_STRING","importData",1240],"(",["T_VARIABLE","$data",1240],")",";",["T_WHITESPACE","\n        ",1240],["T_RETURN","return",1241],["T_WHITESPACE"," ",1241],["T_VARIABLE","$this",1241],";",["T_WHITESPACE","\n    ",1241],"}",["T_WHITESPACE","\n\n    ",1242],["T_PUBLIC","public",1244],["T_WHITESPACE"," ",1244],["T_FUNCTION","function",1244],["T_WHITESPACE"," ",1244],["T_STRING","applyCoupon",1244],"(",["T_VARIABLE","$code",1244],")",["T_WHITESPACE","\n    ",1244],"{",["T_WHITESPACE","\n        ",1245],["T_VARIABLE","$code",1246],["T_WHITESPACE"," ",1246],"=",["T_WHITESPACE"," ",1246],["T_STRING","trim",1246],"(",["T_STRING_CAST","(string)",1246],["T_VARIABLE","$code",1246],")",";",["T_WHITESPACE","\n        ",1246],["T_VARIABLE","$this",1247],["T_OBJECT_OPERATOR","->",1247],["T_STRING","getQuote",1247],"(",")",["T_OBJECT_OPERATOR","->",1247],["T_STRING","setCouponCode",1247],"(",["T_VARIABLE","$code",1247],")",";",["T_WHITESPACE","\n        ",1247],["T_VARIABLE","$this",1248],["T_OBJECT_OPERATOR","->",1248],["T_STRING","setRecollect",1248],"(",["T_STRING","true",1248],")",";",["T_WHITESPACE","\n        ",1248],["T_RETURN","return",1249],["T_WHITESPACE"," ",1249],["T_VARIABLE","$this",1249],";",["T_WHITESPACE","\n    ",1249],"}",["T_WHITESPACE","\n\n    ",1250],["T_PUBLIC","public",1252],["T_WHITESPACE"," ",1252],["T_FUNCTION","function",1252],["T_WHITESPACE"," ",1252],["T_STRING","setAccountData",1252],"(",["T_VARIABLE","$accountData",1252],")",["T_WHITESPACE","\n    ",1252],"{",["T_WHITESPACE","\n        ",1253],["T_VARIABLE","$customer",1254],["T_WHITESPACE","   ",1254],"=",["T_WHITESPACE"," ",1254],["T_VARIABLE","$this",1254],["T_OBJECT_OPERATOR","->",1254],["T_STRING","getQuote",1254],"(",")",["T_OBJECT_OPERATOR","->",1254],["T_STRING","getCustomer",1254],"(",")",";",["T_WHITESPACE","\n        ",1254],["T_VARIABLE","$form",1255],["T_WHITESPACE","       ",1255],"=",["T_WHITESPACE"," ",1255],["T_VARIABLE","$this",1255],["T_OBJECT_OPERATOR","->",1255],["T_STRING","_getCustomerForm",1255],"(",")",";",["T_WHITESPACE","\n        ",1255],["T_VARIABLE","$form",1256],["T_OBJECT_OPERATOR","->",1256],["T_STRING","setEntity",1256],"(",["T_VARIABLE","$customer",1256],")",";",["T_WHITESPACE","\n\n        ",1256],["T_COMMENT","\/\/ emulate request\n",1258],["T_WHITESPACE","        ",1259],["T_VARIABLE","$request",1259],["T_WHITESPACE"," ",1259],"=",["T_WHITESPACE"," ",1259],["T_VARIABLE","$form",1259],["T_OBJECT_OPERATOR","->",1259],["T_STRING","prepareRequest",1259],"(",["T_VARIABLE","$accountData",1259],")",";",["T_WHITESPACE","\n        ",1259],["T_VARIABLE","$data",1260],["T_WHITESPACE","    ",1260],"=",["T_WHITESPACE"," ",1260],["T_VARIABLE","$form",1260],["T_OBJECT_OPERATOR","->",1260],["T_STRING","extractData",1260],"(",["T_VARIABLE","$request",1260],")",";",["T_WHITESPACE","\n        ",1260],["T_VARIABLE","$form",1261],["T_OBJECT_OPERATOR","->",1261],["T_STRING","restoreData",1261],"(",["T_VARIABLE","$data",1261],")",";",["T_WHITESPACE","\n\n        ",1261],["T_VARIABLE","$data",1263],["T_WHITESPACE"," ",1263],"=",["T_WHITESPACE"," ",1263],["T_ARRAY","array",1263],"(",")",";",["T_WHITESPACE","\n        ",1263],["T_FOREACH","foreach",1264],["T_WHITESPACE"," ",1264],"(",["T_VARIABLE","$form",1264],["T_OBJECT_OPERATOR","->",1264],["T_STRING","getAttributes",1264],"(",")",["T_WHITESPACE"," ",1264],["T_AS","as",1264],["T_WHITESPACE"," ",1264],["T_VARIABLE","$attribute",1264],")",["T_WHITESPACE"," ",1264],"{",["T_WHITESPACE","\n            ",1264],["T_VARIABLE","$code",1265],["T_WHITESPACE"," ",1265],"=",["T_WHITESPACE"," ",1265],["T_STRING","sprintf",1265],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_%s'",1265],",",["T_WHITESPACE"," ",1265],["T_VARIABLE","$attribute",1265],["T_OBJECT_OPERATOR","->",1265],["T_STRING","getAttributeCode",1265],"(",")",")",";",["T_WHITESPACE","\n            ",1265],["T_VARIABLE","$data",1266],"[",["T_VARIABLE","$code",1266],"]",["T_WHITESPACE"," ",1266],"=",["T_WHITESPACE"," ",1266],["T_VARIABLE","$customer",1266],["T_OBJECT_OPERATOR","->",1266],["T_STRING","getData",1266],"(",["T_VARIABLE","$attribute",1266],["T_OBJECT_OPERATOR","->",1266],["T_STRING","getAttributeCode",1266],"(",")",")",";",["T_WHITESPACE","\n        ",1266],"}",["T_WHITESPACE","\n\n        ",1267],["T_IF","if",1269],["T_WHITESPACE"," ",1269],"(",["T_ISSET","isset",1269],"(",["T_VARIABLE","$data",1269],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",1269],"]",")",")",["T_WHITESPACE"," ",1269],"{",["T_WHITESPACE","\n            ",1269],["T_VARIABLE","$groupModel",1270],["T_WHITESPACE"," ",1270],"=",["T_WHITESPACE"," ",1270],["T_STRING","Mage",1270],["T_DOUBLE_COLON","::",1270],["T_STRING","getModel",1270],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/group'",1270],")",["T_OBJECT_OPERATOR","->",1270],["T_STRING","load",1270],"(",["T_VARIABLE","$data",1270],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",1270],"]",")",";",["T_WHITESPACE","\n            ",1270],["T_VARIABLE","$data",1271],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_tax_class_id'",1271],"]",["T_WHITESPACE"," ",1271],"=",["T_WHITESPACE"," ",1271],["T_VARIABLE","$groupModel",1271],["T_OBJECT_OPERATOR","->",1271],["T_STRING","getTaxClassId",1271],"(",")",";",["T_WHITESPACE","\n            ",1271],["T_VARIABLE","$this",1272],["T_OBJECT_OPERATOR","->",1272],["T_STRING","setRecollect",1272],"(",["T_STRING","true",1272],")",";",["T_WHITESPACE","\n        ",1272],"}",["T_WHITESPACE","\n\n        ",1273],["T_VARIABLE","$this",1275],["T_OBJECT_OPERATOR","->",1275],["T_STRING","getQuote",1275],"(",")",["T_OBJECT_OPERATOR","->",1275],["T_STRING","addData",1275],"(",["T_VARIABLE","$data",1275],")",";",["T_WHITESPACE","\n        ",1275],["T_RETURN","return",1276],["T_WHITESPACE"," ",1276],["T_VARIABLE","$this",1276],";",["T_WHITESPACE","\n    ",1276],"}",["T_WHITESPACE","\n\n    ",1277],["T_DOC_COMMENT","\/**\n     * Parse data retrieved from request\n     *\n     * @param   array $data\n     * @return  Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",1279],["T_WHITESPACE","\n    ",1284],["T_PUBLIC","public",1285],["T_WHITESPACE"," ",1285],["T_FUNCTION","function",1285],["T_WHITESPACE"," ",1285],["T_STRING","importPostData",1285],"(",["T_VARIABLE","$data",1285],")",["T_WHITESPACE","\n    ",1285],"{",["T_WHITESPACE","\n        ",1286],["T_IF","if",1287],["T_WHITESPACE"," ",1287],"(",["T_STRING","is_array",1287],"(",["T_VARIABLE","$data",1287],")",")",["T_WHITESPACE"," ",1287],"{",["T_WHITESPACE","\n            ",1287],["T_VARIABLE","$this",1288],["T_OBJECT_OPERATOR","->",1288],["T_STRING","addData",1288],"(",["T_VARIABLE","$data",1288],")",";",["T_WHITESPACE","\n        ",1288],"}",["T_WHITESPACE"," ",1289],["T_ELSE","else",1289],["T_WHITESPACE"," ",1289],"{",["T_WHITESPACE","\n            ",1289],["T_RETURN","return",1290],["T_WHITESPACE"," ",1290],["T_VARIABLE","$this",1290],";",["T_WHITESPACE","\n        ",1290],"}",["T_WHITESPACE","\n\n        ",1291],["T_IF","if",1293],["T_WHITESPACE"," ",1293],"(",["T_ISSET","isset",1293],"(",["T_VARIABLE","$data",1293],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",1293],"]",")",")",["T_WHITESPACE"," ",1293],"{",["T_WHITESPACE","\n            ",1293],["T_VARIABLE","$this",1294],["T_OBJECT_OPERATOR","->",1294],["T_STRING","setAccountData",1294],"(",["T_VARIABLE","$data",1294],"[",["T_CONSTANT_ENCAPSED_STRING","'account'",1294],"]",")",";",["T_WHITESPACE","\n        ",1294],"}",["T_WHITESPACE","\n\n        ",1295],["T_IF","if",1297],["T_WHITESPACE"," ",1297],"(",["T_ISSET","isset",1297],"(",["T_VARIABLE","$data",1297],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",1297],"]",")",")",["T_WHITESPACE"," ",1297],"{",["T_WHITESPACE","\n            ",1297],["T_VARIABLE","$this",1298],["T_OBJECT_OPERATOR","->",1298],["T_STRING","getQuote",1298],"(",")",["T_OBJECT_OPERATOR","->",1298],["T_STRING","addData",1298],"(",["T_VARIABLE","$data",1298],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",1298],"]",")",";",["T_WHITESPACE","\n            ",1298],["T_IF","if",1299],["T_WHITESPACE"," ",1299],"(",["T_EMPTY","empty",1299],"(",["T_VARIABLE","$data",1299],"[",["T_CONSTANT_ENCAPSED_STRING","'comment'",1299],"]","[",["T_CONSTANT_ENCAPSED_STRING","'customer_note_notify'",1299],"]",")",")",["T_WHITESPACE"," ",1299],"{",["T_WHITESPACE","\n                ",1299],["T_VARIABLE","$this",1300],["T_OBJECT_OPERATOR","->",1300],["T_STRING","getQuote",1300],"(",")",["T_OBJECT_OPERATOR","->",1300],["T_STRING","setCustomerNoteNotify",1300],"(",["T_STRING","false",1300],")",";",["T_WHITESPACE","\n            ",1300],"}",["T_WHITESPACE"," ",1301],["T_ELSE","else",1301],["T_WHITESPACE"," ",1301],"{",["T_WHITESPACE","\n                ",1301],["T_VARIABLE","$this",1302],["T_OBJECT_OPERATOR","->",1302],["T_STRING","getQuote",1302],"(",")",["T_OBJECT_OPERATOR","->",1302],["T_STRING","setCustomerNoteNotify",1302],"(",["T_STRING","true",1302],")",";",["T_WHITESPACE","\n            ",1302],"}",["T_WHITESPACE","\n        ",1303],"}",["T_WHITESPACE","\n\n        ",1304],["T_IF","if",1306],["T_WHITESPACE"," ",1306],"(",["T_ISSET","isset",1306],"(",["T_VARIABLE","$data",1306],"[",["T_CONSTANT_ENCAPSED_STRING","'billing_address'",1306],"]",")",")",["T_WHITESPACE"," ",1306],"{",["T_WHITESPACE","\n            ",1306],["T_VARIABLE","$this",1307],["T_OBJECT_OPERATOR","->",1307],["T_STRING","setBillingAddress",1307],"(",["T_VARIABLE","$data",1307],"[",["T_CONSTANT_ENCAPSED_STRING","'billing_address'",1307],"]",")",";",["T_WHITESPACE","\n        ",1307],"}",["T_WHITESPACE","\n\n        ",1308],["T_IF","if",1310],["T_WHITESPACE"," ",1310],"(",["T_ISSET","isset",1310],"(",["T_VARIABLE","$data",1310],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_address'",1310],"]",")",")",["T_WHITESPACE"," ",1310],"{",["T_WHITESPACE","\n            ",1310],["T_VARIABLE","$this",1311],["T_OBJECT_OPERATOR","->",1311],["T_STRING","setShippingAddress",1311],"(",["T_VARIABLE","$data",1311],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_address'",1311],"]",")",";",["T_WHITESPACE","\n        ",1311],"}",["T_WHITESPACE","\n\n        ",1312],["T_IF","if",1314],["T_WHITESPACE"," ",1314],"(",["T_ISSET","isset",1314],"(",["T_VARIABLE","$data",1314],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",1314],"]",")",")",["T_WHITESPACE"," ",1314],"{",["T_WHITESPACE","\n            ",1314],["T_VARIABLE","$this",1315],["T_OBJECT_OPERATOR","->",1315],["T_STRING","setShippingMethod",1315],"(",["T_VARIABLE","$data",1315],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",1315],"]",")",";",["T_WHITESPACE","\n        ",1315],"}",["T_WHITESPACE","\n\n        ",1316],["T_IF","if",1318],["T_WHITESPACE"," ",1318],"(",["T_ISSET","isset",1318],"(",["T_VARIABLE","$data",1318],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_method'",1318],"]",")",")",["T_WHITESPACE"," ",1318],"{",["T_WHITESPACE","\n            ",1318],["T_VARIABLE","$this",1319],["T_OBJECT_OPERATOR","->",1319],["T_STRING","setPaymentMethod",1319],"(",["T_VARIABLE","$data",1319],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_method'",1319],"]",")",";",["T_WHITESPACE","\n        ",1319],"}",["T_WHITESPACE","\n\n        ",1320],["T_IF","if",1322],["T_WHITESPACE"," ",1322],"(",["T_ISSET","isset",1322],"(",["T_VARIABLE","$data",1322],"[",["T_CONSTANT_ENCAPSED_STRING","'coupon'",1322],"]","[",["T_CONSTANT_ENCAPSED_STRING","'code'",1322],"]",")",")",["T_WHITESPACE"," ",1322],"{",["T_WHITESPACE","\n            ",1322],["T_VARIABLE","$this",1323],["T_OBJECT_OPERATOR","->",1323],["T_STRING","applyCoupon",1323],"(",["T_VARIABLE","$data",1323],"[",["T_CONSTANT_ENCAPSED_STRING","'coupon'",1323],"]","[",["T_CONSTANT_ENCAPSED_STRING","'code'",1323],"]",")",";",["T_WHITESPACE","\n        ",1323],"}",["T_WHITESPACE","\n        ",1324],["T_RETURN","return",1325],["T_WHITESPACE"," ",1325],["T_VARIABLE","$this",1325],";",["T_WHITESPACE","\n    ",1325],"}",["T_WHITESPACE","\n\n    ",1326],["T_DOC_COMMENT","\/**\n     * Check whether we need to create new customer (for another website) during order creation\n     *\n     * @param   Mage_Core_Model_Store $store\n     * @return  boolean\n     *\/",1328],["T_WHITESPACE","\n    ",1333],["T_PROTECTED","protected",1334],["T_WHITESPACE"," ",1334],["T_FUNCTION","function",1334],["T_WHITESPACE"," ",1334],["T_STRING","_customerIsInStore",1334],"(",["T_VARIABLE","$store",1334],")",["T_WHITESPACE","\n    ",1334],"{",["T_WHITESPACE","\n        ",1335],["T_VARIABLE","$customer",1336],["T_WHITESPACE"," ",1336],"=",["T_WHITESPACE"," ",1336],["T_VARIABLE","$this",1336],["T_OBJECT_OPERATOR","->",1336],["T_STRING","getSession",1336],"(",")",["T_OBJECT_OPERATOR","->",1336],["T_STRING","getCustomer",1336],"(",")",";",["T_WHITESPACE","\n        ",1336],["T_IF","if",1337],["T_WHITESPACE"," ",1337],"(",["T_VARIABLE","$customer",1337],["T_OBJECT_OPERATOR","->",1337],["T_STRING","getWebsiteId",1337],"(",")",["T_WHITESPACE"," ",1337],["T_IS_EQUAL","==",1337],["T_WHITESPACE"," ",1337],["T_VARIABLE","$store",1337],["T_OBJECT_OPERATOR","->",1337],["T_STRING","getWebsiteId",1337],"(",")",")",["T_WHITESPACE"," ",1337],"{",["T_WHITESPACE","\n            ",1337],["T_RETURN","return",1338],["T_WHITESPACE"," ",1338],["T_STRING","true",1338],";",["T_WHITESPACE","\n        ",1338],"}",["T_WHITESPACE","\n        ",1339],["T_RETURN","return",1340],["T_WHITESPACE"," ",1340],["T_VARIABLE","$customer",1340],["T_OBJECT_OPERATOR","->",1340],["T_STRING","isInStore",1340],"(",["T_VARIABLE","$store",1340],")",";",["T_WHITESPACE","\n    ",1340],"}",["T_WHITESPACE","\n\n    ",1341],["T_DOC_COMMENT","\/**\n     * Set and validate Customer data\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",1343],["T_WHITESPACE","\n    ",1348],["T_PROTECTED","protected",1349],["T_WHITESPACE"," ",1349],["T_FUNCTION","function",1349],["T_WHITESPACE"," ",1349],["T_STRING","_setCustomerData",1349],"(",["T_STRING","Mage_Customer_Model_Customer",1349],["T_WHITESPACE"," ",1349],["T_VARIABLE","$customer",1349],")",["T_WHITESPACE","\n    ",1349],"{",["T_WHITESPACE","\n        ",1350],["T_VARIABLE","$form",1351],["T_WHITESPACE"," ",1351],"=",["T_WHITESPACE"," ",1351],["T_VARIABLE","$this",1351],["T_OBJECT_OPERATOR","->",1351],["T_STRING","_getCustomerForm",1351],"(",")",";",["T_WHITESPACE","\n        ",1351],["T_VARIABLE","$form",1352],["T_OBJECT_OPERATOR","->",1352],["T_STRING","setEntity",1352],"(",["T_VARIABLE","$customer",1352],")",";",["T_WHITESPACE","\n\n        ",1352],["T_COMMENT","\/\/ emulate request\n",1354],["T_WHITESPACE","        ",1355],["T_VARIABLE","$request",1355],["T_WHITESPACE"," ",1355],"=",["T_WHITESPACE"," ",1355],["T_VARIABLE","$form",1355],["T_OBJECT_OPERATOR","->",1355],["T_STRING","prepareRequest",1355],"(",["T_ARRAY","array",1355],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",1355],["T_WHITESPACE"," ",1355],["T_DOUBLE_ARROW","=>",1355],["T_WHITESPACE"," ",1355],["T_VARIABLE","$this",1355],["T_OBJECT_OPERATOR","->",1355],["T_STRING","getData",1355],"(",")",")",")",";",["T_WHITESPACE","\n        ",1355],["T_VARIABLE","$data",1356],["T_WHITESPACE","    ",1356],"=",["T_WHITESPACE"," ",1356],["T_VARIABLE","$form",1356],["T_OBJECT_OPERATOR","->",1356],["T_STRING","extractData",1356],"(",["T_VARIABLE","$request",1356],",",["T_WHITESPACE"," ",1356],["T_CONSTANT_ENCAPSED_STRING","'order\/account'",1356],")",";",["T_WHITESPACE","\n        ",1356],["T_IF","if",1357],["T_WHITESPACE"," ",1357],"(",["T_VARIABLE","$this",1357],["T_OBJECT_OPERATOR","->",1357],["T_STRING","getIsValidate",1357],"(",")",")",["T_WHITESPACE"," ",1357],"{",["T_WHITESPACE","\n            ",1357],["T_VARIABLE","$errors",1358],["T_WHITESPACE"," ",1358],"=",["T_WHITESPACE"," ",1358],["T_VARIABLE","$form",1358],["T_OBJECT_OPERATOR","->",1358],["T_STRING","validateData",1358],"(",["T_VARIABLE","$data",1358],")",";",["T_WHITESPACE","\n            ",1358],["T_IF","if",1359],["T_WHITESPACE"," ",1359],"(",["T_VARIABLE","$errors",1359],["T_WHITESPACE"," ",1359],["T_IS_NOT_IDENTICAL","!==",1359],["T_WHITESPACE"," ",1359],["T_STRING","true",1359],")",["T_WHITESPACE"," ",1359],"{",["T_WHITESPACE","\n                ",1359],["T_FOREACH","foreach",1360],["T_WHITESPACE"," ",1360],"(",["T_VARIABLE","$errors",1360],["T_WHITESPACE"," ",1360],["T_AS","as",1360],["T_WHITESPACE"," ",1360],["T_VARIABLE","$error",1360],")",["T_WHITESPACE"," ",1360],"{",["T_WHITESPACE","\n                    ",1360],["T_VARIABLE","$this",1361],["T_OBJECT_OPERATOR","->",1361],["T_STRING","_errors",1361],"[","]",["T_WHITESPACE"," ",1361],"=",["T_WHITESPACE"," ",1361],["T_VARIABLE","$error",1361],";",["T_WHITESPACE","\n                ",1361],"}",["T_WHITESPACE","\n                ",1362],["T_VARIABLE","$form",1363],["T_OBJECT_OPERATOR","->",1363],["T_STRING","restoreData",1363],"(",["T_VARIABLE","$data",1363],")",";",["T_WHITESPACE","\n            ",1363],"}",["T_WHITESPACE"," ",1364],["T_ELSE","else",1364],["T_WHITESPACE"," ",1364],"{",["T_WHITESPACE","\n                ",1364],["T_VARIABLE","$form",1365],["T_OBJECT_OPERATOR","->",1365],["T_STRING","compactData",1365],"(",["T_VARIABLE","$data",1365],")",";",["T_WHITESPACE","\n            ",1365],"}",["T_WHITESPACE","\n        ",1366],"}",["T_WHITESPACE"," ",1367],["T_ELSE","else",1367],["T_WHITESPACE"," ",1367],"{",["T_WHITESPACE","\n            ",1367],["T_VARIABLE","$form",1368],["T_OBJECT_OPERATOR","->",1368],["T_STRING","restoreData",1368],"(",["T_VARIABLE","$data",1368],")",";",["T_WHITESPACE","\n        ",1368],"}",["T_WHITESPACE","\n\n        ",1369],["T_RETURN","return",1371],["T_WHITESPACE"," ",1371],["T_VARIABLE","$this",1371],";",["T_WHITESPACE","\n    ",1371],"}",["T_WHITESPACE","\n\n    ",1372],["T_DOC_COMMENT","\/**\n     * Prepare quote customer\n     *\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",1374],["T_WHITESPACE","\n    ",1378],["T_PUBLIC","public",1379],["T_WHITESPACE"," ",1379],["T_FUNCTION","function",1379],["T_WHITESPACE"," ",1379],["T_STRING","_prepareCustomer",1379],"(",")",["T_WHITESPACE","\n    ",1379],"{",["T_WHITESPACE","\n        ",1380],["T_DOC_COMMENT","\/** @var $quote Mage_Sales_Model_Quote *\/",1381],["T_WHITESPACE","\n        ",1381],["T_VARIABLE","$quote",1382],["T_WHITESPACE"," ",1382],"=",["T_WHITESPACE"," ",1382],["T_VARIABLE","$this",1382],["T_OBJECT_OPERATOR","->",1382],["T_STRING","getQuote",1382],"(",")",";",["T_WHITESPACE","\n        ",1382],["T_IF","if",1383],["T_WHITESPACE"," ",1383],"(",["T_VARIABLE","$quote",1383],["T_OBJECT_OPERATOR","->",1383],["T_STRING","getCustomerIsGuest",1383],"(",")",")",["T_WHITESPACE"," ",1383],"{",["T_WHITESPACE","\n            ",1383],["T_RETURN","return",1384],["T_WHITESPACE"," ",1384],["T_VARIABLE","$this",1384],";",["T_WHITESPACE","\n        ",1384],"}",["T_WHITESPACE","\n\n        ",1385],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",1387],["T_WHITESPACE","\n        ",1387],["T_VARIABLE","$customer",1388],["T_WHITESPACE"," ",1388],"=",["T_WHITESPACE"," ",1388],["T_VARIABLE","$this",1388],["T_OBJECT_OPERATOR","->",1388],["T_STRING","getSession",1388],"(",")",["T_OBJECT_OPERATOR","->",1388],["T_STRING","getCustomer",1388],"(",")",";",["T_WHITESPACE","\n        ",1388],["T_DOC_COMMENT","\/** @var $store Mage_Core_Model_Store *\/",1389],["T_WHITESPACE","\n        ",1389],["T_VARIABLE","$store",1390],["T_WHITESPACE"," ",1390],"=",["T_WHITESPACE"," ",1390],["T_VARIABLE","$this",1390],["T_OBJECT_OPERATOR","->",1390],["T_STRING","getSession",1390],"(",")",["T_OBJECT_OPERATOR","->",1390],["T_STRING","getStore",1390],"(",")",";",["T_WHITESPACE","\n\n        ",1390],["T_VARIABLE","$customerIsInStore",1392],["T_WHITESPACE"," ",1392],"=",["T_WHITESPACE"," ",1392],["T_VARIABLE","$this",1392],["T_OBJECT_OPERATOR","->",1392],["T_STRING","_customerIsInStore",1392],"(",["T_VARIABLE","$store",1392],")",";",["T_WHITESPACE","\n        ",1392],["T_VARIABLE","$customerBillingAddress",1393],["T_WHITESPACE"," ",1393],"=",["T_WHITESPACE"," ",1393],["T_STRING","null",1393],";",["T_WHITESPACE","\n        ",1393],["T_VARIABLE","$customerShippingAddress",1394],["T_WHITESPACE"," ",1394],"=",["T_WHITESPACE"," ",1394],["T_STRING","null",1394],";",["T_WHITESPACE","\n\n        ",1394],["T_IF","if",1396],["T_WHITESPACE"," ",1396],"(",["T_VARIABLE","$customer",1396],["T_OBJECT_OPERATOR","->",1396],["T_STRING","getId",1396],"(",")",")",["T_WHITESPACE"," ",1396],"{",["T_WHITESPACE","\n            ",1396],["T_COMMENT","\/\/ Create new customer if customer is not registered in specified store\n",1397],["T_WHITESPACE","            ",1398],["T_IF","if",1398],["T_WHITESPACE"," ",1398],"(","!",["T_VARIABLE","$customerIsInStore",1398],")",["T_WHITESPACE"," ",1398],"{",["T_WHITESPACE","\n                ",1398],["T_VARIABLE","$customer",1399],["T_OBJECT_OPERATOR","->",1399],["T_STRING","setId",1399],"(",["T_STRING","null",1399],")",["T_WHITESPACE","\n                    ",1399],["T_OBJECT_OPERATOR","->",1400],["T_STRING","setStore",1400],"(",["T_VARIABLE","$store",1400],")",["T_WHITESPACE","\n                    ",1400],["T_OBJECT_OPERATOR","->",1401],["T_STRING","setDefaultBilling",1401],"(",["T_STRING","null",1401],")",["T_WHITESPACE","\n                    ",1401],["T_OBJECT_OPERATOR","->",1402],["T_STRING","setDefaultShipping",1402],"(",["T_STRING","null",1402],")",["T_WHITESPACE","\n                    ",1402],["T_OBJECT_OPERATOR","->",1403],["T_STRING","setPassword",1403],"(",["T_VARIABLE","$customer",1403],["T_OBJECT_OPERATOR","->",1403],["T_STRING","generatePassword",1403],"(",")",")",";",["T_WHITESPACE","\n                ",1403],["T_VARIABLE","$this",1404],["T_OBJECT_OPERATOR","->",1404],["T_STRING","_setCustomerData",1404],"(",["T_VARIABLE","$customer",1404],")",";",["T_WHITESPACE","\n            ",1404],"}",["T_WHITESPACE","\n\n            ",1405],["T_IF","if",1407],["T_WHITESPACE"," ",1407],"(",["T_VARIABLE","$this",1407],["T_OBJECT_OPERATOR","->",1407],["T_STRING","getBillingAddress",1407],"(",")",["T_OBJECT_OPERATOR","->",1407],["T_STRING","getSaveInAddressBook",1407],"(",")",")",["T_WHITESPACE"," ",1407],"{",["T_WHITESPACE","\n                ",1407],["T_DOC_COMMENT","\/** @var $customerBillingAddress Mage_Customer_Model_Address *\/",1408],["T_WHITESPACE","\n                ",1408],["T_VARIABLE","$customerBillingAddress",1409],["T_WHITESPACE"," ",1409],"=",["T_WHITESPACE"," ",1409],["T_VARIABLE","$this",1409],["T_OBJECT_OPERATOR","->",1409],["T_STRING","getBillingAddress",1409],"(",")",["T_OBJECT_OPERATOR","->",1409],["T_STRING","exportCustomerAddress",1409],"(",")",";",["T_WHITESPACE","\n                ",1409],["T_VARIABLE","$customerAddressId",1410],["T_WHITESPACE"," ",1410],"=",["T_WHITESPACE"," ",1410],["T_VARIABLE","$this",1410],["T_OBJECT_OPERATOR","->",1410],["T_STRING","getBillingAddress",1410],"(",")",["T_OBJECT_OPERATOR","->",1410],["T_STRING","getCustomerAddressId",1410],"(",")",";",["T_WHITESPACE","\n                ",1410],["T_IF","if",1411],["T_WHITESPACE"," ",1411],"(",["T_VARIABLE","$customerAddressId",1411],["T_WHITESPACE"," ",1411],["T_BOOLEAN_AND","&&",1411],["T_WHITESPACE"," ",1411],["T_VARIABLE","$customer",1411],["T_OBJECT_OPERATOR","->",1411],["T_STRING","getId",1411],"(",")",")",["T_WHITESPACE"," ",1411],"{",["T_WHITESPACE","\n                    ",1411],["T_VARIABLE","$customer",1412],["T_OBJECT_OPERATOR","->",1412],["T_STRING","getAddressItemById",1412],"(",["T_VARIABLE","$customerAddressId",1412],")",["T_OBJECT_OPERATOR","->",1412],["T_STRING","addData",1412],"(",["T_VARIABLE","$customerBillingAddress",1412],["T_OBJECT_OPERATOR","->",1412],["T_STRING","getData",1412],"(",")",")",";",["T_WHITESPACE","\n                ",1412],"}",["T_WHITESPACE"," ",1413],["T_ELSE","else",1413],["T_WHITESPACE"," ",1413],"{",["T_WHITESPACE","\n                    ",1413],["T_VARIABLE","$customer",1414],["T_OBJECT_OPERATOR","->",1414],["T_STRING","addAddress",1414],"(",["T_VARIABLE","$customerBillingAddress",1414],")",";",["T_WHITESPACE","\n                ",1414],"}",["T_WHITESPACE","\n            ",1415],"}",["T_WHITESPACE","\n\n            ",1416],["T_IF","if",1418],["T_WHITESPACE"," ",1418],"(","!",["T_VARIABLE","$this",1418],["T_OBJECT_OPERATOR","->",1418],["T_STRING","getQuote",1418],"(",")",["T_OBJECT_OPERATOR","->",1418],["T_STRING","isVirtual",1418],"(",")",["T_WHITESPACE"," ",1418],["T_BOOLEAN_AND","&&",1418],["T_WHITESPACE"," ",1418],["T_VARIABLE","$this",1418],["T_OBJECT_OPERATOR","->",1418],["T_STRING","getShippingAddress",1418],"(",")",["T_OBJECT_OPERATOR","->",1418],["T_STRING","getSaveInAddressBook",1418],"(",")",")",["T_WHITESPACE"," ",1418],"{",["T_WHITESPACE","\n                ",1418],["T_DOC_COMMENT","\/** @var $customerShippingAddress Mage_Customer_Model_Address *\/",1419],["T_WHITESPACE","\n                ",1419],["T_VARIABLE","$customerShippingAddress",1420],["T_WHITESPACE"," ",1420],"=",["T_WHITESPACE"," ",1420],["T_VARIABLE","$this",1420],["T_OBJECT_OPERATOR","->",1420],["T_STRING","getShippingAddress",1420],"(",")",["T_OBJECT_OPERATOR","->",1420],["T_STRING","exportCustomerAddress",1420],"(",")",";",["T_WHITESPACE","\n                ",1420],["T_VARIABLE","$customerAddressId",1421],["T_WHITESPACE"," ",1421],"=",["T_WHITESPACE"," ",1421],["T_VARIABLE","$this",1421],["T_OBJECT_OPERATOR","->",1421],["T_STRING","getShippingAddress",1421],"(",")",["T_OBJECT_OPERATOR","->",1421],["T_STRING","getCustomerAddressId",1421],"(",")",";",["T_WHITESPACE","\n                ",1421],["T_IF","if",1422],["T_WHITESPACE"," ",1422],"(",["T_VARIABLE","$customerAddressId",1422],["T_WHITESPACE"," ",1422],["T_BOOLEAN_AND","&&",1422],["T_WHITESPACE"," ",1422],["T_VARIABLE","$customer",1422],["T_OBJECT_OPERATOR","->",1422],["T_STRING","getId",1422],"(",")",")",["T_WHITESPACE"," ",1422],"{",["T_WHITESPACE","\n                    ",1422],["T_VARIABLE","$customer",1423],["T_OBJECT_OPERATOR","->",1423],["T_STRING","getAddressItemById",1423],"(",["T_VARIABLE","$customerAddressId",1423],")",["T_OBJECT_OPERATOR","->",1423],["T_STRING","addData",1423],"(",["T_VARIABLE","$customerShippingAddress",1423],["T_OBJECT_OPERATOR","->",1423],["T_STRING","getData",1423],"(",")",")",";",["T_WHITESPACE","\n                ",1423],"}",["T_WHITESPACE"," ",1424],["T_ELSEIF","elseif",1424],["T_WHITESPACE"," ",1424],"(","!",["T_EMPTY","empty",1424],"(",["T_VARIABLE","$customerAddressId",1424],")",["T_WHITESPACE","\n                    ",1424],["T_BOOLEAN_AND","&&",1425],["T_WHITESPACE"," ",1425],["T_VARIABLE","$customerBillingAddress",1425],["T_WHITESPACE"," ",1425],["T_IS_NOT_IDENTICAL","!==",1425],["T_WHITESPACE"," ",1425],["T_STRING","null",1425],["T_WHITESPACE","\n                    ",1425],["T_BOOLEAN_AND","&&",1426],["T_WHITESPACE"," ",1426],["T_VARIABLE","$this",1426],["T_OBJECT_OPERATOR","->",1426],["T_STRING","getBillingAddress",1426],"(",")",["T_OBJECT_OPERATOR","->",1426],["T_STRING","getCustomerAddressId",1426],"(",")",["T_WHITESPACE"," ",1426],["T_IS_EQUAL","==",1426],["T_WHITESPACE"," ",1426],["T_VARIABLE","$customerAddressId",1426],["T_WHITESPACE","\n                ",1426],")",["T_WHITESPACE"," ",1427],"{",["T_WHITESPACE","\n                    ",1427],["T_VARIABLE","$customerBillingAddress",1428],["T_OBJECT_OPERATOR","->",1428],["T_STRING","setIsDefaultShipping",1428],"(",["T_STRING","true",1428],")",";",["T_WHITESPACE","\n                ",1428],"}",["T_WHITESPACE"," ",1429],["T_ELSE","else",1429],["T_WHITESPACE"," ",1429],"{",["T_WHITESPACE","\n                    ",1429],["T_VARIABLE","$customer",1430],["T_OBJECT_OPERATOR","->",1430],["T_STRING","addAddress",1430],"(",["T_VARIABLE","$customerShippingAddress",1430],")",";",["T_WHITESPACE","\n                ",1430],"}",["T_WHITESPACE","\n            ",1431],"}",["T_WHITESPACE","\n\n            ",1432],["T_IF","if",1434],["T_WHITESPACE"," ",1434],"(",["T_STRING","is_null",1434],"(",["T_VARIABLE","$customer",1434],["T_OBJECT_OPERATOR","->",1434],["T_STRING","getDefaultBilling",1434],"(",")",")",["T_WHITESPACE"," ",1434],["T_BOOLEAN_AND","&&",1434],["T_WHITESPACE"," ",1434],["T_VARIABLE","$customerBillingAddress",1434],")",["T_WHITESPACE"," ",1434],"{",["T_WHITESPACE","\n                ",1434],["T_VARIABLE","$customerBillingAddress",1435],["T_OBJECT_OPERATOR","->",1435],["T_STRING","setIsDefaultBilling",1435],"(",["T_STRING","true",1435],")",";",["T_WHITESPACE","\n            ",1435],"}",["T_WHITESPACE","\n\n            ",1436],["T_IF","if",1438],["T_WHITESPACE"," ",1438],"(",["T_STRING","is_null",1438],"(",["T_VARIABLE","$customer",1438],["T_OBJECT_OPERATOR","->",1438],["T_STRING","getDefaultShipping",1438],"(",")",")",")",["T_WHITESPACE"," ",1438],"{",["T_WHITESPACE","\n                ",1438],["T_IF","if",1439],["T_WHITESPACE"," ",1439],"(",["T_VARIABLE","$this",1439],["T_OBJECT_OPERATOR","->",1439],["T_STRING","getShippingAddress",1439],"(",")",["T_OBJECT_OPERATOR","->",1439],["T_STRING","getSameAsBilling",1439],"(",")",["T_WHITESPACE"," ",1439],["T_BOOLEAN_AND","&&",1439],["T_WHITESPACE"," ",1439],["T_VARIABLE","$customerBillingAddress",1439],")",["T_WHITESPACE"," ",1439],"{",["T_WHITESPACE","\n                    ",1439],["T_VARIABLE","$customerBillingAddress",1440],["T_OBJECT_OPERATOR","->",1440],["T_STRING","setIsDefaultShipping",1440],"(",["T_STRING","true",1440],")",";",["T_WHITESPACE","\n                ",1440],"}",["T_WHITESPACE"," ",1441],["T_ELSEIF","elseif",1441],["T_WHITESPACE"," ",1441],"(",["T_VARIABLE","$customerShippingAddress",1441],")",["T_WHITESPACE"," ",1441],"{",["T_WHITESPACE","\n                    ",1441],["T_VARIABLE","$customerShippingAddress",1442],["T_OBJECT_OPERATOR","->",1442],["T_STRING","setIsDefaultShipping",1442],"(",["T_STRING","true",1442],")",";",["T_WHITESPACE","\n                ",1442],"}",["T_WHITESPACE","\n            ",1443],"}",["T_WHITESPACE","\n        ",1444],"}",["T_WHITESPACE"," ",1445],["T_ELSE","else",1445],["T_WHITESPACE"," ",1445],"{",["T_WHITESPACE","\n            ",1445],["T_COMMENT","\/\/ Prepare new customer\n",1446],["T_WHITESPACE","            ",1447],["T_DOC_COMMENT","\/** @var $customerBillingAddress Mage_Customer_Model_Address *\/",1447],["T_WHITESPACE","\n            ",1447],["T_VARIABLE","$customerBillingAddress",1448],["T_WHITESPACE"," ",1448],"=",["T_WHITESPACE"," ",1448],["T_VARIABLE","$this",1448],["T_OBJECT_OPERATOR","->",1448],["T_STRING","getBillingAddress",1448],"(",")",["T_OBJECT_OPERATOR","->",1448],["T_STRING","exportCustomerAddress",1448],"(",")",";",["T_WHITESPACE","\n            ",1448],["T_VARIABLE","$customer",1449],["T_OBJECT_OPERATOR","->",1449],["T_STRING","addData",1449],"(",["T_VARIABLE","$customerBillingAddress",1449],["T_OBJECT_OPERATOR","->",1449],["T_STRING","getData",1449],"(",")",")",["T_WHITESPACE","\n                ",1449],["T_OBJECT_OPERATOR","->",1450],["T_STRING","setPassword",1450],"(",["T_VARIABLE","$customer",1450],["T_OBJECT_OPERATOR","->",1450],["T_STRING","generatePassword",1450],"(",")",")",["T_WHITESPACE","\n                ",1450],["T_OBJECT_OPERATOR","->",1451],["T_STRING","setStore",1451],"(",["T_VARIABLE","$store",1451],")",";",["T_WHITESPACE","\n            ",1451],["T_VARIABLE","$customer",1452],["T_OBJECT_OPERATOR","->",1452],["T_STRING","setEmail",1452],"(",["T_VARIABLE","$this",1452],["T_OBJECT_OPERATOR","->",1452],["T_STRING","_getNewCustomerEmail",1452],"(",["T_VARIABLE","$customer",1452],")",")",";",["T_WHITESPACE","\n            ",1452],["T_VARIABLE","$this",1453],["T_OBJECT_OPERATOR","->",1453],["T_STRING","_setCustomerData",1453],"(",["T_VARIABLE","$customer",1453],")",";",["T_WHITESPACE","\n\n            ",1453],["T_IF","if",1455],["T_WHITESPACE"," ",1455],"(",["T_VARIABLE","$this",1455],["T_OBJECT_OPERATOR","->",1455],["T_STRING","getBillingAddress",1455],"(",")",["T_OBJECT_OPERATOR","->",1455],["T_STRING","getSaveInAddressBook",1455],"(",")",")",["T_WHITESPACE"," ",1455],"{",["T_WHITESPACE","\n                ",1455],["T_VARIABLE","$customerBillingAddress",1456],["T_OBJECT_OPERATOR","->",1456],["T_STRING","setIsDefaultBilling",1456],"(",["T_STRING","true",1456],")",";",["T_WHITESPACE","\n                ",1456],["T_VARIABLE","$customer",1457],["T_OBJECT_OPERATOR","->",1457],["T_STRING","addAddress",1457],"(",["T_VARIABLE","$customerBillingAddress",1457],")",";",["T_WHITESPACE","\n            ",1457],"}",["T_WHITESPACE","\n\n            ",1458],["T_DOC_COMMENT","\/** @var $shippingAddress Mage_Sales_Model_Quote_Address *\/",1460],["T_WHITESPACE","\n            ",1460],["T_VARIABLE","$shippingAddress",1461],["T_WHITESPACE"," ",1461],"=",["T_WHITESPACE"," ",1461],["T_VARIABLE","$this",1461],["T_OBJECT_OPERATOR","->",1461],["T_STRING","getShippingAddress",1461],"(",")",";",["T_WHITESPACE","\n            ",1461],["T_IF","if",1462],["T_WHITESPACE"," ",1462],"(","!",["T_VARIABLE","$this",1462],["T_OBJECT_OPERATOR","->",1462],["T_STRING","getQuote",1462],"(",")",["T_OBJECT_OPERATOR","->",1462],["T_STRING","isVirtual",1462],"(",")",["T_WHITESPACE","\n                ",1462],["T_BOOLEAN_AND","&&",1463],["T_WHITESPACE"," ",1463],"!",["T_VARIABLE","$shippingAddress",1463],["T_OBJECT_OPERATOR","->",1463],["T_STRING","getSameAsBilling",1463],"(",")",["T_WHITESPACE","\n                ",1463],["T_BOOLEAN_AND","&&",1464],["T_WHITESPACE"," ",1464],["T_VARIABLE","$shippingAddress",1464],["T_OBJECT_OPERATOR","->",1464],["T_STRING","getSaveInAddressBook",1464],"(",")",["T_WHITESPACE","\n            ",1464],")",["T_WHITESPACE"," ",1465],"{",["T_WHITESPACE","\n                ",1465],["T_DOC_COMMENT","\/** @var $customerShippingAddress Mage_Customer_Model_Address *\/",1466],["T_WHITESPACE","\n                ",1466],["T_VARIABLE","$customerShippingAddress",1467],["T_WHITESPACE"," ",1467],"=",["T_WHITESPACE"," ",1467],["T_VARIABLE","$shippingAddress",1467],["T_OBJECT_OPERATOR","->",1467],["T_STRING","exportCustomerAddress",1467],"(",")",";",["T_WHITESPACE","\n                ",1467],["T_VARIABLE","$customerShippingAddress",1468],["T_OBJECT_OPERATOR","->",1468],["T_STRING","setIsDefaultShipping",1468],"(",["T_STRING","true",1468],")",";",["T_WHITESPACE","\n                ",1468],["T_VARIABLE","$customer",1469],["T_OBJECT_OPERATOR","->",1469],["T_STRING","addAddress",1469],"(",["T_VARIABLE","$customerShippingAddress",1469],")",";",["T_WHITESPACE","\n            ",1469],"}",["T_WHITESPACE"," ",1470],["T_ELSE","else",1470],["T_WHITESPACE"," ",1470],"{",["T_WHITESPACE","\n                ",1470],["T_VARIABLE","$customerBillingAddress",1471],["T_OBJECT_OPERATOR","->",1471],["T_STRING","setIsDefaultShipping",1471],"(",["T_STRING","true",1471],")",";",["T_WHITESPACE","\n            ",1471],"}",["T_WHITESPACE","\n        ",1472],"}",["T_WHITESPACE","\n\n        ",1473],["T_COMMENT","\/\/ Set quote customer data to customer\n",1475],["T_WHITESPACE","        ",1476],["T_VARIABLE","$this",1476],["T_OBJECT_OPERATOR","->",1476],["T_STRING","_setCustomerData",1476],"(",["T_VARIABLE","$customer",1476],")",";",["T_WHITESPACE","\n\n        ",1476],["T_COMMENT","\/\/ Set customer to quote and convert customer data to quote\n",1478],["T_WHITESPACE","        ",1479],["T_VARIABLE","$quote",1479],["T_OBJECT_OPERATOR","->",1479],["T_STRING","setCustomer",1479],"(",["T_VARIABLE","$customer",1479],")",";",["T_WHITESPACE","\n\n        ",1479],["T_COMMENT","\/\/ Add user defined attributes to quote\n",1481],["T_WHITESPACE","        ",1482],["T_VARIABLE","$form",1482],["T_WHITESPACE"," ",1482],"=",["T_WHITESPACE"," ",1482],["T_VARIABLE","$this",1482],["T_OBJECT_OPERATOR","->",1482],["T_STRING","_getCustomerForm",1482],"(",")",["T_OBJECT_OPERATOR","->",1482],["T_STRING","setEntity",1482],"(",["T_VARIABLE","$customer",1482],")",";",["T_WHITESPACE","\n        ",1482],["T_FOREACH","foreach",1483],["T_WHITESPACE"," ",1483],"(",["T_VARIABLE","$form",1483],["T_OBJECT_OPERATOR","->",1483],["T_STRING","getUserAttributes",1483],"(",")",["T_WHITESPACE"," ",1483],["T_AS","as",1483],["T_WHITESPACE"," ",1483],["T_VARIABLE","$attribute",1483],")",["T_WHITESPACE"," ",1483],"{",["T_WHITESPACE","\n            ",1483],["T_VARIABLE","$quoteCode",1484],["T_WHITESPACE"," ",1484],"=",["T_WHITESPACE"," ",1484],["T_STRING","sprintf",1484],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_%s'",1484],",",["T_WHITESPACE"," ",1484],["T_VARIABLE","$attribute",1484],["T_OBJECT_OPERATOR","->",1484],["T_STRING","getAttributeCode",1484],"(",")",")",";",["T_WHITESPACE","\n            ",1484],["T_VARIABLE","$quote",1485],["T_OBJECT_OPERATOR","->",1485],["T_STRING","setData",1485],"(",["T_VARIABLE","$quoteCode",1485],",",["T_WHITESPACE"," ",1485],["T_VARIABLE","$customer",1485],["T_OBJECT_OPERATOR","->",1485],["T_STRING","getData",1485],"(",["T_VARIABLE","$attribute",1485],["T_OBJECT_OPERATOR","->",1485],["T_STRING","getAttributeCode",1485],"(",")",")",")",";",["T_WHITESPACE","\n        ",1485],"}",["T_WHITESPACE","\n\n        ",1486],["T_IF","if",1488],["T_WHITESPACE"," ",1488],"(",["T_VARIABLE","$customer",1488],["T_OBJECT_OPERATOR","->",1488],["T_STRING","getId",1488],"(",")",")",["T_WHITESPACE"," ",1488],"{",["T_WHITESPACE","\n            ",1488],["T_COMMENT","\/\/ Restore account data for existing customer\n",1489],["T_WHITESPACE","            ",1490],["T_VARIABLE","$this",1490],["T_OBJECT_OPERATOR","->",1490],["T_STRING","_getCustomerForm",1490],"(",")",["T_WHITESPACE","\n                ",1490],["T_OBJECT_OPERATOR","->",1491],["T_STRING","setEntity",1491],"(",["T_VARIABLE","$customer",1491],")",["T_WHITESPACE","\n                ",1491],["T_OBJECT_OPERATOR","->",1492],["T_STRING","resetEntityData",1492],"(",")",";",["T_WHITESPACE","\n        ",1492],"}",["T_WHITESPACE"," ",1493],["T_ELSE","else",1493],["T_WHITESPACE"," ",1493],"{",["T_WHITESPACE","\n            ",1493],["T_VARIABLE","$quote",1494],["T_OBJECT_OPERATOR","->",1494],["T_STRING","setCustomerId",1494],"(",["T_STRING","true",1494],")",";",["T_WHITESPACE","\n        ",1494],"}",["T_WHITESPACE","\n\n        ",1495],["T_RETURN","return",1497],["T_WHITESPACE"," ",1497],["T_VARIABLE","$this",1497],";",["T_WHITESPACE","\n    ",1497],"}",["T_WHITESPACE","\n\n    ",1498],["T_DOC_COMMENT","\/**\n     * Prepare item options\n     *\/",1500],["T_WHITESPACE","\n    ",1502],["T_PROTECTED","protected",1503],["T_WHITESPACE"," ",1503],["T_FUNCTION","function",1503],["T_WHITESPACE"," ",1503],["T_STRING","_prepareQuoteItems",1503],"(",")",["T_WHITESPACE","\n    ",1503],"{",["T_WHITESPACE","\n        ",1504],["T_FOREACH","foreach",1505],["T_WHITESPACE"," ",1505],"(",["T_VARIABLE","$this",1505],["T_OBJECT_OPERATOR","->",1505],["T_STRING","getQuote",1505],"(",")",["T_OBJECT_OPERATOR","->",1505],["T_STRING","getAllItems",1505],"(",")",["T_WHITESPACE"," ",1505],["T_AS","as",1505],["T_WHITESPACE"," ",1505],["T_VARIABLE","$item",1505],")",["T_WHITESPACE"," ",1505],"{",["T_WHITESPACE","\n            ",1505],["T_VARIABLE","$options",1506],["T_WHITESPACE"," ",1506],"=",["T_WHITESPACE"," ",1506],["T_ARRAY","array",1506],"(",")",";",["T_WHITESPACE","\n            ",1506],["T_VARIABLE","$productOptions",1507],["T_WHITESPACE"," ",1507],"=",["T_WHITESPACE"," ",1507],["T_VARIABLE","$item",1507],["T_OBJECT_OPERATOR","->",1507],["T_STRING","getProduct",1507],"(",")",["T_OBJECT_OPERATOR","->",1507],["T_STRING","getTypeInstance",1507],"(",["T_STRING","true",1507],")",["T_OBJECT_OPERATOR","->",1507],["T_STRING","getOrderOptions",1507],"(",["T_VARIABLE","$item",1507],["T_OBJECT_OPERATOR","->",1507],["T_STRING","getProduct",1507],"(",")",")",";",["T_WHITESPACE","\n            ",1507],["T_IF","if",1508],["T_WHITESPACE"," ",1508],"(",["T_VARIABLE","$productOptions",1508],")",["T_WHITESPACE"," ",1508],"{",["T_WHITESPACE","\n                ",1508],["T_VARIABLE","$productOptions",1509],"[",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",1509],"]","[",["T_CONSTANT_ENCAPSED_STRING","'options'",1509],"]",["T_WHITESPACE"," ",1509],"=",["T_WHITESPACE"," ",1509],["T_VARIABLE","$this",1509],["T_OBJECT_OPERATOR","->",1509],["T_STRING","_prepareOptionsForRequest",1509],"(",["T_VARIABLE","$item",1509],")",";",["T_WHITESPACE","\n                ",1509],["T_VARIABLE","$options",1510],["T_WHITESPACE"," ",1510],"=",["T_WHITESPACE"," ",1510],["T_VARIABLE","$productOptions",1510],";",["T_WHITESPACE","\n            ",1510],"}",["T_WHITESPACE","\n            ",1511],["T_VARIABLE","$addOptions",1512],["T_WHITESPACE"," ",1512],"=",["T_WHITESPACE"," ",1512],["T_VARIABLE","$item",1512],["T_OBJECT_OPERATOR","->",1512],["T_STRING","getOptionByCode",1512],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",1512],")",";",["T_WHITESPACE","\n            ",1512],["T_IF","if",1513],["T_WHITESPACE"," ",1513],"(",["T_VARIABLE","$addOptions",1513],")",["T_WHITESPACE"," ",1513],"{",["T_WHITESPACE","\n                ",1513],["T_VARIABLE","$options",1514],"[",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",1514],"]",["T_WHITESPACE"," ",1514],"=",["T_WHITESPACE"," ",1514],["T_STRING","unserialize",1514],"(",["T_VARIABLE","$addOptions",1514],["T_OBJECT_OPERATOR","->",1514],["T_STRING","getValue",1514],"(",")",")",";",["T_WHITESPACE","\n            ",1514],"}",["T_WHITESPACE","\n            ",1515],["T_VARIABLE","$item",1516],["T_OBJECT_OPERATOR","->",1516],["T_STRING","setProductOrderOptions",1516],"(",["T_VARIABLE","$options",1516],")",";",["T_WHITESPACE","\n        ",1516],"}",["T_WHITESPACE","\n        ",1517],["T_RETURN","return",1518],["T_WHITESPACE"," ",1518],["T_VARIABLE","$this",1518],";",["T_WHITESPACE","\n    ",1518],"}",["T_WHITESPACE","\n\n    ",1519],["T_DOC_COMMENT","\/**\n     * Create new order\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",1521],["T_WHITESPACE","\n    ",1525],["T_PUBLIC","public",1526],["T_WHITESPACE"," ",1526],["T_FUNCTION","function",1526],["T_WHITESPACE"," ",1526],["T_STRING","createOrder",1526],"(",")",["T_WHITESPACE","\n    ",1526],"{",["T_WHITESPACE","\n        ",1527],["T_VARIABLE","$this",1528],["T_OBJECT_OPERATOR","->",1528],["T_STRING","_prepareCustomer",1528],"(",")",";",["T_WHITESPACE","\n        ",1528],["T_VARIABLE","$this",1529],["T_OBJECT_OPERATOR","->",1529],["T_STRING","_validate",1529],"(",")",";",["T_WHITESPACE","\n        ",1529],["T_VARIABLE","$quote",1530],["T_WHITESPACE"," ",1530],"=",["T_WHITESPACE"," ",1530],["T_VARIABLE","$this",1530],["T_OBJECT_OPERATOR","->",1530],["T_STRING","getQuote",1530],"(",")",";",["T_WHITESPACE","\n        ",1530],["T_VARIABLE","$this",1531],["T_OBJECT_OPERATOR","->",1531],["T_STRING","_prepareQuoteItems",1531],"(",")",";",["T_WHITESPACE","\n\n        ",1531],["T_VARIABLE","$service",1533],["T_WHITESPACE"," ",1533],"=",["T_WHITESPACE"," ",1533],["T_STRING","Mage",1533],["T_DOUBLE_COLON","::",1533],["T_STRING","getModel",1533],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_quote'",1533],",",["T_WHITESPACE"," ",1533],["T_VARIABLE","$quote",1533],")",";",["T_WHITESPACE","\n        ",1533],["T_DOC_COMMENT","\/** @var Mage_Sales_Model_Order $oldOrder *\/",1534],["T_WHITESPACE","\n        ",1534],["T_VARIABLE","$oldOrder",1535],["T_WHITESPACE"," ",1535],"=",["T_WHITESPACE"," ",1535],["T_VARIABLE","$this",1535],["T_OBJECT_OPERATOR","->",1535],["T_STRING","getSession",1535],"(",")",["T_OBJECT_OPERATOR","->",1535],["T_STRING","getOrder",1535],"(",")",";",["T_WHITESPACE","\n        ",1535],["T_IF","if",1536],["T_WHITESPACE"," ",1536],"(",["T_VARIABLE","$oldOrder",1536],["T_OBJECT_OPERATOR","->",1536],["T_STRING","getId",1536],"(",")",")",["T_WHITESPACE"," ",1536],"{",["T_WHITESPACE","\n            ",1536],["T_VARIABLE","$originalId",1537],["T_WHITESPACE"," ",1537],"=",["T_WHITESPACE"," ",1537],["T_VARIABLE","$oldOrder",1537],["T_OBJECT_OPERATOR","->",1537],["T_STRING","getOriginalIncrementId",1537],"(",")",";",["T_WHITESPACE","\n            ",1537],["T_IF","if",1538],["T_WHITESPACE"," ",1538],"(","!",["T_VARIABLE","$originalId",1538],")",["T_WHITESPACE"," ",1538],"{",["T_WHITESPACE","\n                ",1538],["T_VARIABLE","$originalId",1539],["T_WHITESPACE"," ",1539],"=",["T_WHITESPACE"," ",1539],["T_VARIABLE","$oldOrder",1539],["T_OBJECT_OPERATOR","->",1539],["T_STRING","getIncrementId",1539],"(",")",";",["T_WHITESPACE","\n            ",1539],"}",["T_WHITESPACE","\n            ",1540],["T_VARIABLE","$orderData",1541],["T_WHITESPACE"," ",1541],"=",["T_WHITESPACE"," ",1541],["T_ARRAY","array",1541],"(",["T_WHITESPACE","\n                ",1541],["T_CONSTANT_ENCAPSED_STRING","'original_increment_id'",1542],["T_WHITESPACE","     ",1542],["T_DOUBLE_ARROW","=>",1542],["T_WHITESPACE"," ",1542],["T_VARIABLE","$originalId",1542],",",["T_WHITESPACE","\n                ",1542],["T_CONSTANT_ENCAPSED_STRING","'relation_parent_id'",1543],["T_WHITESPACE","        ",1543],["T_DOUBLE_ARROW","=>",1543],["T_WHITESPACE"," ",1543],["T_VARIABLE","$oldOrder",1543],["T_OBJECT_OPERATOR","->",1543],["T_STRING","getId",1543],"(",")",",",["T_WHITESPACE","\n                ",1543],["T_CONSTANT_ENCAPSED_STRING","'relation_parent_real_id'",1544],["T_WHITESPACE","   ",1544],["T_DOUBLE_ARROW","=>",1544],["T_WHITESPACE"," ",1544],["T_VARIABLE","$oldOrder",1544],["T_OBJECT_OPERATOR","->",1544],["T_STRING","getIncrementId",1544],"(",")",",",["T_WHITESPACE","\n                ",1544],["T_CONSTANT_ENCAPSED_STRING","'edit_increment'",1545],["T_WHITESPACE","            ",1545],["T_DOUBLE_ARROW","=>",1545],["T_WHITESPACE"," ",1545],["T_VARIABLE","$oldOrder",1545],["T_OBJECT_OPERATOR","->",1545],["T_STRING","getEditIncrement",1545],"(",")","+",["T_LNUMBER","1",1545],",",["T_WHITESPACE","\n                ",1545],["T_CONSTANT_ENCAPSED_STRING","'increment_id'",1546],["T_WHITESPACE","              ",1546],["T_DOUBLE_ARROW","=>",1546],["T_WHITESPACE"," ",1546],["T_VARIABLE","$originalId",1546],".",["T_CONSTANT_ENCAPSED_STRING","'-'",1546],".","(",["T_VARIABLE","$oldOrder",1546],["T_OBJECT_OPERATOR","->",1546],["T_STRING","getEditIncrement",1546],"(",")","+",["T_LNUMBER","1",1546],")",["T_WHITESPACE","\n            ",1546],")",";",["T_WHITESPACE","\n            ",1547],["T_VARIABLE","$quote",1548],["T_OBJECT_OPERATOR","->",1548],["T_STRING","setReservedOrderId",1548],"(",["T_VARIABLE","$orderData",1548],"[",["T_CONSTANT_ENCAPSED_STRING","'increment_id'",1548],"]",")",";",["T_WHITESPACE","\n            ",1548],["T_VARIABLE","$service",1549],["T_OBJECT_OPERATOR","->",1549],["T_STRING","setOrderData",1549],"(",["T_VARIABLE","$orderData",1549],")",";",["T_WHITESPACE","\n\n            ",1549],["T_VARIABLE","$oldOrder",1551],["T_OBJECT_OPERATOR","->",1551],["T_STRING","cancel",1551],"(",")",";",["T_WHITESPACE","\n        ",1551],"}",["T_WHITESPACE","\n\n        ",1552],["T_DOC_COMMENT","\/** @var Mage_Sales_Model_Order $order *\/",1554],["T_WHITESPACE","\n        ",1554],["T_VARIABLE","$order",1555],["T_WHITESPACE"," ",1555],"=",["T_WHITESPACE"," ",1555],["T_VARIABLE","$service",1555],["T_OBJECT_OPERATOR","->",1555],["T_STRING","submit",1555],"(",")",";",["T_WHITESPACE","\n        ",1555],["T_VARIABLE","$customer",1556],["T_WHITESPACE"," ",1556],"=",["T_WHITESPACE"," ",1556],["T_VARIABLE","$quote",1556],["T_OBJECT_OPERATOR","->",1556],["T_STRING","getCustomer",1556],"(",")",";",["T_WHITESPACE","\n        ",1556],["T_IF","if",1557],["T_WHITESPACE"," ",1557],"(","(","!",["T_VARIABLE","$customer",1557],["T_OBJECT_OPERATOR","->",1557],["T_STRING","getId",1557],"(",")",["T_WHITESPACE"," ",1557],["T_BOOLEAN_OR","||",1557],["T_WHITESPACE"," ",1557],"!",["T_VARIABLE","$customer",1557],["T_OBJECT_OPERATOR","->",1557],["T_STRING","isInStore",1557],"(",["T_VARIABLE","$this",1557],["T_OBJECT_OPERATOR","->",1557],["T_STRING","getSession",1557],"(",")",["T_OBJECT_OPERATOR","->",1557],["T_STRING","getStore",1557],"(",")",")",")",["T_WHITESPACE","\n            ",1557],["T_BOOLEAN_AND","&&",1558],["T_WHITESPACE"," ",1558],"!",["T_VARIABLE","$quote",1558],["T_OBJECT_OPERATOR","->",1558],["T_STRING","getCustomerIsGuest",1558],"(",")",["T_WHITESPACE","\n        ",1558],")",["T_WHITESPACE"," ",1559],"{",["T_WHITESPACE","\n            ",1559],["T_VARIABLE","$customer",1560],["T_OBJECT_OPERATOR","->",1560],["T_STRING","setCreatedAt",1560],"(",["T_VARIABLE","$order",1560],["T_OBJECT_OPERATOR","->",1560],["T_STRING","getCreatedAt",1560],"(",")",")",";",["T_WHITESPACE","\n            ",1560],["T_VARIABLE","$customer",1561],["T_WHITESPACE","\n                ",1561],["T_OBJECT_OPERATOR","->",1562],["T_STRING","save",1562],"(",")",["T_WHITESPACE","\n                ",1562],["T_OBJECT_OPERATOR","->",1563],["T_STRING","sendNewAccountEmail",1563],"(",["T_CONSTANT_ENCAPSED_STRING","'registered'",1563],",",["T_WHITESPACE"," ",1563],["T_CONSTANT_ENCAPSED_STRING","''",1563],",",["T_WHITESPACE"," ",1563],["T_VARIABLE","$quote",1563],["T_OBJECT_OPERATOR","->",1563],["T_STRING","getStoreId",1563],"(",")",")",";",";",["T_WHITESPACE","\n        ",1563],"}",["T_WHITESPACE","\n        ",1564],["T_IF","if",1565],["T_WHITESPACE"," ",1565],"(",["T_VARIABLE","$oldOrder",1565],["T_OBJECT_OPERATOR","->",1565],["T_STRING","getId",1565],"(",")",")",["T_WHITESPACE"," ",1565],"{",["T_WHITESPACE","\n            ",1565],["T_VARIABLE","$oldOrder",1566],["T_OBJECT_OPERATOR","->",1566],["T_STRING","setRelationChildId",1566],"(",["T_VARIABLE","$order",1566],["T_OBJECT_OPERATOR","->",1566],["T_STRING","getId",1566],"(",")",")",";",["T_WHITESPACE","\n            ",1566],["T_VARIABLE","$oldOrder",1567],["T_OBJECT_OPERATOR","->",1567],["T_STRING","setRelationChildRealId",1567],"(",["T_VARIABLE","$order",1567],["T_OBJECT_OPERATOR","->",1567],["T_STRING","getIncrementId",1567],"(",")",")",";",["T_WHITESPACE","\n            ",1567],["T_VARIABLE","$oldOrder",1568],["T_OBJECT_OPERATOR","->",1568],["T_STRING","save",1568],"(",")",";",["T_WHITESPACE","\n            ",1568],["T_VARIABLE","$order",1569],["T_OBJECT_OPERATOR","->",1569],["T_STRING","save",1569],"(",")",";",["T_WHITESPACE","\n        ",1569],"}",["T_WHITESPACE","\n        ",1570],["T_IF","if",1571],["T_WHITESPACE"," ",1571],"(",["T_VARIABLE","$this",1571],["T_OBJECT_OPERATOR","->",1571],["T_STRING","getSendConfirmation",1571],"(",")",")",["T_WHITESPACE"," ",1571],"{",["T_WHITESPACE","\n            ",1571],["T_VARIABLE","$order",1572],["T_OBJECT_OPERATOR","->",1572],["T_STRING","queueNewOrderEmail",1572],"(",")",";",["T_WHITESPACE","\n        ",1572],"}",["T_WHITESPACE","\n\n        ",1573],["T_STRING","Mage",1575],["T_DOUBLE_COLON","::",1575],["T_STRING","dispatchEvent",1575],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_submit_all_after'",1575],",",["T_WHITESPACE"," ",1575],["T_ARRAY","array",1575],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",1575],["T_WHITESPACE"," ",1575],["T_DOUBLE_ARROW","=>",1575],["T_WHITESPACE"," ",1575],["T_VARIABLE","$order",1575],",",["T_WHITESPACE"," ",1575],["T_CONSTANT_ENCAPSED_STRING","'quote'",1575],["T_WHITESPACE"," ",1575],["T_DOUBLE_ARROW","=>",1575],["T_WHITESPACE"," ",1575],["T_VARIABLE","$quote",1575],")",")",";",["T_WHITESPACE","\n\n        ",1575],["T_RETURN","return",1577],["T_WHITESPACE"," ",1577],["T_VARIABLE","$order",1577],";",["T_WHITESPACE","\n    ",1577],"}",["T_WHITESPACE","\n\n    ",1578],["T_DOC_COMMENT","\/**\n     * Validate quote data before order creation\n     *\n     * @return Mage_Adminhtml_Model_Sales_Order_Create\n     *\/",1580],["T_WHITESPACE","\n    ",1584],["T_PROTECTED","protected",1585],["T_WHITESPACE"," ",1585],["T_FUNCTION","function",1585],["T_WHITESPACE"," ",1585],["T_STRING","_validate",1585],"(",")",["T_WHITESPACE","\n    ",1585],"{",["T_WHITESPACE","\n        ",1586],["T_VARIABLE","$customerId",1587],["T_WHITESPACE"," ",1587],"=",["T_WHITESPACE"," ",1587],["T_VARIABLE","$this",1587],["T_OBJECT_OPERATOR","->",1587],["T_STRING","getSession",1587],"(",")",["T_OBJECT_OPERATOR","->",1587],["T_STRING","getCustomerId",1587],"(",")",";",["T_WHITESPACE","\n        ",1587],["T_IF","if",1588],["T_WHITESPACE"," ",1588],"(",["T_STRING","is_null",1588],"(",["T_VARIABLE","$customerId",1588],")",")",["T_WHITESPACE"," ",1588],"{",["T_WHITESPACE","\n            ",1588],["T_STRING","Mage",1589],["T_DOUBLE_COLON","::",1589],["T_STRING","throwException",1589],"(",["T_STRING","Mage",1589],["T_DOUBLE_COLON","::",1589],["T_STRING","helper",1589],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1589],")",["T_OBJECT_OPERATOR","->",1589],["T_STRING","__",1589],"(",["T_CONSTANT_ENCAPSED_STRING","'Please select a customer.'",1589],")",")",";",["T_WHITESPACE","\n        ",1589],"}",["T_WHITESPACE","\n\n        ",1590],["T_IF","if",1592],["T_WHITESPACE"," ",1592],"(","!",["T_VARIABLE","$this",1592],["T_OBJECT_OPERATOR","->",1592],["T_STRING","getSession",1592],"(",")",["T_OBJECT_OPERATOR","->",1592],["T_STRING","getStore",1592],"(",")",["T_OBJECT_OPERATOR","->",1592],["T_STRING","getId",1592],"(",")",")",["T_WHITESPACE"," ",1592],"{",["T_WHITESPACE","\n            ",1592],["T_STRING","Mage",1593],["T_DOUBLE_COLON","::",1593],["T_STRING","throwException",1593],"(",["T_STRING","Mage",1593],["T_DOUBLE_COLON","::",1593],["T_STRING","helper",1593],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1593],")",["T_OBJECT_OPERATOR","->",1593],["T_STRING","__",1593],"(",["T_CONSTANT_ENCAPSED_STRING","'Please select a store.'",1593],")",")",";",["T_WHITESPACE","\n        ",1593],"}",["T_WHITESPACE","\n        ",1594],["T_VARIABLE","$items",1595],["T_WHITESPACE"," ",1595],"=",["T_WHITESPACE"," ",1595],["T_VARIABLE","$this",1595],["T_OBJECT_OPERATOR","->",1595],["T_STRING","getQuote",1595],"(",")",["T_OBJECT_OPERATOR","->",1595],["T_STRING","getAllItems",1595],"(",")",";",["T_WHITESPACE","\n\n        ",1595],["T_IF","if",1597],["T_WHITESPACE"," ",1597],"(",["T_STRING","count",1597],"(",["T_VARIABLE","$items",1597],")",["T_WHITESPACE"," ",1597],["T_IS_EQUAL","==",1597],["T_WHITESPACE"," ",1597],["T_LNUMBER","0",1597],")",["T_WHITESPACE"," ",1597],"{",["T_WHITESPACE","\n            ",1597],["T_VARIABLE","$this",1598],["T_OBJECT_OPERATOR","->",1598],["T_STRING","_errors",1598],"[","]",["T_WHITESPACE"," ",1598],"=",["T_WHITESPACE"," ",1598],["T_STRING","Mage",1598],["T_DOUBLE_COLON","::",1598],["T_STRING","helper",1598],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1598],")",["T_OBJECT_OPERATOR","->",1598],["T_STRING","__",1598],"(",["T_CONSTANT_ENCAPSED_STRING","'You need to specify order items.'",1598],")",";",["T_WHITESPACE","\n        ",1598],"}",["T_WHITESPACE","\n\n        ",1599],["T_FOREACH","foreach",1601],["T_WHITESPACE"," ",1601],"(",["T_VARIABLE","$items",1601],["T_WHITESPACE"," ",1601],["T_AS","as",1601],["T_WHITESPACE"," ",1601],["T_VARIABLE","$item",1601],")",["T_WHITESPACE"," ",1601],"{",["T_WHITESPACE","\n            ",1601],["T_VARIABLE","$messages",1602],["T_WHITESPACE"," ",1602],"=",["T_WHITESPACE"," ",1602],["T_VARIABLE","$item",1602],["T_OBJECT_OPERATOR","->",1602],["T_STRING","getMessage",1602],"(",["T_STRING","false",1602],")",";",["T_WHITESPACE","\n            ",1602],["T_IF","if",1603],["T_WHITESPACE"," ",1603],"(",["T_VARIABLE","$item",1603],["T_OBJECT_OPERATOR","->",1603],["T_STRING","getHasError",1603],"(",")",["T_WHITESPACE"," ",1603],["T_BOOLEAN_AND","&&",1603],["T_WHITESPACE"," ",1603],["T_STRING","is_array",1603],"(",["T_VARIABLE","$messages",1603],")",["T_WHITESPACE"," ",1603],["T_BOOLEAN_AND","&&",1603],["T_WHITESPACE"," ",1603],"!",["T_EMPTY","empty",1603],"(",["T_VARIABLE","$messages",1603],")",")",["T_WHITESPACE"," ",1603],"{",["T_WHITESPACE","\n                ",1603],["T_VARIABLE","$this",1604],["T_OBJECT_OPERATOR","->",1604],["T_STRING","_errors",1604],["T_WHITESPACE"," ",1604],"=",["T_WHITESPACE"," ",1604],["T_STRING","array_merge",1604],"(",["T_VARIABLE","$this",1604],["T_OBJECT_OPERATOR","->",1604],["T_STRING","_errors",1604],",",["T_WHITESPACE"," ",1604],["T_VARIABLE","$messages",1604],")",";",["T_WHITESPACE","\n            ",1604],"}",["T_WHITESPACE","\n        ",1605],"}",["T_WHITESPACE","\n\n        ",1606],["T_IF","if",1608],["T_WHITESPACE"," ",1608],"(","!",["T_VARIABLE","$this",1608],["T_OBJECT_OPERATOR","->",1608],["T_STRING","getQuote",1608],"(",")",["T_OBJECT_OPERATOR","->",1608],["T_STRING","isVirtual",1608],"(",")",")",["T_WHITESPACE"," ",1608],"{",["T_WHITESPACE","\n            ",1608],["T_IF","if",1609],["T_WHITESPACE"," ",1609],"(","!",["T_VARIABLE","$this",1609],["T_OBJECT_OPERATOR","->",1609],["T_STRING","getQuote",1609],"(",")",["T_OBJECT_OPERATOR","->",1609],["T_STRING","getShippingAddress",1609],"(",")",["T_OBJECT_OPERATOR","->",1609],["T_STRING","getShippingMethod",1609],"(",")",")",["T_WHITESPACE"," ",1609],"{",["T_WHITESPACE","\n                ",1609],["T_VARIABLE","$this",1610],["T_OBJECT_OPERATOR","->",1610],["T_STRING","_errors",1610],"[","]",["T_WHITESPACE"," ",1610],"=",["T_WHITESPACE"," ",1610],["T_STRING","Mage",1610],["T_DOUBLE_COLON","::",1610],["T_STRING","helper",1610],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1610],")",["T_OBJECT_OPERATOR","->",1610],["T_STRING","__",1610],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping method must be specified.'",1610],")",";",["T_WHITESPACE","\n            ",1610],"}",["T_WHITESPACE","\n        ",1611],"}",["T_WHITESPACE","\n\n        ",1612],["T_IF","if",1614],["T_WHITESPACE"," ",1614],"(","!",["T_VARIABLE","$this",1614],["T_OBJECT_OPERATOR","->",1614],["T_STRING","getQuote",1614],"(",")",["T_OBJECT_OPERATOR","->",1614],["T_STRING","getPayment",1614],"(",")",["T_OBJECT_OPERATOR","->",1614],["T_STRING","getMethod",1614],"(",")",")",["T_WHITESPACE"," ",1614],"{",["T_WHITESPACE","\n            ",1614],["T_VARIABLE","$this",1615],["T_OBJECT_OPERATOR","->",1615],["T_STRING","_errors",1615],"[","]",["T_WHITESPACE"," ",1615],"=",["T_WHITESPACE"," ",1615],["T_STRING","Mage",1615],["T_DOUBLE_COLON","::",1615],["T_STRING","helper",1615],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1615],")",["T_OBJECT_OPERATOR","->",1615],["T_STRING","__",1615],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment method must be specified.'",1615],")",";",["T_WHITESPACE","\n        ",1615],"}",["T_WHITESPACE"," ",1616],["T_ELSE","else",1616],["T_WHITESPACE"," ",1616],"{",["T_WHITESPACE","\n            ",1616],["T_VARIABLE","$method",1617],["T_WHITESPACE"," ",1617],"=",["T_WHITESPACE"," ",1617],["T_VARIABLE","$this",1617],["T_OBJECT_OPERATOR","->",1617],["T_STRING","getQuote",1617],"(",")",["T_OBJECT_OPERATOR","->",1617],["T_STRING","getPayment",1617],"(",")",["T_OBJECT_OPERATOR","->",1617],["T_STRING","getMethodInstance",1617],"(",")",";",["T_WHITESPACE","\n            ",1617],["T_IF","if",1618],["T_WHITESPACE"," ",1618],"(","!",["T_VARIABLE","$method",1618],")",["T_WHITESPACE"," ",1618],"{",["T_WHITESPACE","\n                ",1618],["T_VARIABLE","$this",1619],["T_OBJECT_OPERATOR","->",1619],["T_STRING","_errors",1619],"[","]",["T_WHITESPACE"," ",1619],"=",["T_WHITESPACE"," ",1619],["T_STRING","Mage",1619],["T_DOUBLE_COLON","::",1619],["T_STRING","helper",1619],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1619],")",["T_OBJECT_OPERATOR","->",1619],["T_STRING","__",1619],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment method instance is not available.'",1619],")",";",["T_WHITESPACE","\n            ",1619],"}",["T_WHITESPACE"," ",1620],["T_ELSE","else",1620],["T_WHITESPACE"," ",1620],"{",["T_WHITESPACE","\n                ",1620],["T_IF","if",1621],["T_WHITESPACE"," ",1621],"(","!",["T_VARIABLE","$method",1621],["T_OBJECT_OPERATOR","->",1621],["T_STRING","isAvailable",1621],"(",["T_VARIABLE","$this",1621],["T_OBJECT_OPERATOR","->",1621],["T_STRING","getQuote",1621],"(",")",")",")",["T_WHITESPACE"," ",1621],"{",["T_WHITESPACE","\n                    ",1621],["T_VARIABLE","$this",1622],["T_OBJECT_OPERATOR","->",1622],["T_STRING","_errors",1622],"[","]",["T_WHITESPACE"," ",1622],"=",["T_WHITESPACE"," ",1622],["T_STRING","Mage",1622],["T_DOUBLE_COLON","::",1622],["T_STRING","helper",1622],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",1622],")",["T_OBJECT_OPERATOR","->",1622],["T_STRING","__",1622],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment method is not available.'",1622],")",";",["T_WHITESPACE","\n                ",1622],"}",["T_WHITESPACE"," ",1623],["T_ELSE","else",1623],["T_WHITESPACE"," ",1623],"{",["T_WHITESPACE","\n                    ",1623],["T_TRY","try",1624],["T_WHITESPACE"," ",1624],"{",["T_WHITESPACE","\n                        ",1624],["T_VARIABLE","$method",1625],["T_OBJECT_OPERATOR","->",1625],["T_STRING","validate",1625],"(",")",";",["T_WHITESPACE","\n                    ",1625],"}",["T_WHITESPACE"," ",1626],["T_CATCH","catch",1626],["T_WHITESPACE"," ",1626],"(",["T_STRING","Mage_Core_Exception",1626],["T_WHITESPACE"," ",1626],["T_VARIABLE","$e",1626],")",["T_WHITESPACE"," ",1626],"{",["T_WHITESPACE","\n                        ",1626],["T_VARIABLE","$this",1627],["T_OBJECT_OPERATOR","->",1627],["T_STRING","_errors",1627],"[","]",["T_WHITESPACE"," ",1627],"=",["T_WHITESPACE"," ",1627],["T_VARIABLE","$e",1627],["T_OBJECT_OPERATOR","->",1627],["T_STRING","getMessage",1627],"(",")",";",["T_WHITESPACE","\n                    ",1627],"}",["T_WHITESPACE","\n                ",1628],"}",["T_WHITESPACE","\n            ",1629],"}",["T_WHITESPACE","\n        ",1630],"}",["T_WHITESPACE","\n\n        ",1631],["T_IF","if",1633],["T_WHITESPACE"," ",1633],"(","!",["T_EMPTY","empty",1633],"(",["T_VARIABLE","$this",1633],["T_OBJECT_OPERATOR","->",1633],["T_STRING","_errors",1633],")",")",["T_WHITESPACE"," ",1633],"{",["T_WHITESPACE","\n            ",1633],["T_FOREACH","foreach",1634],["T_WHITESPACE"," ",1634],"(",["T_VARIABLE","$this",1634],["T_OBJECT_OPERATOR","->",1634],["T_STRING","_errors",1634],["T_WHITESPACE"," ",1634],["T_AS","as",1634],["T_WHITESPACE"," ",1634],["T_VARIABLE","$error",1634],")",["T_WHITESPACE"," ",1634],"{",["T_WHITESPACE","\n                ",1634],["T_VARIABLE","$this",1635],["T_OBJECT_OPERATOR","->",1635],["T_STRING","getSession",1635],"(",")",["T_OBJECT_OPERATOR","->",1635],["T_STRING","addError",1635],"(",["T_VARIABLE","$error",1635],")",";",["T_WHITESPACE","\n            ",1635],"}",["T_WHITESPACE","\n            ",1636],["T_STRING","Mage",1637],["T_DOUBLE_COLON","::",1637],["T_STRING","throwException",1637],"(",["T_CONSTANT_ENCAPSED_STRING","''",1637],")",";",["T_WHITESPACE","\n        ",1637],"}",["T_WHITESPACE","\n        ",1638],["T_RETURN","return",1639],["T_WHITESPACE"," ",1639],["T_VARIABLE","$this",1639],";",["T_WHITESPACE","\n    ",1639],"}",["T_WHITESPACE","\n\n    ",1640],["T_DOC_COMMENT","\/**\n     * Retrieve new customer email\n     *\n     * @param   Mage_Customer_Model_Customer $customer\n     * @return  string\n     *\/",1642],["T_WHITESPACE","\n    ",1647],["T_PROTECTED","protected",1648],["T_WHITESPACE"," ",1648],["T_FUNCTION","function",1648],["T_WHITESPACE"," ",1648],["T_STRING","_getNewCustomerEmail",1648],"(",["T_VARIABLE","$customer",1648],")",["T_WHITESPACE","\n    ",1648],"{",["T_WHITESPACE","\n        ",1649],["T_VARIABLE","$email",1650],["T_WHITESPACE"," ",1650],"=",["T_WHITESPACE"," ",1650],["T_VARIABLE","$this",1650],["T_OBJECT_OPERATOR","->",1650],["T_STRING","getData",1650],"(",["T_CONSTANT_ENCAPSED_STRING","'account\/email'",1650],")",";",["T_WHITESPACE","\n        ",1650],["T_IF","if",1651],["T_WHITESPACE"," ",1651],"(",["T_EMPTY","empty",1651],"(",["T_VARIABLE","$email",1651],")",")",["T_WHITESPACE"," ",1651],"{",["T_WHITESPACE","\n            ",1651],["T_VARIABLE","$host",1652],["T_WHITESPACE"," ",1652],"=",["T_WHITESPACE"," ",1652],["T_VARIABLE","$this",1652],["T_OBJECT_OPERATOR","->",1652],["T_STRING","getSession",1652],"(",")",["T_WHITESPACE","\n                ",1652],["T_OBJECT_OPERATOR","->",1653],["T_STRING","getStore",1653],"(",")",["T_WHITESPACE","\n                ",1653],["T_OBJECT_OPERATOR","->",1654],["T_STRING","getConfig",1654],"(",["T_STRING","Mage_Customer_Model_Customer",1654],["T_DOUBLE_COLON","::",1654],["T_STRING","XML_PATH_DEFAULT_EMAIL_DOMAIN",1654],")",";",["T_WHITESPACE","\n            ",1654],["T_VARIABLE","$account",1655],["T_WHITESPACE"," ",1655],"=",["T_WHITESPACE"," ",1655],["T_VARIABLE","$customer",1655],["T_OBJECT_OPERATOR","->",1655],["T_STRING","getIncrementId",1655],"(",")",["T_WHITESPACE"," ",1655],"?",["T_WHITESPACE"," ",1655],["T_VARIABLE","$customer",1655],["T_OBJECT_OPERATOR","->",1655],["T_STRING","getIncrementId",1655],"(",")",["T_WHITESPACE"," ",1655],":",["T_WHITESPACE"," ",1655],["T_STRING","time",1655],"(",")",";",["T_WHITESPACE","\n            ",1655],["T_VARIABLE","$email",1656],["T_WHITESPACE"," ",1656],"=",["T_WHITESPACE"," ",1656],["T_VARIABLE","$account",1656],".",["T_CONSTANT_ENCAPSED_STRING","'@'",1656],".",["T_WHITESPACE"," ",1656],["T_VARIABLE","$host",1656],";",["T_WHITESPACE","\n            ",1656],["T_VARIABLE","$account",1657],["T_WHITESPACE"," ",1657],"=",["T_WHITESPACE"," ",1657],["T_VARIABLE","$this",1657],["T_OBJECT_OPERATOR","->",1657],["T_STRING","getData",1657],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",1657],")",";",["T_WHITESPACE","\n            ",1657],["T_VARIABLE","$account",1658],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",1658],"]",["T_WHITESPACE"," ",1658],"=",["T_WHITESPACE"," ",1658],["T_VARIABLE","$email",1658],";",["T_WHITESPACE","\n            ",1658],["T_VARIABLE","$this",1659],["T_OBJECT_OPERATOR","->",1659],["T_STRING","setData",1659],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",1659],",",["T_WHITESPACE"," ",1659],["T_VARIABLE","$account",1659],")",";",["T_WHITESPACE","\n        ",1659],"}",["T_WHITESPACE","\n        ",1660],["T_RETURN","return",1661],["T_WHITESPACE"," ",1661],["T_VARIABLE","$email",1661],";",["T_WHITESPACE","\n    ",1661],"}",["T_WHITESPACE","\n\n    ",1662],["T_DOC_COMMENT","\/**\n     * Create customer model and assign it to quote\n     * @deprecated after 1.4.0.0.\n     *\/",1664],["T_WHITESPACE","\n    ",1667],["T_PROTECTED","protected",1668],["T_WHITESPACE"," ",1668],["T_FUNCTION","function",1668],["T_WHITESPACE"," ",1668],["T_STRING","_putCustomerIntoQuote",1668],"(",")",["T_WHITESPACE","\n    ",1668],"{",["T_WHITESPACE","\n        ",1669],["T_IF","if",1670],["T_WHITESPACE"," ",1670],"(","!",["T_VARIABLE","$this",1670],["T_OBJECT_OPERATOR","->",1670],["T_STRING","getSession",1670],"(",")",["T_OBJECT_OPERATOR","->",1670],["T_STRING","getCustomer",1670],"(",")",["T_OBJECT_OPERATOR","->",1670],["T_STRING","getId",1670],"(",")",")",["T_WHITESPACE"," ",1670],"{",["T_WHITESPACE","\n            ",1670],["T_DOC_COMMENT","\/** @var Mage_Customer_Model_Customer*\/",1671],["T_WHITESPACE","\n            ",1671],["T_VARIABLE","$customer",1672],["T_WHITESPACE"," ",1672],"=",["T_WHITESPACE"," ",1672],["T_STRING","Mage",1672],["T_DOUBLE_COLON","::",1672],["T_STRING","getModel",1672],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",1672],")",";",["T_WHITESPACE","\n\n            ",1672],["T_VARIABLE","$customer",1674],["T_OBJECT_OPERATOR","->",1674],["T_STRING","addData",1674],"(",["T_VARIABLE","$this",1674],["T_OBJECT_OPERATOR","->",1674],["T_STRING","getBillingAddress",1674],"(",")",["T_OBJECT_OPERATOR","->",1674],["T_STRING","exportCustomerAddress",1674],"(",")",["T_OBJECT_OPERATOR","->",1674],["T_STRING","getData",1674],"(",")",")",["T_WHITESPACE","\n                     ",1674],["T_OBJECT_OPERATOR","->",1675],["T_STRING","addData",1675],"(",["T_VARIABLE","$this",1675],["T_OBJECT_OPERATOR","->",1675],["T_STRING","getData",1675],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",1675],")",")",["T_WHITESPACE","\n                     ",1675],["T_OBJECT_OPERATOR","->",1676],["T_STRING","setPassword",1676],"(",["T_VARIABLE","$customer",1676],["T_OBJECT_OPERATOR","->",1676],["T_STRING","generatePassword",1676],"(",")",")",["T_WHITESPACE","\n                     ",1676],["T_OBJECT_OPERATOR","->",1677],["T_STRING","setWebsiteId",1677],"(",["T_VARIABLE","$this",1677],["T_OBJECT_OPERATOR","->",1677],["T_STRING","getSession",1677],"(",")",["T_OBJECT_OPERATOR","->",1677],["T_STRING","getStore",1677],"(",")",["T_OBJECT_OPERATOR","->",1677],["T_STRING","getWebsiteId",1677],"(",")",")",["T_WHITESPACE","\n                     ",1677],["T_OBJECT_OPERATOR","->",1678],["T_STRING","setStoreId",1678],"(",["T_VARIABLE","$this",1678],["T_OBJECT_OPERATOR","->",1678],["T_STRING","getSession",1678],"(",")",["T_OBJECT_OPERATOR","->",1678],["T_STRING","getStore",1678],"(",")",["T_OBJECT_OPERATOR","->",1678],["T_STRING","getId",1678],"(",")",")",["T_WHITESPACE","\n                     ",1678],["T_OBJECT_OPERATOR","->",1679],["T_STRING","setEmail",1679],"(",["T_VARIABLE","$this",1679],["T_OBJECT_OPERATOR","->",1679],["T_STRING","_getNewCustomerEmail",1679],"(",["T_VARIABLE","$customer",1679],")",")",";",["T_WHITESPACE","\n        ",1679],"}",["T_WHITESPACE"," ",1680],["T_ELSEIF","elseif",1680],["T_WHITESPACE"," ",1680],"(","(",["T_VARIABLE","$customer",1680],["T_WHITESPACE"," ",1680],"=",["T_WHITESPACE"," ",1680],["T_VARIABLE","$this",1680],["T_OBJECT_OPERATOR","->",1680],["T_STRING","getSession",1680],"(",")",["T_OBJECT_OPERATOR","->",1680],["T_STRING","getCustomer",1680],"(",")",")",["T_WHITESPACE","\n                ",1680],["T_BOOLEAN_AND","&&",1681],["T_WHITESPACE"," ",1681],["T_VARIABLE","$customer",1681],["T_OBJECT_OPERATOR","->",1681],["T_STRING","getId",1681],"(",")",["T_WHITESPACE","\n                ",1681],["T_BOOLEAN_AND","&&",1682],["T_WHITESPACE"," ",1682],"!",["T_VARIABLE","$this",1682],["T_OBJECT_OPERATOR","->",1682],["T_STRING","getSession",1682],"(",")",["T_OBJECT_OPERATOR","->",1682],["T_STRING","getCustomer",1682],"(",["T_STRING","true",1682],",",["T_WHITESPACE"," ",1682],["T_STRING","true",1682],")",["T_OBJECT_OPERATOR","->",1682],["T_STRING","getId",1682],"(",")",["T_WHITESPACE","\n        ",1682],")",["T_WHITESPACE"," ",1683],"{",["T_WHITESPACE","\n            ",1683],["T_VARIABLE","$customer",1684],["T_WHITESPACE"," ",1684],"=",["T_WHITESPACE"," ",1684],["T_CLONE","clone",1684],["T_WHITESPACE"," ",1684],["T_VARIABLE","$customer",1684],";",["T_WHITESPACE","\n            ",1684],["T_VARIABLE","$customer",1685],["T_OBJECT_OPERATOR","->",1685],["T_STRING","setStore",1685],"(",["T_VARIABLE","$this",1685],["T_OBJECT_OPERATOR","->",1685],["T_STRING","getSession",1685],"(",")",["T_OBJECT_OPERATOR","->",1685],["T_STRING","getStore",1685],"(",")",")",["T_WHITESPACE","\n                ",1685],["T_OBJECT_OPERATOR","->",1686],["T_STRING","save",1686],"(",")",";",["T_WHITESPACE","\n            ",1686],["T_VARIABLE","$this",1687],["T_OBJECT_OPERATOR","->",1687],["T_STRING","getSession",1687],"(",")",["T_OBJECT_OPERATOR","->",1687],["T_STRING","setCustomer",1687],"(",["T_VARIABLE","$customer",1687],")",";",["T_WHITESPACE","\n            ",1687],["T_VARIABLE","$customer",1688],["T_OBJECT_OPERATOR","->",1688],["T_STRING","addData",1688],"(",["T_VARIABLE","$this",1688],["T_OBJECT_OPERATOR","->",1688],["T_STRING","getData",1688],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",1688],")",")",";",["T_WHITESPACE","\n        ",1688],"}",["T_WHITESPACE"," ",1689],["T_ELSE","else",1689],["T_WHITESPACE"," ",1689],"{",["T_WHITESPACE","\n            ",1689],["T_VARIABLE","$customer",1690],["T_WHITESPACE"," ",1690],"=",["T_WHITESPACE"," ",1690],["T_VARIABLE","$this",1690],["T_OBJECT_OPERATOR","->",1690],["T_STRING","getSession",1690],"(",")",["T_OBJECT_OPERATOR","->",1690],["T_STRING","getCustomer",1690],"(",")",";",["T_WHITESPACE","\n            ",1690],["T_VARIABLE","$customer",1691],["T_OBJECT_OPERATOR","->",1691],["T_STRING","addData",1691],"(",["T_VARIABLE","$this",1691],["T_OBJECT_OPERATOR","->",1691],["T_STRING","getData",1691],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",1691],")",")",";",["T_WHITESPACE","\n        ",1691],"}",["T_WHITESPACE","\n        ",1692],["T_VARIABLE","$this",1693],["T_OBJECT_OPERATOR","->",1693],["T_STRING","getQuote",1693],"(",")",["T_OBJECT_OPERATOR","->",1693],["T_STRING","setCustomer",1693],"(",["T_VARIABLE","$customer",1693],")",";",["T_WHITESPACE","\n        ",1693],["T_VARIABLE","$this",1694],["T_OBJECT_OPERATOR","->",1694],["T_STRING","_customer",1694],["T_WHITESPACE"," ",1694],"=",["T_WHITESPACE"," ",1694],["T_VARIABLE","$customer",1694],";",["T_WHITESPACE","\n    ",1694],"}",["T_WHITESPACE","\n\n    ",1695],["T_DOC_COMMENT","\/**\n     * Save customer\n     *\n     * @deprecated after 1.4.0.0.\n     * @param Mage_Customer_Model_Customer $order\n     *\/",1697],["T_WHITESPACE","\n    ",1702],["T_PROTECTED","protected",1703],["T_WHITESPACE"," ",1703],["T_FUNCTION","function",1703],["T_WHITESPACE"," ",1703],["T_STRING","_saveCustomerAfterOrder",1703],"(",["T_VARIABLE","$order",1703],")",["T_WHITESPACE","\n    ",1703],"{",["T_WHITESPACE","\n        ",1704],["T_IF","if",1705],["T_WHITESPACE"," ",1705],"(",["T_VARIABLE","$this",1705],["T_OBJECT_OPERATOR","->",1705],["T_STRING","_customer",1705],")",["T_WHITESPACE"," ",1705],"{",["T_WHITESPACE","\n            ",1705],["T_IF","if",1706],["T_WHITESPACE"," ",1706],"(","!",["T_WHITESPACE"," ",1706],["T_VARIABLE","$this",1706],["T_OBJECT_OPERATOR","->",1706],["T_STRING","_customer",1706],["T_OBJECT_OPERATOR","->",1706],["T_STRING","getId",1706],"(",")",")",["T_WHITESPACE"," ",1706],"{",["T_WHITESPACE","\n                ",1706],["T_VARIABLE","$billing",1707],["T_WHITESPACE","          ",1707],"=",["T_WHITESPACE"," ",1707],["T_VARIABLE","$this",1707],["T_OBJECT_OPERATOR","->",1707],["T_STRING","getBillingAddress",1707],"(",")",";",["T_WHITESPACE","\n                ",1707],["T_VARIABLE","$customerBilling",1708],["T_WHITESPACE","  ",1708],"=",["T_WHITESPACE"," ",1708],["T_VARIABLE","$billing",1708],["T_OBJECT_OPERATOR","->",1708],["T_STRING","exportCustomerAddress",1708],"(",")",";",["T_WHITESPACE","\n                ",1708],["T_VARIABLE","$shipping",1709],["T_WHITESPACE","         ",1709],"=",["T_WHITESPACE"," ",1709],["T_VARIABLE","$this",1709],["T_OBJECT_OPERATOR","->",1709],["T_STRING","getShippingAddress",1709],"(",")",";",["T_WHITESPACE","\n                ",1709],["T_VARIABLE","$customerShipping",1710],["T_WHITESPACE"," ",1710],"=",["T_WHITESPACE"," ",1710],["T_VARIABLE","$shipping",1710],["T_OBJECT_OPERATOR","->",1710],["T_STRING","exportCustomerAddress",1710],"(",")",";",["T_WHITESPACE","\n\n                ",1710],["T_VARIABLE","$this",1712],["T_OBJECT_OPERATOR","->",1712],["T_STRING","_customer",1712],["T_OBJECT_OPERATOR","->",1712],["T_STRING","addAddress",1712],"(",["T_VARIABLE","$customerBilling",1712],")",";",["T_WHITESPACE","\n\n                ",1712],["T_IF","if",1714],["T_WHITESPACE"," ",1714],"(","!",["T_WHITESPACE"," ",1714],["T_VARIABLE","$shipping",1714],["T_OBJECT_OPERATOR","->",1714],["T_STRING","getSameAsBilling",1714],"(",")",")",["T_WHITESPACE"," ",1714],"{",["T_WHITESPACE","\n                    ",1714],["T_VARIABLE","$this",1715],["T_OBJECT_OPERATOR","->",1715],["T_STRING","_customer",1715],["T_OBJECT_OPERATOR","->",1715],["T_STRING","addAddress",1715],"(",["T_VARIABLE","$customerShipping",1715],")",";",["T_WHITESPACE","\n                ",1715],"}",["T_WHITESPACE","\n                ",1716],["T_COMMENT","\/\/ preliminary save to find addresses id\n",1717],["T_WHITESPACE","                ",1718],["T_VARIABLE","$this",1718],["T_OBJECT_OPERATOR","->",1718],["T_STRING","_customer",1718],["T_OBJECT_OPERATOR","->",1718],["T_STRING","save",1718],"(",")",";",["T_WHITESPACE","\n                ",1718],["T_COMMENT","\/\/ setting default addresses id\n",1719],["T_WHITESPACE","                ",1720],["T_VARIABLE","$defShipping",1720],["T_WHITESPACE"," ",1720],"=",["T_WHITESPACE"," ",1720],["T_VARIABLE","$shipping",1720],["T_OBJECT_OPERATOR","->",1720],["T_STRING","getSameAsBilling",1720],"(",")",["T_WHITESPACE"," ",1720],"?",["T_WHITESPACE"," ",1720],["T_VARIABLE","$customerBilling",1720],["T_OBJECT_OPERATOR","->",1720],["T_STRING","getId",1720],"(",")",["T_WHITESPACE"," ",1720],":",["T_WHITESPACE"," ",1720],["T_VARIABLE","$customerShipping",1720],["T_OBJECT_OPERATOR","->",1720],["T_STRING","getId",1720],"(",")",";",["T_WHITESPACE","\n                ",1720],["T_VARIABLE","$this",1721],["T_OBJECT_OPERATOR","->",1721],["T_STRING","_customer",1721],["T_WHITESPACE","\n                    ",1721],["T_OBJECT_OPERATOR","->",1722],["T_STRING","setDefaultBilling",1722],"(",["T_VARIABLE","$customerBilling",1722],["T_OBJECT_OPERATOR","->",1722],["T_STRING","getId",1722],"(",")",")",["T_WHITESPACE","\n                    ",1722],["T_OBJECT_OPERATOR","->",1723],["T_STRING","setDefaultShipping",1723],"(",["T_VARIABLE","$defShipping",1723],")",["T_WHITESPACE","\n                    ",1723],["T_OBJECT_OPERATOR","->",1724],["T_STRING","save",1724],"(",")",";",["T_WHITESPACE","\n\n                ",1724],["T_VARIABLE","$order",1726],["T_OBJECT_OPERATOR","->",1726],["T_STRING","setCustomerId",1726],"(",["T_VARIABLE","$this",1726],["T_OBJECT_OPERATOR","->",1726],["T_STRING","_customer",1726],["T_OBJECT_OPERATOR","->",1726],["T_STRING","getId",1726],"(",")",")",";",["T_WHITESPACE","\n                ",1726],["T_VARIABLE","$billing",1727],["T_OBJECT_OPERATOR","->",1727],["T_STRING","setCustomerId",1727],"(",["T_VARIABLE","$this",1727],["T_OBJECT_OPERATOR","->",1727],["T_STRING","_customer",1727],["T_OBJECT_OPERATOR","->",1727],["T_STRING","getId",1727],"(",")",")",";",["T_WHITESPACE","\n                ",1727],["T_VARIABLE","$shipping",1728],["T_OBJECT_OPERATOR","->",1728],["T_STRING","setCustomerId",1728],"(",["T_VARIABLE","$this",1728],["T_OBJECT_OPERATOR","->",1728],["T_STRING","_customer",1728],["T_OBJECT_OPERATOR","->",1728],["T_STRING","getId",1728],"(",")",")",";",["T_WHITESPACE","\n                ",1728],["T_VARIABLE","$this",1729],["T_OBJECT_OPERATOR","->",1729],["T_STRING","_customer",1729],["T_OBJECT_OPERATOR","->",1729],["T_STRING","sendNewAccountEmail",1729],"(",["T_CONSTANT_ENCAPSED_STRING","'registered'",1729],",",["T_WHITESPACE"," ",1729],["T_CONSTANT_ENCAPSED_STRING","''",1729],",",["T_WHITESPACE"," ",1729],["T_VARIABLE","$order",1729],["T_OBJECT_OPERATOR","->",1729],["T_STRING","getStoreId",1729],"(",")",")",";",["T_WHITESPACE","\n            ",1729],"}",["T_WHITESPACE"," ",1730],["T_ELSE","else",1730],["T_WHITESPACE"," ",1730],"{",["T_WHITESPACE","\n                ",1730],["T_VARIABLE","$saveCusstomerAddress",1731],["T_WHITESPACE"," ",1731],"=",["T_WHITESPACE"," ",1731],["T_STRING","false",1731],";",["T_WHITESPACE","\n\n                ",1731],["T_IF","if",1733],["T_WHITESPACE"," ",1733],"(",["T_VARIABLE","$this",1733],["T_OBJECT_OPERATOR","->",1733],["T_STRING","getBillingAddress",1733],"(",")",["T_OBJECT_OPERATOR","->",1733],["T_STRING","getSaveInAddressBook",1733],"(",")",")",["T_WHITESPACE"," ",1733],"{",["T_WHITESPACE","\n                    ",1733],["T_VARIABLE","$billingAddress",1734],["T_WHITESPACE"," ",1734],"=",["T_WHITESPACE"," ",1734],["T_VARIABLE","$this",1734],["T_OBJECT_OPERATOR","->",1734],["T_STRING","getBillingAddress",1734],"(",")",["T_OBJECT_OPERATOR","->",1734],["T_STRING","exportCustomerAddress",1734],"(",")",";",["T_WHITESPACE","\n                    ",1734],["T_IF","if",1735],["T_WHITESPACE"," ",1735],"(",["T_VARIABLE","$this",1735],["T_OBJECT_OPERATOR","->",1735],["T_STRING","getBillingAddress",1735],"(",")",["T_OBJECT_OPERATOR","->",1735],["T_STRING","getCustomerAddressId",1735],"(",")",")",["T_WHITESPACE"," ",1735],"{",["T_WHITESPACE","\n                        ",1735],["T_VARIABLE","$billingAddress",1736],["T_OBJECT_OPERATOR","->",1736],["T_STRING","setId",1736],"(",["T_VARIABLE","$this",1736],["T_OBJECT_OPERATOR","->",1736],["T_STRING","getBillingAddress",1736],"(",")",["T_OBJECT_OPERATOR","->",1736],["T_STRING","getCustomerAddressId",1736],"(",")",")",";",["T_WHITESPACE","\n                    ",1736],"}",["T_WHITESPACE","\n                    ",1737],["T_VARIABLE","$this",1738],["T_OBJECT_OPERATOR","->",1738],["T_STRING","_customer",1738],["T_OBJECT_OPERATOR","->",1738],["T_STRING","addAddress",1738],"(",["T_VARIABLE","$billingAddress",1738],")",";",["T_WHITESPACE","\n                    ",1738],["T_VARIABLE","$saveCusstomerAddress",1739],["T_WHITESPACE"," ",1739],"=",["T_WHITESPACE"," ",1739],["T_STRING","true",1739],";",["T_WHITESPACE","\n                ",1739],"}",["T_WHITESPACE","\n                ",1740],["T_IF","if",1741],["T_WHITESPACE"," ",1741],"(",["T_VARIABLE","$this",1741],["T_OBJECT_OPERATOR","->",1741],["T_STRING","getShippingAddress",1741],"(",")",["T_OBJECT_OPERATOR","->",1741],["T_STRING","getSaveInAddressBook",1741],"(",")",")",["T_WHITESPACE"," ",1741],"{",["T_WHITESPACE","\n                    ",1741],["T_VARIABLE","$shippingAddress",1742],["T_WHITESPACE"," ",1742],"=",["T_WHITESPACE"," ",1742],["T_VARIABLE","$this",1742],["T_OBJECT_OPERATOR","->",1742],["T_STRING","getShippingAddress",1742],"(",")",["T_OBJECT_OPERATOR","->",1742],["T_STRING","exportCustomerAddress",1742],"(",")",";",["T_WHITESPACE","\n                    ",1742],["T_IF","if",1743],["T_WHITESPACE"," ",1743],"(",["T_VARIABLE","$this",1743],["T_OBJECT_OPERATOR","->",1743],["T_STRING","getShippingAddress",1743],"(",")",["T_OBJECT_OPERATOR","->",1743],["T_STRING","getCustomerAddressId",1743],"(",")",")",["T_WHITESPACE"," ",1743],"{",["T_WHITESPACE","\n                        ",1743],["T_VARIABLE","$shippingAddress",1744],["T_OBJECT_OPERATOR","->",1744],["T_STRING","setId",1744],"(",["T_VARIABLE","$this",1744],["T_OBJECT_OPERATOR","->",1744],["T_STRING","getShippingAddress",1744],"(",")",["T_OBJECT_OPERATOR","->",1744],["T_STRING","getCustomerAddressId",1744],"(",")",")",";",["T_WHITESPACE","\n                    ",1744],"}",["T_WHITESPACE","\n                    ",1745],["T_VARIABLE","$this",1746],["T_OBJECT_OPERATOR","->",1746],["T_STRING","_customer",1746],["T_OBJECT_OPERATOR","->",1746],["T_STRING","addAddress",1746],"(",["T_VARIABLE","$shippingAddress",1746],")",";",["T_WHITESPACE","\n                    ",1746],["T_VARIABLE","$saveCusstomerAddress",1747],["T_WHITESPACE"," ",1747],"=",["T_WHITESPACE"," ",1747],["T_STRING","true",1747],";",["T_WHITESPACE","\n                ",1747],"}",["T_WHITESPACE","\n                ",1748],["T_IF","if",1749],["T_WHITESPACE"," ",1749],"(",["T_VARIABLE","$saveCusstomerAddress",1749],")",["T_WHITESPACE"," ",1749],"{",["T_WHITESPACE","\n                    ",1749],["T_VARIABLE","$this",1750],["T_OBJECT_OPERATOR","->",1750],["T_STRING","_customer",1750],["T_OBJECT_OPERATOR","->",1750],["T_STRING","save",1750],"(",")",";",["T_WHITESPACE","\n                ",1750],"}",["T_WHITESPACE","\n            ",1751],"}",["T_WHITESPACE","\n        ",1752],"}",["T_WHITESPACE","\n    ",1753],"}",["T_WHITESPACE","\n\n    ",1754],["T_DOC_COMMENT","\/**\n     * @deprecated after 1.1.7\n     * @return unknown\n     *\/",1756],["T_WHITESPACE","\n    ",1759],["T_PROTECTED","protected",1760],["T_WHITESPACE"," ",1760],["T_FUNCTION","function",1760],["T_WHITESPACE"," ",1760],["T_STRING","_saveCustomer",1760],"(",")",["T_WHITESPACE","\n    ",1760],"{",["T_WHITESPACE","\n        ",1761],["T_IF","if",1762],["T_WHITESPACE"," ",1762],"(","!",["T_VARIABLE","$this",1762],["T_OBJECT_OPERATOR","->",1762],["T_STRING","getSession",1762],"(",")",["T_OBJECT_OPERATOR","->",1762],["T_STRING","getCustomer",1762],"(",")",["T_OBJECT_OPERATOR","->",1762],["T_STRING","getId",1762],"(",")",")",["T_WHITESPACE"," ",1762],"{",["T_WHITESPACE","\n            ",1762],["T_VARIABLE","$customer",1763],["T_WHITESPACE"," ",1763],"=",["T_WHITESPACE"," ",1763],["T_STRING","Mage",1763],["T_DOUBLE_COLON","::",1763],["T_STRING","getModel",1763],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",1763],")",";",["T_WHITESPACE","\n            ",1763],["T_COMMENT","\/* @var $customer Mage_Customer_Model_Customer*\/",1764],["T_WHITESPACE","\n\n            ",1764],["T_VARIABLE","$billingAddress",1766],["T_WHITESPACE"," ",1766],"=",["T_WHITESPACE"," ",1766],["T_VARIABLE","$this",1766],["T_OBJECT_OPERATOR","->",1766],["T_STRING","getBillingAddress",1766],"(",")",["T_OBJECT_OPERATOR","->",1766],["T_STRING","exportCustomerAddress",1766],"(",")",";",["T_WHITESPACE","\n\n            ",1766],["T_VARIABLE","$customer",1768],["T_OBJECT_OPERATOR","->",1768],["T_STRING","addData",1768],"(",["T_VARIABLE","$billingAddress",1768],["T_OBJECT_OPERATOR","->",1768],["T_STRING","getData",1768],"(",")",")",["T_WHITESPACE","\n                ",1768],["T_OBJECT_OPERATOR","->",1769],["T_STRING","addData",1769],"(",["T_VARIABLE","$this",1769],["T_OBJECT_OPERATOR","->",1769],["T_STRING","getData",1769],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",1769],")",")",["T_WHITESPACE","\n                ",1769],["T_OBJECT_OPERATOR","->",1770],["T_STRING","setPassword",1770],"(",["T_VARIABLE","$customer",1770],["T_OBJECT_OPERATOR","->",1770],["T_STRING","generatePassword",1770],"(",")",")",["T_WHITESPACE","\n                ",1770],["T_OBJECT_OPERATOR","->",1771],["T_STRING","setWebsiteId",1771],"(",["T_VARIABLE","$this",1771],["T_OBJECT_OPERATOR","->",1771],["T_STRING","getSession",1771],"(",")",["T_OBJECT_OPERATOR","->",1771],["T_STRING","getStore",1771],"(",")",["T_OBJECT_OPERATOR","->",1771],["T_STRING","getWebsiteId",1771],"(",")",")",["T_WHITESPACE","\n                ",1771],["T_OBJECT_OPERATOR","->",1772],["T_STRING","setStoreId",1772],"(",["T_VARIABLE","$this",1772],["T_OBJECT_OPERATOR","->",1772],["T_STRING","getSession",1772],"(",")",["T_OBJECT_OPERATOR","->",1772],["T_STRING","getStore",1772],"(",")",["T_OBJECT_OPERATOR","->",1772],["T_STRING","getId",1772],"(",")",")",["T_WHITESPACE","\n                ",1772],["T_OBJECT_OPERATOR","->",1773],["T_STRING","addAddress",1773],"(",["T_VARIABLE","$billingAddress",1773],")",";",["T_WHITESPACE","\n\n            ",1773],["T_IF","if",1775],["T_WHITESPACE"," ",1775],"(","!",["T_VARIABLE","$this",1775],["T_OBJECT_OPERATOR","->",1775],["T_STRING","getShippingAddress",1775],"(",")",["T_OBJECT_OPERATOR","->",1775],["T_STRING","getSameAsBilling",1775],"(",")",")",["T_WHITESPACE"," ",1775],"{",["T_WHITESPACE","\n                ",1775],["T_VARIABLE","$shippingAddress",1776],["T_WHITESPACE"," ",1776],"=",["T_WHITESPACE"," ",1776],["T_VARIABLE","$this",1776],["T_OBJECT_OPERATOR","->",1776],["T_STRING","getShippingAddress",1776],"(",")",["T_OBJECT_OPERATOR","->",1776],["T_STRING","exportCustomerAddress",1776],"(",")",";",["T_WHITESPACE","\n                ",1776],["T_VARIABLE","$customer",1777],["T_OBJECT_OPERATOR","->",1777],["T_STRING","addAddress",1777],"(",["T_VARIABLE","$shippingAddress",1777],")",";",["T_WHITESPACE","\n            ",1777],"}",["T_WHITESPACE"," ",1778],["T_ELSE","else",1778],["T_WHITESPACE"," ",1778],"{",["T_WHITESPACE","\n                ",1778],["T_VARIABLE","$shippingAddress",1779],["T_WHITESPACE"," ",1779],"=",["T_WHITESPACE"," ",1779],["T_VARIABLE","$billingAddress",1779],";",["T_WHITESPACE","\n            ",1779],"}",["T_WHITESPACE","\n            ",1780],["T_VARIABLE","$customer",1781],["T_OBJECT_OPERATOR","->",1781],["T_STRING","save",1781],"(",")",";",["T_WHITESPACE","\n\n\n            ",1781],["T_VARIABLE","$customer",1784],["T_OBJECT_OPERATOR","->",1784],["T_STRING","setEmail",1784],"(",["T_VARIABLE","$this",1784],["T_OBJECT_OPERATOR","->",1784],["T_STRING","_getNewCustomerEmail",1784],"(",["T_VARIABLE","$customer",1784],")",")",["T_WHITESPACE","\n                ",1784],["T_OBJECT_OPERATOR","->",1785],["T_STRING","setDefaultBilling",1785],"(",["T_VARIABLE","$billingAddress",1785],["T_OBJECT_OPERATOR","->",1785],["T_STRING","getId",1785],"(",")",")",["T_WHITESPACE","\n                ",1785],["T_OBJECT_OPERATOR","->",1786],["T_STRING","setDefaultShipping",1786],"(",["T_VARIABLE","$shippingAddress",1786],["T_OBJECT_OPERATOR","->",1786],["T_STRING","getId",1786],"(",")",")",["T_WHITESPACE","\n                ",1786],["T_OBJECT_OPERATOR","->",1787],["T_STRING","save",1787],"(",")",";",["T_WHITESPACE","\n\n            ",1787],["T_VARIABLE","$this",1789],["T_OBJECT_OPERATOR","->",1789],["T_STRING","getBillingAddress",1789],"(",")",["T_OBJECT_OPERATOR","->",1789],["T_STRING","setCustomerId",1789],"(",["T_VARIABLE","$customer",1789],["T_OBJECT_OPERATOR","->",1789],["T_STRING","getId",1789],"(",")",")",";",["T_WHITESPACE","\n            ",1789],["T_VARIABLE","$this",1790],["T_OBJECT_OPERATOR","->",1790],["T_STRING","getShippingAddress",1790],"(",")",["T_OBJECT_OPERATOR","->",1790],["T_STRING","setCustomerId",1790],"(",["T_VARIABLE","$customer",1790],["T_OBJECT_OPERATOR","->",1790],["T_STRING","getId",1790],"(",")",")",";",["T_WHITESPACE","\n\n            ",1790],["T_VARIABLE","$customer",1792],["T_OBJECT_OPERATOR","->",1792],["T_STRING","sendNewAccountEmail",1792],"(",["T_CONSTANT_ENCAPSED_STRING","'registered'",1792],",",["T_WHITESPACE"," ",1792],["T_CONSTANT_ENCAPSED_STRING","''",1792],",",["T_WHITESPACE"," ",1792],["T_VARIABLE","$customer",1792],["T_OBJECT_OPERATOR","->",1792],["T_STRING","getStoreId",1792],"(",")",")",";",["T_WHITESPACE","\n        ",1792],"}",["T_WHITESPACE"," ",1793],["T_ELSE","else",1793],["T_WHITESPACE"," ",1793],"{",["T_WHITESPACE","\n            ",1793],["T_VARIABLE","$customer",1794],["T_WHITESPACE"," ",1794],"=",["T_WHITESPACE"," ",1794],["T_VARIABLE","$this",1794],["T_OBJECT_OPERATOR","->",1794],["T_STRING","getSession",1794],"(",")",["T_OBJECT_OPERATOR","->",1794],["T_STRING","getCustomer",1794],"(",")",";",["T_WHITESPACE","\n\n            ",1794],["T_VARIABLE","$saveCusstomerAddress",1796],["T_WHITESPACE"," ",1796],"=",["T_WHITESPACE"," ",1796],["T_STRING","false",1796],";",["T_WHITESPACE","\n\n            ",1796],["T_IF","if",1798],["T_WHITESPACE"," ",1798],"(",["T_VARIABLE","$this",1798],["T_OBJECT_OPERATOR","->",1798],["T_STRING","getBillingAddress",1798],"(",")",["T_OBJECT_OPERATOR","->",1798],["T_STRING","getSaveInAddressBook",1798],"(",")",")",["T_WHITESPACE"," ",1798],"{",["T_WHITESPACE","\n                ",1798],["T_VARIABLE","$billingAddress",1799],["T_WHITESPACE"," ",1799],"=",["T_WHITESPACE"," ",1799],["T_VARIABLE","$this",1799],["T_OBJECT_OPERATOR","->",1799],["T_STRING","getBillingAddress",1799],"(",")",["T_OBJECT_OPERATOR","->",1799],["T_STRING","exportCustomerAddress",1799],"(",")",";",["T_WHITESPACE","\n                ",1799],["T_IF","if",1800],["T_WHITESPACE"," ",1800],"(",["T_VARIABLE","$this",1800],["T_OBJECT_OPERATOR","->",1800],["T_STRING","getBillingAddress",1800],"(",")",["T_OBJECT_OPERATOR","->",1800],["T_STRING","getCustomerAddressId",1800],"(",")",")",["T_WHITESPACE"," ",1800],"{",["T_WHITESPACE","\n                    ",1800],["T_VARIABLE","$billingAddress",1801],["T_OBJECT_OPERATOR","->",1801],["T_STRING","setId",1801],"(",["T_VARIABLE","$this",1801],["T_OBJECT_OPERATOR","->",1801],["T_STRING","getBillingAddress",1801],"(",")",["T_OBJECT_OPERATOR","->",1801],["T_STRING","getCustomerAddressId",1801],"(",")",")",";",["T_WHITESPACE","\n                ",1801],"}",["T_WHITESPACE","\n                ",1802],["T_VARIABLE","$customer",1803],["T_OBJECT_OPERATOR","->",1803],["T_STRING","addAddress",1803],"(",["T_VARIABLE","$billingAddress",1803],")",";",["T_WHITESPACE","\n                ",1803],["T_VARIABLE","$saveCusstomerAddress",1804],["T_WHITESPACE"," ",1804],"=",["T_WHITESPACE"," ",1804],["T_STRING","true",1804],";",["T_WHITESPACE","\n            ",1804],"}",["T_WHITESPACE","\n            ",1805],["T_IF","if",1806],["T_WHITESPACE"," ",1806],"(",["T_VARIABLE","$this",1806],["T_OBJECT_OPERATOR","->",1806],["T_STRING","getShippingAddress",1806],"(",")",["T_OBJECT_OPERATOR","->",1806],["T_STRING","getSaveInAddressBook",1806],"(",")",")",["T_WHITESPACE"," ",1806],"{",["T_WHITESPACE","\n                ",1806],["T_VARIABLE","$shippingAddress",1807],["T_WHITESPACE"," ",1807],"=",["T_WHITESPACE"," ",1807],["T_VARIABLE","$this",1807],["T_OBJECT_OPERATOR","->",1807],["T_STRING","getShippingAddress",1807],"(",")",["T_OBJECT_OPERATOR","->",1807],["T_STRING","exportCustomerAddress",1807],"(",")",";",["T_WHITESPACE","\n                ",1807],["T_IF","if",1808],["T_WHITESPACE"," ",1808],"(",["T_VARIABLE","$this",1808],["T_OBJECT_OPERATOR","->",1808],["T_STRING","getShippingAddress",1808],"(",")",["T_OBJECT_OPERATOR","->",1808],["T_STRING","getCustomerAddressId",1808],"(",")",")",["T_WHITESPACE"," ",1808],"{",["T_WHITESPACE","\n                    ",1808],["T_VARIABLE","$shippingAddress",1809],["T_OBJECT_OPERATOR","->",1809],["T_STRING","setId",1809],"(",["T_VARIABLE","$this",1809],["T_OBJECT_OPERATOR","->",1809],["T_STRING","getShippingAddress",1809],"(",")",["T_OBJECT_OPERATOR","->",1809],["T_STRING","getCustomerAddressId",1809],"(",")",")",";",["T_WHITESPACE","\n                ",1809],"}",["T_WHITESPACE","\n                ",1810],["T_VARIABLE","$customer",1811],["T_OBJECT_OPERATOR","->",1811],["T_STRING","addAddress",1811],"(",["T_VARIABLE","$shippingAddress",1811],")",";",["T_WHITESPACE","\n                ",1811],["T_VARIABLE","$saveCusstomerAddress",1812],["T_WHITESPACE"," ",1812],"=",["T_WHITESPACE"," ",1812],["T_STRING","true",1812],";",["T_WHITESPACE","\n            ",1812],"}",["T_WHITESPACE","\n            ",1813],["T_IF","if",1814],["T_WHITESPACE"," ",1814],"(",["T_VARIABLE","$saveCusstomerAddress",1814],")",["T_WHITESPACE"," ",1814],"{",["T_WHITESPACE","\n                ",1814],["T_VARIABLE","$customer",1815],["T_OBJECT_OPERATOR","->",1815],["T_STRING","save",1815],"(",")",";",["T_WHITESPACE","\n            ",1815],"}",["T_WHITESPACE","\n\n            ",1816],["T_VARIABLE","$customer",1818],["T_OBJECT_OPERATOR","->",1818],["T_STRING","addData",1818],"(",["T_VARIABLE","$this",1818],["T_OBJECT_OPERATOR","->",1818],["T_STRING","getData",1818],"(",["T_CONSTANT_ENCAPSED_STRING","'account'",1818],")",")",";",["T_WHITESPACE","\n            ",1818],["T_DOC_COMMENT","\/**\n             * don't save account information, use it only for order creation\n             *\/",1819],["T_WHITESPACE","\n            ",1821],["T_COMMENT","\/\/$customer->save();\n",1822],["T_WHITESPACE","        ",1823],"}",["T_WHITESPACE","\n        ",1823],["T_VARIABLE","$this",1824],["T_OBJECT_OPERATOR","->",1824],["T_STRING","getQuote",1824],"(",")",["T_OBJECT_OPERATOR","->",1824],["T_STRING","setCustomer",1824],"(",["T_VARIABLE","$customer",1824],")",";",["T_WHITESPACE","\n        ",1824],["T_RETURN","return",1825],["T_WHITESPACE"," ",1825],["T_VARIABLE","$this",1825],";",["T_WHITESPACE","\n    ",1825],"}",["T_WHITESPACE","\n",1826],"}",["T_WHITESPACE","\n",1827]]