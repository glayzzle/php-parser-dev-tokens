[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Adminhtml\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Backup admin controller\n *\n * @category   Mage\n * @package    Mage_Adminhtml\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_System_BackupController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Adminhtml_Controller_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Backup list action\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_PUBLIC","public",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","indexAction",39],"(",")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","_title",41],"(",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","__",41],"(",["T_CONSTANT_ENCAPSED_STRING","'System'",41],")",")",["T_OBJECT_OPERATOR","->",41],["T_STRING","_title",41],"(",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","__",41],"(",["T_CONSTANT_ENCAPSED_STRING","'Tools'",41],")",")",["T_OBJECT_OPERATOR","->",41],["T_STRING","_title",41],"(",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","__",41],"(",["T_CONSTANT_ENCAPSED_STRING","'Backups'",41],")",")",";",["T_WHITESPACE","\n\n        ",41],["T_IF","if",43],"(",["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getRequest",43],"(",")",["T_OBJECT_OPERATOR","->",43],["T_STRING","getParam",43],"(",["T_CONSTANT_ENCAPSED_STRING","'ajax'",43],")",")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n            ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","_forward",44],"(",["T_CONSTANT_ENCAPSED_STRING","'grid'",44],")",";",["T_WHITESPACE","\n            ",44],["T_RETURN","return",45],";",["T_WHITESPACE","\n        ",45],"}",["T_WHITESPACE","\n\n        ",46],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","loadLayout",48],"(",")",";",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_setActiveMenu",49],"(",["T_CONSTANT_ENCAPSED_STRING","'system'",49],")",";",["T_WHITESPACE","\n        ",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","_addBreadcrumb",50],"(",["T_STRING","Mage",50],["T_DOUBLE_COLON","::",50],["T_STRING","helper",50],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",50],")",["T_OBJECT_OPERATOR","->",50],["T_STRING","__",50],"(",["T_CONSTANT_ENCAPSED_STRING","'System'",50],")",",",["T_WHITESPACE"," ",50],["T_STRING","Mage",50],["T_DOUBLE_COLON","::",50],["T_STRING","helper",50],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",50],")",["T_OBJECT_OPERATOR","->",50],["T_STRING","__",50],"(",["T_CONSTANT_ENCAPSED_STRING","'System'",50],")",")",";",["T_WHITESPACE","\n        ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_addBreadcrumb",51],"(",["T_STRING","Mage",51],["T_DOUBLE_COLON","::",51],["T_STRING","helper",51],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",51],")",["T_OBJECT_OPERATOR","->",51],["T_STRING","__",51],"(",["T_CONSTANT_ENCAPSED_STRING","'Tools'",51],")",",",["T_WHITESPACE"," ",51],["T_STRING","Mage",51],["T_DOUBLE_COLON","::",51],["T_STRING","helper",51],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",51],")",["T_OBJECT_OPERATOR","->",51],["T_STRING","__",51],"(",["T_CONSTANT_ENCAPSED_STRING","'Tools'",51],")",")",";",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_addBreadcrumb",52],"(",["T_STRING","Mage",52],["T_DOUBLE_COLON","::",52],["T_STRING","helper",52],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",52],")",["T_OBJECT_OPERATOR","->",52],["T_STRING","__",52],"(",["T_CONSTANT_ENCAPSED_STRING","'Backups'",52],")",",",["T_WHITESPACE"," ",52],["T_STRING","Mage",52],["T_DOUBLE_COLON","::",52],["T_STRING","helper",52],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",52],")",["T_OBJECT_OPERATOR","->",52],["T_STRING","__",52],"(",["T_CONSTANT_ENCAPSED_STRING","'Backup'",52],")",")",";",["T_WHITESPACE","\n\n        ",52],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_addContent",54],"(",["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getLayout",54],"(",")",["T_OBJECT_OPERATOR","->",54],["T_STRING","createBlock",54],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/backup'",54],",",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'backup'",54],")",")",";",["T_WHITESPACE","\n\n        ",54],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","renderLayout",56],"(",")",";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Backup list action\n     *\/",59],["T_WHITESPACE","\n    ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","gridAction",62],"(",")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getResponse",64],"(",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","setBody",64],"(",["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getLayout",64],"(",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","createBlock",64],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/backup_grid'",64],")",["T_OBJECT_OPERATOR","->",64],["T_STRING","toHtml",64],"(",")",")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Create backup action\n     *\n     * @return Mage_Adminhtml_Controller_Action\n     *\/",67],["T_WHITESPACE","\n    ",71],["T_PUBLIC","public",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","createAction",72],"(",")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_IF","if",74],["T_WHITESPACE"," ",74],"(","!",["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getRequest",74],"(",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","isAjax",74],"(",")",")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_RETURN","return",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getUrl",75],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",75],")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n\n        ",76],["T_VARIABLE","$response",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_NEW","new",78],["T_WHITESPACE"," ",78],["T_STRING","Varien_Object",78],"(",")",";",["T_WHITESPACE","\n\n        ",78],["T_DOC_COMMENT","\/**\n         * @var Mage_Backup_Helper_Data $helper\n         *\/",80],["T_WHITESPACE","\n        ",82],["T_VARIABLE","$helper",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","Mage",83],["T_DOUBLE_COLON","::",83],["T_STRING","helper",83],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",83],")",";",["T_WHITESPACE","\n\n        ",83],["T_TRY","try",85],["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$type",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getRequest",86],"(",")",["T_OBJECT_OPERATOR","->",86],["T_STRING","getParam",86],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",86],")",";",["T_WHITESPACE","\n\n            ",86],["T_IF","if",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$type",88],["T_WHITESPACE"," ",88],["T_IS_EQUAL","==",88],["T_WHITESPACE"," ",88],["T_STRING","Mage_Backup_Helper_Data",88],["T_DOUBLE_COLON","::",88],["T_STRING","TYPE_SYSTEM_SNAPSHOT",88],["T_WHITESPACE","\n                ",88],["T_BOOLEAN_AND","&&",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getRequest",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","getParam",89],"(",["T_CONSTANT_ENCAPSED_STRING","'exclude_media'",89],")",["T_WHITESPACE","\n            ",89],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$type",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_STRING","Mage_Backup_Helper_Data",91],["T_DOUBLE_COLON","::",91],["T_STRING","TYPE_SNAPSHOT_WITHOUT_MEDIA",91],";",["T_WHITESPACE","\n            ",91],"}",["T_WHITESPACE","\n\n            ",92],["T_VARIABLE","$backupManager",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","Mage_Backup",94],["T_DOUBLE_COLON","::",94],["T_STRING","getBackupInstance",94],"(",["T_VARIABLE","$type",94],")",["T_WHITESPACE","\n                ",94],["T_OBJECT_OPERATOR","->",95],["T_STRING","setBackupExtension",95],"(",["T_VARIABLE","$helper",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getExtensionByType",95],"(",["T_VARIABLE","$type",95],")",")",["T_WHITESPACE","\n                ",95],["T_OBJECT_OPERATOR","->",96],["T_STRING","setTime",96],"(",["T_STRING","time",96],"(",")",")",["T_WHITESPACE","\n                ",96],["T_OBJECT_OPERATOR","->",97],["T_STRING","setBackupsDir",97],"(",["T_VARIABLE","$helper",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getBackupsDir",97],"(",")",")",";",["T_WHITESPACE","\n\n            ",97],["T_VARIABLE","$backupManager",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","setName",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getRequest",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","getParam",99],"(",["T_CONSTANT_ENCAPSED_STRING","'backup_name'",99],")",")",";",["T_WHITESPACE","\n\n            ",99],["T_STRING","Mage",101],["T_DOUBLE_COLON","::",101],["T_STRING","register",101],"(",["T_CONSTANT_ENCAPSED_STRING","'backup_manager'",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$backupManager",101],")",";",["T_WHITESPACE","\n\n            ",101],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getRequest",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","getParam",103],"(",["T_CONSTANT_ENCAPSED_STRING","'maintenance_mode'",103],")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n                ",103],["T_VARIABLE","$turnedOn",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$helper",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","turnOnMaintenanceMode",104],"(",")",";",["T_WHITESPACE","\n\n                ",104],["T_IF","if",106],["T_WHITESPACE"," ",106],"(","!",["T_VARIABLE","$turnedOn",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n                    ",106],["T_VARIABLE","$response",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","setError",107],"(",["T_WHITESPACE","\n                        ",107],["T_STRING","Mage",108],["T_DOUBLE_COLON","::",108],["T_STRING","helper",108],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",108],")",["T_OBJECT_OPERATOR","->",108],["T_STRING","__",108],"(",["T_CONSTANT_ENCAPSED_STRING","'You do not have sufficient permissions to enable Maintenance Mode during this operation.'",108],")",["T_WHITESPACE","\n                            ",108],".",["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","' '",109],["T_WHITESPACE"," ",109],".",["T_WHITESPACE"," ",109],["T_STRING","Mage",109],["T_DOUBLE_COLON","::",109],["T_STRING","helper",109],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",109],")",["T_OBJECT_OPERATOR","->",109],["T_STRING","__",109],"(",["T_CONSTANT_ENCAPSED_STRING","'Please either unselect the \"Put store on the maintenance mode\" checkbox or update your permissions to proceed with the backup.\"'",109],")",["T_WHITESPACE","\n                    ",109],")",";",["T_WHITESPACE","\n                    ",110],["T_VARIABLE","$backupManager",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","setErrorMessage",111],"(",["T_STRING","Mage",111],["T_DOUBLE_COLON","::",111],["T_STRING","helper",111],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",111],")",["T_OBJECT_OPERATOR","->",111],["T_STRING","__",111],"(",["T_CONSTANT_ENCAPSED_STRING","\"System couldn't put store on the maintenance mode\"",111],")",")",";",["T_WHITESPACE","\n                    ",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getResponse",112],"(",")",["T_OBJECT_OPERATOR","->",112],["T_STRING","setBody",112],"(",["T_VARIABLE","$response",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","toJson",112],"(",")",")",";",["T_WHITESPACE","\n                ",112],"}",["T_WHITESPACE","\n            ",113],"}",["T_WHITESPACE","\n\n            ",114],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$type",116],["T_WHITESPACE"," ",116],["T_IS_NOT_EQUAL","!=",116],["T_WHITESPACE"," ",116],["T_STRING","Mage_Backup_Helper_Data",116],["T_DOUBLE_COLON","::",116],["T_STRING","TYPE_DB",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n                ",116],["T_VARIABLE","$backupManager",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","setRootDir",117],"(",["T_STRING","Mage",117],["T_DOUBLE_COLON","::",117],["T_STRING","getBaseDir",117],"(",")",")",["T_WHITESPACE","\n                    ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","addIgnorePaths",118],"(",["T_VARIABLE","$helper",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getBackupIgnorePaths",118],"(",")",")",";",["T_WHITESPACE","\n            ",118],"}",["T_WHITESPACE","\n\n            ",119],["T_VARIABLE","$successMessage",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$helper",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getCreateSuccessMessageByType",121],"(",["T_VARIABLE","$type",121],")",";",["T_WHITESPACE","\n\n            ",121],["T_VARIABLE","$backupManager",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","create",123],"(",")",";",["T_WHITESPACE","\n\n            ",123],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_getSession",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","addSuccess",125],"(",["T_VARIABLE","$successMessage",125],")",";",["T_WHITESPACE","\n\n            ",125],["T_VARIABLE","$response",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","setRedirectUrl",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getUrl",127],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",127],")",")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE"," ",128],["T_CATCH","catch",128],["T_WHITESPACE"," ",128],"(",["T_STRING","Mage_Backup_Exception_NotEnoughFreeSpace",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$e",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$errorMessage",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_STRING","Mage",129],["T_DOUBLE_COLON","::",129],["T_STRING","helper",129],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",129],")",["T_OBJECT_OPERATOR","->",129],["T_STRING","__",129],"(",["T_CONSTANT_ENCAPSED_STRING","'Not enough free space to create backup.'",129],")",";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE"," ",130],["T_CATCH","catch",130],["T_WHITESPACE"," ",130],"(",["T_STRING","Mage_Backup_Exception_NotEnoughPermissions",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$e",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_STRING","Mage",131],["T_DOUBLE_COLON","::",131],["T_STRING","log",131],"(",["T_VARIABLE","$e",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getMessage",131],"(",")",")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$errorMessage",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","Mage",132],["T_DOUBLE_COLON","::",132],["T_STRING","helper",132],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",132],")",["T_OBJECT_OPERATOR","->",132],["T_STRING","__",132],"(",["T_CONSTANT_ENCAPSED_STRING","'Not enough permissions to create backup.'",132],")",";",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE"," ",133],["T_CATCH","catch",133],["T_WHITESPACE"," ",133],"(",["T_STRING","Exception",133],["T_WHITESPACE","  ",133],["T_VARIABLE","$e",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_STRING","Mage",134],["T_DOUBLE_COLON","::",134],["T_STRING","log",134],"(",["T_VARIABLE","$e",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getMessage",134],"(",")",")",";",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$errorMessage",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","Mage",135],["T_DOUBLE_COLON","::",135],["T_STRING","helper",135],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",135],")",["T_OBJECT_OPERATOR","->",135],["T_STRING","__",135],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while creating the backup.'",135],")",";",["T_WHITESPACE","\n        ",135],"}",["T_WHITESPACE","\n\n        ",136],["T_IF","if",138],["T_WHITESPACE"," ",138],"(","!",["T_EMPTY","empty",138],"(",["T_VARIABLE","$errorMessage",138],")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$response",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","setError",139],"(",["T_VARIABLE","$errorMessage",139],")",";",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$backupManager",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","setErrorMessage",140],"(",["T_VARIABLE","$errorMessage",140],")",";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n\n        ",141],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getRequest",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","getParam",143],"(",["T_CONSTANT_ENCAPSED_STRING","'maintenance_mode'",143],")",")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$helper",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","turnOffMaintenanceMode",144],"(",")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n\n        ",145],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getResponse",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","setBody",147],"(",["T_VARIABLE","$response",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","toJson",147],"(",")",")",";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Download backup action\n     *\n     * @return Mage_Adminhtml_Controller_Action\n     *\/",150],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","downloadAction",155],"(",")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_COMMENT","\/* @var $backup Mage_Backup_Model_Backup *\/",157],["T_WHITESPACE","\n        ",157],["T_VARIABLE","$backup",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","Mage",158],["T_DOUBLE_COLON","::",158],["T_STRING","getModel",158],"(",["T_CONSTANT_ENCAPSED_STRING","'backup\/backup'",158],")",["T_OBJECT_OPERATOR","->",158],["T_STRING","loadByTimeAndType",158],"(",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getRequest",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getParam",159],"(",["T_CONSTANT_ENCAPSED_STRING","'time'",159],")",",",["T_WHITESPACE","\n            ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getRequest",160],"(",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","getParam",160],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",160],")",["T_WHITESPACE","\n        ",160],")",";",["T_WHITESPACE","\n\n        ",161],["T_IF","if",163],["T_WHITESPACE"," ",163],"(","!",["T_VARIABLE","$backup",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getTime",163],"(",")",["T_WHITESPACE"," ",163],["T_BOOLEAN_OR","||",163],["T_WHITESPACE"," ",163],"!",["T_VARIABLE","$backup",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","exists",163],"(",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_redirect",164],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",164],")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_VARIABLE","$fileName",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","Mage",167],["T_DOUBLE_COLON","::",167],["T_STRING","helper",167],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",167],")",["T_OBJECT_OPERATOR","->",167],["T_STRING","generateBackupDownloadName",167],"(",["T_VARIABLE","$backup",167],")",";",["T_WHITESPACE","\n\n        ",167],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_prepareDownloadResponse",169],"(",["T_VARIABLE","$fileName",169],",",["T_WHITESPACE"," ",169],["T_STRING","null",169],",",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'application\/octet-stream'",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$backup",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getSize",169],"(",")",")",";",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getResponse",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","sendHeaders",171],"(",")",";",["T_WHITESPACE","\n\n        ",171],["T_VARIABLE","$backup",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","output",173],"(",")",";",["T_WHITESPACE","\n        ",173],["T_EXIT","exit",174],"(",")",";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Rollback Action\n     *\n     * @return Mage_Adminhtml_Controller_Action\n     *\/",177],["T_WHITESPACE","\n    ",181],["T_PUBLIC","public",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","rollbackAction",182],"(",")",["T_WHITESPACE","\n    ",182],"{",["T_WHITESPACE","\n        ",183],["T_IF","if",184],["T_WHITESPACE"," ",184],"(","!",["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","helper",184],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",184],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","isRollbackAllowed",184],"(",")",")","{",["T_WHITESPACE","\n            ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_forward",185],"(",["T_CONSTANT_ENCAPSED_STRING","'denied'",185],")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n\n        ",186],["T_IF","if",188],["T_WHITESPACE"," ",188],"(","!",["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getRequest",188],"(",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","isAjax",188],"(",")",")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_RETURN","return",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getUrl",189],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",189],")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n\n        ",190],["T_VARIABLE","$helper",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_STRING","Mage",192],["T_DOUBLE_COLON","::",192],["T_STRING","helper",192],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",192],")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$response",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_NEW","new",193],["T_WHITESPACE"," ",193],["T_STRING","Varien_Object",193],"(",")",";",["T_WHITESPACE","\n\n        ",193],["T_TRY","try",195],["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_COMMENT","\/* @var $backup Mage_Backup_Model_Backup *\/",196],["T_WHITESPACE","\n            ",196],["T_VARIABLE","$backup",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","Mage",197],["T_DOUBLE_COLON","::",197],["T_STRING","getModel",197],"(",["T_CONSTANT_ENCAPSED_STRING","'backup\/backup'",197],")",["T_OBJECT_OPERATOR","->",197],["T_STRING","loadByTimeAndType",197],"(",["T_WHITESPACE","\n                ",197],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getRequest",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","getParam",198],"(",["T_CONSTANT_ENCAPSED_STRING","'time'",198],")",",",["T_WHITESPACE","\n                ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getRequest",199],"(",")",["T_OBJECT_OPERATOR","->",199],["T_STRING","getParam",199],"(",["T_CONSTANT_ENCAPSED_STRING","'type'",199],")",["T_WHITESPACE","\n            ",199],")",";",["T_WHITESPACE","\n\n            ",200],["T_IF","if",202],["T_WHITESPACE"," ",202],"(","!",["T_VARIABLE","$backup",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getTime",202],"(",")",["T_WHITESPACE"," ",202],["T_BOOLEAN_OR","||",202],["T_WHITESPACE"," ",202],"!",["T_VARIABLE","$backup",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","exists",202],"(",")",")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n                ",202],["T_RETURN","return",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_redirect",203],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",203],")",";",["T_WHITESPACE","\n            ",203],"}",["T_WHITESPACE","\n\n            ",204],["T_IF","if",206],["T_WHITESPACE"," ",206],"(","!",["T_VARIABLE","$backup",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getTime",206],"(",")",")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n                ",206],["T_THROW","throw",207],["T_WHITESPACE"," ",207],["T_NEW","new",207],["T_WHITESPACE"," ",207],["T_STRING","Mage_Backup_Exception_CantLoadSnapshot",207],"(",")",";",["T_WHITESPACE","\n            ",207],"}",["T_WHITESPACE","\n\n            ",208],["T_VARIABLE","$type",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$backup",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getType",210],"(",")",";",["T_WHITESPACE","\n\n            ",210],["T_VARIABLE","$backupManager",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_STRING","Mage_Backup",212],["T_DOUBLE_COLON","::",212],["T_STRING","getBackupInstance",212],"(",["T_VARIABLE","$type",212],")",["T_WHITESPACE","\n                ",212],["T_OBJECT_OPERATOR","->",213],["T_STRING","setBackupExtension",213],"(",["T_VARIABLE","$helper",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getExtensionByType",213],"(",["T_VARIABLE","$type",213],")",")",["T_WHITESPACE","\n                ",213],["T_OBJECT_OPERATOR","->",214],["T_STRING","setTime",214],"(",["T_VARIABLE","$backup",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getTime",214],"(",")",")",["T_WHITESPACE","\n                ",214],["T_OBJECT_OPERATOR","->",215],["T_STRING","setBackupsDir",215],"(",["T_VARIABLE","$helper",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getBackupsDir",215],"(",")",")",["T_WHITESPACE","\n                ",215],["T_OBJECT_OPERATOR","->",216],["T_STRING","setName",216],"(",["T_VARIABLE","$backup",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getName",216],"(",")",",",["T_WHITESPACE"," ",216],["T_STRING","false",216],")",["T_WHITESPACE","\n                ",216],["T_OBJECT_OPERATOR","->",217],["T_STRING","setResourceModel",217],"(",["T_STRING","Mage",217],["T_DOUBLE_COLON","::",217],["T_STRING","getResourceModel",217],"(",["T_CONSTANT_ENCAPSED_STRING","'backup\/db'",217],")",")",";",["T_WHITESPACE","\n\n            ",217],["T_STRING","Mage",219],["T_DOUBLE_COLON","::",219],["T_STRING","register",219],"(",["T_CONSTANT_ENCAPSED_STRING","'backup_manager'",219],",",["T_WHITESPACE"," ",219],["T_VARIABLE","$backupManager",219],")",";",["T_WHITESPACE","\n\n            ",219],["T_VARIABLE","$passwordValid",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_STRING","Mage",221],["T_DOUBLE_COLON","::",221],["T_STRING","getModel",221],"(",["T_CONSTANT_ENCAPSED_STRING","'backup\/backup'",221],")",["T_OBJECT_OPERATOR","->",221],["T_STRING","validateUserPassword",221],"(",["T_WHITESPACE","\n                ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getRequest",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","getParam",222],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",222],")",["T_WHITESPACE","\n            ",222],")",";",["T_WHITESPACE","\n\n            ",223],["T_IF","if",225],["T_WHITESPACE"," ",225],"(","!",["T_VARIABLE","$passwordValid",225],")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n                ",225],["T_VARIABLE","$response",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","setError",226],"(",["T_STRING","Mage",226],["T_DOUBLE_COLON","::",226],["T_STRING","helper",226],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",226],")",["T_OBJECT_OPERATOR","->",226],["T_STRING","__",226],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid Password.'",226],")",")",";",["T_WHITESPACE","\n                ",226],["T_VARIABLE","$backupManager",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","setErrorMessage",227],"(",["T_STRING","Mage",227],["T_DOUBLE_COLON","::",227],["T_STRING","helper",227],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",227],")",["T_OBJECT_OPERATOR","->",227],["T_STRING","__",227],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid Password.'",227],")",")",";",["T_WHITESPACE","\n                ",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getResponse",228],"(",")",["T_OBJECT_OPERATOR","->",228],["T_STRING","setBody",228],"(",["T_VARIABLE","$response",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","toJson",228],"(",")",")",";",["T_WHITESPACE","\n            ",228],"}",["T_WHITESPACE","\n\n            ",229],["T_IF","if",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getRequest",231],"(",")",["T_OBJECT_OPERATOR","->",231],["T_STRING","getParam",231],"(",["T_CONSTANT_ENCAPSED_STRING","'maintenance_mode'",231],")",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n                ",231],["T_VARIABLE","$turnedOn",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_VARIABLE","$helper",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","turnOnMaintenanceMode",232],"(",")",";",["T_WHITESPACE","\n\n                ",232],["T_IF","if",234],["T_WHITESPACE"," ",234],"(","!",["T_VARIABLE","$turnedOn",234],")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n                    ",234],["T_VARIABLE","$response",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","setError",235],"(",["T_WHITESPACE","\n                        ",235],["T_STRING","Mage",236],["T_DOUBLE_COLON","::",236],["T_STRING","helper",236],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",236],")",["T_OBJECT_OPERATOR","->",236],["T_STRING","__",236],"(",["T_CONSTANT_ENCAPSED_STRING","'You do not have sufficient permissions to enable Maintenance Mode during this operation.'",236],")",["T_WHITESPACE","\n                            ",236],".",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","' '",237],["T_WHITESPACE"," ",237],".",["T_WHITESPACE"," ",237],["T_STRING","Mage",237],["T_DOUBLE_COLON","::",237],["T_STRING","helper",237],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",237],")",["T_OBJECT_OPERATOR","->",237],["T_STRING","__",237],"(",["T_CONSTANT_ENCAPSED_STRING","'Please either unselect the \"Put store on the maintenance mode\" checkbox or update your permissions to proceed with the rollback.\"'",237],")",["T_WHITESPACE","\n                    ",237],")",";",["T_WHITESPACE","\n                    ",238],["T_VARIABLE","$backupManager",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","setErrorMessage",239],"(",["T_STRING","Mage",239],["T_DOUBLE_COLON","::",239],["T_STRING","helper",239],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",239],")",["T_OBJECT_OPERATOR","->",239],["T_STRING","__",239],"(",["T_CONSTANT_ENCAPSED_STRING","\"System couldn't put store on the maintenance mode\"",239],")",")",";",["T_WHITESPACE","\n                    ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getResponse",240],"(",")",["T_OBJECT_OPERATOR","->",240],["T_STRING","setBody",240],"(",["T_VARIABLE","$response",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","toJson",240],"(",")",")",";",["T_WHITESPACE","\n                ",240],"}",["T_WHITESPACE","\n            ",241],"}",["T_WHITESPACE","\n\n            ",242],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_VARIABLE","$type",244],["T_WHITESPACE"," ",244],["T_IS_NOT_EQUAL","!=",244],["T_WHITESPACE"," ",244],["T_STRING","Mage_Backup_Helper_Data",244],["T_DOUBLE_COLON","::",244],["T_STRING","TYPE_DB",244],")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n\n                ",244],["T_VARIABLE","$backupManager",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","setRootDir",246],"(",["T_STRING","Mage",246],["T_DOUBLE_COLON","::",246],["T_STRING","getBaseDir",246],"(",")",")",["T_WHITESPACE","\n                    ",246],["T_OBJECT_OPERATOR","->",247],["T_STRING","addIgnorePaths",247],"(",["T_VARIABLE","$helper",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getRollbackIgnorePaths",247],"(",")",")",";",["T_WHITESPACE","\n\n                ",247],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getRequest",249],"(",")",["T_OBJECT_OPERATOR","->",249],["T_STRING","getParam",249],"(",["T_CONSTANT_ENCAPSED_STRING","'use_ftp'",249],",",["T_WHITESPACE"," ",249],["T_STRING","false",249],")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                    ",249],["T_VARIABLE","$backupManager",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","setUseFtp",250],"(",["T_WHITESPACE","\n                        ",250],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getRequest",251],"(",")",["T_OBJECT_OPERATOR","->",251],["T_STRING","getParam",251],"(",["T_CONSTANT_ENCAPSED_STRING","'ftp_host'",251],",",["T_WHITESPACE"," ",251],["T_CONSTANT_ENCAPSED_STRING","''",251],")",",",["T_WHITESPACE","\n                        ",251],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getRequest",252],"(",")",["T_OBJECT_OPERATOR","->",252],["T_STRING","getParam",252],"(",["T_CONSTANT_ENCAPSED_STRING","'ftp_user'",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","''",252],")",",",["T_WHITESPACE","\n                        ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getRequest",253],"(",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","getParam",253],"(",["T_CONSTANT_ENCAPSED_STRING","'ftp_pass'",253],",",["T_WHITESPACE"," ",253],["T_CONSTANT_ENCAPSED_STRING","''",253],")",",",["T_WHITESPACE","\n                        ",253],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getRequest",254],"(",")",["T_OBJECT_OPERATOR","->",254],["T_STRING","getParam",254],"(",["T_CONSTANT_ENCAPSED_STRING","'ftp_path'",254],",",["T_WHITESPACE"," ",254],["T_CONSTANT_ENCAPSED_STRING","''",254],")",["T_WHITESPACE","\n                    ",254],")",";",["T_WHITESPACE","\n                ",255],"}",["T_WHITESPACE","\n            ",256],"}",["T_WHITESPACE","\n\n            ",257],["T_VARIABLE","$backupManager",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","rollback",259],"(",")",";",["T_WHITESPACE","\n\n            ",259],["T_VARIABLE","$helper",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","invalidateCache",261],"(",")",["T_OBJECT_OPERATOR","->",261],["T_STRING","invalidateIndexer",261],"(",")",";",["T_WHITESPACE","\n\n            ",261],["T_VARIABLE","$adminSession",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_getSession",263],"(",")",";",["T_WHITESPACE","\n            ",263],["T_VARIABLE","$adminSession",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","unsetAll",264],"(",")",";",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$adminSession",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getCookie",265],"(",")",["T_OBJECT_OPERATOR","->",265],["T_STRING","delete",265],"(",["T_VARIABLE","$adminSession",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getSessionName",265],"(",")",")",";",["T_WHITESPACE","\n\n            ",265],["T_VARIABLE","$response",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","setRedirectUrl",267],"(",["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getUrl",267],"(",["T_CONSTANT_ENCAPSED_STRING","'*'",267],")",")",";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE"," ",268],["T_CATCH","catch",268],["T_WHITESPACE"," ",268],"(",["T_STRING","Mage_Backup_Exception_CantLoadSnapshot",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$e",268],")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n            ",268],["T_VARIABLE","$errorMsg",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","Mage",269],["T_DOUBLE_COLON","::",269],["T_STRING","helper",269],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",269],")",["T_OBJECT_OPERATOR","->",269],["T_STRING","__",269],"(",["T_CONSTANT_ENCAPSED_STRING","'Backup file not found'",269],")",";",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE"," ",270],["T_CATCH","catch",270],["T_WHITESPACE"," ",270],"(",["T_STRING","Mage_Backup_Exception_FtpConnectionFailed",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$e",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$errorMsg",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_STRING","Mage",271],["T_DOUBLE_COLON","::",271],["T_STRING","helper",271],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",271],")",["T_OBJECT_OPERATOR","->",271],["T_STRING","__",271],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to connect to FTP'",271],")",";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE"," ",272],["T_CATCH","catch",272],["T_WHITESPACE"," ",272],"(",["T_STRING","Mage_Backup_Exception_FtpValidationFailed",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$e",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$errorMsg",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","Mage",273],["T_DOUBLE_COLON","::",273],["T_STRING","helper",273],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",273],")",["T_OBJECT_OPERATOR","->",273],["T_STRING","__",273],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to validate FTP'",273],")",";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE"," ",274],["T_CATCH","catch",274],["T_WHITESPACE"," ",274],"(",["T_STRING","Mage_Backup_Exception_NotEnoughPermissions",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$e",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n            ",274],["T_STRING","Mage",275],["T_DOUBLE_COLON","::",275],["T_STRING","log",275],"(",["T_VARIABLE","$e",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getMessage",275],"(",")",")",";",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$errorMsg",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_STRING","Mage",276],["T_DOUBLE_COLON","::",276],["T_STRING","helper",276],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",276],")",["T_OBJECT_OPERATOR","->",276],["T_STRING","__",276],"(",["T_CONSTANT_ENCAPSED_STRING","'Not enough permissions to perform rollback'",276],")",";",["T_WHITESPACE","\n        ",276],"}",["T_WHITESPACE"," ",277],["T_CATCH","catch",277],["T_WHITESPACE"," ",277],"(",["T_STRING","Exception",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$e",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_STRING","Mage",278],["T_DOUBLE_COLON","::",278],["T_STRING","log",278],"(",["T_VARIABLE","$e",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getMessage",278],"(",")",")",";",["T_WHITESPACE","\n            ",278],["T_VARIABLE","$errorMsg",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_STRING","Mage",279],["T_DOUBLE_COLON","::",279],["T_STRING","helper",279],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",279],")",["T_OBJECT_OPERATOR","->",279],["T_STRING","__",279],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to rollback'",279],")",";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n\n        ",280],["T_IF","if",282],["T_WHITESPACE"," ",282],"(","!",["T_EMPTY","empty",282],"(",["T_VARIABLE","$errorMsg",282],")",")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$response",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","setError",283],"(",["T_VARIABLE","$errorMsg",283],")",";",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$backupManager",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","setErrorMessage",284],"(",["T_VARIABLE","$errorMsg",284],")",";",["T_WHITESPACE","\n        ",284],"}",["T_WHITESPACE","\n\n        ",285],["T_IF","if",287],["T_WHITESPACE"," ",287],"(",["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getRequest",287],"(",")",["T_OBJECT_OPERATOR","->",287],["T_STRING","getParam",287],"(",["T_CONSTANT_ENCAPSED_STRING","'maintenance_mode'",287],")",")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$helper",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","turnOffMaintenanceMode",288],"(",")",";",["T_WHITESPACE","\n        ",288],"}",["T_WHITESPACE","\n\n        ",289],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getResponse",291],"(",")",["T_OBJECT_OPERATOR","->",291],["T_STRING","setBody",291],"(",["T_VARIABLE","$response",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","toJson",291],"(",")",")",";",["T_WHITESPACE","\n    ",291],"}",["T_WHITESPACE","\n\n    ",292],["T_DOC_COMMENT","\/**\n     * Delete backups mass action\n     *\n     * @return Mage_Adminhtml_Controller_Action\n     *\/",294],["T_WHITESPACE","\n    ",298],["T_PUBLIC","public",299],["T_WHITESPACE"," ",299],["T_FUNCTION","function",299],["T_WHITESPACE"," ",299],["T_STRING","massDeleteAction",299],"(",")",["T_WHITESPACE","\n    ",299],"{",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$backupIds",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getRequest",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","getParam",301],"(",["T_CONSTANT_ENCAPSED_STRING","'ids'",301],",",["T_WHITESPACE"," ",301],["T_ARRAY","array",301],"(",")",")",";",["T_WHITESPACE","\n\n        ",301],["T_IF","if",303],["T_WHITESPACE"," ",303],"(","!",["T_STRING","is_array",303],"(",["T_VARIABLE","$backupIds",303],")",["T_WHITESPACE"," ",303],["T_BOOLEAN_OR","||",303],["T_WHITESPACE"," ",303],"!",["T_STRING","count",303],"(",["T_VARIABLE","$backupIds",303],")",")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n            ",303],["T_RETURN","return",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_redirect",304],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",304],")",";",["T_WHITESPACE","\n        ",304],"}",["T_WHITESPACE","\n\n        ",305],["T_DOC_COMMENT","\/** @var $backupModel Mage_Backup_Model_Backup *\/",307],["T_WHITESPACE","\n        ",307],["T_VARIABLE","$backupModel",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_STRING","Mage",308],["T_DOUBLE_COLON","::",308],["T_STRING","getModel",308],"(",["T_CONSTANT_ENCAPSED_STRING","'backup\/backup'",308],")",";",["T_WHITESPACE","\n        ",308],["T_VARIABLE","$resultData",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_NEW","new",309],["T_WHITESPACE"," ",309],["T_STRING","Varien_Object",309],"(",")",";",["T_WHITESPACE","\n        ",309],["T_VARIABLE","$resultData",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","setIsSuccess",310],"(",["T_STRING","false",310],")",";",["T_WHITESPACE","\n        ",310],["T_VARIABLE","$resultData",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","setDeleteResult",311],"(",["T_ARRAY","array",311],"(",")",")",";",["T_WHITESPACE","\n        ",311],["T_STRING","Mage",312],["T_DOUBLE_COLON","::",312],["T_STRING","register",312],"(",["T_CONSTANT_ENCAPSED_STRING","'backup_manager'",312],",",["T_WHITESPACE"," ",312],["T_VARIABLE","$resultData",312],")",";",["T_WHITESPACE","\n\n        ",312],["T_VARIABLE","$deleteFailMessage",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_STRING","Mage",314],["T_DOUBLE_COLON","::",314],["T_STRING","helper",314],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",314],")",["T_OBJECT_OPERATOR","->",314],["T_STRING","__",314],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to delete one or several backups.'",314],")",";",["T_WHITESPACE","\n\n        ",314],["T_TRY","try",316],["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_VARIABLE","$allBackupsDeleted",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_STRING","true",317],";",["T_WHITESPACE","\n\n            ",317],["T_FOREACH","foreach",319],["T_WHITESPACE"," ",319],"(",["T_VARIABLE","$backupIds",319],["T_WHITESPACE"," ",319],["T_AS","as",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$id",319],")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n                ",319],["T_LIST","list",320],"(",["T_VARIABLE","$time",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$type",320],")",["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_STRING","explode",320],"(",["T_CONSTANT_ENCAPSED_STRING","'_'",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$id",320],")",";",["T_WHITESPACE","\n                ",320],["T_VARIABLE","$backupModel",321],["T_WHITESPACE","\n                    ",321],["T_OBJECT_OPERATOR","->",322],["T_STRING","loadByTimeAndType",322],"(",["T_VARIABLE","$time",322],",",["T_WHITESPACE"," ",322],["T_VARIABLE","$type",322],")",["T_WHITESPACE","\n                    ",322],["T_OBJECT_OPERATOR","->",323],["T_STRING","deleteFile",323],"(",")",";",["T_WHITESPACE","\n\n                ",323],["T_IF","if",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$backupModel",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","exists",325],"(",")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n                    ",325],["T_VARIABLE","$allBackupsDeleted",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_STRING","false",326],";",["T_WHITESPACE","\n                    ",326],["T_VARIABLE","$result",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_STRING","Mage",327],["T_DOUBLE_COLON","::",327],["T_STRING","helper",327],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",327],")",["T_OBJECT_OPERATOR","->",327],["T_STRING","__",327],"(",["T_CONSTANT_ENCAPSED_STRING","'failed'",327],")",";",["T_WHITESPACE","\n                ",327],"}",["T_WHITESPACE"," ",328],["T_ELSE","else",328],["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n                    ",328],["T_VARIABLE","$result",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_STRING","Mage",329],["T_DOUBLE_COLON","::",329],["T_STRING","helper",329],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",329],")",["T_OBJECT_OPERATOR","->",329],["T_STRING","__",329],"(",["T_CONSTANT_ENCAPSED_STRING","'successful'",329],")",";",["T_WHITESPACE","\n                ",329],"}",["T_WHITESPACE","\n\n                ",330],["T_VARIABLE","$resultData",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","setDeleteResult",332],"(",["T_WHITESPACE","\n                    ",332],["T_STRING","array_merge",333],"(",["T_VARIABLE","$resultData",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getDeleteResult",333],"(",")",",",["T_WHITESPACE"," ",333],["T_ARRAY","array",333],"(",["T_VARIABLE","$backupModel",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getFileName",333],"(",")",["T_WHITESPACE"," ",333],".",["T_WHITESPACE"," ",333],["T_CONSTANT_ENCAPSED_STRING","' '",333],["T_WHITESPACE"," ",333],".",["T_WHITESPACE"," ",333],["T_VARIABLE","$result",333],")",")",["T_WHITESPACE","\n                ",333],")",";",["T_WHITESPACE","\n            ",334],"}",["T_WHITESPACE","\n\n            ",335],["T_VARIABLE","$resultData",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","setIsSuccess",337],"(",["T_STRING","true",337],")",";",["T_WHITESPACE","\n            ",337],["T_IF","if",338],["T_WHITESPACE"," ",338],"(",["T_VARIABLE","$allBackupsDeleted",338],")",["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","_getSession",339],"(",")",["T_OBJECT_OPERATOR","->",339],["T_STRING","addSuccess",339],"(",["T_WHITESPACE","\n                    ",339],["T_STRING","Mage",340],["T_DOUBLE_COLON","::",340],["T_STRING","helper",340],"(",["T_CONSTANT_ENCAPSED_STRING","'backup'",340],")",["T_OBJECT_OPERATOR","->",340],["T_STRING","__",340],"(",["T_CONSTANT_ENCAPSED_STRING","'The selected backup(s) has been deleted.'",340],")",["T_WHITESPACE","\n                ",340],")",";",["T_WHITESPACE","\n            ",341],"}",["T_WHITESPACE","\n            ",342],["T_ELSE","else",343],["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n                ",343],["T_THROW","throw",344],["T_WHITESPACE"," ",344],["T_NEW","new",344],["T_WHITESPACE"," ",344],["T_STRING","Exception",344],"(",["T_VARIABLE","$deleteFailMessage",344],")",";",["T_WHITESPACE","\n            ",344],"}",["T_WHITESPACE","\n        ",345],"}",["T_WHITESPACE"," ",346],["T_CATCH","catch",346],["T_WHITESPACE"," ",346],"(",["T_STRING","Exception",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$e",346],")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n            ",346],["T_VARIABLE","$resultData",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","setIsSuccess",347],"(",["T_STRING","false",347],")",";",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","_getSession",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","addError",348],"(",["T_VARIABLE","$deleteFailMessage",348],")",";",["T_WHITESPACE","\n        ",348],"}",["T_WHITESPACE","\n\n        ",349],["T_RETURN","return",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","_redirect",351],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",351],")",";",["T_WHITESPACE","\n    ",351],"}",["T_WHITESPACE","\n\n    ",352],["T_DOC_COMMENT","\/**\n     * Check Permissions for all actions\n     *\n     * @return bool\n     *\/",354],["T_WHITESPACE","\n    ",358],["T_PROTECTED","protected",359],["T_WHITESPACE"," ",359],["T_FUNCTION","function",359],["T_WHITESPACE"," ",359],["T_STRING","_isAllowed",359],"(",")",["T_WHITESPACE","\n    ",359],"{",["T_WHITESPACE","\n        ",360],["T_RETURN","return",361],["T_WHITESPACE"," ",361],["T_STRING","Mage",361],["T_DOUBLE_COLON","::",361],["T_STRING","getSingleton",361],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/session'",361],")",["T_OBJECT_OPERATOR","->",361],["T_STRING","isAllowed",361],"(",["T_CONSTANT_ENCAPSED_STRING","'system\/tools\/backup'",361],["T_WHITESPACE"," ",361],")",";",["T_WHITESPACE","\n    ",361],"}",["T_WHITESPACE","\n\n    ",362],["T_DOC_COMMENT","\/**\n     * Retrive adminhtml session model\n     *\n     * @return Mage_Adminhtml_Model_Session\n     *\/",364],["T_WHITESPACE","\n    ",368],["T_PROTECTED","protected",369],["T_WHITESPACE"," ",369],["T_FUNCTION","function",369],["T_WHITESPACE"," ",369],["T_STRING","_getSession",369],"(",")",["T_WHITESPACE","\n    ",369],"{",["T_WHITESPACE","\n        ",370],["T_RETURN","return",371],["T_WHITESPACE"," ",371],["T_STRING","Mage",371],["T_DOUBLE_COLON","::",371],["T_STRING","getSingleton",371],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",371],")",";",["T_WHITESPACE","\n    ",371],"}",["T_WHITESPACE","\n",372],"}",["T_WHITESPACE","\n",373]]