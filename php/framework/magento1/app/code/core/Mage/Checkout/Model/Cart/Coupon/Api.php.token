[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Shopping cart api\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Cart_Coupon_Api",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Api_Resource",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $couponCode\n     * @param  $storeId\n     * @return bool\n     *\/",37],["T_WHITESPACE","\n    ",42],["T_PUBLIC","public",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","add",43],"(",["T_VARIABLE","$quoteId",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$couponCode",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$store",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","null",43],")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_RETURN","return",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","_applyCoupon",45],"(",["T_VARIABLE","$quoteId",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$couponCode",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$store",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","null",45],")",";",["T_WHITESPACE","\n    ",45],"}",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $storeId\n     * @return void\n     *\/",48],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","remove",53],"(",["T_VARIABLE","$quoteId",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$store",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","null",53],")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$couponCode",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","''",55],";",["T_WHITESPACE","\n        ",55],["T_RETURN","return",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_applyCoupon",56],"(",["T_VARIABLE","$quoteId",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$couponCode",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$store",56],")",";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $storeId\n     * @return string\n     *\/",59],["T_WHITESPACE","\n    ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","get",64],"(",["T_VARIABLE","$quoteId",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$store",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","null",64],")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$quote",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_getQuote",66],"(",["T_VARIABLE","$quoteId",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$store",66],")",";",["T_WHITESPACE","\n\n        ",66],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$quote",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getCouponCode",68],"(",")",";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $couponCode\n     * @param  $store\n     * @return bool\n     *\/",71],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","_applyCoupon",77],"(",["T_VARIABLE","$quoteId",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$couponCode",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$store",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","null",77],")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$quote",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_getQuote",79],"(",["T_VARIABLE","$quoteId",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$store",79],")",";",["T_WHITESPACE","\n\n        ",79],["T_IF","if",81],["T_WHITESPACE"," ",81],"(","!",["T_VARIABLE","$quote",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getItemsCount",81],"(",")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_fault",82],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_is_empty'",82],")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE","\n\n        ",83],["T_VARIABLE","$oldCouponCode",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$quote",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getCouponCode",85],"(",")",";",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(","!",["T_STRING","strlen",86],"(",["T_VARIABLE","$couponCode",86],")",["T_WHITESPACE"," ",86],["T_BOOLEAN_AND","&&",86],["T_WHITESPACE"," ",86],"!",["T_STRING","strlen",86],"(",["T_VARIABLE","$oldCouponCode",86],")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_RETURN","return",87],["T_WHITESPACE"," ",87],["T_STRING","false",87],";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n\n        ",88],["T_TRY","try",90],["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$quote",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getShippingAddress",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","setCollectShippingRates",91],"(",["T_STRING","true",91],")",";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$quote",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","setCouponCode",92],"(",["T_STRING","strlen",92],"(",["T_VARIABLE","$couponCode",92],")",["T_WHITESPACE"," ",92],"?",["T_WHITESPACE"," ",92],["T_VARIABLE","$couponCode",92],["T_WHITESPACE"," ",92],":",["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","''",92],")",["T_WHITESPACE","\n                ",92],["T_OBJECT_OPERATOR","->",93],["T_STRING","collectTotals",93],"(",")",["T_WHITESPACE","\n                ",93],["T_OBJECT_OPERATOR","->",94],["T_STRING","save",94],"(",")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE"," ",95],["T_CATCH","catch",95],["T_WHITESPACE"," ",95],"(",["T_STRING","Exception",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$e",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_fault",96],"(",["T_CONSTANT_ENCAPSED_STRING","\"cannot_apply_coupon_code\"",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$e",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getMessage",96],"(",")",")",";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE","\n\n        ",97],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$couponCode",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(","!",["T_VARIABLE","$couponCode",100],["T_WHITESPACE"," ",100],["T_IS_EQUAL","==",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$quote",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getCouponCode",100],"(",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_fault",101],"(",["T_CONSTANT_ENCAPSED_STRING","'coupon_code_is_not_valid'",101],")",";",["T_WHITESPACE","\n            ",101],"}",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n\n        ",103],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_STRING","true",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n\n",106],"}",["T_WHITESPACE","\n",109]]