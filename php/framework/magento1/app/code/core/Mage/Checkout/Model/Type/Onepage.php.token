[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * One page checkout processing model\n *\/",27],["T_WHITESPACE","\n",29],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Checkout_Model_Type_Onepage",30],["T_WHITESPACE","\n",30],"{",["T_WHITESPACE","\n    ",31],["T_DOC_COMMENT","\/**\n     * Checkout types: Checkout as Guest, Register, Logged In Customer\n     *\/",32],["T_WHITESPACE","\n    ",34],["T_CONST","const",35],["T_WHITESPACE"," ",35],["T_STRING","METHOD_GUEST",35],["T_WHITESPACE","    ",35],"=",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'guest'",35],";",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","METHOD_REGISTER",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'register'",36],";",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","METHOD_CUSTOMER",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'customer'",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Error message of \"customer already exists\"\n     *\n     * @var string\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PRIVATE","private",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_customerEmailExistsMessage",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","''",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * @var Mage_Customer_Model_Session\n     *\/",46],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_customerSession",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * @var Mage_Checkout_Model_Session\n     *\/",51],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_checkoutSession",54],";",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * @var Mage_Sales_Model_Quote\n     *\/",56],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$_quote",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","null",59],";",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * @var Mage_Checkout_Helper_Data\n     *\/",61],["T_WHITESPACE","\n    ",63],["T_PROTECTED","protected",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$_helper",64],";",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * Class constructor\n     * Set customer already exists message\n     *\/",66],["T_WHITESPACE","\n    ",69],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","__construct",70],"(",")",["T_WHITESPACE","\n    ",70],"{",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_helper",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","Mage",72],["T_DOUBLE_COLON","::",72],["T_STRING","helper",72],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",72],")",";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_customerEmailExistsMessage",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","Mage",73],["T_DOUBLE_COLON","::",73],["T_STRING","helper",73],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","__",73],"(",["T_CONSTANT_ENCAPSED_STRING","'There is already a customer registered using this email address. Please login using this email address or enter a different email address to register your account.'",73],")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_checkoutSession",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","Mage",74],["T_DOUBLE_COLON","::",74],["T_STRING","getSingleton",74],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",74],")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_customerSession",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","Mage",75],["T_DOUBLE_COLON","::",75],["T_STRING","getSingleton",75],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",75],")",";",["T_WHITESPACE","\n    ",75],"}",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Get frontend checkout session object\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",78],["T_WHITESPACE","\n    ",82],["T_PUBLIC","public",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","getCheckout",83],"(",")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_checkoutSession",85],";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Quote object getter\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",88],["T_WHITESPACE","\n    ",92],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","getQuote",93],"(",")",["T_WHITESPACE","\n    ",93],"{",["T_WHITESPACE","\n        ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_quote",95],["T_WHITESPACE"," ",95],["T_IS_IDENTICAL","===",95],["T_WHITESPACE"," ",95],["T_STRING","null",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_checkoutSession",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getQuote",96],"(",")",";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE","\n        ",97],["T_RETURN","return",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_quote",98],";",["T_WHITESPACE","\n    ",98],"}",["T_WHITESPACE","\n\n    ",99],["T_DOC_COMMENT","\/**\n     * Declare checkout quote instance\n     *\n     * @param Mage_Sales_Model_Quote $quote\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",101],["T_WHITESPACE","\n    ",106],["T_PUBLIC","public",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","setQuote",107],"(",["T_STRING","Mage_Sales_Model_Quote",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$quote",107],")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_quote",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$quote",109],";",["T_WHITESPACE","\n        ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Get customer session object\n     *\n     * @return Mage_Customer_Model_Session\n     *\/",113],["T_WHITESPACE","\n    ",117],["T_PUBLIC","public",118],["T_WHITESPACE"," ",118],["T_FUNCTION","function",118],["T_WHITESPACE"," ",118],["T_STRING","getCustomerSession",118],"(",")",["T_WHITESPACE","\n    ",118],"{",["T_WHITESPACE","\n        ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_customerSession",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Initialize quote state to be valid for one page checkout\n     *\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",123],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","initCheckout",128],"(",")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$checkout",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getCheckout",130],"(",")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$customerSession",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getCustomerSession",131],"(",")",";",["T_WHITESPACE","\n        ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_STRING","is_array",132],"(",["T_VARIABLE","$checkout",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getStepData",132],"(",")",")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_FOREACH","foreach",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$checkout",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getStepData",133],"(",")",["T_WHITESPACE"," ",133],["T_AS","as",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$step",133],["T_DOUBLE_ARROW","=>",133],["T_VARIABLE","$data",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n                ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(","!","(",["T_VARIABLE","$step",134],["T_IS_IDENTICAL","===",134],["T_CONSTANT_ENCAPSED_STRING","'login'",134],["T_WHITESPACE"," ",134],["T_BOOLEAN_OR","||",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$customerSession",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","isLoggedIn",134],"(",")",["T_WHITESPACE"," ",134],["T_BOOLEAN_AND","&&",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$step",134],["T_IS_IDENTICAL","===",134],["T_CONSTANT_ENCAPSED_STRING","'billing'",134],")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                    ",134],["T_VARIABLE","$checkout",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","setStepData",135],"(",["T_VARIABLE","$step",135],",",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'allow'",135],",",["T_WHITESPACE"," ",135],["T_STRING","false",135],")",";",["T_WHITESPACE","\n                ",135],"}",["T_WHITESPACE","\n            ",136],"}",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n\n        ",138],["T_VARIABLE","$quoteSave",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","false",140],";",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$collectTotals",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","false",141],";",["T_WHITESPACE","\n\n        ",141],["T_DOC_COMMENT","\/**\n         * Reset multishipping flag before any manipulations with quote address\n         * addAddress method for quote object related on this flag\n         *\/",143],["T_WHITESPACE","\n        ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getQuote",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","getIsMultiShipping",147],"(",")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getQuote",148],"(",")",["T_OBJECT_OPERATOR","->",148],["T_STRING","setIsMultiShipping",148],"(",["T_STRING","false",148],")",";",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$quoteSave",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_STRING","true",149],";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n\n        ",150],["T_DOC_COMMENT","\/**\n         *  Reset customer balance\n         *\/",152],["T_WHITESPACE","\n        ",154],["T_IF","if",155],["T_WHITESPACE"," ",155],"(",["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getQuote",155],"(",")",["T_OBJECT_OPERATOR","->",155],["T_STRING","getUseCustomerBalance",155],"(",")",")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getQuote",156],"(",")",["T_OBJECT_OPERATOR","->",156],["T_STRING","setUseCustomerBalance",156],"(",["T_STRING","false",156],")",";",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$quoteSave",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_STRING","true",157],";",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$collectTotals",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","true",158],";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n        ",159],["T_DOC_COMMENT","\/**\n         *  Reset reward points\n         *\/",160],["T_WHITESPACE","\n        ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getQuote",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","getUseRewardPoints",163],"(",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getQuote",164],"(",")",["T_OBJECT_OPERATOR","->",164],["T_STRING","setUseRewardPoints",164],"(",["T_STRING","false",164],")",";",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$quoteSave",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_STRING","true",165],";",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$collectTotals",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_STRING","true",166],";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n\n        ",167],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_VARIABLE","$collectTotals",169],")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getQuote",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","collectTotals",170],"(",")",";",["T_WHITESPACE","\n        ",170],"}",["T_WHITESPACE","\n\n        ",171],["T_IF","if",173],["T_WHITESPACE"," ",173],"(",["T_VARIABLE","$quoteSave",173],")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getQuote",174],"(",")",["T_OBJECT_OPERATOR","->",174],["T_STRING","save",174],"(",")",";",["T_WHITESPACE","\n        ",174],"}",["T_WHITESPACE","\n\n        ",175],["T_COMMENT","\/*\n        * want to load the correct customer information by assigning to address\n        * instead of just loading from sales\/quote_address\n        *\/",177],["T_WHITESPACE","\n        ",180],["T_VARIABLE","$customer",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$customerSession",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getCustomer",181],"(",")",";",["T_WHITESPACE","\n        ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(",["T_VARIABLE","$customer",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getQuote",183],"(",")",["T_OBJECT_OPERATOR","->",183],["T_STRING","assignCustomer",183],"(",["T_VARIABLE","$customer",183],")",";",["T_WHITESPACE","\n        ",183],"}",["T_WHITESPACE","\n        ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Get quote checkout method\n     *\n     * @return string\n     *\/",188],["T_WHITESPACE","\n    ",192],["T_PUBLIC","public",193],["T_WHITESPACE"," ",193],["T_FUNCTION","function",193],["T_WHITESPACE"," ",193],["T_STRING","getCheckoutMethod",193],"(",")",["T_WHITESPACE","\n    ",193],"{",["T_WHITESPACE","\n        ",194],["T_IF","if",195],["T_WHITESPACE"," ",195],"(",["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getCustomerSession",195],"(",")",["T_OBJECT_OPERATOR","->",195],["T_STRING","isLoggedIn",195],"(",")",")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_RETURN","return",196],["T_WHITESPACE"," ",196],["T_STRING","self",196],["T_DOUBLE_COLON","::",196],["T_STRING","METHOD_CUSTOMER",196],";",["T_WHITESPACE","\n        ",196],"}",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(","!",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getQuote",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","getCheckoutMethod",198],"(",")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_helper",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","isAllowedGuestCheckout",199],"(",["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getQuote",199],"(",")",")",")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n                ",199],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getQuote",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","setCheckoutMethod",200],"(",["T_STRING","self",200],["T_DOUBLE_COLON","::",200],["T_STRING","METHOD_GUEST",200],")",";",["T_WHITESPACE","\n            ",200],"}",["T_WHITESPACE"," ",201],["T_ELSE","else",201],["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getQuote",202],"(",")",["T_OBJECT_OPERATOR","->",202],["T_STRING","setCheckoutMethod",202],"(",["T_STRING","self",202],["T_DOUBLE_COLON","::",202],["T_STRING","METHOD_REGISTER",202],")",";",["T_WHITESPACE","\n            ",202],"}",["T_WHITESPACE","\n        ",203],"}",["T_WHITESPACE","\n        ",204],["T_RETURN","return",205],["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getQuote",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getCheckoutMethod",205],"(",")",";",["T_WHITESPACE","\n    ",205],"}",["T_WHITESPACE","\n\n    ",206],["T_DOC_COMMENT","\/**\n     * Get quote checkout method\n     *\n     * @deprecated since 1.4.0.1\n     * @return string\n     *\/",208],["T_WHITESPACE","\n    ",213],["T_PUBLIC","public",214],["T_WHITESPACE"," ",214],["T_FUNCTION","function",214],["T_WHITESPACE"," ",214],["T_STRING","getCheckoutMehod",214],"(",")",["T_WHITESPACE","\n    ",214],"{",["T_WHITESPACE","\n        ",215],["T_RETURN","return",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getCheckoutMethod",216],"(",")",";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n\n    ",217],["T_DOC_COMMENT","\/**\n     * Specify checkout method\n     *\n     * @param   string $method\n     * @return  array\n     *\/",219],["T_WHITESPACE","\n    ",224],["T_PUBLIC","public",225],["T_WHITESPACE"," ",225],["T_FUNCTION","function",225],["T_WHITESPACE"," ",225],["T_STRING","saveCheckoutMethod",225],"(",["T_VARIABLE","$method",225],")",["T_WHITESPACE","\n    ",225],"{",["T_WHITESPACE","\n        ",226],["T_IF","if",227],["T_WHITESPACE"," ",227],"(",["T_EMPTY","empty",227],"(",["T_VARIABLE","$method",227],")",")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_ARRAY","array",228],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],"-",["T_LNUMBER","1",228],",",["T_WHITESPACE"," ",228],["T_CONSTANT_ENCAPSED_STRING","'message'",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_STRING","Mage",228],["T_DOUBLE_COLON","::",228],["T_STRING","helper",228],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",228],")",["T_OBJECT_OPERATOR","->",228],["T_STRING","__",228],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid data.'",228],")",")",";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n\n        ",229],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getQuote",231],"(",")",["T_OBJECT_OPERATOR","->",231],["T_STRING","setCheckoutMethod",231],"(",["T_VARIABLE","$method",231],")",["T_OBJECT_OPERATOR","->",231],["T_STRING","save",231],"(",")",";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getCheckout",232],"(",")",["T_OBJECT_OPERATOR","->",232],["T_STRING","setStepData",232],"(",["T_CONSTANT_ENCAPSED_STRING","'billing'",232],",",["T_WHITESPACE"," ",232],["T_CONSTANT_ENCAPSED_STRING","'allow'",232],",",["T_WHITESPACE"," ",232],["T_STRING","true",232],")",";",["T_WHITESPACE","\n        ",232],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_ARRAY","array",233],"(",")",";",["T_WHITESPACE","\n    ",233],"}",["T_WHITESPACE","\n\n    ",234],["T_DOC_COMMENT","\/**\n     * Get customer address by identifier\n     *\n     * @param   int $addressId\n     * @return  Mage_Customer_Model_Address\n     *\/",236],["T_WHITESPACE","\n    ",241],["T_PUBLIC","public",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","getAddress",242],"(",["T_VARIABLE","$addressId",242],")",["T_WHITESPACE","\n    ",242],"{",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$address",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_STRING","Mage",244],["T_DOUBLE_COLON","::",244],["T_STRING","getModel",244],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",244],")",["T_OBJECT_OPERATOR","->",244],["T_STRING","load",244],"(",["T_INT_CAST","(int)",244],["T_VARIABLE","$addressId",244],")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$address",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","explodeStreetAddress",245],"(",")",";",["T_WHITESPACE","\n        ",245],["T_IF","if",246],["T_WHITESPACE"," ",246],"(",["T_VARIABLE","$address",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getRegionId",246],"(",")",")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$address",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","setRegion",247],"(",["T_VARIABLE","$address",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getRegionId",247],"(",")",")",";",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE","\n        ",248],["T_RETURN","return",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$address",249],";",["T_WHITESPACE","\n    ",249],"}",["T_WHITESPACE","\n\n    ",250],["T_DOC_COMMENT","\/**\n     * Save billing address information to quote\n     * This method is called by One Page Checkout JS (AJAX) while saving the billing information.\n     *\n     * @param   array $data\n     * @param   int $customerAddressId\n     * @return  Mage_Checkout_Model_Type_Onepage\n     *\/",252],["T_WHITESPACE","\n    ",259],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","saveBilling",260],"(",["T_VARIABLE","$data",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$customerAddressId",260],")",["T_WHITESPACE","\n    ",260],"{",["T_WHITESPACE","\n        ",261],["T_IF","if",262],["T_WHITESPACE"," ",262],"(",["T_EMPTY","empty",262],"(",["T_VARIABLE","$data",262],")",")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n            ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_ARRAY","array",263],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",263],["T_WHITESPACE"," ",263],["T_DOUBLE_ARROW","=>",263],["T_WHITESPACE"," ",263],"-",["T_LNUMBER","1",263],",",["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","'message'",263],["T_WHITESPACE"," ",263],["T_DOUBLE_ARROW","=>",263],["T_WHITESPACE"," ",263],["T_STRING","Mage",263],["T_DOUBLE_COLON","::",263],["T_STRING","helper",263],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",263],")",["T_OBJECT_OPERATOR","->",263],["T_STRING","__",263],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid data.'",263],")",")",";",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n\n        ",264],["T_VARIABLE","$address",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getQuote",266],"(",")",["T_OBJECT_OPERATOR","->",266],["T_STRING","getBillingAddress",266],"(",")",";",["T_WHITESPACE","\n        ",266],["T_COMMENT","\/* @var $addressForm Mage_Customer_Model_Form *\/",267],["T_WHITESPACE","\n        ",267],["T_VARIABLE","$addressForm",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_STRING","Mage",268],["T_DOUBLE_COLON","::",268],["T_STRING","getModel",268],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",268],")",";",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$addressForm",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","setFormCode",269],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_address_edit'",269],")",["T_WHITESPACE","\n            ",269],["T_OBJECT_OPERATOR","->",270],["T_STRING","setEntityType",270],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_address'",270],")",["T_WHITESPACE","\n            ",270],["T_OBJECT_OPERATOR","->",271],["T_STRING","setIsAjaxRequest",271],"(",["T_STRING","Mage",271],["T_DOUBLE_COLON","::",271],["T_STRING","app",271],"(",")",["T_OBJECT_OPERATOR","->",271],["T_STRING","getRequest",271],"(",")",["T_OBJECT_OPERATOR","->",271],["T_STRING","isAjax",271],"(",")",")",";",["T_WHITESPACE","\n\n        ",271],["T_IF","if",273],["T_WHITESPACE"," ",273],"(","!",["T_EMPTY","empty",273],"(",["T_VARIABLE","$customerAddressId",273],")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$customerAddress",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_STRING","Mage",274],["T_DOUBLE_COLON","::",274],["T_STRING","getModel",274],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",274],")",["T_OBJECT_OPERATOR","->",274],["T_STRING","load",274],"(",["T_VARIABLE","$customerAddressId",274],")",";",["T_WHITESPACE","\n            ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$customerAddress",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getId",275],"(",")",")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n                ",275],["T_IF","if",276],["T_WHITESPACE"," ",276],"(",["T_VARIABLE","$customerAddress",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getCustomerId",276],"(",")",["T_WHITESPACE"," ",276],["T_IS_NOT_EQUAL","!=",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getQuote",276],"(",")",["T_OBJECT_OPERATOR","->",276],["T_STRING","getCustomerId",276],"(",")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n                    ",276],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_ARRAY","array",277],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_LNUMBER","1",277],",",["T_WHITESPACE","\n                        ",277],["T_CONSTANT_ENCAPSED_STRING","'message'",278],["T_WHITESPACE"," ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_STRING","Mage",278],["T_DOUBLE_COLON","::",278],["T_STRING","helper",278],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",278],")",["T_OBJECT_OPERATOR","->",278],["T_STRING","__",278],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer Address is not valid.'",278],")",["T_WHITESPACE","\n                    ",278],")",";",["T_WHITESPACE","\n                ",279],"}",["T_WHITESPACE","\n\n                ",280],["T_VARIABLE","$address",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","importCustomerAddress",282],"(",["T_VARIABLE","$customerAddress",282],")",["T_OBJECT_OPERATOR","->",282],["T_STRING","setSaveInAddressBook",282],"(",["T_LNUMBER","0",282],")",";",["T_WHITESPACE","\n                ",282],["T_VARIABLE","$addressForm",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","setEntity",283],"(",["T_VARIABLE","$address",283],")",";",["T_WHITESPACE","\n                ",283],["T_VARIABLE","$addressErrors",284],["T_WHITESPACE","  ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$addressForm",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","validateData",284],"(",["T_VARIABLE","$address",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getData",284],"(",")",")",";",["T_WHITESPACE","\n                ",284],["T_IF","if",285],["T_WHITESPACE"," ",285],"(",["T_VARIABLE","$addressErrors",285],["T_WHITESPACE"," ",285],["T_IS_NOT_IDENTICAL","!==",285],["T_WHITESPACE"," ",285],["T_STRING","true",285],")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n                    ",285],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_ARRAY","array",286],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",286],["T_WHITESPACE"," ",286],["T_DOUBLE_ARROW","=>",286],["T_WHITESPACE"," ",286],["T_LNUMBER","1",286],",",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","'message'",286],["T_WHITESPACE"," ",286],["T_DOUBLE_ARROW","=>",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$addressErrors",286],")",";",["T_WHITESPACE","\n                ",286],"}",["T_WHITESPACE","\n            ",287],"}",["T_WHITESPACE","\n        ",288],"}",["T_WHITESPACE"," ",289],["T_ELSE","else",289],["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$addressForm",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","setEntity",290],"(",["T_VARIABLE","$address",290],")",";",["T_WHITESPACE","\n            ",290],["T_COMMENT","\/\/ emulate request object\n",291],["T_WHITESPACE","            ",292],["T_VARIABLE","$addressData",292],["T_WHITESPACE","    ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$addressForm",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","extractData",292],"(",["T_VARIABLE","$addressForm",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","prepareRequest",292],"(",["T_VARIABLE","$data",292],")",")",";",["T_WHITESPACE","\n            ",292],["T_VARIABLE","$addressErrors",293],["T_WHITESPACE","  ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$addressForm",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","validateData",293],"(",["T_VARIABLE","$addressData",293],")",";",["T_WHITESPACE","\n            ",293],["T_IF","if",294],["T_WHITESPACE"," ",294],"(",["T_VARIABLE","$addressErrors",294],["T_WHITESPACE"," ",294],["T_IS_NOT_IDENTICAL","!==",294],["T_WHITESPACE"," ",294],["T_STRING","true",294],")",["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n                ",294],["T_RETURN","return",295],["T_WHITESPACE"," ",295],["T_ARRAY","array",295],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",295],["T_WHITESPACE"," ",295],["T_DOUBLE_ARROW","=>",295],["T_WHITESPACE"," ",295],["T_LNUMBER","1",295],",",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","'message'",295],["T_WHITESPACE"," ",295],["T_DOUBLE_ARROW","=>",295],["T_WHITESPACE"," ",295],["T_STRING","array_values",295],"(",["T_VARIABLE","$addressErrors",295],")",")",";",["T_WHITESPACE","\n            ",295],"}",["T_WHITESPACE","\n            ",296],["T_VARIABLE","$addressForm",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","compactData",297],"(",["T_VARIABLE","$addressData",297],")",";",["T_WHITESPACE","\n            ",297],["T_COMMENT","\/\/unset billing address attributes which were not shown in form\n",298],["T_WHITESPACE","            ",299],["T_FOREACH","foreach",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$addressForm",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getAttributes",299],"(",")",["T_WHITESPACE"," ",299],["T_AS","as",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$attribute",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                ",299],["T_IF","if",300],["T_WHITESPACE"," ",300],"(","!",["T_ISSET","isset",300],"(",["T_VARIABLE","$data",300],"[",["T_VARIABLE","$attribute",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getAttributeCode",300],"(",")","]",")",")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n                    ",300],["T_VARIABLE","$address",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","setData",301],"(",["T_VARIABLE","$attribute",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getAttributeCode",301],"(",")",",",["T_WHITESPACE"," ",301],["T_STRING","NULL",301],")",";",["T_WHITESPACE","\n                ",301],"}",["T_WHITESPACE","\n            ",302],"}",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$address",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","setCustomerAddressId",304],"(",["T_STRING","null",304],")",";",["T_WHITESPACE","\n            ",304],["T_COMMENT","\/\/ Additional form data, not fetched by extractData (as it fetches only attributes)\n",305],["T_WHITESPACE","            ",306],["T_VARIABLE","$address",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","setSaveInAddressBook",306],"(",["T_EMPTY","empty",306],"(",["T_VARIABLE","$data",306],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",306],"]",")",["T_WHITESPACE"," ",306],"?",["T_WHITESPACE"," ",306],["T_LNUMBER","0",306],["T_WHITESPACE"," ",306],":",["T_WHITESPACE"," ",306],["T_LNUMBER","1",306],")",";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n\n        ",307],["T_COMMENT","\/\/ set email for newly created user\n",309],["T_WHITESPACE","        ",310],["T_IF","if",310],["T_WHITESPACE"," ",310],"(","!",["T_VARIABLE","$address",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getEmail",310],"(",")",["T_WHITESPACE"," ",310],["T_BOOLEAN_AND","&&",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getQuote",310],"(",")",["T_OBJECT_OPERATOR","->",310],["T_STRING","getCustomerEmail",310],"(",")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_VARIABLE","$address",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","setEmail",311],"(",["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getQuote",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getCustomerEmail",311],"(",")",")",";",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n\n        ",312],["T_COMMENT","\/\/ validate billing address\n",314],["T_WHITESPACE","        ",315],["T_IF","if",315],["T_WHITESPACE"," ",315],"(","(",["T_VARIABLE","$validateRes",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$address",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","validate",315],"(",")",")",["T_WHITESPACE"," ",315],["T_IS_NOT_IDENTICAL","!==",315],["T_WHITESPACE"," ",315],["T_STRING","true",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_RETURN","return",316],["T_WHITESPACE"," ",316],["T_ARRAY","array",316],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",316],["T_WHITESPACE"," ",316],["T_DOUBLE_ARROW","=>",316],["T_WHITESPACE"," ",316],["T_LNUMBER","1",316],",",["T_WHITESPACE"," ",316],["T_CONSTANT_ENCAPSED_STRING","'message'",316],["T_WHITESPACE"," ",316],["T_DOUBLE_ARROW","=>",316],["T_WHITESPACE"," ",316],["T_VARIABLE","$validateRes",316],")",";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE","\n\n        ",317],["T_VARIABLE","$address",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","implodeStreetAddress",319],"(",")",";",["T_WHITESPACE","\n\n        ",319],["T_IF","if",321],["T_WHITESPACE"," ",321],"(",["T_STRING","true",321],["T_WHITESPACE"," ",321],["T_IS_NOT_IDENTICAL","!==",321],["T_WHITESPACE"," ",321],"(",["T_VARIABLE","$result",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_validateCustomerData",321],"(",["T_VARIABLE","$data",321],")",")",")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_RETURN","return",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$result",322],";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE","\n\n        ",323],["T_IF","if",325],["T_WHITESPACE"," ",325],"(","!",["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getQuote",325],"(",")",["T_OBJECT_OPERATOR","->",325],["T_STRING","getCustomerId",325],"(",")",["T_WHITESPACE"," ",325],["T_BOOLEAN_AND","&&",325],["T_WHITESPACE"," ",325],["T_STRING","self",325],["T_DOUBLE_COLON","::",325],["T_STRING","METHOD_REGISTER",325],["T_WHITESPACE"," ",325],["T_IS_EQUAL","==",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getQuote",325],"(",")",["T_OBJECT_OPERATOR","->",325],["T_STRING","getCheckoutMethod",325],"(",")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_IF","if",326],["T_WHITESPACE"," ",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_customerEmailExists",326],"(",["T_VARIABLE","$address",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getEmail",326],"(",")",",",["T_WHITESPACE"," ",326],["T_STRING","Mage",326],["T_DOUBLE_COLON","::",326],["T_STRING","app",326],"(",")",["T_OBJECT_OPERATOR","->",326],["T_STRING","getWebsite",326],"(",")",["T_OBJECT_OPERATOR","->",326],["T_STRING","getId",326],"(",")",")",")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n                ",326],["T_RETURN","return",327],["T_WHITESPACE"," ",327],["T_ARRAY","array",327],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_LNUMBER","1",327],",",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'message'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_customerEmailExistsMessage",327],")",";",["T_WHITESPACE","\n            ",327],"}",["T_WHITESPACE","\n        ",328],"}",["T_WHITESPACE","\n\n        ",329],["T_IF","if",331],["T_WHITESPACE"," ",331],"(","!",["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getQuote",331],"(",")",["T_OBJECT_OPERATOR","->",331],["T_STRING","isVirtual",331],"(",")",")",["T_WHITESPACE"," ",331],"{",["T_WHITESPACE","\n            ",331],["T_DOC_COMMENT","\/**\n             * Billing address using otions\n             *\/",332],["T_WHITESPACE","\n            ",334],["T_VARIABLE","$usingCase",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_ISSET","isset",335],"(",["T_VARIABLE","$data",335],"[",["T_CONSTANT_ENCAPSED_STRING","'use_for_shipping'",335],"]",")",["T_WHITESPACE"," ",335],"?",["T_WHITESPACE"," ",335],["T_INT_CAST","(int)",335],["T_VARIABLE","$data",335],"[",["T_CONSTANT_ENCAPSED_STRING","'use_for_shipping'",335],"]",["T_WHITESPACE"," ",335],":",["T_WHITESPACE"," ",335],["T_LNUMBER","0",335],";",["T_WHITESPACE","\n\n            ",335],["T_SWITCH","switch",337],["T_WHITESPACE"," ",337],"(",["T_VARIABLE","$usingCase",337],")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                ",337],["T_CASE","case",338],["T_WHITESPACE"," ",338],["T_LNUMBER","0",338],":",["T_WHITESPACE","\n                    ",338],["T_VARIABLE","$shipping",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getQuote",339],"(",")",["T_OBJECT_OPERATOR","->",339],["T_STRING","getShippingAddress",339],"(",")",";",["T_WHITESPACE","\n                    ",339],["T_VARIABLE","$shipping",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","setSameAsBilling",340],"(",["T_LNUMBER","0",340],")",";",["T_WHITESPACE","\n                    ",340],["T_BREAK","break",341],";",["T_WHITESPACE","\n                ",341],["T_CASE","case",342],["T_WHITESPACE"," ",342],["T_LNUMBER","1",342],":",["T_WHITESPACE","\n                    ",342],["T_VARIABLE","$billing",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_CLONE","clone",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$address",343],";",["T_WHITESPACE","\n                    ",343],["T_VARIABLE","$billing",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","unsAddressId",344],"(",")",["T_OBJECT_OPERATOR","->",344],["T_STRING","unsAddressType",344],"(",")",";",["T_WHITESPACE","\n                    ",344],["T_VARIABLE","$shipping",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getQuote",345],"(",")",["T_OBJECT_OPERATOR","->",345],["T_STRING","getShippingAddress",345],"(",")",";",["T_WHITESPACE","\n                    ",345],["T_VARIABLE","$shippingMethod",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$shipping",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getShippingMethod",346],"(",")",";",["T_WHITESPACE","\n\n                    ",346],["T_COMMENT","\/\/ Billing address properties that must be always copied to shipping address\n",348],["T_WHITESPACE","                    ",349],["T_VARIABLE","$requiredBillingAttributes",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_ARRAY","array",349],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_address_id'",349],")",";",["T_WHITESPACE","\n\n                    ",349],["T_COMMENT","\/\/ don't reset original shipping data, if it was not changed by customer\n",351],["T_WHITESPACE","                    ",352],["T_FOREACH","foreach",352],["T_WHITESPACE"," ",352],"(",["T_VARIABLE","$shipping",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getData",352],"(",")",["T_WHITESPACE"," ",352],["T_AS","as",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$shippingKey",352],["T_WHITESPACE"," ",352],["T_DOUBLE_ARROW","=>",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$shippingValue",352],")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n                        ",352],["T_IF","if",353],["T_WHITESPACE"," ",353],"(","!",["T_STRING","is_null",353],"(",["T_VARIABLE","$shippingValue",353],")",["T_WHITESPACE"," ",353],["T_BOOLEAN_AND","&&",353],["T_WHITESPACE"," ",353],"!",["T_STRING","is_null",353],"(",["T_VARIABLE","$billing",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getData",353],"(",["T_VARIABLE","$shippingKey",353],")",")",["T_WHITESPACE","\n                            ",353],["T_BOOLEAN_AND","&&",354],["T_WHITESPACE"," ",354],"!",["T_ISSET","isset",354],"(",["T_VARIABLE","$data",354],"[",["T_VARIABLE","$shippingKey",354],"]",")",["T_WHITESPACE"," ",354],["T_BOOLEAN_AND","&&",354],["T_WHITESPACE"," ",354],"!",["T_STRING","in_array",354],"(",["T_VARIABLE","$shippingKey",354],",",["T_WHITESPACE"," ",354],["T_VARIABLE","$requiredBillingAttributes",354],")",["T_WHITESPACE","\n                        ",354],")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n                            ",355],["T_VARIABLE","$billing",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","unsetData",356],"(",["T_VARIABLE","$shippingKey",356],")",";",["T_WHITESPACE","\n                        ",356],"}",["T_WHITESPACE","\n                    ",357],"}",["T_WHITESPACE","\n                    ",358],["T_VARIABLE","$shipping",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","addData",359],"(",["T_VARIABLE","$billing",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getData",359],"(",")",")",["T_WHITESPACE","\n                        ",359],["T_OBJECT_OPERATOR","->",360],["T_STRING","setSameAsBilling",360],"(",["T_LNUMBER","1",360],")",["T_WHITESPACE","\n                        ",360],["T_OBJECT_OPERATOR","->",361],["T_STRING","setSaveInAddressBook",361],"(",["T_LNUMBER","0",361],")",["T_WHITESPACE","\n                        ",361],["T_OBJECT_OPERATOR","->",362],["T_STRING","setShippingMethod",362],"(",["T_VARIABLE","$shippingMethod",362],")",["T_WHITESPACE","\n                        ",362],["T_OBJECT_OPERATOR","->",363],["T_STRING","setCollectShippingRates",363],"(",["T_STRING","true",363],")",";",["T_WHITESPACE","\n                    ",363],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getCheckout",364],"(",")",["T_OBJECT_OPERATOR","->",364],["T_STRING","setStepData",364],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",364],",",["T_WHITESPACE"," ",364],["T_CONSTANT_ENCAPSED_STRING","'complete'",364],",",["T_WHITESPACE"," ",364],["T_STRING","true",364],")",";",["T_WHITESPACE","\n                    ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_setCartCouponCode",365],"(",")",";",["T_WHITESPACE","\n                    ",365],["T_BREAK","break",366],";",["T_WHITESPACE","\n            ",366],"}",["T_WHITESPACE","\n        ",367],"}",["T_WHITESPACE","\n\n        ",368],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getQuote",370],"(",")",["T_OBJECT_OPERATOR","->",370],["T_STRING","collectTotals",370],"(",")",";",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getQuote",371],"(",")",["T_OBJECT_OPERATOR","->",371],["T_STRING","save",371],"(",")",";",["T_WHITESPACE","\n\n        ",371],["T_IF","if",373],["T_WHITESPACE"," ",373],"(","!",["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getQuote",373],"(",")",["T_OBJECT_OPERATOR","->",373],["T_STRING","isVirtual",373],"(",")",["T_WHITESPACE"," ",373],["T_BOOLEAN_AND","&&",373],["T_WHITESPACE"," ",373],["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getCheckout",373],"(",")",["T_OBJECT_OPERATOR","->",373],["T_STRING","getStepData",373],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",373],",",["T_WHITESPACE"," ",373],["T_CONSTANT_ENCAPSED_STRING","'complete'",373],")",["T_WHITESPACE"," ",373],["T_IS_EQUAL","==",373],["T_WHITESPACE"," ",373],["T_STRING","true",373],")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n            ",373],["T_COMMENT","\/\/Recollect Shipping rates for shipping methods\n",374],["T_WHITESPACE","            ",375],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getQuote",375],"(",")",["T_OBJECT_OPERATOR","->",375],["T_STRING","getShippingAddress",375],"(",")",["T_OBJECT_OPERATOR","->",375],["T_STRING","setCollectShippingRates",375],"(",["T_STRING","true",375],")",";",["T_WHITESPACE","\n        ",375],"}",["T_WHITESPACE","\n\n        ",376],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getCheckout",378],"(",")",["T_WHITESPACE","\n            ",378],["T_OBJECT_OPERATOR","->",379],["T_STRING","setStepData",379],"(",["T_CONSTANT_ENCAPSED_STRING","'billing'",379],",",["T_WHITESPACE"," ",379],["T_CONSTANT_ENCAPSED_STRING","'allow'",379],",",["T_WHITESPACE"," ",379],["T_STRING","true",379],")",["T_WHITESPACE","\n            ",379],["T_OBJECT_OPERATOR","->",380],["T_STRING","setStepData",380],"(",["T_CONSTANT_ENCAPSED_STRING","'billing'",380],",",["T_WHITESPACE"," ",380],["T_CONSTANT_ENCAPSED_STRING","'complete'",380],",",["T_WHITESPACE"," ",380],["T_STRING","true",380],")",["T_WHITESPACE","\n            ",380],["T_OBJECT_OPERATOR","->",381],["T_STRING","setStepData",381],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",381],",",["T_WHITESPACE"," ",381],["T_CONSTANT_ENCAPSED_STRING","'allow'",381],",",["T_WHITESPACE"," ",381],["T_STRING","true",381],")",";",["T_WHITESPACE","\n\n        ",381],["T_RETURN","return",383],["T_WHITESPACE"," ",383],["T_ARRAY","array",383],"(",")",";",["T_WHITESPACE","\n    ",383],"}",["T_WHITESPACE","\n\n    ",384],["T_DOC_COMMENT","\/**\n     * Validate customer data and set some its data for further usage in quote\n     * Will return either true or array with error messages\n     *\n     * @param array $data\n     * @return true|array\n     *\/",386],["T_WHITESPACE","\n    ",392],["T_PROTECTED","protected",393],["T_WHITESPACE"," ",393],["T_FUNCTION","function",393],["T_WHITESPACE"," ",393],["T_STRING","_validateCustomerData",393],"(",["T_ARRAY","array",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$data",393],")",["T_WHITESPACE","\n    ",393],"{",["T_WHITESPACE","\n        ",394],["T_DOC_COMMENT","\/** @var $customerForm Mage_Customer_Model_Form *\/",395],["T_WHITESPACE","\n        ",395],["T_VARIABLE","$customerForm",396],["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_STRING","Mage",396],["T_DOUBLE_COLON","::",396],["T_STRING","getModel",396],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",396],")",";",["T_WHITESPACE","\n        ",396],["T_VARIABLE","$customerForm",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","setFormCode",397],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_register'",397],")",["T_WHITESPACE","\n            ",397],["T_OBJECT_OPERATOR","->",398],["T_STRING","setIsAjaxRequest",398],"(",["T_STRING","Mage",398],["T_DOUBLE_COLON","::",398],["T_STRING","app",398],"(",")",["T_OBJECT_OPERATOR","->",398],["T_STRING","getRequest",398],"(",")",["T_OBJECT_OPERATOR","->",398],["T_STRING","isAjax",398],"(",")",")",";",["T_WHITESPACE","\n\n        ",398],["T_VARIABLE","$quote",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getQuote",400],"(",")",";",["T_WHITESPACE","\n        ",400],["T_IF","if",401],["T_WHITESPACE"," ",401],"(",["T_VARIABLE","$quote",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getCustomerId",401],"(",")",")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n            ",401],["T_VARIABLE","$customer",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_VARIABLE","$quote",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","getCustomer",402],"(",")",";",["T_WHITESPACE","\n            ",402],["T_VARIABLE","$customerForm",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","setEntity",403],"(",["T_VARIABLE","$customer",403],")",";",["T_WHITESPACE","\n            ",403],["T_VARIABLE","$customerData",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_VARIABLE","$quote",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","getCustomer",404],"(",")",["T_OBJECT_OPERATOR","->",404],["T_STRING","getData",404],"(",")",";",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE"," ",405],["T_ELSE","else",405],["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n            ",405],["T_COMMENT","\/* @var $customer Mage_Customer_Model_Customer *\/",406],["T_WHITESPACE","\n            ",406],["T_VARIABLE","$customer",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_STRING","Mage",407],["T_DOUBLE_COLON","::",407],["T_STRING","getModel",407],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",407],")",";",["T_WHITESPACE","\n            ",407],["T_VARIABLE","$customerForm",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","setEntity",408],"(",["T_VARIABLE","$customer",408],")",";",["T_WHITESPACE","\n            ",408],["T_VARIABLE","$customerRequest",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_VARIABLE","$customerForm",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","prepareRequest",409],"(",["T_VARIABLE","$data",409],")",";",["T_WHITESPACE","\n            ",409],["T_VARIABLE","$customerData",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$customerForm",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","extractData",410],"(",["T_VARIABLE","$customerRequest",410],")",";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n\n        ",411],["T_VARIABLE","$customerErrors",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$customerForm",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","validateData",413],"(",["T_VARIABLE","$customerData",413],")",";",["T_WHITESPACE","\n        ",413],["T_IF","if",414],["T_WHITESPACE"," ",414],"(",["T_VARIABLE","$customerErrors",414],["T_WHITESPACE"," ",414],["T_IS_NOT_IDENTICAL","!==",414],["T_WHITESPACE"," ",414],["T_STRING","true",414],")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n            ",414],["T_RETURN","return",415],["T_WHITESPACE"," ",415],["T_ARRAY","array",415],"(",["T_WHITESPACE","\n                ",415],["T_CONSTANT_ENCAPSED_STRING","'error'",416],["T_WHITESPACE","     ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],"-",["T_LNUMBER","1",416],",",["T_WHITESPACE","\n                ",416],["T_CONSTANT_ENCAPSED_STRING","'message'",417],["T_WHITESPACE","   ",417],["T_DOUBLE_ARROW","=>",417],["T_WHITESPACE"," ",417],["T_STRING","implode",417],"(",["T_CONSTANT_ENCAPSED_STRING","', '",417],",",["T_WHITESPACE"," ",417],["T_VARIABLE","$customerErrors",417],")",["T_WHITESPACE","\n            ",417],")",";",["T_WHITESPACE","\n        ",418],"}",["T_WHITESPACE","\n\n        ",419],["T_IF","if",421],["T_WHITESPACE"," ",421],"(",["T_VARIABLE","$quote",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getCustomerId",421],"(",")",")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n            ",421],["T_RETURN","return",422],["T_WHITESPACE"," ",422],["T_STRING","true",422],";",["T_WHITESPACE","\n        ",422],"}",["T_WHITESPACE","\n\n        ",423],["T_VARIABLE","$customerForm",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","compactData",425],"(",["T_VARIABLE","$customerData",425],")",";",["T_WHITESPACE","\n\n        ",425],["T_IF","if",427],["T_WHITESPACE"," ",427],"(",["T_VARIABLE","$quote",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getCheckoutMethod",427],"(",")",["T_WHITESPACE"," ",427],["T_IS_EQUAL","==",427],["T_WHITESPACE"," ",427],["T_STRING","self",427],["T_DOUBLE_COLON","::",427],["T_STRING","METHOD_REGISTER",427],")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n            ",427],["T_COMMENT","\/\/ set customer password\n",428],["T_WHITESPACE","            ",429],["T_VARIABLE","$customer",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","setPassword",429],"(",["T_VARIABLE","$customerRequest",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getParam",429],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_password'",429],")",")",";",["T_WHITESPACE","\n            ",429],["T_VARIABLE","$customer",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","setPasswordConfirmation",430],"(",["T_VARIABLE","$customerRequest",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getParam",430],"(",["T_CONSTANT_ENCAPSED_STRING","'confirm_password'",430],")",")",";",["T_WHITESPACE","\n        ",430],"}",["T_WHITESPACE"," ",431],["T_ELSE","else",431],["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n            ",431],["T_COMMENT","\/\/ spoof customer password for guest\n",432],["T_WHITESPACE","            ",433],["T_VARIABLE","$password",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_VARIABLE","$customer",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","generatePassword",433],"(",")",";",["T_WHITESPACE","\n            ",433],["T_VARIABLE","$customer",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","setPassword",434],"(",["T_VARIABLE","$password",434],")",";",["T_WHITESPACE","\n            ",434],["T_VARIABLE","$customer",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","setPasswordConfirmation",435],"(",["T_VARIABLE","$password",435],")",";",["T_WHITESPACE","\n            ",435],["T_COMMENT","\/\/ set NOT LOGGED IN group id explicitly,\n",436],["T_WHITESPACE","            ",437],["T_COMMENT","\/\/ otherwise copyFieldset('customer_account', 'to_quote') will fill it with default group id value\n",437],["T_WHITESPACE","            ",438],["T_VARIABLE","$customer",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","setGroupId",438],"(",["T_STRING","Mage_Customer_Model_Group",438],["T_DOUBLE_COLON","::",438],["T_STRING","NOT_LOGGED_IN_ID",438],")",";",["T_WHITESPACE","\n        ",438],"}",["T_WHITESPACE","\n\n        ",439],["T_VARIABLE","$result",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$customer",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","validate",441],"(",")",";",["T_WHITESPACE","\n        ",441],["T_IF","if",442],["T_WHITESPACE"," ",442],"(",["T_STRING","true",442],["T_WHITESPACE"," ",442],["T_IS_NOT_IDENTICAL","!==",442],["T_WHITESPACE"," ",442],["T_VARIABLE","$result",442],["T_WHITESPACE"," ",442],["T_BOOLEAN_AND","&&",442],["T_WHITESPACE"," ",442],["T_STRING","is_array",442],"(",["T_VARIABLE","$result",442],")",")",["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n            ",442],["T_RETURN","return",443],["T_WHITESPACE"," ",443],["T_ARRAY","array",443],"(",["T_WHITESPACE","\n                ",443],["T_CONSTANT_ENCAPSED_STRING","'error'",444],["T_WHITESPACE","   ",444],["T_DOUBLE_ARROW","=>",444],["T_WHITESPACE"," ",444],"-",["T_LNUMBER","1",444],",",["T_WHITESPACE","\n                ",444],["T_CONSTANT_ENCAPSED_STRING","'message'",445],["T_WHITESPACE"," ",445],["T_DOUBLE_ARROW","=>",445],["T_WHITESPACE"," ",445],["T_STRING","implode",445],"(",["T_CONSTANT_ENCAPSED_STRING","', '",445],",",["T_WHITESPACE"," ",445],["T_VARIABLE","$result",445],")",["T_WHITESPACE","\n            ",445],")",";",["T_WHITESPACE","\n        ",446],"}",["T_WHITESPACE","\n\n        ",447],["T_IF","if",449],["T_WHITESPACE"," ",449],"(",["T_VARIABLE","$quote",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getCheckoutMethod",449],"(",")",["T_WHITESPACE"," ",449],["T_IS_EQUAL","==",449],["T_WHITESPACE"," ",449],["T_STRING","self",449],["T_DOUBLE_COLON","::",449],["T_STRING","METHOD_REGISTER",449],")",["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_COMMENT","\/\/ save customer encrypted password in quote\n",450],["T_WHITESPACE","            ",451],["T_VARIABLE","$quote",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","setPasswordHash",451],"(",["T_VARIABLE","$customer",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","encryptPassword",451],"(",["T_VARIABLE","$customer",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getPassword",451],"(",")",")",")",";",["T_WHITESPACE","\n        ",451],"}",["T_WHITESPACE","\n\n        ",452],["T_COMMENT","\/\/ copy customer\/guest email to address\n",454],["T_WHITESPACE","        ",455],["T_VARIABLE","$quote",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","getBillingAddress",455],"(",")",["T_OBJECT_OPERATOR","->",455],["T_STRING","setEmail",455],"(",["T_VARIABLE","$customer",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","getEmail",455],"(",")",")",";",["T_WHITESPACE","\n\n        ",455],["T_COMMENT","\/\/ copy customer data to quote\n",457],["T_WHITESPACE","        ",458],["T_STRING","Mage",458],["T_DOUBLE_COLON","::",458],["T_STRING","helper",458],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",458],")",["T_OBJECT_OPERATOR","->",458],["T_STRING","copyFieldset",458],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_account'",458],",",["T_WHITESPACE"," ",458],["T_CONSTANT_ENCAPSED_STRING","'to_quote'",458],",",["T_WHITESPACE"," ",458],["T_VARIABLE","$customer",458],",",["T_WHITESPACE"," ",458],["T_VARIABLE","$quote",458],")",";",["T_WHITESPACE","\n\n        ",458],["T_RETURN","return",460],["T_WHITESPACE"," ",460],["T_STRING","true",460],";",["T_WHITESPACE","\n    ",460],"}",["T_WHITESPACE","\n\n    ",461],["T_DOC_COMMENT","\/**\n     * Validate customer data and set some its data for further usage in quote\n     * Will return either true or array with error messages\n     *\n     * @deprecated since 1.4.0.1\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @return true|array\n     *\/",463],["T_WHITESPACE","\n    ",470],["T_PROTECTED","protected",471],["T_WHITESPACE"," ",471],["T_FUNCTION","function",471],["T_WHITESPACE"," ",471],["T_STRING","_processValidateCustomer",471],"(",["T_STRING","Mage_Sales_Model_Quote_Address",471],["T_WHITESPACE"," ",471],["T_VARIABLE","$address",471],")",["T_WHITESPACE","\n    ",471],"{",["T_WHITESPACE","\n        ",472],["T_COMMENT","\/\/ set customer date of birth for further usage\n",473],["T_WHITESPACE","        ",474],["T_VARIABLE","$dob",474],["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],["T_CONSTANT_ENCAPSED_STRING","''",474],";",["T_WHITESPACE","\n        ",474],["T_IF","if",475],["T_WHITESPACE"," ",475],"(",["T_VARIABLE","$address",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","getDob",475],"(",")",")",["T_WHITESPACE"," ",475],"{",["T_WHITESPACE","\n            ",475],["T_VARIABLE","$dob",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_STRING","Mage",476],["T_DOUBLE_COLON","::",476],["T_STRING","app",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","getLocale",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","date",476],"(",["T_VARIABLE","$address",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getDob",476],"(",")",",",["T_WHITESPACE"," ",476],["T_STRING","null",476],",",["T_WHITESPACE"," ",476],["T_STRING","null",476],",",["T_WHITESPACE"," ",476],["T_STRING","false",476],")",["T_OBJECT_OPERATOR","->",476],["T_STRING","toString",476],"(",["T_CONSTANT_ENCAPSED_STRING","'yyyy-MM-dd'",476],")",";",["T_WHITESPACE","\n            ",476],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getQuote",477],"(",")",["T_OBJECT_OPERATOR","->",477],["T_STRING","setCustomerDob",477],"(",["T_VARIABLE","$dob",477],")",";",["T_WHITESPACE","\n        ",477],"}",["T_WHITESPACE","\n\n        ",478],["T_COMMENT","\/\/ set customer tax\/vat number for further usage\n",480],["T_WHITESPACE","        ",481],["T_IF","if",481],["T_WHITESPACE"," ",481],"(",["T_VARIABLE","$address",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getTaxvat",481],"(",")",")",["T_WHITESPACE"," ",481],"{",["T_WHITESPACE","\n            ",481],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getQuote",482],"(",")",["T_OBJECT_OPERATOR","->",482],["T_STRING","setCustomerTaxvat",482],"(",["T_VARIABLE","$address",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getTaxvat",482],"(",")",")",";",["T_WHITESPACE","\n        ",482],"}",["T_WHITESPACE","\n\n        ",483],["T_COMMENT","\/\/ set customer gender for further usage\n",485],["T_WHITESPACE","        ",486],["T_IF","if",486],["T_WHITESPACE"," ",486],"(",["T_VARIABLE","$address",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getGender",486],"(",")",")",["T_WHITESPACE"," ",486],"{",["T_WHITESPACE","\n            ",486],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getQuote",487],"(",")",["T_OBJECT_OPERATOR","->",487],["T_STRING","setCustomerGender",487],"(",["T_VARIABLE","$address",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getGender",487],"(",")",")",";",["T_WHITESPACE","\n        ",487],"}",["T_WHITESPACE","\n\n        ",488],["T_COMMENT","\/\/ invoke customer model, if it is registering\n",490],["T_WHITESPACE","        ",491],["T_IF","if",491],["T_WHITESPACE"," ",491],"(",["T_STRING","self",491],["T_DOUBLE_COLON","::",491],["T_STRING","METHOD_REGISTER",491],["T_WHITESPACE"," ",491],["T_IS_EQUAL","==",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$this",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getQuote",491],"(",")",["T_OBJECT_OPERATOR","->",491],["T_STRING","getCheckoutMethod",491],"(",")",")",["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n            ",491],["T_COMMENT","\/\/ set customer password hash for further usage\n",492],["T_WHITESPACE","            ",493],["T_VARIABLE","$customer",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_STRING","Mage",493],["T_DOUBLE_COLON","::",493],["T_STRING","getModel",493],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",493],")",";",["T_WHITESPACE","\n            ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getQuote",494],"(",")",["T_OBJECT_OPERATOR","->",494],["T_STRING","setPasswordHash",494],"(",["T_VARIABLE","$customer",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","encryptPassword",494],"(",["T_VARIABLE","$address",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getCustomerPassword",494],"(",")",")",")",";",["T_WHITESPACE","\n\n            ",494],["T_COMMENT","\/\/ validate customer\n",496],["T_WHITESPACE","            ",497],["T_FOREACH","foreach",497],["T_WHITESPACE"," ",497],"(",["T_ARRAY","array",497],"(",["T_WHITESPACE","\n                ",497],["T_CONSTANT_ENCAPSED_STRING","'firstname'",498],["T_WHITESPACE","    ",498],["T_DOUBLE_ARROW","=>",498],["T_WHITESPACE"," ",498],["T_CONSTANT_ENCAPSED_STRING","'firstname'",498],",",["T_WHITESPACE","\n                ",498],["T_CONSTANT_ENCAPSED_STRING","'lastname'",499],["T_WHITESPACE","     ",499],["T_DOUBLE_ARROW","=>",499],["T_WHITESPACE"," ",499],["T_CONSTANT_ENCAPSED_STRING","'lastname'",499],",",["T_WHITESPACE","\n                ",499],["T_CONSTANT_ENCAPSED_STRING","'email'",500],["T_WHITESPACE","        ",500],["T_DOUBLE_ARROW","=>",500],["T_WHITESPACE"," ",500],["T_CONSTANT_ENCAPSED_STRING","'email'",500],",",["T_WHITESPACE","\n                ",500],["T_CONSTANT_ENCAPSED_STRING","'password'",501],["T_WHITESPACE","     ",501],["T_DOUBLE_ARROW","=>",501],["T_WHITESPACE"," ",501],["T_CONSTANT_ENCAPSED_STRING","'customer_password'",501],",",["T_WHITESPACE","\n                ",501],["T_CONSTANT_ENCAPSED_STRING","'confirmation'",502],["T_WHITESPACE"," ",502],["T_DOUBLE_ARROW","=>",502],["T_WHITESPACE"," ",502],["T_CONSTANT_ENCAPSED_STRING","'confirm_password'",502],",",["T_WHITESPACE","\n                ",502],["T_CONSTANT_ENCAPSED_STRING","'taxvat'",503],["T_WHITESPACE","       ",503],["T_DOUBLE_ARROW","=>",503],["T_WHITESPACE"," ",503],["T_CONSTANT_ENCAPSED_STRING","'taxvat'",503],",",["T_WHITESPACE","\n                ",503],["T_CONSTANT_ENCAPSED_STRING","'gender'",504],["T_WHITESPACE","       ",504],["T_DOUBLE_ARROW","=>",504],["T_WHITESPACE"," ",504],["T_CONSTANT_ENCAPSED_STRING","'gender'",504],",",["T_WHITESPACE","\n            ",504],")",["T_WHITESPACE"," ",505],["T_AS","as",505],["T_WHITESPACE"," ",505],["T_VARIABLE","$key",505],["T_WHITESPACE"," ",505],["T_DOUBLE_ARROW","=>",505],["T_WHITESPACE"," ",505],["T_VARIABLE","$dataKey",505],")",["T_WHITESPACE"," ",505],"{",["T_WHITESPACE","\n                ",505],["T_VARIABLE","$customer",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","setData",506],"(",["T_VARIABLE","$key",506],",",["T_WHITESPACE"," ",506],["T_VARIABLE","$address",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getData",506],"(",["T_VARIABLE","$dataKey",506],")",")",";",["T_WHITESPACE","\n            ",506],"}",["T_WHITESPACE","\n            ",507],["T_IF","if",508],["T_WHITESPACE"," ",508],"(",["T_VARIABLE","$dob",508],")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n                ",508],["T_VARIABLE","$customer",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","setDob",509],"(",["T_VARIABLE","$dob",509],")",";",["T_WHITESPACE","\n            ",509],"}",["T_WHITESPACE","\n            ",510],["T_VARIABLE","$validationResult",511],["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_VARIABLE","$customer",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","validate",511],"(",")",";",["T_WHITESPACE","\n            ",511],["T_IF","if",512],["T_WHITESPACE"," ",512],"(",["T_STRING","true",512],["T_WHITESPACE"," ",512],["T_IS_NOT_IDENTICAL","!==",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$validationResult",512],["T_WHITESPACE"," ",512],["T_BOOLEAN_AND","&&",512],["T_WHITESPACE"," ",512],["T_STRING","is_array",512],"(",["T_VARIABLE","$validationResult",512],")",")",["T_WHITESPACE"," ",512],"{",["T_WHITESPACE","\n                ",512],["T_RETURN","return",513],["T_WHITESPACE"," ",513],["T_ARRAY","array",513],"(",["T_WHITESPACE","\n                    ",513],["T_CONSTANT_ENCAPSED_STRING","'error'",514],["T_WHITESPACE","   ",514],["T_DOUBLE_ARROW","=>",514],["T_WHITESPACE"," ",514],"-",["T_LNUMBER","1",514],",",["T_WHITESPACE","\n                    ",514],["T_CONSTANT_ENCAPSED_STRING","'message'",515],["T_WHITESPACE"," ",515],["T_DOUBLE_ARROW","=>",515],["T_WHITESPACE"," ",515],["T_STRING","implode",515],"(",["T_CONSTANT_ENCAPSED_STRING","', '",515],",",["T_WHITESPACE"," ",515],["T_VARIABLE","$validationResult",515],")",["T_WHITESPACE","\n                ",515],")",";",["T_WHITESPACE","\n            ",516],"}",["T_WHITESPACE","\n        ",517],"}",["T_WHITESPACE"," ",518],["T_ELSE","else",518],["T_WHITESPACE"," ",518],["T_IF","if",518],["T_WHITESPACE"," ",518],"(",["T_STRING","self",518],["T_DOUBLE_COLON","::",518],["T_STRING","METHOD_GUEST",518],["T_WHITESPACE"," ",518],["T_IS_EQUAL","==",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getQuote",518],"(",")",["T_OBJECT_OPERATOR","->",518],["T_STRING","getCheckoutMethod",518],"(",")",")",["T_WHITESPACE"," ",518],"{",["T_WHITESPACE","\n            ",518],["T_VARIABLE","$email",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_VARIABLE","$address",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getData",519],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",519],")",";",["T_WHITESPACE","\n            ",519],["T_IF","if",520],["T_WHITESPACE"," ",520],"(","!",["T_STRING","Zend_Validate",520],["T_DOUBLE_COLON","::",520],["T_STRING","is",520],"(",["T_VARIABLE","$email",520],",",["T_WHITESPACE"," ",520],["T_CONSTANT_ENCAPSED_STRING","'EmailAddress'",520],")",")",["T_WHITESPACE"," ",520],"{",["T_WHITESPACE","\n                ",520],["T_RETURN","return",521],["T_WHITESPACE"," ",521],["T_ARRAY","array",521],"(",["T_WHITESPACE","\n                    ",521],["T_CONSTANT_ENCAPSED_STRING","'error'",522],["T_WHITESPACE","   ",522],["T_DOUBLE_ARROW","=>",522],["T_WHITESPACE"," ",522],"-",["T_LNUMBER","1",522],",",["T_WHITESPACE","\n                    ",522],["T_CONSTANT_ENCAPSED_STRING","'message'",523],["T_WHITESPACE"," ",523],["T_DOUBLE_ARROW","=>",523],["T_WHITESPACE"," ",523],["T_STRING","Mage",523],["T_DOUBLE_COLON","::",523],["T_STRING","helper",523],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",523],")",["T_OBJECT_OPERATOR","->",523],["T_STRING","__",523],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid email address \"%s\"'",523],",",["T_WHITESPACE"," ",523],["T_VARIABLE","$email",523],")",["T_WHITESPACE","\n                ",523],")",";",["T_WHITESPACE","\n            ",524],"}",["T_WHITESPACE","\n        ",525],"}",["T_WHITESPACE","\n\n        ",526],["T_RETURN","return",528],["T_WHITESPACE"," ",528],["T_STRING","true",528],";",["T_WHITESPACE","\n    ",528],"}",["T_WHITESPACE","\n\n    ",529],["T_DOC_COMMENT","\/**\n     * Save checkout shipping address\n     *\n     * @param   array $data\n     * @param   int $customerAddressId\n     * @return  Mage_Checkout_Model_Type_Onepage\n     *\/",531],["T_WHITESPACE","\n    ",537],["T_PUBLIC","public",538],["T_WHITESPACE"," ",538],["T_FUNCTION","function",538],["T_WHITESPACE"," ",538],["T_STRING","saveShipping",538],"(",["T_VARIABLE","$data",538],",",["T_WHITESPACE"," ",538],["T_VARIABLE","$customerAddressId",538],")",["T_WHITESPACE","\n    ",538],"{",["T_WHITESPACE","\n        ",539],["T_IF","if",540],["T_WHITESPACE"," ",540],"(",["T_EMPTY","empty",540],"(",["T_VARIABLE","$data",540],")",")",["T_WHITESPACE"," ",540],"{",["T_WHITESPACE","\n            ",540],["T_RETURN","return",541],["T_WHITESPACE"," ",541],["T_ARRAY","array",541],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",541],["T_WHITESPACE"," ",541],["T_DOUBLE_ARROW","=>",541],["T_WHITESPACE"," ",541],"-",["T_LNUMBER","1",541],",",["T_WHITESPACE"," ",541],["T_CONSTANT_ENCAPSED_STRING","'message'",541],["T_WHITESPACE"," ",541],["T_DOUBLE_ARROW","=>",541],["T_WHITESPACE"," ",541],["T_STRING","Mage",541],["T_DOUBLE_COLON","::",541],["T_STRING","helper",541],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",541],")",["T_OBJECT_OPERATOR","->",541],["T_STRING","__",541],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid data.'",541],")",")",";",["T_WHITESPACE","\n        ",541],"}",["T_WHITESPACE","\n        ",542],["T_VARIABLE","$address",543],["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_VARIABLE","$this",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","getQuote",543],"(",")",["T_OBJECT_OPERATOR","->",543],["T_STRING","getShippingAddress",543],"(",")",";",["T_WHITESPACE","\n\n        ",543],["T_COMMENT","\/* @var $addressForm Mage_Customer_Model_Form *\/",545],["T_WHITESPACE","\n        ",545],["T_VARIABLE","$addressForm",546],["T_WHITESPACE","    ",546],"=",["T_WHITESPACE"," ",546],["T_STRING","Mage",546],["T_DOUBLE_COLON","::",546],["T_STRING","getModel",546],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",546],")",";",["T_WHITESPACE","\n        ",546],["T_VARIABLE","$addressForm",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","setFormCode",547],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_address_edit'",547],")",["T_WHITESPACE","\n            ",547],["T_OBJECT_OPERATOR","->",548],["T_STRING","setEntityType",548],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_address'",548],")",["T_WHITESPACE","\n            ",548],["T_OBJECT_OPERATOR","->",549],["T_STRING","setIsAjaxRequest",549],"(",["T_STRING","Mage",549],["T_DOUBLE_COLON","::",549],["T_STRING","app",549],"(",")",["T_OBJECT_OPERATOR","->",549],["T_STRING","getRequest",549],"(",")",["T_OBJECT_OPERATOR","->",549],["T_STRING","isAjax",549],"(",")",")",";",["T_WHITESPACE","\n\n        ",549],["T_IF","if",551],["T_WHITESPACE"," ",551],"(","!",["T_EMPTY","empty",551],"(",["T_VARIABLE","$customerAddressId",551],")",")",["T_WHITESPACE"," ",551],"{",["T_WHITESPACE","\n            ",551],["T_VARIABLE","$customerAddress",552],["T_WHITESPACE"," ",552],"=",["T_WHITESPACE"," ",552],["T_STRING","Mage",552],["T_DOUBLE_COLON","::",552],["T_STRING","getModel",552],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",552],")",["T_OBJECT_OPERATOR","->",552],["T_STRING","load",552],"(",["T_VARIABLE","$customerAddressId",552],")",";",["T_WHITESPACE","\n            ",552],["T_IF","if",553],["T_WHITESPACE"," ",553],"(",["T_VARIABLE","$customerAddress",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","getId",553],"(",")",")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n                ",553],["T_IF","if",554],["T_WHITESPACE"," ",554],"(",["T_VARIABLE","$customerAddress",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","getCustomerId",554],"(",")",["T_WHITESPACE"," ",554],["T_IS_NOT_EQUAL","!=",554],["T_WHITESPACE"," ",554],["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","getQuote",554],"(",")",["T_OBJECT_OPERATOR","->",554],["T_STRING","getCustomerId",554],"(",")",")",["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n                    ",554],["T_RETURN","return",555],["T_WHITESPACE"," ",555],["T_ARRAY","array",555],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",555],["T_WHITESPACE"," ",555],["T_DOUBLE_ARROW","=>",555],["T_WHITESPACE"," ",555],["T_LNUMBER","1",555],",",["T_WHITESPACE","\n                        ",555],["T_CONSTANT_ENCAPSED_STRING","'message'",556],["T_WHITESPACE"," ",556],["T_DOUBLE_ARROW","=>",556],["T_WHITESPACE"," ",556],["T_STRING","Mage",556],["T_DOUBLE_COLON","::",556],["T_STRING","helper",556],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",556],")",["T_OBJECT_OPERATOR","->",556],["T_STRING","__",556],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer Address is not valid.'",556],")",["T_WHITESPACE","\n                    ",556],")",";",["T_WHITESPACE","\n                ",557],"}",["T_WHITESPACE","\n\n                ",558],["T_VARIABLE","$address",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","importCustomerAddress",560],"(",["T_VARIABLE","$customerAddress",560],")",["T_OBJECT_OPERATOR","->",560],["T_STRING","setSaveInAddressBook",560],"(",["T_LNUMBER","0",560],")",";",["T_WHITESPACE","\n                ",560],["T_VARIABLE","$addressForm",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","setEntity",561],"(",["T_VARIABLE","$address",561],")",";",["T_WHITESPACE","\n                ",561],["T_VARIABLE","$addressErrors",562],["T_WHITESPACE","  ",562],"=",["T_WHITESPACE"," ",562],["T_VARIABLE","$addressForm",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","validateData",562],"(",["T_VARIABLE","$address",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","getData",562],"(",")",")",";",["T_WHITESPACE","\n                ",562],["T_IF","if",563],["T_WHITESPACE"," ",563],"(",["T_VARIABLE","$addressErrors",563],["T_WHITESPACE"," ",563],["T_IS_NOT_IDENTICAL","!==",563],["T_WHITESPACE"," ",563],["T_STRING","true",563],")",["T_WHITESPACE"," ",563],"{",["T_WHITESPACE","\n                    ",563],["T_RETURN","return",564],["T_WHITESPACE"," ",564],["T_ARRAY","array",564],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",564],["T_WHITESPACE"," ",564],["T_DOUBLE_ARROW","=>",564],["T_WHITESPACE"," ",564],["T_LNUMBER","1",564],",",["T_WHITESPACE"," ",564],["T_CONSTANT_ENCAPSED_STRING","'message'",564],["T_WHITESPACE"," ",564],["T_DOUBLE_ARROW","=>",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$addressErrors",564],")",";",["T_WHITESPACE","\n                ",564],"}",["T_WHITESPACE","\n            ",565],"}",["T_WHITESPACE","\n        ",566],"}",["T_WHITESPACE"," ",567],["T_ELSE","else",567],["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n            ",567],["T_VARIABLE","$addressForm",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","setEntity",568],"(",["T_VARIABLE","$address",568],")",";",["T_WHITESPACE","\n            ",568],["T_COMMENT","\/\/ emulate request object\n",569],["T_WHITESPACE","            ",570],["T_VARIABLE","$addressData",570],["T_WHITESPACE","    ",570],"=",["T_WHITESPACE"," ",570],["T_VARIABLE","$addressForm",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","extractData",570],"(",["T_VARIABLE","$addressForm",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","prepareRequest",570],"(",["T_VARIABLE","$data",570],")",")",";",["T_WHITESPACE","\n            ",570],["T_VARIABLE","$addressErrors",571],["T_WHITESPACE","  ",571],"=",["T_WHITESPACE"," ",571],["T_VARIABLE","$addressForm",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","validateData",571],"(",["T_VARIABLE","$addressData",571],")",";",["T_WHITESPACE","\n            ",571],["T_IF","if",572],["T_WHITESPACE"," ",572],"(",["T_VARIABLE","$addressErrors",572],["T_WHITESPACE"," ",572],["T_IS_NOT_IDENTICAL","!==",572],["T_WHITESPACE"," ",572],["T_STRING","true",572],")",["T_WHITESPACE"," ",572],"{",["T_WHITESPACE","\n                ",572],["T_RETURN","return",573],["T_WHITESPACE"," ",573],["T_ARRAY","array",573],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",573],["T_WHITESPACE"," ",573],["T_DOUBLE_ARROW","=>",573],["T_WHITESPACE"," ",573],["T_LNUMBER","1",573],",",["T_WHITESPACE"," ",573],["T_CONSTANT_ENCAPSED_STRING","'message'",573],["T_WHITESPACE"," ",573],["T_DOUBLE_ARROW","=>",573],["T_WHITESPACE"," ",573],["T_VARIABLE","$addressErrors",573],")",";",["T_WHITESPACE","\n            ",573],"}",["T_WHITESPACE","\n            ",574],["T_VARIABLE","$addressForm",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","compactData",575],"(",["T_VARIABLE","$addressData",575],")",";",["T_WHITESPACE","\n            ",575],["T_COMMENT","\/\/ unset shipping address attributes which were not shown in form\n",576],["T_WHITESPACE","            ",577],["T_FOREACH","foreach",577],["T_WHITESPACE"," ",577],"(",["T_VARIABLE","$addressForm",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","getAttributes",577],"(",")",["T_WHITESPACE"," ",577],["T_AS","as",577],["T_WHITESPACE"," ",577],["T_VARIABLE","$attribute",577],")",["T_WHITESPACE"," ",577],"{",["T_WHITESPACE","\n                ",577],["T_IF","if",578],["T_WHITESPACE"," ",578],"(","!",["T_ISSET","isset",578],"(",["T_VARIABLE","$data",578],"[",["T_VARIABLE","$attribute",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getAttributeCode",578],"(",")","]",")",")",["T_WHITESPACE"," ",578],"{",["T_WHITESPACE","\n                    ",578],["T_VARIABLE","$address",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","setData",579],"(",["T_VARIABLE","$attribute",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","getAttributeCode",579],"(",")",",",["T_WHITESPACE"," ",579],["T_STRING","NULL",579],")",";",["T_WHITESPACE","\n                ",579],"}",["T_WHITESPACE","\n            ",580],"}",["T_WHITESPACE","\n\n            ",581],["T_VARIABLE","$address",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","setCustomerAddressId",583],"(",["T_STRING","null",583],")",";",["T_WHITESPACE","\n            ",583],["T_COMMENT","\/\/ Additional form data, not fetched by extractData (as it fetches only attributes)\n",584],["T_WHITESPACE","            ",585],["T_VARIABLE","$address",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","setSaveInAddressBook",585],"(",["T_EMPTY","empty",585],"(",["T_VARIABLE","$data",585],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",585],"]",")",["T_WHITESPACE"," ",585],"?",["T_WHITESPACE"," ",585],["T_LNUMBER","0",585],["T_WHITESPACE"," ",585],":",["T_WHITESPACE"," ",585],["T_LNUMBER","1",585],")",";",["T_WHITESPACE","\n            ",585],["T_VARIABLE","$address",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","setSameAsBilling",586],"(",["T_EMPTY","empty",586],"(",["T_VARIABLE","$data",586],"[",["T_CONSTANT_ENCAPSED_STRING","'same_as_billing'",586],"]",")",["T_WHITESPACE"," ",586],"?",["T_WHITESPACE"," ",586],["T_LNUMBER","0",586],["T_WHITESPACE"," ",586],":",["T_WHITESPACE"," ",586],["T_LNUMBER","1",586],")",";",["T_WHITESPACE","\n        ",586],"}",["T_WHITESPACE","\n\n        ",587],["T_VARIABLE","$address",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","implodeStreetAddress",589],"(",")",";",["T_WHITESPACE","\n        ",589],["T_VARIABLE","$address",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","setCollectShippingRates",590],"(",["T_STRING","true",590],")",";",["T_WHITESPACE","\n\n        ",590],["T_IF","if",592],["T_WHITESPACE"," ",592],"(","(",["T_VARIABLE","$validateRes",592],["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_VARIABLE","$address",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","validate",592],"(",")",")",["T_IS_NOT_IDENTICAL","!==",592],["T_STRING","true",592],")",["T_WHITESPACE"," ",592],"{",["T_WHITESPACE","\n            ",592],["T_RETURN","return",593],["T_WHITESPACE"," ",593],["T_ARRAY","array",593],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",593],["T_WHITESPACE"," ",593],["T_DOUBLE_ARROW","=>",593],["T_WHITESPACE"," ",593],["T_LNUMBER","1",593],",",["T_WHITESPACE"," ",593],["T_CONSTANT_ENCAPSED_STRING","'message'",593],["T_WHITESPACE"," ",593],["T_DOUBLE_ARROW","=>",593],["T_WHITESPACE"," ",593],["T_VARIABLE","$validateRes",593],")",";",["T_WHITESPACE","\n        ",593],"}",["T_WHITESPACE","\n\n        ",594],["T_VARIABLE","$this",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","_setCartCouponCode",596],"(",")",";",["T_WHITESPACE","\n\n        ",596],["T_VARIABLE","$this",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getQuote",598],"(",")",["T_OBJECT_OPERATOR","->",598],["T_STRING","collectTotals",598],"(",")",["T_OBJECT_OPERATOR","->",598],["T_STRING","save",598],"(",")",";",["T_WHITESPACE","\n\n        ",598],["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","getCheckout",600],"(",")",["T_WHITESPACE","\n            ",600],["T_OBJECT_OPERATOR","->",601],["T_STRING","setStepData",601],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",601],",",["T_WHITESPACE"," ",601],["T_CONSTANT_ENCAPSED_STRING","'complete'",601],",",["T_WHITESPACE"," ",601],["T_STRING","true",601],")",["T_WHITESPACE","\n            ",601],["T_OBJECT_OPERATOR","->",602],["T_STRING","setStepData",602],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",602],",",["T_WHITESPACE"," ",602],["T_CONSTANT_ENCAPSED_STRING","'allow'",602],",",["T_WHITESPACE"," ",602],["T_STRING","true",602],")",";",["T_WHITESPACE","\n\n        ",602],["T_RETURN","return",604],["T_WHITESPACE"," ",604],["T_ARRAY","array",604],"(",")",";",["T_WHITESPACE","\n    ",604],"}",["T_WHITESPACE","\n\n    ",605],["T_DOC_COMMENT","\/**\n     * Specify quote shipping method\n     *\n     * @param   string $shippingMethod\n     * @return  array\n     *\/",607],["T_WHITESPACE","\n    ",612],["T_PUBLIC","public",613],["T_WHITESPACE"," ",613],["T_FUNCTION","function",613],["T_WHITESPACE"," ",613],["T_STRING","saveShippingMethod",613],"(",["T_VARIABLE","$shippingMethod",613],")",["T_WHITESPACE","\n    ",613],"{",["T_WHITESPACE","\n        ",614],["T_IF","if",615],["T_WHITESPACE"," ",615],"(",["T_EMPTY","empty",615],"(",["T_VARIABLE","$shippingMethod",615],")",")",["T_WHITESPACE"," ",615],"{",["T_WHITESPACE","\n            ",615],["T_RETURN","return",616],["T_WHITESPACE"," ",616],["T_ARRAY","array",616],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",616],["T_WHITESPACE"," ",616],["T_DOUBLE_ARROW","=>",616],["T_WHITESPACE"," ",616],"-",["T_LNUMBER","1",616],",",["T_WHITESPACE"," ",616],["T_CONSTANT_ENCAPSED_STRING","'message'",616],["T_WHITESPACE"," ",616],["T_DOUBLE_ARROW","=>",616],["T_WHITESPACE"," ",616],["T_STRING","Mage",616],["T_DOUBLE_COLON","::",616],["T_STRING","helper",616],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",616],")",["T_OBJECT_OPERATOR","->",616],["T_STRING","__",616],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid shipping method.'",616],")",")",";",["T_WHITESPACE","\n        ",616],"}",["T_WHITESPACE","\n        ",617],["T_VARIABLE","$rate",618],["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getQuote",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","getShippingAddress",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","getShippingRateByCode",618],"(",["T_VARIABLE","$shippingMethod",618],")",";",["T_WHITESPACE","\n        ",618],["T_IF","if",619],["T_WHITESPACE"," ",619],"(","!",["T_VARIABLE","$rate",619],")",["T_WHITESPACE"," ",619],"{",["T_WHITESPACE","\n            ",619],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_ARRAY","array",620],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",620],["T_WHITESPACE"," ",620],["T_DOUBLE_ARROW","=>",620],["T_WHITESPACE"," ",620],"-",["T_LNUMBER","1",620],",",["T_WHITESPACE"," ",620],["T_CONSTANT_ENCAPSED_STRING","'message'",620],["T_WHITESPACE"," ",620],["T_DOUBLE_ARROW","=>",620],["T_WHITESPACE"," ",620],["T_STRING","Mage",620],["T_DOUBLE_COLON","::",620],["T_STRING","helper",620],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",620],")",["T_OBJECT_OPERATOR","->",620],["T_STRING","__",620],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid shipping method.'",620],")",")",";",["T_WHITESPACE","\n        ",620],"}",["T_WHITESPACE","\n        ",621],["T_VARIABLE","$this",622],["T_OBJECT_OPERATOR","->",622],["T_STRING","getQuote",622],"(",")",["T_OBJECT_OPERATOR","->",622],["T_STRING","getShippingAddress",622],"(",")",["T_WHITESPACE","\n            ",622],["T_OBJECT_OPERATOR","->",623],["T_STRING","setShippingMethod",623],"(",["T_VARIABLE","$shippingMethod",623],")",";",["T_WHITESPACE","\n\n        ",623],["T_VARIABLE","$this",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","getCheckout",625],"(",")",["T_WHITESPACE","\n            ",625],["T_OBJECT_OPERATOR","->",626],["T_STRING","setStepData",626],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",626],",",["T_WHITESPACE"," ",626],["T_CONSTANT_ENCAPSED_STRING","'complete'",626],",",["T_WHITESPACE"," ",626],["T_STRING","true",626],")",["T_WHITESPACE","\n            ",626],["T_OBJECT_OPERATOR","->",627],["T_STRING","setStepData",627],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",627],",",["T_WHITESPACE"," ",627],["T_CONSTANT_ENCAPSED_STRING","'allow'",627],",",["T_WHITESPACE"," ",627],["T_STRING","true",627],")",";",["T_WHITESPACE","\n\n        ",627],["T_RETURN","return",629],["T_WHITESPACE"," ",629],["T_ARRAY","array",629],"(",")",";",["T_WHITESPACE","\n    ",629],"}",["T_WHITESPACE","\n\n    ",630],["T_DOC_COMMENT","\/**\n     * Specify quote payment method\n     *\n     * @param   array $data\n     * @return  array\n     *\/",632],["T_WHITESPACE","\n    ",637],["T_PUBLIC","public",638],["T_WHITESPACE"," ",638],["T_FUNCTION","function",638],["T_WHITESPACE"," ",638],["T_STRING","savePayment",638],"(",["T_VARIABLE","$data",638],")",["T_WHITESPACE","\n    ",638],"{",["T_WHITESPACE","\n        ",639],["T_IF","if",640],["T_WHITESPACE"," ",640],"(",["T_EMPTY","empty",640],"(",["T_VARIABLE","$data",640],")",")",["T_WHITESPACE"," ",640],"{",["T_WHITESPACE","\n            ",640],["T_RETURN","return",641],["T_WHITESPACE"," ",641],["T_ARRAY","array",641],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",641],["T_WHITESPACE"," ",641],["T_DOUBLE_ARROW","=>",641],["T_WHITESPACE"," ",641],"-",["T_LNUMBER","1",641],",",["T_WHITESPACE"," ",641],["T_CONSTANT_ENCAPSED_STRING","'message'",641],["T_WHITESPACE"," ",641],["T_DOUBLE_ARROW","=>",641],["T_WHITESPACE"," ",641],["T_STRING","Mage",641],["T_DOUBLE_COLON","::",641],["T_STRING","helper",641],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",641],")",["T_OBJECT_OPERATOR","->",641],["T_STRING","__",641],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid data.'",641],")",")",";",["T_WHITESPACE","\n        ",641],"}",["T_WHITESPACE","\n        ",642],["T_VARIABLE","$quote",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","getQuote",643],"(",")",";",["T_WHITESPACE","\n        ",643],["T_IF","if",644],["T_WHITESPACE"," ",644],"(",["T_VARIABLE","$quote",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","isVirtual",644],"(",")",")",["T_WHITESPACE"," ",644],"{",["T_WHITESPACE","\n            ",644],["T_VARIABLE","$quote",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","getBillingAddress",645],"(",")",["T_OBJECT_OPERATOR","->",645],["T_STRING","setPaymentMethod",645],"(",["T_ISSET","isset",645],"(",["T_VARIABLE","$data",645],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",645],"]",")",["T_WHITESPACE"," ",645],"?",["T_WHITESPACE"," ",645],["T_VARIABLE","$data",645],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",645],"]",["T_WHITESPACE"," ",645],":",["T_WHITESPACE"," ",645],["T_STRING","null",645],")",";",["T_WHITESPACE","\n        ",645],"}",["T_WHITESPACE"," ",646],["T_ELSE","else",646],["T_WHITESPACE"," ",646],"{",["T_WHITESPACE","\n            ",646],["T_VARIABLE","$quote",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","getShippingAddress",647],"(",")",["T_OBJECT_OPERATOR","->",647],["T_STRING","setPaymentMethod",647],"(",["T_ISSET","isset",647],"(",["T_VARIABLE","$data",647],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",647],"]",")",["T_WHITESPACE"," ",647],"?",["T_WHITESPACE"," ",647],["T_VARIABLE","$data",647],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",647],"]",["T_WHITESPACE"," ",647],":",["T_WHITESPACE"," ",647],["T_STRING","null",647],")",";",["T_WHITESPACE","\n        ",647],"}",["T_WHITESPACE","\n\n        ",648],["T_COMMENT","\/\/ shipping totals may be affected by payment method\n",650],["T_WHITESPACE","        ",651],["T_IF","if",651],["T_WHITESPACE"," ",651],"(","!",["T_VARIABLE","$quote",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","isVirtual",651],"(",")",["T_WHITESPACE"," ",651],["T_BOOLEAN_AND","&&",651],["T_WHITESPACE"," ",651],["T_VARIABLE","$quote",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","getShippingAddress",651],"(",")",")",["T_WHITESPACE"," ",651],"{",["T_WHITESPACE","\n            ",651],["T_VARIABLE","$quote",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","getShippingAddress",652],"(",")",["T_OBJECT_OPERATOR","->",652],["T_STRING","setCollectShippingRates",652],"(",["T_STRING","true",652],")",";",["T_WHITESPACE","\n        ",652],"}",["T_WHITESPACE","\n\n        ",653],["T_VARIABLE","$data",655],"[",["T_CONSTANT_ENCAPSED_STRING","'checks'",655],"]",["T_WHITESPACE"," ",655],"=",["T_WHITESPACE"," ",655],["T_STRING","Mage_Payment_Model_Method_Abstract",655],["T_DOUBLE_COLON","::",655],["T_STRING","CHECK_USE_CHECKOUT",655],["T_WHITESPACE","\n            ",655],"|",["T_WHITESPACE"," ",656],["T_STRING","Mage_Payment_Model_Method_Abstract",656],["T_DOUBLE_COLON","::",656],["T_STRING","CHECK_USE_FOR_COUNTRY",656],["T_WHITESPACE","\n            ",656],"|",["T_WHITESPACE"," ",657],["T_STRING","Mage_Payment_Model_Method_Abstract",657],["T_DOUBLE_COLON","::",657],["T_STRING","CHECK_USE_FOR_CURRENCY",657],["T_WHITESPACE","\n            ",657],"|",["T_WHITESPACE"," ",658],["T_STRING","Mage_Payment_Model_Method_Abstract",658],["T_DOUBLE_COLON","::",658],["T_STRING","CHECK_ORDER_TOTAL_MIN_MAX",658],["T_WHITESPACE","\n            ",658],"|",["T_WHITESPACE"," ",659],["T_STRING","Mage_Payment_Model_Method_Abstract",659],["T_DOUBLE_COLON","::",659],["T_STRING","CHECK_ZERO_TOTAL",659],";",["T_WHITESPACE","\n\n        ",659],["T_VARIABLE","$payment",661],["T_WHITESPACE"," ",661],"=",["T_WHITESPACE"," ",661],["T_VARIABLE","$quote",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","getPayment",661],"(",")",";",["T_WHITESPACE","\n        ",661],["T_VARIABLE","$payment",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","importData",662],"(",["T_VARIABLE","$data",662],")",";",["T_WHITESPACE","\n\n        ",662],["T_VARIABLE","$quote",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","save",664],"(",")",";",["T_WHITESPACE","\n\n        ",664],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getCheckout",666],"(",")",["T_WHITESPACE","\n            ",666],["T_OBJECT_OPERATOR","->",667],["T_STRING","setStepData",667],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",667],",",["T_WHITESPACE"," ",667],["T_CONSTANT_ENCAPSED_STRING","'complete'",667],",",["T_WHITESPACE"," ",667],["T_STRING","true",667],")",["T_WHITESPACE","\n            ",667],["T_OBJECT_OPERATOR","->",668],["T_STRING","setStepData",668],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",668],",",["T_WHITESPACE"," ",668],["T_CONSTANT_ENCAPSED_STRING","'allow'",668],",",["T_WHITESPACE"," ",668],["T_STRING","true",668],")",";",["T_WHITESPACE","\n\n        ",668],["T_RETURN","return",670],["T_WHITESPACE"," ",670],["T_ARRAY","array",670],"(",")",";",["T_WHITESPACE","\n    ",670],"}",["T_WHITESPACE","\n\n    ",671],["T_DOC_COMMENT","\/**\n     * Validate quote state to be integrated with one page checkout process\n     *\/",673],["T_WHITESPACE","\n    ",675],["T_PUBLIC","public",676],["T_WHITESPACE"," ",676],["T_FUNCTION","function",676],["T_WHITESPACE"," ",676],["T_STRING","validate",676],"(",")",["T_WHITESPACE","\n    ",676],"{",["T_WHITESPACE","\n        ",677],["T_VARIABLE","$quote",678],["T_WHITESPACE","  ",678],"=",["T_WHITESPACE"," ",678],["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getQuote",678],"(",")",";",["T_WHITESPACE","\n        ",678],["T_IF","if",679],["T_WHITESPACE"," ",679],"(",["T_VARIABLE","$quote",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getIsMultiShipping",679],"(",")",")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n            ",679],["T_STRING","Mage",680],["T_DOUBLE_COLON","::",680],["T_STRING","throwException",680],"(",["T_STRING","Mage",680],["T_DOUBLE_COLON","::",680],["T_STRING","helper",680],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",680],")",["T_OBJECT_OPERATOR","->",680],["T_STRING","__",680],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid checkout type.'",680],")",")",";",["T_WHITESPACE","\n        ",680],"}",["T_WHITESPACE","\n\n        ",681],["T_IF","if",683],["T_WHITESPACE"," ",683],"(",["T_VARIABLE","$quote",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getCheckoutMethod",683],"(",")",["T_WHITESPACE"," ",683],["T_IS_EQUAL","==",683],["T_WHITESPACE"," ",683],["T_STRING","self",683],["T_DOUBLE_COLON","::",683],["T_STRING","METHOD_GUEST",683],["T_WHITESPACE"," ",683],["T_BOOLEAN_AND","&&",683],["T_WHITESPACE"," ",683],"!",["T_VARIABLE","$quote",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","isAllowedGuestCheckout",683],"(",")",")",["T_WHITESPACE"," ",683],"{",["T_WHITESPACE","\n            ",683],["T_STRING","Mage",684],["T_DOUBLE_COLON","::",684],["T_STRING","throwException",684],"(",["T_STRING","Mage",684],["T_DOUBLE_COLON","::",684],["T_STRING","helper",684],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",684],")",["T_OBJECT_OPERATOR","->",684],["T_STRING","__",684],"(",["T_CONSTANT_ENCAPSED_STRING","'Sorry, guest checkout is not enabled. Please try again or contact store owner.'",684],")",")",";",["T_WHITESPACE","\n        ",684],"}",["T_WHITESPACE","\n    ",685],"}",["T_WHITESPACE","\n\n    ",686],["T_DOC_COMMENT","\/**\n     * Prepare quote for guest checkout order submit\n     *\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",688],["T_WHITESPACE","\n    ",692],["T_PROTECTED","protected",693],["T_WHITESPACE"," ",693],["T_FUNCTION","function",693],["T_WHITESPACE"," ",693],["T_STRING","_prepareGuestQuote",693],"(",")",["T_WHITESPACE","\n    ",693],"{",["T_WHITESPACE","\n        ",694],["T_VARIABLE","$quote",695],["T_WHITESPACE"," ",695],"=",["T_WHITESPACE"," ",695],["T_VARIABLE","$this",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","getQuote",695],"(",")",";",["T_WHITESPACE","\n        ",695],["T_VARIABLE","$quote",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","setCustomerId",696],"(",["T_STRING","null",696],")",["T_WHITESPACE","\n            ",696],["T_OBJECT_OPERATOR","->",697],["T_STRING","setCustomerEmail",697],"(",["T_VARIABLE","$quote",697],["T_OBJECT_OPERATOR","->",697],["T_STRING","getBillingAddress",697],"(",")",["T_OBJECT_OPERATOR","->",697],["T_STRING","getEmail",697],"(",")",")",["T_WHITESPACE","\n            ",697],["T_OBJECT_OPERATOR","->",698],["T_STRING","setCustomerIsGuest",698],"(",["T_STRING","true",698],")",["T_WHITESPACE","\n            ",698],["T_OBJECT_OPERATOR","->",699],["T_STRING","setCustomerGroupId",699],"(",["T_STRING","Mage_Customer_Model_Group",699],["T_DOUBLE_COLON","::",699],["T_STRING","NOT_LOGGED_IN_ID",699],")",";",["T_WHITESPACE","\n        ",699],["T_RETURN","return",700],["T_WHITESPACE"," ",700],["T_VARIABLE","$this",700],";",["T_WHITESPACE","\n    ",700],"}",["T_WHITESPACE","\n\n    ",701],["T_DOC_COMMENT","\/**\n     * Prepare quote for customer registration and customer order submit\n     *\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",703],["T_WHITESPACE","\n    ",707],["T_PROTECTED","protected",708],["T_WHITESPACE"," ",708],["T_FUNCTION","function",708],["T_WHITESPACE"," ",708],["T_STRING","_prepareNewCustomerQuote",708],"(",")",["T_WHITESPACE","\n    ",708],"{",["T_WHITESPACE","\n        ",709],["T_VARIABLE","$quote",710],["T_WHITESPACE","      ",710],"=",["T_WHITESPACE"," ",710],["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","getQuote",710],"(",")",";",["T_WHITESPACE","\n        ",710],["T_VARIABLE","$billing",711],["T_WHITESPACE","    ",711],"=",["T_WHITESPACE"," ",711],["T_VARIABLE","$quote",711],["T_OBJECT_OPERATOR","->",711],["T_STRING","getBillingAddress",711],"(",")",";",["T_WHITESPACE","\n        ",711],["T_VARIABLE","$shipping",712],["T_WHITESPACE","   ",712],"=",["T_WHITESPACE"," ",712],["T_VARIABLE","$quote",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","isVirtual",712],"(",")",["T_WHITESPACE"," ",712],"?",["T_WHITESPACE"," ",712],["T_STRING","null",712],["T_WHITESPACE"," ",712],":",["T_WHITESPACE"," ",712],["T_VARIABLE","$quote",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","getShippingAddress",712],"(",")",";",["T_WHITESPACE","\n\n        ",712],["T_COMMENT","\/\/$customer = Mage::getModel('customer\/customer');\n",714],["T_WHITESPACE","        ",715],["T_VARIABLE","$customer",715],["T_WHITESPACE"," ",715],"=",["T_WHITESPACE"," ",715],["T_VARIABLE","$quote",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","getCustomer",715],"(",")",";",["T_WHITESPACE","\n        ",715],["T_COMMENT","\/* @var $customer Mage_Customer_Model_Customer *\/",716],["T_WHITESPACE","\n        ",716],["T_VARIABLE","$customerBilling",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_VARIABLE","$billing",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","exportCustomerAddress",717],"(",")",";",["T_WHITESPACE","\n        ",717],["T_VARIABLE","$customer",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","addAddress",718],"(",["T_VARIABLE","$customerBilling",718],")",";",["T_WHITESPACE","\n        ",718],["T_VARIABLE","$billing",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","setCustomerAddress",719],"(",["T_VARIABLE","$customerBilling",719],")",";",["T_WHITESPACE","\n        ",719],["T_VARIABLE","$customerBilling",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","setIsDefaultBilling",720],"(",["T_STRING","true",720],")",";",["T_WHITESPACE","\n        ",720],["T_IF","if",721],["T_WHITESPACE"," ",721],"(",["T_VARIABLE","$shipping",721],["T_WHITESPACE"," ",721],["T_BOOLEAN_AND","&&",721],["T_WHITESPACE"," ",721],"!",["T_VARIABLE","$shipping",721],["T_OBJECT_OPERATOR","->",721],["T_STRING","getSameAsBilling",721],"(",")",")",["T_WHITESPACE"," ",721],"{",["T_WHITESPACE","\n            ",721],["T_VARIABLE","$customerShipping",722],["T_WHITESPACE"," ",722],"=",["T_WHITESPACE"," ",722],["T_VARIABLE","$shipping",722],["T_OBJECT_OPERATOR","->",722],["T_STRING","exportCustomerAddress",722],"(",")",";",["T_WHITESPACE","\n            ",722],["T_VARIABLE","$customer",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","addAddress",723],"(",["T_VARIABLE","$customerShipping",723],")",";",["T_WHITESPACE","\n            ",723],["T_VARIABLE","$shipping",724],["T_OBJECT_OPERATOR","->",724],["T_STRING","setCustomerAddress",724],"(",["T_VARIABLE","$customerShipping",724],")",";",["T_WHITESPACE","\n            ",724],["T_VARIABLE","$customerShipping",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","setIsDefaultShipping",725],"(",["T_STRING","true",725],")",";",["T_WHITESPACE","\n        ",725],"}",["T_WHITESPACE"," ",726],["T_ELSE","else",726],["T_WHITESPACE"," ",726],"{",["T_WHITESPACE","\n            ",726],["T_VARIABLE","$customerBilling",727],["T_OBJECT_OPERATOR","->",727],["T_STRING","setIsDefaultShipping",727],"(",["T_STRING","true",727],")",";",["T_WHITESPACE","\n        ",727],"}",["T_WHITESPACE","\n\n        ",728],["T_STRING","Mage",730],["T_DOUBLE_COLON","::",730],["T_STRING","helper",730],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",730],")",["T_OBJECT_OPERATOR","->",730],["T_STRING","copyFieldset",730],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_quote'",730],",",["T_WHITESPACE"," ",730],["T_CONSTANT_ENCAPSED_STRING","'to_customer'",730],",",["T_WHITESPACE"," ",730],["T_VARIABLE","$quote",730],",",["T_WHITESPACE"," ",730],["T_VARIABLE","$customer",730],")",";",["T_WHITESPACE","\n        ",730],["T_VARIABLE","$customer",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","setPassword",731],"(",["T_VARIABLE","$customer",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","decryptPassword",731],"(",["T_VARIABLE","$quote",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getPasswordHash",731],"(",")",")",")",";",["T_WHITESPACE","\n        ",731],["T_VARIABLE","$quote",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","setCustomer",732],"(",["T_VARIABLE","$customer",732],")",["T_WHITESPACE","\n            ",732],["T_OBJECT_OPERATOR","->",733],["T_STRING","setCustomerId",733],"(",["T_STRING","true",733],")",";",["T_WHITESPACE","\n    ",733],"}",["T_WHITESPACE","\n\n    ",734],["T_DOC_COMMENT","\/**\n     * Prepare quote for customer order submit\n     *\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",736],["T_WHITESPACE","\n    ",740],["T_PROTECTED","protected",741],["T_WHITESPACE"," ",741],["T_FUNCTION","function",741],["T_WHITESPACE"," ",741],["T_STRING","_prepareCustomerQuote",741],"(",")",["T_WHITESPACE","\n    ",741],"{",["T_WHITESPACE","\n        ",742],["T_VARIABLE","$quote",743],["T_WHITESPACE","      ",743],"=",["T_WHITESPACE"," ",743],["T_VARIABLE","$this",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","getQuote",743],"(",")",";",["T_WHITESPACE","\n        ",743],["T_VARIABLE","$billing",744],["T_WHITESPACE","    ",744],"=",["T_WHITESPACE"," ",744],["T_VARIABLE","$quote",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","getBillingAddress",744],"(",")",";",["T_WHITESPACE","\n        ",744],["T_VARIABLE","$shipping",745],["T_WHITESPACE","   ",745],"=",["T_WHITESPACE"," ",745],["T_VARIABLE","$quote",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","isVirtual",745],"(",")",["T_WHITESPACE"," ",745],"?",["T_WHITESPACE"," ",745],["T_STRING","null",745],["T_WHITESPACE"," ",745],":",["T_WHITESPACE"," ",745],["T_VARIABLE","$quote",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","getShippingAddress",745],"(",")",";",["T_WHITESPACE","\n\n        ",745],["T_VARIABLE","$customer",747],["T_WHITESPACE"," ",747],"=",["T_WHITESPACE"," ",747],["T_VARIABLE","$this",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","getCustomerSession",747],"(",")",["T_OBJECT_OPERATOR","->",747],["T_STRING","getCustomer",747],"(",")",";",["T_WHITESPACE","\n        ",747],["T_IF","if",748],["T_WHITESPACE"," ",748],"(","!",["T_VARIABLE","$billing",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","getCustomerId",748],"(",")",["T_WHITESPACE"," ",748],["T_BOOLEAN_OR","||",748],["T_WHITESPACE"," ",748],["T_VARIABLE","$billing",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","getSaveInAddressBook",748],"(",")",")",["T_WHITESPACE"," ",748],"{",["T_WHITESPACE","\n            ",748],["T_VARIABLE","$customerBilling",749],["T_WHITESPACE"," ",749],"=",["T_WHITESPACE"," ",749],["T_VARIABLE","$billing",749],["T_OBJECT_OPERATOR","->",749],["T_STRING","exportCustomerAddress",749],"(",")",";",["T_WHITESPACE","\n            ",749],["T_VARIABLE","$customer",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","addAddress",750],"(",["T_VARIABLE","$customerBilling",750],")",";",["T_WHITESPACE","\n            ",750],["T_VARIABLE","$billing",751],["T_OBJECT_OPERATOR","->",751],["T_STRING","setCustomerAddress",751],"(",["T_VARIABLE","$customerBilling",751],")",";",["T_WHITESPACE","\n        ",751],"}",["T_WHITESPACE","\n        ",752],["T_IF","if",753],["T_WHITESPACE"," ",753],"(",["T_VARIABLE","$shipping",753],["T_WHITESPACE"," ",753],["T_BOOLEAN_AND","&&",753],["T_WHITESPACE"," ",753],"!",["T_VARIABLE","$shipping",753],["T_OBJECT_OPERATOR","->",753],["T_STRING","getSameAsBilling",753],"(",")",["T_WHITESPACE"," ",753],["T_BOOLEAN_AND","&&",753],["T_WHITESPACE","\n            ",753],"(","!",["T_VARIABLE","$shipping",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","getCustomerId",754],"(",")",["T_WHITESPACE"," ",754],["T_BOOLEAN_OR","||",754],["T_WHITESPACE"," ",754],["T_VARIABLE","$shipping",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","getSaveInAddressBook",754],"(",")",")",")",["T_WHITESPACE"," ",754],"{",["T_WHITESPACE","\n            ",754],["T_VARIABLE","$customerShipping",755],["T_WHITESPACE"," ",755],"=",["T_WHITESPACE"," ",755],["T_VARIABLE","$shipping",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","exportCustomerAddress",755],"(",")",";",["T_WHITESPACE","\n            ",755],["T_VARIABLE","$customer",756],["T_OBJECT_OPERATOR","->",756],["T_STRING","addAddress",756],"(",["T_VARIABLE","$customerShipping",756],")",";",["T_WHITESPACE","\n            ",756],["T_VARIABLE","$shipping",757],["T_OBJECT_OPERATOR","->",757],["T_STRING","setCustomerAddress",757],"(",["T_VARIABLE","$customerShipping",757],")",";",["T_WHITESPACE","\n        ",757],"}",["T_WHITESPACE","\n\n        ",758],["T_IF","if",760],["T_WHITESPACE"," ",760],"(",["T_ISSET","isset",760],"(",["T_VARIABLE","$customerBilling",760],")",["T_WHITESPACE"," ",760],["T_BOOLEAN_AND","&&",760],["T_WHITESPACE"," ",760],"!",["T_VARIABLE","$customer",760],["T_OBJECT_OPERATOR","->",760],["T_STRING","getDefaultBilling",760],"(",")",")",["T_WHITESPACE"," ",760],"{",["T_WHITESPACE","\n            ",760],["T_VARIABLE","$customerBilling",761],["T_OBJECT_OPERATOR","->",761],["T_STRING","setIsDefaultBilling",761],"(",["T_STRING","true",761],")",";",["T_WHITESPACE","\n        ",761],"}",["T_WHITESPACE","\n        ",762],["T_IF","if",763],["T_WHITESPACE"," ",763],"(",["T_VARIABLE","$shipping",763],["T_WHITESPACE"," ",763],["T_BOOLEAN_AND","&&",763],["T_WHITESPACE"," ",763],["T_ISSET","isset",763],"(",["T_VARIABLE","$customerShipping",763],")",["T_WHITESPACE"," ",763],["T_BOOLEAN_AND","&&",763],["T_WHITESPACE"," ",763],"!",["T_VARIABLE","$customer",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","getDefaultShipping",763],"(",")",")",["T_WHITESPACE"," ",763],"{",["T_WHITESPACE","\n            ",763],["T_VARIABLE","$customerShipping",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","setIsDefaultShipping",764],"(",["T_STRING","true",764],")",";",["T_WHITESPACE","\n        ",764],"}",["T_WHITESPACE"," ",765],["T_ELSE","else",765],["T_WHITESPACE"," ",765],["T_IF","if",765],["T_WHITESPACE"," ",765],"(",["T_ISSET","isset",765],"(",["T_VARIABLE","$customerBilling",765],")",["T_WHITESPACE"," ",765],["T_BOOLEAN_AND","&&",765],["T_WHITESPACE"," ",765],"!",["T_VARIABLE","$customer",765],["T_OBJECT_OPERATOR","->",765],["T_STRING","getDefaultShipping",765],"(",")",")",["T_WHITESPACE"," ",765],"{",["T_WHITESPACE","\n            ",765],["T_VARIABLE","$customerBilling",766],["T_OBJECT_OPERATOR","->",766],["T_STRING","setIsDefaultShipping",766],"(",["T_STRING","true",766],")",";",["T_WHITESPACE","\n        ",766],"}",["T_WHITESPACE","\n        ",767],["T_VARIABLE","$quote",768],["T_OBJECT_OPERATOR","->",768],["T_STRING","setCustomer",768],"(",["T_VARIABLE","$customer",768],")",";",["T_WHITESPACE","\n    ",768],"}",["T_WHITESPACE","\n\n    ",769],["T_DOC_COMMENT","\/**\n     * Involve new customer to system\n     *\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",771],["T_WHITESPACE","\n    ",775],["T_PROTECTED","protected",776],["T_WHITESPACE"," ",776],["T_FUNCTION","function",776],["T_WHITESPACE"," ",776],["T_STRING","_involveNewCustomer",776],"(",")",["T_WHITESPACE","\n    ",776],"{",["T_WHITESPACE","\n        ",777],["T_VARIABLE","$customer",778],["T_WHITESPACE"," ",778],"=",["T_WHITESPACE"," ",778],["T_VARIABLE","$this",778],["T_OBJECT_OPERATOR","->",778],["T_STRING","getQuote",778],"(",")",["T_OBJECT_OPERATOR","->",778],["T_STRING","getCustomer",778],"(",")",";",["T_WHITESPACE","\n        ",778],["T_IF","if",779],["T_WHITESPACE"," ",779],"(",["T_VARIABLE","$customer",779],["T_OBJECT_OPERATOR","->",779],["T_STRING","isConfirmationRequired",779],"(",")",")",["T_WHITESPACE"," ",779],"{",["T_WHITESPACE","\n            ",779],["T_VARIABLE","$customer",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","sendNewAccountEmail",780],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",780],",",["T_WHITESPACE"," ",780],["T_CONSTANT_ENCAPSED_STRING","''",780],",",["T_WHITESPACE"," ",780],["T_VARIABLE","$this",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","getQuote",780],"(",")",["T_OBJECT_OPERATOR","->",780],["T_STRING","getStoreId",780],"(",")",")",";",["T_WHITESPACE","\n            ",780],["T_VARIABLE","$url",781],["T_WHITESPACE"," ",781],"=",["T_WHITESPACE"," ",781],["T_STRING","Mage",781],["T_DOUBLE_COLON","::",781],["T_STRING","helper",781],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",781],")",["T_OBJECT_OPERATOR","->",781],["T_STRING","getEmailConfirmationUrl",781],"(",["T_VARIABLE","$customer",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","getEmail",781],"(",")",")",";",["T_WHITESPACE","\n            ",781],["T_VARIABLE","$this",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","getCustomerSession",782],"(",")",["T_OBJECT_OPERATOR","->",782],["T_STRING","addSuccess",782],"(",["T_WHITESPACE","\n                ",782],["T_STRING","Mage",783],["T_DOUBLE_COLON","::",783],["T_STRING","helper",783],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",783],")",["T_OBJECT_OPERATOR","->",783],["T_STRING","__",783],"(",["T_CONSTANT_ENCAPSED_STRING","'Account confirmation is required. Please, check your e-mail for confirmation link. To resend confirmation email please <a href=\"%s\">click here<\/a>.'",783],",",["T_WHITESPACE"," ",783],["T_VARIABLE","$url",783],")",["T_WHITESPACE","\n            ",783],")",";",["T_WHITESPACE","\n        ",784],"}",["T_WHITESPACE"," ",785],["T_ELSE","else",785],["T_WHITESPACE"," ",785],"{",["T_WHITESPACE","\n            ",785],["T_VARIABLE","$customer",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","sendNewAccountEmail",786],"(",["T_CONSTANT_ENCAPSED_STRING","'registered'",786],",",["T_WHITESPACE"," ",786],["T_CONSTANT_ENCAPSED_STRING","''",786],",",["T_WHITESPACE"," ",786],["T_VARIABLE","$this",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","getQuote",786],"(",")",["T_OBJECT_OPERATOR","->",786],["T_STRING","getStoreId",786],"(",")",")",";",["T_WHITESPACE","\n            ",786],["T_VARIABLE","$this",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","getCustomerSession",787],"(",")",["T_OBJECT_OPERATOR","->",787],["T_STRING","loginById",787],"(",["T_VARIABLE","$customer",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","getId",787],"(",")",")",";",["T_WHITESPACE","\n        ",787],"}",["T_WHITESPACE","\n        ",788],["T_RETURN","return",789],["T_WHITESPACE"," ",789],["T_VARIABLE","$this",789],";",["T_WHITESPACE","\n    ",789],"}",["T_WHITESPACE","\n\n    ",790],["T_DOC_COMMENT","\/**\n     * Create order based on checkout type. Create customer if necessary.\n     *\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",792],["T_WHITESPACE","\n    ",796],["T_PUBLIC","public",797],["T_WHITESPACE"," ",797],["T_FUNCTION","function",797],["T_WHITESPACE"," ",797],["T_STRING","saveOrder",797],"(",")",["T_WHITESPACE","\n    ",797],"{",["T_WHITESPACE","\n        ",798],["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","validate",799],"(",")",";",["T_WHITESPACE","\n        ",799],["T_VARIABLE","$isNewCustomer",800],["T_WHITESPACE"," ",800],"=",["T_WHITESPACE"," ",800],["T_STRING","false",800],";",["T_WHITESPACE","\n        ",800],["T_SWITCH","switch",801],["T_WHITESPACE"," ",801],"(",["T_VARIABLE","$this",801],["T_OBJECT_OPERATOR","->",801],["T_STRING","getCheckoutMethod",801],"(",")",")",["T_WHITESPACE"," ",801],"{",["T_WHITESPACE","\n            ",801],["T_CASE","case",802],["T_WHITESPACE"," ",802],["T_STRING","self",802],["T_DOUBLE_COLON","::",802],["T_STRING","METHOD_GUEST",802],":",["T_WHITESPACE","\n                ",802],["T_VARIABLE","$this",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","_prepareGuestQuote",803],"(",")",";",["T_WHITESPACE","\n                ",803],["T_BREAK","break",804],";",["T_WHITESPACE","\n            ",804],["T_CASE","case",805],["T_WHITESPACE"," ",805],["T_STRING","self",805],["T_DOUBLE_COLON","::",805],["T_STRING","METHOD_REGISTER",805],":",["T_WHITESPACE","\n                ",805],["T_VARIABLE","$this",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","_prepareNewCustomerQuote",806],"(",")",";",["T_WHITESPACE","\n                ",806],["T_VARIABLE","$isNewCustomer",807],["T_WHITESPACE"," ",807],"=",["T_WHITESPACE"," ",807],["T_STRING","true",807],";",["T_WHITESPACE","\n                ",807],["T_BREAK","break",808],";",["T_WHITESPACE","\n            ",808],["T_DEFAULT","default",809],":",["T_WHITESPACE","\n                ",809],["T_VARIABLE","$this",810],["T_OBJECT_OPERATOR","->",810],["T_STRING","_prepareCustomerQuote",810],"(",")",";",["T_WHITESPACE","\n                ",810],["T_BREAK","break",811],";",["T_WHITESPACE","\n        ",811],"}",["T_WHITESPACE","\n\n        ",812],["T_VARIABLE","$service",814],["T_WHITESPACE"," ",814],"=",["T_WHITESPACE"," ",814],["T_STRING","Mage",814],["T_DOUBLE_COLON","::",814],["T_STRING","getModel",814],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_quote'",814],",",["T_WHITESPACE"," ",814],["T_VARIABLE","$this",814],["T_OBJECT_OPERATOR","->",814],["T_STRING","getQuote",814],"(",")",")",";",["T_WHITESPACE","\n        ",814],["T_VARIABLE","$service",815],["T_OBJECT_OPERATOR","->",815],["T_STRING","submitAll",815],"(",")",";",["T_WHITESPACE","\n\n        ",815],["T_IF","if",817],["T_WHITESPACE"," ",817],"(",["T_VARIABLE","$isNewCustomer",817],")",["T_WHITESPACE"," ",817],"{",["T_WHITESPACE","\n            ",817],["T_TRY","try",818],["T_WHITESPACE"," ",818],"{",["T_WHITESPACE","\n                ",818],["T_VARIABLE","$this",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","_involveNewCustomer",819],"(",")",";",["T_WHITESPACE","\n            ",819],"}",["T_WHITESPACE"," ",820],["T_CATCH","catch",820],["T_WHITESPACE"," ",820],"(",["T_STRING","Exception",820],["T_WHITESPACE"," ",820],["T_VARIABLE","$e",820],")",["T_WHITESPACE"," ",820],"{",["T_WHITESPACE","\n                ",820],["T_STRING","Mage",821],["T_DOUBLE_COLON","::",821],["T_STRING","logException",821],"(",["T_VARIABLE","$e",821],")",";",["T_WHITESPACE","\n            ",821],"}",["T_WHITESPACE","\n        ",822],"}",["T_WHITESPACE","\n\n        ",823],["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","_checkoutSession",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","setLastQuoteId",825],"(",["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","getQuote",825],"(",")",["T_OBJECT_OPERATOR","->",825],["T_STRING","getId",825],"(",")",")",["T_WHITESPACE","\n            ",825],["T_OBJECT_OPERATOR","->",826],["T_STRING","setLastSuccessQuoteId",826],"(",["T_VARIABLE","$this",826],["T_OBJECT_OPERATOR","->",826],["T_STRING","getQuote",826],"(",")",["T_OBJECT_OPERATOR","->",826],["T_STRING","getId",826],"(",")",")",["T_WHITESPACE","\n            ",826],["T_OBJECT_OPERATOR","->",827],["T_STRING","clearHelperData",827],"(",")",";",["T_WHITESPACE","\n\n        ",827],["T_VARIABLE","$order",829],["T_WHITESPACE"," ",829],"=",["T_WHITESPACE"," ",829],["T_VARIABLE","$service",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","getOrder",829],"(",")",";",["T_WHITESPACE","\n        ",829],["T_IF","if",830],["T_WHITESPACE"," ",830],"(",["T_VARIABLE","$order",830],")",["T_WHITESPACE"," ",830],"{",["T_WHITESPACE","\n            ",830],["T_STRING","Mage",831],["T_DOUBLE_COLON","::",831],["T_STRING","dispatchEvent",831],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_type_onepage_save_order_after'",831],",",["T_WHITESPACE","\n                ",831],["T_ARRAY","array",832],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",832],["T_DOUBLE_ARROW","=>",832],["T_VARIABLE","$order",832],",",["T_WHITESPACE"," ",832],["T_CONSTANT_ENCAPSED_STRING","'quote'",832],["T_DOUBLE_ARROW","=>",832],["T_VARIABLE","$this",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","getQuote",832],"(",")",")",")",";",["T_WHITESPACE","\n\n            ",832],["T_DOC_COMMENT","\/**\n             * a flag to set that there will be redirect to third party after confirmation\n             * eg: paypal standard ipn\n             *\/",834],["T_WHITESPACE","\n            ",837],["T_VARIABLE","$redirectUrl",838],["T_WHITESPACE"," ",838],"=",["T_WHITESPACE"," ",838],["T_VARIABLE","$this",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","getQuote",838],"(",")",["T_OBJECT_OPERATOR","->",838],["T_STRING","getPayment",838],"(",")",["T_OBJECT_OPERATOR","->",838],["T_STRING","getOrderPlaceRedirectUrl",838],"(",")",";",["T_WHITESPACE","\n            ",838],["T_DOC_COMMENT","\/**\n             * we only want to send to customer about new order when there is no redirect to third party\n             *\/",839],["T_WHITESPACE","\n            ",841],["T_IF","if",842],["T_WHITESPACE"," ",842],"(","!",["T_VARIABLE","$redirectUrl",842],["T_WHITESPACE"," ",842],["T_BOOLEAN_AND","&&",842],["T_WHITESPACE"," ",842],["T_VARIABLE","$order",842],["T_OBJECT_OPERATOR","->",842],["T_STRING","getCanSendNewEmailFlag",842],"(",")",")",["T_WHITESPACE"," ",842],"{",["T_WHITESPACE","\n                ",842],["T_TRY","try",843],["T_WHITESPACE"," ",843],"{",["T_WHITESPACE","\n                    ",843],["T_VARIABLE","$order",844],["T_OBJECT_OPERATOR","->",844],["T_STRING","queueNewOrderEmail",844],"(",")",";",["T_WHITESPACE","\n                ",844],"}",["T_WHITESPACE"," ",845],["T_CATCH","catch",845],["T_WHITESPACE"," ",845],"(",["T_STRING","Exception",845],["T_WHITESPACE"," ",845],["T_VARIABLE","$e",845],")",["T_WHITESPACE"," ",845],"{",["T_WHITESPACE","\n                    ",845],["T_STRING","Mage",846],["T_DOUBLE_COLON","::",846],["T_STRING","logException",846],"(",["T_VARIABLE","$e",846],")",";",["T_WHITESPACE","\n                ",846],"}",["T_WHITESPACE","\n            ",847],"}",["T_WHITESPACE","\n\n            ",848],["T_COMMENT","\/\/ add order information to the session\n",850],["T_WHITESPACE","            ",851],["T_VARIABLE","$this",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","_checkoutSession",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","setLastOrderId",851],"(",["T_VARIABLE","$order",851],["T_OBJECT_OPERATOR","->",851],["T_STRING","getId",851],"(",")",")",["T_WHITESPACE","\n                ",851],["T_OBJECT_OPERATOR","->",852],["T_STRING","setRedirectUrl",852],"(",["T_VARIABLE","$redirectUrl",852],")",["T_WHITESPACE","\n                ",852],["T_OBJECT_OPERATOR","->",853],["T_STRING","setLastRealOrderId",853],"(",["T_VARIABLE","$order",853],["T_OBJECT_OPERATOR","->",853],["T_STRING","getIncrementId",853],"(",")",")",";",["T_WHITESPACE","\n\n            ",853],["T_COMMENT","\/\/ as well a billing agreement can be created\n",855],["T_WHITESPACE","            ",856],["T_VARIABLE","$agreement",856],["T_WHITESPACE"," ",856],"=",["T_WHITESPACE"," ",856],["T_VARIABLE","$order",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","getPayment",856],"(",")",["T_OBJECT_OPERATOR","->",856],["T_STRING","getBillingAgreement",856],"(",")",";",["T_WHITESPACE","\n            ",856],["T_IF","if",857],["T_WHITESPACE"," ",857],"(",["T_VARIABLE","$agreement",857],")",["T_WHITESPACE"," ",857],"{",["T_WHITESPACE","\n                ",857],["T_VARIABLE","$this",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","_checkoutSession",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","setLastBillingAgreementId",858],"(",["T_VARIABLE","$agreement",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","getId",858],"(",")",")",";",["T_WHITESPACE","\n            ",858],"}",["T_WHITESPACE","\n        ",859],"}",["T_WHITESPACE","\n\n        ",860],["T_COMMENT","\/\/ add recurring profiles information to the session\n",862],["T_WHITESPACE","        ",863],["T_VARIABLE","$profiles",863],["T_WHITESPACE"," ",863],"=",["T_WHITESPACE"," ",863],["T_VARIABLE","$service",863],["T_OBJECT_OPERATOR","->",863],["T_STRING","getRecurringPaymentProfiles",863],"(",")",";",["T_WHITESPACE","\n        ",863],["T_IF","if",864],["T_WHITESPACE"," ",864],"(",["T_VARIABLE","$profiles",864],")",["T_WHITESPACE"," ",864],"{",["T_WHITESPACE","\n            ",864],["T_VARIABLE","$ids",865],["T_WHITESPACE"," ",865],"=",["T_WHITESPACE"," ",865],["T_ARRAY","array",865],"(",")",";",["T_WHITESPACE","\n            ",865],["T_FOREACH","foreach",866],["T_WHITESPACE"," ",866],"(",["T_VARIABLE","$profiles",866],["T_WHITESPACE"," ",866],["T_AS","as",866],["T_WHITESPACE"," ",866],["T_VARIABLE","$profile",866],")",["T_WHITESPACE"," ",866],"{",["T_WHITESPACE","\n                ",866],["T_VARIABLE","$ids",867],"[","]",["T_WHITESPACE"," ",867],"=",["T_WHITESPACE"," ",867],["T_VARIABLE","$profile",867],["T_OBJECT_OPERATOR","->",867],["T_STRING","getId",867],"(",")",";",["T_WHITESPACE","\n            ",867],"}",["T_WHITESPACE","\n            ",868],["T_VARIABLE","$this",869],["T_OBJECT_OPERATOR","->",869],["T_STRING","_checkoutSession",869],["T_OBJECT_OPERATOR","->",869],["T_STRING","setLastRecurringProfileIds",869],"(",["T_VARIABLE","$ids",869],")",";",["T_WHITESPACE","\n            ",869],["T_COMMENT","\/\/ TODO: send recurring profile emails\n",870],["T_WHITESPACE","        ",871],"}",["T_WHITESPACE","\n\n        ",871],["T_STRING","Mage",873],["T_DOUBLE_COLON","::",873],["T_STRING","dispatchEvent",873],"(",["T_WHITESPACE","\n            ",873],["T_CONSTANT_ENCAPSED_STRING","'checkout_submit_all_after'",874],",",["T_WHITESPACE","\n            ",874],["T_ARRAY","array",875],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",875],["T_WHITESPACE"," ",875],["T_DOUBLE_ARROW","=>",875],["T_WHITESPACE"," ",875],["T_VARIABLE","$order",875],",",["T_WHITESPACE"," ",875],["T_CONSTANT_ENCAPSED_STRING","'quote'",875],["T_WHITESPACE"," ",875],["T_DOUBLE_ARROW","=>",875],["T_WHITESPACE"," ",875],["T_VARIABLE","$this",875],["T_OBJECT_OPERATOR","->",875],["T_STRING","getQuote",875],"(",")",",",["T_WHITESPACE"," ",875],["T_CONSTANT_ENCAPSED_STRING","'recurring_profiles'",875],["T_WHITESPACE"," ",875],["T_DOUBLE_ARROW","=>",875],["T_WHITESPACE"," ",875],["T_VARIABLE","$profiles",875],")",["T_WHITESPACE","\n        ",875],")",";",["T_WHITESPACE","\n\n        ",876],["T_RETURN","return",878],["T_WHITESPACE"," ",878],["T_VARIABLE","$this",878],";",["T_WHITESPACE","\n    ",878],"}",["T_WHITESPACE","\n\n    ",879],["T_DOC_COMMENT","\/**\n     * Validate quote state to be able submitted from one page checkout page\n     *\n     * @deprecated after 1.4 - service model doing quote validation\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",881],["T_WHITESPACE","\n    ",886],["T_PROTECTED","protected",887],["T_WHITESPACE"," ",887],["T_FUNCTION","function",887],["T_WHITESPACE"," ",887],["T_STRING","validateOrder",887],"(",")",["T_WHITESPACE","\n    ",887],"{",["T_WHITESPACE","\n        ",888],["T_IF","if",889],["T_WHITESPACE"," ",889],"(",["T_VARIABLE","$this",889],["T_OBJECT_OPERATOR","->",889],["T_STRING","getQuote",889],"(",")",["T_OBJECT_OPERATOR","->",889],["T_STRING","getIsMultiShipping",889],"(",")",")",["T_WHITESPACE"," ",889],"{",["T_WHITESPACE","\n            ",889],["T_STRING","Mage",890],["T_DOUBLE_COLON","::",890],["T_STRING","throwException",890],"(",["T_STRING","Mage",890],["T_DOUBLE_COLON","::",890],["T_STRING","helper",890],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",890],")",["T_OBJECT_OPERATOR","->",890],["T_STRING","__",890],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid checkout type.'",890],")",")",";",["T_WHITESPACE","\n        ",890],"}",["T_WHITESPACE","\n\n        ",891],["T_IF","if",893],["T_WHITESPACE"," ",893],"(","!",["T_VARIABLE","$this",893],["T_OBJECT_OPERATOR","->",893],["T_STRING","getQuote",893],"(",")",["T_OBJECT_OPERATOR","->",893],["T_STRING","isVirtual",893],"(",")",")",["T_WHITESPACE"," ",893],"{",["T_WHITESPACE","\n            ",893],["T_VARIABLE","$address",894],["T_WHITESPACE"," ",894],"=",["T_WHITESPACE"," ",894],["T_VARIABLE","$this",894],["T_OBJECT_OPERATOR","->",894],["T_STRING","getQuote",894],"(",")",["T_OBJECT_OPERATOR","->",894],["T_STRING","getShippingAddress",894],"(",")",";",["T_WHITESPACE","\n            ",894],["T_VARIABLE","$addressValidation",895],["T_WHITESPACE"," ",895],"=",["T_WHITESPACE"," ",895],["T_VARIABLE","$address",895],["T_OBJECT_OPERATOR","->",895],["T_STRING","validate",895],"(",")",";",["T_WHITESPACE","\n            ",895],["T_IF","if",896],["T_WHITESPACE"," ",896],"(",["T_VARIABLE","$addressValidation",896],["T_WHITESPACE"," ",896],["T_IS_NOT_IDENTICAL","!==",896],["T_WHITESPACE"," ",896],["T_STRING","true",896],")",["T_WHITESPACE"," ",896],"{",["T_WHITESPACE","\n                ",896],["T_STRING","Mage",897],["T_DOUBLE_COLON","::",897],["T_STRING","throwException",897],"(",["T_STRING","Mage",897],["T_DOUBLE_COLON","::",897],["T_STRING","helper",897],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",897],")",["T_OBJECT_OPERATOR","->",897],["T_STRING","__",897],"(",["T_CONSTANT_ENCAPSED_STRING","'Please check shipping address information.'",897],")",")",";",["T_WHITESPACE","\n            ",897],"}",["T_WHITESPACE","\n            ",898],["T_VARIABLE","$method",899],"=",["T_WHITESPACE"," ",899],["T_VARIABLE","$address",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","getShippingMethod",899],"(",")",";",["T_WHITESPACE","\n            ",899],["T_VARIABLE","$rate",900],["T_WHITESPACE","  ",900],"=",["T_WHITESPACE"," ",900],["T_VARIABLE","$address",900],["T_OBJECT_OPERATOR","->",900],["T_STRING","getShippingRateByCode",900],"(",["T_VARIABLE","$method",900],")",";",["T_WHITESPACE","\n            ",900],["T_IF","if",901],["T_WHITESPACE"," ",901],"(","!",["T_VARIABLE","$this",901],["T_OBJECT_OPERATOR","->",901],["T_STRING","getQuote",901],"(",")",["T_OBJECT_OPERATOR","->",901],["T_STRING","isVirtual",901],"(",")",["T_WHITESPACE"," ",901],["T_BOOLEAN_AND","&&",901],["T_WHITESPACE"," ",901],"(","!",["T_VARIABLE","$method",901],["T_WHITESPACE"," ",901],["T_BOOLEAN_OR","||",901],["T_WHITESPACE"," ",901],"!",["T_VARIABLE","$rate",901],")",")",["T_WHITESPACE"," ",901],"{",["T_WHITESPACE","\n                ",901],["T_STRING","Mage",902],["T_DOUBLE_COLON","::",902],["T_STRING","throwException",902],"(",["T_STRING","Mage",902],["T_DOUBLE_COLON","::",902],["T_STRING","helper",902],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",902],")",["T_OBJECT_OPERATOR","->",902],["T_STRING","__",902],"(",["T_CONSTANT_ENCAPSED_STRING","'Please specify shipping method.'",902],")",")",";",["T_WHITESPACE","\n            ",902],"}",["T_WHITESPACE","\n        ",903],"}",["T_WHITESPACE","\n\n        ",904],["T_VARIABLE","$addressValidation",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],["T_VARIABLE","$this",906],["T_OBJECT_OPERATOR","->",906],["T_STRING","getQuote",906],"(",")",["T_OBJECT_OPERATOR","->",906],["T_STRING","getBillingAddress",906],"(",")",["T_OBJECT_OPERATOR","->",906],["T_STRING","validate",906],"(",")",";",["T_WHITESPACE","\n        ",906],["T_IF","if",907],["T_WHITESPACE"," ",907],"(",["T_VARIABLE","$addressValidation",907],["T_WHITESPACE"," ",907],["T_IS_NOT_IDENTICAL","!==",907],["T_WHITESPACE"," ",907],["T_STRING","true",907],")",["T_WHITESPACE"," ",907],"{",["T_WHITESPACE","\n            ",907],["T_STRING","Mage",908],["T_DOUBLE_COLON","::",908],["T_STRING","throwException",908],"(",["T_STRING","Mage",908],["T_DOUBLE_COLON","::",908],["T_STRING","helper",908],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",908],")",["T_OBJECT_OPERATOR","->",908],["T_STRING","__",908],"(",["T_CONSTANT_ENCAPSED_STRING","'Please check billing address information.'",908],")",")",";",["T_WHITESPACE","\n        ",908],"}",["T_WHITESPACE","\n\n        ",909],["T_IF","if",911],["T_WHITESPACE"," ",911],"(","!","(",["T_VARIABLE","$this",911],["T_OBJECT_OPERATOR","->",911],["T_STRING","getQuote",911],"(",")",["T_OBJECT_OPERATOR","->",911],["T_STRING","getPayment",911],"(",")",["T_OBJECT_OPERATOR","->",911],["T_STRING","getMethod",911],"(",")",")",")",["T_WHITESPACE"," ",911],"{",["T_WHITESPACE","\n            ",911],["T_STRING","Mage",912],["T_DOUBLE_COLON","::",912],["T_STRING","throwException",912],"(",["T_STRING","Mage",912],["T_DOUBLE_COLON","::",912],["T_STRING","helper",912],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",912],")",["T_OBJECT_OPERATOR","->",912],["T_STRING","__",912],"(",["T_CONSTANT_ENCAPSED_STRING","'Please select valid payment method.'",912],")",")",";",["T_WHITESPACE","\n        ",912],"}",["T_WHITESPACE","\n    ",913],"}",["T_WHITESPACE","\n\n    ",914],["T_DOC_COMMENT","\/**\n     * Check if customer email exists\n     *\n     * @param string $email\n     * @param int $websiteId\n     * @return false|Mage_Customer_Model_Customer\n     *\/",916],["T_WHITESPACE","\n    ",922],["T_PROTECTED","protected",923],["T_WHITESPACE"," ",923],["T_FUNCTION","function",923],["T_WHITESPACE"," ",923],["T_STRING","_customerEmailExists",923],"(",["T_VARIABLE","$email",923],",",["T_WHITESPACE"," ",923],["T_VARIABLE","$websiteId",923],["T_WHITESPACE"," ",923],"=",["T_WHITESPACE"," ",923],["T_STRING","null",923],")",["T_WHITESPACE","\n    ",923],"{",["T_WHITESPACE","\n        ",924],["T_VARIABLE","$customer",925],["T_WHITESPACE"," ",925],"=",["T_WHITESPACE"," ",925],["T_STRING","Mage",925],["T_DOUBLE_COLON","::",925],["T_STRING","getModel",925],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",925],")",";",["T_WHITESPACE","\n        ",925],["T_IF","if",926],["T_WHITESPACE"," ",926],"(",["T_VARIABLE","$websiteId",926],")",["T_WHITESPACE"," ",926],"{",["T_WHITESPACE","\n            ",926],["T_VARIABLE","$customer",927],["T_OBJECT_OPERATOR","->",927],["T_STRING","setWebsiteId",927],"(",["T_VARIABLE","$websiteId",927],")",";",["T_WHITESPACE","\n        ",927],"}",["T_WHITESPACE","\n        ",928],["T_VARIABLE","$customer",929],["T_OBJECT_OPERATOR","->",929],["T_STRING","loadByEmail",929],"(",["T_VARIABLE","$email",929],")",";",["T_WHITESPACE","\n        ",929],["T_IF","if",930],["T_WHITESPACE"," ",930],"(",["T_VARIABLE","$customer",930],["T_OBJECT_OPERATOR","->",930],["T_STRING","getId",930],"(",")",")",["T_WHITESPACE"," ",930],"{",["T_WHITESPACE","\n            ",930],["T_RETURN","return",931],["T_WHITESPACE"," ",931],["T_VARIABLE","$customer",931],";",["T_WHITESPACE","\n        ",931],"}",["T_WHITESPACE","\n        ",932],["T_RETURN","return",933],["T_WHITESPACE"," ",933],["T_STRING","false",933],";",["T_WHITESPACE","\n    ",933],"}",["T_WHITESPACE","\n\n    ",934],["T_DOC_COMMENT","\/**\n     * Get last order increment id by order id\n     *\n     * @return string\n     *\/",936],["T_WHITESPACE","\n    ",940],["T_PUBLIC","public",941],["T_WHITESPACE"," ",941],["T_FUNCTION","function",941],["T_WHITESPACE"," ",941],["T_STRING","getLastOrderId",941],"(",")",["T_WHITESPACE","\n    ",941],"{",["T_WHITESPACE","\n        ",942],["T_VARIABLE","$lastId",943],["T_WHITESPACE","  ",943],"=",["T_WHITESPACE"," ",943],["T_VARIABLE","$this",943],["T_OBJECT_OPERATOR","->",943],["T_STRING","getCheckout",943],"(",")",["T_OBJECT_OPERATOR","->",943],["T_STRING","getLastOrderId",943],"(",")",";",["T_WHITESPACE","\n        ",943],["T_VARIABLE","$orderId",944],["T_WHITESPACE"," ",944],"=",["T_WHITESPACE"," ",944],["T_STRING","false",944],";",["T_WHITESPACE","\n        ",944],["T_IF","if",945],["T_WHITESPACE"," ",945],"(",["T_VARIABLE","$lastId",945],")",["T_WHITESPACE"," ",945],"{",["T_WHITESPACE","\n            ",945],["T_VARIABLE","$order",946],["T_WHITESPACE"," ",946],"=",["T_WHITESPACE"," ",946],["T_STRING","Mage",946],["T_DOUBLE_COLON","::",946],["T_STRING","getModel",946],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",946],")",";",["T_WHITESPACE","\n            ",946],["T_VARIABLE","$order",947],["T_OBJECT_OPERATOR","->",947],["T_STRING","load",947],"(",["T_VARIABLE","$lastId",947],")",";",["T_WHITESPACE","\n            ",947],["T_VARIABLE","$orderId",948],["T_WHITESPACE"," ",948],"=",["T_WHITESPACE"," ",948],["T_VARIABLE","$order",948],["T_OBJECT_OPERATOR","->",948],["T_STRING","getIncrementId",948],"(",")",";",["T_WHITESPACE","\n        ",948],"}",["T_WHITESPACE","\n        ",949],["T_RETURN","return",950],["T_WHITESPACE"," ",950],["T_VARIABLE","$orderId",950],";",["T_WHITESPACE","\n    ",950],"}",["T_WHITESPACE","\n\n    ",951],["T_DOC_COMMENT","\/**\n     * Sets cart coupon code from checkout to quote\n     *\n     * @return $this\n     *\/",953],["T_WHITESPACE","\n    ",957],["T_PROTECTED","protected",958],["T_WHITESPACE"," ",958],["T_FUNCTION","function",958],["T_WHITESPACE"," ",958],["T_STRING","_setCartCouponCode",958],"(",")",["T_WHITESPACE","\n    ",958],"{",["T_WHITESPACE","\n        ",959],["T_IF","if",960],["T_WHITESPACE"," ",960],"(",["T_VARIABLE","$couponCode",960],["T_WHITESPACE"," ",960],"=",["T_WHITESPACE"," ",960],["T_VARIABLE","$this",960],["T_OBJECT_OPERATOR","->",960],["T_STRING","getCheckout",960],"(",")",["T_OBJECT_OPERATOR","->",960],["T_STRING","getCartCouponCode",960],"(",")",")",["T_WHITESPACE"," ",960],"{",["T_WHITESPACE","\n            ",960],["T_VARIABLE","$this",961],["T_OBJECT_OPERATOR","->",961],["T_STRING","getQuote",961],"(",")",["T_OBJECT_OPERATOR","->",961],["T_STRING","setCouponCode",961],"(",["T_VARIABLE","$couponCode",961],")",";",["T_WHITESPACE","\n        ",961],"}",["T_WHITESPACE","\n        ",962],["T_RETURN","return",963],["T_WHITESPACE"," ",963],["T_VARIABLE","$this",963],";",["T_WHITESPACE","\n    ",963],"}",["T_WHITESPACE","\n",964],"}",["T_WHITESPACE","\n",965]]