[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Multishipping checkout model\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_Model_Type_Multishipping",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_Model_Type_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Quote shipping addresses items cache\n     *\n     * @var array\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_quoteShippingAddressesItems",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\/",43],["T_WHITESPACE","\n    ",45],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","__construct",46],"(",")",["T_WHITESPACE","\n    ",46],"{",["T_WHITESPACE","\n        ",47],["T_STRING","parent",48],["T_DOUBLE_COLON","::",48],["T_STRING","__construct",48],"(",")",";",["T_WHITESPACE","\n        ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","_init",49],"(",")",";",["T_WHITESPACE","\n    ",49],"}",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * Initialize multishipping checkout.\n     * Split virtual\/not virtual items between default billing\/shipping addresses\n     *\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",52],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","_init",58],"(",")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_DOC_COMMENT","\/**\n         * reset quote shipping addresses and items\n         *\/",60],["T_WHITESPACE","\n        ",62],["T_VARIABLE","$quote",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getQuote",63],"(",")",";",["T_WHITESPACE","\n        ",63],["T_IF","if",64],["T_WHITESPACE"," ",64],"(","!",["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getCustomer",64],"(",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","getId",64],"(",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_RETURN","return",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],";",["T_WHITESPACE","\n        ",65],"}",["T_WHITESPACE","\n\n        ",66],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getCheckoutSession",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","getCheckoutState",68],"(",")",["T_WHITESPACE"," ",68],["T_IS_IDENTICAL","===",68],["T_WHITESPACE"," ",68],["T_STRING","Mage_Checkout_Model_Session",68],["T_DOUBLE_COLON","::",68],["T_STRING","CHECKOUT_STATE_BEGIN",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getCheckoutSession",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","setCheckoutState",69],"(",["T_STRING","true",69],")",";",["T_WHITESPACE","\n            ",69],["T_DOC_COMMENT","\/**\n             * Remove all addresses\n             *\/",70],["T_WHITESPACE","\n            ",72],["T_VARIABLE","$addresses",73],["T_WHITESPACE","  ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$quote",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getAllAddresses",73],"(",")",";",["T_WHITESPACE","\n            ",73],["T_FOREACH","foreach",74],["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$addresses",74],["T_WHITESPACE"," ",74],["T_AS","as",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$address",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n                ",74],["T_VARIABLE","$quote",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","removeAddress",75],"(",["T_VARIABLE","$address",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getId",75],"(",")",")",";",["T_WHITESPACE","\n            ",75],"}",["T_WHITESPACE","\n\n            ",76],["T_IF","if",78],["T_WHITESPACE"," ",78],"(",["T_VARIABLE","$defaultShipping",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getCustomerDefaultShippingAddress",78],"(",")",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n                ",78],["T_VARIABLE","$quote",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getShippingAddress",79],"(",")",["T_OBJECT_OPERATOR","->",79],["T_STRING","importCustomerAddress",79],"(",["T_VARIABLE","$defaultShipping",79],")",";",["T_WHITESPACE","\n\n                ",79],["T_FOREACH","foreach",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getQuoteItems",81],"(",")",["T_WHITESPACE"," ",81],["T_AS","as",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$item",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n                    ",81],["T_DOC_COMMENT","\/**\n                     * Items with parent id we add in importQuoteItem method.\n                     * Skip virtual items\n                     *\/",82],["T_WHITESPACE","\n                    ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$item",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getParentItemId",86],"(",")",["T_WHITESPACE"," ",86],["T_BOOLEAN_OR","||",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$item",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getProduct",86],"(",")",["T_OBJECT_OPERATOR","->",86],["T_STRING","getIsVirtual",86],"(",")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n                        ",86],["T_CONTINUE","continue",87],";",["T_WHITESPACE","\n                    ",87],"}",["T_WHITESPACE","\n                    ",88],["T_VARIABLE","$quote",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getShippingAddress",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","addItem",89],"(",["T_VARIABLE","$item",89],")",";",["T_WHITESPACE","\n                ",89],"}",["T_WHITESPACE","\n            ",90],"}",["T_WHITESPACE","\n\n            ",91],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getCustomerDefaultBillingAddress",93],"(",")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$quote",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getBillingAddress",94],"(",")",["T_WHITESPACE","\n                    ",94],["T_OBJECT_OPERATOR","->",95],["T_STRING","importCustomerAddress",95],"(",["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getCustomerDefaultBillingAddress",95],"(",")",")",";",["T_WHITESPACE","\n                ",95],["T_FOREACH","foreach",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getQuoteItems",96],"(",")",["T_WHITESPACE"," ",96],["T_AS","as",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$item",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n                    ",96],["T_IF","if",97],["T_WHITESPACE"," ",97],"(",["T_VARIABLE","$item",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getParentItemId",97],"(",")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n                        ",97],["T_CONTINUE","continue",98],";",["T_WHITESPACE","\n                    ",98],"}",["T_WHITESPACE","\n                    ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$item",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getProduct",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getIsVirtual",100],"(",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n                        ",100],["T_VARIABLE","$quote",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getBillingAddress",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","addItem",101],"(",["T_VARIABLE","$item",101],")",";",["T_WHITESPACE","\n                    ",101],"}",["T_WHITESPACE","\n                ",102],"}",["T_WHITESPACE","\n            ",103],"}",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","save",105],"(",")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n        ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Get quote items assigned to different quote addresses populated per item qty.\n     * Based on result array we can display each item separately\n     *\n     * @return array\n     *\/",110],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","getQuoteShippingAddressesItems",116],"(",")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_quoteShippingAddressesItems",118],["T_WHITESPACE"," ",118],["T_IS_NOT_IDENTICAL","!==",118],["T_WHITESPACE"," ",118],["T_STRING","null",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_quoteShippingAddressesItems",119],";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$items",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_ARRAY","array",121],"(",")",";",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$addresses",122],["T_WHITESPACE","  ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getQuote",122],"(",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","getAllAddresses",122],"(",")",";",["T_WHITESPACE","\n        ",122],["T_FOREACH","foreach",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$addresses",123],["T_WHITESPACE"," ",123],["T_AS","as",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$address",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_FOREACH","foreach",124],["T_WHITESPACE"," ",124],"(",["T_VARIABLE","$address",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getAllItems",124],"(",")",["T_WHITESPACE"," ",124],["T_AS","as",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$item",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$item",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getParentItemId",125],"(",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n                    ",125],["T_CONTINUE","continue",126],";",["T_WHITESPACE","\n                ",126],"}",["T_WHITESPACE","\n                ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$item",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getProduct",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getIsVirtual",128],"(",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                    ",128],["T_VARIABLE","$items",129],"[","]",["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$item",129],";",["T_WHITESPACE","\n                    ",129],["T_CONTINUE","continue",130],";",["T_WHITESPACE","\n                ",130],"}",["T_WHITESPACE","\n                ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_VARIABLE","$item",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getQty",132],"(",")",["T_WHITESPACE"," ",132],">",["T_WHITESPACE"," ",132],["T_LNUMBER","1",132],")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                    ",132],["T_FOR","for",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$i",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_LNUMBER","0",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$n",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$item",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getQty",133],"(",")",";",["T_WHITESPACE"," ",133],["T_VARIABLE","$i",133],["T_WHITESPACE"," ",133],"<",["T_WHITESPACE"," ",133],["T_VARIABLE","$n",133],";",["T_WHITESPACE"," ",133],["T_VARIABLE","$i",133],["T_INC","++",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n                        ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$i",134],["T_WHITESPACE"," ",134],["T_IS_EQUAL","==",134],["T_WHITESPACE"," ",134],["T_LNUMBER","0",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                            ",134],["T_VARIABLE","$addressItem",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$item",135],";",["T_WHITESPACE","\n                        ",135],"}",["T_WHITESPACE"," ",136],["T_ELSE","else",136],["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                            ",136],["T_VARIABLE","$addressItem",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_CLONE","clone",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$item",137],";",["T_WHITESPACE","\n                        ",137],"}",["T_WHITESPACE","\n                        ",138],["T_VARIABLE","$addressItem",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","setQty",139],"(",["T_LNUMBER","1",139],")",["T_WHITESPACE","\n                            ",139],["T_OBJECT_OPERATOR","->",140],["T_STRING","setCustomerAddressId",140],"(",["T_VARIABLE","$address",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getCustomerAddressId",140],"(",")",")",["T_WHITESPACE","\n                            ",140],["T_OBJECT_OPERATOR","->",141],["T_STRING","save",141],"(",")",";",["T_WHITESPACE","\n                        ",141],["T_VARIABLE","$items",142],"[","]",["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$addressItem",142],";",["T_WHITESPACE","\n                    ",142],"}",["T_WHITESPACE","\n                ",143],"}",["T_WHITESPACE"," ",144],["T_ELSE","else",144],["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                    ",144],["T_VARIABLE","$item",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","setCustomerAddressId",145],"(",["T_VARIABLE","$address",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getCustomerAddressId",145],"(",")",")",";",["T_WHITESPACE","\n                    ",145],["T_VARIABLE","$items",146],"[","]",["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$item",146],";",["T_WHITESPACE","\n                ",146],"}",["T_WHITESPACE","\n            ",147],"}",["T_WHITESPACE","\n        ",148],"}",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_quoteShippingAddressesItems",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$items",150],";",["T_WHITESPACE","\n        ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$items",151],";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Remove item from address\n     *\n     * @param int $addressId\n     * @param int $itemId\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",154],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","removeAddressItem",161],"(",["T_VARIABLE","$addressId",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$itemId",161],")",["T_WHITESPACE","\n    ",161],"{",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$address",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getQuote",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","getAddressById",163],"(",["T_VARIABLE","$addressId",163],")",";",["T_WHITESPACE","\n        ",163],["T_COMMENT","\/* @var $address Mage_Sales_Model_Quote_Address *\/",164],["T_WHITESPACE","\n        ",164],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$address",165],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$item",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$address",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getValidItemById",166],"(",["T_VARIABLE","$itemId",166],")",";",["T_WHITESPACE","\n            ",166],["T_IF","if",167],["T_WHITESPACE"," ",167],"(",["T_VARIABLE","$item",167],")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n                ",167],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_VARIABLE","$item",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getQty",168],"(",")",">",["T_LNUMBER","1",168],["T_WHITESPACE"," ",168],["T_BOOLEAN_AND","&&",168],["T_WHITESPACE"," ",168],"!",["T_VARIABLE","$item",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getProduct",168],"(",")",["T_OBJECT_OPERATOR","->",168],["T_STRING","getIsVirtual",168],"(",")",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n                    ",168],["T_VARIABLE","$item",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","setQty",169],"(",["T_VARIABLE","$item",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getQty",169],"(",")","-",["T_LNUMBER","1",169],")",";",["T_WHITESPACE","\n                ",169],"}",["T_WHITESPACE"," ",170],["T_ELSE","else",170],["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n                    ",170],["T_VARIABLE","$address",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","removeItem",171],"(",["T_VARIABLE","$item",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getId",171],"(",")",")",";",["T_WHITESPACE","\n                ",171],"}",["T_WHITESPACE","\n\n                ",172],["T_DOC_COMMENT","\/**\n                 * Require shiping rate recollect\n                 *\/",174],["T_WHITESPACE","\n                ",176],["T_VARIABLE","$address",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","setCollectShippingRates",177],"(",["T_BOOL_CAST","(boolean)",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getCollectRatesFlag",177],"(",")",")",";",["T_WHITESPACE","\n\n                ",177],["T_IF","if",179],["T_WHITESPACE"," ",179],"(",["T_STRING","count",179],"(",["T_VARIABLE","$address",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getAllItems",179],"(",")",")",["T_WHITESPACE"," ",179],["T_IS_EQUAL","==",179],["T_WHITESPACE"," ",179],["T_LNUMBER","0",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                    ",179],["T_VARIABLE","$address",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","isDeleted",180],"(",["T_STRING","true",180],")",";",["T_WHITESPACE","\n                ",180],"}",["T_WHITESPACE","\n\n                ",181],["T_IF","if",183],["T_WHITESPACE"," ",183],"(",["T_VARIABLE","$quoteItem",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getQuote",183],"(",")",["T_OBJECT_OPERATOR","->",183],["T_STRING","getItemById",183],"(",["T_VARIABLE","$item",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getQuoteItemId",183],"(",")",")",")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n                    ",183],["T_VARIABLE","$newItemQty",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$quoteItem",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getQty",184],"(",")","-",["T_LNUMBER","1",184],";",["T_WHITESPACE","\n                    ",184],["T_IF","if",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$newItemQty",185],["T_WHITESPACE"," ",185],">",["T_WHITESPACE"," ",185],["T_LNUMBER","0",185],["T_WHITESPACE"," ",185],["T_BOOLEAN_AND","&&",185],["T_WHITESPACE"," ",185],"!",["T_VARIABLE","$item",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getProduct",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","getIsVirtual",185],"(",")",")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                        ",185],["T_VARIABLE","$quoteItem",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","setQty",186],"(",["T_VARIABLE","$quoteItem",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getQty",186],"(",")","-",["T_LNUMBER","1",186],")",";",["T_WHITESPACE","\n                    ",186],"}",["T_WHITESPACE"," ",187],["T_ELSE","else",187],["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                        ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getQuote",188],"(",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","removeItem",188],"(",["T_VARIABLE","$quoteItem",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getId",188],"(",")",")",";",["T_WHITESPACE","\n                    ",188],"}",["T_WHITESPACE","\n                ",189],"}",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","save",191],"(",")",";",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n        ",193],["T_RETURN","return",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],";",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Assign quote items to addresses and specify items qty\n     *\n     * array structure:\n     * array(\n     *      $quoteItemId => array(\n     *          'qty'       => $qty,\n     *          'address'   => $customerAddressId\n     *      )\n     * )\n     *\n     * @param array $info\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",197],["T_WHITESPACE","\n    ",210],["T_PUBLIC","public",211],["T_WHITESPACE"," ",211],["T_FUNCTION","function",211],["T_WHITESPACE"," ",211],["T_STRING","setShippingItemsInformation",211],"(",["T_VARIABLE","$info",211],")",["T_WHITESPACE","\n    ",211],"{",["T_WHITESPACE","\n        ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_STRING","is_array",213],"(",["T_VARIABLE","$info",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$allQty",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_LNUMBER","0",214],";",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$itemsInfo",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_ARRAY","array",215],"(",")",";",["T_WHITESPACE","\n            ",215],["T_FOREACH","foreach",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$info",216],["T_WHITESPACE"," ",216],["T_AS","as",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$itemData",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n                ",216],["T_FOREACH","foreach",217],["T_WHITESPACE"," ",217],"(",["T_VARIABLE","$itemData",217],["T_WHITESPACE"," ",217],["T_AS","as",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$quoteItemId",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$data",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n                    ",217],["T_VARIABLE","$allQty",218],["T_WHITESPACE"," ",218],["T_PLUS_EQUAL","+=",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$data",218],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",218],"]",";",["T_WHITESPACE","\n                    ",218],["T_VARIABLE","$itemsInfo",219],"[",["T_VARIABLE","$quoteItemId",219],"]",["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$data",219],";",["T_WHITESPACE","\n                ",219],"}",["T_WHITESPACE","\n            ",220],"}",["T_WHITESPACE","\n\n            ",221],["T_VARIABLE","$maxQty",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_INT_CAST","(int)",223],["T_STRING","Mage",223],["T_DOUBLE_COLON","::",223],["T_STRING","getStoreConfig",223],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping\/option\/checkout_multiple_maximum_qty'",223],")",";",["T_WHITESPACE","\n            ",223],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_VARIABLE","$allQty",224],["T_WHITESPACE"," ",224],">",["T_WHITESPACE"," ",224],["T_VARIABLE","$maxQty",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                ",224],["T_STRING","Mage",225],["T_DOUBLE_COLON","::",225],["T_STRING","throwException",225],"(",["T_STRING","Mage",225],["T_DOUBLE_COLON","::",225],["T_STRING","helper",225],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",225],")",["T_OBJECT_OPERATOR","->",225],["T_STRING","__",225],"(",["T_CONSTANT_ENCAPSED_STRING","'Maximum qty allowed for Shipping to multiple addresses is %s'",225],",",["T_WHITESPACE"," ",225],["T_VARIABLE","$maxQty",225],")",")",";",["T_WHITESPACE","\n            ",225],"}",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$quote",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getQuote",227],"(",")",";",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$addresses",228],["T_WHITESPACE","  ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$quote",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getAllShippingAddresses",228],"(",")",";",["T_WHITESPACE","\n            ",228],["T_FOREACH","foreach",229],["T_WHITESPACE"," ",229],"(",["T_VARIABLE","$addresses",229],["T_WHITESPACE"," ",229],["T_AS","as",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$address",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                ",229],["T_VARIABLE","$quote",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","removeAddress",230],"(",["T_VARIABLE","$address",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getId",230],"(",")",")",";",["T_WHITESPACE","\n            ",230],"}",["T_WHITESPACE","\n\n            ",231],["T_FOREACH","foreach",233],["T_WHITESPACE"," ",233],"(",["T_VARIABLE","$info",233],["T_WHITESPACE"," ",233],["T_AS","as",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$itemData",233],")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n                ",233],["T_FOREACH","foreach",234],["T_WHITESPACE"," ",234],"(",["T_VARIABLE","$itemData",234],["T_WHITESPACE"," ",234],["T_AS","as",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$quoteItemId",234],["T_WHITESPACE"," ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$data",234],")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n                    ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_addShippingItem",235],"(",["T_VARIABLE","$quoteItemId",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$data",235],")",";",["T_WHITESPACE","\n                ",235],"}",["T_WHITESPACE","\n            ",236],"}",["T_WHITESPACE","\n\n            ",237],["T_DOC_COMMENT","\/**\n             * Delete all not virtual quote items which are not added to shipping address\n             * MultishippingQty should be defined for each quote item when it processed with _addShippingItem\n             *\/",239],["T_WHITESPACE","\n            ",242],["T_FOREACH","foreach",243],["T_WHITESPACE"," ",243],"(",["T_VARIABLE","$quote",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getAllItems",243],"(",")",["T_WHITESPACE"," ",243],["T_AS","as",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$_item",243],")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n                ",243],["T_IF","if",244],["T_WHITESPACE"," ",244],"(","!",["T_VARIABLE","$_item",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getProduct",244],"(",")",["T_OBJECT_OPERATOR","->",244],["T_STRING","getIsVirtual",244],"(",")",["T_WHITESPACE"," ",244],["T_BOOLEAN_AND","&&",244],["T_WHITESPACE","\n                    ",244],"!",["T_VARIABLE","$_item",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getParentItem",245],"(",")",["T_WHITESPACE"," ",245],["T_BOOLEAN_AND","&&",245],["T_WHITESPACE","\n                    ",245],"!",["T_VARIABLE","$_item",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getMultishippingQty",246],"(",")",["T_WHITESPACE","\n                ",246],")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n                    ",247],["T_VARIABLE","$quote",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","removeItem",248],"(",["T_VARIABLE","$_item",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getId",248],"(",")",")",";",["T_WHITESPACE","\n                ",248],"}",["T_WHITESPACE","\n            ",249],"}",["T_WHITESPACE","\n\n            ",250],["T_IF","if",252],["T_WHITESPACE"," ",252],"(",["T_VARIABLE","$billingAddress",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$quote",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getBillingAddress",252],"(",")",")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n                ",252],["T_VARIABLE","$quote",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","removeAddress",253],"(",["T_VARIABLE","$billingAddress",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getId",253],"(",")",")",";",["T_WHITESPACE","\n            ",253],"}",["T_WHITESPACE","\n\n            ",254],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_VARIABLE","$customerDefaultBilling",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getCustomerDefaultBillingAddress",256],"(",")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n                ",256],["T_VARIABLE","$quote",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getBillingAddress",257],"(",")",["T_OBJECT_OPERATOR","->",257],["T_STRING","importCustomerAddress",257],"(",["T_VARIABLE","$customerDefaultBilling",257],")",";",["T_WHITESPACE","\n            ",257],"}",["T_WHITESPACE","\n\n            ",258],["T_FOREACH","foreach",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$quote",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getAllItems",260],"(",")",["T_WHITESPACE"," ",260],["T_AS","as",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$_item",260],")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n                ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(","!",["T_VARIABLE","$_item",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getProduct",261],"(",")",["T_OBJECT_OPERATOR","->",261],["T_STRING","getIsVirtual",261],"(",")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n                    ",261],["T_CONTINUE","continue",262],";",["T_WHITESPACE","\n                ",262],"}",["T_WHITESPACE","\n\n                ",263],["T_IF","if",265],["T_WHITESPACE"," ",265],"(",["T_ISSET","isset",265],"(",["T_VARIABLE","$itemsInfo",265],"[",["T_VARIABLE","$_item",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getId",265],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",265],"]",")",")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n                    ",265],["T_IF","if",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$qty",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_INT_CAST","(int)",266],["T_VARIABLE","$itemsInfo",266],"[",["T_VARIABLE","$_item",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getId",266],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",266],"]",")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n                        ",266],["T_VARIABLE","$_item",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","setQty",267],"(",["T_VARIABLE","$qty",267],")",";",["T_WHITESPACE","\n                        ",267],["T_VARIABLE","$quote",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getBillingAddress",268],"(",")",["T_OBJECT_OPERATOR","->",268],["T_STRING","addItem",268],"(",["T_VARIABLE","$_item",268],")",";",["T_WHITESPACE","\n                    ",268],"}",["T_WHITESPACE"," ",269],["T_ELSE","else",269],["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n                        ",269],["T_VARIABLE","$_item",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","setQty",270],"(",["T_LNUMBER","0",270],")",";",["T_WHITESPACE","\n                        ",270],["T_VARIABLE","$quote",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","removeItem",271],"(",["T_VARIABLE","$_item",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getId",271],"(",")",")",";",["T_WHITESPACE","\n                    ",271],"}",["T_WHITESPACE","\n                 ",272],"}",["T_WHITESPACE","\n\n            ",273],"}",["T_WHITESPACE","\n\n            ",275],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","save",277],"(",")",";",["T_WHITESPACE","\n            ",277],["T_STRING","Mage",278],["T_DOUBLE_COLON","::",278],["T_STRING","dispatchEvent",278],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_type_multishipping_set_shipping_items'",278],",",["T_WHITESPACE"," ",278],["T_ARRAY","array",278],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",278],["T_DOUBLE_ARROW","=>",278],["T_VARIABLE","$quote",278],")",")",";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n        ",279],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],";",["T_WHITESPACE","\n    ",280],"}",["T_WHITESPACE","\n\n    ",281],["T_DOC_COMMENT","\/**\n     * Add quote item to specific shipping address based on customer address id\n     *\n     * @param int $quoteItemId\n     * @param array $data array('qty'=>$qty, 'address'=>$customerAddressId)\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",283],["T_WHITESPACE","\n    ",289],["T_PROTECTED","protected",290],["T_WHITESPACE"," ",290],["T_FUNCTION","function",290],["T_WHITESPACE"," ",290],["T_STRING","_addShippingItem",290],"(",["T_VARIABLE","$quoteItemId",290],",",["T_WHITESPACE"," ",290],["T_VARIABLE","$data",290],")",["T_WHITESPACE","\n    ",290],"{",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$qty",292],["T_WHITESPACE","       ",292],"=",["T_WHITESPACE"," ",292],["T_ISSET","isset",292],"(",["T_VARIABLE","$data",292],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",292],"]",")",["T_WHITESPACE"," ",292],"?",["T_WHITESPACE"," ",292],["T_INT_CAST","(int)",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$data",292],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",292],"]",["T_WHITESPACE"," ",292],":",["T_WHITESPACE"," ",292],["T_LNUMBER","1",292],";",["T_WHITESPACE","\n        ",292],["T_COMMENT","\/\/$qty       = $qty > 0 ? $qty : 1;\n",293],["T_WHITESPACE","        ",294],["T_VARIABLE","$addressId",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_ISSET","isset",294],"(",["T_VARIABLE","$data",294],"[",["T_CONSTANT_ENCAPSED_STRING","'address'",294],"]",")",["T_WHITESPACE"," ",294],"?",["T_WHITESPACE"," ",294],["T_VARIABLE","$data",294],"[",["T_CONSTANT_ENCAPSED_STRING","'address'",294],"]",["T_WHITESPACE"," ",294],":",["T_WHITESPACE"," ",294],["T_STRING","false",294],";",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$quoteItem",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getQuote",295],"(",")",["T_OBJECT_OPERATOR","->",295],["T_STRING","getItemById",295],"(",["T_VARIABLE","$quoteItemId",295],")",";",["T_WHITESPACE","\n\n        ",295],["T_IF","if",297],["T_WHITESPACE"," ",297],"(",["T_VARIABLE","$addressId",297],["T_WHITESPACE"," ",297],["T_BOOLEAN_AND","&&",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$quoteItem",297],")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n            ",297],["T_DOC_COMMENT","\/**\n             * Skip item processing if qty 0\n             *\/",298],["T_WHITESPACE","\n            ",300],["T_IF","if",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$qty",301],["T_WHITESPACE"," ",301],["T_IS_IDENTICAL","===",301],["T_WHITESPACE"," ",301],["T_LNUMBER","0",301],")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n                ",301],["T_RETURN","return",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],";",["T_WHITESPACE","\n            ",302],"}",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$quoteItem",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","setMultishippingQty",304],"(",["T_INT_CAST","(int)",304],["T_VARIABLE","$quoteItem",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getMultishippingQty",304],"(",")","+",["T_VARIABLE","$qty",304],")",";",["T_WHITESPACE","\n            ",304],["T_VARIABLE","$quoteItem",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","setQty",305],"(",["T_VARIABLE","$quoteItem",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getMultishippingQty",305],"(",")",")",";",["T_WHITESPACE","\n            ",305],["T_VARIABLE","$address",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getCustomer",306],"(",")",["T_OBJECT_OPERATOR","->",306],["T_STRING","getAddressById",306],"(",["T_VARIABLE","$addressId",306],")",";",["T_WHITESPACE","\n            ",306],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_VARIABLE","$address",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getId",307],"(",")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n                ",307],["T_IF","if",308],["T_WHITESPACE"," ",308],"(","!",["T_VARIABLE","$quoteAddress",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getQuote",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getShippingAddressByCustomerAddressId",308],"(",["T_VARIABLE","$address",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getId",308],"(",")",")",")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n                    ",308],["T_VARIABLE","$quoteAddress",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_STRING","Mage",309],["T_DOUBLE_COLON","::",309],["T_STRING","getModel",309],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",309],")",["T_OBJECT_OPERATOR","->",309],["T_STRING","importCustomerAddress",309],"(",["T_VARIABLE","$address",309],")",";",["T_WHITESPACE","\n                    ",309],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getQuote",310],"(",")",["T_OBJECT_OPERATOR","->",310],["T_STRING","addShippingAddress",310],"(",["T_VARIABLE","$quoteAddress",310],")",";",["T_WHITESPACE","\n                    ",310],["T_IF","if",311],["T_WHITESPACE"," ",311],"(",["T_VARIABLE","$couponCode",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getCheckoutSession",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getCartCouponCode",311],"(",")",")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n                        ",311],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","getQuote",312],"(",")",["T_OBJECT_OPERATOR","->",312],["T_STRING","setCouponCode",312],"(",["T_VARIABLE","$couponCode",312],")",";",["T_WHITESPACE","\n                    ",312],"}",["T_WHITESPACE","\n                ",313],"}",["T_WHITESPACE","\n\n                ",314],["T_VARIABLE","$quoteAddress",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getQuote",316],"(",")",["T_OBJECT_OPERATOR","->",316],["T_STRING","getShippingAddressByCustomerAddressId",316],"(",["T_VARIABLE","$address",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getId",316],"(",")",")",";",["T_WHITESPACE","\n                ",316],["T_IF","if",317],["T_WHITESPACE"," ",317],"(",["T_VARIABLE","$quoteAddressItem",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_VARIABLE","$quoteAddress",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getItemByQuoteItemId",317],"(",["T_VARIABLE","$quoteItemId",317],")",")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n                    ",317],["T_VARIABLE","$quoteAddressItem",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","setQty",318],"(",["T_INT_CAST","(int)",318],"(",["T_VARIABLE","$quoteAddressItem",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getQty",318],"(",")","+",["T_VARIABLE","$qty",318],")",")",";",["T_WHITESPACE","\n                ",318],"}",["T_WHITESPACE"," ",319],["T_ELSE","else",319],["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n                    ",319],["T_VARIABLE","$quoteAddress",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","addItem",320],"(",["T_VARIABLE","$quoteItem",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$qty",320],")",";",["T_WHITESPACE","\n                ",320],"}",["T_WHITESPACE","\n                ",321],["T_DOC_COMMENT","\/**\n                 * Require shiping rate recollect\n                 *\/",322],["T_WHITESPACE","\n                ",324],["T_VARIABLE","$quoteAddress",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","setCollectShippingRates",325],"(",["T_BOOL_CAST","(boolean)",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getCollectRatesFlag",325],"(",")",")",";",["T_WHITESPACE","\n            ",325],"}",["T_WHITESPACE","\n        ",326],"}",["T_WHITESPACE","\n        ",327],["T_RETURN","return",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],";",["T_WHITESPACE","\n    ",328],"}",["T_WHITESPACE","\n\n    ",329],["T_DOC_COMMENT","\/**\n     * Reimport customer address info to quote shipping address\n     *\n     * @param int $addressId customer address id\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",331],["T_WHITESPACE","\n    ",336],["T_PUBLIC","public",337],["T_WHITESPACE"," ",337],["T_FUNCTION","function",337],["T_WHITESPACE"," ",337],["T_STRING","updateQuoteCustomerShippingAddress",337],"(",["T_VARIABLE","$addressId",337],")",["T_WHITESPACE","\n    ",337],"{",["T_WHITESPACE","\n        ",338],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$address",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getCustomer",339],"(",")",["T_OBJECT_OPERATOR","->",339],["T_STRING","getAddressById",339],"(",["T_VARIABLE","$addressId",339],")",")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getQuote",340],"(",")",["T_OBJECT_OPERATOR","->",340],["T_STRING","getShippingAddressByCustomerAddressId",340],"(",["T_VARIABLE","$addressId",340],")",["T_WHITESPACE","\n                ",340],["T_OBJECT_OPERATOR","->",341],["T_STRING","setCollectShippingRates",341],"(",["T_STRING","true",341],")",["T_WHITESPACE","\n                ",341],["T_OBJECT_OPERATOR","->",342],["T_STRING","importCustomerAddress",342],"(",["T_VARIABLE","$address",342],")",["T_WHITESPACE","\n                ",342],["T_OBJECT_OPERATOR","->",343],["T_STRING","collectTotals",343],"(",")",";",["T_WHITESPACE","\n            ",343],["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getQuote",344],"(",")",["T_OBJECT_OPERATOR","->",344],["T_STRING","save",344],"(",")",";",["T_WHITESPACE","\n        ",344],"}",["T_WHITESPACE","\n        ",345],["T_RETURN","return",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],";",["T_WHITESPACE","\n    ",346],"}",["T_WHITESPACE","\n\n    ",347],["T_DOC_COMMENT","\/**\n     * Reimport customer billing address to quote\n     *\n     * @param int $addressId customer address id\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",349],["T_WHITESPACE","\n    ",354],["T_PUBLIC","public",355],["T_WHITESPACE"," ",355],["T_FUNCTION","function",355],["T_WHITESPACE"," ",355],["T_STRING","setQuoteCustomerBillingAddress",355],"(",["T_VARIABLE","$addressId",355],")",["T_WHITESPACE","\n    ",355],"{",["T_WHITESPACE","\n        ",356],["T_IF","if",357],["T_WHITESPACE"," ",357],"(",["T_VARIABLE","$address",357],["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getCustomer",357],"(",")",["T_OBJECT_OPERATOR","->",357],["T_STRING","getAddressById",357],"(",["T_VARIABLE","$addressId",357],")",")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n            ",357],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getQuote",358],"(",")",["T_OBJECT_OPERATOR","->",358],["T_STRING","getBillingAddress",358],"(",["T_VARIABLE","$addressId",358],")",["T_WHITESPACE","\n                ",358],["T_OBJECT_OPERATOR","->",359],["T_STRING","importCustomerAddress",359],"(",["T_VARIABLE","$address",359],")",["T_WHITESPACE","\n                ",359],["T_OBJECT_OPERATOR","->",360],["T_STRING","collectTotals",360],"(",")",";",["T_WHITESPACE","\n            ",360],["T_VARIABLE","$this",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getQuote",361],"(",")",["T_OBJECT_OPERATOR","->",361],["T_STRING","collectTotals",361],"(",")",["T_OBJECT_OPERATOR","->",361],["T_STRING","save",361],"(",")",";",["T_WHITESPACE","\n        ",361],"}",["T_WHITESPACE","\n        ",362],["T_RETURN","return",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],";",["T_WHITESPACE","\n    ",363],"}",["T_WHITESPACE","\n\n    ",364],["T_DOC_COMMENT","\/**\n     * Assign shipping methods to addresses\n     *\n     * @param  array $methods\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",366],["T_WHITESPACE","\n    ",371],["T_PUBLIC","public",372],["T_WHITESPACE"," ",372],["T_FUNCTION","function",372],["T_WHITESPACE"," ",372],["T_STRING","setShippingMethods",372],"(",["T_VARIABLE","$methods",372],")",["T_WHITESPACE","\n    ",372],"{",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$addresses",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getQuote",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","getAllShippingAddresses",374],"(",")",";",["T_WHITESPACE","\n        ",374],["T_FOREACH","foreach",375],["T_WHITESPACE"," ",375],"(",["T_VARIABLE","$addresses",375],["T_WHITESPACE"," ",375],["T_AS","as",375],["T_WHITESPACE"," ",375],["T_VARIABLE","$address",375],")",["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n            ",375],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_ISSET","isset",376],"(",["T_VARIABLE","$methods",376],"[",["T_VARIABLE","$address",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","getId",376],"(",")","]",")",")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n                ",376],["T_VARIABLE","$address",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","setShippingMethod",377],"(",["T_VARIABLE","$methods",377],"[",["T_VARIABLE","$address",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getId",377],"(",")","]",")",";",["T_WHITESPACE","\n            ",377],"}",["T_WHITESPACE"," ",378],["T_ELSEIF","elseif",378],["T_WHITESPACE"," ",378],"(","!",["T_VARIABLE","$address",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getShippingMethod",378],"(",")",")",["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n                ",378],["T_STRING","Mage",379],["T_DOUBLE_COLON","::",379],["T_STRING","throwException",379],"(",["T_STRING","Mage",379],["T_DOUBLE_COLON","::",379],["T_STRING","helper",379],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",379],")",["T_OBJECT_OPERATOR","->",379],["T_STRING","__",379],"(",["T_CONSTANT_ENCAPSED_STRING","'Please select shipping methods for all addresses'",379],")",")",";",["T_WHITESPACE","\n            ",379],"}",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","save",382],"(",")",";",["T_WHITESPACE","\n        ",382],["T_RETURN","return",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$this",383],";",["T_WHITESPACE","\n    ",383],"}",["T_WHITESPACE","\n\n    ",384],["T_DOC_COMMENT","\/**\n     * Set payment method info to quote payment\n     *\n     * @param array $payment\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",386],["T_WHITESPACE","\n    ",391],["T_PUBLIC","public",392],["T_WHITESPACE"," ",392],["T_FUNCTION","function",392],["T_WHITESPACE"," ",392],["T_STRING","setPaymentMethod",392],"(",["T_VARIABLE","$payment",392],")",["T_WHITESPACE","\n    ",392],"{",["T_WHITESPACE","\n        ",393],["T_IF","if",394],["T_WHITESPACE"," ",394],"(","!",["T_ISSET","isset",394],"(",["T_VARIABLE","$payment",394],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",394],"]",")",")",["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n            ",394],["T_STRING","Mage",395],["T_DOUBLE_COLON","::",395],["T_STRING","throwException",395],"(",["T_STRING","Mage",395],["T_DOUBLE_COLON","::",395],["T_STRING","helper",395],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",395],")",["T_OBJECT_OPERATOR","->",395],["T_STRING","__",395],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment method is not defined'",395],")",")",";",["T_WHITESPACE","\n        ",395],"}",["T_WHITESPACE","\n        ",396],["T_VARIABLE","$quote",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getQuote",397],"(",")",";",["T_WHITESPACE","\n        ",397],["T_VARIABLE","$quote",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","getPayment",398],"(",")",["T_OBJECT_OPERATOR","->",398],["T_STRING","importData",398],"(",["T_VARIABLE","$payment",398],")",";",["T_WHITESPACE","\n        ",398],["T_COMMENT","\/\/ shipping totals may be affected by payment method\n",399],["T_WHITESPACE","        ",400],["T_IF","if",400],["T_WHITESPACE"," ",400],"(","!",["T_VARIABLE","$quote",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","isVirtual",400],"(",")",["T_WHITESPACE"," ",400],["T_BOOLEAN_AND","&&",400],["T_WHITESPACE"," ",400],["T_VARIABLE","$quote",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getShippingAddress",400],"(",")",")",["T_WHITESPACE"," ",400],"{",["T_WHITESPACE","\n            ",400],["T_VARIABLE","$quote",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getShippingAddress",401],"(",")",["T_OBJECT_OPERATOR","->",401],["T_STRING","setCollectShippingRates",401],"(",["T_STRING","true",401],")",";",["T_WHITESPACE","\n            ",401],["T_VARIABLE","$quote",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","setTotalsCollectedFlag",402],"(",["T_STRING","false",402],")",["T_OBJECT_OPERATOR","->",402],["T_STRING","collectTotals",402],"(",")",";",["T_WHITESPACE","\n        ",402],"}",["T_WHITESPACE","\n        ",403],["T_VARIABLE","$quote",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","save",404],"(",")",";",["T_WHITESPACE","\n        ",404],["T_RETURN","return",405],["T_WHITESPACE"," ",405],["T_VARIABLE","$this",405],";",["T_WHITESPACE","\n    ",405],"}",["T_WHITESPACE","\n\n    ",406],["T_DOC_COMMENT","\/**\n     * Prepare order based on quote address\n     *\n     * @param   Mage_Sales_Model_Quote_Address $address\n     * @return  Mage_Sales_Model_Order\n     * @throws  Mage_Checkout_Exception\n     *\/",408],["T_WHITESPACE","\n    ",414],["T_PROTECTED","protected",415],["T_WHITESPACE"," ",415],["T_FUNCTION","function",415],["T_WHITESPACE"," ",415],["T_STRING","_prepareOrder",415],"(",["T_STRING","Mage_Sales_Model_Quote_Address",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$address",415],")",["T_WHITESPACE","\n    ",415],"{",["T_WHITESPACE","\n        ",416],["T_VARIABLE","$quote",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getQuote",417],"(",")",";",["T_WHITESPACE","\n        ",417],["T_VARIABLE","$quote",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","unsReservedOrderId",418],"(",")",";",["T_WHITESPACE","\n        ",418],["T_VARIABLE","$quote",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","reserveOrderId",419],"(",")",";",["T_WHITESPACE","\n        ",419],["T_VARIABLE","$quote",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","collectTotals",420],"(",")",";",["T_WHITESPACE","\n\n        ",420],["T_VARIABLE","$convertQuote",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_STRING","Mage",422],["T_DOUBLE_COLON","::",422],["T_STRING","getSingleton",422],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/convert_quote'",422],")",";",["T_WHITESPACE","\n        ",422],["T_VARIABLE","$order",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$convertQuote",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","addressToOrder",423],"(",["T_VARIABLE","$address",423],")",";",["T_WHITESPACE","\n        ",423],["T_VARIABLE","$order",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","setQuote",424],"(",["T_VARIABLE","$quote",424],")",";",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$order",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","setBillingAddress",425],"(",["T_WHITESPACE","\n            ",425],["T_VARIABLE","$convertQuote",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","addressToOrderAddress",426],"(",["T_VARIABLE","$quote",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getBillingAddress",426],"(",")",")",["T_WHITESPACE","\n        ",426],")",";",["T_WHITESPACE","\n\n        ",427],["T_IF","if",429],["T_WHITESPACE"," ",429],"(",["T_VARIABLE","$address",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getAddressType",429],"(",")",["T_WHITESPACE"," ",429],["T_IS_EQUAL","==",429],["T_WHITESPACE"," ",429],["T_CONSTANT_ENCAPSED_STRING","'billing'",429],")",["T_WHITESPACE"," ",429],"{",["T_WHITESPACE","\n            ",429],["T_VARIABLE","$order",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","setIsVirtual",430],"(",["T_LNUMBER","1",430],")",";",["T_WHITESPACE","\n        ",430],"}",["T_WHITESPACE"," ",431],["T_ELSE","else",431],["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n            ",431],["T_VARIABLE","$order",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","setShippingAddress",432],"(",["T_VARIABLE","$convertQuote",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","addressToOrderAddress",432],"(",["T_VARIABLE","$address",432],")",")",";",["T_WHITESPACE","\n        ",432],"}",["T_WHITESPACE","\n\n        ",433],["T_VARIABLE","$order",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","setPayment",435],"(",["T_VARIABLE","$convertQuote",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","paymentToOrderPayment",435],"(",["T_VARIABLE","$quote",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getPayment",435],"(",")",")",")",";",["T_WHITESPACE","\n        ",435],["T_IF","if",436],["T_WHITESPACE"," ",436],"(",["T_STRING","Mage",436],["T_DOUBLE_COLON","::",436],["T_STRING","app",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","getStore",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","roundPrice",436],"(",["T_VARIABLE","$address",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getGrandTotal",436],"(",")",")",["T_WHITESPACE"," ",436],["T_IS_EQUAL","==",436],["T_WHITESPACE"," ",436],["T_LNUMBER","0",436],")",["T_WHITESPACE"," ",436],"{",["T_WHITESPACE","\n            ",436],["T_VARIABLE","$order",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","getPayment",437],"(",")",["T_OBJECT_OPERATOR","->",437],["T_STRING","setMethod",437],"(",["T_CONSTANT_ENCAPSED_STRING","'free'",437],")",";",["T_WHITESPACE","\n        ",437],"}",["T_WHITESPACE","\n\n        ",438],["T_FOREACH","foreach",440],["T_WHITESPACE"," ",440],"(",["T_VARIABLE","$address",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getAllItems",440],"(",")",["T_WHITESPACE"," ",440],["T_AS","as",440],["T_WHITESPACE"," ",440],["T_VARIABLE","$item",440],")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n            ",440],["T_VARIABLE","$_quoteItem",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$item",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getQuoteItem",441],"(",")",";",["T_WHITESPACE","\n            ",441],["T_IF","if",442],["T_WHITESPACE"," ",442],"(","!",["T_VARIABLE","$_quoteItem",442],")",["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n                ",442],["T_THROW","throw",443],["T_WHITESPACE"," ",443],["T_NEW","new",443],["T_WHITESPACE"," ",443],["T_STRING","Mage_Checkout_Exception",443],"(",["T_STRING","Mage",443],["T_DOUBLE_COLON","::",443],["T_STRING","helper",443],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",443],")",["T_OBJECT_OPERATOR","->",443],["T_STRING","__",443],"(",["T_CONSTANT_ENCAPSED_STRING","'Item not found or already ordered'",443],")",")",";",["T_WHITESPACE","\n            ",443],"}",["T_WHITESPACE","\n            ",444],["T_VARIABLE","$item",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","setProductType",445],"(",["T_VARIABLE","$_quoteItem",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getProductType",445],"(",")",")",["T_WHITESPACE","\n                ",445],["T_OBJECT_OPERATOR","->",446],["T_STRING","setProductOptions",446],"(",["T_WHITESPACE","\n                    ",446],["T_VARIABLE","$_quoteItem",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getProduct",447],"(",")",["T_OBJECT_OPERATOR","->",447],["T_STRING","getTypeInstance",447],"(",["T_STRING","true",447],")",["T_OBJECT_OPERATOR","->",447],["T_STRING","getOrderOptions",447],"(",["T_VARIABLE","$_quoteItem",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getProduct",447],"(",")",")",["T_WHITESPACE","\n                ",447],")",";",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$orderItem",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_VARIABLE","$convertQuote",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","itemToOrderItem",449],"(",["T_VARIABLE","$item",449],")",";",["T_WHITESPACE","\n            ",449],["T_IF","if",450],["T_WHITESPACE"," ",450],"(",["T_VARIABLE","$item",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getParentItem",450],"(",")",")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n                ",450],["T_VARIABLE","$orderItem",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","setParentItem",451],"(",["T_VARIABLE","$order",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getItemByQuoteItemId",451],"(",["T_VARIABLE","$item",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getParentItem",451],"(",")",["T_OBJECT_OPERATOR","->",451],["T_STRING","getId",451],"(",")",")",")",";",["T_WHITESPACE","\n            ",451],"}",["T_WHITESPACE","\n            ",452],["T_VARIABLE","$order",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","addItem",453],"(",["T_VARIABLE","$orderItem",453],")",";",["T_WHITESPACE","\n        ",453],"}",["T_WHITESPACE","\n\n        ",454],["T_RETURN","return",456],["T_WHITESPACE"," ",456],["T_VARIABLE","$order",456],";",["T_WHITESPACE","\n    ",456],"}",["T_WHITESPACE","\n\n    ",457],["T_DOC_COMMENT","\/**\n     * Validate quote data\n     *\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",459],["T_WHITESPACE","\n    ",463],["T_PROTECTED","protected",464],["T_WHITESPACE"," ",464],["T_FUNCTION","function",464],["T_WHITESPACE"," ",464],["T_STRING","_validate",464],"(",")",["T_WHITESPACE","\n    ",464],"{",["T_WHITESPACE","\n        ",465],["T_VARIABLE","$quote",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","getQuote",466],"(",")",";",["T_WHITESPACE","\n        ",466],["T_IF","if",467],["T_WHITESPACE"," ",467],"(","!",["T_VARIABLE","$quote",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","getIsMultiShipping",467],"(",")",")",["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n            ",467],["T_STRING","Mage",468],["T_DOUBLE_COLON","::",468],["T_STRING","throwException",468],"(",["T_STRING","Mage",468],["T_DOUBLE_COLON","::",468],["T_STRING","helper",468],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",468],")",["T_OBJECT_OPERATOR","->",468],["T_STRING","__",468],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid checkout type.'",468],")",")",";",["T_WHITESPACE","\n        ",468],"}",["T_WHITESPACE","\n\n        ",469],["T_DOC_COMMENT","\/** @var $paymentMethod Mage_Payment_Model_Method_Abstract *\/",471],["T_WHITESPACE","\n        ",471],["T_VARIABLE","$paymentMethod",472],["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$quote",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getPayment",472],"(",")",["T_OBJECT_OPERATOR","->",472],["T_STRING","getMethodInstance",472],"(",")",";",["T_WHITESPACE","\n        ",472],["T_IF","if",473],["T_WHITESPACE"," ",473],"(","!",["T_EMPTY","empty",473],"(",["T_VARIABLE","$paymentMethod",473],")",["T_WHITESPACE"," ",473],["T_BOOLEAN_AND","&&",473],["T_WHITESPACE"," ",473],"!",["T_VARIABLE","$paymentMethod",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","isAvailable",473],"(",["T_VARIABLE","$quote",473],")",")",["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n            ",473],["T_STRING","Mage",474],["T_DOUBLE_COLON","::",474],["T_STRING","throwException",474],"(",["T_STRING","Mage",474],["T_DOUBLE_COLON","::",474],["T_STRING","helper",474],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",474],")",["T_OBJECT_OPERATOR","->",474],["T_STRING","__",474],"(",["T_CONSTANT_ENCAPSED_STRING","'Please specify payment method.'",474],")",")",";",["T_WHITESPACE","\n        ",474],"}",["T_WHITESPACE","\n\n        ",475],["T_VARIABLE","$addresses",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$quote",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getAllShippingAddresses",477],"(",")",";",["T_WHITESPACE","\n        ",477],["T_FOREACH","foreach",478],["T_WHITESPACE"," ",478],"(",["T_VARIABLE","$addresses",478],["T_WHITESPACE"," ",478],["T_AS","as",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$address",478],")",["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n            ",478],["T_VARIABLE","$addressValidation",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_VARIABLE","$address",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","validate",479],"(",")",";",["T_WHITESPACE","\n            ",479],["T_IF","if",480],["T_WHITESPACE"," ",480],"(",["T_VARIABLE","$addressValidation",480],["T_WHITESPACE"," ",480],["T_IS_NOT_IDENTICAL","!==",480],["T_WHITESPACE"," ",480],["T_STRING","true",480],")",["T_WHITESPACE"," ",480],"{",["T_WHITESPACE","\n                ",480],["T_STRING","Mage",481],["T_DOUBLE_COLON","::",481],["T_STRING","throwException",481],"(",["T_STRING","Mage",481],["T_DOUBLE_COLON","::",481],["T_STRING","helper",481],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",481],")",["T_OBJECT_OPERATOR","->",481],["T_STRING","__",481],"(",["T_CONSTANT_ENCAPSED_STRING","'Please check shipping addresses information.'",481],")",")",";",["T_WHITESPACE","\n            ",481],"}",["T_WHITESPACE","\n            ",482],["T_VARIABLE","$method",483],"=",["T_WHITESPACE"," ",483],["T_VARIABLE","$address",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getShippingMethod",483],"(",")",";",["T_WHITESPACE","\n            ",483],["T_VARIABLE","$rate",484],["T_WHITESPACE","  ",484],"=",["T_WHITESPACE"," ",484],["T_VARIABLE","$address",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getShippingRateByCode",484],"(",["T_VARIABLE","$method",484],")",";",["T_WHITESPACE","\n            ",484],["T_IF","if",485],["T_WHITESPACE"," ",485],"(","!",["T_VARIABLE","$method",485],["T_WHITESPACE"," ",485],["T_BOOLEAN_OR","||",485],["T_WHITESPACE"," ",485],"!",["T_VARIABLE","$rate",485],")",["T_WHITESPACE"," ",485],"{",["T_WHITESPACE","\n                ",485],["T_STRING","Mage",486],["T_DOUBLE_COLON","::",486],["T_STRING","throwException",486],"(",["T_STRING","Mage",486],["T_DOUBLE_COLON","::",486],["T_STRING","helper",486],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",486],")",["T_OBJECT_OPERATOR","->",486],["T_STRING","__",486],"(",["T_CONSTANT_ENCAPSED_STRING","'Please specify shipping methods for all addresses.'",486],")",")",";",["T_WHITESPACE","\n            ",486],"}",["T_WHITESPACE","\n        ",487],"}",["T_WHITESPACE","\n        ",488],["T_VARIABLE","$addressValidation",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_VARIABLE","$quote",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getBillingAddress",489],"(",")",["T_OBJECT_OPERATOR","->",489],["T_STRING","validate",489],"(",")",";",["T_WHITESPACE","\n        ",489],["T_IF","if",490],["T_WHITESPACE"," ",490],"(",["T_VARIABLE","$addressValidation",490],["T_WHITESPACE"," ",490],["T_IS_NOT_IDENTICAL","!==",490],["T_WHITESPACE"," ",490],["T_STRING","true",490],")",["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n            ",490],["T_STRING","Mage",491],["T_DOUBLE_COLON","::",491],["T_STRING","throwException",491],"(",["T_STRING","Mage",491],["T_DOUBLE_COLON","::",491],["T_STRING","helper",491],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",491],")",["T_OBJECT_OPERATOR","->",491],["T_STRING","__",491],"(",["T_CONSTANT_ENCAPSED_STRING","'Please check billing address information.'",491],")",")",";",["T_WHITESPACE","\n        ",491],"}",["T_WHITESPACE","\n        ",492],["T_RETURN","return",493],["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],";",["T_WHITESPACE","\n    ",493],"}",["T_WHITESPACE","\n\n    ",494],["T_DOC_COMMENT","\/**\n     * Create orders per each quote address\n     *\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",496],["T_WHITESPACE","\n    ",500],["T_PUBLIC","public",501],["T_WHITESPACE"," ",501],["T_FUNCTION","function",501],["T_WHITESPACE"," ",501],["T_STRING","createOrders",501],"(",")",["T_WHITESPACE","\n    ",501],"{",["T_WHITESPACE","\n        ",502],["T_VARIABLE","$orderIds",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_ARRAY","array",503],"(",")",";",["T_WHITESPACE","\n        ",503],["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","_validate",504],"(",")",";",["T_WHITESPACE","\n        ",504],["T_VARIABLE","$shippingAddresses",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getQuote",505],"(",")",["T_OBJECT_OPERATOR","->",505],["T_STRING","getAllShippingAddresses",505],"(",")",";",["T_WHITESPACE","\n        ",505],["T_VARIABLE","$orders",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_ARRAY","array",506],"(",")",";",["T_WHITESPACE","\n\n        ",506],["T_IF","if",508],["T_WHITESPACE"," ",508],"(",["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","getQuote",508],"(",")",["T_OBJECT_OPERATOR","->",508],["T_STRING","hasVirtualItems",508],"(",")",")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n            ",508],["T_VARIABLE","$shippingAddresses",509],"[","]",["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getQuote",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","getBillingAddress",509],"(",")",";",["T_WHITESPACE","\n        ",509],"}",["T_WHITESPACE","\n\n        ",510],["T_TRY","try",512],["T_WHITESPACE"," ",512],"{",["T_WHITESPACE","\n            ",512],["T_FOREACH","foreach",513],["T_WHITESPACE"," ",513],"(",["T_VARIABLE","$shippingAddresses",513],["T_WHITESPACE"," ",513],["T_AS","as",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$address",513],")",["T_WHITESPACE"," ",513],"{",["T_WHITESPACE","\n                ",513],["T_VARIABLE","$order",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","_prepareOrder",514],"(",["T_VARIABLE","$address",514],")",";",["T_WHITESPACE","\n\n                ",514],["T_VARIABLE","$orders",516],"[","]",["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_VARIABLE","$order",516],";",["T_WHITESPACE","\n                ",516],["T_STRING","Mage",517],["T_DOUBLE_COLON","::",517],["T_STRING","dispatchEvent",517],"(",["T_WHITESPACE","\n                    ",517],["T_CONSTANT_ENCAPSED_STRING","'checkout_type_multishipping_create_orders_single'",518],",",["T_WHITESPACE","\n                    ",518],["T_ARRAY","array",519],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",519],["T_DOUBLE_ARROW","=>",519],["T_VARIABLE","$order",519],",",["T_WHITESPACE"," ",519],["T_CONSTANT_ENCAPSED_STRING","'address'",519],["T_DOUBLE_ARROW","=>",519],["T_VARIABLE","$address",519],")",["T_WHITESPACE","\n                ",519],")",";",["T_WHITESPACE","\n            ",520],"}",["T_WHITESPACE","\n\n            ",521],["T_FOREACH","foreach",523],["T_WHITESPACE"," ",523],"(",["T_VARIABLE","$orders",523],["T_WHITESPACE"," ",523],["T_AS","as",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$order",523],")",["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n                ",523],["T_VARIABLE","$order",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","place",524],"(",")",";",["T_WHITESPACE","\n                ",524],["T_VARIABLE","$order",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","save",525],"(",")",";",["T_WHITESPACE","\n                ",525],["T_IF","if",526],["T_WHITESPACE"," ",526],"(",["T_VARIABLE","$order",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getCanSendNewEmailFlag",526],"(",")",")","{",["T_WHITESPACE","\n                    ",526],["T_VARIABLE","$order",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","queueNewOrderEmail",527],"(",")",";",["T_WHITESPACE","\n                ",527],"}",["T_WHITESPACE","\n                ",528],["T_VARIABLE","$orderIds",529],"[",["T_VARIABLE","$order",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getId",529],"(",")","]",["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$order",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getIncrementId",529],"(",")",";",["T_WHITESPACE","\n            ",529],"}",["T_WHITESPACE","\n\n            ",530],["T_STRING","Mage",532],["T_DOUBLE_COLON","::",532],["T_STRING","getSingleton",532],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/session'",532],")",["T_OBJECT_OPERATOR","->",532],["T_STRING","setOrderIds",532],"(",["T_VARIABLE","$orderIds",532],")",";",["T_WHITESPACE","\n            ",532],["T_STRING","Mage",533],["T_DOUBLE_COLON","::",533],["T_STRING","getSingleton",533],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",533],")",["T_OBJECT_OPERATOR","->",533],["T_STRING","setLastQuoteId",533],"(",["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getQuote",533],"(",")",["T_OBJECT_OPERATOR","->",533],["T_STRING","getId",533],"(",")",")",";",["T_WHITESPACE","\n\n            ",533],["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","getQuote",535],"(",")",["T_WHITESPACE","\n                ",535],["T_OBJECT_OPERATOR","->",536],["T_STRING","setIsActive",536],"(",["T_STRING","false",536],")",["T_WHITESPACE","\n                ",536],["T_OBJECT_OPERATOR","->",537],["T_STRING","save",537],"(",")",";",["T_WHITESPACE","\n\n            ",537],["T_STRING","Mage",539],["T_DOUBLE_COLON","::",539],["T_STRING","dispatchEvent",539],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_submit_all_after'",539],",",["T_WHITESPACE"," ",539],["T_ARRAY","array",539],"(",["T_CONSTANT_ENCAPSED_STRING","'orders'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$orders",539],",",["T_WHITESPACE"," ",539],["T_CONSTANT_ENCAPSED_STRING","'quote'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$this",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","getQuote",539],"(",")",")",")",";",["T_WHITESPACE","\n\n            ",539],["T_RETURN","return",541],["T_WHITESPACE"," ",541],["T_VARIABLE","$this",541],";",["T_WHITESPACE","\n        ",541],"}",["T_WHITESPACE"," ",542],["T_CATCH","catch",542],["T_WHITESPACE"," ",542],"(",["T_STRING","Exception",542],["T_WHITESPACE"," ",542],["T_VARIABLE","$e",542],")",["T_WHITESPACE"," ",542],"{",["T_WHITESPACE","\n            ",542],["T_STRING","Mage",543],["T_DOUBLE_COLON","::",543],["T_STRING","dispatchEvent",543],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_multishipping_refund_all'",543],",",["T_WHITESPACE"," ",543],["T_ARRAY","array",543],"(",["T_CONSTANT_ENCAPSED_STRING","'orders'",543],["T_WHITESPACE"," ",543],["T_DOUBLE_ARROW","=>",543],["T_WHITESPACE"," ",543],["T_VARIABLE","$orders",543],")",")",";",["T_WHITESPACE","\n            ",543],["T_THROW","throw",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$e",544],";",["T_WHITESPACE","\n        ",544],"}",["T_WHITESPACE","\n    ",545],"}",["T_WHITESPACE","\n\n    ",546],["T_DOC_COMMENT","\/**\n     * Collect quote totals and save quote object\n     *\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",548],["T_WHITESPACE","\n    ",552],["T_PUBLIC","public",553],["T_WHITESPACE"," ",553],["T_FUNCTION","function",553],["T_WHITESPACE"," ",553],["T_STRING","save",553],"(",")",["T_WHITESPACE","\n    ",553],"{",["T_WHITESPACE","\n        ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","getQuote",555],"(",")",["T_OBJECT_OPERATOR","->",555],["T_STRING","collectTotals",555],"(",")",["T_WHITESPACE","\n            ",555],["T_OBJECT_OPERATOR","->",556],["T_STRING","save",556],"(",")",";",["T_WHITESPACE","\n        ",556],["T_RETURN","return",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],";",["T_WHITESPACE","\n    ",557],"}",["T_WHITESPACE","\n\n    ",558],["T_DOC_COMMENT","\/**\n     * Specify BEGIN state in checkout session whot allow reinit multishipping checkout\n     *\n     * @return Mage_Checkout_Model_Type_Multishipping\n     *\/",560],["T_WHITESPACE","\n    ",564],["T_PUBLIC","public",565],["T_WHITESPACE"," ",565],["T_FUNCTION","function",565],["T_WHITESPACE"," ",565],["T_STRING","reset",565],"(",")",["T_WHITESPACE","\n    ",565],"{",["T_WHITESPACE","\n        ",566],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getCheckoutSession",567],"(",")",["T_OBJECT_OPERATOR","->",567],["T_STRING","setCheckoutState",567],"(",["T_STRING","Mage_Checkout_Model_Session",567],["T_DOUBLE_COLON","::",567],["T_STRING","CHECKOUT_STATE_BEGIN",567],")",";",["T_WHITESPACE","\n        ",567],["T_RETURN","return",568],["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],";",["T_WHITESPACE","\n    ",568],"}",["T_WHITESPACE","\n\n    ",569],["T_DOC_COMMENT","\/**\n     * Check if quote amount is allowed for multishipping checkout\n     *\n     * @return bool\n     *\/",571],["T_WHITESPACE","\n    ",575],["T_PUBLIC","public",576],["T_WHITESPACE"," ",576],["T_FUNCTION","function",576],["T_WHITESPACE"," ",576],["T_STRING","validateMinimumAmount",576],"(",")",["T_WHITESPACE","\n    ",576],"{",["T_WHITESPACE","\n        ",577],["T_RETURN","return",578],["T_WHITESPACE"," ",578],"!","(",["T_STRING","Mage",578],["T_DOUBLE_COLON","::",578],["T_STRING","getStoreConfigFlag",578],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/active'",578],")",["T_WHITESPACE","\n            ",578],["T_BOOLEAN_AND","&&",579],["T_WHITESPACE"," ",579],["T_STRING","Mage",579],["T_DOUBLE_COLON","::",579],["T_STRING","getStoreConfigFlag",579],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/multi_address'",579],")",["T_WHITESPACE","\n            ",579],["T_BOOLEAN_AND","&&",580],["T_WHITESPACE"," ",580],"!",["T_VARIABLE","$this",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getQuote",580],"(",")",["T_OBJECT_OPERATOR","->",580],["T_STRING","validateMinimumAmount",580],"(",")",")",";",["T_WHITESPACE","\n    ",580],"}",["T_WHITESPACE","\n\n    ",581],["T_DOC_COMMENT","\/**\n     * Get notification message for case when multishipping checkout is not allowed\n     *\n     * @return string\n     *\/",583],["T_WHITESPACE","\n    ",587],["T_PUBLIC","public",588],["T_WHITESPACE"," ",588],["T_FUNCTION","function",588],["T_WHITESPACE"," ",588],["T_STRING","getMinimumAmountDescription",588],"(",")",["T_WHITESPACE","\n    ",588],"{",["T_WHITESPACE","\n        ",589],["T_VARIABLE","$descr",590],["T_WHITESPACE"," ",590],"=",["T_WHITESPACE"," ",590],["T_STRING","Mage",590],["T_DOUBLE_COLON","::",590],["T_STRING","getStoreConfig",590],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/multi_address_description'",590],")",";",["T_WHITESPACE","\n        ",590],["T_IF","if",591],["T_WHITESPACE"," ",591],"(",["T_EMPTY","empty",591],"(",["T_VARIABLE","$descr",591],")",")",["T_WHITESPACE"," ",591],"{",["T_WHITESPACE","\n            ",591],["T_VARIABLE","$descr",592],["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_STRING","Mage",592],["T_DOUBLE_COLON","::",592],["T_STRING","getStoreConfig",592],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/description'",592],")",";",["T_WHITESPACE","\n        ",592],"}",["T_WHITESPACE","\n        ",593],["T_RETURN","return",594],["T_WHITESPACE"," ",594],["T_VARIABLE","$descr",594],";",["T_WHITESPACE","\n    ",594],"}",["T_WHITESPACE","\n\n    ",595],["T_PUBLIC","public",597],["T_WHITESPACE"," ",597],["T_FUNCTION","function",597],["T_WHITESPACE"," ",597],["T_STRING","getMinimumAmountError",597],"(",")",["T_WHITESPACE","\n    ",597],"{",["T_WHITESPACE","\n        ",598],["T_VARIABLE","$error",599],["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_STRING","Mage",599],["T_DOUBLE_COLON","::",599],["T_STRING","getStoreConfig",599],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/multi_address_error_message'",599],")",";",["T_WHITESPACE","\n        ",599],["T_IF","if",600],["T_WHITESPACE"," ",600],"(",["T_EMPTY","empty",600],"(",["T_VARIABLE","$error",600],")",")",["T_WHITESPACE"," ",600],"{",["T_WHITESPACE","\n            ",600],["T_VARIABLE","$error",601],["T_WHITESPACE"," ",601],"=",["T_WHITESPACE"," ",601],["T_STRING","Mage",601],["T_DOUBLE_COLON","::",601],["T_STRING","getStoreConfig",601],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/error_message'",601],")",";",["T_WHITESPACE","\n        ",601],"}",["T_WHITESPACE","\n        ",602],["T_RETURN","return",603],["T_WHITESPACE"," ",603],["T_VARIABLE","$error",603],";",["T_WHITESPACE","\n    ",603],"}",["T_WHITESPACE","\n\n    ",604],["T_DOC_COMMENT","\/**\n     * Function is deprecated. Moved into helper.\n     *\n     * Check if multishipping checkout is available.\n     * There should be a valid quote in checkout session. If not, only the config value will be returned.\n     *\n     * @return bool\n     *\/",606],["T_WHITESPACE","\n    ",613],["T_PUBLIC","public",614],["T_WHITESPACE"," ",614],["T_FUNCTION","function",614],["T_WHITESPACE"," ",614],["T_STRING","isCheckoutAvailable",614],"(",")",["T_WHITESPACE","\n    ",614],"{",["T_WHITESPACE","\n        ",615],["T_RETURN","return",616],["T_WHITESPACE"," ",616],["T_STRING","Mage",616],["T_DOUBLE_COLON","::",616],["T_STRING","helper",616],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",616],")",["T_OBJECT_OPERATOR","->",616],["T_STRING","isMultishippingCheckoutAvailable",616],"(",")",";",["T_WHITESPACE","\n    ",616],"}",["T_WHITESPACE","\n\n    ",617],["T_DOC_COMMENT","\/**\n     * Get order IDs created during checkout\n     *\n     * @param bool $asAssoc\n     * @return array\n     *\/",619],["T_WHITESPACE","\n    ",624],["T_PUBLIC","public",625],["T_WHITESPACE"," ",625],["T_FUNCTION","function",625],["T_WHITESPACE"," ",625],["T_STRING","getOrderIds",625],"(",["T_VARIABLE","$asAssoc",625],["T_WHITESPACE"," ",625],"=",["T_WHITESPACE"," ",625],["T_STRING","false",625],")",["T_WHITESPACE","\n    ",625],"{",["T_WHITESPACE","\n        ",626],["T_VARIABLE","$idsAssoc",627],["T_WHITESPACE"," ",627],"=",["T_WHITESPACE"," ",627],["T_STRING","Mage",627],["T_DOUBLE_COLON","::",627],["T_STRING","getSingleton",627],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/session'",627],")",["T_OBJECT_OPERATOR","->",627],["T_STRING","getOrderIds",627],"(",")",";",["T_WHITESPACE","\n        ",627],["T_RETURN","return",628],["T_WHITESPACE"," ",628],["T_VARIABLE","$asAssoc",628],["T_WHITESPACE"," ",628],"?",["T_WHITESPACE"," ",628],["T_VARIABLE","$idsAssoc",628],["T_WHITESPACE"," ",628],":",["T_WHITESPACE"," ",628],["T_STRING","array_keys",628],"(",["T_VARIABLE","$idsAssoc",628],")",";",["T_WHITESPACE","\n    ",628],"}",["T_WHITESPACE","\n",629],"}",["T_WHITESPACE","\n",630]]