[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Shopping cart api\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Cart_Api",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Api_Resource",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","__construct",37],"(",")",["T_WHITESPACE","\n    ",37],"{",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","_storeIdSessionField",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"cart_store_id\"",39],";",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","_attributesMap",40],"[",["T_CONSTANT_ENCAPSED_STRING","'quote'",40],"]",["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_ARRAY","array",40],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_id'",40],["T_WHITESPACE"," ",40],["T_DOUBLE_ARROW","=>",40],["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",40],")",";",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","_attributesMap",41],"[",["T_CONSTANT_ENCAPSED_STRING","'quote_customer'",41],"]",["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_ARRAY","array",41],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",41],["T_WHITESPACE"," ",41],["T_DOUBLE_ARROW","=>",41],["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",41],")",";",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","_attributesMap",42],"[",["T_CONSTANT_ENCAPSED_STRING","'quote_address'",42],"]",["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_ARRAY","array",42],"(",["T_CONSTANT_ENCAPSED_STRING","'address_id'",42],["T_WHITESPACE"," ",42],["T_DOUBLE_ARROW","=>",42],["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",42],")",";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_attributesMap",43],"[",["T_CONSTANT_ENCAPSED_STRING","'quote_payment'",43],"]",["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_ARRAY","array",43],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_id'",43],["T_WHITESPACE"," ",43],["T_DOUBLE_ARROW","=>",43],["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Create new quote for shopping cart\n     *\n     * @param int|string $store\n     * @return int\n     *\/",46],["T_WHITESPACE","\n    ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","create",52],"(",["T_VARIABLE","$store",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","null",52],")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$storeId",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_getStoreId",54],"(",["T_VARIABLE","$store",54],")",";",["T_WHITESPACE","\n\n        ",54],["T_TRY","try",56],["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_COMMENT","\/*@var $quote Mage_Sales_Model_Quote*\/",57],["T_WHITESPACE","\n            ",57],["T_VARIABLE","$quote",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","Mage",58],["T_DOUBLE_COLON","::",58],["T_STRING","getModel",58],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",58],")",";",["T_WHITESPACE","\n            ",58],["T_VARIABLE","$quote",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","setStoreId",59],"(",["T_VARIABLE","$storeId",59],")",["T_WHITESPACE","\n                    ",59],["T_OBJECT_OPERATOR","->",60],["T_STRING","setIsActive",60],"(",["T_STRING","false",60],")",["T_WHITESPACE","\n                    ",60],["T_OBJECT_OPERATOR","->",61],["T_STRING","setIsMultiShipping",61],"(",["T_STRING","false",61],")",["T_WHITESPACE","\n                    ",61],["T_OBJECT_OPERATOR","->",62],["T_STRING","save",62],"(",")",";",["T_WHITESPACE","\n        ",62],"}",["T_WHITESPACE"," ",63],["T_CATCH","catch",63],["T_WHITESPACE"," ",63],"(",["T_STRING","Mage_Core_Exception",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$e",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_fault",64],"(",["T_CONSTANT_ENCAPSED_STRING","'create_quote_fault'",64],",",["T_WHITESPACE"," ",64],["T_VARIABLE","$e",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getMessage",64],"(",")",")",";",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE","\n        ",65],["T_RETURN","return",66],["T_WHITESPACE"," ",66],["T_INT_CAST","(int)",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$quote",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getId",66],"(",")",";",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Retrieve full information about quote\n     *\n     * @param  $quoteId\n     * @param  $store\n     * @return array\n     *\/",69],["T_WHITESPACE","\n    ",75],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","info",76],"(",["T_VARIABLE","$quoteId",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$store",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","null",76],")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$quote",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getQuote",78],"(",["T_VARIABLE","$quoteId",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$store",78],")",";",["T_WHITESPACE","\n\n        ",78],["T_IF","if",80],["T_WHITESPACE"," ",80],"(",["T_VARIABLE","$quote",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getGiftMessageId",80],"(",")",["T_WHITESPACE"," ",80],">",["T_WHITESPACE"," ",80],["T_LNUMBER","0",80],")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$quote",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","setGiftMessage",81],"(",["T_WHITESPACE","\n                ",81],["T_STRING","Mage",82],["T_DOUBLE_COLON","::",82],["T_STRING","getSingleton",82],"(",["T_CONSTANT_ENCAPSED_STRING","'giftmessage\/message'",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","load",82],"(",["T_VARIABLE","$quote",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getGiftMessageId",82],"(",")",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","getMessage",82],"(",")",["T_WHITESPACE","\n            ",82],")",";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n\n        ",84],["T_VARIABLE","$result",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_getAttributes",86],"(",["T_VARIABLE","$quote",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'quote'",86],")",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$result",87],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_address'",87],"]",["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_getAttributes",87],"(",["T_VARIABLE","$quote",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getShippingAddress",87],"(",")",",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'quote_address'",87],")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$result",88],"[",["T_CONSTANT_ENCAPSED_STRING","'billing_address'",88],"]",["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_getAttributes",88],"(",["T_VARIABLE","$quote",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getBillingAddress",88],"(",")",",",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'quote_address'",88],")",";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$result",89],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",89],"]",["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_ARRAY","array",89],"(",")",";",["T_WHITESPACE","\n\n        ",89],["T_FOREACH","foreach",91],["T_WHITESPACE"," ",91],"(",["T_VARIABLE","$quote",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getAllItems",91],"(",")",["T_WHITESPACE"," ",91],["T_AS","as",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$item",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_VARIABLE","$item",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getGiftMessageId",92],"(",")",["T_WHITESPACE"," ",92],">",["T_WHITESPACE"," ",92],["T_LNUMBER","0",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$item",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","setGiftMessage",93],"(",["T_WHITESPACE","\n                    ",93],["T_STRING","Mage",94],["T_DOUBLE_COLON","::",94],["T_STRING","getSingleton",94],"(",["T_CONSTANT_ENCAPSED_STRING","'giftmessage\/message'",94],")",["T_OBJECT_OPERATOR","->",94],["T_STRING","load",94],"(",["T_VARIABLE","$item",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getGiftMessageId",94],"(",")",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","getMessage",94],"(",")",["T_WHITESPACE","\n                ",94],")",";",["T_WHITESPACE","\n            ",95],"}",["T_WHITESPACE","\n\n            ",96],["T_VARIABLE","$result",98],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",98],"]","[","]",["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_getAttributes",98],"(",["T_VARIABLE","$item",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'quote_item'",98],")",";",["T_WHITESPACE","\n        ",98],"}",["T_WHITESPACE","\n\n        ",99],["T_VARIABLE","$result",101],"[",["T_CONSTANT_ENCAPSED_STRING","'payment'",101],"]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_getAttributes",101],"(",["T_VARIABLE","$quote",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getPayment",101],"(",")",",",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'quote_payment'",101],")",";",["T_WHITESPACE","\n\n        ",101],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$result",103],";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $store\n     * @return void\n     *\/",106],["T_WHITESPACE","\n    ",110],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","totals",111],"(",["T_VARIABLE","$quoteId",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$store",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","null",111],")",["T_WHITESPACE","\n    ",111],"{",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$quote",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_getQuote",113],"(",["T_VARIABLE","$quoteId",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$store",113],")",";",["T_WHITESPACE","\n\n        ",113],["T_VARIABLE","$totals",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$quote",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getTotals",115],"(",")",";",["T_WHITESPACE","\n\n        ",115],["T_VARIABLE","$totalsResult",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",")",";",["T_WHITESPACE","\n        ",117],["T_FOREACH","foreach",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$totals",118],["T_WHITESPACE"," ",118],["T_AS","as",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$total",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$totalsResult",119],"[","]",["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_ARRAY","array",119],"(",["T_WHITESPACE","\n                ",119],["T_CONSTANT_ENCAPSED_STRING","\"title\"",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$total",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getTitle",120],"(",")",",",["T_WHITESPACE","\n                ",120],["T_CONSTANT_ENCAPSED_STRING","\"amount\"",121],["T_WHITESPACE"," ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$total",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getValue",121],"(",")",["T_WHITESPACE","\n            ",121],")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE","\n        ",123],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$totalsResult",124],";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * Create an order from the shopping cart (quote)\n     *\n     * @param  $quoteId\n     * @param  $store\n     * @param  $agreements array\n     * @return string\n     *\/",127],["T_WHITESPACE","\n    ",134],["T_PUBLIC","public",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","createOrder",135],"(",["T_VARIABLE","$quoteId",135],",",["T_WHITESPACE"," ",135],["T_VARIABLE","$store",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","null",135],",",["T_WHITESPACE"," ",135],["T_VARIABLE","$agreements",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","null",135],")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$requiredAgreements",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_STRING","Mage",137],["T_DOUBLE_COLON","::",137],["T_STRING","helper",137],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",137],")",["T_OBJECT_OPERATOR","->",137],["T_STRING","getRequiredAgreementIds",137],"(",")",";",["T_WHITESPACE","\n        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(","!",["T_EMPTY","empty",138],"(",["T_VARIABLE","$requiredAgreements",138],")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$diff",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","array_diff",139],"(",["T_VARIABLE","$agreements",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$requiredAgreements",139],")",";",["T_WHITESPACE","\n            ",139],["T_IF","if",140],["T_WHITESPACE"," ",140],"(","!",["T_EMPTY","empty",140],"(",["T_VARIABLE","$diff",140],")",")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_fault",141],"(",["T_CONSTANT_ENCAPSED_STRING","'required_agreements_are_not_all'",141],")",";",["T_WHITESPACE","\n            ",141],"}",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE","\n\n        ",143],["T_VARIABLE","$quote",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_getQuote",145],"(",["T_VARIABLE","$quoteId",145],",",["T_WHITESPACE"," ",145],["T_VARIABLE","$store",145],")",";",["T_WHITESPACE","\n        ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$quote",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getIsMultiShipping",146],"(",")",")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_fault",147],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_checkout_type'",147],")",";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n        ",148],["T_IF","if",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$quote",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getCheckoutMethod",149],"(",")",["T_WHITESPACE"," ",149],["T_IS_EQUAL","==",149],["T_WHITESPACE"," ",149],["T_STRING","Mage_Checkout_Model_Api_Resource_Customer",149],["T_DOUBLE_COLON","::",149],["T_STRING","MODE_GUEST",149],["T_WHITESPACE","\n                ",149],["T_BOOLEAN_AND","&&",150],["T_WHITESPACE"," ",150],"!",["T_STRING","Mage",150],["T_DOUBLE_COLON","::",150],["T_STRING","helper",150],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",150],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","isAllowedGuestCheckout",150],"(",["T_VARIABLE","$quote",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$quote",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getStoreId",150],"(",")",")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_fault",151],"(",["T_CONSTANT_ENCAPSED_STRING","'guest_checkout_is_not_enabled'",151],")",";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE","\n\n        ",152],["T_DOC_COMMENT","\/** @var $customerResource Mage_Checkout_Model_Api_Resource_Customer *\/",154],["T_WHITESPACE","\n        ",154],["T_VARIABLE","$customerResource",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_STRING","Mage",155],["T_DOUBLE_COLON","::",155],["T_STRING","getModel",155],"(",["T_CONSTANT_ENCAPSED_STRING","\"checkout\/api_resource_customer\"",155],")",";",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$isNewCustomer",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$customerResource",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","prepareCustomerForQuote",156],"(",["T_VARIABLE","$quote",156],")",";",["T_WHITESPACE","\n\n        ",156],["T_TRY","try",158],["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$quote",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","collectTotals",159],"(",")",";",["T_WHITESPACE","\n            ",159],["T_DOC_COMMENT","\/** @var $service Mage_Sales_Model_Service_Quote *\/",160],["T_WHITESPACE","\n            ",160],["T_VARIABLE","$service",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","Mage",161],["T_DOUBLE_COLON","::",161],["T_STRING","getModel",161],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_quote'",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$quote",161],")",";",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$service",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","submitAll",162],"(",")",";",["T_WHITESPACE","\n\n            ",162],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$isNewCustomer",164],")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n                ",164],["T_TRY","try",165],["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                    ",165],["T_VARIABLE","$customerResource",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","involveNewCustomer",166],"(",["T_VARIABLE","$quote",166],")",";",["T_WHITESPACE","\n                ",166],"}",["T_WHITESPACE"," ",167],["T_CATCH","catch",167],["T_WHITESPACE"," ",167],"(",["T_STRING","Exception",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$e",167],")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n                    ",167],["T_STRING","Mage",168],["T_DOUBLE_COLON","::",168],["T_STRING","logException",168],"(",["T_VARIABLE","$e",168],")",";",["T_WHITESPACE","\n                ",168],"}",["T_WHITESPACE","\n            ",169],"}",["T_WHITESPACE","\n\n            ",170],["T_VARIABLE","$order",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$service",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getOrder",172],"(",")",";",["T_WHITESPACE","\n            ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(",["T_VARIABLE","$order",173],")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n                ",173],["T_STRING","Mage",174],["T_DOUBLE_COLON","::",174],["T_STRING","dispatchEvent",174],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_type_onepage_save_order_after'",174],",",["T_WHITESPACE","\n                    ",174],["T_ARRAY","array",175],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",175],["T_WHITESPACE"," ",175],["T_DOUBLE_ARROW","=>",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$order",175],",",["T_WHITESPACE"," ",175],["T_CONSTANT_ENCAPSED_STRING","'quote'",175],["T_WHITESPACE"," ",175],["T_DOUBLE_ARROW","=>",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$quote",175],")",")",";",["T_WHITESPACE","\n\n                ",175],["T_TRY","try",177],["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n                    ",177],["T_VARIABLE","$order",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","queueNewOrderEmail",178],"(",")",";",["T_WHITESPACE","\n                ",178],"}",["T_WHITESPACE"," ",179],["T_CATCH","catch",179],["T_WHITESPACE"," ",179],"(",["T_STRING","Exception",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$e",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                    ",179],["T_STRING","Mage",180],["T_DOUBLE_COLON","::",180],["T_STRING","logException",180],"(",["T_VARIABLE","$e",180],")",";",["T_WHITESPACE","\n                ",180],"}",["T_WHITESPACE","\n            ",181],"}",["T_WHITESPACE","\n\n            ",182],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","dispatchEvent",184],"(",["T_WHITESPACE","\n                ",184],["T_CONSTANT_ENCAPSED_STRING","'checkout_submit_all_after'",185],",",["T_WHITESPACE","\n                ",185],["T_ARRAY","array",186],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$order",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'quote'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$quote",186],")",["T_WHITESPACE","\n            ",186],")",";",["T_WHITESPACE","\n        ",187],"}",["T_WHITESPACE"," ",188],["T_CATCH","catch",188],["T_WHITESPACE"," ",188],"(",["T_STRING","Mage_Core_Exception",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$e",188],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_fault",189],"(",["T_CONSTANT_ENCAPSED_STRING","'create_order_fault'",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$e",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getMessage",189],"(",")",")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n\n        ",190],["T_RETURN","return",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$order",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getIncrementId",192],"(",")",";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n\n    ",193],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $store\n     * @return array\n     *\/",195],["T_WHITESPACE","\n    ",199],["T_PUBLIC","public",200],["T_WHITESPACE"," ",200],["T_FUNCTION","function",200],["T_WHITESPACE"," ",200],["T_STRING","licenseAgreement",200],"(",["T_VARIABLE","$quoteId",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$store",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_STRING","null",200],")",["T_WHITESPACE","\n    ",200],"{",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$quote",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_getQuote",202],"(",["T_VARIABLE","$quoteId",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$store",202],")",";",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$storeId",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$quote",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getStoreId",203],"(",")",";",["T_WHITESPACE","\n\n        ",203],["T_VARIABLE","$agreements",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_ARRAY","array",205],"(",")",";",["T_WHITESPACE","\n        ",205],["T_IF","if",206],["T_WHITESPACE"," ",206],"(",["T_STRING","Mage",206],["T_DOUBLE_COLON","::",206],["T_STRING","getStoreConfigFlag",206],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/options\/enable_agreements'",206],")",")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$agreementsCollection",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_STRING","Mage",207],["T_DOUBLE_COLON","::",207],["T_STRING","getModel",207],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/agreement'",207],")",["T_OBJECT_OPERATOR","->",207],["T_STRING","getCollection",207],"(",")",["T_WHITESPACE","\n                    ",207],["T_OBJECT_OPERATOR","->",208],["T_STRING","addStoreFilter",208],"(",["T_VARIABLE","$storeId",208],")",["T_WHITESPACE","\n                    ",208],["T_OBJECT_OPERATOR","->",209],["T_STRING","addFieldToFilter",209],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active'",209],",",["T_WHITESPACE"," ",209],["T_LNUMBER","1",209],")",";",["T_WHITESPACE","\n\n            ",209],["T_FOREACH","foreach",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$agreementsCollection",211],["T_WHITESPACE"," ",211],["T_AS","as",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$_a",211],")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n                ",211],["T_DOC_COMMENT","\/** @var $_a  Mage_Checkout_Model_Agreement *\/",212],["T_WHITESPACE","\n                ",212],["T_VARIABLE","$agreements",213],"[","]",["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_getAttributes",213],"(",["T_VARIABLE","$_a",213],",",["T_WHITESPACE"," ",213],["T_CONSTANT_ENCAPSED_STRING","\"quote_agreement\"",213],")",";",["T_WHITESPACE","\n            ",213],"}",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n\n        ",215],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$agreements",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n",218],"}",["T_WHITESPACE","\n",219]]