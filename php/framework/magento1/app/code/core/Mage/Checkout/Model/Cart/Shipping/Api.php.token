[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Shopping cart api\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Cart_Shipping_Api",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Api_Resource",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","__construct",37],"(",")",["T_WHITESPACE","\n    ",37],"{",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","_ignoredAttributeCodes",39],"[",["T_CONSTANT_ENCAPSED_STRING","'quote_shipping_rate'",39],"]",["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_ARRAY","array",39],"(",["T_CONSTANT_ENCAPSED_STRING","'address_id'",39],",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'created_at'",39],",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",39],",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'rate_id'",39],",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'carrier_sort_order'",39],")",";",["T_WHITESPACE","\n    ",39],"}",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Set an Shipping Method for Shopping Cart\n     *\n     * @param  $quoteId\n     * @param  $shippingMethod\n     * @param  $store\n     * @return bool\n     *\/",42],["T_WHITESPACE","\n    ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","setShippingMethod",50],"(",["T_VARIABLE","$quoteId",50],",",["T_WHITESPACE"," ",50],["T_VARIABLE","$shippingMethod",50],",",["T_WHITESPACE"," ",50],["T_VARIABLE","$store",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","null",50],")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$quote",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_getQuote",52],"(",["T_VARIABLE","$quoteId",52],",",["T_WHITESPACE"," ",52],["T_VARIABLE","$store",52],")",";",["T_WHITESPACE","\n\n        ",52],["T_VARIABLE","$quoteShippingAddress",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$quote",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getShippingAddress",54],"(",")",";",["T_WHITESPACE","\n        ",54],["T_IF","if",55],"(",["T_STRING","is_null",55],"(",["T_VARIABLE","$quoteShippingAddress",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getId",55],"(",")",")",["T_WHITESPACE"," ",55],")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n            ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_fault",56],"(",["T_CONSTANT_ENCAPSED_STRING","\"shipping_address_is_not_set\"",56],")",";",["T_WHITESPACE","\n        ",56],"}",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$rate",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$quote",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getShippingAddress",59],"(",")",["T_OBJECT_OPERATOR","->",59],["T_STRING","collectShippingRates",59],"(",")",["T_OBJECT_OPERATOR","->",59],["T_STRING","getShippingRateByCode",59],"(",["T_VARIABLE","$shippingMethod",59],")",";",["T_WHITESPACE","\n        ",59],["T_IF","if",60],["T_WHITESPACE"," ",60],"(","!",["T_VARIABLE","$rate",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_fault",61],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method_is_not_available'",61],")",";",["T_WHITESPACE","\n        ",61],"}",["T_WHITESPACE","\n\n        ",62],["T_TRY","try",64],["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$quote",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getShippingAddress",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","setShippingMethod",65],"(",["T_VARIABLE","$shippingMethod",65],")",";",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$quote",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","collectTotals",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","save",66],"(",")",";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE"," ",67],["T_CATCH","catch",67],"(",["T_STRING","Mage_Core_Exception",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$e",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n            ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_fault",68],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method_is_not_set'",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$e",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getMessage",68],"(",")",")",";",["T_WHITESPACE","\n        ",68],"}",["T_WHITESPACE","\n\n        ",69],["T_RETURN","return",71],["T_WHITESPACE"," ",71],["T_STRING","true",71],";",["T_WHITESPACE","\n    ",71],"}",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * Get list of available shipping methods\n     *\n     * @param  $quoteId\n     * @param  $store\n     * @return array\n     *\/",74],["T_WHITESPACE","\n    ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","getShippingMethodsList",81],"(",["T_VARIABLE","$quoteId",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$store",81],"=",["T_STRING","null",81],")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$quote",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_getQuote",83],"(",["T_VARIABLE","$quoteId",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$store",83],")",";",["T_WHITESPACE","\n\n        ",83],["T_VARIABLE","$quoteShippingAddress",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$quote",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getShippingAddress",85],"(",")",";",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_STRING","is_null",86],"(",["T_VARIABLE","$quoteShippingAddress",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getId",86],"(",")",")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_fault",87],"(",["T_CONSTANT_ENCAPSED_STRING","\"shipping_address_is_not_set\"",87],")",";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n\n        ",88],["T_TRY","try",90],["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$quoteShippingAddress",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","collectShippingRates",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","save",91],"(",")",";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$groupedRates",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$quoteShippingAddress",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getGroupedAllShippingRates",92],"(",")",";",["T_WHITESPACE","\n\n            ",92],["T_VARIABLE","$ratesResult",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_ARRAY","array",94],"(",")",";",["T_WHITESPACE","\n            ",94],["T_FOREACH","foreach",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$groupedRates",95],["T_WHITESPACE"," ",95],["T_AS","as",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$carrierCode",95],["T_WHITESPACE"," ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$rates",95],["T_WHITESPACE"," ",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n                ",95],["T_VARIABLE","$carrierName",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$carrierCode",96],";",["T_WHITESPACE","\n                ",96],["T_IF","if",97],["T_WHITESPACE"," ",97],"(","!",["T_STRING","is_null",97],"(",["T_STRING","Mage",97],["T_DOUBLE_COLON","::",97],["T_STRING","getStoreConfig",97],"(",["T_CONSTANT_ENCAPSED_STRING","'carriers\/'",97],".",["T_VARIABLE","$carrierCode",97],".",["T_CONSTANT_ENCAPSED_STRING","'\/title'",97],")",")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n                    ",97],["T_VARIABLE","$carrierName",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","Mage",98],["T_DOUBLE_COLON","::",98],["T_STRING","getStoreConfig",98],"(",["T_CONSTANT_ENCAPSED_STRING","'carriers\/'",98],".",["T_VARIABLE","$carrierCode",98],".",["T_CONSTANT_ENCAPSED_STRING","'\/title'",98],")",";",["T_WHITESPACE","\n                ",98],"}",["T_WHITESPACE","\n\n                ",99],["T_FOREACH","foreach",101],["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$rates",101],["T_WHITESPACE"," ",101],["T_AS","as",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$rate",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n                    ",101],["T_VARIABLE","$rateItem",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_getAttributes",102],"(",["T_VARIABLE","$rate",102],",",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","\"quote_shipping_rate\"",102],")",";",["T_WHITESPACE","\n                    ",102],["T_VARIABLE","$rateItem",103],"[",["T_CONSTANT_ENCAPSED_STRING","'carrierName'",103],"]",["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$carrierName",103],";",["T_WHITESPACE","\n                    ",103],["T_VARIABLE","$ratesResult",104],"[","]",["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$rateItem",104],";",["T_WHITESPACE","\n                    ",104],["T_UNSET","unset",105],"(",["T_VARIABLE","$rateItem",105],")",";",["T_WHITESPACE","\n                ",105],"}",["T_WHITESPACE","\n            ",106],"}",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE"," ",108],["T_CATCH","catch",108],["T_WHITESPACE"," ",108],"(",["T_STRING","Mage_Core_Exception",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$e",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_fault",109],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_methods_list_could_not_be_retrived'",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$e",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getMessage",109],"(",")",")",";",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE","\n\n        ",110],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$ratesResult",112],";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n\n",113],"}",["T_WHITESPACE","\n",116]]