[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Shopping cart api for product\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_Model_Cart_Product_Api",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_Model_Api_Resource_Product",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Base preparation of product data\n     *\n     * @param mixed $data\n     * @return null|array\n     *\/",36],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","_prepareProductsData",42],"(",["T_VARIABLE","$data",42],")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_RETURN","return",44],["T_WHITESPACE"," ",44],["T_STRING","is_array",44],"(",["T_VARIABLE","$data",44],")",["T_WHITESPACE"," ",44],"?",["T_WHITESPACE"," ",44],["T_VARIABLE","$data",44],["T_WHITESPACE"," ",44],":",["T_WHITESPACE"," ",44],["T_STRING","null",44],";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $productsData\n     * @param  $store\n     * @return bool\n     *\/",47],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","add",53],"(",["T_VARIABLE","$quoteId",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$productsData",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$store",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","null",53],")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$quote",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_getQuote",55],"(",["T_VARIABLE","$quoteId",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$store",55],")",";",["T_WHITESPACE","\n        ",55],["T_IF","if",56],["T_WHITESPACE"," ",56],"(",["T_EMPTY","empty",56],"(",["T_VARIABLE","$store",56],")",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$store",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$quote",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getStoreId",57],"(",")",";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$productsData",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_prepareProductsData",60],"(",["T_VARIABLE","$productsData",60],")",";",["T_WHITESPACE","\n        ",60],["T_IF","if",61],["T_WHITESPACE"," ",61],"(",["T_EMPTY","empty",61],"(",["T_VARIABLE","$productsData",61],")",")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_fault",62],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_product_data'",62],")",";",["T_WHITESPACE","\n        ",62],"}",["T_WHITESPACE","\n\n        ",63],["T_VARIABLE","$errors",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_ARRAY","array",65],"(",")",";",["T_WHITESPACE","\n        ",65],["T_FOREACH","foreach",66],["T_WHITESPACE"," ",66],"(",["T_VARIABLE","$productsData",66],["T_WHITESPACE"," ",66],["T_AS","as",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$productItem",66],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_IF","if",67],["T_WHITESPACE"," ",67],"(",["T_ISSET","isset",67],"(",["T_VARIABLE","$productItem",67],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",67],"]",")",")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n                ",67],["T_VARIABLE","$productByItem",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_getProduct",68],"(",["T_VARIABLE","$productItem",68],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",68],"]",",",["T_WHITESPACE"," ",68],["T_VARIABLE","$store",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","\"id\"",68],")",";",["T_WHITESPACE","\n            ",68],"}",["T_WHITESPACE"," ",69],["T_ELSE","else",69],["T_WHITESPACE"," ",69],["T_IF","if",69],["T_WHITESPACE"," ",69],"(",["T_ISSET","isset",69],"(",["T_VARIABLE","$productItem",69],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",69],"]",")",")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n                ",69],["T_VARIABLE","$productByItem",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_getProduct",70],"(",["T_VARIABLE","$productItem",70],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",70],"]",",",["T_WHITESPACE"," ",70],["T_VARIABLE","$store",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","\"sku\"",70],")",";",["T_WHITESPACE","\n            ",70],"}",["T_WHITESPACE"," ",71],["T_ELSE","else",71],["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n                ",71],["T_VARIABLE","$errors",72],"[","]",["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","Mage",72],["T_DOUBLE_COLON","::",72],["T_STRING","helper",72],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",72],")",["T_OBJECT_OPERATOR","->",72],["T_STRING","__",72],"(",["T_CONSTANT_ENCAPSED_STRING","\"One item of products do not have identifier or sku\"",72],")",";",["T_WHITESPACE","\n                ",72],["T_CONTINUE","continue",73],";",["T_WHITESPACE","\n            ",73],"}",["T_WHITESPACE","\n\n            ",74],["T_VARIABLE","$productRequest",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_getProductRequest",76],"(",["T_VARIABLE","$productItem",76],")",";",["T_WHITESPACE","\n            ",76],["T_TRY","try",77],["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$result",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$quote",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","addProduct",78],"(",["T_VARIABLE","$productByItem",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$productRequest",78],")",";",["T_WHITESPACE","\n                ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(",["T_STRING","is_string",79],"(",["T_VARIABLE","$result",79],")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n                    ",79],["T_STRING","Mage",80],["T_DOUBLE_COLON","::",80],["T_STRING","throwException",80],"(",["T_VARIABLE","$result",80],")",";",["T_WHITESPACE","\n                ",80],"}",["T_WHITESPACE","\n            ",81],"}",["T_WHITESPACE"," ",82],["T_CATCH","catch",82],["T_WHITESPACE"," ",82],"(",["T_STRING","Mage_Core_Exception",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$e",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n                ",82],["T_VARIABLE","$errors",83],"[","]",["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$e",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getMessage",83],"(",")",";",["T_WHITESPACE","\n            ",83],"}",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n\n        ",85],["T_IF","if",87],["T_WHITESPACE"," ",87],"(","!",["T_EMPTY","empty",87],"(",["T_VARIABLE","$errors",87],")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_fault",88],"(",["T_CONSTANT_ENCAPSED_STRING","\"add_product_fault\"",88],",",["T_WHITESPACE"," ",88],["T_STRING","implode",88],"(",["T_STRING","PHP_EOL",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$errors",88],")",")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n\n        ",89],["T_TRY","try",91],["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$quote",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","collectTotals",92],"(",")",["T_OBJECT_OPERATOR","->",92],["T_STRING","save",92],"(",")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE"," ",93],["T_CATCH","catch",93],["T_WHITESPACE"," ",93],"(",["T_STRING","Exception",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$e",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_fault",94],"(",["T_CONSTANT_ENCAPSED_STRING","\"add_product_quote_save_fault\"",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$e",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getMessage",94],"(",")",")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n\n        ",95],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_STRING","true",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $productsData\n     * @param  $store\n     * @return bool\n     *\/",100],["T_WHITESPACE","\n    ",105],["T_PUBLIC","public",106],["T_WHITESPACE"," ",106],["T_FUNCTION","function",106],["T_WHITESPACE"," ",106],["T_STRING","update",106],"(",["T_VARIABLE","$quoteId",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$productsData",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$store",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","null",106],")",["T_WHITESPACE","\n    ",106],"{",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$quote",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_getQuote",108],"(",["T_VARIABLE","$quoteId",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$store",108],")",";",["T_WHITESPACE","\n        ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_EMPTY","empty",109],"(",["T_VARIABLE","$store",109],")",")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$store",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$quote",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getStoreId",110],"(",")",";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_VARIABLE","$productsData",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_prepareProductsData",113],"(",["T_VARIABLE","$productsData",113],")",";",["T_WHITESPACE","\n        ",113],["T_IF","if",114],["T_WHITESPACE"," ",114],"(",["T_EMPTY","empty",114],"(",["T_VARIABLE","$productsData",114],")",")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_fault",115],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_product_data'",115],")",";",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE","\n\n        ",116],["T_VARIABLE","$errors",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],"(",")",";",["T_WHITESPACE","\n        ",118],["T_FOREACH","foreach",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$productsData",119],["T_WHITESPACE"," ",119],["T_AS","as",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$productItem",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_ISSET","isset",120],"(",["T_VARIABLE","$productItem",120],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",120],"]",")",")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n                ",120],["T_VARIABLE","$productByItem",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_getProduct",121],"(",["T_VARIABLE","$productItem",121],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",121],"]",",",["T_WHITESPACE"," ",121],["T_VARIABLE","$store",121],",",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","\"id\"",121],")",";",["T_WHITESPACE","\n            ",121],"}",["T_WHITESPACE"," ",122],["T_ELSE","else",122],["T_WHITESPACE"," ",122],["T_IF","if",122],["T_WHITESPACE"," ",122],"(",["T_ISSET","isset",122],"(",["T_VARIABLE","$productItem",122],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",122],"]",")",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$productByItem",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_getProduct",123],"(",["T_VARIABLE","$productItem",123],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",123],"]",",",["T_WHITESPACE"," ",123],["T_VARIABLE","$store",123],",",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","\"sku\"",123],")",";",["T_WHITESPACE","\n            ",123],"}",["T_WHITESPACE"," ",124],["T_ELSE","else",124],["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$errors",125],"[","]",["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","Mage",125],["T_DOUBLE_COLON","::",125],["T_STRING","helper",125],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",125],")",["T_OBJECT_OPERATOR","->",125],["T_STRING","__",125],"(",["T_CONSTANT_ENCAPSED_STRING","\"One item of products do not have identifier or sku\"",125],")",";",["T_WHITESPACE","\n                ",125],["T_CONTINUE","continue",126],";",["T_WHITESPACE","\n            ",126],"}",["T_WHITESPACE","\n\n            ",127],["T_DOC_COMMENT","\/** @var $quoteItem Mage_Sales_Model_Quote_Item *\/",129],["T_WHITESPACE","\n            ",129],["T_VARIABLE","$quoteItem",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_getQuoteItemByProduct",130],"(",["T_VARIABLE","$quote",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$productByItem",130],",",["T_WHITESPACE","\n                ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_getProductRequest",131],"(",["T_VARIABLE","$productItem",131],")",")",";",["T_WHITESPACE","\n            ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_STRING","is_null",132],"(",["T_VARIABLE","$quoteItem",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getId",132],"(",")",")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                ",132],["T_VARIABLE","$errors",133],"[","]",["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","Mage",133],["T_DOUBLE_COLON","::",133],["T_STRING","helper",133],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",133],")",["T_OBJECT_OPERATOR","->",133],["T_STRING","__",133],"(",["T_CONSTANT_ENCAPSED_STRING","\"One item of products is not belong any of quote item\"",133],")",";",["T_WHITESPACE","\n                ",133],["T_CONTINUE","continue",134],";",["T_WHITESPACE","\n            ",134],"}",["T_WHITESPACE","\n\n            ",135],["T_IF","if",137],["T_WHITESPACE"," ",137],"(",["T_VARIABLE","$productItem",137],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",137],"]",["T_WHITESPACE"," ",137],">",["T_WHITESPACE"," ",137],["T_LNUMBER","0",137],")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n                ",137],["T_VARIABLE","$quoteItem",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","setQty",138],"(",["T_VARIABLE","$productItem",138],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",138],"]",")",";",["T_WHITESPACE","\n            ",138],"}",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n\n        ",140],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","!",["T_EMPTY","empty",142],"(",["T_VARIABLE","$errors",142],")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_fault",143],"(",["T_CONSTANT_ENCAPSED_STRING","\"update_product_fault\"",143],",",["T_WHITESPACE"," ",143],["T_STRING","implode",143],"(",["T_STRING","PHP_EOL",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$errors",143],")",")",";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n\n        ",144],["T_TRY","try",146],["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$quote",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","collectTotals",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","save",147],"(",")",";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE"," ",148],["T_CATCH","catch",148],["T_WHITESPACE"," ",148],"(",["T_STRING","Exception",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$e",148],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_fault",149],"(",["T_CONSTANT_ENCAPSED_STRING","\"update_product_quote_save_fault\"",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$e",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getMessage",149],"(",")",")",";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n\n        ",150],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_STRING","true",152],";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $productsData\n     * @param  $store\n     * @return bool\n     *\/",155],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","remove",161],"(",["T_VARIABLE","$quoteId",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$productsData",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$store",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","null",161],")",["T_WHITESPACE","\n    ",161],"{",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$quote",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_getQuote",163],"(",["T_VARIABLE","$quoteId",163],",",["T_WHITESPACE"," ",163],["T_VARIABLE","$store",163],")",";",["T_WHITESPACE","\n        ",163],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_EMPTY","empty",164],"(",["T_VARIABLE","$store",164],")",")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$store",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$quote",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getStoreId",165],"(",")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n\n        ",166],["T_VARIABLE","$productsData",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_prepareProductsData",168],"(",["T_VARIABLE","$productsData",168],")",";",["T_WHITESPACE","\n        ",168],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_EMPTY","empty",169],"(",["T_VARIABLE","$productsData",169],")",")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_fault",170],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_product_data'",170],")",";",["T_WHITESPACE","\n        ",170],"}",["T_WHITESPACE","\n\n        ",171],["T_VARIABLE","$errors",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_ARRAY","array",173],"(",")",";",["T_WHITESPACE","\n        ",173],["T_FOREACH","foreach",174],["T_WHITESPACE"," ",174],"(",["T_VARIABLE","$productsData",174],["T_WHITESPACE"," ",174],["T_AS","as",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$productItem",174],")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n            ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_ISSET","isset",175],"(",["T_VARIABLE","$productItem",175],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",175],"]",")",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$productByItem",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_getProduct",176],"(",["T_VARIABLE","$productItem",176],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",176],"]",",",["T_WHITESPACE"," ",176],["T_VARIABLE","$store",176],",",["T_WHITESPACE"," ",176],["T_CONSTANT_ENCAPSED_STRING","\"id\"",176],")",";",["T_WHITESPACE","\n            ",176],"}",["T_WHITESPACE"," ",177],["T_ELSE","else",177],["T_WHITESPACE"," ",177],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_ISSET","isset",177],"(",["T_VARIABLE","$productItem",177],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",177],"]",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$productByItem",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_getProduct",178],"(",["T_VARIABLE","$productItem",178],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",178],"]",",",["T_WHITESPACE"," ",178],["T_VARIABLE","$store",178],",",["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","\"sku\"",178],")",";",["T_WHITESPACE","\n            ",178],"}",["T_WHITESPACE"," ",179],["T_ELSE","else",179],["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$errors",180],"[","]",["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","Mage",180],["T_DOUBLE_COLON","::",180],["T_STRING","helper",180],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",180],")",["T_OBJECT_OPERATOR","->",180],["T_STRING","__",180],"(",["T_CONSTANT_ENCAPSED_STRING","\"One item of products do not have identifier or sku\"",180],")",";",["T_WHITESPACE","\n                ",180],["T_CONTINUE","continue",181],";",["T_WHITESPACE","\n            ",181],"}",["T_WHITESPACE","\n\n            ",182],["T_TRY","try",184],["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n                ",184],["T_DOC_COMMENT","\/** @var $quoteItem Mage_Sales_Model_Quote_Item *\/",185],["T_WHITESPACE","\n                ",185],["T_VARIABLE","$quoteItem",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_getQuoteItemByProduct",186],"(",["T_VARIABLE","$quote",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$productByItem",186],",",["T_WHITESPACE","\n                    ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_getProductRequest",187],"(",["T_VARIABLE","$productItem",187],")",")",";",["T_WHITESPACE","\n                ",187],["T_IF","if",188],["T_WHITESPACE"," ",188],"(",["T_STRING","is_null",188],"(",["T_VARIABLE","$quoteItem",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getId",188],"(",")",")",")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n                    ",188],["T_VARIABLE","$errors",189],"[","]",["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_STRING","Mage",189],["T_DOUBLE_COLON","::",189],["T_STRING","helper",189],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",189],")",["T_OBJECT_OPERATOR","->",189],["T_STRING","__",189],"(",["T_CONSTANT_ENCAPSED_STRING","\"One item of products is not belong any of quote item\"",189],")",";",["T_WHITESPACE","\n                    ",189],["T_CONTINUE","continue",190],";",["T_WHITESPACE","\n                ",190],"}",["T_WHITESPACE","\n                ",191],["T_VARIABLE","$quote",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","removeItem",192],"(",["T_VARIABLE","$quoteItem",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getId",192],"(",")",")",";",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE"," ",193],["T_CATCH","catch",193],["T_WHITESPACE"," ",193],"(",["T_STRING","Mage_Core_Exception",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$e",193],")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n                ",193],["T_VARIABLE","$errors",194],"[","]",["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$e",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getMessage",194],"(",")",";",["T_WHITESPACE","\n            ",194],"}",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n\n        ",196],["T_IF","if",198],["T_WHITESPACE"," ",198],"(","!",["T_EMPTY","empty",198],"(",["T_VARIABLE","$errors",198],")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_fault",199],"(",["T_CONSTANT_ENCAPSED_STRING","\"remove_product_fault\"",199],",",["T_WHITESPACE"," ",199],["T_STRING","implode",199],"(",["T_STRING","PHP_EOL",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$errors",199],")",")",";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n\n        ",200],["T_TRY","try",202],["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$quote",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","collectTotals",203],"(",")",["T_OBJECT_OPERATOR","->",203],["T_STRING","save",203],"(",")",";",["T_WHITESPACE","\n        ",203],"}",["T_WHITESPACE"," ",204],["T_CATCH","catch",204],["T_WHITESPACE"," ",204],"(",["T_STRING","Exception",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$e",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_fault",205],"(",["T_CONSTANT_ENCAPSED_STRING","\"remove_product_quote_save_fault\"",205],",",["T_WHITESPACE"," ",205],["T_VARIABLE","$e",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getMessage",205],"(",")",")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n\n        ",206],["T_RETURN","return",208],["T_WHITESPACE"," ",208],["T_STRING","true",208],";",["T_WHITESPACE","\n    ",208],"}",["T_WHITESPACE","\n\n    ",209],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $store\n     * @return array\n     *\/",211],["T_WHITESPACE","\n    ",215],["T_PUBLIC","public",216],["T_WHITESPACE"," ",216],["T_FUNCTION","function",216],["T_WHITESPACE"," ",216],["T_STRING","items",216],"(",["T_VARIABLE","$quoteId",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$store",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_STRING","null",216],")",["T_WHITESPACE","\n    ",216],"{",["T_WHITESPACE","\n        ",217],["T_VARIABLE","$quote",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_getQuote",218],"(",["T_VARIABLE","$quoteId",218],",",["T_WHITESPACE"," ",218],["T_VARIABLE","$store",218],")",";",["T_WHITESPACE","\n        ",218],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_EMPTY","empty",219],"(",["T_VARIABLE","$store",219],")",")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$store",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$quote",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getStoreId",220],"(",")",";",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n\n        ",221],["T_IF","if",223],["T_WHITESPACE"," ",223],"(","!",["T_VARIABLE","$quote",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getItemsCount",223],"(",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n            ",223],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_ARRAY","array",224],"(",")",";",["T_WHITESPACE","\n        ",224],"}",["T_WHITESPACE","\n\n        ",225],["T_VARIABLE","$productsResult",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_ARRAY","array",227],"(",")",";",["T_WHITESPACE","\n        ",227],["T_FOREACH","foreach",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$quote",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getAllItems",228],"(",")",["T_WHITESPACE"," ",228],["T_AS","as",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$item",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_DOC_COMMENT","\/** @var $item Mage_Sales_Model_Quote_Item *\/",229],["T_WHITESPACE","\n            ",229],["T_VARIABLE","$product",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$item",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getProduct",230],"(",")",";",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$productsResult",231],"[","]",["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_ARRAY","array",231],"(",["T_WHITESPACE"," ",231],["T_COMMENT","\/\/ Basic product data\n",231],["T_WHITESPACE","                ",232],["T_CONSTANT_ENCAPSED_STRING","'product_id'",232],["T_WHITESPACE","   ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$product",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getId",232],"(",")",",",["T_WHITESPACE","\n                ",232],["T_CONSTANT_ENCAPSED_STRING","'sku'",233],["T_WHITESPACE","          ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$product",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getSku",233],"(",")",",",["T_WHITESPACE","\n                ",233],["T_CONSTANT_ENCAPSED_STRING","'name'",234],["T_WHITESPACE","         ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$product",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getName",234],"(",")",",",["T_WHITESPACE","\n                ",234],["T_CONSTANT_ENCAPSED_STRING","'set'",235],["T_WHITESPACE","          ",235],["T_DOUBLE_ARROW","=>",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$product",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getAttributeSetId",235],"(",")",",",["T_WHITESPACE","\n                ",235],["T_CONSTANT_ENCAPSED_STRING","'type'",236],["T_WHITESPACE","         ",236],["T_DOUBLE_ARROW","=>",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$product",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getTypeId",236],"(",")",",",["T_WHITESPACE","\n                ",236],["T_CONSTANT_ENCAPSED_STRING","'category_ids'",237],["T_WHITESPACE"," ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$product",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getCategoryIds",237],"(",")",",",["T_WHITESPACE","\n                ",237],["T_CONSTANT_ENCAPSED_STRING","'website_ids'",238],["T_WHITESPACE","  ",238],["T_DOUBLE_ARROW","=>",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$product",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getWebsiteIds",238],"(",")",["T_WHITESPACE","\n            ",238],")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n\n        ",240],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$productsResult",242],";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $productsData\n     * @param  $store\n     * @return bool\n     *\/",245],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","moveToCustomerQuote",251],"(",["T_VARIABLE","$quoteId",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$productsData",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$store",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_STRING","null",251],")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$quote",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_getQuote",253],"(",["T_VARIABLE","$quoteId",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$store",253],")",";",["T_WHITESPACE","\n\n        ",253],["T_IF","if",255],["T_WHITESPACE"," ",255],"(",["T_EMPTY","empty",255],"(",["T_VARIABLE","$store",255],")",")",["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n            ",255],["T_VARIABLE","$store",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$quote",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getStoreId",256],"(",")",";",["T_WHITESPACE","\n        ",256],"}",["T_WHITESPACE","\n\n        ",257],["T_VARIABLE","$customer",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$quote",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getCustomer",259],"(",")",";",["T_WHITESPACE","\n        ",259],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_STRING","is_null",260],"(",["T_VARIABLE","$customer",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getId",260],"(",")",")",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_fault",261],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_not_set_for_quote'",261],")",";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n\n        ",262],["T_DOC_COMMENT","\/** @var $customerQuote Mage_Sales_Model_Quote *\/",264],["T_WHITESPACE","\n        ",264],["T_VARIABLE","$customerQuote",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","Mage",265],["T_DOUBLE_COLON","::",265],["T_STRING","getModel",265],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",265],")",["T_WHITESPACE","\n            ",265],["T_OBJECT_OPERATOR","->",266],["T_STRING","setStoreId",266],"(",["T_VARIABLE","$store",266],")",["T_WHITESPACE","\n            ",266],["T_OBJECT_OPERATOR","->",267],["T_STRING","loadByCustomer",267],"(",["T_VARIABLE","$customer",267],")",";",["T_WHITESPACE","\n\n        ",267],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_STRING","is_null",269],"(",["T_VARIABLE","$customerQuote",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getId",269],"(",")",")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_fault",270],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_quote_not_exist'",270],")",";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n\n        ",271],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_VARIABLE","$customerQuote",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getId",273],"(",")",["T_WHITESPACE"," ",273],["T_IS_EQUAL","==",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$quote",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getId",273],"(",")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_fault",274],"(",["T_CONSTANT_ENCAPSED_STRING","'quotes_are_similar'",274],")",";",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n\n        ",275],["T_VARIABLE","$productsData",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_prepareProductsData",277],"(",["T_VARIABLE","$productsData",277],")",";",["T_WHITESPACE","\n        ",277],["T_IF","if",278],["T_WHITESPACE"," ",278],"(",["T_EMPTY","empty",278],"(",["T_VARIABLE","$productsData",278],")",")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n            ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_fault",279],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_product_data'",279],")",";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n\n        ",280],["T_VARIABLE","$errors",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_ARRAY","array",282],"(",")",";",["T_WHITESPACE","\n        ",282],["T_FOREACH","foreach",283],["T_WHITESPACE"," ",283],"(",["T_VARIABLE","$productsData",283],["T_WHITESPACE"," ",283],["T_AS","as",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$key",283],["T_WHITESPACE"," ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$productItem",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_ISSET","isset",284],"(",["T_VARIABLE","$productItem",284],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",284],"]",")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                ",284],["T_VARIABLE","$productByItem",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","_getProduct",285],"(",["T_VARIABLE","$productItem",285],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",285],"]",",",["T_WHITESPACE"," ",285],["T_VARIABLE","$store",285],",",["T_WHITESPACE"," ",285],["T_CONSTANT_ENCAPSED_STRING","\"id\"",285],")",";",["T_WHITESPACE","\n            ",285],"}",["T_WHITESPACE"," ",286],["T_ELSE","else",286],["T_WHITESPACE"," ",286],["T_IF","if",286],["T_WHITESPACE"," ",286],"(",["T_ISSET","isset",286],"(",["T_VARIABLE","$productItem",286],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",286],"]",")",")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n                ",286],["T_VARIABLE","$productByItem",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_getProduct",287],"(",["T_VARIABLE","$productItem",287],"[",["T_CONSTANT_ENCAPSED_STRING","'sku'",287],"]",",",["T_WHITESPACE"," ",287],["T_VARIABLE","$store",287],",",["T_WHITESPACE"," ",287],["T_CONSTANT_ENCAPSED_STRING","\"sku\"",287],")",";",["T_WHITESPACE","\n            ",287],"}",["T_WHITESPACE"," ",288],["T_ELSE","else",288],["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n                ",288],["T_VARIABLE","$errors",289],"[","]",["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","helper",289],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",289],")",["T_OBJECT_OPERATOR","->",289],["T_STRING","__",289],"(",["T_CONSTANT_ENCAPSED_STRING","\"One item of products do not have identifier or sku\"",289],")",";",["T_WHITESPACE","\n                ",289],["T_CONTINUE","continue",290],";",["T_WHITESPACE","\n            ",290],"}",["T_WHITESPACE","\n\n            ",291],["T_TRY","try",293],["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n                ",293],["T_DOC_COMMENT","\/** @var $quoteItem Mage_Sales_Model_Quote_Item *\/",294],["T_WHITESPACE","\n                ",294],["T_VARIABLE","$quoteItem",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_getQuoteItemByProduct",295],"(",["T_VARIABLE","$quote",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$productByItem",295],",",["T_WHITESPACE","\n                    ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_getProductRequest",296],"(",["T_VARIABLE","$productItem",296],")",")",";",["T_WHITESPACE","\n                ",296],["T_IF","if",297],["T_WHITESPACE"," ",297],"(",["T_VARIABLE","$quoteItem",297],["T_WHITESPACE"," ",297],["T_BOOLEAN_AND","&&",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$quoteItem",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getId",297],"(",")",")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n                    ",297],["T_VARIABLE","$newQuoteItem",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_CLONE","clone",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$quoteItem",298],";",["T_WHITESPACE","\n                    ",298],["T_VARIABLE","$newQuoteItem",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","setId",299],"(",["T_STRING","null",299],")",";",["T_WHITESPACE","\n                    ",299],["T_VARIABLE","$customerQuote",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","addItem",300],"(",["T_VARIABLE","$newQuoteItem",300],")",";",["T_WHITESPACE","\n                    ",300],["T_VARIABLE","$quote",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","removeItem",301],"(",["T_VARIABLE","$quoteItem",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getId",301],"(",")",")",";",["T_WHITESPACE","\n                    ",301],["T_UNSET","unset",302],"(",["T_VARIABLE","$productsData",302],"[",["T_VARIABLE","$key",302],"]",")",";",["T_WHITESPACE","\n                ",302],"}",["T_WHITESPACE"," ",303],["T_ELSE","else",303],["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n                     ",303],["T_VARIABLE","$errors",304],"[","]",["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_STRING","Mage",304],["T_DOUBLE_COLON","::",304],["T_STRING","helper",304],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",304],")",["T_OBJECT_OPERATOR","->",304],["T_STRING","__",304],"(",["T_CONSTANT_ENCAPSED_STRING","\"One item of products is not belong any of quote item\"",304],")",";",["T_WHITESPACE","\n                ",304],"}",["T_WHITESPACE","\n            ",305],"}",["T_WHITESPACE"," ",306],["T_CATCH","catch",306],["T_WHITESPACE"," ",306],"(",["T_STRING","Mage_Core_Exception",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$e",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n                ",306],["T_VARIABLE","$errors",307],"[","]",["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$e",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getMessage",307],"(",")",";",["T_WHITESPACE","\n            ",307],"}",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n\n        ",309],["T_IF","if",311],["T_WHITESPACE"," ",311],"(",["T_STRING","count",311],"(",["T_VARIABLE","$productsData",311],")",["T_WHITESPACE"," ",311],["T_BOOLEAN_OR","||",311],["T_WHITESPACE"," ",311],"!",["T_EMPTY","empty",311],"(",["T_VARIABLE","$errors",311],")",")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n            ",311],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","_fault",312],"(",["T_CONSTANT_ENCAPSED_STRING","'unable_to_move_all_products'",312],",",["T_WHITESPACE"," ",312],["T_STRING","implode",312],"(",["T_STRING","PHP_EOL",312],",",["T_WHITESPACE"," ",312],["T_VARIABLE","$errors",312],")",")",";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n\n        ",313],["T_TRY","try",315],["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$customerQuote",316],["T_WHITESPACE","\n                ",316],["T_OBJECT_OPERATOR","->",317],["T_STRING","collectTotals",317],"(",")",["T_WHITESPACE","\n                ",317],["T_OBJECT_OPERATOR","->",318],["T_STRING","save",318],"(",")",";",["T_WHITESPACE","\n\n            ",318],["T_VARIABLE","$quote",320],["T_WHITESPACE","\n                ",320],["T_OBJECT_OPERATOR","->",321],["T_STRING","collectTotals",321],"(",")",["T_WHITESPACE","\n                ",321],["T_OBJECT_OPERATOR","->",322],["T_STRING","save",322],"(",")",";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE"," ",323],["T_CATCH","catch",323],["T_WHITESPACE"," ",323],"(",["T_STRING","Exception",323],["T_WHITESPACE"," ",323],["T_VARIABLE","$e",323],")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n             ",323],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_fault",324],"(",["T_CONSTANT_ENCAPSED_STRING","\"product_move_quote_save_fault\"",324],",",["T_WHITESPACE"," ",324],["T_VARIABLE","$e",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","getMessage",324],"(",")",")",";",["T_WHITESPACE","\n        ",324],"}",["T_WHITESPACE","\n\n        ",325],["T_RETURN","return",327],["T_WHITESPACE"," ",327],["T_STRING","true",327],";",["T_WHITESPACE","\n    ",327],"}",["T_WHITESPACE","\n",328],"}",["T_WHITESPACE","\n",329]]