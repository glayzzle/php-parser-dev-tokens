[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_CLASS","class",28],["T_WHITESPACE"," ",28],["T_STRING","Mage_Checkout_Model_Session",28],["T_WHITESPACE"," ",28],["T_EXTENDS","extends",28],["T_WHITESPACE"," ",28],["T_STRING","Mage_Core_Model_Session_Abstract",28],["T_WHITESPACE","\n",28],"{",["T_WHITESPACE","\n    ",29],["T_CONST","const",30],["T_WHITESPACE"," ",30],["T_STRING","CHECKOUT_STATE_BEGIN",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","'begin'",30],";",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * Quote instance\n     *\n     * @var null|Mage_Sales_Model_Quote\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_quote",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Customer instance\n     *\n     * @var null|Mage_Customer_Model_Customer\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_customer",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Whether load only active quote\n     *\n     * @var bool\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_loadInactive",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","false",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Loaded order instance\n     *\n     * @var Mage_Sales_Model_Order\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$_order",58],";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Class constructor. Initialize checkout session namespace\n     *\/",60],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","__construct",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","init",65],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",65],")",";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Unset all data associated with object\n     *\/",68],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","unsetAll",71],"(",")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_STRING","parent",73],["T_DOUBLE_COLON","::",73],["T_STRING","unsetAll",73],"(",")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_quote",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","null",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Set customer instance\n     *\n     * @param Mage_Customer_Model_Customer|null $customer\n     * @return Mage_Checkout_Model_Session\n     *\/",77],["T_WHITESPACE","\n    ",82],["T_PUBLIC","public",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","setCustomer",83],"(",["T_VARIABLE","$customer",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_customer",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$customer",85],";",["T_WHITESPACE","\n        ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Check whether current session has quote\n     *\n     * @return bool\n     *\/",89],["T_WHITESPACE","\n    ",93],["T_PUBLIC","public",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","hasQuote",94],"(",")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_ISSET","isset",96],"(",["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_quote",96],")",";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Set quote to be loaded even if inactive\n     *\n     * @param bool $load\n     * @return Mage_Checkout_Model_Session\n     *\/",99],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","setLoadInactive",105],"(",["T_VARIABLE","$load",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","true",105],")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_loadInactive",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$load",107],";",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Get checkout quote instance by current session\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",111],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","getQuote",116],"(",")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","dispatchEvent",118],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_quote_process'",118],",",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_session'",118],["T_WHITESPACE"," ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],")",")",";",["T_WHITESPACE","\n\n        ",118],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_quote",120],["T_WHITESPACE"," ",120],["T_IS_IDENTICAL","===",120],["T_WHITESPACE"," ",120],["T_STRING","null",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_DOC_COMMENT","\/** @var $quote Mage_Sales_Model_Quote *\/",121],["T_WHITESPACE","\n            ",121],["T_VARIABLE","$quote",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","Mage",122],["T_DOUBLE_COLON","::",122],["T_STRING","getModel",122],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",122],")",["T_OBJECT_OPERATOR","->",122],["T_STRING","setStoreId",122],"(",["T_STRING","Mage",122],["T_DOUBLE_COLON","::",122],["T_STRING","app",122],"(",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","getStore",122],"(",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","getId",122],"(",")",")",";",["T_WHITESPACE","\n            ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getQuoteId",123],"(",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n                ",123],["T_IF","if",124],["T_WHITESPACE"," ",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_loadInactive",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n                    ",124],["T_VARIABLE","$quote",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","load",125],"(",["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getQuoteId",125],"(",")",")",";",["T_WHITESPACE","\n                ",125],"}",["T_WHITESPACE"," ",126],["T_ELSE","else",126],["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                    ",126],["T_VARIABLE","$quote",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","loadActive",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getQuoteId",127],"(",")",")",";",["T_WHITESPACE","\n                ",127],"}",["T_WHITESPACE","\n                ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$quote",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getId",129],"(",")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n                    ",129],["T_DOC_COMMENT","\/**\n                     * If current currency code of quote is not equal current currency code of store,\n                     * need recalculate totals of quote. It is possible if customer use currency switcher or\n                     * store switcher.\n                     *\/",130],["T_WHITESPACE","\n                    ",134],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$quote",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getQuoteCurrencyCode",135],"(",")",["T_WHITESPACE"," ",135],["T_IS_NOT_EQUAL","!=",135],["T_WHITESPACE"," ",135],["T_STRING","Mage",135],["T_DOUBLE_COLON","::",135],["T_STRING","app",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getStore",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getCurrentCurrencyCode",135],"(",")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                        ",135],["T_VARIABLE","$quote",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","setStore",136],"(",["T_STRING","Mage",136],["T_DOUBLE_COLON","::",136],["T_STRING","app",136],"(",")",["T_OBJECT_OPERATOR","->",136],["T_STRING","getStore",136],"(",")",")",";",["T_WHITESPACE","\n                        ",136],["T_VARIABLE","$quote",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","collectTotals",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","save",137],"(",")",";",["T_WHITESPACE","\n                        ",137],["T_COMMENT","\/*\n                         * We mast to create new quote object, because collectTotals()\n                         * can to create links with other objects.\n                         *\/",138],["T_WHITESPACE","\n                        ",141],["T_VARIABLE","$quote",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","Mage",142],["T_DOUBLE_COLON","::",142],["T_STRING","getModel",142],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",142],")",["T_OBJECT_OPERATOR","->",142],["T_STRING","setStoreId",142],"(",["T_STRING","Mage",142],["T_DOUBLE_COLON","::",142],["T_STRING","app",142],"(",")",["T_OBJECT_OPERATOR","->",142],["T_STRING","getStore",142],"(",")",["T_OBJECT_OPERATOR","->",142],["T_STRING","getId",142],"(",")",")",";",["T_WHITESPACE","\n                        ",142],["T_VARIABLE","$quote",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","load",143],"(",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getQuoteId",143],"(",")",")",";",["T_WHITESPACE","\n                    ",143],"}",["T_WHITESPACE","\n                ",144],"}",["T_WHITESPACE"," ",145],["T_ELSE","else",145],["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n                    ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","setQuoteId",146],"(",["T_STRING","null",146],")",";",["T_WHITESPACE","\n                ",146],"}",["T_WHITESPACE","\n            ",147],"}",["T_WHITESPACE","\n\n            ",148],["T_VARIABLE","$customerSession",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","Mage",150],["T_DOUBLE_COLON","::",150],["T_STRING","getSingleton",150],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",150],")",";",["T_WHITESPACE","\n\n            ",150],["T_IF","if",152],["T_WHITESPACE"," ",152],"(","!",["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getQuoteId",152],"(",")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n                ",152],["T_IF","if",153],["T_WHITESPACE"," ",153],"(",["T_VARIABLE","$customerSession",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","isLoggedIn",153],"(",")",["T_WHITESPACE"," ",153],["T_BOOLEAN_OR","||",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_customer",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                    ",153],["T_VARIABLE","$customer",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_customer",154],")",["T_WHITESPACE"," ",154],"?",["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_customer",154],["T_WHITESPACE"," ",154],":",["T_WHITESPACE"," ",154],["T_VARIABLE","$customerSession",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getCustomer",154],"(",")",";",["T_WHITESPACE","\n                    ",154],["T_VARIABLE","$quote",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","loadByCustomer",155],"(",["T_VARIABLE","$customer",155],")",";",["T_WHITESPACE","\n                    ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","setQuoteId",156],"(",["T_VARIABLE","$quote",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getId",156],"(",")",")",";",["T_WHITESPACE","\n                ",156],"}",["T_WHITESPACE"," ",157],["T_ELSE","else",157],["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n                    ",157],["T_VARIABLE","$quote",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","setIsCheckoutCart",158],"(",["T_STRING","true",158],")",";",["T_WHITESPACE","\n                    ",158],["T_STRING","Mage",159],["T_DOUBLE_COLON","::",159],["T_STRING","dispatchEvent",159],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_quote_init'",159],",",["T_WHITESPACE"," ",159],["T_ARRAY","array",159],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",159],["T_DOUBLE_ARROW","=>",159],["T_VARIABLE","$quote",159],")",")",";",["T_WHITESPACE","\n                ",159],"}",["T_WHITESPACE","\n            ",160],"}",["T_WHITESPACE","\n\n            ",161],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getQuoteId",163],"(",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$customerSession",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","isLoggedIn",164],"(",")",["T_WHITESPACE"," ",164],["T_BOOLEAN_OR","||",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_customer",164],")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n                    ",164],["T_VARIABLE","$customer",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_customer",165],")",["T_WHITESPACE"," ",165],"?",["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_customer",165],["T_WHITESPACE"," ",165],":",["T_WHITESPACE"," ",165],["T_VARIABLE","$customerSession",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getCustomer",165],"(",")",";",["T_WHITESPACE","\n                    ",165],["T_VARIABLE","$quote",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","setCustomer",166],"(",["T_VARIABLE","$customer",166],")",";",["T_WHITESPACE","\n                ",166],"}",["T_WHITESPACE","\n            ",167],"}",["T_WHITESPACE","\n\n            ",168],["T_VARIABLE","$quote",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","setStore",170],"(",["T_STRING","Mage",170],["T_DOUBLE_COLON","::",170],["T_STRING","app",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","getStore",170],"(",")",")",";",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_quote",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$quote",171],";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n\n        ",172],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_VARIABLE","$remoteAddr",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_STRING","Mage",174],["T_DOUBLE_COLON","::",174],["T_STRING","helper",174],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/http'",174],")",["T_OBJECT_OPERATOR","->",174],["T_STRING","getRemoteAddr",174],"(",")",")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n            ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_quote",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","setRemoteIp",175],"(",["T_VARIABLE","$remoteAddr",175],")",";",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$xForwardIp",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_STRING","Mage",176],["T_DOUBLE_COLON","::",176],["T_STRING","app",176],"(",")",["T_OBJECT_OPERATOR","->",176],["T_STRING","getRequest",176],"(",")",["T_OBJECT_OPERATOR","->",176],["T_STRING","getServer",176],"(",["T_CONSTANT_ENCAPSED_STRING","'HTTP_X_FORWARDED_FOR'",176],")",";",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_quote",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","setXForwardedFor",177],"(",["T_VARIABLE","$xForwardIp",177],")",";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n        ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_quote",179],";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n\n    ",180],["T_PROTECTED","protected",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","_getQuoteIdKey",182],"(",")",["T_WHITESPACE","\n    ",182],"{",["T_WHITESPACE","\n        ",183],["T_RETURN","return",184],["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'quote_id_'",184],["T_WHITESPACE"," ",184],".",["T_WHITESPACE"," ",184],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","app",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","getStore",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","getWebsiteId",184],"(",")",";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_PUBLIC","public",187],["T_WHITESPACE"," ",187],["T_FUNCTION","function",187],["T_WHITESPACE"," ",187],["T_STRING","setQuoteId",187],"(",["T_VARIABLE","$quoteId",187],")",["T_WHITESPACE","\n    ",187],"{",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","setData",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_getQuoteIdKey",189],"(",")",",",["T_WHITESPACE"," ",189],["T_VARIABLE","$quoteId",189],")",";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n\n    ",190],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","getQuoteId",192],"(",")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_RETURN","return",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getData",194],"(",["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_getQuoteIdKey",194],"(",")",")",";",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Load data for customer quote and merge with current quote\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",197],["T_WHITESPACE","\n    ",201],["T_PUBLIC","public",202],["T_WHITESPACE"," ",202],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","loadCustomerQuote",202],"(",")",["T_WHITESPACE","\n    ",202],"{",["T_WHITESPACE","\n        ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(","!",["T_STRING","Mage",204],["T_DOUBLE_COLON","::",204],["T_STRING","getSingleton",204],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",204],")",["T_OBJECT_OPERATOR","->",204],["T_STRING","getCustomerId",204],"(",")",")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_RETURN","return",205],["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n\n        ",206],["T_STRING","Mage",208],["T_DOUBLE_COLON","::",208],["T_STRING","dispatchEvent",208],"(",["T_CONSTANT_ENCAPSED_STRING","'load_customer_quote_before'",208],",",["T_WHITESPACE"," ",208],["T_ARRAY","array",208],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_session'",208],["T_WHITESPACE"," ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],")",")",";",["T_WHITESPACE","\n\n        ",208],["T_VARIABLE","$customerQuote",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_STRING","Mage",210],["T_DOUBLE_COLON","::",210],["T_STRING","getModel",210],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",210],")",["T_WHITESPACE","\n            ",210],["T_OBJECT_OPERATOR","->",211],["T_STRING","setStoreId",211],"(",["T_STRING","Mage",211],["T_DOUBLE_COLON","::",211],["T_STRING","app",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","getStore",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","getId",211],"(",")",")",["T_WHITESPACE","\n            ",211],["T_OBJECT_OPERATOR","->",212],["T_STRING","loadByCustomer",212],"(",["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","getSingleton",212],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",212],")",["T_OBJECT_OPERATOR","->",212],["T_STRING","getCustomerId",212],"(",")",")",";",["T_WHITESPACE","\n\n        ",212],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$customerQuote",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getId",214],"(",")",["T_WHITESPACE"," ",214],["T_BOOLEAN_AND","&&",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getQuoteId",214],"(",")",["T_WHITESPACE"," ",214],["T_IS_NOT_EQUAL","!=",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$customerQuote",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getId",214],"(",")",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_IF","if",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getQuoteId",215],"(",")",")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n                ",215],["T_VARIABLE","$customerQuote",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","merge",216],"(",["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getQuote",216],"(",")",")",["T_WHITESPACE","\n                    ",216],["T_OBJECT_OPERATOR","->",217],["T_STRING","collectTotals",217],"(",")",["T_WHITESPACE","\n                    ",217],["T_OBJECT_OPERATOR","->",218],["T_STRING","save",218],"(",")",";",["T_WHITESPACE","\n            ",218],"}",["T_WHITESPACE","\n\n            ",219],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setQuoteId",221],"(",["T_VARIABLE","$customerQuote",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getId",221],"(",")",")",";",["T_WHITESPACE","\n\n            ",221],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_quote",223],")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_quote",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","delete",224],"(",")",";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_quote",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_VARIABLE","$customerQuote",226],";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE"," ",227],["T_ELSE","else",227],["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getQuote",228],"(",")",["T_OBJECT_OPERATOR","->",228],["T_STRING","getBillingAddress",228],"(",")",";",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getQuote",229],"(",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getShippingAddress",229],"(",")",";",["T_WHITESPACE","\n            ",229],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getQuote",230],"(",")",["T_OBJECT_OPERATOR","->",230],["T_STRING","setCustomer",230],"(",["T_STRING","Mage",230],["T_DOUBLE_COLON","::",230],["T_STRING","getSingleton",230],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",230],")",["T_OBJECT_OPERATOR","->",230],["T_STRING","getCustomer",230],"(",")",")",["T_WHITESPACE","\n                ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","setTotalsCollectedFlag",231],"(",["T_STRING","false",231],")",["T_WHITESPACE","\n                ",231],["T_OBJECT_OPERATOR","->",232],["T_STRING","collectTotals",232],"(",")",["T_WHITESPACE","\n                ",232],["T_OBJECT_OPERATOR","->",233],["T_STRING","save",233],"(",")",";",["T_WHITESPACE","\n        ",233],"}",["T_WHITESPACE","\n        ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_PUBLIC","public",238],["T_WHITESPACE"," ",238],["T_FUNCTION","function",238],["T_WHITESPACE"," ",238],["T_STRING","setStepData",238],"(",["T_VARIABLE","$step",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$data",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$value",238],"=",["T_STRING","null",238],")",["T_WHITESPACE","\n    ",238],"{",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$steps",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getSteps",240],"(",")",";",["T_WHITESPACE","\n        ",240],["T_IF","if",241],["T_WHITESPACE"," ",241],"(",["T_STRING","is_null",241],"(",["T_VARIABLE","$value",241],")",")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n            ",241],["T_IF","if",242],["T_WHITESPACE"," ",242],"(",["T_STRING","is_array",242],"(",["T_VARIABLE","$data",242],")",")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n                ",242],["T_VARIABLE","$steps",243],"[",["T_VARIABLE","$step",243],"]",["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$data",243],";",["T_WHITESPACE","\n            ",243],"}",["T_WHITESPACE","\n        ",244],"}",["T_WHITESPACE"," ",245],["T_ELSE","else",245],["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n            ",245],["T_IF","if",246],["T_WHITESPACE"," ",246],"(","!",["T_ISSET","isset",246],"(",["T_VARIABLE","$steps",246],"[",["T_VARIABLE","$step",246],"]",")",")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n                ",246],["T_VARIABLE","$steps",247],"[",["T_VARIABLE","$step",247],"]",["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_ARRAY","array",247],"(",")",";",["T_WHITESPACE","\n            ",247],"}",["T_WHITESPACE","\n            ",248],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_STRING","is_string",249],"(",["T_VARIABLE","$data",249],")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                ",249],["T_VARIABLE","$steps",250],"[",["T_VARIABLE","$step",250],"]","[",["T_VARIABLE","$data",250],"]",["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$value",250],";",["T_WHITESPACE","\n            ",250],"}",["T_WHITESPACE","\n        ",251],"}",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","setSteps",253],"(",["T_VARIABLE","$steps",253],")",";",["T_WHITESPACE","\n\n        ",253],["T_RETURN","return",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],";",["T_WHITESPACE","\n    ",255],"}",["T_WHITESPACE","\n\n    ",256],["T_PUBLIC","public",258],["T_WHITESPACE"," ",258],["T_FUNCTION","function",258],["T_WHITESPACE"," ",258],["T_STRING","getStepData",258],"(",["T_VARIABLE","$step",258],"=",["T_STRING","null",258],",",["T_WHITESPACE"," ",258],["T_VARIABLE","$data",258],"=",["T_STRING","null",258],")",["T_WHITESPACE","\n    ",258],"{",["T_WHITESPACE","\n        ",259],["T_VARIABLE","$steps",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getSteps",260],"(",")",";",["T_WHITESPACE","\n        ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(",["T_STRING","is_null",261],"(",["T_VARIABLE","$step",261],")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_RETURN","return",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$steps",262],";",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n        ",263],["T_IF","if",264],["T_WHITESPACE"," ",264],"(","!",["T_ISSET","isset",264],"(",["T_VARIABLE","$steps",264],"[",["T_VARIABLE","$step",264],"]",")",")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n            ",264],["T_RETURN","return",265],["T_WHITESPACE"," ",265],["T_STRING","false",265],";",["T_WHITESPACE","\n        ",265],"}",["T_WHITESPACE","\n        ",266],["T_IF","if",267],["T_WHITESPACE"," ",267],"(",["T_STRING","is_null",267],"(",["T_VARIABLE","$data",267],")",")",["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n            ",267],["T_RETURN","return",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$steps",268],"[",["T_VARIABLE","$step",268],"]",";",["T_WHITESPACE","\n        ",268],"}",["T_WHITESPACE","\n        ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(","!",["T_STRING","is_string",270],"(",["T_VARIABLE","$data",270],")",["T_WHITESPACE"," ",270],["T_BOOLEAN_OR","||",270],["T_WHITESPACE"," ",270],"!",["T_ISSET","isset",270],"(",["T_VARIABLE","$steps",270],"[",["T_VARIABLE","$step",270],"]","[",["T_VARIABLE","$data",270],"]",")",")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_RETURN","return",271],["T_WHITESPACE"," ",271],["T_STRING","false",271],";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE","\n        ",272],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$steps",273],"[",["T_VARIABLE","$step",273],"]","[",["T_VARIABLE","$data",273],"]",";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Retrieves list of all saved additional messages for different instances (e.g. quote items) in checkout session\n     * Returned: array(itemKey => messageCollection, ...)\n     * where itemKey is a unique hash (e.g 'quote_item17') to distinguish item messages among message collections\n     *\n     * @param bool $clear\n     *\n     * @return array\n     *\/",276],["T_WHITESPACE","\n    ",284],["T_PUBLIC","public",285],["T_WHITESPACE"," ",285],["T_FUNCTION","function",285],["T_WHITESPACE"," ",285],["T_STRING","getAdditionalMessages",285],"(",["T_VARIABLE","$clear",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_STRING","false",285],")",["T_WHITESPACE","\n    ",285],"{",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$additionalMessages",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getData",287],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_messages'",287],")",";",["T_WHITESPACE","\n        ",287],["T_IF","if",288],["T_WHITESPACE"," ",288],"(","!",["T_VARIABLE","$additionalMessages",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n            ",288],["T_RETURN","return",289],["T_WHITESPACE"," ",289],["T_ARRAY","array",289],"(",")",";",["T_WHITESPACE","\n        ",289],"}",["T_WHITESPACE","\n        ",290],["T_IF","if",291],["T_WHITESPACE"," ",291],"(",["T_VARIABLE","$clear",291],")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","setData",292],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_messages'",292],",",["T_WHITESPACE"," ",292],["T_STRING","null",292],")",";",["T_WHITESPACE","\n        ",292],"}",["T_WHITESPACE","\n        ",293],["T_RETURN","return",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$additionalMessages",294],";",["T_WHITESPACE","\n    ",294],"}",["T_WHITESPACE","\n\n    ",295],["T_DOC_COMMENT","\/**\n     * Retrieves list of item additional messages\n     * itemKey is a unique hash (e.g 'quote_item17') to distinguish item messages among message collections\n     *\n     * @param string $itemKey\n     * @param bool $clear\n     *\n     * @return null|Mage_Core_Model_Message_Collection\n     *\/",297],["T_WHITESPACE","\n    ",305],["T_PUBLIC","public",306],["T_WHITESPACE"," ",306],["T_FUNCTION","function",306],["T_WHITESPACE"," ",306],["T_STRING","getItemAdditionalMessages",306],"(",["T_VARIABLE","$itemKey",306],",",["T_WHITESPACE"," ",306],["T_VARIABLE","$clear",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_STRING","false",306],")",["T_WHITESPACE","\n    ",306],"{",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$allMessages",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getAdditionalMessages",308],"(",")",";",["T_WHITESPACE","\n        ",308],["T_IF","if",309],["T_WHITESPACE"," ",309],"(","!",["T_ISSET","isset",309],"(",["T_VARIABLE","$allMessages",309],"[",["T_VARIABLE","$itemKey",309],"]",")",")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n            ",309],["T_RETURN","return",310],["T_WHITESPACE"," ",310],["T_STRING","null",310],";",["T_WHITESPACE","\n        ",310],"}",["T_WHITESPACE","\n\n        ",311],["T_VARIABLE","$messages",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$allMessages",313],"[",["T_VARIABLE","$itemKey",313],"]",";",["T_WHITESPACE","\n        ",313],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$clear",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_UNSET","unset",315],"(",["T_VARIABLE","$allMessages",315],"[",["T_VARIABLE","$itemKey",315],"]",")",";",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","setAdditionalMessages",316],"(",["T_VARIABLE","$allMessages",316],")",";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE","\n        ",317],["T_RETURN","return",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$messages",318],";",["T_WHITESPACE","\n    ",318],"}",["T_WHITESPACE","\n\n    ",319],["T_DOC_COMMENT","\/**\n     * Adds new message in this session to a list of additional messages for some item\n     * itemKey is a unique hash (e.g 'quote_item17') to distinguish item messages among message collections\n     *\n     * @param string $itemKey\n     * @param Mage_Core_Model_Message $message\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",321],["T_WHITESPACE","\n    ",329],["T_PUBLIC","public",330],["T_WHITESPACE"," ",330],["T_FUNCTION","function",330],["T_WHITESPACE"," ",330],["T_STRING","addItemAdditionalMessage",330],"(",["T_VARIABLE","$itemKey",330],",",["T_WHITESPACE"," ",330],["T_VARIABLE","$message",330],")",["T_WHITESPACE","\n    ",330],"{",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$allMessages",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getAdditionalMessages",332],"(",")",";",["T_WHITESPACE","\n        ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(","!",["T_ISSET","isset",333],"(",["T_VARIABLE","$allMessages",333],"[",["T_VARIABLE","$itemKey",333],"]",")",")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$allMessages",334],"[",["T_VARIABLE","$itemKey",334],"]",["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_STRING","Mage",334],["T_DOUBLE_COLON","::",334],["T_STRING","getModel",334],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/message_collection'",334],")",";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n        ",335],["T_VARIABLE","$allMessages",336],"[",["T_VARIABLE","$itemKey",336],"]",["T_OBJECT_OPERATOR","->",336],["T_STRING","add",336],"(",["T_VARIABLE","$message",336],")",";",["T_WHITESPACE","\n        ",336],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","setAdditionalMessages",337],"(",["T_VARIABLE","$allMessages",337],")",";",["T_WHITESPACE","\n\n        ",337],["T_RETURN","return",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],";",["T_WHITESPACE","\n    ",339],"}",["T_WHITESPACE","\n\n    ",340],["T_DOC_COMMENT","\/**\n     * Retrieves list of quote item messages\n     * @param int $itemId\n     * @param bool $clear\n     *\n     * @return null|Mage_Core_Model_Message_Collection\n     *\/",342],["T_WHITESPACE","\n    ",348],["T_PUBLIC","public",349],["T_WHITESPACE"," ",349],["T_FUNCTION","function",349],["T_WHITESPACE"," ",349],["T_STRING","getQuoteItemMessages",349],"(",["T_VARIABLE","$itemId",349],",",["T_WHITESPACE"," ",349],["T_VARIABLE","$clear",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_STRING","false",349],")",["T_WHITESPACE","\n    ",349],"{",["T_WHITESPACE","\n        ",350],["T_RETURN","return",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getItemAdditionalMessages",351],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_item'",351],["T_WHITESPACE"," ",351],".",["T_WHITESPACE"," ",351],["T_VARIABLE","$itemId",351],",",["T_WHITESPACE"," ",351],["T_VARIABLE","$clear",351],")",";",["T_WHITESPACE","\n    ",351],"}",["T_WHITESPACE","\n\n    ",352],["T_DOC_COMMENT","\/**\n     * Adds new message to a list of quote item messages, saved in this session\n     *\n     * @param int $itemId\n     * @param Mage_Core_Model_Message $message\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",354],["T_WHITESPACE","\n    ",361],["T_FUNCTION","function",362],["T_WHITESPACE"," ",362],["T_STRING","addQuoteItemMessage",362],"(",["T_VARIABLE","$itemId",362],",",["T_WHITESPACE"," ",362],["T_VARIABLE","$message",362],")",["T_WHITESPACE","\n    ",362],"{",["T_WHITESPACE","\n        ",363],["T_RETURN","return",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","addItemAdditionalMessage",364],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_item'",364],["T_WHITESPACE"," ",364],".",["T_WHITESPACE"," ",364],["T_VARIABLE","$itemId",364],",",["T_WHITESPACE"," ",364],["T_VARIABLE","$message",364],")",";",["T_WHITESPACE","\n    ",364],"}",["T_WHITESPACE","\n\n    ",365],["T_PUBLIC","public",367],["T_WHITESPACE"," ",367],["T_FUNCTION","function",367],["T_WHITESPACE"," ",367],["T_STRING","clear",367],"(",")",["T_WHITESPACE","\n    ",367],"{",["T_WHITESPACE","\n        ",368],["T_STRING","Mage",369],["T_DOUBLE_COLON","::",369],["T_STRING","dispatchEvent",369],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_quote_destroy'",369],",",["T_WHITESPACE"," ",369],["T_ARRAY","array",369],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",369],["T_DOUBLE_ARROW","=>",369],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getQuote",369],"(",")",")",")",";",["T_WHITESPACE","\n        ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","_quote",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_STRING","null",370],";",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","setQuoteId",371],"(",["T_STRING","null",371],")",";",["T_WHITESPACE","\n        ",371],["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","setLastSuccessQuoteId",372],"(",["T_STRING","null",372],")",";",["T_WHITESPACE","\n    ",372],"}",["T_WHITESPACE","\n\n    ",373],["T_DOC_COMMENT","\/**\n     * Clear misc checkout parameters\n     *\/",375],["T_WHITESPACE","\n    ",377],["T_PUBLIC","public",378],["T_WHITESPACE"," ",378],["T_FUNCTION","function",378],["T_WHITESPACE"," ",378],["T_STRING","clearHelperData",378],"(",")",["T_WHITESPACE","\n    ",378],"{",["T_WHITESPACE","\n        ",379],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","setLastBillingAgreementId",380],"(",["T_STRING","null",380],")",["T_WHITESPACE","\n            ",380],["T_OBJECT_OPERATOR","->",381],["T_STRING","setRedirectUrl",381],"(",["T_STRING","null",381],")",["T_WHITESPACE","\n            ",381],["T_OBJECT_OPERATOR","->",382],["T_STRING","setLastOrderId",382],"(",["T_STRING","null",382],")",["T_WHITESPACE","\n            ",382],["T_OBJECT_OPERATOR","->",383],["T_STRING","setLastRealOrderId",383],"(",["T_STRING","null",383],")",["T_WHITESPACE","\n            ",383],["T_OBJECT_OPERATOR","->",384],["T_STRING","setLastRecurringProfileIds",384],"(",["T_STRING","null",384],")",["T_WHITESPACE","\n            ",384],["T_OBJECT_OPERATOR","->",385],["T_STRING","setAdditionalMessages",385],"(",["T_STRING","null",385],")",["T_WHITESPACE","\n        ",385],";",["T_WHITESPACE","\n    ",386],"}",["T_WHITESPACE","\n\n    ",387],["T_PUBLIC","public",389],["T_WHITESPACE"," ",389],["T_FUNCTION","function",389],["T_WHITESPACE"," ",389],["T_STRING","resetCheckout",389],"(",")",["T_WHITESPACE","\n    ",389],"{",["T_WHITESPACE","\n        ",390],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","setCheckoutState",391],"(",["T_STRING","self",391],["T_DOUBLE_COLON","::",391],["T_STRING","CHECKOUT_STATE_BEGIN",391],")",";",["T_WHITESPACE","\n        ",391],["T_RETURN","return",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],";",["T_WHITESPACE","\n    ",392],"}",["T_WHITESPACE","\n\n    ",393],["T_PUBLIC","public",395],["T_WHITESPACE"," ",395],["T_FUNCTION","function",395],["T_WHITESPACE"," ",395],["T_STRING","replaceQuote",395],"(",["T_VARIABLE","$quote",395],")",["T_WHITESPACE","\n    ",395],"{",["T_WHITESPACE","\n        ",396],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","_quote",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$quote",397],";",["T_WHITESPACE","\n        ",397],["T_VARIABLE","$this",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","setQuoteId",398],"(",["T_VARIABLE","$quote",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","getId",398],"(",")",")",";",["T_WHITESPACE","\n        ",398],["T_RETURN","return",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],";",["T_WHITESPACE","\n    ",399],"}",["T_WHITESPACE","\n\n    ",400],["T_DOC_COMMENT","\/**\n     * Get order instance based on last order ID\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",402],["T_WHITESPACE","\n    ",406],["T_PUBLIC","public",407],["T_WHITESPACE"," ",407],["T_FUNCTION","function",407],["T_WHITESPACE"," ",407],["T_STRING","getLastRealOrder",407],"(",")",["T_WHITESPACE","\n    ",407],"{",["T_WHITESPACE","\n        ",408],["T_VARIABLE","$orderId",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getLastRealOrderId",409],"(",")",";",["T_WHITESPACE","\n        ",409],["T_IF","if",410],["T_WHITESPACE"," ",410],"(",["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_order",410],["T_WHITESPACE"," ",410],["T_IS_NOT_IDENTICAL","!==",410],["T_WHITESPACE"," ",410],["T_STRING","null",410],["T_WHITESPACE"," ",410],["T_BOOLEAN_AND","&&",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$orderId",410],["T_WHITESPACE"," ",410],["T_IS_EQUAL","==",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_order",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getIncrementId",410],"(",")",")",["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n            ",410],["T_RETURN","return",411],["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_order",411],";",["T_WHITESPACE","\n        ",411],"}",["T_WHITESPACE","\n        ",412],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_order",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_getOrderModel",413],"(",")",";",["T_WHITESPACE","\n        ",413],["T_IF","if",414],["T_WHITESPACE"," ",414],"(",["T_VARIABLE","$orderId",414],")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n            ",414],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_order",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","loadByIncrementId",415],"(",["T_VARIABLE","$orderId",415],")",";",["T_WHITESPACE","\n        ",415],"}",["T_WHITESPACE","\n        ",416],["T_RETURN","return",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","_order",417],";",["T_WHITESPACE","\n    ",417],"}",["T_WHITESPACE","\n\n    ",418],["T_DOC_COMMENT","\/**\n     * Get order model\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",420],["T_WHITESPACE","\n    ",424],["T_PROTECTED","protected",425],["T_WHITESPACE"," ",425],["T_FUNCTION","function",425],["T_WHITESPACE"," ",425],["T_STRING","_getOrderModel",425],"(",")",["T_WHITESPACE","\n    ",425],"{",["T_WHITESPACE","\n        ",426],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_STRING","Mage",427],["T_DOUBLE_COLON","::",427],["T_STRING","getModel",427],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",427],")",";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n",428],"}",["T_WHITESPACE","\n",429]]