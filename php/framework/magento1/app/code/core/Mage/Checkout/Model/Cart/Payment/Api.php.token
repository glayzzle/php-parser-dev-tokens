[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Shopping cart api\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Cart_Payment_Api",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Checkout_Model_Api_Resource",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n\n    ",36],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","_preparePaymentData",38],"(",["T_VARIABLE","$data",38],")",["T_WHITESPACE","\n    ",38],"{",["T_WHITESPACE","\n        ",39],["T_IF","if",40],["T_WHITESPACE"," ",40],"(","!","(",["T_STRING","is_array",40],"(",["T_VARIABLE","$data",40],")",["T_WHITESPACE"," ",40],["T_BOOLEAN_AND","&&",40],["T_WHITESPACE"," ",40],["T_STRING","is_null",40],"(",["T_VARIABLE","$data",40],"[",["T_LNUMBER","0",40],"]",")",")",")",["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n            ",40],["T_RETURN","return",41],["T_WHITESPACE"," ",41],["T_ARRAY","array",41],"(",")",";",["T_WHITESPACE","\n        ",41],"}",["T_WHITESPACE","\n\n        ",42],["T_RETURN","return",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$data",44],";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * @param  $method\n     * @param  $quote\n     * @return bool\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","_canUsePaymentMethod",52],"(",["T_VARIABLE","$method",52],",",["T_WHITESPACE"," ",52],["T_VARIABLE","$quote",52],")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","!","(",["T_VARIABLE","$method",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","isGateway",54],"(",")",["T_WHITESPACE"," ",54],["T_BOOLEAN_OR","||",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$method",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","canUseInternal",54],"(",")",")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_RETURN","return",55],["T_WHITESPACE"," ",55],["T_STRING","false",55],";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n\n        ",56],["T_IF","if",58],["T_WHITESPACE"," ",58],"(","!",["T_VARIABLE","$method",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","canUseForCountry",58],"(",["T_VARIABLE","$quote",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getBillingAddress",58],"(",")",["T_OBJECT_OPERATOR","->",58],["T_STRING","getCountry",58],"(",")",")",")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_RETURN","return",59],["T_WHITESPACE"," ",59],["T_STRING","false",59],";",["T_WHITESPACE","\n        ",59],"}",["T_WHITESPACE","\n\n        ",60],["T_IF","if",62],["T_WHITESPACE"," ",62],"(","!",["T_VARIABLE","$method",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","canUseForCurrency",62],"(",["T_STRING","Mage",62],["T_DOUBLE_COLON","::",62],["T_STRING","app",62],"(",")",["T_OBJECT_OPERATOR","->",62],["T_STRING","getStore",62],"(",["T_VARIABLE","$quote",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getStoreId",62],"(",")",")",["T_OBJECT_OPERATOR","->",62],["T_STRING","getBaseCurrencyCode",62],"(",")",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_STRING","false",63],";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE","\n\n        ",64],["T_DOC_COMMENT","\/**\n         * Checking for min\/max order total for assigned payment method\n         *\/",66],["T_WHITESPACE","\n        ",68],["T_VARIABLE","$total",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$quote",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getBaseGrandTotal",69],"(",")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$minTotal",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$method",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getConfigData",70],"(",["T_CONSTANT_ENCAPSED_STRING","'min_order_total'",70],")",";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$maxTotal",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$method",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getConfigData",71],"(",["T_CONSTANT_ENCAPSED_STRING","'max_order_total'",71],")",";",["T_WHITESPACE","\n\n        ",71],["T_IF","if",73],["T_WHITESPACE"," ",73],"(","(","!",["T_EMPTY","empty",73],"(",["T_VARIABLE","$minTotal",73],")",["T_WHITESPACE"," ",73],["T_BOOLEAN_AND","&&",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$total",73],["T_WHITESPACE"," ",73],"<",["T_WHITESPACE"," ",73],["T_VARIABLE","$minTotal",73],")",")",["T_WHITESPACE"," ",73],["T_BOOLEAN_OR","||",73],["T_WHITESPACE"," ",73],"(","!",["T_EMPTY","empty",73],"(",["T_VARIABLE","$maxTotal",73],")",["T_WHITESPACE"," ",73],["T_BOOLEAN_AND","&&",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$total",73],["T_WHITESPACE"," ",73],">",["T_WHITESPACE"," ",73],["T_VARIABLE","$maxTotal",73],")",")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_STRING","false",74],";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n\n        ",75],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","true",77],";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","_getPaymentMethodAvailableCcTypes",80],"(",["T_VARIABLE","$method",80],")",["T_WHITESPACE","\n    ",80],"{",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$ccTypes",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","Mage",82],["T_DOUBLE_COLON","::",82],["T_STRING","getSingleton",82],"(",["T_CONSTANT_ENCAPSED_STRING","'payment\/config'",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","getCcTypes",82],"(",")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$methodCcTypes",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","explode",83],"(",["T_CONSTANT_ENCAPSED_STRING","','",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$method",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getConfigData",83],"(",["T_CONSTANT_ENCAPSED_STRING","'cctypes'",83],")",")",";",["T_WHITESPACE","\n        ",83],["T_FOREACH","foreach",84],["T_WHITESPACE"," ",84],"(",["T_VARIABLE","$ccTypes",84],["T_WHITESPACE"," ",84],["T_AS","as",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$code",84],["T_WHITESPACE"," ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$title",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n            ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(","!",["T_STRING","in_array",85],"(",["T_VARIABLE","$code",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$methodCcTypes",85],")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                ",85],["T_UNSET","unset",86],"(",["T_VARIABLE","$ccTypes",86],"[",["T_VARIABLE","$code",86],"]",")",";",["T_WHITESPACE","\n            ",86],"}",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_EMPTY","empty",89],"(",["T_VARIABLE","$ccTypes",89],")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_STRING","null",90],";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n\n        ",91],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$ccTypes",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Retrieve available payment methods for a quote\n     *\n     * @param int $quoteId\n     * @param int $store\n     * @return array\n     *\/",96],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getPaymentMethodsList",103],"(",["T_VARIABLE","$quoteId",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$store",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_STRING","null",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$quote",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_getQuote",105],"(",["T_VARIABLE","$quoteId",105],",",["T_WHITESPACE"," ",105],["T_VARIABLE","$store",105],")",";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$store",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$quote",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getStoreId",106],"(",")",";",["T_WHITESPACE","\n\n        ",106],["T_VARIABLE","$total",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$quote",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getBaseSubtotal",108],"(",")",";",["T_WHITESPACE","\n\n        ",108],["T_VARIABLE","$methodsResult",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_ARRAY","array",110],"(",")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$methods",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","Mage",111],["T_DOUBLE_COLON","::",111],["T_STRING","helper",111],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",111],")",["T_OBJECT_OPERATOR","->",111],["T_STRING","getStoreMethods",111],"(",["T_VARIABLE","$store",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$quote",111],")",";",["T_WHITESPACE","\n\n        ",111],["T_FOREACH","foreach",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$methods",113],["T_WHITESPACE"," ",113],["T_AS","as",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$method",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n            ",113],["T_DOC_COMMENT","\/** @var $method Mage_Payment_Model_Method_Abstract *\/",114],["T_WHITESPACE","\n            ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_canUsePaymentMethod",115],"(",["T_VARIABLE","$method",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$quote",115],")",")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$isRecurring",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$quote",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","hasRecurringItems",116],"(",")",["T_WHITESPACE"," ",116],["T_BOOLEAN_AND","&&",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$method",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","canManageRecurringProfiles",116],"(",")",";",["T_WHITESPACE","\n\n                ",116],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$total",118],["T_WHITESPACE"," ",118],["T_IS_NOT_EQUAL","!=",118],["T_WHITESPACE"," ",118],["T_LNUMBER","0",118],["T_WHITESPACE"," ",118],["T_BOOLEAN_OR","||",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$method",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getCode",118],"(",")",["T_WHITESPACE"," ",118],["T_IS_EQUAL","==",118],["T_WHITESPACE"," ",118],["T_CONSTANT_ENCAPSED_STRING","'free'",118],["T_WHITESPACE"," ",118],["T_BOOLEAN_OR","||",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$isRecurring",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n                    ",118],["T_VARIABLE","$methodsResult",119],"[","]",["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_ARRAY","array",119],"(",["T_WHITESPACE","\n                        ",119],["T_CONSTANT_ENCAPSED_STRING","'code'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$method",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getCode",120],"(",")",",",["T_WHITESPACE","\n                        ",120],["T_CONSTANT_ENCAPSED_STRING","'title'",121],["T_WHITESPACE"," ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$method",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getTitle",121],"(",")",",",["T_WHITESPACE","\n                        ",121],["T_CONSTANT_ENCAPSED_STRING","'cc_types'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_getPaymentMethodAvailableCcTypes",122],"(",["T_VARIABLE","$method",122],")",",",["T_WHITESPACE","\n                    ",122],")",";",["T_WHITESPACE","\n                ",123],"}",["T_WHITESPACE","\n            ",124],"}",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n\n        ",126],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$methodsResult",128],";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * @param  $quoteId\n     * @param  $paymentData\n     * @param  $store\n     * @return bool\n     *\/",131],["T_WHITESPACE","\n    ",136],["T_PUBLIC","public",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","setPaymentMethod",137],"(",["T_VARIABLE","$quoteId",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$paymentData",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$store",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_STRING","null",137],")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$quote",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_getQuote",139],"(",["T_VARIABLE","$quoteId",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$store",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$store",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$quote",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getStoreId",140],"(",")",";",["T_WHITESPACE","\n\n        ",140],["T_VARIABLE","$paymentData",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_preparePaymentData",142],"(",["T_VARIABLE","$paymentData",142],")",";",["T_WHITESPACE","\n\n        ",142],["T_IF","if",144],["T_WHITESPACE"," ",144],"(",["T_EMPTY","empty",144],"(",["T_VARIABLE","$paymentData",144],")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_fault",145],"(",["T_CONSTANT_ENCAPSED_STRING","\"payment_method_empty\"",145],")",";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n\n        ",146],["T_IF","if",148],["T_WHITESPACE"," ",148],"(",["T_VARIABLE","$quote",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","isVirtual",148],"(",")",")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_COMMENT","\/\/ check if billing address is set\n",149],["T_WHITESPACE","            ",150],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_STRING","is_null",150],"(",["T_VARIABLE","$quote",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getBillingAddress",150],"(",")",["T_OBJECT_OPERATOR","->",150],["T_STRING","getId",150],"(",")",")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_fault",151],"(",["T_CONSTANT_ENCAPSED_STRING","'billing_address_is_not_set'",151],")",";",["T_WHITESPACE","\n            ",151],"}",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$quote",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getBillingAddress",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","setPaymentMethod",153],"(",["T_WHITESPACE","\n                ",153],["T_ISSET","isset",154],"(",["T_VARIABLE","$paymentData",154],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",154],"]",")",["T_WHITESPACE"," ",154],"?",["T_WHITESPACE"," ",154],["T_VARIABLE","$paymentData",154],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",154],"]",["T_WHITESPACE"," ",154],":",["T_WHITESPACE"," ",154],["T_STRING","null",154],["T_WHITESPACE","\n            ",154],")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE"," ",156],["T_ELSE","else",156],["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_COMMENT","\/\/ check if shipping address is set\n",157],["T_WHITESPACE","            ",158],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_STRING","is_null",158],"(",["T_VARIABLE","$quote",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getShippingAddress",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getId",158],"(",")",")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n                ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_fault",159],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_address_is_not_set'",159],")",";",["T_WHITESPACE","\n            ",159],"}",["T_WHITESPACE","\n            ",160],["T_VARIABLE","$quote",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getShippingAddress",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","setPaymentMethod",161],"(",["T_WHITESPACE","\n                ",161],["T_ISSET","isset",162],"(",["T_VARIABLE","$paymentData",162],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",162],"]",")",["T_WHITESPACE"," ",162],"?",["T_WHITESPACE"," ",162],["T_VARIABLE","$paymentData",162],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",162],"]",["T_WHITESPACE"," ",162],":",["T_WHITESPACE"," ",162],["T_STRING","null",162],["T_WHITESPACE","\n            ",162],")",";",["T_WHITESPACE","\n        ",163],"}",["T_WHITESPACE","\n\n        ",164],["T_IF","if",166],["T_WHITESPACE"," ",166],"(","!",["T_VARIABLE","$quote",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","isVirtual",166],"(",")",["T_WHITESPACE"," ",166],["T_BOOLEAN_AND","&&",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$quote",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getShippingAddress",166],"(",")",")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$quote",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getShippingAddress",167],"(",")",["T_OBJECT_OPERATOR","->",167],["T_STRING","setCollectShippingRates",167],"(",["T_STRING","true",167],")",";",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n\n        ",168],["T_VARIABLE","$total",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$quote",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getBaseSubtotal",170],"(",")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$methods",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_STRING","Mage",171],["T_DOUBLE_COLON","::",171],["T_STRING","helper",171],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",171],")",["T_OBJECT_OPERATOR","->",171],["T_STRING","getStoreMethods",171],"(",["T_VARIABLE","$store",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$quote",171],")",";",["T_WHITESPACE","\n        ",171],["T_FOREACH","foreach",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$methods",172],["T_WHITESPACE"," ",172],["T_AS","as",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$method",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(",["T_VARIABLE","$method",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getCode",173],"(",")",["T_WHITESPACE"," ",173],["T_IS_EQUAL","==",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$paymentData",173],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",173],"]",")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n                ",173],["T_DOC_COMMENT","\/** @var $method Mage_Payment_Model_Method_Abstract *\/",174],["T_WHITESPACE","\n                ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(","!","(",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_canUsePaymentMethod",175],"(",["T_VARIABLE","$method",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$quote",175],")",["T_WHITESPACE","\n                    ",175],["T_BOOLEAN_AND","&&",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$total",176],["T_WHITESPACE"," ",176],["T_IS_NOT_EQUAL","!=",176],["T_WHITESPACE"," ",176],["T_LNUMBER","0",176],["T_WHITESPACE","\n                        ",176],["T_BOOLEAN_OR","||",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$method",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getCode",177],"(",")",["T_WHITESPACE"," ",177],["T_IS_EQUAL","==",177],["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","'free'",177],["T_WHITESPACE","\n                        ",177],["T_BOOLEAN_OR","||",178],["T_WHITESPACE"," ",178],"(",["T_VARIABLE","$quote",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","hasRecurringItems",178],"(",")",["T_WHITESPACE"," ",178],["T_BOOLEAN_AND","&&",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$method",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","canManageRecurringProfiles",178],"(",")",")",")",")",["T_WHITESPACE","\n                ",178],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                    ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_fault",180],"(",["T_CONSTANT_ENCAPSED_STRING","\"method_not_allowed\"",180],")",";",["T_WHITESPACE","\n                ",180],"}",["T_WHITESPACE","\n            ",181],"}",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n\n        ",183],["T_TRY","try",185],["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$payment",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$quote",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getPayment",186],"(",")",";",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$payment",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","importData",187],"(",["T_VARIABLE","$paymentData",187],")",";",["T_WHITESPACE","\n\n\n            ",187],["T_VARIABLE","$quote",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","setTotalsCollectedFlag",190],"(",["T_STRING","false",190],")",["T_WHITESPACE","\n                ",190],["T_OBJECT_OPERATOR","->",191],["T_STRING","collectTotals",191],"(",")",["T_WHITESPACE","\n                ",191],["T_OBJECT_OPERATOR","->",192],["T_STRING","save",192],"(",")",";",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE"," ",193],["T_CATCH","catch",193],["T_WHITESPACE"," ",193],"(",["T_STRING","Mage_Core_Exception",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$e",193],")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_fault",194],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_method_is_not_set'",194],",",["T_WHITESPACE"," ",194],["T_VARIABLE","$e",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getMessage",194],"(",")",")",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n        ",195],["T_RETURN","return",196],["T_WHITESPACE"," ",196],["T_STRING","true",196],";",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n\n",197],"}",["T_WHITESPACE","\n",199]]