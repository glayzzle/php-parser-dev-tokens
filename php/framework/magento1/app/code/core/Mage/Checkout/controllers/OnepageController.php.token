[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Onepage controller for checkout\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_OnepageController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_Controller_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * List of functions for section update\n     *\n     * @var array\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_sectionUpdateFunctions",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_ARRAY","array",41],"(",["T_WHITESPACE","\n        ",41],["T_CONSTANT_ENCAPSED_STRING","'payment-method'",42],["T_WHITESPACE","  ",42],["T_DOUBLE_ARROW","=>",42],["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'_getPaymentMethodsHtml'",42],",",["T_WHITESPACE","\n        ",42],["T_CONSTANT_ENCAPSED_STRING","'shipping-method'",43],["T_WHITESPACE"," ",43],["T_DOUBLE_ARROW","=>",43],["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'_getShippingMethodsHtml'",43],",",["T_WHITESPACE","\n        ",43],["T_CONSTANT_ENCAPSED_STRING","'review'",44],["T_WHITESPACE","          ",44],["T_DOUBLE_ARROW","=>",44],["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'_getReviewHtml'",44],",",["T_WHITESPACE","\n    ",44],")",";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * @var Mage_Sales_Model_Order\n     *\/",47],["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$_order",50],";",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * Predispatch: should set layout area\n     *\n     * @return Mage_Checkout_OnepageController\n     *\/",52],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","preDispatch",57],"(",")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_STRING","parent",59],["T_DOUBLE_COLON","::",59],["T_STRING","preDispatch",59],"(",")",";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_preDispatchValidateCustomer",60],"(",")",";",["T_WHITESPACE","\n\n        ",60],["T_VARIABLE","$checkoutSessionQuote",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","Mage",62],["T_DOUBLE_COLON","::",62],["T_STRING","getSingleton",62],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",62],")",["T_OBJECT_OPERATOR","->",62],["T_STRING","getQuote",62],"(",")",";",["T_WHITESPACE","\n        ",62],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$checkoutSessionQuote",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getIsMultiShipping",63],"(",")",")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$checkoutSessionQuote",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","setIsMultiShipping",64],"(",["T_STRING","false",64],")",";",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$checkoutSessionQuote",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","removeAllAddresses",65],"(",")",";",["T_WHITESPACE","\n        ",65],"}",["T_WHITESPACE","\n\n        ",66],["T_IF","if",68],["T_WHITESPACE"," ",68],"(","!",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_canShowForUnregisteredUsers",68],"(",")",")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","norouteAction",69],"(",")",";",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","setFlag",70],"(",["T_CONSTANT_ENCAPSED_STRING","''",70],",",["T_STRING","self",70],["T_DOUBLE_COLON","::",70],["T_STRING","FLAG_NO_DISPATCH",70],",",["T_STRING","true",70],")",";",["T_WHITESPACE","\n            ",70],["T_RETURN","return",71],";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n\n        ",72],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Send Ajax redirect response\n     *\n     * @return Mage_Checkout_OnepageController\n     *\/",77],["T_WHITESPACE","\n    ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","_ajaxRedirectResponse",82],"(",")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getResponse",84],"(",")",["T_WHITESPACE","\n            ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","setHeader",85],"(",["T_CONSTANT_ENCAPSED_STRING","'HTTP\/1.1'",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'403 Session Expired'",85],")",["T_WHITESPACE","\n            ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","setHeader",86],"(",["T_CONSTANT_ENCAPSED_STRING","'Login-Required'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'true'",86],")",["T_WHITESPACE","\n            ",86],["T_OBJECT_OPERATOR","->",87],["T_STRING","sendResponse",87],"(",")",";",["T_WHITESPACE","\n        ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Validate ajax request and redirect on failure\n     *\n     * @return bool\n     *\/",91],["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","_expireAjax",96],"(",")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getOnepage",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","getQuote",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","hasItems",98],"(",")",["T_WHITESPACE","\n            ",98],["T_BOOLEAN_OR","||",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getOnepage",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","getQuote",99],"(",")",["T_OBJECT_OPERATOR","->",99],["T_STRING","getHasError",99],"(",")",["T_WHITESPACE","\n            ",99],["T_BOOLEAN_OR","||",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getOnepage",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getQuote",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getIsMultiShipping",100],"(",")",["T_WHITESPACE","\n        ",100],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_ajaxRedirectResponse",102],"(",")",";",["T_WHITESPACE","\n            ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_STRING","true",103],";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$action",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","strtolower",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getRequest",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getActionName",105],"(",")",")",";",["T_WHITESPACE","\n        ",105],["T_IF","if",106],["T_WHITESPACE"," ",106],"(",["T_STRING","Mage",106],["T_DOUBLE_COLON","::",106],["T_STRING","getSingleton",106],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",106],")",["T_OBJECT_OPERATOR","->",106],["T_STRING","getCartWasUpdated",106],"(",["T_STRING","true",106],")",["T_WHITESPACE","\n            ",106],["T_BOOLEAN_AND","&&",107],["T_WHITESPACE"," ",107],"!",["T_STRING","in_array",107],"(",["T_VARIABLE","$action",107],",",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",["T_CONSTANT_ENCAPSED_STRING","'index'",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'progress'",107],")",")",["T_WHITESPACE","\n        ",107],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_ajaxRedirectResponse",109],"(",")",";",["T_WHITESPACE","\n            ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_STRING","true",110],";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n        ",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_STRING","false",112],";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * Get shipping method step html\n     *\n     * @return string\n     *\/",115],["T_WHITESPACE","\n    ",119],["T_PROTECTED","protected",120],["T_WHITESPACE"," ",120],["T_FUNCTION","function",120],["T_WHITESPACE"," ",120],["T_STRING","_getShippingMethodsHtml",120],"(",")",["T_WHITESPACE","\n    ",120],"{",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$layout",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getLayout",122],"(",")",";",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$update",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$layout",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getUpdate",123],"(",")",";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$update",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","load",124],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_shippingmethod'",124],")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$layout",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","generateXml",125],"(",")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$layout",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","generateBlocks",126],"(",")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$output",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$layout",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getOutput",127],"(",")",";",["T_WHITESPACE","\n        ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$output",128],";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * Get payment method step html\n     *\n     * @return string\n     *\/",131],["T_WHITESPACE","\n    ",135],["T_PROTECTED","protected",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","_getPaymentMethodsHtml",136],"(",")",["T_WHITESPACE","\n    ",136],"{",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$layout",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getLayout",138],"(",")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$update",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$layout",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getUpdate",139],"(",")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$update",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","load",140],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_paymentmethod'",140],")",";",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$layout",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","generateXml",141],"(",")",";",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$layout",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","generateBlocks",142],"(",")",";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$output",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$layout",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getOutput",143],"(",")",";",["T_WHITESPACE","\n        ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$output",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Return block content from the 'checkout_onepage_additional'\n     * This is the additional content for shipping method\n     *\n     * @return string\n     *\/",147],["T_WHITESPACE","\n    ",152],["T_PROTECTED","protected",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","_getAdditionalHtml",153],"(",")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$layout",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getLayout",155],"(",")",";",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$update",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$layout",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getUpdate",156],"(",")",";",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$update",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","load",157],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_additional'",157],")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$layout",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","generateXml",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$layout",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","generateBlocks",159],"(",")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$output",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$layout",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getOutput",160],"(",")",";",["T_WHITESPACE","\n        ",160],["T_STRING","Mage",161],["T_DOUBLE_COLON","::",161],["T_STRING","getSingleton",161],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/translate_inline'",161],")",["T_OBJECT_OPERATOR","->",161],["T_STRING","processResponseBody",161],"(",["T_VARIABLE","$output",161],")",";",["T_WHITESPACE","\n        ",161],["T_RETURN","return",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$output",162],";",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n\n    ",163],["T_DOC_COMMENT","\/**\n     * Get order review step html\n     *\n     * @return string\n     *\/",165],["T_WHITESPACE","\n    ",169],["T_PROTECTED","protected",170],["T_WHITESPACE"," ",170],["T_FUNCTION","function",170],["T_WHITESPACE"," ",170],["T_STRING","_getReviewHtml",170],"(",")",["T_WHITESPACE","\n    ",170],"{",["T_WHITESPACE","\n        ",171],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getLayout",172],"(",")",["T_OBJECT_OPERATOR","->",172],["T_STRING","getBlock",172],"(",["T_CONSTANT_ENCAPSED_STRING","'root'",172],")",["T_OBJECT_OPERATOR","->",172],["T_STRING","toHtml",172],"(",")",";",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n\n    ",173],["T_DOC_COMMENT","\/**\n     * Get one page checkout model\n     *\n     * @return Mage_Checkout_Model_Type_Onepage\n     *\/",175],["T_WHITESPACE","\n    ",179],["T_PUBLIC","public",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","getOnepage",180],"(",")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_STRING","Mage",182],["T_DOUBLE_COLON","::",182],["T_STRING","getSingleton",182],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/type_onepage'",182],")",";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Checkout page\n     *\/",185],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","indexAction",188],"(",")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_STRING","Mage",190],["T_DOUBLE_COLON","::",190],["T_STRING","helper",190],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",190],")",["T_OBJECT_OPERATOR","->",190],["T_STRING","canOnepageCheckout",190],"(",")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_STRING","Mage",191],["T_DOUBLE_COLON","::",191],["T_STRING","getSingleton",191],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",191],")",["T_OBJECT_OPERATOR","->",191],["T_STRING","addError",191],"(",["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","__",191],"(",["T_CONSTANT_ENCAPSED_STRING","'The onepage checkout is disabled.'",191],")",")",";",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_redirect",192],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",192],")",";",["T_WHITESPACE","\n            ",192],["T_RETURN","return",193],";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$quote",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getOnepage",195],"(",")",["T_OBJECT_OPERATOR","->",195],["T_STRING","getQuote",195],"(",")",";",["T_WHITESPACE","\n        ",195],["T_IF","if",196],["T_WHITESPACE"," ",196],"(","!",["T_VARIABLE","$quote",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","hasItems",196],"(",")",["T_WHITESPACE"," ",196],["T_BOOLEAN_OR","||",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$quote",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getHasError",196],"(",")",")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_redirect",197],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",197],")",";",["T_WHITESPACE","\n            ",197],["T_RETURN","return",198],";",["T_WHITESPACE","\n        ",198],"}",["T_WHITESPACE","\n        ",199],["T_IF","if",200],["T_WHITESPACE"," ",200],"(","!",["T_VARIABLE","$quote",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","validateMinimumAmount",200],"(",")",")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$error",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","Mage",201],["T_DOUBLE_COLON","::",201],["T_STRING","getStoreConfig",201],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/error_message'",201],")",["T_WHITESPACE"," ",201],"?",["T_WHITESPACE","\n                ",201],["T_STRING","Mage",202],["T_DOUBLE_COLON","::",202],["T_STRING","getStoreConfig",202],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/error_message'",202],")",["T_WHITESPACE"," ",202],":",["T_WHITESPACE","\n                ",202],["T_STRING","Mage",203],["T_DOUBLE_COLON","::",203],["T_STRING","helper",203],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",203],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","__",203],"(",["T_CONSTANT_ENCAPSED_STRING","'Subtotal must exceed minimum order amount'",203],")",";",["T_WHITESPACE","\n\n            ",203],["T_STRING","Mage",205],["T_DOUBLE_COLON","::",205],["T_STRING","getSingleton",205],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",205],")",["T_OBJECT_OPERATOR","->",205],["T_STRING","addError",205],"(",["T_VARIABLE","$error",205],")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_redirect",206],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",206],")",";",["T_WHITESPACE","\n            ",206],["T_RETURN","return",207],";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n        ",208],["T_STRING","Mage",209],["T_DOUBLE_COLON","::",209],["T_STRING","getSingleton",209],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",209],")",["T_OBJECT_OPERATOR","->",209],["T_STRING","setCartWasUpdated",209],"(",["T_STRING","false",209],")",";",["T_WHITESPACE","\n        ",209],["T_STRING","Mage",210],["T_DOUBLE_COLON","::",210],["T_STRING","getSingleton",210],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",210],")",["T_OBJECT_OPERATOR","->",210],["T_STRING","setBeforeAuthUrl",210],"(",["T_STRING","Mage",210],["T_DOUBLE_COLON","::",210],["T_STRING","getUrl",210],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/*'",210],",",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],"(",["T_CONSTANT_ENCAPSED_STRING","'_secure'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_STRING","true",210],")",")",")",";",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getOnepage",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","initCheckout",211],"(",")",";",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","loadLayout",212],"(",")",";",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_initLayoutMessages",213],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",213],")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getLayout",214],"(",")",["T_OBJECT_OPERATOR","->",214],["T_STRING","getBlock",214],"(",["T_CONSTANT_ENCAPSED_STRING","'head'",214],")",["T_OBJECT_OPERATOR","->",214],["T_STRING","setTitle",214],"(",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","__",214],"(",["T_CONSTANT_ENCAPSED_STRING","'Checkout'",214],")",")",";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","renderLayout",215],"(",")",";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Refreshes the previous step\n     * Loads the block corresponding to the current step and sets it\n     * in to the response body\n     *\n     * This function is called from the reloadProgessBlock\n     * function from the javascript\n     *\n     * @return string|null\n     *\/",218],["T_WHITESPACE","\n    ",227],["T_PUBLIC","public",228],["T_WHITESPACE"," ",228],["T_FUNCTION","function",228],["T_WHITESPACE"," ",228],["T_STRING","progressAction",228],"(",")",["T_WHITESPACE","\n    ",228],"{",["T_WHITESPACE","\n        ",229],["T_COMMENT","\/\/ previous step should never be null. We always start with billing and go forward\n",230],["T_WHITESPACE","        ",231],["T_VARIABLE","$prevStep",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getRequest",231],"(",")",["T_OBJECT_OPERATOR","->",231],["T_STRING","getParam",231],"(",["T_CONSTANT_ENCAPSED_STRING","'prevStep'",231],",",["T_WHITESPACE"," ",231],["T_STRING","false",231],")",";",["T_WHITESPACE","\n\n        ",231],["T_IF","if",233],["T_WHITESPACE"," ",233],"(",["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_expireAjax",233],"(",")",["T_WHITESPACE"," ",233],["T_BOOLEAN_OR","||",233],["T_WHITESPACE"," ",233],"!",["T_VARIABLE","$prevStep",233],")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n            ",233],["T_RETURN","return",234],["T_WHITESPACE"," ",234],["T_STRING","null",234],";",["T_WHITESPACE","\n        ",234],"}",["T_WHITESPACE","\n\n        ",235],["T_VARIABLE","$layout",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getLayout",237],"(",")",";",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$update",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$layout",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getUpdate",238],"(",")",";",["T_WHITESPACE","\n        ",238],["T_COMMENT","\/* Load the block belonging to the current step*\/",239],["T_WHITESPACE","\n        ",239],["T_VARIABLE","$update",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","load",240],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_progress_'",240],["T_WHITESPACE"," ",240],".",["T_WHITESPACE"," ",240],["T_VARIABLE","$prevStep",240],")",";",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$layout",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","generateXml",241],"(",")",";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$layout",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","generateBlocks",242],"(",")",";",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$output",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$layout",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getOutput",243],"(",")",";",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getResponse",244],"(",")",["T_OBJECT_OPERATOR","->",244],["T_STRING","setBody",244],"(",["T_VARIABLE","$output",244],")",";",["T_WHITESPACE","\n        ",244],["T_RETURN","return",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$output",245],";",["T_WHITESPACE","\n    ",245],"}",["T_WHITESPACE","\n\n    ",246],["T_DOC_COMMENT","\/**\n     * Shipping method action\n     *\/",248],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","shippingMethodAction",251],"(",")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_IF","if",253],["T_WHITESPACE"," ",253],"(",["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_expireAjax",253],"(",")",")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n            ",253],["T_RETURN","return",254],";",["T_WHITESPACE","\n        ",254],"}",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","loadLayout",256],"(",["T_STRING","false",256],")",";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","renderLayout",257],"(",")",";",["T_WHITESPACE","\n    ",257],"}",["T_WHITESPACE","\n\n    ",258],["T_DOC_COMMENT","\/**\n     * Review page action\n     *\/",260],["T_WHITESPACE","\n    ",262],["T_PUBLIC","public",263],["T_WHITESPACE"," ",263],["T_FUNCTION","function",263],["T_WHITESPACE"," ",263],["T_STRING","reviewAction",263],"(",")",["T_WHITESPACE","\n    ",263],"{",["T_WHITESPACE","\n        ",264],["T_IF","if",265],["T_WHITESPACE"," ",265],"(",["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_expireAjax",265],"(",")",")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n            ",265],["T_RETURN","return",266],";",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","loadLayout",268],"(",["T_STRING","false",268],")",";",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","renderLayout",269],"(",")",";",["T_WHITESPACE","\n    ",269],"}",["T_WHITESPACE","\n\n    ",270],["T_DOC_COMMENT","\/**\n     * Order success action\n     *\/",272],["T_WHITESPACE","\n    ",274],["T_PUBLIC","public",275],["T_WHITESPACE"," ",275],["T_FUNCTION","function",275],["T_WHITESPACE"," ",275],["T_STRING","successAction",275],"(",")",["T_WHITESPACE","\n    ",275],"{",["T_WHITESPACE","\n        ",276],["T_VARIABLE","$session",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getOnepage",277],"(",")",["T_OBJECT_OPERATOR","->",277],["T_STRING","getCheckout",277],"(",")",";",["T_WHITESPACE","\n        ",277],["T_IF","if",278],["T_WHITESPACE"," ",278],"(","!",["T_VARIABLE","$session",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getLastSuccessQuoteId",278],"(",")",")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n            ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_redirect",279],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",279],")",";",["T_WHITESPACE","\n            ",279],["T_RETURN","return",280],";",["T_WHITESPACE","\n        ",280],"}",["T_WHITESPACE","\n\n        ",281],["T_VARIABLE","$lastQuoteId",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$session",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getLastQuoteId",283],"(",")",";",["T_WHITESPACE","\n        ",283],["T_VARIABLE","$lastOrderId",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$session",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getLastOrderId",284],"(",")",";",["T_WHITESPACE","\n        ",284],["T_VARIABLE","$lastRecurringProfiles",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$session",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getLastRecurringProfileIds",285],"(",")",";",["T_WHITESPACE","\n        ",285],["T_IF","if",286],["T_WHITESPACE"," ",286],"(","!",["T_VARIABLE","$lastQuoteId",286],["T_WHITESPACE"," ",286],["T_BOOLEAN_OR","||",286],["T_WHITESPACE"," ",286],"(","!",["T_VARIABLE","$lastOrderId",286],["T_WHITESPACE"," ",286],["T_BOOLEAN_AND","&&",286],["T_WHITESPACE"," ",286],["T_EMPTY","empty",286],"(",["T_VARIABLE","$lastRecurringProfiles",286],")",")",")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_redirect",287],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",287],")",";",["T_WHITESPACE","\n            ",287],["T_RETURN","return",288],";",["T_WHITESPACE","\n        ",288],"}",["T_WHITESPACE","\n\n        ",289],["T_VARIABLE","$session",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","clear",291],"(",")",";",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","loadLayout",292],"(",")",";",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_initLayoutMessages",293],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",293],")",";",["T_WHITESPACE","\n        ",293],["T_STRING","Mage",294],["T_DOUBLE_COLON","::",294],["T_STRING","dispatchEvent",294],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_controller_success_action'",294],",",["T_WHITESPACE"," ",294],["T_ARRAY","array",294],"(",["T_CONSTANT_ENCAPSED_STRING","'order_ids'",294],["T_WHITESPACE"," ",294],["T_DOUBLE_ARROW","=>",294],["T_WHITESPACE"," ",294],["T_ARRAY","array",294],"(",["T_VARIABLE","$lastOrderId",294],")",")",")",";",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","renderLayout",295],"(",")",";",["T_WHITESPACE","\n    ",295],"}",["T_WHITESPACE","\n\n    ",296],["T_DOC_COMMENT","\/**\n     * Failure action\n     *\/",298],["T_WHITESPACE","\n    ",300],["T_PUBLIC","public",301],["T_WHITESPACE"," ",301],["T_FUNCTION","function",301],["T_WHITESPACE"," ",301],["T_STRING","failureAction",301],"(",")",["T_WHITESPACE","\n    ",301],"{",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$lastQuoteId",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getOnepage",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","getCheckout",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","getLastQuoteId",303],"(",")",";",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$lastOrderId",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getOnepage",304],"(",")",["T_OBJECT_OPERATOR","->",304],["T_STRING","getCheckout",304],"(",")",["T_OBJECT_OPERATOR","->",304],["T_STRING","getLastOrderId",304],"(",")",";",["T_WHITESPACE","\n\n        ",304],["T_IF","if",306],["T_WHITESPACE"," ",306],"(","!",["T_VARIABLE","$lastQuoteId",306],["T_WHITESPACE"," ",306],["T_BOOLEAN_OR","||",306],["T_WHITESPACE"," ",306],"!",["T_VARIABLE","$lastOrderId",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_redirect",307],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",307],")",";",["T_WHITESPACE","\n            ",307],["T_RETURN","return",308],";",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n\n        ",309],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","loadLayout",311],"(",")",";",["T_WHITESPACE","\n        ",311],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","renderLayout",312],"(",")",";",["T_WHITESPACE","\n    ",312],"}",["T_WHITESPACE","\n\n\n    ",313],["T_DOC_COMMENT","\/**\n     * Get additional info action\n     *\/",316],["T_WHITESPACE","\n    ",318],["T_PUBLIC","public",319],["T_WHITESPACE"," ",319],["T_FUNCTION","function",319],["T_WHITESPACE"," ",319],["T_STRING","getAdditionalAction",319],"(",")",["T_WHITESPACE","\n    ",319],"{",["T_WHITESPACE","\n        ",320],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getResponse",321],"(",")",["T_OBJECT_OPERATOR","->",321],["T_STRING","setBody",321],"(",["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_getAdditionalHtml",321],"(",")",")",";",["T_WHITESPACE","\n    ",321],"}",["T_WHITESPACE","\n\n    ",322],["T_DOC_COMMENT","\/**\n     * Address JSON\n     *\/",324],["T_WHITESPACE","\n    ",326],["T_PUBLIC","public",327],["T_WHITESPACE"," ",327],["T_FUNCTION","function",327],["T_WHITESPACE"," ",327],["T_STRING","getAddressAction",327],"(",")",["T_WHITESPACE","\n    ",327],"{",["T_WHITESPACE","\n        ",328],["T_IF","if",329],["T_WHITESPACE"," ",329],"(",["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_expireAjax",329],"(",")",")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_RETURN","return",330],";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$addressId",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getRequest",332],"(",")",["T_OBJECT_OPERATOR","->",332],["T_STRING","getParam",332],"(",["T_CONSTANT_ENCAPSED_STRING","'address'",332],",",["T_WHITESPACE"," ",332],["T_STRING","false",332],")",";",["T_WHITESPACE","\n        ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$addressId",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$address",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getOnepage",334],"(",")",["T_OBJECT_OPERATOR","->",334],["T_STRING","getAddress",334],"(",["T_VARIABLE","$addressId",334],")",";",["T_WHITESPACE","\n\n            ",334],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_STRING","Mage",336],["T_DOUBLE_COLON","::",336],["T_STRING","getSingleton",336],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",336],")",["T_OBJECT_OPERATOR","->",336],["T_STRING","getCustomer",336],"(",")",["T_OBJECT_OPERATOR","->",336],["T_STRING","getId",336],"(",")",["T_WHITESPACE"," ",336],["T_IS_EQUAL","==",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$address",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getCustomerId",336],"(",")",")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n                ",336],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","_prepareDataJSON",337],"(",["T_VARIABLE","$address",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","toArray",337],"(",")",")",";",["T_WHITESPACE","\n            ",337],"}",["T_WHITESPACE"," ",338],["T_ELSE","else",338],["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getResponse",339],"(",")",["T_OBJECT_OPERATOR","->",339],["T_STRING","setHeader",339],"(",["T_CONSTANT_ENCAPSED_STRING","'HTTP\/1.1'",339],",",["T_CONSTANT_ENCAPSED_STRING","'403 Forbidden'",339],")",";",["T_WHITESPACE","\n            ",339],"}",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_DOC_COMMENT","\/**\n     * Save checkout method\n     *\/",344],["T_WHITESPACE","\n    ",346],["T_PUBLIC","public",347],["T_WHITESPACE"," ",347],["T_FUNCTION","function",347],["T_WHITESPACE"," ",347],["T_STRING","saveMethodAction",347],"(",")",["T_WHITESPACE","\n    ",347],"{",["T_WHITESPACE","\n        ",348],["T_IF","if",349],["T_WHITESPACE"," ",349],"(",["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_expireAjax",349],"(",")",")",["T_WHITESPACE"," ",349],"{",["T_WHITESPACE","\n            ",349],["T_RETURN","return",350],";",["T_WHITESPACE","\n        ",350],"}",["T_WHITESPACE","\n        ",351],["T_IF","if",352],["T_WHITESPACE"," ",352],"(",["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getRequest",352],"(",")",["T_OBJECT_OPERATOR","->",352],["T_STRING","isPost",352],"(",")",")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$method",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getRequest",353],"(",")",["T_OBJECT_OPERATOR","->",353],["T_STRING","getPost",353],"(",["T_CONSTANT_ENCAPSED_STRING","'method'",353],")",";",["T_WHITESPACE","\n            ",353],["T_VARIABLE","$result",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getOnepage",354],"(",")",["T_OBJECT_OPERATOR","->",354],["T_STRING","saveCheckoutMethod",354],"(",["T_VARIABLE","$method",354],")",";",["T_WHITESPACE","\n            ",354],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","_prepareDataJSON",355],"(",["T_VARIABLE","$result",355],")",";",["T_WHITESPACE","\n        ",355],"}",["T_WHITESPACE","\n    ",356],"}",["T_WHITESPACE","\n\n    ",357],["T_DOC_COMMENT","\/**\n     * Save checkout billing address\n     *\/",359],["T_WHITESPACE","\n    ",361],["T_PUBLIC","public",362],["T_WHITESPACE"," ",362],["T_FUNCTION","function",362],["T_WHITESPACE"," ",362],["T_STRING","saveBillingAction",362],"(",")",["T_WHITESPACE","\n    ",362],"{",["T_WHITESPACE","\n        ",363],["T_IF","if",364],["T_WHITESPACE"," ",364],"(",["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_expireAjax",364],"(",")",")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n            ",364],["T_RETURN","return",365],";",["T_WHITESPACE","\n        ",365],"}",["T_WHITESPACE","\n        ",366],["T_IF","if",367],["T_WHITESPACE"," ",367],"(",["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getRequest",367],"(",")",["T_OBJECT_OPERATOR","->",367],["T_STRING","isPost",367],"(",")",")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n            ",367],["T_VARIABLE","$data",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getRequest",368],"(",")",["T_OBJECT_OPERATOR","->",368],["T_STRING","getPost",368],"(",["T_CONSTANT_ENCAPSED_STRING","'billing'",368],",",["T_WHITESPACE"," ",368],["T_ARRAY","array",368],"(",")",")",";",["T_WHITESPACE","\n            ",368],["T_VARIABLE","$customerAddressId",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getRequest",369],"(",")",["T_OBJECT_OPERATOR","->",369],["T_STRING","getPost",369],"(",["T_CONSTANT_ENCAPSED_STRING","'billing_address_id'",369],",",["T_WHITESPACE"," ",369],["T_STRING","false",369],")",";",["T_WHITESPACE","\n\n            ",369],["T_IF","if",371],["T_WHITESPACE"," ",371],"(",["T_ISSET","isset",371],"(",["T_VARIABLE","$data",371],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",371],"]",")",")",["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n                ",371],["T_VARIABLE","$data",372],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",372],"]",["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_STRING","trim",372],"(",["T_VARIABLE","$data",372],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",372],"]",")",";",["T_WHITESPACE","\n            ",372],"}",["T_WHITESPACE","\n            ",373],["T_VARIABLE","$result",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getOnepage",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","saveBilling",374],"(",["T_VARIABLE","$data",374],",",["T_WHITESPACE"," ",374],["T_VARIABLE","$customerAddressId",374],")",";",["T_WHITESPACE","\n\n            ",374],["T_IF","if",376],["T_WHITESPACE"," ",376],"(","!",["T_ISSET","isset",376],"(",["T_VARIABLE","$result",376],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",376],"]",")",")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n                ",376],["T_IF","if",377],["T_WHITESPACE"," ",377],"(",["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getOnepage",377],"(",")",["T_OBJECT_OPERATOR","->",377],["T_STRING","getQuote",377],"(",")",["T_OBJECT_OPERATOR","->",377],["T_STRING","isVirtual",377],"(",")",")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n                    ",377],["T_VARIABLE","$result",378],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",378],"]",["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_CONSTANT_ENCAPSED_STRING","'payment'",378],";",["T_WHITESPACE","\n                    ",378],["T_VARIABLE","$result",379],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",379],"]",["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_ARRAY","array",379],"(",["T_WHITESPACE","\n                        ",379],["T_CONSTANT_ENCAPSED_STRING","'name'",380],["T_WHITESPACE"," ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_CONSTANT_ENCAPSED_STRING","'payment-method'",380],",",["T_WHITESPACE","\n                        ",380],["T_CONSTANT_ENCAPSED_STRING","'html'",381],["T_WHITESPACE"," ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","_getPaymentMethodsHtml",381],"(",")",["T_WHITESPACE","\n                    ",381],")",";",["T_WHITESPACE","\n                ",382],"}",["T_WHITESPACE"," ",383],["T_ELSEIF","elseif",383],["T_WHITESPACE"," ",383],"(",["T_ISSET","isset",383],"(",["T_VARIABLE","$data",383],"[",["T_CONSTANT_ENCAPSED_STRING","'use_for_shipping'",383],"]",")",["T_WHITESPACE"," ",383],["T_BOOLEAN_AND","&&",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$data",383],"[",["T_CONSTANT_ENCAPSED_STRING","'use_for_shipping'",383],"]",["T_WHITESPACE"," ",383],["T_IS_EQUAL","==",383],["T_WHITESPACE"," ",383],["T_LNUMBER","1",383],")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n                    ",383],["T_VARIABLE","$result",384],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",384],"]",["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",384],";",["T_WHITESPACE","\n                    ",384],["T_VARIABLE","$result",385],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",385],"]",["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_ARRAY","array",385],"(",["T_WHITESPACE","\n                        ",385],["T_CONSTANT_ENCAPSED_STRING","'name'",386],["T_WHITESPACE"," ",386],["T_DOUBLE_ARROW","=>",386],["T_WHITESPACE"," ",386],["T_CONSTANT_ENCAPSED_STRING","'shipping-method'",386],",",["T_WHITESPACE","\n                        ",386],["T_CONSTANT_ENCAPSED_STRING","'html'",387],["T_WHITESPACE"," ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_getShippingMethodsHtml",387],"(",")",["T_WHITESPACE","\n                    ",387],")",";",["T_WHITESPACE","\n\n                    ",388],["T_VARIABLE","$result",390],"[",["T_CONSTANT_ENCAPSED_STRING","'allow_sections'",390],"]",["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_ARRAY","array",390],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",390],")",";",["T_WHITESPACE","\n                    ",390],["T_VARIABLE","$result",391],"[",["T_CONSTANT_ENCAPSED_STRING","'duplicateBillingInfo'",391],"]",["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_CONSTANT_ENCAPSED_STRING","'true'",391],";",["T_WHITESPACE","\n                ",391],"}",["T_WHITESPACE"," ",392],["T_ELSE","else",392],["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n                    ",392],["T_VARIABLE","$result",393],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",393],"]",["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_CONSTANT_ENCAPSED_STRING","'shipping'",393],";",["T_WHITESPACE","\n                ",393],"}",["T_WHITESPACE","\n            ",394],"}",["T_WHITESPACE","\n\n            ",395],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","_prepareDataJSON",397],"(",["T_VARIABLE","$result",397],")",";",["T_WHITESPACE","\n        ",397],"}",["T_WHITESPACE","\n    ",398],"}",["T_WHITESPACE","\n\n    ",399],["T_DOC_COMMENT","\/**\n     * Shipping address save action\n     *\/",401],["T_WHITESPACE","\n    ",403],["T_PUBLIC","public",404],["T_WHITESPACE"," ",404],["T_FUNCTION","function",404],["T_WHITESPACE"," ",404],["T_STRING","saveShippingAction",404],"(",")",["T_WHITESPACE","\n    ",404],"{",["T_WHITESPACE","\n        ",405],["T_IF","if",406],["T_WHITESPACE"," ",406],"(",["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_expireAjax",406],"(",")",")",["T_WHITESPACE"," ",406],"{",["T_WHITESPACE","\n            ",406],["T_RETURN","return",407],";",["T_WHITESPACE","\n        ",407],"}",["T_WHITESPACE","\n        ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(",["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getRequest",409],"(",")",["T_OBJECT_OPERATOR","->",409],["T_STRING","isPost",409],"(",")",")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_VARIABLE","$data",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getRequest",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","getPost",410],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",410],",",["T_WHITESPACE"," ",410],["T_ARRAY","array",410],"(",")",")",";",["T_WHITESPACE","\n            ",410],["T_VARIABLE","$customerAddressId",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getRequest",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","getPost",411],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_address_id'",411],",",["T_WHITESPACE"," ",411],["T_STRING","false",411],")",";",["T_WHITESPACE","\n            ",411],["T_VARIABLE","$result",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getOnepage",412],"(",")",["T_OBJECT_OPERATOR","->",412],["T_STRING","saveShipping",412],"(",["T_VARIABLE","$data",412],",",["T_WHITESPACE"," ",412],["T_VARIABLE","$customerAddressId",412],")",";",["T_WHITESPACE","\n\n            ",412],["T_IF","if",414],["T_WHITESPACE"," ",414],"(","!",["T_ISSET","isset",414],"(",["T_VARIABLE","$result",414],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",414],"]",")",")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n                ",414],["T_VARIABLE","$result",415],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",415],"]",["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",415],";",["T_WHITESPACE","\n                ",415],["T_VARIABLE","$result",416],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",416],"]",["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_ARRAY","array",416],"(",["T_WHITESPACE","\n                    ",416],["T_CONSTANT_ENCAPSED_STRING","'name'",417],["T_WHITESPACE"," ",417],["T_DOUBLE_ARROW","=>",417],["T_WHITESPACE"," ",417],["T_CONSTANT_ENCAPSED_STRING","'shipping-method'",417],",",["T_WHITESPACE","\n                    ",417],["T_CONSTANT_ENCAPSED_STRING","'html'",418],["T_WHITESPACE"," ",418],["T_DOUBLE_ARROW","=>",418],["T_WHITESPACE"," ",418],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","_getShippingMethodsHtml",418],"(",")",["T_WHITESPACE","\n                ",418],")",";",["T_WHITESPACE","\n            ",419],"}",["T_WHITESPACE","\n            ",420],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","_prepareDataJSON",421],"(",["T_VARIABLE","$result",421],")",";",["T_WHITESPACE","\n        ",421],"}",["T_WHITESPACE","\n    ",422],"}",["T_WHITESPACE","\n\n    ",423],["T_DOC_COMMENT","\/**\n     * Shipping method save action\n     *\/",425],["T_WHITESPACE","\n    ",427],["T_PUBLIC","public",428],["T_WHITESPACE"," ",428],["T_FUNCTION","function",428],["T_WHITESPACE"," ",428],["T_STRING","saveShippingMethodAction",428],"(",")",["T_WHITESPACE","\n    ",428],"{",["T_WHITESPACE","\n        ",429],["T_IF","if",430],["T_WHITESPACE"," ",430],"(",["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","_expireAjax",430],"(",")",")",["T_WHITESPACE"," ",430],"{",["T_WHITESPACE","\n            ",430],["T_RETURN","return",431],";",["T_WHITESPACE","\n        ",431],"}",["T_WHITESPACE","\n        ",432],["T_IF","if",433],["T_WHITESPACE"," ",433],"(",["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getRequest",433],"(",")",["T_OBJECT_OPERATOR","->",433],["T_STRING","isPost",433],"(",")",")",["T_WHITESPACE"," ",433],"{",["T_WHITESPACE","\n            ",433],["T_VARIABLE","$data",434],["T_WHITESPACE"," ",434],"=",["T_WHITESPACE"," ",434],["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getRequest",434],"(",")",["T_OBJECT_OPERATOR","->",434],["T_STRING","getPost",434],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",434],",",["T_WHITESPACE"," ",434],["T_CONSTANT_ENCAPSED_STRING","''",434],")",";",["T_WHITESPACE","\n            ",434],["T_VARIABLE","$result",435],["T_WHITESPACE"," ",435],"=",["T_WHITESPACE"," ",435],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getOnepage",435],"(",")",["T_OBJECT_OPERATOR","->",435],["T_STRING","saveShippingMethod",435],"(",["T_VARIABLE","$data",435],")",";",["T_WHITESPACE","\n            ",435],["T_COMMENT","\/\/ $result will contain error data if shipping method is empty\n",436],["T_WHITESPACE","            ",437],["T_IF","if",437],["T_WHITESPACE"," ",437],"(","!",["T_VARIABLE","$result",437],")",["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n                ",437],["T_STRING","Mage",438],["T_DOUBLE_COLON","::",438],["T_STRING","dispatchEvent",438],"(",["T_WHITESPACE","\n                    ",438],["T_CONSTANT_ENCAPSED_STRING","'checkout_controller_onepage_save_shipping_method'",439],",",["T_WHITESPACE","\n                     ",439],["T_ARRAY","array",440],"(",["T_WHITESPACE","\n                          ",440],["T_CONSTANT_ENCAPSED_STRING","'request'",441],["T_WHITESPACE"," ",441],["T_DOUBLE_ARROW","=>",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getRequest",441],"(",")",",",["T_WHITESPACE","\n                          ",441],["T_CONSTANT_ENCAPSED_STRING","'quote'",442],["T_WHITESPACE","   ",442],["T_DOUBLE_ARROW","=>",442],["T_WHITESPACE"," ",442],["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getOnepage",442],"(",")",["T_OBJECT_OPERATOR","->",442],["T_STRING","getQuote",442],"(",")",")",")",";",["T_WHITESPACE","\n                ",442],["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getOnepage",443],"(",")",["T_OBJECT_OPERATOR","->",443],["T_STRING","getQuote",443],"(",")",["T_OBJECT_OPERATOR","->",443],["T_STRING","collectTotals",443],"(",")",";",["T_WHITESPACE","\n                ",443],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","_prepareDataJSON",444],"(",["T_VARIABLE","$result",444],")",";",["T_WHITESPACE","\n\n                ",444],["T_VARIABLE","$result",446],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",446],"]",["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_CONSTANT_ENCAPSED_STRING","'payment'",446],";",["T_WHITESPACE","\n                ",446],["T_VARIABLE","$result",447],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",447],"]",["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_ARRAY","array",447],"(",["T_WHITESPACE","\n                    ",447],["T_CONSTANT_ENCAPSED_STRING","'name'",448],["T_WHITESPACE"," ",448],["T_DOUBLE_ARROW","=>",448],["T_WHITESPACE"," ",448],["T_CONSTANT_ENCAPSED_STRING","'payment-method'",448],",",["T_WHITESPACE","\n                    ",448],["T_CONSTANT_ENCAPSED_STRING","'html'",449],["T_WHITESPACE"," ",449],["T_DOUBLE_ARROW","=>",449],["T_WHITESPACE"," ",449],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_getPaymentMethodsHtml",449],"(",")",["T_WHITESPACE","\n                ",449],")",";",["T_WHITESPACE","\n            ",450],"}",["T_WHITESPACE","\n            ",451],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getOnepage",452],"(",")",["T_OBJECT_OPERATOR","->",452],["T_STRING","getQuote",452],"(",")",["T_OBJECT_OPERATOR","->",452],["T_STRING","collectTotals",452],"(",")",["T_OBJECT_OPERATOR","->",452],["T_STRING","save",452],"(",")",";",["T_WHITESPACE","\n            ",452],["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","_prepareDataJSON",453],"(",["T_VARIABLE","$result",453],")",";",["T_WHITESPACE","\n        ",453],"}",["T_WHITESPACE","\n    ",454],"}",["T_WHITESPACE","\n\n    ",455],["T_DOC_COMMENT","\/**\n     * Save payment ajax action\n     *\n     * Sets either redirect or a JSON response\n     *\/",457],["T_WHITESPACE","\n    ",461],["T_PUBLIC","public",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","savePaymentAction",462],"(",")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_IF","if",464],["T_WHITESPACE"," ",464],"(",["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_expireAjax",464],"(",")",")",["T_WHITESPACE"," ",464],"{",["T_WHITESPACE","\n            ",464],["T_RETURN","return",465],";",["T_WHITESPACE","\n        ",465],"}",["T_WHITESPACE","\n        ",466],["T_TRY","try",467],["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n            ",467],["T_IF","if",468],["T_WHITESPACE"," ",468],"(","!",["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getRequest",468],"(",")",["T_OBJECT_OPERATOR","->",468],["T_STRING","isPost",468],"(",")",")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n                ",468],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_ajaxRedirectResponse",469],"(",")",";",["T_WHITESPACE","\n                ",469],["T_RETURN","return",470],";",["T_WHITESPACE","\n            ",470],"}",["T_WHITESPACE","\n\n            ",471],["T_VARIABLE","$data",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getRequest",473],"(",")",["T_OBJECT_OPERATOR","->",473],["T_STRING","getPost",473],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",473],",",["T_WHITESPACE"," ",473],["T_ARRAY","array",473],"(",")",")",";",["T_WHITESPACE","\n            ",473],["T_VARIABLE","$result",474],["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getOnepage",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","savePayment",474],"(",["T_VARIABLE","$data",474],")",";",["T_WHITESPACE","\n\n            ",474],["T_COMMENT","\/\/ get section and redirect data\n",476],["T_WHITESPACE","            ",477],["T_VARIABLE","$redirectUrl",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getOnepage",477],"(",")",["T_OBJECT_OPERATOR","->",477],["T_STRING","getQuote",477],"(",")",["T_OBJECT_OPERATOR","->",477],["T_STRING","getPayment",477],"(",")",["T_OBJECT_OPERATOR","->",477],["T_STRING","getCheckoutRedirectUrl",477],"(",")",";",["T_WHITESPACE","\n            ",477],["T_IF","if",478],["T_WHITESPACE"," ",478],"(",["T_EMPTY","empty",478],"(",["T_VARIABLE","$result",478],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",478],"]",")",["T_WHITESPACE"," ",478],["T_BOOLEAN_AND","&&",478],["T_WHITESPACE"," ",478],"!",["T_VARIABLE","$redirectUrl",478],")",["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n                ",478],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","loadLayout",479],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_review'",479],")",";",["T_WHITESPACE","\n                ",479],["T_VARIABLE","$result",480],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",480],"]",["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_CONSTANT_ENCAPSED_STRING","'review'",480],";",["T_WHITESPACE","\n                ",480],["T_VARIABLE","$result",481],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",481],"]",["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_ARRAY","array",481],"(",["T_WHITESPACE","\n                    ",481],["T_CONSTANT_ENCAPSED_STRING","'name'",482],["T_WHITESPACE"," ",482],["T_DOUBLE_ARROW","=>",482],["T_WHITESPACE"," ",482],["T_CONSTANT_ENCAPSED_STRING","'review'",482],",",["T_WHITESPACE","\n                    ",482],["T_CONSTANT_ENCAPSED_STRING","'html'",483],["T_WHITESPACE"," ",483],["T_DOUBLE_ARROW","=>",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","_getReviewHtml",483],"(",")",["T_WHITESPACE","\n                ",483],")",";",["T_WHITESPACE","\n            ",484],"}",["T_WHITESPACE","\n            ",485],["T_IF","if",486],["T_WHITESPACE"," ",486],"(",["T_VARIABLE","$redirectUrl",486],")",["T_WHITESPACE"," ",486],"{",["T_WHITESPACE","\n                ",486],["T_VARIABLE","$result",487],"[",["T_CONSTANT_ENCAPSED_STRING","'redirect'",487],"]",["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_VARIABLE","$redirectUrl",487],";",["T_WHITESPACE","\n            ",487],"}",["T_WHITESPACE","\n        ",488],"}",["T_WHITESPACE"," ",489],["T_CATCH","catch",489],["T_WHITESPACE"," ",489],"(",["T_STRING","Mage_Payment_Exception",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$e",489],")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n            ",489],["T_IF","if",490],["T_WHITESPACE"," ",490],"(",["T_VARIABLE","$e",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","getFields",490],"(",")",")",["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n                ",490],["T_VARIABLE","$result",491],"[",["T_CONSTANT_ENCAPSED_STRING","'fields'",491],"]",["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_VARIABLE","$e",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getFields",491],"(",")",";",["T_WHITESPACE","\n            ",491],"}",["T_WHITESPACE","\n            ",492],["T_VARIABLE","$result",493],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",493],"]",["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_VARIABLE","$e",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getMessage",493],"(",")",";",["T_WHITESPACE","\n        ",493],"}",["T_WHITESPACE"," ",494],["T_CATCH","catch",494],["T_WHITESPACE"," ",494],"(",["T_STRING","Mage_Core_Exception",494],["T_WHITESPACE"," ",494],["T_VARIABLE","$e",494],")",["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n            ",494],["T_VARIABLE","$result",495],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",495],"]",["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_VARIABLE","$e",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getMessage",495],"(",")",";",["T_WHITESPACE","\n        ",495],"}",["T_WHITESPACE"," ",496],["T_CATCH","catch",496],["T_WHITESPACE"," ",496],"(",["T_STRING","Exception",496],["T_WHITESPACE"," ",496],["T_VARIABLE","$e",496],")",["T_WHITESPACE"," ",496],"{",["T_WHITESPACE","\n            ",496],["T_STRING","Mage",497],["T_DOUBLE_COLON","::",497],["T_STRING","logException",497],"(",["T_VARIABLE","$e",497],")",";",["T_WHITESPACE","\n            ",497],["T_VARIABLE","$result",498],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",498],"]",["T_WHITESPACE"," ",498],"=",["T_WHITESPACE"," ",498],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","__",498],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to set Payment Method.'",498],")",";",["T_WHITESPACE","\n        ",498],"}",["T_WHITESPACE","\n        ",499],["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","_prepareDataJSON",500],"(",["T_VARIABLE","$result",500],")",";",["T_WHITESPACE","\n    ",500],"}",["T_WHITESPACE","\n\n    ",501],["T_DOC_COMMENT","\/**\n     * Get Order by quoteId\n     *\n     * @throws Mage_Payment_Model_Info_Exception\n     * @return Mage_Sales_Model_Order\n     *\/",503],["T_WHITESPACE","\n    ",508],["T_PROTECTED","protected",509],["T_WHITESPACE"," ",509],["T_FUNCTION","function",509],["T_WHITESPACE"," ",509],["T_STRING","_getOrder",509],"(",")",["T_WHITESPACE","\n    ",509],"{",["T_WHITESPACE","\n        ",510],["T_IF","if",511],["T_WHITESPACE"," ",511],"(",["T_STRING","is_null",511],"(",["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","_order",511],")",")",["T_WHITESPACE"," ",511],"{",["T_WHITESPACE","\n            ",511],["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","_order",512],["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],["T_STRING","Mage",512],["T_DOUBLE_COLON","::",512],["T_STRING","getModel",512],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",512],")",["T_OBJECT_OPERATOR","->",512],["T_STRING","load",512],"(",["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getOnepage",512],"(",")",["T_OBJECT_OPERATOR","->",512],["T_STRING","getQuote",512],"(",")",["T_OBJECT_OPERATOR","->",512],["T_STRING","getId",512],"(",")",",",["T_WHITESPACE"," ",512],["T_CONSTANT_ENCAPSED_STRING","'quote_id'",512],")",";",["T_WHITESPACE","\n            ",512],["T_IF","if",513],["T_WHITESPACE"," ",513],"(","!",["T_VARIABLE","$this",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","_order",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getId",513],"(",")",")",["T_WHITESPACE"," ",513],"{",["T_WHITESPACE","\n                ",513],["T_THROW","throw",514],["T_WHITESPACE"," ",514],["T_NEW","new",514],["T_WHITESPACE"," ",514],["T_STRING","Mage_Payment_Model_Info_Exception",514],"(",["T_STRING","Mage",514],["T_DOUBLE_COLON","::",514],["T_STRING","helper",514],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",514],")",["T_OBJECT_OPERATOR","->",514],["T_STRING","__",514],"(",["T_CONSTANT_ENCAPSED_STRING","\"Can not create invoice. Order was not found.\"",514],")",")",";",["T_WHITESPACE","\n            ",514],"}",["T_WHITESPACE","\n        ",515],"}",["T_WHITESPACE","\n        ",516],["T_RETURN","return",517],["T_WHITESPACE"," ",517],["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","_order",517],";",["T_WHITESPACE","\n    ",517],"}",["T_WHITESPACE","\n\n    ",518],["T_DOC_COMMENT","\/**\n     * Create invoice\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",520],["T_WHITESPACE","\n    ",524],["T_PROTECTED","protected",525],["T_WHITESPACE"," ",525],["T_FUNCTION","function",525],["T_WHITESPACE"," ",525],["T_STRING","_initInvoice",525],"(",")",["T_WHITESPACE","\n    ",525],"{",["T_WHITESPACE","\n        ",526],["T_VARIABLE","$items",527],["T_WHITESPACE"," ",527],"=",["T_WHITESPACE"," ",527],["T_ARRAY","array",527],"(",")",";",["T_WHITESPACE","\n        ",527],["T_FOREACH","foreach",528],["T_WHITESPACE"," ",528],"(",["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","_getOrder",528],"(",")",["T_OBJECT_OPERATOR","->",528],["T_STRING","getAllItems",528],"(",")",["T_WHITESPACE"," ",528],["T_AS","as",528],["T_WHITESPACE"," ",528],["T_VARIABLE","$item",528],")",["T_WHITESPACE"," ",528],"{",["T_WHITESPACE","\n            ",528],["T_VARIABLE","$items",529],"[",["T_VARIABLE","$item",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getId",529],"(",")","]",["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$item",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getQtyOrdered",529],"(",")",";",["T_WHITESPACE","\n        ",529],"}",["T_WHITESPACE","\n        ",530],["T_COMMENT","\/* @var $invoice Mage_Sales_Model_Service_Order *\/",531],["T_WHITESPACE","\n        ",531],["T_VARIABLE","$invoice",532],["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],["T_STRING","Mage",532],["T_DOUBLE_COLON","::",532],["T_STRING","getModel",532],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_order'",532],",",["T_WHITESPACE"," ",532],["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","_getOrder",532],"(",")",")",["T_OBJECT_OPERATOR","->",532],["T_STRING","prepareInvoice",532],"(",["T_VARIABLE","$items",532],")",";",["T_WHITESPACE","\n        ",532],["T_VARIABLE","$invoice",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","setEmailSent",533],"(",["T_STRING","true",533],")",["T_OBJECT_OPERATOR","->",533],["T_STRING","register",533],"(",")",";",["T_WHITESPACE","\n\n        ",533],["T_STRING","Mage",535],["T_DOUBLE_COLON","::",535],["T_STRING","register",535],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",535],",",["T_WHITESPACE"," ",535],["T_VARIABLE","$invoice",535],")",";",["T_WHITESPACE","\n        ",535],["T_RETURN","return",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$invoice",536],";",["T_WHITESPACE","\n    ",536],"}",["T_WHITESPACE","\n\n    ",537],["T_DOC_COMMENT","\/**\n     * Create order action\n     *\/",539],["T_WHITESPACE","\n    ",541],["T_PUBLIC","public",542],["T_WHITESPACE"," ",542],["T_FUNCTION","function",542],["T_WHITESPACE"," ",542],["T_STRING","saveOrderAction",542],"(",")",["T_WHITESPACE","\n    ",542],"{",["T_WHITESPACE","\n        ",543],["T_IF","if",544],["T_WHITESPACE"," ",544],"(","!",["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","_validateFormKey",544],"(",")",")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n            ",544],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","_redirect",545],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",545],")",";",["T_WHITESPACE","\n            ",545],["T_RETURN","return",546],";",["T_WHITESPACE","\n        ",546],"}",["T_WHITESPACE","\n\n        ",547],["T_IF","if",549],["T_WHITESPACE"," ",549],"(",["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","_expireAjax",549],"(",")",")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_RETURN","return",550],";",["T_WHITESPACE","\n        ",550],"}",["T_WHITESPACE","\n\n        ",551],["T_VARIABLE","$result",553],["T_WHITESPACE"," ",553],"=",["T_WHITESPACE"," ",553],["T_ARRAY","array",553],"(",")",";",["T_WHITESPACE","\n        ",553],["T_TRY","try",554],["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n            ",554],["T_VARIABLE","$requiredAgreements",555],["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],["T_STRING","Mage",555],["T_DOUBLE_COLON","::",555],["T_STRING","helper",555],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",555],")",["T_OBJECT_OPERATOR","->",555],["T_STRING","getRequiredAgreementIds",555],"(",")",";",["T_WHITESPACE","\n            ",555],["T_IF","if",556],["T_WHITESPACE"," ",556],"(",["T_VARIABLE","$requiredAgreements",556],")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n                ",556],["T_VARIABLE","$postedAgreements",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_STRING","array_keys",557],"(",["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getRequest",557],"(",")",["T_OBJECT_OPERATOR","->",557],["T_STRING","getPost",557],"(",["T_CONSTANT_ENCAPSED_STRING","'agreement'",557],",",["T_WHITESPACE"," ",557],["T_ARRAY","array",557],"(",")",")",")",";",["T_WHITESPACE","\n                ",557],["T_VARIABLE","$diff",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_STRING","array_diff",558],"(",["T_VARIABLE","$requiredAgreements",558],",",["T_WHITESPACE"," ",558],["T_VARIABLE","$postedAgreements",558],")",";",["T_WHITESPACE","\n                ",558],["T_IF","if",559],["T_WHITESPACE"," ",559],"(",["T_VARIABLE","$diff",559],")",["T_WHITESPACE"," ",559],"{",["T_WHITESPACE","\n                    ",559],["T_VARIABLE","$result",560],"[",["T_CONSTANT_ENCAPSED_STRING","'success'",560],"]",["T_WHITESPACE"," ",560],"=",["T_WHITESPACE"," ",560],["T_STRING","false",560],";",["T_WHITESPACE","\n                    ",560],["T_VARIABLE","$result",561],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",561],"]",["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_STRING","true",561],";",["T_WHITESPACE","\n                    ",561],["T_VARIABLE","$result",562],"[",["T_CONSTANT_ENCAPSED_STRING","'error_messages'",562],"]",["T_WHITESPACE"," ",562],"=",["T_WHITESPACE"," ",562],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","__",562],"(",["T_CONSTANT_ENCAPSED_STRING","'Please agree to all the terms and conditions before placing the order.'",562],")",";",["T_WHITESPACE","\n                    ",562],["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","_prepareDataJSON",563],"(",["T_VARIABLE","$result",563],")",";",["T_WHITESPACE","\n                    ",563],["T_RETURN","return",564],";",["T_WHITESPACE","\n                ",564],"}",["T_WHITESPACE","\n            ",565],"}",["T_WHITESPACE","\n\n            ",566],["T_VARIABLE","$data",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getRequest",568],"(",")",["T_OBJECT_OPERATOR","->",568],["T_STRING","getPost",568],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",568],",",["T_WHITESPACE"," ",568],["T_ARRAY","array",568],"(",")",")",";",["T_WHITESPACE","\n            ",568],["T_IF","if",569],["T_WHITESPACE"," ",569],"(",["T_VARIABLE","$data",569],")",["T_WHITESPACE"," ",569],"{",["T_WHITESPACE","\n                ",569],["T_VARIABLE","$data",570],"[",["T_CONSTANT_ENCAPSED_STRING","'checks'",570],"]",["T_WHITESPACE"," ",570],"=",["T_WHITESPACE"," ",570],["T_STRING","Mage_Payment_Model_Method_Abstract",570],["T_DOUBLE_COLON","::",570],["T_STRING","CHECK_USE_CHECKOUT",570],["T_WHITESPACE","\n                    ",570],"|",["T_WHITESPACE"," ",571],["T_STRING","Mage_Payment_Model_Method_Abstract",571],["T_DOUBLE_COLON","::",571],["T_STRING","CHECK_USE_FOR_COUNTRY",571],["T_WHITESPACE","\n                    ",571],"|",["T_WHITESPACE"," ",572],["T_STRING","Mage_Payment_Model_Method_Abstract",572],["T_DOUBLE_COLON","::",572],["T_STRING","CHECK_USE_FOR_CURRENCY",572],["T_WHITESPACE","\n                    ",572],"|",["T_WHITESPACE"," ",573],["T_STRING","Mage_Payment_Model_Method_Abstract",573],["T_DOUBLE_COLON","::",573],["T_STRING","CHECK_ORDER_TOTAL_MIN_MAX",573],["T_WHITESPACE","\n                    ",573],"|",["T_WHITESPACE"," ",574],["T_STRING","Mage_Payment_Model_Method_Abstract",574],["T_DOUBLE_COLON","::",574],["T_STRING","CHECK_ZERO_TOTAL",574],";",["T_WHITESPACE","\n                ",574],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","getOnepage",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","getQuote",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","getPayment",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","importData",575],"(",["T_VARIABLE","$data",575],")",";",["T_WHITESPACE","\n            ",575],"}",["T_WHITESPACE","\n\n            ",576],["T_VARIABLE","$this",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getOnepage",578],"(",")",["T_OBJECT_OPERATOR","->",578],["T_STRING","saveOrder",578],"(",")",";",["T_WHITESPACE","\n\n            ",578],["T_VARIABLE","$redirectUrl",580],["T_WHITESPACE"," ",580],"=",["T_WHITESPACE"," ",580],["T_VARIABLE","$this",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getOnepage",580],"(",")",["T_OBJECT_OPERATOR","->",580],["T_STRING","getCheckout",580],"(",")",["T_OBJECT_OPERATOR","->",580],["T_STRING","getRedirectUrl",580],"(",")",";",["T_WHITESPACE","\n            ",580],["T_VARIABLE","$result",581],"[",["T_CONSTANT_ENCAPSED_STRING","'success'",581],"]",["T_WHITESPACE"," ",581],"=",["T_WHITESPACE"," ",581],["T_STRING","true",581],";",["T_WHITESPACE","\n            ",581],["T_VARIABLE","$result",582],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",582],"]",["T_WHITESPACE","   ",582],"=",["T_WHITESPACE"," ",582],["T_STRING","false",582],";",["T_WHITESPACE","\n        ",582],"}",["T_WHITESPACE"," ",583],["T_CATCH","catch",583],["T_WHITESPACE"," ",583],"(",["T_STRING","Mage_Payment_Model_Info_Exception",583],["T_WHITESPACE"," ",583],["T_VARIABLE","$e",583],")",["T_WHITESPACE"," ",583],"{",["T_WHITESPACE","\n            ",583],["T_VARIABLE","$message",584],["T_WHITESPACE"," ",584],"=",["T_WHITESPACE"," ",584],["T_VARIABLE","$e",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","getMessage",584],"(",")",";",["T_WHITESPACE","\n            ",584],["T_IF","if",585],["T_WHITESPACE"," ",585],"(","!",["T_EMPTY","empty",585],"(",["T_VARIABLE","$message",585],")",")",["T_WHITESPACE"," ",585],"{",["T_WHITESPACE","\n                ",585],["T_VARIABLE","$result",586],"[",["T_CONSTANT_ENCAPSED_STRING","'error_messages'",586],"]",["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_VARIABLE","$message",586],";",["T_WHITESPACE","\n            ",586],"}",["T_WHITESPACE","\n            ",587],["T_VARIABLE","$result",588],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",588],"]",["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_CONSTANT_ENCAPSED_STRING","'payment'",588],";",["T_WHITESPACE","\n            ",588],["T_VARIABLE","$result",589],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",589],"]",["T_WHITESPACE"," ",589],"=",["T_WHITESPACE"," ",589],["T_ARRAY","array",589],"(",["T_WHITESPACE","\n                ",589],["T_CONSTANT_ENCAPSED_STRING","'name'",590],["T_WHITESPACE"," ",590],["T_DOUBLE_ARROW","=>",590],["T_WHITESPACE"," ",590],["T_CONSTANT_ENCAPSED_STRING","'payment-method'",590],",",["T_WHITESPACE","\n                ",590],["T_CONSTANT_ENCAPSED_STRING","'html'",591],["T_WHITESPACE"," ",591],["T_DOUBLE_ARROW","=>",591],["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_getPaymentMethodsHtml",591],"(",")",["T_WHITESPACE","\n            ",591],")",";",["T_WHITESPACE","\n        ",592],"}",["T_WHITESPACE"," ",593],["T_CATCH","catch",593],["T_WHITESPACE"," ",593],"(",["T_STRING","Mage_Core_Exception",593],["T_WHITESPACE"," ",593],["T_VARIABLE","$e",593],")",["T_WHITESPACE"," ",593],"{",["T_WHITESPACE","\n            ",593],["T_STRING","Mage",594],["T_DOUBLE_COLON","::",594],["T_STRING","logException",594],"(",["T_VARIABLE","$e",594],")",";",["T_WHITESPACE","\n            ",594],["T_STRING","Mage",595],["T_DOUBLE_COLON","::",595],["T_STRING","helper",595],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",595],")",["T_OBJECT_OPERATOR","->",595],["T_STRING","sendPaymentFailedEmail",595],"(",["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","getOnepage",595],"(",")",["T_OBJECT_OPERATOR","->",595],["T_STRING","getQuote",595],"(",")",",",["T_WHITESPACE"," ",595],["T_VARIABLE","$e",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","getMessage",595],"(",")",")",";",["T_WHITESPACE","\n            ",595],["T_VARIABLE","$result",596],"[",["T_CONSTANT_ENCAPSED_STRING","'success'",596],"]",["T_WHITESPACE"," ",596],"=",["T_WHITESPACE"," ",596],["T_STRING","false",596],";",["T_WHITESPACE","\n            ",596],["T_VARIABLE","$result",597],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",597],"]",["T_WHITESPACE"," ",597],"=",["T_WHITESPACE"," ",597],["T_STRING","true",597],";",["T_WHITESPACE","\n            ",597],["T_VARIABLE","$result",598],"[",["T_CONSTANT_ENCAPSED_STRING","'error_messages'",598],"]",["T_WHITESPACE"," ",598],"=",["T_WHITESPACE"," ",598],["T_VARIABLE","$e",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getMessage",598],"(",")",";",["T_WHITESPACE","\n\n            ",598],["T_VARIABLE","$gotoSection",600],["T_WHITESPACE"," ",600],"=",["T_WHITESPACE"," ",600],["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","getOnepage",600],"(",")",["T_OBJECT_OPERATOR","->",600],["T_STRING","getCheckout",600],"(",")",["T_OBJECT_OPERATOR","->",600],["T_STRING","getGotoSection",600],"(",")",";",["T_WHITESPACE","\n            ",600],["T_IF","if",601],["T_WHITESPACE"," ",601],"(",["T_VARIABLE","$gotoSection",601],")",["T_WHITESPACE"," ",601],"{",["T_WHITESPACE","\n                ",601],["T_VARIABLE","$result",602],"[",["T_CONSTANT_ENCAPSED_STRING","'goto_section'",602],"]",["T_WHITESPACE"," ",602],"=",["T_WHITESPACE"," ",602],["T_VARIABLE","$gotoSection",602],";",["T_WHITESPACE","\n                ",602],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","getOnepage",603],"(",")",["T_OBJECT_OPERATOR","->",603],["T_STRING","getCheckout",603],"(",")",["T_OBJECT_OPERATOR","->",603],["T_STRING","setGotoSection",603],"(",["T_STRING","null",603],")",";",["T_WHITESPACE","\n            ",603],"}",["T_WHITESPACE","\n            ",604],["T_VARIABLE","$updateSection",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","getOnepage",605],"(",")",["T_OBJECT_OPERATOR","->",605],["T_STRING","getCheckout",605],"(",")",["T_OBJECT_OPERATOR","->",605],["T_STRING","getUpdateSection",605],"(",")",";",["T_WHITESPACE","\n            ",605],["T_IF","if",606],["T_WHITESPACE"," ",606],"(",["T_VARIABLE","$updateSection",606],")",["T_WHITESPACE"," ",606],"{",["T_WHITESPACE","\n                ",606],["T_IF","if",607],["T_WHITESPACE"," ",607],"(",["T_ISSET","isset",607],"(",["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","_sectionUpdateFunctions",607],"[",["T_VARIABLE","$updateSection",607],"]",")",")",["T_WHITESPACE"," ",607],"{",["T_WHITESPACE","\n                    ",607],["T_VARIABLE","$updateSectionFunction",608],["T_WHITESPACE"," ",608],"=",["T_WHITESPACE"," ",608],["T_VARIABLE","$this",608],["T_OBJECT_OPERATOR","->",608],["T_STRING","_sectionUpdateFunctions",608],"[",["T_VARIABLE","$updateSection",608],"]",";",["T_WHITESPACE","\n                    ",608],["T_VARIABLE","$result",609],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",609],"]",["T_WHITESPACE"," ",609],"=",["T_WHITESPACE"," ",609],["T_ARRAY","array",609],"(",["T_WHITESPACE","\n                        ",609],["T_CONSTANT_ENCAPSED_STRING","'name'",610],["T_WHITESPACE"," ",610],["T_DOUBLE_ARROW","=>",610],["T_WHITESPACE"," ",610],["T_VARIABLE","$updateSection",610],",",["T_WHITESPACE","\n                        ",610],["T_CONSTANT_ENCAPSED_STRING","'html'",611],["T_WHITESPACE"," ",611],["T_DOUBLE_ARROW","=>",611],["T_WHITESPACE"," ",611],["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_VARIABLE","$updateSectionFunction",611],"(",")",["T_WHITESPACE","\n                    ",611],")",";",["T_WHITESPACE","\n                ",612],"}",["T_WHITESPACE","\n                ",613],["T_VARIABLE","$this",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","getOnepage",614],"(",")",["T_OBJECT_OPERATOR","->",614],["T_STRING","getCheckout",614],"(",")",["T_OBJECT_OPERATOR","->",614],["T_STRING","setUpdateSection",614],"(",["T_STRING","null",614],")",";",["T_WHITESPACE","\n            ",614],"}",["T_WHITESPACE","\n        ",615],"}",["T_WHITESPACE"," ",616],["T_CATCH","catch",616],["T_WHITESPACE"," ",616],"(",["T_STRING","Exception",616],["T_WHITESPACE"," ",616],["T_VARIABLE","$e",616],")",["T_WHITESPACE"," ",616],"{",["T_WHITESPACE","\n            ",616],["T_STRING","Mage",617],["T_DOUBLE_COLON","::",617],["T_STRING","logException",617],"(",["T_VARIABLE","$e",617],")",";",["T_WHITESPACE","\n            ",617],["T_STRING","Mage",618],["T_DOUBLE_COLON","::",618],["T_STRING","helper",618],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",618],")",["T_OBJECT_OPERATOR","->",618],["T_STRING","sendPaymentFailedEmail",618],"(",["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getOnepage",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","getQuote",618],"(",")",",",["T_WHITESPACE"," ",618],["T_VARIABLE","$e",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getMessage",618],"(",")",")",";",["T_WHITESPACE","\n            ",618],["T_VARIABLE","$result",619],"[",["T_CONSTANT_ENCAPSED_STRING","'success'",619],"]",["T_WHITESPACE","  ",619],"=",["T_WHITESPACE"," ",619],["T_STRING","false",619],";",["T_WHITESPACE","\n            ",619],["T_VARIABLE","$result",620],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",620],"]",["T_WHITESPACE","    ",620],"=",["T_WHITESPACE"," ",620],["T_STRING","true",620],";",["T_WHITESPACE","\n            ",620],["T_VARIABLE","$result",621],"[",["T_CONSTANT_ENCAPSED_STRING","'error_messages'",621],"]",["T_WHITESPACE"," ",621],"=",["T_WHITESPACE"," ",621],["T_VARIABLE","$this",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","__",621],"(",["T_CONSTANT_ENCAPSED_STRING","'There was an error processing your order. Please contact us or try again later.'",621],")",";",["T_WHITESPACE","\n        ",621],"}",["T_WHITESPACE","\n        ",622],["T_VARIABLE","$this",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","getOnepage",623],"(",")",["T_OBJECT_OPERATOR","->",623],["T_STRING","getQuote",623],"(",")",["T_OBJECT_OPERATOR","->",623],["T_STRING","save",623],"(",")",";",["T_WHITESPACE","\n        ",623],["T_DOC_COMMENT","\/**\n         * when there is redirect to third party, we don't want to save order yet.\n         * we will save the order in return action.\n         *\/",624],["T_WHITESPACE","\n        ",627],["T_IF","if",628],["T_WHITESPACE"," ",628],"(",["T_ISSET","isset",628],"(",["T_VARIABLE","$redirectUrl",628],")",")",["T_WHITESPACE"," ",628],"{",["T_WHITESPACE","\n            ",628],["T_VARIABLE","$result",629],"[",["T_CONSTANT_ENCAPSED_STRING","'redirect'",629],"]",["T_WHITESPACE"," ",629],"=",["T_WHITESPACE"," ",629],["T_VARIABLE","$redirectUrl",629],";",["T_WHITESPACE","\n        ",629],"}",["T_WHITESPACE","\n\n        ",630],["T_VARIABLE","$this",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","_prepareDataJSON",632],"(",["T_VARIABLE","$result",632],")",";",["T_WHITESPACE","\n    ",632],"}",["T_WHITESPACE","\n\n    ",633],["T_DOC_COMMENT","\/**\n     * Filtering posted data. Converting localized data if needed\n     *\n     * @param array\n     * @return array\n     *\/",635],["T_WHITESPACE","\n    ",640],["T_PROTECTED","protected",641],["T_WHITESPACE"," ",641],["T_FUNCTION","function",641],["T_WHITESPACE"," ",641],["T_STRING","_filterPostData",641],"(",["T_VARIABLE","$data",641],")",["T_WHITESPACE","\n    ",641],"{",["T_WHITESPACE","\n        ",642],["T_VARIABLE","$data",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","_filterDates",643],"(",["T_VARIABLE","$data",643],",",["T_WHITESPACE"," ",643],["T_ARRAY","array",643],"(",["T_CONSTANT_ENCAPSED_STRING","'dob'",643],")",")",";",["T_WHITESPACE","\n        ",643],["T_RETURN","return",644],["T_WHITESPACE"," ",644],["T_VARIABLE","$data",644],";",["T_WHITESPACE","\n    ",644],"}",["T_WHITESPACE","\n\n    ",645],["T_DOC_COMMENT","\/**\n     * Check can page show for unregistered users\n     *\n     * @return boolean\n     *\/",647],["T_WHITESPACE","\n    ",651],["T_PROTECTED","protected",652],["T_WHITESPACE"," ",652],["T_FUNCTION","function",652],["T_WHITESPACE"," ",652],["T_STRING","_canShowForUnregisteredUsers",652],"(",")",["T_WHITESPACE","\n    ",652],"{",["T_WHITESPACE","\n        ",653],["T_RETURN","return",654],["T_WHITESPACE"," ",654],["T_STRING","Mage",654],["T_DOUBLE_COLON","::",654],["T_STRING","getSingleton",654],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",654],")",["T_OBJECT_OPERATOR","->",654],["T_STRING","isLoggedIn",654],"(",")",["T_WHITESPACE","\n            ",654],["T_BOOLEAN_OR","||",655],["T_WHITESPACE"," ",655],["T_VARIABLE","$this",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","getRequest",655],"(",")",["T_OBJECT_OPERATOR","->",655],["T_STRING","getActionName",655],"(",")",["T_WHITESPACE"," ",655],["T_IS_EQUAL","==",655],["T_WHITESPACE"," ",655],["T_CONSTANT_ENCAPSED_STRING","'index'",655],["T_WHITESPACE","\n            ",655],["T_BOOLEAN_OR","||",656],["T_WHITESPACE"," ",656],["T_STRING","Mage",656],["T_DOUBLE_COLON","::",656],["T_STRING","helper",656],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",656],")",["T_OBJECT_OPERATOR","->",656],["T_STRING","isAllowedGuestCheckout",656],"(",["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getOnepage",656],"(",")",["T_OBJECT_OPERATOR","->",656],["T_STRING","getQuote",656],"(",")",")",["T_WHITESPACE","\n            ",656],["T_BOOLEAN_OR","||",657],["T_WHITESPACE"," ",657],"!",["T_STRING","Mage",657],["T_DOUBLE_COLON","::",657],["T_STRING","helper",657],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",657],")",["T_OBJECT_OPERATOR","->",657],["T_STRING","isCustomerMustBeLogged",657],"(",")",";",["T_WHITESPACE","\n    ",657],"}",["T_WHITESPACE","\n\n    ",658],["T_DOC_COMMENT","\/**\n     * Prepare JSON formatted data for response to client\n     *\n     * @param $response\n     * @return Zend_Controller_Response_Abstract\n     *\/",660],["T_WHITESPACE","\n    ",665],["T_PROTECTED","protected",666],["T_WHITESPACE"," ",666],["T_FUNCTION","function",666],["T_WHITESPACE"," ",666],["T_STRING","_prepareDataJSON",666],"(",["T_VARIABLE","$response",666],")",["T_WHITESPACE","\n    ",666],"{",["T_WHITESPACE","\n        ",667],["T_VARIABLE","$this",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","getResponse",668],"(",")",["T_OBJECT_OPERATOR","->",668],["T_STRING","setHeader",668],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-type'",668],",",["T_WHITESPACE"," ",668],["T_CONSTANT_ENCAPSED_STRING","'application\/json'",668],",",["T_WHITESPACE"," ",668],["T_STRING","true",668],")",";",["T_WHITESPACE","\n        ",668],["T_RETURN","return",669],["T_WHITESPACE"," ",669],["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getResponse",669],"(",")",["T_OBJECT_OPERATOR","->",669],["T_STRING","setBody",669],"(",["T_STRING","Mage",669],["T_DOUBLE_COLON","::",669],["T_STRING","helper",669],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",669],")",["T_OBJECT_OPERATOR","->",669],["T_STRING","jsonEncode",669],"(",["T_VARIABLE","$response",669],")",")",";",["T_WHITESPACE","\n    ",669],"}",["T_WHITESPACE","\n\n",670],"}",["T_WHITESPACE","\n",672]]