[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Shopping cart model\n *\n * @category    Mage\n * @package     Mage_Checkout\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_Model_Cart",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Varien_Object",34],["T_WHITESPACE"," ",34],["T_IMPLEMENTS","implements",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Checkout_Model_Cart_Interface",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Shopping cart items summary quantity(s)\n     *\n     * @var int|null\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_summaryQty",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * List of product ids in shopping cart\n     *\n     * @var array|null\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_productIds",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Get shopping cart resource model\n     *\n     * @return Mage_Checkout_Model_Resource_Cart\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","_getResource",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_RETURN","return",57],["T_WHITESPACE"," ",57],["T_STRING","Mage",57],["T_DOUBLE_COLON","::",57],["T_STRING","getResourceSingleton",57],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",57],")",";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Retrieve checkout session model\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",60],["T_WHITESPACE","\n    ",64],["T_PUBLIC","public",65],["T_WHITESPACE"," ",65],["T_FUNCTION","function",65],["T_WHITESPACE"," ",65],["T_STRING","getCheckoutSession",65],"(",")",["T_WHITESPACE","\n    ",65],"{",["T_WHITESPACE","\n        ",66],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_STRING","Mage",67],["T_DOUBLE_COLON","::",67],["T_STRING","getSingleton",67],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",67],")",";",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Retrieve customer session model\n     *\n     * @return Mage_Customer_Model_Customer\n     *\/",70],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","getCustomerSession",75],"(",")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","Mage",77],["T_DOUBLE_COLON","::",77],["T_STRING","getSingleton",77],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",77],")",";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * List of shopping cart items\n     *\n     * @return Mage_Eav_Model_Entity_Collection_Abstract|array\n     *\/",80],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","getItems",85],"(",")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(","!",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getQuote",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","getId",87],"(",")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_ARRAY","array",88],"(",")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getQuote",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","getItemsCollection",90],"(",")",";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Retrieve array of cart product ids\n     *\n     * @return array\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","getQuoteProductIds",98],"(",")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$products",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getData",100],"(",["T_CONSTANT_ENCAPSED_STRING","'product_ids'",100],")",";",["T_WHITESPACE","\n        ",100],["T_IF","if",101],["T_WHITESPACE"," ",101],"(",["T_STRING","is_null",101],"(",["T_VARIABLE","$products",101],")",")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$products",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_ARRAY","array",102],"(",")",";",["T_WHITESPACE","\n            ",102],["T_FOREACH","foreach",103],["T_WHITESPACE"," ",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getQuote",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","getAllItems",103],"(",")",["T_WHITESPACE"," ",103],["T_AS","as",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$item",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n                ",103],["T_VARIABLE","$products",104],"[",["T_VARIABLE","$item",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getProductId",104],"(",")","]",["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$item",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getProductId",104],"(",")",";",["T_WHITESPACE","\n            ",104],"}",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","setData",106],"(",["T_CONSTANT_ENCAPSED_STRING","'product_ids'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$products",106],")",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$products",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Get quote object associated with cart. By default it is current customer session quote\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",111],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","getQuote",116],"(",")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(","!",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","hasData",118],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",118],")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","setData",119],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getCheckoutSession",119],"(",")",["T_OBJECT_OPERATOR","->",119],["T_STRING","getQuote",119],"(",")",")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n        ",120],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_getData",121],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",121],")",";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Set quote object associated with the cart\n     *\n     * @param Mage_Sales_Model_Quote $quote\n     * @return Mage_Checkout_Model_Cart\n     *\/",124],["T_WHITESPACE","\n    ",129],["T_PUBLIC","public",130],["T_WHITESPACE"," ",130],["T_FUNCTION","function",130],["T_WHITESPACE"," ",130],["T_STRING","setQuote",130],"(",["T_STRING","Mage_Sales_Model_Quote",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$quote",130],")",["T_WHITESPACE","\n    ",130],"{",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","setData",132],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$quote",132],")",";",["T_WHITESPACE","\n        ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * Initialize cart quote state to be able use it on cart page\n     *\n     * @return Mage_Checkout_Model_Cart\n     *\/",136],["T_WHITESPACE","\n    ",140],["T_PUBLIC","public",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","init",141],"(",")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$quote",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getQuote",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","setCheckoutMethod",143],"(",["T_CONSTANT_ENCAPSED_STRING","''",143],")",";",["T_WHITESPACE","\n\n        ",143],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getCheckoutSession",145],"(",")",["T_OBJECT_OPERATOR","->",145],["T_STRING","getCheckoutState",145],"(",")",["T_WHITESPACE"," ",145],["T_IS_NOT_IDENTICAL","!==",145],["T_WHITESPACE"," ",145],["T_STRING","Mage_Checkout_Model_Session",145],["T_DOUBLE_COLON","::",145],["T_STRING","CHECKOUT_STATE_BEGIN",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$quote",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","removeAllAddresses",146],"(",")",["T_OBJECT_OPERATOR","->",146],["T_STRING","removePayment",146],"(",")",";",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getCheckoutSession",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","resetCheckout",147],"(",")",";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n\n        ",148],["T_IF","if",150],["T_WHITESPACE"," ",150],"(","!",["T_VARIABLE","$quote",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","hasItems",150],"(",")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$quote",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getShippingAddress",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","setCollectShippingRates",151],"(",["T_STRING","false",151],")",["T_WHITESPACE","\n                ",151],["T_OBJECT_OPERATOR","->",152],["T_STRING","removeAllShippingRates",152],"(",")",";",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE","\n\n        ",153],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Convert order item to quote item\n     *\n     * @param Mage_Sales_Model_Order_Item $orderItem\n     * @param mixed $qtyFlag if is null set product qty like in order\n     * @return Mage_Checkout_Model_Cart\n     *\/",158],["T_WHITESPACE","\n    ",164],["T_PUBLIC","public",165],["T_WHITESPACE"," ",165],["T_FUNCTION","function",165],["T_WHITESPACE"," ",165],["T_STRING","addOrderItem",165],"(",["T_VARIABLE","$orderItem",165],",",["T_WHITESPACE"," ",165],["T_VARIABLE","$qtyFlag",165],"=",["T_STRING","null",165],")",["T_WHITESPACE","\n    ",165],"{",["T_WHITESPACE","\n        ",166],["T_COMMENT","\/* @var $orderItem Mage_Sales_Model_Order_Item *\/",167],["T_WHITESPACE","\n        ",167],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_STRING","is_null",168],"(",["T_VARIABLE","$orderItem",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getParentItem",168],"(",")",")",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$product",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_STRING","Mage",169],["T_DOUBLE_COLON","::",169],["T_STRING","getModel",169],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",169],")",["T_WHITESPACE","\n                ",169],["T_OBJECT_OPERATOR","->",170],["T_STRING","setStoreId",170],"(",["T_STRING","Mage",170],["T_DOUBLE_COLON","::",170],["T_STRING","app",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","getStore",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","getId",170],"(",")",")",["T_WHITESPACE","\n                ",170],["T_OBJECT_OPERATOR","->",171],["T_STRING","load",171],"(",["T_VARIABLE","$orderItem",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getProductId",171],"(",")",")",";",["T_WHITESPACE","\n            ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(","!",["T_VARIABLE","$product",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getId",172],"(",")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n                ",172],["T_RETURN","return",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],";",["T_WHITESPACE","\n            ",173],"}",["T_WHITESPACE","\n\n            ",174],["T_VARIABLE","$info",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$orderItem",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getProductOptionByCode",176],"(",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",176],")",";",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$info",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_NEW","new",177],["T_WHITESPACE"," ",177],["T_STRING","Varien_Object",177],"(",["T_VARIABLE","$info",177],")",";",["T_WHITESPACE","\n            ",177],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_STRING","is_null",178],"(",["T_VARIABLE","$qtyFlag",178],")",")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$info",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","setQty",179],"(",["T_VARIABLE","$orderItem",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getQtyOrdered",179],"(",")",")",";",["T_WHITESPACE","\n            ",179],"}",["T_WHITESPACE"," ",180],["T_ELSE","else",180],["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n                ",180],["T_VARIABLE","$info",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","setQty",181],"(",["T_LNUMBER","1",181],")",";",["T_WHITESPACE","\n            ",181],"}",["T_WHITESPACE","\n\n            ",182],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","addProduct",184],"(",["T_VARIABLE","$product",184],",",["T_WHITESPACE"," ",184],["T_VARIABLE","$info",184],")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n        ",185],["T_RETURN","return",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],";",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n\n    ",187],["T_DOC_COMMENT","\/**\n     * Get product object based on requested product information\n     *\n     * @param   mixed $productInfo\n     * @return  Mage_Catalog_Model_Product\n     *\/",189],["T_WHITESPACE","\n    ",194],["T_PROTECTED","protected",195],["T_WHITESPACE"," ",195],["T_FUNCTION","function",195],["T_WHITESPACE"," ",195],["T_STRING","_getProduct",195],"(",["T_VARIABLE","$productInfo",195],")",["T_WHITESPACE","\n    ",195],"{",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$product",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","null",197],";",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$productInfo",198],["T_WHITESPACE"," ",198],["T_INSTANCEOF","instanceof",198],["T_WHITESPACE"," ",198],["T_STRING","Mage_Catalog_Model_Product",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$product",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$productInfo",199],";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE"," ",200],["T_ELSEIF","elseif",200],["T_WHITESPACE"," ",200],"(",["T_STRING","is_int",200],"(",["T_VARIABLE","$productInfo",200],")",["T_WHITESPACE"," ",200],["T_BOOLEAN_OR","||",200],["T_WHITESPACE"," ",200],["T_STRING","is_string",200],"(",["T_VARIABLE","$productInfo",200],")",")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$product",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","Mage",201],["T_DOUBLE_COLON","::",201],["T_STRING","getModel",201],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",201],")",["T_WHITESPACE","\n                ",201],["T_OBJECT_OPERATOR","->",202],["T_STRING","setStoreId",202],"(",["T_STRING","Mage",202],["T_DOUBLE_COLON","::",202],["T_STRING","app",202],"(",")",["T_OBJECT_OPERATOR","->",202],["T_STRING","getStore",202],"(",")",["T_OBJECT_OPERATOR","->",202],["T_STRING","getId",202],"(",")",")",["T_WHITESPACE","\n                ",202],["T_OBJECT_OPERATOR","->",203],["T_STRING","load",203],"(",["T_VARIABLE","$productInfo",203],")",";",["T_WHITESPACE","\n        ",203],"}",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$currentWebsiteId",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_STRING","Mage",205],["T_DOUBLE_COLON","::",205],["T_STRING","app",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getStore",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getWebsiteId",205],"(",")",";",["T_WHITESPACE","\n        ",205],["T_IF","if",206],["T_WHITESPACE"," ",206],"(","!",["T_VARIABLE","$product",206],["T_WHITESPACE","\n            ",206],["T_BOOLEAN_OR","||",207],["T_WHITESPACE"," ",207],"!",["T_VARIABLE","$product",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getId",207],"(",")",["T_WHITESPACE","\n            ",207],["T_BOOLEAN_OR","||",208],["T_WHITESPACE"," ",208],"!",["T_STRING","is_array",208],"(",["T_VARIABLE","$product",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getWebsiteIds",208],"(",")",")",["T_WHITESPACE","\n            ",208],["T_BOOLEAN_OR","||",209],["T_WHITESPACE"," ",209],"!",["T_STRING","in_array",209],"(",["T_VARIABLE","$currentWebsiteId",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$product",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getWebsiteIds",209],"(",")",")",["T_WHITESPACE","\n        ",209],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_STRING","Mage",211],["T_DOUBLE_COLON","::",211],["T_STRING","throwException",211],"(",["T_STRING","Mage",211],["T_DOUBLE_COLON","::",211],["T_STRING","helper",211],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",211],")",["T_OBJECT_OPERATOR","->",211],["T_STRING","__",211],"(",["T_CONSTANT_ENCAPSED_STRING","'The product could not be found.'",211],")",")",";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE","\n        ",212],["T_RETURN","return",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$product",213],";",["T_WHITESPACE","\n    ",213],"}",["T_WHITESPACE","\n\n    ",214],["T_DOC_COMMENT","\/**\n     * Get request for product add to cart procedure\n     *\n     * @param   mixed $requestInfo\n     * @return  Varien_Object\n     *\/",216],["T_WHITESPACE","\n    ",221],["T_PROTECTED","protected",222],["T_WHITESPACE"," ",222],["T_FUNCTION","function",222],["T_WHITESPACE"," ",222],["T_STRING","_getProductRequest",222],"(",["T_VARIABLE","$requestInfo",222],")",["T_WHITESPACE","\n    ",222],"{",["T_WHITESPACE","\n        ",223],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_VARIABLE","$requestInfo",224],["T_WHITESPACE"," ",224],["T_INSTANCEOF","instanceof",224],["T_WHITESPACE"," ",224],["T_STRING","Varien_Object",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$request",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$requestInfo",225],";",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE"," ",226],["T_ELSEIF","elseif",226],["T_WHITESPACE"," ",226],"(",["T_STRING","is_numeric",226],"(",["T_VARIABLE","$requestInfo",226],")",")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$request",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_NEW","new",227],["T_WHITESPACE"," ",227],["T_STRING","Varien_Object",227],"(",["T_ARRAY","array",227],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$requestInfo",227],")",")",";",["T_WHITESPACE","\n        ",227],"}",["T_WHITESPACE"," ",228],["T_ELSE","else",228],["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$request",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_NEW","new",229],["T_WHITESPACE"," ",229],["T_STRING","Varien_Object",229],"(",["T_VARIABLE","$requestInfo",229],")",";",["T_WHITESPACE","\n        ",229],"}",["T_WHITESPACE","\n\n        ",230],["T_RETURN","return",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$request",232],";",["T_WHITESPACE","\n    ",232],"}",["T_WHITESPACE","\n\n    ",233],["T_DOC_COMMENT","\/**\n     * Add product to shopping cart (quote)\n     *\n     * @param   int|Mage_Catalog_Model_Product $productInfo\n     * @param   mixed $requestInfo\n     * @return  Mage_Checkout_Model_Cart\n     *\/",235],["T_WHITESPACE","\n    ",241],["T_PUBLIC","public",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","addProduct",242],"(",["T_VARIABLE","$productInfo",242],",",["T_WHITESPACE"," ",242],["T_VARIABLE","$requestInfo",242],"=",["T_STRING","null",242],")",["T_WHITESPACE","\n    ",242],"{",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$product",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_getProduct",244],"(",["T_VARIABLE","$productInfo",244],")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$request",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","_getProductRequest",245],"(",["T_VARIABLE","$requestInfo",245],")",";",["T_WHITESPACE","\n\n        ",245],["T_DOC_COMMENT","\/** @var Mage_Catalog_Helper_Product $helper *\/",247],["T_WHITESPACE","\n        ",247],["T_VARIABLE","$helper",248],["T_WHITESPACE","  ",248],"=",["T_WHITESPACE"," ",248],["T_STRING","Mage",248],["T_DOUBLE_COLON","::",248],["T_STRING","helper",248],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",248],")",";",["T_WHITESPACE","\n\n        ",248],["T_IF","if",250],["T_WHITESPACE"," ",250],"(","!",["T_VARIABLE","$request",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","hasQty",250],"(",")",")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n            ",250],["T_VARIABLE","$request",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","setQty",251],"(",["T_VARIABLE","$helper",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getDefaultQty",251],"(",["T_VARIABLE","$product",251],")",")",";",["T_WHITESPACE","\n        ",251],"}",["T_WHITESPACE","\n\n        ",252],["T_VARIABLE","$productId",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$product",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getId",254],"(",")",";",["T_WHITESPACE","\n\n        ",254],["T_IF","if",256],["T_WHITESPACE"," ",256],"(","!",["T_VARIABLE","$product",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","isConfigurable",256],"(",")",["T_WHITESPACE"," ",256],["T_BOOLEAN_AND","&&",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$product",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getStockItem",256],"(",")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$minimumQty",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$product",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getStockItem",257],"(",")",["T_OBJECT_OPERATOR","->",257],["T_STRING","getMinSaleQty",257],"(",")",";",["T_WHITESPACE","\n            ",257],["T_COMMENT","\/\/If product was not found in cart and there is set minimal qty for it\n",258],["T_WHITESPACE","            ",259],["T_IF","if",259],["T_WHITESPACE"," ",259],"(",["T_VARIABLE","$minimumQty",259],["T_WHITESPACE"," ",259],["T_BOOLEAN_AND","&&",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$minimumQty",259],["T_WHITESPACE"," ",259],">",["T_WHITESPACE"," ",259],["T_LNUMBER","0",259],["T_WHITESPACE"," ",259],["T_BOOLEAN_AND","&&",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$request",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getQty",259],"(",")",["T_WHITESPACE"," ",259],"<",["T_WHITESPACE"," ",259],["T_VARIABLE","$minimumQty",259],["T_WHITESPACE","\n                ",259],["T_BOOLEAN_AND","&&",260],["T_WHITESPACE"," ",260],"!",["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getQuote",260],"(",")",["T_OBJECT_OPERATOR","->",260],["T_STRING","hasProductId",260],"(",["T_VARIABLE","$productId",260],")",["T_WHITESPACE","\n            ",260],")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n                ",261],["T_VARIABLE","$request",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","setQty",262],"(",["T_VARIABLE","$minimumQty",262],")",";",["T_WHITESPACE","\n            ",262],"}",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n\n        ",264],["T_IF","if",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$productId",266],")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_TRY","try",267],["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n                ",267],["T_VARIABLE","$result",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getQuote",268],"(",")",["T_OBJECT_OPERATOR","->",268],["T_STRING","addProduct",268],"(",["T_VARIABLE","$product",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$request",268],")",";",["T_WHITESPACE","\n            ",268],"}",["T_WHITESPACE"," ",269],["T_CATCH","catch",269],["T_WHITESPACE"," ",269],"(",["T_STRING","Mage_Core_Exception",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$e",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n                ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getCheckoutSession",270],"(",")",["T_OBJECT_OPERATOR","->",270],["T_STRING","setUseNotice",270],"(",["T_STRING","false",270],")",";",["T_WHITESPACE","\n                ",270],["T_VARIABLE","$result",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$e",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getMessage",271],"(",")",";",["T_WHITESPACE","\n            ",271],"}",["T_WHITESPACE","\n            ",272],["T_DOC_COMMENT","\/**\n             * String we can get if prepare process has error\n             *\/",273],["T_WHITESPACE","\n            ",275],["T_IF","if",276],["T_WHITESPACE"," ",276],"(",["T_STRING","is_string",276],"(",["T_VARIABLE","$result",276],")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n                ",276],["T_VARIABLE","$redirectUrl",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],"(",["T_VARIABLE","$product",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","hasOptionsValidationFail",277],"(",")",")",["T_WHITESPACE","\n                    ",277],"?",["T_WHITESPACE"," ",278],["T_VARIABLE","$product",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getUrlModel",278],"(",")",["T_OBJECT_OPERATOR","->",278],["T_STRING","getUrl",278],"(",["T_WHITESPACE","\n                        ",278],["T_VARIABLE","$product",279],",",["T_WHITESPACE","\n                        ",279],["T_ARRAY","array",280],"(",["T_CONSTANT_ENCAPSED_STRING","'_query'",280],["T_WHITESPACE"," ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_ARRAY","array",280],"(",["T_CONSTANT_ENCAPSED_STRING","'startcustomization'",280],["T_WHITESPACE"," ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_LNUMBER","1",280],")",")",["T_WHITESPACE","\n                    ",280],")",["T_WHITESPACE","\n                    ",281],":",["T_WHITESPACE"," ",282],["T_VARIABLE","$product",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getProductUrl",282],"(",")",";",["T_WHITESPACE","\n                ",282],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getCheckoutSession",283],"(",")",["T_OBJECT_OPERATOR","->",283],["T_STRING","setRedirectUrl",283],"(",["T_VARIABLE","$redirectUrl",283],")",";",["T_WHITESPACE","\n                ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getCheckoutSession",284],"(",")",["T_OBJECT_OPERATOR","->",284],["T_STRING","getUseNotice",284],"(",")",["T_WHITESPACE"," ",284],["T_IS_IDENTICAL","===",284],["T_WHITESPACE"," ",284],["T_STRING","null",284],")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                    ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getCheckoutSession",285],"(",")",["T_OBJECT_OPERATOR","->",285],["T_STRING","setUseNotice",285],"(",["T_STRING","true",285],")",";",["T_WHITESPACE","\n                ",285],"}",["T_WHITESPACE","\n                ",286],["T_STRING","Mage",287],["T_DOUBLE_COLON","::",287],["T_STRING","throwException",287],"(",["T_VARIABLE","$result",287],")",";",["T_WHITESPACE","\n            ",287],"}",["T_WHITESPACE","\n        ",288],"}",["T_WHITESPACE"," ",289],["T_ELSE","else",289],["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n            ",289],["T_STRING","Mage",290],["T_DOUBLE_COLON","::",290],["T_STRING","throwException",290],"(",["T_STRING","Mage",290],["T_DOUBLE_COLON","::",290],["T_STRING","helper",290],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",290],")",["T_OBJECT_OPERATOR","->",290],["T_STRING","__",290],"(",["T_CONSTANT_ENCAPSED_STRING","'The product does not exist.'",290],")",")",";",["T_WHITESPACE","\n        ",290],"}",["T_WHITESPACE","\n\n        ",291],["T_STRING","Mage",293],["T_DOUBLE_COLON","::",293],["T_STRING","dispatchEvent",293],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_cart_product_add_after'",293],",",["T_WHITESPACE"," ",293],["T_ARRAY","array",293],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_item'",293],["T_WHITESPACE"," ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$result",293],",",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'product'",293],["T_WHITESPACE"," ",293],["T_DOUBLE_ARROW","=>",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$product",293],")",")",";",["T_WHITESPACE","\n        ",293],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getCheckoutSession",294],"(",")",["T_OBJECT_OPERATOR","->",294],["T_STRING","setLastAddedProductId",294],"(",["T_VARIABLE","$productId",294],")",";",["T_WHITESPACE","\n        ",294],["T_RETURN","return",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],";",["T_WHITESPACE","\n    ",295],"}",["T_WHITESPACE","\n\n    ",296],["T_DOC_COMMENT","\/**\n     * Adding products to cart by ids\n     *\n     * @param   array $productIds\n     * @return  Mage_Checkout_Model_Cart\n     *\/",298],["T_WHITESPACE","\n    ",303],["T_PUBLIC","public",304],["T_WHITESPACE"," ",304],["T_FUNCTION","function",304],["T_WHITESPACE"," ",304],["T_STRING","addProductsByIds",304],"(",["T_VARIABLE","$productIds",304],")",["T_WHITESPACE","\n    ",304],"{",["T_WHITESPACE","\n        ",305],["T_VARIABLE","$allAvailable",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_STRING","true",306],";",["T_WHITESPACE","\n        ",306],["T_VARIABLE","$allAdded",307],["T_WHITESPACE","     ",307],"=",["T_WHITESPACE"," ",307],["T_STRING","true",307],";",["T_WHITESPACE","\n\n        ",307],["T_IF","if",309],["T_WHITESPACE"," ",309],"(","!",["T_EMPTY","empty",309],"(",["T_VARIABLE","$productIds",309],")",")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n            ",309],["T_FOREACH","foreach",310],["T_WHITESPACE"," ",310],"(",["T_VARIABLE","$productIds",310],["T_WHITESPACE"," ",310],["T_AS","as",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$productId",310],")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$productId",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_INT_CAST","(int)",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$productId",311],";",["T_WHITESPACE","\n                ",311],["T_IF","if",312],["T_WHITESPACE"," ",312],"(","!",["T_VARIABLE","$productId",312],")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n                    ",312],["T_CONTINUE","continue",313],";",["T_WHITESPACE","\n                ",313],"}",["T_WHITESPACE","\n                ",314],["T_VARIABLE","$product",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_getProduct",315],"(",["T_VARIABLE","$productId",315],")",";",["T_WHITESPACE","\n                ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$product",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getId",316],"(",")",["T_WHITESPACE"," ",316],["T_BOOLEAN_AND","&&",316],["T_WHITESPACE"," ",316],["T_VARIABLE","$product",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","isVisibleInCatalog",316],"(",")",")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n                    ",316],["T_TRY","try",317],["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n                        ",317],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getQuote",318],"(",")",["T_OBJECT_OPERATOR","->",318],["T_STRING","addProduct",318],"(",["T_VARIABLE","$product",318],")",";",["T_WHITESPACE","\n                    ",318],"}",["T_WHITESPACE"," ",319],["T_CATCH","catch",319],["T_WHITESPACE"," ",319],"(",["T_STRING","Exception",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$e",319],")","{",["T_WHITESPACE","\n                        ",319],["T_VARIABLE","$allAdded",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_STRING","false",320],";",["T_WHITESPACE","\n                    ",320],"}",["T_WHITESPACE","\n                ",321],"}",["T_WHITESPACE"," ",322],["T_ELSE","else",322],["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n                    ",322],["T_VARIABLE","$allAvailable",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_STRING","false",323],";",["T_WHITESPACE","\n                ",323],"}",["T_WHITESPACE","\n            ",324],"}",["T_WHITESPACE","\n\n            ",325],["T_IF","if",327],["T_WHITESPACE"," ",327],"(","!",["T_VARIABLE","$allAvailable",327],")",["T_WHITESPACE"," ",327],"{",["T_WHITESPACE","\n                ",327],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","getCheckoutSession",328],"(",")",["T_OBJECT_OPERATOR","->",328],["T_STRING","addError",328],"(",["T_WHITESPACE","\n                    ",328],["T_STRING","Mage",329],["T_DOUBLE_COLON","::",329],["T_STRING","helper",329],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",329],")",["T_OBJECT_OPERATOR","->",329],["T_STRING","__",329],"(",["T_CONSTANT_ENCAPSED_STRING","'Some of the requested products are unavailable.'",329],")",["T_WHITESPACE","\n                ",329],")",";",["T_WHITESPACE","\n            ",330],"}",["T_WHITESPACE","\n            ",331],["T_IF","if",332],["T_WHITESPACE"," ",332],"(","!",["T_VARIABLE","$allAdded",332],")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n                ",332],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getCheckoutSession",333],"(",")",["T_OBJECT_OPERATOR","->",333],["T_STRING","addError",333],"(",["T_WHITESPACE","\n                    ",333],["T_STRING","Mage",334],["T_DOUBLE_COLON","::",334],["T_STRING","helper",334],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",334],")",["T_OBJECT_OPERATOR","->",334],["T_STRING","__",334],"(",["T_CONSTANT_ENCAPSED_STRING","'Some of the requested products are not available in the desired quantity.'",334],")",["T_WHITESPACE","\n                ",334],")",";",["T_WHITESPACE","\n            ",335],"}",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE","\n        ",337],["T_RETURN","return",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],";",["T_WHITESPACE","\n    ",338],"}",["T_WHITESPACE","\n\n    ",339],["T_DOC_COMMENT","\/**\n     * Returns suggested quantities for items.\n     * Can be used to automatically fix user entered quantities before updating cart\n     * so that cart contains valid qty values\n     *\n     * $data is an array of ($quoteItemId => (item info array with 'qty' key), ...)\n     *\n     * @param   array $data\n     * @return  array\n     *\/",341],["T_WHITESPACE","\n    ",350],["T_PUBLIC","public",351],["T_WHITESPACE"," ",351],["T_FUNCTION","function",351],["T_WHITESPACE"," ",351],["T_STRING","suggestItemsQty",351],"(",["T_VARIABLE","$data",351],")",["T_WHITESPACE","\n    ",351],"{",["T_WHITESPACE","\n        ",352],["T_FOREACH","foreach",353],["T_WHITESPACE"," ",353],"(",["T_VARIABLE","$data",353],["T_WHITESPACE"," ",353],["T_AS","as",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$itemId",353],["T_WHITESPACE"," ",353],["T_DOUBLE_ARROW","=>",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$itemInfo",353],")",["T_WHITESPACE"," ",353],"{",["T_WHITESPACE","\n            ",353],["T_IF","if",354],["T_WHITESPACE"," ",354],"(","!",["T_ISSET","isset",354],"(",["T_VARIABLE","$itemInfo",354],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",354],"]",")",")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n                ",354],["T_CONTINUE","continue",355],";",["T_WHITESPACE","\n            ",355],"}",["T_WHITESPACE","\n            ",356],["T_VARIABLE","$qty",357],["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_DOUBLE_CAST","(float)",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$itemInfo",357],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",357],"]",";",["T_WHITESPACE","\n            ",357],["T_IF","if",358],["T_WHITESPACE"," ",358],"(",["T_VARIABLE","$qty",358],["T_WHITESPACE"," ",358],["T_IS_SMALLER_OR_EQUAL","<=",358],["T_WHITESPACE"," ",358],["T_LNUMBER","0",358],")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n                ",358],["T_CONTINUE","continue",359],";",["T_WHITESPACE","\n            ",359],"}",["T_WHITESPACE","\n\n            ",360],["T_VARIABLE","$quoteItem",362],["T_WHITESPACE"," ",362],"=",["T_WHITESPACE"," ",362],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","getQuote",362],"(",")",["T_OBJECT_OPERATOR","->",362],["T_STRING","getItemById",362],"(",["T_VARIABLE","$itemId",362],")",";",["T_WHITESPACE","\n            ",362],["T_IF","if",363],["T_WHITESPACE"," ",363],"(","!",["T_VARIABLE","$quoteItem",363],")",["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n                ",363],["T_CONTINUE","continue",364],";",["T_WHITESPACE","\n            ",364],"}",["T_WHITESPACE","\n\n            ",365],["T_VARIABLE","$product",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$quoteItem",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getProduct",367],"(",")",";",["T_WHITESPACE","\n            ",367],["T_IF","if",368],["T_WHITESPACE"," ",368],"(","!",["T_VARIABLE","$product",368],")",["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n                ",368],["T_CONTINUE","continue",369],";",["T_WHITESPACE","\n            ",369],"}",["T_WHITESPACE","\n\n            ",370],["T_COMMENT","\/* @var $stockItem Mage_CatalogInventory_Model_Stock_Item *\/",372],["T_WHITESPACE","\n            ",372],["T_VARIABLE","$stockItem",373],["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],["T_VARIABLE","$product",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getStockItem",373],"(",")",";",["T_WHITESPACE","\n            ",373],["T_IF","if",374],["T_WHITESPACE"," ",374],"(","!",["T_VARIABLE","$stockItem",374],")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n                ",374],["T_CONTINUE","continue",375],";",["T_WHITESPACE","\n            ",375],"}",["T_WHITESPACE","\n\n            ",376],["T_VARIABLE","$data",378],"[",["T_VARIABLE","$itemId",378],"]","[",["T_CONSTANT_ENCAPSED_STRING","'before_suggest_qty'",378],"]",["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$qty",378],";",["T_WHITESPACE","\n            ",378],["T_VARIABLE","$data",379],"[",["T_VARIABLE","$itemId",379],"]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",379],"]",["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_VARIABLE","$stockItem",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","suggestQty",379],"(",["T_VARIABLE","$qty",379],")",";",["T_WHITESPACE","\n        ",379],"}",["T_WHITESPACE","\n\n        ",380],["T_RETURN","return",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$data",382],";",["T_WHITESPACE","\n    ",382],"}",["T_WHITESPACE","\n\n    ",383],["T_DOC_COMMENT","\/**\n     * Update cart items information\n     *\n     * @param   array $data\n     * @return  Mage_Checkout_Model_Cart\n     *\/",385],["T_WHITESPACE","\n    ",390],["T_PUBLIC","public",391],["T_WHITESPACE"," ",391],["T_FUNCTION","function",391],["T_WHITESPACE"," ",391],["T_STRING","updateItems",391],"(",["T_VARIABLE","$data",391],")",["T_WHITESPACE","\n    ",391],"{",["T_WHITESPACE","\n        ",392],["T_STRING","Mage",393],["T_DOUBLE_COLON","::",393],["T_STRING","dispatchEvent",393],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_cart_update_items_before'",393],",",["T_WHITESPACE"," ",393],["T_ARRAY","array",393],"(",["T_CONSTANT_ENCAPSED_STRING","'cart'",393],["T_DOUBLE_ARROW","=>",393],["T_VARIABLE","$this",393],",",["T_WHITESPACE"," ",393],["T_CONSTANT_ENCAPSED_STRING","'info'",393],["T_DOUBLE_ARROW","=>",393],["T_VARIABLE","$data",393],")",")",";",["T_WHITESPACE","\n\n        ",393],["T_COMMENT","\/* @var $messageFactory Mage_Core_Model_Message *\/",395],["T_WHITESPACE","\n        ",395],["T_VARIABLE","$messageFactory",396],["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_STRING","Mage",396],["T_DOUBLE_COLON","::",396],["T_STRING","getSingleton",396],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/message'",396],")",";",["T_WHITESPACE","\n        ",396],["T_VARIABLE","$session",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getCheckoutSession",397],"(",")",";",["T_WHITESPACE","\n        ",397],["T_VARIABLE","$qtyRecalculatedFlag",398],["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_STRING","false",398],";",["T_WHITESPACE","\n        ",398],["T_FOREACH","foreach",399],["T_WHITESPACE"," ",399],"(",["T_VARIABLE","$data",399],["T_WHITESPACE"," ",399],["T_AS","as",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$itemId",399],["T_WHITESPACE"," ",399],["T_DOUBLE_ARROW","=>",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$itemInfo",399],")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n            ",399],["T_VARIABLE","$item",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getQuote",400],"(",")",["T_OBJECT_OPERATOR","->",400],["T_STRING","getItemById",400],"(",["T_VARIABLE","$itemId",400],")",";",["T_WHITESPACE","\n            ",400],["T_IF","if",401],["T_WHITESPACE"," ",401],"(","!",["T_VARIABLE","$item",401],")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n                ",401],["T_CONTINUE","continue",402],";",["T_WHITESPACE","\n            ",402],"}",["T_WHITESPACE","\n\n            ",403],["T_IF","if",405],["T_WHITESPACE"," ",405],"(","!",["T_EMPTY","empty",405],"(",["T_VARIABLE","$itemInfo",405],"[",["T_CONSTANT_ENCAPSED_STRING","'remove'",405],"]",")",["T_WHITESPACE"," ",405],["T_BOOLEAN_OR","||",405],["T_WHITESPACE"," ",405],"(",["T_ISSET","isset",405],"(",["T_VARIABLE","$itemInfo",405],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",405],"]",")",["T_WHITESPACE"," ",405],["T_BOOLEAN_AND","&&",405],["T_WHITESPACE"," ",405],["T_VARIABLE","$itemInfo",405],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",405],"]",["T_IS_EQUAL","==",405],["T_CONSTANT_ENCAPSED_STRING","'0'",405],")",")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n                ",405],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","removeItem",406],"(",["T_VARIABLE","$itemId",406],")",";",["T_WHITESPACE","\n                ",406],["T_CONTINUE","continue",407],";",["T_WHITESPACE","\n            ",407],"}",["T_WHITESPACE","\n\n            ",408],["T_VARIABLE","$qty",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_ISSET","isset",410],"(",["T_VARIABLE","$itemInfo",410],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",410],"]",")",["T_WHITESPACE"," ",410],"?",["T_WHITESPACE"," ",410],["T_DOUBLE_CAST","(float)",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$itemInfo",410],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",410],"]",["T_WHITESPACE"," ",410],":",["T_WHITESPACE"," ",410],["T_STRING","false",410],";",["T_WHITESPACE","\n            ",410],["T_IF","if",411],["T_WHITESPACE"," ",411],"(",["T_VARIABLE","$qty",411],["T_WHITESPACE"," ",411],">",["T_WHITESPACE"," ",411],["T_LNUMBER","0",411],")",["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n                ",411],["T_VARIABLE","$item",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","setQty",412],"(",["T_VARIABLE","$qty",412],")",";",["T_WHITESPACE","\n\n                ",412],["T_VARIABLE","$itemInQuote",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getQuote",414],"(",")",["T_OBJECT_OPERATOR","->",414],["T_STRING","getItemById",414],"(",["T_VARIABLE","$item",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getId",414],"(",")",")",";",["T_WHITESPACE","\n\n                ",414],["T_IF","if",416],["T_WHITESPACE"," ",416],"(","!",["T_VARIABLE","$itemInQuote",416],["T_WHITESPACE"," ",416],["T_BOOLEAN_AND","&&",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$item",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getHasError",416],"(",")",")",["T_WHITESPACE"," ",416],"{",["T_WHITESPACE","\n                    ",416],["T_STRING","Mage",417],["T_DOUBLE_COLON","::",417],["T_STRING","throwException",417],"(",["T_VARIABLE","$item",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getMessage",417],"(",")",")",";",["T_WHITESPACE","\n                ",417],"}",["T_WHITESPACE","\n\n                ",418],["T_IF","if",420],["T_WHITESPACE"," ",420],"(",["T_ISSET","isset",420],"(",["T_VARIABLE","$itemInfo",420],"[",["T_CONSTANT_ENCAPSED_STRING","'before_suggest_qty'",420],"]",")",["T_WHITESPACE"," ",420],["T_BOOLEAN_AND","&&",420],["T_WHITESPACE"," ",420],"(",["T_VARIABLE","$itemInfo",420],"[",["T_CONSTANT_ENCAPSED_STRING","'before_suggest_qty'",420],"]",["T_WHITESPACE"," ",420],["T_IS_NOT_EQUAL","!=",420],["T_WHITESPACE"," ",420],["T_VARIABLE","$qty",420],")",")",["T_WHITESPACE"," ",420],"{",["T_WHITESPACE","\n                    ",420],["T_VARIABLE","$qtyRecalculatedFlag",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_STRING","true",421],";",["T_WHITESPACE","\n                    ",421],["T_VARIABLE","$message",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$messageFactory",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","notice",422],"(",["T_STRING","Mage",422],["T_DOUBLE_COLON","::",422],["T_STRING","helper",422],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",422],")",["T_OBJECT_OPERATOR","->",422],["T_STRING","__",422],"(",["T_CONSTANT_ENCAPSED_STRING","'Quantity was recalculated from %d to %d'",422],",",["T_WHITESPACE"," ",422],["T_VARIABLE","$itemInfo",422],"[",["T_CONSTANT_ENCAPSED_STRING","'before_suggest_qty'",422],"]",",",["T_WHITESPACE"," ",422],["T_VARIABLE","$qty",422],")",")",";",["T_WHITESPACE","\n                    ",422],["T_VARIABLE","$session",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","addQuoteItemMessage",423],"(",["T_VARIABLE","$item",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getId",423],"(",")",",",["T_WHITESPACE"," ",423],["T_VARIABLE","$message",423],")",";",["T_WHITESPACE","\n                ",423],"}",["T_WHITESPACE","\n            ",424],"}",["T_WHITESPACE","\n        ",425],"}",["T_WHITESPACE","\n\n        ",426],["T_IF","if",428],["T_WHITESPACE"," ",428],"(",["T_VARIABLE","$qtyRecalculatedFlag",428],")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n            ",428],["T_VARIABLE","$session",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","addNotice",429],"(",["T_WHITESPACE","\n                ",429],["T_STRING","Mage",430],["T_DOUBLE_COLON","::",430],["T_STRING","helper",430],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",430],")",["T_OBJECT_OPERATOR","->",430],["T_STRING","__",430],"(",["T_CONSTANT_ENCAPSED_STRING","'Some products quantities were recalculated because of quantity increment mismatch'",430],")",["T_WHITESPACE","\n            ",430],")",";",["T_WHITESPACE","\n        ",431],"}",["T_WHITESPACE","\n\n        ",432],["T_STRING","Mage",434],["T_DOUBLE_COLON","::",434],["T_STRING","dispatchEvent",434],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_cart_update_items_after'",434],",",["T_WHITESPACE"," ",434],["T_ARRAY","array",434],"(",["T_CONSTANT_ENCAPSED_STRING","'cart'",434],["T_DOUBLE_ARROW","=>",434],["T_VARIABLE","$this",434],",",["T_WHITESPACE"," ",434],["T_CONSTANT_ENCAPSED_STRING","'info'",434],["T_DOUBLE_ARROW","=>",434],["T_VARIABLE","$data",434],")",")",";",["T_WHITESPACE","\n        ",434],["T_RETURN","return",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$this",435],";",["T_WHITESPACE","\n    ",435],"}",["T_WHITESPACE","\n\n    ",436],["T_DOC_COMMENT","\/**\n     * Remove item from cart\n     *\n     * @param   int $itemId\n     * @return  Mage_Checkout_Model_Cart\n     *\/",438],["T_WHITESPACE","\n    ",443],["T_PUBLIC","public",444],["T_WHITESPACE"," ",444],["T_FUNCTION","function",444],["T_WHITESPACE"," ",444],["T_STRING","removeItem",444],"(",["T_VARIABLE","$itemId",444],")",["T_WHITESPACE","\n    ",444],"{",["T_WHITESPACE","\n        ",445],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getQuote",446],"(",")",["T_OBJECT_OPERATOR","->",446],["T_STRING","removeItem",446],"(",["T_VARIABLE","$itemId",446],")",";",["T_WHITESPACE","\n        ",446],["T_RETURN","return",447],["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],";",["T_WHITESPACE","\n    ",447],"}",["T_WHITESPACE","\n\n    ",448],["T_DOC_COMMENT","\/**\n     * Save cart\n     *\n     * @return Mage_Checkout_Model_Cart\n     *\/",450],["T_WHITESPACE","\n    ",454],["T_PUBLIC","public",455],["T_WHITESPACE"," ",455],["T_FUNCTION","function",455],["T_WHITESPACE"," ",455],["T_STRING","save",455],"(",")",["T_WHITESPACE","\n    ",455],"{",["T_WHITESPACE","\n        ",456],["T_STRING","Mage",457],["T_DOUBLE_COLON","::",457],["T_STRING","dispatchEvent",457],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_cart_save_before'",457],",",["T_WHITESPACE"," ",457],["T_ARRAY","array",457],"(",["T_CONSTANT_ENCAPSED_STRING","'cart'",457],["T_DOUBLE_ARROW","=>",457],["T_VARIABLE","$this",457],")",")",";",["T_WHITESPACE","\n\n        ",457],["T_VARIABLE","$this",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","getQuote",459],"(",")",["T_OBJECT_OPERATOR","->",459],["T_STRING","getBillingAddress",459],"(",")",";",["T_WHITESPACE","\n        ",459],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getQuote",460],"(",")",["T_OBJECT_OPERATOR","->",460],["T_STRING","getShippingAddress",460],"(",")",["T_OBJECT_OPERATOR","->",460],["T_STRING","setCollectShippingRates",460],"(",["T_STRING","true",460],")",";",["T_WHITESPACE","\n        ",460],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getQuote",461],"(",")",["T_OBJECT_OPERATOR","->",461],["T_STRING","collectTotals",461],"(",")",";",["T_WHITESPACE","\n        ",461],["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","getQuote",462],"(",")",["T_OBJECT_OPERATOR","->",462],["T_STRING","save",462],"(",")",";",["T_WHITESPACE","\n        ",462],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getCheckoutSession",463],"(",")",["T_OBJECT_OPERATOR","->",463],["T_STRING","setQuoteId",463],"(",["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getQuote",463],"(",")",["T_OBJECT_OPERATOR","->",463],["T_STRING","getId",463],"(",")",")",";",["T_WHITESPACE","\n        ",463],["T_DOC_COMMENT","\/**\n         * Cart save usually called after changes with cart items.\n         *\/",464],["T_WHITESPACE","\n        ",466],["T_STRING","Mage",467],["T_DOUBLE_COLON","::",467],["T_STRING","dispatchEvent",467],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_cart_save_after'",467],",",["T_WHITESPACE"," ",467],["T_ARRAY","array",467],"(",["T_CONSTANT_ENCAPSED_STRING","'cart'",467],["T_DOUBLE_ARROW","=>",467],["T_VARIABLE","$this",467],")",")",";",["T_WHITESPACE","\n        ",467],["T_RETURN","return",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$this",468],";",["T_WHITESPACE","\n    ",468],"}",["T_WHITESPACE","\n\n    ",469],["T_DOC_COMMENT","\/**\n     * Save cart (implement interface method)\n     *\/",471],["T_WHITESPACE","\n    ",473],["T_PUBLIC","public",474],["T_WHITESPACE"," ",474],["T_FUNCTION","function",474],["T_WHITESPACE"," ",474],["T_STRING","saveQuote",474],"(",")",["T_WHITESPACE","\n    ",474],"{",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","save",476],"(",")",";",["T_WHITESPACE","\n    ",476],"}",["T_WHITESPACE","\n\n    ",477],["T_DOC_COMMENT","\/**\n     * Mark all quote items as deleted (empty shopping cart)\n     *\n     * @return Mage_Checkout_Model_Cart\n     *\/",479],["T_WHITESPACE","\n    ",483],["T_PUBLIC","public",484],["T_WHITESPACE"," ",484],["T_FUNCTION","function",484],["T_WHITESPACE"," ",484],["T_STRING","truncate",484],"(",")",["T_WHITESPACE","\n    ",484],"{",["T_WHITESPACE","\n        ",485],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getQuote",486],"(",")",["T_OBJECT_OPERATOR","->",486],["T_STRING","removeAllItems",486],"(",")",";",["T_WHITESPACE","\n        ",486],["T_RETURN","return",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],";",["T_WHITESPACE","\n    ",487],"}",["T_WHITESPACE","\n\n    ",488],["T_PUBLIC","public",490],["T_WHITESPACE"," ",490],["T_FUNCTION","function",490],["T_WHITESPACE"," ",490],["T_STRING","getProductIds",490],"(",")",["T_WHITESPACE","\n    ",490],"{",["T_WHITESPACE","\n        ",491],["T_VARIABLE","$quoteId",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_STRING","Mage",492],["T_DOUBLE_COLON","::",492],["T_STRING","getSingleton",492],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",492],")",["T_OBJECT_OPERATOR","->",492],["T_STRING","getQuoteId",492],"(",")",";",["T_WHITESPACE","\n        ",492],["T_IF","if",493],["T_WHITESPACE"," ",493],"(",["T_STRING","null",493],["T_WHITESPACE"," ",493],["T_IS_IDENTICAL","===",493],["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","_productIds",493],")",["T_WHITESPACE"," ",493],"{",["T_WHITESPACE","\n            ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","_productIds",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],["T_ARRAY","array",494],"(",")",";",["T_WHITESPACE","\n            ",494],["T_IF","if",495],["T_WHITESPACE"," ",495],"(",["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getSummaryQty",495],"(",")",">",["T_LNUMBER","0",495],")",["T_WHITESPACE"," ",495],"{",["T_WHITESPACE","\n               ",495],["T_FOREACH","foreach",496],["T_WHITESPACE"," ",496],"(",["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getQuote",496],"(",")",["T_OBJECT_OPERATOR","->",496],["T_STRING","getAllItems",496],"(",")",["T_WHITESPACE"," ",496],["T_AS","as",496],["T_WHITESPACE"," ",496],["T_VARIABLE","$item",496],")",["T_WHITESPACE"," ",496],"{",["T_WHITESPACE","\n                   ",496],["T_VARIABLE","$this",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","_productIds",497],"[","]",["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_VARIABLE","$item",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getProductId",497],"(",")",";",["T_WHITESPACE","\n               ",497],"}",["T_WHITESPACE","\n            ",498],"}",["T_WHITESPACE","\n            ",499],["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","_productIds",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_STRING","array_unique",500],"(",["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","_productIds",500],")",";",["T_WHITESPACE","\n        ",500],"}",["T_WHITESPACE","\n        ",501],["T_RETURN","return",502],["T_WHITESPACE"," ",502],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","_productIds",502],";",["T_WHITESPACE","\n    ",502],"}",["T_WHITESPACE","\n\n    ",503],["T_DOC_COMMENT","\/**\n     * Get shopping cart items summary (includes config settings)\n     *\n     * @return int|float\n     *\/",505],["T_WHITESPACE","\n    ",509],["T_PUBLIC","public",510],["T_WHITESPACE"," ",510],["T_FUNCTION","function",510],["T_WHITESPACE"," ",510],["T_STRING","getSummaryQty",510],"(",")",["T_WHITESPACE","\n    ",510],"{",["T_WHITESPACE","\n        ",511],["T_VARIABLE","$quoteId",512],["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],["T_STRING","Mage",512],["T_DOUBLE_COLON","::",512],["T_STRING","getSingleton",512],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",512],")",["T_OBJECT_OPERATOR","->",512],["T_STRING","getQuoteId",512],"(",")",";",["T_WHITESPACE","\n\n        ",512],["T_COMMENT","\/\/If there is no quote id in session trying to load quote\n",514],["T_WHITESPACE","        ",515],["T_COMMENT","\/\/and get new quote id. This is done for cases when quote was created\n",515],["T_WHITESPACE","        ",516],["T_COMMENT","\/\/not by customer (from backend for example).\n",516],["T_WHITESPACE","        ",517],["T_IF","if",517],["T_WHITESPACE"," ",517],"(","!",["T_VARIABLE","$quoteId",517],["T_WHITESPACE"," ",517],["T_BOOLEAN_AND","&&",517],["T_WHITESPACE"," ",517],["T_STRING","Mage",517],["T_DOUBLE_COLON","::",517],["T_STRING","getSingleton",517],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",517],")",["T_OBJECT_OPERATOR","->",517],["T_STRING","isLoggedIn",517],"(",")",")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n            ",517],["T_VARIABLE","$quote",518],["T_WHITESPACE"," ",518],"=",["T_WHITESPACE"," ",518],["T_STRING","Mage",518],["T_DOUBLE_COLON","::",518],["T_STRING","getSingleton",518],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",518],")",["T_OBJECT_OPERATOR","->",518],["T_STRING","getQuote",518],"(",")",";",["T_WHITESPACE","\n            ",518],["T_VARIABLE","$quoteId",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_STRING","Mage",519],["T_DOUBLE_COLON","::",519],["T_STRING","getSingleton",519],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",519],")",["T_OBJECT_OPERATOR","->",519],["T_STRING","getQuoteId",519],"(",")",";",["T_WHITESPACE","\n        ",519],"}",["T_WHITESPACE","\n\n        ",520],["T_IF","if",522],["T_WHITESPACE"," ",522],"(",["T_VARIABLE","$quoteId",522],["T_WHITESPACE"," ",522],["T_BOOLEAN_AND","&&",522],["T_WHITESPACE"," ",522],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_summaryQty",522],["T_WHITESPACE"," ",522],["T_IS_IDENTICAL","===",522],["T_WHITESPACE"," ",522],["T_STRING","null",522],")",["T_WHITESPACE"," ",522],"{",["T_WHITESPACE","\n            ",522],["T_IF","if",523],["T_WHITESPACE"," ",523],"(",["T_STRING","Mage",523],["T_DOUBLE_COLON","::",523],["T_STRING","getStoreConfig",523],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart_link\/use_qty'",523],")",")",["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n                ",523],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","_summaryQty",524],["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","getItemsQty",524],"(",")",";",["T_WHITESPACE","\n            ",524],"}",["T_WHITESPACE"," ",525],["T_ELSE","else",525],["T_WHITESPACE"," ",525],"{",["T_WHITESPACE","\n                ",525],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","_summaryQty",526],["T_WHITESPACE"," ",526],"=",["T_WHITESPACE"," ",526],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getItemsCount",526],"(",")",";",["T_WHITESPACE","\n            ",526],"}",["T_WHITESPACE","\n        ",527],"}",["T_WHITESPACE","\n        ",528],["T_RETURN","return",529],["T_WHITESPACE"," ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","_summaryQty",529],";",["T_WHITESPACE","\n    ",529],"}",["T_WHITESPACE","\n\n    ",530],["T_DOC_COMMENT","\/**\n     * Get shopping cart items count\n     *\n     * @return int\n     *\/",532],["T_WHITESPACE","\n    ",536],["T_PUBLIC","public",537],["T_WHITESPACE"," ",537],["T_FUNCTION","function",537],["T_WHITESPACE"," ",537],["T_STRING","getItemsCount",537],"(",")",["T_WHITESPACE","\n    ",537],"{",["T_WHITESPACE","\n        ",538],["T_RETURN","return",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$this",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","getQuote",539],"(",")",["T_OBJECT_OPERATOR","->",539],["T_STRING","getItemsCount",539],"(",")","*",["T_LNUMBER","1",539],";",["T_WHITESPACE","\n    ",539],"}",["T_WHITESPACE","\n\n    ",540],["T_DOC_COMMENT","\/**\n     * Get shopping cart summary qty\n     *\n     * @return int|float\n     *\/",542],["T_WHITESPACE","\n    ",546],["T_PUBLIC","public",547],["T_WHITESPACE"," ",547],["T_FUNCTION","function",547],["T_WHITESPACE"," ",547],["T_STRING","getItemsQty",547],"(",")",["T_WHITESPACE","\n    ",547],"{",["T_WHITESPACE","\n        ",548],["T_RETURN","return",549],["T_WHITESPACE"," ",549],["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getQuote",549],"(",")",["T_OBJECT_OPERATOR","->",549],["T_STRING","getItemsQty",549],"(",")","*",["T_LNUMBER","1",549],";",["T_WHITESPACE","\n    ",549],"}",["T_WHITESPACE","\n\n    ",550],["T_DOC_COMMENT","\/**\n     * Update item in shopping cart (quote)\n     * $requestInfo - either qty (int) or buyRequest in form of array or Varien_Object\n     * $updatingParams - information on how to perform update, passed to Quote->updateItem() method\n     *\n     * @param int $itemId\n     * @param int|array|Varien_Object $requestInfo\n     * @param null|array|Varien_Object $updatingParams\n     * @return Mage_Sales_Model_Quote_Item|string\n     *\n     * @see Mage_Sales_Model_Quote::updateItem()\n     *\/",552],["T_WHITESPACE","\n    ",563],["T_PUBLIC","public",564],["T_WHITESPACE"," ",564],["T_FUNCTION","function",564],["T_WHITESPACE"," ",564],["T_STRING","updateItem",564],"(",["T_VARIABLE","$itemId",564],",",["T_WHITESPACE"," ",564],["T_VARIABLE","$requestInfo",564],["T_WHITESPACE"," ",564],"=",["T_WHITESPACE"," ",564],["T_STRING","null",564],",",["T_WHITESPACE"," ",564],["T_VARIABLE","$updatingParams",564],["T_WHITESPACE"," ",564],"=",["T_WHITESPACE"," ",564],["T_STRING","null",564],")",["T_WHITESPACE","\n    ",564],"{",["T_WHITESPACE","\n        ",565],["T_TRY","try",566],["T_WHITESPACE"," ",566],"{",["T_WHITESPACE","\n            ",566],["T_VARIABLE","$item",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getQuote",567],"(",")",["T_OBJECT_OPERATOR","->",567],["T_STRING","getItemById",567],"(",["T_VARIABLE","$itemId",567],")",";",["T_WHITESPACE","\n            ",567],["T_IF","if",568],["T_WHITESPACE"," ",568],"(","!",["T_VARIABLE","$item",568],")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n                ",568],["T_STRING","Mage",569],["T_DOUBLE_COLON","::",569],["T_STRING","throwException",569],"(",["T_STRING","Mage",569],["T_DOUBLE_COLON","::",569],["T_STRING","helper",569],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",569],")",["T_OBJECT_OPERATOR","->",569],["T_STRING","__",569],"(",["T_CONSTANT_ENCAPSED_STRING","'Quote item does not exist.'",569],")",")",";",["T_WHITESPACE","\n            ",569],"}",["T_WHITESPACE","\n            ",570],["T_VARIABLE","$productId",571],["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_VARIABLE","$item",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","getProduct",571],"(",")",["T_OBJECT_OPERATOR","->",571],["T_STRING","getId",571],"(",")",";",["T_WHITESPACE","\n            ",571],["T_VARIABLE","$product",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$this",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","_getProduct",572],"(",["T_VARIABLE","$productId",572],")",";",["T_WHITESPACE","\n            ",572],["T_VARIABLE","$request",573],["T_WHITESPACE"," ",573],"=",["T_WHITESPACE"," ",573],["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","_getProductRequest",573],"(",["T_VARIABLE","$requestInfo",573],")",";",["T_WHITESPACE","\n\n            ",573],["T_IF","if",575],["T_WHITESPACE"," ",575],"(",["T_VARIABLE","$product",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","getStockItem",575],"(",")",")",["T_WHITESPACE"," ",575],"{",["T_WHITESPACE","\n                ",575],["T_VARIABLE","$minimumQty",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_VARIABLE","$product",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","getStockItem",576],"(",")",["T_OBJECT_OPERATOR","->",576],["T_STRING","getMinSaleQty",576],"(",")",";",["T_WHITESPACE","\n                ",576],["T_COMMENT","\/\/ If product was not found in cart and there is set minimal qty for it\n",577],["T_WHITESPACE","                ",578],["T_IF","if",578],["T_WHITESPACE"," ",578],"(",["T_VARIABLE","$minimumQty",578],["T_WHITESPACE"," ",578],["T_BOOLEAN_AND","&&",578],["T_WHITESPACE"," ",578],"(",["T_VARIABLE","$minimumQty",578],["T_WHITESPACE"," ",578],">",["T_WHITESPACE"," ",578],["T_LNUMBER","0",578],")",["T_WHITESPACE","\n                    ",578],["T_BOOLEAN_AND","&&",579],["T_WHITESPACE"," ",579],"(",["T_VARIABLE","$request",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","getQty",579],"(",")",["T_WHITESPACE"," ",579],"<",["T_WHITESPACE"," ",579],["T_VARIABLE","$minimumQty",579],")",["T_WHITESPACE","\n                    ",579],["T_BOOLEAN_AND","&&",580],["T_WHITESPACE"," ",580],"!",["T_VARIABLE","$this",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getQuote",580],"(",")",["T_OBJECT_OPERATOR","->",580],["T_STRING","hasProductId",580],"(",["T_VARIABLE","$productId",580],")",["T_WHITESPACE","\n                ",580],")",["T_WHITESPACE"," ",581],"{",["T_WHITESPACE","\n                    ",581],["T_VARIABLE","$request",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","setQty",582],"(",["T_VARIABLE","$minimumQty",582],")",";",["T_WHITESPACE","\n                ",582],"}",["T_WHITESPACE","\n            ",583],"}",["T_WHITESPACE","\n\n            ",584],["T_VARIABLE","$result",586],["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","getQuote",586],"(",")",["T_OBJECT_OPERATOR","->",586],["T_STRING","updateItem",586],"(",["T_VARIABLE","$itemId",586],",",["T_WHITESPACE"," ",586],["T_VARIABLE","$request",586],",",["T_WHITESPACE"," ",586],["T_VARIABLE","$updatingParams",586],")",";",["T_WHITESPACE","\n        ",586],"}",["T_WHITESPACE"," ",587],["T_CATCH","catch",587],["T_WHITESPACE"," ",587],"(",["T_STRING","Mage_Core_Exception",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$e",587],")",["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n            ",587],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","getCheckoutSession",588],"(",")",["T_OBJECT_OPERATOR","->",588],["T_STRING","setUseNotice",588],"(",["T_STRING","false",588],")",";",["T_WHITESPACE","\n            ",588],["T_VARIABLE","$result",589],["T_WHITESPACE"," ",589],"=",["T_WHITESPACE"," ",589],["T_VARIABLE","$e",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getMessage",589],"(",")",";",["T_WHITESPACE","\n        ",589],"}",["T_WHITESPACE","\n\n        ",590],["T_DOC_COMMENT","\/**\n         * We can get string if updating process had some errors\n         *\/",592],["T_WHITESPACE","\n        ",594],["T_IF","if",595],["T_WHITESPACE"," ",595],"(",["T_STRING","is_string",595],"(",["T_VARIABLE","$result",595],")",")",["T_WHITESPACE"," ",595],"{",["T_WHITESPACE","\n            ",595],["T_IF","if",596],["T_WHITESPACE"," ",596],"(",["T_VARIABLE","$this",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","getCheckoutSession",596],"(",")",["T_OBJECT_OPERATOR","->",596],["T_STRING","getUseNotice",596],"(",")",["T_WHITESPACE"," ",596],["T_IS_IDENTICAL","===",596],["T_WHITESPACE"," ",596],["T_STRING","null",596],")",["T_WHITESPACE"," ",596],"{",["T_WHITESPACE","\n                ",596],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","getCheckoutSession",597],"(",")",["T_OBJECT_OPERATOR","->",597],["T_STRING","setUseNotice",597],"(",["T_STRING","true",597],")",";",["T_WHITESPACE","\n            ",597],"}",["T_WHITESPACE","\n            ",598],["T_STRING","Mage",599],["T_DOUBLE_COLON","::",599],["T_STRING","throwException",599],"(",["T_VARIABLE","$result",599],")",";",["T_WHITESPACE","\n        ",599],"}",["T_WHITESPACE","\n\n        ",600],["T_STRING","Mage",602],["T_DOUBLE_COLON","::",602],["T_STRING","dispatchEvent",602],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_cart_product_update_after'",602],",",["T_WHITESPACE"," ",602],["T_ARRAY","array",602],"(",["T_WHITESPACE","\n            ",602],["T_CONSTANT_ENCAPSED_STRING","'quote_item'",603],["T_WHITESPACE"," ",603],["T_DOUBLE_ARROW","=>",603],["T_WHITESPACE"," ",603],["T_VARIABLE","$result",603],",",["T_WHITESPACE","\n            ",603],["T_CONSTANT_ENCAPSED_STRING","'product'",604],["T_WHITESPACE"," ",604],["T_DOUBLE_ARROW","=>",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$product",604],["T_WHITESPACE","\n        ",604],")",")",";",["T_WHITESPACE","\n        ",605],["T_VARIABLE","$this",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","getCheckoutSession",606],"(",")",["T_OBJECT_OPERATOR","->",606],["T_STRING","setLastAddedProductId",606],"(",["T_VARIABLE","$productId",606],")",";",["T_WHITESPACE","\n        ",606],["T_RETURN","return",607],["T_WHITESPACE"," ",607],["T_VARIABLE","$result",607],";",["T_WHITESPACE","\n    ",607],"}",["T_WHITESPACE","\n",608],"}",["T_WHITESPACE","\n",609]]