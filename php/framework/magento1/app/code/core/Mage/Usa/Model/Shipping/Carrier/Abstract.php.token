[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Usa\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Abstract USA shipping carrier model\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_ABSTRACT","abstract",32],["T_WHITESPACE"," ",32],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Usa_Model_Shipping_Carrier_Abstract",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Shipping_Model_Carrier_Abstract",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n\n    ",33],["T_CONST","const",35],["T_WHITESPACE"," ",35],["T_STRING","USA_COUNTRY_ID",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'US'",35],";",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","PUERTORICO_COUNTRY_ID",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'PR'",36],";",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","GUAM_COUNTRY_ID",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'GU'",37],";",["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","GUAM_REGION_CODE",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'GU'",38],";",["T_WHITESPACE","\n\n    ",38],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_STATIC","static",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_quotesCache",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_ARRAY","array",40],"(",")",";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Flag for check carriers for activity\n     *\n     * @var string\n     *\/",42],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$_activeFlag",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'active'",47],";",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Set flag for check carriers for activity\n     *\n     * @param string $code\n     * @return Mage_Usa_Model_Shipping_Carrier_Abstract\n     *\/",49],["T_WHITESPACE","\n    ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","setActiveFlag",55],"(",["T_VARIABLE","$code",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'active'",55],")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_activeFlag",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$code",57],";",["T_WHITESPACE","\n        ",57],["T_RETURN","return",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],";",["T_WHITESPACE","\n    ",58],"}",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * Return code of carrier\n     *\n     * @return string\n     *\/",61],["T_WHITESPACE","\n    ",65],["T_PUBLIC","public",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","getCarrierCode",66],"(",")",["T_WHITESPACE","\n    ",66],"{",["T_WHITESPACE","\n        ",67],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_ISSET","isset",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_code",68],")",["T_WHITESPACE"," ",68],"?",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_code",68],["T_WHITESPACE"," ",68],":",["T_WHITESPACE"," ",68],["T_STRING","null",68],";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n\n    ",69],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","getTrackingInfo",71],"(",["T_VARIABLE","$tracking",71],")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$info",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",")",";",["T_WHITESPACE","\n\n        ",73],["T_VARIABLE","$result",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getTracking",75],"(",["T_VARIABLE","$tracking",75],")",";",["T_WHITESPACE","\n\n        ",75],["T_IF","if",77],"(",["T_VARIABLE","$result",77],["T_WHITESPACE"," ",77],["T_INSTANCEOF","instanceof",77],["T_WHITESPACE"," ",77],["T_STRING","Mage_Shipping_Model_Tracking_Result",77],")","{",["T_WHITESPACE","\n            ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(",["T_VARIABLE","$trackings",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$result",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getAllTrackings",78],"(",")",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n                ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$trackings",79],"[",["T_LNUMBER","0",79],"]",";",["T_WHITESPACE","\n            ",79],"}",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n        ",81],["T_ELSEIF","elseif",82],["T_WHITESPACE"," ",82],"(",["T_STRING","is_string",82],"(",["T_VARIABLE","$result",82],")",["T_WHITESPACE"," ",82],["T_BOOLEAN_AND","&&",82],["T_WHITESPACE"," ",82],"!",["T_EMPTY","empty",82],"(",["T_VARIABLE","$result",82],")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$result",83],";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n\n        ",84],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_STRING","false",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Check if carrier has shipping tracking option available\n     * All Mage_Usa carriers have shipping tracking option available\n     *\n     * @return boolean\n     *\/",89],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","isTrackingAvailable",95],"(",")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_STRING","true",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Check if city option required\n     *\n     * @return boolean\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","isCityRequired",105],"(",")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_STRING","true",107],";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Determine whether zip-code is required for the country of destination\n     *\n     * @param string|null $countryId\n     * @return bool\n     *\/",110],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","isZipCodeRequired",116],"(",["T_VARIABLE","$countryId",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","null",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$countryId",118],["T_WHITESPACE"," ",118],["T_IS_NOT_EQUAL","!=",118],["T_WHITESPACE"," ",118],["T_STRING","null",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],"!",["T_STRING","Mage",119],["T_DOUBLE_COLON","::",119],["T_STRING","helper",119],"(",["T_CONSTANT_ENCAPSED_STRING","'directory'",119],")",["T_OBJECT_OPERATOR","->",119],["T_STRING","isZipCodeOptional",119],"(",["T_VARIABLE","$countryId",119],")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n        ",120],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_STRING","true",121],";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Check if carrier has shipping label option available\n     *\n     * @return boolean\n     *\/",124],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","isShippingLabelsAvailable",129],"(",")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_RETURN","return",131],["T_WHITESPACE"," ",131],["T_STRING","true",131],";",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Return items for further shipment rate evaluation. We need to pass children of a bundle instead passing the\n     * bundle itself, otherwise we may not get a rate at all (e.g. when total weight of a bundle exceeds max weight\n     * despite each item by itself is not)\n     *\n     * @param Mage_Shipping_Model_Rate_Request $request\n     * @return array\n     *\/",134],["T_WHITESPACE","\n    ",141],["T_PUBLIC","public",142],["T_WHITESPACE"," ",142],["T_FUNCTION","function",142],["T_WHITESPACE"," ",142],["T_STRING","getAllItems",142],"(",["T_STRING","Mage_Shipping_Model_Rate_Request",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$request",142],")",["T_WHITESPACE","\n    ",142],"{",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$items",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_ARRAY","array",144],"(",")",";",["T_WHITESPACE","\n        ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$request",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getAllItems",145],"(",")",")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_FOREACH","foreach",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$request",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getAllItems",146],"(",")",["T_WHITESPACE"," ",146],["T_AS","as",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$item",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n                ",146],["T_COMMENT","\/* @var $item Mage_Sales_Model_Quote_Item *\/",147],["T_WHITESPACE","\n                ",147],["T_IF","if",148],["T_WHITESPACE"," ",148],"(",["T_VARIABLE","$item",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getProduct",148],"(",")",["T_OBJECT_OPERATOR","->",148],["T_STRING","isVirtual",148],"(",")",["T_WHITESPACE"," ",148],["T_BOOLEAN_OR","||",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$item",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getParentItem",148],"(",")",")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n                    ",148],["T_COMMENT","\/\/ Don't process children here - we will process (or already have processed) them below\n",149],["T_WHITESPACE","                    ",150],["T_CONTINUE","continue",150],";",["T_WHITESPACE","\n                ",150],"}",["T_WHITESPACE","\n\n                ",151],["T_IF","if",153],["T_WHITESPACE"," ",153],"(",["T_VARIABLE","$item",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getHasChildren",153],"(",")",["T_WHITESPACE"," ",153],["T_BOOLEAN_AND","&&",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$item",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","isShipSeparately",153],"(",")",")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                    ",153],["T_FOREACH","foreach",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$item",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getChildren",154],"(",")",["T_WHITESPACE"," ",154],["T_AS","as",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$child",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n                        ",154],["T_IF","if",155],["T_WHITESPACE"," ",155],"(","!",["T_VARIABLE","$child",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getFreeShipping",155],"(",")",["T_WHITESPACE"," ",155],["T_BOOLEAN_AND","&&",155],["T_WHITESPACE"," ",155],"!",["T_VARIABLE","$child",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getProduct",155],"(",")",["T_OBJECT_OPERATOR","->",155],["T_STRING","isVirtual",155],"(",")",")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n                            ",155],["T_VARIABLE","$items",156],"[","]",["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$child",156],";",["T_WHITESPACE","\n                        ",156],"}",["T_WHITESPACE","\n                    ",157],"}",["T_WHITESPACE","\n                ",158],"}",["T_WHITESPACE"," ",159],["T_ELSE","else",159],["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                    ",159],["T_COMMENT","\/\/ Ship together - count compound item as one solid\n",160],["T_WHITESPACE","                    ",161],["T_VARIABLE","$items",161],"[","]",["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$item",161],";",["T_WHITESPACE","\n                ",161],"}",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE","\n        ",163],"}",["T_WHITESPACE","\n        ",164],["T_RETURN","return",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$items",165],";",["T_WHITESPACE","\n    ",165],"}",["T_WHITESPACE","\n\n    ",166],["T_DOC_COMMENT","\/**\n     * Processing additional validation to check if carrier applicable.\n     *\n     * @param Mage_Shipping_Model_Rate_Request $request\n     * @return Mage_Shipping_Model_Carrier_Abstract|Mage_Shipping_Model_Rate_Result_Error|boolean\n     *\/",168],["T_WHITESPACE","\n    ",173],["T_PUBLIC","public",174],["T_WHITESPACE"," ",174],["T_FUNCTION","function",174],["T_WHITESPACE"," ",174],["T_STRING","proccessAdditionalValidation",174],"(",["T_STRING","Mage_Shipping_Model_Rate_Request",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$request",174],")",["T_WHITESPACE","\n    ",174],"{",["T_WHITESPACE","\n        ",175],["T_COMMENT","\/\/Skip by item validation if there is no items in request\n",176],["T_WHITESPACE","        ",177],["T_IF","if",177],"(","!",["T_STRING","count",177],"(",["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getAllItems",177],"(",["T_VARIABLE","$request",177],")",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE","\n\n        ",179],["T_VARIABLE","$maxAllowedWeight",181],["T_WHITESPACE","   ",181],"=",["T_WHITESPACE"," ",181],["T_DOUBLE_CAST","(float)",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getConfigData",181],"(",["T_CONSTANT_ENCAPSED_STRING","'max_package_weight'",181],")",";",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$errorMsg",182],["T_WHITESPACE","           ",182],"=",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","''",182],";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$configErrorMsg",183],["T_WHITESPACE","     ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getConfigData",183],"(",["T_CONSTANT_ENCAPSED_STRING","'specificerrmsg'",183],")",";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$defaultErrorMsg",184],["T_WHITESPACE","    ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","helper",184],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",184],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","__",184],"(",["T_CONSTANT_ENCAPSED_STRING","'The shipping module is not available.'",184],")",";",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$showMethod",185],["T_WHITESPACE","         ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getConfigData",185],"(",["T_CONSTANT_ENCAPSED_STRING","'showmethod'",185],")",";",["T_WHITESPACE","\n\n        ",185],["T_FOREACH","foreach",187],["T_WHITESPACE"," ",187],"(",["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getAllItems",187],"(",["T_VARIABLE","$request",187],")",["T_WHITESPACE"," ",187],["T_AS","as",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$item",187],")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_IF","if",188],["T_WHITESPACE"," ",188],"(",["T_VARIABLE","$item",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getProduct",188],"(",")",["T_WHITESPACE"," ",188],["T_BOOLEAN_AND","&&",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$item",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getProduct",188],"(",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","getId",188],"(",")",")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n                ",188],["T_VARIABLE","$weight",189],["T_WHITESPACE","         ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$item",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getProduct",189],"(",")",["T_OBJECT_OPERATOR","->",189],["T_STRING","getWeight",189],"(",")",";",["T_WHITESPACE","\n                ",189],["T_VARIABLE","$stockItem",190],["T_WHITESPACE","      ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$item",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getProduct",190],"(",")",["T_OBJECT_OPERATOR","->",190],["T_STRING","getStockItem",190],"(",")",";",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$doValidation",191],["T_WHITESPACE","   ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","true",191],";",["T_WHITESPACE","\n\n                ",191],["T_IF","if",193],["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$stockItem",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getIsQtyDecimal",193],"(",")",["T_WHITESPACE"," ",193],["T_BOOLEAN_AND","&&",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$stockItem",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getIsDecimalDivided",193],"(",")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n                    ",193],["T_IF","if",194],["T_WHITESPACE"," ",194],"(",["T_VARIABLE","$stockItem",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getEnableQtyIncrements",194],"(",")",["T_WHITESPACE"," ",194],["T_BOOLEAN_AND","&&",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$stockItem",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getQtyIncrements",194],"(",")",")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n                        ",194],["T_VARIABLE","$weight",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$weight",195],["T_WHITESPACE"," ",195],"*",["T_WHITESPACE"," ",195],["T_VARIABLE","$stockItem",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getQtyIncrements",195],"(",")",";",["T_WHITESPACE","\n                    ",195],"}",["T_WHITESPACE"," ",196],["T_ELSE","else",196],["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n                        ",196],["T_VARIABLE","$doValidation",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","false",197],";",["T_WHITESPACE","\n                    ",197],"}",["T_WHITESPACE","\n                ",198],"}",["T_WHITESPACE"," ",199],["T_ELSEIF","elseif",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$stockItem",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getIsQtyDecimal",199],"(",")",["T_WHITESPACE"," ",199],["T_BOOLEAN_AND","&&",199],["T_WHITESPACE"," ",199],"!",["T_VARIABLE","$stockItem",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getIsDecimalDivided",199],"(",")",")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n                    ",199],["T_VARIABLE","$weight",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$weight",200],["T_WHITESPACE"," ",200],"*",["T_WHITESPACE"," ",200],["T_VARIABLE","$item",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getQty",200],"(",")",";",["T_WHITESPACE","\n                ",200],"}",["T_WHITESPACE","\n\n                ",201],["T_IF","if",203],["T_WHITESPACE"," ",203],"(",["T_VARIABLE","$doValidation",203],["T_WHITESPACE"," ",203],["T_BOOLEAN_AND","&&",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$weight",203],["T_WHITESPACE"," ",203],">",["T_WHITESPACE"," ",203],["T_VARIABLE","$maxAllowedWeight",203],")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n                    ",203],["T_VARIABLE","$errorMsg",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],"(",["T_VARIABLE","$configErrorMsg",204],")",["T_WHITESPACE"," ",204],"?",["T_WHITESPACE"," ",204],["T_VARIABLE","$configErrorMsg",204],["T_WHITESPACE"," ",204],":",["T_WHITESPACE"," ",204],["T_VARIABLE","$defaultErrorMsg",204],";",["T_WHITESPACE","\n                    ",204],["T_BREAK","break",205],";",["T_WHITESPACE","\n                ",205],"}",["T_WHITESPACE","\n            ",206],"}",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n\n        ",208],["T_IF","if",210],["T_WHITESPACE"," ",210],"(","!",["T_VARIABLE","$errorMsg",210],["T_WHITESPACE"," ",210],["T_BOOLEAN_AND","&&",210],["T_WHITESPACE"," ",210],"!",["T_VARIABLE","$request",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getDestPostcode",210],"(",")",["T_WHITESPACE"," ",210],["T_BOOLEAN_AND","&&",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","isZipCodeRequired",210],"(",["T_VARIABLE","$request",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getDestCountryId",210],"(",")",")",")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$errorMsg",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_STRING","Mage",211],["T_DOUBLE_COLON","::",211],["T_STRING","helper",211],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",211],")",["T_OBJECT_OPERATOR","->",211],["T_STRING","__",211],"(",["T_CONSTANT_ENCAPSED_STRING","'This shipping method is not available, please specify ZIP-code'",211],")",";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE","\n\n        ",212],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$errorMsg",214],["T_WHITESPACE"," ",214],["T_BOOLEAN_AND","&&",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$showMethod",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$error",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_STRING","Mage",215],["T_DOUBLE_COLON","::",215],["T_STRING","getModel",215],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping\/rate_result_error'",215],")",";",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$error",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","setCarrier",216],"(",["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_code",216],")",";",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$error",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","setCarrierTitle",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getConfigData",217],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",217],")",")",";",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$error",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","setErrorMessage",218],"(",["T_VARIABLE","$errorMsg",218],")",";",["T_WHITESPACE","\n            ",218],["T_RETURN","return",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$error",219],";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE"," ",220],["T_ELSEIF","elseif",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$errorMsg",220],")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_STRING","false",221],";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE","\n        ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Returns cache key for some request to carrier quotes service\n     *\n     * @param string|array $requestParams\n     * @return string\n     *\/",226],["T_WHITESPACE","\n    ",231],["T_PROTECTED","protected",232],["T_WHITESPACE"," ",232],["T_FUNCTION","function",232],["T_WHITESPACE"," ",232],["T_STRING","_getQuotesCacheKey",232],"(",["T_VARIABLE","$requestParams",232],")",["T_WHITESPACE","\n    ",232],"{",["T_WHITESPACE","\n        ",233],["T_IF","if",234],["T_WHITESPACE"," ",234],"(",["T_STRING","is_array",234],"(",["T_VARIABLE","$requestParams",234],")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$requestParams",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_STRING","implode",235],"(",["T_CONSTANT_ENCAPSED_STRING","','",235],",",["T_WHITESPACE"," ",235],["T_STRING","array_merge",235],"(",["T_WHITESPACE","\n                ",235],["T_ARRAY","array",236],"(",["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getCarrierCode",236],"(",")",")",",",["T_WHITESPACE","\n                ",236],["T_STRING","array_keys",237],"(",["T_VARIABLE","$requestParams",237],")",",",["T_WHITESPACE","\n                ",237],["T_VARIABLE","$requestParams",238],")",["T_WHITESPACE","\n            ",238],")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n        ",240],["T_RETURN","return",241],["T_WHITESPACE"," ",241],["T_STRING","crc32",241],"(",["T_VARIABLE","$requestParams",241],")",";",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n\n    ",242],["T_DOC_COMMENT","\/**\n     * Checks whether some request to rates have already been done, so we have cache for it\n     * Used to reduce number of same requests done to carrier service during one session\n     *\n     * Returns cached response or null\n     *\n     * @param string|array $requestParams\n     * @return null|string\n     *\/",244],["T_WHITESPACE","\n    ",252],["T_PROTECTED","protected",253],["T_WHITESPACE"," ",253],["T_FUNCTION","function",253],["T_WHITESPACE"," ",253],["T_STRING","_getCachedQuotes",253],"(",["T_VARIABLE","$requestParams",253],")",["T_WHITESPACE","\n    ",253],"{",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$key",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","_getQuotesCacheKey",255],"(",["T_VARIABLE","$requestParams",255],")",";",["T_WHITESPACE","\n        ",255],["T_RETURN","return",256],["T_WHITESPACE"," ",256],["T_ISSET","isset",256],"(",["T_STRING","self",256],["T_DOUBLE_COLON","::",256],["T_VARIABLE","$_quotesCache",256],"[",["T_VARIABLE","$key",256],"]",")",["T_WHITESPACE"," ",256],"?",["T_WHITESPACE"," ",256],["T_STRING","self",256],["T_DOUBLE_COLON","::",256],["T_VARIABLE","$_quotesCache",256],"[",["T_VARIABLE","$key",256],"]",["T_WHITESPACE"," ",256],":",["T_WHITESPACE"," ",256],["T_STRING","null",256],";",["T_WHITESPACE","\n    ",256],"}",["T_WHITESPACE","\n\n    ",257],["T_DOC_COMMENT","\/**\n     * Sets received carrier quotes to cache\n     *\n     * @param string|array $requestParams\n     * @param string $response\n     * @return Mage_Usa_Model_Shipping_Carrier_Abstract\n     *\/",259],["T_WHITESPACE","\n    ",265],["T_PROTECTED","protected",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","_setCachedQuotes",266],"(",["T_VARIABLE","$requestParams",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$response",266],")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$key",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_getQuotesCacheKey",268],"(",["T_VARIABLE","$requestParams",268],")",";",["T_WHITESPACE","\n        ",268],["T_STRING","self",269],["T_DOUBLE_COLON","::",269],["T_VARIABLE","$_quotesCache",269],"[",["T_VARIABLE","$key",269],"]",["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$response",269],";",["T_WHITESPACE","\n        ",269],["T_RETURN","return",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],";",["T_WHITESPACE","\n    ",270],"}",["T_WHITESPACE","\n\n    ",271],["T_DOC_COMMENT","\/**\n     * Prepare service name. Strip tags and entities from name\n     *\n     * @param string|object $name  service name or object with implemented __toString() method\n     * @return string              prepared service name\n     *\/",273],["T_WHITESPACE","\n    ",278],["T_PROTECTED","protected",279],["T_WHITESPACE"," ",279],["T_FUNCTION","function",279],["T_WHITESPACE"," ",279],["T_STRING","_prepareServiceName",279],"(",["T_VARIABLE","$name",279],")",["T_WHITESPACE","\n    ",279],"{",["T_WHITESPACE","\n        ",280],["T_VARIABLE","$name",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","html_entity_decode",281],"(",["T_STRING_CAST","(string)",281],["T_VARIABLE","$name",281],")",";",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$name",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_STRING","strip_tags",282],"(",["T_STRING","preg_replace",282],"(",["T_CONSTANT_ENCAPSED_STRING","'#&\\w+;#'",282],",",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","''",282],",",["T_WHITESPACE"," ",282],["T_VARIABLE","$name",282],")",")",";",["T_WHITESPACE","\n        ",282],["T_RETURN","return",283],["T_WHITESPACE"," ",283],["T_STRING","trim",283],"(",["T_VARIABLE","$name",283],")",";",["T_WHITESPACE","\n    ",283],"}",["T_WHITESPACE","\n\n    ",284],["T_DOC_COMMENT","\/**\n     * Prepare shipment request.\n     * Validate and correct request information\n     *\n     * @param Varien_Object $request\n     *\n     *\/",286],["T_WHITESPACE","\n    ",292],["T_PROTECTED","protected",293],["T_WHITESPACE"," ",293],["T_FUNCTION","function",293],["T_WHITESPACE"," ",293],["T_STRING","_prepareShipmentRequest",293],"(",["T_STRING","Varien_Object",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$request",293],")",["T_WHITESPACE","\n    ",293],"{",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$phonePattern",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","'\/[\\s\\_\\-\\(\\)]+\/'",295],";",["T_WHITESPACE","\n        ",295],["T_VARIABLE","$phoneNumber",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$request",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getShipperContactPhoneNumber",296],"(",")",";",["T_WHITESPACE","\n        ",296],["T_VARIABLE","$phoneNumber",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_STRING","preg_replace",297],"(",["T_VARIABLE","$phonePattern",297],",",["T_WHITESPACE"," ",297],["T_CONSTANT_ENCAPSED_STRING","''",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$phoneNumber",297],")",";",["T_WHITESPACE","\n        ",297],["T_VARIABLE","$request",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","setShipperContactPhoneNumber",298],"(",["T_VARIABLE","$phoneNumber",298],")",";",["T_WHITESPACE","\n        ",298],["T_VARIABLE","$phoneNumber",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_VARIABLE","$request",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getRecipientContactPhoneNumber",299],"(",")",";",["T_WHITESPACE","\n        ",299],["T_VARIABLE","$phoneNumber",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_STRING","preg_replace",300],"(",["T_VARIABLE","$phonePattern",300],",",["T_WHITESPACE"," ",300],["T_CONSTANT_ENCAPSED_STRING","''",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$phoneNumber",300],")",";",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$request",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","setRecipientContactPhoneNumber",301],"(",["T_VARIABLE","$phoneNumber",301],")",";",["T_WHITESPACE","\n    ",301],"}",["T_WHITESPACE","\n\n    ",302],["T_DOC_COMMENT","\/**\n     * Do request to shipment\n     *\n     * @param Mage_Shipping_Model_Shipment_Request $request\n     * @return array\n     *\/",304],["T_WHITESPACE","\n    ",309],["T_PUBLIC","public",310],["T_WHITESPACE"," ",310],["T_FUNCTION","function",310],["T_WHITESPACE"," ",310],["T_STRING","requestToShipment",310],"(",["T_STRING","Mage_Shipping_Model_Shipment_Request",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$request",310],")",["T_WHITESPACE","\n    ",310],"{",["T_WHITESPACE","\n        ",311],["T_VARIABLE","$packages",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$request",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","getPackages",312],"(",")",";",["T_WHITESPACE","\n        ",312],["T_IF","if",313],["T_WHITESPACE"," ",313],"(","!",["T_STRING","is_array",313],"(",["T_VARIABLE","$packages",313],")",["T_WHITESPACE"," ",313],["T_BOOLEAN_OR","||",313],["T_WHITESPACE"," ",313],"!",["T_VARIABLE","$packages",313],")",["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n            ",313],["T_STRING","Mage",314],["T_DOUBLE_COLON","::",314],["T_STRING","throwException",314],"(",["T_STRING","Mage",314],["T_DOUBLE_COLON","::",314],["T_STRING","helper",314],"(",["T_CONSTANT_ENCAPSED_STRING","'usa'",314],")",["T_OBJECT_OPERATOR","->",314],["T_STRING","__",314],"(",["T_CONSTANT_ENCAPSED_STRING","'No packages for request'",314],")",")",";",["T_WHITESPACE","\n        ",314],"}",["T_WHITESPACE","\n        ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$request",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getStoreId",316],"(",")",["T_WHITESPACE"," ",316],["T_IS_NOT_EQUAL","!=",316],["T_WHITESPACE"," ",316],["T_STRING","null",316],")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","setStore",317],"(",["T_VARIABLE","$request",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getStoreId",317],"(",")",")",";",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE","\n        ",318],["T_VARIABLE","$data",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_ARRAY","array",319],"(",")",";",["T_WHITESPACE","\n        ",319],["T_FOREACH","foreach",320],["T_WHITESPACE"," ",320],"(",["T_VARIABLE","$packages",320],["T_WHITESPACE"," ",320],["T_AS","as",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$packageId",320],["T_WHITESPACE"," ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$package",320],")",["T_WHITESPACE"," ",320],"{",["T_WHITESPACE","\n            ",320],["T_VARIABLE","$request",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","setPackageId",321],"(",["T_VARIABLE","$packageId",321],")",";",["T_WHITESPACE","\n            ",321],["T_VARIABLE","$request",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","setPackagingType",322],"(",["T_VARIABLE","$package",322],"[",["T_CONSTANT_ENCAPSED_STRING","'params'",322],"]","[",["T_CONSTANT_ENCAPSED_STRING","'container'",322],"]",")",";",["T_WHITESPACE","\n            ",322],["T_VARIABLE","$request",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","setPackageWeight",323],"(",["T_VARIABLE","$package",323],"[",["T_CONSTANT_ENCAPSED_STRING","'params'",323],"]","[",["T_CONSTANT_ENCAPSED_STRING","'weight'",323],"]",")",";",["T_WHITESPACE","\n            ",323],["T_VARIABLE","$request",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","setPackageParams",324],"(",["T_NEW","new",324],["T_WHITESPACE"," ",324],["T_STRING","Varien_Object",324],"(",["T_VARIABLE","$package",324],"[",["T_CONSTANT_ENCAPSED_STRING","'params'",324],"]",")",")",";",["T_WHITESPACE","\n            ",324],["T_VARIABLE","$request",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","setPackageItems",325],"(",["T_VARIABLE","$package",325],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",325],"]",")",";",["T_WHITESPACE","\n            ",325],["T_VARIABLE","$result",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_doShipmentRequest",326],"(",["T_VARIABLE","$request",326],")",";",["T_WHITESPACE","\n\n            ",326],["T_IF","if",328],["T_WHITESPACE"," ",328],"(",["T_VARIABLE","$result",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","hasErrors",328],"(",")",")",["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n                ",328],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","rollBack",329],"(",["T_VARIABLE","$data",329],")",";",["T_WHITESPACE","\n                ",329],["T_BREAK","break",330],";",["T_WHITESPACE","\n            ",330],"}",["T_WHITESPACE"," ",331],["T_ELSE","else",331],["T_WHITESPACE"," ",331],"{",["T_WHITESPACE","\n                ",331],["T_VARIABLE","$data",332],"[","]",["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_ARRAY","array",332],"(",["T_WHITESPACE","\n                    ",332],["T_CONSTANT_ENCAPSED_STRING","'tracking_number'",333],["T_WHITESPACE"," ",333],["T_DOUBLE_ARROW","=>",333],["T_WHITESPACE"," ",333],["T_VARIABLE","$result",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getTrackingNumber",333],"(",")",",",["T_WHITESPACE","\n                    ",333],["T_CONSTANT_ENCAPSED_STRING","'label_content'",334],["T_WHITESPACE","   ",334],["T_DOUBLE_ARROW","=>",334],["T_WHITESPACE"," ",334],["T_VARIABLE","$result",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getShippingLabelContent",334],"(",")",["T_WHITESPACE","\n                ",334],")",";",["T_WHITESPACE","\n            ",335],"}",["T_WHITESPACE","\n            ",336],["T_IF","if",337],["T_WHITESPACE"," ",337],"(","!",["T_ISSET","isset",337],"(",["T_VARIABLE","$isFirstRequest",337],")",")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                ",337],["T_VARIABLE","$request",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","setMasterTrackingId",338],"(",["T_VARIABLE","$result",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getTrackingNumber",338],"(",")",")",";",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$isFirstRequest",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_STRING","false",339],";",["T_WHITESPACE","\n            ",339],"}",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n\n        ",341],["T_VARIABLE","$response",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_NEW","new",343],["T_WHITESPACE"," ",343],["T_STRING","Varien_Object",343],"(",["T_ARRAY","array",343],"(",["T_WHITESPACE","\n            ",343],["T_CONSTANT_ENCAPSED_STRING","'info'",344],["T_WHITESPACE","   ",344],["T_DOUBLE_ARROW","=>",344],["T_WHITESPACE"," ",344],["T_VARIABLE","$data",344],["T_WHITESPACE","\n        ",344],")",")",";",["T_WHITESPACE","\n        ",345],["T_IF","if",346],["T_WHITESPACE"," ",346],"(",["T_VARIABLE","$result",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getErrors",346],"(",")",")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n            ",346],["T_VARIABLE","$response",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","setErrors",347],"(",["T_VARIABLE","$result",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getErrors",347],"(",")",")",";",["T_WHITESPACE","\n        ",347],"}",["T_WHITESPACE","\n        ",348],["T_RETURN","return",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$response",349],";",["T_WHITESPACE","\n    ",349],"}",["T_WHITESPACE","\n\n    ",350],["T_DOC_COMMENT","\/**\n     * Do request to RMA shipment\n     *\n     * @param $request\n     * @return array\n     *\/",352],["T_WHITESPACE","\n    ",357],["T_PUBLIC","public",358],["T_WHITESPACE"," ",358],["T_FUNCTION","function",358],["T_WHITESPACE"," ",358],["T_STRING","returnOfShipment",358],"(",["T_VARIABLE","$request",358],")",["T_WHITESPACE","\n    ",358],"{",["T_WHITESPACE","\n        ",359],["T_VARIABLE","$request",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","setIsReturn",360],"(",["T_STRING","true",360],")",";",["T_WHITESPACE","\n        ",360],["T_VARIABLE","$packages",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_VARIABLE","$request",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getPackages",361],"(",")",";",["T_WHITESPACE","\n        ",361],["T_IF","if",362],["T_WHITESPACE"," ",362],"(","!",["T_STRING","is_array",362],"(",["T_VARIABLE","$packages",362],")",["T_WHITESPACE"," ",362],["T_BOOLEAN_OR","||",362],["T_WHITESPACE"," ",362],"!",["T_VARIABLE","$packages",362],")",["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n            ",362],["T_STRING","Mage",363],["T_DOUBLE_COLON","::",363],["T_STRING","throwException",363],"(",["T_STRING","Mage",363],["T_DOUBLE_COLON","::",363],["T_STRING","helper",363],"(",["T_CONSTANT_ENCAPSED_STRING","'usa'",363],")",["T_OBJECT_OPERATOR","->",363],["T_STRING","__",363],"(",["T_CONSTANT_ENCAPSED_STRING","'No packages for request'",363],")",")",";",["T_WHITESPACE","\n        ",363],"}",["T_WHITESPACE","\n        ",364],["T_IF","if",365],["T_WHITESPACE"," ",365],"(",["T_VARIABLE","$request",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getStoreId",365],"(",")",["T_WHITESPACE"," ",365],["T_IS_NOT_EQUAL","!=",365],["T_WHITESPACE"," ",365],["T_STRING","null",365],")",["T_WHITESPACE"," ",365],"{",["T_WHITESPACE","\n            ",365],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","setStore",366],"(",["T_VARIABLE","$request",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getStoreId",366],"(",")",")",";",["T_WHITESPACE","\n        ",366],"}",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$data",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_ARRAY","array",368],"(",")",";",["T_WHITESPACE","\n        ",368],["T_FOREACH","foreach",369],["T_WHITESPACE"," ",369],"(",["T_VARIABLE","$packages",369],["T_WHITESPACE"," ",369],["T_AS","as",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$packageId",369],["T_WHITESPACE"," ",369],["T_DOUBLE_ARROW","=>",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$package",369],")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$request",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","setPackageId",370],"(",["T_VARIABLE","$packageId",370],")",";",["T_WHITESPACE","\n            ",370],["T_VARIABLE","$request",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","setPackagingType",371],"(",["T_VARIABLE","$package",371],"[",["T_CONSTANT_ENCAPSED_STRING","'params'",371],"]","[",["T_CONSTANT_ENCAPSED_STRING","'container'",371],"]",")",";",["T_WHITESPACE","\n            ",371],["T_VARIABLE","$request",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","setPackageWeight",372],"(",["T_VARIABLE","$package",372],"[",["T_CONSTANT_ENCAPSED_STRING","'params'",372],"]","[",["T_CONSTANT_ENCAPSED_STRING","'weight'",372],"]",")",";",["T_WHITESPACE","\n            ",372],["T_VARIABLE","$request",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","setPackageParams",373],"(",["T_NEW","new",373],["T_WHITESPACE"," ",373],["T_STRING","Varien_Object",373],"(",["T_VARIABLE","$package",373],"[",["T_CONSTANT_ENCAPSED_STRING","'params'",373],"]",")",")",";",["T_WHITESPACE","\n            ",373],["T_VARIABLE","$request",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","setPackageItems",374],"(",["T_VARIABLE","$package",374],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",374],"]",")",";",["T_WHITESPACE","\n            ",374],["T_VARIABLE","$result",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","_doShipmentRequest",375],"(",["T_VARIABLE","$request",375],")",";",["T_WHITESPACE","\n\n            ",375],["T_IF","if",377],["T_WHITESPACE"," ",377],"(",["T_VARIABLE","$result",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","hasErrors",377],"(",")",")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n                ",377],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","rollBack",378],"(",["T_VARIABLE","$data",378],")",";",["T_WHITESPACE","\n                ",378],["T_BREAK","break",379],";",["T_WHITESPACE","\n            ",379],"}",["T_WHITESPACE"," ",380],["T_ELSE","else",380],["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n                ",380],["T_VARIABLE","$data",381],"[","]",["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_ARRAY","array",381],"(",["T_WHITESPACE","\n                    ",381],["T_CONSTANT_ENCAPSED_STRING","'tracking_number'",382],["T_WHITESPACE"," ",382],["T_DOUBLE_ARROW","=>",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$result",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getTrackingNumber",382],"(",")",",",["T_WHITESPACE","\n                    ",382],["T_CONSTANT_ENCAPSED_STRING","'label_content'",383],["T_WHITESPACE","   ",383],["T_DOUBLE_ARROW","=>",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$result",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getShippingLabelContent",383],"(",")",["T_WHITESPACE","\n                ",383],")",";",["T_WHITESPACE","\n            ",384],"}",["T_WHITESPACE","\n            ",385],["T_IF","if",386],["T_WHITESPACE"," ",386],"(","!",["T_ISSET","isset",386],"(",["T_VARIABLE","$isFirstRequest",386],")",")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n                ",386],["T_VARIABLE","$request",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","setMasterTrackingId",387],"(",["T_VARIABLE","$result",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getTrackingNumber",387],"(",")",")",";",["T_WHITESPACE","\n                ",387],["T_VARIABLE","$isFirstRequest",388],["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_STRING","false",388],";",["T_WHITESPACE","\n            ",388],"}",["T_WHITESPACE","\n        ",389],"}",["T_WHITESPACE","\n\n        ",390],["T_VARIABLE","$response",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_NEW","new",392],["T_WHITESPACE"," ",392],["T_STRING","Varien_Object",392],"(",["T_ARRAY","array",392],"(",["T_WHITESPACE","\n            ",392],["T_CONSTANT_ENCAPSED_STRING","'info'",393],["T_WHITESPACE","   ",393],["T_DOUBLE_ARROW","=>",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$data",393],["T_WHITESPACE","\n        ",393],")",")",";",["T_WHITESPACE","\n        ",394],["T_IF","if",395],["T_WHITESPACE"," ",395],"(",["T_VARIABLE","$result",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getErrors",395],"(",")",")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n            ",395],["T_VARIABLE","$response",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","setErrors",396],"(",["T_VARIABLE","$result",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getErrors",396],"(",")",")",";",["T_WHITESPACE","\n        ",396],"}",["T_WHITESPACE","\n        ",397],["T_RETURN","return",398],["T_WHITESPACE"," ",398],["T_VARIABLE","$response",398],";",["T_WHITESPACE","\n    ",398],"}",["T_WHITESPACE","\n\n    ",399],["T_DOC_COMMENT","\/**\n     * For multi package shipments. Delete requested shipments if the current shipment\n     * request is failed\n     *\n     * @todo implement rollback logic\n     * @param array $data\n     * @return bool\n     *\/",401],["T_WHITESPACE","\n    ",408],["T_PUBLIC","public",409],["T_WHITESPACE"," ",409],["T_FUNCTION","function",409],["T_WHITESPACE"," ",409],["T_STRING","rollBack",409],"(",["T_VARIABLE","$data",409],")",["T_WHITESPACE","\n    ",409],"{",["T_WHITESPACE","\n        ",410],["T_RETURN","return",411],["T_WHITESPACE"," ",411],["T_STRING","true",411],";",["T_WHITESPACE","\n    ",411],"}",["T_WHITESPACE","\n\n    ",412],["T_DOC_COMMENT","\/**\n     * Do shipment request to carrier web service, obtain Print Shipping Labels and process errors in response\n     *\n     * @param Varien_Object $request\n     * @return Varien_Object\n     *\/",414],["T_WHITESPACE","\n    ",419],["T_ABSTRACT","abstract",420],["T_WHITESPACE"," ",420],["T_PROTECTED","protected",420],["T_WHITESPACE"," ",420],["T_FUNCTION","function",420],["T_WHITESPACE"," ",420],["T_STRING","_doShipmentRequest",420],"(",["T_STRING","Varien_Object",420],["T_WHITESPACE"," ",420],["T_VARIABLE","$request",420],")",";",["T_WHITESPACE","\n\n    ",420],["T_DOC_COMMENT","\/**\n     * Check is Country U.S. Possessions and Trust Territories\n     *\n     * @param string $countyId\n     * @return boolean\n     *\/",422],["T_WHITESPACE","\n    ",427],["T_PROTECTED","protected",428],["T_WHITESPACE"," ",428],["T_FUNCTION","function",428],["T_WHITESPACE"," ",428],["T_STRING","_isUSCountry",428],"(",["T_VARIABLE","$countyId",428],")",["T_WHITESPACE","\n    ",428],"{",["T_WHITESPACE","\n        ",429],["T_SWITCH","switch",430],["T_WHITESPACE"," ",430],"(",["T_VARIABLE","$countyId",430],")",["T_WHITESPACE"," ",430],"{",["T_WHITESPACE","\n            ",430],["T_CASE","case",431],["T_WHITESPACE"," ",431],["T_CONSTANT_ENCAPSED_STRING","'AS'",431],":",["T_WHITESPACE"," ",431],["T_COMMENT","\/\/ Samoa American\n",431],["T_WHITESPACE","            ",432],["T_CASE","case",432],["T_WHITESPACE"," ",432],["T_CONSTANT_ENCAPSED_STRING","'GU'",432],":",["T_WHITESPACE"," ",432],["T_COMMENT","\/\/ Guam\n",432],["T_WHITESPACE","            ",433],["T_CASE","case",433],["T_WHITESPACE"," ",433],["T_CONSTANT_ENCAPSED_STRING","'MP'",433],":",["T_WHITESPACE"," ",433],["T_COMMENT","\/\/ Northern Mariana Islands\n",433],["T_WHITESPACE","            ",434],["T_CASE","case",434],["T_WHITESPACE"," ",434],["T_CONSTANT_ENCAPSED_STRING","'PW'",434],":",["T_WHITESPACE"," ",434],["T_COMMENT","\/\/ Palau\n",434],["T_WHITESPACE","            ",435],["T_CASE","case",435],["T_WHITESPACE"," ",435],["T_CONSTANT_ENCAPSED_STRING","'PR'",435],":",["T_WHITESPACE"," ",435],["T_COMMENT","\/\/ Puerto Rico\n",435],["T_WHITESPACE","            ",436],["T_CASE","case",436],["T_WHITESPACE"," ",436],["T_CONSTANT_ENCAPSED_STRING","'VI'",436],":",["T_WHITESPACE"," ",436],["T_COMMENT","\/\/ Virgin Islands US\n",436],["T_WHITESPACE","            ",437],["T_CASE","case",437],["T_WHITESPACE"," ",437],["T_CONSTANT_ENCAPSED_STRING","'US'",437],";",["T_WHITESPACE"," ",437],["T_COMMENT","\/\/ United States\n",437],["T_WHITESPACE","                ",438],["T_RETURN","return",438],["T_WHITESPACE"," ",438],["T_STRING","true",438],";",["T_WHITESPACE","\n        ",438],"}",["T_WHITESPACE","\n\n        ",439],["T_RETURN","return",441],["T_WHITESPACE"," ",441],["T_STRING","false",441],";",["T_WHITESPACE","\n    ",441],"}",["T_WHITESPACE","\n\n    ",442],["T_DOC_COMMENT","\/**\n     * Check is Canada\n     *\n     * @param string $countryId\n     * @return boolean\n     *\/",444],["T_WHITESPACE","\n    ",449],["T_PROTECTED","protected",450],["T_WHITESPACE"," ",450],["T_FUNCTION","function",450],["T_WHITESPACE"," ",450],["T_STRING","_isCanada",450],"(",["T_VARIABLE","$countryId",450],")",["T_WHITESPACE","\n    ",450],"{",["T_WHITESPACE","\n        ",451],["T_RETURN","return",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$countryId",452],["T_WHITESPACE"," ",452],["T_IS_EQUAL","==",452],["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","'CA'",452],";",["T_WHITESPACE","\n    ",452],"}",["T_WHITESPACE","\n\n    ",453],["T_DOC_COMMENT","\/**\n     * Check whether girth is allowed for the carrier\n     *\n     * @param null|string $countyDest\n     * @return bool\n     *\/",455],["T_WHITESPACE","\n    ",460],["T_PUBLIC","public",461],["T_WHITESPACE"," ",461],["T_FUNCTION","function",461],["T_WHITESPACE"," ",461],["T_STRING","isGirthAllowed",461],"(",["T_VARIABLE","$countyDest",461],["T_WHITESPACE"," ",461],"=",["T_WHITESPACE"," ",461],["T_STRING","null",461],")",["T_WHITESPACE"," ",461],"{",["T_WHITESPACE","\n        ",461],["T_RETURN","return",462],["T_WHITESPACE"," ",462],["T_STRING","false",462],";",["T_WHITESPACE","\n    ",462],"}",["T_WHITESPACE","\n",463],"}",["T_WHITESPACE","\n",464]]