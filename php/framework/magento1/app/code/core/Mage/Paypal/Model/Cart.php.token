[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * PayPal-specific model for shopping cart items and totals\n * The main idea is to accommodate all possible totals into PayPal-compatible 4 totals and line items\n *\/",27],["T_WHITESPACE","\n",30],["T_CLASS","class",31],["T_WHITESPACE"," ",31],["T_STRING","Mage_Paypal_Model_Cart",31],["T_WHITESPACE","\n",31],"{",["T_WHITESPACE","\n    ",32],["T_DOC_COMMENT","\/**\n     * Totals that PayPal suppports when passing shopping cart\n     *\n     * @var string\n     *\/",33],["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","TOTAL_SUBTOTAL",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'subtotal'",38],";",["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","TOTAL_DISCOUNT",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'discount'",39],";",["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","TOTAL_TAX",40],["T_WHITESPACE","      ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'tax'",40],";",["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","TOTAL_SHIPPING",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'shipping'",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Order or quote instance\n     *\n     * @var Mage_Sales_Model_Order\n     * @var Mage_Sales_Model_Quote\n     *\/",43],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_salesEntity",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","null",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Rendered cart items\n     * Array of Varien_Objects\n     *\n     * @var array\n     *\/",51],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$_items",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_ARRAY","array",57],"(",")",";",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Rendered cart totals\n     * Associative array with the keys from constants above\n     *\n     * @var array\n     *\/",59],["T_WHITESPACE","\n    ",64],["T_PROTECTED","protected",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$_totals",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_ARRAY","array",65],"(",")",";",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Set of optional descriptions for the item that may replace a total and composed of several amounts\n     * Array of strings\n     *\n     * @var array\n     *\/",67],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$_totalLineItemDescriptions",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",")",";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Lazy initialization indicator for rendering\n     *\n     * @var bool\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$_shouldRender",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","true",80],";",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Validation result for the rendered cart items\n     *\n     * @var bool\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$_areItemsValid",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","false",87],";",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Validation result for the rendered totals\n     *\n     * @var bool\n     *\/",89],["T_WHITESPACE","\n    ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$_areTotalsValid",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","false",94],";",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Whether to render discount total as a line item\n     * Use case: WPP\n     *\n     * @var bool\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$_isDiscountAsItem",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","false",102],";",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Whether to render shipping total as a line item\n     * Use case: WPS\n     *\n     * @var bool\n     *\/",104],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$_isShippingAsItem",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_STRING","false",110],";",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Require instance of an order or a quote\n     *\n     * @param array $params\n     *\/",112],["T_WHITESPACE","\n    ",116],["T_PUBLIC","public",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","__construct",117],"(",["T_VARIABLE","$params",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",")",")",["T_WHITESPACE","\n    ",117],"{",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$salesEntity",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","array_shift",119],"(",["T_VARIABLE","$params",119],")",";",["T_WHITESPACE","\n        ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_STRING","is_object",120],"(",["T_VARIABLE","$salesEntity",120],")",["T_WHITESPACE","\n            ",120],["T_BOOLEAN_AND","&&",121],["T_WHITESPACE"," ",121],"(","(",["T_VARIABLE","$salesEntity",121],["T_WHITESPACE"," ",121],["T_INSTANCEOF","instanceof",121],["T_WHITESPACE"," ",121],["T_STRING","Mage_Sales_Model_Order",121],")",["T_WHITESPACE"," ",121],["T_BOOLEAN_OR","||",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$salesEntity",121],["T_WHITESPACE"," ",121],["T_INSTANCEOF","instanceof",121],["T_WHITESPACE"," ",121],["T_STRING","Mage_Sales_Model_Quote",121],")",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_salesEntity",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$salesEntity",122],";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE"," ",123],["T_ELSE","else",123],["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_THROW","throw",124],["T_WHITESPACE"," ",124],["T_NEW","new",124],["T_WHITESPACE"," ",124],["T_STRING","Exception",124],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid sales entity provided.'",124],")",";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Getter for the current sales entity\n     *\n     * @return Mage_Sales_Model_Order\n     * @return Mage_Sales_Model_Quote\n     *\/",128],["T_WHITESPACE","\n    ",133],["T_PUBLIC","public",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","getSalesEntity",134],"(",")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_RETURN","return",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_salesEntity",136],";",["T_WHITESPACE","\n    ",136],"}",["T_WHITESPACE","\n\n    ",137],["T_DOC_COMMENT","\/**\n     * Render and get line items\n     * By default returns false if the items are invalid\n     *\n     * @param bool $bypassValidation\n     * @return array|false\n     *\/",139],["T_WHITESPACE","\n    ",145],["T_PUBLIC","public",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","getItems",146],"(",["T_VARIABLE","$bypassValidation",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","false",146],")",["T_WHITESPACE","\n    ",146],"{",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_render",148],"(",")",";",["T_WHITESPACE","\n        ",148],["T_IF","if",149],["T_WHITESPACE"," ",149],"(","!",["T_VARIABLE","$bypassValidation",149],["T_WHITESPACE"," ",149],["T_BOOLEAN_AND","&&",149],["T_WHITESPACE"," ",149],"!",["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_areItemsValid",149],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_STRING","false",150],";",["T_WHITESPACE","\n        ",150],"}",["T_WHITESPACE","\n        ",151],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_items",152],";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_DOC_COMMENT","\/**\n     * Render and get totals\n     * If the totals are invalid for any reason, they will be merged into one amount (subtotal is utilized for it)\n     * An option to substract discount from the subtotal is available\n     *\n     * @param bool $mergeDiscount\n     * @return array\n     *\/",155],["T_WHITESPACE","\n    ",162],["T_PUBLIC","public",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","getTotals",163],"(",["T_VARIABLE","$mergeDiscount",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_STRING","false",163],")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_render",165],"(",")",";",["T_WHITESPACE","\n\n        ",165],["T_COMMENT","\/\/ cut down totals to one total if they are invalid\n",167],["T_WHITESPACE","        ",168],["T_IF","if",168],["T_WHITESPACE"," ",168],"(","!",["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_areTotalsValid",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$totals",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_ARRAY","array",169],"(",["T_WHITESPACE","\n                ",169],["T_STRING","self",170],["T_DOUBLE_COLON","::",170],["T_STRING","TOTAL_SUBTOTAL",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_totals",170],"[",["T_STRING","self",170],["T_DOUBLE_COLON","::",170],["T_STRING","TOTAL_SUBTOTAL",170],"]",["T_WHITESPACE"," ",170],"+",["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_totals",170],"[",["T_STRING","self",170],["T_DOUBLE_COLON","::",170],["T_STRING","TOTAL_TAX",170],"]",["T_WHITESPACE","\n            ",170],")",";",["T_WHITESPACE","\n            ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(","!",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_isShippingAsItem",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n                ",172],["T_VARIABLE","$totals",173],"[",["T_STRING","self",173],["T_DOUBLE_COLON","::",173],["T_STRING","TOTAL_SUBTOTAL",173],"]",["T_WHITESPACE"," ",173],["T_PLUS_EQUAL","+=",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_totals",173],"[",["T_STRING","self",173],["T_DOUBLE_COLON","::",173],["T_STRING","TOTAL_SHIPPING",173],"]",";",["T_WHITESPACE","\n            ",173],"}",["T_WHITESPACE","\n            ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(","!",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_isDiscountAsItem",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$totals",176],"[",["T_STRING","self",176],["T_DOUBLE_COLON","::",176],["T_STRING","TOTAL_SUBTOTAL",176],"]",["T_WHITESPACE"," ",176],["T_MINUS_EQUAL","-=",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_totals",176],"[",["T_STRING","self",176],["T_DOUBLE_COLON","::",176],["T_STRING","TOTAL_DISCOUNT",176],"]",";",["T_WHITESPACE","\n            ",176],"}",["T_WHITESPACE","\n            ",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$totals",178],";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE"," ",179],["T_ELSEIF","elseif",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$mergeDiscount",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n            ",179],["T_VARIABLE","$totals",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_totals",180],";",["T_WHITESPACE","\n            ",180],["T_UNSET","unset",181],"(",["T_VARIABLE","$totals",181],"[",["T_STRING","self",181],["T_DOUBLE_COLON","::",181],["T_STRING","TOTAL_DISCOUNT",181],"]",")",";",["T_WHITESPACE","\n            ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(","!",["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_isDiscountAsItem",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n                ",182],["T_VARIABLE","$totals",183],"[",["T_STRING","self",183],["T_DOUBLE_COLON","::",183],["T_STRING","TOTAL_SUBTOTAL",183],"]",["T_WHITESPACE"," ",183],["T_MINUS_EQUAL","-=",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","_totals",183],"[",["T_STRING","self",183],["T_DOUBLE_COLON","::",183],["T_STRING","TOTAL_DISCOUNT",183],"]",";",["T_WHITESPACE","\n            ",183],"}",["T_WHITESPACE","\n            ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$totals",185],";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n        ",186],["T_RETURN","return",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_totals",187],";",["T_WHITESPACE","\n    ",187],"}",["T_WHITESPACE","\n\n    ",188],["T_DOC_COMMENT","\/**\n     * Add a line item\n     *\n     * @param string $name\n     * @param numeric $qty\n     * @param float $amount\n     * @param string $identifier\n     * @return Varien_Object\n     *\/",190],["T_WHITESPACE","\n    ",198],["T_PUBLIC","public",199],["T_WHITESPACE"," ",199],["T_FUNCTION","function",199],["T_WHITESPACE"," ",199],["T_STRING","addItem",199],"(",["T_VARIABLE","$name",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$qty",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$amount",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$identifier",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_STRING","null",199],")",["T_WHITESPACE","\n    ",199],"{",["T_WHITESPACE","\n        ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_shouldRender",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","true",201],";",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$item",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_NEW","new",202],["T_WHITESPACE"," ",202],["T_STRING","Varien_Object",202],"(",["T_ARRAY","array",202],"(",["T_WHITESPACE","\n            ",202],["T_CONSTANT_ENCAPSED_STRING","'name'",203],["T_WHITESPACE","   ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$name",203],",",["T_WHITESPACE","\n            ",203],["T_CONSTANT_ENCAPSED_STRING","'qty'",204],["T_WHITESPACE","    ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$qty",204],",",["T_WHITESPACE","\n            ",204],["T_CONSTANT_ENCAPSED_STRING","'amount'",205],["T_WHITESPACE"," ",205],["T_DOUBLE_ARROW","=>",205],["T_WHITESPACE"," ",205],["T_DOUBLE_CAST","(float)",205],["T_VARIABLE","$amount",205],",",["T_WHITESPACE","\n        ",205],")",")",";",["T_WHITESPACE","\n        ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$identifier",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$item",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","setData",208],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$identifier",208],")",";",["T_WHITESPACE","\n        ",208],"}",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","_items",210],"[","]",["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$item",210],";",["T_WHITESPACE","\n        ",210],["T_RETURN","return",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$item",211],";",["T_WHITESPACE","\n    ",211],"}",["T_WHITESPACE","\n\n    ",212],["T_DOC_COMMENT","\/**\n     * Remove item from cart by identifier\n     *\n     * @param string $identifier\n     * @return bool\n     *\/",214],["T_WHITESPACE","\n    ",219],["T_PUBLIC","public",220],["T_WHITESPACE"," ",220],["T_FUNCTION","function",220],["T_WHITESPACE"," ",220],["T_STRING","removeItem",220],"(",["T_VARIABLE","$identifier",220],")",["T_WHITESPACE","\n    ",220],"{",["T_WHITESPACE","\n        ",221],["T_FOREACH","foreach",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_items",222],["T_WHITESPACE"," ",222],["T_AS","as",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$key",222],["T_WHITESPACE"," ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$item",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$item",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getId",223],"(",")",["T_WHITESPACE"," ",223],["T_IS_EQUAL","==",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$identifier",223],")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_UNSET","unset",224],"(",["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_items",224],"[",["T_VARIABLE","$key",224],"]",")",";",["T_WHITESPACE","\n                ",224],["T_RETURN","return",225],["T_WHITESPACE"," ",225],["T_STRING","true",225],";",["T_WHITESPACE","\n            ",225],"}",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE","\n        ",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_STRING","false",228],";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_DOC_COMMENT","\/**\n     * Compound the specified amount with the specified total\n     *\n     * @param string $code\n     * @param float $amount\n     * @param string $lineItemDescription\n     * @return Mage_Paypal_Model_Cart\n     *\/",231],["T_WHITESPACE","\n    ",238],["T_PUBLIC","public",239],["T_WHITESPACE"," ",239],["T_FUNCTION","function",239],["T_WHITESPACE"," ",239],["T_STRING","updateTotal",239],"(",["T_VARIABLE","$code",239],",",["T_WHITESPACE"," ",239],["T_VARIABLE","$amount",239],",",["T_WHITESPACE"," ",239],["T_VARIABLE","$lineItemDescription",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_STRING","null",239],")",["T_WHITESPACE","\n    ",239],"{",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_shouldRender",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_STRING","true",241],";",["T_WHITESPACE","\n        ",241],["T_IF","if",242],["T_WHITESPACE"," ",242],"(",["T_ISSET","isset",242],"(",["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","_totals",242],"[",["T_VARIABLE","$code",242],"]",")",")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_totals",243],"[",["T_VARIABLE","$code",243],"]",["T_WHITESPACE"," ",243],["T_PLUS_EQUAL","+=",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$amount",243],";",["T_WHITESPACE","\n            ",243],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_VARIABLE","$lineItemDescription",244],")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n                ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","_totalLineItemDescriptions",245],"[",["T_VARIABLE","$code",245],"]","[","]",["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$lineItemDescription",245],";",["T_WHITESPACE","\n            ",245],"}",["T_WHITESPACE","\n        ",246],"}",["T_WHITESPACE","\n        ",247],["T_RETURN","return",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],";",["T_WHITESPACE","\n    ",248],"}",["T_WHITESPACE","\n\n    ",249],["T_DOC_COMMENT","\/**\n     * Get\/Set whether to render the discount total as a line item\n     *\n     * @param $setValue\n     * @return bool|Mage_Paypal_Model_Cart\n     *\/",251],["T_WHITESPACE","\n    ",256],["T_PUBLIC","public",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","isDiscountAsItem",257],"(",["T_VARIABLE","$setValue",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","null",257],")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_RETURN","return",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_totalAsItem",259],"(",["T_CONSTANT_ENCAPSED_STRING","'_isDiscountAsItem'",259],",",["T_WHITESPACE"," ",259],["T_VARIABLE","$setValue",259],")",";",["T_WHITESPACE","\n    ",259],"}",["T_WHITESPACE","\n\n    ",260],["T_DOC_COMMENT","\/**\n     * Get\/Set whether to render the discount total as a line item\n     *\n     * @param $setValue\n     * @return bool|Mage_Paypal_Model_Cart\n     *\/",262],["T_WHITESPACE","\n    ",267],["T_PUBLIC","public",268],["T_WHITESPACE"," ",268],["T_FUNCTION","function",268],["T_WHITESPACE"," ",268],["T_STRING","isShippingAsItem",268],"(",["T_VARIABLE","$setValue",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_STRING","null",268],")",["T_WHITESPACE","\n    ",268],"{",["T_WHITESPACE","\n        ",269],["T_RETURN","return",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_totalAsItem",270],"(",["T_CONSTANT_ENCAPSED_STRING","'_isShippingAsItem'",270],",",["T_WHITESPACE"," ",270],["T_VARIABLE","$setValue",270],")",";",["T_WHITESPACE","\n    ",270],"}",["T_WHITESPACE","\n\n    ",271],["T_DOC_COMMENT","\/**\n     * (re)Render all items and totals\n     *\/",273],["T_WHITESPACE","\n    ",275],["T_PROTECTED","protected",276],["T_WHITESPACE"," ",276],["T_FUNCTION","function",276],["T_WHITESPACE"," ",276],["T_STRING","_render",276],"(",")",["T_WHITESPACE","\n    ",276],"{",["T_WHITESPACE","\n        ",277],["T_IF","if",278],["T_WHITESPACE"," ",278],"(","!",["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_shouldRender",278],")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n            ",278],["T_RETURN","return",279],";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n\n        ",280],["T_COMMENT","\/\/ regular items from the sales entity\n",282],["T_WHITESPACE","        ",283],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_items",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_ARRAY","array",283],"(",")",";",["T_WHITESPACE","\n        ",283],["T_FOREACH","foreach",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_salesEntity",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getAllItems",284],"(",")",["T_WHITESPACE"," ",284],["T_AS","as",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$item",284],")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_IF","if",285],["T_WHITESPACE"," ",285],"(","!",["T_VARIABLE","$item",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getParentItem",285],"(",")",")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n                ",285],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_addRegularItem",286],"(",["T_VARIABLE","$item",286],")",";",["T_WHITESPACE","\n            ",286],"}",["T_WHITESPACE","\n        ",287],"}",["T_WHITESPACE","\n        ",288],["T_STRING","end",289],"(",["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","_items",289],")",";",["T_WHITESPACE","\n        ",289],["T_VARIABLE","$lastRegularItemKey",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","key",290],"(",["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_items",290],")",";",["T_WHITESPACE","\n\n        ",290],["T_COMMENT","\/\/ regular totals\n",292],["T_WHITESPACE","        ",293],["T_VARIABLE","$shippingDescription",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","''",293],";",["T_WHITESPACE","\n        ",293],["T_IF","if",294],["T_WHITESPACE"," ",294],"(",["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","_salesEntity",294],["T_WHITESPACE"," ",294],["T_INSTANCEOF","instanceof",294],["T_WHITESPACE"," ",294],["T_STRING","Mage_Sales_Model_Order",294],")",["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n            ",294],["T_VARIABLE","$shippingDescription",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_salesEntity",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getShippingDescription",295],"(",")",";",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_totals",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_ARRAY","array",296],"(",["T_WHITESPACE","\n                ",296],["T_STRING","self",297],["T_DOUBLE_COLON","::",297],["T_STRING","TOTAL_SUBTOTAL",297],["T_WHITESPACE"," ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_salesEntity",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getBaseSubtotal",297],"(",")",",",["T_WHITESPACE","\n                ",297],["T_STRING","self",298],["T_DOUBLE_COLON","::",298],["T_STRING","TOTAL_TAX",298],["T_WHITESPACE","      ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_salesEntity",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getBaseTaxAmount",298],"(",")",",",["T_WHITESPACE","\n                ",298],["T_STRING","self",299],["T_DOUBLE_COLON","::",299],["T_STRING","TOTAL_SHIPPING",299],["T_WHITESPACE"," ",299],["T_DOUBLE_ARROW","=>",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_salesEntity",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getBaseShippingAmount",299],"(",")",",",["T_WHITESPACE","\n                ",299],["T_STRING","self",300],["T_DOUBLE_COLON","::",300],["T_STRING","TOTAL_DISCOUNT",300],["T_WHITESPACE"," ",300],["T_DOUBLE_ARROW","=>",300],["T_WHITESPACE"," ",300],["T_STRING","abs",300],"(",["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","_salesEntity",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getBaseDiscountAmount",300],"(",")",")",",",["T_WHITESPACE","\n            ",300],")",";",["T_WHITESPACE","\n            ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_applyHiddenTaxWorkaround",302],"(",["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_salesEntity",302],")",";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE"," ",303],["T_ELSE","else",303],["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$address",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_salesEntity",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getIsVirtual",304],"(",")",["T_WHITESPACE"," ",304],"?",["T_WHITESPACE","\n                ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_salesEntity",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getBillingAddress",305],"(",")",["T_WHITESPACE"," ",305],":",["T_WHITESPACE"," ",305],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_salesEntity",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getShippingAddress",305],"(",")",";",["T_WHITESPACE","\n            ",305],["T_VARIABLE","$shippingDescription",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$address",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getShippingDescription",306],"(",")",";",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_totals",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_ARRAY","array",307],["T_WHITESPACE"," ",307],"(",["T_WHITESPACE","\n                ",307],["T_STRING","self",308],["T_DOUBLE_COLON","::",308],["T_STRING","TOTAL_SUBTOTAL",308],["T_WHITESPACE"," ",308],["T_DOUBLE_ARROW","=>",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_salesEntity",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getBaseSubtotal",308],"(",")",",",["T_WHITESPACE","\n                ",308],["T_STRING","self",309],["T_DOUBLE_COLON","::",309],["T_STRING","TOTAL_TAX",309],["T_WHITESPACE","      ",309],["T_DOUBLE_ARROW","=>",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$address",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getBaseTaxAmount",309],"(",")",",",["T_WHITESPACE","\n                ",309],["T_STRING","self",310],["T_DOUBLE_COLON","::",310],["T_STRING","TOTAL_SHIPPING",310],["T_WHITESPACE"," ",310],["T_DOUBLE_ARROW","=>",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$address",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getBaseShippingAmount",310],"(",")",",",["T_WHITESPACE","\n                ",310],["T_STRING","self",311],["T_DOUBLE_COLON","::",311],["T_STRING","TOTAL_DISCOUNT",311],["T_WHITESPACE"," ",311],["T_DOUBLE_ARROW","=>",311],["T_WHITESPACE"," ",311],["T_STRING","abs",311],"(",["T_VARIABLE","$address",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getBaseDiscountAmount",311],"(",")",")",",",["T_WHITESPACE","\n            ",311],")",";",["T_WHITESPACE","\n            ",312],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_applyHiddenTaxWorkaround",313],"(",["T_VARIABLE","$address",313],")",";",["T_WHITESPACE","\n        ",313],"}",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$originalDiscount",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_totals",315],"[",["T_STRING","self",315],["T_DOUBLE_COLON","::",315],["T_STRING","TOTAL_DISCOUNT",315],"]",";",["T_WHITESPACE","\n\n        ",315],["T_COMMENT","\/\/ arbitrary items, total modifications\n",317],["T_WHITESPACE","        ",318],["T_STRING","Mage",318],["T_DOUBLE_COLON","::",318],["T_STRING","dispatchEvent",318],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_prepare_line_items'",318],",",["T_WHITESPACE"," ",318],["T_ARRAY","array",318],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_cart'",318],["T_WHITESPACE"," ",318],["T_DOUBLE_ARROW","=>",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],")",")",";",["T_WHITESPACE","\n\n        ",318],["T_COMMENT","\/\/ distinguish original discount among the others\n",320],["T_WHITESPACE","        ",321],["T_IF","if",321],["T_WHITESPACE"," ",321],"(",["T_VARIABLE","$originalDiscount",321],["T_WHITESPACE"," ",321],">",["T_WHITESPACE"," ",321],["T_DNUMBER","0.0001",321],["T_WHITESPACE"," ",321],["T_BOOLEAN_AND","&&",321],["T_WHITESPACE"," ",321],["T_ISSET","isset",321],"(",["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_totalLineItemDescriptions",321],"[",["T_STRING","self",321],["T_DOUBLE_COLON","::",321],["T_STRING","TOTAL_DISCOUNT",321],"]",")",")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","_totalLineItemDescriptions",322],"[",["T_STRING","self",322],["T_DOUBLE_COLON","::",322],["T_STRING","TOTAL_DISCOUNT",322],"]","[","]",["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_STRING","Mage",322],["T_DOUBLE_COLON","::",322],["T_STRING","helper",322],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",322],")",["T_OBJECT_OPERATOR","->",322],["T_STRING","__",322],"(",["T_CONSTANT_ENCAPSED_STRING","'Discount (%s)'",322],",",["T_WHITESPACE"," ",322],["T_STRING","Mage",322],["T_DOUBLE_COLON","::",322],["T_STRING","app",322],"(",")",["T_OBJECT_OPERATOR","->",322],["T_STRING","getStore",322],"(",")",["T_OBJECT_OPERATOR","->",322],["T_STRING","convertPrice",322],"(",["T_VARIABLE","$originalDiscount",322],",",["T_WHITESPACE"," ",322],["T_STRING","true",322],",",["T_WHITESPACE"," ",322],["T_STRING","false",322],")",")",";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE","\n\n        ",323],["T_COMMENT","\/\/ discount, shipping as items\n",325],["T_WHITESPACE","        ",326],["T_IF","if",326],["T_WHITESPACE"," ",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_isDiscountAsItem",326],["T_WHITESPACE"," ",326],["T_BOOLEAN_AND","&&",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_totals",326],"[",["T_STRING","self",326],["T_DOUBLE_COLON","::",326],["T_STRING","TOTAL_DISCOUNT",326],"]",")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n            ",326],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","addItem",327],"(",["T_STRING","Mage",327],["T_DOUBLE_COLON","::",327],["T_STRING","helper",327],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",327],")",["T_OBJECT_OPERATOR","->",327],["T_STRING","__",327],"(",["T_CONSTANT_ENCAPSED_STRING","'Discount'",327],")",",",["T_WHITESPACE"," ",327],["T_LNUMBER","1",327],",",["T_WHITESPACE"," ",327],"-",["T_DNUMBER","1.00",327],["T_WHITESPACE"," ",327],"*",["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_totals",327],"[",["T_STRING","self",327],["T_DOUBLE_COLON","::",327],["T_STRING","TOTAL_DISCOUNT",327],"]",",",["T_WHITESPACE","\n                ",327],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_renderTotalLineItemDescriptions",328],"(",["T_STRING","self",328],["T_DOUBLE_COLON","::",328],["T_STRING","TOTAL_DISCOUNT",328],")",["T_WHITESPACE","\n            ",328],")",";",["T_WHITESPACE","\n        ",329],"}",["T_WHITESPACE","\n        ",330],["T_VARIABLE","$shippingItemId",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","_renderTotalLineItemDescriptions",331],"(",["T_STRING","self",331],["T_DOUBLE_COLON","::",331],["T_STRING","TOTAL_SHIPPING",331],",",["T_WHITESPACE"," ",331],["T_VARIABLE","$shippingDescription",331],")",";",["T_WHITESPACE","\n        ",331],["T_IF","if",332],["T_WHITESPACE"," ",332],"(",["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","_isShippingAsItem",332],["T_WHITESPACE"," ",332],["T_BOOLEAN_AND","&&",332],["T_WHITESPACE"," ",332],["T_DOUBLE_CAST","(float)",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","_totals",332],"[",["T_STRING","self",332],["T_DOUBLE_COLON","::",332],["T_STRING","TOTAL_SHIPPING",332],"]",")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n            ",332],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","addItem",333],"(",["T_STRING","Mage",333],["T_DOUBLE_COLON","::",333],["T_STRING","helper",333],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",333],")",["T_OBJECT_OPERATOR","->",333],["T_STRING","__",333],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping'",333],")",",",["T_WHITESPACE"," ",333],["T_LNUMBER","1",333],",",["T_WHITESPACE"," ",333],["T_DOUBLE_CAST","(float)",333],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","_totals",333],"[",["T_STRING","self",333],["T_DOUBLE_COLON","::",333],["T_STRING","TOTAL_SHIPPING",333],"]",",",["T_WHITESPACE","\n                ",333],["T_VARIABLE","$shippingItemId",334],["T_WHITESPACE","\n            ",334],")",";",["T_WHITESPACE","\n        ",335],"}",["T_WHITESPACE","\n\n        ",336],["T_COMMENT","\/\/ compound non-regular items into subtotal\n",338],["T_WHITESPACE","        ",339],["T_FOREACH","foreach",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","_items",339],["T_WHITESPACE"," ",339],["T_AS","as",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$key",339],["T_WHITESPACE"," ",339],["T_DOUBLE_ARROW","=>",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$item",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_IF","if",340],["T_WHITESPACE"," ",340],"(",["T_VARIABLE","$key",340],["T_WHITESPACE"," ",340],">",["T_WHITESPACE"," ",340],["T_VARIABLE","$lastRegularItemKey",340],["T_WHITESPACE"," ",340],["T_BOOLEAN_AND","&&",340],["T_WHITESPACE"," ",340],["T_VARIABLE","$item",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getAmount",340],"(",")",["T_WHITESPACE"," ",340],["T_IS_NOT_EQUAL","!=",340],["T_WHITESPACE"," ",340],["T_LNUMBER","0",340],")",["T_WHITESPACE"," ",340],"{",["T_WHITESPACE","\n                ",340],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_totals",341],"[",["T_STRING","self",341],["T_DOUBLE_COLON","::",341],["T_STRING","TOTAL_SUBTOTAL",341],"]",["T_WHITESPACE"," ",341],["T_PLUS_EQUAL","+=",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$item",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getAmount",341],"(",")",";",["T_WHITESPACE","\n            ",341],"}",["T_WHITESPACE","\n        ",342],"}",["T_WHITESPACE","\n\n        ",343],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_validate",345],"(",")",";",["T_WHITESPACE","\n        ",345],["T_COMMENT","\/\/ if cart items are invalid, prepare cart for transfer without line items\n",346],["T_WHITESPACE","        ",347],["T_IF","if",347],["T_WHITESPACE"," ",347],"(","!",["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_areItemsValid",347],")",["T_WHITESPACE"," ",347],"{",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","removeItem",348],"(",["T_VARIABLE","$shippingItemId",348],")",";",["T_WHITESPACE","\n        ",348],"}",["T_WHITESPACE","\n\n        ",349],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","_shouldRender",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_STRING","false",351],";",["T_WHITESPACE","\n    ",351],"}",["T_WHITESPACE","\n\n    ",352],["T_DOC_COMMENT","\/**\n     * Merge multiple descriptions  by a total code into a string\n     *\n     * @param string $code\n     * @param string $prepend\n     * @param string $append\n     * @param string $glue\n     * @return string\n     *\/",354],["T_WHITESPACE","\n    ",362],["T_PROTECTED","protected",363],["T_WHITESPACE"," ",363],["T_FUNCTION","function",363],["T_WHITESPACE"," ",363],["T_STRING","_renderTotalLineItemDescriptions",363],"(",["T_VARIABLE","$code",363],",",["T_WHITESPACE"," ",363],["T_VARIABLE","$prepend",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_CONSTANT_ENCAPSED_STRING","''",363],",",["T_WHITESPACE"," ",363],["T_VARIABLE","$append",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_CONSTANT_ENCAPSED_STRING","''",363],",",["T_WHITESPACE"," ",363],["T_VARIABLE","$glue",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_CONSTANT_ENCAPSED_STRING","'; '",363],")",["T_WHITESPACE","\n    ",363],"{",["T_WHITESPACE","\n        ",364],["T_VARIABLE","$result",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_ARRAY","array",365],"(",")",";",["T_WHITESPACE","\n        ",365],["T_IF","if",366],["T_WHITESPACE"," ",366],"(",["T_VARIABLE","$prepend",366],")",["T_WHITESPACE"," ",366],"{",["T_WHITESPACE","\n            ",366],["T_VARIABLE","$result",367],"[","]",["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$prepend",367],";",["T_WHITESPACE","\n        ",367],"}",["T_WHITESPACE","\n        ",368],["T_IF","if",369],["T_WHITESPACE"," ",369],"(",["T_ISSET","isset",369],"(",["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_totalLineItemDescriptions",369],"[",["T_VARIABLE","$code",369],"]",")",")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$result",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_STRING","array_merge",370],"(",["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","_totalLineItemDescriptions",370],"[",["T_VARIABLE","$code",370],"]",")",";",["T_WHITESPACE","\n        ",370],"}",["T_WHITESPACE","\n        ",371],["T_IF","if",372],["T_WHITESPACE"," ",372],"(",["T_VARIABLE","$append",372],")",["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n            ",372],["T_VARIABLE","$result",373],"[","]",["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],["T_VARIABLE","$append",373],";",["T_WHITESPACE","\n        ",373],"}",["T_WHITESPACE","\n        ",374],["T_RETURN","return",375],["T_WHITESPACE"," ",375],["T_STRING","implode",375],"(",["T_VARIABLE","$glue",375],",",["T_WHITESPACE"," ",375],["T_VARIABLE","$result",375],")",";",["T_WHITESPACE","\n    ",375],"}",["T_WHITESPACE","\n\n    ",376],["T_DOC_COMMENT","\/**\n     * Check the line items and totals according to PayPal business logic limitations\n     *\/",378],["T_WHITESPACE","\n    ",380],["T_PROTECTED","protected",381],["T_WHITESPACE"," ",381],["T_FUNCTION","function",381],["T_WHITESPACE"," ",381],["T_STRING","_validate",381],"(",")",["T_WHITESPACE","\n    ",381],"{",["T_WHITESPACE","\n        ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","_areItemsValid",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_STRING","true",383],";",["T_WHITESPACE","\n        ",383],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_areTotalsValid",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_STRING","false",384],";",["T_WHITESPACE","\n\n        ",384],["T_VARIABLE","$referenceAmount",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_salesEntity",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getBaseGrandTotal",386],"(",")",";",["T_WHITESPACE","\n\n        ",386],["T_VARIABLE","$itemsSubtotal",388],["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_LNUMBER","0",388],";",["T_WHITESPACE","\n        ",388],["T_FOREACH","foreach",389],["T_WHITESPACE"," ",389],"(",["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_items",389],["T_WHITESPACE"," ",389],["T_AS","as",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$i",389],")",["T_WHITESPACE"," ",389],"{",["T_WHITESPACE","\n            ",389],["T_VARIABLE","$itemsSubtotal",390],["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_VARIABLE","$itemsSubtotal",390],["T_WHITESPACE"," ",390],"+",["T_WHITESPACE"," ",390],["T_VARIABLE","$i",390],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",390],"]",["T_WHITESPACE"," ",390],"*",["T_WHITESPACE"," ",390],["T_VARIABLE","$i",390],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",390],"]",";",["T_WHITESPACE","\n        ",390],"}",["T_WHITESPACE","\n        ",391],["T_VARIABLE","$sum",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_VARIABLE","$itemsSubtotal",392],["T_WHITESPACE"," ",392],"+",["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","_totals",392],"[",["T_STRING","self",392],["T_DOUBLE_COLON","::",392],["T_STRING","TOTAL_TAX",392],"]",";",["T_WHITESPACE","\n        ",392],["T_IF","if",393],["T_WHITESPACE"," ",393],"(","!",["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","_isShippingAsItem",393],")",["T_WHITESPACE"," ",393],"{",["T_WHITESPACE","\n            ",393],["T_VARIABLE","$sum",394],["T_WHITESPACE"," ",394],["T_PLUS_EQUAL","+=",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","_totals",394],"[",["T_STRING","self",394],["T_DOUBLE_COLON","::",394],["T_STRING","TOTAL_SHIPPING",394],"]",";",["T_WHITESPACE","\n        ",394],"}",["T_WHITESPACE","\n        ",395],["T_IF","if",396],["T_WHITESPACE"," ",396],"(","!",["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","_isDiscountAsItem",396],")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n            ",396],["T_VARIABLE","$sum",397],["T_WHITESPACE"," ",397],["T_MINUS_EQUAL","-=",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","_totals",397],"[",["T_STRING","self",397],["T_DOUBLE_COLON","::",397],["T_STRING","TOTAL_DISCOUNT",397],"]",";",["T_WHITESPACE","\n        ",397],"}",["T_WHITESPACE","\n        ",398],["T_DOC_COMMENT","\/**\n         * numbers are intentionally converted to strings because of possible comparison error\n         * see http:\/\/php.net\/float\n         *\/",399],["T_WHITESPACE","\n        ",402],["T_COMMENT","\/\/ match sum of all the items and totals to the reference amount\n",403],["T_WHITESPACE","        ",404],["T_IF","if",404],["T_WHITESPACE"," ",404],"(",["T_STRING","sprintf",404],"(",["T_CONSTANT_ENCAPSED_STRING","'%.4F'",404],",",["T_WHITESPACE"," ",404],["T_VARIABLE","$sum",404],")",["T_WHITESPACE"," ",404],["T_IS_NOT_EQUAL","!=",404],["T_WHITESPACE"," ",404],["T_STRING","sprintf",404],"(",["T_CONSTANT_ENCAPSED_STRING","'%.4F'",404],",",["T_WHITESPACE"," ",404],["T_VARIABLE","$referenceAmount",404],")",")",["T_WHITESPACE"," ",404],"{",["T_WHITESPACE","\n            ",404],["T_VARIABLE","$adjustment",405],["T_WHITESPACE"," ",405],"=",["T_WHITESPACE"," ",405],["T_VARIABLE","$sum",405],["T_WHITESPACE"," ",405],"-",["T_WHITESPACE"," ",405],["T_VARIABLE","$referenceAmount",405],";",["T_WHITESPACE","\n            ",405],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_totals",406],"[",["T_STRING","self",406],["T_DOUBLE_COLON","::",406],["T_STRING","TOTAL_SUBTOTAL",406],"]",["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_totals",406],"[",["T_STRING","self",406],["T_DOUBLE_COLON","::",406],["T_STRING","TOTAL_SUBTOTAL",406],"]",["T_WHITESPACE"," ",406],"-",["T_WHITESPACE"," ",406],["T_VARIABLE","$adjustment",406],";",["T_WHITESPACE","\n        ",406],"}",["T_WHITESPACE","\n\n        ",407],["T_COMMENT","\/\/ PayPal requires to have discount less than items subtotal\n",409],["T_WHITESPACE","        ",410],["T_IF","if",410],["T_WHITESPACE"," ",410],"(","!",["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_isDiscountAsItem",410],")",["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n            ",410],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_areTotalsValid",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_STRING","round",411],"(",["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_totals",411],"[",["T_STRING","self",411],["T_DOUBLE_COLON","::",411],["T_STRING","TOTAL_DISCOUNT",411],"]",",",["T_WHITESPACE"," ",411],["T_LNUMBER","4",411],")",["T_WHITESPACE"," ",411],"<",["T_WHITESPACE"," ",411],["T_STRING","round",411],"(",["T_VARIABLE","$itemsSubtotal",411],",",["T_WHITESPACE"," ",411],["T_LNUMBER","4",411],")",";",["T_WHITESPACE","\n        ",411],"}",["T_WHITESPACE"," ",412],["T_ELSE","else",412],["T_WHITESPACE"," ",412],"{",["T_WHITESPACE","\n            ",412],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_areTotalsValid",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$itemsSubtotal",413],["T_WHITESPACE"," ",413],">",["T_WHITESPACE"," ",413],["T_DNUMBER","0.00001",413],";",["T_WHITESPACE","\n        ",413],"}",["T_WHITESPACE","\n\n        ",414],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","_areItemsValid",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","_areItemsValid",416],["T_WHITESPACE"," ",416],["T_BOOLEAN_AND","&&",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","_areTotalsValid",416],";",["T_WHITESPACE","\n    ",416],"}",["T_WHITESPACE","\n\n    ",417],["T_DOC_COMMENT","\/**\n     * Check whether items are valid\n     *\n     * @return bool\n     *\/",419],["T_WHITESPACE","\n    ",423],["T_PUBLIC","public",424],["T_WHITESPACE"," ",424],["T_FUNCTION","function",424],["T_WHITESPACE"," ",424],["T_STRING","areItemsValid",424],"(",")",["T_WHITESPACE","\n    ",424],"{",["T_WHITESPACE","\n        ",425],["T_RETURN","return",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","_areItemsValid",426],";",["T_WHITESPACE","\n    ",426],"}",["T_WHITESPACE","\n\n    ",427],["T_DOC_COMMENT","\/**\n     * Add a usual line item with amount and qty\n     *\n     * @param Varien_Object $salesItem\n     * @return Varien_Object\n     *\/",429],["T_WHITESPACE","\n    ",434],["T_PROTECTED","protected",435],["T_WHITESPACE"," ",435],["T_FUNCTION","function",435],["T_WHITESPACE"," ",435],["T_STRING","_addRegularItem",435],"(",["T_STRING","Varien_Object",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$salesItem",435],")",["T_WHITESPACE","\n    ",435],"{",["T_WHITESPACE","\n        ",436],["T_IF","if",437],["T_WHITESPACE"," ",437],"(",["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","_salesEntity",437],["T_WHITESPACE"," ",437],["T_INSTANCEOF","instanceof",437],["T_WHITESPACE"," ",437],["T_STRING","Mage_Sales_Model_Order",437],")",["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n            ",437],["T_VARIABLE","$qty",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_INT_CAST","(int)",438],["T_WHITESPACE"," ",438],["T_VARIABLE","$salesItem",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getQtyOrdered",438],"(",")",";",["T_WHITESPACE","\n            ",438],["T_VARIABLE","$amount",439],["T_WHITESPACE"," ",439],"=",["T_WHITESPACE"," ",439],["T_DOUBLE_CAST","(float)",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$salesItem",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getBasePrice",439],"(",")",";",["T_WHITESPACE","\n            ",439],["T_COMMENT","\/\/ TODO: nominal item for order\n",440],["T_WHITESPACE","        ",441],"}",["T_WHITESPACE"," ",441],["T_ELSE","else",441],["T_WHITESPACE"," ",441],"{",["T_WHITESPACE","\n            ",441],["T_VARIABLE","$qty",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_INT_CAST","(int)",442],["T_WHITESPACE"," ",442],["T_VARIABLE","$salesItem",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getTotalQty",442],"(",")",";",["T_WHITESPACE","\n            ",442],["T_VARIABLE","$amount",443],["T_WHITESPACE"," ",443],"=",["T_WHITESPACE"," ",443],["T_VARIABLE","$salesItem",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","isNominal",443],"(",")",["T_WHITESPACE"," ",443],"?",["T_WHITESPACE"," ",443],["T_LNUMBER","0",443],["T_WHITESPACE"," ",443],":",["T_WHITESPACE"," ",443],["T_DOUBLE_CAST","(float)",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$salesItem",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getBaseCalculationPrice",443],"(",")",";",["T_WHITESPACE","\n        ",443],"}",["T_WHITESPACE","\n        ",444],["T_COMMENT","\/\/ workaround in case if item subtotal precision is not compatible with PayPal (.2)\n",445],["T_WHITESPACE","        ",446],["T_VARIABLE","$subAggregatedLabel",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_CONSTANT_ENCAPSED_STRING","''",446],";",["T_WHITESPACE","\n        ",446],["T_IF","if",447],["T_WHITESPACE"," ",447],"(",["T_VARIABLE","$amount",447],["T_WHITESPACE"," ",447],"-",["T_WHITESPACE"," ",447],["T_STRING","round",447],"(",["T_VARIABLE","$amount",447],",",["T_WHITESPACE"," ",447],["T_LNUMBER","2",447],")",")",["T_WHITESPACE"," ",447],"{",["T_WHITESPACE","\n            ",447],["T_VARIABLE","$amount",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_VARIABLE","$amount",448],["T_WHITESPACE"," ",448],"*",["T_WHITESPACE"," ",448],["T_VARIABLE","$qty",448],";",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$subAggregatedLabel",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_CONSTANT_ENCAPSED_STRING","' x'",449],["T_WHITESPACE"," ",449],".",["T_WHITESPACE"," ",449],["T_VARIABLE","$qty",449],";",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$qty",450],["T_WHITESPACE"," ",450],"=",["T_WHITESPACE"," ",450],["T_LNUMBER","1",450],";",["T_WHITESPACE","\n        ",450],"}",["T_WHITESPACE","\n\n        ",451],["T_COMMENT","\/\/ aggregate item price if item qty * price does not match row total\n",453],["T_WHITESPACE","        ",454],["T_IF","if",454],["T_WHITESPACE"," ",454],"(","(",["T_VARIABLE","$amount",454],["T_WHITESPACE"," ",454],"*",["T_WHITESPACE"," ",454],["T_VARIABLE","$qty",454],")",["T_WHITESPACE"," ",454],["T_IS_NOT_EQUAL","!=",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$salesItem",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","getBaseRowTotal",454],"(",")",")",["T_WHITESPACE"," ",454],"{",["T_WHITESPACE","\n            ",454],["T_VARIABLE","$amount",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_DOUBLE_CAST","(float)",455],["T_WHITESPACE"," ",455],["T_VARIABLE","$salesItem",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","getBaseRowTotal",455],"(",")",";",["T_WHITESPACE","\n            ",455],["T_VARIABLE","$subAggregatedLabel",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_CONSTANT_ENCAPSED_STRING","' x'",456],["T_WHITESPACE"," ",456],".",["T_WHITESPACE"," ",456],["T_VARIABLE","$qty",456],";",["T_WHITESPACE","\n            ",456],["T_VARIABLE","$qty",457],["T_WHITESPACE"," ",457],"=",["T_WHITESPACE"," ",457],["T_LNUMBER","1",457],";",["T_WHITESPACE","\n        ",457],"}",["T_WHITESPACE","\n\n        ",458],["T_RETURN","return",460],["T_WHITESPACE"," ",460],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","addItem",460],"(",["T_VARIABLE","$salesItem",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getName",460],"(",")",["T_WHITESPACE"," ",460],".",["T_WHITESPACE"," ",460],["T_VARIABLE","$subAggregatedLabel",460],",",["T_WHITESPACE"," ",460],["T_VARIABLE","$qty",460],",",["T_WHITESPACE"," ",460],["T_VARIABLE","$amount",460],",",["T_WHITESPACE"," ",460],["T_VARIABLE","$salesItem",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getSku",460],"(",")",")",";",["T_WHITESPACE","\n    ",460],"}",["T_WHITESPACE","\n\n    ",461],["T_DOC_COMMENT","\/**\n     * Get\/Set for the specified variable.\n     * If the value changes, the re-rendering is commenced\n     *\n     * @param string $var\n     * @param $setValue\n     * @return bool|Mage_Paypal_Model_Cart\n     *\/",463],["T_WHITESPACE","\n    ",470],["T_PRIVATE","private",471],["T_WHITESPACE"," ",471],["T_FUNCTION","function",471],["T_WHITESPACE"," ",471],["T_STRING","_totalAsItem",471],"(",["T_VARIABLE","$var",471],",",["T_WHITESPACE"," ",471],["T_VARIABLE","$setValue",471],["T_WHITESPACE"," ",471],"=",["T_WHITESPACE"," ",471],["T_STRING","null",471],")",["T_WHITESPACE","\n    ",471],"{",["T_WHITESPACE","\n        ",472],["T_IF","if",473],["T_WHITESPACE"," ",473],"(",["T_STRING","null",473],["T_WHITESPACE"," ",473],["T_IS_NOT_IDENTICAL","!==",473],["T_WHITESPACE"," ",473],["T_VARIABLE","$setValue",473],")",["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n            ",473],["T_IF","if",474],["T_WHITESPACE"," ",474],"(",["T_VARIABLE","$setValue",474],["T_WHITESPACE"," ",474],["T_IS_NOT_EQUAL","!=",474],["T_WHITESPACE"," ",474],["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_VARIABLE","$var",474],")",["T_WHITESPACE"," ",474],"{",["T_WHITESPACE","\n                ",474],["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","_shouldRender",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_STRING","true",475],";",["T_WHITESPACE","\n            ",475],"}",["T_WHITESPACE","\n            ",476],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_VARIABLE","$var",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$setValue",477],";",["T_WHITESPACE","\n            ",477],["T_RETURN","return",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],";",["T_WHITESPACE","\n        ",478],"}",["T_WHITESPACE","\n        ",479],["T_RETURN","return",480],["T_WHITESPACE"," ",480],["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_VARIABLE","$var",480],";",["T_WHITESPACE","\n    ",480],"}",["T_WHITESPACE","\n\n    ",481],["T_DOC_COMMENT","\/**\n     * Add \"hidden\" discount and shipping tax\n     *\n     * Go ahead, try to understand ]:->\n     *\n     * Tax settings for getting \"discount tax\":\n     * - Catalog Prices = Including Tax\n     * - Apply Customer Tax = After Discount\n     * - Apply Discount on Prices = Including Tax\n     *\n     * Test case for getting \"hidden shipping tax\":\n     * - Make sure shipping is taxable (set shipping tax class)\n     * - Catalog Prices = Including Tax\n     * - Shipping Prices = Including Tax\n     * - Apply Customer Tax = After Discount\n     * - Create a shopping cart price rule with % discount applied to the Shipping Amount\n     * - run shopping cart and estimate shipping\n     * - go to PayPal\n     *\n     * @param Mage_Core_Model_Abstract $salesEntity\n     *\/",483],["T_WHITESPACE","\n    ",503],["T_PRIVATE","private",504],["T_WHITESPACE"," ",504],["T_FUNCTION","function",504],["T_WHITESPACE"," ",504],["T_STRING","_applyHiddenTaxWorkaround",504],"(",["T_VARIABLE","$salesEntity",504],")",["T_WHITESPACE","\n    ",504],"{",["T_WHITESPACE","\n        ",505],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","_totals",506],"[",["T_STRING","self",506],["T_DOUBLE_COLON","::",506],["T_STRING","TOTAL_TAX",506],"]",["T_WHITESPACE"," ",506],["T_PLUS_EQUAL","+=",506],["T_WHITESPACE"," ",506],["T_DOUBLE_CAST","(float)",506],["T_VARIABLE","$salesEntity",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getBaseHiddenTaxAmount",506],"(",")",";",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","_totals",507],"[",["T_STRING","self",507],["T_DOUBLE_COLON","::",507],["T_STRING","TOTAL_TAX",507],"]",["T_WHITESPACE"," ",507],["T_PLUS_EQUAL","+=",507],["T_WHITESPACE"," ",507],["T_DOUBLE_CAST","(float)",507],["T_VARIABLE","$salesEntity",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getBaseShippingHiddenTaxAmount",507],"(",")",";",["T_WHITESPACE","\n    ",507],"}",["T_WHITESPACE","\n\n    ",508],["T_DOC_COMMENT","\/**\n     * Check whether any item has negative amount\n     *\n     * @return bool\n     *\/",510],["T_WHITESPACE","\n    ",514],["T_PUBLIC","public",515],["T_WHITESPACE"," ",515],["T_FUNCTION","function",515],["T_WHITESPACE"," ",515],["T_STRING","hasNegativeItemAmount",515],"(",")",["T_WHITESPACE","\n    ",515],"{",["T_WHITESPACE","\n        ",516],["T_FOREACH","foreach",517],["T_WHITESPACE"," ",517],"(",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","_items",517],["T_WHITESPACE"," ",517],["T_AS","as",517],["T_WHITESPACE"," ",517],["T_VARIABLE","$item",517],")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n            ",517],["T_IF","if",518],["T_WHITESPACE"," ",518],"(",["T_VARIABLE","$item",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getAmount",518],"(",")",["T_WHITESPACE"," ",518],"<",["T_WHITESPACE"," ",518],["T_LNUMBER","0",518],")",["T_WHITESPACE"," ",518],"{",["T_WHITESPACE","\n                ",518],["T_RETURN","return",519],["T_WHITESPACE"," ",519],["T_STRING","true",519],";",["T_WHITESPACE","\n            ",519],"}",["T_WHITESPACE","\n        ",520],"}",["T_WHITESPACE","\n        ",521],["T_RETURN","return",522],["T_WHITESPACE"," ",522],["T_STRING","false",522],";",["T_WHITESPACE","\n    ",522],"}",["T_WHITESPACE","\n",523],"}",["T_WHITESPACE","\n",524]]