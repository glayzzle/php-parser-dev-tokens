[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Payflow Advanced Checkout Controller\n *\n * @category   Mage\n * @package    Mage_Paypal\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Paypal_PayflowadvancedController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Paypal_Controller_Express_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Config mode type\n     *\n     * @var string\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_configType",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'Mage_Paypal_Model_Config'",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Config method type\n     *\n     * @var string\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_configMethod",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","Mage_Paypal_Model_Config",48],["T_DOUBLE_COLON","::",48],["T_STRING","METHOD_PAYFLOWADVANCED",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Checkout mode type\n     *\n     * @var string\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_checkoutType",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'Mage_Paypal_Model_Payflowadvanced'",55],";",["T_WHITESPACE","\n\n\n    ",55],["T_DOC_COMMENT","\/**\n     * When a customer cancel payment from payflow gateway.\n     *\n     * @return void\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","cancelPaymentAction",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$gotoSection",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","_cancelPayment",65],"(",")",";",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$redirectBlock",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_getIframeBlock",66],"(",")",["T_WHITESPACE","\n            ",66],["T_OBJECT_OPERATOR","->",67],["T_STRING","setGotoSection",67],"(",["T_VARIABLE","$gotoSection",67],")",["T_WHITESPACE","\n            ",67],["T_OBJECT_OPERATOR","->",68],["T_STRING","setTemplate",68],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/payflowadvanced\/redirect.phtml'",68],")",";",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getResponse",69],"(",")",["T_OBJECT_OPERATOR","->",69],["T_STRING","setBody",69],"(",["T_VARIABLE","$redirectBlock",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","toHtml",69],"(",")",")",";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * When a customer return to website from payflow gateway.\n     *\n     * @return void\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","returnUrlAction",77],"(",")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$redirectBlock",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_getIframeBlock",79],"(",")",["T_WHITESPACE","\n            ",79],["T_OBJECT_OPERATOR","->",80],["T_STRING","setTemplate",80],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/payflowadvanced\/redirect.phtml'",80],")",";",["T_WHITESPACE","\n\n        ",80],["T_VARIABLE","$session",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_getCheckout",82],"(",")",";",["T_WHITESPACE","\n        ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$session",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getLastRealOrderId",83],"(",")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$order",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","getModel",84],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",84],")",["T_OBJECT_OPERATOR","->",84],["T_STRING","loadByIncrementId",84],"(",["T_VARIABLE","$session",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getLastRealOrderId",84],"(",")",")",";",["T_WHITESPACE","\n\n            ",84],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$order",86],["T_WHITESPACE"," ",86],["T_BOOLEAN_AND","&&",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$order",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getIncrementId",86],"(",")",["T_WHITESPACE"," ",86],["T_IS_EQUAL","==",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$session",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getLastRealOrderId",86],"(",")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n                ",86],["T_VARIABLE","$allowedOrderStates",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_ARRAY","array",87],"(",["T_WHITESPACE","\n                    ",87],["T_STRING","Mage_Sales_Model_Order",88],["T_DOUBLE_COLON","::",88],["T_STRING","STATE_PROCESSING",88],",",["T_WHITESPACE","\n                    ",88],["T_STRING","Mage_Sales_Model_Order",89],["T_DOUBLE_COLON","::",89],["T_STRING","STATE_COMPLETE",89],["T_WHITESPACE","\n                ",89],")",";",["T_WHITESPACE","\n                ",90],["T_IF","if",91],["T_WHITESPACE"," ",91],"(",["T_STRING","in_array",91],"(",["T_VARIABLE","$order",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getState",91],"(",")",",",["T_WHITESPACE"," ",91],["T_VARIABLE","$allowedOrderStates",91],")",")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n                    ",91],["T_VARIABLE","$session",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","unsLastRealOrderId",92],"(",")",";",["T_WHITESPACE","\n                    ",92],["T_VARIABLE","$redirectBlock",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","setGotoSuccessPage",93],"(",["T_STRING","true",93],")",";",["T_WHITESPACE","\n                ",93],"}",["T_WHITESPACE"," ",94],["T_ELSE","else",94],["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n                    ",94],["T_VARIABLE","$gotoSection",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_cancelPayment",95],"(",["T_WHITESPACE","\n                        ",95],["T_STRING","Mage",96],["T_DOUBLE_COLON","::",96],["T_STRING","helper",96],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",96],")",["T_WHITESPACE","\n                            ",96],["T_OBJECT_OPERATOR","->",97],["T_STRING","stripTags",97],"(",["T_WHITESPACE","\n                                ",97],["T_STRING","strval",98],"(",["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getRequest",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","getParam",98],"(",["T_CONSTANT_ENCAPSED_STRING","'RESPMSG'",98],")",")",["T_WHITESPACE","\n                            ",98],")",["T_WHITESPACE","\n                    ",99],")",";",["T_WHITESPACE","\n                    ",100],["T_VARIABLE","$redirectBlock",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","setGotoSection",101],"(",["T_VARIABLE","$gotoSection",101],")",";",["T_WHITESPACE","\n                    ",101],["T_VARIABLE","$redirectBlock",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","setErrorMsg",102],"(",["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","__",102],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment has been declined. Please try again.'",102],")",")",";",["T_WHITESPACE","\n                ",102],"}",["T_WHITESPACE","\n            ",103],"}",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n\n        ",105],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getResponse",107],"(",")",["T_OBJECT_OPERATOR","->",107],["T_STRING","setBody",107],"(",["T_VARIABLE","$redirectBlock",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","toHtml",107],"(",")",")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Submit transaction to Payflow getaway into iframe\n     *\n     * @return void\n     *\/",110],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","formAction",115],"(",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getResponse",117],"(",")",["T_WHITESPACE","\n            ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","setBody",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_getIframeBlock",118],"(",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","toHtml",118],"(",")",")",";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Get response from PayPal by silent post method\n     *\n     * @return void\n     *\/",121],["T_WHITESPACE","\n    ",125],["T_PUBLIC","public",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","silentPostAction",126],"(",")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$data",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getRequest",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getPost",128],"(",")",";",["T_WHITESPACE","\n        ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_ISSET","isset",129],"(",["T_VARIABLE","$data",129],"[",["T_CONSTANT_ENCAPSED_STRING","'INVNUM'",129],"]",")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_DOC_COMMENT","\/** @var $paymentModel Mage_Paypal_Model_Payflowadvanced *\/",130],["T_WHITESPACE","\n            ",130],["T_VARIABLE","$paymentModel",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","Mage",131],["T_DOUBLE_COLON","::",131],["T_STRING","getModel",131],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/payflowadvanced'",131],")",";",["T_WHITESPACE","\n            ",131],["T_TRY","try",132],["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                ",132],["T_VARIABLE","$paymentModel",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","process",133],"(",["T_VARIABLE","$data",133],")",";",["T_WHITESPACE","\n            ",133],"}",["T_WHITESPACE"," ",134],["T_CATCH","catch",134],["T_WHITESPACE"," ",134],"(",["T_STRING","Exception",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$e",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_STRING","Mage",135],["T_DOUBLE_COLON","::",135],["T_STRING","logException",135],"(",["T_VARIABLE","$e",135],")",";",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n\n    ",138],["T_DOC_COMMENT","\/**\n     * Cancel order, return quote to customer\n     *\n     * @param string $errorMsg\n     * @return bool|string\n     *\/",140],["T_WHITESPACE","\n    ",145],["T_PROTECTED","protected",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","_cancelPayment",146],"(",["T_VARIABLE","$errorMsg",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","''",146],")",["T_WHITESPACE","\n    ",146],"{",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$gotoSection",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_STRING","false",148],";",["T_WHITESPACE","\n        ",148],["T_COMMENT","\/* @var $helper Mage_Paypal_Helper_Checkout *\/",149],["T_WHITESPACE","\n        ",149],["T_VARIABLE","$helper",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","Mage",150],["T_DOUBLE_COLON","::",150],["T_STRING","helper",150],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/checkout'",150],")",";",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$helper",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","cancelCurrentOrder",151],"(",["T_VARIABLE","$errorMsg",151],")",";",["T_WHITESPACE","\n        ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(",["T_VARIABLE","$helper",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","restoreQuote",152],"(",")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$gotoSection",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'payment'",153],";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$gotoSection",155],";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Get frontend checkout session object\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",158],["T_WHITESPACE","\n    ",162],["T_PROTECTED","protected",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","_getCheckout",163],"(",")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_RETURN","return",165],["T_WHITESPACE"," ",165],["T_STRING","Mage",165],["T_DOUBLE_COLON","::",165],["T_STRING","getSingleton",165],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",165],")",";",["T_WHITESPACE","\n    ",165],"}",["T_WHITESPACE","\n\n    ",166],["T_DOC_COMMENT","\/**\n     * Get iframe block\n     *\n     * @return Mage_Paypal_Block_Payflow_Advanced_Iframe\n     *\/",168],["T_WHITESPACE","\n    ",172],["T_PROTECTED","protected",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","_getIframeBlock",173],"(",")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","loadLayout",175],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_payflow_advanced_iframe'",175],")",";",["T_WHITESPACE","\n        ",175],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getLayout",176],"(",")",["T_WHITESPACE","\n            ",176],["T_OBJECT_OPERATOR","->",177],["T_STRING","getBlock",177],"(",["T_CONSTANT_ENCAPSED_STRING","'payflow.advanced.iframe'",177],")",";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n",178],"}",["T_WHITESPACE","\n",179]]