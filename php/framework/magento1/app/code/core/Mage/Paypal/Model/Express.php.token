[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n *\n * PayPal Express Module\n *\/",27],["T_WHITESPACE","\n",30],["T_CLASS","class",31],["T_WHITESPACE"," ",31],["T_STRING","Mage_Paypal_Model_Express",31],["T_WHITESPACE"," ",31],["T_EXTENDS","extends",31],["T_WHITESPACE"," ",31],["T_STRING","Mage_Payment_Model_Method_Abstract",31],["T_WHITESPACE","\n    ",31],["T_IMPLEMENTS","implements",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Payment_Model_Recurring_Profile_MethodInterface",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_PROTECTED","protected",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$_code",34],["T_WHITESPACE","  ",34],"=",["T_WHITESPACE"," ",34],["T_STRING","Mage_Paypal_Model_Config",34],["T_DOUBLE_COLON","::",34],["T_STRING","METHOD_WPP_EXPRESS",34],";",["T_WHITESPACE","\n    ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$_formBlockType",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'paypal\/express_form'",35],";",["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$_infoBlockType",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'paypal\/payment_info'",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Website Payments Pro instance type\n     *\n     * @var $_proType string\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_proType",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'paypal\/pro'",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Availability options\n     *\/",45],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_isGateway",48],["T_WHITESPACE","                   ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","false",48],";",["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_canOrder",49],["T_WHITESPACE","                    ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","true",49],";",["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$_canAuthorize",50],["T_WHITESPACE","                ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","true",50],";",["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_canCapture",51],["T_WHITESPACE","                  ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","true",51],";",["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_canCapturePartial",52],["T_WHITESPACE","           ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","true",52],";",["T_WHITESPACE","\n    ",52],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$_canRefund",53],["T_WHITESPACE","                   ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","true",53],";",["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_canRefundInvoicePartial",54],["T_WHITESPACE","     ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","true",54],";",["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_canVoid",55],["T_WHITESPACE","                     ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","true",55],";",["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_canUseInternal",56],["T_WHITESPACE","              ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","false",56],";",["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$_canUseCheckout",57],["T_WHITESPACE","              ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","true",57],";",["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$_canUseForMultishipping",58],["T_WHITESPACE","      ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","false",58],";",["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$_canFetchTransactionInfo",59],["T_WHITESPACE","     ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","true",59],";",["T_WHITESPACE","\n    ",59],["T_PROTECTED","protected",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$_canCreateBillingAgreement",60],["T_WHITESPACE","   ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","true",60],";",["T_WHITESPACE","\n    ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$_canReviewPayment",61],["T_WHITESPACE","            ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","true",61],";",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Website Payments Pro instance\n     *\n     * @var Mage_Paypal_Model_Pro\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$_pro",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","null",68],";",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Payment additional information key for payment action\n     * @var string\n     *\/",70],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$_isOrderPaymentActionKey",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'is_order_action'",74],";",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Payment additional information key for number of used authorizations\n     * @var string\n     *\/",76],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$_authorizationCountKey",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'authorization_count'",80],";",["T_WHITESPACE","\n\n    ",80],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","__construct",82],"(",["T_VARIABLE","$params",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_ARRAY","array",82],"(",")",")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$proInstance",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","array_shift",84],"(",["T_VARIABLE","$params",84],")",";",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$proInstance",85],["T_WHITESPACE"," ",85],["T_BOOLEAN_AND","&&",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$proInstance",85],["T_WHITESPACE"," ",85],["T_INSTANCEOF","instanceof",85],["T_WHITESPACE"," ",85],["T_STRING","Mage_Paypal_Model_Pro",85],")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_pro",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$proInstance",86],";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE"," ",87],["T_ELSE","else",87],["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_pro",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_STRING","Mage",88],["T_DOUBLE_COLON","::",88],["T_STRING","getModel",88],"(",["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_proType",88],")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_pro",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setMethod",90],"(",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_code",90],")",";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_setApiProcessableErrors",91],"(",")",";",["T_WHITESPACE","\n    ",91],"}",["T_WHITESPACE","\n\n    ",92],["T_DOC_COMMENT","\/**\n     * Set processable error codes to API model\n     *\n     * @return Mage_Paypal_Model_Api_Nvp\n     *\/",94],["T_WHITESPACE","\n    ",98],["T_PROTECTED","protected",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","_setApiProcessableErrors",99],"(",")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_RETURN","return",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_pro",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getApi",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","setProcessableErrors",101],"(",["T_WHITESPACE","\n            ",101],["T_ARRAY","array",102],"(",["T_WHITESPACE","\n                ",102],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",103],["T_DOUBLE_COLON","::",103],["T_STRING","API_INTERNAL_ERROR",103],",",["T_WHITESPACE","\n                ",103],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",104],["T_DOUBLE_COLON","::",104],["T_STRING","API_UNABLE_PROCESS_PAYMENT_ERROR_CODE",104],",",["T_WHITESPACE","\n                ",104],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",105],["T_DOUBLE_COLON","::",105],["T_STRING","API_DO_EXPRESS_CHECKOUT_FAIL",105],",",["T_WHITESPACE","\n                ",105],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",106],["T_DOUBLE_COLON","::",106],["T_STRING","API_UNABLE_TRANSACTION_COMPLETE",106],",",["T_WHITESPACE","\n                ",106],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",107],["T_DOUBLE_COLON","::",107],["T_STRING","API_TRANSACTION_EXPIRED",107],",",["T_WHITESPACE","\n                ",107],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",108],["T_DOUBLE_COLON","::",108],["T_STRING","API_MAX_PAYMENT_ATTEMPTS_EXCEEDED",108],",",["T_WHITESPACE","\n                ",108],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",109],["T_DOUBLE_COLON","::",109],["T_STRING","API_COUNTRY_FILTER_DECLINE",109],",",["T_WHITESPACE","\n                ",109],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",110],["T_DOUBLE_COLON","::",110],["T_STRING","API_MAXIMUM_AMOUNT_FILTER_DECLINE",110],",",["T_WHITESPACE","\n                ",110],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",111],["T_DOUBLE_COLON","::",111],["T_STRING","API_OTHER_FILTER_DECLINE",111],["T_WHITESPACE","\n            ",111],")",")",";",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * Store setter\n     * Also updates store ID in config object\n     *\n     * @param Mage_Core_Model_Store|int $store\n     *\/",115],["T_WHITESPACE","\n    ",120],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","setStore",121],"(",["T_VARIABLE","$store",121],")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","setData",123],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$store",123],")",";",["T_WHITESPACE","\n        ",123],["T_IF","if",124],["T_WHITESPACE"," ",124],"(",["T_STRING","null",124],["T_WHITESPACE"," ",124],["T_IS_IDENTICAL","===",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$store",124],")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$store",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","Mage",125],["T_DOUBLE_COLON","::",125],["T_STRING","app",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","getStore",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","getId",125],"(",")",";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_pro",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getConfig",127],"(",")",["T_OBJECT_OPERATOR","->",127],["T_STRING","setStoreId",127],"(",["T_STRING","is_object",127],"(",["T_VARIABLE","$store",127],")",["T_WHITESPACE"," ",127],"?",["T_WHITESPACE"," ",127],["T_VARIABLE","$store",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getId",127],"(",")",["T_WHITESPACE"," ",127],":",["T_WHITESPACE"," ",127],["T_VARIABLE","$store",127],")",";",["T_WHITESPACE","\n        ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n   ",129],["T_DOC_COMMENT","\/**\n    * Can be used in regular checkout\n    *\n    * @return bool\n    *\/",131],["T_WHITESPACE","\n   ",135],["T_PUBLIC","public",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","canUseCheckout",136],"(",")",["T_WHITESPACE","\n   ",136],"{",["T_WHITESPACE","\n       ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_STRING","Mage",138],["T_DOUBLE_COLON","::",138],["T_STRING","getStoreConfigFlag",138],"(",["T_CONSTANT_ENCAPSED_STRING","'payment\/hosted_pro\/active'",138],")",["T_WHITESPACE","\n           ",138],["T_BOOLEAN_AND","&&",139],["T_WHITESPACE"," ",139],"!",["T_STRING","Mage",139],["T_DOUBLE_COLON","::",139],["T_STRING","getStoreConfigFlag",139],"(",["T_CONSTANT_ENCAPSED_STRING","'payment\/hosted_pro\/display_ec'",139],")",["T_WHITESPACE","\n       ",139],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n           ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_STRING","false",141],";",["T_WHITESPACE","\n       ",141],"}",["T_WHITESPACE","\n       ",142],["T_RETURN","return",143],["T_WHITESPACE"," ",143],["T_STRING","parent",143],["T_DOUBLE_COLON","::",143],["T_STRING","canUseCheckout",143],"(",")",";",["T_WHITESPACE","\n   ",143],"}",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * Whether method is available for specified currency\n     *\n     * @param string $currencyCode\n     * @return bool\n     *\/",146],["T_WHITESPACE","\n    ",151],["T_PUBLIC","public",152],["T_WHITESPACE"," ",152],["T_FUNCTION","function",152],["T_WHITESPACE"," ",152],["T_STRING","canUseForCurrency",152],"(",["T_VARIABLE","$currencyCode",152],")",["T_WHITESPACE","\n    ",152],"{",["T_WHITESPACE","\n        ",153],["T_RETURN","return",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_pro",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getConfig",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","isCurrencyCodeSupported",154],"(",["T_VARIABLE","$currencyCode",154],")",";",["T_WHITESPACE","\n    ",154],"}",["T_WHITESPACE","\n\n    ",155],["T_DOC_COMMENT","\/**\n     * Payment action getter compatible with payment model\n     *\n     * @see Mage_Sales_Model_Payment::place()\n     * @return string\n     *\/",157],["T_WHITESPACE","\n    ",162],["T_PUBLIC","public",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","getConfigPaymentAction",163],"(",")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_RETURN","return",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_pro",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getConfig",165],"(",")",["T_OBJECT_OPERATOR","->",165],["T_STRING","getPaymentAction",165],"(",")",";",["T_WHITESPACE","\n    ",165],"}",["T_WHITESPACE","\n\n    ",166],["T_DOC_COMMENT","\/**\n     * Check whether payment method can be used\n     * @param Mage_Sales_Model_Quote\n     * @return bool\n     *\/",168],["T_WHITESPACE","\n    ",172],["T_PUBLIC","public",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","isAvailable",173],"(",["T_VARIABLE","$quote",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_STRING","null",173],")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n        ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_STRING","parent",175],["T_DOUBLE_COLON","::",175],["T_STRING","isAvailable",175],"(",["T_VARIABLE","$quote",175],")",["T_WHITESPACE"," ",175],["T_BOOLEAN_AND","&&",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_pro",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getConfig",175],"(",")",["T_OBJECT_OPERATOR","->",175],["T_STRING","isMethodAvailable",175],"(",")",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_STRING","true",176],";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n        ",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_STRING","false",178],";",["T_WHITESPACE","\n    ",178],"}",["T_WHITESPACE","\n\n    ",179],["T_DOC_COMMENT","\/**\n     * Custom getter for payment configuration\n     *\n     * @param string $field\n     * @param int $storeId\n     * @return mixed\n     *\/",181],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","getConfigData",188],"(",["T_VARIABLE","$field",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$storeId",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","null",188],")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_RETURN","return",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_pro",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getConfig",190],"(",")",["T_OBJECT_OPERATOR","->",190],["T_VARIABLE","$field",190],";",["T_WHITESPACE","\n    ",190],"}",["T_WHITESPACE","\n\n    ",191],["T_DOC_COMMENT","\/**\n     * Order payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Express\n     *\/",193],["T_WHITESPACE","\n    ",199],["T_PUBLIC","public",200],["T_WHITESPACE"," ",200],["T_FUNCTION","function",200],["T_WHITESPACE"," ",200],["T_STRING","order",200],"(",["T_STRING","Varien_Object",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$payment",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$amount",200],")",["T_WHITESPACE","\n    ",200],"{",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$paypalTransactionData",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","Mage",202],["T_DOUBLE_COLON","::",202],["T_STRING","getSingleton",202],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",202],")",["T_OBJECT_OPERATOR","->",202],["T_STRING","getPaypalTransactionData",202],"(",")",";",["T_WHITESPACE","\n        ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(","!",["T_STRING","is_array",203],"(",["T_VARIABLE","$paypalTransactionData",203],")",")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_placeOrder",204],"(",["T_VARIABLE","$payment",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$amount",204],")",";",["T_WHITESPACE","\n        ",204],"}",["T_WHITESPACE"," ",205],["T_ELSE","else",205],["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_importToPayment",206],"(",["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_pro",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getApi",206],"(",")",["T_OBJECT_OPERATOR","->",206],["T_STRING","setData",206],"(",["T_VARIABLE","$paypalTransactionData",206],")",",",["T_WHITESPACE"," ",206],["T_VARIABLE","$payment",206],")",";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$payment",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","setAdditionalInformation",209],"(",["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_isOrderPaymentActionKey",209],",",["T_WHITESPACE"," ",209],["T_STRING","true",209],")",";",["T_WHITESPACE","\n\n        ",209],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$payment",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getIsFraudDetected",211],"(",")",")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n            ",211],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],";",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE","\n\n        ",213],["T_VARIABLE","$order",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$payment",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getOrder",215],"(",")",";",["T_WHITESPACE","\n        ",215],["T_VARIABLE","$orderTransactionId",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_VARIABLE","$payment",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getTransactionId",216],"(",")",";",["T_WHITESPACE","\n\n        ",216],["T_VARIABLE","$api",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_callDoAuthorize",218],"(",["T_VARIABLE","$amount",218],",",["T_WHITESPACE"," ",218],["T_VARIABLE","$payment",218],",",["T_WHITESPACE"," ",218],["T_VARIABLE","$orderTransactionId",218],")",";",["T_WHITESPACE","\n\n        ",218],["T_VARIABLE","$state",220],["T_WHITESPACE","  ",220],"=",["T_WHITESPACE"," ",220],["T_STRING","Mage_Sales_Model_Order",220],["T_DOUBLE_COLON","::",220],["T_STRING","STATE_PROCESSING",220],";",["T_WHITESPACE","\n        ",220],["T_VARIABLE","$status",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_STRING","true",221],";",["T_WHITESPACE","\n\n        ",221],["T_VARIABLE","$formatedPrice",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_VARIABLE","$order",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getBaseCurrency",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","formatTxt",223],"(",["T_VARIABLE","$amount",223],")",";",["T_WHITESPACE","\n        ",223],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_VARIABLE","$payment",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getIsTransactionPending",224],"(",")",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$message",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_STRING","Mage",225],["T_DOUBLE_COLON","::",225],["T_STRING","helper",225],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",225],")",["T_OBJECT_OPERATOR","->",225],["T_STRING","__",225],"(",["T_CONSTANT_ENCAPSED_STRING","'Ordering amount of %s is pending approval on gateway.'",225],",",["T_WHITESPACE"," ",225],["T_VARIABLE","$formatedPrice",225],")",";",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$state",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_STRING","Mage_Sales_Model_Order",226],["T_DOUBLE_COLON","::",226],["T_STRING","STATE_PAYMENT_REVIEW",226],";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE"," ",227],["T_ELSE","else",227],["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$message",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_STRING","Mage",228],["T_DOUBLE_COLON","::",228],["T_STRING","helper",228],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",228],")",["T_OBJECT_OPERATOR","->",228],["T_STRING","__",228],"(",["T_CONSTANT_ENCAPSED_STRING","'Ordered amount of %s.'",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$formatedPrice",228],")",";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n\n        ",229],["T_VARIABLE","$payment",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","addTransaction",231],"(",["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",231],["T_DOUBLE_COLON","::",231],["T_STRING","TYPE_ORDER",231],",",["T_WHITESPACE"," ",231],["T_STRING","null",231],",",["T_WHITESPACE"," ",231],["T_STRING","false",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$message",231],")",";",["T_WHITESPACE","\n\n        ",231],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_pro",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","importPaymentInfo",233],"(",["T_VARIABLE","$api",233],",",["T_WHITESPACE"," ",233],["T_VARIABLE","$payment",233],")",";",["T_WHITESPACE","\n\n        ",233],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$payment",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getIsTransactionPending",235],"(",")",")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$message",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_STRING","Mage",236],["T_DOUBLE_COLON","::",236],["T_STRING","helper",236],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",236],")",["T_OBJECT_OPERATOR","->",236],["T_STRING","__",236],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorizing amount of %s is pending approval on gateway.'",236],",",["T_WHITESPACE"," ",236],["T_VARIABLE","$formatedPrice",236],")",";",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$state",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_STRING","Mage_Sales_Model_Order",237],["T_DOUBLE_COLON","::",237],["T_STRING","STATE_PAYMENT_REVIEW",237],";",["T_WHITESPACE","\n            ",237],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_VARIABLE","$payment",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getIsFraudDetected",238],"(",")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n                ",238],["T_VARIABLE","$status",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_STRING","Mage_Sales_Model_Order",239],["T_DOUBLE_COLON","::",239],["T_STRING","STATUS_FRAUD",239],";",["T_WHITESPACE","\n            ",239],"}",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE"," ",241],["T_ELSE","else",241],["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n            ",241],["T_VARIABLE","$message",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_STRING","Mage",242],["T_DOUBLE_COLON","::",242],["T_STRING","helper",242],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",242],")",["T_OBJECT_OPERATOR","->",242],["T_STRING","__",242],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorized amount of %s.'",242],",",["T_WHITESPACE"," ",242],["T_VARIABLE","$formatedPrice",242],")",";",["T_WHITESPACE","\n        ",242],"}",["T_WHITESPACE","\n\n        ",243],["T_VARIABLE","$payment",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","resetTransactionAdditionalInfo",245],"(",")",";",["T_WHITESPACE","\n\n        ",245],["T_VARIABLE","$payment",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","setTransactionId",247],"(",["T_VARIABLE","$api",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getTransactionId",247],"(",")",")",";",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$payment",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","setParentTransactionId",248],"(",["T_VARIABLE","$orderTransactionId",248],")",";",["T_WHITESPACE","\n\n        ",248],["T_VARIABLE","$transaction",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$payment",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","addTransaction",250],"(",["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",250],["T_DOUBLE_COLON","::",250],["T_STRING","TYPE_AUTH",250],",",["T_WHITESPACE"," ",250],["T_STRING","null",250],",",["T_WHITESPACE"," ",250],["T_STRING","false",250],",",["T_WHITESPACE","\n            ",250],["T_VARIABLE","$message",251],["T_WHITESPACE","\n        ",251],")",";",["T_WHITESPACE","\n\n        ",252],["T_VARIABLE","$order",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","setState",254],"(",["T_VARIABLE","$state",254],",",["T_WHITESPACE"," ",254],["T_VARIABLE","$status",254],")",";",["T_WHITESPACE","\n\n        ",254],["T_VARIABLE","$payment",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","setSkipOrderProcessing",256],"(",["T_STRING","true",256],")",";",["T_WHITESPACE","\n        ",256],["T_RETURN","return",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],";",["T_WHITESPACE","\n    ",257],"}",["T_WHITESPACE","\n\n    ",258],["T_DOC_COMMENT","\/**\n     * Authorize payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Express\n     *\/",260],["T_WHITESPACE","\n    ",266],["T_PUBLIC","public",267],["T_WHITESPACE"," ",267],["T_FUNCTION","function",267],["T_WHITESPACE"," ",267],["T_STRING","authorize",267],"(",["T_STRING","Varien_Object",267],["T_WHITESPACE"," ",267],["T_VARIABLE","$payment",267],",",["T_WHITESPACE"," ",267],["T_VARIABLE","$amount",267],")",["T_WHITESPACE","\n    ",267],"{",["T_WHITESPACE","\n        ",268],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","_placeOrder",269],"(",["T_VARIABLE","$payment",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$amount",269],")",";",["T_WHITESPACE","\n    ",269],"}",["T_WHITESPACE","\n\n    ",270],["T_DOC_COMMENT","\/**\n     * Void payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Express\n     *\/",272],["T_WHITESPACE","\n    ",277],["T_PUBLIC","public",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","void",278],"(",["T_STRING","Varien_Object",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$payment",278],")",["T_WHITESPACE","\n    ",278],"{",["T_WHITESPACE","\n        ",279],["T_COMMENT","\/\/Switching to order transaction if needed\n",280],["T_WHITESPACE","        ",281],["T_IF","if",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$payment",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getAdditionalInformation",281],"(",["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","_isOrderPaymentActionKey",281],")",["T_WHITESPACE","\n            ",281],["T_BOOLEAN_AND","&&",282],["T_WHITESPACE"," ",282],"!",["T_VARIABLE","$payment",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getVoidOnlyAuthorization",282],"(",")",["T_WHITESPACE","\n        ",282],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$orderTransaction",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$payment",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","lookupTransaction",284],"(",["T_WHITESPACE","\n                ",284],["T_STRING","false",285],",",["T_WHITESPACE"," ",285],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",285],["T_DOUBLE_COLON","::",285],["T_STRING","TYPE_ORDER",285],["T_WHITESPACE","\n            ",285],")",";",["T_WHITESPACE","\n            ",286],["T_IF","if",287],["T_WHITESPACE"," ",287],"(",["T_VARIABLE","$orderTransaction",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n                ",287],["T_VARIABLE","$payment",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","setParentTransactionId",288],"(",["T_VARIABLE","$orderTransaction",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getTxnId",288],"(",")",")",";",["T_WHITESPACE","\n                ",288],["T_VARIABLE","$payment",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","setTransactionId",289],"(",["T_VARIABLE","$orderTransaction",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getTxnId",289],"(",")",["T_WHITESPACE"," ",289],".",["T_WHITESPACE"," ",289],["T_CONSTANT_ENCAPSED_STRING","'-void'",289],")",";",["T_WHITESPACE","\n            ",289],"}",["T_WHITESPACE","\n        ",290],"}",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","_pro",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","void",292],"(",["T_VARIABLE","$payment",292],")",";",["T_WHITESPACE","\n        ",292],["T_RETURN","return",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$this",293],";",["T_WHITESPACE","\n    ",293],"}",["T_WHITESPACE","\n\n    ",294],["T_DOC_COMMENT","\/**\n     * Capture payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Express\n     *\/",296],["T_WHITESPACE","\n    ",302],["T_PUBLIC","public",303],["T_WHITESPACE"," ",303],["T_FUNCTION","function",303],["T_WHITESPACE"," ",303],["T_STRING","capture",303],"(",["T_STRING","Varien_Object",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$payment",303],",",["T_WHITESPACE"," ",303],["T_VARIABLE","$amount",303],")",["T_WHITESPACE","\n    ",303],"{",["T_WHITESPACE","\n        ",304],["T_VARIABLE","$authorizationTransaction",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$payment",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getAuthorizationTransaction",305],"(",")",";",["T_WHITESPACE","\n        ",305],["T_VARIABLE","$authorizationPeriod",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_STRING","abs",306],"(",["T_STRING","intval",306],"(",["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getConfigData",306],"(",["T_CONSTANT_ENCAPSED_STRING","'authorization_honor_period'",306],")",")",")",";",["T_WHITESPACE","\n        ",306],["T_VARIABLE","$maxAuthorizationNumber",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_STRING","abs",307],"(",["T_STRING","intval",307],"(",["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getConfigData",307],"(",["T_CONSTANT_ENCAPSED_STRING","'child_authorization_number'",307],")",")",")",";",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$order",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$payment",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getOrder",308],"(",")",";",["T_WHITESPACE","\n        ",308],["T_VARIABLE","$isAuthorizationCreated",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_STRING","false",309],";",["T_WHITESPACE","\n\n        ",309],["T_IF","if",311],["T_WHITESPACE"," ",311],"(",["T_VARIABLE","$payment",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getAdditionalInformation",311],"(",["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_isOrderPaymentActionKey",311],")",")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n            ",311],["T_VARIABLE","$voided",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_STRING","false",312],";",["T_WHITESPACE","\n            ",312],["T_IF","if",313],["T_WHITESPACE"," ",313],"(","!",["T_VARIABLE","$authorizationTransaction",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getIsClosed",313],"(",")",["T_WHITESPACE","\n                ",313],["T_BOOLEAN_AND","&&",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_isTransactionExpired",314],"(",["T_VARIABLE","$authorizationTransaction",314],",",["T_WHITESPACE"," ",314],["T_VARIABLE","$authorizationPeriod",314],")",["T_WHITESPACE","\n            ",314],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n                ",315],["T_COMMENT","\/\/Save payment state and configure payment object for voiding\n",316],["T_WHITESPACE","                ",317],["T_VARIABLE","$isCaptureFinal",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_VARIABLE","$payment",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getShouldCloseParentTransaction",317],"(",")",";",["T_WHITESPACE","\n                ",317],["T_VARIABLE","$captureTrxId",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$payment",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getTransactionId",318],"(",")",";",["T_WHITESPACE","\n                ",318],["T_VARIABLE","$payment",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","setShouldCloseParentTransaction",319],"(",["T_STRING","false",319],")",";",["T_WHITESPACE","\n                ",319],["T_VARIABLE","$payment",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","setParentTransactionId",320],"(",["T_VARIABLE","$authorizationTransaction",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getTxnId",320],"(",")",")",";",["T_WHITESPACE","\n                ",320],["T_VARIABLE","$payment",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","unsTransactionId",321],"(",")",";",["T_WHITESPACE","\n                ",321],["T_VARIABLE","$payment",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","setVoidOnlyAuthorization",322],"(",["T_STRING","true",322],")",";",["T_WHITESPACE","\n                ",322],["T_VARIABLE","$payment",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","void",323],"(",["T_NEW","new",323],["T_WHITESPACE"," ",323],["T_STRING","Varien_Object",323],"(",")",")",";",["T_WHITESPACE","\n\n                ",323],["T_COMMENT","\/\/Revert payment state after voiding\n",325],["T_WHITESPACE","                ",326],["T_VARIABLE","$payment",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","unsAuthorizationTransaction",326],"(",")",";",["T_WHITESPACE","\n                ",326],["T_VARIABLE","$payment",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","unsTransactionId",327],"(",")",";",["T_WHITESPACE","\n                ",327],["T_VARIABLE","$payment",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","setShouldCloseParentTransaction",328],"(",["T_VARIABLE","$isCaptureFinal",328],")",";",["T_WHITESPACE","\n                ",328],["T_VARIABLE","$voided",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_STRING","true",329],";",["T_WHITESPACE","\n            ",329],"}",["T_WHITESPACE","\n\n            ",330],["T_IF","if",332],["T_WHITESPACE"," ",332],"(",["T_VARIABLE","$authorizationTransaction",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getIsClosed",332],"(",")",["T_WHITESPACE"," ",332],["T_BOOLEAN_OR","||",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$voided",332],")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n                ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$payment",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getAdditionalInformation",333],"(",["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","_authorizationCountKey",333],")",["T_WHITESPACE"," ",333],">",["T_WHITESPACE"," ",333],["T_VARIABLE","$maxAuthorizationNumber",333],["T_WHITESPACE"," ",333],"-",["T_WHITESPACE"," ",333],["T_LNUMBER","1",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n                    ",333],["T_STRING","Mage",334],["T_DOUBLE_COLON","::",334],["T_STRING","throwException",334],"(",["T_STRING","Mage",334],["T_DOUBLE_COLON","::",334],["T_STRING","helper",334],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",334],")",["T_OBJECT_OPERATOR","->",334],["T_STRING","__",334],"(",["T_CONSTANT_ENCAPSED_STRING","'The maximum number of child authorizations is reached.'",334],")",")",";",["T_WHITESPACE","\n                ",334],"}",["T_WHITESPACE","\n                ",335],["T_VARIABLE","$api",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_callDoAuthorize",336],"(",["T_WHITESPACE","\n                    ",336],["T_VARIABLE","$amount",337],",",["T_WHITESPACE","\n                    ",337],["T_VARIABLE","$payment",338],",",["T_WHITESPACE","\n                    ",338],["T_VARIABLE","$authorizationTransaction",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getParentTxnId",339],"(",")",["T_WHITESPACE","\n                ",339],")",";",["T_WHITESPACE","\n\n                ",340],["T_COMMENT","\/\/Adding authorization transaction\n",342],["T_WHITESPACE","                ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_pro",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","importPaymentInfo",343],"(",["T_VARIABLE","$api",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$payment",343],")",";",["T_WHITESPACE","\n                ",343],["T_VARIABLE","$payment",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","setTransactionId",344],"(",["T_VARIABLE","$api",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getTransactionId",344],"(",")",")",";",["T_WHITESPACE","\n                ",344],["T_VARIABLE","$payment",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","setParentTransactionId",345],"(",["T_VARIABLE","$authorizationTransaction",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getParentTxnId",345],"(",")",")",";",["T_WHITESPACE","\n                ",345],["T_VARIABLE","$payment",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","setIsTransactionClosed",346],"(",["T_STRING","false",346],")",";",["T_WHITESPACE","\n\n                ",346],["T_VARIABLE","$formatedPrice",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_VARIABLE","$order",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getBaseCurrency",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","formatTxt",348],"(",["T_VARIABLE","$amount",348],")",";",["T_WHITESPACE","\n\n                ",348],["T_IF","if",350],["T_WHITESPACE"," ",350],"(",["T_VARIABLE","$payment",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","getIsTransactionPending",350],"(",")",")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                    ",350],["T_VARIABLE","$message",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_STRING","Mage",351],["T_DOUBLE_COLON","::",351],["T_STRING","helper",351],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",351],")",["T_OBJECT_OPERATOR","->",351],["T_STRING","__",351],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorizing amount of %s is pending approval on gateway.'",351],",",["T_WHITESPACE"," ",351],["T_VARIABLE","$formatedPrice",351],")",";",["T_WHITESPACE","\n                ",351],"}",["T_WHITESPACE"," ",352],["T_ELSE","else",352],["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n                    ",352],["T_VARIABLE","$message",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_STRING","Mage",353],["T_DOUBLE_COLON","::",353],["T_STRING","helper",353],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",353],")",["T_OBJECT_OPERATOR","->",353],["T_STRING","__",353],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorized amount of %s.'",353],",",["T_WHITESPACE"," ",353],["T_VARIABLE","$formatedPrice",353],")",";",["T_WHITESPACE","\n                ",353],"}",["T_WHITESPACE","\n\n                ",354],["T_VARIABLE","$transaction",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_VARIABLE","$payment",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","addTransaction",356],"(",["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",356],["T_DOUBLE_COLON","::",356],["T_STRING","TYPE_AUTH",356],",",["T_WHITESPACE"," ",356],["T_STRING","null",356],",",["T_WHITESPACE","\n                    ",356],["T_STRING","true",357],",",["T_WHITESPACE"," ",357],["T_VARIABLE","$message",357],["T_WHITESPACE","\n                ",357],")",";",["T_WHITESPACE","\n\n                ",358],["T_VARIABLE","$payment",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","setParentTransactionId",360],"(",["T_VARIABLE","$api",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getTransactionId",360],"(",")",")",";",["T_WHITESPACE","\n                ",360],["T_VARIABLE","$isAuthorizationCreated",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_STRING","true",361],";",["T_WHITESPACE","\n            ",361],"}",["T_WHITESPACE","\n            ",362],["T_COMMENT","\/\/close order transaction if needed\n",363],["T_WHITESPACE","            ",364],["T_IF","if",364],["T_WHITESPACE"," ",364],"(",["T_VARIABLE","$payment",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getShouldCloseParentTransaction",364],"(",")",")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n                ",364],["T_VARIABLE","$orderTransaction",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_VARIABLE","$payment",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","lookupTransaction",365],"(",["T_WHITESPACE","\n                    ",365],["T_STRING","false",366],",",["T_WHITESPACE"," ",366],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",366],["T_DOUBLE_COLON","::",366],["T_STRING","TYPE_ORDER",366],["T_WHITESPACE","\n                ",366],")",";",["T_WHITESPACE","\n\n                ",367],["T_IF","if",369],["T_WHITESPACE"," ",369],"(",["T_VARIABLE","$orderTransaction",369],")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n                    ",369],["T_VARIABLE","$orderTransaction",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","setIsClosed",370],"(",["T_STRING","true",370],")",";",["T_WHITESPACE","\n                    ",370],["T_VARIABLE","$order",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","addRelatedObject",371],"(",["T_VARIABLE","$orderTransaction",371],")",";",["T_WHITESPACE","\n                ",371],"}",["T_WHITESPACE","\n            ",372],"}",["T_WHITESPACE","\n        ",373],"}",["T_WHITESPACE","\n\n        ",374],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_STRING","false",376],["T_WHITESPACE"," ",376],["T_IS_IDENTICAL","===",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","_pro",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","capture",376],"(",["T_VARIABLE","$payment",376],",",["T_WHITESPACE"," ",376],["T_VARIABLE","$amount",376],")",")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","_placeOrder",377],"(",["T_VARIABLE","$payment",377],",",["T_WHITESPACE"," ",377],["T_VARIABLE","$amount",377],")",";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE","\n\n        ",378],["T_IF","if",380],["T_WHITESPACE"," ",380],"(",["T_VARIABLE","$isAuthorizationCreated",380],["T_WHITESPACE"," ",380],["T_BOOLEAN_AND","&&",380],["T_WHITESPACE"," ",380],["T_ISSET","isset",380],"(",["T_VARIABLE","$transaction",380],")",")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n            ",380],["T_VARIABLE","$transaction",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","setIsClosed",381],"(",["T_STRING","true",381],")",";",["T_WHITESPACE","\n        ",381],"}",["T_WHITESPACE","\n\n        ",382],["T_RETURN","return",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],";",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n\n    ",385],["T_DOC_COMMENT","\/**\n     * Refund capture\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Express\n     *\/",387],["T_WHITESPACE","\n    ",393],["T_PUBLIC","public",394],["T_WHITESPACE"," ",394],["T_FUNCTION","function",394],["T_WHITESPACE"," ",394],["T_STRING","refund",394],"(",["T_STRING","Varien_Object",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$payment",394],",",["T_WHITESPACE"," ",394],["T_VARIABLE","$amount",394],")",["T_WHITESPACE","\n    ",394],"{",["T_WHITESPACE","\n        ",395],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","_pro",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","refund",396],"(",["T_VARIABLE","$payment",396],",",["T_WHITESPACE"," ",396],["T_VARIABLE","$amount",396],")",";",["T_WHITESPACE","\n        ",396],["T_RETURN","return",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],";",["T_WHITESPACE","\n    ",397],"}",["T_WHITESPACE","\n\n    ",398],["T_DOC_COMMENT","\/**\n     * Cancel payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Express\n     *\/",400],["T_WHITESPACE","\n    ",405],["T_PUBLIC","public",406],["T_WHITESPACE"," ",406],["T_FUNCTION","function",406],["T_WHITESPACE"," ",406],["T_STRING","cancel",406],"(",["T_STRING","Varien_Object",406],["T_WHITESPACE"," ",406],["T_VARIABLE","$payment",406],")",["T_WHITESPACE","\n    ",406],"{",["T_WHITESPACE","\n        ",407],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","void",408],"(",["T_VARIABLE","$payment",408],")",";",["T_WHITESPACE","\n\n        ",408],["T_RETURN","return",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],";",["T_WHITESPACE","\n    ",410],"}",["T_WHITESPACE","\n\n    ",411],["T_DOC_COMMENT","\/**\n     * Whether payment can be reviewed\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return bool\n     *\/",413],["T_WHITESPACE","\n    ",418],["T_PUBLIC","public",419],["T_WHITESPACE"," ",419],["T_FUNCTION","function",419],["T_WHITESPACE"," ",419],["T_STRING","canReviewPayment",419],"(",["T_STRING","Mage_Payment_Model_Info",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$payment",419],")",["T_WHITESPACE","\n    ",419],"{",["T_WHITESPACE","\n        ",420],["T_RETURN","return",421],["T_WHITESPACE"," ",421],["T_STRING","parent",421],["T_DOUBLE_COLON","::",421],["T_STRING","canReviewPayment",421],"(",["T_VARIABLE","$payment",421],")",["T_WHITESPACE"," ",421],["T_BOOLEAN_AND","&&",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","_pro",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","canReviewPayment",421],"(",["T_VARIABLE","$payment",421],")",";",["T_WHITESPACE","\n    ",421],"}",["T_WHITESPACE","\n\n    ",422],["T_DOC_COMMENT","\/**\n     * Attempt to accept a pending payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return bool\n     *\/",424],["T_WHITESPACE","\n    ",429],["T_PUBLIC","public",430],["T_WHITESPACE"," ",430],["T_FUNCTION","function",430],["T_WHITESPACE"," ",430],["T_STRING","acceptPayment",430],"(",["T_STRING","Mage_Payment_Model_Info",430],["T_WHITESPACE"," ",430],["T_VARIABLE","$payment",430],")",["T_WHITESPACE","\n    ",430],"{",["T_WHITESPACE","\n        ",431],["T_STRING","parent",432],["T_DOUBLE_COLON","::",432],["T_STRING","acceptPayment",432],"(",["T_VARIABLE","$payment",432],")",";",["T_WHITESPACE","\n        ",432],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","_pro",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","reviewPayment",433],"(",["T_VARIABLE","$payment",433],",",["T_WHITESPACE"," ",433],["T_STRING","Mage_Paypal_Model_Pro",433],["T_DOUBLE_COLON","::",433],["T_STRING","PAYMENT_REVIEW_ACCEPT",433],")",";",["T_WHITESPACE","\n    ",433],"}",["T_WHITESPACE","\n\n    ",434],["T_DOC_COMMENT","\/**\n     * Attempt to deny a pending payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return bool\n     *\/",436],["T_WHITESPACE","\n    ",441],["T_PUBLIC","public",442],["T_WHITESPACE"," ",442],["T_FUNCTION","function",442],["T_WHITESPACE"," ",442],["T_STRING","denyPayment",442],"(",["T_STRING","Mage_Payment_Model_Info",442],["T_WHITESPACE"," ",442],["T_VARIABLE","$payment",442],")",["T_WHITESPACE","\n    ",442],"{",["T_WHITESPACE","\n        ",443],["T_STRING","parent",444],["T_DOUBLE_COLON","::",444],["T_STRING","denyPayment",444],"(",["T_VARIABLE","$payment",444],")",";",["T_WHITESPACE","\n        ",444],["T_RETURN","return",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","_pro",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","reviewPayment",445],"(",["T_VARIABLE","$payment",445],",",["T_WHITESPACE"," ",445],["T_STRING","Mage_Paypal_Model_Pro",445],["T_DOUBLE_COLON","::",445],["T_STRING","PAYMENT_REVIEW_DENY",445],")",";",["T_WHITESPACE","\n    ",445],"}",["T_WHITESPACE","\n\n    ",446],["T_DOC_COMMENT","\/**\n     * Checkout redirect URL getter for onepage checkout (hardcode)\n     *\n     * @see Mage_Checkout_OnepageController::savePaymentAction()\n     * @see Mage_Sales_Model_Quote_Payment::getCheckoutRedirectUrl()\n     * @return string\n     *\/",448],["T_WHITESPACE","\n    ",454],["T_PUBLIC","public",455],["T_WHITESPACE"," ",455],["T_FUNCTION","function",455],["T_WHITESPACE"," ",455],["T_STRING","getCheckoutRedirectUrl",455],"(",")",["T_WHITESPACE","\n    ",455],"{",["T_WHITESPACE","\n        ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_STRING","Mage",457],["T_DOUBLE_COLON","::",457],["T_STRING","getUrl",457],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/express\/start'",457],")",";",["T_WHITESPACE","\n    ",457],"}",["T_WHITESPACE","\n\n    ",458],["T_DOC_COMMENT","\/**\n     * Fetch transaction details info\n     *\n     * @param Mage_Payment_Model_Info $payment\n     * @param string $transactionId\n     * @return array\n     *\/",460],["T_WHITESPACE","\n    ",466],["T_PUBLIC","public",467],["T_WHITESPACE"," ",467],["T_FUNCTION","function",467],["T_WHITESPACE"," ",467],["T_STRING","fetchTransactionInfo",467],"(",["T_STRING","Mage_Payment_Model_Info",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$payment",467],",",["T_WHITESPACE"," ",467],["T_VARIABLE","$transactionId",467],")",["T_WHITESPACE","\n    ",467],"{",["T_WHITESPACE","\n        ",468],["T_RETURN","return",469],["T_WHITESPACE"," ",469],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_pro",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","fetchTransactionInfo",469],"(",["T_VARIABLE","$payment",469],",",["T_WHITESPACE"," ",469],["T_VARIABLE","$transactionId",469],")",";",["T_WHITESPACE","\n    ",469],"}",["T_WHITESPACE","\n\n    ",470],["T_DOC_COMMENT","\/**\n     * Validate RP data\n     *\n     * @param Mage_Payment_Model_Recurring_Profile $profile\n     *\/",472],["T_WHITESPACE","\n    ",476],["T_PUBLIC","public",477],["T_WHITESPACE"," ",477],["T_FUNCTION","function",477],["T_WHITESPACE"," ",477],["T_STRING","validateRecurringProfile",477],"(",["T_STRING","Mage_Payment_Model_Recurring_Profile",477],["T_WHITESPACE"," ",477],["T_VARIABLE","$profile",477],")",["T_WHITESPACE","\n    ",477],"{",["T_WHITESPACE","\n        ",478],["T_RETURN","return",479],["T_WHITESPACE"," ",479],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_pro",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","validateRecurringProfile",479],"(",["T_VARIABLE","$profile",479],")",";",["T_WHITESPACE","\n    ",479],"}",["T_WHITESPACE","\n\n    ",480],["T_DOC_COMMENT","\/**\n     * Submit RP to the gateway\n     *\n     * @param Mage_Payment_Model_Recurring_Profile $profile\n     * @param Mage_Payment_Model_Info $paymentInfo\n     *\/",482],["T_WHITESPACE","\n    ",487],["T_PUBLIC","public",488],["T_WHITESPACE"," ",488],["T_FUNCTION","function",488],["T_WHITESPACE"," ",488],["T_STRING","submitRecurringProfile",488],"(",["T_STRING","Mage_Payment_Model_Recurring_Profile",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$profile",488],",",["T_WHITESPACE","\n        ",488],["T_STRING","Mage_Payment_Model_Info",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$paymentInfo",489],["T_WHITESPACE","\n    ",489],")",["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n        ",490],["T_VARIABLE","$token",491],["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_VARIABLE","$paymentInfo",491],["T_OBJECT_OPERATOR","->",491],["T_WHITESPACE","\n            ",491],["T_STRING","getAdditionalInformation",492],"(",["T_STRING","Mage_Paypal_Model_Express_Checkout",492],["T_DOUBLE_COLON","::",492],["T_STRING","PAYMENT_INFO_TRANSPORT_TOKEN",492],")",";",["T_WHITESPACE","\n        ",492],["T_VARIABLE","$profile",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","setToken",493],"(",["T_VARIABLE","$token",493],")",";",["T_WHITESPACE","\n        ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","_pro",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","submitRecurringProfile",494],"(",["T_VARIABLE","$profile",494],",",["T_WHITESPACE"," ",494],["T_VARIABLE","$paymentInfo",494],")",";",["T_WHITESPACE","\n    ",494],"}",["T_WHITESPACE","\n\n    ",495],["T_DOC_COMMENT","\/**\n     * Fetch RP details\n     *\n     * @param string $referenceId\n     * @param Varien_Object $result\n     *\/",497],["T_WHITESPACE","\n    ",502],["T_PUBLIC","public",503],["T_WHITESPACE"," ",503],["T_FUNCTION","function",503],["T_WHITESPACE"," ",503],["T_STRING","getRecurringProfileDetails",503],"(",["T_VARIABLE","$referenceId",503],",",["T_WHITESPACE"," ",503],["T_STRING","Varien_Object",503],["T_WHITESPACE"," ",503],["T_VARIABLE","$result",503],")",["T_WHITESPACE","\n    ",503],"{",["T_WHITESPACE","\n        ",504],["T_RETURN","return",505],["T_WHITESPACE"," ",505],["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","_pro",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getRecurringProfileDetails",505],"(",["T_VARIABLE","$referenceId",505],",",["T_WHITESPACE"," ",505],["T_VARIABLE","$result",505],")",";",["T_WHITESPACE","\n    ",505],"}",["T_WHITESPACE","\n\n    ",506],["T_DOC_COMMENT","\/**\n     * Whether can get recurring profile details\n     *\/",508],["T_WHITESPACE","\n    ",510],["T_PUBLIC","public",511],["T_WHITESPACE"," ",511],["T_FUNCTION","function",511],["T_WHITESPACE"," ",511],["T_STRING","canGetRecurringProfileDetails",511],"(",")",["T_WHITESPACE","\n    ",511],"{",["T_WHITESPACE","\n        ",512],["T_RETURN","return",513],["T_WHITESPACE"," ",513],["T_STRING","true",513],";",["T_WHITESPACE","\n    ",513],"}",["T_WHITESPACE","\n\n    ",514],["T_DOC_COMMENT","\/**\n     * Update RP data\n     *\n     * @param Mage_Payment_Model_Recurring_Profile $profile\n     *\/",516],["T_WHITESPACE","\n    ",520],["T_PUBLIC","public",521],["T_WHITESPACE"," ",521],["T_FUNCTION","function",521],["T_WHITESPACE"," ",521],["T_STRING","updateRecurringProfile",521],"(",["T_STRING","Mage_Payment_Model_Recurring_Profile",521],["T_WHITESPACE"," ",521],["T_VARIABLE","$profile",521],")",["T_WHITESPACE","\n    ",521],"{",["T_WHITESPACE","\n        ",522],["T_RETURN","return",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_pro",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","updateRecurringProfile",523],"(",["T_VARIABLE","$profile",523],")",";",["T_WHITESPACE","\n    ",523],"}",["T_WHITESPACE","\n\n    ",524],["T_DOC_COMMENT","\/**\n     * Manage status\n     *\n     * @param Mage_Payment_Model_Recurring_Profile $profile\n     *\/",526],["T_WHITESPACE","\n    ",530],["T_PUBLIC","public",531],["T_WHITESPACE"," ",531],["T_FUNCTION","function",531],["T_WHITESPACE"," ",531],["T_STRING","updateRecurringProfileStatus",531],"(",["T_STRING","Mage_Payment_Model_Recurring_Profile",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$profile",531],")",["T_WHITESPACE","\n    ",531],"{",["T_WHITESPACE","\n        ",532],["T_RETURN","return",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","_pro",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","updateRecurringProfileStatus",533],"(",["T_VARIABLE","$profile",533],")",";",["T_WHITESPACE","\n    ",533],"}",["T_WHITESPACE","\n\n    ",534],["T_DOC_COMMENT","\/**\n     * Assign data to info model instance\n     *\n     * @param   mixed $data\n     * @return  Mage_Payment_Model_Info\n     *\/",536],["T_WHITESPACE","\n    ",541],["T_PUBLIC","public",542],["T_WHITESPACE"," ",542],["T_FUNCTION","function",542],["T_WHITESPACE"," ",542],["T_STRING","assignData",542],"(",["T_VARIABLE","$data",542],")",["T_WHITESPACE","\n    ",542],"{",["T_WHITESPACE","\n        ",543],["T_VARIABLE","$result",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],["T_STRING","parent",544],["T_DOUBLE_COLON","::",544],["T_STRING","assignData",544],"(",["T_VARIABLE","$data",544],")",";",["T_WHITESPACE","\n        ",544],["T_VARIABLE","$key",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_STRING","Mage_Paypal_Model_Express_Checkout",545],["T_DOUBLE_COLON","::",545],["T_STRING","PAYMENT_INFO_TRANSPORT_BILLING_AGREEMENT",545],";",["T_WHITESPACE","\n        ",545],["T_IF","if",546],["T_WHITESPACE"," ",546],"(",["T_STRING","is_array",546],"(",["T_VARIABLE","$data",546],")",")",["T_WHITESPACE"," ",546],"{",["T_WHITESPACE","\n            ",546],["T_VARIABLE","$this",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","getInfoInstance",547],"(",")",["T_OBJECT_OPERATOR","->",547],["T_STRING","setAdditionalInformation",547],"(",["T_VARIABLE","$key",547],",",["T_WHITESPACE"," ",547],["T_ISSET","isset",547],"(",["T_VARIABLE","$data",547],"[",["T_VARIABLE","$key",547],"]",")",["T_WHITESPACE"," ",547],"?",["T_WHITESPACE"," ",547],["T_VARIABLE","$data",547],"[",["T_VARIABLE","$key",547],"]",["T_WHITESPACE"," ",547],":",["T_WHITESPACE"," ",547],["T_STRING","null",547],")",";",["T_WHITESPACE","\n        ",547],"}",["T_WHITESPACE","\n        ",548],["T_ELSEIF","elseif",549],["T_WHITESPACE"," ",549],"(",["T_VARIABLE","$data",549],["T_WHITESPACE"," ",549],["T_INSTANCEOF","instanceof",549],["T_WHITESPACE"," ",549],["T_STRING","Varien_Object",549],")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","getInfoInstance",550],"(",")",["T_OBJECT_OPERATOR","->",550],["T_STRING","setAdditionalInformation",550],"(",["T_VARIABLE","$key",550],",",["T_WHITESPACE"," ",550],["T_VARIABLE","$data",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","getData",550],"(",["T_VARIABLE","$key",550],")",")",";",["T_WHITESPACE","\n        ",550],"}",["T_WHITESPACE","\n        ",551],["T_RETURN","return",552],["T_WHITESPACE"," ",552],["T_VARIABLE","$result",552],";",["T_WHITESPACE","\n    ",552],"}",["T_WHITESPACE","\n\n    ",553],["T_DOC_COMMENT","\/**\n     * Place an order with authorization or capture action\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Express\n     *\/",555],["T_WHITESPACE","\n    ",561],["T_PROTECTED","protected",562],["T_WHITESPACE"," ",562],["T_FUNCTION","function",562],["T_WHITESPACE"," ",562],["T_STRING","_placeOrder",562],"(",["T_STRING","Mage_Sales_Model_Order_Payment",562],["T_WHITESPACE"," ",562],["T_VARIABLE","$payment",562],",",["T_WHITESPACE"," ",562],["T_VARIABLE","$amount",562],")",["T_WHITESPACE","\n    ",562],"{",["T_WHITESPACE","\n        ",563],["T_VARIABLE","$order",564],["T_WHITESPACE"," ",564],"=",["T_WHITESPACE"," ",564],["T_VARIABLE","$payment",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","getOrder",564],"(",")",";",["T_WHITESPACE","\n\n        ",564],["T_COMMENT","\/\/ prepare api call\n",566],["T_WHITESPACE","        ",567],["T_VARIABLE","$token",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$payment",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getAdditionalInformation",567],"(",["T_STRING","Mage_Paypal_Model_Express_Checkout",567],["T_DOUBLE_COLON","::",567],["T_STRING","PAYMENT_INFO_TRANSPORT_TOKEN",567],")",";",["T_WHITESPACE","\n        ",567],["T_VARIABLE","$api",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_pro",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getApi",568],"(",")",["T_WHITESPACE","\n            ",568],["T_OBJECT_OPERATOR","->",569],["T_STRING","setToken",569],"(",["T_VARIABLE","$token",569],")",["T_WHITESPACE","\n            ",569],["T_OBJECT_OPERATOR","->",570],["T_STRING","setPayerId",570],"(",["T_VARIABLE","$payment",570],["T_OBJECT_OPERATOR","->",570],["T_WHITESPACE","\n                ",570],["T_STRING","getAdditionalInformation",571],"(",["T_STRING","Mage_Paypal_Model_Express_Checkout",571],["T_DOUBLE_COLON","::",571],["T_STRING","PAYMENT_INFO_TRANSPORT_PAYER_ID",571],")",")",["T_WHITESPACE","\n            ",571],["T_OBJECT_OPERATOR","->",572],["T_STRING","setAmount",572],"(",["T_VARIABLE","$amount",572],")",["T_WHITESPACE","\n            ",572],["T_OBJECT_OPERATOR","->",573],["T_STRING","setPaymentAction",573],"(",["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","_pro",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","getConfig",573],"(",")",["T_OBJECT_OPERATOR","->",573],["T_STRING","paymentAction",573],")",["T_WHITESPACE","\n            ",573],["T_OBJECT_OPERATOR","->",574],["T_STRING","setNotifyUrl",574],"(",["T_STRING","Mage",574],["T_DOUBLE_COLON","::",574],["T_STRING","getUrl",574],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/ipn\/'",574],")",")",["T_WHITESPACE","\n            ",574],["T_OBJECT_OPERATOR","->",575],["T_STRING","setInvNum",575],"(",["T_VARIABLE","$order",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","getIncrementId",575],"(",")",")",["T_WHITESPACE","\n            ",575],["T_OBJECT_OPERATOR","->",576],["T_STRING","setCurrencyCode",576],"(",["T_VARIABLE","$order",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","getBaseCurrencyCode",576],"(",")",")",["T_WHITESPACE","\n            ",576],["T_OBJECT_OPERATOR","->",577],["T_STRING","setPaypalCart",577],"(",["T_STRING","Mage",577],["T_DOUBLE_COLON","::",577],["T_STRING","getModel",577],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/cart'",577],",",["T_WHITESPACE"," ",577],["T_ARRAY","array",577],"(",["T_VARIABLE","$order",577],")",")",")",["T_WHITESPACE","\n            ",577],["T_OBJECT_OPERATOR","->",578],["T_STRING","setIsLineItemsEnabled",578],"(",["T_VARIABLE","$this",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","_pro",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getConfig",578],"(",")",["T_OBJECT_OPERATOR","->",578],["T_STRING","lineItemsEnabled",578],")",";",["T_WHITESPACE","\n\n        ",578],["T_COMMENT","\/\/ call api and get details from it\n",580],["T_WHITESPACE","        ",581],["T_VARIABLE","$api",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","callDoExpressCheckoutPayment",581],"(",")",";",["T_WHITESPACE","\n\n        ",581],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","_importToPayment",583],"(",["T_VARIABLE","$api",583],",",["T_WHITESPACE"," ",583],["T_VARIABLE","$payment",583],")",";",["T_WHITESPACE","\n        ",583],["T_RETURN","return",584],["T_WHITESPACE"," ",584],["T_VARIABLE","$this",584],";",["T_WHITESPACE","\n    ",584],"}",["T_WHITESPACE","\n\n    ",585],["T_DOC_COMMENT","\/**\n     * Import payment info to payment\n     *\n     * @param Mage_Paypal_Model_Api_Nvp\n     * @param Mage_Sales_Model_Order_Payment\n     *\/",587],["T_WHITESPACE","\n    ",592],["T_PROTECTED","protected",593],["T_WHITESPACE"," ",593],["T_FUNCTION","function",593],["T_WHITESPACE"," ",593],["T_STRING","_importToPayment",593],"(",["T_VARIABLE","$api",593],",",["T_WHITESPACE"," ",593],["T_VARIABLE","$payment",593],")",["T_WHITESPACE","\n    ",593],"{",["T_WHITESPACE","\n        ",594],["T_VARIABLE","$payment",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","setTransactionId",595],"(",["T_VARIABLE","$api",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","getTransactionId",595],"(",")",")",["T_OBJECT_OPERATOR","->",595],["T_STRING","setIsTransactionClosed",595],"(",["T_LNUMBER","0",595],")",["T_WHITESPACE","\n            ",595],["T_OBJECT_OPERATOR","->",596],["T_STRING","setAdditionalInformation",596],"(",["T_STRING","Mage_Paypal_Model_Express_Checkout",596],["T_DOUBLE_COLON","::",596],["T_STRING","PAYMENT_INFO_TRANSPORT_REDIRECT",596],",",["T_WHITESPACE","\n                ",596],["T_VARIABLE","$api",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","getRedirectRequired",597],"(",")",["T_WHITESPACE","\n            ",597],")",";",["T_WHITESPACE","\n\n        ",598],["T_IF","if",600],["T_WHITESPACE"," ",600],"(",["T_VARIABLE","$api",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","getBillingAgreementId",600],"(",")",")",["T_WHITESPACE"," ",600],"{",["T_WHITESPACE","\n            ",600],["T_VARIABLE","$payment",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","setBillingAgreementData",601],"(",["T_ARRAY","array",601],"(",["T_WHITESPACE","\n                ",601],["T_CONSTANT_ENCAPSED_STRING","'billing_agreement_id'",602],["T_WHITESPACE","  ",602],["T_DOUBLE_ARROW","=>",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$api",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getBillingAgreementId",602],"(",")",",",["T_WHITESPACE","\n                ",602],["T_CONSTANT_ENCAPSED_STRING","'method_code'",603],["T_WHITESPACE","           ",603],["T_DOUBLE_ARROW","=>",603],["T_WHITESPACE"," ",603],["T_STRING","Mage_Paypal_Model_Config",603],["T_DOUBLE_COLON","::",603],["T_STRING","METHOD_BILLING_AGREEMENT",603],["T_WHITESPACE","\n            ",603],")",")",";",["T_WHITESPACE","\n        ",604],"}",["T_WHITESPACE","\n\n        ",605],["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","_pro",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","importPaymentInfo",607],"(",["T_VARIABLE","$api",607],",",["T_WHITESPACE"," ",607],["T_VARIABLE","$payment",607],")",";",["T_WHITESPACE","\n    ",607],"}",["T_WHITESPACE","\n\n    ",608],["T_DOC_COMMENT","\/**\n     * Check void availability\n     *\n     * @param   Varien_Object $payment\n     * @return  bool\n     *\/",610],["T_WHITESPACE","\n    ",615],["T_PUBLIC","public",616],["T_WHITESPACE"," ",616],["T_FUNCTION","function",616],["T_WHITESPACE"," ",616],["T_STRING","canVoid",616],"(",["T_STRING","Varien_Object",616],["T_WHITESPACE"," ",616],["T_VARIABLE","$payment",616],")",["T_WHITESPACE","\n    ",616],"{",["T_WHITESPACE","\n        ",617],["T_IF","if",618],["T_WHITESPACE"," ",618],"(",["T_VARIABLE","$payment",618],["T_WHITESPACE"," ",618],["T_INSTANCEOF","instanceof",618],["T_WHITESPACE"," ",618],["T_STRING","Mage_Sales_Model_Order_Invoice",618],["T_WHITESPACE","\n            ",618],["T_BOOLEAN_OR","||",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$payment",619],["T_WHITESPACE"," ",619],["T_INSTANCEOF","instanceof",619],["T_WHITESPACE"," ",619],["T_STRING","Mage_Sales_Model_Order_Creditmemo",619],["T_WHITESPACE","\n        ",619],")",["T_WHITESPACE"," ",620],"{",["T_WHITESPACE","\n            ",620],["T_RETURN","return",621],["T_WHITESPACE"," ",621],["T_STRING","false",621],";",["T_WHITESPACE","\n        ",621],"}",["T_WHITESPACE","\n        ",622],["T_VARIABLE","$info",623],["T_WHITESPACE"," ",623],"=",["T_WHITESPACE"," ",623],["T_VARIABLE","$this",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","getInfoInstance",623],"(",")",";",["T_WHITESPACE","\n        ",623],["T_IF","if",624],["T_WHITESPACE"," ",624],"(",["T_VARIABLE","$info",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","getAdditionalInformation",624],"(",["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","_isOrderPaymentActionKey",624],")",")",["T_WHITESPACE"," ",624],"{",["T_WHITESPACE","\n            ",624],["T_VARIABLE","$orderTransaction",625],["T_WHITESPACE"," ",625],"=",["T_WHITESPACE"," ",625],["T_VARIABLE","$info",625],["T_OBJECT_OPERATOR","->",625],["T_STRING","lookupTransaction",625],"(",["T_WHITESPACE","\n                ",625],["T_STRING","false",626],",",["T_WHITESPACE"," ",626],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",626],["T_DOUBLE_COLON","::",626],["T_STRING","TYPE_ORDER",626],["T_WHITESPACE","\n            ",626],")",";",["T_WHITESPACE","\n            ",627],["T_IF","if",628],["T_WHITESPACE"," ",628],"(",["T_VARIABLE","$orderTransaction",628],")",["T_WHITESPACE"," ",628],"{",["T_WHITESPACE","\n                ",628],["T_VARIABLE","$info",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","setParentTransactionId",629],"(",["T_VARIABLE","$orderTransaction",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","getTxnId",629],"(",")",")",";",["T_WHITESPACE","\n            ",629],"}",["T_WHITESPACE","\n        ",630],"}",["T_WHITESPACE","\n\n        ",631],["T_RETURN","return",633],["T_WHITESPACE"," ",633],["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","_canVoid",633],";",["T_WHITESPACE","\n    ",633],"}",["T_WHITESPACE","\n\n    ",634],["T_DOC_COMMENT","\/**\n     * Check capture availability\n     *\n     * @return bool\n     *\/",636],["T_WHITESPACE","\n    ",640],["T_PUBLIC","public",641],["T_WHITESPACE"," ",641],["T_FUNCTION","function",641],["T_WHITESPACE"," ",641],["T_STRING","canCapture",641],"(",")",["T_WHITESPACE","\n    ",641],"{",["T_WHITESPACE","\n        ",642],["T_VARIABLE","$payment",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","getInfoInstance",643],"(",")",";",["T_WHITESPACE","\n        ",643],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","_pro",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getConfig",644],"(",")",["T_OBJECT_OPERATOR","->",644],["T_STRING","setStoreId",644],"(",["T_VARIABLE","$payment",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getOrder",644],"(",")",["T_OBJECT_OPERATOR","->",644],["T_STRING","getStore",644],"(",")",["T_OBJECT_OPERATOR","->",644],["T_STRING","getId",644],"(",")",")",";",["T_WHITESPACE","\n\n        ",644],["T_IF","if",646],["T_WHITESPACE"," ",646],"(",["T_VARIABLE","$payment",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","getAdditionalInformation",646],"(",["T_VARIABLE","$this",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","_isOrderPaymentActionKey",646],")",")",["T_WHITESPACE"," ",646],"{",["T_WHITESPACE","\n            ",646],["T_VARIABLE","$orderTransaction",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_VARIABLE","$payment",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","lookupTransaction",647],"(",["T_STRING","false",647],",",["T_WHITESPACE","\n                ",647],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",648],["T_DOUBLE_COLON","::",648],["T_STRING","TYPE_ORDER",648],["T_WHITESPACE","\n            ",648],")",";",["T_WHITESPACE","\n            ",649],["T_IF","if",650],["T_WHITESPACE"," ",650],"(",["T_VARIABLE","$orderTransaction",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getIsClosed",650],"(",")",")",["T_WHITESPACE"," ",650],"{",["T_WHITESPACE","\n                ",650],["T_RETURN","return",651],["T_WHITESPACE"," ",651],["T_STRING","false",651],";",["T_WHITESPACE","\n            ",651],"}",["T_WHITESPACE","\n\n            ",652],["T_VARIABLE","$orderValidPeriod",654],["T_WHITESPACE"," ",654],"=",["T_WHITESPACE"," ",654],["T_STRING","abs",654],"(",["T_STRING","intval",654],"(",["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","getConfigData",654],"(",["T_CONSTANT_ENCAPSED_STRING","'order_valid_period'",654],")",")",")",";",["T_WHITESPACE","\n\n            ",654],["T_VARIABLE","$dateCompass",656],["T_WHITESPACE"," ",656],"=",["T_WHITESPACE"," ",656],["T_NEW","new",656],["T_WHITESPACE"," ",656],["T_STRING","DateTime",656],"(",["T_VARIABLE","$orderTransaction",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getCreatedAt",656],"(",")",")",";",["T_WHITESPACE","\n            ",656],["T_VARIABLE","$dateCompass",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","modify",657],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",657],["T_WHITESPACE"," ",657],".",["T_WHITESPACE"," ",657],["T_VARIABLE","$orderValidPeriod",657],["T_WHITESPACE"," ",657],".",["T_WHITESPACE"," ",657],["T_CONSTANT_ENCAPSED_STRING","' days'",657],")",";",["T_WHITESPACE","\n            ",657],["T_VARIABLE","$currentDate",658],["T_WHITESPACE"," ",658],"=",["T_WHITESPACE"," ",658],["T_NEW","new",658],["T_WHITESPACE"," ",658],["T_STRING","DateTime",658],"(",")",";",["T_WHITESPACE","\n\n            ",658],["T_IF","if",660],["T_WHITESPACE"," ",660],"(",["T_VARIABLE","$currentDate",660],["T_WHITESPACE"," ",660],">",["T_WHITESPACE"," ",660],["T_VARIABLE","$dateCompass",660],["T_WHITESPACE"," ",660],["T_BOOLEAN_OR","||",660],["T_WHITESPACE"," ",660],["T_VARIABLE","$orderValidPeriod",660],["T_WHITESPACE"," ",660],["T_IS_EQUAL","==",660],["T_WHITESPACE"," ",660],["T_LNUMBER","0",660],")",["T_WHITESPACE"," ",660],"{",["T_WHITESPACE","\n                ",660],["T_RETURN","return",661],["T_WHITESPACE"," ",661],["T_STRING","false",661],";",["T_WHITESPACE","\n            ",661],"}",["T_WHITESPACE","\n        ",662],"}",["T_WHITESPACE","\n        ",663],["T_RETURN","return",664],["T_WHITESPACE"," ",664],["T_VARIABLE","$this",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","_canCapture",664],";",["T_WHITESPACE","\n    ",664],"}",["T_WHITESPACE","\n\n    ",665],["T_DOC_COMMENT","\/**\n     * Call DoAuthorize\n     *\n     * @param int $amount\n     * @param Varien_Object $payment\n     * @param string $parentTransactionId\n     * @return Mage_Paypal_Model_Api_Abstract\n     * @throws Mage_Paypal_Model_Api_ProcessableException\n     *\/",667],["T_WHITESPACE","\n    ",675],["T_PROTECTED","protected",676],["T_WHITESPACE"," ",676],["T_FUNCTION","function",676],["T_WHITESPACE"," ",676],["T_STRING","_callDoAuthorize",676],"(",["T_VARIABLE","$amount",676],",",["T_WHITESPACE"," ",676],["T_VARIABLE","$payment",676],",",["T_WHITESPACE"," ",676],["T_VARIABLE","$parentTransactionId",676],")",["T_WHITESPACE","\n    ",676],"{",["T_WHITESPACE","\n        ",677],["T_VARIABLE","$apiData",678],["T_WHITESPACE"," ",678],"=",["T_WHITESPACE"," ",678],["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","_pro",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getApi",678],"(",")",["T_OBJECT_OPERATOR","->",678],["T_STRING","getData",678],"(",")",";",["T_WHITESPACE","\n        ",678],["T_FOREACH","foreach",679],["T_WHITESPACE"," ",679],"(",["T_VARIABLE","$apiData",679],["T_WHITESPACE"," ",679],["T_AS","as",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$k",679],["T_WHITESPACE"," ",679],["T_DOUBLE_ARROW","=>",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$v",679],")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n            ",679],["T_IF","if",680],["T_WHITESPACE"," ",680],"(",["T_STRING","is_object",680],"(",["T_VARIABLE","$v",680],")",")",["T_WHITESPACE"," ",680],"{",["T_WHITESPACE","\n                ",680],["T_UNSET","unset",681],"(",["T_VARIABLE","$apiData",681],"[",["T_VARIABLE","$k",681],"]",")",";",["T_WHITESPACE","\n            ",681],"}",["T_WHITESPACE","\n        ",682],"}",["T_WHITESPACE","\n        ",683],["T_STRING","Mage",684],["T_DOUBLE_COLON","::",684],["T_STRING","getSingleton",684],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",684],")",["T_OBJECT_OPERATOR","->",684],["T_STRING","setPaypalTransactionData",684],"(",["T_VARIABLE","$apiData",684],")",";",["T_WHITESPACE","\n        ",684],["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","_pro",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","resetApi",685],"(",")",";",["T_WHITESPACE","\n        ",685],["T_VARIABLE","$api",686],["T_WHITESPACE"," ",686],"=",["T_WHITESPACE"," ",686],["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","_setApiProcessableErrors",686],"(",")",["T_WHITESPACE","\n            ",686],["T_OBJECT_OPERATOR","->",687],["T_STRING","setAmount",687],"(",["T_VARIABLE","$amount",687],")",["T_WHITESPACE","\n            ",687],["T_OBJECT_OPERATOR","->",688],["T_STRING","setCurrencyCode",688],"(",["T_VARIABLE","$payment",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","getOrder",688],"(",")",["T_OBJECT_OPERATOR","->",688],["T_STRING","getBaseCurrencyCode",688],"(",")",")",["T_WHITESPACE","\n            ",688],["T_OBJECT_OPERATOR","->",689],["T_STRING","setTransactionId",689],"(",["T_VARIABLE","$parentTransactionId",689],")",["T_WHITESPACE","\n            ",689],["T_OBJECT_OPERATOR","->",690],["T_STRING","callDoAuthorization",690],"(",")",";",["T_WHITESPACE","\n\n        ",690],["T_VARIABLE","$payment",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","setAdditionalInformation",692],"(",["T_VARIABLE","$this",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","_authorizationCountKey",692],",",["T_WHITESPACE","\n            ",692],["T_VARIABLE","$payment",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","getAdditionalInformation",693],"(",["T_VARIABLE","$this",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","_authorizationCountKey",693],")",["T_WHITESPACE"," ",693],"+",["T_WHITESPACE"," ",693],["T_LNUMBER","1",693],["T_WHITESPACE","\n        ",693],")",";",["T_WHITESPACE","\n\n        ",694],["T_RETURN","return",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$api",696],";",["T_WHITESPACE","\n    ",696],"}",["T_WHITESPACE","\n\n    ",697],["T_DOC_COMMENT","\/**\n     * Check transaction for expiration in PST\n     *\n     * @param Mage_Sales_Model_Order_Payment_Transaction $transaction\n     * @param int $period\n     * @return boolean\n     *\/",699],["T_WHITESPACE","\n    ",705],["T_PROTECTED","protected",706],["T_WHITESPACE"," ",706],["T_FUNCTION","function",706],["T_WHITESPACE"," ",706],["T_STRING","_isTransactionExpired",706],"(",["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",706],["T_WHITESPACE"," ",706],["T_VARIABLE","$transaction",706],",",["T_WHITESPACE"," ",706],["T_VARIABLE","$period",706],")",["T_WHITESPACE","\n    ",706],"{",["T_WHITESPACE","\n        ",707],["T_VARIABLE","$period",708],["T_WHITESPACE"," ",708],"=",["T_WHITESPACE"," ",708],["T_STRING","intval",708],"(",["T_VARIABLE","$period",708],")",";",["T_WHITESPACE","\n        ",708],["T_IF","if",709],["T_WHITESPACE"," ",709],"(",["T_LNUMBER","0",709],["T_WHITESPACE"," ",709],["T_IS_EQUAL","==",709],["T_WHITESPACE"," ",709],["T_VARIABLE","$period",709],")",["T_WHITESPACE"," ",709],"{",["T_WHITESPACE","\n            ",709],["T_RETURN","return",710],["T_WHITESPACE"," ",710],["T_STRING","true",710],";",["T_WHITESPACE","\n        ",710],"}",["T_WHITESPACE","\n\n        ",711],["T_VARIABLE","$transactionClosingDate",713],["T_WHITESPACE"," ",713],"=",["T_WHITESPACE"," ",713],["T_NEW","new",713],["T_WHITESPACE"," ",713],["T_STRING","DateTime",713],"(",["T_VARIABLE","$transaction",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","getCreatedAt",713],"(",")",",",["T_WHITESPACE"," ",713],["T_NEW","new",713],["T_WHITESPACE"," ",713],["T_STRING","DateTimeZone",713],"(",["T_CONSTANT_ENCAPSED_STRING","'GMT'",713],")",")",";",["T_WHITESPACE","\n        ",713],["T_VARIABLE","$transactionClosingDate",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","setTimezone",714],"(",["T_NEW","new",714],["T_WHITESPACE"," ",714],["T_STRING","DateTimeZone",714],"(",["T_CONSTANT_ENCAPSED_STRING","'US\/Pacific'",714],")",")",";",["T_WHITESPACE","\n        ",714],["T_DOC_COMMENT","\/**\n         * 11:49:00 PayPal transactions closing time\n         *\/",715],["T_WHITESPACE","\n        ",717],["T_VARIABLE","$transactionClosingDate",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","setTime",718],"(",["T_LNUMBER","11",718],",",["T_WHITESPACE"," ",718],["T_LNUMBER","49",718],",",["T_WHITESPACE"," ",718],["T_LNUMBER","00",718],")",";",["T_WHITESPACE","\n        ",718],["T_VARIABLE","$transactionClosingDate",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","modify",719],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",719],["T_WHITESPACE"," ",719],".",["T_WHITESPACE"," ",719],["T_VARIABLE","$period",719],["T_WHITESPACE"," ",719],".",["T_WHITESPACE"," ",719],["T_CONSTANT_ENCAPSED_STRING","' days'",719],")",";",["T_WHITESPACE","\n\n        ",719],["T_VARIABLE","$currentTime",721],["T_WHITESPACE"," ",721],"=",["T_WHITESPACE"," ",721],["T_NEW","new",721],["T_WHITESPACE"," ",721],["T_STRING","DateTime",721],"(",["T_STRING","null",721],",",["T_WHITESPACE"," ",721],["T_NEW","new",721],["T_WHITESPACE"," ",721],["T_STRING","DateTimeZone",721],"(",["T_CONSTANT_ENCAPSED_STRING","'US\/Pacific'",721],")",")",";",["T_WHITESPACE","\n\n        ",721],["T_IF","if",723],["T_WHITESPACE"," ",723],"(",["T_VARIABLE","$currentTime",723],["T_WHITESPACE"," ",723],">",["T_WHITESPACE"," ",723],["T_VARIABLE","$transactionClosingDate",723],")",["T_WHITESPACE"," ",723],"{",["T_WHITESPACE","\n            ",723],["T_RETURN","return",724],["T_WHITESPACE"," ",724],["T_STRING","true",724],";",["T_WHITESPACE","\n        ",724],"}",["T_WHITESPACE","\n\n        ",725],["T_RETURN","return",727],["T_WHITESPACE"," ",727],["T_STRING","false",727],";",["T_WHITESPACE","\n    ",727],"}",["T_WHITESPACE","\n",728],"}",["T_WHITESPACE","\n",729]]