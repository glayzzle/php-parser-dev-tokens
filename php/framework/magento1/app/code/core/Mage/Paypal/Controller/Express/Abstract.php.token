[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Abstract Express Checkout Controller\n *\/",27],["T_WHITESPACE","\n",29],["T_ABSTRACT","abstract",30],["T_WHITESPACE"," ",30],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Paypal_Controller_Express_Abstract",30],["T_WHITESPACE"," ",30],["T_EXTENDS","extends",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Core_Controller_Front_Action",30],["T_WHITESPACE","\n",30],"{",["T_WHITESPACE","\n    ",31],["T_DOC_COMMENT","\/**\n     * @var Mage_Paypal_Model_Express_Checkout\n     *\/",32],["T_WHITESPACE","\n    ",34],["T_PROTECTED","protected",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$_checkout",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_STRING","null",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * @var Mage_Paypal_Model_Config\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_config",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_STRING","null",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * @var Mage_Sales_Model_Quote\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_quote",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","false",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Instantiate config\n     *\/",47],["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","_construct",50],"(",")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_STRING","parent",52],["T_DOUBLE_COLON","::",52],["T_STRING","_construct",52],"(",")",";",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_config",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","Mage",53],["T_DOUBLE_COLON","::",53],["T_STRING","getModel",53],"(",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_configType",53],",",["T_WHITESPACE"," ",53],["T_ARRAY","array",53],"(",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_configMethod",53],")",")",";",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Start Express Checkout by requesting initial token and dispatching customer to PayPal\n     *\/",56],["T_WHITESPACE","\n    ",58],["T_PUBLIC","public",59],["T_WHITESPACE"," ",59],["T_FUNCTION","function",59],["T_WHITESPACE"," ",59],["T_STRING","startAction",59],"(",")",["T_WHITESPACE","\n    ",59],"{",["T_WHITESPACE","\n        ",60],["T_TRY","try",61],["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_initCheckout",62],"(",")",";",["T_WHITESPACE","\n\n            ",62],["T_IF","if",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_getQuote",64],"(",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","getIsMultiShipping",64],"(",")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n                ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","_getQuote",65],"(",")",["T_OBJECT_OPERATOR","->",65],["T_STRING","setIsMultiShipping",65],"(",["T_STRING","false",65],")",";",["T_WHITESPACE","\n                ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_getQuote",66],"(",")",["T_OBJECT_OPERATOR","->",66],["T_STRING","removeAllAddresses",66],"(",")",";",["T_WHITESPACE","\n            ",66],"}",["T_WHITESPACE","\n\n            ",67],["T_VARIABLE","$customer",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","Mage",69],["T_DOUBLE_COLON","::",69],["T_STRING","getSingleton",69],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",69],")",["T_OBJECT_OPERATOR","->",69],["T_STRING","getCustomer",69],"(",")",";",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$quoteCheckoutMethod",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_getQuote",70],"(",")",["T_OBJECT_OPERATOR","->",70],["T_STRING","getCheckoutMethod",70],"(",")",";",["T_WHITESPACE","\n            ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(",["T_VARIABLE","$customer",71],["T_WHITESPACE"," ",71],["T_BOOLEAN_AND","&&",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$customer",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getId",71],"(",")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n                ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_checkout",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","setCustomerWithAddressChange",72],"(",["T_WHITESPACE","\n                    ",72],["T_VARIABLE","$customer",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_getQuote",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getBillingAddress",73],"(",")",",",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_getQuote",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getShippingAddress",73],"(",")",["T_WHITESPACE","\n                ",73],")",";",["T_WHITESPACE","\n            ",74],"}",["T_WHITESPACE"," ",75],["T_ELSEIF","elseif",75],["T_WHITESPACE"," ",75],"(","(","!",["T_VARIABLE","$quoteCheckoutMethod",75],["T_WHITESPACE","\n                ",75],["T_BOOLEAN_OR","||",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$quoteCheckoutMethod",76],["T_WHITESPACE"," ",76],["T_IS_NOT_EQUAL","!=",76],["T_WHITESPACE"," ",76],["T_STRING","Mage_Checkout_Model_Type_Onepage",76],["T_DOUBLE_COLON","::",76],["T_STRING","METHOD_REGISTER",76],")",["T_WHITESPACE","\n                ",76],["T_BOOLEAN_AND","&&",77],["T_WHITESPACE"," ",77],"!",["T_STRING","Mage",77],["T_DOUBLE_COLON","::",77],["T_STRING","helper",77],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",77],")",["T_OBJECT_OPERATOR","->",77],["T_STRING","isAllowedGuestCheckout",77],"(",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getQuote",78],"(",")",",",["T_WHITESPACE","\n                ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_getQuote",79],"(",")",["T_OBJECT_OPERATOR","->",79],["T_STRING","getStoreId",79],"(",")",["T_WHITESPACE","\n            ",79],")",")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n                ",80],["T_STRING","Mage",81],["T_DOUBLE_COLON","::",81],["T_STRING","getSingleton",81],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/session'",81],")",["T_OBJECT_OPERATOR","->",81],["T_STRING","addNotice",81],"(",["T_WHITESPACE","\n                    ",81],["T_STRING","Mage",82],["T_DOUBLE_COLON","::",82],["T_STRING","helper",82],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","__",82],"(",["T_CONSTANT_ENCAPSED_STRING","'To proceed to Checkout, please log in using your email address.'",82],")",["T_WHITESPACE","\n                ",82],")",";",["T_WHITESPACE","\n                ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","redirectLogin",84],"(",")",";",["T_WHITESPACE","\n                ",84],["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","getSingleton",85],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",85],")",["T_WHITESPACE","\n                    ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","setBeforeAuthUrl",86],"(",["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","getUrl",86],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/*'",86],",",["T_WHITESPACE"," ",86],["T_ARRAY","array",86],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",86],["T_WHITESPACE"," ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],["T_STRING","true",86],")",")",")",";",["T_WHITESPACE","\n                ",86],["T_RETURN","return",87],";",["T_WHITESPACE","\n            ",87],"}",["T_WHITESPACE","\n\n            ",88],["T_COMMENT","\/\/ billing agreement\n",90],["T_WHITESPACE","            ",91],["T_VARIABLE","$isBARequested",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_BOOL_CAST","(bool)",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getRequest",91],"(",")",["T_WHITESPACE","\n                ",91],["T_OBJECT_OPERATOR","->",92],["T_STRING","getParam",92],"(",["T_STRING","Mage_Paypal_Model_Express_Checkout",92],["T_DOUBLE_COLON","::",92],["T_STRING","PAYMENT_INFO_TRANSPORT_BILLING_AGREEMENT",92],")",";",["T_WHITESPACE","\n            ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$customer",93],["T_WHITESPACE"," ",93],["T_BOOLEAN_AND","&&",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$customer",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getId",93],"(",")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_checkout",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","setIsBillingAgreementRequested",94],"(",["T_VARIABLE","$isBARequested",94],")",";",["T_WHITESPACE","\n            ",94],"}",["T_WHITESPACE","\n\n            ",95],["T_COMMENT","\/\/ Bill Me Later\n",97],["T_WHITESPACE","            ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_checkout",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","setIsBml",98],"(",["T_BOOL_CAST","(bool)",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getRequest",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","getParam",98],"(",["T_CONSTANT_ENCAPSED_STRING","'bml'",98],")",")",";",["T_WHITESPACE","\n\n            ",98],["T_COMMENT","\/\/ giropay\n",100],["T_WHITESPACE","            ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_checkout",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","prepareGiropayUrls",101],"(",["T_WHITESPACE","\n                ",101],["T_STRING","Mage",102],["T_DOUBLE_COLON","::",102],["T_STRING","getUrl",102],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/onepage\/success'",102],")",",",["T_WHITESPACE","\n                ",102],["T_STRING","Mage",103],["T_DOUBLE_COLON","::",103],["T_STRING","getUrl",103],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/express\/cancel'",103],")",",",["T_WHITESPACE","\n                ",103],["T_STRING","Mage",104],["T_DOUBLE_COLON","::",104],["T_STRING","getUrl",104],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/onepage\/success'",104],")",["T_WHITESPACE","\n            ",104],")",";",["T_WHITESPACE","\n\n            ",105],["T_VARIABLE","$button",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_BOOL_CAST","(bool)",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getRequest",107],"(",")",["T_OBJECT_OPERATOR","->",107],["T_STRING","getParam",107],"(",["T_STRING","Mage_Paypal_Model_Express_Checkout",107],["T_DOUBLE_COLON","::",107],["T_STRING","PAYMENT_INFO_BUTTON",107],")",";",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$token",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_checkout",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","start",108],"(",["T_STRING","Mage",108],["T_DOUBLE_COLON","::",108],["T_STRING","getUrl",108],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/return'",108],")",",",["T_WHITESPACE"," ",108],["T_STRING","Mage",108],["T_DOUBLE_COLON","::",108],["T_STRING","getUrl",108],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/cancel'",108],")",",",["T_WHITESPACE"," ",108],["T_VARIABLE","$button",108],")",";",["T_WHITESPACE","\n            ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$token",109],["T_WHITESPACE"," ",109],["T_BOOLEAN_AND","&&",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$url",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_checkout",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getRedirectUrl",109],"(",")",")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n                ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_initToken",110],"(",["T_VARIABLE","$token",110],")",";",["T_WHITESPACE","\n                ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getResponse",111],"(",")",["T_OBJECT_OPERATOR","->",111],["T_STRING","setRedirect",111],"(",["T_VARIABLE","$url",111],")",";",["T_WHITESPACE","\n                ",111],["T_RETURN","return",112],";",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE"," ",114],["T_CATCH","catch",114],["T_WHITESPACE"," ",114],"(",["T_STRING","Mage_Core_Exception",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$e",114],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_getCheckoutSession",115],"(",")",["T_OBJECT_OPERATOR","->",115],["T_STRING","addError",115],"(",["T_VARIABLE","$e",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getMessage",115],"(",")",")",";",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE"," ",116],["T_CATCH","catch",116],["T_WHITESPACE"," ",116],"(",["T_STRING","Exception",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$e",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_getCheckoutSession",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","addError",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","__",117],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to start Express Checkout.'",117],")",")",";",["T_WHITESPACE","\n            ",117],["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","logException",118],"(",["T_VARIABLE","$e",118],")",";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE","\n\n        ",119],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_redirect",121],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",121],")",";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Return shipping options items for shipping address from request\n     *\/",124],["T_WHITESPACE","\n    ",126],["T_PUBLIC","public",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","shippingOptionsCallbackAction",127],"(",")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_TRY","try",129],["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$quoteId",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getRequest",130],"(",")",["T_OBJECT_OPERATOR","->",130],["T_STRING","getParam",130],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_id'",130],")",";",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_quote",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","Mage",131],["T_DOUBLE_COLON","::",131],["T_STRING","getModel",131],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",131],")",["T_OBJECT_OPERATOR","->",131],["T_STRING","load",131],"(",["T_VARIABLE","$quoteId",131],")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_initCheckout",132],"(",")",";",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$response",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_checkout",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getShippingOptionsCallbackResponse",133],"(",["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getRequest",133],"(",")",["T_OBJECT_OPERATOR","->",133],["T_STRING","getParams",133],"(",")",")",";",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getResponse",134],"(",")",["T_OBJECT_OPERATOR","->",134],["T_STRING","setBody",134],"(",["T_VARIABLE","$response",134],")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE"," ",135],["T_CATCH","catch",135],["T_WHITESPACE"," ",135],"(",["T_STRING","Exception",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$e",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_STRING","Mage",136],["T_DOUBLE_COLON","::",136],["T_STRING","logException",136],"(",["T_VARIABLE","$e",136],")",";",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n\n    ",138],["T_DOC_COMMENT","\/**\n     * Cancel Express Checkout\n     *\/",140],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","cancelAction",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_TRY","try",145],["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_initToken",146],"(",["T_STRING","false",146],")",";",["T_WHITESPACE","\n            ",146],["T_COMMENT","\/\/ TODO verify if this logic of order cancelation is deprecated\n",147],["T_WHITESPACE","            ",148],["T_COMMENT","\/\/ if there is an order - cancel it\n",148],["T_WHITESPACE","            ",149],["T_VARIABLE","$orderId",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_getCheckoutSession",149],"(",")",["T_OBJECT_OPERATOR","->",149],["T_STRING","getLastOrderId",149],"(",")",";",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$order",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$orderId",150],")",["T_WHITESPACE"," ",150],"?",["T_WHITESPACE"," ",150],["T_STRING","Mage",150],["T_DOUBLE_COLON","::",150],["T_STRING","getModel",150],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",150],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","load",150],"(",["T_VARIABLE","$orderId",150],")",["T_WHITESPACE"," ",150],":",["T_WHITESPACE"," ",150],["T_STRING","false",150],";",["T_WHITESPACE","\n            ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(",["T_VARIABLE","$order",151],["T_WHITESPACE"," ",151],["T_BOOLEAN_AND","&&",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$order",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getId",151],"(",")",["T_WHITESPACE"," ",151],["T_BOOLEAN_AND","&&",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$order",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getQuoteId",151],"(",")",["T_WHITESPACE"," ",151],["T_IS_EQUAL","==",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_getCheckoutSession",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","getQuoteId",151],"(",")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                ",151],["T_VARIABLE","$order",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","cancel",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","save",152],"(",")",";",["T_WHITESPACE","\n                ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_getCheckoutSession",153],"(",")",["T_WHITESPACE","\n                    ",153],["T_OBJECT_OPERATOR","->",154],["T_STRING","unsLastQuoteId",154],"(",")",["T_WHITESPACE","\n                    ",154],["T_OBJECT_OPERATOR","->",155],["T_STRING","unsLastSuccessQuoteId",155],"(",")",["T_WHITESPACE","\n                    ",155],["T_OBJECT_OPERATOR","->",156],["T_STRING","unsLastOrderId",156],"(",")",["T_WHITESPACE","\n                    ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","unsLastRealOrderId",157],"(",")",["T_WHITESPACE","\n                    ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","addSuccess",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","__",158],"(",["T_CONSTANT_ENCAPSED_STRING","'Express Checkout and Order have been canceled.'",158],")",")",["T_WHITESPACE","\n                ",158],";",["T_WHITESPACE","\n            ",159],"}",["T_WHITESPACE"," ",160],["T_ELSE","else",160],["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_getCheckoutSession",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","addSuccess",161],"(",["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","__",161],"(",["T_CONSTANT_ENCAPSED_STRING","'Express Checkout has been canceled.'",161],")",")",";",["T_WHITESPACE","\n            ",161],"}",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE"," ",163],["T_CATCH","catch",163],["T_WHITESPACE"," ",163],"(",["T_STRING","Mage_Core_Exception",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$e",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_getCheckoutSession",164],"(",")",["T_OBJECT_OPERATOR","->",164],["T_STRING","addError",164],"(",["T_VARIABLE","$e",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getMessage",164],"(",")",")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE"," ",165],["T_CATCH","catch",165],["T_WHITESPACE"," ",165],"(",["T_STRING","Exception",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$e",165],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_getCheckoutSession",166],"(",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","addError",166],"(",["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","__",166],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to cancel Express Checkout.'",166],")",")",";",["T_WHITESPACE","\n            ",166],["T_STRING","Mage",167],["T_DOUBLE_COLON","::",167],["T_STRING","logException",167],"(",["T_VARIABLE","$e",167],")",";",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n\n        ",168],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_redirect",170],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",170],")",";",["T_WHITESPACE","\n    ",170],"}",["T_WHITESPACE","\n\n    ",171],["T_DOC_COMMENT","\/**\n     * Return from PayPal and dispatch customer to order review page\n     *\/",173],["T_WHITESPACE","\n    ",175],["T_PUBLIC","public",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","returnAction",176],"(",")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getRequest",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","getParam",178],"(",["T_CONSTANT_ENCAPSED_STRING","'retry_authorization'",178],")",["T_WHITESPACE"," ",178],["T_IS_EQUAL","==",178],["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","'true'",178],["T_WHITESPACE","\n            ",178],["T_BOOLEAN_AND","&&",179],["T_WHITESPACE"," ",179],["T_STRING","is_array",179],"(",["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_getCheckoutSession",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","getPaypalTransactionData",179],"(",")",")",["T_WHITESPACE","\n        ",179],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_forward",181],"(",["T_CONSTANT_ENCAPSED_STRING","'placeOrder'",181],")",";",["T_WHITESPACE","\n            ",181],["T_RETURN","return",182],";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n        ",183],["T_TRY","try",184],["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_getCheckoutSession",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","unsPaypalTransactionData",185],"(",")",";",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_checkout",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_initCheckout",186],"(",")",";",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_checkout",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","returnFromPaypal",187],"(",["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_initToken",187],"(",")",")",";",["T_WHITESPACE","\n\n            ",187],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_checkout",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","canSkipOrderReviewStep",189],"(",")",")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n                ",189],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_forward",190],"(",["T_CONSTANT_ENCAPSED_STRING","'placeOrder'",190],")",";",["T_WHITESPACE","\n            ",190],"}",["T_WHITESPACE"," ",191],["T_ELSE","else",191],["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n                ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_redirect",192],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",192],")",";",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE","\n\n            ",193],["T_RETURN","return",195],";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE"," ",196],["T_CATCH","catch",196],["T_WHITESPACE"," ",196],"(",["T_STRING","Mage_Core_Exception",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$e",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_STRING","Mage",197],["T_DOUBLE_COLON","::",197],["T_STRING","getSingleton",197],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",197],")",["T_OBJECT_OPERATOR","->",197],["T_STRING","addError",197],"(",["T_VARIABLE","$e",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getMessage",197],"(",")",")",";",["T_WHITESPACE","\n        ",197],"}",["T_WHITESPACE","\n        ",198],["T_CATCH","catch",199],["T_WHITESPACE"," ",199],"(",["T_STRING","Exception",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$e",199],")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n            ",199],["T_STRING","Mage",200],["T_DOUBLE_COLON","::",200],["T_STRING","getSingleton",200],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",200],")",["T_OBJECT_OPERATOR","->",200],["T_STRING","addError",200],"(",["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","__",200],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to process Express Checkout approval.'",200],")",")",";",["T_WHITESPACE","\n            ",200],["T_STRING","Mage",201],["T_DOUBLE_COLON","::",201],["T_STRING","logException",201],"(",["T_VARIABLE","$e",201],")",";",["T_WHITESPACE","\n        ",201],"}",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_redirect",203],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",203],")",";",["T_WHITESPACE","\n    ",203],"}",["T_WHITESPACE","\n\n    ",204],["T_DOC_COMMENT","\/**\n     * Review order after returning from PayPal\n     *\/",206],["T_WHITESPACE","\n    ",208],["T_PUBLIC","public",209],["T_WHITESPACE"," ",209],["T_FUNCTION","function",209],["T_WHITESPACE"," ",209],["T_STRING","reviewAction",209],"(",")",["T_WHITESPACE","\n    ",209],"{",["T_WHITESPACE","\n        ",210],["T_TRY","try",211],["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","_initCheckout",212],"(",")",";",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_checkout",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","prepareOrderReview",213],"(",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_initToken",213],"(",")",")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","loadLayout",214],"(",")",";",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_initLayoutMessages",215],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/session'",215],")",";",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$reviewBlock",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getLayout",216],"(",")",["T_OBJECT_OPERATOR","->",216],["T_STRING","getBlock",216],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal.express.review'",216],")",";",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$reviewBlock",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","setQuote",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_getQuote",217],"(",")",")",";",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$reviewBlock",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getChild",218],"(",["T_CONSTANT_ENCAPSED_STRING","'details'",218],")",["T_OBJECT_OPERATOR","->",218],["T_STRING","setQuote",218],"(",["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_getQuote",218],"(",")",")",";",["T_WHITESPACE","\n            ",218],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$reviewBlock",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getChild",219],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",219],")",")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n                ",219],["T_VARIABLE","$reviewBlock",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getChild",220],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",220],")",["T_OBJECT_OPERATOR","->",220],["T_STRING","setQuote",220],"(",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_getQuote",220],"(",")",")",";",["T_WHITESPACE","\n            ",220],"}",["T_WHITESPACE","\n            ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","renderLayout",222],"(",")",";",["T_WHITESPACE","\n            ",222],["T_RETURN","return",223],";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE","\n        ",224],["T_CATCH","catch",225],["T_WHITESPACE"," ",225],"(",["T_STRING","Mage_Core_Exception",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$e",225],")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n            ",225],["T_STRING","Mage",226],["T_DOUBLE_COLON","::",226],["T_STRING","getSingleton",226],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",226],")",["T_OBJECT_OPERATOR","->",226],["T_STRING","addError",226],"(",["T_VARIABLE","$e",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getMessage",226],"(",")",")",";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE","\n        ",227],["T_CATCH","catch",228],["T_WHITESPACE"," ",228],"(",["T_STRING","Exception",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$e",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_STRING","Mage",229],["T_DOUBLE_COLON","::",229],["T_STRING","getSingleton",229],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",229],")",["T_OBJECT_OPERATOR","->",229],["T_STRING","addError",229],"(",["T_WHITESPACE","\n                ",229],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","__",230],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize Express Checkout review.'",230],")",["T_WHITESPACE","\n            ",230],")",";",["T_WHITESPACE","\n            ",231],["T_STRING","Mage",232],["T_DOUBLE_COLON","::",232],["T_STRING","logException",232],"(",["T_VARIABLE","$e",232],")",";",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_redirect",234],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",234],")",";",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Dispatch customer back to PayPal for editing payment information\n     *\/",237],["T_WHITESPACE","\n    ",239],["T_PUBLIC","public",240],["T_WHITESPACE"," ",240],["T_FUNCTION","function",240],["T_WHITESPACE"," ",240],["T_STRING","editAction",240],"(",")",["T_WHITESPACE","\n    ",240],"{",["T_WHITESPACE","\n        ",241],["T_TRY","try",242],["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getResponse",243],"(",")",["T_OBJECT_OPERATOR","->",243],["T_STRING","setRedirect",243],"(",["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_config",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getExpressCheckoutEditUrl",243],"(",["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_initToken",243],"(",")",")",")",";",["T_WHITESPACE","\n        ",243],"}",["T_WHITESPACE","\n        ",244],["T_CATCH","catch",245],["T_WHITESPACE"," ",245],"(",["T_STRING","Mage_Core_Exception",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$e",245],")",["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n            ",245],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_getSession",246],"(",")",["T_OBJECT_OPERATOR","->",246],["T_STRING","addError",246],"(",["T_VARIABLE","$e",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getMessage",246],"(",")",")",";",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_redirect",247],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",247],")",";",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE","\n    ",248],"}",["T_WHITESPACE","\n\n    ",249],["T_DOC_COMMENT","\/**\n     * Update shipping method (combined action for ajax and regular request)\n     *\/",251],["T_WHITESPACE","\n    ",253],["T_PUBLIC","public",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","saveShippingMethodAction",254],"(",")",["T_WHITESPACE","\n    ",254],"{",["T_WHITESPACE","\n        ",255],["T_TRY","try",256],["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$isAjax",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getRequest",257],"(",")",["T_OBJECT_OPERATOR","->",257],["T_STRING","getParam",257],"(",["T_CONSTANT_ENCAPSED_STRING","'isAjax'",257],")",";",["T_WHITESPACE","\n            ",257],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","_initCheckout",258],"(",")",";",["T_WHITESPACE","\n            ",258],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_checkout",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","updateShippingMethod",259],"(",["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getRequest",259],"(",")",["T_OBJECT_OPERATOR","->",259],["T_STRING","getParam",259],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",259],")",")",";",["T_WHITESPACE","\n            ",259],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$isAjax",260],")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n                ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","loadLayout",261],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_express_review_details'",261],")",";",["T_WHITESPACE","\n                ",261],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getResponse",262],"(",")",["T_OBJECT_OPERATOR","->",262],["T_STRING","setBody",262],"(",["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getLayout",262],"(",")",["T_OBJECT_OPERATOR","->",262],["T_STRING","getBlock",262],"(",["T_CONSTANT_ENCAPSED_STRING","'root'",262],")",["T_WHITESPACE","\n                    ",262],["T_OBJECT_OPERATOR","->",263],["T_STRING","setQuote",263],"(",["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_getQuote",263],"(",")",")",["T_WHITESPACE","\n                    ",263],["T_OBJECT_OPERATOR","->",264],["T_STRING","toHtml",264],"(",")",")",";",["T_WHITESPACE","\n                ",264],["T_RETURN","return",265],";",["T_WHITESPACE","\n            ",265],"}",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE"," ",267],["T_CATCH","catch",267],["T_WHITESPACE"," ",267],"(",["T_STRING","Mage_Core_Exception",267],["T_WHITESPACE"," ",267],["T_VARIABLE","$e",267],")",["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n            ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_getSession",268],"(",")",["T_OBJECT_OPERATOR","->",268],["T_STRING","addError",268],"(",["T_VARIABLE","$e",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getMessage",268],"(",")",")",";",["T_WHITESPACE","\n        ",268],"}",["T_WHITESPACE"," ",269],["T_CATCH","catch",269],["T_WHITESPACE"," ",269],"(",["T_STRING","Exception",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$e",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_getSession",270],"(",")",["T_OBJECT_OPERATOR","->",270],["T_STRING","addError",270],"(",["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","__",270],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to update shipping method.'",270],")",")",";",["T_WHITESPACE","\n            ",270],["T_STRING","Mage",271],["T_DOUBLE_COLON","::",271],["T_STRING","logException",271],"(",["T_VARIABLE","$e",271],")",";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE","\n        ",272],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_VARIABLE","$isAjax",273],")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getResponse",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","setBody",274],"(",["T_CONSTANT_ENCAPSED_STRING","'<script type=\"text\/javascript\">window.location.href = '",274],["T_WHITESPACE","\n                ",274],".",["T_WHITESPACE"," ",275],["T_STRING","Mage",275],["T_DOUBLE_COLON","::",275],["T_STRING","getUrl",275],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",275],")",["T_WHITESPACE"," ",275],".",["T_WHITESPACE"," ",275],["T_CONSTANT_ENCAPSED_STRING","';<\/script>'",275],")",";",["T_WHITESPACE","\n        ",275],"}",["T_WHITESPACE"," ",276],["T_ELSE","else",276],["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n            ",276],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_redirect",277],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",277],")",";",["T_WHITESPACE","\n        ",277],"}",["T_WHITESPACE","\n    ",278],"}",["T_WHITESPACE","\n\n    ",279],["T_DOC_COMMENT","\/**\n     * Update Order (combined action for ajax and regular request)\n     *\/",281],["T_WHITESPACE","\n    ",283],["T_PUBLIC","public",284],["T_WHITESPACE"," ",284],["T_FUNCTION","function",284],["T_WHITESPACE"," ",284],["T_STRING","updateShippingMethodsAction",284],"(",")",["T_WHITESPACE","\n    ",284],"{",["T_WHITESPACE","\n        ",285],["T_TRY","try",286],["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_initCheckout",287],"(",")",";",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_checkout",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","prepareOrderReview",288],"(",["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_initToken",288],"(",")",")",";",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","loadLayout",289],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_express_review'",289],")",";",["T_WHITESPACE","\n\n            ",289],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getResponse",291],"(",")",["T_OBJECT_OPERATOR","->",291],["T_STRING","setBody",291],"(",["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getLayout",291],"(",")",["T_OBJECT_OPERATOR","->",291],["T_STRING","getBlock",291],"(",["T_CONSTANT_ENCAPSED_STRING","'express.review.shipping.method'",291],")",["T_WHITESPACE","\n                ",291],["T_OBJECT_OPERATOR","->",292],["T_STRING","setQuote",292],"(",["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","_getQuote",292],"(",")",")",["T_WHITESPACE","\n                ",292],["T_OBJECT_OPERATOR","->",293],["T_STRING","toHtml",293],"(",")",")",";",["T_WHITESPACE","\n            ",293],["T_RETURN","return",294],";",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE"," ",295],["T_CATCH","catch",295],["T_WHITESPACE"," ",295],"(",["T_STRING","Mage_Core_Exception",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$e",295],")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_getSession",296],"(",")",["T_OBJECT_OPERATOR","->",296],["T_STRING","addError",296],"(",["T_VARIABLE","$e",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getMessage",296],"(",")",")",";",["T_WHITESPACE","\n        ",296],"}",["T_WHITESPACE"," ",297],["T_CATCH","catch",297],["T_WHITESPACE"," ",297],"(",["T_STRING","Exception",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$e",297],")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n            ",297],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_getSession",298],"(",")",["T_OBJECT_OPERATOR","->",298],["T_STRING","addError",298],"(",["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","__",298],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to update shipping method.'",298],")",")",";",["T_WHITESPACE","\n            ",298],["T_STRING","Mage",299],["T_DOUBLE_COLON","::",299],["T_STRING","logException",299],"(",["T_VARIABLE","$e",299],")",";",["T_WHITESPACE","\n        ",299],"}",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getResponse",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","setBody",301],"(",["T_CONSTANT_ENCAPSED_STRING","'<script type=\"text\/javascript\">window.location.href = '",301],["T_WHITESPACE","\n            ",301],".",["T_WHITESPACE"," ",302],["T_STRING","Mage",302],["T_DOUBLE_COLON","::",302],["T_STRING","getUrl",302],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",302],")",["T_WHITESPACE"," ",302],".",["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","';<\/script>'",302],")",";",["T_WHITESPACE","\n    ",302],"}",["T_WHITESPACE","\n\n    ",303],["T_DOC_COMMENT","\/**\n     * Submit the order\n     *\/",305],["T_WHITESPACE","\n    ",307],["T_PUBLIC","public",308],["T_WHITESPACE"," ",308],["T_FUNCTION","function",308],["T_WHITESPACE"," ",308],["T_STRING","placeOrderAction",308],"(",")",["T_WHITESPACE","\n    ",308],"{",["T_WHITESPACE","\n        ",309],["T_TRY","try",310],["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_VARIABLE","$requiredAgreements",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_STRING","Mage",311],["T_DOUBLE_COLON","::",311],["T_STRING","helper",311],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",311],")",["T_OBJECT_OPERATOR","->",311],["T_STRING","getRequiredAgreementIds",311],"(",")",";",["T_WHITESPACE","\n            ",311],["T_IF","if",312],["T_WHITESPACE"," ",312],"(",["T_VARIABLE","$requiredAgreements",312],")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n                ",312],["T_VARIABLE","$postedAgreements",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_STRING","array_keys",313],"(",["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getRequest",313],"(",")",["T_OBJECT_OPERATOR","->",313],["T_STRING","getPost",313],"(",["T_CONSTANT_ENCAPSED_STRING","'agreement'",313],",",["T_WHITESPACE"," ",313],["T_ARRAY","array",313],"(",")",")",")",";",["T_WHITESPACE","\n                ",313],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_STRING","array_diff",314],"(",["T_VARIABLE","$requiredAgreements",314],",",["T_WHITESPACE"," ",314],["T_VARIABLE","$postedAgreements",314],")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n                    ",314],["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","throwException",315],"(",["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","helper",315],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",315],")",["T_OBJECT_OPERATOR","->",315],["T_STRING","__",315],"(",["T_CONSTANT_ENCAPSED_STRING","'Please agree to all the terms and conditions before placing the order.'",315],")",")",";",["T_WHITESPACE","\n                ",315],"}",["T_WHITESPACE","\n            ",316],"}",["T_WHITESPACE","\n\n            ",317],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_initCheckout",319],"(",")",";",["T_WHITESPACE","\n            ",319],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_checkout",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","place",320],"(",["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_initToken",320],"(",")",")",";",["T_WHITESPACE","\n\n            ",320],["T_COMMENT","\/\/ prepare session to success or cancellation page\n",322],["T_WHITESPACE","            ",323],["T_VARIABLE","$session",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","_getCheckoutSession",323],"(",")",";",["T_WHITESPACE","\n            ",323],["T_VARIABLE","$session",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","clearHelperData",324],"(",")",";",["T_WHITESPACE","\n\n            ",324],["T_COMMENT","\/\/ \"last successful quote\"\n",326],["T_WHITESPACE","            ",327],["T_VARIABLE","$quoteId",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_getQuote",327],"(",")",["T_OBJECT_OPERATOR","->",327],["T_STRING","getId",327],"(",")",";",["T_WHITESPACE","\n            ",327],["T_VARIABLE","$session",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","setLastQuoteId",328],"(",["T_VARIABLE","$quoteId",328],")",["T_OBJECT_OPERATOR","->",328],["T_STRING","setLastSuccessQuoteId",328],"(",["T_VARIABLE","$quoteId",328],")",";",["T_WHITESPACE","\n\n            ",328],["T_COMMENT","\/\/ an order may be created\n",330],["T_WHITESPACE","            ",331],["T_VARIABLE","$order",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","_checkout",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getOrder",331],"(",")",";",["T_WHITESPACE","\n            ",331],["T_IF","if",332],["T_WHITESPACE"," ",332],"(",["T_VARIABLE","$order",332],")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n                ",332],["T_VARIABLE","$session",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","setLastOrderId",333],"(",["T_VARIABLE","$order",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getId",333],"(",")",")",["T_WHITESPACE","\n                    ",333],["T_OBJECT_OPERATOR","->",334],["T_STRING","setLastRealOrderId",334],"(",["T_VARIABLE","$order",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getIncrementId",334],"(",")",")",";",["T_WHITESPACE","\n                ",334],["T_COMMENT","\/\/ as well a billing agreement can be created\n",335],["T_WHITESPACE","                ",336],["T_VARIABLE","$agreement",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_checkout",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getBillingAgreement",336],"(",")",";",["T_WHITESPACE","\n                ",336],["T_IF","if",337],["T_WHITESPACE"," ",337],"(",["T_VARIABLE","$agreement",337],")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                    ",337],["T_VARIABLE","$session",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","setLastBillingAgreementId",338],"(",["T_VARIABLE","$agreement",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getId",338],"(",")",")",";",["T_WHITESPACE","\n                ",338],"}",["T_WHITESPACE","\n            ",339],"}",["T_WHITESPACE","\n\n            ",340],["T_COMMENT","\/\/ recurring profiles may be created along with the order or without it\n",342],["T_WHITESPACE","            ",343],["T_VARIABLE","$profiles",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_checkout",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getRecurringPaymentProfiles",343],"(",")",";",["T_WHITESPACE","\n            ",343],["T_IF","if",344],["T_WHITESPACE"," ",344],"(",["T_VARIABLE","$profiles",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n                ",344],["T_VARIABLE","$ids",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_ARRAY","array",345],"(",")",";",["T_WHITESPACE","\n                ",345],["T_FOREACH","foreach",346],"(",["T_VARIABLE","$profiles",346],["T_WHITESPACE"," ",346],["T_AS","as",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$profile",346],")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n                    ",346],["T_VARIABLE","$ids",347],"[","]",["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_VARIABLE","$profile",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getId",347],"(",")",";",["T_WHITESPACE","\n                ",347],"}",["T_WHITESPACE","\n                ",348],["T_VARIABLE","$session",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","setLastRecurringProfileIds",349],"(",["T_VARIABLE","$ids",349],")",";",["T_WHITESPACE","\n            ",349],"}",["T_WHITESPACE","\n\n            ",350],["T_COMMENT","\/\/ redirect if PayPal specified some URL (for example, to Giropay bank)\n",352],["T_WHITESPACE","            ",353],["T_VARIABLE","$url",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_checkout",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getRedirectUrl",353],"(",")",";",["T_WHITESPACE","\n            ",353],["T_IF","if",354],["T_WHITESPACE"," ",354],"(",["T_VARIABLE","$url",354],")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n                ",354],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getResponse",355],"(",")",["T_OBJECT_OPERATOR","->",355],["T_STRING","setRedirect",355],"(",["T_VARIABLE","$url",355],")",";",["T_WHITESPACE","\n                ",355],["T_RETURN","return",356],";",["T_WHITESPACE","\n            ",356],"}",["T_WHITESPACE","\n            ",357],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","_initToken",358],"(",["T_STRING","false",358],")",";",["T_WHITESPACE"," ",358],["T_COMMENT","\/\/ no need in token anymore\n",358],["T_WHITESPACE","            ",359],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","_redirect",359],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/onepage\/success'",359],")",";",["T_WHITESPACE","\n            ",359],["T_RETURN","return",360],";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE"," ",361],["T_CATCH","catch",361],["T_WHITESPACE"," ",361],"(",["T_STRING","Mage_Paypal_Model_Api_ProcessableException",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$e",361],")",["T_WHITESPACE"," ",361],"{",["T_WHITESPACE","\n            ",361],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","_processPaypalApiError",362],"(",["T_VARIABLE","$e",362],")",";",["T_WHITESPACE","\n        ",362],"}",["T_WHITESPACE"," ",363],["T_CATCH","catch",363],["T_WHITESPACE"," ",363],"(",["T_STRING","Mage_Core_Exception",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$e",363],")",["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n            ",363],["T_STRING","Mage",364],["T_DOUBLE_COLON","::",364],["T_STRING","helper",364],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",364],")",["T_OBJECT_OPERATOR","->",364],["T_STRING","sendPaymentFailedEmail",364],"(",["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_getQuote",364],"(",")",",",["T_WHITESPACE"," ",364],["T_VARIABLE","$e",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getMessage",364],"(",")",")",";",["T_WHITESPACE","\n            ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_getSession",365],"(",")",["T_OBJECT_OPERATOR","->",365],["T_STRING","addError",365],"(",["T_VARIABLE","$e",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getMessage",365],"(",")",")",";",["T_WHITESPACE","\n            ",365],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","_redirect",366],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",366],")",";",["T_WHITESPACE","\n        ",366],"}",["T_WHITESPACE"," ",367],["T_CATCH","catch",367],["T_WHITESPACE"," ",367],"(",["T_STRING","Exception",367],["T_WHITESPACE"," ",367],["T_VARIABLE","$e",367],")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n            ",367],["T_STRING","Mage",368],["T_DOUBLE_COLON","::",368],["T_STRING","helper",368],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",368],")",["T_OBJECT_OPERATOR","->",368],["T_STRING","sendPaymentFailedEmail",368],"(",["T_WHITESPACE","\n                ",368],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_getQuote",369],"(",")",",",["T_WHITESPACE","\n                ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","__",370],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to place the order.'",370],")",["T_WHITESPACE","\n            ",370],")",";",["T_WHITESPACE","\n            ",371],["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","_getSession",372],"(",")",["T_OBJECT_OPERATOR","->",372],["T_STRING","addError",372],"(",["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","__",372],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to place the order.'",372],")",")",";",["T_WHITESPACE","\n            ",372],["T_STRING","Mage",373],["T_DOUBLE_COLON","::",373],["T_STRING","logException",373],"(",["T_VARIABLE","$e",373],")",";",["T_WHITESPACE","\n            ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_redirect",374],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/review'",374],")",";",["T_WHITESPACE","\n        ",374],"}",["T_WHITESPACE","\n    ",375],"}",["T_WHITESPACE","\n\n    ",376],["T_DOC_COMMENT","\/**\n     * Process PayPal API's processable errors\n     *\n     * @param Mage_Paypal_Model_Api_ProcessableException $exception\n     * @throws Mage_Paypal_Model_Api_ProcessableException\n     *\/",378],["T_WHITESPACE","\n    ",383],["T_PROTECTED","protected",384],["T_WHITESPACE"," ",384],["T_FUNCTION","function",384],["T_WHITESPACE"," ",384],["T_STRING","_processPaypalApiError",384],"(",["T_VARIABLE","$exception",384],")",["T_WHITESPACE","\n    ",384],"{",["T_WHITESPACE","\n        ",385],["T_SWITCH","switch",386],["T_WHITESPACE"," ",386],"(",["T_VARIABLE","$exception",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getCode",386],"(",")",")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n            ",386],["T_CASE","case",387],["T_WHITESPACE"," ",387],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",387],["T_DOUBLE_COLON","::",387],["T_STRING","API_MAX_PAYMENT_ATTEMPTS_EXCEEDED",387],":",["T_WHITESPACE","\n            ",387],["T_CASE","case",388],["T_WHITESPACE"," ",388],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",388],["T_DOUBLE_COLON","::",388],["T_STRING","API_TRANSACTION_EXPIRED",388],":",["T_WHITESPACE","\n                ",388],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getResponse",389],"(",")",["T_OBJECT_OPERATOR","->",389],["T_STRING","setRedirect",389],"(",["T_WHITESPACE","\n                    ",389],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","_getQuote",390],"(",")",["T_OBJECT_OPERATOR","->",390],["T_STRING","getPayment",390],"(",")",["T_OBJECT_OPERATOR","->",390],["T_STRING","getCheckoutRedirectUrl",390],"(",")",["T_WHITESPACE","\n                ",390],")",";",["T_WHITESPACE","\n                ",391],["T_BREAK","break",392],";",["T_WHITESPACE","\n            ",392],["T_CASE","case",393],["T_WHITESPACE"," ",393],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",393],["T_DOUBLE_COLON","::",393],["T_STRING","API_DO_EXPRESS_CHECKOUT_FAIL",393],":",["T_WHITESPACE","\n                ",393],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","_redirectSameToken",394],"(",")",";",["T_WHITESPACE","\n                ",394],["T_BREAK","break",395],";",["T_WHITESPACE","\n            ",395],["T_CASE","case",396],["T_WHITESPACE"," ",396],["T_STRING","Mage_Paypal_Model_Api_ProcessableException",396],["T_DOUBLE_COLON","::",396],["T_STRING","API_UNABLE_TRANSACTION_COMPLETE",396],":",["T_WHITESPACE","\n                ",396],["T_IF","if",397],["T_WHITESPACE"," ",397],"(",["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","_config",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getPaymentAction",397],"(",")",["T_WHITESPACE"," ",397],["T_IS_EQUAL","==",397],["T_WHITESPACE"," ",397],["T_STRING","Mage_Payment_Model_Method_Abstract",397],["T_DOUBLE_COLON","::",397],["T_STRING","ACTION_ORDER",397],")",["T_WHITESPACE"," ",397],"{",["T_WHITESPACE","\n                    ",397],["T_VARIABLE","$paypalTransactionData",398],["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_VARIABLE","$this",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","_getCheckoutSession",398],"(",")",["T_OBJECT_OPERATOR","->",398],["T_STRING","getPaypalTransactionData",398],"(",")",";",["T_WHITESPACE","\n                    ",398],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getResponse",399],"(",")",["T_OBJECT_OPERATOR","->",399],["T_STRING","setRedirect",399],"(",["T_WHITESPACE","\n                        ",399],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","_config",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getExpressCheckoutOrderUrl",400],"(",["T_VARIABLE","$paypalTransactionData",400],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",400],"]",")",["T_WHITESPACE","\n                    ",400],")",";",["T_WHITESPACE","\n                ",401],"}",["T_WHITESPACE"," ",402],["T_ELSE","else",402],["T_WHITESPACE"," ",402],"{",["T_WHITESPACE","\n                    ",402],["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_redirectSameToken",403],"(",")",";",["T_WHITESPACE","\n                ",403],"}",["T_WHITESPACE","\n                ",404],["T_BREAK","break",405],";",["T_WHITESPACE","\n            ",405],["T_DEFAULT","default",406],":",["T_WHITESPACE","\n                ",406],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","_redirectToCartAndShowError",407],"(",["T_VARIABLE","$exception",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getUserMessage",407],"(",")",")",";",["T_WHITESPACE","\n                ",407],["T_BREAK","break",408],";",["T_WHITESPACE","\n        ",408],"}",["T_WHITESPACE","\n\n    ",409],"}",["T_WHITESPACE","\n\n    ",411],["T_DOC_COMMENT","\/**\n     * Redirect customer back to PayPal with the same token\n     *\/",413],["T_WHITESPACE","\n    ",415],["T_PROTECTED","protected",416],["T_WHITESPACE"," ",416],["T_FUNCTION","function",416],["T_WHITESPACE"," ",416],["T_STRING","_redirectSameToken",416],"(",")",["T_WHITESPACE","\n    ",416],"{",["T_WHITESPACE","\n        ",417],["T_VARIABLE","$token",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","_initToken",418],"(",")",";",["T_WHITESPACE","\n        ",418],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getResponse",419],"(",")",["T_OBJECT_OPERATOR","->",419],["T_STRING","setRedirect",419],"(",["T_WHITESPACE","\n            ",419],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","_config",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getExpressCheckoutStartUrl",420],"(",["T_VARIABLE","$token",420],")",["T_WHITESPACE","\n        ",420],")",";",["T_WHITESPACE","\n    ",421],"}",["T_WHITESPACE","\n\n    ",422],["T_DOC_COMMENT","\/**\n     * Redirect customer to shopping cart and show error message\n     *\n     * @param string $errorMessage\n     *\/",424],["T_WHITESPACE","\n    ",428],["T_PROTECTED","protected",429],["T_WHITESPACE"," ",429],["T_FUNCTION","function",429],["T_WHITESPACE"," ",429],["T_STRING","_redirectToCartAndShowError",429],"(",["T_VARIABLE","$errorMessage",429],")",["T_WHITESPACE","\n    ",429],"{",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$cart",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_STRING","Mage",431],["T_DOUBLE_COLON","::",431],["T_STRING","getSingleton",431],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",431],")",";",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$cart",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getCheckoutSession",432],"(",")",["T_OBJECT_OPERATOR","->",432],["T_STRING","addError",432],"(",["T_VARIABLE","$errorMessage",432],")",";",["T_WHITESPACE","\n        ",432],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","_redirect",433],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/cart'",433],")",";",["T_WHITESPACE","\n    ",433],"}",["T_WHITESPACE","\n\n    ",434],["T_DOC_COMMENT","\/**\n     * Instantiate quote and checkout\n     *\n     * @return Mage_Paypal_Model_Express_Checkout\n     * @throws Mage_Core_Exception\n     *\/",436],["T_WHITESPACE","\n    ",441],["T_PROTECTED","protected",442],["T_WHITESPACE"," ",442],["T_FUNCTION","function",442],["T_WHITESPACE"," ",442],["T_STRING","_initCheckout",442],"(",")",["T_WHITESPACE","\n    ",442],"{",["T_WHITESPACE","\n        ",443],["T_VARIABLE","$quote",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","_getQuote",444],"(",")",";",["T_WHITESPACE","\n        ",444],["T_IF","if",445],["T_WHITESPACE"," ",445],"(","!",["T_VARIABLE","$quote",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","hasItems",445],"(",")",["T_WHITESPACE"," ",445],["T_BOOLEAN_OR","||",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$quote",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getHasError",445],"(",")",")",["T_WHITESPACE"," ",445],"{",["T_WHITESPACE","\n            ",445],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getResponse",446],"(",")",["T_OBJECT_OPERATOR","->",446],["T_STRING","setHeader",446],"(",["T_CONSTANT_ENCAPSED_STRING","'HTTP\/1.1'",446],",",["T_CONSTANT_ENCAPSED_STRING","'403 Forbidden'",446],")",";",["T_WHITESPACE","\n            ",446],["T_STRING","Mage",447],["T_DOUBLE_COLON","::",447],["T_STRING","throwException",447],"(",["T_STRING","Mage",447],["T_DOUBLE_COLON","::",447],["T_STRING","helper",447],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",447],")",["T_OBJECT_OPERATOR","->",447],["T_STRING","__",447],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize Express Checkout.'",447],")",")",";",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE","\n        ",448],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_checkout",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_STRING","Mage",449],["T_DOUBLE_COLON","::",449],["T_STRING","getSingleton",449],"(",["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_checkoutType",449],",",["T_WHITESPACE"," ",449],["T_ARRAY","array",449],"(",["T_WHITESPACE","\n            ",449],["T_CONSTANT_ENCAPSED_STRING","'config'",450],["T_WHITESPACE"," ",450],["T_DOUBLE_ARROW","=>",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","_config",450],",",["T_WHITESPACE","\n            ",450],["T_CONSTANT_ENCAPSED_STRING","'quote'",451],["T_WHITESPACE","  ",451],["T_DOUBLE_ARROW","=>",451],["T_WHITESPACE"," ",451],["T_VARIABLE","$quote",451],",",["T_WHITESPACE","\n        ",451],")",")",";",["T_WHITESPACE","\n\n        ",452],["T_RETURN","return",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","_checkout",454],";",["T_WHITESPACE","\n    ",454],"}",["T_WHITESPACE","\n\n    ",455],["T_DOC_COMMENT","\/**\n     * Search for proper checkout token in request or session or (un)set specified one\n     * Combined getter\/setter\n     *\n     * @param string $setToken\n     * @return Mage_Paypal_ExpressController|string\n     *\/",457],["T_WHITESPACE","\n    ",463],["T_PROTECTED","protected",464],["T_WHITESPACE"," ",464],["T_FUNCTION","function",464],["T_WHITESPACE"," ",464],["T_STRING","_initToken",464],"(",["T_VARIABLE","$setToken",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_STRING","null",464],")",["T_WHITESPACE","\n    ",464],"{",["T_WHITESPACE","\n        ",465],["T_IF","if",466],["T_WHITESPACE"," ",466],"(",["T_STRING","null",466],["T_WHITESPACE"," ",466],["T_IS_NOT_IDENTICAL","!==",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$setToken",466],")",["T_WHITESPACE"," ",466],"{",["T_WHITESPACE","\n            ",466],["T_IF","if",467],["T_WHITESPACE"," ",467],"(",["T_STRING","false",467],["T_WHITESPACE"," ",467],["T_IS_IDENTICAL","===",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$setToken",467],")",["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n                ",467],["T_COMMENT","\/\/ security measure for avoid unsetting token twice\n",468],["T_WHITESPACE","                ",469],["T_IF","if",469],["T_WHITESPACE"," ",469],"(","!",["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_getSession",469],"(",")",["T_OBJECT_OPERATOR","->",469],["T_STRING","getExpressCheckoutToken",469],"(",")",")",["T_WHITESPACE"," ",469],"{",["T_WHITESPACE","\n                    ",469],["T_STRING","Mage",470],["T_DOUBLE_COLON","::",470],["T_STRING","throwException",470],"(",["T_VARIABLE","$this",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","__",470],"(",["T_CONSTANT_ENCAPSED_STRING","'PayPal Express Checkout Token does not exist.'",470],")",")",";",["T_WHITESPACE","\n                ",470],"}",["T_WHITESPACE","\n                ",471],["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","_getSession",472],"(",")",["T_OBJECT_OPERATOR","->",472],["T_STRING","unsExpressCheckoutToken",472],"(",")",";",["T_WHITESPACE","\n            ",472],"}",["T_WHITESPACE"," ",473],["T_ELSE","else",473],["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n                ",473],["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","_getSession",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","setExpressCheckoutToken",474],"(",["T_VARIABLE","$setToken",474],")",";",["T_WHITESPACE","\n            ",474],"}",["T_WHITESPACE","\n            ",475],["T_RETURN","return",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$this",476],";",["T_WHITESPACE","\n        ",476],"}",["T_WHITESPACE","\n        ",477],["T_IF","if",478],["T_WHITESPACE"," ",478],"(",["T_VARIABLE","$setToken",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getRequest",478],"(",")",["T_OBJECT_OPERATOR","->",478],["T_STRING","getParam",478],"(",["T_CONSTANT_ENCAPSED_STRING","'token'",478],")",")",["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n            ",478],["T_IF","if",479],["T_WHITESPACE"," ",479],"(",["T_VARIABLE","$setToken",479],["T_WHITESPACE"," ",479],["T_IS_NOT_IDENTICAL","!==",479],["T_WHITESPACE"," ",479],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_getSession",479],"(",")",["T_OBJECT_OPERATOR","->",479],["T_STRING","getExpressCheckoutToken",479],"(",")",")",["T_WHITESPACE"," ",479],"{",["T_WHITESPACE","\n                ",479],["T_STRING","Mage",480],["T_DOUBLE_COLON","::",480],["T_STRING","throwException",480],"(",["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","__",480],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong PayPal Express Checkout Token specified.'",480],")",")",";",["T_WHITESPACE","\n            ",480],"}",["T_WHITESPACE","\n        ",481],"}",["T_WHITESPACE"," ",482],["T_ELSE","else",482],["T_WHITESPACE"," ",482],"{",["T_WHITESPACE","\n            ",482],["T_VARIABLE","$setToken",483],["T_WHITESPACE"," ",483],"=",["T_WHITESPACE"," ",483],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","_getSession",483],"(",")",["T_OBJECT_OPERATOR","->",483],["T_STRING","getExpressCheckoutToken",483],"(",")",";",["T_WHITESPACE","\n        ",483],"}",["T_WHITESPACE","\n        ",484],["T_RETURN","return",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$setToken",485],";",["T_WHITESPACE","\n    ",485],"}",["T_WHITESPACE","\n\n    ",486],["T_DOC_COMMENT","\/**\n     * PayPal session instance getter\n     *\n     * @return Mage_PayPal_Model_Session\n     *\/",488],["T_WHITESPACE","\n    ",492],["T_PRIVATE","private",493],["T_WHITESPACE"," ",493],["T_FUNCTION","function",493],["T_WHITESPACE"," ",493],["T_STRING","_getSession",493],"(",")",["T_WHITESPACE","\n    ",493],"{",["T_WHITESPACE","\n        ",494],["T_RETURN","return",495],["T_WHITESPACE"," ",495],["T_STRING","Mage",495],["T_DOUBLE_COLON","::",495],["T_STRING","getSingleton",495],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/session'",495],")",";",["T_WHITESPACE","\n    ",495],"}",["T_WHITESPACE","\n\n    ",496],["T_DOC_COMMENT","\/**\n     * Return checkout session object\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",498],["T_WHITESPACE","\n    ",502],["T_PROTECTED","protected",503],["T_WHITESPACE"," ",503],["T_FUNCTION","function",503],["T_WHITESPACE"," ",503],["T_STRING","_getCheckoutSession",503],"(",")",["T_WHITESPACE","\n    ",503],"{",["T_WHITESPACE","\n        ",504],["T_RETURN","return",505],["T_WHITESPACE"," ",505],["T_STRING","Mage",505],["T_DOUBLE_COLON","::",505],["T_STRING","getSingleton",505],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",505],")",";",["T_WHITESPACE","\n    ",505],"}",["T_WHITESPACE","\n\n    ",506],["T_DOC_COMMENT","\/**\n     * Return checkout quote object\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",508],["T_WHITESPACE","\n    ",512],["T_PRIVATE","private",513],["T_WHITESPACE"," ",513],["T_FUNCTION","function",513],["T_WHITESPACE"," ",513],["T_STRING","_getQuote",513],"(",")",["T_WHITESPACE","\n    ",513],"{",["T_WHITESPACE","\n        ",514],["T_IF","if",515],["T_WHITESPACE"," ",515],"(","!",["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","_quote",515],")",["T_WHITESPACE"," ",515],"{",["T_WHITESPACE","\n            ",515],["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","_quote",516],["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","_getCheckoutSession",516],"(",")",["T_OBJECT_OPERATOR","->",516],["T_STRING","getQuote",516],"(",")",";",["T_WHITESPACE","\n        ",516],"}",["T_WHITESPACE","\n        ",517],["T_RETURN","return",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","_quote",518],";",["T_WHITESPACE","\n    ",518],"}",["T_WHITESPACE","\n\n    ",519],["T_DOC_COMMENT","\/**\n     * Redirect to login page\n     *\n     *\/",521],["T_WHITESPACE","\n    ",524],["T_PUBLIC","public",525],["T_WHITESPACE"," ",525],["T_FUNCTION","function",525],["T_WHITESPACE"," ",525],["T_STRING","redirectLogin",525],"(",")",["T_WHITESPACE","\n    ",525],"{",["T_WHITESPACE","\n        ",526],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","setFlag",527],"(",["T_CONSTANT_ENCAPSED_STRING","''",527],",",["T_WHITESPACE"," ",527],["T_CONSTANT_ENCAPSED_STRING","'no-dispatch'",527],",",["T_WHITESPACE"," ",527],["T_STRING","true",527],")",";",["T_WHITESPACE","\n        ",527],["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getResponse",528],"(",")",["T_OBJECT_OPERATOR","->",528],["T_STRING","setRedirect",528],"(",["T_WHITESPACE","\n            ",528],["T_STRING","Mage",529],["T_DOUBLE_COLON","::",529],["T_STRING","helper",529],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/url'",529],")",["T_OBJECT_OPERATOR","->",529],["T_STRING","addRequestParam",529],"(",["T_WHITESPACE","\n                ",529],["T_STRING","Mage",530],["T_DOUBLE_COLON","::",530],["T_STRING","helper",530],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",530],")",["T_OBJECT_OPERATOR","->",530],["T_STRING","getLoginUrl",530],"(",")",",",["T_WHITESPACE","\n                ",530],["T_ARRAY","array",531],"(",["T_CONSTANT_ENCAPSED_STRING","'context'",531],["T_WHITESPACE"," ",531],["T_DOUBLE_ARROW","=>",531],["T_WHITESPACE"," ",531],["T_CONSTANT_ENCAPSED_STRING","'checkout'",531],")",["T_WHITESPACE","\n            ",531],")",["T_WHITESPACE","\n        ",532],")",";",["T_WHITESPACE","\n    ",533],"}",["T_WHITESPACE","\n",534],"}",["T_WHITESPACE","\n",535]]