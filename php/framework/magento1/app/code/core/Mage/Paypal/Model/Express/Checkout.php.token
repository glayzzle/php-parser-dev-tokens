[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Wrapper that performs Paypal Express and Checkout communication\n * Use current Paypal Express method instance\n *\/",27],["T_WHITESPACE","\n",30],["T_CLASS","class",31],["T_WHITESPACE"," ",31],["T_STRING","Mage_Paypal_Model_Express_Checkout",31],["T_WHITESPACE","\n",31],"{",["T_WHITESPACE","\n    ",32],["T_DOC_COMMENT","\/**\n     * Cache ID prefix for \"pal\" lookup\n     * @var string\n     *\/",33],["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","PAL_CACHE_ID",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'paypal_express_checkout_pal'",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Keys for passthrough variables in sales\/quote_payment and sales\/order_payment\n     * Uses additional_information as storage\n     * @var string\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_CONST","const",44],["T_WHITESPACE"," ",44],["T_STRING","PAYMENT_INFO_TRANSPORT_TOKEN",44],["T_WHITESPACE","    ",44],"=",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'paypal_express_checkout_token'",44],";",["T_WHITESPACE","\n    ",44],["T_CONST","const",45],["T_WHITESPACE"," ",45],["T_STRING","PAYMENT_INFO_TRANSPORT_SHIPPING_OVERRIDEN",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_CONSTANT_ENCAPSED_STRING","'paypal_express_checkout_shipping_overriden'",45],";",["T_WHITESPACE","\n    ",45],["T_CONST","const",46],["T_WHITESPACE"," ",46],["T_STRING","PAYMENT_INFO_TRANSPORT_SHIPPING_METHOD",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'paypal_express_checkout_shipping_method'",46],";",["T_WHITESPACE","\n    ",46],["T_CONST","const",47],["T_WHITESPACE"," ",47],["T_STRING","PAYMENT_INFO_TRANSPORT_PAYER_ID",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'paypal_express_checkout_payer_id'",47],";",["T_WHITESPACE","\n    ",47],["T_CONST","const",48],["T_WHITESPACE"," ",48],["T_STRING","PAYMENT_INFO_TRANSPORT_REDIRECT",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'paypal_express_checkout_redirect_required'",48],";",["T_WHITESPACE","\n    ",48],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","PAYMENT_INFO_TRANSPORT_BILLING_AGREEMENT",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'paypal_ec_create_ba'",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Flag which says that was used PayPal Express Checkout button for checkout\n     * Uses additional_information as storage\n     * @var string\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_CONST","const",56],["T_WHITESPACE"," ",56],["T_STRING","PAYMENT_INFO_BUTTON",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'button'",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * @var Mage_Sales_Model_Quote\n     *\/",58],["T_WHITESPACE","\n    ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$_quote",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","null",61],";",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Config instance\n     * @var Mage_Paypal_Model_Config\n     *\/",63],["T_WHITESPACE","\n    ",66],["T_PROTECTED","protected",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$_config",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","null",67],";",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * API instance\n     * @var Mage_Paypal_Model_Api_Nvp\n     *\/",69],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$_api",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","null",73],";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Api Model Type\n     *\n     * @var string\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$_apiType",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'paypal\/api_nvp'",80],";",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Payment method type\n     *\n     * @var unknown_type\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$_methodType",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","Mage_Paypal_Model_Config",87],["T_DOUBLE_COLON","::",87],["T_STRING","METHOD_WPP_EXPRESS",87],";",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * State helper variables\n     * @var string\n     *\/",89],["T_WHITESPACE","\n    ",92],["T_PROTECTED","protected",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$_redirectUrl",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","''",93],";",["T_WHITESPACE","\n    ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$_pendingPaymentMessage",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","''",94],";",["T_WHITESPACE","\n    ",94],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$_checkoutRedirectUrl",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","''",95],";",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * @var Mage_Customer_Model_Session\n     *\/",97],["T_WHITESPACE","\n    ",99],["T_PROTECTED","protected",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$_customerSession",100],";",["T_WHITESPACE","\n\n    ",100],["T_DOC_COMMENT","\/**\n     * Redirect urls supposed to be set to support giropay\n     *\n     * @var array\n     *\/",102],["T_WHITESPACE","\n    ",106],["T_PROTECTED","protected",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$_giropayUrls",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",")",";",["T_WHITESPACE","\n\n    ",107],["T_DOC_COMMENT","\/**\n     * Create Billing Agreement flag\n     *\n     * @var bool\n     *\/",109],["T_WHITESPACE","\n    ",113],["T_PROTECTED","protected",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$_isBARequested",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","false",114],";",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Flag for Bill Me Later mode\n     *\n     * @var bool\n     *\/",116],["T_WHITESPACE","\n    ",120],["T_PROTECTED","protected",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$_isBml",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_STRING","false",121],";",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Customer ID\n     *\n     * @var int\n     *\/",123],["T_WHITESPACE","\n    ",127],["T_PROTECTED","protected",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$_customerId",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_STRING","null",128],";",["T_WHITESPACE","\n\n    ",128],["T_DOC_COMMENT","\/**\n     * Recurring payment profiles\n     *\n     * @var array\n     *\/",130],["T_WHITESPACE","\n    ",134],["T_PROTECTED","protected",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$_recurringPaymentProfiles",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_ARRAY","array",135],"(",")",";",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Billing agreement that might be created during order placing\n     *\n     * @var Mage_Sales_Model_Billing_Agreement\n     *\/",137],["T_WHITESPACE","\n    ",141],["T_PROTECTED","protected",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$_billingAgreement",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","null",142],";",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Order\n     *\n     * @var Mage_Sales_Model_QuoteMage_Sales_Model_Quote\n     *\/",144],["T_WHITESPACE","\n    ",148],["T_PROTECTED","protected",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$_order",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_STRING","null",149],";",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Set quote and config instances\n     * @param array $params\n     *\/",151],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","__construct",155],"(",["T_VARIABLE","$params",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_ARRAY","array",155],"(",")",")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_ISSET","isset",157],"(",["T_VARIABLE","$params",157],"[",["T_CONSTANT_ENCAPSED_STRING","'quote'",157],"]",")",["T_WHITESPACE"," ",157],["T_BOOLEAN_AND","&&",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$params",157],"[",["T_CONSTANT_ENCAPSED_STRING","'quote'",157],"]",["T_WHITESPACE"," ",157],["T_INSTANCEOF","instanceof",157],["T_WHITESPACE"," ",157],["T_STRING","Mage_Sales_Model_Quote",157],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_quote",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$params",158],"[",["T_CONSTANT_ENCAPSED_STRING","'quote'",158],"]",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE"," ",159],["T_ELSE","else",159],["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_THROW","throw",160],["T_WHITESPACE"," ",160],["T_NEW","new",160],["T_WHITESPACE"," ",160],["T_STRING","Exception",160],"(",["T_CONSTANT_ENCAPSED_STRING","'Quote instance is required.'",160],")",";",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n        ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_ISSET","isset",162],"(",["T_VARIABLE","$params",162],"[",["T_CONSTANT_ENCAPSED_STRING","'config'",162],"]",")",["T_WHITESPACE"," ",162],["T_BOOLEAN_AND","&&",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$params",162],"[",["T_CONSTANT_ENCAPSED_STRING","'config'",162],"]",["T_WHITESPACE"," ",162],["T_INSTANCEOF","instanceof",162],["T_WHITESPACE"," ",162],["T_STRING","Mage_Paypal_Model_Config",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_config",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$params",163],"[",["T_CONSTANT_ENCAPSED_STRING","'config'",163],"]",";",["T_WHITESPACE","\n        ",163],"}",["T_WHITESPACE"," ",164],["T_ELSE","else",164],["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_THROW","throw",165],["T_WHITESPACE"," ",165],["T_NEW","new",165],["T_WHITESPACE"," ",165],["T_STRING","Exception",165],"(",["T_CONSTANT_ENCAPSED_STRING","'Config instance is required.'",165],")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","_customerSession",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_ISSET","isset",167],"(",["T_VARIABLE","$params",167],"[",["T_CONSTANT_ENCAPSED_STRING","'session'",167],"]",")",["T_WHITESPACE"," ",167],["T_BOOLEAN_AND","&&",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$params",167],"[",["T_CONSTANT_ENCAPSED_STRING","'session'",167],"]",["T_WHITESPACE"," ",167],["T_INSTANCEOF","instanceof",167],["T_WHITESPACE"," ",167],["T_STRING","Mage_Customer_Model_Session",167],["T_WHITESPACE","\n            ",167],"?",["T_WHITESPACE"," ",168],["T_VARIABLE","$params",168],"[",["T_CONSTANT_ENCAPSED_STRING","'session'",168],"]",["T_WHITESPACE"," ",168],":",["T_WHITESPACE"," ",168],["T_STRING","Mage",168],["T_DOUBLE_COLON","::",168],["T_STRING","getSingleton",168],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",168],")",";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Checkout with PayPal image URL getter\n     * Spares API calls of getting \"pal\" variable, by putting it into cache per store view\n     * @return string\n     *\/",171],["T_WHITESPACE","\n    ",175],["T_PUBLIC","public",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","getCheckoutShortcutImageUrl",176],"(",")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_COMMENT","\/\/ get \"pal\" thing from cache or lookup it via API\n",178],["T_WHITESPACE","        ",179],["T_VARIABLE","$pal",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_STRING","null",179],";",["T_WHITESPACE","\n        ",179],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_config",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","areButtonsDynamic",180],"(",")",")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$cacheId",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_STRING","self",181],["T_DOUBLE_COLON","::",181],["T_STRING","PAL_CACHE_ID",181],["T_WHITESPACE"," ",181],".",["T_WHITESPACE"," ",181],["T_STRING","Mage",181],["T_DOUBLE_COLON","::",181],["T_STRING","app",181],"(",")",["T_OBJECT_OPERATOR","->",181],["T_STRING","getStore",181],"(",")",["T_OBJECT_OPERATOR","->",181],["T_STRING","getId",181],"(",")",";",["T_WHITESPACE","\n            ",181],["T_VARIABLE","$pal",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","Mage",182],["T_DOUBLE_COLON","::",182],["T_STRING","app",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","loadCache",182],"(",["T_VARIABLE","$cacheId",182],")",";",["T_WHITESPACE","\n            ",182],["T_IF","if",183],["T_WHITESPACE"," ",183],"(","-",["T_LNUMBER","1",183],["T_WHITESPACE"," ",183],["T_IS_EQUAL","==",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$pal",183],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$pal",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","null",184],";",["T_WHITESPACE","\n            ",184],"}",["T_WHITESPACE"," ",185],["T_ELSEIF","elseif",185],["T_WHITESPACE"," ",185],"(","!",["T_VARIABLE","$pal",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                ",185],["T_VARIABLE","$pal",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","null",186],";",["T_WHITESPACE","\n                ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_getApi",187],"(",")",";",["T_WHITESPACE","\n                ",187],["T_TRY","try",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n                    ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_api",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","callGetPalDetails",189],"(",")",";",["T_WHITESPACE","\n                    ",189],["T_VARIABLE","$pal",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_api",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getPal",190],"(",")",";",["T_WHITESPACE","\n                    ",190],["T_STRING","Mage",191],["T_DOUBLE_COLON","::",191],["T_STRING","app",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","saveCache",191],"(",["T_VARIABLE","$pal",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$cacheId",191],",",["T_WHITESPACE"," ",191],["T_ARRAY","array",191],"(",["T_STRING","Mage_Core_Model_Config",191],["T_DOUBLE_COLON","::",191],["T_STRING","CACHE_TAG",191],")",")",";",["T_WHITESPACE","\n                ",191],"}",["T_WHITESPACE"," ",192],["T_CATCH","catch",192],["T_WHITESPACE"," ",192],"(",["T_STRING","Exception",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$e",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n                    ",192],["T_STRING","Mage",193],["T_DOUBLE_COLON","::",193],["T_STRING","app",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","saveCache",193],"(","-",["T_LNUMBER","1",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$cacheId",193],",",["T_WHITESPACE"," ",193],["T_ARRAY","array",193],"(",["T_STRING","Mage_Core_Model_Config",193],["T_DOUBLE_COLON","::",193],["T_STRING","CACHE_TAG",193],")",")",";",["T_WHITESPACE","\n                    ",193],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","logException",194],"(",["T_VARIABLE","$e",194],")",";",["T_WHITESPACE","\n                ",194],"}",["T_WHITESPACE","\n            ",195],"}",["T_WHITESPACE","\n        ",196],"}",["T_WHITESPACE","\n\n        ",197],["T_RETURN","return",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_config",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getExpressCheckoutShortcutImageUrl",199],"(",["T_WHITESPACE","\n            ",199],["T_STRING","Mage",200],["T_DOUBLE_COLON","::",200],["T_STRING","app",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","getLocale",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","getLocaleCode",200],"(",")",",",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_quote",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getBaseGrandTotal",201],"(",")",",",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$pal",202],["T_WHITESPACE","\n        ",202],")",";",["T_WHITESPACE","\n    ",203],"}",["T_WHITESPACE","\n\n    ",204],["T_DOC_COMMENT","\/**\n     * Setter that enables giropay redirects flow\n     *\n     * @param string $successUrl - payment success result\n     * @param string $cancelUrl  - payment cancellation result\n     * @param string $pendingUrl - pending payment result\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",206],["T_WHITESPACE","\n    ",213],["T_PUBLIC","public",214],["T_WHITESPACE"," ",214],["T_FUNCTION","function",214],["T_WHITESPACE"," ",214],["T_STRING","prepareGiropayUrls",214],"(",["T_VARIABLE","$successUrl",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$cancelUrl",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$pendingUrl",214],")",["T_WHITESPACE","\n    ",214],"{",["T_WHITESPACE","\n        ",215],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_giropayUrls",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_ARRAY","array",216],"(",["T_VARIABLE","$successUrl",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$cancelUrl",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$pendingUrl",216],")",";",["T_WHITESPACE","\n        ",216],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$this",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n\n    ",218],["T_DOC_COMMENT","\/**\n     * Set create billing agreement flag\n     *\n     * @param bool $flag\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",220],["T_WHITESPACE","\n    ",225],["T_PUBLIC","public",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","setIsBillingAgreementRequested",226],"(",["T_VARIABLE","$flag",226],")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_isBARequested",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$flag",228],";",["T_WHITESPACE","\n        ",228],["T_RETURN","return",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],";",["T_WHITESPACE","\n    ",229],"}",["T_WHITESPACE","\n\n    ",230],["T_DOC_COMMENT","\/**\n     * Setter for customer Id\n     *\n     * @param int $id\n     * @return Mage_Paypal_Model_Express_Checkout\n     * @deprecated please use self::setCustomer\n     *\/",232],["T_WHITESPACE","\n    ",238],["T_PUBLIC","public",239],["T_WHITESPACE"," ",239],["T_FUNCTION","function",239],["T_WHITESPACE"," ",239],["T_STRING","setCustomerId",239],"(",["T_VARIABLE","$id",239],")",["T_WHITESPACE","\n    ",239],"{",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_customerId",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$id",241],";",["T_WHITESPACE","\n        ",241],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$this",242],";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * Set flag that forces to use BillMeLater\n     *\n     * @param bool $isBml\n     *\/",245],["T_WHITESPACE","\n    ",249],["T_PUBLIC","public",250],["T_WHITESPACE"," ",250],["T_FUNCTION","function",250],["T_WHITESPACE"," ",250],["T_STRING","setIsBml",250],"(",["T_VARIABLE","$isBml",250],")",["T_WHITESPACE","\n    ",250],"{",["T_WHITESPACE","\n        ",251],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","_isBml",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$isBml",252],";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Setter for customer\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",255],["T_WHITESPACE","\n    ",260],["T_PUBLIC","public",261],["T_WHITESPACE"," ",261],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","setCustomer",261],"(",["T_VARIABLE","$customer",261],")",["T_WHITESPACE","\n    ",261],"{",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_quote",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","assignCustomer",263],"(",["T_VARIABLE","$customer",263],")",";",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_customerId",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$customer",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getId",264],"(",")",";",["T_WHITESPACE","\n        ",264],["T_RETURN","return",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],";",["T_WHITESPACE","\n    ",265],"}",["T_WHITESPACE","\n\n    ",266],["T_DOC_COMMENT","\/**\n     * Setter for customer with billing and shipping address changing ability\n     *\n     * @param  Mage_Customer_Model_Customer   $customer\n     * @param  Mage_Sales_Model_Quote_Address $billingAddress\n     * @param  Mage_Sales_Model_Quote_Address $shippingAddress\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",268],["T_WHITESPACE","\n    ",275],["T_PUBLIC","public",276],["T_WHITESPACE"," ",276],["T_FUNCTION","function",276],["T_WHITESPACE"," ",276],["T_STRING","setCustomerWithAddressChange",276],"(",["T_VARIABLE","$customer",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$billingAddress",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_STRING","null",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$shippingAddress",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_STRING","null",276],")",["T_WHITESPACE","\n    ",276],"{",["T_WHITESPACE","\n        ",277],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_quote",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","assignCustomerWithAddressChange",278],"(",["T_VARIABLE","$customer",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$billingAddress",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$shippingAddress",278],")",";",["T_WHITESPACE","\n        ",278],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_customerId",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$customer",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","getId",279],"(",")",";",["T_WHITESPACE","\n        ",279],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],";",["T_WHITESPACE","\n    ",280],"}",["T_WHITESPACE","\n\n    ",281],["T_DOC_COMMENT","\/**\n     * Reserve order ID for specified quote and start checkout on PayPal\n     *\n     * @param string $returnUrl\n     * @param string $cancelUrl\n     * @param bool|null $button\n     * @return mixed\n     *\/",283],["T_WHITESPACE","\n    ",290],["T_PUBLIC","public",291],["T_WHITESPACE"," ",291],["T_FUNCTION","function",291],["T_WHITESPACE"," ",291],["T_STRING","start",291],"(",["T_VARIABLE","$returnUrl",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$cancelUrl",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$button",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_STRING","null",291],")",["T_WHITESPACE","\n    ",291],"{",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_quote",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","collectTotals",293],"(",")",";",["T_WHITESPACE","\n\n        ",293],["T_IF","if",295],["T_WHITESPACE"," ",295],"(","!",["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_quote",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getGrandTotal",295],"(",")",["T_WHITESPACE"," ",295],["T_BOOLEAN_AND","&&",295],["T_WHITESPACE"," ",295],"!",["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_quote",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","hasNominalItems",295],"(",")",")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_STRING","Mage",296],["T_DOUBLE_COLON","::",296],["T_STRING","throwException",296],"(",["T_STRING","Mage",296],["T_DOUBLE_COLON","::",296],["T_STRING","helper",296],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",296],")",["T_OBJECT_OPERATOR","->",296],["T_STRING","__",296],"(",["T_CONSTANT_ENCAPSED_STRING","'PayPal does not support processing orders with zero amount. To complete your purchase, proceed to the standard checkout process.'",296],")",")",";",["T_WHITESPACE","\n        ",296],"}",["T_WHITESPACE","\n\n        ",297],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_quote",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","reserveOrderId",299],"(",")",["T_OBJECT_OPERATOR","->",299],["T_STRING","save",299],"(",")",";",["T_WHITESPACE","\n        ",299],["T_COMMENT","\/\/ prepare API\n",300],["T_WHITESPACE","        ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_getApi",301],"(",")",";",["T_WHITESPACE","\n        ",301],["T_VARIABLE","$solutionType",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_config",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getMerchantCountry",302],"(",")",["T_WHITESPACE"," ",302],["T_IS_EQUAL","==",302],["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","'DE'",302],["T_WHITESPACE","\n            ",302],"?",["T_WHITESPACE"," ",303],["T_STRING","Mage_Paypal_Model_Config",303],["T_DOUBLE_COLON","::",303],["T_STRING","EC_SOLUTION_TYPE_MARK",303],["T_WHITESPACE"," ",303],":",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_config",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","solutionType",303],";",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_api",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","setAmount",304],"(",["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_quote",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getBaseGrandTotal",304],"(",")",")",["T_WHITESPACE","\n            ",304],["T_OBJECT_OPERATOR","->",305],["T_STRING","setCurrencyCode",305],"(",["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_quote",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getBaseCurrencyCode",305],"(",")",")",["T_WHITESPACE","\n            ",305],["T_OBJECT_OPERATOR","->",306],["T_STRING","setInvNum",306],"(",["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_quote",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getReservedOrderId",306],"(",")",")",["T_WHITESPACE","\n            ",306],["T_OBJECT_OPERATOR","->",307],["T_STRING","setReturnUrl",307],"(",["T_VARIABLE","$returnUrl",307],")",["T_WHITESPACE","\n            ",307],["T_OBJECT_OPERATOR","->",308],["T_STRING","setCancelUrl",308],"(",["T_VARIABLE","$cancelUrl",308],")",["T_WHITESPACE","\n            ",308],["T_OBJECT_OPERATOR","->",309],["T_STRING","setSolutionType",309],"(",["T_VARIABLE","$solutionType",309],")",["T_WHITESPACE","\n            ",309],["T_OBJECT_OPERATOR","->",310],["T_STRING","setPaymentAction",310],"(",["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_config",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","paymentAction",310],")",";",["T_WHITESPACE","\n\n        ",310],["T_IF","if",312],["T_WHITESPACE"," ",312],"(",["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","_giropayUrls",312],")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n            ",312],["T_LIST","list",313],"(",["T_VARIABLE","$successUrl",313],",",["T_WHITESPACE"," ",313],["T_VARIABLE","$cancelUrl",313],",",["T_WHITESPACE"," ",313],["T_VARIABLE","$pendingUrl",313],")",["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_giropayUrls",313],";",["T_WHITESPACE","\n            ",313],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_api",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","addData",314],"(",["T_ARRAY","array",314],"(",["T_WHITESPACE","\n                ",314],["T_CONSTANT_ENCAPSED_STRING","'giropay_cancel_url'",315],["T_WHITESPACE"," ",315],["T_DOUBLE_ARROW","=>",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$cancelUrl",315],",",["T_WHITESPACE","\n                ",315],["T_CONSTANT_ENCAPSED_STRING","'giropay_success_url'",316],["T_WHITESPACE"," ",316],["T_DOUBLE_ARROW","=>",316],["T_WHITESPACE"," ",316],["T_VARIABLE","$successUrl",316],",",["T_WHITESPACE","\n                ",316],["T_CONSTANT_ENCAPSED_STRING","'giropay_bank_txn_pending_url'",317],["T_WHITESPACE"," ",317],["T_DOUBLE_ARROW","=>",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$pendingUrl",317],",",["T_WHITESPACE","\n            ",317],")",")",";",["T_WHITESPACE","\n        ",318],"}",["T_WHITESPACE","\n\n        ",319],["T_IF","if",321],["T_WHITESPACE"," ",321],"(",["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_isBml",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","_api",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","setFundingSource",322],"(",["T_CONSTANT_ENCAPSED_STRING","'BML'",322],")",";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE","\n\n        ",323],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_setBillingAgreementRequest",325],"(",")",";",["T_WHITESPACE","\n\n        ",325],["T_IF","if",327],["T_WHITESPACE"," ",327],"(",["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_config",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","requireBillingAddress",327],["T_WHITESPACE"," ",327],["T_IS_EQUAL","==",327],["T_WHITESPACE"," ",327],["T_STRING","Mage_Paypal_Model_Config",327],["T_DOUBLE_COLON","::",327],["T_STRING","REQUIRE_BILLING_ADDRESS_ALL",327],")",["T_WHITESPACE"," ",327],"{",["T_WHITESPACE","\n            ",327],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_api",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","setRequireBillingAddress",328],"(",["T_LNUMBER","1",328],")",";",["T_WHITESPACE","\n        ",328],"}",["T_WHITESPACE","\n\n        ",329],["T_COMMENT","\/\/ supress or export shipping address\n",331],["T_WHITESPACE","        ",332],["T_IF","if",332],["T_WHITESPACE"," ",332],"(",["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","_quote",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getIsVirtual",332],"(",")",")",["T_WHITESPACE"," ",332],"{",["T_WHITESPACE","\n            ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","_config",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","requireBillingAddress",333],["T_WHITESPACE"," ",333],["T_IS_EQUAL","==",333],["T_WHITESPACE"," ",333],["T_STRING","Mage_Paypal_Model_Config",333],["T_DOUBLE_COLON","::",333],["T_STRING","REQUIRE_BILLING_ADDRESS_VIRTUAL",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n                ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","_api",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","setRequireBillingAddress",334],"(",["T_LNUMBER","1",334],")",";",["T_WHITESPACE","\n            ",334],"}",["T_WHITESPACE","\n            ",335],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_api",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","setSuppressShipping",336],"(",["T_STRING","true",336],")",";",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE"," ",337],["T_ELSE","else",337],["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n            ",337],["T_VARIABLE","$address",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_quote",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getShippingAddress",338],"(",")",";",["T_WHITESPACE","\n            ",338],["T_VARIABLE","$isOverriden",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_LNUMBER","0",339],";",["T_WHITESPACE","\n            ",339],["T_IF","if",340],["T_WHITESPACE"," ",340],"(",["T_STRING","true",340],["T_WHITESPACE"," ",340],["T_IS_IDENTICAL","===",340],["T_WHITESPACE"," ",340],["T_VARIABLE","$address",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","validate",340],"(",")",")",["T_WHITESPACE"," ",340],"{",["T_WHITESPACE","\n                ",340],["T_VARIABLE","$isOverriden",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_LNUMBER","1",341],";",["T_WHITESPACE","\n                ",341],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","_api",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","setAddress",342],"(",["T_VARIABLE","$address",342],")",";",["T_WHITESPACE","\n            ",342],"}",["T_WHITESPACE","\n            ",343],["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","_quote",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getPayment",344],"(",")",["T_OBJECT_OPERATOR","->",344],["T_STRING","setAdditionalInformation",344],"(",["T_WHITESPACE","\n                ",344],["T_STRING","self",345],["T_DOUBLE_COLON","::",345],["T_STRING","PAYMENT_INFO_TRANSPORT_SHIPPING_OVERRIDEN",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$isOverriden",345],["T_WHITESPACE","\n            ",345],")",";",["T_WHITESPACE","\n            ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_quote",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getPayment",347],"(",")",["T_OBJECT_OPERATOR","->",347],["T_STRING","save",347],"(",")",";",["T_WHITESPACE","\n        ",347],"}",["T_WHITESPACE","\n\n        ",348],["T_COMMENT","\/\/ add line items\n",350],["T_WHITESPACE","        ",351],["T_VARIABLE","$paypalCart",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_STRING","Mage",351],["T_DOUBLE_COLON","::",351],["T_STRING","getModel",351],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/cart'",351],",",["T_WHITESPACE"," ",351],["T_ARRAY","array",351],"(",["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","_quote",351],")",")",";",["T_WHITESPACE","\n        ",351],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","_api",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","setPaypalCart",352],"(",["T_VARIABLE","$paypalCart",352],")",["T_WHITESPACE","\n            ",352],["T_OBJECT_OPERATOR","->",353],["T_STRING","setIsLineItemsEnabled",353],"(",["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_config",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","lineItemsEnabled",353],")",["T_WHITESPACE","\n        ",353],";",["T_WHITESPACE","\n\n        ",354],["T_COMMENT","\/\/ add shipping options if needed and line items are available\n",356],["T_WHITESPACE","        ",357],["T_IF","if",357],["T_WHITESPACE"," ",357],"(",["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_config",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","lineItemsEnabled",357],["T_WHITESPACE"," ",357],["T_BOOLEAN_AND","&&",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_config",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","transferShippingOptions",357],["T_WHITESPACE"," ",357],["T_BOOLEAN_AND","&&",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$paypalCart",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getItems",357],"(",")",")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n            ",357],["T_IF","if",358],["T_WHITESPACE"," ",358],"(","!",["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","_quote",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getIsVirtual",358],"(",")",["T_WHITESPACE"," ",358],["T_BOOLEAN_AND","&&",358],["T_WHITESPACE"," ",358],"!",["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","_quote",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","hasNominalItems",358],"(",")",")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n                ",358],["T_IF","if",359],["T_WHITESPACE"," ",359],"(",["T_VARIABLE","$options",359],["T_WHITESPACE"," ",359],"=",["T_WHITESPACE"," ",359],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","_prepareShippingOptions",359],"(",["T_VARIABLE","$address",359],",",["T_WHITESPACE"," ",359],["T_STRING","true",359],")",")",["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n                    ",359],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","_api",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","setShippingOptionsCallbackUrl",360],"(",["T_WHITESPACE","\n                        ",360],["T_STRING","Mage",361],["T_DOUBLE_COLON","::",361],["T_STRING","getUrl",361],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/shippingOptionsCallback'",361],",",["T_WHITESPACE"," ",361],["T_ARRAY","array",361],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_id'",361],["T_WHITESPACE"," ",361],["T_DOUBLE_ARROW","=>",361],["T_WHITESPACE"," ",361],["T_VARIABLE","$this",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","_quote",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getId",361],"(",")",")",")",["T_WHITESPACE","\n                    ",361],")",["T_OBJECT_OPERATOR","->",362],["T_STRING","setShippingOptions",362],"(",["T_VARIABLE","$options",362],")",";",["T_WHITESPACE","\n                ",362],"}",["T_WHITESPACE","\n            ",363],"}",["T_WHITESPACE","\n        ",364],"}",["T_WHITESPACE","\n\n        ",365],["T_COMMENT","\/\/ add recurring payment profiles information\n",367],["T_WHITESPACE","        ",368],["T_IF","if",368],["T_WHITESPACE"," ",368],"(",["T_VARIABLE","$profiles",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_quote",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","prepareRecurringPaymentProfiles",368],"(",")",")",["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n            ",368],["T_FOREACH","foreach",369],["T_WHITESPACE"," ",369],"(",["T_VARIABLE","$profiles",369],["T_WHITESPACE"," ",369],["T_AS","as",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$profile",369],")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n                ",369],["T_VARIABLE","$profile",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","setMethodCode",370],"(",["T_STRING","Mage_Paypal_Model_Config",370],["T_DOUBLE_COLON","::",370],["T_STRING","METHOD_WPP_EXPRESS",370],")",";",["T_WHITESPACE","\n                ",370],["T_IF","if",371],["T_WHITESPACE"," ",371],"(","!",["T_VARIABLE","$profile",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","isValid",371],"(",")",")",["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n                    ",371],["T_STRING","Mage",372],["T_DOUBLE_COLON","::",372],["T_STRING","throwException",372],"(",["T_VARIABLE","$profile",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getValidationErrors",372],"(",["T_STRING","true",372],",",["T_WHITESPACE"," ",372],["T_STRING","true",372],")",")",";",["T_WHITESPACE","\n                ",372],"}",["T_WHITESPACE","\n            ",373],"}",["T_WHITESPACE","\n            ",374],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","_api",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","addRecurringPaymentProfiles",375],"(",["T_VARIABLE","$profiles",375],")",";",["T_WHITESPACE","\n        ",375],"}",["T_WHITESPACE","\n\n        ",376],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_config",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","exportExpressCheckoutStyleSettings",378],"(",["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_api",378],")",";",["T_WHITESPACE","\n\n        ",378],["T_COMMENT","\/\/ call API and redirect with token\n",380],["T_WHITESPACE","        ",381],["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","_api",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","callSetExpressCheckout",381],"(",")",";",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$token",382],["T_WHITESPACE"," ",382],"=",["T_WHITESPACE"," ",382],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_api",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getToken",382],"(",")",";",["T_WHITESPACE","\n        ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","_redirectUrl",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_VARIABLE","$button",383],["T_WHITESPACE"," ",383],"?",["T_WHITESPACE"," ",383],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","_config",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getExpressCheckoutStartUrl",383],"(",["T_VARIABLE","$token",383],")",["T_WHITESPACE","\n            ",383],":",["T_WHITESPACE"," ",384],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_config",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getPayPalBasicStartUrl",384],"(",["T_VARIABLE","$token",384],")",";",["T_WHITESPACE","\n\n        ",384],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_quote",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getPayment",386],"(",")",["T_OBJECT_OPERATOR","->",386],["T_STRING","unsAdditionalInformation",386],"(",["T_STRING","self",386],["T_DOUBLE_COLON","::",386],["T_STRING","PAYMENT_INFO_TRANSPORT_BILLING_AGREEMENT",386],")",";",["T_WHITESPACE","\n\n        ",386],["T_COMMENT","\/\/ Set flag that we came from Express Checkout button\n",388],["T_WHITESPACE","        ",389],["T_IF","if",389],["T_WHITESPACE"," ",389],"(","!",["T_EMPTY","empty",389],"(",["T_VARIABLE","$button",389],")",")",["T_WHITESPACE"," ",389],"{",["T_WHITESPACE","\n            ",389],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","_quote",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getPayment",390],"(",")",["T_OBJECT_OPERATOR","->",390],["T_STRING","setAdditionalInformation",390],"(",["T_STRING","self",390],["T_DOUBLE_COLON","::",390],["T_STRING","PAYMENT_INFO_BUTTON",390],",",["T_WHITESPACE"," ",390],["T_LNUMBER","1",390],")",";",["T_WHITESPACE","\n        ",390],"}",["T_WHITESPACE"," ",391],["T_ELSEIF","elseif",391],["T_WHITESPACE"," ",391],"(",["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","_quote",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getPayment",391],"(",")",["T_OBJECT_OPERATOR","->",391],["T_STRING","hasAdditionalInformation",391],"(",["T_STRING","self",391],["T_DOUBLE_COLON","::",391],["T_STRING","PAYMENT_INFO_BUTTON",391],")",")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n            ",391],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","_quote",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","getPayment",392],"(",")",["T_OBJECT_OPERATOR","->",392],["T_STRING","unsAdditionalInformation",392],"(",["T_STRING","self",392],["T_DOUBLE_COLON","::",392],["T_STRING","PAYMENT_INFO_BUTTON",392],")",";",["T_WHITESPACE","\n        ",392],"}",["T_WHITESPACE","\n\n        ",393],["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","_quote",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getPayment",395],"(",")",["T_OBJECT_OPERATOR","->",395],["T_STRING","save",395],"(",")",";",["T_WHITESPACE","\n        ",395],["T_RETURN","return",396],["T_WHITESPACE"," ",396],["T_VARIABLE","$token",396],";",["T_WHITESPACE","\n    ",396],"}",["T_WHITESPACE","\n\n    ",397],["T_DOC_COMMENT","\/**\n     * Check whether system can skip order review page before placing order\n     *\n     * @return bool\n     *\/",399],["T_WHITESPACE","\n    ",403],["T_PUBLIC","public",404],["T_WHITESPACE"," ",404],["T_FUNCTION","function",404],["T_WHITESPACE"," ",404],["T_STRING","canSkipOrderReviewStep",404],"(",")",["T_WHITESPACE","\n    ",404],"{",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$isOnepageCheckout",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],"!",["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_quote",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","getPayment",406],"(",")",["T_WHITESPACE","\n            ",406],["T_OBJECT_OPERATOR","->",407],["T_STRING","getAdditionalInformation",407],"(",["T_STRING","Mage_Paypal_Model_Express_Checkout",407],["T_DOUBLE_COLON","::",407],["T_STRING","PAYMENT_INFO_BUTTON",407],")",";",["T_WHITESPACE","\n        ",407],["T_RETURN","return",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","_config",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","isOrderReviewStepDisabled",408],"(",")",["T_WHITESPACE"," ",408],["T_BOOLEAN_AND","&&",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$isOnepageCheckout",408],";",["T_WHITESPACE","\n    ",408],"}",["T_WHITESPACE","\n\n    ",409],["T_DOC_COMMENT","\/**\n     * Update quote when returned from PayPal\n     * rewrite billing address by paypal\n     * save old billing address for new customer\n     * export shipping address in case address absence\n     *\n     * @param string $token\n     *\/",411],["T_WHITESPACE","\n    ",418],["T_PUBLIC","public",419],["T_WHITESPACE"," ",419],["T_FUNCTION","function",419],["T_WHITESPACE"," ",419],["T_STRING","returnFromPaypal",419],"(",["T_VARIABLE","$token",419],")",["T_WHITESPACE","\n    ",419],"{",["T_WHITESPACE","\n        ",420],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","_getApi",421],"(",")",";",["T_WHITESPACE","\n        ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_api",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","setToken",422],"(",["T_VARIABLE","$token",422],")",["T_WHITESPACE","\n            ",422],["T_OBJECT_OPERATOR","->",423],["T_STRING","callGetExpressCheckoutDetails",423],"(",")",";",["T_WHITESPACE","\n        ",423],["T_VARIABLE","$quote",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_VARIABLE","$this",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","_quote",424],";",["T_WHITESPACE","\n\n        ",424],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","_ignoreAddressValidation",426],"(",")",";",["T_WHITESPACE","\n\n        ",426],["T_COMMENT","\/\/ import shipping address\n",428],["T_WHITESPACE","        ",429],["T_VARIABLE","$exportedShippingAddress",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","_api",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getExportedShippingAddress",429],"(",")",";",["T_WHITESPACE","\n        ",429],["T_IF","if",430],["T_WHITESPACE"," ",430],"(","!",["T_VARIABLE","$quote",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getIsVirtual",430],"(",")",")",["T_WHITESPACE"," ",430],"{",["T_WHITESPACE","\n            ",430],["T_VARIABLE","$shippingAddress",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$quote",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getShippingAddress",431],"(",")",";",["T_WHITESPACE","\n            ",431],["T_IF","if",432],["T_WHITESPACE"," ",432],"(",["T_VARIABLE","$shippingAddress",432],")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n                ",432],["T_IF","if",433],["T_WHITESPACE"," ",433],"(",["T_VARIABLE","$exportedShippingAddress",433],")",["T_WHITESPACE"," ",433],"{",["T_WHITESPACE","\n                    ",433],["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","_setExportedAddressData",434],"(",["T_VARIABLE","$shippingAddress",434],",",["T_WHITESPACE"," ",434],["T_VARIABLE","$exportedShippingAddress",434],")",";",["T_WHITESPACE","\n\n                    ",434],["T_IF","if",436],["T_WHITESPACE"," ",436],"(",["T_VARIABLE","$quote",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getPayment",436],"(",")",["T_OBJECT_OPERATOR","->",436],["T_STRING","getAdditionalInformation",436],"(",["T_STRING","self",436],["T_DOUBLE_COLON","::",436],["T_STRING","PAYMENT_INFO_BUTTON",436],")",["T_WHITESPACE"," ",436],["T_IS_EQUAL","==",436],["T_WHITESPACE"," ",436],["T_LNUMBER","1",436],")",["T_WHITESPACE"," ",436],"{",["T_WHITESPACE","\n                        ",436],["T_COMMENT","\/\/ PayPal doesn't provide detailed shipping info: prefix, middlename, lastname, suffix\n",437],["T_WHITESPACE","                        ",438],["T_VARIABLE","$shippingAddress",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","setPrefix",438],"(",["T_STRING","null",438],")",";",["T_WHITESPACE","\n                        ",438],["T_VARIABLE","$shippingAddress",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","setMiddlename",439],"(",["T_STRING","null",439],")",";",["T_WHITESPACE","\n                        ",439],["T_VARIABLE","$shippingAddress",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","setLastname",440],"(",["T_STRING","null",440],")",";",["T_WHITESPACE","\n                        ",440],["T_VARIABLE","$shippingAddress",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","setSuffix",441],"(",["T_STRING","null",441],")",";",["T_WHITESPACE","\n                    ",441],"}",["T_WHITESPACE","\n\n                    ",442],["T_VARIABLE","$shippingAddress",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","setCollectShippingRates",444],"(",["T_STRING","true",444],")",";",["T_WHITESPACE","\n                    ",444],["T_VARIABLE","$shippingAddress",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","setSameAsBilling",445],"(",["T_LNUMBER","0",445],")",";",["T_WHITESPACE","\n                ",445],"}",["T_WHITESPACE","\n\n                ",446],["T_COMMENT","\/\/ import shipping method\n",448],["T_WHITESPACE","                ",449],["T_VARIABLE","$code",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_CONSTANT_ENCAPSED_STRING","''",449],";",["T_WHITESPACE","\n                ",449],["T_IF","if",450],["T_WHITESPACE"," ",450],"(",["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","_api",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getShippingRateCode",450],"(",")",")",["T_WHITESPACE"," ",450],"{",["T_WHITESPACE","\n                    ",450],["T_IF","if",451],["T_WHITESPACE"," ",451],"(",["T_VARIABLE","$code",451],["T_WHITESPACE"," ",451],"=",["T_WHITESPACE"," ",451],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","_matchShippingMethodCode",451],"(",["T_VARIABLE","$shippingAddress",451],",",["T_WHITESPACE"," ",451],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","_api",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getShippingRateCode",451],"(",")",")",")",["T_WHITESPACE"," ",451],"{",["T_WHITESPACE","\n                         ",451],["T_COMMENT","\/\/ possible bug of double collecting rates :-\/\n",452],["T_WHITESPACE","                        ",453],["T_VARIABLE","$shippingAddress",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","setShippingMethod",453],"(",["T_VARIABLE","$code",453],")",["T_OBJECT_OPERATOR","->",453],["T_STRING","setCollectShippingRates",453],"(",["T_STRING","true",453],")",";",["T_WHITESPACE","\n                    ",453],"}",["T_WHITESPACE","\n                ",454],"}",["T_WHITESPACE","\n                ",455],["T_VARIABLE","$quote",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","getPayment",456],"(",")",["T_OBJECT_OPERATOR","->",456],["T_STRING","setAdditionalInformation",456],"(",["T_WHITESPACE","\n                    ",456],["T_STRING","self",457],["T_DOUBLE_COLON","::",457],["T_STRING","PAYMENT_INFO_TRANSPORT_SHIPPING_METHOD",457],",",["T_WHITESPACE","\n                    ",457],["T_VARIABLE","$code",458],["T_WHITESPACE","\n                ",458],")",";",["T_WHITESPACE","\n            ",459],"}",["T_WHITESPACE","\n        ",460],"}",["T_WHITESPACE","\n\n        ",461],["T_COMMENT","\/\/ import billing address\n",463],["T_WHITESPACE","        ",464],["T_VARIABLE","$portBillingFromShipping",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$quote",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getPayment",464],"(",")",["T_OBJECT_OPERATOR","->",464],["T_STRING","getAdditionalInformation",464],"(",["T_STRING","self",464],["T_DOUBLE_COLON","::",464],["T_STRING","PAYMENT_INFO_BUTTON",464],")",["T_WHITESPACE"," ",464],["T_IS_EQUAL","==",464],["T_WHITESPACE"," ",464],["T_LNUMBER","1",464],["T_WHITESPACE","\n            ",464],["T_BOOLEAN_AND","&&",465],["T_WHITESPACE"," ",465],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","_config",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","requireBillingAddress",465],["T_WHITESPACE"," ",465],["T_IS_NOT_EQUAL","!=",465],["T_WHITESPACE"," ",465],["T_STRING","Mage_Paypal_Model_Config",465],["T_DOUBLE_COLON","::",465],["T_STRING","REQUIRE_BILLING_ADDRESS_ALL",465],["T_WHITESPACE","\n            ",465],["T_BOOLEAN_AND","&&",466],["T_WHITESPACE"," ",466],"!",["T_VARIABLE","$quote",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","isVirtual",466],"(",")",";",["T_WHITESPACE","\n        ",466],["T_IF","if",467],["T_WHITESPACE"," ",467],"(",["T_VARIABLE","$portBillingFromShipping",467],")",["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n            ",467],["T_VARIABLE","$billingAddress",468],["T_WHITESPACE"," ",468],"=",["T_WHITESPACE"," ",468],["T_CLONE","clone",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$shippingAddress",468],";",["T_WHITESPACE","\n            ",468],["T_VARIABLE","$billingAddress",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","unsAddressId",469],"(",")",["T_WHITESPACE","\n                ",469],["T_OBJECT_OPERATOR","->",470],["T_STRING","unsAddressType",470],"(",")",";",["T_WHITESPACE","\n            ",470],["T_VARIABLE","$data",471],["T_WHITESPACE"," ",471],"=",["T_WHITESPACE"," ",471],["T_VARIABLE","$billingAddress",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getData",471],"(",")",";",["T_WHITESPACE","\n            ",471],["T_VARIABLE","$data",472],"[",["T_CONSTANT_ENCAPSED_STRING","'save_in_address_book'",472],"]",["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_LNUMBER","0",472],";",["T_WHITESPACE","\n            ",472],["T_VARIABLE","$quote",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getBillingAddress",473],"(",")",["T_OBJECT_OPERATOR","->",473],["T_STRING","addData",473],"(",["T_VARIABLE","$data",473],")",";",["T_WHITESPACE","\n            ",473],["T_VARIABLE","$quote",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getShippingAddress",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","setSameAsBilling",474],"(",["T_LNUMBER","1",474],")",";",["T_WHITESPACE","\n        ",474],"}",["T_WHITESPACE"," ",475],["T_ELSE","else",475],["T_WHITESPACE"," ",475],"{",["T_WHITESPACE","\n            ",475],["T_VARIABLE","$billingAddress",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_VARIABLE","$quote",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getBillingAddress",476],"(",")",";",["T_WHITESPACE","\n        ",476],"}",["T_WHITESPACE","\n        ",477],["T_VARIABLE","$exportedBillingAddress",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","_api",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getExportedBillingAddress",478],"(",")",";",["T_WHITESPACE","\n        ",478],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_setExportedAddressData",479],"(",["T_VARIABLE","$billingAddress",479],",",["T_WHITESPACE"," ",479],["T_VARIABLE","$exportedBillingAddress",479],")",";",["T_WHITESPACE","\n        ",479],["T_VARIABLE","$billingAddress",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","setCustomerNotes",480],"(",["T_VARIABLE","$exportedBillingAddress",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getData",480],"(",["T_CONSTANT_ENCAPSED_STRING","'note'",480],")",")",";",["T_WHITESPACE","\n        ",480],["T_VARIABLE","$quote",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","setBillingAddress",481],"(",["T_VARIABLE","$billingAddress",481],")",";",["T_WHITESPACE","\n\n        ",481],["T_COMMENT","\/\/ import payment info\n",483],["T_WHITESPACE","        ",484],["T_VARIABLE","$payment",484],["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_VARIABLE","$quote",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getPayment",484],"(",")",";",["T_WHITESPACE","\n        ",484],["T_VARIABLE","$payment",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","setMethod",485],"(",["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","_methodType",485],")",";",["T_WHITESPACE","\n        ",485],["T_STRING","Mage",486],["T_DOUBLE_COLON","::",486],["T_STRING","getSingleton",486],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/info'",486],")",["T_OBJECT_OPERATOR","->",486],["T_STRING","importToPayment",486],"(",["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","_api",486],",",["T_WHITESPACE"," ",486],["T_VARIABLE","$payment",486],")",";",["T_WHITESPACE","\n        ",486],["T_VARIABLE","$payment",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","setAdditionalInformation",487],"(",["T_STRING","self",487],["T_DOUBLE_COLON","::",487],["T_STRING","PAYMENT_INFO_TRANSPORT_PAYER_ID",487],",",["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","_api",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getPayerId",487],"(",")",")",["T_WHITESPACE","\n            ",487],["T_OBJECT_OPERATOR","->",488],["T_STRING","setAdditionalInformation",488],"(",["T_STRING","self",488],["T_DOUBLE_COLON","::",488],["T_STRING","PAYMENT_INFO_TRANSPORT_TOKEN",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$token",488],")",["T_WHITESPACE","\n        ",488],";",["T_WHITESPACE","\n        ",489],["T_VARIABLE","$quote",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","collectTotals",490],"(",")",["T_OBJECT_OPERATOR","->",490],["T_STRING","save",490],"(",")",";",["T_WHITESPACE","\n    ",490],"}",["T_WHITESPACE","\n\n    ",491],["T_DOC_COMMENT","\/**\n     * Check whether order review has enough data to initialize\n     *\n     * @param $token\n     * @throws Mage_Core_Exception\n     *\/",493],["T_WHITESPACE","\n    ",498],["T_PUBLIC","public",499],["T_WHITESPACE"," ",499],["T_FUNCTION","function",499],["T_WHITESPACE"," ",499],["T_STRING","prepareOrderReview",499],"(",["T_VARIABLE","$token",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_STRING","null",499],")",["T_WHITESPACE","\n    ",499],"{",["T_WHITESPACE","\n        ",500],["T_VARIABLE","$payment",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","_quote",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getPayment",501],"(",")",";",["T_WHITESPACE","\n        ",501],["T_IF","if",502],["T_WHITESPACE"," ",502],"(","!",["T_VARIABLE","$payment",502],["T_WHITESPACE"," ",502],["T_BOOLEAN_OR","||",502],["T_WHITESPACE"," ",502],"!",["T_VARIABLE","$payment",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getAdditionalInformation",502],"(",["T_STRING","self",502],["T_DOUBLE_COLON","::",502],["T_STRING","PAYMENT_INFO_TRANSPORT_PAYER_ID",502],")",")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE","\n            ",502],["T_STRING","Mage",503],["T_DOUBLE_COLON","::",503],["T_STRING","throwException",503],"(",["T_STRING","Mage",503],["T_DOUBLE_COLON","::",503],["T_STRING","helper",503],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",503],")",["T_OBJECT_OPERATOR","->",503],["T_STRING","__",503],"(",["T_CONSTANT_ENCAPSED_STRING","'Payer is not identified.'",503],")",")",";",["T_WHITESPACE","\n        ",503],"}",["T_WHITESPACE","\n        ",504],["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","_quote",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","setMayEditShippingAddress",505],"(",["T_WHITESPACE","\n            ",505],["T_LNUMBER","1",506],["T_WHITESPACE"," ",506],["T_IS_NOT_EQUAL","!=",506],["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","_quote",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getPayment",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","getAdditionalInformation",506],"(",["T_STRING","self",506],["T_DOUBLE_COLON","::",506],["T_STRING","PAYMENT_INFO_TRANSPORT_SHIPPING_OVERRIDEN",506],")",["T_WHITESPACE","\n        ",506],")",";",["T_WHITESPACE","\n        ",507],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","_quote",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","setMayEditShippingMethod",508],"(",["T_WHITESPACE","\n            ",508],["T_CONSTANT_ENCAPSED_STRING","''",509],["T_WHITESPACE"," ",509],["T_IS_EQUAL","==",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","_quote",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getPayment",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","getAdditionalInformation",509],"(",["T_STRING","self",509],["T_DOUBLE_COLON","::",509],["T_STRING","PAYMENT_INFO_TRANSPORT_SHIPPING_METHOD",509],")",["T_WHITESPACE","\n        ",509],")",";",["T_WHITESPACE","\n        ",510],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","_ignoreAddressValidation",511],"(",")",";",["T_WHITESPACE","\n        ",511],["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","_quote",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","collectTotals",512],"(",")",["T_OBJECT_OPERATOR","->",512],["T_STRING","save",512],"(",")",";",["T_WHITESPACE","\n    ",512],"}",["T_WHITESPACE","\n\n    ",513],["T_DOC_COMMENT","\/**\n     * Return callback response with shipping options\n     *\n     * @param array $request\n     * @return string\n     *\/",515],["T_WHITESPACE","\n    ",520],["T_PUBLIC","public",521],["T_WHITESPACE"," ",521],["T_FUNCTION","function",521],["T_WHITESPACE"," ",521],["T_STRING","getShippingOptionsCallbackResponse",521],"(",["T_ARRAY","array",521],["T_WHITESPACE"," ",521],["T_VARIABLE","$request",521],")",["T_WHITESPACE","\n    ",521],"{",["T_WHITESPACE","\n        ",522],["T_COMMENT","\/\/ prepare debug data\n",523],["T_WHITESPACE","        ",524],["T_VARIABLE","$logger",524],["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_STRING","Mage",524],["T_DOUBLE_COLON","::",524],["T_STRING","getModel",524],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/log_adapter'",524],",",["T_WHITESPACE"," ",524],["T_CONSTANT_ENCAPSED_STRING","'payment_'",524],["T_WHITESPACE"," ",524],".",["T_WHITESPACE"," ",524],["T_VARIABLE","$this",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","_methodType",524],["T_WHITESPACE"," ",524],".",["T_WHITESPACE"," ",524],["T_CONSTANT_ENCAPSED_STRING","'.log'",524],")",";",["T_WHITESPACE","\n        ",524],["T_VARIABLE","$debugData",525],["T_WHITESPACE"," ",525],"=",["T_WHITESPACE"," ",525],["T_ARRAY","array",525],"(",["T_CONSTANT_ENCAPSED_STRING","'request'",525],["T_WHITESPACE"," ",525],["T_DOUBLE_ARROW","=>",525],["T_WHITESPACE"," ",525],["T_VARIABLE","$request",525],",",["T_WHITESPACE"," ",525],["T_CONSTANT_ENCAPSED_STRING","'response'",525],["T_WHITESPACE"," ",525],["T_DOUBLE_ARROW","=>",525],["T_WHITESPACE"," ",525],["T_ARRAY","array",525],"(",")",")",";",["T_WHITESPACE","\n\n        ",525],["T_TRY","try",527],["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n            ",527],["T_COMMENT","\/\/ obtain addresses\n",528],["T_WHITESPACE","            ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","_getApi",529],"(",")",";",["T_WHITESPACE","\n            ",529],["T_VARIABLE","$address",530],["T_WHITESPACE"," ",530],"=",["T_WHITESPACE"," ",530],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","_api",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","prepareShippingOptionsCallbackAddress",530],"(",["T_VARIABLE","$request",530],")",";",["T_WHITESPACE","\n            ",530],["T_VARIABLE","$quoteAddress",531],["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","_quote",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","getShippingAddress",531],"(",")",";",["T_WHITESPACE","\n\n            ",531],["T_COMMENT","\/\/ compare addresses, calculate shipping rates and prepare response\n",533],["T_WHITESPACE","            ",534],["T_VARIABLE","$options",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_ARRAY","array",534],"(",")",";",["T_WHITESPACE","\n            ",534],["T_IF","if",535],["T_WHITESPACE"," ",535],"(",["T_VARIABLE","$address",535],["T_WHITESPACE"," ",535],["T_BOOLEAN_AND","&&",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$quoteAddress",535],["T_WHITESPACE"," ",535],["T_BOOLEAN_AND","&&",535],["T_WHITESPACE"," ",535],"!",["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","_quote",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","getIsVirtual",535],"(",")",")",["T_WHITESPACE"," ",535],"{",["T_WHITESPACE","\n                ",535],["T_FOREACH","foreach",536],["T_WHITESPACE"," ",536],"(",["T_VARIABLE","$address",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","getExportedKeys",536],"(",")",["T_WHITESPACE"," ",536],["T_AS","as",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$key",536],")",["T_WHITESPACE"," ",536],"{",["T_WHITESPACE","\n                    ",536],["T_VARIABLE","$quoteAddress",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","setDataUsingMethod",537],"(",["T_VARIABLE","$key",537],",",["T_WHITESPACE"," ",537],["T_VARIABLE","$address",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getData",537],"(",["T_VARIABLE","$key",537],")",")",";",["T_WHITESPACE","\n                ",537],"}",["T_WHITESPACE","\n                ",538],["T_VARIABLE","$quoteAddress",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","setCollectShippingRates",539],"(",["T_STRING","true",539],")",["T_OBJECT_OPERATOR","->",539],["T_STRING","collectTotals",539],"(",")",";",["T_WHITESPACE","\n                ",539],["T_VARIABLE","$options",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","_prepareShippingOptions",540],"(",["T_VARIABLE","$quoteAddress",540],",",["T_WHITESPACE"," ",540],["T_STRING","false",540],",",["T_WHITESPACE"," ",540],["T_STRING","true",540],")",";",["T_WHITESPACE","\n            ",540],"}",["T_WHITESPACE","\n            ",541],["T_VARIABLE","$response",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","_api",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","setShippingOptions",542],"(",["T_VARIABLE","$options",542],")",["T_OBJECT_OPERATOR","->",542],["T_STRING","formatShippingOptionsCallback",542],"(",")",";",["T_WHITESPACE","\n\n            ",542],["T_COMMENT","\/\/ log request and response\n",544],["T_WHITESPACE","            ",545],["T_VARIABLE","$debugData",545],"[",["T_CONSTANT_ENCAPSED_STRING","'response'",545],"]",["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$response",545],";",["T_WHITESPACE","\n            ",545],["T_VARIABLE","$logger",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","log",546],"(",["T_VARIABLE","$debugData",546],")",";",["T_WHITESPACE","\n            ",546],["T_RETURN","return",547],["T_WHITESPACE"," ",547],["T_VARIABLE","$response",547],";",["T_WHITESPACE","\n        ",547],"}",["T_WHITESPACE"," ",548],["T_CATCH","catch",548],["T_WHITESPACE"," ",548],"(",["T_STRING","Exception",548],["T_WHITESPACE"," ",548],["T_VARIABLE","$e",548],")",["T_WHITESPACE"," ",548],"{",["T_WHITESPACE","\n            ",548],["T_VARIABLE","$logger",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","log",549],"(",["T_VARIABLE","$debugData",549],")",";",["T_WHITESPACE","\n            ",549],["T_THROW","throw",550],["T_WHITESPACE"," ",550],["T_VARIABLE","$e",550],";",["T_WHITESPACE","\n        ",550],"}",["T_WHITESPACE","\n    ",551],"}",["T_WHITESPACE","\n\n    ",552],["T_DOC_COMMENT","\/**\n     * Set shipping method to quote, if needed\n     * @param string $methodCode\n     *\/",554],["T_WHITESPACE","\n    ",557],["T_PUBLIC","public",558],["T_WHITESPACE"," ",558],["T_FUNCTION","function",558],["T_WHITESPACE"," ",558],["T_STRING","updateShippingMethod",558],"(",["T_VARIABLE","$methodCode",558],")",["T_WHITESPACE","\n    ",558],"{",["T_WHITESPACE","\n        ",559],["T_IF","if",560],["T_WHITESPACE"," ",560],"(","!",["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","_quote",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getIsVirtual",560],"(",")",["T_WHITESPACE"," ",560],["T_BOOLEAN_AND","&&",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$shippingAddress",560],["T_WHITESPACE"," ",560],"=",["T_WHITESPACE"," ",560],["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","_quote",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getShippingAddress",560],"(",")",")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n            ",560],["T_IF","if",561],["T_WHITESPACE"," ",561],"(",["T_VARIABLE","$methodCode",561],["T_WHITESPACE"," ",561],["T_IS_NOT_EQUAL","!=",561],["T_WHITESPACE"," ",561],["T_VARIABLE","$shippingAddress",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","getShippingMethod",561],"(",")",")",["T_WHITESPACE"," ",561],"{",["T_WHITESPACE","\n                ",561],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","_ignoreAddressValidation",562],"(",")",";",["T_WHITESPACE","\n                ",562],["T_VARIABLE","$shippingAddress",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","setShippingMethod",563],"(",["T_VARIABLE","$methodCode",563],")",["T_OBJECT_OPERATOR","->",563],["T_STRING","setCollectShippingRates",563],"(",["T_STRING","true",563],")",";",["T_WHITESPACE","\n                ",563],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","_quote",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","collectTotals",564],"(",")",["T_OBJECT_OPERATOR","->",564],["T_STRING","save",564],"(",")",";",["T_WHITESPACE","\n            ",564],"}",["T_WHITESPACE","\n        ",565],"}",["T_WHITESPACE","\n    ",566],"}",["T_WHITESPACE","\n\n    ",567],["T_DOC_COMMENT","\/**\n     * Place the order and recurring payment profiles when customer returned from paypal\n     * Until this moment all quote data must be valid\n     *\n     * @param string $token\n     * @param string $shippingMethodCode\n     *\/",569],["T_WHITESPACE","\n    ",575],["T_PUBLIC","public",576],["T_WHITESPACE"," ",576],["T_FUNCTION","function",576],["T_WHITESPACE"," ",576],["T_STRING","place",576],"(",["T_VARIABLE","$token",576],",",["T_WHITESPACE"," ",576],["T_VARIABLE","$shippingMethodCode",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_STRING","null",576],")",["T_WHITESPACE","\n    ",576],"{",["T_WHITESPACE","\n        ",577],["T_IF","if",578],["T_WHITESPACE"," ",578],"(",["T_VARIABLE","$shippingMethodCode",578],")",["T_WHITESPACE"," ",578],"{",["T_WHITESPACE","\n            ",578],["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","updateShippingMethod",579],"(",["T_VARIABLE","$shippingMethodCode",579],")",";",["T_WHITESPACE","\n        ",579],"}",["T_WHITESPACE","\n\n        ",580],["T_VARIABLE","$isNewCustomer",582],["T_WHITESPACE"," ",582],"=",["T_WHITESPACE"," ",582],["T_STRING","false",582],";",["T_WHITESPACE","\n        ",582],["T_SWITCH","switch",583],["T_WHITESPACE"," ",583],"(",["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","getCheckoutMethod",583],"(",")",")",["T_WHITESPACE"," ",583],"{",["T_WHITESPACE","\n            ",583],["T_CASE","case",584],["T_WHITESPACE"," ",584],["T_STRING","Mage_Checkout_Model_Type_Onepage",584],["T_DOUBLE_COLON","::",584],["T_STRING","METHOD_GUEST",584],":",["T_WHITESPACE","\n                ",584],["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","_prepareGuestQuote",585],"(",")",";",["T_WHITESPACE","\n                ",585],["T_BREAK","break",586],";",["T_WHITESPACE","\n            ",586],["T_CASE","case",587],["T_WHITESPACE"," ",587],["T_STRING","Mage_Checkout_Model_Type_Onepage",587],["T_DOUBLE_COLON","::",587],["T_STRING","METHOD_REGISTER",587],":",["T_WHITESPACE","\n                ",587],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","_prepareNewCustomerQuote",588],"(",")",";",["T_WHITESPACE","\n                ",588],["T_VARIABLE","$isNewCustomer",589],["T_WHITESPACE"," ",589],"=",["T_WHITESPACE"," ",589],["T_STRING","true",589],";",["T_WHITESPACE","\n                ",589],["T_BREAK","break",590],";",["T_WHITESPACE","\n            ",590],["T_DEFAULT","default",591],":",["T_WHITESPACE","\n                ",591],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","_prepareCustomerQuote",592],"(",")",";",["T_WHITESPACE","\n                ",592],["T_BREAK","break",593],";",["T_WHITESPACE","\n        ",593],"}",["T_WHITESPACE","\n\n        ",594],["T_VARIABLE","$this",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","_ignoreAddressValidation",596],"(",")",";",["T_WHITESPACE","\n        ",596],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","_quote",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","collectTotals",597],"(",")",";",["T_WHITESPACE","\n        ",597],["T_VARIABLE","$service",598],["T_WHITESPACE"," ",598],"=",["T_WHITESPACE"," ",598],["T_STRING","Mage",598],["T_DOUBLE_COLON","::",598],["T_STRING","getModel",598],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_quote'",598],",",["T_WHITESPACE"," ",598],["T_VARIABLE","$this",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","_quote",598],")",";",["T_WHITESPACE","\n        ",598],["T_VARIABLE","$service",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","submitAll",599],"(",")",";",["T_WHITESPACE","\n        ",599],["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","_quote",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","save",600],"(",")",";",["T_WHITESPACE","\n\n        ",600],["T_IF","if",602],["T_WHITESPACE"," ",602],"(",["T_VARIABLE","$isNewCustomer",602],")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n            ",602],["T_TRY","try",603],["T_WHITESPACE"," ",603],"{",["T_WHITESPACE","\n                ",603],["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","_involveNewCustomer",604],"(",")",";",["T_WHITESPACE","\n            ",604],"}",["T_WHITESPACE"," ",605],["T_CATCH","catch",605],["T_WHITESPACE"," ",605],"(",["T_STRING","Exception",605],["T_WHITESPACE"," ",605],["T_VARIABLE","$e",605],")",["T_WHITESPACE"," ",605],"{",["T_WHITESPACE","\n                ",605],["T_STRING","Mage",606],["T_DOUBLE_COLON","::",606],["T_STRING","logException",606],"(",["T_VARIABLE","$e",606],")",";",["T_WHITESPACE","\n            ",606],"}",["T_WHITESPACE","\n        ",607],"}",["T_WHITESPACE","\n\n        ",608],["T_VARIABLE","$this",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","_recurringPaymentProfiles",610],["T_WHITESPACE"," ",610],"=",["T_WHITESPACE"," ",610],["T_VARIABLE","$service",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getRecurringPaymentProfiles",610],"(",")",";",["T_WHITESPACE","\n        ",610],["T_COMMENT","\/\/ TODO: send recurring profile emails\n",611],["T_WHITESPACE","\n        ",612],["T_DOC_COMMENT","\/** @var $order Mage_Sales_Model_Order *\/",613],["T_WHITESPACE","\n        ",613],["T_VARIABLE","$order",614],["T_WHITESPACE"," ",614],"=",["T_WHITESPACE"," ",614],["T_VARIABLE","$service",614],["T_OBJECT_OPERATOR","->",614],["T_STRING","getOrder",614],"(",")",";",["T_WHITESPACE","\n        ",614],["T_IF","if",615],["T_WHITESPACE"," ",615],"(","!",["T_VARIABLE","$order",615],")",["T_WHITESPACE"," ",615],"{",["T_WHITESPACE","\n            ",615],["T_RETURN","return",616],";",["T_WHITESPACE","\n        ",616],"}",["T_WHITESPACE","\n        ",617],["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","_billingAgreement",618],["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_VARIABLE","$order",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getPayment",618],"(",")",["T_OBJECT_OPERATOR","->",618],["T_STRING","getBillingAgreement",618],"(",")",";",["T_WHITESPACE","\n\n        ",618],["T_COMMENT","\/\/ commence redirecting to finish payment, if paypal requires it\n",620],["T_WHITESPACE","        ",621],["T_IF","if",621],["T_WHITESPACE"," ",621],"(",["T_VARIABLE","$order",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","getPayment",621],"(",")",["T_OBJECT_OPERATOR","->",621],["T_STRING","getAdditionalInformation",621],"(",["T_WHITESPACE","\n                ",621],["T_STRING","Mage_Paypal_Model_Express_Checkout",622],["T_DOUBLE_COLON","::",622],["T_STRING","PAYMENT_INFO_TRANSPORT_REDIRECT",622],["T_WHITESPACE","\n        ",622],")",")",["T_WHITESPACE"," ",623],"{",["T_WHITESPACE","\n            ",623],["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","_redirectUrl",624],["T_WHITESPACE"," ",624],"=",["T_WHITESPACE"," ",624],["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","_config",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","getExpressCheckoutCompleteUrl",624],"(",["T_VARIABLE","$token",624],")",";",["T_WHITESPACE","\n        ",624],"}",["T_WHITESPACE","\n\n        ",625],["T_SWITCH","switch",627],["T_WHITESPACE"," ",627],"(",["T_VARIABLE","$order",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","getState",627],"(",")",")",["T_WHITESPACE"," ",627],"{",["T_WHITESPACE","\n            ",627],["T_COMMENT","\/\/ even after placement paypal can disallow to authorize\/capture, but will wait until bank transfers money\n",628],["T_WHITESPACE","            ",629],["T_CASE","case",629],["T_WHITESPACE"," ",629],["T_STRING","Mage_Sales_Model_Order",629],["T_DOUBLE_COLON","::",629],["T_STRING","STATE_PENDING_PAYMENT",629],":",["T_WHITESPACE","\n                ",629],["T_COMMENT","\/\/ TODO\n",630],["T_WHITESPACE","                ",631],["T_BREAK","break",631],";",["T_WHITESPACE","\n            ",631],["T_COMMENT","\/\/ regular placement, when everything is ok\n",632],["T_WHITESPACE","            ",633],["T_CASE","case",633],["T_WHITESPACE"," ",633],["T_STRING","Mage_Sales_Model_Order",633],["T_DOUBLE_COLON","::",633],["T_STRING","STATE_PROCESSING",633],":",["T_WHITESPACE","\n            ",633],["T_CASE","case",634],["T_WHITESPACE"," ",634],["T_STRING","Mage_Sales_Model_Order",634],["T_DOUBLE_COLON","::",634],["T_STRING","STATE_COMPLETE",634],":",["T_WHITESPACE","\n            ",634],["T_CASE","case",635],["T_WHITESPACE"," ",635],["T_STRING","Mage_Sales_Model_Order",635],["T_DOUBLE_COLON","::",635],["T_STRING","STATE_PAYMENT_REVIEW",635],":",["T_WHITESPACE","\n                ",635],["T_VARIABLE","$order",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","queueNewOrderEmail",636],"(",")",";",["T_WHITESPACE","\n                ",636],["T_BREAK","break",637],";",["T_WHITESPACE","\n        ",637],"}",["T_WHITESPACE","\n        ",638],["T_VARIABLE","$this",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","_order",639],["T_WHITESPACE"," ",639],"=",["T_WHITESPACE"," ",639],["T_VARIABLE","$order",639],";",["T_WHITESPACE","\n    ",639],"}",["T_WHITESPACE","\n\n    ",640],["T_DOC_COMMENT","\/**\n     * Make sure addresses will be saved without validation errors\n     *\/",642],["T_WHITESPACE","\n    ",644],["T_PRIVATE","private",645],["T_WHITESPACE"," ",645],["T_FUNCTION","function",645],["T_WHITESPACE"," ",645],["T_STRING","_ignoreAddressValidation",645],"(",")",["T_WHITESPACE","\n    ",645],"{",["T_WHITESPACE","\n        ",646],["T_VARIABLE","$this",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","_quote",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","getBillingAddress",647],"(",")",["T_OBJECT_OPERATOR","->",647],["T_STRING","setShouldIgnoreValidation",647],"(",["T_STRING","true",647],")",";",["T_WHITESPACE","\n        ",647],["T_IF","if",648],["T_WHITESPACE"," ",648],"(","!",["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","_quote",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getIsVirtual",648],"(",")",")",["T_WHITESPACE"," ",648],"{",["T_WHITESPACE","\n            ",648],["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","_quote",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","getShippingAddress",649],"(",")",["T_OBJECT_OPERATOR","->",649],["T_STRING","setShouldIgnoreValidation",649],"(",["T_STRING","true",649],")",";",["T_WHITESPACE","\n            ",649],["T_IF","if",650],["T_WHITESPACE"," ",650],"(","!",["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","_config",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","requireBillingAddress",650],["T_WHITESPACE"," ",650],["T_BOOLEAN_AND","&&",650],["T_WHITESPACE"," ",650],"!",["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","_quote",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getBillingAddress",650],"(",")",["T_OBJECT_OPERATOR","->",650],["T_STRING","getEmail",650],"(",")",")",["T_WHITESPACE"," ",650],"{",["T_WHITESPACE","\n                ",650],["T_VARIABLE","$this",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","_quote",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","getBillingAddress",651],"(",")",["T_OBJECT_OPERATOR","->",651],["T_STRING","setSameAsBilling",651],"(",["T_LNUMBER","1",651],")",";",["T_WHITESPACE","\n            ",651],"}",["T_WHITESPACE","\n        ",652],"}",["T_WHITESPACE","\n    ",653],"}",["T_WHITESPACE","\n\n    ",654],["T_DOC_COMMENT","\/**\n     * Determine whether redirect somewhere specifically is required\n     *\n     * @return string\n     *\/",656],["T_WHITESPACE","\n    ",660],["T_PUBLIC","public",661],["T_WHITESPACE"," ",661],["T_FUNCTION","function",661],["T_WHITESPACE"," ",661],["T_STRING","getRedirectUrl",661],"(",")",["T_WHITESPACE","\n    ",661],"{",["T_WHITESPACE","\n        ",662],["T_RETURN","return",663],["T_WHITESPACE"," ",663],["T_VARIABLE","$this",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","_redirectUrl",663],";",["T_WHITESPACE","\n    ",663],"}",["T_WHITESPACE","\n\n    ",664],["T_DOC_COMMENT","\/**\n     * Return recurring payment profiles\n     *\n     * @return array\n     *\/",666],["T_WHITESPACE","\n    ",670],["T_PUBLIC","public",671],["T_WHITESPACE"," ",671],["T_FUNCTION","function",671],["T_WHITESPACE"," ",671],["T_STRING","getRecurringPaymentProfiles",671],"(",")",["T_WHITESPACE","\n    ",671],"{",["T_WHITESPACE","\n        ",672],["T_RETURN","return",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","_recurringPaymentProfiles",673],";",["T_WHITESPACE","\n    ",673],"}",["T_WHITESPACE","\n\n    ",674],["T_DOC_COMMENT","\/**\n     * Get created billing agreement\n     *\n     * @return Mage_Sales_Model_Billing_Agreement|null\n     *\/",676],["T_WHITESPACE","\n    ",680],["T_PUBLIC","public",681],["T_WHITESPACE"," ",681],["T_FUNCTION","function",681],["T_WHITESPACE"," ",681],["T_STRING","getBillingAgreement",681],"(",")",["T_WHITESPACE","\n    ",681],"{",["T_WHITESPACE","\n        ",682],["T_RETURN","return",683],["T_WHITESPACE"," ",683],["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","_billingAgreement",683],";",["T_WHITESPACE","\n    ",683],"}",["T_WHITESPACE","\n\n    ",684],["T_DOC_COMMENT","\/**\n     * Return order\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",686],["T_WHITESPACE","\n    ",690],["T_PUBLIC","public",691],["T_WHITESPACE"," ",691],["T_FUNCTION","function",691],["T_WHITESPACE"," ",691],["T_STRING","getOrder",691],"(",")",["T_WHITESPACE","\n    ",691],"{",["T_WHITESPACE","\n        ",692],["T_RETURN","return",693],["T_WHITESPACE"," ",693],["T_VARIABLE","$this",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","_order",693],";",["T_WHITESPACE","\n    ",693],"}",["T_WHITESPACE","\n\n    ",694],["T_DOC_COMMENT","\/**\n     * Get checkout method\n     *\n     * @return string\n     *\/",696],["T_WHITESPACE","\n    ",700],["T_PUBLIC","public",701],["T_WHITESPACE"," ",701],["T_FUNCTION","function",701],["T_WHITESPACE"," ",701],["T_STRING","getCheckoutMethod",701],"(",")",["T_WHITESPACE","\n    ",701],"{",["T_WHITESPACE","\n        ",702],["T_IF","if",703],["T_WHITESPACE"," ",703],"(",["T_VARIABLE","$this",703],["T_OBJECT_OPERATOR","->",703],["T_STRING","getCustomerSession",703],"(",")",["T_OBJECT_OPERATOR","->",703],["T_STRING","isLoggedIn",703],"(",")",")",["T_WHITESPACE"," ",703],"{",["T_WHITESPACE","\n            ",703],["T_RETURN","return",704],["T_WHITESPACE"," ",704],["T_STRING","Mage_Checkout_Model_Type_Onepage",704],["T_DOUBLE_COLON","::",704],["T_STRING","METHOD_CUSTOMER",704],";",["T_WHITESPACE","\n        ",704],"}",["T_WHITESPACE","\n        ",705],["T_IF","if",706],["T_WHITESPACE"," ",706],"(","!",["T_VARIABLE","$this",706],["T_OBJECT_OPERATOR","->",706],["T_STRING","_quote",706],["T_OBJECT_OPERATOR","->",706],["T_STRING","getCheckoutMethod",706],"(",")",")",["T_WHITESPACE"," ",706],"{",["T_WHITESPACE","\n            ",706],["T_IF","if",707],["T_WHITESPACE"," ",707],"(",["T_STRING","Mage",707],["T_DOUBLE_COLON","::",707],["T_STRING","helper",707],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",707],")",["T_OBJECT_OPERATOR","->",707],["T_STRING","isAllowedGuestCheckout",707],"(",["T_VARIABLE","$this",707],["T_OBJECT_OPERATOR","->",707],["T_STRING","_quote",707],")",")",["T_WHITESPACE"," ",707],"{",["T_WHITESPACE","\n                ",707],["T_VARIABLE","$this",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","_quote",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","setCheckoutMethod",708],"(",["T_STRING","Mage_Checkout_Model_Type_Onepage",708],["T_DOUBLE_COLON","::",708],["T_STRING","METHOD_GUEST",708],")",";",["T_WHITESPACE","\n            ",708],"}",["T_WHITESPACE"," ",709],["T_ELSE","else",709],["T_WHITESPACE"," ",709],"{",["T_WHITESPACE","\n                ",709],["T_VARIABLE","$this",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","_quote",710],["T_OBJECT_OPERATOR","->",710],["T_STRING","setCheckoutMethod",710],"(",["T_STRING","Mage_Checkout_Model_Type_Onepage",710],["T_DOUBLE_COLON","::",710],["T_STRING","METHOD_REGISTER",710],")",";",["T_WHITESPACE","\n            ",710],"}",["T_WHITESPACE","\n        ",711],"}",["T_WHITESPACE","\n        ",712],["T_RETURN","return",713],["T_WHITESPACE"," ",713],["T_VARIABLE","$this",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","_quote",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","getCheckoutMethod",713],"(",")",";",["T_WHITESPACE","\n    ",713],"}",["T_WHITESPACE","\n\n    ",714],["T_DOC_COMMENT","\/**\n     * Sets address data from exported address\n     *\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @param array $exportedAddress\n     *\/",716],["T_WHITESPACE","\n    ",721],["T_PROTECTED","protected",722],["T_WHITESPACE"," ",722],["T_FUNCTION","function",722],["T_WHITESPACE"," ",722],["T_STRING","_setExportedAddressData",722],"(",["T_VARIABLE","$address",722],",",["T_WHITESPACE"," ",722],["T_VARIABLE","$exportedAddress",722],")",["T_WHITESPACE","\n    ",722],"{",["T_WHITESPACE","\n        ",723],["T_COMMENT","\/\/ Exported data is more priority if we came from Express Checkout button\n",724],["T_WHITESPACE","        ",725],["T_VARIABLE","$isButton",725],["T_WHITESPACE","  ",725],"=",["T_WHITESPACE"," ",725],["T_BOOL_CAST","(bool)",725],["T_VARIABLE","$this",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","_quote",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","getPayment",725],"(",")",["T_OBJECT_OPERATOR","->",725],["T_STRING","getAdditionalInformation",725],"(",["T_STRING","self",725],["T_DOUBLE_COLON","::",725],["T_STRING","PAYMENT_INFO_BUTTON",725],")",";",["T_WHITESPACE","\n        ",725],["T_IF","if",726],["T_WHITESPACE"," ",726],"(","!",["T_VARIABLE","$isButton",726],")",["T_WHITESPACE"," ",726],"{",["T_WHITESPACE","\n            ",726],["T_FOREACH","foreach",727],["T_WHITESPACE"," ",727],"(",["T_VARIABLE","$exportedAddress",727],["T_OBJECT_OPERATOR","->",727],["T_STRING","getExportedKeys",727],"(",")",["T_WHITESPACE"," ",727],["T_AS","as",727],["T_WHITESPACE"," ",727],["T_VARIABLE","$key",727],")",["T_WHITESPACE"," ",727],"{",["T_WHITESPACE","\n                ",727],["T_VARIABLE","$oldData",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_VARIABLE","$address",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","getDataUsingMethod",728],"(",["T_VARIABLE","$key",728],")",";",["T_WHITESPACE","\n                ",728],["T_VARIABLE","$isEmpty",729],["T_WHITESPACE"," ",729],"=",["T_WHITESPACE"," ",729],["T_STRING","null",729],";",["T_WHITESPACE","\n                ",729],["T_IF","if",730],["T_WHITESPACE"," ",730],"(",["T_STRING","is_array",730],"(",["T_VARIABLE","$oldData",730],")",")",["T_WHITESPACE"," ",730],"{",["T_WHITESPACE","\n                    ",730],["T_FOREACH","foreach",731],"(",["T_VARIABLE","$oldData",731],["T_WHITESPACE"," ",731],["T_AS","as",731],["T_WHITESPACE"," ",731],["T_VARIABLE","$val",731],")",["T_WHITESPACE"," ",731],"{",["T_WHITESPACE","\n                        ",731],["T_IF","if",732],"(","!",["T_EMPTY","empty",732],"(",["T_VARIABLE","$val",732],")",")",["T_WHITESPACE"," ",732],"{",["T_WHITESPACE","\n                            ",732],["T_VARIABLE","$isEmpty",733],["T_WHITESPACE"," ",733],"=",["T_WHITESPACE"," ",733],["T_STRING","false",733],";",["T_WHITESPACE","\n                            ",733],["T_BREAK","break",734],";",["T_WHITESPACE","\n                        ",734],"}",["T_WHITESPACE","\n                        ",735],["T_VARIABLE","$isEmpty",736],["T_WHITESPACE"," ",736],"=",["T_WHITESPACE"," ",736],["T_STRING","true",736],";",["T_WHITESPACE","\n                    ",736],"}",["T_WHITESPACE","\n                ",737],"}",["T_WHITESPACE","\n                ",738],["T_IF","if",739],["T_WHITESPACE"," ",739],"(",["T_EMPTY","empty",739],"(",["T_VARIABLE","$oldData",739],")",["T_WHITESPACE"," ",739],["T_BOOLEAN_OR","||",739],["T_WHITESPACE"," ",739],["T_VARIABLE","$isEmpty",739],["T_WHITESPACE"," ",739],["T_IS_IDENTICAL","===",739],["T_WHITESPACE"," ",739],["T_STRING","true",739],")",["T_WHITESPACE"," ",739],"{",["T_WHITESPACE","\n                    ",739],["T_VARIABLE","$address",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","setDataUsingMethod",740],"(",["T_VARIABLE","$key",740],",",["T_WHITESPACE"," ",740],["T_VARIABLE","$exportedAddress",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","getData",740],"(",["T_VARIABLE","$key",740],")",")",";",["T_WHITESPACE","\n                ",740],"}",["T_WHITESPACE","\n            ",741],"}",["T_WHITESPACE","\n        ",742],"}",["T_WHITESPACE"," ",743],["T_ELSE","else",743],["T_WHITESPACE"," ",743],"{",["T_WHITESPACE","\n            ",743],["T_FOREACH","foreach",744],["T_WHITESPACE"," ",744],"(",["T_VARIABLE","$exportedAddress",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","getExportedKeys",744],"(",")",["T_WHITESPACE"," ",744],["T_AS","as",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$key",744],")",["T_WHITESPACE"," ",744],"{",["T_WHITESPACE","\n                ",744],["T_VARIABLE","$data",745],["T_WHITESPACE"," ",745],"=",["T_WHITESPACE"," ",745],["T_VARIABLE","$exportedAddress",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","getData",745],"(",["T_VARIABLE","$key",745],")",";",["T_WHITESPACE","\n                ",745],["T_IF","if",746],["T_WHITESPACE"," ",746],"(","!",["T_EMPTY","empty",746],"(",["T_VARIABLE","$data",746],")",")",["T_WHITESPACE"," ",746],"{",["T_WHITESPACE","\n                    ",746],["T_VARIABLE","$address",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","setDataUsingMethod",747],"(",["T_VARIABLE","$key",747],",",["T_WHITESPACE"," ",747],["T_VARIABLE","$data",747],")",";",["T_WHITESPACE","\n                ",747],"}",["T_WHITESPACE","\n            ",748],"}",["T_WHITESPACE","\n        ",749],"}",["T_WHITESPACE","\n    ",750],"}",["T_WHITESPACE","\n\n    ",751],["T_DOC_COMMENT","\/**\n     * Set create billing agreement flag to api call\n     *\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",753],["T_WHITESPACE","\n    ",757],["T_PROTECTED","protected",758],["T_WHITESPACE"," ",758],["T_FUNCTION","function",758],["T_WHITESPACE"," ",758],["T_STRING","_setBillingAgreementRequest",758],"(",")",["T_WHITESPACE","\n    ",758],"{",["T_WHITESPACE","\n        ",759],["T_IF","if",760],["T_WHITESPACE"," ",760],"(","!",["T_VARIABLE","$this",760],["T_OBJECT_OPERATOR","->",760],["T_STRING","_customerId",760],["T_WHITESPACE"," ",760],["T_BOOLEAN_OR","||",760],["T_WHITESPACE"," ",760],["T_VARIABLE","$this",760],["T_OBJECT_OPERATOR","->",760],["T_STRING","_quote",760],["T_OBJECT_OPERATOR","->",760],["T_STRING","hasNominalItems",760],"(",")",")",["T_WHITESPACE"," ",760],"{",["T_WHITESPACE","\n            ",760],["T_RETURN","return",761],["T_WHITESPACE"," ",761],["T_VARIABLE","$this",761],";",["T_WHITESPACE","\n        ",761],"}",["T_WHITESPACE","\n\n        ",762],["T_VARIABLE","$isRequested",764],["T_WHITESPACE"," ",764],"=",["T_WHITESPACE"," ",764],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","_isBARequested",764],["T_WHITESPACE"," ",764],["T_BOOLEAN_OR","||",764],["T_WHITESPACE"," ",764],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","_quote",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","getPayment",764],"(",")",["T_WHITESPACE","\n            ",764],["T_OBJECT_OPERATOR","->",765],["T_STRING","getAdditionalInformation",765],"(",["T_STRING","self",765],["T_DOUBLE_COLON","::",765],["T_STRING","PAYMENT_INFO_TRANSPORT_BILLING_AGREEMENT",765],")",";",["T_WHITESPACE","\n\n        ",765],["T_IF","if",767],["T_WHITESPACE"," ",767],"(","!","(",["T_VARIABLE","$this",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","_config",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","allow_ba_signup",767],["T_WHITESPACE"," ",767],["T_IS_EQUAL","==",767],["T_WHITESPACE"," ",767],["T_STRING","Mage_Paypal_Model_Config",767],["T_DOUBLE_COLON","::",767],["T_STRING","EC_BA_SIGNUP_AUTO",767],["T_WHITESPACE","\n            ",767],["T_BOOLEAN_OR","||",768],["T_WHITESPACE"," ",768],["T_VARIABLE","$isRequested",768],["T_WHITESPACE"," ",768],["T_BOOLEAN_AND","&&",768],["T_WHITESPACE"," ",768],["T_VARIABLE","$this",768],["T_OBJECT_OPERATOR","->",768],["T_STRING","_config",768],["T_OBJECT_OPERATOR","->",768],["T_STRING","shouldAskToCreateBillingAgreement",768],"(",")",")",")",["T_WHITESPACE"," ",768],"{",["T_WHITESPACE","\n            ",768],["T_RETURN","return",769],["T_WHITESPACE"," ",769],["T_VARIABLE","$this",769],";",["T_WHITESPACE","\n        ",769],"}",["T_WHITESPACE","\n\n        ",770],["T_IF","if",772],["T_WHITESPACE"," ",772],"(","!",["T_STRING","Mage",772],["T_DOUBLE_COLON","::",772],["T_STRING","getModel",772],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement'",772],")",["T_OBJECT_OPERATOR","->",772],["T_STRING","needToCreateForCustomer",772],"(",["T_VARIABLE","$this",772],["T_OBJECT_OPERATOR","->",772],["T_STRING","_customerId",772],")",")",["T_WHITESPACE"," ",772],"{",["T_WHITESPACE","\n            ",772],["T_RETURN","return",773],["T_WHITESPACE"," ",773],["T_VARIABLE","$this",773],";",["T_WHITESPACE","\n        ",773],"}",["T_WHITESPACE","\n        ",774],["T_VARIABLE","$this",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","_api",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","setBillingType",775],"(",["T_VARIABLE","$this",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","_api",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","getBillingAgreementType",775],"(",")",")",";",["T_WHITESPACE","\n        ",775],["T_RETURN","return",776],["T_WHITESPACE"," ",776],["T_VARIABLE","$this",776],";",["T_WHITESPACE","\n    ",776],"}",["T_WHITESPACE","\n\n    ",777],["T_DOC_COMMENT","\/**\n     * @return Mage_Paypal_Model_Api_Nvp\n     *\/",779],["T_WHITESPACE","\n    ",781],["T_PROTECTED","protected",782],["T_WHITESPACE"," ",782],["T_FUNCTION","function",782],["T_WHITESPACE"," ",782],["T_STRING","_getApi",782],"(",")",["T_WHITESPACE","\n    ",782],"{",["T_WHITESPACE","\n        ",783],["T_IF","if",784],["T_WHITESPACE"," ",784],"(",["T_STRING","null",784],["T_WHITESPACE"," ",784],["T_IS_IDENTICAL","===",784],["T_WHITESPACE"," ",784],["T_VARIABLE","$this",784],["T_OBJECT_OPERATOR","->",784],["T_STRING","_api",784],")",["T_WHITESPACE"," ",784],"{",["T_WHITESPACE","\n            ",784],["T_VARIABLE","$this",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","_api",785],["T_WHITESPACE"," ",785],"=",["T_WHITESPACE"," ",785],["T_STRING","Mage",785],["T_DOUBLE_COLON","::",785],["T_STRING","getModel",785],"(",["T_VARIABLE","$this",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","_apiType",785],")",["T_OBJECT_OPERATOR","->",785],["T_STRING","setConfigObject",785],"(",["T_VARIABLE","$this",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","_config",785],")",";",["T_WHITESPACE","\n        ",785],"}",["T_WHITESPACE","\n        ",786],["T_RETURN","return",787],["T_WHITESPACE"," ",787],["T_VARIABLE","$this",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","_api",787],";",["T_WHITESPACE","\n    ",787],"}",["T_WHITESPACE","\n\n    ",788],["T_DOC_COMMENT","\/**\n     * Attempt to collect address shipping rates and return them for further usage in instant update API\n     * Returns empty array if it was impossible to obtain any shipping rate\n     * If there are shipping rates obtained, the method must return one of them as default.\n     *\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @param bool $mayReturnEmpty\n     * @return array|false\n     *\/",790],["T_WHITESPACE","\n    ",798],["T_PROTECTED","protected",799],["T_WHITESPACE"," ",799],["T_FUNCTION","function",799],["T_WHITESPACE"," ",799],["T_STRING","_prepareShippingOptions",799],"(",["T_WHITESPACE","\n        ",799],["T_STRING","Mage_Sales_Model_Quote_Address",800],["T_WHITESPACE"," ",800],["T_VARIABLE","$address",800],",",["T_WHITESPACE","\n        ",800],["T_VARIABLE","$mayReturnEmpty",801],["T_WHITESPACE"," ",801],"=",["T_WHITESPACE"," ",801],["T_STRING","false",801],",",["T_WHITESPACE"," ",801],["T_VARIABLE","$calculateTax",801],["T_WHITESPACE"," ",801],"=",["T_WHITESPACE"," ",801],["T_STRING","false",801],["T_WHITESPACE","\n    ",801],")",["T_WHITESPACE"," ",802],"{",["T_WHITESPACE","\n        ",802],["T_VARIABLE","$options",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_ARRAY","array",803],"(",")",";",["T_WHITESPACE"," ",803],["T_VARIABLE","$i",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_LNUMBER","0",803],";",["T_WHITESPACE"," ",803],["T_VARIABLE","$iMin",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_STRING","false",803],";",["T_WHITESPACE"," ",803],["T_VARIABLE","$min",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_STRING","false",803],";",["T_WHITESPACE","\n        ",803],["T_VARIABLE","$userSelectedOption",804],["T_WHITESPACE"," ",804],"=",["T_WHITESPACE"," ",804],["T_STRING","null",804],";",["T_WHITESPACE","\n\n        ",804],["T_FOREACH","foreach",806],["T_WHITESPACE"," ",806],"(",["T_VARIABLE","$address",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getGroupedAllShippingRates",806],"(",")",["T_WHITESPACE"," ",806],["T_AS","as",806],["T_WHITESPACE"," ",806],["T_VARIABLE","$group",806],")",["T_WHITESPACE"," ",806],"{",["T_WHITESPACE","\n            ",806],["T_FOREACH","foreach",807],["T_WHITESPACE"," ",807],"(",["T_VARIABLE","$group",807],["T_WHITESPACE"," ",807],["T_AS","as",807],["T_WHITESPACE"," ",807],["T_VARIABLE","$rate",807],")",["T_WHITESPACE"," ",807],"{",["T_WHITESPACE","\n                ",807],["T_VARIABLE","$amount",808],["T_WHITESPACE"," ",808],"=",["T_WHITESPACE"," ",808],["T_DOUBLE_CAST","(float)",808],["T_VARIABLE","$rate",808],["T_OBJECT_OPERATOR","->",808],["T_STRING","getPrice",808],"(",")",";",["T_WHITESPACE","\n                ",808],["T_IF","if",809],["T_WHITESPACE"," ",809],"(",["T_VARIABLE","$rate",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getErrorMessage",809],"(",")",")",["T_WHITESPACE"," ",809],"{",["T_WHITESPACE","\n                    ",809],["T_CONTINUE","continue",810],";",["T_WHITESPACE","\n                ",810],"}",["T_WHITESPACE","\n                ",811],["T_VARIABLE","$isDefault",812],["T_WHITESPACE"," ",812],"=",["T_WHITESPACE"," ",812],["T_VARIABLE","$address",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","getShippingMethod",812],"(",")",["T_WHITESPACE"," ",812],["T_IS_IDENTICAL","===",812],["T_WHITESPACE"," ",812],["T_VARIABLE","$rate",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","getCode",812],"(",")",";",["T_WHITESPACE","\n                ",812],["T_VARIABLE","$amountExclTax",813],["T_WHITESPACE"," ",813],"=",["T_WHITESPACE"," ",813],["T_STRING","Mage",813],["T_DOUBLE_COLON","::",813],["T_STRING","helper",813],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",813],")",["T_OBJECT_OPERATOR","->",813],["T_STRING","getShippingPrice",813],"(",["T_VARIABLE","$amount",813],",",["T_WHITESPACE"," ",813],["T_STRING","false",813],",",["T_WHITESPACE"," ",813],["T_VARIABLE","$address",813],")",";",["T_WHITESPACE","\n                ",813],["T_VARIABLE","$amountInclTax",814],["T_WHITESPACE"," ",814],"=",["T_WHITESPACE"," ",814],["T_STRING","Mage",814],["T_DOUBLE_COLON","::",814],["T_STRING","helper",814],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",814],")",["T_OBJECT_OPERATOR","->",814],["T_STRING","getShippingPrice",814],"(",["T_VARIABLE","$amount",814],",",["T_WHITESPACE"," ",814],["T_STRING","true",814],",",["T_WHITESPACE"," ",814],["T_VARIABLE","$address",814],")",";",["T_WHITESPACE","\n\n                ",814],["T_VARIABLE","$options",816],"[",["T_VARIABLE","$i",816],"]",["T_WHITESPACE"," ",816],"=",["T_WHITESPACE"," ",816],["T_NEW","new",816],["T_WHITESPACE"," ",816],["T_STRING","Varien_Object",816],"(",["T_ARRAY","array",816],"(",["T_WHITESPACE","\n                    ",816],["T_CONSTANT_ENCAPSED_STRING","'is_default'",817],["T_WHITESPACE"," ",817],["T_DOUBLE_ARROW","=>",817],["T_WHITESPACE"," ",817],["T_VARIABLE","$isDefault",817],",",["T_WHITESPACE","\n                    ",817],["T_CONSTANT_ENCAPSED_STRING","'name'",818],["T_WHITESPACE","       ",818],["T_DOUBLE_ARROW","=>",818],["T_WHITESPACE"," ",818],["T_STRING","trim",818],"(","\"",["T_CURLY_OPEN","{",818],["T_VARIABLE","$rate",818],["T_OBJECT_OPERATOR","->",818],["T_STRING","getCarrier",818],"(",")","}",["T_ENCAPSED_AND_WHITESPACE"," - ",818],["T_CURLY_OPEN","{",818],["T_VARIABLE","$rate",818],["T_OBJECT_OPERATOR","->",818],["T_STRING","getMethodTitle",818],"(",")","}","\"",",",["T_WHITESPACE"," ",818],["T_CONSTANT_ENCAPSED_STRING","' -'",818],")",",",["T_WHITESPACE","\n                    ",818],["T_CONSTANT_ENCAPSED_STRING","'code'",819],["T_WHITESPACE","       ",819],["T_DOUBLE_ARROW","=>",819],["T_WHITESPACE"," ",819],["T_VARIABLE","$rate",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","getCode",819],"(",")",",",["T_WHITESPACE","\n                    ",819],["T_CONSTANT_ENCAPSED_STRING","'amount'",820],["T_WHITESPACE","     ",820],["T_DOUBLE_ARROW","=>",820],["T_WHITESPACE"," ",820],["T_VARIABLE","$amountExclTax",820],",",["T_WHITESPACE","\n                ",820],")",")",";",["T_WHITESPACE","\n                ",821],["T_IF","if",822],["T_WHITESPACE"," ",822],"(",["T_VARIABLE","$calculateTax",822],")",["T_WHITESPACE"," ",822],"{",["T_WHITESPACE","\n                    ",822],["T_VARIABLE","$options",823],"[",["T_VARIABLE","$i",823],"]",["T_OBJECT_OPERATOR","->",823],["T_STRING","setTaxAmount",823],"(",["T_WHITESPACE","\n                        ",823],["T_VARIABLE","$amountInclTax",824],["T_WHITESPACE"," ",824],"-",["T_WHITESPACE"," ",824],["T_VARIABLE","$amountExclTax",824],["T_WHITESPACE","\n                            ",824],"+",["T_WHITESPACE"," ",825],["T_VARIABLE","$address",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","getTaxAmount",825],"(",")",["T_WHITESPACE"," ",825],"-",["T_WHITESPACE"," ",825],["T_VARIABLE","$address",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","getShippingTaxAmount",825],"(",")",["T_WHITESPACE","\n                    ",825],")",";",["T_WHITESPACE","\n                ",826],"}",["T_WHITESPACE","\n                ",827],["T_IF","if",828],["T_WHITESPACE"," ",828],"(",["T_VARIABLE","$isDefault",828],")",["T_WHITESPACE"," ",828],"{",["T_WHITESPACE","\n                    ",828],["T_VARIABLE","$userSelectedOption",829],["T_WHITESPACE"," ",829],"=",["T_WHITESPACE"," ",829],["T_VARIABLE","$options",829],"[",["T_VARIABLE","$i",829],"]",";",["T_WHITESPACE","\n                ",829],"}",["T_WHITESPACE","\n                ",830],["T_IF","if",831],["T_WHITESPACE"," ",831],"(",["T_STRING","false",831],["T_WHITESPACE"," ",831],["T_IS_IDENTICAL","===",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$min",831],["T_WHITESPACE"," ",831],["T_BOOLEAN_OR","||",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$amountInclTax",831],["T_WHITESPACE"," ",831],"<",["T_WHITESPACE"," ",831],["T_VARIABLE","$min",831],")",["T_WHITESPACE"," ",831],"{",["T_WHITESPACE","\n                    ",831],["T_VARIABLE","$min",832],["T_WHITESPACE"," ",832],"=",["T_WHITESPACE"," ",832],["T_VARIABLE","$amountInclTax",832],";",["T_WHITESPACE","\n                    ",832],["T_VARIABLE","$iMin",833],["T_WHITESPACE"," ",833],"=",["T_WHITESPACE"," ",833],["T_VARIABLE","$i",833],";",["T_WHITESPACE","\n                ",833],"}",["T_WHITESPACE","\n                ",834],["T_VARIABLE","$i",835],["T_INC","++",835],";",["T_WHITESPACE","\n            ",835],"}",["T_WHITESPACE","\n        ",836],"}",["T_WHITESPACE","\n\n        ",837],["T_IF","if",839],["T_WHITESPACE"," ",839],"(",["T_VARIABLE","$mayReturnEmpty",839],["T_WHITESPACE"," ",839],["T_BOOLEAN_AND","&&",839],["T_WHITESPACE"," ",839],["T_STRING","is_null",839],"(",["T_VARIABLE","$userSelectedOption",839],")",")",["T_WHITESPACE"," ",839],"{",["T_WHITESPACE","\n            ",839],["T_VARIABLE","$options",840],"[","]",["T_WHITESPACE"," ",840],"=",["T_WHITESPACE"," ",840],["T_NEW","new",840],["T_WHITESPACE"," ",840],["T_STRING","Varien_Object",840],"(",["T_ARRAY","array",840],"(",["T_WHITESPACE","\n                ",840],["T_CONSTANT_ENCAPSED_STRING","'is_default'",841],["T_WHITESPACE"," ",841],["T_DOUBLE_ARROW","=>",841],["T_WHITESPACE"," ",841],["T_STRING","true",841],",",["T_WHITESPACE","\n                ",841],["T_CONSTANT_ENCAPSED_STRING","'name'",842],["T_WHITESPACE","       ",842],["T_DOUBLE_ARROW","=>",842],["T_WHITESPACE"," ",842],["T_STRING","Mage",842],["T_DOUBLE_COLON","::",842],["T_STRING","helper",842],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",842],")",["T_OBJECT_OPERATOR","->",842],["T_STRING","__",842],"(",["T_CONSTANT_ENCAPSED_STRING","'N\/A'",842],")",",",["T_WHITESPACE","\n                ",842],["T_CONSTANT_ENCAPSED_STRING","'code'",843],["T_WHITESPACE","       ",843],["T_DOUBLE_ARROW","=>",843],["T_WHITESPACE"," ",843],["T_CONSTANT_ENCAPSED_STRING","'no_rate'",843],",",["T_WHITESPACE","\n                ",843],["T_CONSTANT_ENCAPSED_STRING","'amount'",844],["T_WHITESPACE","     ",844],["T_DOUBLE_ARROW","=>",844],["T_WHITESPACE"," ",844],["T_DNUMBER","0.00",844],",",["T_WHITESPACE","\n            ",844],")",")",";",["T_WHITESPACE","\n            ",845],["T_IF","if",846],["T_WHITESPACE"," ",846],"(",["T_VARIABLE","$calculateTax",846],")",["T_WHITESPACE"," ",846],"{",["T_WHITESPACE","\n                ",846],["T_VARIABLE","$options",847],"[",["T_VARIABLE","$i",847],"]",["T_OBJECT_OPERATOR","->",847],["T_STRING","setTaxAmount",847],"(",["T_VARIABLE","$address",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","getTaxAmount",847],"(",")",")",";",["T_WHITESPACE","\n            ",847],"}",["T_WHITESPACE","\n        ",848],"}",["T_WHITESPACE"," ",849],["T_ELSEIF","elseif",849],["T_WHITESPACE"," ",849],"(",["T_STRING","is_null",849],"(",["T_VARIABLE","$userSelectedOption",849],")",["T_WHITESPACE"," ",849],["T_BOOLEAN_AND","&&",849],["T_WHITESPACE"," ",849],["T_ISSET","isset",849],"(",["T_VARIABLE","$options",849],"[",["T_VARIABLE","$iMin",849],"]",")",")",["T_WHITESPACE"," ",849],"{",["T_WHITESPACE","\n            ",849],["T_VARIABLE","$options",850],"[",["T_VARIABLE","$iMin",850],"]",["T_OBJECT_OPERATOR","->",850],["T_STRING","setIsDefault",850],"(",["T_STRING","true",850],")",";",["T_WHITESPACE","\n        ",850],"}",["T_WHITESPACE","\n\n        ",851],["T_COMMENT","\/\/ Magento will transfer only first 10 cheapest shipping options if there are more than 10 available.\n",853],["T_WHITESPACE","        ",854],["T_IF","if",854],["T_WHITESPACE"," ",854],"(",["T_STRING","count",854],"(",["T_VARIABLE","$options",854],")",["T_WHITESPACE"," ",854],">",["T_WHITESPACE"," ",854],["T_LNUMBER","10",854],")",["T_WHITESPACE"," ",854],"{",["T_WHITESPACE","\n            ",854],["T_STRING","usort",855],"(",["T_VARIABLE","$options",855],",",["T_WHITESPACE"," ",855],["T_ARRAY","array",855],"(",["T_STRING","get_class",855],"(",["T_VARIABLE","$this",855],")",",",["T_CONSTANT_ENCAPSED_STRING","'cmpShippingOptions'",855],")",")",";",["T_WHITESPACE","\n            ",855],["T_STRING","array_splice",856],"(",["T_VARIABLE","$options",856],",",["T_WHITESPACE"," ",856],["T_LNUMBER","10",856],")",";",["T_WHITESPACE","\n            ",856],["T_COMMENT","\/\/ User selected option will be always included in options list\n",857],["T_WHITESPACE","            ",858],["T_IF","if",858],["T_WHITESPACE"," ",858],"(","!",["T_STRING","is_null",858],"(",["T_VARIABLE","$userSelectedOption",858],")",["T_WHITESPACE"," ",858],["T_BOOLEAN_AND","&&",858],["T_WHITESPACE"," ",858],"!",["T_STRING","in_array",858],"(",["T_VARIABLE","$userSelectedOption",858],",",["T_WHITESPACE"," ",858],["T_VARIABLE","$options",858],")",")",["T_WHITESPACE"," ",858],"{",["T_WHITESPACE","\n                ",858],["T_VARIABLE","$options",859],"[",["T_LNUMBER","9",859],"]",["T_WHITESPACE"," ",859],"=",["T_WHITESPACE"," ",859],["T_VARIABLE","$userSelectedOption",859],";",["T_WHITESPACE","\n            ",859],"}",["T_WHITESPACE","\n        ",860],"}",["T_WHITESPACE","\n\n        ",861],["T_RETURN","return",863],["T_WHITESPACE"," ",863],["T_VARIABLE","$options",863],";",["T_WHITESPACE","\n    ",863],"}",["T_WHITESPACE","\n\n    ",864],["T_DOC_COMMENT","\/**\n     * Compare two shipping options based on their amounts\n     *\n     * This function is used as a callback comparison function in shipping options sorting process\n     * @see self::_prepareShippingOptions()\n     *\n     * @param Varien_Object $option1\n     * @param Varien_Object $option2\n     * @return integer\n     *\/",866],["T_WHITESPACE","\n    ",875],["T_PROTECTED","protected",876],["T_WHITESPACE"," ",876],["T_STATIC","static",876],["T_WHITESPACE"," ",876],["T_FUNCTION","function",876],["T_WHITESPACE"," ",876],["T_STRING","cmpShippingOptions",876],"(",["T_STRING","Varien_Object",876],["T_WHITESPACE"," ",876],["T_VARIABLE","$option1",876],",",["T_WHITESPACE"," ",876],["T_STRING","Varien_Object",876],["T_WHITESPACE"," ",876],["T_VARIABLE","$option2",876],")",["T_WHITESPACE","\n    ",876],"{",["T_WHITESPACE","\n        ",877],["T_IF","if",878],["T_WHITESPACE"," ",878],"(",["T_VARIABLE","$option1",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","getAmount",878],"(",")",["T_WHITESPACE"," ",878],["T_IS_EQUAL","==",878],["T_WHITESPACE"," ",878],["T_VARIABLE","$option2",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","getAmount",878],"(",")",")",["T_WHITESPACE"," ",878],"{",["T_WHITESPACE","\n            ",878],["T_RETURN","return",879],["T_WHITESPACE"," ",879],["T_LNUMBER","0",879],";",["T_WHITESPACE","\n        ",879],"}",["T_WHITESPACE","\n        ",880],["T_RETURN","return",881],["T_WHITESPACE"," ",881],"(",["T_VARIABLE","$option1",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","getAmount",881],"(",")",["T_WHITESPACE"," ",881],"<",["T_WHITESPACE"," ",881],["T_VARIABLE","$option2",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","getAmount",881],"(",")",")",["T_WHITESPACE"," ",881],"?",["T_WHITESPACE"," ",881],"-",["T_LNUMBER","1",881],["T_WHITESPACE"," ",881],":",["T_WHITESPACE"," ",881],["T_LNUMBER","1",881],";",["T_WHITESPACE","\n    ",881],"}",["T_WHITESPACE","\n\n    ",882],["T_DOC_COMMENT","\/**\n     * Try to find whether the code provided by PayPal corresponds to any of possible shipping rates\n     * This method was created only because PayPal has issues with returning the selected code.\n     * If in future the issue is fixed, we don't need to attempt to match it. It would be enough to set the method code\n     * before collecting shipping rates\n     *\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @param string $selectedCode\n     * @return string\n     *\/",884],["T_WHITESPACE","\n    ",893],["T_PROTECTED","protected",894],["T_WHITESPACE"," ",894],["T_FUNCTION","function",894],["T_WHITESPACE"," ",894],["T_STRING","_matchShippingMethodCode",894],"(",["T_STRING","Mage_Sales_Model_Quote_Address",894],["T_WHITESPACE"," ",894],["T_VARIABLE","$address",894],",",["T_WHITESPACE"," ",894],["T_VARIABLE","$selectedCode",894],")",["T_WHITESPACE","\n    ",894],"{",["T_WHITESPACE","\n        ",895],["T_VARIABLE","$options",896],["T_WHITESPACE"," ",896],"=",["T_WHITESPACE"," ",896],["T_VARIABLE","$this",896],["T_OBJECT_OPERATOR","->",896],["T_STRING","_prepareShippingOptions",896],"(",["T_VARIABLE","$address",896],",",["T_WHITESPACE"," ",896],["T_STRING","false",896],")",";",["T_WHITESPACE","\n        ",896],["T_FOREACH","foreach",897],["T_WHITESPACE"," ",897],"(",["T_VARIABLE","$options",897],["T_WHITESPACE"," ",897],["T_AS","as",897],["T_WHITESPACE"," ",897],["T_VARIABLE","$option",897],")",["T_WHITESPACE"," ",897],"{",["T_WHITESPACE","\n            ",897],["T_IF","if",898],["T_WHITESPACE"," ",898],"(",["T_VARIABLE","$selectedCode",898],["T_WHITESPACE"," ",898],["T_IS_IDENTICAL","===",898],["T_WHITESPACE"," ",898],["T_VARIABLE","$option",898],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",898],"]",["T_WHITESPACE"," ",898],["T_COMMENT","\/\/ the proper case as outlined in documentation\n",898],["T_WHITESPACE","                ",899],["T_BOOLEAN_OR","||",899],["T_WHITESPACE"," ",899],["T_VARIABLE","$selectedCode",899],["T_WHITESPACE"," ",899],["T_IS_IDENTICAL","===",899],["T_WHITESPACE"," ",899],["T_VARIABLE","$option",899],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",899],"]",["T_WHITESPACE"," ",899],["T_COMMENT","\/\/ workaround: PayPal may return name instead of the code\n",899],["T_WHITESPACE","                ",900],["T_COMMENT","\/\/ workaround: PayPal may concatenate code and name, and return it instead of the code:\n",900],["T_WHITESPACE","                ",901],["T_BOOLEAN_OR","||",901],["T_WHITESPACE"," ",901],["T_VARIABLE","$selectedCode",901],["T_WHITESPACE"," ",901],["T_IS_IDENTICAL","===",901],["T_WHITESPACE"," ",901],"\"",["T_CURLY_OPEN","{",901],["T_VARIABLE","$option",901],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",901],"]","}",["T_ENCAPSED_AND_WHITESPACE"," ",901],["T_CURLY_OPEN","{",901],["T_VARIABLE","$option",901],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",901],"]","}","\"",["T_WHITESPACE","\n            ",901],")",["T_WHITESPACE"," ",902],"{",["T_WHITESPACE","\n                ",902],["T_RETURN","return",903],["T_WHITESPACE"," ",903],["T_VARIABLE","$option",903],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",903],"]",";",["T_WHITESPACE","\n            ",903],"}",["T_WHITESPACE","\n        ",904],"}",["T_WHITESPACE","\n        ",905],["T_RETURN","return",906],["T_WHITESPACE"," ",906],["T_CONSTANT_ENCAPSED_STRING","''",906],";",["T_WHITESPACE","\n    ",906],"}",["T_WHITESPACE","\n\n    ",907],["T_DOC_COMMENT","\/**\n     * Prepare quote for guest checkout order submit\n     *\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",909],["T_WHITESPACE","\n    ",913],["T_PROTECTED","protected",914],["T_WHITESPACE"," ",914],["T_FUNCTION","function",914],["T_WHITESPACE"," ",914],["T_STRING","_prepareGuestQuote",914],"(",")",["T_WHITESPACE","\n    ",914],"{",["T_WHITESPACE","\n        ",915],["T_VARIABLE","$quote",916],["T_WHITESPACE"," ",916],"=",["T_WHITESPACE"," ",916],["T_VARIABLE","$this",916],["T_OBJECT_OPERATOR","->",916],["T_STRING","_quote",916],";",["T_WHITESPACE","\n        ",916],["T_VARIABLE","$quote",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","setCustomerId",917],"(",["T_STRING","null",917],")",["T_WHITESPACE","\n            ",917],["T_OBJECT_OPERATOR","->",918],["T_STRING","setCustomerEmail",918],"(",["T_VARIABLE","$quote",918],["T_OBJECT_OPERATOR","->",918],["T_STRING","getBillingAddress",918],"(",")",["T_OBJECT_OPERATOR","->",918],["T_STRING","getEmail",918],"(",")",")",["T_WHITESPACE","\n            ",918],["T_OBJECT_OPERATOR","->",919],["T_STRING","setCustomerIsGuest",919],"(",["T_STRING","true",919],")",["T_WHITESPACE","\n            ",919],["T_OBJECT_OPERATOR","->",920],["T_STRING","setCustomerGroupId",920],"(",["T_STRING","Mage_Customer_Model_Group",920],["T_DOUBLE_COLON","::",920],["T_STRING","NOT_LOGGED_IN_ID",920],")",";",["T_WHITESPACE","\n        ",920],["T_RETURN","return",921],["T_WHITESPACE"," ",921],["T_VARIABLE","$this",921],";",["T_WHITESPACE","\n    ",921],"}",["T_WHITESPACE","\n\n    ",922],["T_DOC_COMMENT","\/**\n     * Checks if customer with email coming from Express checkout exists\n     *\n     * @return int\n     *\/",924],["T_WHITESPACE","\n    ",928],["T_PROTECTED","protected",929],["T_WHITESPACE"," ",929],["T_FUNCTION","function",929],["T_WHITESPACE"," ",929],["T_STRING","_lookupCustomerId",929],"(",")",["T_WHITESPACE","\n    ",929],"{",["T_WHITESPACE","\n        ",930],["T_RETURN","return",931],["T_WHITESPACE"," ",931],["T_STRING","Mage",931],["T_DOUBLE_COLON","::",931],["T_STRING","getModel",931],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",931],")",["T_WHITESPACE","\n            ",931],["T_OBJECT_OPERATOR","->",932],["T_STRING","setWebsiteId",932],"(",["T_STRING","Mage",932],["T_DOUBLE_COLON","::",932],["T_STRING","app",932],"(",")",["T_OBJECT_OPERATOR","->",932],["T_STRING","getWebsite",932],"(",")",["T_OBJECT_OPERATOR","->",932],["T_STRING","getId",932],"(",")",")",["T_WHITESPACE","\n            ",932],["T_OBJECT_OPERATOR","->",933],["T_STRING","loadByEmail",933],"(",["T_VARIABLE","$this",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","_quote",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","getCustomerEmail",933],"(",")",")",["T_WHITESPACE","\n            ",933],["T_OBJECT_OPERATOR","->",934],["T_STRING","getId",934],"(",")",";",["T_WHITESPACE","\n    ",934],"}",["T_WHITESPACE","\n\n    ",935],["T_DOC_COMMENT","\/**\n     * Prepare quote for customer registration and customer order submit\n     * and restore magento customer data from quote\n     *\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",937],["T_WHITESPACE","\n    ",942],["T_PROTECTED","protected",943],["T_WHITESPACE"," ",943],["T_FUNCTION","function",943],["T_WHITESPACE"," ",943],["T_STRING","_prepareNewCustomerQuote",943],"(",")",["T_WHITESPACE","\n    ",943],"{",["T_WHITESPACE","\n        ",944],["T_VARIABLE","$quote",945],["T_WHITESPACE","      ",945],"=",["T_WHITESPACE"," ",945],["T_VARIABLE","$this",945],["T_OBJECT_OPERATOR","->",945],["T_STRING","_quote",945],";",["T_WHITESPACE","\n        ",945],["T_VARIABLE","$billing",946],["T_WHITESPACE","    ",946],"=",["T_WHITESPACE"," ",946],["T_VARIABLE","$quote",946],["T_OBJECT_OPERATOR","->",946],["T_STRING","getBillingAddress",946],"(",")",";",["T_WHITESPACE","\n        ",946],["T_VARIABLE","$shipping",947],["T_WHITESPACE","   ",947],"=",["T_WHITESPACE"," ",947],["T_VARIABLE","$quote",947],["T_OBJECT_OPERATOR","->",947],["T_STRING","isVirtual",947],"(",")",["T_WHITESPACE"," ",947],"?",["T_WHITESPACE"," ",947],["T_STRING","null",947],["T_WHITESPACE"," ",947],":",["T_WHITESPACE"," ",947],["T_VARIABLE","$quote",947],["T_OBJECT_OPERATOR","->",947],["T_STRING","getShippingAddress",947],"(",")",";",["T_WHITESPACE","\n\n        ",947],["T_VARIABLE","$customerId",949],["T_WHITESPACE"," ",949],"=",["T_WHITESPACE"," ",949],["T_VARIABLE","$this",949],["T_OBJECT_OPERATOR","->",949],["T_STRING","_lookupCustomerId",949],"(",")",";",["T_WHITESPACE","\n        ",949],["T_IF","if",950],["T_WHITESPACE"," ",950],"(",["T_VARIABLE","$customerId",950],["T_WHITESPACE"," ",950],["T_BOOLEAN_AND","&&",950],["T_WHITESPACE"," ",950],"!",["T_VARIABLE","$this",950],["T_OBJECT_OPERATOR","->",950],["T_STRING","_customerEmailExists",950],"(",["T_VARIABLE","$quote",950],["T_OBJECT_OPERATOR","->",950],["T_STRING","getCustomerEmail",950],"(",")",")",")",["T_WHITESPACE"," ",950],"{",["T_WHITESPACE","\n            ",950],["T_VARIABLE","$this",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","getCustomerSession",951],"(",")",["T_OBJECT_OPERATOR","->",951],["T_STRING","loginById",951],"(",["T_VARIABLE","$customerId",951],")",";",["T_WHITESPACE","\n            ",951],["T_RETURN","return",952],["T_WHITESPACE"," ",952],["T_VARIABLE","$this",952],["T_OBJECT_OPERATOR","->",952],["T_STRING","_prepareCustomerQuote",952],"(",")",";",["T_WHITESPACE","\n        ",952],"}",["T_WHITESPACE","\n\n        ",953],["T_VARIABLE","$customer",955],["T_WHITESPACE"," ",955],"=",["T_WHITESPACE"," ",955],["T_VARIABLE","$quote",955],["T_OBJECT_OPERATOR","->",955],["T_STRING","getCustomer",955],"(",")",";",["T_WHITESPACE","\n        ",955],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",956],["T_WHITESPACE","\n        ",956],["T_VARIABLE","$customerBilling",957],["T_WHITESPACE"," ",957],"=",["T_WHITESPACE"," ",957],["T_VARIABLE","$billing",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","exportCustomerAddress",957],"(",")",";",["T_WHITESPACE","\n        ",957],["T_VARIABLE","$customer",958],["T_OBJECT_OPERATOR","->",958],["T_STRING","addAddress",958],"(",["T_VARIABLE","$customerBilling",958],")",";",["T_WHITESPACE","\n        ",958],["T_VARIABLE","$billing",959],["T_OBJECT_OPERATOR","->",959],["T_STRING","setCustomerAddress",959],"(",["T_VARIABLE","$customerBilling",959],")",";",["T_WHITESPACE","\n        ",959],["T_VARIABLE","$customerBilling",960],["T_OBJECT_OPERATOR","->",960],["T_STRING","setIsDefaultBilling",960],"(",["T_STRING","true",960],")",";",["T_WHITESPACE","\n        ",960],["T_IF","if",961],["T_WHITESPACE"," ",961],"(",["T_VARIABLE","$shipping",961],["T_WHITESPACE"," ",961],["T_BOOLEAN_AND","&&",961],["T_WHITESPACE"," ",961],"!",["T_VARIABLE","$shipping",961],["T_OBJECT_OPERATOR","->",961],["T_STRING","getSameAsBilling",961],"(",")",")",["T_WHITESPACE"," ",961],"{",["T_WHITESPACE","\n            ",961],["T_VARIABLE","$customerShipping",962],["T_WHITESPACE"," ",962],"=",["T_WHITESPACE"," ",962],["T_VARIABLE","$shipping",962],["T_OBJECT_OPERATOR","->",962],["T_STRING","exportCustomerAddress",962],"(",")",";",["T_WHITESPACE","\n            ",962],["T_VARIABLE","$customer",963],["T_OBJECT_OPERATOR","->",963],["T_STRING","addAddress",963],"(",["T_VARIABLE","$customerShipping",963],")",";",["T_WHITESPACE","\n            ",963],["T_VARIABLE","$shipping",964],["T_OBJECT_OPERATOR","->",964],["T_STRING","setCustomerAddress",964],"(",["T_VARIABLE","$customerShipping",964],")",";",["T_WHITESPACE","\n            ",964],["T_VARIABLE","$customerShipping",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","setIsDefaultShipping",965],"(",["T_STRING","true",965],")",";",["T_WHITESPACE","\n        ",965],"}",["T_WHITESPACE"," ",966],["T_ELSEIF","elseif",966],["T_WHITESPACE"," ",966],"(",["T_VARIABLE","$shipping",966],")",["T_WHITESPACE"," ",966],"{",["T_WHITESPACE","\n            ",966],["T_VARIABLE","$customerBilling",967],["T_OBJECT_OPERATOR","->",967],["T_STRING","setIsDefaultShipping",967],"(",["T_STRING","true",967],")",";",["T_WHITESPACE","\n        ",967],"}",["T_WHITESPACE","\n        ",968],["T_DOC_COMMENT","\/**\n         * @todo integration with dynamica attributes customer_dob, customer_taxvat, customer_gender\n         *\/",969],["T_WHITESPACE","\n        ",971],["T_IF","if",972],["T_WHITESPACE"," ",972],"(",["T_VARIABLE","$quote",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","getCustomerDob",972],"(",")",["T_WHITESPACE"," ",972],["T_BOOLEAN_AND","&&",972],["T_WHITESPACE"," ",972],"!",["T_VARIABLE","$billing",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","getCustomerDob",972],"(",")",")",["T_WHITESPACE"," ",972],"{",["T_WHITESPACE","\n            ",972],["T_VARIABLE","$billing",973],["T_OBJECT_OPERATOR","->",973],["T_STRING","setCustomerDob",973],"(",["T_VARIABLE","$quote",973],["T_OBJECT_OPERATOR","->",973],["T_STRING","getCustomerDob",973],"(",")",")",";",["T_WHITESPACE","\n        ",973],"}",["T_WHITESPACE","\n\n        ",974],["T_IF","if",976],["T_WHITESPACE"," ",976],"(",["T_VARIABLE","$quote",976],["T_OBJECT_OPERATOR","->",976],["T_STRING","getCustomerTaxvat",976],"(",")",["T_WHITESPACE"," ",976],["T_BOOLEAN_AND","&&",976],["T_WHITESPACE"," ",976],"!",["T_VARIABLE","$billing",976],["T_OBJECT_OPERATOR","->",976],["T_STRING","getCustomerTaxvat",976],"(",")",")",["T_WHITESPACE"," ",976],"{",["T_WHITESPACE","\n            ",976],["T_VARIABLE","$billing",977],["T_OBJECT_OPERATOR","->",977],["T_STRING","setCustomerTaxvat",977],"(",["T_VARIABLE","$quote",977],["T_OBJECT_OPERATOR","->",977],["T_STRING","getCustomerTaxvat",977],"(",")",")",";",["T_WHITESPACE","\n        ",977],"}",["T_WHITESPACE","\n\n        ",978],["T_IF","if",980],["T_WHITESPACE"," ",980],"(",["T_VARIABLE","$quote",980],["T_OBJECT_OPERATOR","->",980],["T_STRING","getCustomerGender",980],"(",")",["T_WHITESPACE"," ",980],["T_BOOLEAN_AND","&&",980],["T_WHITESPACE"," ",980],"!",["T_VARIABLE","$billing",980],["T_OBJECT_OPERATOR","->",980],["T_STRING","getCustomerGender",980],"(",")",")",["T_WHITESPACE"," ",980],"{",["T_WHITESPACE","\n            ",980],["T_VARIABLE","$billing",981],["T_OBJECT_OPERATOR","->",981],["T_STRING","setCustomerGender",981],"(",["T_VARIABLE","$quote",981],["T_OBJECT_OPERATOR","->",981],["T_STRING","getCustomerGender",981],"(",")",")",";",["T_WHITESPACE","\n        ",981],"}",["T_WHITESPACE","\n\n        ",982],["T_STRING","Mage",984],["T_DOUBLE_COLON","::",984],["T_STRING","helper",984],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",984],")",["T_OBJECT_OPERATOR","->",984],["T_STRING","copyFieldset",984],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_billing'",984],",",["T_WHITESPACE"," ",984],["T_CONSTANT_ENCAPSED_STRING","'to_customer'",984],",",["T_WHITESPACE"," ",984],["T_VARIABLE","$billing",984],",",["T_WHITESPACE"," ",984],["T_VARIABLE","$customer",984],")",";",["T_WHITESPACE","\n        ",984],["T_VARIABLE","$customer",985],["T_OBJECT_OPERATOR","->",985],["T_STRING","setEmail",985],"(",["T_VARIABLE","$quote",985],["T_OBJECT_OPERATOR","->",985],["T_STRING","getCustomerEmail",985],"(",")",")",";",["T_WHITESPACE","\n        ",985],["T_VARIABLE","$customer",986],["T_OBJECT_OPERATOR","->",986],["T_STRING","setPrefix",986],"(",["T_VARIABLE","$quote",986],["T_OBJECT_OPERATOR","->",986],["T_STRING","getCustomerPrefix",986],"(",")",")",";",["T_WHITESPACE","\n        ",986],["T_VARIABLE","$customer",987],["T_OBJECT_OPERATOR","->",987],["T_STRING","setFirstname",987],"(",["T_VARIABLE","$quote",987],["T_OBJECT_OPERATOR","->",987],["T_STRING","getCustomerFirstname",987],"(",")",")",";",["T_WHITESPACE","\n        ",987],["T_VARIABLE","$customer",988],["T_OBJECT_OPERATOR","->",988],["T_STRING","setMiddlename",988],"(",["T_VARIABLE","$quote",988],["T_OBJECT_OPERATOR","->",988],["T_STRING","getCustomerMiddlename",988],"(",")",")",";",["T_WHITESPACE","\n        ",988],["T_VARIABLE","$customer",989],["T_OBJECT_OPERATOR","->",989],["T_STRING","setLastname",989],"(",["T_VARIABLE","$quote",989],["T_OBJECT_OPERATOR","->",989],["T_STRING","getCustomerLastname",989],"(",")",")",";",["T_WHITESPACE","\n        ",989],["T_VARIABLE","$customer",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","setSuffix",990],"(",["T_VARIABLE","$quote",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","getCustomerSuffix",990],"(",")",")",";",["T_WHITESPACE","\n        ",990],["T_VARIABLE","$customer",991],["T_OBJECT_OPERATOR","->",991],["T_STRING","setPassword",991],"(",["T_VARIABLE","$customer",991],["T_OBJECT_OPERATOR","->",991],["T_STRING","decryptPassword",991],"(",["T_VARIABLE","$quote",991],["T_OBJECT_OPERATOR","->",991],["T_STRING","getPasswordHash",991],"(",")",")",")",";",["T_WHITESPACE","\n        ",991],["T_VARIABLE","$customer",992],["T_OBJECT_OPERATOR","->",992],["T_STRING","setPasswordHash",992],"(",["T_VARIABLE","$customer",992],["T_OBJECT_OPERATOR","->",992],["T_STRING","hashPassword",992],"(",["T_VARIABLE","$customer",992],["T_OBJECT_OPERATOR","->",992],["T_STRING","getPassword",992],"(",")",")",")",";",["T_WHITESPACE","\n        ",992],["T_VARIABLE","$customer",993],["T_OBJECT_OPERATOR","->",993],["T_STRING","save",993],"(",")",";",["T_WHITESPACE","\n        ",993],["T_VARIABLE","$quote",994],["T_OBJECT_OPERATOR","->",994],["T_STRING","setCustomer",994],"(",["T_VARIABLE","$customer",994],")",";",["T_WHITESPACE","\n\n        ",994],["T_RETURN","return",996],["T_WHITESPACE"," ",996],["T_VARIABLE","$this",996],";",["T_WHITESPACE","\n    ",996],"}",["T_WHITESPACE","\n\n    ",997],["T_DOC_COMMENT","\/**\n     * Prepare quote for customer order submit\n     *\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",999],["T_WHITESPACE","\n    ",1003],["T_PROTECTED","protected",1004],["T_WHITESPACE"," ",1004],["T_FUNCTION","function",1004],["T_WHITESPACE"," ",1004],["T_STRING","_prepareCustomerQuote",1004],"(",")",["T_WHITESPACE","\n    ",1004],"{",["T_WHITESPACE","\n        ",1005],["T_VARIABLE","$quote",1006],["T_WHITESPACE","      ",1006],"=",["T_WHITESPACE"," ",1006],["T_VARIABLE","$this",1006],["T_OBJECT_OPERATOR","->",1006],["T_STRING","_quote",1006],";",["T_WHITESPACE","\n        ",1006],["T_VARIABLE","$billing",1007],["T_WHITESPACE","    ",1007],"=",["T_WHITESPACE"," ",1007],["T_VARIABLE","$quote",1007],["T_OBJECT_OPERATOR","->",1007],["T_STRING","getBillingAddress",1007],"(",")",";",["T_WHITESPACE","\n        ",1007],["T_VARIABLE","$shipping",1008],["T_WHITESPACE","   ",1008],"=",["T_WHITESPACE"," ",1008],["T_VARIABLE","$quote",1008],["T_OBJECT_OPERATOR","->",1008],["T_STRING","isVirtual",1008],"(",")",["T_WHITESPACE"," ",1008],"?",["T_WHITESPACE"," ",1008],["T_STRING","null",1008],["T_WHITESPACE"," ",1008],":",["T_WHITESPACE"," ",1008],["T_VARIABLE","$quote",1008],["T_OBJECT_OPERATOR","->",1008],["T_STRING","getShippingAddress",1008],"(",")",";",["T_WHITESPACE","\n\n        ",1008],["T_VARIABLE","$customer",1010],["T_WHITESPACE"," ",1010],"=",["T_WHITESPACE"," ",1010],["T_VARIABLE","$this",1010],["T_OBJECT_OPERATOR","->",1010],["T_STRING","getCustomerSession",1010],"(",")",["T_OBJECT_OPERATOR","->",1010],["T_STRING","getCustomer",1010],"(",")",";",["T_WHITESPACE","\n        ",1010],["T_IF","if",1011],["T_WHITESPACE"," ",1011],"(","!",["T_VARIABLE","$billing",1011],["T_OBJECT_OPERATOR","->",1011],["T_STRING","getCustomerId",1011],"(",")",["T_WHITESPACE"," ",1011],["T_BOOLEAN_OR","||",1011],["T_WHITESPACE"," ",1011],["T_VARIABLE","$billing",1011],["T_OBJECT_OPERATOR","->",1011],["T_STRING","getSaveInAddressBook",1011],"(",")",")",["T_WHITESPACE"," ",1011],"{",["T_WHITESPACE","\n            ",1011],["T_VARIABLE","$customerBilling",1012],["T_WHITESPACE"," ",1012],"=",["T_WHITESPACE"," ",1012],["T_VARIABLE","$billing",1012],["T_OBJECT_OPERATOR","->",1012],["T_STRING","exportCustomerAddress",1012],"(",")",";",["T_WHITESPACE","\n            ",1012],["T_VARIABLE","$customer",1013],["T_OBJECT_OPERATOR","->",1013],["T_STRING","addAddress",1013],"(",["T_VARIABLE","$customerBilling",1013],")",";",["T_WHITESPACE","\n            ",1013],["T_VARIABLE","$billing",1014],["T_OBJECT_OPERATOR","->",1014],["T_STRING","setCustomerAddress",1014],"(",["T_VARIABLE","$customerBilling",1014],")",";",["T_WHITESPACE","\n        ",1014],"}",["T_WHITESPACE","\n        ",1015],["T_IF","if",1016],["T_WHITESPACE"," ",1016],"(",["T_VARIABLE","$shipping",1016],["T_WHITESPACE"," ",1016],["T_BOOLEAN_AND","&&",1016],["T_WHITESPACE"," ",1016],"(","(","!",["T_VARIABLE","$shipping",1016],["T_OBJECT_OPERATOR","->",1016],["T_STRING","getCustomerId",1016],"(",")",["T_WHITESPACE"," ",1016],["T_BOOLEAN_AND","&&",1016],["T_WHITESPACE"," ",1016],"!",["T_VARIABLE","$shipping",1016],["T_OBJECT_OPERATOR","->",1016],["T_STRING","getSameAsBilling",1016],"(",")",")",["T_WHITESPACE","\n            ",1016],["T_BOOLEAN_OR","||",1017],["T_WHITESPACE"," ",1017],"(","!",["T_VARIABLE","$shipping",1017],["T_OBJECT_OPERATOR","->",1017],["T_STRING","getSameAsBilling",1017],"(",")",["T_WHITESPACE"," ",1017],["T_BOOLEAN_AND","&&",1017],["T_WHITESPACE"," ",1017],["T_VARIABLE","$shipping",1017],["T_OBJECT_OPERATOR","->",1017],["T_STRING","getSaveInAddressBook",1017],"(",")",")",")",")",["T_WHITESPACE"," ",1017],"{",["T_WHITESPACE","\n            ",1017],["T_VARIABLE","$customerShipping",1018],["T_WHITESPACE"," ",1018],"=",["T_WHITESPACE"," ",1018],["T_VARIABLE","$shipping",1018],["T_OBJECT_OPERATOR","->",1018],["T_STRING","exportCustomerAddress",1018],"(",")",";",["T_WHITESPACE","\n            ",1018],["T_VARIABLE","$customer",1019],["T_OBJECT_OPERATOR","->",1019],["T_STRING","addAddress",1019],"(",["T_VARIABLE","$customerShipping",1019],")",";",["T_WHITESPACE","\n            ",1019],["T_VARIABLE","$shipping",1020],["T_OBJECT_OPERATOR","->",1020],["T_STRING","setCustomerAddress",1020],"(",["T_VARIABLE","$customerShipping",1020],")",";",["T_WHITESPACE","\n        ",1020],"}",["T_WHITESPACE","\n\n        ",1021],["T_IF","if",1023],["T_WHITESPACE"," ",1023],"(",["T_ISSET","isset",1023],"(",["T_VARIABLE","$customerBilling",1023],")",["T_WHITESPACE"," ",1023],["T_BOOLEAN_AND","&&",1023],["T_WHITESPACE"," ",1023],"!",["T_VARIABLE","$customer",1023],["T_OBJECT_OPERATOR","->",1023],["T_STRING","getDefaultBilling",1023],"(",")",")",["T_WHITESPACE"," ",1023],"{",["T_WHITESPACE","\n            ",1023],["T_VARIABLE","$customerBilling",1024],["T_OBJECT_OPERATOR","->",1024],["T_STRING","setIsDefaultBilling",1024],"(",["T_STRING","true",1024],")",";",["T_WHITESPACE","\n        ",1024],"}",["T_WHITESPACE","\n        ",1025],["T_IF","if",1026],["T_WHITESPACE"," ",1026],"(",["T_VARIABLE","$shipping",1026],["T_WHITESPACE"," ",1026],["T_BOOLEAN_AND","&&",1026],["T_WHITESPACE"," ",1026],["T_ISSET","isset",1026],"(",["T_VARIABLE","$customerBilling",1026],")",["T_WHITESPACE"," ",1026],["T_BOOLEAN_AND","&&",1026],["T_WHITESPACE"," ",1026],"!",["T_VARIABLE","$customer",1026],["T_OBJECT_OPERATOR","->",1026],["T_STRING","getDefaultShipping",1026],"(",")",["T_WHITESPACE"," ",1026],["T_BOOLEAN_AND","&&",1026],["T_WHITESPACE"," ",1026],["T_VARIABLE","$shipping",1026],["T_OBJECT_OPERATOR","->",1026],["T_STRING","getSameAsBilling",1026],"(",")",")",["T_WHITESPACE"," ",1026],"{",["T_WHITESPACE","\n            ",1026],["T_VARIABLE","$customerBilling",1027],["T_OBJECT_OPERATOR","->",1027],["T_STRING","setIsDefaultShipping",1027],"(",["T_STRING","true",1027],")",";",["T_WHITESPACE","\n        ",1027],"}",["T_WHITESPACE"," ",1028],["T_ELSEIF","elseif",1028],["T_WHITESPACE"," ",1028],"(",["T_VARIABLE","$shipping",1028],["T_WHITESPACE"," ",1028],["T_BOOLEAN_AND","&&",1028],["T_WHITESPACE"," ",1028],["T_ISSET","isset",1028],"(",["T_VARIABLE","$customerShipping",1028],")",["T_WHITESPACE"," ",1028],["T_BOOLEAN_AND","&&",1028],["T_WHITESPACE"," ",1028],"!",["T_VARIABLE","$customer",1028],["T_OBJECT_OPERATOR","->",1028],["T_STRING","getDefaultShipping",1028],"(",")",")",["T_WHITESPACE"," ",1028],"{",["T_WHITESPACE","\n            ",1028],["T_VARIABLE","$customerShipping",1029],["T_OBJECT_OPERATOR","->",1029],["T_STRING","setIsDefaultShipping",1029],"(",["T_STRING","true",1029],")",";",["T_WHITESPACE","\n        ",1029],"}",["T_WHITESPACE","\n        ",1030],["T_VARIABLE","$quote",1031],["T_OBJECT_OPERATOR","->",1031],["T_STRING","setCustomer",1031],"(",["T_VARIABLE","$customer",1031],")",";",["T_WHITESPACE","\n\n        ",1031],["T_RETURN","return",1033],["T_WHITESPACE"," ",1033],["T_VARIABLE","$this",1033],";",["T_WHITESPACE","\n    ",1033],"}",["T_WHITESPACE","\n\n    ",1034],["T_DOC_COMMENT","\/**\n     * Involve new customer to system\n     *\n     * @return Mage_Paypal_Model_Express_Checkout\n     *\/",1036],["T_WHITESPACE","\n    ",1040],["T_PROTECTED","protected",1041],["T_WHITESPACE"," ",1041],["T_FUNCTION","function",1041],["T_WHITESPACE"," ",1041],["T_STRING","_involveNewCustomer",1041],"(",")",["T_WHITESPACE","\n    ",1041],"{",["T_WHITESPACE","\n        ",1042],["T_VARIABLE","$customer",1043],["T_WHITESPACE"," ",1043],"=",["T_WHITESPACE"," ",1043],["T_VARIABLE","$this",1043],["T_OBJECT_OPERATOR","->",1043],["T_STRING","_quote",1043],["T_OBJECT_OPERATOR","->",1043],["T_STRING","getCustomer",1043],"(",")",";",["T_WHITESPACE","\n        ",1043],["T_IF","if",1044],["T_WHITESPACE"," ",1044],"(",["T_VARIABLE","$customer",1044],["T_OBJECT_OPERATOR","->",1044],["T_STRING","isConfirmationRequired",1044],"(",")",")",["T_WHITESPACE"," ",1044],"{",["T_WHITESPACE","\n            ",1044],["T_VARIABLE","$customer",1045],["T_OBJECT_OPERATOR","->",1045],["T_STRING","sendNewAccountEmail",1045],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",1045],")",";",["T_WHITESPACE","\n            ",1045],["T_VARIABLE","$url",1046],["T_WHITESPACE"," ",1046],"=",["T_WHITESPACE"," ",1046],["T_STRING","Mage",1046],["T_DOUBLE_COLON","::",1046],["T_STRING","helper",1046],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",1046],")",["T_OBJECT_OPERATOR","->",1046],["T_STRING","getEmailConfirmationUrl",1046],"(",["T_VARIABLE","$customer",1046],["T_OBJECT_OPERATOR","->",1046],["T_STRING","getEmail",1046],"(",")",")",";",["T_WHITESPACE","\n            ",1046],["T_VARIABLE","$this",1047],["T_OBJECT_OPERATOR","->",1047],["T_STRING","getCustomerSession",1047],"(",")",["T_OBJECT_OPERATOR","->",1047],["T_STRING","addSuccess",1047],"(",["T_WHITESPACE","\n                ",1047],["T_STRING","Mage",1048],["T_DOUBLE_COLON","::",1048],["T_STRING","helper",1048],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",1048],")",["T_OBJECT_OPERATOR","->",1048],["T_STRING","__",1048],"(",["T_CONSTANT_ENCAPSED_STRING","'Account confirmation is required. Please, check your e-mail for confirmation link. To resend confirmation email please <a href=\"%s\">click here<\/a>.'",1048],",",["T_WHITESPACE"," ",1048],["T_VARIABLE","$url",1048],")",["T_WHITESPACE","\n            ",1048],")",";",["T_WHITESPACE","\n        ",1049],"}",["T_WHITESPACE"," ",1050],["T_ELSE","else",1050],["T_WHITESPACE"," ",1050],"{",["T_WHITESPACE","\n            ",1050],["T_VARIABLE","$customer",1051],["T_OBJECT_OPERATOR","->",1051],["T_STRING","sendNewAccountEmail",1051],"(",")",";",["T_WHITESPACE","\n            ",1051],["T_VARIABLE","$this",1052],["T_OBJECT_OPERATOR","->",1052],["T_STRING","getCustomerSession",1052],"(",")",["T_OBJECT_OPERATOR","->",1052],["T_STRING","loginById",1052],"(",["T_VARIABLE","$customer",1052],["T_OBJECT_OPERATOR","->",1052],["T_STRING","getId",1052],"(",")",")",";",["T_WHITESPACE","\n        ",1052],"}",["T_WHITESPACE","\n        ",1053],["T_RETURN","return",1054],["T_WHITESPACE"," ",1054],["T_VARIABLE","$this",1054],";",["T_WHITESPACE","\n    ",1054],"}",["T_WHITESPACE","\n\n    ",1055],["T_DOC_COMMENT","\/**\n     * Get customer session object\n     *\n     * @return Mage_Customer_Model_Session\n     *\/",1057],["T_WHITESPACE","\n    ",1061],["T_PUBLIC","public",1062],["T_WHITESPACE"," ",1062],["T_FUNCTION","function",1062],["T_WHITESPACE"," ",1062],["T_STRING","getCustomerSession",1062],"(",")",["T_WHITESPACE","\n    ",1062],"{",["T_WHITESPACE","\n        ",1063],["T_RETURN","return",1064],["T_WHITESPACE"," ",1064],["T_VARIABLE","$this",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","_customerSession",1064],";",["T_WHITESPACE","\n    ",1064],"}",["T_WHITESPACE","\n\n    ",1065],["T_DOC_COMMENT","\/**\n     * Check if customer email exists\n     *\n     * @param string $email\n     * @return bool\n     *\/",1067],["T_WHITESPACE","\n    ",1072],["T_PROTECTED","protected",1073],["T_WHITESPACE"," ",1073],["T_FUNCTION","function",1073],["T_WHITESPACE"," ",1073],["T_STRING","_customerEmailExists",1073],"(",["T_VARIABLE","$email",1073],")",["T_WHITESPACE","\n    ",1073],"{",["T_WHITESPACE","\n        ",1074],["T_VARIABLE","$result",1075],["T_WHITESPACE","    ",1075],"=",["T_WHITESPACE"," ",1075],["T_STRING","false",1075],";",["T_WHITESPACE","\n        ",1075],["T_VARIABLE","$customer",1076],["T_WHITESPACE","  ",1076],"=",["T_WHITESPACE"," ",1076],["T_STRING","Mage",1076],["T_DOUBLE_COLON","::",1076],["T_STRING","getModel",1076],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",1076],")",";",["T_WHITESPACE","\n        ",1076],["T_VARIABLE","$websiteId",1077],["T_WHITESPACE"," ",1077],"=",["T_WHITESPACE"," ",1077],["T_STRING","Mage",1077],["T_DOUBLE_COLON","::",1077],["T_STRING","app",1077],"(",")",["T_OBJECT_OPERATOR","->",1077],["T_STRING","getStore",1077],"(",")",["T_OBJECT_OPERATOR","->",1077],["T_STRING","getWebsiteId",1077],"(",")",";",["T_WHITESPACE","\n        ",1077],["T_IF","if",1078],["T_WHITESPACE"," ",1078],"(","!",["T_STRING","is_null",1078],"(",["T_VARIABLE","$websiteId",1078],")",")",["T_WHITESPACE"," ",1078],"{",["T_WHITESPACE","\n            ",1078],["T_VARIABLE","$customer",1079],["T_OBJECT_OPERATOR","->",1079],["T_STRING","setWebsiteId",1079],"(",["T_VARIABLE","$websiteId",1079],")",";",["T_WHITESPACE","\n        ",1079],"}",["T_WHITESPACE","\n        ",1080],["T_VARIABLE","$customer",1081],["T_OBJECT_OPERATOR","->",1081],["T_STRING","loadByEmail",1081],"(",["T_VARIABLE","$email",1081],")",";",["T_WHITESPACE","\n        ",1081],["T_IF","if",1082],["T_WHITESPACE"," ",1082],"(","!",["T_STRING","is_null",1082],"(",["T_VARIABLE","$customer",1082],["T_OBJECT_OPERATOR","->",1082],["T_STRING","getId",1082],"(",")",")",")",["T_WHITESPACE"," ",1082],"{",["T_WHITESPACE","\n            ",1082],["T_VARIABLE","$result",1083],["T_WHITESPACE"," ",1083],"=",["T_WHITESPACE"," ",1083],["T_STRING","true",1083],";",["T_WHITESPACE","\n        ",1083],"}",["T_WHITESPACE","\n\n        ",1084],["T_RETURN","return",1086],["T_WHITESPACE"," ",1086],["T_VARIABLE","$result",1086],";",["T_WHITESPACE","\n    ",1086],"}",["T_WHITESPACE","\n",1087],"}",["T_WHITESPACE","\n",1088]]