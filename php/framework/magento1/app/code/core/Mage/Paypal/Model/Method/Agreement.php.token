[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Paypal Billing Agreement method\n *\n * @author Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Paypal_Model_Method_Agreement",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Sales_Model_Payment_Method_Billing_AgreementAbstract",32],["T_WHITESPACE","\n    ",32],["T_IMPLEMENTS","implements",33],["T_WHITESPACE"," ",33],["T_STRING","Mage_Payment_Model_Billing_Agreement_MethodInterface",33],["T_WHITESPACE","\n",33],"{",["T_WHITESPACE","\n    ",34],["T_DOC_COMMENT","\/**\n     * Method code\n     *\n     * @var string\n     *\/",35],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_code",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_STRING","Mage_Paypal_Model_Config",40],["T_DOUBLE_COLON","::",40],["T_STRING","METHOD_BILLING_AGREEMENT",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Method instance settings\n     *\n     *\/",42],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$_canAuthorize",46],["T_WHITESPACE","            ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","true",46],";",["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$_canCapture",47],["T_WHITESPACE","              ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","true",47],";",["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_canCapturePartial",48],["T_WHITESPACE","       ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","true",48],";",["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_canRefund",49],["T_WHITESPACE","               ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","true",49],";",["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$_canRefundInvoicePartial",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","true",50],";",["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_canVoid",51],["T_WHITESPACE","                 ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","true",51],";",["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_canUseCheckout",52],["T_WHITESPACE","          ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","false",52],";",["T_WHITESPACE","\n    ",52],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$_canUseInternal",53],["T_WHITESPACE","          ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","false",53],";",["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_canFetchTransactionInfo",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","true",54],";",["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_canReviewPayment",55],["T_WHITESPACE","        ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","true",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Website Payments Pro instance\n     *\n     * @var Mage_Paypal_Model_Pro\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_pro",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","null",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Initialize Mage_Paypal_Model_Pro model\n     *\n     * @param array $params\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","__construct",69],"(",["T_VARIABLE","$params",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_ARRAY","array",69],"(",")",")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$proInstance",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","array_shift",71],"(",["T_VARIABLE","$params",71],")",";",["T_WHITESPACE","\n        ",71],["T_IF","if",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$proInstance",72],["T_WHITESPACE"," ",72],["T_BOOLEAN_AND","&&",72],["T_WHITESPACE"," ",72],"(",["T_VARIABLE","$proInstance",72],["T_WHITESPACE"," ",72],["T_INSTANCEOF","instanceof",72],["T_WHITESPACE"," ",72],["T_STRING","Mage_Paypal_Model_Pro",72],")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_pro",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$proInstance",73],";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE"," ",74],["T_ELSE","else",74],["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_pro",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","Mage",75],["T_DOUBLE_COLON","::",75],["T_STRING","getModel",75],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/pro'",75],")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_pro",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","setMethod",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_code",77],")",";",["T_WHITESPACE","\n    ",77],"}",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * Store setter\n     * Also updates store ID in config object\n     *\n     * @param Mage_Core_Model_Store|int $store\n     *\/",80],["T_WHITESPACE","\n    ",85],["T_PUBLIC","public",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","setStore",86],"(",["T_VARIABLE","$store",86],")",["T_WHITESPACE","\n    ",86],"{",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","setData",88],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$store",88],")",";",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_STRING","null",89],["T_WHITESPACE"," ",89],["T_IS_IDENTICAL","===",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$store",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$store",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","Mage",90],["T_DOUBLE_COLON","::",90],["T_STRING","app",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","getStore",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","getId",90],"(",")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_pro",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getConfig",92],"(",")",["T_OBJECT_OPERATOR","->",92],["T_STRING","setStoreId",92],"(",["T_STRING","is_object",92],"(",["T_VARIABLE","$store",92],")",["T_WHITESPACE"," ",92],"?",["T_WHITESPACE"," ",92],["T_VARIABLE","$store",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getId",92],"(",")",["T_WHITESPACE"," ",92],":",["T_WHITESPACE"," ",92],["T_VARIABLE","$store",92],")",";",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Init billing agreement\n     *\n     * @param Mage_Payment_Model_Billing_AgreementAbstract $agreement\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","initBillingAgreementToken",102],"(",["T_STRING","Mage_Payment_Model_Billing_AgreementAbstract",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$agreement",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$api",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_pro",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getApi",104],"(",")",["T_WHITESPACE","\n            ",104],["T_OBJECT_OPERATOR","->",105],["T_STRING","setReturnUrl",105],"(",["T_VARIABLE","$agreement",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getReturnUrl",105],"(",")",")",["T_WHITESPACE","\n            ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","setCancelUrl",106],"(",["T_VARIABLE","$agreement",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getCancelUrl",106],"(",")",")",["T_WHITESPACE","\n            ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","setBillingType",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_pro",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getApi",107],"(",")",["T_OBJECT_OPERATOR","->",107],["T_STRING","getBillingAgreementType",107],"(",")",")",";",["T_WHITESPACE","\n\n        ",107],["T_VARIABLE","$api",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","callSetCustomerBillingAgreement",109],"(",")",";",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$agreement",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","setRedirectUrl",110],"(",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_pro",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getConfig",111],"(",")",["T_OBJECT_OPERATOR","->",111],["T_STRING","getStartBillingAgreementUrl",111],"(",["T_VARIABLE","$api",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getToken",111],"(",")",")",["T_WHITESPACE","\n        ",111],")",";",["T_WHITESPACE","\n        ",112],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Retrieve billing agreement customer details by token\n     *\n     * @param Mage_Payment_Model_Billing_AgreementAbstract $agreement\n     * @return array\n     *\/",116],["T_WHITESPACE","\n    ",121],["T_PUBLIC","public",122],["T_WHITESPACE"," ",122],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","getBillingAgreementTokenInfo",122],"(",["T_STRING","Mage_Payment_Model_Billing_AgreementAbstract",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$agreement",122],")",["T_WHITESPACE","\n    ",122],"{",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$api",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_pro",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getApi",124],"(",")",["T_WHITESPACE","\n            ",124],["T_OBJECT_OPERATOR","->",125],["T_STRING","setToken",125],"(",["T_VARIABLE","$agreement",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getToken",125],"(",")",")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$api",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","callGetBillingAgreementCustomerDetails",126],"(",")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$responseData",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_ARRAY","array",127],"(",["T_WHITESPACE","\n            ",127],["T_CONSTANT_ENCAPSED_STRING","'token'",128],["T_WHITESPACE","         ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$api",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getData",128],"(",["T_CONSTANT_ENCAPSED_STRING","'token'",128],")",",",["T_WHITESPACE","\n            ",128],["T_CONSTANT_ENCAPSED_STRING","'email'",129],["T_WHITESPACE","         ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$api",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getData",129],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",129],")",",",["T_WHITESPACE","\n            ",129],["T_CONSTANT_ENCAPSED_STRING","'payer_id'",130],["T_WHITESPACE","      ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$api",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getData",130],"(",["T_CONSTANT_ENCAPSED_STRING","'payer_id'",130],")",",",["T_WHITESPACE","\n            ",130],["T_CONSTANT_ENCAPSED_STRING","'payer_status'",131],["T_WHITESPACE","  ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$api",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getData",131],"(",["T_CONSTANT_ENCAPSED_STRING","'payer_status'",131],")",["T_WHITESPACE","\n        ",131],")",";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$agreement",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","addData",133],"(",["T_VARIABLE","$responseData",133],")",";",["T_WHITESPACE","\n        ",133],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$responseData",134],";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Create billing agreement by token specified in request\n     *\n     * @param Mage_Payment_Model_Billing_AgreementAbstract $agreement\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",137],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","placeBillingAgreement",143],"(",["T_STRING","Mage_Payment_Model_Billing_AgreementAbstract",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$agreement",143],")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$api",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_pro",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getApi",145],"(",")",["T_WHITESPACE","\n            ",145],["T_OBJECT_OPERATOR","->",146],["T_STRING","setToken",146],"(",["T_VARIABLE","$agreement",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getToken",146],"(",")",")",";",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$api",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","callCreateBillingAgreement",147],"(",")",";",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$agreement",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","setBillingAgreementId",148],"(",["T_VARIABLE","$api",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getData",148],"(",["T_CONSTANT_ENCAPSED_STRING","'billing_agreement_id'",148],")",")",";",["T_WHITESPACE","\n        ",148],["T_RETURN","return",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],";",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n\n    ",150],["T_DOC_COMMENT","\/**\n     * Update billing agreement status\n     *\n     * @param Mage_Payment_Model_Billing_AgreementAbstract $agreement\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",152],["T_WHITESPACE","\n    ",157],["T_PUBLIC","public",158],["T_WHITESPACE"," ",158],["T_FUNCTION","function",158],["T_WHITESPACE"," ",158],["T_STRING","updateBillingAgreementStatus",158],"(",["T_STRING","Mage_Payment_Model_Billing_AgreementAbstract",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$agreement",158],")",["T_WHITESPACE","\n    ",158],"{",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$targetStatus",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$agreement",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getStatus",160],"(",")",";",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$api",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_pro",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getApi",161],"(",")",["T_WHITESPACE","\n            ",161],["T_OBJECT_OPERATOR","->",162],["T_STRING","setReferenceId",162],"(",["T_VARIABLE","$agreement",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getReferenceId",162],"(",")",")",["T_WHITESPACE","\n            ",162],["T_OBJECT_OPERATOR","->",163],["T_STRING","setBillingAgreementStatus",163],"(",["T_VARIABLE","$targetStatus",163],")",";",["T_WHITESPACE","\n        ",163],["T_TRY","try",164],["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$api",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","callUpdateBillingAgreement",165],"(",")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE"," ",166],["T_CATCH","catch",166],["T_WHITESPACE"," ",166],"(",["T_STRING","Mage_Core_Exception",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$e",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_COMMENT","\/\/ when BA was already canceled, just pretend that the operation succeeded\n",167],["T_WHITESPACE","            ",168],["T_IF","if",168],["T_WHITESPACE"," ",168],"(","!","(",["T_STRING","Mage_Sales_Model_Billing_Agreement",168],["T_DOUBLE_COLON","::",168],["T_STRING","STATUS_CANCELED",168],["T_WHITESPACE"," ",168],["T_IS_EQUAL","==",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$targetStatus",168],["T_WHITESPACE","\n                ",168],["T_BOOLEAN_AND","&&",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$api",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getIsBillingAgreementAlreadyCancelled",169],"(",")",")",")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n                ",169],["T_THROW","throw",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$e",170],";",["T_WHITESPACE","\n            ",170],"}",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n        ",172],["T_RETURN","return",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n\n    ",174],["T_DOC_COMMENT","\/**\n     * Authorize payment\n     *\n     * @param Varien_Object $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",176],["T_WHITESPACE","\n    ",182],["T_PUBLIC","public",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","authorize",183],"(",["T_STRING","Varien_Object",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$payment",183],",",["T_WHITESPACE"," ",183],["T_VARIABLE","$amount",183],")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_placeOrder",185],"(",["T_VARIABLE","$payment",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$amount",185],")",";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Void payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",188],["T_WHITESPACE","\n    ",193],["T_PUBLIC","public",194],["T_WHITESPACE"," ",194],["T_FUNCTION","function",194],["T_WHITESPACE"," ",194],["T_STRING","void",194],"(",["T_STRING","Varien_Object",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$payment",194],")",["T_WHITESPACE","\n    ",194],"{",["T_WHITESPACE","\n        ",195],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_pro",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","void",196],"(",["T_VARIABLE","$payment",196],")",";",["T_WHITESPACE","\n        ",196],["T_RETURN","return",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],";",["T_WHITESPACE","\n    ",197],"}",["T_WHITESPACE","\n\n    ",198],["T_DOC_COMMENT","\/**\n     * Capture payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",200],["T_WHITESPACE","\n    ",206],["T_PUBLIC","public",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","capture",207],"(",["T_STRING","Varien_Object",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$payment",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$amount",207],")",["T_WHITESPACE","\n    ",207],"{",["T_WHITESPACE","\n        ",208],["T_IF","if",209],["T_WHITESPACE"," ",209],"(",["T_STRING","false",209],["T_WHITESPACE"," ",209],["T_IS_IDENTICAL","===",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_pro",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","capture",209],"(",["T_VARIABLE","$payment",209],",",["T_WHITESPACE"," ",209],["T_VARIABLE","$amount",209],")",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n            ",209],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","_placeOrder",210],"(",["T_VARIABLE","$payment",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$amount",210],")",";",["T_WHITESPACE","\n        ",210],"}",["T_WHITESPACE","\n        ",211],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * Refund capture\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",215],["T_WHITESPACE","\n    ",221],["T_PUBLIC","public",222],["T_WHITESPACE"," ",222],["T_FUNCTION","function",222],["T_WHITESPACE"," ",222],["T_STRING","refund",222],"(",["T_STRING","Varien_Object",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$payment",222],",",["T_WHITESPACE"," ",222],["T_VARIABLE","$amount",222],")",["T_WHITESPACE","\n    ",222],"{",["T_WHITESPACE","\n        ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_pro",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","refund",224],"(",["T_VARIABLE","$payment",224],",",["T_WHITESPACE"," ",224],["T_VARIABLE","$amount",224],")",";",["T_WHITESPACE","\n        ",224],["T_RETURN","return",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],";",["T_WHITESPACE","\n    ",225],"}",["T_WHITESPACE","\n\n    ",226],["T_DOC_COMMENT","\/**\n     * Cancel payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",228],["T_WHITESPACE","\n    ",233],["T_PUBLIC","public",234],["T_WHITESPACE"," ",234],["T_FUNCTION","function",234],["T_WHITESPACE"," ",234],["T_STRING","cancel",234],"(",["T_STRING","Varien_Object",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$payment",234],")",["T_WHITESPACE","\n    ",234],"{",["T_WHITESPACE","\n        ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_pro",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","cancel",236],"(",["T_VARIABLE","$payment",236],")",";",["T_WHITESPACE","\n        ",236],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],";",["T_WHITESPACE","\n    ",237],"}",["T_WHITESPACE","\n\n    ",238],["T_DOC_COMMENT","\/**\n     * Whether payment can be reviewed\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return bool\n     *\/",240],["T_WHITESPACE","\n    ",245],["T_PUBLIC","public",246],["T_WHITESPACE"," ",246],["T_FUNCTION","function",246],["T_WHITESPACE"," ",246],["T_STRING","canReviewPayment",246],"(",["T_STRING","Mage_Payment_Model_Info",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$payment",246],")",["T_WHITESPACE","\n    ",246],"{",["T_WHITESPACE","\n        ",247],["T_RETURN","return",248],["T_WHITESPACE"," ",248],["T_STRING","parent",248],["T_DOUBLE_COLON","::",248],["T_STRING","canReviewPayment",248],"(",["T_VARIABLE","$payment",248],")",["T_WHITESPACE"," ",248],["T_BOOLEAN_AND","&&",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","_pro",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","canReviewPayment",248],"(",["T_VARIABLE","$payment",248],")",";",["T_WHITESPACE","\n    ",248],"}",["T_WHITESPACE","\n\n    ",249],["T_DOC_COMMENT","\/**\n     * Attempt to accept a pending payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return bool\n     *\/",251],["T_WHITESPACE","\n    ",256],["T_PUBLIC","public",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","acceptPayment",257],"(",["T_STRING","Mage_Payment_Model_Info",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$payment",257],")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_STRING","parent",259],["T_DOUBLE_COLON","::",259],["T_STRING","acceptPayment",259],"(",["T_VARIABLE","$payment",259],")",";",["T_WHITESPACE","\n        ",259],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","_pro",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","reviewPayment",260],"(",["T_VARIABLE","$payment",260],",",["T_WHITESPACE"," ",260],["T_STRING","Mage_Paypal_Model_Pro",260],["T_DOUBLE_COLON","::",260],["T_STRING","PAYMENT_REVIEW_ACCEPT",260],")",";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n\n    ",261],["T_DOC_COMMENT","\/**\n     * Attempt to deny a pending payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return bool\n     *\/",263],["T_WHITESPACE","\n    ",268],["T_PUBLIC","public",269],["T_WHITESPACE"," ",269],["T_FUNCTION","function",269],["T_WHITESPACE"," ",269],["T_STRING","denyPayment",269],"(",["T_STRING","Mage_Payment_Model_Info",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$payment",269],")",["T_WHITESPACE","\n    ",269],"{",["T_WHITESPACE","\n        ",270],["T_STRING","parent",271],["T_DOUBLE_COLON","::",271],["T_STRING","denyPayment",271],"(",["T_VARIABLE","$payment",271],")",";",["T_WHITESPACE","\n        ",271],["T_RETURN","return",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","_pro",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","reviewPayment",272],"(",["T_VARIABLE","$payment",272],",",["T_WHITESPACE"," ",272],["T_STRING","Mage_Paypal_Model_Pro",272],["T_DOUBLE_COLON","::",272],["T_STRING","PAYMENT_REVIEW_DENY",272],")",";",["T_WHITESPACE","\n    ",272],"}",["T_WHITESPACE","\n\n    ",273],["T_DOC_COMMENT","\/**\n     * Fetch transaction details info\n     *\n     * @param Mage_Payment_Model_Info $payment\n     * @param string $transactionId\n     * @return array\n     *\/",275],["T_WHITESPACE","\n    ",281],["T_PUBLIC","public",282],["T_WHITESPACE"," ",282],["T_FUNCTION","function",282],["T_WHITESPACE"," ",282],["T_STRING","fetchTransactionInfo",282],"(",["T_STRING","Mage_Payment_Model_Info",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$payment",282],",",["T_WHITESPACE"," ",282],["T_VARIABLE","$transactionId",282],")",["T_WHITESPACE","\n    ",282],"{",["T_WHITESPACE","\n        ",283],["T_RETURN","return",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_pro",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","fetchTransactionInfo",284],"(",["T_VARIABLE","$payment",284],",",["T_WHITESPACE"," ",284],["T_VARIABLE","$transactionId",284],")",";",["T_WHITESPACE","\n    ",284],"}",["T_WHITESPACE","\n\n    ",285],["T_DOC_COMMENT","\/**\n     * Place an order with authorization or capture action\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @param float $amount\n     * @return Mage_Paypal_Model_Method_Agreement\n     *\/",287],["T_WHITESPACE","\n    ",293],["T_PROTECTED","protected",294],["T_WHITESPACE"," ",294],["T_FUNCTION","function",294],["T_WHITESPACE"," ",294],["T_STRING","_placeOrder",294],"(",["T_STRING","Mage_Sales_Model_Order_Payment",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$payment",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$amount",294],")",["T_WHITESPACE","\n    ",294],"{",["T_WHITESPACE","\n        ",295],["T_VARIABLE","$order",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$payment",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getOrder",296],"(",")",";",["T_WHITESPACE","\n        ",296],["T_VARIABLE","$billingAgreement",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_STRING","Mage",297],["T_DOUBLE_COLON","::",297],["T_STRING","getModel",297],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement'",297],")",["T_OBJECT_OPERATOR","->",297],["T_STRING","load",297],"(",["T_WHITESPACE","\n            ",297],["T_VARIABLE","$payment",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getAdditionalInformation",298],"(",["T_WHITESPACE","\n                ",298],["T_STRING","Mage_Sales_Model_Payment_Method_Billing_AgreementAbstract",299],["T_DOUBLE_COLON","::",299],["T_STRING","TRANSPORT_BILLING_AGREEMENT_ID",299],["T_WHITESPACE","\n            ",299],")",["T_WHITESPACE","\n        ",300],")",";",["T_WHITESPACE","\n\n        ",301],["T_VARIABLE","$proConfig",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_pro",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getConfig",303],"(",")",";",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$api",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_pro",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getApi",304],"(",")",["T_WHITESPACE","\n            ",304],["T_OBJECT_OPERATOR","->",305],["T_STRING","setReferenceId",305],"(",["T_VARIABLE","$billingAgreement",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getReferenceId",305],"(",")",")",["T_WHITESPACE","\n            ",305],["T_OBJECT_OPERATOR","->",306],["T_STRING","setPaymentAction",306],"(",["T_VARIABLE","$proConfig",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","paymentAction",306],")",["T_WHITESPACE","\n            ",306],["T_OBJECT_OPERATOR","->",307],["T_STRING","setAmount",307],"(",["T_VARIABLE","$amount",307],")",["T_WHITESPACE","\n            ",307],["T_OBJECT_OPERATOR","->",308],["T_STRING","setCurrencyCode",308],"(",["T_VARIABLE","$payment",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getOrder",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getBaseCurrencyCode",308],"(",")",")",["T_WHITESPACE","\n            ",308],["T_OBJECT_OPERATOR","->",309],["T_STRING","setNotifyUrl",309],"(",["T_STRING","Mage",309],["T_DOUBLE_COLON","::",309],["T_STRING","getUrl",309],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/ipn\/'",309],")",")",["T_WHITESPACE","\n            ",309],["T_OBJECT_OPERATOR","->",310],["T_STRING","setPaypalCart",310],"(",["T_STRING","Mage",310],["T_DOUBLE_COLON","::",310],["T_STRING","getModel",310],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/cart'",310],",",["T_WHITESPACE"," ",310],["T_ARRAY","array",310],"(",["T_VARIABLE","$order",310],")",")",")",["T_WHITESPACE","\n            ",310],["T_OBJECT_OPERATOR","->",311],["T_STRING","setIsLineItemsEnabled",311],"(",["T_VARIABLE","$proConfig",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","lineItemsEnabled",311],")",["T_WHITESPACE","\n            ",311],["T_OBJECT_OPERATOR","->",312],["T_STRING","setInvNum",312],"(",["T_VARIABLE","$order",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","getIncrementId",312],"(",")",")",["T_WHITESPACE","\n        ",312],";",["T_WHITESPACE","\n\n        ",313],["T_COMMENT","\/\/ call api and import transaction and other payment information\n",315],["T_WHITESPACE","        ",316],["T_VARIABLE","$api",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","callDoReferenceTransaction",316],"(",")",";",["T_WHITESPACE","\n        ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_pro",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","importPaymentInfo",317],"(",["T_VARIABLE","$api",317],",",["T_WHITESPACE"," ",317],["T_VARIABLE","$payment",317],")",";",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$api",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","callGetTransactionDetails",318],"(",")",";",["T_WHITESPACE","\n        ",318],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_pro",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","importPaymentInfo",319],"(",["T_VARIABLE","$api",319],",",["T_WHITESPACE"," ",319],["T_VARIABLE","$payment",319],")",";",["T_WHITESPACE","\n\n        ",319],["T_VARIABLE","$payment",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","setTransactionId",321],"(",["T_VARIABLE","$api",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getTransactionId",321],"(",")",")",["T_WHITESPACE","\n            ",321],["T_OBJECT_OPERATOR","->",322],["T_STRING","setIsTransactionClosed",322],"(",["T_LNUMBER","0",322],")",";",["T_WHITESPACE","\n\n        ",322],["T_IF","if",324],["T_WHITESPACE"," ",324],"(",["T_VARIABLE","$api",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","getBillingAgreementId",324],"(",")",")",["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n            ",324],["T_VARIABLE","$order",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","addRelatedObject",325],"(",["T_VARIABLE","$billingAgreement",325],")",";",["T_WHITESPACE","\n            ",325],["T_VARIABLE","$billingAgreement",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","setIsObjectChanged",326],"(",["T_STRING","true",326],")",";",["T_WHITESPACE","\n            ",326],["T_VARIABLE","$billingAgreement",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","addOrderRelation",327],"(",["T_VARIABLE","$order",327],")",";",["T_WHITESPACE","\n        ",327],"}",["T_WHITESPACE","\n\n        ",328],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],";",["T_WHITESPACE","\n    ",330],"}",["T_WHITESPACE","\n\n\n    ",331],["T_PROTECTED","protected",334],["T_WHITESPACE"," ",334],["T_FUNCTION","function",334],["T_WHITESPACE"," ",334],["T_STRING","_isAvailable",334],"(",["T_VARIABLE","$quote",334],")",["T_WHITESPACE","\n    ",334],"{",["T_WHITESPACE","\n        ",335],["T_RETURN","return",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_pro",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getConfig",336],"(",")",["T_OBJECT_OPERATOR","->",336],["T_STRING","isMethodAvailable",336],"(",["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_code",336],")",";",["T_WHITESPACE","\n    ",336],"}",["T_WHITESPACE","\n\n    ",337],["T_DOC_COMMENT","\/**\n     * Payment action getter compatible with payment model\n     *\n     * @see Mage_Sales_Model_Payment::place()\n     * @return string\n     *\/",339],["T_WHITESPACE","\n    ",344],["T_PUBLIC","public",345],["T_WHITESPACE"," ",345],["T_FUNCTION","function",345],["T_WHITESPACE"," ",345],["T_STRING","getConfigPaymentAction",345],"(",")",["T_WHITESPACE","\n    ",345],"{",["T_WHITESPACE","\n        ",346],["T_RETURN","return",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_pro",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getConfig",347],"(",")",["T_OBJECT_OPERATOR","->",347],["T_STRING","getPaymentAction",347],"(",")",";",["T_WHITESPACE","\n    ",347],"}",["T_WHITESPACE","\n\n",348],"}",["T_WHITESPACE","\n",350]]