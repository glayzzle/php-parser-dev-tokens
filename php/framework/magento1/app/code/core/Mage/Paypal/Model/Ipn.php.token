[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * PayPal Instant Payment Notification processor model\n *\/",27],["T_WHITESPACE","\n",29],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Paypal_Model_Ipn",30],["T_WHITESPACE","\n",30],"{",["T_WHITESPACE","\n    ",31],["T_DOC_COMMENT","\/**\n     * Default log filename\n     *\n     * @var string\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","DEFAULT_LOG_FILE",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'paypal_unknown_ipn.log'",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Store order instance\n     *\n     * @var Mage_Sales_Model_Order\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_order",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_STRING","null",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Recurring profile instance\n     *\n     * @var Mage_Sales_Model_Recurring_Profile\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_recurringProfile",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","null",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     *\n     * @var Mage_Paypal_Model_Config\n     *\/",53],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$_config",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","null",57],";",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * PayPal info instance\n     *\n     * @var Mage_Paypal_Model_Info\n     *\/",59],["T_WHITESPACE","\n    ",63],["T_PROTECTED","protected",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$_info",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","null",64],";",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * IPN request data\n     * @var array\n     *\/",66],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_request",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",")",";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Collected debug information\n     *\n     * @var array\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_debugData",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_ARRAY","array",77],"(",")",";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * IPN request data getter\n     *\n     * @param string $key\n     * @return array|string\n     *\/",79],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","getRequestData",85],"(",["T_VARIABLE","$key",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","null",85],")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(",["T_STRING","null",87],["T_WHITESPACE"," ",87],["T_IS_IDENTICAL","===",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$key",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_request",88],";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_ISSET","isset",90],"(",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_request",90],"[",["T_VARIABLE","$key",90],"]",")",["T_WHITESPACE"," ",90],"?",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_request",90],"[",["T_VARIABLE","$key",90],"]",["T_WHITESPACE"," ",90],":",["T_WHITESPACE"," ",90],["T_STRING","null",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Get ipn data, send verification to PayPal, run corresponding handler\n     *\n     * @param array $request\n     * @param Zend_Http_Client_Adapter_Interface $httpAdapter\n     * @throws Exception\n     *\/",93],["T_WHITESPACE","\n    ",99],["T_PUBLIC","public",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","processIpnRequest",100],"(",["T_ARRAY","array",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$request",100],",",["T_WHITESPACE"," ",100],["T_STRING","Zend_Http_Client_Adapter_Interface",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$httpAdapter",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","null",100],")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_request",102],["T_WHITESPACE","   ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$request",102],";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_debugData",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",["T_CONSTANT_ENCAPSED_STRING","'ipn'",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$request",103],")",";",["T_WHITESPACE","\n        ",103],["T_STRING","ksort",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_debugData",104],"[",["T_CONSTANT_ENCAPSED_STRING","'ipn'",104],"]",")",";",["T_WHITESPACE","\n\n        ",104],["T_TRY","try",106],["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_IF","if",107],["T_WHITESPACE"," ",107],"(",["T_ISSET","isset",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_request",107],"[",["T_CONSTANT_ENCAPSED_STRING","'txn_type'",107],"]",")",["T_WHITESPACE"," ",107],["T_BOOLEAN_AND","&&",107],["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'recurring_payment'",107],["T_WHITESPACE"," ",107],["T_IS_EQUAL","==",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_request",107],"[",["T_CONSTANT_ENCAPSED_STRING","'txn_type'",107],"]",")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n                ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_getRecurringProfile",108],"(",")",";",["T_WHITESPACE","\n                ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$httpAdapter",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n                    ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_postBack",110],"(",["T_VARIABLE","$httpAdapter",110],")",";",["T_WHITESPACE","\n                ",110],"}",["T_WHITESPACE","\n                ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_processRecurringProfile",112],"(",")",";",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE"," ",113],["T_ELSE","else",113],["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_getOrder",114],"(",")",";",["T_WHITESPACE","\n                ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$httpAdapter",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                    ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_postBack",116],"(",["T_VARIABLE","$httpAdapter",116],")",";",["T_WHITESPACE","\n                ",116],"}",["T_WHITESPACE","\n                ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_processOrder",118],"(",")",";",["T_WHITESPACE","\n            ",118],"}",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE"," ",120],["T_CATCH","catch",120],["T_WHITESPACE"," ",120],"(",["T_STRING","Exception",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$e",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_debugData",121],"[",["T_CONSTANT_ENCAPSED_STRING","'exception'",121],"]",["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$e",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getMessage",121],"(",")",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","_debug",122],"(",")",";",["T_WHITESPACE","\n            ",122],["T_THROW","throw",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$e",123],";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_debug",125],"(",")",";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Post back to PayPal to check whether this request is a valid one\n     *\n     * @param Zend_Http_Client_Adapter_Interface $httpAdapter\n     *\/",128],["T_WHITESPACE","\n    ",132],["T_PROTECTED","protected",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","_postBack",133],"(",["T_STRING","Zend_Http_Client_Adapter_Interface",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$httpAdapter",133],")",["T_WHITESPACE","\n    ",133],"{",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$postbackQuery",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","http_build_query",135],"(",["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_request",135],")",["T_WHITESPACE"," ",135],".",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'&cmd=_notify-validate'",135],";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$postbackUrl",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_config",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getPaypalUrl",136],"(",")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_debugData",137],"[",["T_CONSTANT_ENCAPSED_STRING","'postback_to'",137],"]",["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$postbackUrl",137],";",["T_WHITESPACE","\n\n        ",137],["T_VARIABLE","$httpAdapter",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","setConfig",139],"(",["T_ARRAY","array",139],"(",["T_CONSTANT_ENCAPSED_STRING","'verifypeer'",139],["T_WHITESPACE"," ",139],["T_DOUBLE_ARROW","=>",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_config",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","verifyPeer",139],")",")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$httpAdapter",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","write",140],"(",["T_WHITESPACE","\n            ",140],["T_STRING","Zend_Http_Client",141],["T_DOUBLE_COLON","::",141],["T_STRING","POST",141],",",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$postbackUrl",142],",",["T_WHITESPACE","\n            ",142],["T_CONSTANT_ENCAPSED_STRING","'1.1'",143],",",["T_WHITESPACE","\n            ",143],["T_ARRAY","array",144],"(",["T_CONSTANT_ENCAPSED_STRING","'Connection: close'",144],")",",",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$postbackQuery",145],["T_WHITESPACE","\n        ",145],")",";",["T_WHITESPACE","\n\n        ",146],["T_TRY","try",148],["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$postbackResult",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$httpAdapter",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","read",149],"(",")",";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE"," ",150],["T_CATCH","catch",150],["T_WHITESPACE"," ",150],"(",["T_STRING","Exception",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$e",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_debugData",151],"[",["T_CONSTANT_ENCAPSED_STRING","'http_error'",151],"]",["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$e",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getMessage",151],"(",")",",",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'code'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$e",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getCode",151],"(",")",")",";",["T_WHITESPACE","\n            ",151],["T_THROW","throw",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$e",152],";",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE","\n\n        ",153],["T_COMMENT","\/*\n         * Handle errors on PayPal side.\n         *\/",155],["T_WHITESPACE","\n        ",157],["T_VARIABLE","$responseCode",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","Zend_Http_Response",158],["T_DOUBLE_COLON","::",158],["T_STRING","extractCode",158],"(",["T_VARIABLE","$postbackResult",158],")",";",["T_WHITESPACE","\n        ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(",["T_EMPTY","empty",159],"(",["T_VARIABLE","$postbackResult",159],")",["T_WHITESPACE"," ",159],["T_BOOLEAN_OR","||",159],["T_WHITESPACE"," ",159],["T_STRING","in_array",159],"(",["T_VARIABLE","$responseCode",159],",",["T_WHITESPACE"," ",159],["T_ARRAY","array",159],"(",["T_CONSTANT_ENCAPSED_STRING","'500'",159],",",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'502'",159],",",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","'503'",159],")",")",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_EMPTY","empty",160],"(",["T_VARIABLE","$postbackResult",160],")",")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$reason",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'Empty response.'",161],";",["T_WHITESPACE","\n            ",161],"}",["T_WHITESPACE"," ",162],["T_ELSE","else",162],["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n                ",162],["T_VARIABLE","$reason",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'Response code: '",163],["T_WHITESPACE"," ",163],".",["T_WHITESPACE"," ",163],["T_VARIABLE","$responseCode",163],["T_WHITESPACE"," ",163],".",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'.'",163],";",["T_WHITESPACE","\n            ",163],"}",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_debugData",165],"[",["T_CONSTANT_ENCAPSED_STRING","'exception'",165],"]",["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'PayPal IPN postback failure. '",165],["T_WHITESPACE"," ",165],".",["T_WHITESPACE"," ",165],["T_VARIABLE","$reason",165],";",["T_WHITESPACE","\n            ",165],["T_THROW","throw",166],["T_WHITESPACE"," ",166],["T_NEW","new",166],["T_WHITESPACE"," ",166],["T_STRING","Mage_Paypal_UnavailableException",166],"(",["T_VARIABLE","$reason",166],")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n\n        ",167],["T_VARIABLE","$response",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_STRING","preg_split",169],"(",["T_CONSTANT_ENCAPSED_STRING","'\/^\\r?$\/m'",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$postbackResult",169],",",["T_WHITESPACE"," ",169],["T_LNUMBER","2",169],")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$response",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_STRING","trim",170],"(",["T_VARIABLE","$response",170],"[",["T_LNUMBER","1",170],"]",")",";",["T_WHITESPACE","\n        ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_VARIABLE","$response",171],["T_WHITESPACE"," ",171],["T_IS_NOT_EQUAL","!=",171],["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'VERIFIED'",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_debugData",172],"[",["T_CONSTANT_ENCAPSED_STRING","'postback'",172],"]",["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$postbackQuery",172],";",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_debugData",173],"[",["T_CONSTANT_ENCAPSED_STRING","'postback_result'",173],"]",["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$postbackResult",173],";",["T_WHITESPACE","\n            ",173],["T_THROW","throw",174],["T_WHITESPACE"," ",174],["T_NEW","new",174],["T_WHITESPACE"," ",174],["T_STRING","Exception",174],"(",["T_CONSTANT_ENCAPSED_STRING","'PayPal IPN postback failure. See '",174],["T_WHITESPACE"," ",174],".",["T_WHITESPACE"," ",174],["T_STRING","self",174],["T_DOUBLE_COLON","::",174],["T_STRING","DEFAULT_LOG_FILE",174],["T_WHITESPACE"," ",174],".",["T_WHITESPACE"," ",174],["T_CONSTANT_ENCAPSED_STRING","' for details.'",174],")",";",["T_WHITESPACE","\n        ",174],"}",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n\n    ",176],["T_DOC_COMMENT","\/**\n     * Load and validate order, instantiate proper configuration\n     *\n     *\n     * @return Mage_Sales_Model_Order\n     * @throws Exception\n     *\/",178],["T_WHITESPACE","\n    ",184],["T_PROTECTED","protected",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","_getOrder",185],"(",")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_EMPTY","empty",187],"(",["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_order",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_COMMENT","\/\/ get proper order\n",188],["T_WHITESPACE","            ",189],["T_VARIABLE","$id",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_request",189],"[",["T_CONSTANT_ENCAPSED_STRING","'invoice'",189],"]",";",["T_WHITESPACE","\n            ",189],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_order",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_STRING","Mage",190],["T_DOUBLE_COLON","::",190],["T_STRING","getModel",190],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",190],")",["T_OBJECT_OPERATOR","->",190],["T_STRING","loadByIncrementId",190],"(",["T_VARIABLE","$id",190],")",";",["T_WHITESPACE","\n            ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(","!",["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_order",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getId",191],"(",")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n                ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_debugData",192],"[",["T_CONSTANT_ENCAPSED_STRING","'exception'",192],"]",["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_STRING","sprintf",192],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong order ID: \"%s\".'",192],",",["T_WHITESPACE"," ",192],["T_VARIABLE","$id",192],")",";",["T_WHITESPACE","\n                ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_debug",193],"(",")",";",["T_WHITESPACE","\n                ",193],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","app",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","getResponse",194],"(",")",["T_WHITESPACE","\n                    ",194],["T_OBJECT_OPERATOR","->",195],["T_STRING","setHeader",195],"(",["T_CONSTANT_ENCAPSED_STRING","'HTTP\/1.1'",195],",",["T_CONSTANT_ENCAPSED_STRING","'503 Service Unavailable'",195],")",["T_WHITESPACE","\n                    ",195],["T_OBJECT_OPERATOR","->",196],["T_STRING","sendResponse",196],"(",")",";",["T_WHITESPACE","\n                ",196],["T_EXIT","exit",197],";",["T_WHITESPACE","\n            ",197],"}",["T_WHITESPACE","\n            ",198],["T_COMMENT","\/\/ re-initialize config with the method code and store id\n",199],["T_WHITESPACE","            ",200],["T_VARIABLE","$methodCode",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_order",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getPayment",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","getMethod",200],"(",")",";",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_config",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","Mage",201],["T_DOUBLE_COLON","::",201],["T_STRING","getModel",201],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/config'",201],",",["T_WHITESPACE"," ",201],["T_ARRAY","array",201],"(",["T_VARIABLE","$methodCode",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_order",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getStoreId",201],"(",")",")",")",";",["T_WHITESPACE","\n            ",201],["T_IF","if",202],["T_WHITESPACE"," ",202],"(","!",["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_config",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","isMethodActive",202],"(",["T_VARIABLE","$methodCode",202],")",["T_WHITESPACE"," ",202],["T_BOOLEAN_OR","||",202],["T_WHITESPACE"," ",202],"!",["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_config",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","isMethodAvailable",202],"(",")",")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n                ",202],["T_THROW","throw",203],["T_WHITESPACE"," ",203],["T_NEW","new",203],["T_WHITESPACE"," ",203],["T_STRING","Exception",203],"(",["T_STRING","sprintf",203],"(",["T_CONSTANT_ENCAPSED_STRING","'Method \"%s\" is not available.'",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$methodCode",203],")",")",";",["T_WHITESPACE","\n            ",203],"}",["T_WHITESPACE","\n\n            ",204],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_verifyOrder",206],"(",")",";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n        ",207],["T_RETURN","return",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_order",208],";",["T_WHITESPACE","\n    ",208],"}",["T_WHITESPACE","\n\n    ",209],["T_DOC_COMMENT","\/**\n     * Load recurring profile\n     *\n     * @return Mage_Sales_Model_Recurring_Profile\n     * @throws Exception\n     *\/",211],["T_WHITESPACE","\n    ",216],["T_PROTECTED","protected",217],["T_WHITESPACE"," ",217],["T_FUNCTION","function",217],["T_WHITESPACE"," ",217],["T_STRING","_getRecurringProfile",217],"(",")",["T_WHITESPACE","\n    ",217],"{",["T_WHITESPACE","\n        ",218],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_EMPTY","empty",219],"(",["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_recurringProfile",219],")",")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_COMMENT","\/\/ get proper recurring profile\n",220],["T_WHITESPACE","            ",221],["T_VARIABLE","$internalReferenceId",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","_request",221],"[",["T_CONSTANT_ENCAPSED_STRING","'rp_invoice_id'",221],"]",";",["T_WHITESPACE","\n            ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_recurringProfile",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_STRING","Mage",222],["T_DOUBLE_COLON","::",222],["T_STRING","getModel",222],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/recurring_profile'",222],")",["T_WHITESPACE","\n                ",222],["T_OBJECT_OPERATOR","->",223],["T_STRING","loadByInternalReferenceId",223],"(",["T_VARIABLE","$internalReferenceId",223],")",";",["T_WHITESPACE","\n            ",223],["T_IF","if",224],["T_WHITESPACE"," ",224],"(","!",["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_recurringProfile",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getId",224],"(",")",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                ",224],["T_THROW","throw",225],["T_WHITESPACE"," ",225],["T_NEW","new",225],["T_WHITESPACE"," ",225],["T_STRING","Exception",225],"(",["T_WHITESPACE","\n                    ",225],["T_STRING","sprintf",226],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong recurring profile INTERNAL_REFERENCE_ID: \"%s\".'",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$internalReferenceId",226],")",["T_WHITESPACE","\n                ",226],")",";",["T_WHITESPACE","\n            ",227],"}",["T_WHITESPACE","\n            ",228],["T_COMMENT","\/\/ re-initialize config with the method code and store id\n",229],["T_WHITESPACE","            ",230],["T_VARIABLE","$methodCode",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_recurringProfile",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getMethodCode",230],"(",")",";",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_config",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","Mage",231],["T_DOUBLE_COLON","::",231],["T_STRING","getModel",231],"(",["T_WHITESPACE","\n                ",231],["T_CONSTANT_ENCAPSED_STRING","'paypal\/config'",232],",",["T_WHITESPACE"," ",232],["T_ARRAY","array",232],"(",["T_VARIABLE","$methodCode",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","_recurringProfile",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getStoreId",232],"(",")",")",["T_WHITESPACE","\n            ",232],")",";",["T_WHITESPACE","\n            ",233],["T_IF","if",234],["T_WHITESPACE"," ",234],"(","!",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_config",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","isMethodActive",234],"(",["T_VARIABLE","$methodCode",234],")",["T_WHITESPACE"," ",234],["T_BOOLEAN_OR","||",234],["T_WHITESPACE"," ",234],"!",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_config",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","isMethodAvailable",234],"(",")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n                ",234],["T_THROW","throw",235],["T_WHITESPACE"," ",235],["T_NEW","new",235],["T_WHITESPACE"," ",235],["T_STRING","Exception",235],"(",["T_STRING","sprintf",235],"(",["T_CONSTANT_ENCAPSED_STRING","'Method \"%s\" is not available.'",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$methodCode",235],")",")",";",["T_WHITESPACE","\n            ",235],"}",["T_WHITESPACE","\n        ",236],"}",["T_WHITESPACE","\n        ",237],["T_RETURN","return",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_recurringProfile",238],";",["T_WHITESPACE","\n    ",238],"}",["T_WHITESPACE","\n\n    ",239],["T_DOC_COMMENT","\/**\n     * Validate incoming request data, as PayPal recommends\n     *\n     * @throws Exception\n     * @link https:\/\/cms.paypal.com\/cgi-bin\/marketingweb?cmd=_render-content&content_ID=developer\/e_howto_admin_IPNIntro\n     *\/",241],["T_WHITESPACE","\n    ",246],["T_PROTECTED","protected",247],["T_WHITESPACE"," ",247],["T_FUNCTION","function",247],["T_WHITESPACE"," ",247],["T_STRING","_verifyOrder",247],"(",")",["T_WHITESPACE","\n    ",247],"{",["T_WHITESPACE","\n        ",248],["T_COMMENT","\/\/ verify merchant email intended to receive notification\n",249],["T_WHITESPACE","        ",250],["T_VARIABLE","$merchantEmail",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","_config",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","businessAccount",250],";",["T_WHITESPACE","\n        ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_VARIABLE","$merchantEmail",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n            ",251],["T_VARIABLE","$receiverEmail",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getRequestData",252],"(",["T_CONSTANT_ENCAPSED_STRING","'business'",252],")",";",["T_WHITESPACE","\n            ",252],["T_IF","if",253],["T_WHITESPACE"," ",253],"(","!",["T_VARIABLE","$receiverEmail",253],")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n                ",253],["T_VARIABLE","$receiverEmail",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getRequestData",254],"(",["T_CONSTANT_ENCAPSED_STRING","'receiver_email'",254],")",";",["T_WHITESPACE","\n            ",254],"}",["T_WHITESPACE","\n            ",255],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_STRING","strtolower",256],"(",["T_VARIABLE","$merchantEmail",256],")",["T_WHITESPACE"," ",256],["T_IS_NOT_EQUAL","!=",256],["T_WHITESPACE"," ",256],["T_STRING","strtolower",256],"(",["T_VARIABLE","$receiverEmail",256],")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n                ",256],["T_THROW","throw",257],["T_WHITESPACE"," ",257],["T_NEW","new",257],["T_WHITESPACE"," ",257],["T_STRING","Exception",257],"(",["T_WHITESPACE","\n                    ",257],["T_STRING","sprintf",258],"(",["T_WHITESPACE","\n                        ",258],["T_CONSTANT_ENCAPSED_STRING","'Requested %s and configured %s merchant emails do not match.'",259],",",["T_WHITESPACE"," ",259],["T_VARIABLE","$receiverEmail",259],",",["T_WHITESPACE"," ",259],["T_VARIABLE","$merchantEmail",259],["T_WHITESPACE","\n                    ",259],")",["T_WHITESPACE","\n                ",260],")",";",["T_WHITESPACE","\n            ",261],"}",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n    ",263],"}",["T_WHITESPACE","\n\n    ",264],["T_DOC_COMMENT","\/**\n     * IPN workflow implementation\n     * Everything should be added to order comments. In positive processing cases customer will get email notifications.\n     * Admin will be notified on errors.\n     *\/",266],["T_WHITESPACE","\n    ",270],["T_PROTECTED","protected",271],["T_WHITESPACE"," ",271],["T_FUNCTION","function",271],["T_WHITESPACE"," ",271],["T_STRING","_processOrder",271],"(",")",["T_WHITESPACE","\n    ",271],"{",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_order",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","null",273],";",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_getOrder",274],"(",")",";",["T_WHITESPACE","\n\n        ",274],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_info",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_STRING","Mage",276],["T_DOUBLE_COLON","::",276],["T_STRING","getSingleton",276],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/info'",276],")",";",["T_WHITESPACE","\n        ",276],["T_TRY","try",277],["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_COMMENT","\/\/ Handle payment_status\n",278],["T_WHITESPACE","            ",279],["T_VARIABLE","$transactionType",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_ISSET","isset",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_request",279],"[",["T_CONSTANT_ENCAPSED_STRING","'txn_type'",279],"]",")",["T_WHITESPACE"," ",279],"?",["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_request",279],"[",["T_CONSTANT_ENCAPSED_STRING","'txn_type'",279],"]",["T_WHITESPACE"," ",279],":",["T_WHITESPACE"," ",279],["T_STRING","null",279],";",["T_WHITESPACE","\n            ",279],["T_SWITCH","switch",280],["T_WHITESPACE"," ",280],"(",["T_VARIABLE","$transactionType",280],")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n                ",280],["T_COMMENT","\/\/ handle new case created\n",281],["T_WHITESPACE","                ",282],["T_CASE","case",282],["T_WHITESPACE"," ",282],["T_STRING","Mage_Paypal_Model_Info",282],["T_DOUBLE_COLON","::",282],["T_STRING","TXN_TYPE_NEW_CASE",282],":",["T_WHITESPACE","\n                    ",282],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_registerDispute",283],"(",")",";",["T_WHITESPACE","\n                    ",283],["T_BREAK","break",284],";",["T_WHITESPACE","\n\n                ",284],["T_COMMENT","\/\/ handle new adjustment is created\n",286],["T_WHITESPACE","                ",287],["T_CASE","case",287],["T_WHITESPACE"," ",287],["T_STRING","Mage_Paypal_Model_Info",287],["T_DOUBLE_COLON","::",287],["T_STRING","TXN_TYPE_ADJUSTMENT",287],":",["T_WHITESPACE","\n                    ",287],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_registerAdjustment",288],"(",")",";",["T_WHITESPACE","\n                    ",288],["T_BREAK","break",289],";",["T_WHITESPACE","\n\n                ",289],["T_COMMENT","\/\/handle new transaction created\n",291],["T_WHITESPACE","                ",292],["T_DEFAULT","default",292],":",["T_WHITESPACE","\n                    ",292],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_registerTransaction",293],"(",")",";",["T_WHITESPACE","\n            ",293],"}",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE"," ",295],["T_CATCH","catch",295],["T_WHITESPACE"," ",295],"(",["T_STRING","Mage_Core_Exception",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$e",295],")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$comment",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_createIpnComment",296],"(",["T_STRING","Mage",296],["T_DOUBLE_COLON","::",296],["T_STRING","helper",296],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",296],")",["T_OBJECT_OPERATOR","->",296],["T_STRING","__",296],"(",["T_CONSTANT_ENCAPSED_STRING","'Note: %s'",296],",",["T_WHITESPACE"," ",296],["T_VARIABLE","$e",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getMessage",296],"(",")",")",",",["T_WHITESPACE"," ",296],["T_STRING","true",296],")",";",["T_WHITESPACE","\n            ",296],["T_VARIABLE","$comment",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","save",297],"(",")",";",["T_WHITESPACE","\n            ",297],["T_THROW","throw",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$e",298],";",["T_WHITESPACE","\n        ",298],"}",["T_WHITESPACE","\n    ",299],"}",["T_WHITESPACE","\n\n    ",300],["T_DOC_COMMENT","\/**\n     * Process adjustment notification\n     *\/",302],["T_WHITESPACE","\n    ",304],["T_PROTECTED","protected",305],["T_WHITESPACE"," ",305],["T_FUNCTION","function",305],["T_WHITESPACE"," ",305],["T_STRING","_registerAdjustment",305],"(",")",["T_WHITESPACE","\n    ",305],"{",["T_WHITESPACE","\n        ",306],["T_VARIABLE","$reasonCode",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_ISSET","isset",307],"(",["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_request",307],"[",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",307],"]",")",["T_WHITESPACE"," ",307],"?",["T_WHITESPACE"," ",307],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_request",307],"[",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",307],"]",["T_WHITESPACE"," ",307],":",["T_WHITESPACE"," ",307],["T_STRING","null",307],";",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$reasonComment",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_info",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","explainReasonCode",308],"(",["T_VARIABLE","$reasonCode",308],")",";",["T_WHITESPACE","\n        ",308],["T_VARIABLE","$notificationAmount",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","_order",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getBaseCurrency",309],"(",")",["T_OBJECT_OPERATOR","->",309],["T_STRING","formatTxt",309],"(",["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","_request",309],"[",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",309],"]",")",";",["T_WHITESPACE","\n        ",309],["T_DOC_COMMENT","\/**\n         *  Add IPN comment about registered dispute\n         *\/",310],["T_WHITESPACE","\n        ",312],["T_VARIABLE","$message",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_STRING","Mage",313],["T_DOUBLE_COLON","::",313],["T_STRING","helper",313],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",313],")",["T_OBJECT_OPERATOR","->",313],["T_STRING","__",313],"(",["T_CONSTANT_ENCAPSED_STRING","'IPN \"%s\". A dispute has been resolved and closed. %s Transaction amount %s.'",313],",",["T_WHITESPACE"," ",313],["T_STRING","ucfirst",313],"(",["T_VARIABLE","$reasonCode",313],")",",",["T_WHITESPACE"," ",313],["T_VARIABLE","$notificationAmount",313],",",["T_WHITESPACE"," ",313],["T_VARIABLE","$reasonComment",313],")",";",["T_WHITESPACE","\n        ",313],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_order",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","addStatusHistoryComment",314],"(",["T_VARIABLE","$message",314],")",["T_WHITESPACE","\n            ",314],["T_OBJECT_OPERATOR","->",315],["T_STRING","setIsCustomerNotified",315],"(",["T_STRING","false",315],")",["T_WHITESPACE","\n            ",315],["T_OBJECT_OPERATOR","->",316],["T_STRING","save",316],"(",")",";",["T_WHITESPACE","\n    ",316],"}",["T_WHITESPACE","\n\n    ",317],["T_DOC_COMMENT","\/**\n     * Process dispute notification\n     *\/",319],["T_WHITESPACE","\n    ",321],["T_PROTECTED","protected",322],["T_WHITESPACE"," ",322],["T_FUNCTION","function",322],["T_WHITESPACE"," ",322],["T_STRING","_registerDispute",322],"(",")",["T_WHITESPACE","\n    ",322],"{",["T_WHITESPACE","\n        ",323],["T_VARIABLE","$reasonCode",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_ISSET","isset",324],"(",["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_request",324],"[",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",324],"]",")",["T_WHITESPACE"," ",324],"?",["T_WHITESPACE"," ",324],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_request",324],"[",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",324],"]",["T_WHITESPACE"," ",324],":",["T_WHITESPACE"," ",324],["T_STRING","null",324],";",["T_WHITESPACE","\n        ",324],["T_VARIABLE","$reasonComment",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","_info",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","explainReasonCode",325],"(",["T_VARIABLE","$reasonCode",325],")",";",["T_WHITESPACE","\n        ",325],["T_VARIABLE","$caseType",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_ISSET","isset",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_request",326],"[",["T_CONSTANT_ENCAPSED_STRING","'case_type'",326],"]",")",["T_WHITESPACE"," ",326],"?",["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_request",326],"[",["T_CONSTANT_ENCAPSED_STRING","'case_type'",326],"]",["T_WHITESPACE"," ",326],":",["T_WHITESPACE"," ",326],["T_STRING","null",326],";",["T_WHITESPACE","\n        ",326],["T_VARIABLE","$caseTypeLabel",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_info",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getCaseTypeLabel",327],"(",["T_VARIABLE","$caseType",327],")",";",["T_WHITESPACE","\n        ",327],["T_VARIABLE","$caseId",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_ISSET","isset",328],"(",["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_request",328],"[",["T_CONSTANT_ENCAPSED_STRING","'case_id'",328],"]",")",["T_WHITESPACE"," ",328],"?",["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_request",328],"[",["T_CONSTANT_ENCAPSED_STRING","'case_id'",328],"]",["T_WHITESPACE"," ",328],":",["T_WHITESPACE"," ",328],["T_STRING","null",328],";",["T_WHITESPACE","\n        ",328],["T_DOC_COMMENT","\/**\n         *  Add IPN comment about registered dispute\n         *\/",329],["T_WHITESPACE","\n        ",331],["T_VARIABLE","$message",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_STRING","Mage",332],["T_DOUBLE_COLON","::",332],["T_STRING","helper",332],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",332],")",["T_OBJECT_OPERATOR","->",332],["T_STRING","__",332],"(",["T_CONSTANT_ENCAPSED_STRING","'IPN \"%s\". Case type \"%s\". Case ID \"%s\" %s'",332],",",["T_WHITESPACE"," ",332],["T_STRING","ucfirst",332],"(",["T_VARIABLE","$caseType",332],")",",",["T_WHITESPACE"," ",332],["T_VARIABLE","$caseTypeLabel",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$caseId",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$reasonComment",332],")",";",["T_WHITESPACE","\n        ",332],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","_order",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","addStatusHistoryComment",333],"(",["T_VARIABLE","$message",333],")",["T_WHITESPACE","\n            ",333],["T_OBJECT_OPERATOR","->",334],["T_STRING","setIsCustomerNotified",334],"(",["T_STRING","false",334],")",["T_WHITESPACE","\n            ",334],["T_OBJECT_OPERATOR","->",335],["T_STRING","save",335],"(",")",";",["T_WHITESPACE","\n    ",335],"}",["T_WHITESPACE","\n\n    ",336],["T_DOC_COMMENT","\/**\n     * Process regular IPN notifications\n     *\/",338],["T_WHITESPACE","\n    ",340],["T_PROTECTED","protected",341],["T_WHITESPACE"," ",341],["T_FUNCTION","function",341],["T_WHITESPACE"," ",341],["T_STRING","_registerTransaction",341],"(",")",["T_WHITESPACE","\n    ",341],"{",["T_WHITESPACE","\n        ",342],["T_TRY","try",343],["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n            ",343],["T_COMMENT","\/\/ Handle payment_status\n",344],["T_WHITESPACE","            ",345],["T_VARIABLE","$paymentStatus",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_filterPaymentStatus",345],"(",["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_request",345],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",345],"]",")",";",["T_WHITESPACE","\n            ",345],["T_SWITCH","switch",346],["T_WHITESPACE"," ",346],"(",["T_VARIABLE","$paymentStatus",346],")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n                ",346],["T_COMMENT","\/\/ paid\n",347],["T_WHITESPACE","                ",348],["T_CASE","case",348],["T_WHITESPACE"," ",348],["T_STRING","Mage_Paypal_Model_Info",348],["T_DOUBLE_COLON","::",348],["T_STRING","PAYMENTSTATUS_COMPLETED",348],":",["T_WHITESPACE","\n                    ",348],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_registerPaymentCapture",349],"(",["T_STRING","true",349],")",";",["T_WHITESPACE","\n                    ",349],["T_BREAK","break",350],";",["T_WHITESPACE","\n\n                ",350],["T_COMMENT","\/\/ the holded payment was denied on paypal side\n",352],["T_WHITESPACE","                ",353],["T_CASE","case",353],["T_WHITESPACE"," ",353],["T_STRING","Mage_Paypal_Model_Info",353],["T_DOUBLE_COLON","::",353],["T_STRING","PAYMENTSTATUS_DENIED",353],":",["T_WHITESPACE","\n                    ",353],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","_registerPaymentDenial",354],"(",")",";",["T_WHITESPACE","\n                    ",354],["T_BREAK","break",355],";",["T_WHITESPACE","\n\n                ",355],["T_COMMENT","\/\/ customer attempted to pay via bank account, but failed\n",357],["T_WHITESPACE","                ",358],["T_CASE","case",358],["T_WHITESPACE"," ",358],["T_STRING","Mage_Paypal_Model_Info",358],["T_DOUBLE_COLON","::",358],["T_STRING","PAYMENTSTATUS_FAILED",358],":",["T_WHITESPACE","\n                    ",358],["T_COMMENT","\/\/ cancel order\n",359],["T_WHITESPACE","                    ",360],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","_registerPaymentFailure",360],"(",")",";",["T_WHITESPACE","\n                    ",360],["T_BREAK","break",361],";",["T_WHITESPACE","\n\n                ",361],["T_COMMENT","\/\/ payment was obtained, but money were not captured yet\n",363],["T_WHITESPACE","                ",364],["T_CASE","case",364],["T_WHITESPACE"," ",364],["T_STRING","Mage_Paypal_Model_Info",364],["T_DOUBLE_COLON","::",364],["T_STRING","PAYMENTSTATUS_PENDING",364],":",["T_WHITESPACE","\n                    ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_registerPaymentPending",365],"(",")",";",["T_WHITESPACE","\n                    ",365],["T_BREAK","break",366],";",["T_WHITESPACE","\n\n                ",366],["T_CASE","case",368],["T_WHITESPACE"," ",368],["T_STRING","Mage_Paypal_Model_Info",368],["T_DOUBLE_COLON","::",368],["T_STRING","PAYMENTSTATUS_PROCESSED",368],":",["T_WHITESPACE","\n                    ",368],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_registerMasspaymentsSuccess",369],"(",")",";",["T_WHITESPACE","\n                    ",369],["T_BREAK","break",370],";",["T_WHITESPACE","\n\n                ",370],["T_CASE","case",372],["T_WHITESPACE"," ",372],["T_STRING","Mage_Paypal_Model_Info",372],["T_DOUBLE_COLON","::",372],["T_STRING","PAYMENTSTATUS_REVERSED",372],":",["T_COMMENT","\/\/ break is intentionally omitted\n",372],["T_WHITESPACE","                ",373],["T_CASE","case",373],["T_WHITESPACE"," ",373],["T_STRING","Mage_Paypal_Model_Info",373],["T_DOUBLE_COLON","::",373],["T_STRING","PAYMENTSTATUS_UNREVERSED",373],":",["T_WHITESPACE","\n                    ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_registerPaymentReversal",374],"(",")",";",["T_WHITESPACE","\n                    ",374],["T_BREAK","break",375],";",["T_WHITESPACE","\n\n                ",375],["T_CASE","case",377],["T_WHITESPACE"," ",377],["T_STRING","Mage_Paypal_Model_Info",377],["T_DOUBLE_COLON","::",377],["T_STRING","PAYMENTSTATUS_REFUNDED",377],":",["T_WHITESPACE","\n                    ",377],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_registerPaymentRefund",378],"(",")",";",["T_WHITESPACE","\n                    ",378],["T_BREAK","break",379],";",["T_WHITESPACE","\n\n                ",379],["T_COMMENT","\/\/ authorization expire\/void\n",381],["T_WHITESPACE","                ",382],["T_CASE","case",382],["T_WHITESPACE"," ",382],["T_STRING","Mage_Paypal_Model_Info",382],["T_DOUBLE_COLON","::",382],["T_STRING","PAYMENTSTATUS_EXPIRED",382],":",["T_WHITESPACE"," ",382],["T_COMMENT","\/\/ break is intentionally omitted\n",382],["T_WHITESPACE","                ",383],["T_CASE","case",383],["T_WHITESPACE"," ",383],["T_STRING","Mage_Paypal_Model_Info",383],["T_DOUBLE_COLON","::",383],["T_STRING","PAYMENTSTATUS_VOIDED",383],":",["T_WHITESPACE","\n                    ",383],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_registerPaymentVoid",384],"(",")",";",["T_WHITESPACE","\n                    ",384],["T_BREAK","break",385],";",["T_WHITESPACE","\n\n                ",385],["T_DEFAULT","default",387],":",["T_WHITESPACE","\n                    ",387],["T_THROW","throw",388],["T_WHITESPACE"," ",388],["T_NEW","new",388],["T_WHITESPACE"," ",388],["T_STRING","Exception",388],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Cannot handle payment status '",388],["T_CURLY_OPEN","{",388],["T_VARIABLE","$paymentStatus",388],"}",["T_ENCAPSED_AND_WHITESPACE","'.",388],"\"",")",";",["T_WHITESPACE","\n            ",388],"}",["T_WHITESPACE","\n        ",389],"}",["T_WHITESPACE"," ",390],["T_CATCH","catch",390],["T_WHITESPACE"," ",390],"(",["T_STRING","Mage_Core_Exception",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$e",390],")",["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n            ",390],["T_VARIABLE","$comment",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","_createIpnComment",391],"(",["T_STRING","Mage",391],["T_DOUBLE_COLON","::",391],["T_STRING","helper",391],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",391],")",["T_OBJECT_OPERATOR","->",391],["T_STRING","__",391],"(",["T_CONSTANT_ENCAPSED_STRING","'Note: %s'",391],",",["T_WHITESPACE"," ",391],["T_VARIABLE","$e",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getMessage",391],"(",")",")",",",["T_WHITESPACE"," ",391],["T_STRING","true",391],")",";",["T_WHITESPACE","\n            ",391],["T_VARIABLE","$comment",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","save",392],"(",")",";",["T_WHITESPACE","\n            ",392],["T_THROW","throw",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$e",393],";",["T_WHITESPACE","\n        ",393],"}",["T_WHITESPACE","\n    ",394],"}",["T_WHITESPACE","\n\n    ",395],["T_DOC_COMMENT","\/**\n     * Process notification from recurring profile payments\n     *\/",397],["T_WHITESPACE","\n    ",399],["T_PROTECTED","protected",400],["T_WHITESPACE"," ",400],["T_FUNCTION","function",400],["T_WHITESPACE"," ",400],["T_STRING","_processRecurringProfile",400],"(",")",["T_WHITESPACE","\n    ",400],"{",["T_WHITESPACE","\n        ",401],["T_VARIABLE","$this",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","_recurringProfile",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_STRING","null",402],";",["T_WHITESPACE","\n        ",402],["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_getRecurringProfile",403],"(",")",";",["T_WHITESPACE","\n\n        ",403],["T_TRY","try",405],["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n            ",405],["T_COMMENT","\/\/ handle payment_status\n",406],["T_WHITESPACE","            ",407],["T_VARIABLE","$paymentStatus",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","_filterPaymentStatus",407],"(",["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","_request",407],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",407],"]",")",";",["T_WHITESPACE","\n\n            ",407],["T_SWITCH","switch",409],["T_WHITESPACE"," ",409],"(",["T_VARIABLE","$paymentStatus",409],")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n                ",409],["T_COMMENT","\/\/ paid\n",410],["T_WHITESPACE","                ",411],["T_CASE","case",411],["T_WHITESPACE"," ",411],["T_STRING","Mage_Paypal_Model_Info",411],["T_DOUBLE_COLON","::",411],["T_STRING","PAYMENTSTATUS_COMPLETED",411],":",["T_WHITESPACE","\n                    ",411],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","_registerRecurringProfilePaymentCapture",412],"(",")",";",["T_WHITESPACE","\n                    ",412],["T_BREAK","break",413],";",["T_WHITESPACE","\n\n                ",413],["T_DEFAULT","default",415],":",["T_WHITESPACE","\n                    ",415],["T_THROW","throw",416],["T_WHITESPACE"," ",416],["T_NEW","new",416],["T_WHITESPACE"," ",416],["T_STRING","Exception",416],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Cannot handle payment status '",416],["T_CURLY_OPEN","{",416],["T_VARIABLE","$paymentStatus",416],"}",["T_ENCAPSED_AND_WHITESPACE","'.",416],"\"",")",";",["T_WHITESPACE","\n            ",416],"}",["T_WHITESPACE","\n        ",417],"}",["T_WHITESPACE"," ",418],["T_CATCH","catch",418],["T_WHITESPACE"," ",418],"(",["T_STRING","Mage_Core_Exception",418],["T_WHITESPACE"," ",418],["T_VARIABLE","$e",418],")",["T_WHITESPACE"," ",418],"{",["T_WHITESPACE","\n",418],["T_COMMENT","\/\/ TODO: add to payment profile comments\n",419],["T_COMMENT","\/\/            $comment = $this->_createIpnComment(Mage::helper('paypal')->__('Note: %s', $e->getMessage()), true);\n",420],["T_COMMENT","\/\/            $comment->save();\n",421],["T_WHITESPACE","            ",422],["T_THROW","throw",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$e",422],";",["T_WHITESPACE","\n        ",422],"}",["T_WHITESPACE","\n    ",423],"}",["T_WHITESPACE","\n\n    ",424],["T_DOC_COMMENT","\/**\n     * Register recurring payment notification, create and process order\n     *\/",426],["T_WHITESPACE","\n    ",428],["T_PROTECTED","protected",429],["T_WHITESPACE"," ",429],["T_FUNCTION","function",429],["T_WHITESPACE"," ",429],["T_STRING","_registerRecurringProfilePaymentCapture",429],"(",")",["T_WHITESPACE","\n    ",429],"{",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$price",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getRequestData",431],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",431],")",["T_WHITESPACE"," ",431],"-",["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getRequestData",431],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",431],")",["T_WHITESPACE"," ",431],"-",["T_WHITESPACE","  ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getRequestData",431],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",431],")",";",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$productItemInfo",432],["T_WHITESPACE"," ",432],"=",["T_WHITESPACE"," ",432],["T_NEW","new",432],["T_WHITESPACE"," ",432],["T_STRING","Varien_Object",432],";",["T_WHITESPACE","\n        ",432],["T_VARIABLE","$type",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_STRING","trim",433],"(",["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getRequestData",433],"(",["T_CONSTANT_ENCAPSED_STRING","'period_type'",433],")",")",";",["T_WHITESPACE","\n        ",433],["T_IF","if",434],["T_WHITESPACE"," ",434],"(",["T_VARIABLE","$type",434],["T_WHITESPACE"," ",434],["T_IS_EQUAL","==",434],["T_WHITESPACE"," ",434],["T_CONSTANT_ENCAPSED_STRING","'Trial'",434],")",["T_WHITESPACE"," ",434],"{",["T_WHITESPACE","\n            ",434],["T_VARIABLE","$productItemInfo",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","setPaymentType",435],"(",["T_STRING","Mage_Sales_Model_Recurring_Profile",435],["T_DOUBLE_COLON","::",435],["T_STRING","PAYMENT_TYPE_TRIAL",435],")",";",["T_WHITESPACE","\n        ",435],"}",["T_WHITESPACE"," ",436],["T_ELSEIF","elseif",436],["T_WHITESPACE"," ",436],"(",["T_VARIABLE","$type",436],["T_WHITESPACE"," ",436],["T_IS_EQUAL","==",436],["T_WHITESPACE"," ",436],["T_CONSTANT_ENCAPSED_STRING","'Regular'",436],")",["T_WHITESPACE"," ",436],"{",["T_WHITESPACE","\n            ",436],["T_VARIABLE","$productItemInfo",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","setPaymentType",437],"(",["T_STRING","Mage_Sales_Model_Recurring_Profile",437],["T_DOUBLE_COLON","::",437],["T_STRING","PAYMENT_TYPE_REGULAR",437],")",";",["T_WHITESPACE","\n        ",437],"}",["T_WHITESPACE","\n        ",438],["T_VARIABLE","$productItemInfo",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","setTaxAmount",439],"(",["T_VARIABLE","$this",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getRequestData",439],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",439],")",")",";",["T_WHITESPACE","\n        ",439],["T_VARIABLE","$productItemInfo",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","setShippingAmount",440],"(",["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getRequestData",440],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",440],")",")",";",["T_WHITESPACE","\n        ",440],["T_VARIABLE","$productItemInfo",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","setPrice",441],"(",["T_VARIABLE","$price",441],")",";",["T_WHITESPACE","\n\n        ",441],["T_DOC_COMMENT","\/** @var $order Mage_Sales_Model_Order *\/",443],["T_WHITESPACE","\n        ",443],["T_VARIABLE","$order",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","_recurringProfile",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","createOrder",444],"(",["T_VARIABLE","$productItemInfo",444],")",";",["T_WHITESPACE","\n\n        ",444],["T_VARIABLE","$payment",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_VARIABLE","$order",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getPayment",446],"(",")",";",["T_WHITESPACE","\n        ",446],["T_VARIABLE","$payment",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","setTransactionId",447],"(",["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getRequestData",447],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",447],")",")",["T_WHITESPACE","\n            ",447],["T_OBJECT_OPERATOR","->",448],["T_STRING","setCurrencyCode",448],"(",["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","getRequestData",448],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_currency'",448],")",")",["T_WHITESPACE","\n            ",448],["T_OBJECT_OPERATOR","->",449],["T_STRING","setPreparedMessage",449],"(",["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_createIpnComment",449],"(",["T_CONSTANT_ENCAPSED_STRING","''",449],")",")",["T_WHITESPACE","\n            ",449],["T_OBJECT_OPERATOR","->",450],["T_STRING","setIsTransactionClosed",450],"(",["T_LNUMBER","0",450],")",";",["T_WHITESPACE","\n        ",450],["T_VARIABLE","$order",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","save",451],"(",")",";",["T_WHITESPACE","\n        ",451],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","_recurringProfile",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","addOrderRelation",452],"(",["T_VARIABLE","$order",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getId",452],"(",")",")",";",["T_WHITESPACE","\n        ",452],["T_VARIABLE","$payment",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","registerCaptureNotification",453],"(",["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","getRequestData",453],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",453],")",")",";",["T_WHITESPACE","\n        ",453],["T_VARIABLE","$order",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","save",454],"(",")",";",["T_WHITESPACE","\n\n        ",454],["T_VARIABLE","$invoice",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_VARIABLE","$payment",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","getCreatedInvoice",456],"(",")",";",["T_WHITESPACE","\n        ",456],["T_IF","if",457],["T_WHITESPACE"," ",457],"(",["T_VARIABLE","$invoice",457],")",["T_WHITESPACE"," ",457],"{",["T_WHITESPACE","\n            ",457],["T_COMMENT","\/\/ notify customer\n",458],["T_WHITESPACE","            ",459],["T_VARIABLE","$message",459],["T_WHITESPACE"," ",459],"=",["T_WHITESPACE"," ",459],["T_STRING","Mage",459],["T_DOUBLE_COLON","::",459],["T_STRING","helper",459],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",459],")",["T_OBJECT_OPERATOR","->",459],["T_STRING","__",459],"(",["T_CONSTANT_ENCAPSED_STRING","'Notified customer about invoice #%s.'",459],",",["T_WHITESPACE"," ",459],["T_VARIABLE","$invoice",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","getIncrementId",459],"(",")",")",";",["T_WHITESPACE","\n            ",459],["T_VARIABLE","$order",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","queueNewOrderEmail",460],"(",")",["T_OBJECT_OPERATOR","->",460],["T_STRING","addStatusHistoryComment",460],"(",["T_VARIABLE","$message",460],")",["T_WHITESPACE","\n                ",460],["T_OBJECT_OPERATOR","->",461],["T_STRING","setIsCustomerNotified",461],"(",["T_STRING","true",461],")",["T_WHITESPACE","\n                ",461],["T_OBJECT_OPERATOR","->",462],["T_STRING","save",462],"(",")",";",["T_WHITESPACE","\n        ",462],"}",["T_WHITESPACE","\n    ",463],"}",["T_WHITESPACE","\n\n    ",464],["T_DOC_COMMENT","\/**\n     * Process completed payment (either full or partial)\n     *\n     * @param bool $skipFraudDetection\n     *\/",466],["T_WHITESPACE","\n    ",470],["T_PROTECTED","protected",471],["T_WHITESPACE"," ",471],["T_FUNCTION","function",471],["T_WHITESPACE"," ",471],["T_STRING","_registerPaymentCapture",471],"(",["T_VARIABLE","$skipFraudDetection",471],["T_WHITESPACE"," ",471],"=",["T_WHITESPACE"," ",471],["T_STRING","false",471],")",["T_WHITESPACE","\n    ",471],"{",["T_WHITESPACE","\n        ",472],["T_IF","if",473],["T_WHITESPACE"," ",473],"(",["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getRequestData",473],"(",["T_CONSTANT_ENCAPSED_STRING","'transaction_entity'",473],")",["T_WHITESPACE"," ",473],["T_IS_EQUAL","==",473],["T_WHITESPACE"," ",473],["T_CONSTANT_ENCAPSED_STRING","'auth'",473],")",["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n            ",473],["T_RETURN","return",474],";",["T_WHITESPACE","\n        ",474],"}",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$parentTransactionId",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getRequestData",476],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",476],")",";",["T_WHITESPACE","\n        ",476],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","_importPaymentInformation",477],"(",")",";",["T_WHITESPACE","\n        ",477],["T_VARIABLE","$payment",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","_order",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getPayment",478],"(",")",";",["T_WHITESPACE","\n        ",478],["T_VARIABLE","$payment",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","setTransactionId",479],"(",["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getRequestData",479],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",479],")",")",["T_WHITESPACE","\n            ",479],["T_OBJECT_OPERATOR","->",480],["T_STRING","setCurrencyCode",480],"(",["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getRequestData",480],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_currency'",480],")",")",["T_WHITESPACE","\n            ",480],["T_OBJECT_OPERATOR","->",481],["T_STRING","setPreparedMessage",481],"(",["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","_createIpnComment",481],"(",["T_CONSTANT_ENCAPSED_STRING","''",481],")",")",["T_WHITESPACE","\n            ",481],["T_OBJECT_OPERATOR","->",482],["T_STRING","setParentTransactionId",482],"(",["T_VARIABLE","$parentTransactionId",482],")",["T_WHITESPACE","\n            ",482],["T_OBJECT_OPERATOR","->",483],["T_STRING","setShouldCloseParentTransaction",483],"(",["T_CONSTANT_ENCAPSED_STRING","'Completed'",483],["T_WHITESPACE"," ",483],["T_IS_IDENTICAL","===",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getRequestData",483],"(",["T_CONSTANT_ENCAPSED_STRING","'auth_status'",483],")",")",["T_WHITESPACE","\n            ",483],["T_OBJECT_OPERATOR","->",484],["T_STRING","setIsTransactionClosed",484],"(",["T_LNUMBER","0",484],")",["T_WHITESPACE","\n            ",484],["T_OBJECT_OPERATOR","->",485],["T_STRING","registerCaptureNotification",485],"(",["T_WHITESPACE","\n                ",485],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getRequestData",486],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",486],")",",",["T_WHITESPACE","\n                ",486],["T_VARIABLE","$skipFraudDetection",487],["T_WHITESPACE"," ",487],["T_BOOLEAN_AND","&&",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$parentTransactionId",487],["T_WHITESPACE","\n            ",487],")",";",["T_WHITESPACE","\n        ",488],["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","_order",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","save",489],"(",")",";",["T_WHITESPACE","\n\n        ",489],["T_COMMENT","\/\/ notify customer\n",491],["T_WHITESPACE","        ",492],["T_VARIABLE","$invoice",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_VARIABLE","$payment",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getCreatedInvoice",492],"(",")",";",["T_WHITESPACE","\n        ",492],["T_IF","if",493],["T_WHITESPACE"," ",493],"(",["T_VARIABLE","$invoice",493],["T_WHITESPACE"," ",493],["T_BOOLEAN_AND","&&",493],["T_WHITESPACE"," ",493],"!",["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","_order",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getEmailSent",493],"(",")",")",["T_WHITESPACE"," ",493],"{",["T_WHITESPACE","\n            ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","_order",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","queueNewOrderEmail",494],"(",")",["T_OBJECT_OPERATOR","->",494],["T_STRING","addStatusHistoryComment",494],"(",["T_WHITESPACE","\n                ",494],["T_STRING","Mage",495],["T_DOUBLE_COLON","::",495],["T_STRING","helper",495],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",495],")",["T_OBJECT_OPERATOR","->",495],["T_STRING","__",495],"(",["T_CONSTANT_ENCAPSED_STRING","'Notified customer about invoice #%s.'",495],",",["T_WHITESPACE"," ",495],["T_VARIABLE","$invoice",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getIncrementId",495],"(",")",")",["T_WHITESPACE","\n            ",495],")",["T_WHITESPACE","\n            ",496],["T_OBJECT_OPERATOR","->",497],["T_STRING","setIsCustomerNotified",497],"(",["T_STRING","true",497],")",["T_WHITESPACE","\n            ",497],["T_OBJECT_OPERATOR","->",498],["T_STRING","save",498],"(",")",";",["T_WHITESPACE","\n        ",498],"}",["T_WHITESPACE","\n    ",499],"}",["T_WHITESPACE","\n\n    ",500],["T_DOC_COMMENT","\/**\n     * Process denied payment notification\n     *\/",502],["T_WHITESPACE","\n    ",504],["T_PROTECTED","protected",505],["T_WHITESPACE"," ",505],["T_FUNCTION","function",505],["T_WHITESPACE"," ",505],["T_STRING","_registerPaymentDenial",505],"(",")",["T_WHITESPACE","\n    ",505],"{",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","_importPaymentInformation",507],"(",")",";",["T_WHITESPACE","\n        ",507],["T_DOC_COMMENT","\/** @var Mage_Sales_Model_Order_Payment *\/",508],["T_WHITESPACE","\n        ",508],["T_VARIABLE","$payment",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","_order",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getPayment",509],"(",")",";",["T_WHITESPACE","\n\n        ",509],["T_VARIABLE","$payment",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","setTransactionId",511],"(",["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","getRequestData",511],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",511],")",")",["T_WHITESPACE","\n            ",511],["T_OBJECT_OPERATOR","->",512],["T_STRING","setNotificationResult",512],"(",["T_STRING","true",512],")",["T_WHITESPACE","\n            ",512],["T_OBJECT_OPERATOR","->",513],["T_STRING","setIsTransactionClosed",513],"(",["T_STRING","true",513],")",";",["T_WHITESPACE","\n        ",513],["T_IF","if",514],["T_WHITESPACE"," ",514],"(","!",["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","_order",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","isCanceled",514],"(",")",")",["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n            ",514],["T_VARIABLE","$payment",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","registerPaymentReviewAction",515],"(",["T_STRING","Mage_Sales_Model_Order_Payment",515],["T_DOUBLE_COLON","::",515],["T_STRING","REVIEW_ACTION_DENY",515],",",["T_WHITESPACE"," ",515],["T_STRING","false",515],")",";",["T_WHITESPACE","\n        ",515],"}",["T_WHITESPACE"," ",516],["T_ELSE","else",516],["T_WHITESPACE"," ",516],"{",["T_WHITESPACE","\n            ",516],["T_VARIABLE","$transactionId",517],["T_WHITESPACE"," ",517],"=",["T_WHITESPACE"," ",517],["T_STRING","Mage",517],["T_DOUBLE_COLON","::",517],["T_STRING","helper",517],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",517],")",["T_OBJECT_OPERATOR","->",517],["T_STRING","getHtmlTransactionId",517],"(",["T_WHITESPACE","\n                ",517],["T_VARIABLE","$payment",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getMethodInstance",518],"(",")",["T_OBJECT_OPERATOR","->",518],["T_STRING","getCode",518],"(",")",",",["T_WHITESPACE","\n                ",518],["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getRequestData",519],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",519],")",["T_WHITESPACE","\n            ",519],")",";",["T_WHITESPACE","\n            ",520],["T_VARIABLE","$comment",521],["T_WHITESPACE"," ",521],"=",["T_WHITESPACE"," ",521],["T_STRING","Mage",521],["T_DOUBLE_COLON","::",521],["T_STRING","helper",521],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",521],")",["T_OBJECT_OPERATOR","->",521],["T_STRING","__",521],"(",["T_CONSTANT_ENCAPSED_STRING","'Transaction ID: \"%s\"'",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$transactionId",521],")",";",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_order",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","addStatusHistoryComment",522],"(",["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_createIpnComment",522],"(",["T_VARIABLE","$comment",522],")",",",["T_WHITESPACE"," ",522],["T_STRING","false",522],")",";",["T_WHITESPACE","\n        ",522],"}",["T_WHITESPACE","\n\n        ",523],["T_VARIABLE","$this",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","_order",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","save",525],"(",")",";",["T_WHITESPACE","\n    ",525],"}",["T_WHITESPACE","\n\n    ",526],["T_DOC_COMMENT","\/**\n     * Treat failed payment as order cancellation\n     *\/",528],["T_WHITESPACE","\n    ",530],["T_PROTECTED","protected",531],["T_WHITESPACE"," ",531],["T_FUNCTION","function",531],["T_WHITESPACE"," ",531],["T_STRING","_registerPaymentFailure",531],"(",")",["T_WHITESPACE","\n    ",531],"{",["T_WHITESPACE","\n        ",532],["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","_importPaymentInformation",533],"(",")",";",["T_WHITESPACE","\n        ",533],["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","_order",534],["T_WHITESPACE","\n            ",534],["T_OBJECT_OPERATOR","->",535],["T_STRING","registerCancellation",535],"(",["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","_createIpnComment",535],"(",["T_CONSTANT_ENCAPSED_STRING","''",535],")",",",["T_WHITESPACE"," ",535],["T_STRING","false",535],")",["T_WHITESPACE","\n            ",535],["T_OBJECT_OPERATOR","->",536],["T_STRING","save",536],"(",")",";",["T_WHITESPACE","\n    ",536],"}",["T_WHITESPACE","\n\n    ",537],["T_DOC_COMMENT","\/**\n     * Process a refund or a chargeback\n     *\/",539],["T_WHITESPACE","\n    ",541],["T_PROTECTED","protected",542],["T_WHITESPACE"," ",542],["T_FUNCTION","function",542],["T_WHITESPACE"," ",542],["T_STRING","_registerPaymentRefund",542],"(",")",["T_WHITESPACE","\n    ",542],"{",["T_WHITESPACE","\n        ",543],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","_importPaymentInformation",544],"(",")",";",["T_WHITESPACE","\n        ",544],["T_VARIABLE","$reason",545],["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","getRequestData",545],"(",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",545],")",";",["T_WHITESPACE","\n        ",545],["T_VARIABLE","$isRefundFinal",546],["T_WHITESPACE"," ",546],"=",["T_WHITESPACE"," ",546],"!",["T_VARIABLE","$this",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","_info",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","isReversalDisputable",546],"(",["T_VARIABLE","$reason",546],")",";",["T_WHITESPACE","\n\n        ",546],["T_DOC_COMMENT","\/** @var Mage_Sales_Model_Order_Payment $payment *\/",548],["T_WHITESPACE","\n        ",548],["T_VARIABLE","$payment",549],["T_WHITESPACE"," ",549],"=",["T_WHITESPACE"," ",549],["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","_order",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getPayment",549],"(",")",";",["T_WHITESPACE","\n\n        ",549],["T_VARIABLE","$amount",551],["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_order",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","getBaseCurrency",551],"(",")",["T_OBJECT_OPERATOR","->",551],["T_STRING","formatTxt",551],"(",["T_VARIABLE","$payment",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","getBaseAmountRefundedOnline",551],"(",")",")",";",["T_WHITESPACE","\n\n        ",551],["T_VARIABLE","$transactionId",553],["T_WHITESPACE"," ",553],"=",["T_WHITESPACE"," ",553],["T_STRING","Mage",553],["T_DOUBLE_COLON","::",553],["T_STRING","helper",553],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",553],")",["T_OBJECT_OPERATOR","->",553],["T_STRING","getHtmlTransactionId",553],"(",["T_WHITESPACE","\n            ",553],["T_VARIABLE","$payment",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","getMethodInstance",554],"(",")",["T_OBJECT_OPERATOR","->",554],["T_STRING","getCode",554],"(",")",",",["T_WHITESPACE","\n            ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","getRequestData",555],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",555],")",["T_WHITESPACE","\n        ",555],")",";",["T_WHITESPACE","\n        ",556],["T_VARIABLE","$comment",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_createIpnComment",557],"(",["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_info",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","explainReasonCode",557],"(",["T_VARIABLE","$reason",557],")",")",["T_WHITESPACE","\n            ",557],".",["T_WHITESPACE"," ",558],["T_CONSTANT_ENCAPSED_STRING","' '",558],["T_WHITESPACE","\n            ",558],".",["T_WHITESPACE"," ",559],["T_STRING","Mage",559],["T_DOUBLE_COLON","::",559],["T_STRING","helper",559],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",559],")",["T_OBJECT_OPERATOR","->",559],["T_STRING","__",559],"(",["T_CONSTANT_ENCAPSED_STRING","'Refunded amount of %s. Transaction ID: \"%s\"'",559],",",["T_WHITESPACE"," ",559],["T_VARIABLE","$amount",559],",",["T_WHITESPACE"," ",559],["T_VARIABLE","$transactionId",559],")",";",["T_WHITESPACE","\n\n        ",559],["T_VARIABLE","$payment",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","setPreparedMessage",561],"(",["T_VARIABLE","$comment",561],")",["T_WHITESPACE","\n            ",561],["T_OBJECT_OPERATOR","->",562],["T_STRING","setTransactionId",562],"(",["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","getRequestData",562],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",562],")",")",["T_WHITESPACE","\n            ",562],["T_OBJECT_OPERATOR","->",563],["T_STRING","setParentTransactionId",563],"(",["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","getRequestData",563],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",563],")",")",["T_WHITESPACE","\n            ",563],["T_OBJECT_OPERATOR","->",564],["T_STRING","setIsTransactionClosed",564],"(",["T_VARIABLE","$isRefundFinal",564],")",["T_WHITESPACE","\n            ",564],["T_OBJECT_OPERATOR","->",565],["T_STRING","registerRefundNotification",565],"(","-",["T_LNUMBER","1",565],["T_WHITESPACE"," ",565],"*",["T_WHITESPACE"," ",565],["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","getRequestData",565],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",565],")",")",";",["T_WHITESPACE","\n        ",565],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","_order",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","addStatusHistoryComment",566],"(",["T_VARIABLE","$comment",566],",",["T_WHITESPACE"," ",566],["T_STRING","false",566],")",";",["T_WHITESPACE","\n        ",566],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","_order",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","save",567],"(",")",";",["T_WHITESPACE","\n\n        ",567],["T_COMMENT","\/\/ TODO: there is no way to close a capture right now\n",569],["T_WHITESPACE","        ",570],["T_VARIABLE","$creditmemo",570],["T_WHITESPACE"," ",570],"=",["T_WHITESPACE"," ",570],["T_VARIABLE","$payment",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","getCreatedCreditmemo",570],"(",")",";",["T_WHITESPACE","\n        ",570],["T_IF","if",571],["T_WHITESPACE"," ",571],"(",["T_VARIABLE","$creditmemo",571],")",["T_WHITESPACE"," ",571],"{",["T_WHITESPACE","\n            ",571],["T_VARIABLE","$creditmemo",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","sendEmail",572],"(",")",";",["T_WHITESPACE","\n            ",572],["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","_order",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","addStatusHistoryComment",573],"(",["T_WHITESPACE","\n                ",573],["T_STRING","Mage",574],["T_DOUBLE_COLON","::",574],["T_STRING","helper",574],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",574],")",["T_OBJECT_OPERATOR","->",574],["T_STRING","__",574],"(",["T_CONSTANT_ENCAPSED_STRING","'Notified customer about creditmemo #%s.'",574],",",["T_WHITESPACE"," ",574],["T_VARIABLE","$creditmemo",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","getIncrementId",574],"(",")",")",["T_WHITESPACE","\n            ",574],")",["T_WHITESPACE","\n            ",575],["T_OBJECT_OPERATOR","->",576],["T_STRING","setIsCustomerNotified",576],"(",["T_STRING","true",576],")",["T_WHITESPACE","\n            ",576],["T_OBJECT_OPERATOR","->",577],["T_STRING","save",577],"(",")",";",["T_WHITESPACE","\n        ",577],"}",["T_WHITESPACE","\n    ",578],"}",["T_WHITESPACE","\n\n    ",579],["T_DOC_COMMENT","\/**\n     * Process payment reversal and cancelled reversal notification\n     *\/",581],["T_WHITESPACE","\n    ",583],["T_PROTECTED","protected",584],["T_WHITESPACE"," ",584],["T_FUNCTION","function",584],["T_WHITESPACE"," ",584],["T_STRING","_registerPaymentReversal",584],"(",")",["T_WHITESPACE","\n    ",584],"{",["T_WHITESPACE","\n        ",585],["T_VARIABLE","$reasonCode",586],["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_ISSET","isset",586],"(",["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","_request",586],"[",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",586],"]",")",["T_WHITESPACE"," ",586],"?",["T_WHITESPACE"," ",586],["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","_request",586],"[",["T_CONSTANT_ENCAPSED_STRING","'reason_code'",586],"]",["T_WHITESPACE"," ",586],":",["T_WHITESPACE"," ",586],["T_STRING","null",586],";",["T_WHITESPACE","\n        ",586],["T_VARIABLE","$reasonComment",587],["T_WHITESPACE"," ",587],"=",["T_WHITESPACE"," ",587],["T_VARIABLE","$this",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","_info",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","explainReasonCode",587],"(",["T_VARIABLE","$reasonCode",587],")",";",["T_WHITESPACE","\n        ",587],["T_VARIABLE","$notificationAmount",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","_order",588],["T_WHITESPACE","\n            ",588],["T_OBJECT_OPERATOR","->",589],["T_STRING","getBaseCurrency",589],"(",")",["T_WHITESPACE","\n            ",589],["T_OBJECT_OPERATOR","->",590],["T_STRING","formatTxt",590],"(",["T_VARIABLE","$this",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","_request",590],"[",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",590],"]",["T_WHITESPACE"," ",590],"+",["T_WHITESPACE"," ",590],["T_VARIABLE","$this",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","_request",590],"[",["T_CONSTANT_ENCAPSED_STRING","'mc_fee'",590],"]",")",";",["T_WHITESPACE","\n        ",590],["T_VARIABLE","$paymentStatus",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_filterPaymentStatus",591],"(",["T_ISSET","isset",591],"(",["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_request",591],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",591],"]",")",["T_WHITESPACE","\n            ",591],"?",["T_WHITESPACE"," ",592],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","_request",592],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",592],"]",["T_WHITESPACE","\n            ",592],":",["T_WHITESPACE"," ",593],["T_STRING","null",593],["T_WHITESPACE","\n        ",593],")",";",["T_WHITESPACE","\n        ",594],["T_VARIABLE","$orderStatus",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],"(",["T_VARIABLE","$paymentStatus",595],["T_WHITESPACE"," ",595],["T_IS_EQUAL","==",595],["T_WHITESPACE"," ",595],["T_STRING","Mage_Paypal_Model_Info",595],["T_DOUBLE_COLON","::",595],["T_STRING","PAYMENTSTATUS_REVERSED",595],")",["T_WHITESPACE","\n            ",595],"?",["T_WHITESPACE"," ",596],["T_STRING","Mage_Paypal_Model_Info",596],["T_DOUBLE_COLON","::",596],["T_STRING","ORDER_STATUS_REVERSED",596],["T_WHITESPACE","\n            ",596],":",["T_WHITESPACE"," ",597],["T_STRING","Mage_Paypal_Model_Info",597],["T_DOUBLE_COLON","::",597],["T_STRING","ORDER_STATUS_CANCELED_REVERSAL",597],";",["T_WHITESPACE","\n        ",597],["T_DOC_COMMENT","\/**\n         * Change order status to PayPal Reversed\/PayPal Cancelled Reversal if it is possible.\n         *\/",598],["T_WHITESPACE","\n        ",600],["T_VARIABLE","$transactionId",601],["T_WHITESPACE"," ",601],"=",["T_WHITESPACE"," ",601],["T_STRING","Mage",601],["T_DOUBLE_COLON","::",601],["T_STRING","helper",601],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",601],")",["T_OBJECT_OPERATOR","->",601],["T_STRING","getHtmlTransactionId",601],"(",["T_WHITESPACE","\n            ",601],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","_config",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getMethodCode",602],"(",")",",",["T_WHITESPACE","\n            ",602],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","_request",603],"[",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",603],"]",["T_WHITESPACE","\n        ",603],")",";",["T_WHITESPACE","\n        ",604],["T_VARIABLE","$message",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_STRING","Mage",605],["T_DOUBLE_COLON","::",605],["T_STRING","helper",605],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",605],")",["T_OBJECT_OPERATOR","->",605],["T_STRING","__",605],"(",["T_CONSTANT_ENCAPSED_STRING","'IPN \"%s\". %s Transaction amount %s. Transaction ID: \"%s\"'",605],",",["T_WHITESPACE"," ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","_request",605],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",605],"]",",",["T_WHITESPACE"," ",605],["T_VARIABLE","$reasonComment",605],",",["T_WHITESPACE"," ",605],["T_VARIABLE","$notificationAmount",605],",",["T_WHITESPACE"," ",605],["T_VARIABLE","$transactionId",605],")",";",["T_WHITESPACE","\n        ",605],["T_VARIABLE","$this",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","_order",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","setStatus",606],"(",["T_VARIABLE","$orderStatus",606],")",";",["T_WHITESPACE","\n        ",606],["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","_order",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","save",607],"(",")",";",["T_WHITESPACE","\n        ",607],["T_VARIABLE","$this",608],["T_OBJECT_OPERATOR","->",608],["T_STRING","_order",608],["T_OBJECT_OPERATOR","->",608],["T_STRING","addStatusHistoryComment",608],"(",["T_VARIABLE","$message",608],",",["T_WHITESPACE"," ",608],["T_VARIABLE","$orderStatus",608],")",["T_WHITESPACE","\n            ",608],["T_OBJECT_OPERATOR","->",609],["T_STRING","setIsCustomerNotified",609],"(",["T_STRING","false",609],")",["T_WHITESPACE","\n            ",609],["T_OBJECT_OPERATOR","->",610],["T_STRING","save",610],"(",")",";",["T_WHITESPACE","\n    ",610],"}",["T_WHITESPACE","\n\n    ",611],["T_DOC_COMMENT","\/**\n     * Process payment pending notification\n     *\n     * @throws Exception\n     *\/",613],["T_WHITESPACE","\n    ",617],["T_PUBLIC","public",618],["T_WHITESPACE"," ",618],["T_FUNCTION","function",618],["T_WHITESPACE"," ",618],["T_STRING","_registerPaymentPending",618],"(",")",["T_WHITESPACE","\n    ",618],"{",["T_WHITESPACE","\n        ",619],["T_VARIABLE","$reason",620],["T_WHITESPACE"," ",620],"=",["T_WHITESPACE"," ",620],["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","getRequestData",620],"(",["T_CONSTANT_ENCAPSED_STRING","'pending_reason'",620],")",";",["T_WHITESPACE","\n        ",620],["T_IF","if",621],["T_WHITESPACE"," ",621],"(",["T_CONSTANT_ENCAPSED_STRING","'authorization'",621],["T_WHITESPACE"," ",621],["T_IS_IDENTICAL","===",621],["T_WHITESPACE"," ",621],["T_VARIABLE","$reason",621],")",["T_WHITESPACE"," ",621],"{",["T_WHITESPACE","\n            ",621],["T_VARIABLE","$this",622],["T_OBJECT_OPERATOR","->",622],["T_STRING","_registerPaymentAuthorization",622],"(",")",";",["T_WHITESPACE","\n            ",622],["T_RETURN","return",623],";",["T_WHITESPACE","\n        ",623],"}",["T_WHITESPACE","\n        ",624],["T_IF","if",625],["T_WHITESPACE"," ",625],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",625],["T_WHITESPACE"," ",625],["T_IS_IDENTICAL","===",625],["T_WHITESPACE"," ",625],["T_VARIABLE","$reason",625],")",["T_WHITESPACE"," ",625],"{",["T_WHITESPACE","\n            ",625],["T_THROW","throw",626],["T_WHITESPACE"," ",626],["T_NEW","new",626],["T_WHITESPACE"," ",626],["T_STRING","Exception",626],"(",["T_CONSTANT_ENCAPSED_STRING","'The \"order\" authorizations are not implemented.'",626],")",";",["T_WHITESPACE","\n        ",626],"}",["T_WHITESPACE","\n\n        ",627],["T_COMMENT","\/\/ case when was placed using PayPal standard\n",629],["T_WHITESPACE","        ",630],["T_IF","if",630],["T_WHITESPACE"," ",630],"(",["T_STRING","Mage_Sales_Model_Order",630],["T_DOUBLE_COLON","::",630],["T_STRING","STATE_PENDING_PAYMENT",630],["T_WHITESPACE"," ",630],["T_IS_EQUAL","==",630],["T_WHITESPACE"," ",630],["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","_order",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","getState",630],"(",")",["T_WHITESPACE","\n            ",630],["T_BOOLEAN_AND","&&",631],["T_WHITESPACE"," ",631],"!",["T_VARIABLE","$this",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","getRequestData",631],"(",["T_CONSTANT_ENCAPSED_STRING","'transaction_entity'",631],")",["T_WHITESPACE","\n        ",631],")",["T_WHITESPACE"," ",632],"{",["T_WHITESPACE","\n            ",632],["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","_registerPaymentCapture",633],"(",")",";",["T_WHITESPACE","\n            ",633],["T_RETURN","return",634],";",["T_WHITESPACE","\n        ",634],"}",["T_WHITESPACE","\n\n        ",635],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_importPaymentInformation",637],"(",")",";",["T_WHITESPACE","\n\n        ",637],["T_VARIABLE","$this",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","_order",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","getPayment",639],"(",")",["T_WHITESPACE","\n            ",639],["T_OBJECT_OPERATOR","->",640],["T_STRING","setPreparedMessage",640],"(",["T_VARIABLE","$this",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","_createIpnComment",640],"(",["T_VARIABLE","$this",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","_info",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","explainPendingReason",640],"(",["T_VARIABLE","$reason",640],")",")",")",["T_WHITESPACE","\n            ",640],["T_OBJECT_OPERATOR","->",641],["T_STRING","setTransactionId",641],"(",["T_VARIABLE","$this",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","getRequestData",641],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",641],")",")",["T_WHITESPACE","\n            ",641],["T_OBJECT_OPERATOR","->",642],["T_STRING","setIsTransactionClosed",642],"(",["T_LNUMBER","0",642],")",["T_WHITESPACE","\n            ",642],["T_OBJECT_OPERATOR","->",643],["T_STRING","registerPaymentReviewAction",643],"(",["T_STRING","Mage_Sales_Model_Order_Payment",643],["T_DOUBLE_COLON","::",643],["T_STRING","REVIEW_ACTION_UPDATE",643],",",["T_WHITESPACE"," ",643],["T_STRING","false",643],")",";",["T_WHITESPACE","\n        ",643],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","_order",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","save",644],"(",")",";",["T_WHITESPACE","\n    ",644],"}",["T_WHITESPACE","\n\n    ",645],["T_DOC_COMMENT","\/**\n     * Register authorized payment\n     *\/",647],["T_WHITESPACE","\n    ",649],["T_PROTECTED","protected",650],["T_WHITESPACE"," ",650],["T_FUNCTION","function",650],["T_WHITESPACE"," ",650],["T_STRING","_registerPaymentAuthorization",650],"(",")",["T_WHITESPACE","\n    ",650],"{",["T_WHITESPACE","\n        ",651],["T_VARIABLE","$this",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","_importPaymentInformation",652],"(",")",";",["T_WHITESPACE","\n\n        ",652],["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","_order",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","getPayment",654],"(",")",["T_WHITESPACE","\n            ",654],["T_OBJECT_OPERATOR","->",655],["T_STRING","setPreparedMessage",655],"(",["T_VARIABLE","$this",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","_createIpnComment",655],"(",["T_CONSTANT_ENCAPSED_STRING","''",655],")",")",["T_WHITESPACE","\n            ",655],["T_OBJECT_OPERATOR","->",656],["T_STRING","setTransactionId",656],"(",["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getRequestData",656],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",656],")",")",["T_WHITESPACE","\n            ",656],["T_OBJECT_OPERATOR","->",657],["T_STRING","setParentTransactionId",657],"(",["T_VARIABLE","$this",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","getRequestData",657],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",657],")",")",["T_WHITESPACE","\n            ",657],["T_OBJECT_OPERATOR","->",658],["T_STRING","setCurrencyCode",658],"(",["T_VARIABLE","$this",658],["T_OBJECT_OPERATOR","->",658],["T_STRING","getRequestData",658],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_currency'",658],")",")",["T_WHITESPACE","\n            ",658],["T_OBJECT_OPERATOR","->",659],["T_STRING","setIsTransactionClosed",659],"(",["T_LNUMBER","0",659],")",["T_WHITESPACE","\n            ",659],["T_OBJECT_OPERATOR","->",660],["T_STRING","registerAuthorizationNotification",660],"(",["T_VARIABLE","$this",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","getRequestData",660],"(",["T_CONSTANT_ENCAPSED_STRING","'mc_gross'",660],")",")",";",["T_WHITESPACE","\n\n        ",660],["T_IF","if",662],["T_WHITESPACE"," ",662],"(","!",["T_VARIABLE","$this",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","_order",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","getEmailSent",662],"(",")",")",["T_WHITESPACE"," ",662],"{",["T_WHITESPACE","\n            ",662],["T_VARIABLE","$this",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","_order",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","queueNewOrderEmail",663],"(",")",";",["T_WHITESPACE","\n        ",663],"}",["T_WHITESPACE","\n        ",664],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","_order",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","save",665],"(",")",";",["T_WHITESPACE","\n    ",665],"}",["T_WHITESPACE","\n\n    ",666],["T_DOC_COMMENT","\/**\n     * Process voided authorization\n     *\/",668],["T_WHITESPACE","\n    ",670],["T_PROTECTED","protected",671],["T_WHITESPACE"," ",671],["T_FUNCTION","function",671],["T_WHITESPACE"," ",671],["T_STRING","_registerPaymentVoid",671],"(",")",["T_WHITESPACE","\n    ",671],"{",["T_WHITESPACE","\n        ",672],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","_importPaymentInformation",673],"(",")",";",["T_WHITESPACE","\n\n        ",673],["T_VARIABLE","$parentTxnId",675],["T_WHITESPACE"," ",675],"=",["T_WHITESPACE"," ",675],["T_VARIABLE","$this",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getRequestData",675],"(",["T_CONSTANT_ENCAPSED_STRING","'transaction_entity'",675],")",["T_WHITESPACE"," ",675],["T_IS_EQUAL","==",675],["T_WHITESPACE"," ",675],["T_CONSTANT_ENCAPSED_STRING","'auth'",675],["T_WHITESPACE","\n            ",675],"?",["T_WHITESPACE"," ",676],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getRequestData",676],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",676],")",["T_WHITESPACE"," ",676],":",["T_WHITESPACE"," ",676],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getRequestData",676],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",676],")",";",["T_WHITESPACE","\n\n        ",676],["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","_order",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getPayment",678],"(",")",["T_WHITESPACE","\n            ",678],["T_OBJECT_OPERATOR","->",679],["T_STRING","setPreparedMessage",679],"(",["T_VARIABLE","$this",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","_createIpnComment",679],"(",["T_CONSTANT_ENCAPSED_STRING","''",679],")",")",["T_WHITESPACE","\n            ",679],["T_OBJECT_OPERATOR","->",680],["T_STRING","setParentTransactionId",680],"(",["T_VARIABLE","$parentTxnId",680],")",["T_WHITESPACE","\n            ",680],["T_OBJECT_OPERATOR","->",681],["T_STRING","registerVoidNotification",681],"(",")",";",["T_WHITESPACE","\n\n        ",681],["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","_order",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","save",683],"(",")",";",["T_WHITESPACE","\n    ",683],"}",["T_WHITESPACE","\n\n    ",684],["T_DOC_COMMENT","\/**\n     * TODO\n     * The status \"Processed\" is used when all Masspayments are successful\n     *\/",686],["T_WHITESPACE","\n    ",689],["T_PROTECTED","protected",690],["T_WHITESPACE"," ",690],["T_FUNCTION","function",690],["T_WHITESPACE"," ",690],["T_STRING","_registerMasspaymentsSuccess",690],"(",")",["T_WHITESPACE","\n    ",690],"{",["T_WHITESPACE","\n        ",691],["T_VARIABLE","$comment",692],["T_WHITESPACE"," ",692],"=",["T_WHITESPACE"," ",692],["T_VARIABLE","$this",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","_createIpnComment",692],"(",["T_CONSTANT_ENCAPSED_STRING","''",692],",",["T_WHITESPACE"," ",692],["T_STRING","true",692],")",";",["T_WHITESPACE","\n        ",692],["T_VARIABLE","$comment",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","save",693],"(",")",";",["T_WHITESPACE","\n    ",693],"}",["T_WHITESPACE","\n\n    ",694],["T_DOC_COMMENT","\/**\n     * Generate an \"IPN\" comment with additional explanation.\n     * Returns the generated comment or order status history object\n     *\n     * @param string $comment\n     * @param bool $addToHistory\n     * @return string|Mage_Sales_Model_Order_Status_History\n     *\/",696],["T_WHITESPACE","\n    ",703],["T_PROTECTED","protected",704],["T_WHITESPACE"," ",704],["T_FUNCTION","function",704],["T_WHITESPACE"," ",704],["T_STRING","_createIpnComment",704],"(",["T_VARIABLE","$comment",704],["T_WHITESPACE"," ",704],"=",["T_WHITESPACE"," ",704],["T_CONSTANT_ENCAPSED_STRING","''",704],",",["T_WHITESPACE"," ",704],["T_VARIABLE","$addToHistory",704],["T_WHITESPACE"," ",704],"=",["T_WHITESPACE"," ",704],["T_STRING","false",704],")",["T_WHITESPACE","\n    ",704],"{",["T_WHITESPACE","\n        ",705],["T_VARIABLE","$paymentStatus",706],["T_WHITESPACE"," ",706],"=",["T_WHITESPACE"," ",706],["T_VARIABLE","$this",706],["T_OBJECT_OPERATOR","->",706],["T_STRING","getRequestData",706],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",706],")",";",["T_WHITESPACE","\n        ",706],["T_VARIABLE","$message",707],["T_WHITESPACE"," ",707],"=",["T_WHITESPACE"," ",707],["T_STRING","Mage",707],["T_DOUBLE_COLON","::",707],["T_STRING","helper",707],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",707],")",["T_OBJECT_OPERATOR","->",707],["T_STRING","__",707],"(",["T_CONSTANT_ENCAPSED_STRING","'IPN \"%s\".'",707],",",["T_WHITESPACE"," ",707],["T_VARIABLE","$paymentStatus",707],")",";",["T_WHITESPACE","\n        ",707],["T_IF","if",708],["T_WHITESPACE"," ",708],"(",["T_VARIABLE","$comment",708],")",["T_WHITESPACE"," ",708],"{",["T_WHITESPACE","\n            ",708],["T_VARIABLE","$message",709],["T_WHITESPACE"," ",709],["T_CONCAT_EQUAL",".=",709],["T_WHITESPACE"," ",709],["T_CONSTANT_ENCAPSED_STRING","' '",709],["T_WHITESPACE"," ",709],".",["T_WHITESPACE"," ",709],["T_VARIABLE","$comment",709],";",["T_WHITESPACE","\n        ",709],"}",["T_WHITESPACE","\n        ",710],["T_IF","if",711],["T_WHITESPACE"," ",711],"(",["T_VARIABLE","$addToHistory",711],")",["T_WHITESPACE"," ",711],"{",["T_WHITESPACE","\n            ",711],["T_VARIABLE","$message",712],["T_WHITESPACE"," ",712],"=",["T_WHITESPACE"," ",712],["T_VARIABLE","$this",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","_order",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","addStatusHistoryComment",712],"(",["T_VARIABLE","$message",712],")",";",["T_WHITESPACE","\n            ",712],["T_VARIABLE","$message",713],["T_OBJECT_OPERATOR","->",713],["T_STRING","setIsCustomerNotified",713],"(",["T_STRING","null",713],")",";",["T_WHITESPACE","\n        ",713],"}",["T_WHITESPACE","\n        ",714],["T_RETURN","return",715],["T_WHITESPACE"," ",715],["T_VARIABLE","$message",715],";",["T_WHITESPACE","\n    ",715],"}",["T_WHITESPACE","\n\n    ",716],["T_DOC_COMMENT","\/**\n     * Map payment information from IPN to payment object\n     * Returns true if there were changes in information\n     *\n     * @param Mage_Payment_Model_Info $payment\n     * @return bool\n     *\/",718],["T_WHITESPACE","\n    ",724],["T_PROTECTED","protected",725],["T_WHITESPACE"," ",725],["T_FUNCTION","function",725],["T_WHITESPACE"," ",725],["T_STRING","_importPaymentInformation",725],"(",")",["T_WHITESPACE","\n    ",725],"{",["T_WHITESPACE","\n        ",726],["T_VARIABLE","$payment",727],["T_WHITESPACE"," ",727],"=",["T_WHITESPACE"," ",727],["T_VARIABLE","$this",727],["T_OBJECT_OPERATOR","->",727],["T_STRING","_order",727],["T_OBJECT_OPERATOR","->",727],["T_STRING","getPayment",727],"(",")",";",["T_WHITESPACE","\n        ",727],["T_VARIABLE","$was",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_VARIABLE","$payment",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","getAdditionalInformation",728],"(",")",";",["T_WHITESPACE","\n\n        ",728],["T_COMMENT","\/\/ collect basic information\n",730],["T_WHITESPACE","        ",731],["T_VARIABLE","$from",731],["T_WHITESPACE"," ",731],"=",["T_WHITESPACE"," ",731],["T_ARRAY","array",731],"(",")",";",["T_WHITESPACE","\n        ",731],["T_FOREACH","foreach",732],["T_WHITESPACE"," ",732],"(",["T_ARRAY","array",732],"(",["T_WHITESPACE","\n            ",732],["T_STRING","Mage_Paypal_Model_Info",733],["T_DOUBLE_COLON","::",733],["T_STRING","PAYER_ID",733],",",["T_WHITESPACE","\n            ",733],["T_CONSTANT_ENCAPSED_STRING","'payer_email'",734],["T_WHITESPACE"," ",734],["T_DOUBLE_ARROW","=>",734],["T_WHITESPACE"," ",734],["T_STRING","Mage_Paypal_Model_Info",734],["T_DOUBLE_COLON","::",734],["T_STRING","PAYER_EMAIL",734],",",["T_WHITESPACE","\n            ",734],["T_STRING","Mage_Paypal_Model_Info",735],["T_DOUBLE_COLON","::",735],["T_STRING","PAYER_STATUS",735],",",["T_WHITESPACE","\n            ",735],["T_STRING","Mage_Paypal_Model_Info",736],["T_DOUBLE_COLON","::",736],["T_STRING","ADDRESS_STATUS",736],",",["T_WHITESPACE","\n            ",736],["T_STRING","Mage_Paypal_Model_Info",737],["T_DOUBLE_COLON","::",737],["T_STRING","PROTECTION_EL",737],",",["T_WHITESPACE","\n            ",737],["T_STRING","Mage_Paypal_Model_Info",738],["T_DOUBLE_COLON","::",738],["T_STRING","PAYMENT_STATUS",738],",",["T_WHITESPACE","\n            ",738],["T_STRING","Mage_Paypal_Model_Info",739],["T_DOUBLE_COLON","::",739],["T_STRING","PENDING_REASON",739],",",["T_WHITESPACE","\n        ",739],")",["T_WHITESPACE"," ",740],["T_AS","as",740],["T_WHITESPACE"," ",740],["T_VARIABLE","$privateKey",740],["T_WHITESPACE"," ",740],["T_DOUBLE_ARROW","=>",740],["T_WHITESPACE"," ",740],["T_VARIABLE","$publicKey",740],")",["T_WHITESPACE"," ",740],"{",["T_WHITESPACE","\n            ",740],["T_IF","if",741],["T_WHITESPACE"," ",741],"(",["T_STRING","is_int",741],"(",["T_VARIABLE","$privateKey",741],")",")",["T_WHITESPACE"," ",741],"{",["T_WHITESPACE","\n                ",741],["T_VARIABLE","$privateKey",742],["T_WHITESPACE"," ",742],"=",["T_WHITESPACE"," ",742],["T_VARIABLE","$publicKey",742],";",["T_WHITESPACE","\n            ",742],"}",["T_WHITESPACE","\n            ",743],["T_VARIABLE","$value",744],["T_WHITESPACE"," ",744],"=",["T_WHITESPACE"," ",744],["T_VARIABLE","$this",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","getRequestData",744],"(",["T_VARIABLE","$privateKey",744],")",";",["T_WHITESPACE","\n            ",744],["T_IF","if",745],["T_WHITESPACE"," ",745],"(",["T_VARIABLE","$value",745],")",["T_WHITESPACE"," ",745],"{",["T_WHITESPACE","\n                ",745],["T_VARIABLE","$from",746],"[",["T_VARIABLE","$publicKey",746],"]",["T_WHITESPACE"," ",746],"=",["T_WHITESPACE"," ",746],["T_VARIABLE","$value",746],";",["T_WHITESPACE","\n            ",746],"}",["T_WHITESPACE","\n        ",747],"}",["T_WHITESPACE","\n        ",748],["T_IF","if",749],["T_WHITESPACE"," ",749],"(",["T_ISSET","isset",749],"(",["T_VARIABLE","$from",749],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",749],"]",")",")",["T_WHITESPACE"," ",749],"{",["T_WHITESPACE","\n            ",749],["T_VARIABLE","$from",750],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",750],"]",["T_WHITESPACE"," ",750],"=",["T_WHITESPACE"," ",750],["T_VARIABLE","$this",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","_filterPaymentStatus",750],"(",["T_VARIABLE","$this",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","getRequestData",750],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_status'",750],")",")",";",["T_WHITESPACE","\n        ",750],"}",["T_WHITESPACE","\n\n        ",751],["T_COMMENT","\/\/ collect fraud filters\n",753],["T_WHITESPACE","        ",754],["T_VARIABLE","$fraudFilters",754],["T_WHITESPACE"," ",754],"=",["T_WHITESPACE"," ",754],["T_ARRAY","array",754],"(",")",";",["T_WHITESPACE","\n        ",754],["T_FOR","for",755],["T_WHITESPACE"," ",755],"(",["T_VARIABLE","$i",755],["T_WHITESPACE"," ",755],"=",["T_WHITESPACE"," ",755],["T_LNUMBER","1",755],";",["T_WHITESPACE"," ",755],["T_VARIABLE","$value",755],["T_WHITESPACE"," ",755],"=",["T_WHITESPACE"," ",755],["T_VARIABLE","$this",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","getRequestData",755],"(","\"",["T_ENCAPSED_AND_WHITESPACE","fraud_management_pending_filters_",755],["T_CURLY_OPEN","{",755],["T_VARIABLE","$i",755],"}","\"",")",";",["T_WHITESPACE"," ",755],["T_VARIABLE","$i",755],["T_INC","++",755],")",["T_WHITESPACE"," ",755],"{",["T_WHITESPACE","\n            ",755],["T_VARIABLE","$fraudFilters",756],"[","]",["T_WHITESPACE"," ",756],"=",["T_WHITESPACE"," ",756],["T_VARIABLE","$value",756],";",["T_WHITESPACE","\n        ",756],"}",["T_WHITESPACE","\n        ",757],["T_IF","if",758],["T_WHITESPACE"," ",758],"(",["T_VARIABLE","$fraudFilters",758],")",["T_WHITESPACE"," ",758],"{",["T_WHITESPACE","\n            ",758],["T_VARIABLE","$from",759],"[",["T_STRING","Mage_Paypal_Model_Info",759],["T_DOUBLE_COLON","::",759],["T_STRING","FRAUD_FILTERS",759],"]",["T_WHITESPACE"," ",759],"=",["T_WHITESPACE"," ",759],["T_VARIABLE","$fraudFilters",759],";",["T_WHITESPACE","\n        ",759],"}",["T_WHITESPACE","\n\n        ",760],["T_VARIABLE","$this",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","_info",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","importToPayment",762],"(",["T_VARIABLE","$from",762],",",["T_WHITESPACE"," ",762],["T_VARIABLE","$payment",762],")",";",["T_WHITESPACE","\n\n        ",762],["T_DOC_COMMENT","\/**\n         * Detect pending payment, frauds\n         * TODO: implement logic in one place\n         * @see Mage_Paypal_Model_Pro::importPaymentInfo()\n         *\/",764],["T_WHITESPACE","\n        ",768],["T_IF","if",769],["T_WHITESPACE"," ",769],"(",["T_VARIABLE","$this",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","_info",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","isPaymentReviewRequired",769],"(",["T_VARIABLE","$payment",769],")",")",["T_WHITESPACE"," ",769],"{",["T_WHITESPACE","\n            ",769],["T_VARIABLE","$payment",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","setIsTransactionPending",770],"(",["T_STRING","true",770],")",";",["T_WHITESPACE","\n            ",770],["T_IF","if",771],["T_WHITESPACE"," ",771],"(",["T_VARIABLE","$fraudFilters",771],")",["T_WHITESPACE"," ",771],"{",["T_WHITESPACE","\n                ",771],["T_VARIABLE","$payment",772],["T_OBJECT_OPERATOR","->",772],["T_STRING","setIsFraudDetected",772],"(",["T_STRING","true",772],")",";",["T_WHITESPACE","\n            ",772],"}",["T_WHITESPACE","\n        ",773],"}",["T_WHITESPACE","\n        ",774],["T_IF","if",775],["T_WHITESPACE"," ",775],"(",["T_VARIABLE","$this",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","_info",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","isPaymentSuccessful",775],"(",["T_VARIABLE","$payment",775],")",")",["T_WHITESPACE"," ",775],"{",["T_WHITESPACE","\n            ",775],["T_VARIABLE","$payment",776],["T_OBJECT_OPERATOR","->",776],["T_STRING","setIsTransactionApproved",776],"(",["T_STRING","true",776],")",";",["T_WHITESPACE","\n        ",776],"}",["T_WHITESPACE"," ",777],["T_ELSEIF","elseif",777],["T_WHITESPACE"," ",777],"(",["T_VARIABLE","$this",777],["T_OBJECT_OPERATOR","->",777],["T_STRING","_info",777],["T_OBJECT_OPERATOR","->",777],["T_STRING","isPaymentFailed",777],"(",["T_VARIABLE","$payment",777],")",")",["T_WHITESPACE"," ",777],"{",["T_WHITESPACE","\n            ",777],["T_VARIABLE","$payment",778],["T_OBJECT_OPERATOR","->",778],["T_STRING","setIsTransactionDenied",778],"(",["T_STRING","true",778],")",";",["T_WHITESPACE","\n        ",778],"}",["T_WHITESPACE","\n\n        ",779],["T_RETURN","return",781],["T_WHITESPACE"," ",781],["T_VARIABLE","$was",781],["T_WHITESPACE"," ",781],["T_IS_NOT_EQUAL","!=",781],["T_WHITESPACE"," ",781],["T_VARIABLE","$payment",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","getAdditionalInformation",781],"(",")",";",["T_WHITESPACE","\n    ",781],"}",["T_WHITESPACE","\n\n    ",782],["T_DOC_COMMENT","\/**\n     * Filter payment status from NVP into paypal\/info format\n     *\n     * @param string $ipnPaymentStatus\n     * @return string\n     *\/",784],["T_WHITESPACE","\n    ",789],["T_PROTECTED","protected",790],["T_WHITESPACE"," ",790],["T_FUNCTION","function",790],["T_WHITESPACE"," ",790],["T_STRING","_filterPaymentStatus",790],"(",["T_VARIABLE","$ipnPaymentStatus",790],")",["T_WHITESPACE","\n    ",790],"{",["T_WHITESPACE","\n        ",791],["T_SWITCH","switch",792],["T_WHITESPACE"," ",792],"(",["T_VARIABLE","$ipnPaymentStatus",792],")",["T_WHITESPACE"," ",792],"{",["T_WHITESPACE","\n            ",792],["T_CASE","case",793],["T_WHITESPACE"," ",793],["T_CONSTANT_ENCAPSED_STRING","'Created'",793],":",["T_WHITESPACE"," ",793],["T_COMMENT","\/\/ break is intentionally omitted\n",793],["T_WHITESPACE","            ",794],["T_CASE","case",794],["T_WHITESPACE"," ",794],["T_CONSTANT_ENCAPSED_STRING","'Completed'",794],":",["T_WHITESPACE"," ",794],["T_RETURN","return",794],["T_WHITESPACE"," ",794],["T_STRING","Mage_Paypal_Model_Info",794],["T_DOUBLE_COLON","::",794],["T_STRING","PAYMENTSTATUS_COMPLETED",794],";",["T_WHITESPACE","\n            ",794],["T_CASE","case",795],["T_WHITESPACE"," ",795],["T_CONSTANT_ENCAPSED_STRING","'Denied'",795],":",["T_WHITESPACE","    ",795],["T_RETURN","return",795],["T_WHITESPACE"," ",795],["T_STRING","Mage_Paypal_Model_Info",795],["T_DOUBLE_COLON","::",795],["T_STRING","PAYMENTSTATUS_DENIED",795],";",["T_WHITESPACE","\n            ",795],["T_CASE","case",796],["T_WHITESPACE"," ",796],["T_CONSTANT_ENCAPSED_STRING","'Expired'",796],":",["T_WHITESPACE","   ",796],["T_RETURN","return",796],["T_WHITESPACE"," ",796],["T_STRING","Mage_Paypal_Model_Info",796],["T_DOUBLE_COLON","::",796],["T_STRING","PAYMENTSTATUS_EXPIRED",796],";",["T_WHITESPACE","\n            ",796],["T_CASE","case",797],["T_WHITESPACE"," ",797],["T_CONSTANT_ENCAPSED_STRING","'Failed'",797],":",["T_WHITESPACE","    ",797],["T_RETURN","return",797],["T_WHITESPACE"," ",797],["T_STRING","Mage_Paypal_Model_Info",797],["T_DOUBLE_COLON","::",797],["T_STRING","PAYMENTSTATUS_FAILED",797],";",["T_WHITESPACE","\n            ",797],["T_CASE","case",798],["T_WHITESPACE"," ",798],["T_CONSTANT_ENCAPSED_STRING","'Pending'",798],":",["T_WHITESPACE","   ",798],["T_RETURN","return",798],["T_WHITESPACE"," ",798],["T_STRING","Mage_Paypal_Model_Info",798],["T_DOUBLE_COLON","::",798],["T_STRING","PAYMENTSTATUS_PENDING",798],";",["T_WHITESPACE","\n            ",798],["T_CASE","case",799],["T_WHITESPACE"," ",799],["T_CONSTANT_ENCAPSED_STRING","'Refunded'",799],":",["T_WHITESPACE","  ",799],["T_RETURN","return",799],["T_WHITESPACE"," ",799],["T_STRING","Mage_Paypal_Model_Info",799],["T_DOUBLE_COLON","::",799],["T_STRING","PAYMENTSTATUS_REFUNDED",799],";",["T_WHITESPACE","\n            ",799],["T_CASE","case",800],["T_WHITESPACE"," ",800],["T_CONSTANT_ENCAPSED_STRING","'Reversed'",800],":",["T_WHITESPACE","  ",800],["T_RETURN","return",800],["T_WHITESPACE"," ",800],["T_STRING","Mage_Paypal_Model_Info",800],["T_DOUBLE_COLON","::",800],["T_STRING","PAYMENTSTATUS_REVERSED",800],";",["T_WHITESPACE","\n            ",800],["T_CASE","case",801],["T_WHITESPACE"," ",801],["T_CONSTANT_ENCAPSED_STRING","'Canceled_Reversal'",801],":",["T_WHITESPACE"," ",801],["T_RETURN","return",801],["T_WHITESPACE"," ",801],["T_STRING","Mage_Paypal_Model_Info",801],["T_DOUBLE_COLON","::",801],["T_STRING","PAYMENTSTATUS_UNREVERSED",801],";",["T_WHITESPACE","\n            ",801],["T_CASE","case",802],["T_WHITESPACE"," ",802],["T_CONSTANT_ENCAPSED_STRING","'Processed'",802],":",["T_WHITESPACE"," ",802],["T_RETURN","return",802],["T_WHITESPACE"," ",802],["T_STRING","Mage_Paypal_Model_Info",802],["T_DOUBLE_COLON","::",802],["T_STRING","PAYMENTSTATUS_PROCESSED",802],";",["T_WHITESPACE","\n            ",802],["T_CASE","case",803],["T_WHITESPACE"," ",803],["T_CONSTANT_ENCAPSED_STRING","'Voided'",803],":",["T_WHITESPACE","    ",803],["T_RETURN","return",803],["T_WHITESPACE"," ",803],["T_STRING","Mage_Paypal_Model_Info",803],["T_DOUBLE_COLON","::",803],["T_STRING","PAYMENTSTATUS_VOIDED",803],";",["T_WHITESPACE","\n        ",803],"}",["T_WHITESPACE","\n        ",804],["T_RETURN","return",805],["T_WHITESPACE"," ",805],["T_CONSTANT_ENCAPSED_STRING","''",805],";",["T_WHITESPACE","\n",805],["T_COMMENT","\/\/ documented in NVP, but not documented in IPN:\n",806],["T_COMMENT","\/\/Mage_Paypal_Model_Info::PAYMENTSTATUS_NONE\n",807],["T_COMMENT","\/\/Mage_Paypal_Model_Info::PAYMENTSTATUS_INPROGRESS\n",808],["T_COMMENT","\/\/Mage_Paypal_Model_Info::PAYMENTSTATUS_REFUNDEDPART\n",809],["T_WHITESPACE","    ",810],"}",["T_WHITESPACE","\n\n    ",810],["T_DOC_COMMENT","\/**\n     * Log debug data to file\n     *\n     * @param mixed $debugData\n     *\/",812],["T_WHITESPACE","\n    ",816],["T_PROTECTED","protected",817],["T_WHITESPACE"," ",817],["T_FUNCTION","function",817],["T_WHITESPACE"," ",817],["T_STRING","_debug",817],"(",")",["T_WHITESPACE","\n    ",817],"{",["T_WHITESPACE","\n        ",818],["T_IF","if",819],["T_WHITESPACE"," ",819],"(",["T_VARIABLE","$this",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","_config",819],["T_WHITESPACE"," ",819],["T_BOOLEAN_AND","&&",819],["T_WHITESPACE"," ",819],["T_VARIABLE","$this",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","_config",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","debug",819],")",["T_WHITESPACE"," ",819],"{",["T_WHITESPACE","\n            ",819],["T_VARIABLE","$file",820],["T_WHITESPACE"," ",820],"=",["T_WHITESPACE"," ",820],["T_VARIABLE","$this",820],["T_OBJECT_OPERATOR","->",820],["T_STRING","_config",820],["T_OBJECT_OPERATOR","->",820],["T_STRING","getMethodCode",820],"(",")",["T_WHITESPACE"," ",820],"?",["T_WHITESPACE"," ",820],"\"",["T_ENCAPSED_AND_WHITESPACE","payment_",820],["T_CURLY_OPEN","{",820],["T_VARIABLE","$this",820],["T_OBJECT_OPERATOR","->",820],["T_STRING","_config",820],["T_OBJECT_OPERATOR","->",820],["T_STRING","getMethodCode",820],"(",")","}",["T_ENCAPSED_AND_WHITESPACE",".log",820],"\"",["T_WHITESPACE","\n                ",820],":",["T_WHITESPACE"," ",821],["T_STRING","self",821],["T_DOUBLE_COLON","::",821],["T_STRING","DEFAULT_LOG_FILE",821],";",["T_WHITESPACE","\n            ",821],["T_STRING","Mage",822],["T_DOUBLE_COLON","::",822],["T_STRING","getModel",822],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/log_adapter'",822],",",["T_WHITESPACE"," ",822],["T_VARIABLE","$file",822],")",["T_OBJECT_OPERATOR","->",822],["T_STRING","log",822],"(",["T_VARIABLE","$this",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","_debugData",822],")",";",["T_WHITESPACE","\n        ",822],"}",["T_WHITESPACE","\n    ",823],"}",["T_WHITESPACE","\n",824],"}",["T_WHITESPACE","\n",825]]