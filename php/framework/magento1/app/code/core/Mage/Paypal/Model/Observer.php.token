[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * PayPal module observer\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",31],["T_CLASS","class",33],["T_WHITESPACE"," ",33],["T_STRING","Mage_Paypal_Model_Observer",33],["T_WHITESPACE","\n",33],"{",["T_WHITESPACE","\n    ",34],["T_DOC_COMMENT","\/**\n     * Goes to reports.paypal.com and fetches Settlement reports.\n     * @return Mage_Paypal_Model_Observer\n     *\/",35],["T_WHITESPACE","\n    ",38],["T_PUBLIC","public",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","fetchReports",39],"(",")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_TRY","try",41],["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n            ",41],["T_VARIABLE","$reports",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","Mage",42],["T_DOUBLE_COLON","::",42],["T_STRING","getModel",42],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/report_settlement'",42],")",";",["T_WHITESPACE","\n            ",42],["T_COMMENT","\/* @var $reports Mage_Paypal_Model_Report_Settlement *\/",43],["T_WHITESPACE","\n            ",43],["T_VARIABLE","$credentials",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$reports",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getSftpCredentials",44],"(",["T_STRING","true",44],")",";",["T_WHITESPACE","\n            ",44],["T_FOREACH","foreach",45],["T_WHITESPACE"," ",45],"(",["T_VARIABLE","$credentials",45],["T_WHITESPACE"," ",45],["T_AS","as",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$config",45],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n                ",45],["T_TRY","try",46],["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n                    ",46],["T_VARIABLE","$reports",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","fetchAndSave",47],"(",["T_VARIABLE","$config",47],")",";",["T_WHITESPACE","\n                ",47],"}",["T_WHITESPACE"," ",48],["T_CATCH","catch",48],["T_WHITESPACE"," ",48],"(",["T_STRING","Exception",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$e",48],")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n                    ",48],["T_STRING","Mage",49],["T_DOUBLE_COLON","::",49],["T_STRING","logException",49],"(",["T_VARIABLE","$e",49],")",";",["T_WHITESPACE","\n                ",49],"}",["T_WHITESPACE","\n            ",50],"}",["T_WHITESPACE","\n        ",51],"}",["T_WHITESPACE"," ",52],["T_CATCH","catch",52],["T_WHITESPACE"," ",52],"(",["T_STRING","Exception",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$e",52],")",["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n            ",52],["T_STRING","Mage",53],["T_DOUBLE_COLON","::",53],["T_STRING","logException",53],"(",["T_VARIABLE","$e",53],")",";",["T_WHITESPACE","\n        ",53],"}",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Clean unfinished transaction\n     *\n     * @deprecated since 1.6.2.0\n     * @return Mage_Paypal_Model_Observer\n     *\/",57],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","cleanTransactions",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_RETURN","return",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Save order into registry to use it in the overloaded controller.\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Paypal_Model_Observer\n     *\/",68],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","saveOrderAfterSubmit",74],"(",["T_STRING","Varien_Event_Observer",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$observer",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_COMMENT","\/* @var $order Mage_Sales_Model_Order *\/",76],["T_WHITESPACE","\n        ",76],["T_VARIABLE","$order",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$observer",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getEvent",77],"(",")",["T_OBJECT_OPERATOR","->",77],["T_STRING","getData",77],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",77],")",";",["T_WHITESPACE","\n        ",77],["T_STRING","Mage",78],["T_DOUBLE_COLON","::",78],["T_STRING","register",78],"(",["T_CONSTANT_ENCAPSED_STRING","'hss_order'",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$order",78],",",["T_WHITESPACE"," ",78],["T_STRING","true",78],")",";",["T_WHITESPACE","\n\n        ",78],["T_RETURN","return",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],";",["T_WHITESPACE","\n    ",80],"}",["T_WHITESPACE","\n\n    ",81],["T_DOC_COMMENT","\/**\n     * Set data for response of frontend saveOrder action\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Paypal_Model_Observer\n     *\/",83],["T_WHITESPACE","\n    ",88],["T_PUBLIC","public",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","setResponseAfterSaveOrder",89],"(",["T_STRING","Varien_Event_Observer",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$observer",89],")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_COMMENT","\/* @var $order Mage_Sales_Model_Order *\/",91],["T_WHITESPACE","\n        ",91],["T_VARIABLE","$order",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","Mage",92],["T_DOUBLE_COLON","::",92],["T_STRING","registry",92],"(",["T_CONSTANT_ENCAPSED_STRING","'hss_order'",92],")",";",["T_WHITESPACE","\n\n        ",92],["T_IF","if",94],["T_WHITESPACE"," ",94],"(",["T_VARIABLE","$order",94],["T_WHITESPACE"," ",94],["T_BOOLEAN_AND","&&",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$order",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getId",94],"(",")",")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n            ",94],["T_VARIABLE","$payment",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$order",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getPayment",95],"(",")",";",["T_WHITESPACE","\n            ",95],["T_IF","if",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$payment",96],["T_WHITESPACE"," ",96],["T_BOOLEAN_AND","&&",96],["T_WHITESPACE"," ",96],["T_STRING","in_array",96],"(",["T_VARIABLE","$payment",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getMethod",96],"(",")",",",["T_WHITESPACE"," ",96],["T_STRING","Mage",96],["T_DOUBLE_COLON","::",96],["T_STRING","helper",96],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/hss'",96],")",["T_OBJECT_OPERATOR","->",96],["T_STRING","getHssMethods",96],"(",")",")",")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n                ",96],["T_COMMENT","\/* @var $controller Mage_Core_Controller_Varien_Action *\/",97],["T_WHITESPACE","\n                ",97],["T_VARIABLE","$controller",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$observer",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getEvent",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","getData",98],"(",["T_CONSTANT_ENCAPSED_STRING","'controller_action'",98],")",";",["T_WHITESPACE","\n                ",98],["T_VARIABLE","$result",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","helper",99],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",99],")",["T_OBJECT_OPERATOR","->",99],["T_STRING","jsonDecode",99],"(",["T_WHITESPACE","\n                    ",99],["T_VARIABLE","$controller",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getResponse",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getBody",100],"(",["T_CONSTANT_ENCAPSED_STRING","'default'",100],")",",",["T_WHITESPACE","\n                    ",100],["T_STRING","Zend_Json",101],["T_DOUBLE_COLON","::",101],["T_STRING","TYPE_ARRAY",101],["T_WHITESPACE","\n                ",101],")",";",["T_WHITESPACE","\n\n                ",102],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_EMPTY","empty",104],"(",["T_VARIABLE","$result",104],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",104],"]",")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n                    ",104],["T_VARIABLE","$controller",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","loadLayout",105],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_onepage_review'",105],")",";",["T_WHITESPACE","\n                    ",105],["T_VARIABLE","$html",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$controller",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getLayout",106],"(",")",["T_OBJECT_OPERATOR","->",106],["T_STRING","getBlock",106],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal.iframe'",106],")",["T_OBJECT_OPERATOR","->",106],["T_STRING","toHtml",106],"(",")",";",["T_WHITESPACE","\n                    ",106],["T_VARIABLE","$result",107],"[",["T_CONSTANT_ENCAPSED_STRING","'update_section'",107],"]",["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",["T_WHITESPACE","\n                        ",107],["T_CONSTANT_ENCAPSED_STRING","'name'",108],["T_WHITESPACE"," ",108],["T_DOUBLE_ARROW","=>",108],["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'paypaliframe'",108],",",["T_WHITESPACE","\n                        ",108],["T_CONSTANT_ENCAPSED_STRING","'html'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$html",109],["T_WHITESPACE","\n                    ",109],")",";",["T_WHITESPACE","\n                    ",110],["T_VARIABLE","$result",111],"[",["T_CONSTANT_ENCAPSED_STRING","'redirect'",111],"]",["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","false",111],";",["T_WHITESPACE","\n                    ",111],["T_VARIABLE","$result",112],"[",["T_CONSTANT_ENCAPSED_STRING","'success'",112],"]",["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","false",112],";",["T_WHITESPACE","\n                    ",112],["T_VARIABLE","$controller",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getResponse",113],"(",")",["T_OBJECT_OPERATOR","->",113],["T_STRING","clearHeader",113],"(",["T_CONSTANT_ENCAPSED_STRING","'Location'",113],")",";",["T_WHITESPACE","\n                    ",113],["T_VARIABLE","$controller",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getResponse",114],"(",")",["T_OBJECT_OPERATOR","->",114],["T_STRING","setBody",114],"(",["T_STRING","Mage",114],["T_DOUBLE_COLON","::",114],["T_STRING","helper",114],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",114],")",["T_OBJECT_OPERATOR","->",114],["T_STRING","jsonEncode",114],"(",["T_VARIABLE","$result",114],")",")",";",["T_WHITESPACE","\n                ",114],"}",["T_WHITESPACE","\n            ",115],"}",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n\n        ",117],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Load country dependent PayPal solutions system configuration\n     *\n     * @param Varien_Event_Observer $observer\n     * @return void\n     *\/",122],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","loadCountryDependentSolutionsConfig",128],"(",["T_STRING","Varien_Event_Observer",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$observer",128],")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$countryCode",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","Mage",130],["T_DOUBLE_COLON","::",130],["T_STRING","helper",130],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",130],")",["T_OBJECT_OPERATOR","->",130],["T_STRING","getConfigurationCountryCode",130],"(",")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$paymentGroups",131],["T_WHITESPACE","   ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$observer",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getEvent",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","getConfig",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","getNode",131],"(",["T_CONSTANT_ENCAPSED_STRING","'sections\/payment\/groups'",131],")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$paymentsConfigs",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$paymentGroups",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","xpath",132],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_payments\/*\/backend_config\/'",132],["T_WHITESPACE"," ",132],".",["T_WHITESPACE"," ",132],["T_VARIABLE","$countryCode",132],")",";",["T_WHITESPACE","\n        ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$paymentsConfigs",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_FOREACH","foreach",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$paymentsConfigs",134],["T_WHITESPACE"," ",134],["T_AS","as",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$config",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$parent",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$config",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getParent",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getParent",135],"(",")",";",["T_WHITESPACE","\n                ",135],["T_VARIABLE","$parent",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","extend",136],"(",["T_VARIABLE","$config",136],",",["T_WHITESPACE"," ",136],["T_STRING","true",136],")",";",["T_WHITESPACE","\n            ",136],"}",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n\n        ",138],["T_VARIABLE","$payments",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$paymentGroups",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","xpath",140],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_payments\/*'",140],")",";",["T_WHITESPACE","\n        ",140],["T_FOREACH","foreach",141],["T_WHITESPACE"," ",141],"(",["T_VARIABLE","$payments",141],["T_WHITESPACE"," ",141],["T_AS","as",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$payment",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n            ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(",["T_INT_CAST","(int)",142],["T_VARIABLE","$payment",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","include",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$fields",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$paymentGroups",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","xpath",143],"(",["T_STRING_CAST","(string)",143],["T_VARIABLE","$payment",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","group",143],["T_WHITESPACE"," ",143],".",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'\/fields'",143],")",";",["T_WHITESPACE","\n                ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(",["T_ISSET","isset",144],"(",["T_VARIABLE","$fields",144],"[",["T_LNUMBER","0",144],"]",")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                    ",144],["T_VARIABLE","$fields",145],"[",["T_LNUMBER","0",145],"]",["T_OBJECT_OPERATOR","->",145],["T_STRING","appendChild",145],"(",["T_VARIABLE","$payment",145],",",["T_WHITESPACE"," ",145],["T_STRING","true",145],")",";",["T_WHITESPACE","\n                ",145],"}",["T_WHITESPACE","\n            ",146],"}",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Update transaction with HTML representation of txn_id\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",151],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","observeHtmlTransactionId",156],"(",["T_STRING","Varien_Event_Observer",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$observer",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_DOC_COMMENT","\/** @var Varien_Object $transaction *\/",158],["T_WHITESPACE","\n        ",158],["T_VARIABLE","$transaction",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$observer",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getEvent",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getTransaction",159],"(",")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$transaction",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","setHtmlTxnId",160],"(",["T_STRING","Mage",160],["T_DOUBLE_COLON","::",160],["T_STRING","helper",160],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",160],")",["T_OBJECT_OPERATOR","->",160],["T_STRING","getHtmlTransactionId",160],"(",["T_WHITESPACE","\n            ",160],["T_VARIABLE","$observer",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getEvent",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","getPayment",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","getMethodInstance",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","getCode",161],"(",")",",",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$transaction",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getTxnId",162],"(",")",["T_WHITESPACE","\n        ",162],")",")",";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n",164],"}",["T_WHITESPACE","\n",165]]