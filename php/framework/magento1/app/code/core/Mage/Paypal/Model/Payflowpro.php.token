[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Payflow Pro payment gateway model\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Paypal_Model_Payflowpro",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE","  ",35],["T_STRING","Mage_Payment_Model_Method_Cc",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Transaction action codes\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","TRXTYPE_AUTH_ONLY",40],["T_WHITESPACE","         ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'A'",40],";",["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","TRXTYPE_SALE",41],["T_WHITESPACE","              ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'S'",41],";",["T_WHITESPACE","\n    ",41],["T_CONST","const",42],["T_WHITESPACE"," ",42],["T_STRING","TRXTYPE_CREDIT",42],["T_WHITESPACE","            ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'C'",42],";",["T_WHITESPACE","\n    ",42],["T_CONST","const",43],["T_WHITESPACE"," ",43],["T_STRING","TRXTYPE_DELAYED_CAPTURE",43],["T_WHITESPACE","   ",43],"=",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'D'",43],";",["T_WHITESPACE","\n    ",43],["T_CONST","const",44],["T_WHITESPACE"," ",44],["T_STRING","TRXTYPE_DELAYED_VOID",44],["T_WHITESPACE","      ",44],"=",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'V'",44],";",["T_WHITESPACE","\n    ",44],["T_CONST","const",45],["T_WHITESPACE"," ",45],["T_STRING","TRXTYPE_DELAYED_VOICE",45],["T_WHITESPACE","     ",45],"=",["T_WHITESPACE"," ",45],["T_CONSTANT_ENCAPSED_STRING","'F'",45],";",["T_WHITESPACE","\n    ",45],["T_CONST","const",46],["T_WHITESPACE"," ",46],["T_STRING","TRXTYPE_DELAYED_INQUIRY",46],["T_WHITESPACE","   ",46],"=",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'I'",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Tender type codes\n     *\/",48],["T_WHITESPACE","\n    ",50],["T_CONST","const",51],["T_WHITESPACE"," ",51],["T_STRING","TENDER_CC",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'C'",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Gateway request URLs\n     *\/",53],["T_WHITESPACE","\n    ",55],["T_CONST","const",56],["T_WHITESPACE"," ",56],["T_STRING","TRANSACTION_URL",56],["T_WHITESPACE","           ",56],"=",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/payflowpro.paypal.com\/transaction'",56],";",["T_WHITESPACE","\n    ",56],["T_CONST","const",57],["T_WHITESPACE"," ",57],["T_STRING","TRANSACTION_URL_TEST_MODE",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/pilot-payflowpro.paypal.com\/transaction'",57],";",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Response codes\n     *\/",59],["T_WHITESPACE","\n    ",61],["T_CONST","const",62],["T_WHITESPACE"," ",62],["T_STRING","RESPONSE_CODE_APPROVED",62],["T_WHITESPACE","                ",62],"=",["T_WHITESPACE"," ",62],["T_LNUMBER","0",62],";",["T_WHITESPACE","\n    ",62],["T_CONST","const",63],["T_WHITESPACE"," ",63],["T_STRING","RESPONSE_CODE_INVALID_AMOUNT",63],["T_WHITESPACE","          ",63],"=",["T_WHITESPACE"," ",63],["T_LNUMBER","4",63],";",["T_WHITESPACE","\n    ",63],["T_CONST","const",64],["T_WHITESPACE"," ",64],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",64],["T_WHITESPACE","     ",64],"=",["T_WHITESPACE"," ",64],["T_LNUMBER","126",64],";",["T_WHITESPACE","\n    ",64],["T_CONST","const",65],["T_WHITESPACE"," ",65],["T_STRING","RESPONSE_CODE_DECLINED",65],["T_WHITESPACE","                ",65],"=",["T_WHITESPACE"," ",65],["T_LNUMBER","12",65],";",["T_WHITESPACE","\n    ",65],["T_CONST","const",66],["T_WHITESPACE"," ",66],["T_STRING","RESPONSE_CODE_DECLINED_BY_FILTER",66],["T_WHITESPACE","      ",66],"=",["T_WHITESPACE"," ",66],["T_LNUMBER","125",66],";",["T_WHITESPACE","\n    ",66],["T_CONST","const",67],["T_WHITESPACE"," ",67],["T_STRING","RESPONSE_CODE_DECLINED_BY_MERCHANT",67],["T_WHITESPACE","    ",67],"=",["T_WHITESPACE"," ",67],["T_LNUMBER","128",67],";",["T_WHITESPACE","\n    ",67],["T_CONST","const",68],["T_WHITESPACE"," ",68],["T_STRING","RESPONSE_CODE_CAPTURE_ERROR",68],["T_WHITESPACE","           ",68],"=",["T_WHITESPACE"," ",68],["T_LNUMBER","111",68],";",["T_WHITESPACE","\n    ",68],["T_CONST","const",69],["T_WHITESPACE"," ",69],["T_STRING","RESPONSE_CODE_VOID_ERROR",69],["T_WHITESPACE","              ",69],"=",["T_WHITESPACE"," ",69],["T_LNUMBER","108",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Payment method code\n     *\/",71],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$_code",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","Mage_Paypal_Model_Config",74],["T_DOUBLE_COLON","::",74],["T_STRING","METHOD_PAYFLOWPRO",74],";",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Availability options\n     *\/",76],["T_WHITESPACE","\n    ",78],["T_PROTECTED","protected",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$_isGateway",79],["T_WHITESPACE","               ",79],"=",["T_WHITESPACE"," ",79],["T_STRING","true",79],";",["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$_canAuthorize",80],["T_WHITESPACE","            ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","true",80],";",["T_WHITESPACE","\n    ",80],["T_PROTECTED","protected",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$_canCapture",81],["T_WHITESPACE","              ",81],"=",["T_WHITESPACE"," ",81],["T_STRING","true",81],";",["T_WHITESPACE","\n    ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$_canCapturePartial",82],["T_WHITESPACE","       ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","true",82],";",["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$_canRefund",83],["T_WHITESPACE","               ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","true",83],";",["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$_canRefundInvoicePartial",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","true",84],";",["T_WHITESPACE","\n    ",84],["T_PROTECTED","protected",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$_canVoid",85],["T_WHITESPACE","                 ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","true",85],";",["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$_canUseInternal",86],["T_WHITESPACE","          ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","true",86],";",["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$_canUseCheckout",87],["T_WHITESPACE","          ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","true",87],";",["T_WHITESPACE","\n    ",87],["T_PROTECTED","protected",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$_canUseForMultishipping",88],["T_WHITESPACE","  ",88],"=",["T_WHITESPACE"," ",88],["T_STRING","true",88],";",["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$_canSaveCc",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","false",89],";",["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$_isProxy",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","false",90],";",["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$_canFetchTransactionInfo",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_STRING","true",91],";",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Gateway request timeout\n     *\/",93],["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$_clientTimeout",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_LNUMBER","45",96],";",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Fields that should be replaced in debug with '***'\n     *\n     * @var array\n     *\/",98],["T_WHITESPACE","\n    ",102],["T_PROTECTED","protected",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$_debugReplacePrivateDataKeys",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'pwd'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'acct'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'expdate'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'cvv2'",103],")",";",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Centinel cardinal fields map\n     *\n     * @var string\n     *\/",105],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$_centinelFieldMap",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_ARRAY","array",110],"(",["T_WHITESPACE","\n        ",110],["T_CONSTANT_ENCAPSED_STRING","'centinel_mpivendor'",111],["T_WHITESPACE","    ",111],["T_DOUBLE_ARROW","=>",111],["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'MPIVENDOR3DS'",111],",",["T_WHITESPACE","\n        ",111],["T_CONSTANT_ENCAPSED_STRING","'centinel_authstatus'",112],["T_WHITESPACE","   ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'AUTHSTATUS3DS'",112],",",["T_WHITESPACE","\n        ",112],["T_CONSTANT_ENCAPSED_STRING","'centinel_cavv'",113],["T_WHITESPACE","         ",113],["T_DOUBLE_ARROW","=>",113],["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'CAVV'",113],",",["T_WHITESPACE","\n        ",113],["T_CONSTANT_ENCAPSED_STRING","'centinel_eci'",114],["T_WHITESPACE","          ",114],["T_DOUBLE_ARROW","=>",114],["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'ECI'",114],",",["T_WHITESPACE","\n        ",114],["T_CONSTANT_ENCAPSED_STRING","'centinel_xid'",115],["T_WHITESPACE","          ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'XID'",115],",",["T_WHITESPACE","\n    ",115],")",";",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Check whether payment method can be used\n     *\n     * @param Mage_Sales_Model_Quote\n     * @return bool\n     *\/",118],["T_WHITESPACE","\n    ",123],["T_PUBLIC","public",124],["T_WHITESPACE"," ",124],["T_FUNCTION","function",124],["T_WHITESPACE"," ",124],["T_STRING","isAvailable",124],"(",["T_VARIABLE","$quote",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","null",124],")",["T_WHITESPACE","\n    ",124],"{",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$storeId",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","app",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getStore",126],"(",["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getStore",126],"(",")",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getId",126],"(",")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$config",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","getModel",127],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/config'",127],")",["T_OBJECT_OPERATOR","->",127],["T_STRING","setStoreId",127],"(",["T_VARIABLE","$storeId",127],")",";",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_STRING","parent",128],["T_DOUBLE_COLON","::",128],["T_STRING","isAvailable",128],"(",["T_VARIABLE","$quote",128],")",["T_WHITESPACE"," ",128],["T_BOOLEAN_AND","&&",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$config",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","isMethodAvailable",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getCode",128],"(",")",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_STRING","true",129],";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n        ",130],["T_RETURN","return",131],["T_WHITESPACE"," ",131],["T_STRING","false",131],";",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Payment action getter compatible with payment model\n     *\n     * @see Mage_Sales_Model_Payment::place()\n     * @return string\n     *\/",134],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","getConfigPaymentAction",140],"(",")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_SWITCH","switch",142],["T_WHITESPACE"," ",142],"(",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getConfigData",142],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_action'",142],")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_CASE","case",143],["T_WHITESPACE"," ",143],["T_STRING","Mage_Paypal_Model_Config",143],["T_DOUBLE_COLON","::",143],["T_STRING","PAYMENT_ACTION_AUTH",143],":",["T_WHITESPACE","\n                ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_STRING","Mage_Payment_Model_Method_Abstract",144],["T_DOUBLE_COLON","::",144],["T_STRING","ACTION_AUTHORIZE",144],";",["T_WHITESPACE","\n            ",144],["T_CASE","case",145],["T_WHITESPACE"," ",145],["T_STRING","Mage_Paypal_Model_Config",145],["T_DOUBLE_COLON","::",145],["T_STRING","PAYMENT_ACTION_SALE",145],":",["T_WHITESPACE","\n                ",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_STRING","Mage_Payment_Model_Method_Abstract",146],["T_DOUBLE_COLON","::",146],["T_STRING","ACTION_AUTHORIZE_CAPTURE",146],";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Authorize payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Payflowpro\n     *\/",150],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","authorize",156],"(",["T_STRING","Varien_Object",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$payment",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$amount",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$request",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_buildPlaceRequest",158],"(",["T_VARIABLE","$payment",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$amount",158],")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$request",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","setTrxtype",159],"(",["T_STRING","self",159],["T_DOUBLE_COLON","::",159],["T_STRING","TRXTYPE_AUTH_ONLY",159],")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_setReferenceTransaction",160],"(",["T_VARIABLE","$payment",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$request",160],")",";",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$response",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_postRequest",161],"(",["T_VARIABLE","$request",161],")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_processErrors",162],"(",["T_VARIABLE","$response",162],")",";",["T_WHITESPACE","\n\n        ",162],["T_SWITCH","switch",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$response",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getResultCode",164],"(",")",")","{",["T_WHITESPACE","\n            ",164],["T_CASE","case",165],["T_WHITESPACE"," ",165],["T_STRING","self",165],["T_DOUBLE_COLON","::",165],["T_STRING","RESPONSE_CODE_APPROVED",165],":",["T_WHITESPACE","\n                ",165],["T_VARIABLE","$payment",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","setTransactionId",166],"(",["T_VARIABLE","$response",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getPnref",166],"(",")",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","setIsTransactionClosed",166],"(",["T_LNUMBER","0",166],")",";",["T_WHITESPACE","\n                ",166],["T_BREAK","break",167],";",["T_WHITESPACE","\n            ",167],["T_CASE","case",168],["T_WHITESPACE"," ",168],["T_STRING","self",168],["T_DOUBLE_COLON","::",168],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",168],":",["T_WHITESPACE","\n                ",168],["T_VARIABLE","$payment",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","setTransactionId",169],"(",["T_VARIABLE","$response",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getPnref",169],"(",")",")",["T_OBJECT_OPERATOR","->",169],["T_STRING","setIsTransactionClosed",169],"(",["T_LNUMBER","0",169],")",";",["T_WHITESPACE","\n                ",169],["T_VARIABLE","$payment",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","setIsTransactionPending",170],"(",["T_STRING","true",170],")",";",["T_WHITESPACE","\n                ",170],["T_VARIABLE","$payment",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setIsFraudDetected",171],"(",["T_STRING","true",171],")",";",["T_WHITESPACE","\n                ",171],["T_BREAK","break",172],";",["T_WHITESPACE","\n        ",172],"}",["T_WHITESPACE","\n        ",173],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Get capture amount\n     *\n     * @param float $amount\n     * @return float\n     *\/",177],["T_WHITESPACE","\n    ",182],["T_PROTECTED","protected",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","_getCaptureAmount",183],"(",["T_VARIABLE","$amount",183],")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$infoInstance",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getInfoInstance",185],"(",")",";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$amountToPay",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","round",186],"(",["T_VARIABLE","$amount",186],",",["T_WHITESPACE"," ",186],["T_LNUMBER","2",186],")",";",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$authorizedAmount",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_STRING","round",187],"(",["T_VARIABLE","$infoInstance",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getAmountAuthorized",187],"(",")",",",["T_WHITESPACE"," ",187],["T_LNUMBER","2",187],")",";",["T_WHITESPACE","\n        ",187],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$amountToPay",188],["T_WHITESPACE"," ",188],["T_IS_NOT_EQUAL","!=",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$authorizedAmount",188],["T_WHITESPACE"," ",188],"?",["T_WHITESPACE"," ",188],["T_VARIABLE","$amountToPay",188],["T_WHITESPACE"," ",188],":",["T_WHITESPACE"," ",188],["T_LNUMBER","0",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Capture payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Payflowpro\n     *\/",191],["T_WHITESPACE","\n    ",196],["T_PUBLIC","public",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","capture",197],"(",["T_STRING","Varien_Object",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$payment",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$amount",197],")",["T_WHITESPACE","\n    ",197],"{",["T_WHITESPACE","\n        ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$payment",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getReferenceTransactionId",199],"(",")",")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$request",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_buildPlaceRequest",200],"(",["T_VARIABLE","$payment",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$amount",200],")",";",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$request",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","setTrxtype",201],"(",["T_STRING","self",201],["T_DOUBLE_COLON","::",201],["T_STRING","TRXTYPE_SALE",201],")",";",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$request",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","setOrigid",202],"(",["T_VARIABLE","$payment",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getReferenceTransactionId",202],"(",")",")",";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE"," ",203],["T_ELSEIF","elseif",203],["T_WHITESPACE"," ",203],"(",["T_VARIABLE","$payment",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getParentTransactionId",203],"(",")",")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$request",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_buildBasicRequest",204],"(",["T_VARIABLE","$payment",204],")",";",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$request",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","setOrigid",205],"(",["T_VARIABLE","$payment",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getParentTransactionId",205],"(",")",")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$captureAmount",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_getCaptureAmount",206],"(",["T_VARIABLE","$amount",206],")",";",["T_WHITESPACE","\n            ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$captureAmount",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$request",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","setAmt",208],"(",["T_VARIABLE","$captureAmount",208],")",";",["T_WHITESPACE","\n            ",208],"}",["T_WHITESPACE","\n            ",209],["T_VARIABLE","$trxType",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getInfoInstance",210],"(",")",["T_OBJECT_OPERATOR","->",210],["T_STRING","hasAmountPaid",210],"(",")",["T_WHITESPACE"," ",210],"?",["T_WHITESPACE"," ",210],["T_STRING","self",210],["T_DOUBLE_COLON","::",210],["T_STRING","TRXTYPE_SALE",210],["T_WHITESPACE"," ",210],":",["T_WHITESPACE"," ",210],["T_STRING","self",210],["T_DOUBLE_COLON","::",210],["T_STRING","TRXTYPE_DELAYED_CAPTURE",210],";",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$request",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","setTrxtype",211],"(",["T_VARIABLE","$trxType",211],")",";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE"," ",212],["T_ELSE","else",212],["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$request",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_buildPlaceRequest",213],"(",["T_VARIABLE","$payment",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$amount",213],")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$request",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","setTrxtype",214],"(",["T_STRING","self",214],["T_DOUBLE_COLON","::",214],["T_STRING","TRXTYPE_SALE",214],")",";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n\n        ",215],["T_VARIABLE","$response",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_postRequest",217],"(",["T_VARIABLE","$request",217],")",";",["T_WHITESPACE","\n        ",217],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_processErrors",218],"(",["T_VARIABLE","$response",218],")",";",["T_WHITESPACE","\n\n        ",218],["T_SWITCH","switch",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$response",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getResultCode",220],"(",")",")","{",["T_WHITESPACE","\n            ",220],["T_CASE","case",221],["T_WHITESPACE"," ",221],["T_STRING","self",221],["T_DOUBLE_COLON","::",221],["T_STRING","RESPONSE_CODE_APPROVED",221],":",["T_WHITESPACE","\n                ",221],["T_VARIABLE","$payment",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","setTransactionId",222],"(",["T_VARIABLE","$response",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getPnref",222],"(",")",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","setIsTransactionClosed",222],"(",["T_LNUMBER","0",222],")",";",["T_WHITESPACE","\n                ",222],["T_BREAK","break",223],";",["T_WHITESPACE","\n            ",223],["T_CASE","case",224],["T_WHITESPACE"," ",224],["T_STRING","self",224],["T_DOUBLE_COLON","::",224],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",224],":",["T_WHITESPACE","\n                ",224],["T_VARIABLE","$payment",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","setTransactionId",225],"(",["T_VARIABLE","$response",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getPnref",225],"(",")",")",["T_OBJECT_OPERATOR","->",225],["T_STRING","setIsTransactionClosed",225],"(",["T_LNUMBER","0",225],")",";",["T_WHITESPACE","\n                ",225],["T_VARIABLE","$payment",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","setIsTransactionPending",226],"(",["T_STRING","true",226],")",";",["T_WHITESPACE","\n                ",226],["T_VARIABLE","$payment",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","setIsFraudDetected",227],"(",["T_STRING","true",227],")",";",["T_WHITESPACE","\n                ",227],["T_BREAK","break",228],";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n        ",229],["T_RETURN","return",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],";",["T_WHITESPACE","\n    ",230],"}",["T_WHITESPACE","\n\n    ",231],["T_DOC_COMMENT","\/**\n     * Void payment\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Payflowpro\n     *\/",233],["T_WHITESPACE","\n    ",238],["T_PUBLIC","public",239],["T_WHITESPACE"," ",239],["T_FUNCTION","function",239],["T_WHITESPACE"," ",239],["T_STRING","void",239],"(",["T_STRING","Varien_Object",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$payment",239],")",["T_WHITESPACE","\n    ",239],"{",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$request",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_buildBasicRequest",241],"(",["T_VARIABLE","$payment",241],")",";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$request",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","setTrxtype",242],"(",["T_STRING","self",242],["T_DOUBLE_COLON","::",242],["T_STRING","TRXTYPE_DELAYED_VOID",242],")",";",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$request",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","setOrigid",243],"(",["T_VARIABLE","$payment",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getParentTransactionId",243],"(",")",")",";",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$response",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_postRequest",244],"(",["T_VARIABLE","$request",244],")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","_processErrors",245],"(",["T_VARIABLE","$response",245],")",";",["T_WHITESPACE","\n\n        ",245],["T_IF","if",247],["T_WHITESPACE"," ",247],"(",["T_VARIABLE","$response",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getResultCode",247],"(",")",["T_WHITESPACE"," ",247],["T_IS_EQUAL","==",247],["T_WHITESPACE"," ",247],["T_STRING","self",247],["T_DOUBLE_COLON","::",247],["T_STRING","RESPONSE_CODE_APPROVED",247],")","{",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$payment",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","setTransactionId",248],"(",["T_VARIABLE","$response",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getPnref",248],"(",")",")",["T_WHITESPACE","\n                ",248],["T_OBJECT_OPERATOR","->",249],["T_STRING","setIsTransactionClosed",249],"(",["T_LNUMBER","1",249],")",["T_WHITESPACE","\n                ",249],["T_OBJECT_OPERATOR","->",250],["T_STRING","setShouldCloseParentTransaction",250],"(",["T_LNUMBER","1",250],")",";",["T_WHITESPACE","\n        ",250],"}",["T_WHITESPACE","\n\n        ",251],["T_RETURN","return",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],";",["T_WHITESPACE","\n    ",253],"}",["T_WHITESPACE","\n\n    ",254],["T_DOC_COMMENT","\/**\n     * Check void availability\n     *\n     * @param   Varien_Object $payment\n     * @return  bool\n     *\/",256],["T_WHITESPACE","\n    ",261],["T_PUBLIC","public",262],["T_WHITESPACE"," ",262],["T_FUNCTION","function",262],["T_WHITESPACE"," ",262],["T_STRING","canVoid",262],"(",["T_STRING","Varien_Object",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$payment",262],")",["T_WHITESPACE","\n    ",262],"{",["T_WHITESPACE","\n        ",263],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$payment",264],["T_WHITESPACE"," ",264],["T_INSTANCEOF","instanceof",264],["T_WHITESPACE"," ",264],["T_STRING","Mage_Sales_Model_Order_Invoice",264],["T_WHITESPACE","\n            ",264],["T_BOOLEAN_OR","||",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$payment",265],["T_WHITESPACE"," ",265],["T_INSTANCEOF","instanceof",265],["T_WHITESPACE"," ",265],["T_STRING","Mage_Sales_Model_Order_Creditmemo",265],["T_WHITESPACE","\n        ",265],")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_RETURN","return",267],["T_WHITESPACE"," ",267],["T_STRING","false",267],";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE","\n        ",268],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_VARIABLE","$payment",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getAmountPaid",269],"(",")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_canVoid",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_STRING","false",270],";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n\n        ",271],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_canVoid",273],";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Attempt to void the authorization on cancelling\n     *\n     * @param Varien_Object $payment\n     * @return Mage_Paypal_Model_Payflowpro\n     *\/",276],["T_WHITESPACE","\n    ",281],["T_PUBLIC","public",282],["T_WHITESPACE"," ",282],["T_FUNCTION","function",282],["T_WHITESPACE"," ",282],["T_STRING","cancel",282],"(",["T_STRING","Varien_Object",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$payment",282],")",["T_WHITESPACE","\n    ",282],"{",["T_WHITESPACE","\n        ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(","!",["T_VARIABLE","$payment",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getOrder",284],"(",")",["T_OBJECT_OPERATOR","->",284],["T_STRING","getInvoiceCollection",284],"(",")",["T_OBJECT_OPERATOR","->",284],["T_STRING","count",284],"(",")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_RETURN","return",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","void",285],"(",["T_VARIABLE","$payment",285],")",";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n\n        ",286],["T_RETURN","return",288],["T_WHITESPACE"," ",288],["T_STRING","false",288],";",["T_WHITESPACE","\n    ",288],"}",["T_WHITESPACE","\n\n    ",289],["T_DOC_COMMENT","\/**\n     * Refund capture\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Paypal_Model_Payflowpro\n     *\/",291],["T_WHITESPACE","\n    ",296],["T_PUBLIC","public",297],["T_WHITESPACE"," ",297],["T_FUNCTION","function",297],["T_WHITESPACE"," ",297],["T_STRING","refund",297],"(",["T_STRING","Varien_Object",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$payment",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$amount",297],")",["T_WHITESPACE","\n    ",297],"{",["T_WHITESPACE","\n        ",298],["T_VARIABLE","$request",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_buildBasicRequest",299],"(",["T_VARIABLE","$payment",299],")",";",["T_WHITESPACE","\n        ",299],["T_VARIABLE","$request",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","setTrxtype",300],"(",["T_STRING","self",300],["T_DOUBLE_COLON","::",300],["T_STRING","TRXTYPE_CREDIT",300],")",";",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$request",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","setOrigid",301],"(",["T_VARIABLE","$payment",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getParentTransactionId",301],"(",")",")",";",["T_WHITESPACE","\n        ",301],["T_VARIABLE","$request",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","setAmt",302],"(",["T_STRING","round",302],"(",["T_VARIABLE","$amount",302],",",["T_LNUMBER","2",302],")",")",";",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$response",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_postRequest",303],"(",["T_VARIABLE","$request",303],")",";",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_processErrors",304],"(",["T_VARIABLE","$response",304],")",";",["T_WHITESPACE","\n\n        ",304],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$response",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getResultCode",306],"(",")",["T_WHITESPACE"," ",306],["T_IS_EQUAL","==",306],["T_WHITESPACE"," ",306],["T_STRING","self",306],["T_DOUBLE_COLON","::",306],["T_STRING","RESPONSE_CODE_APPROVED",306],")","{",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$payment",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","setTransactionId",307],"(",["T_VARIABLE","$response",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getPnref",307],"(",")",")",["T_WHITESPACE","\n                ",307],["T_OBJECT_OPERATOR","->",308],["T_STRING","setIsTransactionClosed",308],"(",["T_LNUMBER","1",308],")",";",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$payment",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","setShouldCloseParentTransaction",309],"(","!",["T_VARIABLE","$payment",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getCreditmemo",309],"(",")",["T_OBJECT_OPERATOR","->",309],["T_STRING","getInvoice",309],"(",")",["T_OBJECT_OPERATOR","->",309],["T_STRING","canRefund",309],"(",")",")",";",["T_WHITESPACE","\n        ",309],"}",["T_WHITESPACE","\n        ",310],["T_RETURN","return",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],";",["T_WHITESPACE","\n    ",311],"}",["T_WHITESPACE","\n\n    ",312],["T_DOC_COMMENT","\/**\n     * Fetch transaction details info\n     *\n     * @param Mage_Payment_Model_Info $payment\n     * @param string $transactionId\n     * @return array\n     *\/",314],["T_WHITESPACE","\n    ",320],["T_PUBLIC","public",321],["T_WHITESPACE"," ",321],["T_FUNCTION","function",321],["T_WHITESPACE"," ",321],["T_STRING","fetchTransactionInfo",321],"(",["T_STRING","Mage_Payment_Model_Info",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$payment",321],",",["T_WHITESPACE"," ",321],["T_VARIABLE","$transactionId",321],")",["T_WHITESPACE","\n    ",321],"{",["T_WHITESPACE","\n        ",322],["T_VARIABLE","$request",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","_buildBasicRequest",323],"(",["T_VARIABLE","$payment",323],")",";",["T_WHITESPACE","\n        ",323],["T_VARIABLE","$request",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","setTrxtype",324],"(",["T_STRING","self",324],["T_DOUBLE_COLON","::",324],["T_STRING","TRXTYPE_DELAYED_INQUIRY",324],")",";",["T_WHITESPACE","\n        ",324],["T_VARIABLE","$request",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","setOrigid",325],"(",["T_VARIABLE","$transactionId",325],")",";",["T_WHITESPACE","\n        ",325],["T_VARIABLE","$response",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_postRequest",326],"(",["T_VARIABLE","$request",326],")",";",["T_WHITESPACE","\n\n        ",326],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_processErrors",328],"(",["T_VARIABLE","$response",328],")",";",["T_WHITESPACE","\n\n        ",328],["T_IF","if",330],["T_WHITESPACE"," ",330],"(","!",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_isTransactionUnderReview",330],"(",["T_VARIABLE","$response",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getOrigresult",330],"(",")",")",")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n            ",330],["T_VARIABLE","$payment",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","setTransactionId",331],"(",["T_VARIABLE","$response",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getOrigpnref",331],"(",")",")",["T_WHITESPACE","\n                ",331],["T_OBJECT_OPERATOR","->",332],["T_STRING","setIsTransactionClosed",332],"(",["T_LNUMBER","0",332],")",";",["T_WHITESPACE","\n            ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$response",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getOrigresult",333],"(",")",["T_WHITESPACE"," ",333],["T_IS_EQUAL","==",333],["T_WHITESPACE"," ",333],["T_STRING","self",333],["T_DOUBLE_COLON","::",333],["T_STRING","RESPONSE_CODE_APPROVED",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n                ",333],["T_VARIABLE","$payment",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","setIsTransactionApproved",334],"(",["T_STRING","true",334],")",";",["T_WHITESPACE","\n            ",334],"}",["T_WHITESPACE"," ",335],["T_ELSE","else",335],["T_WHITESPACE"," ",335],["T_IF","if",335],["T_WHITESPACE"," ",335],"(",["T_VARIABLE","$response",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getOrigresult",335],"(",")",["T_WHITESPACE"," ",335],["T_IS_EQUAL","==",335],["T_WHITESPACE"," ",335],["T_STRING","self",335],["T_DOUBLE_COLON","::",335],["T_STRING","RESPONSE_CODE_DECLINED_BY_MERCHANT",335],")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n                ",335],["T_VARIABLE","$payment",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","setIsTransactionDenied",336],"(",["T_STRING","true",336],")",";",["T_WHITESPACE","\n            ",336],"}",["T_WHITESPACE","\n        ",337],"}",["T_WHITESPACE","\n\n        ",338],["T_VARIABLE","$rawData",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$response",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getData",340],"(",")",";",["T_WHITESPACE","\n        ",340],["T_RETURN","return",341],["T_WHITESPACE"," ",341],"(",["T_VARIABLE","$rawData",341],")",["T_WHITESPACE"," ",341],"?",["T_WHITESPACE"," ",341],["T_VARIABLE","$rawData",341],["T_WHITESPACE"," ",341],":",["T_WHITESPACE"," ",341],["T_ARRAY","array",341],"(",")",";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_DOC_COMMENT","\/**\n     * Check whether the transaction is in payment review status\n     *\n     * @param string $statusCode\n     * @return bool\n     *\/",344],["T_WHITESPACE","\n    ",349],["T_PROTECTED","protected",350],["T_WHITESPACE"," ",350],["T_STATIC","static",350],["T_WHITESPACE"," ",350],["T_FUNCTION","function",350],["T_WHITESPACE"," ",350],["T_STRING","_isTransactionUnderReview",350],"(",["T_VARIABLE","$status",350],")",["T_WHITESPACE","\n    ",350],"{",["T_WHITESPACE","\n        ",351],["T_IF","if",352],["T_WHITESPACE"," ",352],"(",["T_STRING","in_array",352],"(",["T_VARIABLE","$status",352],",",["T_WHITESPACE"," ",352],["T_ARRAY","array",352],"(",["T_STRING","self",352],["T_DOUBLE_COLON","::",352],["T_STRING","RESPONSE_CODE_APPROVED",352],",",["T_WHITESPACE"," ",352],["T_STRING","self",352],["T_DOUBLE_COLON","::",352],["T_STRING","RESPONSE_CODE_DECLINED_BY_MERCHANT",352],")",")",")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n            ",352],["T_RETURN","return",353],["T_WHITESPACE"," ",353],["T_STRING","false",353],";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE","\n        ",354],["T_RETURN","return",355],["T_WHITESPACE"," ",355],["T_STRING","true",355],";",["T_WHITESPACE","\n    ",355],"}",["T_WHITESPACE","\n\n    ",356],["T_DOC_COMMENT","\/**\n     * Getter for URL to perform Payflow requests, based on test mode by default\n     *\n     * @param bool $testMode Ability to specify test mode using\n     * @return string\n     *\/",358],["T_WHITESPACE","\n    ",363],["T_PROTECTED","protected",364],["T_WHITESPACE"," ",364],["T_FUNCTION","function",364],["T_WHITESPACE"," ",364],["T_STRING","_getTransactionUrl",364],"(",["T_VARIABLE","$testMode",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_STRING","null",364],")",["T_WHITESPACE","\n    ",364],"{",["T_WHITESPACE","\n        ",365],["T_VARIABLE","$testMode",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_STRING","is_null",366],"(",["T_VARIABLE","$testMode",366],")",["T_WHITESPACE"," ",366],"?",["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getConfigData",366],"(",["T_CONSTANT_ENCAPSED_STRING","'sandbox_flag'",366],")",["T_WHITESPACE"," ",366],":",["T_WHITESPACE"," ",366],["T_BOOL_CAST","(bool)",366],["T_VARIABLE","$testMode",366],";",["T_WHITESPACE","\n        ",366],["T_IF","if",367],["T_WHITESPACE"," ",367],"(",["T_VARIABLE","$testMode",367],")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n            ",367],["T_RETURN","return",368],["T_WHITESPACE"," ",368],["T_STRING","self",368],["T_DOUBLE_COLON","::",368],["T_STRING","TRANSACTION_URL_TEST_MODE",368],";",["T_WHITESPACE","\n        ",368],"}",["T_WHITESPACE","\n        ",369],["T_RETURN","return",370],["T_WHITESPACE"," ",370],["T_STRING","self",370],["T_DOUBLE_COLON","::",370],["T_STRING","TRANSACTION_URL",370],";",["T_WHITESPACE","\n    ",370],"}",["T_WHITESPACE","\n\n    ",371],["T_DOC_COMMENT","\/**\n     * Post request to gateway and return response\n     *\n     * @param Varien_Object $request\n     * @return Varien_Object\n     *\/",373],["T_WHITESPACE","\n    ",378],["T_PROTECTED","protected",379],["T_WHITESPACE"," ",379],["T_FUNCTION","function",379],["T_WHITESPACE"," ",379],["T_STRING","_postRequest",379],"(",["T_STRING","Varien_Object",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$request",379],")",["T_WHITESPACE","\n    ",379],"{",["T_WHITESPACE","\n        ",380],["T_VARIABLE","$debugData",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_ARRAY","array",381],"(",["T_CONSTANT_ENCAPSED_STRING","'request'",381],["T_WHITESPACE"," ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$request",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getData",381],"(",")",")",";",["T_WHITESPACE","\n\n        ",381],["T_VARIABLE","$client",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_NEW","new",383],["T_WHITESPACE"," ",383],["T_STRING","Varien_Http_Client",383],"(",")",";",["T_WHITESPACE","\n        ",383],["T_VARIABLE","$result",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_NEW","new",384],["T_WHITESPACE"," ",384],["T_STRING","Varien_Object",384],"(",")",";",["T_WHITESPACE","\n\n        ",384],["T_VARIABLE","$_config",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_ARRAY","array",386],"(",["T_WHITESPACE","\n            ",386],["T_CONSTANT_ENCAPSED_STRING","'maxredirects'",387],["T_WHITESPACE"," ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_LNUMBER","5",387],",",["T_WHITESPACE","\n            ",387],["T_CONSTANT_ENCAPSED_STRING","'timeout'",388],["T_WHITESPACE","    ",388],["T_DOUBLE_ARROW","=>",388],["T_WHITESPACE"," ",388],["T_LNUMBER","30",388],",",["T_WHITESPACE","\n            ",388],["T_CONSTANT_ENCAPSED_STRING","'verifypeer'",389],["T_WHITESPACE"," ",389],["T_DOUBLE_ARROW","=>",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","getConfigData",389],"(",["T_CONSTANT_ENCAPSED_STRING","'verify_peer'",389],")",["T_WHITESPACE","\n        ",389],")",";",["T_WHITESPACE","\n\n        ",390],["T_COMMENT","\/\/checking proxy\n",392],["T_WHITESPACE","        ",393],["T_VARIABLE","$_isProxy",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getConfigData",393],"(",["T_CONSTANT_ENCAPSED_STRING","'use_proxy'",393],",",["T_WHITESPACE"," ",393],["T_STRING","false",393],")",";",["T_WHITESPACE","\n        ",393],["T_IF","if",394],["T_WHITESPACE"," ",394],"(",["T_VARIABLE","$_isProxy",394],")",["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n            ",394],["T_VARIABLE","$_config",395],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy'",395],"]",["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getConfigData",395],"(",["T_CONSTANT_ENCAPSED_STRING","'proxy_host'",395],")",["T_WHITESPACE","\n                ",395],".",["T_WHITESPACE"," ",396],["T_CONSTANT_ENCAPSED_STRING","':'",396],["T_WHITESPACE","\n                ",396],".",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getConfigData",397],"(",["T_CONSTANT_ENCAPSED_STRING","'proxy_port'",397],")",";",["T_COMMENT","\/\/http:\/\/proxy.shr.secureserver.net:3128',\n",397],["T_WHITESPACE","            ",398],["T_VARIABLE","$_config",398],"[",["T_CONSTANT_ENCAPSED_STRING","'httpproxytunnel'",398],"]",["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_STRING","true",398],";",["T_WHITESPACE","\n            ",398],["T_VARIABLE","$_config",399],"[",["T_CONSTANT_ENCAPSED_STRING","'proxytype'",399],"]",["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_STRING","CURLPROXY_HTTP",399],";",["T_WHITESPACE","\n        ",399],"}",["T_WHITESPACE","\n\n        ",400],["T_VARIABLE","$client",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","setUri",402],"(",["T_VARIABLE","$this",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","_getTransactionUrl",402],"(",")",")",["T_WHITESPACE","\n            ",402],["T_OBJECT_OPERATOR","->",403],["T_STRING","setConfig",403],"(",["T_VARIABLE","$_config",403],")",["T_WHITESPACE","\n            ",403],["T_OBJECT_OPERATOR","->",404],["T_STRING","setMethod",404],"(",["T_STRING","Zend_Http_Client",404],["T_DOUBLE_COLON","::",404],["T_STRING","POST",404],")",["T_WHITESPACE","\n            ",404],["T_OBJECT_OPERATOR","->",405],["T_STRING","setParameterPost",405],"(",["T_VARIABLE","$request",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","getData",405],"(",")",")",["T_WHITESPACE","\n            ",405],["T_OBJECT_OPERATOR","->",406],["T_STRING","setHeaders",406],"(",["T_CONSTANT_ENCAPSED_STRING","'X-VPS-VIT-CLIENT-CERTIFICATION-ID: 33baf5893fc2123d8b191d2d011b7fdc'",406],")",["T_WHITESPACE","\n            ",406],["T_OBJECT_OPERATOR","->",407],["T_STRING","setHeaders",407],"(",["T_CONSTANT_ENCAPSED_STRING","'X-VPS-Request-ID: '",407],["T_WHITESPACE"," ",407],".",["T_WHITESPACE"," ",407],["T_VARIABLE","$request",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getRequestId",407],"(",")",")",["T_WHITESPACE","\n            ",407],["T_OBJECT_OPERATOR","->",408],["T_STRING","setHeaders",408],"(",["T_CONSTANT_ENCAPSED_STRING","'X-VPS-CLIENT-TIMEOUT: '",408],["T_WHITESPACE"," ",408],".",["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","_clientTimeout",408],")",";",["T_WHITESPACE","\n\n        ",408],["T_TRY","try",410],["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n           ",410],["T_DOC_COMMENT","\/**\n            * we are sending request to payflow pro without url encoding\n            * so we set up _urlEncodeBody flag to false\n            *\/",411],["T_WHITESPACE","\n            ",414],["T_VARIABLE","$response",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_VARIABLE","$client",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","setUrlEncodeBody",415],"(",["T_STRING","false",415],")",["T_OBJECT_OPERATOR","->",415],["T_STRING","request",415],"(",")",";",["T_WHITESPACE","\n        ",415],"}",["T_WHITESPACE","\n        ",416],["T_CATCH","catch",417],["T_WHITESPACE"," ",417],"(",["T_STRING","Exception",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$e",417],")",["T_WHITESPACE"," ",417],"{",["T_WHITESPACE","\n            ",417],["T_VARIABLE","$result",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","setResponseCode",418],"(","-",["T_LNUMBER","1",418],")",["T_WHITESPACE","\n                ",418],["T_OBJECT_OPERATOR","->",419],["T_STRING","setResponseReasonCode",419],"(",["T_VARIABLE","$e",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getCode",419],"(",")",")",["T_WHITESPACE","\n                ",419],["T_OBJECT_OPERATOR","->",420],["T_STRING","setResponseReasonText",420],"(",["T_VARIABLE","$e",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getMessage",420],"(",")",")",";",["T_WHITESPACE","\n\n            ",420],["T_VARIABLE","$debugData",422],"[",["T_CONSTANT_ENCAPSED_STRING","'result'",422],"]",["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$result",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getData",422],"(",")",";",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","_debug",423],"(",["T_VARIABLE","$debugData",423],")",";",["T_WHITESPACE","\n            ",423],["T_THROW","throw",424],["T_WHITESPACE"," ",424],["T_VARIABLE","$e",424],";",["T_WHITESPACE","\n        ",424],"}",["T_WHITESPACE","\n\n\n\n        ",425],["T_VARIABLE","$response",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_STRING","strstr",429],"(",["T_VARIABLE","$response",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getBody",429],"(",")",",",["T_WHITESPACE"," ",429],["T_CONSTANT_ENCAPSED_STRING","'RESULT'",429],")",";",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$valArray",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_STRING","explode",430],"(",["T_CONSTANT_ENCAPSED_STRING","'&'",430],",",["T_WHITESPACE"," ",430],["T_VARIABLE","$response",430],")",";",["T_WHITESPACE","\n\n        ",430],["T_FOREACH","foreach",432],"(",["T_VARIABLE","$valArray",432],["T_WHITESPACE"," ",432],["T_AS","as",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$val",432],")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n                ",432],["T_VARIABLE","$valArray2",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_STRING","explode",433],"(",["T_CONSTANT_ENCAPSED_STRING","'='",433],",",["T_WHITESPACE"," ",433],["T_VARIABLE","$val",433],")",";",["T_WHITESPACE","\n                ",433],["T_VARIABLE","$result",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","setData",434],"(",["T_STRING","strtolower",434],"(",["T_VARIABLE","$valArray2",434],"[",["T_LNUMBER","0",434],"]",")",",",["T_WHITESPACE"," ",434],["T_VARIABLE","$valArray2",434],"[",["T_LNUMBER","1",434],"]",")",";",["T_WHITESPACE","\n        ",434],"}",["T_WHITESPACE","\n\n        ",435],["T_VARIABLE","$result",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","setResultCode",437],"(",["T_VARIABLE","$result",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","getResult",437],"(",")",")",["T_WHITESPACE","\n                ",437],["T_OBJECT_OPERATOR","->",438],["T_STRING","setRespmsg",438],"(",["T_VARIABLE","$result",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getRespmsg",438],"(",")",")",";",["T_WHITESPACE","\n\n        ",438],["T_VARIABLE","$debugData",440],"[",["T_CONSTANT_ENCAPSED_STRING","'result'",440],"]",["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_VARIABLE","$result",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getData",440],"(",")",";",["T_WHITESPACE","\n        ",440],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","_debug",441],"(",["T_VARIABLE","$debugData",441],")",";",["T_WHITESPACE","\n\n        ",441],["T_RETURN","return",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$result",443],";",["T_WHITESPACE","\n    ",443],"}",["T_WHITESPACE","\n\n     ",444],["T_DOC_COMMENT","\/**\n      * Return request object with information for 'authorization' or 'sale' action\n      *\n      * @param Mage_Sales_Model_Order_Payment $payment\n      * @param float $amount\n      * @return Varien_Object\n      *\/",446],["T_WHITESPACE","\n    ",452],["T_PROTECTED","protected",453],["T_WHITESPACE"," ",453],["T_FUNCTION","function",453],["T_WHITESPACE"," ",453],["T_STRING","_buildPlaceRequest",453],"(",["T_STRING","Varien_Object",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$payment",453],",",["T_WHITESPACE"," ",453],["T_VARIABLE","$amount",453],")",["T_WHITESPACE","\n    ",453],"{",["T_WHITESPACE","\n        ",454],["T_VARIABLE","$request",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_VARIABLE","$this",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","_buildBasicRequest",455],"(",["T_VARIABLE","$payment",455],")",";",["T_WHITESPACE","\n        ",455],["T_VARIABLE","$request",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","setAmt",456],"(",["T_STRING","round",456],"(",["T_VARIABLE","$amount",456],",",["T_LNUMBER","2",456],")",")",";",["T_WHITESPACE","\n        ",456],["T_VARIABLE","$request",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","setAcct",457],"(",["T_VARIABLE","$payment",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getCcNumber",457],"(",")",")",";",["T_WHITESPACE","\n        ",457],["T_VARIABLE","$request",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","setExpdate",458],"(",["T_STRING","sprintf",458],"(",["T_CONSTANT_ENCAPSED_STRING","'%02d'",458],",",["T_VARIABLE","$payment",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getCcExpMonth",458],"(",")",")",["T_WHITESPACE"," ",458],".",["T_WHITESPACE"," ",458],["T_STRING","substr",458],"(",["T_VARIABLE","$payment",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getCcExpYear",458],"(",")",",","-",["T_LNUMBER","2",458],",",["T_LNUMBER","2",458],")",")",";",["T_WHITESPACE","\n        ",458],["T_VARIABLE","$request",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","setCvv2",459],"(",["T_VARIABLE","$payment",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","getCcCid",459],"(",")",")",";",["T_WHITESPACE","\n\n        ",459],["T_IF","if",461],["T_WHITESPACE"," ",461],"(",["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getIsCentinelValidationEnabled",461],"(",")",")","{",["T_WHITESPACE","\n            ",461],["T_VARIABLE","$params",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_ARRAY","array",462],"(",")",";",["T_WHITESPACE","\n            ",462],["T_VARIABLE","$params",463],["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getCentinelValidator",463],"(",")",["T_OBJECT_OPERATOR","->",463],["T_STRING","exportCmpiData",463],"(",["T_VARIABLE","$params",463],")",";",["T_WHITESPACE","\n            ",463],["T_VARIABLE","$request",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_STRING","Varien_Object_Mapper",464],["T_DOUBLE_COLON","::",464],["T_STRING","accumulateByMap",464],"(",["T_VARIABLE","$params",464],",",["T_WHITESPACE"," ",464],["T_VARIABLE","$request",464],",",["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_centinelFieldMap",464],")",";",["T_WHITESPACE","\n        ",464],"}",["T_WHITESPACE","\n\n        ",465],["T_VARIABLE","$order",467],["T_WHITESPACE"," ",467],"=",["T_WHITESPACE"," ",467],["T_VARIABLE","$payment",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","getOrder",467],"(",")",";",["T_WHITESPACE","\n        ",467],["T_IF","if",468],["T_WHITESPACE"," ",468],"(","!",["T_EMPTY","empty",468],"(",["T_VARIABLE","$order",468],")",")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n            ",468],["T_VARIABLE","$orderIncrementId",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$order",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getIncrementId",469],"(",")",";",["T_WHITESPACE","\n\n            ",469],["T_VARIABLE","$request",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","setCurrency",471],"(",["T_VARIABLE","$order",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getBaseCurrencyCode",471],"(",")",")",["T_WHITESPACE","\n                ",471],["T_OBJECT_OPERATOR","->",472],["T_STRING","setInvnum",472],"(",["T_VARIABLE","$orderIncrementId",472],")",["T_WHITESPACE","\n                ",472],["T_OBJECT_OPERATOR","->",473],["T_STRING","setPonum",473],"(",["T_VARIABLE","$order",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getId",473],"(",")",")",["T_WHITESPACE","\n                ",473],["T_OBJECT_OPERATOR","->",474],["T_STRING","setComment1",474],"(",["T_VARIABLE","$orderIncrementId",474],")",";",["T_WHITESPACE","\n\n            ",474],["T_VARIABLE","$customerId",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_VARIABLE","$order",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getCustomerId",476],"(",")",";",["T_WHITESPACE","\n            ",476],["T_IF","if",477],["T_WHITESPACE"," ",477],"(",["T_VARIABLE","$customerId",477],")",["T_WHITESPACE"," ",477],"{",["T_WHITESPACE","\n                ",477],["T_VARIABLE","$request",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","setCustref",478],"(",["T_VARIABLE","$customerId",478],")",";",["T_WHITESPACE","\n            ",478],"}",["T_WHITESPACE","\n\n            ",479],["T_VARIABLE","$billing",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_VARIABLE","$order",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getBillingAddress",481],"(",")",";",["T_WHITESPACE","\n            ",481],["T_IF","if",482],["T_WHITESPACE"," ",482],"(","!",["T_EMPTY","empty",482],"(",["T_VARIABLE","$billing",482],")",")",["T_WHITESPACE"," ",482],"{",["T_WHITESPACE","\n                ",482],["T_VARIABLE","$request",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","setFirstname",483],"(",["T_VARIABLE","$billing",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getFirstname",483],"(",")",")",["T_WHITESPACE","\n                    ",483],["T_OBJECT_OPERATOR","->",484],["T_STRING","setLastname",484],"(",["T_VARIABLE","$billing",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getLastname",484],"(",")",")",["T_WHITESPACE","\n                    ",484],["T_OBJECT_OPERATOR","->",485],["T_STRING","setStreet",485],"(",["T_STRING","implode",485],"(",["T_CONSTANT_ENCAPSED_STRING","' '",485],",",["T_WHITESPACE"," ",485],["T_VARIABLE","$billing",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","getStreet",485],"(",")",")",")",["T_WHITESPACE","\n                    ",485],["T_OBJECT_OPERATOR","->",486],["T_STRING","setCity",486],"(",["T_VARIABLE","$billing",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getCity",486],"(",")",")",["T_WHITESPACE","\n                    ",486],["T_OBJECT_OPERATOR","->",487],["T_STRING","setState",487],"(",["T_VARIABLE","$billing",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getRegionCode",487],"(",")",")",["T_WHITESPACE","\n                    ",487],["T_OBJECT_OPERATOR","->",488],["T_STRING","setZip",488],"(",["T_VARIABLE","$billing",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getPostcode",488],"(",")",")",["T_WHITESPACE","\n                    ",488],["T_OBJECT_OPERATOR","->",489],["T_STRING","setCountry",489],"(",["T_VARIABLE","$billing",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getCountry",489],"(",")",")",["T_WHITESPACE","\n                    ",489],["T_OBJECT_OPERATOR","->",490],["T_STRING","setEmail",490],"(",["T_VARIABLE","$payment",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","getOrder",490],"(",")",["T_OBJECT_OPERATOR","->",490],["T_STRING","getCustomerEmail",490],"(",")",")",";",["T_WHITESPACE","\n            ",490],"}",["T_WHITESPACE","\n            ",491],["T_VARIABLE","$shipping",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_VARIABLE","$order",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getShippingAddress",492],"(",")",";",["T_WHITESPACE","\n            ",492],["T_IF","if",493],["T_WHITESPACE"," ",493],"(","!",["T_EMPTY","empty",493],"(",["T_VARIABLE","$shipping",493],")",")",["T_WHITESPACE"," ",493],"{",["T_WHITESPACE","\n                ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","_applyCountryWorkarounds",494],"(",["T_VARIABLE","$shipping",494],")",";",["T_WHITESPACE","\n                ",494],["T_VARIABLE","$request",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","setShiptofirstname",495],"(",["T_VARIABLE","$shipping",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getFirstname",495],"(",")",")",["T_WHITESPACE","\n                    ",495],["T_OBJECT_OPERATOR","->",496],["T_STRING","setShiptolastname",496],"(",["T_VARIABLE","$shipping",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getLastname",496],"(",")",")",["T_WHITESPACE","\n                    ",496],["T_OBJECT_OPERATOR","->",497],["T_STRING","setShiptostreet",497],"(",["T_STRING","implode",497],"(",["T_CONSTANT_ENCAPSED_STRING","' '",497],",",["T_WHITESPACE"," ",497],["T_VARIABLE","$shipping",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getStreet",497],"(",")",")",")",["T_WHITESPACE","\n                    ",497],["T_OBJECT_OPERATOR","->",498],["T_STRING","setShiptocity",498],"(",["T_VARIABLE","$shipping",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getCity",498],"(",")",")",["T_WHITESPACE","\n                    ",498],["T_OBJECT_OPERATOR","->",499],["T_STRING","setShiptostate",499],"(",["T_VARIABLE","$shipping",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","getRegionCode",499],"(",")",")",["T_WHITESPACE","\n                    ",499],["T_OBJECT_OPERATOR","->",500],["T_STRING","setShiptozip",500],"(",["T_VARIABLE","$shipping",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getPostcode",500],"(",")",")",["T_WHITESPACE","\n                    ",500],["T_OBJECT_OPERATOR","->",501],["T_STRING","setShiptocountry",501],"(",["T_VARIABLE","$shipping",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getCountry",501],"(",")",")",";",["T_WHITESPACE","\n            ",501],"}",["T_WHITESPACE","\n        ",502],"}",["T_WHITESPACE","\n        ",503],["T_RETURN","return",504],["T_WHITESPACE"," ",504],["T_VARIABLE","$request",504],";",["T_WHITESPACE","\n    ",504],"}",["T_WHITESPACE","\n\n     ",505],["T_DOC_COMMENT","\/**\n      * Return request object with basic information for gateway request\n      *\n      * @param Mage_Sales_Model_Order_Payment $payment\n      * @return Varien_Object\n      *\/",507],["T_WHITESPACE","\n    ",512],["T_PROTECTED","protected",513],["T_WHITESPACE"," ",513],["T_FUNCTION","function",513],["T_WHITESPACE"," ",513],["T_STRING","_buildBasicRequest",513],"(",["T_STRING","Varien_Object",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$payment",513],")",["T_WHITESPACE","\n    ",513],"{",["T_WHITESPACE","\n        ",514],["T_VARIABLE","$request",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_NEW","new",515],["T_WHITESPACE"," ",515],["T_STRING","Varien_Object",515],"(",")",";",["T_WHITESPACE","\n        ",515],["T_VARIABLE","$bnCode",516],["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_STRING","Mage",516],["T_DOUBLE_COLON","::",516],["T_STRING","getModel",516],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/config'",516],")",["T_OBJECT_OPERATOR","->",516],["T_STRING","getBuildNotationCode",516],"(",")",";",["T_WHITESPACE","\n        ",516],["T_VARIABLE","$request",517],["T_WHITESPACE","\n            ",517],["T_OBJECT_OPERATOR","->",518],["T_STRING","setUser",518],"(",["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getConfigData",518],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",518],")",")",["T_WHITESPACE","\n            ",518],["T_OBJECT_OPERATOR","->",519],["T_STRING","setVendor",519],"(",["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getConfigData",519],"(",["T_CONSTANT_ENCAPSED_STRING","'vendor'",519],")",")",["T_WHITESPACE","\n            ",519],["T_OBJECT_OPERATOR","->",520],["T_STRING","setPartner",520],"(",["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","getConfigData",520],"(",["T_CONSTANT_ENCAPSED_STRING","'partner'",520],")",")",["T_WHITESPACE","\n            ",520],["T_OBJECT_OPERATOR","->",521],["T_STRING","setPwd",521],"(",["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getConfigData",521],"(",["T_CONSTANT_ENCAPSED_STRING","'pwd'",521],")",")",["T_WHITESPACE","\n            ",521],["T_OBJECT_OPERATOR","->",522],["T_STRING","setVerbosity",522],"(",["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getConfigData",522],"(",["T_CONSTANT_ENCAPSED_STRING","'verbosity'",522],")",")",["T_WHITESPACE","\n            ",522],["T_OBJECT_OPERATOR","->",523],["T_STRING","setData",523],"(",["T_CONSTANT_ENCAPSED_STRING","'BNCODE'",523],",",["T_WHITESPACE"," ",523],["T_VARIABLE","$bnCode",523],")",["T_WHITESPACE","\n            ",523],["T_OBJECT_OPERATOR","->",524],["T_STRING","setTender",524],"(",["T_STRING","self",524],["T_DOUBLE_COLON","::",524],["T_STRING","TENDER_CC",524],")",["T_WHITESPACE","\n            ",524],["T_OBJECT_OPERATOR","->",525],["T_STRING","setRequestId",525],"(",["T_VARIABLE","$this",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","_generateRequestId",525],"(",")",")",";",["T_WHITESPACE","\n        ",525],["T_RETURN","return",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$request",526],";",["T_WHITESPACE","\n    ",526],"}",["T_WHITESPACE","\n\n     ",527],["T_DOC_COMMENT","\/**\n      * Return unique value for request\n      *\n      * @return string\n      *\/",529],["T_WHITESPACE","\n    ",533],["T_PROTECTED","protected",534],["T_WHITESPACE"," ",534],["T_FUNCTION","function",534],["T_WHITESPACE"," ",534],["T_STRING","_generateRequestId",534],"(",")",["T_WHITESPACE","\n    ",534],"{",["T_WHITESPACE","\n        ",535],["T_RETURN","return",536],["T_WHITESPACE"," ",536],["T_STRING","Mage",536],["T_DOUBLE_COLON","::",536],["T_STRING","helper",536],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",536],")",["T_OBJECT_OPERATOR","->",536],["T_STRING","uniqHash",536],"(",")",";",["T_WHITESPACE","\n    ",536],"}",["T_WHITESPACE","\n\n     ",537],["T_DOC_COMMENT","\/**\n      * If response is failed throw exception\n      *\n      * @throws Mage_Core_Exception\n      *\/",539],["T_WHITESPACE","\n    ",543],["T_PROTECTED","protected",544],["T_WHITESPACE"," ",544],["T_FUNCTION","function",544],["T_WHITESPACE"," ",544],["T_STRING","_processErrors",544],"(",["T_STRING","Varien_Object",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$response",544],")",["T_WHITESPACE","\n    ",544],"{",["T_WHITESPACE","\n        ",545],["T_IF","if",546],["T_WHITESPACE"," ",546],"(",["T_VARIABLE","$response",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","getResultCode",546],"(",")",["T_WHITESPACE"," ",546],["T_IS_EQUAL","==",546],["T_WHITESPACE"," ",546],["T_STRING","self",546],["T_DOUBLE_COLON","::",546],["T_STRING","RESPONSE_CODE_VOID_ERROR",546],")",["T_WHITESPACE"," ",546],"{",["T_WHITESPACE","\n            ",546],["T_THROW","throw",547],["T_WHITESPACE"," ",547],["T_NEW","new",547],["T_WHITESPACE"," ",547],["T_STRING","Mage_Paypal_Exception",547],"(",["T_STRING","Mage",547],["T_DOUBLE_COLON","::",547],["T_STRING","helper",547],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",547],")",["T_OBJECT_OPERATOR","->",547],["T_STRING","__",547],"(",["T_CONSTANT_ENCAPSED_STRING","'You cannot void a verification transaction'",547],")",")",";",["T_WHITESPACE","\n        ",547],"}",["T_WHITESPACE"," ",548],["T_ELSEIF","elseif",548],["T_WHITESPACE"," ",548],"(",["T_VARIABLE","$response",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","getResultCode",548],"(",")",["T_WHITESPACE"," ",548],["T_IS_NOT_EQUAL","!=",548],["T_WHITESPACE"," ",548],["T_STRING","self",548],["T_DOUBLE_COLON","::",548],["T_STRING","RESPONSE_CODE_APPROVED",548],["T_WHITESPACE","\n            ",548],["T_BOOLEAN_AND","&&",549],["T_WHITESPACE"," ",549],["T_VARIABLE","$response",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getResultCode",549],"(",")",["T_WHITESPACE"," ",549],["T_IS_NOT_EQUAL","!=",549],["T_WHITESPACE"," ",549],["T_STRING","self",549],["T_DOUBLE_COLON","::",549],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",549],")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_STRING","Mage",550],["T_DOUBLE_COLON","::",550],["T_STRING","throwException",550],"(",["T_VARIABLE","$response",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","getRespmsg",550],"(",")",")",";",["T_WHITESPACE","\n        ",550],"}",["T_WHITESPACE","\n    ",551],"}",["T_WHITESPACE","\n\n    ",552],["T_DOC_COMMENT","\/**\n     * Adopt specified address object to be compatible with Paypal\n     * Puerto Rico should be as state of USA and not as a country\n     *\n     * @param Varien_Object $address\n     *\/",554],["T_WHITESPACE","\n    ",559],["T_PROTECTED","protected",560],["T_WHITESPACE"," ",560],["T_FUNCTION","function",560],["T_WHITESPACE"," ",560],["T_STRING","_applyCountryWorkarounds",560],"(",["T_STRING","Varien_Object",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$address",560],")",["T_WHITESPACE","\n    ",560],"{",["T_WHITESPACE","\n        ",561],["T_IF","if",562],["T_WHITESPACE"," ",562],"(",["T_VARIABLE","$address",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","getCountry",562],"(",")",["T_WHITESPACE"," ",562],["T_IS_EQUAL","==",562],["T_WHITESPACE"," ",562],["T_CONSTANT_ENCAPSED_STRING","'PR'",562],")",["T_WHITESPACE"," ",562],"{",["T_WHITESPACE","\n            ",562],["T_VARIABLE","$address",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","setCountry",563],"(",["T_CONSTANT_ENCAPSED_STRING","'US'",563],")",";",["T_WHITESPACE","\n            ",563],["T_VARIABLE","$address",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","setRegionCode",564],"(",["T_CONSTANT_ENCAPSED_STRING","'PR'",564],")",";",["T_WHITESPACE","\n        ",564],"}",["T_WHITESPACE","\n    ",565],"}",["T_WHITESPACE","\n\n    ",566],["T_DOC_COMMENT","\/**\n     * Set reference transaction data into request\n     *\n     * @param Varien_Object $payment\n     * @param Varien_Object $request\n     * @return Mage_Paypal_Model_Payflowpro\n     *\/",568],["T_WHITESPACE","\n    ",574],["T_PROTECTED","protected",575],["T_WHITESPACE"," ",575],["T_FUNCTION","function",575],["T_WHITESPACE"," ",575],["T_STRING","_setReferenceTransaction",575],"(",["T_STRING","Varien_Object",575],["T_WHITESPACE"," ",575],["T_VARIABLE","$payment",575],",",["T_WHITESPACE"," ",575],["T_VARIABLE","$request",575],")",["T_WHITESPACE","\n    ",575],"{",["T_WHITESPACE","\n        ",576],["T_RETURN","return",577],["T_WHITESPACE"," ",577],["T_VARIABLE","$this",577],";",["T_WHITESPACE","\n    ",577],"}",["T_WHITESPACE","\n",578],"}",["T_WHITESPACE","\n",579]]