[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Payflow Link payment gateway model\n *\n * @category    Mage\n * @package     Mage_Paypal\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Paypal_Model_Payflowlink",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Paypal_Model_Payflowpro",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Default layout template\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","LAYOUT_TEMPLATE",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'minLayout'",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Mobile layout template\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_CONST","const",45],["T_WHITESPACE"," ",45],["T_STRING","MOBILE_LAYOUT_TEMPLATE",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_CONSTANT_ENCAPSED_STRING","'mobile'",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Controller for callback urls\n     *\n     * @var string\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_callbackController",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","'payflow'",52],";",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Response params mappings\n     *\n     * @var array\n     *\/",54],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$_responseParamsMappings",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_ARRAY","array",59],"(",["T_WHITESPACE","\n        ",59],["T_CONSTANT_ENCAPSED_STRING","'firstname'",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'billtofirstname'",60],",",["T_WHITESPACE","\n        ",60],["T_CONSTANT_ENCAPSED_STRING","'lastname'",61],["T_WHITESPACE"," ",61],["T_DOUBLE_ARROW","=>",61],["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'billtolastname'",61],",",["T_WHITESPACE","\n        ",61],["T_CONSTANT_ENCAPSED_STRING","'address'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'billtostreet'",62],",",["T_WHITESPACE","\n        ",62],["T_CONSTANT_ENCAPSED_STRING","'city'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'billtocity'",63],",",["T_WHITESPACE","\n        ",63],["T_CONSTANT_ENCAPSED_STRING","'state'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'billtostate'",64],",",["T_WHITESPACE","\n        ",64],["T_CONSTANT_ENCAPSED_STRING","'zip'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'billtozip'",65],",",["T_WHITESPACE","\n        ",65],["T_CONSTANT_ENCAPSED_STRING","'country'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'billtocountry'",66],",",["T_WHITESPACE","\n        ",66],["T_CONSTANT_ENCAPSED_STRING","'phone'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'billtophone'",67],",",["T_WHITESPACE","\n        ",67],["T_CONSTANT_ENCAPSED_STRING","'email'",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'billtoemail'",68],",",["T_WHITESPACE","\n        ",68],["T_CONSTANT_ENCAPSED_STRING","'nametoship'",69],["T_WHITESPACE"," ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'shiptofirstname'",69],",",["T_WHITESPACE","\n        ",69],["T_CONSTANT_ENCAPSED_STRING","'addresstoship'",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'shiptostreet'",70],",",["T_WHITESPACE","\n        ",70],["T_CONSTANT_ENCAPSED_STRING","'citytoship'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'shiptocity'",71],",",["T_WHITESPACE","\n        ",71],["T_CONSTANT_ENCAPSED_STRING","'statetoship'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'shiptostate'",72],",",["T_WHITESPACE","\n        ",72],["T_CONSTANT_ENCAPSED_STRING","'ziptoship'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'shiptozip'",73],",",["T_WHITESPACE","\n        ",73],["T_CONSTANT_ENCAPSED_STRING","'countrytoship'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'shiptocountry'",74],",",["T_WHITESPACE","\n        ",74],["T_CONSTANT_ENCAPSED_STRING","'phonetoship'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'shiptophone'",75],",",["T_WHITESPACE","\n        ",75],["T_CONSTANT_ENCAPSED_STRING","'emailtoship'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'shiptoemail'",76],",",["T_WHITESPACE","\n        ",76],["T_CONSTANT_ENCAPSED_STRING","'faxtoship'",77],["T_WHITESPACE"," ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'shiptofax'",77],",",["T_WHITESPACE","\n        ",77],["T_CONSTANT_ENCAPSED_STRING","'method'",78],["T_WHITESPACE"," ",78],["T_DOUBLE_ARROW","=>",78],["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'tender'",78],",",["T_WHITESPACE","\n        ",78],["T_CONSTANT_ENCAPSED_STRING","'cscmatch'",79],["T_WHITESPACE"," ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'cvv2match'",79],",",["T_WHITESPACE","\n        ",79],["T_CONSTANT_ENCAPSED_STRING","'type'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'trxtype'",80],",",["T_WHITESPACE","\n    ",80],")",";",["T_WHITESPACE","\n\n    ",81],["T_DOC_COMMENT","\/**\n     * Payment method code\n     *\/",83],["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$_code",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","Mage_Paypal_Model_Config",86],["T_DOUBLE_COLON","::",86],["T_STRING","METHOD_PAYFLOWLINK",86],";",["T_WHITESPACE","\n\n    ",86],["T_PROTECTED","protected",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$_formBlockType",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'paypal\/payflow_link_form'",88],";",["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$_infoBlockType",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'paypal\/payflow_link_info'",89],";",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Availability options\n     *\/",91],["T_WHITESPACE","\n    ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$_canUseInternal",94],["T_WHITESPACE","          ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","false",94],";",["T_WHITESPACE","\n    ",94],["T_PROTECTED","protected",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$_canUseForMultishipping",95],["T_WHITESPACE","  ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","false",95],";",["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$_isInitializeNeeded",96],["T_WHITESPACE","      ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","true",96],";",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Request & response model\n     * @var Mage_Paypal_Model_Payflow_Request\n     *\/",98],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$_response",102],";",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Gateway request URL\n     * @var string\n     *\/",104],["T_WHITESPACE","\n    ",107],["T_CONST","const",108],["T_WHITESPACE"," ",108],["T_STRING","TRANSACTION_PAYFLOW_URL",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/payflowlink.paypal.com\/'",108],";",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Error message\n     * @var string\n     *\/",110],["T_WHITESPACE","\n    ",113],["T_CONST","const",114],["T_WHITESPACE"," ",114],["T_STRING","RESPONSE_ERROR_MSG",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'Payment error. %s was not found.'",114],";",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Key for storing secure hash in additional information of payment model\n     *\n     * @var string\n     *\/",116],["T_WHITESPACE","\n    ",120],["T_PROTECTED","protected",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$_secureSilentPostHashKey",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'secure_silent_post_hash'",121],";",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Do not validate payment form using server methods\n     *\n     * @return  bool\n     *\/",123],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","validate",128],"(",")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_STRING","true",130],";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Check whether payment method can be used\n     *\n     * @param Mage_Sales_Model_Quote\n     * @return bool\n     *\/",133],["T_WHITESPACE","\n    ",138],["T_PUBLIC","public",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","isAvailable",139],"(",["T_VARIABLE","$quote",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","null",139],")",["T_WHITESPACE","\n    ",139],"{",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$storeId",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","Mage",141],["T_DOUBLE_COLON","::",141],["T_STRING","app",141],"(",")",["T_OBJECT_OPERATOR","->",141],["T_STRING","getStore",141],"(",["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getStore",141],"(",")",")",["T_OBJECT_OPERATOR","->",141],["T_STRING","getId",141],"(",")",";",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$config",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","Mage",142],["T_DOUBLE_COLON","::",142],["T_STRING","getModel",142],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/config'",142],")",["T_OBJECT_OPERATOR","->",142],["T_STRING","setStoreId",142],"(",["T_VARIABLE","$storeId",142],")",";",["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_STRING","Mage_Payment_Model_Method_Abstract",143],["T_DOUBLE_COLON","::",143],["T_STRING","isAvailable",143],"(",["T_VARIABLE","$quote",143],")",["T_WHITESPACE"," ",143],["T_BOOLEAN_AND","&&",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$config",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","isMethodAvailable",143],"(",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getCode",143],"(",")",")",")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_STRING","true",144],";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n        ",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_STRING","false",146],";",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Return iframe template value depending on config\n     *\n     * @return string\n     *\/",149],["T_WHITESPACE","\n    ",153],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","getTemplate",154],"(",")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getConfigData",156],"(",["T_CONSTANT_ENCAPSED_STRING","'mobile_optimized'",156],")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_RETURN","return",157],["T_WHITESPACE"," ",157],["T_STRING","self",157],["T_DOUBLE_COLON","::",157],["T_STRING","MOBILE_LAYOUT_TEMPLATE",157],";",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE"," ",158],["T_ELSE","else",158],["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_STRING","self",159],["T_DOUBLE_COLON","::",159],["T_STRING","LAYOUT_TEMPLATE",159],";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Instantiate state and set it to state object\n     *\n     * @param string $paymentAction\n     * @param Varien_Object $stateObject\n     *\/",163],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","initialize",169],"(",["T_VARIABLE","$paymentAction",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$stateObject",169],")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_SWITCH","switch",171],["T_WHITESPACE"," ",171],"(",["T_VARIABLE","$paymentAction",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_CASE","case",172],["T_WHITESPACE"," ",172],["T_STRING","Mage_Paypal_Model_Config",172],["T_DOUBLE_COLON","::",172],["T_STRING","PAYMENT_ACTION_AUTH",172],":",["T_WHITESPACE","\n            ",172],["T_CASE","case",173],["T_WHITESPACE"," ",173],["T_STRING","Mage_Paypal_Model_Config",173],["T_DOUBLE_COLON","::",173],["T_STRING","PAYMENT_ACTION_SALE",173],":",["T_WHITESPACE","\n                ",173],["T_VARIABLE","$payment",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getInfoInstance",174],"(",")",";",["T_WHITESPACE","\n                ",174],["T_VARIABLE","$order",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$payment",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getOrder",175],"(",")",";",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$order",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","setCanSendNewEmailFlag",176],"(",["T_STRING","false",176],")",";",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$payment",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","setAmountAuthorized",177],"(",["T_VARIABLE","$order",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getTotalDue",177],"(",")",")",";",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$payment",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","setBaseAmountAuthorized",178],"(",["T_VARIABLE","$order",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getBaseTotalDue",178],"(",")",")",";",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_generateSecureSilentPostHash",179],"(",["T_VARIABLE","$payment",179],")",";",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$request",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_buildTokenRequest",180],"(",["T_VARIABLE","$payment",180],")",";",["T_WHITESPACE","\n                ",180],["T_VARIABLE","$response",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_postRequest",181],"(",["T_VARIABLE","$request",181],")",";",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_processTokenErrors",182],"(",["T_VARIABLE","$response",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$payment",182],")",";",["T_WHITESPACE","\n\n                ",182],["T_VARIABLE","$order",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$payment",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getOrder",184],"(",")",";",["T_WHITESPACE","\n                ",184],["T_VARIABLE","$order",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","setCanSendNewEmailFlag",185],"(",["T_STRING","false",185],")",";",["T_WHITESPACE","\n\n                ",185],["T_VARIABLE","$stateObject",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","setState",187],"(",["T_STRING","Mage_Sales_Model_Order",187],["T_DOUBLE_COLON","::",187],["T_STRING","STATE_PENDING_PAYMENT",187],")",";",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$stateObject",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","setStatus",188],"(",["T_CONSTANT_ENCAPSED_STRING","'pending_payment'",188],")",";",["T_WHITESPACE","\n                ",188],["T_VARIABLE","$stateObject",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","setIsNotified",189],"(",["T_STRING","false",189],")",";",["T_WHITESPACE","\n                ",189],["T_BREAK","break",190],";",["T_WHITESPACE","\n            ",190],["T_DEFAULT","default",191],":",["T_WHITESPACE","\n                ",191],["T_BREAK","break",192],";",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n\n    ",194],["T_DOC_COMMENT","\/**\n     * Return response model.\n     *\n     * @return Mage_Mage_Paypal_Model_Payflow_Request\n     *\/",196],["T_WHITESPACE","\n    ",200],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","getResponse",201],"(",")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(","!",["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_response",203],")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_response",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_STRING","Mage",204],["T_DOUBLE_COLON","::",204],["T_STRING","getModel",204],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/payflow_request'",204],")",";",["T_WHITESPACE","\n        ",204],"}",["T_WHITESPACE","\n\n        ",205],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_response",207],";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n\n    ",208],["T_DOC_COMMENT","\/**\n     * Fill response with data.\n     *\n     * @param array $postData\n     * @return Mage_Paypal_Model_Payflowlink\n     *\/",210],["T_WHITESPACE","\n    ",215],["T_PUBLIC","public",216],["T_WHITESPACE"," ",216],["T_FUNCTION","function",216],["T_WHITESPACE"," ",216],["T_STRING","setResponseData",216],"(",["T_ARRAY","array",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$postData",216],")",["T_WHITESPACE","\n    ",216],"{",["T_WHITESPACE","\n        ",217],["T_FOREACH","foreach",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$postData",218],["T_WHITESPACE"," ",218],["T_AS","as",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$key",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$val",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getResponse",219],"(",")",["T_OBJECT_OPERATOR","->",219],["T_STRING","setData",219],"(",["T_STRING","strtolower",219],"(",["T_VARIABLE","$key",219],")",",",["T_WHITESPACE"," ",219],["T_VARIABLE","$val",219],")",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n        ",220],["T_FOREACH","foreach",221],["T_WHITESPACE"," ",221],"(",["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","_responseParamsMappings",221],["T_WHITESPACE"," ",221],["T_AS","as",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$originKey",221],["T_WHITESPACE"," ",221],["T_DOUBLE_ARROW","=>",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$key",221],")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n            ",221],["T_VARIABLE","$data",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getResponse",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","getData",222],"(",["T_VARIABLE","$key",222],")",";",["T_WHITESPACE","\n            ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_ISSET","isset",223],"(",["T_VARIABLE","$data",223],")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getResponse",224],"(",")",["T_OBJECT_OPERATOR","->",224],["T_STRING","setData",224],"(",["T_VARIABLE","$originKey",224],",",["T_WHITESPACE"," ",224],["T_VARIABLE","$data",224],")",";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE","\n        ",226],["T_COMMENT","\/\/ process AVS data separately\n",227],["T_WHITESPACE","        ",228],["T_VARIABLE","$avsAddr",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getResponse",228],"(",")",["T_OBJECT_OPERATOR","->",228],["T_STRING","getData",228],"(",["T_CONSTANT_ENCAPSED_STRING","'avsaddr'",228],")",";",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$avsZip",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getResponse",229],"(",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getData",229],"(",["T_CONSTANT_ENCAPSED_STRING","'avszip'",229],")",";",["T_WHITESPACE","\n        ",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_ISSET","isset",230],"(",["T_VARIABLE","$avsAddr",230],")",["T_WHITESPACE"," ",230],["T_BOOLEAN_AND","&&",230],["T_WHITESPACE"," ",230],["T_ISSET","isset",230],"(",["T_VARIABLE","$avsZip",230],")",")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getResponse",231],"(",")",["T_OBJECT_OPERATOR","->",231],["T_STRING","setData",231],"(",["T_CONSTANT_ENCAPSED_STRING","'avsdata'",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$avsAddr",231],["T_WHITESPACE"," ",231],".",["T_WHITESPACE"," ",231],["T_VARIABLE","$avsZip",231],")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n        ",232],["T_COMMENT","\/\/ process Name separately\n",233],["T_WHITESPACE","        ",234],["T_VARIABLE","$firstnameParameter",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getResponse",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","getData",234],"(",["T_CONSTANT_ENCAPSED_STRING","'billtofirstname'",234],")",";",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$lastnameParameter",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getResponse",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","getData",235],"(",["T_CONSTANT_ENCAPSED_STRING","'billtolastname'",235],")",";",["T_WHITESPACE","\n        ",235],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_ISSET","isset",236],"(",["T_VARIABLE","$firstnameParameter",236],")",["T_WHITESPACE"," ",236],["T_BOOLEAN_AND","&&",236],["T_WHITESPACE"," ",236],["T_ISSET","isset",236],"(",["T_VARIABLE","$lastnameParameter",236],")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getResponse",237],"(",")",["T_OBJECT_OPERATOR","->",237],["T_STRING","setData",237],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",237],",",["T_WHITESPACE"," ",237],["T_VARIABLE","$firstnameParameter",237],["T_WHITESPACE"," ",237],".",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","' '",237],["T_WHITESPACE"," ",237],".",["T_WHITESPACE"," ",237],["T_VARIABLE","$lastnameParameter",237],")",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n\n        ",238],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n\n    ",241],["T_DOC_COMMENT","\/**\n     * Operate with order using data from $_POST which came from Silent Post Url.\n     *\n     * @param array $responseData\n     * @throws Mage_Core_Exception in case of validation error or order creation error\n     *\/",243],["T_WHITESPACE","\n    ",248],["T_PUBLIC","public",249],["T_WHITESPACE"," ",249],["T_FUNCTION","function",249],["T_WHITESPACE"," ",249],["T_STRING","process",249],"(",["T_VARIABLE","$responseData",249],")",["T_WHITESPACE","\n    ",249],"{",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$debugData",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_ARRAY","array",251],"(",["T_WHITESPACE","\n            ",251],["T_CONSTANT_ENCAPSED_STRING","'response'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$responseData",252],["T_WHITESPACE","\n        ",252],")",";",["T_WHITESPACE","\n        ",253],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","_debug",254],"(",["T_VARIABLE","$debugData",254],")",";",["T_WHITESPACE","\n\n        ",254],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","setResponseData",256],"(",["T_VARIABLE","$responseData",256],")",";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$order",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","_getOrderFromResponse",257],"(",")",";",["T_WHITESPACE","\n\n        ",257],["T_IF","if",259],["T_WHITESPACE"," ",259],"(",["T_VARIABLE","$order",259],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n            ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","_processOrder",260],"(",["T_VARIABLE","$order",260],")",";",["T_WHITESPACE","\n        ",260],"}",["T_WHITESPACE","\n    ",261],"}",["T_WHITESPACE","\n\n    ",262],["T_DOC_COMMENT","\/**\n     * Operate with order using information from silent post\n     *\n     * @param Mage_Sales_Model_Order $order\n     *\/",264],["T_WHITESPACE","\n    ",268],["T_PROTECTED","protected",269],["T_WHITESPACE"," ",269],["T_FUNCTION","function",269],["T_WHITESPACE"," ",269],["T_STRING","_processOrder",269],"(",["T_STRING","Mage_Sales_Model_Order",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$order",269],")",["T_WHITESPACE","\n    ",269],"{",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$response",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getResponse",271],"(",")",";",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$payment",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$order",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getPayment",272],"(",")",";",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$payment",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","setTransactionId",273],"(",["T_VARIABLE","$response",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getPnref",273],"(",")",")",["T_WHITESPACE","\n            ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","setIsTransactionClosed",274],"(",["T_LNUMBER","0",274],")",";",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$canSendNewOrderEmail",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_STRING","true",275],";",["T_WHITESPACE","\n\n        ",275],["T_IF","if",277],["T_WHITESPACE"," ",277],"(",["T_VARIABLE","$response",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getResult",277],"(",")",["T_WHITESPACE"," ",277],["T_IS_EQUAL","==",277],["T_WHITESPACE"," ",277],["T_STRING","self",277],["T_DOUBLE_COLON","::",277],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",277],["T_WHITESPACE"," ",277],["T_BOOLEAN_OR","||",277],["T_WHITESPACE","\n            ",277],["T_VARIABLE","$response",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getResult",278],"(",")",["T_WHITESPACE"," ",278],["T_IS_EQUAL","==",278],["T_WHITESPACE"," ",278],["T_STRING","self",278],["T_DOUBLE_COLON","::",278],["T_STRING","RESPONSE_CODE_DECLINED_BY_FILTER",278],["T_WHITESPACE","\n        ",278],")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n            ",279],["T_VARIABLE","$canSendNewOrderEmail",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_STRING","false",280],";",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$fraudMessage",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","_getFraudMessage",281],"(",")",["T_WHITESPACE"," ",281],"?",["T_WHITESPACE","\n                ",281],["T_VARIABLE","$response",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getFraudMessage",282],"(",")",["T_WHITESPACE"," ",282],":",["T_WHITESPACE"," ",282],["T_VARIABLE","$response",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getRespmsg",282],"(",")",";",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$payment",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","setIsTransactionPending",283],"(",["T_STRING","true",283],")",["T_WHITESPACE","\n                ",283],["T_OBJECT_OPERATOR","->",284],["T_STRING","setIsFraudDetected",284],"(",["T_STRING","true",284],")",["T_WHITESPACE","\n                ",284],["T_OBJECT_OPERATOR","->",285],["T_STRING","setAdditionalInformation",285],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_fraud_filters'",285],",",["T_WHITESPACE"," ",285],["T_VARIABLE","$fraudMessage",285],")",";",["T_WHITESPACE","\n        ",285],"}",["T_WHITESPACE","\n\n        ",286],["T_IF","if",288],["T_WHITESPACE"," ",288],"(",["T_VARIABLE","$response",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getAvsdata",288],"(",")",["T_WHITESPACE"," ",288],["T_BOOLEAN_AND","&&",288],["T_WHITESPACE"," ",288],["T_STRING","strstr",288],"(",["T_STRING","substr",288],"(",["T_VARIABLE","$response",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getAvsdata",288],"(",")",",",["T_WHITESPACE"," ",288],["T_LNUMBER","0",288],",",["T_WHITESPACE"," ",288],["T_LNUMBER","2",288],")",",",["T_WHITESPACE"," ",288],["T_CONSTANT_ENCAPSED_STRING","'N'",288],")",")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$payment",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","setAdditionalInformation",289],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_avs_code'",289],",",["T_WHITESPACE"," ",289],["T_STRING","substr",289],"(",["T_VARIABLE","$response",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getAvsdata",289],"(",")",",",["T_WHITESPACE"," ",289],["T_LNUMBER","0",289],",",["T_WHITESPACE"," ",289],["T_LNUMBER","2",289],")",")",";",["T_WHITESPACE","\n        ",289],"}",["T_WHITESPACE","\n        ",290],["T_IF","if",291],["T_WHITESPACE"," ",291],"(",["T_VARIABLE","$response",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getCvv2match",291],"(",")",["T_WHITESPACE"," ",291],["T_BOOLEAN_AND","&&",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$response",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getCvv2match",291],"(",")",["T_WHITESPACE"," ",291],["T_IS_NOT_EQUAL","!=",291],["T_WHITESPACE"," ",291],["T_CONSTANT_ENCAPSED_STRING","'Y'",291],")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$payment",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","setAdditionalInformation",292],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal_cvv2_match'",292],",",["T_WHITESPACE"," ",292],["T_VARIABLE","$response",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getCvv2match",292],"(",")",")",";",["T_WHITESPACE","\n        ",292],"}",["T_WHITESPACE","\n\n        ",293],["T_SWITCH","switch",295],["T_WHITESPACE"," ",295],"(",["T_VARIABLE","$response",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getType",295],"(",")",")","{",["T_WHITESPACE","\n            ",295],["T_CASE","case",296],["T_WHITESPACE"," ",296],["T_STRING","self",296],["T_DOUBLE_COLON","::",296],["T_STRING","TRXTYPE_AUTH_ONLY",296],":",["T_WHITESPACE","\n                ",296],["T_VARIABLE","$payment",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","registerAuthorizationNotification",297],"(",["T_VARIABLE","$payment",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getBaseAmountAuthorized",297],"(",")",")",";",["T_WHITESPACE","\n                ",297],["T_BREAK","break",298],";",["T_WHITESPACE","\n            ",298],["T_CASE","case",299],["T_WHITESPACE"," ",299],["T_STRING","self",299],["T_DOUBLE_COLON","::",299],["T_STRING","TRXTYPE_SALE",299],":",["T_WHITESPACE","\n                ",299],["T_VARIABLE","$payment",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","registerCaptureNotification",300],"(",["T_VARIABLE","$payment",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getBaseAmountAuthorized",300],"(",")",")",";",["T_WHITESPACE","\n                ",300],["T_BREAK","break",301],";",["T_WHITESPACE","\n        ",301],"}",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$order",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","save",303],"(",")",";",["T_WHITESPACE","\n\n        ",303],["T_TRY","try",305],["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n            ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$canSendNewOrderEmail",306],")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n                ",306],["T_VARIABLE","$order",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","queueNewOrderEmail",307],"(",")",";",["T_WHITESPACE","\n            ",307],"}",["T_WHITESPACE","\n            ",308],["T_STRING","Mage",309],["T_DOUBLE_COLON","::",309],["T_STRING","getModel",309],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",309],")",["T_WHITESPACE","\n                ",309],["T_OBJECT_OPERATOR","->",310],["T_STRING","load",310],"(",["T_VARIABLE","$order",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getQuoteId",310],"(",")",")",["T_WHITESPACE","\n                ",310],["T_OBJECT_OPERATOR","->",311],["T_STRING","setIsActive",311],"(",["T_STRING","false",311],")",["T_WHITESPACE","\n                ",311],["T_OBJECT_OPERATOR","->",312],["T_STRING","save",312],"(",")",";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE"," ",313],["T_CATCH","catch",313],["T_WHITESPACE"," ",313],"(",["T_STRING","Exception",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$e",313],")",["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n            ",313],["T_STRING","Mage",314],["T_DOUBLE_COLON","::",314],["T_STRING","throwException",314],"(",["T_STRING","Mage",314],["T_DOUBLE_COLON","::",314],["T_STRING","helper",314],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal'",314],")",["T_OBJECT_OPERATOR","->",314],["T_STRING","__",314],"(",["T_CONSTANT_ENCAPSED_STRING","'Can not send new order email.'",314],")",")",";",["T_WHITESPACE","\n        ",314],"}",["T_WHITESPACE","\n    ",315],"}",["T_WHITESPACE","\n\n    ",316],["T_DOC_COMMENT","\/**\n     * Get fraud message from response\n     *\n     * @return string|bool\n     *\/",318],["T_WHITESPACE","\n    ",322],["T_PROTECTED","protected",323],["T_WHITESPACE"," ",323],["T_FUNCTION","function",323],["T_WHITESPACE"," ",323],["T_STRING","_getFraudMessage",323],"(",")",["T_WHITESPACE","\n    ",323],"{",["T_WHITESPACE","\n        ",324],["T_IF","if",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getResponse",325],"(",")",["T_OBJECT_OPERATOR","->",325],["T_STRING","getFpsPrexmldata",325],"(",")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_VARIABLE","$xml",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_NEW","new",326],["T_WHITESPACE"," ",326],["T_STRING","SimpleXMLElement",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getResponse",326],"(",")",["T_OBJECT_OPERATOR","->",326],["T_STRING","getFpsPrexmldata",326],"(",")",")",";",["T_WHITESPACE","\n            ",326],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getResponse",327],"(",")",["T_OBJECT_OPERATOR","->",327],["T_STRING","setFraudMessage",327],"(",["T_STRING_CAST","(string)",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$xml",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","rule",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","triggeredMessage",327],")",";",["T_WHITESPACE","\n            ",327],["T_RETURN","return",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","getResponse",328],"(",")",["T_OBJECT_OPERATOR","->",328],["T_STRING","getFraudMessage",328],"(",")",";",["T_WHITESPACE","\n        ",328],"}",["T_WHITESPACE","\n\n        ",329],["T_RETURN","return",331],["T_WHITESPACE"," ",331],["T_STRING","false",331],";",["T_WHITESPACE","\n    ",331],"}",["T_WHITESPACE","\n\n    ",332],["T_DOC_COMMENT","\/**\n     * Check response from Payflow gateway.\n     *\n     * @return Mage_Sales_Model_Order in case of validation passed\n     * @throws Mage_Core_Exception in other cases\n     *\/",334],["T_WHITESPACE","\n    ",339],["T_PROTECTED","protected",340],["T_WHITESPACE"," ",340],["T_FUNCTION","function",340],["T_WHITESPACE"," ",340],["T_STRING","_getOrderFromResponse",340],"(",")",["T_WHITESPACE","\n    ",340],"{",["T_WHITESPACE","\n        ",341],["T_VARIABLE","$response",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","getResponse",342],"(",")",";",["T_WHITESPACE","\n\n        ",342],["T_VARIABLE","$order",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_STRING","Mage",344],["T_DOUBLE_COLON","::",344],["T_STRING","getModel",344],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",344],")",["T_WHITESPACE","\n                ",344],["T_OBJECT_OPERATOR","->",345],["T_STRING","loadByIncrementId",345],"(",["T_VARIABLE","$response",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getInvnum",345],"(",")",")",";",["T_WHITESPACE","\n\n        ",345],["T_IF","if",347],["T_WHITESPACE"," ",347],"(",["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_getSecureSilentPostHash",347],"(",["T_VARIABLE","$order",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getPayment",347],"(",")",")",["T_WHITESPACE"," ",347],["T_IS_NOT_EQUAL","!=",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$response",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getUser2",347],"(",")",["T_WHITESPACE","\n            ",347],["T_BOOLEAN_OR","||",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","_code",348],["T_WHITESPACE"," ",348],["T_IS_NOT_EQUAL","!=",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$order",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getPayment",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","getMethodInstance",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","getCode",348],"(",")",["T_WHITESPACE","\n        ",348],")",["T_WHITESPACE"," ",349],"{",["T_WHITESPACE","\n            ",349],["T_RETURN","return",350],["T_WHITESPACE"," ",350],["T_STRING","false",350],";",["T_WHITESPACE","\n        ",350],"}",["T_WHITESPACE","\n\n        ",351],["T_IF","if",353],["T_WHITESPACE"," ",353],"(",["T_VARIABLE","$response",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getResult",353],"(",")",["T_WHITESPACE"," ",353],["T_IS_NOT_EQUAL","!=",353],["T_WHITESPACE"," ",353],["T_STRING","self",353],["T_DOUBLE_COLON","::",353],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",353],["T_WHITESPACE","\n            ",353],["T_BOOLEAN_AND","&&",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$response",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getResult",354],"(",")",["T_WHITESPACE"," ",354],["T_IS_NOT_EQUAL","!=",354],["T_WHITESPACE"," ",354],["T_STRING","self",354],["T_DOUBLE_COLON","::",354],["T_STRING","RESPONSE_CODE_DECLINED_BY_FILTER",354],["T_WHITESPACE","\n            ",354],["T_BOOLEAN_AND","&&",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$response",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getResult",355],"(",")",["T_WHITESPACE"," ",355],["T_IS_NOT_EQUAL","!=",355],["T_WHITESPACE"," ",355],["T_STRING","self",355],["T_DOUBLE_COLON","::",355],["T_STRING","RESPONSE_CODE_APPROVED",355],["T_WHITESPACE","\n        ",355],")",["T_WHITESPACE"," ",356],"{",["T_WHITESPACE","\n            ",356],["T_IF","if",357],["T_WHITESPACE"," ",357],"(",["T_VARIABLE","$order",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getState",357],"(",")",["T_WHITESPACE"," ",357],["T_IS_NOT_EQUAL","!=",357],["T_WHITESPACE"," ",357],["T_STRING","Mage_Sales_Model_Order",357],["T_DOUBLE_COLON","::",357],["T_STRING","STATE_CANCELED",357],")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n                ",357],["T_VARIABLE","$order",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","registerCancellation",358],"(",["T_VARIABLE","$response",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getRespmsg",358],"(",")",")",["T_OBJECT_OPERATOR","->",358],["T_STRING","save",358],"(",")",";",["T_WHITESPACE","\n            ",358],"}",["T_WHITESPACE","\n            ",359],["T_STRING","Mage",360],["T_DOUBLE_COLON","::",360],["T_STRING","throwException",360],"(",["T_VARIABLE","$response",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getRespmsg",360],"(",")",")",";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n\n        ",361],["T_VARIABLE","$amountCompared",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],"(",["T_VARIABLE","$response",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getAmt",363],"(",")",["T_WHITESPACE"," ",363],["T_IS_EQUAL","==",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$order",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getPayment",363],"(",")",["T_OBJECT_OPERATOR","->",363],["T_STRING","getBaseAmountAuthorized",363],"(",")",")",["T_WHITESPACE"," ",363],"?",["T_WHITESPACE"," ",363],["T_STRING","true",363],["T_WHITESPACE"," ",363],":",["T_WHITESPACE"," ",363],["T_STRING","false",363],";",["T_WHITESPACE","\n        ",363],["T_IF","if",364],["T_WHITESPACE"," ",364],"(","!",["T_VARIABLE","$order",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getId",364],"(",")",["T_WHITESPACE","\n            ",364],["T_BOOLEAN_OR","||",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$order",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getState",365],"(",")",["T_WHITESPACE"," ",365],["T_IS_NOT_EQUAL","!=",365],["T_WHITESPACE"," ",365],["T_STRING","Mage_Sales_Model_Order",365],["T_DOUBLE_COLON","::",365],["T_STRING","STATE_PENDING_PAYMENT",365],["T_WHITESPACE","\n            ",365],["T_BOOLEAN_OR","||",366],["T_WHITESPACE"," ",366],"!",["T_VARIABLE","$amountCompared",366],["T_WHITESPACE","\n        ",366],")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n            ",367],["T_STRING","Mage",368],["T_DOUBLE_COLON","::",368],["T_STRING","throwException",368],"(",["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_formatStr",368],"(",["T_STRING","self",368],["T_DOUBLE_COLON","::",368],["T_STRING","RESPONSE_ERROR_MSG",368],",",["T_WHITESPACE"," ",368],["T_CONSTANT_ENCAPSED_STRING","'Order'",368],")",")",";",["T_WHITESPACE","\n        ",368],"}",["T_WHITESPACE","\n\n        ",369],["T_VARIABLE","$fetchData",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","fetchTransactionInfo",371],"(",["T_VARIABLE","$order",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getPayment",371],"(",")",",",["T_WHITESPACE"," ",371],["T_VARIABLE","$response",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getPnref",371],"(",")",")",";",["T_WHITESPACE","\n        ",371],["T_IF","if",372],["T_WHITESPACE"," ",372],"(","!",["T_ISSET","isset",372],"(",["T_VARIABLE","$fetchData",372],"[",["T_CONSTANT_ENCAPSED_STRING","'custref'",372],"]",")",["T_WHITESPACE"," ",372],["T_BOOLEAN_OR","||",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$fetchData",372],"[",["T_CONSTANT_ENCAPSED_STRING","'custref'",372],"]",["T_WHITESPACE"," ",372],["T_IS_NOT_EQUAL","!=",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$order",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getIncrementId",372],"(",")",")",["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n            ",372],["T_STRING","Mage",373],["T_DOUBLE_COLON","::",373],["T_STRING","throwException",373],"(",["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","_formatStr",373],"(",["T_STRING","self",373],["T_DOUBLE_COLON","::",373],["T_STRING","RESPONSE_ERROR_MSG",373],",",["T_WHITESPACE"," ",373],["T_CONSTANT_ENCAPSED_STRING","'Transaction'",373],")",")",";",["T_WHITESPACE","\n        ",373],"}",["T_WHITESPACE","\n\n        ",374],["T_RETURN","return",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$order",376],";",["T_WHITESPACE","\n    ",376],"}",["T_WHITESPACE","\n\n    ",377],["T_DOC_COMMENT","\/**\n     * Build request for getting token\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Varien_Object\n     *\/",379],["T_WHITESPACE","\n    ",384],["T_PROTECTED","protected",385],["T_WHITESPACE"," ",385],["T_FUNCTION","function",385],["T_WHITESPACE"," ",385],["T_STRING","_buildTokenRequest",385],"(",["T_STRING","Mage_Sales_Model_Order_Payment",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$payment",385],")",["T_WHITESPACE","\n    ",385],"{",["T_WHITESPACE","\n        ",386],["T_VARIABLE","$request",387],["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_buildBasicRequest",387],"(",["T_VARIABLE","$payment",387],")",";",["T_WHITESPACE","\n        ",387],["T_VARIABLE","$request",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","setCreatesecuretoken",388],"(",["T_CONSTANT_ENCAPSED_STRING","'Y'",388],")",["T_WHITESPACE","\n            ",388],["T_OBJECT_OPERATOR","->",389],["T_STRING","setSecuretokenid",389],"(",["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_generateSecureTokenId",389],"(",")",")",["T_WHITESPACE","\n            ",389],["T_OBJECT_OPERATOR","->",390],["T_STRING","setTrxtype",390],"(",["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","_getTrxTokenType",390],"(",")",")",["T_WHITESPACE","\n            ",390],["T_OBJECT_OPERATOR","->",391],["T_STRING","setAmt",391],"(",["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","_formatStr",391],"(",["T_CONSTANT_ENCAPSED_STRING","'%.2F'",391],",",["T_WHITESPACE"," ",391],["T_VARIABLE","$payment",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getOrder",391],"(",")",["T_OBJECT_OPERATOR","->",391],["T_STRING","getBaseTotalDue",391],"(",")",")",")",["T_WHITESPACE","\n            ",391],["T_OBJECT_OPERATOR","->",392],["T_STRING","setCurrency",392],"(",["T_VARIABLE","$payment",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","getOrder",392],"(",")",["T_OBJECT_OPERATOR","->",392],["T_STRING","getBaseCurrencyCode",392],"(",")",")",["T_WHITESPACE","\n            ",392],["T_OBJECT_OPERATOR","->",393],["T_STRING","setInvnum",393],"(",["T_VARIABLE","$payment",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getOrder",393],"(",")",["T_OBJECT_OPERATOR","->",393],["T_STRING","getIncrementId",393],"(",")",")",["T_WHITESPACE","\n            ",393],["T_OBJECT_OPERATOR","->",394],["T_STRING","setCustref",394],"(",["T_VARIABLE","$payment",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getOrder",394],"(",")",["T_OBJECT_OPERATOR","->",394],["T_STRING","getIncrementId",394],"(",")",")",["T_WHITESPACE","\n            ",394],["T_OBJECT_OPERATOR","->",395],["T_STRING","setPonum",395],"(",["T_VARIABLE","$payment",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getOrder",395],"(",")",["T_OBJECT_OPERATOR","->",395],["T_STRING","getId",395],"(",")",")",";",["T_WHITESPACE","\n        ",395],["T_COMMENT","\/\/This is PaPal issue with taxes and shipping\n",396],["T_WHITESPACE","            ",397],["T_COMMENT","\/\/->setSubtotal($this->_formatStr('%.2F', $payment->getOrder()->getBaseSubtotal()))\n",397],["T_WHITESPACE","            ",398],["T_COMMENT","\/\/->setTaxamt($this->_formatStr('%.2F', $payment->getOrder()->getBaseTaxAmount()))\n",398],["T_WHITESPACE","            ",399],["T_COMMENT","\/\/->setFreightamt($this->_formatStr('%.2F', $payment->getOrder()->getBaseShippingAmount()));\n",399],["T_WHITESPACE","\n\n        ",400],["T_VARIABLE","$order",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_VARIABLE","$payment",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","getOrder",402],"(",")",";",["T_WHITESPACE","\n        ",402],["T_IF","if",403],["T_WHITESPACE"," ",403],"(",["T_EMPTY","empty",403],"(",["T_VARIABLE","$order",403],")",")",["T_WHITESPACE"," ",403],"{",["T_WHITESPACE","\n            ",403],["T_RETURN","return",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$request",404],";",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE","\n\n        ",405],["T_VARIABLE","$billing",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$order",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getBillingAddress",407],"(",")",";",["T_WHITESPACE","\n        ",407],["T_IF","if",408],["T_WHITESPACE"," ",408],"(","!",["T_EMPTY","empty",408],"(",["T_VARIABLE","$billing",408],")",")",["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n            ",408],["T_VARIABLE","$request",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","setFirstname",409],"(",["T_VARIABLE","$billing",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getFirstname",409],"(",")",")",["T_WHITESPACE","\n                ",409],["T_OBJECT_OPERATOR","->",410],["T_STRING","setLastname",410],"(",["T_VARIABLE","$billing",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getLastname",410],"(",")",")",["T_WHITESPACE","\n                ",410],["T_OBJECT_OPERATOR","->",411],["T_STRING","setStreet",411],"(",["T_STRING","implode",411],"(",["T_CONSTANT_ENCAPSED_STRING","' '",411],",",["T_WHITESPACE"," ",411],["T_VARIABLE","$billing",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getStreet",411],"(",")",")",")",["T_WHITESPACE","\n                ",411],["T_OBJECT_OPERATOR","->",412],["T_STRING","setCity",412],"(",["T_VARIABLE","$billing",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getCity",412],"(",")",")",["T_WHITESPACE","\n                ",412],["T_OBJECT_OPERATOR","->",413],["T_STRING","setState",413],"(",["T_VARIABLE","$billing",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getRegionCode",413],"(",")",")",["T_WHITESPACE","\n                ",413],["T_OBJECT_OPERATOR","->",414],["T_STRING","setZip",414],"(",["T_VARIABLE","$billing",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getPostcode",414],"(",")",")",["T_WHITESPACE","\n                ",414],["T_OBJECT_OPERATOR","->",415],["T_STRING","setCountry",415],"(",["T_VARIABLE","$billing",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getCountry",415],"(",")",")",["T_WHITESPACE","\n                ",415],["T_OBJECT_OPERATOR","->",416],["T_STRING","setEmail",416],"(",["T_VARIABLE","$order",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getCustomerEmail",416],"(",")",")",";",["T_WHITESPACE","\n        ",416],"}",["T_WHITESPACE","\n        ",417],["T_VARIABLE","$shipping",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_VARIABLE","$order",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getShippingAddress",418],"(",")",";",["T_WHITESPACE","\n        ",418],["T_IF","if",419],["T_WHITESPACE"," ",419],"(","!",["T_EMPTY","empty",419],"(",["T_VARIABLE","$shipping",419],")",")",["T_WHITESPACE"," ",419],"{",["T_WHITESPACE","\n            ",419],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","_applyCountryWorkarounds",420],"(",["T_VARIABLE","$shipping",420],")",";",["T_WHITESPACE","\n            ",420],["T_VARIABLE","$request",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","setShiptofirstname",421],"(",["T_VARIABLE","$shipping",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getFirstname",421],"(",")",")",["T_WHITESPACE","\n                ",421],["T_OBJECT_OPERATOR","->",422],["T_STRING","setShiptolastname",422],"(",["T_VARIABLE","$shipping",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getLastname",422],"(",")",")",["T_WHITESPACE","\n                ",422],["T_OBJECT_OPERATOR","->",423],["T_STRING","setShiptostreet",423],"(",["T_STRING","implode",423],"(",["T_CONSTANT_ENCAPSED_STRING","' '",423],",",["T_WHITESPACE"," ",423],["T_VARIABLE","$shipping",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getStreet",423],"(",")",")",")",["T_WHITESPACE","\n                ",423],["T_OBJECT_OPERATOR","->",424],["T_STRING","setShiptocity",424],"(",["T_VARIABLE","$shipping",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getCity",424],"(",")",")",["T_WHITESPACE","\n                ",424],["T_OBJECT_OPERATOR","->",425],["T_STRING","setShiptostate",425],"(",["T_VARIABLE","$shipping",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getRegionCode",425],"(",")",")",["T_WHITESPACE","\n                ",425],["T_OBJECT_OPERATOR","->",426],["T_STRING","setShiptozip",426],"(",["T_VARIABLE","$shipping",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getPostcode",426],"(",")",")",["T_WHITESPACE","\n                ",426],["T_OBJECT_OPERATOR","->",427],["T_STRING","setShiptocountry",427],"(",["T_VARIABLE","$shipping",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getCountry",427],"(",")",")",";",["T_WHITESPACE","\n        ",427],"}",["T_WHITESPACE","\n        ",428],["T_COMMENT","\/\/pass store Id to request\n",429],["T_WHITESPACE","        ",430],["T_VARIABLE","$request",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","setUser1",430],"(",["T_VARIABLE","$order",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getStoreId",430],"(",")",")",["T_WHITESPACE","\n            ",430],["T_OBJECT_OPERATOR","->",431],["T_STRING","setUser2",431],"(",["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_getSecureSilentPostHash",431],"(",["T_VARIABLE","$payment",431],")",")",";",["T_WHITESPACE","\n\n        ",431],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$request",433],";",["T_WHITESPACE","\n    ",433],"}",["T_WHITESPACE","\n\n    ",434],["T_DOC_COMMENT","\/**\n     * Get store id from response if exists\n     * or default\n     *\n     * @return int\n     *\/",436],["T_WHITESPACE","\n    ",441],["T_PROTECTED","protected",442],["T_WHITESPACE"," ",442],["T_FUNCTION","function",442],["T_WHITESPACE"," ",442],["T_STRING","_getStoreId",442],"(",")",["T_WHITESPACE","\n    ",442],"{",["T_WHITESPACE","\n        ",443],["T_VARIABLE","$response",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getResponse",444],"(",")",";",["T_WHITESPACE","\n        ",444],["T_IF","if",445],["T_WHITESPACE"," ",445],"(",["T_VARIABLE","$response",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getUser1",445],"(",")",")",["T_WHITESPACE"," ",445],"{",["T_WHITESPACE","\n            ",445],["T_RETURN","return",446],["T_WHITESPACE"," ",446],["T_INT_CAST","(int)",446],["T_WHITESPACE"," ",446],["T_VARIABLE","$response",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getUser1",446],"(",")",";",["T_WHITESPACE","\n        ",446],"}",["T_WHITESPACE","\n\n        ",447],["T_RETURN","return",449],["T_WHITESPACE"," ",449],["T_STRING","Mage",449],["T_DOUBLE_COLON","::",449],["T_STRING","app",449],"(",")",["T_OBJECT_OPERATOR","->",449],["T_STRING","getStore",449],"(",["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getStore",449],"(",")",")",["T_OBJECT_OPERATOR","->",449],["T_STRING","getId",449],"(",")",";",["T_WHITESPACE","\n    ",449],"}",["T_WHITESPACE","\n\n    ",450],["T_DOC_COMMENT","\/**\n      * Return request object with basic information for gateway request\n      *\n      * @param Varien_Object $payment\n      * @return Mage_Paypal_Model_Payflow_Request\n      *\/",452],["T_WHITESPACE","\n    ",457],["T_PROTECTED","protected",458],["T_WHITESPACE"," ",458],["T_FUNCTION","function",458],["T_WHITESPACE"," ",458],["T_STRING","_buildBasicRequest",458],"(",["T_STRING","Varien_Object",458],["T_WHITESPACE"," ",458],["T_VARIABLE","$payment",458],")",["T_WHITESPACE","\n    ",458],"{",["T_WHITESPACE","\n        ",459],["T_VARIABLE","$request",460],["T_WHITESPACE"," ",460],"=",["T_WHITESPACE"," ",460],["T_STRING","Mage",460],["T_DOUBLE_COLON","::",460],["T_STRING","getModel",460],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/payflow_request'",460],")",";",["T_WHITESPACE","\n        ",460],["T_VARIABLE","$cscEditable",461],["T_WHITESPACE"," ",461],"=",["T_WHITESPACE"," ",461],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getConfigData",461],"(",["T_CONSTANT_ENCAPSED_STRING","'csc_editable'",461],")",";",["T_WHITESPACE","\n        ",461],["T_VARIABLE","$bnCode",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_STRING","Mage",462],["T_DOUBLE_COLON","::",462],["T_STRING","getModel",462],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/config'",462],")",["T_OBJECT_OPERATOR","->",462],["T_STRING","getBuildNotationCode",462],"(",")",";",["T_WHITESPACE","\n        ",462],["T_VARIABLE","$request",463],["T_WHITESPACE","\n            ",463],["T_OBJECT_OPERATOR","->",464],["T_STRING","setUser",464],"(",["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getConfigData",464],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",464],",",["T_WHITESPACE"," ",464],["T_VARIABLE","$this",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","_getStoreId",464],"(",")",")",")",["T_WHITESPACE","\n            ",464],["T_OBJECT_OPERATOR","->",465],["T_STRING","setVendor",465],"(",["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","getConfigData",465],"(",["T_CONSTANT_ENCAPSED_STRING","'vendor'",465],",",["T_WHITESPACE"," ",465],["T_VARIABLE","$this",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","_getStoreId",465],"(",")",")",")",["T_WHITESPACE","\n            ",465],["T_OBJECT_OPERATOR","->",466],["T_STRING","setPartner",466],"(",["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","getConfigData",466],"(",["T_CONSTANT_ENCAPSED_STRING","'partner'",466],",",["T_WHITESPACE"," ",466],["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","_getStoreId",466],"(",")",")",")",["T_WHITESPACE","\n            ",466],["T_OBJECT_OPERATOR","->",467],["T_STRING","setPwd",467],"(",["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","getConfigData",467],"(",["T_CONSTANT_ENCAPSED_STRING","'pwd'",467],",",["T_WHITESPACE"," ",467],["T_VARIABLE","$this",467],["T_OBJECT_OPERATOR","->",467],["T_STRING","_getStoreId",467],"(",")",")",")",["T_WHITESPACE","\n            ",467],["T_OBJECT_OPERATOR","->",468],["T_STRING","setVerbosity",468],"(",["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getConfigData",468],"(",["T_CONSTANT_ENCAPSED_STRING","'verbosity'",468],",",["T_WHITESPACE"," ",468],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","_getStoreId",468],"(",")",")",")",["T_WHITESPACE","\n            ",468],["T_OBJECT_OPERATOR","->",469],["T_STRING","setData",469],"(",["T_CONSTANT_ENCAPSED_STRING","'BNCODE'",469],",",["T_WHITESPACE"," ",469],["T_VARIABLE","$bnCode",469],")",["T_WHITESPACE","\n            ",469],["T_OBJECT_OPERATOR","->",470],["T_STRING","setTender",470],"(",["T_STRING","self",470],["T_DOUBLE_COLON","::",470],["T_STRING","TENDER_CC",470],")",["T_WHITESPACE","\n            ",470],["T_OBJECT_OPERATOR","->",471],["T_STRING","setCancelurl",471],"(",["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","_getCallbackUrl",471],"(",["T_CONSTANT_ENCAPSED_STRING","'cancelPayment'",471],")",")",["T_WHITESPACE","\n            ",471],["T_OBJECT_OPERATOR","->",472],["T_STRING","setErrorurl",472],"(",["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","_getCallbackUrl",472],"(",["T_CONSTANT_ENCAPSED_STRING","'returnUrl'",472],")",")",["T_WHITESPACE","\n            ",472],["T_OBJECT_OPERATOR","->",473],["T_STRING","setSilentpost",473],"(",["T_CONSTANT_ENCAPSED_STRING","'TRUE'",473],")",["T_WHITESPACE","\n            ",473],["T_OBJECT_OPERATOR","->",474],["T_STRING","setSilentposturl",474],"(",["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","_getCallbackUrl",474],"(",["T_CONSTANT_ENCAPSED_STRING","'silentPost'",474],")",")",["T_WHITESPACE","\n            ",474],["T_OBJECT_OPERATOR","->",475],["T_STRING","setReturnurl",475],"(",["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","_getCallbackUrl",475],"(",["T_CONSTANT_ENCAPSED_STRING","'returnUrl'",475],")",")",["T_WHITESPACE","\n            ",475],["T_OBJECT_OPERATOR","->",476],["T_STRING","setTemplate",476],"(",["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getTemplate",476],"(",")",")",["T_WHITESPACE","\n            ",476],["T_OBJECT_OPERATOR","->",477],["T_STRING","setDisablereceipt",477],"(",["T_CONSTANT_ENCAPSED_STRING","'TRUE'",477],")",["T_WHITESPACE","\n            ",477],["T_OBJECT_OPERATOR","->",478],["T_STRING","setCscrequired",478],"(",["T_VARIABLE","$cscEditable",478],["T_WHITESPACE"," ",478],["T_BOOLEAN_AND","&&",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getConfigData",478],"(",["T_CONSTANT_ENCAPSED_STRING","'csc_required'",478],")",["T_WHITESPACE"," ",478],"?",["T_WHITESPACE"," ",478],["T_CONSTANT_ENCAPSED_STRING","'TRUE'",478],["T_WHITESPACE"," ",478],":",["T_WHITESPACE"," ",478],["T_CONSTANT_ENCAPSED_STRING","'FALSE'",478],")",["T_WHITESPACE","\n            ",478],["T_OBJECT_OPERATOR","->",479],["T_STRING","setCscedit",479],"(",["T_VARIABLE","$cscEditable",479],["T_WHITESPACE"," ",479],"?",["T_WHITESPACE"," ",479],["T_CONSTANT_ENCAPSED_STRING","'TRUE'",479],["T_WHITESPACE"," ",479],":",["T_WHITESPACE"," ",479],["T_CONSTANT_ENCAPSED_STRING","'FALSE'",479],")",["T_WHITESPACE","\n            ",479],["T_OBJECT_OPERATOR","->",480],["T_STRING","setEmailcustomer",480],"(",["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getConfigData",480],"(",["T_CONSTANT_ENCAPSED_STRING","'email_confirmation'",480],")",["T_WHITESPACE"," ",480],"?",["T_WHITESPACE"," ",480],["T_CONSTANT_ENCAPSED_STRING","'TRUE'",480],["T_WHITESPACE"," ",480],":",["T_WHITESPACE"," ",480],["T_CONSTANT_ENCAPSED_STRING","'FALSE'",480],")",["T_WHITESPACE","\n            ",480],["T_OBJECT_OPERATOR","->",481],["T_STRING","setUrlmethod",481],"(",["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getConfigData",481],"(",["T_CONSTANT_ENCAPSED_STRING","'url_method'",481],")",")",";",["T_WHITESPACE","\n        ",481],["T_RETURN","return",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$request",482],";",["T_WHITESPACE","\n    ",482],"}",["T_WHITESPACE","\n\n    ",483],["T_DOC_COMMENT","\/**\n      * Get payment action code\n      *\n      * @return string\n      *\/",485],["T_WHITESPACE","\n    ",489],["T_PROTECTED","protected",490],["T_WHITESPACE"," ",490],["T_FUNCTION","function",490],["T_WHITESPACE"," ",490],["T_STRING","_getTrxTokenType",490],"(",")",["T_WHITESPACE","\n    ",490],"{",["T_WHITESPACE","\n        ",491],["T_SWITCH","switch",492],["T_WHITESPACE"," ",492],"(",["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getConfigData",492],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_action'",492],")",")",["T_WHITESPACE"," ",492],"{",["T_WHITESPACE","\n            ",492],["T_CASE","case",493],["T_WHITESPACE"," ",493],["T_STRING","Mage_Paypal_Model_Config",493],["T_DOUBLE_COLON","::",493],["T_STRING","PAYMENT_ACTION_AUTH",493],":",["T_WHITESPACE","\n                ",493],["T_RETURN","return",494],["T_WHITESPACE"," ",494],["T_STRING","self",494],["T_DOUBLE_COLON","::",494],["T_STRING","TRXTYPE_AUTH_ONLY",494],";",["T_WHITESPACE","\n            ",494],["T_CASE","case",495],["T_WHITESPACE"," ",495],["T_STRING","Mage_Paypal_Model_Config",495],["T_DOUBLE_COLON","::",495],["T_STRING","PAYMENT_ACTION_SALE",495],":",["T_WHITESPACE","\n                ",495],["T_RETURN","return",496],["T_WHITESPACE"," ",496],["T_STRING","self",496],["T_DOUBLE_COLON","::",496],["T_STRING","TRXTYPE_SALE",496],";",["T_WHITESPACE","\n        ",496],"}",["T_WHITESPACE","\n    ",497],"}",["T_WHITESPACE","\n\n    ",498],["T_DOC_COMMENT","\/**\n      * Return unique value for secure token id\n      *\n      * @return string\n      *\/",500],["T_WHITESPACE","\n    ",504],["T_PROTECTED","protected",505],["T_WHITESPACE"," ",505],["T_FUNCTION","function",505],["T_WHITESPACE"," ",505],["T_STRING","_generateSecureTokenId",505],"(",")",["T_WHITESPACE","\n    ",505],"{",["T_WHITESPACE","\n        ",506],["T_RETURN","return",507],["T_WHITESPACE"," ",507],["T_STRING","Mage",507],["T_DOUBLE_COLON","::",507],["T_STRING","helper",507],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",507],")",["T_OBJECT_OPERATOR","->",507],["T_STRING","uniqHash",507],"(",")",";",["T_WHITESPACE","\n    ",507],"}",["T_WHITESPACE","\n\n    ",508],["T_DOC_COMMENT","\/**\n     * Format values\n     *\n     * @param mixed $format\n     * @param mixed $string\n     * @return mixed\n     *\/",510],["T_WHITESPACE","\n    ",516],["T_PROTECTED","protected",517],["T_WHITESPACE"," ",517],["T_FUNCTION","function",517],["T_WHITESPACE"," ",517],["T_STRING","_formatStr",517],"(",["T_VARIABLE","$format",517],",",["T_WHITESPACE"," ",517],["T_VARIABLE","$string",517],")",["T_WHITESPACE","\n    ",517],"{",["T_WHITESPACE","\n        ",518],["T_RETURN","return",519],["T_WHITESPACE"," ",519],["T_STRING","sprintf",519],"(",["T_VARIABLE","$format",519],",",["T_WHITESPACE"," ",519],["T_VARIABLE","$string",519],")",";",["T_WHITESPACE","\n    ",519],"}",["T_WHITESPACE","\n\n    ",520],["T_DOC_COMMENT","\/**\n      * If response is failed throw exception\n      * Set token data in payment object\n      *\n      * @param Varien_Object $response\n      * @param Mage_Sales_Model_Order_Payment $payment\n      * @throws Mage_Core_Exception\n      *\/",522],["T_WHITESPACE","\n    ",529],["T_PROTECTED","protected",530],["T_WHITESPACE"," ",530],["T_FUNCTION","function",530],["T_WHITESPACE"," ",530],["T_STRING","_processTokenErrors",530],"(",["T_VARIABLE","$response",530],",",["T_WHITESPACE"," ",530],["T_VARIABLE","$payment",530],")",["T_WHITESPACE","\n    ",530],"{",["T_WHITESPACE","\n        ",531],["T_IF","if",532],["T_WHITESPACE"," ",532],"(","!",["T_VARIABLE","$response",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","getSecuretoken",532],"(",")",["T_WHITESPACE"," ",532],["T_BOOLEAN_AND","&&",532],["T_WHITESPACE","\n            ",532],["T_VARIABLE","$response",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getResult",533],"(",")",["T_WHITESPACE"," ",533],["T_IS_NOT_EQUAL","!=",533],["T_WHITESPACE"," ",533],["T_STRING","self",533],["T_DOUBLE_COLON","::",533],["T_STRING","RESPONSE_CODE_APPROVED",533],["T_WHITESPACE","\n            ",533],["T_BOOLEAN_AND","&&",534],["T_WHITESPACE"," ",534],["T_VARIABLE","$response",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","getResult",534],"(",")",["T_WHITESPACE"," ",534],["T_IS_NOT_EQUAL","!=",534],["T_WHITESPACE"," ",534],["T_STRING","self",534],["T_DOUBLE_COLON","::",534],["T_STRING","RESPONSE_CODE_FRAUDSERVICE_FILTER",534],")",["T_WHITESPACE"," ",534],"{",["T_WHITESPACE","\n            ",534],["T_STRING","Mage",535],["T_DOUBLE_COLON","::",535],["T_STRING","throwException",535],"(",["T_VARIABLE","$response",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","getRespmsg",535],"(",")",")",";",["T_WHITESPACE","\n        ",535],"}",["T_WHITESPACE"," ",536],["T_ELSE","else",536],["T_WHITESPACE"," ",536],"{",["T_WHITESPACE","\n            ",536],["T_VARIABLE","$payment",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","setAdditionalInformation",537],"(",["T_CONSTANT_ENCAPSED_STRING","'secure_token_id'",537],",",["T_WHITESPACE"," ",537],["T_VARIABLE","$response",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getSecuretokenid",537],"(",")",")",["T_WHITESPACE","\n                ",537],["T_OBJECT_OPERATOR","->",538],["T_STRING","setAdditionalInformation",538],"(",["T_CONSTANT_ENCAPSED_STRING","'secure_token'",538],",",["T_WHITESPACE"," ",538],["T_VARIABLE","$response",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getSecuretoken",538],"(",")",")",";",["T_WHITESPACE","\n        ",538],"}",["T_WHITESPACE","\n    ",539],"}",["T_WHITESPACE","\n\n    ",540],["T_DOC_COMMENT","\/**\n     * Return secure hash value for silent post request\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return string\n     *\/",542],["T_WHITESPACE","\n    ",547],["T_PROTECTED","protected",548],["T_WHITESPACE"," ",548],["T_FUNCTION","function",548],["T_WHITESPACE"," ",548],["T_STRING","_getSecureSilentPostHash",548],"(",["T_VARIABLE","$payment",548],")",["T_WHITESPACE","\n    ",548],"{",["T_WHITESPACE","\n        ",549],["T_RETURN","return",550],["T_WHITESPACE"," ",550],["T_VARIABLE","$payment",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","getAdditionalInformation",550],"(",["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_secureSilentPostHashKey",550],")",";",["T_WHITESPACE","\n    ",550],"}",["T_WHITESPACE","\n\n    ",551],["T_DOC_COMMENT","\/**\n     * Generate end return new secure hash value\n     *\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return string\n     *\/",553],["T_WHITESPACE","\n    ",558],["T_PROTECTED","protected",559],["T_WHITESPACE"," ",559],["T_FUNCTION","function",559],["T_WHITESPACE"," ",559],["T_STRING","_generateSecureSilentPostHash",559],"(",["T_VARIABLE","$payment",559],")",["T_WHITESPACE","\n    ",559],"{",["T_WHITESPACE","\n        ",560],["T_VARIABLE","$secureHash",561],["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_STRING","md5",561],"(",["T_STRING","Mage",561],["T_DOUBLE_COLON","::",561],["T_STRING","helper",561],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",561],")",["T_OBJECT_OPERATOR","->",561],["T_STRING","getRandomString",561],"(",["T_LNUMBER","10",561],")",")",";",["T_WHITESPACE","\n        ",561],["T_VARIABLE","$payment",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","setAdditionalInformation",562],"(",["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","_secureSilentPostHashKey",562],",",["T_WHITESPACE"," ",562],["T_VARIABLE","$secureHash",562],")",";",["T_WHITESPACE","\n        ",562],["T_RETURN","return",563],["T_WHITESPACE"," ",563],["T_VARIABLE","$secureHash",563],";",["T_WHITESPACE","\n    ",563],"}",["T_WHITESPACE","\n\n    ",564],["T_DOC_COMMENT","\/**\n     * Add transaction with correct transaction Id\n     *\n     * @deprecated since 1.6.2.0\n     * @param Varien_Object $payment\n     * @param string $txnId\n     * @return void\n     *\/",566],["T_WHITESPACE","\n    ",573],["T_PROTECTED","protected",574],["T_WHITESPACE"," ",574],["T_FUNCTION","function",574],["T_WHITESPACE"," ",574],["T_STRING","_addTransaction",574],"(",["T_VARIABLE","$payment",574],",",["T_WHITESPACE"," ",574],["T_VARIABLE","$txnId",574],")",["T_WHITESPACE","\n    ",574],"{",["T_WHITESPACE","\n    ",575],"}",["T_WHITESPACE","\n\n    ",576],["T_DOC_COMMENT","\/**\n     * Initialize request\n     *\n     * @deprecated since 1.6.2.0\n     * @param Varien_Object $payment\n     * @param  $amount\n     * @return Mage_Paypal_Model_Payflowlink\n     *\/",578],["T_WHITESPACE","\n    ",585],["T_PROTECTED","protected",586],["T_WHITESPACE"," ",586],["T_FUNCTION","function",586],["T_WHITESPACE"," ",586],["T_STRING","_initialize",586],"(",["T_STRING","Varien_Object",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$payment",586],",",["T_WHITESPACE"," ",586],["T_VARIABLE","$amount",586],")",["T_WHITESPACE","\n    ",586],"{",["T_WHITESPACE","\n        ",587],["T_RETURN","return",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$this",588],";",["T_WHITESPACE","\n    ",588],"}",["T_WHITESPACE","\n\n    ",589],["T_DOC_COMMENT","\/**\n     * Check whether order review has enough data to initialize\n     *\n     * @deprecated since 1.6.2.0\n     * @param $token\n     * @throws Mage_Core_Exception\n     *\/",591],["T_WHITESPACE","\n    ",597],["T_PUBLIC","public",598],["T_WHITESPACE"," ",598],["T_FUNCTION","function",598],["T_WHITESPACE"," ",598],["T_STRING","prepareOrderReview",598],"(",["T_VARIABLE","$token",598],["T_WHITESPACE"," ",598],"=",["T_WHITESPACE"," ",598],["T_STRING","null",598],")",["T_WHITESPACE","\n    ",598],"{",["T_WHITESPACE","\n    ",599],"}",["T_WHITESPACE","\n\n    ",600],["T_DOC_COMMENT","\/**\n     * Additional authorization logic for Account Verification\n     *\n     * @deprecated since 1.6.2.0\n     * @param Varien_Object $payment\n     * @param mixed $amount\n     * @param Mage_Paypal_Model_Payment_Transaction $transaction\n     * @param string $txnId\n     * @return Mage_Paypal_Model_Payflowlink\n     *\/",602],["T_WHITESPACE","\n    ",611],["T_PROTECTED","protected",612],["T_WHITESPACE"," ",612],["T_FUNCTION","function",612],["T_WHITESPACE"," ",612],["T_STRING","_authorize",612],"(",["T_STRING","Varien_Object",612],["T_WHITESPACE"," ",612],["T_VARIABLE","$payment",612],",",["T_WHITESPACE"," ",612],["T_VARIABLE","$amount",612],",",["T_WHITESPACE"," ",612],["T_VARIABLE","$transaction",612],",",["T_WHITESPACE"," ",612],["T_VARIABLE","$txnId",612],")",["T_WHITESPACE","\n    ",612],"{",["T_WHITESPACE","\n        ",613],["T_RETURN","return",614],["T_WHITESPACE"," ",614],["T_VARIABLE","$this",614],";",["T_WHITESPACE","\n    ",614],"}",["T_WHITESPACE","\n\n    ",615],["T_DOC_COMMENT","\/**\n     * Operate with order or quote using information from silent post\n     *\n     * @deprecated since 1.6.2.0\n     * @param Varien_Object $document\n     *\/",617],["T_WHITESPACE","\n    ",622],["T_PROTECTED","protected",623],["T_WHITESPACE"," ",623],["T_FUNCTION","function",623],["T_WHITESPACE"," ",623],["T_STRING","_process",623],"(",["T_STRING","Varien_Object",623],["T_WHITESPACE"," ",623],["T_VARIABLE","$document",623],")",["T_WHITESPACE","\n    ",623],"{",["T_WHITESPACE","\n    ",624],"}",["T_WHITESPACE","\n\n    ",625],["T_DOC_COMMENT","\/**\n     * Check Transaction\n     *\n     * @deprecated since 1.6.2.0\n     * @param Mage_Paypal_Model_Payment_Transaction $transaction\n     * @param mixed $amount\n     * @return Mage_Paypal_Model_Payflowlink\n     *\/",627],["T_WHITESPACE","\n    ",634],["T_PROTECTED","protected",635],["T_WHITESPACE"," ",635],["T_FUNCTION","function",635],["T_WHITESPACE"," ",635],["T_STRING","_checkTransaction",635],"(",["T_VARIABLE","$transaction",635],",",["T_WHITESPACE"," ",635],["T_VARIABLE","$amount",635],")",["T_WHITESPACE","\n    ",635],"{",["T_WHITESPACE","\n        ",636],["T_RETURN","return",637],["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],";",["T_WHITESPACE","\n    ",637],"}",["T_WHITESPACE","\n\n    ",638],["T_DOC_COMMENT","\/**\n     * Check response from Payflow gateway.\n     *\n     * @deprecated since 1.6.2.0\n     * @return Mage_Sales_Model_Abstract in case of validation passed\n     * @throws Mage_Core_Exception in other cases\n     *\/",640],["T_WHITESPACE","\n    ",646],["T_PROTECTED","protected",647],["T_WHITESPACE"," ",647],["T_FUNCTION","function",647],["T_WHITESPACE"," ",647],["T_STRING","_getDocumentFromResponse",647],"(",")",["T_WHITESPACE","\n    ",647],"{",["T_WHITESPACE","\n        ",648],["T_RETURN","return",649],["T_WHITESPACE"," ",649],["T_STRING","null",649],";",["T_WHITESPACE","\n    ",649],"}",["T_WHITESPACE","\n\n    ",650],["T_DOC_COMMENT","\/**\n     * Get callback controller\n     *\n     * @return string\n     *\/",652],["T_WHITESPACE","\n    ",656],["T_PUBLIC","public",657],["T_WHITESPACE"," ",657],["T_FUNCTION","function",657],["T_WHITESPACE"," ",657],["T_STRING","getCallbackController",657],"(",")",["T_WHITESPACE","\n    ",657],"{",["T_WHITESPACE","\n        ",658],["T_RETURN","return",659],["T_WHITESPACE"," ",659],["T_VARIABLE","$this",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","_callbackController",659],";",["T_WHITESPACE","\n    ",659],"}",["T_WHITESPACE","\n\n    ",660],["T_DOC_COMMENT","\/**\n     * Get callback url\n     *\n     * @param string $actionName\n     * @return string\n     *\/",662],["T_WHITESPACE","\n    ",667],["T_PROTECTED","protected",668],["T_WHITESPACE"," ",668],["T_FUNCTION","function",668],["T_WHITESPACE"," ",668],["T_STRING","_getCallbackUrl",668],"(",["T_VARIABLE","$actionName",668],")",["T_WHITESPACE","\n    ",668],"{",["T_WHITESPACE","\n        ",669],["T_VARIABLE","$request",670],["T_WHITESPACE"," ",670],"=",["T_WHITESPACE"," ",670],["T_STRING","Mage",670],["T_DOUBLE_COLON","::",670],["T_STRING","app",670],"(",")",["T_OBJECT_OPERATOR","->",670],["T_STRING","getRequest",670],"(",")",";",["T_WHITESPACE","\n        ",670],["T_IF","if",671],["T_WHITESPACE"," ",671],"(",["T_VARIABLE","$request",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","getParam",671],"(",["T_CONSTANT_ENCAPSED_STRING","'website'",671],")",")",["T_WHITESPACE"," ",671],"{",["T_WHITESPACE","\n            ",671],["T_VARIABLE","$website",672],["T_WHITESPACE"," ",672],"=",["T_WHITESPACE"," ",672],["T_STRING","Mage",672],["T_DOUBLE_COLON","::",672],["T_STRING","getModel",672],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",672],")",["T_OBJECT_OPERATOR","->",672],["T_STRING","load",672],"(",["T_VARIABLE","$request",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","getParam",672],"(",["T_CONSTANT_ENCAPSED_STRING","'website'",672],")",")",";",["T_WHITESPACE","\n            ",672],["T_VARIABLE","$secure",673],["T_WHITESPACE"," ",673],"=",["T_WHITESPACE"," ",673],["T_STRING","Mage",673],["T_DOUBLE_COLON","::",673],["T_STRING","getStoreConfigFlag",673],"(",["T_WHITESPACE","\n                ",673],["T_STRING","Mage_Core_Model_Url",674],["T_DOUBLE_COLON","::",674],["T_STRING","XML_PATH_SECURE_IN_FRONT",674],",",["T_WHITESPACE","\n                ",674],["T_VARIABLE","$website",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getDefaultStore",675],"(",")",["T_WHITESPACE","\n            ",675],")",";",["T_WHITESPACE","\n            ",676],["T_VARIABLE","$path",677],["T_WHITESPACE"," ",677],"=",["T_WHITESPACE"," ",677],["T_VARIABLE","$secure",677],["T_WHITESPACE","\n                ",677],"?",["T_WHITESPACE"," ",678],["T_STRING","Mage_Core_Model_Store",678],["T_DOUBLE_COLON","::",678],["T_STRING","XML_PATH_SECURE_BASE_LINK_URL",678],["T_WHITESPACE","\n                ",678],":",["T_WHITESPACE"," ",679],["T_STRING","Mage_Core_Model_Store",679],["T_DOUBLE_COLON","::",679],["T_STRING","XML_PATH_UNSECURE_BASE_LINK_URL",679],";",["T_WHITESPACE","\n            ",679],["T_VARIABLE","$websiteUrl",680],["T_WHITESPACE"," ",680],"=",["T_WHITESPACE"," ",680],["T_STRING","Mage",680],["T_DOUBLE_COLON","::",680],["T_STRING","getStoreConfig",680],"(",["T_VARIABLE","$path",680],",",["T_WHITESPACE"," ",680],["T_VARIABLE","$website",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","getDefaultStore",680],"(",")",")",";",["T_WHITESPACE","\n        ",680],"}",["T_WHITESPACE"," ",681],["T_ELSE","else",681],["T_WHITESPACE"," ",681],"{",["T_WHITESPACE","\n            ",681],["T_VARIABLE","$secure",682],["T_WHITESPACE"," ",682],"=",["T_WHITESPACE"," ",682],["T_STRING","Mage",682],["T_DOUBLE_COLON","::",682],["T_STRING","getStoreConfigFlag",682],"(",["T_STRING","Mage_Core_Model_Url",682],["T_DOUBLE_COLON","::",682],["T_STRING","XML_PATH_SECURE_IN_FRONT",682],")",";",["T_WHITESPACE","\n            ",682],["T_VARIABLE","$websiteUrl",683],["T_WHITESPACE"," ",683],"=",["T_WHITESPACE"," ",683],["T_STRING","Mage",683],["T_DOUBLE_COLON","::",683],["T_STRING","getBaseUrl",683],"(",["T_STRING","Mage_Core_Model_Store",683],["T_DOUBLE_COLON","::",683],["T_STRING","URL_TYPE_LINK",683],",",["T_WHITESPACE"," ",683],["T_VARIABLE","$secure",683],")",";",["T_WHITESPACE","\n        ",683],"}",["T_WHITESPACE","\n\n        ",684],["T_RETURN","return",686],["T_WHITESPACE"," ",686],["T_VARIABLE","$websiteUrl",686],["T_WHITESPACE"," ",686],".",["T_WHITESPACE"," ",686],["T_CONSTANT_ENCAPSED_STRING","'paypal\/'",686],["T_WHITESPACE"," ",686],".",["T_WHITESPACE"," ",686],["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","getCallbackController",686],"(",")",["T_WHITESPACE"," ",686],".",["T_WHITESPACE"," ",686],["T_CONSTANT_ENCAPSED_STRING","'\/'",686],["T_WHITESPACE"," ",686],".",["T_WHITESPACE"," ",686],["T_VARIABLE","$actionName",686],";",["T_WHITESPACE","\n    ",686],"}",["T_WHITESPACE","\n",687],"}",["T_WHITESPACE","\n",688]]