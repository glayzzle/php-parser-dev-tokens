[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogIndex\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Index data aggregation model\n *\n * Allow cache some aggregated data with tag dependency\n *\n * @method Mage_CatalogIndex_Model_Resource_Aggregation _getResource()\n * @method Mage_CatalogIndex_Model_Resource_Aggregation getResource()\n * @method int getStoreId()\n * @method Mage_CatalogIndex_Model_Aggregation setStoreId(int $value)\n * @method string getCreatedAt()\n * @method Mage_CatalogIndex_Model_Aggregation setCreatedAt(string $value)\n * @method string getKey()\n * @method Mage_CatalogIndex_Model_Aggregation setKey(string $value)\n *\n * @category    Mage\n * @package     Mage_CatalogIndex\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",44],["T_CLASS","class",45],["T_WHITESPACE"," ",45],["T_STRING","Mage_CatalogIndex_Model_Aggregation",45],["T_WHITESPACE"," ",45],["T_EXTENDS","extends",45],["T_WHITESPACE"," ",45],["T_STRING","Mage_Core_Model_Abstract",45],["T_WHITESPACE","\n",45],"{",["T_WHITESPACE","\n    ",46],["T_CONST","const",47],["T_WHITESPACE"," ",47],["T_STRING","CACHE_FLAG_NAME",47],["T_WHITESPACE","   ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'layered_navigation'",47],";",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Initialize resource model\n     *\/",49],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","_construct",52],"(",")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_init",54],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogindex\/aggregation'",54],")",";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","_isEnabled",57],"(",")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_RETURN","return",59],["T_WHITESPACE"," ",59],["T_STRING","Mage",59],["T_DOUBLE_COLON","::",59],["T_STRING","app",59],"(",")",["T_OBJECT_OPERATOR","->",59],["T_STRING","useCache",59],"(",["T_STRING","self",59],["T_DOUBLE_COLON","::",59],["T_STRING","CACHE_FLAG_NAME",59],")",";",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Get aggregated data by data key and store\n     *\n     * @param   string $key\n     * @param   null|int|string|Mage_Core_Model_Store $store\n     * @return  array|null\n     *\/",62],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","getCacheData",69],"(",["T_VARIABLE","$key",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$store",69],"=",["T_STRING","null",69],")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(","!",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_isEnabled",71],"(",")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_STRING","null",72],";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n\n        ",73],["T_VARIABLE","$key",75],["T_WHITESPACE","    ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_processKey",75],"(",["T_VARIABLE","$key",75],")",";",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$store",76],["T_WHITESPACE","  ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","Mage",76],["T_DOUBLE_COLON","::",76],["T_STRING","app",76],"(",")",["T_OBJECT_OPERATOR","->",76],["T_STRING","getStore",76],"(",["T_VARIABLE","$store",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$data",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_getResource",77],"(",")",["T_OBJECT_OPERATOR","->",77],["T_STRING","getCacheData",77],"(",["T_VARIABLE","$key",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$store",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getId",77],"(",")",")",";",["T_WHITESPACE","\n        ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(",["T_EMPTY","empty",78],"(",["T_VARIABLE","$data",78],")",")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_STRING","null",79],";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n        ",80],["T_RETURN","return",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$data",81],";",["T_WHITESPACE","\n    ",81],"}",["T_WHITESPACE","\n\n    ",82],["T_DOC_COMMENT","\/**\n     * Save aggregation data to cache\n     *\n     * @param   string $key\n     * @param   array $tags\n     * @param   null|int|string|Mage_Core_Model_Store $store\n     * @return  Mage_CatalogIndex_Model_Aggregation\n     *\/",84],["T_WHITESPACE","\n    ",91],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","saveCacheData",92],"(",["T_VARIABLE","$data",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$key",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$tags",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$store",92],"=",["T_STRING","null",92],")",["T_WHITESPACE","\n    ",92],"{",["T_WHITESPACE","\n        ",93],["T_IF","if",94],["T_WHITESPACE"," ",94],"(","!",["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_isEnabled",94],"(",")",")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n            ",94],["T_RETURN","return",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],";",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n\n        ",96],["T_VARIABLE","$key",98],["T_WHITESPACE","    ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_processKey",98],"(",["T_VARIABLE","$key",98],")",";",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$tags",99],["T_WHITESPACE","   ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_processTags",99],"(",["T_VARIABLE","$tags",99],")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$store",100],["T_WHITESPACE","  ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","Mage",100],["T_DOUBLE_COLON","::",100],["T_STRING","app",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getStore",100],"(",["T_VARIABLE","$store",100],")",";",["T_WHITESPACE","\n\n        ",100],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_getResource",102],"(",")",["T_OBJECT_OPERATOR","->",102],["T_STRING","saveCacheData",102],"(",["T_VARIABLE","$data",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$key",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$tags",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$store",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getId",102],"(",")",")",";",["T_WHITESPACE","\n        ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Delete cached aggregation data\n     *\n     * @param   array $tags\n     * @param   int|null|string $store\n     * @return  Mage_CatalogIndex_Model_Aggregation\n     *\/",106],["T_WHITESPACE","\n    ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","clearCacheData",113],"(",["T_VARIABLE","$tags",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_ARRAY","array",113],"(",")",",",["T_WHITESPACE"," ",113],["T_VARIABLE","$store",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","null",113],")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$tags",115],["T_WHITESPACE","    ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_processTags",115],"(",["T_VARIABLE","$tags",115],")",";",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$store",116],["T_WHITESPACE"," ",116],["T_IS_NOT_IDENTICAL","!==",116],["T_WHITESPACE"," ",116],["T_STRING","null",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$store",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","Mage",117],["T_DOUBLE_COLON","::",117],["T_STRING","app",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getStore",117],"(",["T_VARIABLE","$store",117],")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getId",117],"(",")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_getResource",119],"(",")",["T_OBJECT_OPERATOR","->",119],["T_STRING","clearCacheData",119],"(",["T_VARIABLE","$tags",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$store",119],")",";",["T_WHITESPACE","\n        ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Clear all cache data related with products\n     *\n     * @param   int|array $productIds\n     * @return  Mage_CatalogIndex_Model_Aggregation\n     *\/",123],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","clearProductData",129],"(",["T_VARIABLE","$productIds",129],")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$categoryPaths",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_getResource",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","getProductCategoryPaths",131],"(",["T_VARIABLE","$productIds",131],")",";",["T_WHITESPACE","\n        ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(","!",["T_EMPTY","empty",132],"(",["T_VARIABLE","$categoryPaths",132],")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$tags",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",")",";",["T_WHITESPACE","\n            ",133],["T_FOREACH","foreach",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$categoryPaths",134],["T_WHITESPACE"," ",134],["T_AS","as",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$path",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$tags",135],"[","]",["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","Mage_Catalog_Model_Category",135],["T_DOUBLE_COLON","::",135],["T_STRING","CACHE_TAG",135],".",["T_CONSTANT_ENCAPSED_STRING","':'",135],".",["T_VARIABLE","$path",135],";",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","clearCacheData",137],"(",["T_VARIABLE","$tags",137],")",";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n        ",138],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n\n    ",140],["T_DOC_COMMENT","\/**\n     * Prepare data key\n     *\n     * @param   string $key\n     * @return  string\n     *\/",142],["T_WHITESPACE","\n    ",147],["T_PROTECTED","protected",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","_processKey",148],"(",["T_VARIABLE","$key",148],")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$key",150],";",["T_WHITESPACE","\n        ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_STRING","md5",151],"(",["T_VARIABLE","$key",151],")",";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Process tags array\n     *\n     * this method split tags like \"category:1,2,3\" to four\n     * different tags: category, category1, category2, category3\n     *\n     * @param unknown_type $tags\n     * @return unknown\n     *\/",154],["T_WHITESPACE","\n    ",162],["T_PROTECTED","protected",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","_processTags",163],"(",["T_VARIABLE","$tags",163],")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$newTags",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_ARRAY","array",165],"(",")",";",["T_WHITESPACE","\n        ",165],["T_FOREACH","foreach",166],["T_WHITESPACE"," ",166],"(",["T_VARIABLE","$tags",166],["T_WHITESPACE"," ",166],["T_AS","as",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$tag",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$tagInfo",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","explode",167],"(",["T_CONSTANT_ENCAPSED_STRING","':'",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$tag",167],")",";",["T_WHITESPACE","\n            ",167],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_STRING","count",168],"(",["T_VARIABLE","$tagInfo",168],")",["T_IS_EQUAL","==",168],["T_LNUMBER","1",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n                ",168],["T_VARIABLE","$newTags",169],"[","]",["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$tagInfo",169],"[",["T_LNUMBER","0",169],"]",";",["T_WHITESPACE","\n            ",169],"}",["T_WHITESPACE"," ",170],["T_ELSE","else",170],["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n                ",170],["T_VARIABLE","$tagVariants",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_STRING","explode",171],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$tagInfo",171],"[",["T_LNUMBER","1",171],"]",")",";",["T_WHITESPACE","\n                ",171],["T_FOREACH","foreach",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$tagVariants",172],["T_WHITESPACE"," ",172],["T_AS","as",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$tagVariant",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n                    ",172],["T_VARIABLE","$newTags",173],"[","]",["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$tagInfo",173],"[",["T_LNUMBER","0",173],"]",["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_VARIABLE","$tagVariant",173],";",["T_WHITESPACE","\n                ",173],"}",["T_WHITESPACE","\n            ",174],"}",["T_WHITESPACE","\n        ",175],"}",["T_WHITESPACE","\n        ",176],["T_RETURN","return",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$newTags",177],";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n",178],"}",["T_WHITESPACE","\n",179]]