[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogRule\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog Price rules observer model\n *\/",27],["T_WHITESPACE","\n",29],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_CatalogRule_Model_Observer",30],["T_WHITESPACE","\n",30],"{",["T_WHITESPACE","\n    ",31],["T_DOC_COMMENT","\/**\n     * Preload price rules for all items in quote\n     *\n     * @var array\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_preloadedPrices",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_ARRAY","array",37],"(",")",";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Store calculated catalog rules prices for products\n     * Prices collected per website, customer group, date and product\n     *\n     * @var array\n     *\/",39],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_rulePrices",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],"(",")",";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Apply all catalog price rules for specific product\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogRule_Model_Observer\n     *\/",47],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","applyAllRulesOnProduct",53],"(",["T_VARIABLE","$observer",53],")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$product",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$observer",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getEvent",55],"(",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","getProduct",55],"(",")",";",["T_WHITESPACE","\n        ",55],["T_IF","if",56],["T_WHITESPACE"," ",56],"(",["T_VARIABLE","$product",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getIsMassupdate",56],"(",")",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_RETURN","return",57],";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n\n        ",58],["T_STRING","Mage",60],["T_DOUBLE_COLON","::",60],["T_STRING","getModel",60],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",60],")",["T_OBJECT_OPERATOR","->",60],["T_STRING","applyAllRulesToProduct",60],"(",["T_VARIABLE","$product",60],")",";",["T_WHITESPACE","\n\n        ",60],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],";",["T_WHITESPACE","\n    ",62],"}",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Load matched catalog price rules for specific product.\n     * Is used for comparison in Mage_CatalogRule_Model_Resource_Rule::applyToProduct method\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogRule_Model_Observer\n     *\/",65],["T_WHITESPACE","\n    ",71],["T_PUBLIC","public",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","loadProductRules",72],"(",["T_VARIABLE","$observer",72],")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_DOC_COMMENT","\/** @var Mage_Catalog_Model_Product $product *\/",74],["T_WHITESPACE","\n        ",74],["T_VARIABLE","$product",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$observer",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getEvent",75],"(",")",["T_OBJECT_OPERATOR","->",75],["T_STRING","getProduct",75],"(",")",";",["T_WHITESPACE","\n        ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(","!",["T_VARIABLE","$product",76],["T_WHITESPACE"," ",76],["T_INSTANCEOF","instanceof",76],["T_WHITESPACE"," ",76],["T_STRING","Mage_Catalog_Model_Product",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n        ",78],["T_STRING","Mage",79],["T_DOUBLE_COLON","::",79],["T_STRING","getModel",79],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",79],")",["T_OBJECT_OPERATOR","->",79],["T_STRING","loadProductRules",79],"(",["T_VARIABLE","$product",79],")",";",["T_WHITESPACE","\n        ",79],["T_RETURN","return",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],";",["T_WHITESPACE","\n    ",80],"}",["T_WHITESPACE","\n\n    ",81],["T_DOC_COMMENT","\/**\n     * Apply all price rules for current date.\n     * Handle catalog_product_import_after event\n     *\n     * @param   Varien_Event_Observer $observer\n     *\n     * @return  Mage_CatalogRule_Model_Observer\n     *\/",83],["T_WHITESPACE","\n    ",90],["T_PUBLIC","public",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","applyAllRules",91],"(",["T_VARIABLE","$observer",91],")",["T_WHITESPACE","\n    ",91],"{",["T_WHITESPACE","\n        ",92],["T_DOC_COMMENT","\/** @var $resource Mage_CatalogRule_Model_Resource_Rule *\/",93],["T_WHITESPACE","\n        ",93],["T_VARIABLE","$resource",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","Mage",94],["T_DOUBLE_COLON","::",94],["T_STRING","getResourceSingleton",94],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",94],")",";",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$resource",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","applyAllRules",95],"(",")",";",["T_WHITESPACE","\n        ",95],["T_STRING","Mage",96],["T_DOUBLE_COLON","::",96],["T_STRING","getModel",96],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/flag'",96],")",["T_OBJECT_OPERATOR","->",96],["T_STRING","loadSelf",96],"(",")",["T_WHITESPACE","\n            ",96],["T_OBJECT_OPERATOR","->",97],["T_STRING","setState",97],"(",["T_LNUMBER","0",97],")",["T_WHITESPACE","\n            ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","save",98],"(",")",";",["T_WHITESPACE","\n\n        ",98],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],";",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Preload all price rules for all items in quote\n     *\n     * @param   Varien_Event_Observer $observer\n     *\n     * @return  Mage_CatalogRule_Model_Observer\n     *\/",103],["T_WHITESPACE","\n    ",109],["T_PUBLIC","public",110],["T_WHITESPACE"," ",110],["T_FUNCTION","function",110],["T_WHITESPACE"," ",110],["T_STRING","preloadPriceRules",110],"(",["T_STRING","Varien_Event_Observer",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$observer",110],")",["T_WHITESPACE","\n    ",110],"{",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$quote",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$observer",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getQuote",112],"(",")",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$date",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","Mage",113],["T_DOUBLE_COLON","::",113],["T_STRING","app",113],"(",")",["T_OBJECT_OPERATOR","->",113],["T_STRING","getLocale",113],"(",")",["T_OBJECT_OPERATOR","->",113],["T_STRING","storeTimeStamp",113],"(",["T_VARIABLE","$quote",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getStoreId",113],"(",")",")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$wId",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$quote",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getStore",114],"(",")",["T_OBJECT_OPERATOR","->",114],["T_STRING","getWebsiteId",114],"(",")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$gId",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$quote",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getCustomerGroupId",115],"(",")",";",["T_WHITESPACE","\n\n        ",115],["T_VARIABLE","$productIds",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",")",";",["T_WHITESPACE","\n        ",117],["T_FOREACH","foreach",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$quote",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getAllItems",118],"(",")",["T_WHITESPACE"," ",118],["T_AS","as",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$item",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$productIds",119],"[","]",["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$item",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getProductId",119],"(",")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_VARIABLE","$cacheKey",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","spl_object_hash",122],"(",["T_VARIABLE","$quote",122],")",";",["T_WHITESPACE","\n\n        ",122],["T_IF","if",124],["T_WHITESPACE"," ",124],"(","!",["T_ISSET","isset",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_preloadedPrices",124],"[",["T_VARIABLE","$cacheKey",124],"]",")",")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_preloadedPrices",125],"[",["T_VARIABLE","$cacheKey",125],"]",["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","Mage",125],["T_DOUBLE_COLON","::",125],["T_STRING","getResourceSingleton",125],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",125],")",["T_WHITESPACE","\n                 ",125],["T_OBJECT_OPERATOR","->",126],["T_STRING","getRulePrices",126],"(",["T_VARIABLE","$date",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$wId",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$gId",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$productIds",126],")",";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_FOREACH","foreach",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_preloadedPrices",129],"[",["T_VARIABLE","$cacheKey",129],"]",["T_WHITESPACE"," ",129],["T_AS","as",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$pId",129],["T_WHITESPACE"," ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$price",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$key",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_getRulePricesKey",130],"(",["T_ARRAY","array",130],"(",["T_VARIABLE","$date",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$wId",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$gId",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$pId",130],")",")",";",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_rulePrices",131],"[",["T_VARIABLE","$key",131],"]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$price",131],";",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n\n        ",132],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Apply catalog price rules to product on frontend\n     *\n     * @param   Varien_Event_Observer $observer\n     *\n     * @return  Mage_CatalogRule_Model_Observer\n     *\/",137],["T_WHITESPACE","\n    ",143],["T_PUBLIC","public",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","processFrontFinalPrice",144],"(",["T_VARIABLE","$observer",144],")",["T_WHITESPACE","\n    ",144],"{",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$product",146],["T_WHITESPACE","    ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$observer",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getEvent",146],"(",")",["T_OBJECT_OPERATOR","->",146],["T_STRING","getProduct",146],"(",")",";",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$pId",147],["T_WHITESPACE","        ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$product",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getId",147],"(",")",";",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$storeId",148],["T_WHITESPACE","    ",148],"=",["T_WHITESPACE"," ",148],["T_VARIABLE","$product",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getStoreId",148],"(",")",";",["T_WHITESPACE","\n\n        ",148],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$observer",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","hasDate",150],"(",")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$date",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$observer",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getEvent",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","getDate",151],"(",")",";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE"," ",152],["T_ELSE","else",152],["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$date",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_STRING","Mage",153],["T_DOUBLE_COLON","::",153],["T_STRING","app",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","getLocale",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","storeTimeStamp",153],"(",["T_VARIABLE","$storeId",153],")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n\n        ",154],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$observer",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","hasWebsiteId",156],"(",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$wId",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$observer",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getEvent",157],"(",")",["T_OBJECT_OPERATOR","->",157],["T_STRING","getWebsiteId",157],"(",")",";",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE"," ",158],["T_ELSE","else",158],["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$wId",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","Mage",159],["T_DOUBLE_COLON","::",159],["T_STRING","app",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getStore",159],"(",["T_VARIABLE","$storeId",159],")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getWebsiteId",159],"(",")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n\n        ",160],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_VARIABLE","$observer",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","hasCustomerGroupId",162],"(",")",")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$gId",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$observer",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getEvent",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","getCustomerGroupId",163],"(",")",";",["T_WHITESPACE","\n        ",163],"}",["T_WHITESPACE"," ",164],["T_ELSEIF","elseif",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$product",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","hasCustomerGroupId",164],"(",")",")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$gId",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$product",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getCustomerGroupId",165],"(",")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE"," ",166],["T_ELSE","else",166],["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$gId",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","Mage",167],["T_DOUBLE_COLON","::",167],["T_STRING","getSingleton",167],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",167],")",["T_OBJECT_OPERATOR","->",167],["T_STRING","getCustomerGroupId",167],"(",")",";",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n\n        ",168],["T_VARIABLE","$key",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_getRulePricesKey",170],"(",["T_ARRAY","array",170],"(",["T_VARIABLE","$date",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$wId",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$gId",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$pId",170],")",")",";",["T_WHITESPACE","\n        ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(","!",["T_ISSET","isset",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_rulePrices",171],"[",["T_VARIABLE","$key",171],"]",")",")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$rulePrice",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","Mage",172],["T_DOUBLE_COLON","::",172],["T_STRING","getResourceModel",172],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",172],")",["T_WHITESPACE","\n                ",172],["T_OBJECT_OPERATOR","->",173],["T_STRING","getRulePrice",173],"(",["T_VARIABLE","$date",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$wId",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$gId",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$pId",173],")",";",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","_rulePrices",174],"[",["T_VARIABLE","$key",174],"]",["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$rulePrice",174],";",["T_WHITESPACE","\n        ",174],"}",["T_WHITESPACE","\n        ",175],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_rulePrices",176],"[",["T_VARIABLE","$key",176],"]",["T_IS_NOT_IDENTICAL","!==",176],["T_STRING","false",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$finalPrice",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","min",177],"(",["T_VARIABLE","$product",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getData",177],"(",["T_CONSTANT_ENCAPSED_STRING","'final_price'",177],")",",",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_rulePrices",177],"[",["T_VARIABLE","$key",177],"]",")",";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$product",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","setFinalPrice",178],"(",["T_VARIABLE","$finalPrice",178],")",";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE","\n        ",179],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n\n    ",181],["T_DOC_COMMENT","\/**\n     * Apply catalog price rules to product in admin\n     *\n     * @param   Varien_Event_Observer $observer\n     *\n     * @return  Mage_CatalogRule_Model_Observer\n     *\/",183],["T_WHITESPACE","\n    ",189],["T_PUBLIC","public",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","processAdminFinalPrice",190],"(",["T_VARIABLE","$observer",190],")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$product",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$observer",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getEvent",192],"(",")",["T_OBJECT_OPERATOR","->",192],["T_STRING","getProduct",192],"(",")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$storeId",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$product",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getStoreId",193],"(",")",";",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$date",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","app",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","getLocale",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","storeDate",194],"(",["T_VARIABLE","$storeId",194],")",";",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$key",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_STRING","false",195],";",["T_WHITESPACE","\n\n        ",195],["T_IF","if",197],["T_WHITESPACE"," ",197],"(",["T_VARIABLE","$ruleData",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","Mage",197],["T_DOUBLE_COLON","::",197],["T_STRING","registry",197],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_data'",197],")",")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$wId",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_VARIABLE","$ruleData",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getWebsiteId",198],"(",")",";",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$gId",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$ruleData",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getCustomerGroupId",199],"(",")",";",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$pId",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$product",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getId",200],"(",")",";",["T_WHITESPACE","\n\n            ",200],["T_VARIABLE","$key",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_getRulePricesKey",202],"(",["T_ARRAY","array",202],"(",["T_VARIABLE","$date",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$wId",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$gId",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$pId",202],")",")",";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n        ",203],["T_ELSEIF","elseif",204],["T_WHITESPACE"," ",204],"(","!",["T_STRING","is_null",204],"(",["T_VARIABLE","$storeId",204],")",["T_WHITESPACE"," ",204],["T_BOOLEAN_AND","&&",204],["T_WHITESPACE"," ",204],"!",["T_STRING","is_null",204],"(",["T_VARIABLE","$product",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getCustomerGroupId",204],"(",")",")",")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$wId",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_STRING","Mage",205],["T_DOUBLE_COLON","::",205],["T_STRING","app",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getStore",205],"(",["T_VARIABLE","$storeId",205],")",["T_OBJECT_OPERATOR","->",205],["T_STRING","getWebsiteId",205],"(",")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$gId",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$product",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getCustomerGroupId",206],"(",")",";",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$pId",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$product",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getId",207],"(",")",";",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$key",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_getRulePricesKey",208],"(",["T_ARRAY","array",208],"(",["T_VARIABLE","$date",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$wId",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$gId",208],",",["T_WHITESPACE"," ",208],["T_VARIABLE","$pId",208],")",")",";",["T_WHITESPACE","\n        ",208],"}",["T_WHITESPACE","\n\n        ",209],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$key",211],")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n            ",211],["T_IF","if",212],["T_WHITESPACE"," ",212],"(","!",["T_ISSET","isset",212],"(",["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","_rulePrices",212],"[",["T_VARIABLE","$key",212],"]",")",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n                ",212],["T_VARIABLE","$rulePrice",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_STRING","Mage",213],["T_DOUBLE_COLON","::",213],["T_STRING","getResourceModel",213],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",213],")",["T_WHITESPACE","\n                    ",213],["T_OBJECT_OPERATOR","->",214],["T_STRING","getRulePrice",214],"(",["T_VARIABLE","$date",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$wId",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$gId",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$pId",214],")",";",["T_WHITESPACE","\n                ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_rulePrices",215],"[",["T_VARIABLE","$key",215],"]",["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$rulePrice",215],";",["T_WHITESPACE","\n            ",215],"}",["T_WHITESPACE","\n            ",216],["T_IF","if",217],["T_WHITESPACE"," ",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_rulePrices",217],"[",["T_VARIABLE","$key",217],"]",["T_IS_NOT_IDENTICAL","!==",217],["T_STRING","false",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n                ",217],["T_VARIABLE","$finalPrice",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_STRING","min",218],"(",["T_VARIABLE","$product",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getData",218],"(",["T_CONSTANT_ENCAPSED_STRING","'final_price'",218],")",",",["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_rulePrices",218],"[",["T_VARIABLE","$key",218],"]",")",";",["T_WHITESPACE","\n                ",218],["T_VARIABLE","$product",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","setFinalPrice",219],"(",["T_VARIABLE","$finalPrice",219],")",";",["T_WHITESPACE","\n            ",219],"}",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n\n        ",221],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Calculate price using catalog price rules of configurable product\n     *\n     * @param Varien_Event_Observer $observer\n     *\n     * @return Mage_CatalogRule_Model_Observer\n     *\/",226],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","catalogProductTypeConfigurablePrice",233],"(",["T_STRING","Varien_Event_Observer",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$observer",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$product",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$observer",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getEvent",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","getProduct",235],"(",")",";",["T_WHITESPACE","\n        ",235],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$product",236],["T_WHITESPACE"," ",236],["T_INSTANCEOF","instanceof",236],["T_WHITESPACE"," ",236],["T_STRING","Mage_Catalog_Model_Product",236],["T_WHITESPACE","\n            ",236],["T_BOOLEAN_AND","&&",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$product",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getConfigurablePrice",237],"(",")",["T_WHITESPACE"," ",237],["T_IS_NOT_IDENTICAL","!==",237],["T_WHITESPACE"," ",237],["T_STRING","null",237],["T_WHITESPACE","\n        ",237],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$configurablePrice",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$product",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getConfigurablePrice",239],"(",")",";",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$productPriceRule",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_STRING","Mage",240],["T_DOUBLE_COLON","::",240],["T_STRING","getModel",240],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",240],")",["T_OBJECT_OPERATOR","->",240],["T_STRING","calcProductPriceRule",240],"(",["T_VARIABLE","$product",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$configurablePrice",240],")",";",["T_WHITESPACE","\n            ",240],["T_IF","if",241],["T_WHITESPACE"," ",241],"(",["T_VARIABLE","$productPriceRule",241],["T_WHITESPACE"," ",241],["T_IS_NOT_IDENTICAL","!==",241],["T_WHITESPACE"," ",241],["T_STRING","null",241],")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n                ",241],["T_VARIABLE","$product",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","setConfigurablePrice",242],"(",["T_VARIABLE","$productPriceRule",242],")",";",["T_WHITESPACE","\n            ",242],"}",["T_WHITESPACE","\n        ",243],"}",["T_WHITESPACE","\n\n        ",244],["T_RETURN","return",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],";",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * Daily update catalog price rule by cron\n     * Update include interval 3 days - current day - 1 days before + 1 days after\n     * This method is called from cron process, cron is working in UTC time and\n     * we should generate data for interval -1 day ... +1 day\n     *\n     * @param   Varien_Event_Observer $observer\n     *\n     * @return  Mage_CatalogRule_Model_Observer\n     *\/",249],["T_WHITESPACE","\n    ",258],["T_PUBLIC","public",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","dailyCatalogUpdate",259],"(",["T_VARIABLE","$observer",259],")",["T_WHITESPACE","\n    ",259],"{",["T_WHITESPACE","\n        ",260],["T_DOC_COMMENT","\/** @var $model Mage_CatalogRule_Model_Rule *\/",261],["T_WHITESPACE","\n        ",261],["T_VARIABLE","$model",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_STRING","Mage",262],["T_DOUBLE_COLON","::",262],["T_STRING","getSingleton",262],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",262],")",";",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$model",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","applyAll",263],"(",")",";",["T_WHITESPACE","\n\n        ",263],["T_RETURN","return",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],";",["T_WHITESPACE","\n    ",265],"}",["T_WHITESPACE","\n\n    ",266],["T_DOC_COMMENT","\/**\n     * Clean out calculated catalog rule prices for products\n     *\/",268],["T_WHITESPACE","\n    ",270],["T_PUBLIC","public",271],["T_WHITESPACE"," ",271],["T_FUNCTION","function",271],["T_WHITESPACE"," ",271],["T_STRING","flushPriceCache",271],"(",")",["T_WHITESPACE","\n    ",271],"{",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_rulePrices",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_ARRAY","array",273],"(",")",";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Calculate minimal final price with catalog rule price\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogRule_Model_Observer\n     *\/",276],["T_WHITESPACE","\n    ",281],["T_PUBLIC","public",282],["T_WHITESPACE"," ",282],["T_FUNCTION","function",282],["T_WHITESPACE"," ",282],["T_STRING","prepareCatalogProductPriceIndexTable",282],"(",["T_STRING","Varien_Event_Observer",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$observer",282],")",["T_WHITESPACE","\n    ",282],"{",["T_WHITESPACE","\n        ",283],["T_VARIABLE","$select",284],["T_WHITESPACE","             ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$observer",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getEvent",284],"(",")",["T_OBJECT_OPERATOR","->",284],["T_STRING","getSelect",284],"(",")",";",["T_WHITESPACE","\n\n        ",284],["T_VARIABLE","$indexTable",286],["T_WHITESPACE","         ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$observer",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getEvent",286],"(",")",["T_OBJECT_OPERATOR","->",286],["T_STRING","getIndexTable",286],"(",")",";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$entityId",287],["T_WHITESPACE","           ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$observer",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getEvent",287],"(",")",["T_OBJECT_OPERATOR","->",287],["T_STRING","getEntityId",287],"(",")",";",["T_WHITESPACE","\n        ",287],["T_VARIABLE","$customerGroupId",288],["T_WHITESPACE","    ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$observer",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getEvent",288],"(",")",["T_OBJECT_OPERATOR","->",288],["T_STRING","getCustomerGroupId",288],"(",")",";",["T_WHITESPACE","\n        ",288],["T_VARIABLE","$websiteId",289],["T_WHITESPACE","          ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$observer",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getEvent",289],"(",")",["T_OBJECT_OPERATOR","->",289],["T_STRING","getWebsiteId",289],"(",")",";",["T_WHITESPACE","\n        ",289],["T_VARIABLE","$websiteDate",290],["T_WHITESPACE","        ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$observer",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getEvent",290],"(",")",["T_OBJECT_OPERATOR","->",290],["T_STRING","getWebsiteDate",290],"(",")",";",["T_WHITESPACE","\n        ",290],["T_VARIABLE","$updateFields",291],["T_WHITESPACE","       ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$observer",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getEvent",291],"(",")",["T_OBJECT_OPERATOR","->",291],["T_STRING","getUpdateFields",291],"(",")",";",["T_WHITESPACE","\n\n        ",291],["T_STRING","Mage",293],["T_DOUBLE_COLON","::",293],["T_STRING","getSingleton",293],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product_price'",293],")",["T_WHITESPACE","\n            ",293],["T_OBJECT_OPERATOR","->",294],["T_STRING","applyPriceRuleToIndexTable",294],"(",["T_VARIABLE","$select",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$indexTable",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$entityId",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$customerGroupId",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$websiteId",294],",",["T_WHITESPACE","\n                ",294],["T_VARIABLE","$updateFields",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$websiteDate",295],")",";",["T_WHITESPACE","\n\n        ",295],["T_RETURN","return",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],";",["T_WHITESPACE","\n    ",297],"}",["T_WHITESPACE","\n\n    ",298],["T_DOC_COMMENT","\/**\n     * Check rules that contains affected attribute\n     * If rules were found they will be set to inactive and notice will be add to admin session\n     *\n     * @param string $attributeCode\n     *\n     * @return Mage_CatalogRule_Model_Observer\n     *\/",300],["T_WHITESPACE","\n    ",307],["T_PROTECTED","protected",308],["T_WHITESPACE"," ",308],["T_FUNCTION","function",308],["T_WHITESPACE"," ",308],["T_STRING","_checkCatalogRulesAvailability",308],"(",["T_VARIABLE","$attributeCode",308],")",["T_WHITESPACE","\n    ",308],"{",["T_WHITESPACE","\n        ",309],["T_COMMENT","\/* @var $collection Mage_CatalogRule_Model_Mysql4_Rule_Collection *\/",310],["T_WHITESPACE","\n        ",310],["T_VARIABLE","$collection",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_STRING","Mage",311],["T_DOUBLE_COLON","::",311],["T_STRING","getResourceModel",311],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_collection'",311],")",["T_WHITESPACE","\n            ",311],["T_OBJECT_OPERATOR","->",312],["T_STRING","addAttributeInConditionFilter",312],"(",["T_VARIABLE","$attributeCode",312],")",";",["T_WHITESPACE","\n\n        ",312],["T_VARIABLE","$disabledRulesCount",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_LNUMBER","0",314],";",["T_WHITESPACE","\n        ",314],["T_FOREACH","foreach",315],["T_WHITESPACE"," ",315],"(",["T_VARIABLE","$collection",315],["T_WHITESPACE"," ",315],["T_AS","as",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$rule",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_COMMENT","\/* @var $rule Mage_CatalogRule_Model_Rule *\/",316],["T_WHITESPACE","\n            ",316],["T_VARIABLE","$rule",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","setIsActive",317],"(",["T_LNUMBER","0",317],")",";",["T_WHITESPACE","\n            ",317],["T_COMMENT","\/* @var $rule->getConditions() Mage_CatalogRule_Model_Rule_Condition_Combine *\/",318],["T_WHITESPACE","\n            ",318],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_removeAttributeFromConditions",319],"(",["T_VARIABLE","$rule",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getConditions",319],"(",")",",",["T_WHITESPACE"," ",319],["T_VARIABLE","$attributeCode",319],")",";",["T_WHITESPACE","\n            ",319],["T_VARIABLE","$rule",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","save",320],"(",")",";",["T_WHITESPACE","\n\n            ",320],["T_VARIABLE","$disabledRulesCount",322],["T_INC","++",322],";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE","\n\n        ",323],["T_IF","if",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$disabledRulesCount",325],")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_STRING","Mage",326],["T_DOUBLE_COLON","::",326],["T_STRING","getModel",326],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",326],")",["T_OBJECT_OPERATOR","->",326],["T_STRING","applyAll",326],"(",")",";",["T_WHITESPACE","\n            ",326],["T_STRING","Mage",327],["T_DOUBLE_COLON","::",327],["T_STRING","getSingleton",327],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",327],")",["T_OBJECT_OPERATOR","->",327],["T_STRING","addWarning",327],"(",["T_WHITESPACE","\n                ",327],["T_STRING","Mage",328],["T_DOUBLE_COLON","::",328],["T_STRING","helper",328],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",328],")",["T_OBJECT_OPERATOR","->",328],["T_STRING","__",328],"(",["T_CONSTANT_ENCAPSED_STRING","'%d Catalog Price Rules based on \"%s\" attribute have been disabled.'",328],",",["T_WHITESPACE"," ",328],["T_VARIABLE","$disabledRulesCount",328],",",["T_WHITESPACE"," ",328],["T_VARIABLE","$attributeCode",328],")",")",";",["T_WHITESPACE","\n        ",328],"}",["T_WHITESPACE","\n\n        ",329],["T_RETURN","return",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],";",["T_WHITESPACE","\n    ",331],"}",["T_WHITESPACE","\n\n    ",332],["T_DOC_COMMENT","\/**\n     * Remove catalog attribute condition by attribute code from rule conditions\n     *\n     * @param Mage_CatalogRule_Model_Rule_Condition_Combine $combine\n     *\n     * @param string $attributeCode\n     *\/",334],["T_WHITESPACE","\n    ",340],["T_PROTECTED","protected",341],["T_WHITESPACE"," ",341],["T_FUNCTION","function",341],["T_WHITESPACE"," ",341],["T_STRING","_removeAttributeFromConditions",341],"(",["T_VARIABLE","$combine",341],",",["T_WHITESPACE"," ",341],["T_VARIABLE","$attributeCode",341],")",["T_WHITESPACE","\n    ",341],"{",["T_WHITESPACE","\n        ",342],["T_VARIABLE","$conditions",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_VARIABLE","$combine",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getConditions",343],"(",")",";",["T_WHITESPACE","\n        ",343],["T_FOREACH","foreach",344],["T_WHITESPACE"," ",344],"(",["T_VARIABLE","$conditions",344],["T_WHITESPACE"," ",344],["T_AS","as",344],["T_WHITESPACE"," ",344],["T_VARIABLE","$conditionId",344],["T_WHITESPACE"," ",344],["T_DOUBLE_ARROW","=>",344],["T_WHITESPACE"," ",344],["T_VARIABLE","$condition",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n            ",344],["T_IF","if",345],["T_WHITESPACE"," ",345],"(",["T_VARIABLE","$condition",345],["T_WHITESPACE"," ",345],["T_INSTANCEOF","instanceof",345],["T_WHITESPACE"," ",345],["T_STRING","Mage_CatalogRule_Model_Rule_Condition_Combine",345],")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n                ",345],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_removeAttributeFromConditions",346],"(",["T_VARIABLE","$condition",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$attributeCode",346],")",";",["T_WHITESPACE","\n            ",346],"}",["T_WHITESPACE","\n            ",347],["T_IF","if",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$condition",348],["T_WHITESPACE"," ",348],["T_INSTANCEOF","instanceof",348],["T_WHITESPACE"," ",348],["T_STRING","Mage_Rule_Model_Condition_Product_Abstract",348],")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n                ",348],["T_IF","if",349],["T_WHITESPACE"," ",349],"(",["T_VARIABLE","$condition",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getAttribute",349],"(",")",["T_WHITESPACE"," ",349],["T_IS_EQUAL","==",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$attributeCode",349],")",["T_WHITESPACE"," ",349],"{",["T_WHITESPACE","\n                    ",349],["T_UNSET","unset",350],"(",["T_VARIABLE","$conditions",350],"[",["T_VARIABLE","$conditionId",350],"]",")",";",["T_WHITESPACE","\n                ",350],"}",["T_WHITESPACE","\n            ",351],"}",["T_WHITESPACE","\n        ",352],"}",["T_WHITESPACE","\n        ",353],["T_VARIABLE","$combine",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","setConditions",354],"(",["T_VARIABLE","$conditions",354],")",";",["T_WHITESPACE","\n    ",354],"}",["T_WHITESPACE","\n\n    ",355],["T_DOC_COMMENT","\/**\n     * After save attribute if it is not used for promo rules already check rules for containing this attribute\n     *\n     * @param Varien_Event_Observer $observer\n     *\n     * @return Mage_CatalogRule_Model_Observer\n     *\/",357],["T_WHITESPACE","\n    ",363],["T_PUBLIC","public",364],["T_WHITESPACE"," ",364],["T_FUNCTION","function",364],["T_WHITESPACE"," ",364],["T_STRING","catalogAttributeSaveAfter",364],"(",["T_STRING","Varien_Event_Observer",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$observer",364],")",["T_WHITESPACE","\n    ",364],"{",["T_WHITESPACE","\n        ",365],["T_VARIABLE","$attribute",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$observer",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getEvent",366],"(",")",["T_OBJECT_OPERATOR","->",366],["T_STRING","getAttribute",366],"(",")",";",["T_WHITESPACE","\n        ",366],["T_IF","if",367],["T_WHITESPACE"," ",367],"(",["T_VARIABLE","$attribute",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","dataHasChangedFor",367],"(",["T_CONSTANT_ENCAPSED_STRING","'is_used_for_promo_rules'",367],")",["T_WHITESPACE"," ",367],["T_BOOLEAN_AND","&&",367],["T_WHITESPACE"," ",367],"!",["T_VARIABLE","$attribute",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getIsUsedForPromoRules",367],"(",")",")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n            ",367],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_checkCatalogRulesAvailability",368],"(",["T_VARIABLE","$attribute",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getAttributeCode",368],"(",")",")",";",["T_WHITESPACE","\n        ",368],"}",["T_WHITESPACE","\n\n        ",369],["T_RETURN","return",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$this",371],";",["T_WHITESPACE","\n    ",371],"}",["T_WHITESPACE","\n\n    ",372],["T_DOC_COMMENT","\/**\n     * After delete attribute check rules that contains deleted attribute\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogRule_Model_Observer\n     *\/",374],["T_WHITESPACE","\n    ",379],["T_PUBLIC","public",380],["T_WHITESPACE"," ",380],["T_FUNCTION","function",380],["T_WHITESPACE"," ",380],["T_STRING","catalogAttributeDeleteAfter",380],"(",["T_STRING","Varien_Event_Observer",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$observer",380],")",["T_WHITESPACE","\n    ",380],"{",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$attribute",382],["T_WHITESPACE"," ",382],"=",["T_WHITESPACE"," ",382],["T_VARIABLE","$observer",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getEvent",382],"(",")",["T_OBJECT_OPERATOR","->",382],["T_STRING","getAttribute",382],"(",")",";",["T_WHITESPACE","\n        ",382],["T_IF","if",383],["T_WHITESPACE"," ",383],"(",["T_VARIABLE","$attribute",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getIsUsedForPromoRules",383],"(",")",")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n            ",383],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_checkCatalogRulesAvailability",384],"(",["T_VARIABLE","$attribute",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getAttributeCode",384],"(",")",")",";",["T_WHITESPACE","\n        ",384],"}",["T_WHITESPACE","\n\n        ",385],["T_RETURN","return",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$this",387],";",["T_WHITESPACE","\n    ",387],"}",["T_WHITESPACE","\n\n    ",388],["T_PUBLIC","public",390],["T_WHITESPACE"," ",390],["T_FUNCTION","function",390],["T_WHITESPACE"," ",390],["T_STRING","prepareCatalogProductCollectionPrices",390],"(",["T_STRING","Varien_Event_Observer",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$observer",390],")",["T_WHITESPACE","\n    ",390],"{",["T_WHITESPACE","\n        ",391],["T_COMMENT","\/* @var $collection Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Collection *\/",392],["T_WHITESPACE","\n        ",392],["T_VARIABLE","$collection",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_VARIABLE","$observer",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getEvent",393],"(",")",["T_OBJECT_OPERATOR","->",393],["T_STRING","getCollection",393],"(",")",";",["T_WHITESPACE","\n        ",393],["T_VARIABLE","$store",394],["T_WHITESPACE","      ",394],"=",["T_WHITESPACE"," ",394],["T_STRING","Mage",394],["T_DOUBLE_COLON","::",394],["T_STRING","app",394],"(",")",["T_OBJECT_OPERATOR","->",394],["T_STRING","getStore",394],"(",["T_VARIABLE","$observer",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getEvent",394],"(",")",["T_OBJECT_OPERATOR","->",394],["T_STRING","getStoreId",394],"(",")",")",";",["T_WHITESPACE","\n        ",394],["T_VARIABLE","$websiteId",395],["T_WHITESPACE","  ",395],"=",["T_WHITESPACE"," ",395],["T_VARIABLE","$store",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getWebsiteId",395],"(",")",";",["T_WHITESPACE","\n        ",395],["T_IF","if",396],["T_WHITESPACE"," ",396],"(",["T_VARIABLE","$observer",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getEvent",396],"(",")",["T_OBJECT_OPERATOR","->",396],["T_STRING","hasCustomerGroupId",396],"(",")",")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n            ",396],["T_VARIABLE","$groupId",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$observer",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getEvent",397],"(",")",["T_OBJECT_OPERATOR","->",397],["T_STRING","getCustomerGroupId",397],"(",")",";",["T_WHITESPACE","\n        ",397],"}",["T_WHITESPACE"," ",398],["T_ELSE","else",398],["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n            ",398],["T_COMMENT","\/* @var $session Mage_Customer_Model_Session *\/",399],["T_WHITESPACE","\n            ",399],["T_VARIABLE","$session",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_STRING","Mage",400],["T_DOUBLE_COLON","::",400],["T_STRING","getSingleton",400],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",400],")",";",["T_WHITESPACE","\n            ",400],["T_IF","if",401],["T_WHITESPACE"," ",401],"(",["T_VARIABLE","$session",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","isLoggedIn",401],"(",")",")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n                ",401],["T_VARIABLE","$groupId",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_STRING","Mage",402],["T_DOUBLE_COLON","::",402],["T_STRING","getSingleton",402],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",402],")",["T_OBJECT_OPERATOR","->",402],["T_STRING","getCustomerGroupId",402],"(",")",";",["T_WHITESPACE","\n            ",402],"}",["T_WHITESPACE"," ",403],["T_ELSE","else",403],["T_WHITESPACE"," ",403],"{",["T_WHITESPACE","\n                ",403],["T_VARIABLE","$groupId",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_STRING","Mage_Customer_Model_Group",404],["T_DOUBLE_COLON","::",404],["T_STRING","NOT_LOGGED_IN_ID",404],";",["T_WHITESPACE","\n            ",404],"}",["T_WHITESPACE","\n        ",405],"}",["T_WHITESPACE","\n        ",406],["T_IF","if",407],["T_WHITESPACE"," ",407],"(",["T_VARIABLE","$observer",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getEvent",407],"(",")",["T_OBJECT_OPERATOR","->",407],["T_STRING","hasDate",407],"(",")",")",["T_WHITESPACE"," ",407],"{",["T_WHITESPACE","\n            ",407],["T_VARIABLE","$date",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_VARIABLE","$observer",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getEvent",408],"(",")",["T_OBJECT_OPERATOR","->",408],["T_STRING","getDate",408],"(",")",";",["T_WHITESPACE","\n        ",408],"}",["T_WHITESPACE"," ",409],["T_ELSE","else",409],["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_VARIABLE","$date",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_STRING","Mage",410],["T_DOUBLE_COLON","::",410],["T_STRING","app",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","getLocale",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","storeTimeStamp",410],"(",["T_VARIABLE","$store",410],")",";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n\n        ",411],["T_VARIABLE","$productIds",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_ARRAY","array",413],"(",")",";",["T_WHITESPACE","\n        ",413],["T_COMMENT","\/* @var $product Mage_Core_Model_Product *\/",414],["T_WHITESPACE","\n        ",414],["T_FOREACH","foreach",415],["T_WHITESPACE"," ",415],"(",["T_VARIABLE","$collection",415],["T_WHITESPACE"," ",415],["T_AS","as",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$product",415],")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n            ",415],["T_VARIABLE","$key",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","_getRulePricesKey",416],"(",["T_ARRAY","array",416],"(",["T_VARIABLE","$date",416],",",["T_WHITESPACE"," ",416],["T_VARIABLE","$websiteId",416],",",["T_WHITESPACE"," ",416],["T_VARIABLE","$groupId",416],",",["T_WHITESPACE"," ",416],["T_VARIABLE","$product",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getId",416],"(",")",")",")",";",["T_WHITESPACE","\n            ",416],["T_IF","if",417],["T_WHITESPACE"," ",417],"(","!",["T_ISSET","isset",417],"(",["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","_rulePrices",417],"[",["T_VARIABLE","$key",417],"]",")",")",["T_WHITESPACE"," ",417],"{",["T_WHITESPACE","\n                ",417],["T_VARIABLE","$productIds",418],"[","]",["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_VARIABLE","$product",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getId",418],"(",")",";",["T_WHITESPACE","\n            ",418],"}",["T_WHITESPACE","\n        ",419],"}",["T_WHITESPACE","\n\n        ",420],["T_IF","if",422],["T_WHITESPACE"," ",422],"(",["T_VARIABLE","$productIds",422],")",["T_WHITESPACE"," ",422],"{",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$rulePrices",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_STRING","Mage",423],["T_DOUBLE_COLON","::",423],["T_STRING","getResourceModel",423],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",423],")",["T_WHITESPACE","\n                ",423],["T_OBJECT_OPERATOR","->",424],["T_STRING","getRulePrices",424],"(",["T_VARIABLE","$date",424],",",["T_WHITESPACE"," ",424],["T_VARIABLE","$websiteId",424],",",["T_WHITESPACE"," ",424],["T_VARIABLE","$groupId",424],",",["T_WHITESPACE"," ",424],["T_VARIABLE","$productIds",424],")",";",["T_WHITESPACE","\n            ",424],["T_FOREACH","foreach",425],["T_WHITESPACE"," ",425],"(",["T_VARIABLE","$productIds",425],["T_WHITESPACE"," ",425],["T_AS","as",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$productId",425],")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n                ",425],["T_VARIABLE","$key",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","_getRulePricesKey",426],"(",["T_ARRAY","array",426],"(",["T_VARIABLE","$date",426],",",["T_WHITESPACE"," ",426],["T_VARIABLE","$websiteId",426],",",["T_WHITESPACE"," ",426],["T_VARIABLE","$groupId",426],",",["T_WHITESPACE"," ",426],["T_VARIABLE","$productId",426],")",")",";",["T_WHITESPACE","\n                ",426],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_rulePrices",427],"[",["T_VARIABLE","$key",427],"]",["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_ISSET","isset",427],"(",["T_VARIABLE","$rulePrices",427],"[",["T_VARIABLE","$productId",427],"]",")",["T_WHITESPACE"," ",427],"?",["T_WHITESPACE"," ",427],["T_VARIABLE","$rulePrices",427],"[",["T_VARIABLE","$productId",427],"]",["T_WHITESPACE"," ",427],":",["T_WHITESPACE"," ",427],["T_STRING","false",427],";",["T_WHITESPACE","\n            ",427],"}",["T_WHITESPACE","\n        ",428],"}",["T_WHITESPACE","\n\n        ",429],["T_RETURN","return",431],["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],";",["T_WHITESPACE","\n    ",431],"}",["T_WHITESPACE","\n\n    ",432],["T_DOC_COMMENT","\/**\n     * Create catalog rule relations for imported products\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",434],["T_WHITESPACE","\n    ",438],["T_PUBLIC","public",439],["T_WHITESPACE"," ",439],["T_FUNCTION","function",439],["T_WHITESPACE"," ",439],["T_STRING","createCatalogRulesRelations",439],"(",["T_STRING","Varien_Event_Observer",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$observer",439],")",["T_WHITESPACE","\n    ",439],"{",["T_WHITESPACE","\n        ",440],["T_VARIABLE","$adapter",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_VARIABLE","$observer",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getEvent",441],"(",")",["T_OBJECT_OPERATOR","->",441],["T_STRING","getAdapter",441],"(",")",";",["T_WHITESPACE","\n        ",441],["T_VARIABLE","$affectedEntityIds",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_VARIABLE","$adapter",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getAffectedEntityIds",442],"(",")",";",["T_WHITESPACE","\n\n        ",442],["T_IF","if",444],["T_WHITESPACE"," ",444],"(",["T_EMPTY","empty",444],"(",["T_VARIABLE","$affectedEntityIds",444],")",")",["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n            ",444],["T_RETURN","return",445],";",["T_WHITESPACE","\n        ",445],"}",["T_WHITESPACE","\n\n        ",446],["T_VARIABLE","$rules",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_STRING","Mage",448],["T_DOUBLE_COLON","::",448],["T_STRING","getModel",448],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",448],")",["T_OBJECT_OPERATOR","->",448],["T_STRING","getCollection",448],"(",")",["T_WHITESPACE","\n            ",448],["T_OBJECT_OPERATOR","->",449],["T_STRING","addFieldToFilter",449],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active'",449],",",["T_WHITESPACE"," ",449],["T_LNUMBER","1",449],")",";",["T_WHITESPACE","\n\n        ",449],["T_FOREACH","foreach",451],["T_WHITESPACE"," ",451],"(",["T_VARIABLE","$rules",451],["T_WHITESPACE"," ",451],["T_AS","as",451],["T_WHITESPACE"," ",451],["T_VARIABLE","$rule",451],")",["T_WHITESPACE"," ",451],"{",["T_WHITESPACE","\n            ",451],["T_VARIABLE","$rule",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","setProductsFilter",452],"(",["T_VARIABLE","$affectedEntityIds",452],")",";",["T_WHITESPACE","\n            ",452],["T_STRING","Mage",453],["T_DOUBLE_COLON","::",453],["T_STRING","getResourceSingleton",453],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",453],")",["T_OBJECT_OPERATOR","->",453],["T_STRING","updateRuleProductData",453],"(",["T_VARIABLE","$rule",453],")",";",["T_WHITESPACE","\n        ",453],"}",["T_WHITESPACE","\n    ",454],"}",["T_WHITESPACE","\n\n    ",455],["T_DOC_COMMENT","\/**\n     * Runs Catalog Product Price Reindex\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",457],["T_WHITESPACE","\n    ",461],["T_PUBLIC","public",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","runCatalogProductPriceReindex",462],"(",["T_STRING","Varien_Event_Observer",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$observer",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$indexProcess",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_STRING","Mage",464],["T_DOUBLE_COLON","::",464],["T_STRING","getSingleton",464],"(",["T_CONSTANT_ENCAPSED_STRING","'index\/indexer'",464],")",["T_OBJECT_OPERATOR","->",464],["T_STRING","getProcessByCode",464],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_price'",464],")",";",["T_WHITESPACE","\n        ",464],["T_IF","if",465],["T_WHITESPACE"," ",465],"(",["T_VARIABLE","$indexProcess",465],")",["T_WHITESPACE"," ",465],"{",["T_WHITESPACE","\n            ",465],["T_VARIABLE","$indexProcess",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","reindexAll",466],"(",")",";",["T_WHITESPACE","\n        ",466],"}",["T_WHITESPACE","\n    ",467],"}",["T_WHITESPACE","\n\n    ",468],["T_DOC_COMMENT","\/**\n     * Generate key for rule prices\n     *\n     * @param array\n     *\/",470],["T_WHITESPACE","\n    ",474],["T_PROTECTED","protected",475],["T_WHITESPACE"," ",475],["T_FUNCTION","function",475],["T_WHITESPACE"," ",475],["T_STRING","_getRulePricesKey",475],"(",["T_VARIABLE","$keyInfo",475],")",["T_WHITESPACE","\n    ",475],"{",["T_WHITESPACE","\n        ",476],["T_RETURN","return",477],["T_WHITESPACE"," ",477],["T_STRING","implode",477],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",477],",",["T_WHITESPACE"," ",477],["T_VARIABLE","$keyInfo",477],")",";",["T_WHITESPACE","\n    ",477],"}",["T_WHITESPACE","\n",478],"}",["T_WHITESPACE","\n",479]]