[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogRule\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog rule indexer\n *\n * @category    Mage\n * @package     Mage_CatalogRule\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_CatalogRule_Model_Action_Index_Refresh",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Connection instance\n     *\n     * @var Varien_Db_Adapter_Interface\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_connection",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Core factory instance\n     *\n     * @var Mage_Core_Model_Factory\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_factory",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Resource instance\n     *\n     * @var Mage_Core_Model_Resource_Db_Abstract\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_resource",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Application instance\n     *\n     * @var Mage_Core_Model_App\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_app",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Constructor with parameters\n     * Array of arguments with keys\n     *  - 'connection' Varien_Db_Adapter_Interface\n     *  - 'factory' Mage_Core_Model_Factory\n     *  - 'resource' Mage_Core_Model_Resource_Db_Abstract\n     *  - 'app' Mage_Core_Model_App\n     *\n     * @param array $args\n     *\/",64],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","__construct",74],"(",["T_ARRAY","array",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$args",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_setConnection",76],"(",["T_VARIABLE","$args",76],"[",["T_CONSTANT_ENCAPSED_STRING","'connection'",76],"]",")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_setFactory",77],"(",["T_VARIABLE","$args",77],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",77],"]",")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_setResource",78],"(",["T_VARIABLE","$args",78],"[",["T_CONSTANT_ENCAPSED_STRING","'resource'",78],"]",")",";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_app",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],"!",["T_EMPTY","empty",79],"(",["T_VARIABLE","$args",79],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",79],"]",")",["T_WHITESPACE"," ",79],"?",["T_WHITESPACE"," ",79],["T_VARIABLE","$args",79],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",79],"]",["T_WHITESPACE"," ",79],":",["T_WHITESPACE"," ",79],["T_STRING","Mage",79],["T_DOUBLE_COLON","::",79],["T_STRING","app",79],"(",")",";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Set connection\n     *\n     * @param Varien_Db_Adapter_Interface $connection\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","_setConnection",87],"(",["T_STRING","Varien_Db_Adapter_Interface",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$connection",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_connection",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$connection",89],";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Set factory\n     *\n     * @param Mage_Core_Model_Factory $factory\n     *\/",92],["T_WHITESPACE","\n    ",96],["T_PROTECTED","protected",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","_setFactory",97],"(",["T_STRING","Mage_Core_Model_Factory",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$factory",97],")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_factory",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$factory",99],";",["T_WHITESPACE","\n    ",99],"}",["T_WHITESPACE","\n\n    ",100],["T_DOC_COMMENT","\/**\n     * Set resource\n     *\n     * @param Mage_Core_Model_Resource_Db_Abstract $resource\n     *\/",102],["T_WHITESPACE","\n    ",106],["T_PROTECTED","protected",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","_setResource",107],"(",["T_STRING","Mage_Core_Model_Resource_Db_Abstract",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$resource",107],")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_resource",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$resource",109],";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Run reindex\n     *\/",112],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","execute",115],"(",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_app",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","dispatchEvent",117],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule_before_apply'",117],",",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",["T_CONSTANT_ENCAPSED_STRING","'resource'",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_resource",117],")",")",";",["T_WHITESPACE","\n\n        ",117],["T_DOC_COMMENT","\/** @var $coreDate Mage_Core_Model_Date *\/",119],["T_WHITESPACE","\n        ",119],["T_VARIABLE","$coreDate",120],["T_WHITESPACE","  ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_factory",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getModel",120],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",120],")",";",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$timestamp",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$coreDate",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","gmtTimestamp",121],"(",["T_CONSTANT_ENCAPSED_STRING","'Today'",121],")",";",["T_WHITESPACE","\n\n        ",121],["T_FOREACH","foreach",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_app",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getWebsites",123],"(",["T_STRING","false",123],")",["T_WHITESPACE"," ",123],["T_AS","as",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$website",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_DOC_COMMENT","\/** @var $website Mage_Core_Model_Website *\/",124],["T_WHITESPACE","\n            ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$website",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getDefaultStore",125],"(",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n                ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_reindex",126],"(",["T_VARIABLE","$website",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$timestamp",126],")",";",["T_WHITESPACE","\n            ",126],"}",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_prepareGroupWebsite",130],"(",["T_VARIABLE","$timestamp",130],")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_prepareAffectedProduct",131],"(",")",";",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Return temporary table name\n     *\n     * @return string\n     *\/",134],["T_WHITESPACE","\n    ",138],["T_PROTECTED","protected",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","_getTemporaryTable",139],"(",")",["T_WHITESPACE","\n    ",139],"{",["T_WHITESPACE","\n        ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_resource",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getTable",141],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product_price_tmp'",141],")",";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Create temporary table\n     *\/",144],["T_WHITESPACE","\n    ",146],["T_PROTECTED","protected",147],["T_WHITESPACE"," ",147],["T_FUNCTION","function",147],["T_WHITESPACE"," ",147],["T_STRING","_createTemporaryTable",147],"(",")",["T_WHITESPACE","\n    ",147],"{",["T_WHITESPACE","\n        ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_connection",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","dropTemporaryTable",149],"(",["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_getTemporaryTable",149],"(",")",")",";",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$table",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_connection",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","newTable",150],"(",["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_getTemporaryTable",150],"(",")",")",["T_WHITESPACE","\n            ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","addColumn",151],"(",["T_WHITESPACE","\n                ",151],["T_CONSTANT_ENCAPSED_STRING","'grouped_id'",152],",",["T_WHITESPACE","\n                ",152],["T_STRING","Varien_Db_Ddl_Table",153],["T_DOUBLE_COLON","::",153],["T_STRING","TYPE_VARCHAR",153],",",["T_WHITESPACE","\n                ",153],["T_LNUMBER","80",154],",",["T_WHITESPACE","\n                ",154],["T_ARRAY","array",155],"(",")",",",["T_WHITESPACE","\n                ",155],["T_CONSTANT_ENCAPSED_STRING","'Grouped ID'",156],["T_WHITESPACE","\n            ",156],")",["T_WHITESPACE","\n            ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","addColumn",158],"(",["T_WHITESPACE","\n                ",158],["T_CONSTANT_ENCAPSED_STRING","'product_id'",159],",",["T_WHITESPACE","\n                ",159],["T_STRING","Varien_Db_Ddl_Table",160],["T_DOUBLE_COLON","::",160],["T_STRING","TYPE_INTEGER",160],",",["T_WHITESPACE","\n                ",160],["T_STRING","null",161],",",["T_WHITESPACE","\n                ",161],["T_ARRAY","array",162],"(",["T_WHITESPACE","\n                    ",162],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_STRING","true",163],["T_WHITESPACE","\n                ",163],")",",",["T_WHITESPACE","\n                ",164],["T_CONSTANT_ENCAPSED_STRING","'Product ID'",165],["T_WHITESPACE","\n            ",165],")",["T_WHITESPACE","\n            ",166],["T_OBJECT_OPERATOR","->",167],["T_STRING","addColumn",167],"(",["T_WHITESPACE","\n                ",167],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",168],",",["T_WHITESPACE","\n                ",168],["T_STRING","Varien_Db_Ddl_Table",169],["T_DOUBLE_COLON","::",169],["T_STRING","TYPE_SMALLINT",169],",",["T_WHITESPACE","\n                ",169],["T_LNUMBER","5",170],",",["T_WHITESPACE","\n                ",170],["T_ARRAY","array",171],"(",["T_WHITESPACE","\n                    ",171],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",172],["T_WHITESPACE"," ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_STRING","true",172],["T_WHITESPACE","\n                ",172],")",",",["T_WHITESPACE","\n                ",173],["T_CONSTANT_ENCAPSED_STRING","'Customer Group ID'",174],["T_WHITESPACE","\n            ",174],")",["T_WHITESPACE","\n            ",175],["T_OBJECT_OPERATOR","->",176],["T_STRING","addColumn",176],"(",["T_WHITESPACE","\n                ",176],["T_CONSTANT_ENCAPSED_STRING","'from_date'",177],",",["T_WHITESPACE","\n                ",177],["T_STRING","Varien_Db_Ddl_Table",178],["T_DOUBLE_COLON","::",178],["T_STRING","TYPE_DATE",178],",",["T_WHITESPACE","\n                ",178],["T_STRING","null",179],",",["T_WHITESPACE","\n                ",179],["T_ARRAY","array",180],"(",")",",",["T_WHITESPACE","\n                ",180],["T_CONSTANT_ENCAPSED_STRING","'From Date'",181],["T_WHITESPACE","\n            ",181],")",["T_WHITESPACE","\n            ",182],["T_OBJECT_OPERATOR","->",183],["T_STRING","addColumn",183],"(",["T_WHITESPACE","\n                ",183],["T_CONSTANT_ENCAPSED_STRING","'to_date'",184],",",["T_WHITESPACE","\n                ",184],["T_STRING","Varien_Db_Ddl_Table",185],["T_DOUBLE_COLON","::",185],["T_STRING","TYPE_DATE",185],",",["T_WHITESPACE","\n                ",185],["T_STRING","null",186],",",["T_WHITESPACE","\n                ",186],["T_ARRAY","array",187],"(",")",",",["T_WHITESPACE","\n                ",187],["T_CONSTANT_ENCAPSED_STRING","'To Date'",188],["T_WHITESPACE","\n            ",188],")",["T_WHITESPACE","\n            ",189],["T_OBJECT_OPERATOR","->",190],["T_STRING","addColumn",190],"(",["T_WHITESPACE","\n                ",190],["T_CONSTANT_ENCAPSED_STRING","'action_amount'",191],",",["T_WHITESPACE","\n                ",191],["T_STRING","Varien_Db_Ddl_Table",192],["T_DOUBLE_COLON","::",192],["T_STRING","TYPE_DECIMAL",192],",",["T_WHITESPACE","\n                ",192],["T_CONSTANT_ENCAPSED_STRING","'12,4'",193],",",["T_WHITESPACE","\n                ",193],["T_ARRAY","array",194],"(",")",",",["T_WHITESPACE","\n                ",194],["T_CONSTANT_ENCAPSED_STRING","'Action Amount'",195],["T_WHITESPACE","\n            ",195],")",["T_WHITESPACE","\n            ",196],["T_OBJECT_OPERATOR","->",197],["T_STRING","addColumn",197],"(",["T_WHITESPACE","\n                ",197],["T_CONSTANT_ENCAPSED_STRING","'action_operator'",198],",",["T_WHITESPACE","\n                ",198],["T_STRING","Varien_Db_Ddl_Table",199],["T_DOUBLE_COLON","::",199],["T_STRING","TYPE_VARCHAR",199],",",["T_WHITESPACE","\n                ",199],["T_LNUMBER","10",200],",",["T_WHITESPACE","\n                ",200],["T_ARRAY","array",201],"(",")",",",["T_WHITESPACE","\n                ",201],["T_CONSTANT_ENCAPSED_STRING","'Action Operator'",202],["T_WHITESPACE","\n            ",202],")",["T_WHITESPACE","\n            ",203],["T_OBJECT_OPERATOR","->",204],["T_STRING","addColumn",204],"(",["T_WHITESPACE","\n                ",204],["T_CONSTANT_ENCAPSED_STRING","'action_stop'",205],",",["T_WHITESPACE","\n                ",205],["T_STRING","Varien_Db_Ddl_Table",206],["T_DOUBLE_COLON","::",206],["T_STRING","TYPE_SMALLINT",206],",",["T_WHITESPACE","\n                ",206],["T_LNUMBER","6",207],",",["T_WHITESPACE","\n                ",207],["T_ARRAY","array",208],"(",")",",",["T_WHITESPACE","\n                ",208],["T_CONSTANT_ENCAPSED_STRING","'Action Stop'",209],["T_WHITESPACE","\n            ",209],")",["T_WHITESPACE","\n            ",210],["T_OBJECT_OPERATOR","->",211],["T_STRING","addColumn",211],"(",["T_WHITESPACE","\n                ",211],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",212],",",["T_WHITESPACE","\n                ",212],["T_STRING","Varien_Db_Ddl_Table",213],["T_DOUBLE_COLON","::",213],["T_STRING","TYPE_INTEGER",213],",",["T_WHITESPACE","\n                ",213],["T_LNUMBER","10",214],",",["T_WHITESPACE","\n                ",214],["T_ARRAY","array",215],"(",["T_WHITESPACE","\n                    ",215],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_STRING","true",216],["T_WHITESPACE","\n                ",216],")",",",["T_WHITESPACE","\n                ",217],["T_CONSTANT_ENCAPSED_STRING","'Sort Order'",218],["T_WHITESPACE","\n            ",218],")",["T_WHITESPACE","\n            ",219],["T_OBJECT_OPERATOR","->",220],["T_STRING","addColumn",220],"(",["T_WHITESPACE","\n                ",220],["T_CONSTANT_ENCAPSED_STRING","'price'",221],",",["T_WHITESPACE","\n                ",221],["T_STRING","Varien_Db_Ddl_Table",222],["T_DOUBLE_COLON","::",222],["T_STRING","TYPE_DECIMAL",222],",",["T_WHITESPACE","\n                ",222],["T_CONSTANT_ENCAPSED_STRING","'12,4'",223],",",["T_WHITESPACE","\n                ",223],["T_ARRAY","array",224],"(",")",",",["T_WHITESPACE","\n                ",224],["T_CONSTANT_ENCAPSED_STRING","'Product Price'",225],["T_WHITESPACE","\n            ",225],")",["T_WHITESPACE","\n            ",226],["T_OBJECT_OPERATOR","->",227],["T_STRING","addColumn",227],"(",["T_WHITESPACE","\n                ",227],["T_CONSTANT_ENCAPSED_STRING","'rule_product_id'",228],",",["T_WHITESPACE","\n                ",228],["T_STRING","Varien_Db_Ddl_Table",229],["T_DOUBLE_COLON","::",229],["T_STRING","TYPE_INTEGER",229],",",["T_WHITESPACE","\n                ",229],["T_STRING","null",230],",",["T_WHITESPACE","\n                ",230],["T_ARRAY","array",231],"(",["T_WHITESPACE","\n                    ",231],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_STRING","true",232],["T_WHITESPACE","\n                ",232],")",",",["T_WHITESPACE","\n                ",233],["T_CONSTANT_ENCAPSED_STRING","'Rule Product ID'",234],["T_WHITESPACE","\n            ",234],")",["T_WHITESPACE","\n            ",235],["T_OBJECT_OPERATOR","->",236],["T_STRING","addColumn",236],"(",["T_WHITESPACE","\n                ",236],["T_CONSTANT_ENCAPSED_STRING","'from_time'",237],",",["T_WHITESPACE","\n                ",237],["T_STRING","Varien_Db_Ddl_Table",238],["T_DOUBLE_COLON","::",238],["T_STRING","TYPE_INTEGER",238],",",["T_WHITESPACE","\n                ",238],["T_STRING","null",239],",",["T_WHITESPACE","\n                ",239],["T_ARRAY","array",240],"(",["T_WHITESPACE","\n                    ",240],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",241],["T_WHITESPACE"," ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_STRING","true",241],",",["T_WHITESPACE","\n                    ",241],["T_CONSTANT_ENCAPSED_STRING","'nullable'",242],["T_WHITESPACE"," ",242],["T_DOUBLE_ARROW","=>",242],["T_WHITESPACE"," ",242],["T_STRING","true",242],",",["T_WHITESPACE","\n                    ",242],["T_CONSTANT_ENCAPSED_STRING","'default'",243],["T_WHITESPACE","  ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_LNUMBER","0",243],",",["T_WHITESPACE","\n                ",243],")",",",["T_WHITESPACE","\n                ",244],["T_CONSTANT_ENCAPSED_STRING","'From Time'",245],["T_WHITESPACE","\n            ",245],")",["T_WHITESPACE","\n            ",246],["T_OBJECT_OPERATOR","->",247],["T_STRING","addColumn",247],"(",["T_WHITESPACE","\n                ",247],["T_CONSTANT_ENCAPSED_STRING","'to_time'",248],",",["T_WHITESPACE","\n                ",248],["T_STRING","Varien_Db_Ddl_Table",249],["T_DOUBLE_COLON","::",249],["T_STRING","TYPE_INTEGER",249],",",["T_WHITESPACE","\n                ",249],["T_STRING","null",250],",",["T_WHITESPACE","\n                ",250],["T_ARRAY","array",251],"(",["T_WHITESPACE","\n                    ",251],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_STRING","true",252],",",["T_WHITESPACE","\n                    ",252],["T_CONSTANT_ENCAPSED_STRING","'nullable'",253],["T_WHITESPACE"," ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_STRING","true",253],",",["T_WHITESPACE","\n                    ",253],["T_CONSTANT_ENCAPSED_STRING","'default'",254],["T_WHITESPACE","  ",254],["T_DOUBLE_ARROW","=>",254],["T_WHITESPACE"," ",254],["T_LNUMBER","0",254],",",["T_WHITESPACE","\n                ",254],")",",",["T_WHITESPACE","\n                ",255],["T_CONSTANT_ENCAPSED_STRING","'To Time'",256],["T_WHITESPACE","\n            ",256],")",["T_WHITESPACE","\n            ",257],["T_OBJECT_OPERATOR","->",258],["T_STRING","addIndex",258],"(",["T_WHITESPACE","\n                ",258],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_connection",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getIndexName",259],"(",["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_getTemporaryTable",259],"(",")",",",["T_WHITESPACE"," ",259],["T_CONSTANT_ENCAPSED_STRING","'grouped_id'",259],")",",",["T_WHITESPACE","\n                ",259],["T_ARRAY","array",260],"(",["T_CONSTANT_ENCAPSED_STRING","'grouped_id'",260],")",["T_WHITESPACE","\n            ",260],")",["T_WHITESPACE","\n            ",261],["T_OBJECT_OPERATOR","->",262],["T_STRING","setComment",262],"(",["T_CONSTANT_ENCAPSED_STRING","'CatalogRule Price Temporary Table'",262],")",";",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_connection",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","createTemporaryTable",263],"(",["T_VARIABLE","$table",263],")",";",["T_WHITESPACE","\n    ",263],"}",["T_WHITESPACE","\n\n    ",264],["T_DOC_COMMENT","\/**\n     * Prepare temporary data\n     *\n     * @param Mage_Core_Model_Website $website\n     * @return Varien_Db_Select\n     *\/",266],["T_WHITESPACE","\n    ",271],["T_PROTECTED","protected",272],["T_WHITESPACE"," ",272],["T_FUNCTION","function",272],["T_WHITESPACE"," ",272],["T_STRING","_prepareTemporarySelect",272],"(",["T_STRING","Mage_Core_Model_Website",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$website",272],")",["T_WHITESPACE","\n    ",272],"{",["T_WHITESPACE","\n        ",273],["T_DOC_COMMENT","\/** @var $catalogFlatHelper Mage_Catalog_Helper_Product_Flat *\/",274],["T_WHITESPACE","\n        ",274],["T_VARIABLE","$catalogFlatHelper",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_factory",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getHelper",275],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_flat'",275],")",";",["T_WHITESPACE","\n\n        ",275],["T_DOC_COMMENT","\/** @var $eavConfig Mage_Eav_Model_Config *\/",277],["T_WHITESPACE","\n        ",277],["T_VARIABLE","$eavConfig",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_factory",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getSingleton",278],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",278],")",";",["T_WHITESPACE","\n        ",278],["T_VARIABLE","$priceAttribute",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$eavConfig",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","getAttribute",279],"(",["T_STRING","Mage_Catalog_Model_Product",279],["T_DOUBLE_COLON","::",279],["T_STRING","ENTITY",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'price'",279],")",";",["T_WHITESPACE","\n\n        ",279],["T_VARIABLE","$select",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","_connection",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","select",281],"(",")",["T_WHITESPACE","\n            ",281],["T_OBJECT_OPERATOR","->",282],["T_STRING","from",282],"(",["T_WHITESPACE","\n                ",282],["T_ARRAY","array",283],"(",["T_CONSTANT_ENCAPSED_STRING","'rp'",283],["T_WHITESPACE"," ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_resource",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getTable",283],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product'",283],")",")",",",["T_WHITESPACE","\n                ",283],["T_ARRAY","array",284],"(",")",["T_WHITESPACE","\n            ",284],")",["T_WHITESPACE","\n            ",285],["T_OBJECT_OPERATOR","->",286],["T_STRING","joinInner",286],"(",["T_WHITESPACE","\n                ",286],["T_ARRAY","array",287],"(",["T_CONSTANT_ENCAPSED_STRING","'r'",287],["T_WHITESPACE"," ",287],["T_DOUBLE_ARROW","=>",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_resource",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getTable",287],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",287],")",")",",",["T_WHITESPACE","\n                ",287],["T_CONSTANT_ENCAPSED_STRING","'r.rule_id = rp.rule_id'",288],",",["T_WHITESPACE","\n                ",288],["T_ARRAY","array",289],"(",")",["T_WHITESPACE","\n            ",289],")",["T_WHITESPACE","\n            ",290],["T_OBJECT_OPERATOR","->",291],["T_STRING","where",291],"(",["T_CONSTANT_ENCAPSED_STRING","'rp.website_id = ?'",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$website",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getId",291],"(",")",")",["T_WHITESPACE","\n            ",291],["T_OBJECT_OPERATOR","->",292],["T_STRING","order",292],"(",["T_WHITESPACE","\n                ",292],["T_ARRAY","array",293],"(",["T_CONSTANT_ENCAPSED_STRING","'rp.product_id'",293],",",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'rp.customer_group_id'",293],",",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'rp.sort_order'",293],",",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'rp.rule_product_id'",293],")",["T_WHITESPACE","\n            ",293],")",["T_WHITESPACE","\n            ",294],["T_OBJECT_OPERATOR","->",295],["T_STRING","joinLeft",295],"(",["T_WHITESPACE","\n                ",295],["T_ARRAY","array",296],"(",["T_WHITESPACE","\n                    ",296],["T_CONSTANT_ENCAPSED_STRING","'pg'",297],["T_WHITESPACE"," ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_resource",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getTable",297],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_group_price'",297],")",["T_WHITESPACE","\n                ",297],")",",",["T_WHITESPACE","\n                ",298],["T_CONSTANT_ENCAPSED_STRING","'pg.entity_id = rp.product_id AND pg.customer_group_id = rp.customer_group_id'",299],["T_WHITESPACE","\n                    ",299],".",["T_WHITESPACE"," ",300],["T_CONSTANT_ENCAPSED_STRING","' AND pg.website_id = rp.website_id'",300],",",["T_WHITESPACE","\n                ",300],["T_ARRAY","array",301],"(",")",["T_WHITESPACE","\n            ",301],")",["T_WHITESPACE","\n            ",302],["T_OBJECT_OPERATOR","->",303],["T_STRING","joinLeft",303],"(",["T_WHITESPACE","\n                ",303],["T_ARRAY","array",304],"(",["T_WHITESPACE","\n                    ",304],["T_CONSTANT_ENCAPSED_STRING","'pgd'",305],["T_WHITESPACE"," ",305],["T_DOUBLE_ARROW","=>",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_resource",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getTable",305],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_attribute_group_price'",305],")",["T_WHITESPACE","\n                ",305],")",",",["T_WHITESPACE","\n                ",306],["T_CONSTANT_ENCAPSED_STRING","'pgd.entity_id = rp.product_id AND pgd.customer_group_id = rp.customer_group_id'",307],["T_WHITESPACE","\n                    ",307],".",["T_WHITESPACE"," ",308],["T_CONSTANT_ENCAPSED_STRING","' AND pgd.website_id = 0'",308],",",["T_WHITESPACE","\n                ",308],["T_ARRAY","array",309],"(",")",["T_WHITESPACE","\n            ",309],")",";",["T_WHITESPACE","\n\n        ",310],["T_VARIABLE","$storeId",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$website",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","getDefaultStore",312],"(",")",["T_OBJECT_OPERATOR","->",312],["T_STRING","getId",312],"(",")",";",["T_WHITESPACE","\n\n        ",312],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$catalogFlatHelper",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","isEnabled",314],"(",")",["T_WHITESPACE"," ",314],["T_BOOLEAN_AND","&&",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$storeId",314],["T_WHITESPACE"," ",314],["T_BOOLEAN_AND","&&",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$catalogFlatHelper",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","isBuilt",314],"(",["T_VARIABLE","$storeId",314],")",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_VARIABLE","$select",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","joinInner",315],"(",["T_WHITESPACE","\n                ",315],["T_ARRAY","array",316],"(",["T_CONSTANT_ENCAPSED_STRING","'p'",316],["T_WHITESPACE"," ",316],["T_DOUBLE_ARROW","=>",316],["T_WHITESPACE"," ",316],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","_resource",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getTable",316],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_flat'",316],")",["T_WHITESPACE"," ",316],".",["T_WHITESPACE"," ",316],["T_CONSTANT_ENCAPSED_STRING","'_'",316],["T_WHITESPACE"," ",316],".",["T_WHITESPACE"," ",316],["T_VARIABLE","$storeId",316],")",",",["T_WHITESPACE","\n                ",316],["T_CONSTANT_ENCAPSED_STRING","'p.entity_id = rp.product_id'",317],",",["T_WHITESPACE","\n                ",317],["T_ARRAY","array",318],"(",")",["T_WHITESPACE","\n            ",318],")",";",["T_WHITESPACE","\n            ",319],["T_VARIABLE","$priceColumn",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_connection",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getIfNullSql",320],"(",["T_WHITESPACE","\n                ",320],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_connection",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getIfNullSql",321],"(",["T_WHITESPACE","\n                    ",321],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","_connection",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getCheckSql",322],"(",["T_WHITESPACE","\n                        ",322],["T_CONSTANT_ENCAPSED_STRING","'pg.is_percent = 1'",323],",",["T_WHITESPACE","\n                        ",323],["T_CONSTANT_ENCAPSED_STRING","'p.price * (100 - pg.value)\/100'",324],",",["T_WHITESPACE","\n                        ",324],["T_CONSTANT_ENCAPSED_STRING","'pg.value'",325],["T_WHITESPACE","\n                    ",325],")",",",["T_WHITESPACE","\n                    ",326],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_connection",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getCheckSql",327],"(",["T_WHITESPACE","\n                        ",327],["T_CONSTANT_ENCAPSED_STRING","'pgd.is_percent = 1'",328],",",["T_WHITESPACE","\n                        ",328],["T_CONSTANT_ENCAPSED_STRING","'p.price * (100 - pgd.value)\/100'",329],",",["T_WHITESPACE","\n                        ",329],["T_CONSTANT_ENCAPSED_STRING","'pgd.value'",330],["T_WHITESPACE","\n                    ",330],")",["T_WHITESPACE","\n                ",331],")",",",["T_WHITESPACE","\n                ",332],["T_CONSTANT_ENCAPSED_STRING","'p.price'",333],["T_WHITESPACE","\n            ",333],")",";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE"," ",335],["T_ELSE","else",335],["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n            ",335],["T_VARIABLE","$select",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","joinInner",336],"(",["T_WHITESPACE","\n                    ",336],["T_ARRAY","array",337],"(",["T_WHITESPACE","\n                        ",337],["T_CONSTANT_ENCAPSED_STRING","'pd'",338],["T_WHITESPACE"," ",338],["T_DOUBLE_ARROW","=>",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_resource",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getTable",338],"(",["T_ARRAY","array",338],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",338],",",["T_WHITESPACE"," ",338],["T_VARIABLE","$priceAttribute",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getBackendType",338],"(",")",")",")",["T_WHITESPACE","\n                    ",338],")",",",["T_WHITESPACE","\n                    ",339],["T_CONSTANT_ENCAPSED_STRING","'pd.entity_id = rp.product_id AND pd.store_id = 0 AND pd.attribute_id = '",340],["T_WHITESPACE","\n                        ",340],".",["T_WHITESPACE"," ",341],["T_VARIABLE","$priceAttribute",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getId",341],"(",")",",",["T_WHITESPACE","\n                    ",341],["T_ARRAY","array",342],"(",")",["T_WHITESPACE","\n                ",342],")",["T_WHITESPACE","\n                ",343],["T_OBJECT_OPERATOR","->",344],["T_STRING","joinLeft",344],"(",["T_WHITESPACE","\n                    ",344],["T_ARRAY","array",345],"(",["T_WHITESPACE","\n                        ",345],["T_CONSTANT_ENCAPSED_STRING","'p'",346],["T_WHITESPACE"," ",346],["T_DOUBLE_ARROW","=>",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_resource",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getTable",346],"(",["T_ARRAY","array",346],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$priceAttribute",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getBackendType",346],"(",")",")",")",["T_WHITESPACE","\n                    ",346],")",",",["T_WHITESPACE","\n                    ",347],["T_CONSTANT_ENCAPSED_STRING","'p.entity_id = rp.product_id AND p.store_id = '",348],["T_WHITESPACE"," ",348],".",["T_WHITESPACE"," ",348],["T_VARIABLE","$storeId",348],["T_WHITESPACE","\n                        ",348],".",["T_WHITESPACE"," ",349],["T_CONSTANT_ENCAPSED_STRING","' AND p.attribute_id = pd.attribute_id'",349],",",["T_WHITESPACE","\n                    ",349],["T_ARRAY","array",350],"(",")",["T_WHITESPACE","\n                ",350],")",";",["T_WHITESPACE","\n            ",351],["T_VARIABLE","$priceColumn",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","_connection",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getIfNullSql",352],"(",["T_WHITESPACE","\n                ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_connection",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getIfNullSql",353],"(",["T_WHITESPACE","\n                    ",353],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","_connection",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getCheckSql",354],"(",["T_WHITESPACE","\n                        ",354],["T_CONSTANT_ENCAPSED_STRING","'pg.is_percent = 1'",355],",",["T_WHITESPACE","\n                        ",355],["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","_connection",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","getIfNullSql",356],"(",["T_WHITESPACE","\n                            ",356],["T_CONSTANT_ENCAPSED_STRING","'p.value'",357],",",["T_WHITESPACE","\n                            ",357],["T_CONSTANT_ENCAPSED_STRING","'pd.value'",358],["T_WHITESPACE","\n                        ",358],")",["T_WHITESPACE"," ",359],".",["T_WHITESPACE"," ",359],["T_CONSTANT_ENCAPSED_STRING","' * (100 - pg.value)\/100'",359],",",["T_WHITESPACE","\n                        ",359],["T_CONSTANT_ENCAPSED_STRING","'pg.value'",360],["T_WHITESPACE","\n                    ",360],")",",",["T_WHITESPACE","\n                    ",361],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","_connection",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","getCheckSql",362],"(",["T_WHITESPACE","\n                        ",362],["T_CONSTANT_ENCAPSED_STRING","'pgd.is_percent = 1'",363],",",["T_WHITESPACE","\n                        ",363],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_connection",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","getIfNullSql",364],"(",["T_WHITESPACE","\n                            ",364],["T_CONSTANT_ENCAPSED_STRING","'p.value'",365],",",["T_WHITESPACE","\n                            ",365],["T_CONSTANT_ENCAPSED_STRING","'pd.value'",366],["T_WHITESPACE","\n                        ",366],")",["T_WHITESPACE"," ",367],".",["T_WHITESPACE"," ",367],["T_CONSTANT_ENCAPSED_STRING","' * (100 - pgd.value)\/100'",367],",",["T_WHITESPACE","\n                        ",367],["T_CONSTANT_ENCAPSED_STRING","'pgd.value'",368],["T_WHITESPACE","\n                    ",368],")",["T_WHITESPACE","\n                ",369],")",",",["T_WHITESPACE","\n                ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","_connection",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getIfNullSql",371],"(",["T_WHITESPACE","\n                    ",371],["T_CONSTANT_ENCAPSED_STRING","'p.value'",372],",",["T_WHITESPACE","\n                    ",372],["T_CONSTANT_ENCAPSED_STRING","'pd.value'",373],["T_WHITESPACE","\n                ",373],")",["T_WHITESPACE","\n            ",374],")",";",["T_WHITESPACE","\n        ",375],"}",["T_WHITESPACE","\n\n        ",376],["T_VARIABLE","$select",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","columns",378],"(",["T_WHITESPACE","\n            ",378],["T_ARRAY","array",379],"(",["T_WHITESPACE","\n                ",379],["T_CONSTANT_ENCAPSED_STRING","'grouped_id'",380],["T_WHITESPACE"," ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","_connection",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getConcatSql",380],"(",["T_WHITESPACE","\n                    ",380],["T_ARRAY","array",381],"(",["T_CONSTANT_ENCAPSED_STRING","'rp.product_id'",381],",",["T_WHITESPACE"," ",381],["T_CONSTANT_ENCAPSED_STRING","'rp.customer_group_id'",381],")",",",["T_WHITESPACE","\n                    ",381],["T_CONSTANT_ENCAPSED_STRING","'-'",382],["T_WHITESPACE","\n                ",382],")",",",["T_WHITESPACE","\n                ",383],["T_CONSTANT_ENCAPSED_STRING","'product_id'",384],["T_WHITESPACE","        ",384],["T_DOUBLE_ARROW","=>",384],["T_WHITESPACE"," ",384],["T_CONSTANT_ENCAPSED_STRING","'rp.product_id'",384],",",["T_WHITESPACE","\n                ",384],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",385],["T_WHITESPACE"," ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_CONSTANT_ENCAPSED_STRING","'rp.customer_group_id'",385],",",["T_WHITESPACE","\n                ",385],["T_CONSTANT_ENCAPSED_STRING","'from_date'",386],["T_WHITESPACE","         ",386],["T_DOUBLE_ARROW","=>",386],["T_WHITESPACE"," ",386],["T_CONSTANT_ENCAPSED_STRING","'r.from_date'",386],",",["T_WHITESPACE","\n                ",386],["T_CONSTANT_ENCAPSED_STRING","'to_date'",387],["T_WHITESPACE","           ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_CONSTANT_ENCAPSED_STRING","'r.to_date'",387],",",["T_WHITESPACE","\n                ",387],["T_CONSTANT_ENCAPSED_STRING","'action_amount'",388],["T_WHITESPACE","     ",388],["T_DOUBLE_ARROW","=>",388],["T_WHITESPACE"," ",388],["T_CONSTANT_ENCAPSED_STRING","'rp.action_amount'",388],",",["T_WHITESPACE","\n                ",388],["T_CONSTANT_ENCAPSED_STRING","'action_operator'",389],["T_WHITESPACE","   ",389],["T_DOUBLE_ARROW","=>",389],["T_WHITESPACE"," ",389],["T_CONSTANT_ENCAPSED_STRING","'rp.action_operator'",389],",",["T_WHITESPACE","\n                ",389],["T_CONSTANT_ENCAPSED_STRING","'action_stop'",390],["T_WHITESPACE","       ",390],["T_DOUBLE_ARROW","=>",390],["T_WHITESPACE"," ",390],["T_CONSTANT_ENCAPSED_STRING","'rp.action_stop'",390],",",["T_WHITESPACE","\n                ",390],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",391],["T_WHITESPACE","        ",391],["T_DOUBLE_ARROW","=>",391],["T_WHITESPACE"," ",391],["T_CONSTANT_ENCAPSED_STRING","'rp.sort_order'",391],",",["T_WHITESPACE","\n                ",391],["T_CONSTANT_ENCAPSED_STRING","'price'",392],["T_WHITESPACE","             ",392],["T_DOUBLE_ARROW","=>",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$priceColumn",392],",",["T_WHITESPACE","\n                ",392],["T_CONSTANT_ENCAPSED_STRING","'rule_product_id'",393],["T_WHITESPACE","   ",393],["T_DOUBLE_ARROW","=>",393],["T_WHITESPACE"," ",393],["T_CONSTANT_ENCAPSED_STRING","'rp.rule_product_id'",393],",",["T_WHITESPACE","\n                ",393],["T_CONSTANT_ENCAPSED_STRING","'from_time'",394],["T_WHITESPACE","         ",394],["T_DOUBLE_ARROW","=>",394],["T_WHITESPACE"," ",394],["T_CONSTANT_ENCAPSED_STRING","'rp.from_time'",394],",",["T_WHITESPACE","\n                ",394],["T_CONSTANT_ENCAPSED_STRING","'to_time'",395],["T_WHITESPACE","           ",395],["T_DOUBLE_ARROW","=>",395],["T_WHITESPACE"," ",395],["T_CONSTANT_ENCAPSED_STRING","'rp.to_time'",395],["T_WHITESPACE","\n            ",395],")",["T_WHITESPACE","\n        ",396],")",";",["T_WHITESPACE","\n\n        ",397],["T_RETURN","return",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$select",399],";",["T_WHITESPACE","\n    ",399],"}",["T_WHITESPACE","\n\n    ",400],["T_DOC_COMMENT","\/**\n     * Prepare price column\n     *\n     * @return Zend_Db_Expr\n     *\/",402],["T_WHITESPACE","\n    ",406],["T_PROTECTED","protected",407],["T_WHITESPACE"," ",407],["T_FUNCTION","function",407],["T_WHITESPACE"," ",407],["T_STRING","_calculatePrice",407],"(",")",["T_WHITESPACE","\n    ",407],"{",["T_WHITESPACE","\n        ",408],["T_VARIABLE","$toPercent",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","_connection",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","quote",409],"(",["T_CONSTANT_ENCAPSED_STRING","'to_percent'",409],")",";",["T_WHITESPACE","\n        ",409],["T_VARIABLE","$byPercent",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_connection",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","quote",410],"(",["T_CONSTANT_ENCAPSED_STRING","'by_percent'",410],")",";",["T_WHITESPACE","\n        ",410],["T_VARIABLE","$toFixed",411],["T_WHITESPACE","   ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_connection",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","quote",411],"(",["T_CONSTANT_ENCAPSED_STRING","'to_fixed'",411],")",";",["T_WHITESPACE","\n        ",411],["T_VARIABLE","$byFixed",412],["T_WHITESPACE","   ",412],"=",["T_WHITESPACE"," ",412],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","_connection",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","quote",412],"(",["T_CONSTANT_ENCAPSED_STRING","'by_fixed'",412],")",";",["T_WHITESPACE","\n        ",412],["T_VARIABLE","$nA",413],["T_WHITESPACE","        ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_connection",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","quote",413],"(",["T_CONSTANT_ENCAPSED_STRING","'N\/A'",413],")",";",["T_WHITESPACE","\n\n        ",413],["T_RETURN","return",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_connection",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getCaseSql",415],"(",["T_WHITESPACE","\n            ",415],["T_CONSTANT_ENCAPSED_STRING","''",416],",",["T_WHITESPACE","\n            ",416],["T_ARRAY","array",417],"(",["T_WHITESPACE","\n                ",417],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","_connection",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getIfNullSql",418],"(",["T_WHITESPACE","\n                    ",418],["T_NEW","new",419],["T_WHITESPACE"," ",419],["T_STRING","Zend_Db_Expr",419],"(",["T_CONSTANT_ENCAPSED_STRING","'@group_id'",419],")",",",["T_WHITESPACE"," ",419],["T_VARIABLE","$nA",419],["T_WHITESPACE","\n                ",419],")",["T_WHITESPACE"," ",420],".",["T_WHITESPACE"," ",420],["T_CONSTANT_ENCAPSED_STRING","' != cppt.grouped_id'",420],["T_WHITESPACE"," ",420],["T_DOUBLE_ARROW","=>",420],["T_WHITESPACE","\n                ",420],["T_CONSTANT_ENCAPSED_STRING","'@price := '",421],["T_WHITESPACE"," ",421],".",["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","_connection",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getCaseSql",421],"(",["T_WHITESPACE","\n                    ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_connection",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","quoteIdentifier",422],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.action_operator'",422],")",",",["T_WHITESPACE","\n                    ",422],["T_ARRAY","array",423],"(",["T_WHITESPACE","\n                        ",423],["T_VARIABLE","$toPercent",424],["T_WHITESPACE"," ",424],["T_DOUBLE_ARROW","=>",424],["T_WHITESPACE"," ",424],["T_NEW","new",424],["T_WHITESPACE"," ",424],["T_STRING","Zend_Db_Expr",424],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.price * cppt.action_amount\/100'",424],")",",",["T_WHITESPACE","\n                        ",424],["T_VARIABLE","$byPercent",425],["T_WHITESPACE"," ",425],["T_DOUBLE_ARROW","=>",425],["T_WHITESPACE"," ",425],["T_NEW","new",425],["T_WHITESPACE"," ",425],["T_STRING","Zend_Db_Expr",425],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.price * (1 - cppt.action_amount\/100)'",425],")",",",["T_WHITESPACE","\n                        ",425],["T_VARIABLE","$toFixed",426],["T_WHITESPACE","   ",426],["T_DOUBLE_ARROW","=>",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","_connection",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getCheckSql",426],"(",["T_WHITESPACE","\n                            ",426],["T_NEW","new",427],["T_WHITESPACE"," ",427],["T_STRING","Zend_Db_Expr",427],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.action_amount < cppt.price'",427],")",",",["T_WHITESPACE","\n                            ",427],["T_NEW","new",428],["T_WHITESPACE"," ",428],["T_STRING","Zend_Db_Expr",428],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.action_amount'",428],")",",",["T_WHITESPACE","\n                            ",428],["T_NEW","new",429],["T_WHITESPACE"," ",429],["T_STRING","Zend_Db_Expr",429],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.price'",429],")",["T_WHITESPACE","\n                        ",429],")",",",["T_WHITESPACE","\n                        ",430],["T_VARIABLE","$byFixed",431],["T_WHITESPACE","   ",431],["T_DOUBLE_ARROW","=>",431],["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_connection",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getCheckSql",431],"(",["T_WHITESPACE","\n                            ",431],["T_NEW","new",432],["T_WHITESPACE"," ",432],["T_STRING","Zend_Db_Expr",432],"(",["T_CONSTANT_ENCAPSED_STRING","'0 > cppt.price - cppt.action_amount'",432],")",",",["T_WHITESPACE","\n                            ",432],["T_NEW","new",433],["T_WHITESPACE"," ",433],["T_STRING","Zend_Db_Expr",433],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",433],")",",",["T_WHITESPACE","\n                            ",433],["T_NEW","new",434],["T_WHITESPACE"," ",434],["T_STRING","Zend_Db_Expr",434],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.price - cppt.action_amount'",434],")",["T_WHITESPACE","\n                        ",434],")",",",["T_WHITESPACE","\n                    ",435],")",["T_WHITESPACE","\n                ",436],")",",",["T_WHITESPACE","\n                ",437],["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","_connection",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getIfNullSql",438],"(",["T_WHITESPACE","\n                    ",438],["T_NEW","new",439],["T_WHITESPACE"," ",439],["T_STRING","Zend_Db_Expr",439],"(",["T_CONSTANT_ENCAPSED_STRING","'@group_id'",439],")",",",["T_WHITESPACE"," ",439],["T_VARIABLE","$nA",439],["T_WHITESPACE","\n                ",439],")",["T_WHITESPACE"," ",440],".",["T_WHITESPACE"," ",440],["T_CONSTANT_ENCAPSED_STRING","' = cppt.grouped_id AND '",440],["T_WHITESPACE","\n                ",440],".",["T_WHITESPACE"," ",441],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","_connection",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getIfNullSql",441],"(",["T_WHITESPACE","\n                    ",441],["T_NEW","new",442],["T_WHITESPACE"," ",442],["T_STRING","Zend_Db_Expr",442],"(",["T_CONSTANT_ENCAPSED_STRING","'@action_stop'",442],")",",",["T_WHITESPACE","\n                    ",442],["T_NEW","new",443],["T_WHITESPACE"," ",443],["T_STRING","Zend_Db_Expr",443],"(",["T_LNUMBER","0",443],")",["T_WHITESPACE","\n                ",443],")",["T_WHITESPACE"," ",444],".",["T_WHITESPACE"," ",444],["T_CONSTANT_ENCAPSED_STRING","' = 0'",444],["T_WHITESPACE"," ",444],["T_DOUBLE_ARROW","=>",444],["T_WHITESPACE"," ",444],["T_CONSTANT_ENCAPSED_STRING","'@price := '",444],["T_WHITESPACE"," ",444],".",["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","_connection",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getCaseSql",444],"(",["T_WHITESPACE","\n                    ",444],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","_connection",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","quoteIdentifier",445],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.action_operator'",445],")",",",["T_WHITESPACE","\n                    ",445],["T_ARRAY","array",446],"(",["T_WHITESPACE","\n                        ",446],["T_VARIABLE","$toPercent",447],["T_WHITESPACE"," ",447],["T_DOUBLE_ARROW","=>",447],["T_WHITESPACE"," ",447],["T_NEW","new",447],["T_WHITESPACE"," ",447],["T_STRING","Zend_Db_Expr",447],"(",["T_CONSTANT_ENCAPSED_STRING","'@price * cppt.action_amount\/100'",447],")",",",["T_WHITESPACE","\n                        ",447],["T_VARIABLE","$byPercent",448],["T_WHITESPACE"," ",448],["T_DOUBLE_ARROW","=>",448],["T_WHITESPACE"," ",448],["T_NEW","new",448],["T_WHITESPACE"," ",448],["T_STRING","Zend_Db_Expr",448],"(",["T_CONSTANT_ENCAPSED_STRING","'@price * (1 - cppt.action_amount\/100)'",448],")",",",["T_WHITESPACE","\n                        ",448],["T_VARIABLE","$toFixed",449],["T_WHITESPACE","   ",449],["T_DOUBLE_ARROW","=>",449],["T_WHITESPACE"," ",449],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_connection",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getCheckSql",449],"(",["T_WHITESPACE","\n                            ",449],["T_NEW","new",450],["T_WHITESPACE"," ",450],["T_STRING","Zend_Db_Expr",450],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.action_amount < @price'",450],")",",",["T_WHITESPACE","\n                            ",450],["T_NEW","new",451],["T_WHITESPACE"," ",451],["T_STRING","Zend_Db_Expr",451],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.action_amount'",451],")",",",["T_WHITESPACE","\n                            ",451],["T_NEW","new",452],["T_WHITESPACE"," ",452],["T_STRING","Zend_Db_Expr",452],"(",["T_CONSTANT_ENCAPSED_STRING","'@price'",452],")",["T_WHITESPACE","\n                        ",452],")",",",["T_WHITESPACE","\n                        ",453],["T_VARIABLE","$byFixed",454],["T_WHITESPACE","   ",454],["T_DOUBLE_ARROW","=>",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","_connection",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","getCheckSql",454],"(",["T_WHITESPACE","\n                            ",454],["T_NEW","new",455],["T_WHITESPACE"," ",455],["T_STRING","Zend_Db_Expr",455],"(",["T_CONSTANT_ENCAPSED_STRING","'0 > @price - cppt.action_amount'",455],")",",",["T_WHITESPACE","\n                            ",455],["T_NEW","new",456],["T_WHITESPACE"," ",456],["T_STRING","Zend_Db_Expr",456],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",456],")",",",["T_WHITESPACE","\n                            ",456],["T_NEW","new",457],["T_WHITESPACE"," ",457],["T_STRING","Zend_Db_Expr",457],"(",["T_CONSTANT_ENCAPSED_STRING","'@price - cppt.action_amount'",457],")",["T_WHITESPACE","\n                        ",457],")",",",["T_WHITESPACE","\n                    ",458],")",["T_WHITESPACE","\n                ",459],")",["T_WHITESPACE","\n            ",460],")",",",["T_WHITESPACE","\n            ",461],["T_CONSTANT_ENCAPSED_STRING","'@price := @price'",462],["T_WHITESPACE","\n        ",462],")",";",["T_WHITESPACE","\n    ",463],"}",["T_WHITESPACE","\n\n    ",464],["T_DOC_COMMENT","\/**\n     * Prepare index select\n     *\n     * @param Mage_Core_Model_Website $website\n     * @param $time\n     * @return Varien_Db_Select\n     *\/",466],["T_WHITESPACE","\n    ",472],["T_PROTECTED","protected",473],["T_WHITESPACE"," ",473],["T_FUNCTION","function",473],["T_WHITESPACE"," ",473],["T_STRING","_prepareIndexSelect",473],"(",["T_STRING","Mage_Core_Model_Website",473],["T_WHITESPACE"," ",473],["T_VARIABLE","$website",473],",",["T_WHITESPACE"," ",473],["T_VARIABLE","$time",473],")",["T_WHITESPACE","\n    ",473],"{",["T_WHITESPACE","\n        ",474],["T_VARIABLE","$nA",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","_connection",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","quote",475],"(",["T_CONSTANT_ENCAPSED_STRING","'N\/A'",475],")",";",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","_connection",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","query",476],"(",["T_CONSTANT_ENCAPSED_STRING","'SET @price := 0'",476],")",";",["T_WHITESPACE","\n        ",476],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","_connection",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","query",477],"(",["T_CONSTANT_ENCAPSED_STRING","'SET @group_id := NULL'",477],")",";",["T_WHITESPACE","\n        ",477],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","_connection",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","query",478],"(",["T_CONSTANT_ENCAPSED_STRING","'SET @action_stop := NULL'",478],")",";",["T_WHITESPACE","\n\n        ",478],["T_VARIABLE","$indexSelect",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","_connection",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","select",480],"(",")",["T_WHITESPACE","\n            ",480],["T_OBJECT_OPERATOR","->",481],["T_STRING","from",481],"(",["T_ARRAY","array",481],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt'",481],["T_WHITESPACE"," ",481],["T_DOUBLE_ARROW","=>",481],["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","_getTemporaryTable",481],"(",")",")",",",["T_WHITESPACE"," ",481],["T_ARRAY","array",481],"(",")",")",["T_WHITESPACE","\n            ",481],["T_OBJECT_OPERATOR","->",482],["T_STRING","order",482],"(",["T_ARRAY","array",482],"(",["T_CONSTANT_ENCAPSED_STRING","'cppt.grouped_id'",482],",",["T_WHITESPACE"," ",482],["T_CONSTANT_ENCAPSED_STRING","'cppt.sort_order'",482],",",["T_WHITESPACE"," ",482],["T_CONSTANT_ENCAPSED_STRING","'cppt.rule_product_id'",482],")",")",["T_WHITESPACE","\n            ",482],["T_OBJECT_OPERATOR","->",483],["T_STRING","columns",483],"(",["T_WHITESPACE","\n                ",483],["T_ARRAY","array",484],"(",["T_WHITESPACE","\n                    ",484],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",485],["T_WHITESPACE"," ",485],["T_DOUBLE_ARROW","=>",485],["T_WHITESPACE"," ",485],["T_CONSTANT_ENCAPSED_STRING","'cppt.customer_group_id'",485],",",["T_WHITESPACE","\n                    ",485],["T_CONSTANT_ENCAPSED_STRING","'product_id'",486],["T_WHITESPACE","        ",486],["T_DOUBLE_ARROW","=>",486],["T_WHITESPACE"," ",486],["T_CONSTANT_ENCAPSED_STRING","'cppt.product_id'",486],",",["T_WHITESPACE","\n                    ",486],["T_CONSTANT_ENCAPSED_STRING","'rule_price'",487],["T_WHITESPACE","        ",487],["T_DOUBLE_ARROW","=>",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","_calculatePrice",487],"(",")",",",["T_WHITESPACE","\n                    ",487],["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",488],["T_WHITESPACE"," ",488],["T_DOUBLE_ARROW","=>",488],["T_WHITESPACE"," ",488],["T_CONSTANT_ENCAPSED_STRING","'cppt.from_date'",488],",",["T_WHITESPACE","\n                    ",488],["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",489],["T_WHITESPACE"," ",489],["T_DOUBLE_ARROW","=>",489],["T_WHITESPACE"," ",489],["T_CONSTANT_ENCAPSED_STRING","'cppt.to_date'",489],",",["T_WHITESPACE","\n                    ",489],["T_NEW","new",490],["T_WHITESPACE"," ",490],["T_STRING","Zend_Db_Expr",490],"(",["T_WHITESPACE","\n                        ",490],["T_VARIABLE","$this",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","_connection",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getCaseSql",491],"(",["T_WHITESPACE","\n                            ",491],["T_CONSTANT_ENCAPSED_STRING","''",492],",",["T_WHITESPACE","\n                            ",492],["T_ARRAY","array",493],"(",["T_WHITESPACE","\n                                ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","_connection",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getIfNullSql",494],"(",["T_WHITESPACE","\n                                    ",494],["T_NEW","new",495],["T_WHITESPACE"," ",495],["T_STRING","Zend_Db_Expr",495],"(",["T_CONSTANT_ENCAPSED_STRING","'@group_id'",495],")",",",["T_WHITESPACE","\n                                    ",495],["T_VARIABLE","$nA",496],["T_WHITESPACE","\n                                ",496],")",["T_WHITESPACE"," ",497],".",["T_WHITESPACE"," ",497],["T_CONSTANT_ENCAPSED_STRING","' != cppt.grouped_id'",497],["T_WHITESPACE"," ",497],["T_DOUBLE_ARROW","=>",497],["T_WHITESPACE"," ",497],["T_NEW","new",497],["T_WHITESPACE"," ",497],["T_STRING","Zend_Db_Expr",497],"(",["T_CONSTANT_ENCAPSED_STRING","'@action_stop := cppt.action_stop'",497],")",",",["T_WHITESPACE","\n                                ",497],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","_connection",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getIfNullSql",498],"(",["T_WHITESPACE","\n                                    ",498],["T_NEW","new",499],["T_WHITESPACE"," ",499],["T_STRING","Zend_Db_Expr",499],"(",["T_CONSTANT_ENCAPSED_STRING","'@group_id'",499],")",",",["T_WHITESPACE","\n                                    ",499],["T_VARIABLE","$nA",500],["T_WHITESPACE","\n                                ",500],")",["T_WHITESPACE"," ",501],".",["T_WHITESPACE"," ",501],["T_CONSTANT_ENCAPSED_STRING","' = cppt.grouped_id'",501],["T_WHITESPACE"," ",501],["T_DOUBLE_ARROW","=>",501],["T_WHITESPACE"," ",501],["T_CONSTANT_ENCAPSED_STRING","'@action_stop := '",501],["T_WHITESPACE","\n                                    ",501],".",["T_WHITESPACE"," ",502],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","_connection",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getIfNullSql",502],"(",["T_WHITESPACE","\n                                        ",502],["T_NEW","new",503],["T_WHITESPACE"," ",503],["T_STRING","Zend_Db_Expr",503],"(",["T_CONSTANT_ENCAPSED_STRING","'@action_stop'",503],")",",",["T_WHITESPACE","\n                                        ",503],["T_NEW","new",504],["T_WHITESPACE"," ",504],["T_STRING","Zend_Db_Expr",504],"(",["T_LNUMBER","0",504],")",["T_WHITESPACE","\n                                    ",504],")",["T_WHITESPACE"," ",505],".",["T_WHITESPACE"," ",505],["T_CONSTANT_ENCAPSED_STRING","' + cppt.action_stop'",505],",",["T_WHITESPACE","\n                            ",505],")",["T_WHITESPACE","\n                        ",506],")",["T_WHITESPACE","\n                    ",507],")",",",["T_WHITESPACE","\n                    ",508],["T_NEW","new",509],["T_WHITESPACE"," ",509],["T_STRING","Zend_Db_Expr",509],"(",["T_CONSTANT_ENCAPSED_STRING","'@group_id := cppt.grouped_id'",509],")",",",["T_WHITESPACE","\n                    ",509],["T_CONSTANT_ENCAPSED_STRING","'from_time'",510],["T_WHITESPACE","         ",510],["T_DOUBLE_ARROW","=>",510],["T_WHITESPACE"," ",510],["T_CONSTANT_ENCAPSED_STRING","'cppt.from_time'",510],",",["T_WHITESPACE","\n                    ",510],["T_CONSTANT_ENCAPSED_STRING","'to_time'",511],["T_WHITESPACE","           ",511],["T_DOUBLE_ARROW","=>",511],["T_WHITESPACE"," ",511],["T_CONSTANT_ENCAPSED_STRING","'cppt.to_time'",511],["T_WHITESPACE","\n                ",511],")",["T_WHITESPACE","\n            ",512],")",";",["T_WHITESPACE","\n\n        ",513],["T_VARIABLE","$select",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","_connection",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","select",515],"(",")",["T_WHITESPACE","\n            ",515],["T_OBJECT_OPERATOR","->",516],["T_STRING","from",516],"(",["T_VARIABLE","$indexSelect",516],",",["T_WHITESPACE"," ",516],["T_ARRAY","array",516],"(",")",")",["T_WHITESPACE","\n            ",516],["T_OBJECT_OPERATOR","->",517],["T_STRING","joinInner",517],"(",["T_WHITESPACE","\n                ",517],["T_ARRAY","array",518],"(",["T_WHITESPACE","\n                    ",518],["T_CONSTANT_ENCAPSED_STRING","'dates'",519],["T_WHITESPACE"," ",519],["T_DOUBLE_ARROW","=>",519],["T_WHITESPACE"," ",519],["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","_connection",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","select",519],"(",")",["T_OBJECT_OPERATOR","->",519],["T_STRING","union",519],"(",["T_WHITESPACE","\n                        ",519],["T_ARRAY","array",520],"(",["T_WHITESPACE","\n                            ",520],["T_NEW","new",521],["T_WHITESPACE"," ",521],["T_STRING","Zend_Db_Expr",521],"(",["T_WHITESPACE","\n                                ",521],["T_CONSTANT_ENCAPSED_STRING","'SELECT '",522],["T_WHITESPACE"," ",522],".",["T_WHITESPACE"," ",522],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_connection",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getDateAddSql",522],"(",["T_WHITESPACE","\n                                    ",522],["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_connection",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","fromUnixtime",523],"(",["T_VARIABLE","$time",523],")",",",["T_WHITESPACE","\n                                    ",523],"-",["T_LNUMBER","1",524],",",["T_WHITESPACE","\n                                    ",524],["T_STRING","Varien_Db_Adapter_Interface",525],["T_DOUBLE_COLON","::",525],["T_STRING","INTERVAL_DAY",525],["T_WHITESPACE","\n                                ",525],")",["T_WHITESPACE"," ",526],".",["T_WHITESPACE"," ",526],["T_CONSTANT_ENCAPSED_STRING","' AS rule_date'",526],["T_WHITESPACE","\n                            ",526],")",",",["T_WHITESPACE","\n                            ",527],["T_NEW","new",528],["T_WHITESPACE"," ",528],["T_STRING","Zend_Db_Expr",528],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT '",528],["T_WHITESPACE"," ",528],".",["T_WHITESPACE"," ",528],["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","_connection",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","fromUnixtime",528],"(",["T_VARIABLE","$time",528],")",["T_WHITESPACE"," ",528],".",["T_WHITESPACE"," ",528],["T_CONSTANT_ENCAPSED_STRING","' AS rule_date'",528],")",",",["T_WHITESPACE","\n                            ",528],["T_NEW","new",529],["T_WHITESPACE"," ",529],["T_STRING","Zend_Db_Expr",529],"(",["T_WHITESPACE","\n                                ",529],["T_CONSTANT_ENCAPSED_STRING","'SELECT '",530],["T_WHITESPACE"," ",530],".",["T_WHITESPACE"," ",530],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","_connection",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","getDateAddSql",530],"(",["T_WHITESPACE","\n                                    ",530],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","_connection",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","fromUnixtime",531],"(",["T_VARIABLE","$time",531],")",",",["T_WHITESPACE","\n                                    ",531],["T_LNUMBER","1",532],",",["T_WHITESPACE","\n                                    ",532],["T_STRING","Varien_Db_Adapter_Interface",533],["T_DOUBLE_COLON","::",533],["T_STRING","INTERVAL_DAY",533],["T_WHITESPACE","\n                                ",533],")",["T_WHITESPACE"," ",534],".",["T_WHITESPACE"," ",534],["T_CONSTANT_ENCAPSED_STRING","' AS rule_date'",534],["T_WHITESPACE","\n                            ",534],")",",",["T_WHITESPACE","\n                        ",535],")",["T_WHITESPACE","\n                    ",536],")",["T_WHITESPACE","\n                ",537],")",",",["T_WHITESPACE","\n                ",538],["T_CONSTANT_ENCAPSED_STRING","'1=1'",539],",",["T_WHITESPACE","\n                ",539],["T_ARRAY","array",540],"(",")",["T_WHITESPACE","\n            ",540],")",["T_WHITESPACE","\n            ",541],["T_OBJECT_OPERATOR","->",542],["T_STRING","columns",542],"(",["T_WHITESPACE","\n                ",542],["T_ARRAY","array",543],"(",["T_WHITESPACE","\n                    ",543],["T_CONSTANT_ENCAPSED_STRING","'rule_product_price_id'",544],["T_WHITESPACE"," ",544],["T_DOUBLE_ARROW","=>",544],["T_WHITESPACE"," ",544],["T_NEW","new",544],["T_WHITESPACE"," ",544],["T_STRING","Zend_Db_Expr",544],"(",["T_CONSTANT_ENCAPSED_STRING","'NULL'",544],")",",",["T_WHITESPACE","\n                    ",544],["T_CONSTANT_ENCAPSED_STRING","'rule_date'",545],["T_WHITESPACE","             ",545],["T_DOUBLE_ARROW","=>",545],["T_WHITESPACE"," ",545],["T_CONSTANT_ENCAPSED_STRING","'dates.rule_date'",545],",",["T_WHITESPACE","\n                    ",545],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",546],["T_WHITESPACE","     ",546],["T_DOUBLE_ARROW","=>",546],["T_WHITESPACE"," ",546],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",546],",",["T_WHITESPACE","\n                    ",546],["T_CONSTANT_ENCAPSED_STRING","'product_id'",547],["T_WHITESPACE","            ",547],["T_DOUBLE_ARROW","=>",547],["T_WHITESPACE"," ",547],["T_CONSTANT_ENCAPSED_STRING","'product_id'",547],",",["T_WHITESPACE","\n                    ",547],["T_CONSTANT_ENCAPSED_STRING","'rule_price'",548],["T_WHITESPACE","            ",548],["T_DOUBLE_ARROW","=>",548],["T_WHITESPACE"," ",548],["T_CONSTANT_ENCAPSED_STRING","'MIN(rule_price)'",548],",",["T_WHITESPACE","\n                    ",548],["T_CONSTANT_ENCAPSED_STRING","'website_id'",549],["T_WHITESPACE","            ",549],["T_DOUBLE_ARROW","=>",549],["T_WHITESPACE"," ",549],["T_NEW","new",549],["T_WHITESPACE"," ",549],["T_STRING","Zend_Db_Expr",549],"(",["T_VARIABLE","$website",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getId",549],"(",")",")",",",["T_WHITESPACE","\n                    ",549],["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",550],["T_WHITESPACE","     ",550],["T_DOUBLE_ARROW","=>",550],["T_WHITESPACE"," ",550],["T_CONSTANT_ENCAPSED_STRING","'latest_start_date'",550],",",["T_WHITESPACE","\n                    ",550],["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",551],["T_WHITESPACE","     ",551],["T_DOUBLE_ARROW","=>",551],["T_WHITESPACE"," ",551],["T_CONSTANT_ENCAPSED_STRING","'earliest_end_date'",551],",",["T_WHITESPACE","\n                ",551],")",["T_WHITESPACE","\n            ",552],")",["T_WHITESPACE","\n            ",553],["T_OBJECT_OPERATOR","->",554],["T_STRING","where",554],"(",["T_NEW","new",554],["T_WHITESPACE"," ",554],["T_STRING","Zend_Db_Expr",554],"(",["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","_connection",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","getUnixTimestamp",554],"(",["T_CONSTANT_ENCAPSED_STRING","'dates.rule_date'",554],")",["T_WHITESPACE"," ",554],".",["T_WHITESPACE"," ",554],["T_CONSTANT_ENCAPSED_STRING","\" >= from_time\"",554],")",")",["T_WHITESPACE","\n            ",554],["T_OBJECT_OPERATOR","->",555],["T_STRING","where",555],"(",["T_WHITESPACE","\n                ",555],["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","_connection",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","getCheckSql",556],"(",["T_WHITESPACE","\n                    ",556],["T_NEW","new",557],["T_WHITESPACE"," ",557],["T_STRING","Zend_Db_Expr",557],"(",["T_CONSTANT_ENCAPSED_STRING","'to_time = 0'",557],")",",",["T_WHITESPACE","\n                    ",557],["T_NEW","new",558],["T_WHITESPACE"," ",558],["T_STRING","Zend_Db_Expr",558],"(",["T_LNUMBER","1",558],")",",",["T_WHITESPACE","\n                    ",558],["T_NEW","new",559],["T_WHITESPACE"," ",559],["T_STRING","Zend_Db_Expr",559],"(",["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","_connection",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","getUnixTimestamp",559],"(",["T_CONSTANT_ENCAPSED_STRING","'dates.rule_date'",559],")",["T_WHITESPACE"," ",559],".",["T_WHITESPACE"," ",559],["T_CONSTANT_ENCAPSED_STRING","\" <= to_time\"",559],")",["T_WHITESPACE","\n                ",559],")",["T_WHITESPACE","\n            ",560],")",["T_WHITESPACE","\n            ",561],["T_OBJECT_OPERATOR","->",562],["T_STRING","group",562],"(",["T_ARRAY","array",562],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",562],",",["T_WHITESPACE"," ",562],["T_CONSTANT_ENCAPSED_STRING","'product_id'",562],",",["T_WHITESPACE"," ",562],["T_CONSTANT_ENCAPSED_STRING","'dates.rule_date'",562],")",")",";",["T_WHITESPACE","\n\n        ",562],["T_RETURN","return",564],["T_WHITESPACE"," ",564],["T_VARIABLE","$select",564],";",["T_WHITESPACE","\n    ",564],"}",["T_WHITESPACE","\n\n    ",565],["T_DOC_COMMENT","\/**\n     * Remove old index data\n     *\n     * @param Mage_Core_Model_Website $website\n     *\/",567],["T_WHITESPACE","\n    ",571],["T_PROTECTED","protected",572],["T_WHITESPACE"," ",572],["T_FUNCTION","function",572],["T_WHITESPACE"," ",572],["T_STRING","_removeOldIndexData",572],"(",["T_STRING","Mage_Core_Model_Website",572],["T_WHITESPACE"," ",572],["T_VARIABLE","$website",572],")",["T_WHITESPACE","\n    ",572],"{",["T_WHITESPACE","\n        ",573],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","_connection",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","delete",574],"(",["T_WHITESPACE","\n            ",574],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","_resource",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","getTable",575],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product_price'",575],")",",",["T_WHITESPACE","\n            ",575],["T_ARRAY","array",576],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id = ?'",576],["T_WHITESPACE"," ",576],["T_DOUBLE_ARROW","=>",576],["T_WHITESPACE"," ",576],["T_VARIABLE","$website",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","getId",576],"(",")",")",["T_WHITESPACE","\n        ",576],")",";",["T_WHITESPACE","\n    ",577],"}",["T_WHITESPACE","\n\n    ",578],["T_DOC_COMMENT","\/**\n     * Fill Index Data\n     *\n     * @param Mage_Core_Model_Website $website\n     * @param int $time\n     *\/",580],["T_WHITESPACE","\n    ",585],["T_PROTECTED","protected",586],["T_WHITESPACE"," ",586],["T_FUNCTION","function",586],["T_WHITESPACE"," ",586],["T_STRING","_fillIndexData",586],"(",["T_STRING","Mage_Core_Model_Website",586],["T_WHITESPACE"," ",586],["T_VARIABLE","$website",586],",",["T_WHITESPACE"," ",586],["T_VARIABLE","$time",586],")",["T_WHITESPACE","\n    ",586],"{",["T_WHITESPACE","\n        ",587],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","_connection",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","query",588],"(",["T_WHITESPACE","\n            ",588],["T_VARIABLE","$this",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","_connection",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","insertFromSelect",589],"(",["T_WHITESPACE","\n                ",589],["T_VARIABLE","$this",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","_prepareIndexSelect",590],"(",["T_VARIABLE","$website",590],",",["T_WHITESPACE"," ",590],["T_VARIABLE","$time",590],")",",",["T_WHITESPACE","\n                ",590],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_resource",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","getTable",591],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product_price'",591],")",["T_WHITESPACE","\n            ",591],")",["T_WHITESPACE","\n        ",592],")",";",["T_WHITESPACE","\n    ",593],"}",["T_WHITESPACE","\n\n    ",594],["T_DOC_COMMENT","\/**\n     * Reindex catalog prices by website for timestamp\n     *\n     * @param Mage_Core_Model_Website $website\n     * @param int $timestamp\n     *\/",596],["T_WHITESPACE","\n    ",601],["T_PROTECTED","protected",602],["T_WHITESPACE"," ",602],["T_FUNCTION","function",602],["T_WHITESPACE"," ",602],["T_STRING","_reindex",602],"(",["T_STRING","Mage_Core_Model_Website",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$website",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$timestamp",602],")",["T_WHITESPACE","\n    ",602],"{",["T_WHITESPACE","\n        ",603],["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","_createTemporaryTable",604],"(",")",";",["T_WHITESPACE","\n        ",604],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","_connection",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","query",605],"(",["T_WHITESPACE","\n            ",605],["T_VARIABLE","$this",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","_connection",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","insertFromSelect",606],"(",["T_WHITESPACE","\n                ",606],["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","_prepareTemporarySelect",607],"(",["T_VARIABLE","$website",607],")",",",["T_WHITESPACE","\n                ",607],["T_VARIABLE","$this",608],["T_OBJECT_OPERATOR","->",608],["T_STRING","_getTemporaryTable",608],"(",")",["T_WHITESPACE","\n            ",608],")",["T_WHITESPACE","\n        ",609],")",";",["T_WHITESPACE","\n        ",610],["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","_removeOldIndexData",611],"(",["T_VARIABLE","$website",611],")",";",["T_WHITESPACE","\n        ",611],["T_VARIABLE","$this",612],["T_OBJECT_OPERATOR","->",612],["T_STRING","_fillIndexData",612],"(",["T_VARIABLE","$website",612],",",["T_WHITESPACE"," ",612],["T_VARIABLE","$timestamp",612],")",";",["T_WHITESPACE","\n    ",612],"}",["T_WHITESPACE","\n\n    ",613],["T_DOC_COMMENT","\/**\n     * Prepare data for group website relation\n     *\/",615],["T_WHITESPACE","\n    ",617],["T_PROTECTED","protected",618],["T_WHITESPACE"," ",618],["T_FUNCTION","function",618],["T_WHITESPACE"," ",618],["T_STRING","_prepareGroupWebsite",618],"(",["T_VARIABLE","$timestamp",618],")",["T_WHITESPACE","\n    ",618],"{",["T_WHITESPACE","\n        ",619],["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","_connection",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","delete",620],"(",["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","_resource",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","getTable",620],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_group_website'",620],")",",",["T_WHITESPACE"," ",620],["T_ARRAY","array",620],"(",")",")",";",["T_WHITESPACE","\n        ",620],["T_VARIABLE","$select",621],["T_WHITESPACE"," ",621],"=",["T_WHITESPACE"," ",621],["T_VARIABLE","$this",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","_connection",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","select",621],"(",")",["T_WHITESPACE","\n            ",621],["T_OBJECT_OPERATOR","->",622],["T_STRING","distinct",622],"(",["T_STRING","true",622],")",["T_WHITESPACE","\n            ",622],["T_OBJECT_OPERATOR","->",623],["T_STRING","from",623],"(",["T_WHITESPACE","\n                ",623],["T_VARIABLE","$this",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","_resource",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","getTable",624],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product'",624],")",",",["T_WHITESPACE","\n                ",624],["T_ARRAY","array",625],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",625],",",["T_WHITESPACE"," ",625],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",625],",",["T_WHITESPACE"," ",625],["T_CONSTANT_ENCAPSED_STRING","'website_id'",625],")",["T_WHITESPACE","\n            ",625],")",["T_WHITESPACE","\n            ",626],["T_OBJECT_OPERATOR","->",627],["T_STRING","where",627],"(",["T_NEW","new",627],["T_WHITESPACE"," ",627],["T_STRING","Zend_Db_Expr",627],"(","\"",["T_CURLY_OPEN","{",627],["T_VARIABLE","$timestamp",627],"}",["T_ENCAPSED_AND_WHITESPACE"," >= from_time",627],"\"",")",")",["T_WHITESPACE","\n            ",627],["T_OBJECT_OPERATOR","->",628],["T_STRING","where",628],"(",["T_WHITESPACE","\n                ",628],["T_VARIABLE","$this",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","_connection",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","getCheckSql",629],"(",["T_WHITESPACE","\n                    ",629],["T_NEW","new",630],["T_WHITESPACE"," ",630],["T_STRING","Zend_Db_Expr",630],"(",["T_CONSTANT_ENCAPSED_STRING","'to_time = 0'",630],")",",",["T_WHITESPACE","\n                    ",630],["T_NEW","new",631],["T_WHITESPACE"," ",631],["T_STRING","Zend_Db_Expr",631],"(",["T_LNUMBER","1",631],")",",",["T_WHITESPACE","\n                    ",631],["T_NEW","new",632],["T_WHITESPACE"," ",632],["T_STRING","Zend_Db_Expr",632],"(","\"",["T_CURLY_OPEN","{",632],["T_VARIABLE","$timestamp",632],"}",["T_ENCAPSED_AND_WHITESPACE"," <= to_time",632],"\"",")",["T_WHITESPACE","\n                ",632],")",["T_WHITESPACE","\n            ",633],")",";",["T_WHITESPACE","\n        ",634],["T_VARIABLE","$query",635],["T_WHITESPACE"," ",635],"=",["T_WHITESPACE"," ",635],["T_VARIABLE","$select",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","insertFromSelect",635],"(",["T_VARIABLE","$this",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","_resource",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","getTable",635],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_group_website'",635],")",")",";",["T_WHITESPACE","\n        ",635],["T_VARIABLE","$this",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","_connection",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","query",636],"(",["T_VARIABLE","$query",636],")",";",["T_WHITESPACE","\n    ",636],"}",["T_WHITESPACE","\n\n    ",637],["T_DOC_COMMENT","\/**\n     * Return data for affected product\n     *\n     * @return null\n     *\/",639],["T_WHITESPACE","\n    ",643],["T_PROTECTED","protected",644],["T_WHITESPACE"," ",644],["T_FUNCTION","function",644],["T_WHITESPACE"," ",644],["T_STRING","_getProduct",644],"(",")",["T_WHITESPACE","\n    ",644],"{",["T_WHITESPACE","\n        ",645],["T_RETURN","return",646],["T_WHITESPACE"," ",646],["T_STRING","null",646],";",["T_WHITESPACE","\n    ",646],"}",["T_WHITESPACE","\n\n    ",647],["T_DOC_COMMENT","\/**\n     * Prepare affected product\n     *\/",649],["T_WHITESPACE","\n    ",651],["T_PROTECTED","protected",652],["T_WHITESPACE"," ",652],["T_FUNCTION","function",652],["T_WHITESPACE"," ",652],["T_STRING","_prepareAffectedProduct",652],"(",")",["T_WHITESPACE","\n    ",652],"{",["T_WHITESPACE","\n        ",653],["T_DOC_COMMENT","\/** @var $modelCondition Mage_Catalog_Model_Product_Condition *\/",654],["T_WHITESPACE","\n        ",654],["T_VARIABLE","$modelCondition",655],["T_WHITESPACE"," ",655],"=",["T_WHITESPACE"," ",655],["T_VARIABLE","$this",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","_factory",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","getModel",655],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_condition'",655],")",";",["T_WHITESPACE","\n\n        ",655],["T_VARIABLE","$productCondition",657],["T_WHITESPACE"," ",657],"=",["T_WHITESPACE"," ",657],["T_VARIABLE","$modelCondition",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","setTable",657],"(",["T_VARIABLE","$this",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","_resource",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","getTable",657],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/affected_product'",657],")",")",["T_WHITESPACE","\n            ",657],["T_OBJECT_OPERATOR","->",658],["T_STRING","setPkFieldName",658],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",658],")",";",["T_WHITESPACE","\n\n            ",658],["T_VARIABLE","$this",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","_app",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","dispatchEvent",660],"(",["T_WHITESPACE","\n                ",660],["T_CONSTANT_ENCAPSED_STRING","'catalogrule_after_apply'",661],",",["T_WHITESPACE","\n                ",661],["T_ARRAY","array",662],"(",["T_WHITESPACE","\n                    ",662],["T_CONSTANT_ENCAPSED_STRING","'product'",663],["T_WHITESPACE"," ",663],["T_DOUBLE_ARROW","=>",663],["T_WHITESPACE"," ",663],["T_VARIABLE","$this",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","_getProduct",663],"(",")",",",["T_WHITESPACE","\n                    ",663],["T_CONSTANT_ENCAPSED_STRING","'product_condition'",664],["T_WHITESPACE"," ",664],["T_DOUBLE_ARROW","=>",664],["T_WHITESPACE"," ",664],["T_VARIABLE","$productCondition",664],["T_WHITESPACE","\n                ",664],")",["T_WHITESPACE","\n            ",665],")",";",["T_WHITESPACE","\n\n        ",666],["T_VARIABLE","$this",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","_connection",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","delete",668],"(",["T_VARIABLE","$this",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","_resource",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","getTable",668],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/affected_product'",668],")",")",";",["T_WHITESPACE","\n    ",668],"}",["T_WHITESPACE","\n",669],"}",["T_WHITESPACE","\n",670]]