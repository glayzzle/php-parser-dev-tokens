[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogRule\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_COMMENT","\/* @var $installer Mage_Core_Model_Resource_Setup *\/",27],["T_WHITESPACE","\n",27],["T_VARIABLE","$installer",28],["T_WHITESPACE","           ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$this",28],";",["T_WHITESPACE","\n",28],["T_VARIABLE","$connection",29],["T_WHITESPACE","          ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$installer",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","getConnection",29],"(",")",";",["T_WHITESPACE","\n\n",29],["T_VARIABLE","$rulesTable",31],["T_WHITESPACE","          ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$installer",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","getTable",31],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",31],")",";",["T_WHITESPACE","\n",31],["T_VARIABLE","$websitesTable",32],["T_WHITESPACE","       ",32],"=",["T_WHITESPACE"," ",32],["T_VARIABLE","$installer",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","getTable",32],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/website'",32],")",";",["T_WHITESPACE","\n",32],["T_VARIABLE","$customerGroupsTable",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$installer",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","getTable",33],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",33],")",";",["T_WHITESPACE","\n",33],["T_VARIABLE","$rulesWebsitesTable",34],["T_WHITESPACE","  ",34],"=",["T_WHITESPACE"," ",34],["T_VARIABLE","$installer",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","getTable",34],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/website'",34],")",";",["T_WHITESPACE","\n",34],["T_VARIABLE","$rulesCustomerGroupsTable",35],["T_WHITESPACE","  ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$installer",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","getTable",35],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/customer_group'",35],")",";",["T_WHITESPACE","\n\n",35],["T_VARIABLE","$installer",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","startSetup",37],"(",")",";",["T_WHITESPACE","\n",37],["T_DOC_COMMENT","\/**\n * Create table 'catalogrule\/website' if not exists. This table will be used instead of\n * column website_ids of main catalog rules table\n *\/",38],["T_WHITESPACE","\n",41],["T_IF","if",42],["T_WHITESPACE"," ",42],"(","!",["T_VARIABLE","$connection",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","isTableExists",42],"(",["T_VARIABLE","$rulesWebsitesTable",42],")",")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$table",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$connection",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","newTable",43],"(",["T_VARIABLE","$rulesWebsitesTable",43],")",["T_WHITESPACE","\n        ",43],["T_OBJECT_OPERATOR","->",44],["T_STRING","addColumn",44],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",44],",",["T_WHITESPACE"," ",44],["T_STRING","Varien_Db_Ddl_Table",44],["T_DOUBLE_COLON","::",44],["T_STRING","TYPE_INTEGER",44],",",["T_WHITESPACE"," ",44],["T_STRING","null",44],",",["T_WHITESPACE"," ",44],["T_ARRAY","array",44],"(",["T_WHITESPACE","\n            ",44],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",45],["T_WHITESPACE","  ",45],["T_DOUBLE_ARROW","=>",45],["T_WHITESPACE"," ",45],["T_STRING","true",45],",",["T_WHITESPACE","\n            ",45],["T_CONSTANT_ENCAPSED_STRING","'nullable'",46],["T_WHITESPACE","  ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],["T_STRING","false",46],",",["T_WHITESPACE","\n            ",46],["T_CONSTANT_ENCAPSED_STRING","'primary'",47],["T_WHITESPACE","   ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],["T_STRING","true",47],["T_WHITESPACE","\n            ",47],")",",",["T_WHITESPACE","\n            ",48],["T_CONSTANT_ENCAPSED_STRING","'Rule Id'",49],["T_WHITESPACE","\n        ",49],")",["T_WHITESPACE","\n        ",50],["T_OBJECT_OPERATOR","->",51],["T_STRING","addColumn",51],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",51],",",["T_WHITESPACE"," ",51],["T_STRING","Varien_Db_Ddl_Table",51],["T_DOUBLE_COLON","::",51],["T_STRING","TYPE_SMALLINT",51],",",["T_WHITESPACE"," ",51],["T_STRING","null",51],",",["T_WHITESPACE"," ",51],["T_ARRAY","array",51],"(",["T_WHITESPACE","\n            ",51],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",52],["T_WHITESPACE","  ",52],["T_DOUBLE_ARROW","=>",52],["T_WHITESPACE"," ",52],["T_STRING","true",52],",",["T_WHITESPACE","\n            ",52],["T_CONSTANT_ENCAPSED_STRING","'nullable'",53],["T_WHITESPACE","  ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_STRING","false",53],",",["T_WHITESPACE","\n            ",53],["T_CONSTANT_ENCAPSED_STRING","'primary'",54],["T_WHITESPACE","   ",54],["T_DOUBLE_ARROW","=>",54],["T_WHITESPACE"," ",54],["T_STRING","true",54],["T_WHITESPACE","\n            ",54],")",",",["T_WHITESPACE","\n            ",55],["T_CONSTANT_ENCAPSED_STRING","'Website Id'",56],["T_WHITESPACE","\n        ",56],")",["T_WHITESPACE","\n        ",57],["T_OBJECT_OPERATOR","->",58],["T_STRING","addIndex",58],"(",["T_WHITESPACE","\n            ",58],["T_VARIABLE","$installer",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getIdxName",59],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/website'",59],",",["T_WHITESPACE"," ",59],["T_ARRAY","array",59],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",59],")",")",",",["T_WHITESPACE","\n            ",59],["T_ARRAY","array",60],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",60],")",["T_WHITESPACE","\n        ",60],")",["T_WHITESPACE","\n        ",61],["T_OBJECT_OPERATOR","->",62],["T_STRING","addIndex",62],"(",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$installer",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getIdxName",63],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/website'",63],",",["T_WHITESPACE"," ",63],["T_ARRAY","array",63],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",63],")",")",",",["T_WHITESPACE","\n            ",63],["T_ARRAY","array",64],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",64],")",["T_WHITESPACE","\n        ",64],")",["T_WHITESPACE","\n        ",65],["T_OBJECT_OPERATOR","->",66],["T_STRING","addForeignKey",66],"(",["T_VARIABLE","$installer",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getFkName",66],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/website'",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",66],",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",66],")",",",["T_WHITESPACE","\n            ",66],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$rulesTable",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",67],",",["T_WHITESPACE","\n            ",67],["T_STRING","Varien_Db_Ddl_Table",68],["T_DOUBLE_COLON","::",68],["T_STRING","ACTION_CASCADE",68],",",["T_WHITESPACE"," ",68],["T_STRING","Varien_Db_Ddl_Table",68],["T_DOUBLE_COLON","::",68],["T_STRING","ACTION_CASCADE",68],["T_WHITESPACE","\n        ",68],")",["T_WHITESPACE","\n        ",69],["T_OBJECT_OPERATOR","->",70],["T_STRING","addForeignKey",70],"(",["T_VARIABLE","$installer",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getFkName",70],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/website'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'website_id'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'core\/website'",70],",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'website_id'",70],")",",",["T_WHITESPACE","\n            ",70],["T_CONSTANT_ENCAPSED_STRING","'website_id'",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$websitesTable",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'website_id'",71],",",["T_WHITESPACE","\n            ",71],["T_STRING","Varien_Db_Ddl_Table",72],["T_DOUBLE_COLON","::",72],["T_STRING","ACTION_CASCADE",72],",",["T_WHITESPACE"," ",72],["T_STRING","Varien_Db_Ddl_Table",72],["T_DOUBLE_COLON","::",72],["T_STRING","ACTION_CASCADE",72],["T_WHITESPACE","\n        ",72],")",["T_WHITESPACE","\n        ",73],["T_OBJECT_OPERATOR","->",74],["T_STRING","setComment",74],"(",["T_CONSTANT_ENCAPSED_STRING","'Catalog Rules To Websites Relations'",74],")",";",["T_WHITESPACE","\n\n    ",74],["T_VARIABLE","$connection",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","createTable",76],"(",["T_VARIABLE","$table",76],")",";",["T_WHITESPACE","\n",76],"}",["T_WHITESPACE","\n\n",77],["T_DOC_COMMENT","\/**\n * Create table 'catalogrule\/customer_group' if not exists. This table will be used instead of\n * column customer_group_ids of main catalog rules table\n *\/",79],["T_WHITESPACE","\n",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(","!",["T_VARIABLE","$connection",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","isTableExists",83],"(",["T_VARIABLE","$rulesCustomerGroupsTable",83],")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n    ",83],["T_VARIABLE","$table",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$connection",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","newTable",84],"(",["T_VARIABLE","$rulesCustomerGroupsTable",84],")",["T_WHITESPACE","\n        ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","addColumn",85],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",85],",",["T_WHITESPACE"," ",85],["T_STRING","Varien_Db_Ddl_Table",85],["T_DOUBLE_COLON","::",85],["T_STRING","TYPE_INTEGER",85],",",["T_WHITESPACE"," ",85],["T_STRING","null",85],",",["T_WHITESPACE"," ",85],["T_ARRAY","array",85],"(",["T_WHITESPACE","\n            ",85],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",86],["T_WHITESPACE","  ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],["T_STRING","true",86],",",["T_WHITESPACE","\n            ",86],["T_CONSTANT_ENCAPSED_STRING","'nullable'",87],["T_WHITESPACE","  ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],["T_STRING","false",87],",",["T_WHITESPACE","\n            ",87],["T_CONSTANT_ENCAPSED_STRING","'primary'",88],["T_WHITESPACE","   ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_STRING","true",88],["T_WHITESPACE","\n            ",88],")",",",["T_WHITESPACE","\n            ",89],["T_CONSTANT_ENCAPSED_STRING","'Rule Id'",90],["T_WHITESPACE","\n        ",90],")",["T_WHITESPACE","\n        ",91],["T_OBJECT_OPERATOR","->",92],["T_STRING","addColumn",92],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",92],",",["T_WHITESPACE"," ",92],["T_STRING","Varien_Db_Ddl_Table",92],["T_DOUBLE_COLON","::",92],["T_STRING","TYPE_SMALLINT",92],",",["T_WHITESPACE"," ",92],["T_STRING","null",92],",",["T_WHITESPACE"," ",92],["T_ARRAY","array",92],"(",["T_WHITESPACE","\n            ",92],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",93],["T_WHITESPACE","  ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_STRING","true",93],",",["T_WHITESPACE","\n            ",93],["T_CONSTANT_ENCAPSED_STRING","'nullable'",94],["T_WHITESPACE","  ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_STRING","false",94],",",["T_WHITESPACE","\n            ",94],["T_CONSTANT_ENCAPSED_STRING","'primary'",95],["T_WHITESPACE","   ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_STRING","true",95],["T_WHITESPACE","\n            ",95],")",",",["T_WHITESPACE","\n            ",96],["T_CONSTANT_ENCAPSED_STRING","'Customer Group Id'",97],["T_WHITESPACE","\n        ",97],")",["T_WHITESPACE","\n        ",98],["T_OBJECT_OPERATOR","->",99],["T_STRING","addIndex",99],"(",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$installer",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getIdxName",100],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/customer_group'",100],",",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",100],")",")",",",["T_WHITESPACE","\n            ",100],["T_ARRAY","array",101],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",101],")",["T_WHITESPACE","\n        ",101],")",["T_WHITESPACE","\n        ",102],["T_OBJECT_OPERATOR","->",103],["T_STRING","addIndex",103],"(",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$installer",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getIdxName",104],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/customer_group'",104],",",["T_WHITESPACE"," ",104],["T_ARRAY","array",104],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",104],")",")",",",["T_WHITESPACE","\n            ",104],["T_ARRAY","array",105],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",105],")",["T_WHITESPACE","\n        ",105],")",["T_WHITESPACE","\n        ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","addForeignKey",107],"(",["T_VARIABLE","$installer",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getFkName",107],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/customer_group'",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",107],")",",",["T_WHITESPACE","\n            ",107],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$rulesTable",108],",",["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'rule_id'",108],",",["T_WHITESPACE","\n            ",108],["T_STRING","Varien_Db_Ddl_Table",109],["T_DOUBLE_COLON","::",109],["T_STRING","ACTION_CASCADE",109],",",["T_WHITESPACE"," ",109],["T_STRING","Varien_Db_Ddl_Table",109],["T_DOUBLE_COLON","::",109],["T_STRING","ACTION_CASCADE",109],["T_WHITESPACE","\n        ",109],")",["T_WHITESPACE","\n        ",110],["T_OBJECT_OPERATOR","->",111],["T_STRING","addForeignKey",111],"(",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$installer",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getFkName",112],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/customer_group'",112],",",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",112],",",["T_WHITESPACE","\n                ",112],["T_CONSTANT_ENCAPSED_STRING","'customer\/customer_group'",113],",",["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",113],["T_WHITESPACE","\n            ",113],")",",",["T_WHITESPACE","\n            ",114],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$customerGroupsTable",115],",",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",115],",",["T_WHITESPACE","\n            ",115],["T_STRING","Varien_Db_Ddl_Table",116],["T_DOUBLE_COLON","::",116],["T_STRING","ACTION_CASCADE",116],",",["T_WHITESPACE"," ",116],["T_STRING","Varien_Db_Ddl_Table",116],["T_DOUBLE_COLON","::",116],["T_STRING","ACTION_CASCADE",116],["T_WHITESPACE","\n        ",116],")",["T_WHITESPACE","\n        ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","setComment",118],"(",["T_CONSTANT_ENCAPSED_STRING","'Catalog Rules To Customer Groups Relations'",118],")",";",["T_WHITESPACE","\n\n    ",118],["T_VARIABLE","$connection",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","createTable",120],"(",["T_VARIABLE","$table",120],")",";",["T_WHITESPACE","\n",120],"}",["T_WHITESPACE","\n\n",121],["T_DOC_COMMENT","\/**\n * Fill out relation table 'catalogrule\/website' with website Ids\n *\/",123],["T_WHITESPACE","\n",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$connection",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","tableColumnExists",126],"(",["T_VARIABLE","$rulesTable",126],",",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'website_ids'",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n    ",126],["T_VARIABLE","$select",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$connection",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","select",127],"(",")",["T_WHITESPACE","\n        ",127],["T_OBJECT_OPERATOR","->",128],["T_STRING","from",128],"(",["T_ARRAY","array",128],"(",["T_CONSTANT_ENCAPSED_STRING","'sr'",128],["T_WHITESPACE"," ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$rulesTable",128],")",",",["T_WHITESPACE"," ",128],["T_ARRAY","array",128],"(",["T_CONSTANT_ENCAPSED_STRING","'sr.rule_id'",128],",",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",128],")",")",["T_WHITESPACE","\n        ",128],["T_OBJECT_OPERATOR","->",129],["T_STRING","join",129],"(",["T_WHITESPACE","\n            ",129],["T_ARRAY","array",130],"(",["T_CONSTANT_ENCAPSED_STRING","'cw'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$websitesTable",130],")",",",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$connection",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","prepareSqlCondition",131],"(",["T_WHITESPACE","\n                ",131],["T_CONSTANT_ENCAPSED_STRING","'sr.website_ids'",132],",",["T_WHITESPACE"," ",132],["T_ARRAY","array",132],"(",["T_CONSTANT_ENCAPSED_STRING","'finset'",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE","  ",132],["T_NEW","new",132],["T_WHITESPACE"," ",132],["T_STRING","Zend_Db_Expr",132],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",132],")",")",["T_WHITESPACE","\n            ",132],")",",",["T_WHITESPACE","\n            ",133],["T_ARRAY","array",134],"(",")",["T_WHITESPACE","\n        ",134],")",";",["T_WHITESPACE","\n    ",135],["T_VARIABLE","$query",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$select",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","insertFromSelect",136],"(",["T_VARIABLE","$rulesWebsitesTable",136],",",["T_WHITESPACE"," ",136],["T_ARRAY","array",136],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",136],",",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'website_id'",136],")",")",";",["T_WHITESPACE","\n    ",136],["T_VARIABLE","$connection",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","query",137],"(",["T_VARIABLE","$query",137],")",";",["T_WHITESPACE","\n",137],"}",["T_WHITESPACE","\n\n",138],["T_DOC_COMMENT","\/**\n * Fill out relation table 'catalogrule\/customer_group' with customer group Ids\n *\/",140],["T_WHITESPACE","\n",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$connection",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","tableColumnExists",143],"(",["T_VARIABLE","$rulesTable",143],",",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'customer_group_ids'",143],")",")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n    ",143],["T_VARIABLE","$select",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$connection",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","select",144],"(",")",["T_WHITESPACE","\n        ",144],["T_OBJECT_OPERATOR","->",145],["T_STRING","from",145],"(",["T_ARRAY","array",145],"(",["T_CONSTANT_ENCAPSED_STRING","'sr'",145],["T_WHITESPACE"," ",145],["T_DOUBLE_ARROW","=>",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$rulesTable",145],")",",",["T_WHITESPACE"," ",145],["T_ARRAY","array",145],"(",["T_CONSTANT_ENCAPSED_STRING","'sr.rule_id'",145],",",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'cg.customer_group_id'",145],")",")",["T_WHITESPACE","\n        ",145],["T_OBJECT_OPERATOR","->",146],["T_STRING","join",146],"(",["T_WHITESPACE","\n            ",146],["T_ARRAY","array",147],"(",["T_CONSTANT_ENCAPSED_STRING","'cg'",147],["T_WHITESPACE"," ",147],["T_DOUBLE_ARROW","=>",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$customerGroupsTable",147],")",",",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$connection",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","prepareSqlCondition",148],"(",["T_WHITESPACE","\n                ",148],["T_CONSTANT_ENCAPSED_STRING","'sr.customer_group_ids'",149],",",["T_WHITESPACE"," ",149],["T_ARRAY","array",149],"(",["T_CONSTANT_ENCAPSED_STRING","'finset'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE","  ",149],["T_NEW","new",149],["T_WHITESPACE"," ",149],["T_STRING","Zend_Db_Expr",149],"(",["T_CONSTANT_ENCAPSED_STRING","'cg.customer_group_id'",149],")",")",["T_WHITESPACE","\n            ",149],")",",",["T_WHITESPACE","\n            ",150],["T_ARRAY","array",151],"(",")",["T_WHITESPACE","\n        ",151],")",";",["T_WHITESPACE","\n    ",152],["T_VARIABLE","$query",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$select",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","insertFromSelect",153],"(",["T_VARIABLE","$rulesCustomerGroupsTable",153],",",["T_WHITESPACE"," ",153],["T_ARRAY","array",153],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",153],",",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",153],")",")",";",["T_WHITESPACE","\n    ",153],["T_VARIABLE","$connection",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","query",154],"(",["T_VARIABLE","$query",154],")",";",["T_WHITESPACE","\n",154],"}",["T_WHITESPACE","\n\n",155],["T_DOC_COMMENT","\/**\n * Eliminate obsolete columns\n *\/",157],["T_WHITESPACE","\n",159],["T_VARIABLE","$connection",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","dropColumn",160],"(",["T_VARIABLE","$rulesTable",160],",",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'website_ids'",160],")",";",["T_WHITESPACE","\n",160],["T_VARIABLE","$connection",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","dropColumn",161],"(",["T_VARIABLE","$rulesTable",161],",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'customer_group_ids'",161],")",";",["T_WHITESPACE","\n\n",161],["T_VARIABLE","$installer",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","endSetup",163],"(",")",";",["T_WHITESPACE","\n",163]]