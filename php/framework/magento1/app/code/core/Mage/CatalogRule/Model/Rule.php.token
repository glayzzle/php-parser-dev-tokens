[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogRule\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog Rule data model\n *\n * @method Mage_CatalogRule_Model_Resource_Rule _getResource()\n * @method Mage_CatalogRule_Model_Resource_Rule getResource()\n * @method string getName()\n * @method Mage_CatalogRule_Model_Rule setName(string $value)\n * @method string getDescription()\n * @method Mage_CatalogRule_Model_Rule setDescription(string $value)\n * @method string getFromDate()\n * @method Mage_CatalogRule_Model_Rule setFromDate(string $value)\n * @method string getToDate()\n * @method Mage_CatalogRule_Model_Rule setToDate(string $value)\n * @method Mage_CatalogRule_Model_Rule setCustomerGroupIds(string $value)\n * @method int getIsActive()\n * @method Mage_CatalogRule_Model_Rule setIsActive(int $value)\n * @method string getConditionsSerialized()\n * @method Mage_CatalogRule_Model_Rule setConditionsSerialized(string $value)\n * @method string getActionsSerialized()\n * @method Mage_CatalogRule_Model_Rule setActionsSerialized(string $value)\n * @method int getStopRulesProcessing()\n * @method Mage_CatalogRule_Model_Rule setStopRulesProcessing(int $value)\n * @method int getSortOrder()\n * @method Mage_CatalogRule_Model_Rule setSortOrder(int $value)\n * @method string getSimpleAction()\n * @method Mage_CatalogRule_Model_Rule setSimpleAction(string $value)\n * @method float getDiscountAmount()\n * @method Mage_CatalogRule_Model_Rule setDiscountAmount(float $value)\n * @method string getWebsiteIds()\n * @method Mage_CatalogRule_Model_Rule setWebsiteIds(string $value)\n *\n * @category    Mage\n * @package     Mage_CatalogRule\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",62],["T_CLASS","class",63],["T_WHITESPACE"," ",63],["T_STRING","Mage_CatalogRule_Model_Rule",63],["T_WHITESPACE"," ",63],["T_EXTENDS","extends",63],["T_WHITESPACE"," ",63],["T_STRING","Mage_Rule_Model_Abstract",63],["T_WHITESPACE","\n",63],"{",["T_WHITESPACE","\n    ",64],["T_DOC_COMMENT","\/**\n     * Related cache types config path\n     *\/",65],["T_WHITESPACE","\n    ",67],["T_CONST","const",68],["T_WHITESPACE"," ",68],["T_STRING","XML_NODE_RELATED_CACHE",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'global\/catalogrule\/related_cache_types'",68],";",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Prefix of model events names\n     *\n     * @var string\n     *\/",70],["T_WHITESPACE","\n    ",74],["T_PROTECTED","protected",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$_eventPrefix",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'catalogrule_rule'",75],";",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Parameter name in event\n     *\n     * In observe method you can use $observer->getEvent()->getRule() in this case\n     *\n     * @var string\n     *\/",77],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$_eventObject",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'rule'",84],";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Store matched product Ids\n     *\n     * @var array\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$_productIds",91],";",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Limitation for products collection\n     *\n     * @var int|array|null\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PROTECTED","protected",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$_productsFilter",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","null",98],";",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Store current date at \"Y-m-d H:i:s\" format\n     *\n     * @var string\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$_now",105],";",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Cached data of prices calculated by price rules\n     *\n     * @var array\n     *\/",107],["T_WHITESPACE","\n    ",111],["T_PROTECTED","protected",112],["T_WHITESPACE"," ",112],["T_STATIC","static",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$_priceRulesData",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_ARRAY","array",112],"(",")",";",["T_WHITESPACE","\n\n    ",112],["T_DOC_COMMENT","\/**\n     * Factory instance\n     *\n     * @var Mage_Core_Model_Factory\n     *\/",114],["T_WHITESPACE","\n    ",118],["T_PROTECTED","protected",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$_factory",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","null",119],";",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Configuration object\n     *\n     * @var Mage_Core_Model_Config\n     *\/",121],["T_WHITESPACE","\n    ",125],["T_PROTECTED","protected",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$_config",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","null",126],";",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Configuration object\n     *\n     * @var Mage_Core_Model_App\n     *\/",128],["T_WHITESPACE","\n    ",132],["T_PROTECTED","protected",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$_app",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","null",133],";",["T_WHITESPACE","\n\n    ",133],["T_DOC_COMMENT","\/**\n     * Constructor with parameters\n     * Array of arguments with keys\n     *  - 'factory' Mage_Core_Model_Factory\n     *  - 'config' Mage_Core_Model_Config\n     *  - 'app' Mage_Core_Model_App\n     *\n     * @param array $args\n     *\/",135],["T_WHITESPACE","\n    ",143],["T_PUBLIC","public",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","__construct",144],"(",["T_ARRAY","array",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$args",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_ARRAY","array",144],"(",")",")",["T_WHITESPACE","\n    ",144],"{",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_factory",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],"!",["T_EMPTY","empty",146],"(",["T_VARIABLE","$args",146],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",146],"]",")",["T_WHITESPACE"," ",146],"?",["T_WHITESPACE"," ",146],["T_VARIABLE","$args",146],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",146],"]",["T_WHITESPACE"," ",146],":",["T_WHITESPACE"," ",146],["T_STRING","Mage",146],["T_DOUBLE_COLON","::",146],["T_STRING","getSingleton",146],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/factory'",146],")",";",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_config",147],["T_WHITESPACE","  ",147],"=",["T_WHITESPACE"," ",147],"!",["T_EMPTY","empty",147],"(",["T_VARIABLE","$args",147],"[",["T_CONSTANT_ENCAPSED_STRING","'config'",147],"]",")",["T_WHITESPACE"," ",147],"?",["T_WHITESPACE"," ",147],["T_VARIABLE","$args",147],"[",["T_CONSTANT_ENCAPSED_STRING","'config'",147],"]",["T_WHITESPACE"," ",147],":",["T_WHITESPACE"," ",147],["T_STRING","Mage",147],["T_DOUBLE_COLON","::",147],["T_STRING","getConfig",147],"(",")",";",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_app",148],["T_WHITESPACE","     ",148],"=",["T_WHITESPACE"," ",148],"!",["T_EMPTY","empty",148],"(",["T_VARIABLE","$args",148],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",148],"]",")",["T_WHITESPACE"," ",148],"?",["T_WHITESPACE"," ",148],["T_VARIABLE","$args",148],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",148],"]",["T_WHITESPACE"," ",148],":",["T_WHITESPACE"," ",148],["T_STRING","Mage",148],["T_DOUBLE_COLON","::",148],["T_STRING","app",148],"(",")",";",["T_WHITESPACE","\n\n        ",148],["T_STRING","parent",150],["T_DOUBLE_COLON","::",150],["T_STRING","__construct",150],"(",")",";",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Init resource model and id field\n     *\/",153],["T_WHITESPACE","\n    ",155],["T_PROTECTED","protected",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","_construct",156],"(",")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_STRING","parent",158],["T_DOUBLE_COLON","::",158],["T_STRING","_construct",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_init",159],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",159],")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","setIdFieldName",160],"(",["T_CONSTANT_ENCAPSED_STRING","'rule_id'",160],")",";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Getter for rule conditions collection\n     *\n     * @return Mage_CatalogRule_Model_Rule_Condition_Combine\n     *\/",163],["T_WHITESPACE","\n    ",167],["T_PUBLIC","public",168],["T_WHITESPACE"," ",168],["T_FUNCTION","function",168],["T_WHITESPACE"," ",168],["T_STRING","getConditionsInstance",168],"(",")",["T_WHITESPACE","\n    ",168],"{",["T_WHITESPACE","\n        ",169],["T_RETURN","return",170],["T_WHITESPACE"," ",170],["T_STRING","Mage",170],["T_DOUBLE_COLON","::",170],["T_STRING","getModel",170],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_condition_combine'",170],")",";",["T_WHITESPACE","\n    ",170],"}",["T_WHITESPACE","\n\n    ",171],["T_DOC_COMMENT","\/**\n     * Getter for rule actions collection\n     *\n     * @return Mage_CatalogRule_Model_Rule_Action_Collection\n     *\/",173],["T_WHITESPACE","\n    ",177],["T_PUBLIC","public",178],["T_WHITESPACE"," ",178],["T_FUNCTION","function",178],["T_WHITESPACE"," ",178],["T_STRING","getActionsInstance",178],"(",")",["T_WHITESPACE","\n    ",178],"{",["T_WHITESPACE","\n        ",179],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_STRING","Mage",180],["T_DOUBLE_COLON","::",180],["T_STRING","getModel",180],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_action_collection'",180],")",";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n\n    ",181],["T_DOC_COMMENT","\/**\n     * Get catalog rule customer group Ids\n     *\n     * @return array\n     *\/",183],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","getCustomerGroupIds",188],"(",")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","hasCustomerGroupIds",190],"(",")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$customerGroupIds",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_getResource",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","getCustomerGroupIds",191],"(",["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getId",191],"(",")",")",";",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","setData",192],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_ids'",192],",",["T_WHITESPACE"," ",192],["T_ARRAY_CAST","(array)",192],["T_VARIABLE","$customerGroupIds",192],")",";",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n        ",193],["T_RETURN","return",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_getData",194],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_ids'",194],")",";",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Retrieve current date for current rule\n     *\n     * @return string\n     *\/",197],["T_WHITESPACE","\n    ",201],["T_PUBLIC","public",202],["T_WHITESPACE"," ",202],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","getNow",202],"(",")",["T_WHITESPACE","\n    ",202],"{",["T_WHITESPACE","\n        ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(","!",["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_now",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_RETURN","return",205],["T_WHITESPACE"," ",205],["T_STRING","now",205],"(",")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n        ",206],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_now",207],";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n\n    ",208],["T_DOC_COMMENT","\/**\n     * Set current date for current rule\n     *\n     * @param string $now\n     *\/",210],["T_WHITESPACE","\n    ",214],["T_PUBLIC","public",215],["T_WHITESPACE"," ",215],["T_FUNCTION","function",215],["T_WHITESPACE"," ",215],["T_STRING","setNow",215],"(",["T_VARIABLE","$now",215],")",["T_WHITESPACE","\n    ",215],"{",["T_WHITESPACE","\n        ",216],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_now",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$now",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n\n    ",218],["T_DOC_COMMENT","\/**\n     * Get array of product ids which are matched by rule\n     *\n     * @return array\n     *\/",220],["T_WHITESPACE","\n    ",224],["T_PUBLIC","public",225],["T_WHITESPACE"," ",225],["T_FUNCTION","function",225],["T_WHITESPACE"," ",225],["T_STRING","getMatchingProductIds",225],"(",")",["T_WHITESPACE","\n    ",225],"{",["T_WHITESPACE","\n        ",226],["T_IF","if",227],["T_WHITESPACE"," ",227],"(",["T_STRING","is_null",227],"(",["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_productIds",227],")",")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_productIds",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_ARRAY","array",228],"(",")",";",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","setCollectedAttributes",229],"(",["T_ARRAY","array",229],"(",")",")",";",["T_WHITESPACE","\n\n            ",229],["T_IF","if",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getWebsiteIds",231],"(",")",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n                ",231],["T_DOC_COMMENT","\/** @var $productCollection Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Collection *\/",232],["T_WHITESPACE","\n                ",232],["T_VARIABLE","$productCollection",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_STRING","Mage",233],["T_DOUBLE_COLON","::",233],["T_STRING","getResourceModel",233],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_collection'",233],")",";",["T_WHITESPACE","\n                ",233],["T_VARIABLE","$productCollection",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","addWebsiteFilter",234],"(",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getWebsiteIds",234],"(",")",")",";",["T_WHITESPACE","\n                ",234],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_productsFilter",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n                    ",235],["T_VARIABLE","$productCollection",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","addIdFilter",236],"(",["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_productsFilter",236],")",";",["T_WHITESPACE","\n                ",236],"}",["T_WHITESPACE","\n                ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getConditions",238],"(",")",["T_OBJECT_OPERATOR","->",238],["T_STRING","collectValidatedAttributes",238],"(",["T_VARIABLE","$productCollection",238],")",";",["T_WHITESPACE","\n\n                ",238],["T_STRING","Mage",240],["T_DOUBLE_COLON","::",240],["T_STRING","getSingleton",240],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource_iterator'",240],")",["T_OBJECT_OPERATOR","->",240],["T_STRING","walk",240],"(",["T_WHITESPACE","\n                    ",240],["T_VARIABLE","$productCollection",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getSelect",241],"(",")",",",["T_WHITESPACE","\n                    ",241],["T_ARRAY","array",242],"(",["T_ARRAY","array",242],"(",["T_VARIABLE","$this",242],",",["T_WHITESPACE"," ",242],["T_CONSTANT_ENCAPSED_STRING","'callbackValidateProduct'",242],")",")",",",["T_WHITESPACE","\n                    ",242],["T_ARRAY","array",243],"(",["T_WHITESPACE","\n                        ",243],["T_CONSTANT_ENCAPSED_STRING","'attributes'",244],["T_WHITESPACE"," ",244],["T_DOUBLE_ARROW","=>",244],["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getCollectedAttributes",244],"(",")",",",["T_WHITESPACE","\n                        ",244],["T_CONSTANT_ENCAPSED_STRING","'product'",245],["T_WHITESPACE","    ",245],["T_DOUBLE_ARROW","=>",245],["T_WHITESPACE"," ",245],["T_STRING","Mage",245],["T_DOUBLE_COLON","::",245],["T_STRING","getModel",245],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",245],")",",",["T_WHITESPACE","\n                    ",245],")",["T_WHITESPACE","\n                ",246],")",";",["T_WHITESPACE","\n            ",247],"}",["T_WHITESPACE","\n        ",248],"}",["T_WHITESPACE","\n\n        ",249],["T_RETURN","return",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","_productIds",251],";",["T_WHITESPACE","\n    ",251],"}",["T_WHITESPACE","\n\n    ",252],["T_DOC_COMMENT","\/**\n     * Callback function for product matching\n     *\n     * @param $args\n     * @return void\n     *\/",254],["T_WHITESPACE","\n    ",259],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","callbackValidateProduct",260],"(",["T_VARIABLE","$args",260],")",["T_WHITESPACE","\n    ",260],"{",["T_WHITESPACE","\n        ",261],["T_VARIABLE","$product",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_CLONE","clone",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$args",262],"[",["T_CONSTANT_ENCAPSED_STRING","'product'",262],"]",";",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$product",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","setData",263],"(",["T_VARIABLE","$args",263],"[",["T_CONSTANT_ENCAPSED_STRING","'row'",263],"]",")",";",["T_WHITESPACE","\n\n        ",263],["T_VARIABLE","$results",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",")",";",["T_WHITESPACE","\n        ",265],["T_FOREACH","foreach",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","_getWebsitesMap",266],"(",")",["T_WHITESPACE"," ",266],["T_AS","as",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$websiteId",266],["T_WHITESPACE"," ",266],["T_DOUBLE_ARROW","=>",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$defaultStoreId",266],")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_VARIABLE","$product",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","setStoreId",267],"(",["T_VARIABLE","$defaultStoreId",267],")",";",["T_WHITESPACE","\n            ",267],["T_VARIABLE","$results",268],"[",["T_VARIABLE","$websiteId",268],"]",["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_INT_CAST","(int)",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getConditions",268],"(",")",["T_OBJECT_OPERATOR","->",268],["T_STRING","validate",268],"(",["T_VARIABLE","$product",268],")",";",["T_WHITESPACE","\n        ",268],"}",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_productIds",270],"[",["T_VARIABLE","$product",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getId",270],"(",")","]",["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$results",270],";",["T_WHITESPACE","\n    ",270],"}",["T_WHITESPACE","\n\n    ",271],["T_DOC_COMMENT","\/**\n     * Prepare website to default assigned store map\n     *\n     * @return array\n     *\/",273],["T_WHITESPACE","\n    ",277],["T_PROTECTED","protected",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","_getWebsitesMap",278],"(",")",["T_WHITESPACE","\n    ",278],"{",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$map",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_ARRAY","array",280],"(",")",";",["T_WHITESPACE","\n        ",280],["T_FOREACH","foreach",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","_app",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getWebsites",281],"(",["T_STRING","true",281],")",["T_WHITESPACE"," ",281],["T_AS","as",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$website",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n            ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$website",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getDefaultStore",282],"(",")",")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n                ",282],["T_VARIABLE","$map",283],"[",["T_VARIABLE","$website",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getId",283],"(",")","]",["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$website",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getDefaultStore",283],"(",")",["T_OBJECT_OPERATOR","->",283],["T_STRING","getId",283],"(",")",";",["T_WHITESPACE","\n            ",283],"}",["T_WHITESPACE","\n        ",284],"}",["T_WHITESPACE","\n        ",285],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$map",286],";",["T_WHITESPACE","\n    ",286],"}",["T_WHITESPACE","\n\n    ",287],["T_DOC_COMMENT","\/**\n     * Apply rule to product\n     *\n     * @param int|Mage_Catalog_Model_Product $product\n     * @param array|null $websiteIds\n     *\n     * @return void\n     *\/",289],["T_WHITESPACE","\n    ",296],["T_PUBLIC","public",297],["T_WHITESPACE"," ",297],["T_FUNCTION","function",297],["T_WHITESPACE"," ",297],["T_STRING","applyToProduct",297],"(",["T_VARIABLE","$product",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$websiteIds",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_STRING","null",297],")",["T_WHITESPACE","\n    ",297],"{",["T_WHITESPACE","\n        ",298],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_STRING","is_numeric",299],"(",["T_VARIABLE","$product",299],")",")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n            ",299],["T_VARIABLE","$product",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","_factory",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getModel",300],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",300],")",["T_OBJECT_OPERATOR","->",300],["T_STRING","load",300],"(",["T_VARIABLE","$product",300],")",";",["T_WHITESPACE","\n        ",300],"}",["T_WHITESPACE","\n        ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_STRING","is_null",302],"(",["T_VARIABLE","$websiteIds",302],")",")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$websiteIds",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getWebsiteIds",303],"(",")",";",["T_WHITESPACE","\n        ",303],"}",["T_WHITESPACE","\n        ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getResource",305],"(",")",["T_OBJECT_OPERATOR","->",305],["T_STRING","applyToProduct",305],"(",["T_VARIABLE","$this",305],",",["T_WHITESPACE"," ",305],["T_VARIABLE","$product",305],",",["T_WHITESPACE"," ",305],["T_VARIABLE","$websiteIds",305],")",";",["T_WHITESPACE","\n        ",305],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getResource",306],"(",")",["T_OBJECT_OPERATOR","->",306],["T_STRING","applyAllRules",306],"(",["T_VARIABLE","$product",306],")",";",["T_WHITESPACE","\n        ",306],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_invalidateCache",307],"(",")",";",["T_WHITESPACE","\n    ",307],"}",["T_WHITESPACE","\n\n    ",308],["T_DOC_COMMENT","\/**\n     * Apply all price rules, invalidate related cache and refresh price index\n     *\n     * @return Mage_CatalogRule_Model_Rule\n     *\/",310],["T_WHITESPACE","\n    ",314],["T_PUBLIC","public",315],["T_WHITESPACE"," ",315],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","applyAll",315],"(",")",["T_WHITESPACE","\n    ",315],"{",["T_WHITESPACE","\n        ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getResourceCollection",317],"(",")",["T_OBJECT_OPERATOR","->",317],["T_STRING","walk",317],"(",["T_ARRAY","array",317],"(",["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_getResource",317],"(",")",",",["T_WHITESPACE"," ",317],["T_CONSTANT_ENCAPSED_STRING","'updateRuleProductData'",317],")",")",";",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","_getResource",318],"(",")",["T_OBJECT_OPERATOR","->",318],["T_STRING","applyAllRules",318],"(",")",";",["T_WHITESPACE","\n        ",318],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_invalidateCache",319],"(",")",";",["T_WHITESPACE","\n        ",319],["T_VARIABLE","$indexProcess",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_STRING","Mage",320],["T_DOUBLE_COLON","::",320],["T_STRING","getSingleton",320],"(",["T_CONSTANT_ENCAPSED_STRING","'index\/indexer'",320],")",["T_OBJECT_OPERATOR","->",320],["T_STRING","getProcessByCode",320],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog_product_price'",320],")",";",["T_WHITESPACE","\n        ",320],["T_IF","if",321],["T_WHITESPACE"," ",321],"(",["T_VARIABLE","$indexProcess",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_VARIABLE","$indexProcess",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","reindexAll",322],"(",")",";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE","\n    ",323],"}",["T_WHITESPACE","\n\n    ",324],["T_DOC_COMMENT","\/**\n     * Apply all price rules to product\n     *\n     * @param  int|Mage_Catalog_Model_Product $product\n     * @return Mage_CatalogRule_Model_Rule\n     *\/",326],["T_WHITESPACE","\n    ",331],["T_PUBLIC","public",332],["T_WHITESPACE"," ",332],["T_FUNCTION","function",332],["T_WHITESPACE"," ",332],["T_STRING","applyAllRulesToProduct",332],"(",["T_VARIABLE","$product",332],")",["T_WHITESPACE","\n    ",332],"{",["T_WHITESPACE","\n        ",333],["T_IF","if",334],["T_WHITESPACE"," ",334],"(",["T_STRING","is_numeric",334],"(",["T_VARIABLE","$product",334],")",")",["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n            ",334],["T_DOC_COMMENT","\/** @var $product Mage_Catalog_Model_Product *\/",335],["T_WHITESPACE","\n            ",335],["T_VARIABLE","$product",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_STRING","Mage",336],["T_DOUBLE_COLON","::",336],["T_STRING","getModel",336],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",336],")",["T_OBJECT_OPERATOR","->",336],["T_STRING","load",336],"(",["T_VARIABLE","$product",336],")",";",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE","\n\n        ",337],["T_VARIABLE","$productWebsiteIds",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_VARIABLE","$product",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getWebsiteIds",339],"(",")",";",["T_WHITESPACE","\n\n        ",339],["T_DOC_COMMENT","\/** @var $rules Mage_CatalogRule_Model_Resource_Rule_Collection *\/",341],["T_WHITESPACE","\n        ",341],["T_VARIABLE","$rules",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_STRING","Mage",342],["T_DOUBLE_COLON","::",342],["T_STRING","getModel",342],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule'",342],")",["T_OBJECT_OPERATOR","->",342],["T_STRING","getCollection",342],"(",")",["T_WHITESPACE","\n            ",342],["T_OBJECT_OPERATOR","->",343],["T_STRING","addFieldToFilter",343],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active'",343],",",["T_WHITESPACE"," ",343],["T_LNUMBER","1",343],")",";",["T_WHITESPACE","\n        ",343],["T_FOREACH","foreach",344],["T_WHITESPACE"," ",344],"(",["T_VARIABLE","$rules",344],["T_WHITESPACE"," ",344],["T_AS","as",344],["T_WHITESPACE"," ",344],["T_VARIABLE","$rule",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n            ",344],["T_VARIABLE","$websiteIds",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_STRING","array_intersect",345],"(",["T_VARIABLE","$productWebsiteIds",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$rule",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getWebsiteIds",345],"(",")",")",";",["T_WHITESPACE","\n            ",345],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getResource",346],"(",")",["T_OBJECT_OPERATOR","->",346],["T_STRING","applyToProduct",346],"(",["T_VARIABLE","$rule",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$product",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$websiteIds",346],")",";",["T_WHITESPACE","\n        ",346],"}",["T_WHITESPACE","\n\n        ",347],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getResource",349],"(",")",["T_OBJECT_OPERATOR","->",349],["T_STRING","applyAllRules",349],"(",["T_VARIABLE","$product",349],")",";",["T_WHITESPACE","\n        ",349],["T_VARIABLE","$this",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","_invalidateCache",350],"(",")",";",["T_WHITESPACE","\n\n        ",350],["T_STRING","Mage",352],["T_DOUBLE_COLON","::",352],["T_STRING","getSingleton",352],"(",["T_CONSTANT_ENCAPSED_STRING","'index\/indexer'",352],")",["T_OBJECT_OPERATOR","->",352],["T_STRING","processEntityAction",352],"(",["T_WHITESPACE","\n            ",352],["T_NEW","new",353],["T_WHITESPACE"," ",353],["T_STRING","Varien_Object",353],"(",["T_ARRAY","array",353],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",353],["T_WHITESPACE"," ",353],["T_DOUBLE_ARROW","=>",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$product",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getId",353],"(",")",")",")",",",["T_WHITESPACE","\n            ",353],["T_STRING","Mage_Catalog_Model_Product",354],["T_DOUBLE_COLON","::",354],["T_STRING","ENTITY",354],",",["T_WHITESPACE","\n            ",354],["T_STRING","Mage_Catalog_Model_Product_Indexer_Price",355],["T_DOUBLE_COLON","::",355],["T_STRING","EVENT_TYPE_REINDEX_PRICE",355],["T_WHITESPACE","\n        ",355],")",";",["T_WHITESPACE","\n\n        ",356],["T_RETURN","return",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$this",358],";",["T_WHITESPACE","\n    ",358],"}",["T_WHITESPACE","\n\n    ",359],["T_DOC_COMMENT","\/**\n     * Calculate price using catalog price rule of product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param float $price\n     * @return float|null\n     *\/",361],["T_WHITESPACE","\n    ",367],["T_PUBLIC","public",368],["T_WHITESPACE"," ",368],["T_FUNCTION","function",368],["T_WHITESPACE"," ",368],["T_STRING","calcProductPriceRule",368],"(",["T_STRING","Mage_Catalog_Model_Product",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$product",368],",",["T_WHITESPACE"," ",368],["T_VARIABLE","$price",368],")",["T_WHITESPACE","\n    ",368],"{",["T_WHITESPACE","\n        ",369],["T_VARIABLE","$priceRules",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_STRING","null",370],";",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$productId",371],["T_WHITESPACE","  ",371],"=",["T_WHITESPACE"," ",371],["T_VARIABLE","$product",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getId",371],"(",")",";",["T_WHITESPACE","\n        ",371],["T_VARIABLE","$storeId",372],["T_WHITESPACE","    ",372],"=",["T_WHITESPACE"," ",372],["T_VARIABLE","$product",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getStoreId",372],"(",")",";",["T_WHITESPACE","\n        ",372],["T_VARIABLE","$websiteId",373],["T_WHITESPACE","  ",373],"=",["T_WHITESPACE"," ",373],["T_STRING","Mage",373],["T_DOUBLE_COLON","::",373],["T_STRING","app",373],"(",")",["T_OBJECT_OPERATOR","->",373],["T_STRING","getStore",373],"(",["T_VARIABLE","$storeId",373],")",["T_OBJECT_OPERATOR","->",373],["T_STRING","getWebsiteId",373],"(",")",";",["T_WHITESPACE","\n        ",373],["T_IF","if",374],["T_WHITESPACE"," ",374],"(",["T_VARIABLE","$product",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","hasCustomerGroupId",374],"(",")",")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n            ",374],["T_VARIABLE","$customerGroupId",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$product",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getCustomerGroupId",375],"(",")",";",["T_WHITESPACE","\n        ",375],"}",["T_WHITESPACE"," ",376],["T_ELSE","else",376],["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$customerGroupId",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_STRING","Mage",377],["T_DOUBLE_COLON","::",377],["T_STRING","getSingleton",377],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",377],")",["T_OBJECT_OPERATOR","->",377],["T_STRING","getCustomerGroupId",377],"(",")",";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE","\n        ",378],["T_VARIABLE","$dateTs",379],["T_WHITESPACE","     ",379],"=",["T_WHITESPACE"," ",379],["T_STRING","Mage",379],["T_DOUBLE_COLON","::",379],["T_STRING","app",379],"(",")",["T_OBJECT_OPERATOR","->",379],["T_STRING","getLocale",379],"(",")",["T_OBJECT_OPERATOR","->",379],["T_STRING","date",379],"(",")",["T_OBJECT_OPERATOR","->",379],["T_STRING","getTimestamp",379],"(",")",";",["T_WHITESPACE","\n        ",379],["T_VARIABLE","$cacheKey",380],["T_WHITESPACE","   ",380],"=",["T_WHITESPACE"," ",380],["T_STRING","date",380],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d'",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$dateTs",380],")",["T_WHITESPACE"," ",380],".",["T_WHITESPACE"," ",380],"\"",["T_ENCAPSED_AND_WHITESPACE","|",380],["T_VARIABLE","$websiteId",380],["T_ENCAPSED_AND_WHITESPACE","|",380],["T_VARIABLE","$customerGroupId",380],["T_ENCAPSED_AND_WHITESPACE","|",380],["T_VARIABLE","$productId",380],["T_ENCAPSED_AND_WHITESPACE","|",380],["T_VARIABLE","$price",380],"\"",";",["T_WHITESPACE","\n\n        ",380],["T_IF","if",382],["T_WHITESPACE"," ",382],"(","!",["T_STRING","array_key_exists",382],"(",["T_VARIABLE","$cacheKey",382],",",["T_WHITESPACE"," ",382],["T_STRING","self",382],["T_DOUBLE_COLON","::",382],["T_VARIABLE","$_priceRulesData",382],")",")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_VARIABLE","$rulesData",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","_getResource",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","getRulesFromProduct",383],"(",["T_VARIABLE","$dateTs",383],",",["T_WHITESPACE"," ",383],["T_VARIABLE","$websiteId",383],",",["T_WHITESPACE"," ",383],["T_VARIABLE","$customerGroupId",383],",",["T_WHITESPACE"," ",383],["T_VARIABLE","$productId",383],")",";",["T_WHITESPACE","\n            ",383],["T_IF","if",384],["T_WHITESPACE"," ",384],"(",["T_VARIABLE","$rulesData",384],")",["T_WHITESPACE"," ",384],"{",["T_WHITESPACE","\n                ",384],["T_FOREACH","foreach",385],["T_WHITESPACE"," ",385],"(",["T_VARIABLE","$rulesData",385],["T_WHITESPACE"," ",385],["T_AS","as",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$ruleData",385],")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n                    ",385],["T_IF","if",386],["T_WHITESPACE"," ",386],"(",["T_VARIABLE","$product",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getParentId",386],"(",")",")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n                        ",386],["T_IF","if",387],["T_WHITESPACE"," ",387],"(","!",["T_EMPTY","empty",387],"(",["T_VARIABLE","$ruleData",387],"[",["T_CONSTANT_ENCAPSED_STRING","'sub_simple_action'",387],"]",")",")",["T_WHITESPACE"," ",387],"{",["T_WHITESPACE","\n                            ",387],["T_VARIABLE","$priceRules",388],["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_STRING","Mage",388],["T_DOUBLE_COLON","::",388],["T_STRING","helper",388],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",388],")",["T_OBJECT_OPERATOR","->",388],["T_STRING","calcPriceRule",388],"(",["T_WHITESPACE","\n                                ",388],["T_VARIABLE","$ruleData",389],"[",["T_CONSTANT_ENCAPSED_STRING","'sub_simple_action'",389],"]",",",["T_WHITESPACE","\n                                ",389],["T_VARIABLE","$ruleData",390],"[",["T_CONSTANT_ENCAPSED_STRING","'sub_discount_amount'",390],"]",",",["T_WHITESPACE","\n                                ",390],["T_VARIABLE","$priceRules",391],["T_WHITESPACE"," ",391],"?",["T_WHITESPACE"," ",391],["T_VARIABLE","$priceRules",391],["T_WHITESPACE"," ",391],":",["T_WHITESPACE"," ",391],["T_VARIABLE","$price",391],["T_WHITESPACE","\n                            ",391],")",";",["T_WHITESPACE","\n                        ",392],"}",["T_WHITESPACE"," ",393],["T_ELSE","else",393],["T_WHITESPACE"," ",393],"{",["T_WHITESPACE","\n                            ",393],["T_VARIABLE","$priceRules",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],"(",["T_VARIABLE","$priceRules",394],["T_WHITESPACE"," ",394],"?",["T_WHITESPACE"," ",394],["T_VARIABLE","$priceRules",394],["T_WHITESPACE"," ",394],":",["T_WHITESPACE"," ",394],["T_VARIABLE","$price",394],")",";",["T_WHITESPACE","\n                        ",394],"}",["T_WHITESPACE","\n                        ",395],["T_IF","if",396],["T_WHITESPACE"," ",396],"(",["T_VARIABLE","$ruleData",396],"[",["T_CONSTANT_ENCAPSED_STRING","'action_stop'",396],"]",")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n                            ",396],["T_BREAK","break",397],";",["T_WHITESPACE","\n                        ",397],"}",["T_WHITESPACE","\n                    ",398],"}",["T_WHITESPACE"," ",399],["T_ELSE","else",399],["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n                        ",399],["T_VARIABLE","$priceRules",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_STRING","Mage",400],["T_DOUBLE_COLON","::",400],["T_STRING","helper",400],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule'",400],")",["T_OBJECT_OPERATOR","->",400],["T_STRING","calcPriceRule",400],"(",["T_WHITESPACE","\n                            ",400],["T_VARIABLE","$ruleData",401],"[",["T_CONSTANT_ENCAPSED_STRING","'action_operator'",401],"]",",",["T_WHITESPACE","\n                            ",401],["T_VARIABLE","$ruleData",402],"[",["T_CONSTANT_ENCAPSED_STRING","'action_amount'",402],"]",",",["T_WHITESPACE","\n                            ",402],["T_VARIABLE","$priceRules",403],["T_WHITESPACE"," ",403],"?",["T_WHITESPACE"," ",403],["T_VARIABLE","$priceRules",403],["T_WHITESPACE"," ",403],":",["T_WHITESPACE"," ",403],["T_VARIABLE","$price",403],["T_WHITESPACE","\n                        ",403],")",";",["T_WHITESPACE","\n                        ",404],["T_IF","if",405],["T_WHITESPACE"," ",405],"(",["T_VARIABLE","$ruleData",405],"[",["T_CONSTANT_ENCAPSED_STRING","'action_stop'",405],"]",")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n                            ",405],["T_BREAK","break",406],";",["T_WHITESPACE","\n                        ",406],"}",["T_WHITESPACE","\n                    ",407],"}",["T_WHITESPACE","\n                ",408],"}",["T_WHITESPACE","\n                ",409],["T_RETURN","return",410],["T_WHITESPACE"," ",410],["T_STRING","self",410],["T_DOUBLE_COLON","::",410],["T_VARIABLE","$_priceRulesData",410],"[",["T_VARIABLE","$cacheKey",410],"]",["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$priceRules",410],";",["T_WHITESPACE","\n            ",410],"}",["T_WHITESPACE"," ",411],["T_ELSE","else",411],["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n                ",411],["T_STRING","self",412],["T_DOUBLE_COLON","::",412],["T_VARIABLE","$_priceRulesData",412],"[",["T_VARIABLE","$cacheKey",412],"]",["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_STRING","null",412],";",["T_WHITESPACE","\n            ",412],"}",["T_WHITESPACE","\n        ",413],"}",["T_WHITESPACE"," ",414],["T_ELSE","else",414],["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n            ",414],["T_RETURN","return",415],["T_WHITESPACE"," ",415],["T_STRING","self",415],["T_DOUBLE_COLON","::",415],["T_VARIABLE","$_priceRulesData",415],"[",["T_VARIABLE","$cacheKey",415],"]",";",["T_WHITESPACE","\n        ",415],"}",["T_WHITESPACE","\n        ",416],["T_RETURN","return",417],["T_WHITESPACE"," ",417],["T_STRING","null",417],";",["T_WHITESPACE","\n    ",417],"}",["T_WHITESPACE","\n\n    ",418],["T_DOC_COMMENT","\/**\n     * Filtering products that must be checked for matching with rule\n     *\n     * @param  int|array $productIds\n     *\/",420],["T_WHITESPACE","\n    ",424],["T_PUBLIC","public",425],["T_WHITESPACE"," ",425],["T_FUNCTION","function",425],["T_WHITESPACE"," ",425],["T_STRING","setProductsFilter",425],"(",["T_VARIABLE","$productIds",425],")",["T_WHITESPACE","\n    ",425],"{",["T_WHITESPACE","\n        ",426],["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_productsFilter",427],["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_VARIABLE","$productIds",427],";",["T_WHITESPACE","\n    ",427],"}",["T_WHITESPACE","\n\n    ",428],["T_DOC_COMMENT","\/**\n     * Returns products filter\n     *\n     * @return array|int|null\n     *\/",430],["T_WHITESPACE","\n    ",434],["T_PUBLIC","public",435],["T_WHITESPACE"," ",435],["T_FUNCTION","function",435],["T_WHITESPACE"," ",435],["T_STRING","getProductsFilter",435],"(",")",["T_WHITESPACE","\n    ",435],"{",["T_WHITESPACE","\n        ",436],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","_productsFilter",437],";",["T_WHITESPACE","\n    ",437],"}",["T_WHITESPACE","\n\n    ",438],["T_DOC_COMMENT","\/**\n     * Invalidate related cache types\n     *\n     * @return Mage_CatalogRule_Model_Rule\n     *\/",440],["T_WHITESPACE","\n    ",444],["T_PROTECTED","protected",445],["T_WHITESPACE"," ",445],["T_FUNCTION","function",445],["T_WHITESPACE"," ",445],["T_STRING","_invalidateCache",445],"(",")",["T_WHITESPACE","\n    ",445],"{",["T_WHITESPACE","\n        ",446],["T_VARIABLE","$types",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","_config",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getNode",447],"(",["T_STRING","self",447],["T_DOUBLE_COLON","::",447],["T_STRING","XML_NODE_RELATED_CACHE",447],")",";",["T_WHITESPACE","\n        ",447],["T_IF","if",448],["T_WHITESPACE"," ",448],"(",["T_VARIABLE","$types",448],")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$types",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_VARIABLE","$types",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","asArray",449],"(",")",";",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","_app",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getCacheInstance",450],"(",")",["T_OBJECT_OPERATOR","->",450],["T_STRING","invalidateType",450],"(",["T_STRING","array_keys",450],"(",["T_VARIABLE","$types",450],")",")",";",["T_WHITESPACE","\n        ",450],"}",["T_WHITESPACE","\n        ",451],["T_RETURN","return",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$this",452],";",["T_WHITESPACE","\n    ",452],"}",["T_WHITESPACE","\n\n    ",453],["T_DOC_COMMENT","\/**\n     * @deprecated after 1.11.2.0\n     *\n     * @param string $format\n     *\n     * @return string\n     *\/",455],["T_WHITESPACE","\n    ",461],["T_PUBLIC","public",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","toString",462],"(",["T_VARIABLE","$format",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_CONSTANT_ENCAPSED_STRING","''",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_RETURN","return",464],["T_WHITESPACE"," ",464],["T_CONSTANT_ENCAPSED_STRING","''",464],";",["T_WHITESPACE","\n    ",464],"}",["T_WHITESPACE","\n\n    ",465],["T_DOC_COMMENT","\/**\n     * Returns rule as an array for admin interface\n     *\n     * @deprecated after 1.11.2.0\n     *\n     * @param array $arrAttributes\n     *\n     * Output example:\n     * array(\n     *   'name'=>'Example rule',\n     *   'conditions'=>{condition_combine::toArray}\n     *   'actions'=>{action_collection::toArray}\n     * )\n     *\n     * @return array\n     *\/",467],["T_WHITESPACE","\n    ",482],["T_PUBLIC","public",483],["T_WHITESPACE"," ",483],["T_FUNCTION","function",483],["T_WHITESPACE"," ",483],["T_STRING","toArray",483],"(",["T_ARRAY","array",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$arrAttributes",483],["T_WHITESPACE"," ",483],"=",["T_WHITESPACE"," ",483],["T_ARRAY","array",483],"(",")",")",["T_WHITESPACE","\n    ",483],"{",["T_WHITESPACE","\n        ",484],["T_RETURN","return",485],["T_WHITESPACE"," ",485],["T_STRING","parent",485],["T_DOUBLE_COLON","::",485],["T_STRING","toArray",485],"(",["T_VARIABLE","$arrAttributes",485],")",";",["T_WHITESPACE","\n    ",485],"}",["T_WHITESPACE","\n\n    ",486],["T_DOC_COMMENT","\/**\n     * Load matched product rules to the product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return $this\n     *\/",488],["T_WHITESPACE","\n    ",493],["T_PUBLIC","public",494],["T_WHITESPACE"," ",494],["T_FUNCTION","function",494],["T_WHITESPACE"," ",494],["T_STRING","loadProductRules",494],"(",["T_STRING","Mage_Catalog_Model_Product",494],["T_WHITESPACE"," ",494],["T_VARIABLE","$product",494],")",["T_WHITESPACE","\n    ",494],"{",["T_WHITESPACE","\n        ",495],["T_IF","if",496],["T_WHITESPACE"," ",496],"(","!",["T_VARIABLE","$product",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","hasData",496],"(",["T_CONSTANT_ENCAPSED_STRING","'matched_rules'",496],")",")",["T_WHITESPACE"," ",496],"{",["T_WHITESPACE","\n            ",496],["T_VARIABLE","$product",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","setMatchedRules",497],"(",["T_VARIABLE","$this",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getResource",497],"(",")",["T_OBJECT_OPERATOR","->",497],["T_STRING","getProductRuleIds",497],"(",["T_VARIABLE","$product",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getId",497],"(",")",")",")",";",["T_WHITESPACE","\n        ",497],"}",["T_WHITESPACE","\n        ",498],["T_RETURN","return",499],["T_WHITESPACE"," ",499],["T_VARIABLE","$this",499],";",["T_WHITESPACE","\n    ",499],"}",["T_WHITESPACE","\n",500],"}",["T_WHITESPACE","\n",501]]