[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Wrapper that performs Paypal MEP and Checkout communication\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_XmlConnect_Model_Paypal_Mep_Checkout",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_COMMENT","\/**#@+\n     * Keys for passthrough variables in sales\/quote_payment and sales\/order_payment\n     * Uses additional_information as storage\n     *\/",36],["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","PAYMENT_INFO_PAYER_EMAIL",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'paypal_payer_email'",40],";",["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","PAYMENT_INFO_TRANSACTION_ID",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'paypal_mep_checkout_transaction_id'",41],";",["T_WHITESPACE","\n    ",41],["T_COMMENT","\/**#@-*\/",42],["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Payment method type\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_methodType",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","Mage_XmlConnect_Model_Payment_Method_Paypal_Mep",49],["T_DOUBLE_COLON","::",49],["T_STRING","MEP_METHOD_CODE",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Quote model\n     *\n     * @var Mage_Sales_Model_Quote\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_quote",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","null",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Checkout session model\n     *\n     * @var Mage_Checkout_Model_Session\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_checkoutSession",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * XmlConnect default helper\n     *\n     * @var Mage_XmlConnect_Helper_Data\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_helper",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Set quote instances\n     *\n     * @throws Mage_Core_Exception\n     * @param array $params\n     *\/",72],["T_WHITESPACE","\n    ",77],["T_PUBLIC","public",78],["T_WHITESPACE"," ",78],["T_FUNCTION","function",78],["T_WHITESPACE"," ",78],["T_STRING","__construct",78],"(",["T_VARIABLE","$params",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_ARRAY","array",78],"(",")",")",["T_WHITESPACE","\n    ",78],"{",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_checkoutSession",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","Mage",80],["T_DOUBLE_COLON","::",80],["T_STRING","getSingleton",80],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",80],")",";",["T_WHITESPACE","\n        ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_ISSET","isset",81],"(",["T_VARIABLE","$params",81],"[",["T_CONSTANT_ENCAPSED_STRING","'quote'",81],"]",")",["T_WHITESPACE"," ",81],["T_BOOLEAN_AND","&&",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$params",81],"[",["T_CONSTANT_ENCAPSED_STRING","'quote'",81],"]",["T_WHITESPACE"," ",81],["T_INSTANCEOF","instanceof",81],["T_WHITESPACE"," ",81],["T_STRING","Mage_Sales_Model_Quote",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_quote",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$params",82],"[",["T_CONSTANT_ENCAPSED_STRING","'quote'",82],"]",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE"," ",83],["T_ELSE","else",83],["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","throwException",84],"(",["T_WHITESPACE","\n                ",84],["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","helper",85],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",85],")",["T_OBJECT_OPERATOR","->",85],["T_STRING","__",85],"(",["T_CONSTANT_ENCAPSED_STRING","'Quote instance is required.'",85],")",["T_WHITESPACE","\n            ",85],")",";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n    ",87],"}",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Prepare quote, reserve order ID for specified quote\n     *\n     * @return string\n     *\/",90],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","initCheckout",95],"(",")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_quote",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","reserveOrderId",97],"(",")",["T_OBJECT_OPERATOR","->",97],["T_STRING","save",97],"(",")",";",["T_WHITESPACE","\n\n        ",97],["T_DOC_COMMENT","\/**\n         * Reset multishipping flag before any manipulations with quote address\n         * addAddress method for quote object related on this flag\n         *\/",99],["T_WHITESPACE","\n        ",102],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_quote",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getIsMultiShipping",103],"(",")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_quote",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","setIsMultiShipping",104],"(",["T_STRING","false",104],")",";",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_quote",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","save",105],"(",")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_COMMENT","\/*\n        * want to load the correct customer information by assigning to address\n        * instead of just loading from sales\/quote_address\n        *\/",108],["T_WHITESPACE","\n        ",111],["T_VARIABLE","$customer",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","Mage",112],["T_DOUBLE_COLON","::",112],["T_STRING","getSingleton",112],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",112],")",["T_OBJECT_OPERATOR","->",112],["T_STRING","getCustomer",112],"(",")",";",["T_WHITESPACE","\n        ",112],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_VARIABLE","$customer",113],")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_quote",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","assignCustomer",114],"(",["T_VARIABLE","$customer",114],")",";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(","!",["T_STRING","Mage",116],["T_DOUBLE_COLON","::",116],["T_STRING","getSingleton",116],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",116],")",["T_OBJECT_OPERATOR","->",116],["T_STRING","isLoggedIn",116],"(",")",["T_WHITESPACE","\n            ",116],["T_BOOLEAN_AND","&&",117],["T_WHITESPACE"," ",117],["T_STRING","Mage",117],["T_DOUBLE_COLON","::",117],["T_STRING","getSingleton",117],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",117],")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getQuote",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","isAllowedGuestCheckout",117],"(",")",["T_WHITESPACE","\n        ",117],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_prepareGuestQuote",119],"(",")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n        ",120],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_quote",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getReservedOrderId",121],"(",")",";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Save shipping and billing address information to quote\n     *\n     * @param array $data\n     * @return array\n     *\/",124],["T_WHITESPACE","\n    ",129],["T_PUBLIC","public",130],["T_WHITESPACE"," ",130],["T_FUNCTION","function",130],["T_WHITESPACE"," ",130],["T_STRING","saveShipping",130],"(",["T_VARIABLE","$data",130],")",["T_WHITESPACE","\n    ",130],"{",["T_WHITESPACE","\n        ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_EMPTY","empty",132],"(",["T_VARIABLE","$data",132],")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_LNUMBER","1",133],",",["T_WHITESPACE"," ",133],["T_CONSTANT_ENCAPSED_STRING","'message'",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_STRING","Mage",133],["T_DOUBLE_COLON","::",133],["T_STRING","helper",133],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",133],")",["T_OBJECT_OPERATOR","->",133],["T_STRING","__",133],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid data.'",133],")",")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n\n        ",134],["T_VARIABLE","$address",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_quote",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getBillingAddress",136],"(",")",";",["T_WHITESPACE","\n\n        ",136],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_applyCountryWorkarounds",138],"(",["T_VARIABLE","$data",138],")",";",["T_WHITESPACE","\n        ",138],["T_DOC_COMMENT","\/** @var $model Mage_XmlConnect_Model_Application *\/",139],["T_WHITESPACE","\n        ",139],["T_VARIABLE","$model",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","Mage",140],["T_DOUBLE_COLON","::",140],["T_STRING","helper",140],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",140],")",["T_OBJECT_OPERATOR","->",140],["T_STRING","getApplication",140],"(",")",";",["T_WHITESPACE","\n\n        ",140],["T_VARIABLE","$paypalMepAllowSpecific",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$model",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getData",142],"(",["T_CONSTANT_ENCAPSED_STRING","'config_data[payment:paypalmep\/allowspecific]'",142],")",";",["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$paypalMepAllowSpecific",143],["T_WHITESPACE"," ",143],["T_IS_NOT_IDENTICAL","!==",143],["T_WHITESPACE"," ",143],["T_STRING","null",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(",["T_INT_CAST","(int)",144],["T_VARIABLE","$paypalMepAllowSpecific",144],["T_WHITESPACE"," ",144],">",["T_WHITESPACE"," ",144],["T_LNUMBER","0",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$allowedCountries",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_STRING","explode",145],"(",["T_CONSTANT_ENCAPSED_STRING","','",145],",",["T_WHITESPACE"," ",145],["T_VARIABLE","$model",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getData",145],"(",["T_CONSTANT_ENCAPSED_STRING","'config_data[payment][paypalmep\/applicable]'",145],")",")",";",["T_WHITESPACE","\n                ",145],["T_VARIABLE","$allowedCountries",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","array_map",146],"(",["T_CONSTANT_ENCAPSED_STRING","'trim'",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$allowedCountries",146],")",";",["T_WHITESPACE","\n                ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(","!",["T_STRING","in_array",147],"(",["T_STRING","trim",147],"(",["T_VARIABLE","$data",147],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",147],"]",")",",",["T_WHITESPACE"," ",147],["T_VARIABLE","$allowedCountries",147],")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                    ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_ARRAY","array",148],"(",["T_WHITESPACE","\n                        ",148],["T_CONSTANT_ENCAPSED_STRING","'error'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_LNUMBER","1",149],",",["T_WHITESPACE","\n                        ",149],["T_CONSTANT_ENCAPSED_STRING","'message'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_STRING","Mage",150],["T_DOUBLE_COLON","::",150],["T_STRING","helper",150],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",150],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","__",150],"(",["T_CONSTANT_ENCAPSED_STRING","'Buyer country is not allowed by store.'",150],")",["T_WHITESPACE","\n                    ",150],")",";",["T_WHITESPACE","\n                ",151],"}",["T_WHITESPACE","\n            ",152],"}",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n\n        ",154],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_EMPTY","empty",156],"(",["T_VARIABLE","$data",156],"[",["T_CONSTANT_ENCAPSED_STRING","'firstname'",156],"]",")",["T_WHITESPACE"," ",156],["T_BOOLEAN_AND","&&",156],["T_WHITESPACE"," ",156],["T_EMPTY","empty",156],"(",["T_VARIABLE","$data",156],"[",["T_CONSTANT_ENCAPSED_STRING","'lastname'",156],"]",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_STRING","Mage",157],["T_DOUBLE_COLON","::",157],["T_STRING","getSingleton",157],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",157],")",["T_OBJECT_OPERATOR","->",157],["T_STRING","isLoggedIn",157],"(",")",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$customer",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","Mage",158],["T_DOUBLE_COLON","::",158],["T_STRING","getSingleton",158],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",158],")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getCustomer",158],"(",")",";",["T_WHITESPACE","\n                ",158],["T_VARIABLE","$data",159],"[",["T_CONSTANT_ENCAPSED_STRING","'firstname'",159],"]",["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$customer",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getFirstname",159],"(",")",";",["T_WHITESPACE","\n                ",159],["T_VARIABLE","$data",160],"[",["T_CONSTANT_ENCAPSED_STRING","'lastname'",160],"]",["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$customer",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getLastname",160],"(",")",";",["T_WHITESPACE","\n            ",160],"}",["T_WHITESPACE"," ",161],["T_ELSE","else",161],["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$data",162],"[",["T_CONSTANT_ENCAPSED_STRING","'firstname'",162],"]",["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","Mage",162],["T_DOUBLE_COLON","::",162],["T_STRING","helper",162],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",162],")",["T_OBJECT_OPERATOR","->",162],["T_STRING","__",162],"(",["T_CONSTANT_ENCAPSED_STRING","'Guest'",162],")",";",["T_WHITESPACE","\n                ",162],["T_VARIABLE","$data",163],"[",["T_CONSTANT_ENCAPSED_STRING","'lastname'",163],"]",["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_STRING","Mage",163],["T_DOUBLE_COLON","::",163],["T_STRING","helper",163],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",163],")",["T_OBJECT_OPERATOR","->",163],["T_STRING","__",163],"(",["T_CONSTANT_ENCAPSED_STRING","'Guest'",163],")",";",["T_WHITESPACE","\n            ",163],"}",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_VARIABLE","$address",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","addData",167],"(",["T_VARIABLE","$data",167],")",";",["T_WHITESPACE","\n\n        ",167],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_ignoreAddressValidation",169],"(",")",";",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$address",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","implodeStreetAddress",171],"(",")",";",["T_WHITESPACE","\n\n        ",171],["T_IF","if",173],["T_WHITESPACE"," ",173],"(","!",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_quote",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","isVirtual",173],"(",")",")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$billing",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_CLONE","clone",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$address",174],";",["T_WHITESPACE","\n            ",174],["T_VARIABLE","$billing",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","unsAddressId",175],"(",")",["T_OBJECT_OPERATOR","->",175],["T_STRING","unsAddressType",175],"(",")",";",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$shipping",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_quote",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getShippingAddress",176],"(",")",";",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$shippingMethod",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$shipping",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getShippingMethod",177],"(",")",";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$shipping",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","addData",178],"(",["T_VARIABLE","$billing",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getData",178],"(",")",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","setSameAsBilling",178],"(",["T_LNUMBER","1",178],")",["T_OBJECT_OPERATOR","->",178],["T_STRING","setShippingMethod",178],"(",["T_VARIABLE","$shippingMethod",178],")",["T_WHITESPACE","\n                ",178],["T_OBJECT_OPERATOR","->",179],["T_STRING","setCollectShippingRates",179],"(",["T_STRING","true",179],")",";",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE","\n\n        ",180],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_quote",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","collectTotals",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","save",182],"(",")",";",["T_WHITESPACE","\n        ",182],["T_RETURN","return",183],["T_WHITESPACE"," ",183],["T_ARRAY","array",183],"(",")",";",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n\n    ",184],["T_DOC_COMMENT","\/**\n     * Specify quote shipping method\n     *\n     * @param string $shippingMethod\n     * @return array\n     *\/",186],["T_WHITESPACE","\n    ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","saveShippingMethod",192],"(",["T_VARIABLE","$shippingMethod",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_IF","if",194],["T_WHITESPACE"," ",194],"(",["T_EMPTY","empty",194],"(",["T_VARIABLE","$shippingMethod",194],")",")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_ARRAY","array",195],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",195],["T_WHITESPACE"," ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_LNUMBER","1",195],",",["T_WHITESPACE"," ",195],["T_CONSTANT_ENCAPSED_STRING","'message'",195],["T_WHITESPACE"," ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_STRING","Mage",195],["T_DOUBLE_COLON","::",195],["T_STRING","helper",195],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",195],")",["T_OBJECT_OPERATOR","->",195],["T_STRING","__",195],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid shipping method.'",195],")",")",";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n\n        ",196],["T_VARIABLE","$rate",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_quote",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getShippingAddress",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","getShippingRateByCode",198],"(",["T_VARIABLE","$shippingMethod",198],")",";",["T_WHITESPACE","\n        ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(","!",["T_VARIABLE","$rate",199],")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n            ",199],["T_RETURN","return",200],["T_WHITESPACE"," ",200],["T_ARRAY","array",200],"(",["T_CONSTANT_ENCAPSED_STRING","'error'",200],["T_WHITESPACE"," ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_LNUMBER","1",200],",",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'message'",200],["T_WHITESPACE"," ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_STRING","Mage",200],["T_DOUBLE_COLON","::",200],["T_STRING","helper",200],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",200],")",["T_OBJECT_OPERATOR","->",200],["T_STRING","__",200],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid shipping method.'",200],")",")",";",["T_WHITESPACE","\n        ",200],"}",["T_WHITESPACE","\n\n        ",201],["T_VARIABLE","$shippingAddress",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_quote",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getShippingAddress",203],"(",")",";",["T_WHITESPACE","\n        ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(","!",["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_quote",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getIsVirtual",204],"(",")",["T_WHITESPACE"," ",204],["T_BOOLEAN_AND","&&",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$shippingAddress",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_VARIABLE","$shippingMethod",205],["T_WHITESPACE"," ",205],["T_IS_NOT_EQUAL","!=",205],["T_WHITESPACE"," ",205],["T_VARIABLE","$shippingAddress",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getShippingMethod",205],"(",")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n                ",205],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_ignoreAddressValidation",206],"(",")",";",["T_WHITESPACE","\n                ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_quote",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getShippingAddress",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","setShippingMethod",207],"(",["T_VARIABLE","$shippingMethod",207],")",";",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_quote",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","collectTotals",208],"(",")",["T_OBJECT_OPERATOR","->",208],["T_STRING","save",208],"(",")",";",["T_WHITESPACE","\n            ",208],"}",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n\n        ",210],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_ARRAY","array",212],"(",")",";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * Specify quote payment method\n     *\n     * @param array $data\n     * @return array\n     *\/",215],["T_WHITESPACE","\n    ",220],["T_PUBLIC","public",221],["T_WHITESPACE"," ",221],["T_FUNCTION","function",221],["T_WHITESPACE"," ",221],["T_STRING","savePayment",221],"(",["T_VARIABLE","$data",221],")",["T_WHITESPACE","\n    ",221],"{",["T_WHITESPACE","\n        ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_quote",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","isVirtual",223],"(",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_quote",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getBillingAddress",224],"(",")",["T_OBJECT_OPERATOR","->",224],["T_STRING","setPaymentMethod",224],"(",["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_methodType",224],")",";",["T_WHITESPACE","\n        ",224],"}",["T_WHITESPACE"," ",225],["T_ELSE","else",225],["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_quote",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getShippingAddress",226],"(",")",["T_OBJECT_OPERATOR","->",226],["T_STRING","setPaymentMethod",226],"(",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_methodType",226],")",";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE","\n\n        ",227],["T_VARIABLE","$payment",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","_quote",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getPayment",229],"(",")",";",["T_WHITESPACE","\n        ",229],["T_VARIABLE","$data",230],"[",["T_CONSTANT_ENCAPSED_STRING","'method'",230],"]",["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_methodType",230],";",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$payment",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","importData",231],"(",["T_VARIABLE","$data",231],")",";",["T_WHITESPACE","\n\n        ",231],["T_VARIABLE","$email",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_ISSET","isset",233],"(",["T_VARIABLE","$data",233],"[",["T_CONSTANT_ENCAPSED_STRING","'payer'",233],"]",")",["T_WHITESPACE"," ",233],"?",["T_WHITESPACE"," ",233],["T_VARIABLE","$data",233],"[",["T_CONSTANT_ENCAPSED_STRING","'payer'",233],"]",["T_WHITESPACE"," ",233],":",["T_WHITESPACE"," ",233],["T_STRING","null",233],";",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$payment",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","setAdditionalInformation",234],"(",["T_STRING","self",234],["T_DOUBLE_COLON","::",234],["T_STRING","PAYMENT_INFO_PAYER_EMAIL",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$email",234],")",";",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$payment",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","setAdditionalInformation",235],"(",["T_WHITESPACE","\n            ",235],["T_STRING","self",236],["T_DOUBLE_COLON","::",236],["T_STRING","PAYMENT_INFO_TRANSACTION_ID",236],",",["T_WHITESPACE"," ",236],["T_ISSET","isset",236],"(",["T_VARIABLE","$data",236],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",236],"]",")",["T_WHITESPACE"," ",236],"?",["T_WHITESPACE"," ",236],["T_VARIABLE","$data",236],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",236],"]",["T_WHITESPACE"," ",236],":",["T_WHITESPACE"," ",236],["T_STRING","null",236],["T_WHITESPACE","\n        ",236],")",";",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_quote",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","setCustomerEmail",238],"(",["T_VARIABLE","$email",238],")",";",["T_WHITESPACE","\n\n        ",238],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_quote",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","collectTotals",240],"(",")",["T_OBJECT_OPERATOR","->",240],["T_STRING","save",240],"(",")",";",["T_WHITESPACE","\n\n        ",240],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_ARRAY","array",242],"(",")",";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * Place the order when customer returned from paypal\n     * Until this moment all quote data must be valid\n     *\n     * @return array\n     *\/",245],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","saveOrder",251],"(",")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_ignoreAddressValidation",253],"(",")",";",["T_WHITESPACE","\n\n        ",253],["T_VARIABLE","$order",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_STRING","Mage",255],["T_DOUBLE_COLON","::",255],["T_STRING","getModel",255],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_quote'",255],",",["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","_quote",255],")",["T_OBJECT_OPERATOR","->",255],["T_STRING","submit",255],"(",")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_quote",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","save",256],"(",")",";",["T_WHITESPACE","\n\n        ",256],["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","_getCheckoutSession",258],"(",")",["T_OBJECT_OPERATOR","->",258],["T_STRING","clear",258],"(",")",";",["T_WHITESPACE","\n\n        ",258],["T_DOC_COMMENT","\/**\n         * Prepare session to success or cancellation page\n         *\/",260],["T_WHITESPACE","\n        ",262],["T_VARIABLE","$quoteId",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_quote",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getId",263],"(",")",";",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_getCheckoutSession",264],"(",")",["T_OBJECT_OPERATOR","->",264],["T_STRING","setLastQuoteId",264],"(",["T_VARIABLE","$quoteId",264],")",["T_OBJECT_OPERATOR","->",264],["T_STRING","setLastSuccessQuoteId",264],"(",["T_VARIABLE","$quoteId",264],")",["T_WHITESPACE","\n            ",264],["T_OBJECT_OPERATOR","->",265],["T_STRING","setLastOrderId",265],"(",["T_VARIABLE","$order",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getId",265],"(",")",")",["T_OBJECT_OPERATOR","->",265],["T_STRING","setLastRealOrderId",265],"(",["T_VARIABLE","$order",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getIncrementId",265],"(",")",")",";",["T_WHITESPACE","\n\n        ",265],["T_IF","if",267],["T_WHITESPACE"," ",267],"(",["T_VARIABLE","$order",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getState",267],"(",")",["T_WHITESPACE"," ",267],["T_IS_EQUAL","==",267],["T_WHITESPACE"," ",267],["T_STRING","Mage_Sales_Model_Order",267],["T_DOUBLE_COLON","::",267],["T_STRING","STATE_PROCESSING",267],["T_WHITESPACE","\n            ",267],["T_BOOLEAN_AND","&&",268],["T_WHITESPACE"," ",268],["T_STRING","Mage",268],["T_DOUBLE_COLON","::",268],["T_STRING","getSingleton",268],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",268],")",["T_OBJECT_OPERATOR","->",268],["T_STRING","isLoggedIn",268],"(",")",["T_WHITESPACE","\n        ",268],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_TRY","try",270],["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n                ",270],["T_VARIABLE","$order",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","queueNewOrderEmail",271],"(",")",";",["T_WHITESPACE","\n            ",271],"}",["T_WHITESPACE"," ",272],["T_CATCH","catch",272],["T_WHITESPACE"," ",272],"(",["T_STRING","Exception",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$e",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n                ",272],["T_STRING","Mage",273],["T_DOUBLE_COLON","::",273],["T_STRING","logException",273],"(",["T_VARIABLE","$e",273],")",";",["T_WHITESPACE","\n            ",273],"}",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n\n        ",275],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_ARRAY","array",277],"(",")",";",["T_WHITESPACE","\n    ",277],"}",["T_WHITESPACE","\n\n    ",278],["T_DOC_COMMENT","\/**\n     * Get last order increment id by order id\n     *\n     * @return string\n     *\/",280],["T_WHITESPACE","\n    ",284],["T_PUBLIC","public",285],["T_WHITESPACE"," ",285],["T_FUNCTION","function",285],["T_WHITESPACE"," ",285],["T_STRING","getLastOrderId",285],"(",")",["T_WHITESPACE","\n    ",285],"{",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$lastId",287],["T_WHITESPACE","  ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_getCheckoutSession",287],"(",")",["T_OBJECT_OPERATOR","->",287],["T_STRING","getLastOrderId",287],"(",")",";",["T_WHITESPACE","\n        ",287],["T_VARIABLE","$orderId",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_STRING","false",288],";",["T_WHITESPACE","\n        ",288],["T_IF","if",289],["T_WHITESPACE"," ",289],"(",["T_VARIABLE","$lastId",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$order",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","Mage",290],["T_DOUBLE_COLON","::",290],["T_STRING","getModel",290],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",290],")",";",["T_WHITESPACE","\n            ",290],["T_VARIABLE","$order",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","load",291],"(",["T_VARIABLE","$lastId",291],")",";",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$orderId",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$order",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getIncrementId",292],"(",")",";",["T_WHITESPACE","\n        ",292],"}",["T_WHITESPACE","\n        ",293],["T_RETURN","return",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$orderId",294],";",["T_WHITESPACE","\n    ",294],"}",["T_WHITESPACE","\n\n    ",295],["T_DOC_COMMENT","\/**\n     * Make sure addresses will be saved without validation errors\n     *\n     * @return null\n     *\/",297],["T_WHITESPACE","\n    ",301],["T_PROTECTED","protected",302],["T_WHITESPACE"," ",302],["T_FUNCTION","function",302],["T_WHITESPACE"," ",302],["T_STRING","_ignoreAddressValidation",302],"(",")",["T_WHITESPACE","\n    ",302],"{",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_quote",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getBillingAddress",304],"(",")",["T_OBJECT_OPERATOR","->",304],["T_STRING","setShouldIgnoreValidation",304],"(",["T_STRING","true",304],")",";",["T_WHITESPACE","\n        ",304],["T_IF","if",305],["T_WHITESPACE"," ",305],"(","!",["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_quote",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getIsVirtual",305],"(",")",")",["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n            ",305],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_quote",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getShippingAddress",306],"(",")",["T_OBJECT_OPERATOR","->",306],["T_STRING","setShouldIgnoreValidation",306],"(",["T_STRING","true",306],")",";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n    ",307],"}",["T_WHITESPACE","\n\n    ",308],["T_DOC_COMMENT","\/**\n     * Get frontend checkout session object\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",310],["T_WHITESPACE","\n    ",314],["T_PROTECTED","protected",315],["T_WHITESPACE"," ",315],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","_getCheckoutSession",315],"(",")",["T_WHITESPACE","\n    ",315],"{",["T_WHITESPACE","\n        ",316],["T_RETURN","return",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_checkoutSession",317],";",["T_WHITESPACE","\n    ",317],"}",["T_WHITESPACE","\n\n    ",318],["T_DOC_COMMENT","\/**\n     * Prepare quote for guest checkout order submit\n     *\n     * @return Mage_XmlConnect_Model_Paypal_Mep_Checkout\n     *\/",320],["T_WHITESPACE","\n    ",324],["T_PROTECTED","protected",325],["T_WHITESPACE"," ",325],["T_FUNCTION","function",325],["T_WHITESPACE"," ",325],["T_STRING","_prepareGuestQuote",325],"(",")",["T_WHITESPACE","\n    ",325],"{",["T_WHITESPACE","\n        ",326],["T_VARIABLE","$quote",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_quote",327],";",["T_WHITESPACE","\n        ",327],["T_VARIABLE","$quote",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","setCustomerId",328],"(",["T_STRING","null",328],")",["T_OBJECT_OPERATOR","->",328],["T_STRING","setCustomerIsGuest",328],"(",["T_STRING","true",328],")",["T_WHITESPACE","\n            ",328],["T_OBJECT_OPERATOR","->",329],["T_STRING","setCustomerGroupId",329],"(",["T_STRING","Mage_Customer_Model_Group",329],["T_DOUBLE_COLON","::",329],["T_STRING","NOT_LOGGED_IN_ID",329],")",";",["T_WHITESPACE","\n        ",329],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],";",["T_WHITESPACE","\n    ",330],"}",["T_WHITESPACE","\n\n    ",331],["T_DOC_COMMENT","\/**\n     * Adopt specified request array from PayPal\n     *\n     * @param array $request\n     * @return null\n     *\/",333],["T_WHITESPACE","\n    ",338],["T_PROTECTED","protected",339],["T_WHITESPACE"," ",339],["T_FUNCTION","function",339],["T_WHITESPACE"," ",339],["T_STRING","_applyCountryWorkarounds",339],"(","&",["T_VARIABLE","$request",339],")",["T_WHITESPACE","\n    ",339],"{",["T_WHITESPACE","\n        ",340],["T_VARIABLE","$request",341],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",341],"]",["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_ISSET","isset",341],"(",["T_VARIABLE","$request",341],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",341],"]",")",["T_WHITESPACE"," ",341],"?",["T_WHITESPACE"," ",341],["T_STRING","trim",341],"(",["T_VARIABLE","$request",341],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",341],"]",")",["T_WHITESPACE"," ",341],":",["T_WHITESPACE"," ",341],["T_STRING","null",341],";",["T_WHITESPACE","\n        ",341],["T_IF","if",342],["T_WHITESPACE"," ",342],"(",["T_EMPTY","empty",342],"(",["T_VARIABLE","$request",342],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",342],"]",")",")",["T_WHITESPACE"," ",342],"{",["T_WHITESPACE","\n            ",342],["T_VARIABLE","$request",343],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",343],"]",["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_STRING","strtoupper",343],"(",["T_STRING","Mage",343],["T_DOUBLE_COLON","::",343],["T_STRING","getStoreConfig",343],"(",["T_CONSTANT_ENCAPSED_STRING","'general\/country\/default'",343],")",")",";",["T_WHITESPACE","\n        ",343],"}",["T_WHITESPACE"," ",344],["T_ELSE","else",344],["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n            ",344],["T_VARIABLE","$request",345],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",345],"]",["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_STRING","strtoupper",345],"(",["T_VARIABLE","$request",345],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",345],"]",")",";",["T_WHITESPACE","\n        ",345],"}",["T_WHITESPACE","\n    ",346],"}",["T_WHITESPACE","\n",347],"}",["T_WHITESPACE","\n",348]]