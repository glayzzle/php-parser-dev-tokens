[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * XmlConnect customer controller\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_XmlConnect_CustomerController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_XmlConnect_Controller_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Customer authentication action\n     *\n     * @return null\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PUBLIC","public",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","loginAction",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$session",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_getSession",43],"(",")",";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$request",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getRequest",44],"(",")",";",["T_WHITESPACE","\n        ",44],["T_IF","if",45],["T_WHITESPACE"," ",45],"(","!",["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","_isCustomerLoggedIn",45],"(",["T_STRING","false",45],")",")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n            ",45],["T_RETURN","return",46],";",["T_WHITESPACE","\n        ",46],"}",["T_WHITESPACE","\n\n        ",47],["T_IF","if",49],["T_WHITESPACE"," ",49],"(",["T_VARIABLE","$request",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","isPost",49],"(",")",")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$user",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$request",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getParam",50],"(",["T_CONSTANT_ENCAPSED_STRING","'username'",50],")",";",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$pass",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$request",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getParam",51],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",51],")",";",["T_WHITESPACE","\n            ",51],["T_TRY","try",52],["T_WHITESPACE"," ",52],"{",["T_WHITESPACE","\n                ",52],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$session",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","login",53],"(",["T_VARIABLE","$user",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$pass",53],")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n                    ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(",["T_VARIABLE","$session",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getCustomer",54],"(",")",["T_OBJECT_OPERATOR","->",54],["T_STRING","getIsJustConfirmed",54],"(",")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n                        ",54],["T_VARIABLE","$session",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getCustomer",55],"(",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","sendNewAccountEmail",55],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmed'",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","''",55],",",["T_WHITESPACE"," ",55],["T_STRING","Mage",55],["T_DOUBLE_COLON","::",55],["T_STRING","app",55],"(",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","getStore",55],"(",")",["T_OBJECT_OPERATOR","->",55],["T_STRING","getId",55],"(",")",")",";",["T_WHITESPACE","\n                    ",55],"}",["T_WHITESPACE","\n                    ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_message",57],"(",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","__",57],"(",["T_CONSTANT_ENCAPSED_STRING","'Authentication complete.'",57],")",",",["T_WHITESPACE"," ",57],["T_STRING","self",57],["T_DOUBLE_COLON","::",57],["T_STRING","MESSAGE_STATUS_SUCCESS",57],")",";",["T_WHITESPACE","\n                ",57],"}",["T_WHITESPACE"," ",58],["T_ELSE","else",58],["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n                    ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","_message",59],"(",["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","__",59],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid login or password.'",59],")",",",["T_WHITESPACE"," ",59],["T_STRING","self",59],["T_DOUBLE_COLON","::",59],["T_STRING","MESSAGE_STATUS_ERROR",59],")",";",["T_WHITESPACE","\n                ",59],"}",["T_WHITESPACE","\n            ",60],"}",["T_WHITESPACE"," ",61],["T_CATCH","catch",61],["T_WHITESPACE"," ",61],"(",["T_STRING","Mage_Core_Exception",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$e",61],")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n                ",61],["T_SWITCH","switch",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$e",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getCode",62],"(",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n                    ",62],["T_CASE","case",63],["T_WHITESPACE"," ",63],["T_STRING","Mage_Customer_Model_Customer",63],["T_DOUBLE_COLON","::",63],["T_STRING","EXCEPTION_EMAIL_NOT_CONFIRMED",63],":",["T_WHITESPACE","\n                        ",63],["T_COMMENT","\/\/ TODO: resend confirmation email message with action\n",64],["T_WHITESPACE","                        ",65],["T_VARIABLE","$message",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$e",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getMessage",65],"(",")",";",["T_WHITESPACE","\n                        ",65],["T_BREAK","break",66],";",["T_WHITESPACE","\n                    ",66],["T_CASE","case",67],["T_WHITESPACE"," ",67],["T_STRING","Mage_Customer_Model_Customer",67],["T_DOUBLE_COLON","::",67],["T_STRING","EXCEPTION_INVALID_EMAIL_OR_PASSWORD",67],":",["T_WHITESPACE","\n                        ",67],["T_VARIABLE","$message",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$e",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getMessage",68],"(",")",";",["T_WHITESPACE","\n                        ",68],["T_BREAK","break",69],";",["T_WHITESPACE","\n                    ",69],["T_DEFAULT","default",70],":",["T_WHITESPACE","\n                        ",70],["T_VARIABLE","$message",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$e",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getMessage",71],"(",")",";",["T_WHITESPACE","\n                ",71],"}",["T_WHITESPACE","\n                ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_message",73],"(",["T_VARIABLE","$message",73],",",["T_WHITESPACE"," ",73],["T_STRING","self",73],["T_DOUBLE_COLON","::",73],["T_STRING","MESSAGE_STATUS_ERROR",73],")",";",["T_WHITESPACE","\n            ",73],"}",["T_WHITESPACE"," ",74],["T_CATCH","catch",74],["T_WHITESPACE"," ",74],"(",["T_STRING","Exception",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$e",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n                ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_message",75],"(",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","__",75],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer authentication problem.'",75],")",",",["T_WHITESPACE"," ",75],["T_STRING","self",75],["T_DOUBLE_COLON","::",75],["T_STRING","MESSAGE_STATUS_ERROR",75],")",";",["T_WHITESPACE","\n            ",75],"}",["T_WHITESPACE","\n        ",76],"}",["T_WHITESPACE"," ",77],["T_ELSE","else",77],["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_message",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","__",78],"(",["T_CONSTANT_ENCAPSED_STRING","'Login and password are required.'",78],")",",",["T_WHITESPACE"," ",78],["T_STRING","self",78],["T_DOUBLE_COLON","::",78],["T_STRING","MESSAGE_STATUS_ERROR",78],")",";",["T_WHITESPACE","\n        ",78],"}",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Customer logout\n     *\n     * @return null\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","logoutAction",87],"(",")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_TRY","try",89],["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_getSession",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","logout",90],"(",")",";",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_message",91],"(",["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","__",91],"(",["T_CONSTANT_ENCAPSED_STRING","'Logout complete.'",91],")",",",["T_WHITESPACE"," ",91],["T_STRING","self",91],["T_DOUBLE_COLON","::",91],["T_STRING","MESSAGE_STATUS_SUCCESS",91],")",";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE"," ",92],["T_CATCH","catch",92],["T_WHITESPACE"," ",92],"(",["T_STRING","Mage_Core_Exception",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$e",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_message",93],"(",["T_VARIABLE","$e",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getMessage",93],"(",")",",",["T_WHITESPACE"," ",93],["T_STRING","self",93],["T_DOUBLE_COLON","::",93],["T_STRING","MESSAGE_STATUS_ERROR",93],")",";",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE"," ",94],["T_CATCH","catch",94],["T_WHITESPACE"," ",94],"(",["T_STRING","Exception",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$e",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n            ",94],["T_STRING","Mage",95],["T_DOUBLE_COLON","::",95],["T_STRING","logException",95],"(",["T_VARIABLE","$e",95],")",";",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_message",96],"(",["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","__",96],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer logout problem.'",96],")",",",["T_WHITESPACE"," ",96],["T_STRING","self",96],["T_DOUBLE_COLON","::",96],["T_STRING","MESSAGE_STATUS_ERROR",96],")",";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Customer registration\/edit account form\n     *\n     * @return null\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","formAction",105],"(",")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_TRY","try",107],["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$editFlag",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_BOOL_CAST","(bool)",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getRequest",108],"(",")",["T_OBJECT_OPERATOR","->",108],["T_STRING","getParam",108],"(",["T_CONSTANT_ENCAPSED_STRING","'edit'",108],")",";",["T_WHITESPACE","\n            ",108],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$editFlag",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n                ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(","!",["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_isCustomerLoggedIn",110],"(",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                    ",110],["T_RETURN","return",111],";",["T_WHITESPACE","\n                ",111],"}",["T_WHITESPACE","\n                ",112],["T_VARIABLE","$formCode",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'customer_account_edit'",113],";",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$customer",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_getSession",114],"(",")",["T_OBJECT_OPERATOR","->",114],["T_STRING","getCustomer",114],"(",")",";",["T_WHITESPACE","\n            ",114],"}",["T_WHITESPACE"," ",115],["T_ELSE","else",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(","!",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_isCustomerLoggedIn",116],"(",["T_STRING","false",116],")",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n                    ",116],["T_RETURN","return",117],";",["T_WHITESPACE","\n                ",117],"}",["T_WHITESPACE","\n                ",118],["T_VARIABLE","$formCode",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'customer_account_create'",119],";",["T_WHITESPACE","\n                ",119],["T_VARIABLE","$customer",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","Mage",120],["T_DOUBLE_COLON","::",120],["T_STRING","getModel",120],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",120],")",";",["T_WHITESPACE","\n            ",120],"}",["T_WHITESPACE","\n\n            ",121],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","loadLayout",123],"(",["T_STRING","false",123],")",["T_OBJECT_OPERATOR","->",123],["T_STRING","getLayout",123],"(",")",["T_OBJECT_OPERATOR","->",123],["T_STRING","getBlock",123],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect.customer.form'",123],")",["T_OBJECT_OPERATOR","->",123],["T_STRING","setCustomer",123],"(",["T_VARIABLE","$customer",123],")",["T_WHITESPACE","\n                ",123],["T_OBJECT_OPERATOR","->",124],["T_STRING","setIsEditPage",124],"(",["T_VARIABLE","$editFlag",124],")",["T_OBJECT_OPERATOR","->",124],["T_STRING","setAttributesBlockName",124],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_form_user_attributes'",124],")",["T_WHITESPACE","\n                ",124],["T_OBJECT_OPERATOR","->",125],["T_STRING","setCustomerFormCode",125],"(",["T_VARIABLE","$formCode",125],")",";",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","renderLayout",126],"(",")",";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE"," ",127],["T_CATCH","catch",127],["T_WHITESPACE"," ",127],"(",["T_STRING","Mage_Core_Exception",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$e",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_message",128],"(",["T_VARIABLE","$e",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getMessage",128],"(",")",",",["T_WHITESPACE"," ",128],["T_STRING","self",128],["T_DOUBLE_COLON","::",128],["T_STRING","MESSAGE_STATUS_ERROR",128],")",";",["T_WHITESPACE","\n        ",128],"}",["T_WHITESPACE"," ",129],["T_CATCH","catch",129],["T_WHITESPACE"," ",129],"(",["T_STRING","Exception",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$e",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_message",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","__",130],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t load customer form.'",130],")",",",["T_WHITESPACE"," ",130],["T_STRING","self",130],["T_DOUBLE_COLON","::",130],["T_STRING","MESSAGE_STATUS_ERROR",130],")",";",["T_WHITESPACE","\n            ",130],["T_STRING","Mage",131],["T_DOUBLE_COLON","::",131],["T_STRING","logException",131],"(",["T_VARIABLE","$e",131],")",";",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n\n    ",133],["T_DOC_COMMENT","\/**\n     * Change customer data action\n     *\n     * @return null\n     *\/",135],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","editAction",140],"(",")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","!",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_isCustomerLoggedIn",142],"(",")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_RETURN","return",143],";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n        ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getRequest",145],"(",")",["T_OBJECT_OPERATOR","->",145],["T_STRING","isPost",145],"(",")",")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$customer",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_getSession",146],"(",")",["T_OBJECT_OPERATOR","->",146],["T_STRING","getCustomer",146],"(",")",";",["T_WHITESPACE","\n\n            ",146],["T_COMMENT","\/* @var $customerForm Mage_Customer_Model_Form *\/",148],["T_WHITESPACE","\n            ",148],["T_VARIABLE","$customerForm",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_STRING","Mage",149],["T_DOUBLE_COLON","::",149],["T_STRING","getModel",149],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",149],")",";",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$customerForm",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","setFormCode",150],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_account_edit'",150],")",["T_OBJECT_OPERATOR","->",150],["T_STRING","setEntity",150],"(",["T_VARIABLE","$customer",150],")",";",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$customerData",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$customerForm",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","extractData",151],"(",["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getRequest",151],"(",")",")",";",["T_WHITESPACE","\n\n            ",151],["T_VARIABLE","$errors",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_ARRAY","array",153],"(",")",";",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$customerErrors",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$customerForm",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","validateData",154],"(",["T_VARIABLE","$customerData",154],")",";",["T_WHITESPACE","\n            ",154],["T_IF","if",155],["T_WHITESPACE"," ",155],"(",["T_VARIABLE","$customerErrors",155],["T_WHITESPACE"," ",155],["T_IS_NOT_IDENTICAL","!==",155],["T_WHITESPACE"," ",155],["T_STRING","true",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n                ",155],["T_VARIABLE","$errors",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_STRING","array_merge",156],"(",["T_VARIABLE","$customerErrors",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$errors",156],")",";",["T_WHITESPACE","\n            ",156],"}",["T_WHITESPACE"," ",157],["T_ELSE","else",157],["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$customerForm",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","compactData",158],"(",["T_VARIABLE","$customerData",158],")",";",["T_WHITESPACE","\n                ",158],["T_VARIABLE","$customerErrors",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$customer",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","validate",159],"(",")",";",["T_WHITESPACE","\n                ",159],["T_IF","if",160],["T_WHITESPACE"," ",160],"(",["T_STRING","is_array",160],"(",["T_VARIABLE","$customerErrors",160],")",")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                    ",160],["T_VARIABLE","$errors",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","array_merge",161],"(",["T_VARIABLE","$customerErrors",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$errors",161],")",";",["T_WHITESPACE","\n                ",161],"}",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE","\n\n            ",163],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getRequest",165],"(",")",["T_OBJECT_OPERATOR","->",165],["T_STRING","getParam",165],"(",["T_CONSTANT_ENCAPSED_STRING","'change_password'",165],")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                ",165],["T_VARIABLE","$currPass",166],["T_WHITESPACE","   ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getRequest",166],"(",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","getPost",166],"(",["T_CONSTANT_ENCAPSED_STRING","'current_password'",166],")",";",["T_WHITESPACE","\n                ",166],["T_VARIABLE","$newPass",167],["T_WHITESPACE","    ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getRequest",167],"(",")",["T_OBJECT_OPERATOR","->",167],["T_STRING","getPost",167],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",167],")",";",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$confPass",168],["T_WHITESPACE","   ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getRequest",168],"(",")",["T_OBJECT_OPERATOR","->",168],["T_STRING","getPost",168],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",168],")",";",["T_WHITESPACE","\n\n                ",168],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_EMPTY","empty",170],"(",["T_VARIABLE","$currPass",170],")",["T_WHITESPACE"," ",170],["T_BOOLEAN_OR","||",170],["T_WHITESPACE"," ",170],["T_EMPTY","empty",170],"(",["T_VARIABLE","$newPass",170],")",["T_WHITESPACE"," ",170],["T_BOOLEAN_OR","||",170],["T_WHITESPACE"," ",170],["T_EMPTY","empty",170],"(",["T_VARIABLE","$confPass",170],")",")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n                    ",170],["T_VARIABLE","$errors",171],"[","]",["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","__",171],"(",["T_CONSTANT_ENCAPSED_STRING","'Password fields cannot be empty.'",171],")",";",["T_WHITESPACE","\n                ",171],"}",["T_WHITESPACE","\n\n                ",172],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_VARIABLE","$newPass",174],["T_WHITESPACE"," ",174],["T_IS_NOT_EQUAL","!=",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$confPass",174],")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n                    ",174],["T_VARIABLE","$errors",175],"[","]",["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","__",175],"(",["T_CONSTANT_ENCAPSED_STRING","'Please make sure your passwords match.'",175],")",";",["T_WHITESPACE","\n                ",175],"}",["T_WHITESPACE","\n\n                ",176],["T_VARIABLE","$oldPass",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_getSession",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","getCustomer",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","getPasswordHash",178],"(",")",";",["T_WHITESPACE","\n                ",178],["T_IF","if",179],["T_WHITESPACE"," ",179],"(",["T_STRING","strpos",179],"(",["T_VARIABLE","$oldPass",179],",",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","':'",179],")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                    ",179],["T_LIST","list",180],"(",",",["T_WHITESPACE"," ",180],["T_VARIABLE","$salt",180],")",["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","explode",180],"(",["T_CONSTANT_ENCAPSED_STRING","':'",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$oldPass",180],")",";",["T_WHITESPACE","\n                ",180],"}",["T_WHITESPACE"," ",181],["T_ELSE","else",181],["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                    ",181],["T_VARIABLE","$salt",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","false",182],";",["T_WHITESPACE","\n                ",182],"}",["T_WHITESPACE","\n\n                ",183],["T_IF","if",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$customer",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","hashPassword",185],"(",["T_VARIABLE","$currPass",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$salt",185],")",["T_WHITESPACE"," ",185],["T_IS_EQUAL","==",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$oldPass",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                    ",185],["T_VARIABLE","$customer",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","setPassword",186],"(",["T_VARIABLE","$newPass",186],")",";",["T_WHITESPACE","\n                ",186],"}",["T_WHITESPACE"," ",187],["T_ELSE","else",187],["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                    ",187],["T_VARIABLE","$errors",188],"[","]",["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","__",188],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid current password.'",188],")",";",["T_WHITESPACE","\n                ",188],"}",["T_WHITESPACE","\n            ",189],"}",["T_WHITESPACE","\n\n            ",190],["T_IF","if",192],["T_WHITESPACE"," ",192],"(","!",["T_EMPTY","empty",192],"(",["T_VARIABLE","$errors",192],")",")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n                ",192],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",193],["T_WHITESPACE","\n                ",193],["T_VARIABLE","$message",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","getModel",194],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",194],",",["T_WHITESPACE"," ",194],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",194],")",";",["T_WHITESPACE","\n                ",194],["T_VARIABLE","$message",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","addChild",195],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",195],",",["T_WHITESPACE"," ",195],["T_STRING","self",195],["T_DOUBLE_COLON","::",195],["T_STRING","MESSAGE_STATUS_ERROR",195],")",";",["T_WHITESPACE","\n                ",195],["T_VARIABLE","$message",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","addChild",196],"(",["T_CONSTANT_ENCAPSED_STRING","'text'",196],",",["T_WHITESPACE"," ",196],["T_STRING","implode",196],"(",["T_CONSTANT_ENCAPSED_STRING","' '",196],",",["T_WHITESPACE"," ",196],["T_VARIABLE","$errors",196],")",")",";",["T_WHITESPACE","\n                ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getResponse",197],"(",")",["T_OBJECT_OPERATOR","->",197],["T_STRING","setBody",197],"(",["T_VARIABLE","$message",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","asNiceXml",197],"(",")",")",";",["T_WHITESPACE","\n                ",197],["T_RETURN","return",198],";",["T_WHITESPACE","\n            ",198],"}",["T_WHITESPACE","\n\n            ",199],["T_TRY","try",201],["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                ",201],["T_VARIABLE","$customer",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","cleanPasswordsValidationData",202],"(",")",";",["T_WHITESPACE","\n                ",202],["T_VARIABLE","$customer",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","save",203],"(",")",";",["T_WHITESPACE","\n                ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_getSession",204],"(",")",["T_OBJECT_OPERATOR","->",204],["T_STRING","setCustomer",204],"(",["T_VARIABLE","$customer",204],")",";",["T_WHITESPACE","\n                ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_message",205],"(",["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","__",205],"(",["T_CONSTANT_ENCAPSED_STRING","'Account information has been saved.'",205],")",",",["T_WHITESPACE"," ",205],["T_STRING","self",205],["T_DOUBLE_COLON","::",205],["T_STRING","MESSAGE_STATUS_SUCCESS",205],")",";",["T_WHITESPACE","\n                ",205],["T_RETURN","return",206],";",["T_WHITESPACE","\n            ",206],"}",["T_WHITESPACE"," ",207],["T_CATCH","catch",207],["T_WHITESPACE"," ",207],"(",["T_STRING","Mage_Core_Exception",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$e",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                ",207],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_message",208],"(",["T_VARIABLE","$e",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getMessage",208],"(",")",",",["T_WHITESPACE"," ",208],["T_STRING","self",208],["T_DOUBLE_COLON","::",208],["T_STRING","MESSAGE_STATUS_ERROR",208],")",";",["T_WHITESPACE","\n            ",208],"}",["T_WHITESPACE"," ",209],["T_CATCH","catch",209],["T_WHITESPACE"," ",209],"(",["T_STRING","Exception",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$e",209],")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n                ",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$e",210],["T_WHITESPACE"," ",210],["T_INSTANCEOF","instanceof",210],["T_WHITESPACE"," ",210],["T_STRING","Mage_Eav_Model_Entity_Attribute_Exception",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n                    ",210],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_message",211],"(",["T_VARIABLE","$e",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getMessage",211],"(",")",",",["T_WHITESPACE"," ",211],["T_STRING","self",211],["T_DOUBLE_COLON","::",211],["T_STRING","MESSAGE_STATUS_ERROR",211],")",";",["T_WHITESPACE","\n                ",211],"}",["T_WHITESPACE"," ",212],["T_ELSE","else",212],["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n                    ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_message",213],"(",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","__",213],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t save the customer.'",213],")",",",["T_WHITESPACE"," ",213],["T_STRING","self",213],["T_DOUBLE_COLON","::",213],["T_STRING","MESSAGE_STATUS_ERROR",213],")",";",["T_WHITESPACE","\n                ",213],"}",["T_WHITESPACE","\n            ",214],"}",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE"," ",216],["T_ELSE","else",216],["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_message",217],"(",["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","__",217],"(",["T_CONSTANT_ENCAPSED_STRING","'POST data is not valid.'",217],")",",",["T_WHITESPACE"," ",217],["T_STRING","self",217],["T_DOUBLE_COLON","::",217],["T_STRING","MESSAGE_STATUS_ERROR",217],")",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n    ",218],"}",["T_WHITESPACE","\n\n    ",219],["T_DOC_COMMENT","\/**\n     * Save customer account\n     *\n     * @return null\n     *\/",221],["T_WHITESPACE","\n    ",225],["T_PUBLIC","public",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","saveAction",226],"(",")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_IF","if",228],["T_WHITESPACE"," ",228],"(","!",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_isCustomerLoggedIn",228],"(",["T_STRING","false",228],")",")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_RETURN","return",229],";",["T_WHITESPACE","\n        ",229],"}",["T_WHITESPACE","\n\n        ",230],["T_VARIABLE","$session",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","_getSession",232],"(",")",";",["T_WHITESPACE","\n        ",232],["T_VARIABLE","$request",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getRequest",233],"(",")",";",["T_WHITESPACE","\n\n        ",233],["T_VARIABLE","$session",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","setEscapeMessages",235],"(",["T_STRING","true",235],")",";",["T_WHITESPACE"," ",235],["T_COMMENT","\/\/ prevent XSS injection in user input\n",235],["T_WHITESPACE","        ",236],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$request",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","isPost",236],"(",")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$errors",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_ARRAY","array",237],"(",")",";",["T_WHITESPACE","\n\n            ",237],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",239],["T_WHITESPACE","\n            ",239],["T_VARIABLE","$customer",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_STRING","Mage",240],["T_DOUBLE_COLON","::",240],["T_STRING","registry",240],"(",["T_CONSTANT_ENCAPSED_STRING","'current_customer'",240],")",";",["T_WHITESPACE","\n            ",240],["T_IF","if",241],["T_WHITESPACE"," ",241],"(",["T_STRING","is_null",241],"(",["T_VARIABLE","$customer",241],")",")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n                ",241],["T_VARIABLE","$customer",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_STRING","Mage",242],["T_DOUBLE_COLON","::",242],["T_STRING","getModel",242],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",242],")",";",["T_WHITESPACE","\n            ",242],"}",["T_WHITESPACE","\n\n            ",243],["T_DOC_COMMENT","\/** @var $customerForm Mage_Customer_Model_Form *\/",245],["T_WHITESPACE","\n            ",245],["T_VARIABLE","$customerForm",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_STRING","Mage",246],["T_DOUBLE_COLON","::",246],["T_STRING","getModel",246],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",246],")",";",["T_WHITESPACE","\n\n            ",246],["T_DOC_COMMENT","\/** Check if registration from checkout page *\/",248],["T_WHITESPACE","\n            ",248],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getRequest",249],"(",")",["T_OBJECT_OPERATOR","->",249],["T_STRING","getParam",249],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_page_registration'",249],",",["T_WHITESPACE"," ",249],["T_STRING","false",249],")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                ",249],["T_VARIABLE","$formCode",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","'checkout_register'",250],";",["T_WHITESPACE","\n            ",250],"}",["T_WHITESPACE"," ",251],["T_ELSE","else",251],["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n                ",251],["T_VARIABLE","$formCode",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'customer_account_create'",252],";",["T_WHITESPACE","\n            ",252],"}",["T_WHITESPACE","\n            ",253],["T_VARIABLE","$customerForm",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","setFormCode",254],"(",["T_VARIABLE","$formCode",254],")",["T_OBJECT_OPERATOR","->",254],["T_STRING","setEntity",254],"(",["T_VARIABLE","$customer",254],")",";",["T_WHITESPACE","\n\n            ",254],["T_VARIABLE","$customerData",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$customerForm",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","extractData",256],"(",["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getRequest",256],"(",")",")",";",["T_WHITESPACE","\n\n            ",256],["T_IF","if",258],["T_WHITESPACE"," ",258],"(",["T_VARIABLE","$this",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getRequest",258],"(",")",["T_OBJECT_OPERATOR","->",258],["T_STRING","getParam",258],"(",["T_CONSTANT_ENCAPSED_STRING","'is_subscribed'",258],",",["T_WHITESPACE"," ",258],["T_STRING","false",258],")",")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n                ",258],["T_VARIABLE","$customer",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","setIsSubscribed",259],"(",["T_LNUMBER","1",259],")",";",["T_WHITESPACE","\n            ",259],"}",["T_WHITESPACE","\n\n            ",260],["T_DOC_COMMENT","\/**\n             * Initialize customer group id\n             *\/",262],["T_WHITESPACE","\n            ",264],["T_VARIABLE","$customer",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getGroupId",265],"(",")",";",["T_WHITESPACE","\n\n            ",265],["T_TRY","try",267],["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n                ",267],["T_VARIABLE","$customerErrors",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$customerForm",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","validateData",268],"(",["T_VARIABLE","$customerData",268],")",";",["T_WHITESPACE","\n                ",268],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_VARIABLE","$customerErrors",269],["T_WHITESPACE"," ",269],["T_IS_NOT_IDENTICAL","!==",269],["T_WHITESPACE"," ",269],["T_STRING","true",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n                    ",269],["T_VARIABLE","$errors",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_STRING","array_merge",270],"(",["T_VARIABLE","$customerErrors",270],",",["T_WHITESPACE"," ",270],["T_VARIABLE","$errors",270],")",";",["T_WHITESPACE","\n                ",270],"}",["T_WHITESPACE"," ",271],["T_ELSE","else",271],["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n                    ",271],["T_VARIABLE","$customerForm",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","compactData",272],"(",["T_VARIABLE","$customerData",272],")",";",["T_WHITESPACE","\n                    ",272],["T_VARIABLE","$customer",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","setPassword",273],"(",["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getRequest",273],"(",")",["T_OBJECT_OPERATOR","->",273],["T_STRING","getPost",273],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",273],")",")",";",["T_WHITESPACE","\n                    ",273],["T_VARIABLE","$customer",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","setPasswordConfirmation",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getRequest",274],"(",")",["T_OBJECT_OPERATOR","->",274],["T_STRING","getPost",274],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",274],")",")",";",["T_WHITESPACE","\n                    ",274],["T_VARIABLE","$customerErrors",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$customer",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","validate",275],"(",")",";",["T_WHITESPACE","\n                    ",275],["T_IF","if",276],["T_WHITESPACE"," ",276],"(",["T_STRING","is_array",276],"(",["T_VARIABLE","$customerErrors",276],")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n                        ",276],["T_VARIABLE","$errors",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_STRING","array_merge",277],"(",["T_VARIABLE","$customerErrors",277],",",["T_WHITESPACE"," ",277],["T_VARIABLE","$errors",277],")",";",["T_WHITESPACE","\n                    ",277],"}",["T_WHITESPACE","\n                ",278],"}",["T_WHITESPACE","\n\n                ",279],["T_VARIABLE","$validationResult",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","count",281],"(",["T_VARIABLE","$errors",281],")",["T_WHITESPACE"," ",281],["T_IS_EQUAL","==",281],["T_WHITESPACE"," ",281],["T_LNUMBER","0",281],";",["T_WHITESPACE","\n                ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_STRING","true",282],["T_WHITESPACE"," ",282],["T_IS_IDENTICAL","===",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$validationResult",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n                    ",282],["T_VARIABLE","$customer",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","save",283],"(",")",";",["T_WHITESPACE","\n\n                    ",283],["T_IF","if",285],["T_WHITESPACE"," ",285],"(",["T_VARIABLE","$customer",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","isConfirmationRequired",285],"(",")",")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n                        ",285],["T_VARIABLE","$customer",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","sendNewAccountEmail",286],"(",["T_WHITESPACE","\n                            ",286],["T_CONSTANT_ENCAPSED_STRING","'confirmation'",287],",",["T_WHITESPACE","\n                            ",287],["T_VARIABLE","$session",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getBeforeAuthUrl",288],"(",")",",",["T_WHITESPACE","\n                            ",288],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","app",289],"(",")",["T_OBJECT_OPERATOR","->",289],["T_STRING","getStore",289],"(",")",["T_OBJECT_OPERATOR","->",289],["T_STRING","getId",289],"(",")",["T_WHITESPACE","\n                        ",289],")",";",["T_WHITESPACE","\n                        ",290],["T_VARIABLE","$message",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","__",291],"(",["T_CONSTANT_ENCAPSED_STRING","'Account confirmation is required. Please check your email for the confirmation link.'",291],")",";",["T_WHITESPACE","\n                        ",291],["T_DOC_COMMENT","\/** @var $messageXmlObj Mage_XmlConnect_Model_Simplexml_Element *\/",292],["T_WHITESPACE","\n                        ",292],["T_VARIABLE","$messageXmlObj",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_STRING","Mage",293],["T_DOUBLE_COLON","::",293],["T_STRING","getModel",293],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",293],",",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",293],")",";",["T_WHITESPACE","\n                        ",293],["T_VARIABLE","$messageXmlObj",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","addChild",294],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",294],",",["T_WHITESPACE"," ",294],["T_STRING","self",294],["T_DOUBLE_COLON","::",294],["T_STRING","MESSAGE_STATUS_SUCCESS",294],")",";",["T_WHITESPACE","\n                        ",294],["T_VARIABLE","$messageXmlObj",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","addChild",295],"(",["T_CONSTANT_ENCAPSED_STRING","'text'",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$message",295],")",";",["T_WHITESPACE","\n                        ",295],["T_VARIABLE","$messageXmlObj",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","addChild",296],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",296],",",["T_WHITESPACE"," ",296],["T_LNUMBER","1",296],")",";",["T_WHITESPACE","\n                        ",296],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getResponse",297],"(",")",["T_OBJECT_OPERATOR","->",297],["T_STRING","setBody",297],"(",["T_VARIABLE","$messageXmlObj",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","asNiceXml",297],"(",")",")",";",["T_WHITESPACE","\n                        ",297],["T_RETURN","return",298],";",["T_WHITESPACE","\n                    ",298],"}",["T_WHITESPACE"," ",299],["T_ELSE","else",299],["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                        ",299],["T_VARIABLE","$session",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","setCustomerAsLoggedIn",300],"(",["T_VARIABLE","$customer",300],")",";",["T_WHITESPACE","\n                        ",300],["T_VARIABLE","$customer",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","sendNewAccountEmail",301],"(",["T_CONSTANT_ENCAPSED_STRING","'registered'",301],",",["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","''",301],",",["T_WHITESPACE"," ",301],["T_STRING","Mage",301],["T_DOUBLE_COLON","::",301],["T_STRING","app",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","getStore",301],"(",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","getId",301],"(",")",")",";",["T_WHITESPACE","\n                        ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_message",302],"(",["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","__",302],"(",["T_CONSTANT_ENCAPSED_STRING","'Thank you for registering!'",302],")",",",["T_WHITESPACE"," ",302],["T_STRING","self",302],["T_DOUBLE_COLON","::",302],["T_STRING","MESSAGE_STATUS_SUCCESS",302],")",";",["T_WHITESPACE","\n                        ",302],["T_RETURN","return",303],";",["T_WHITESPACE","\n                    ",303],"}",["T_WHITESPACE","\n                ",304],"}",["T_WHITESPACE"," ",305],["T_ELSE","else",305],["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n                    ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_STRING","is_array",306],"(",["T_VARIABLE","$errors",306],")",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n                        ",306],["T_VARIABLE","$message",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_STRING","implode",307],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",307],",",["T_WHITESPACE"," ",307],["T_VARIABLE","$errors",307],")",";",["T_WHITESPACE","\n                    ",307],"}",["T_WHITESPACE"," ",308],["T_ELSE","else",308],["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n                        ",308],["T_VARIABLE","$message",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","__",309],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid customer data.'",309],")",";",["T_WHITESPACE","\n                    ",309],"}",["T_WHITESPACE","\n                    ",310],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_message",311],"(",["T_VARIABLE","$message",311],",",["T_WHITESPACE"," ",311],["T_STRING","self",311],["T_DOUBLE_COLON","::",311],["T_STRING","MESSAGE_STATUS_ERROR",311],")",";",["T_WHITESPACE","\n                    ",311],["T_RETURN","return",312],";",["T_WHITESPACE","\n                ",312],"}",["T_WHITESPACE","\n            ",313],"}",["T_WHITESPACE"," ",314],["T_CATCH","catch",314],["T_WHITESPACE"," ",314],"(",["T_STRING","Mage_Core_Exception",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$e",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n                ",314],["T_IF","if",315],["T_WHITESPACE"," ",315],"(",["T_VARIABLE","$e",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getCode",315],"(",")",["T_WHITESPACE"," ",315],["T_IS_IDENTICAL","===",315],["T_WHITESPACE"," ",315],["T_STRING","Mage_Customer_Model_Customer",315],["T_DOUBLE_COLON","::",315],["T_STRING","EXCEPTION_EMAIL_EXISTS",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n                    ",315],["T_VARIABLE","$message",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","__",316],"(",["T_CONSTANT_ENCAPSED_STRING","'An account with this email address already exists.'",316],")",";",["T_WHITESPACE","\n                    ",316],["T_VARIABLE","$session",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","setEscapeMessages",317],"(",["T_STRING","false",317],")",";",["T_WHITESPACE","\n                ",317],"}",["T_WHITESPACE"," ",318],["T_ELSE","else",318],["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n                    ",318],["T_VARIABLE","$message",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_VARIABLE","$e",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getMessage",319],"(",")",";",["T_WHITESPACE","\n                ",319],"}",["T_WHITESPACE","\n                ",320],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_message",321],"(",["T_VARIABLE","$message",321],",",["T_WHITESPACE"," ",321],["T_STRING","self",321],["T_DOUBLE_COLON","::",321],["T_STRING","MESSAGE_STATUS_ERROR",321],")",";",["T_WHITESPACE","\n            ",321],"}",["T_WHITESPACE"," ",322],["T_CATCH","catch",322],["T_WHITESPACE"," ",322],"(",["T_STRING","Exception",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$e",322],")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n                ",322],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","_message",323],"(",["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","__",323],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t save the customer.'",323],")",",",["T_WHITESPACE"," ",323],["T_STRING","self",323],["T_DOUBLE_COLON","::",323],["T_STRING","MESSAGE_STATUS_ERROR",323],")",";",["T_WHITESPACE","\n            ",323],"}",["T_WHITESPACE","\n        ",324],"}",["T_WHITESPACE","\n    ",325],"}",["T_WHITESPACE","\n\n    ",326],["T_DOC_COMMENT","\/**\n     * Send new password to customer by specified email\n     *\n     * @return null\n     *\/",328],["T_WHITESPACE","\n    ",332],["T_PUBLIC","public",333],["T_WHITESPACE"," ",333],["T_FUNCTION","function",333],["T_WHITESPACE"," ",333],["T_STRING","forgotPasswordAction",333],"(",")",["T_WHITESPACE","\n    ",333],"{",["T_WHITESPACE","\n        ",334],["T_VARIABLE","$email",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getRequest",335],"(",")",["T_OBJECT_OPERATOR","->",335],["T_STRING","getPost",335],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",335],")",";",["T_WHITESPACE","\n        ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$email",336],")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_IF","if",337],["T_WHITESPACE"," ",337],"(","!",["T_STRING","Zend_Validate",337],["T_DOUBLE_COLON","::",337],["T_STRING","is",337],"(",["T_VARIABLE","$email",337],",",["T_WHITESPACE"," ",337],["T_CONSTANT_ENCAPSED_STRING","'EmailAddress'",337],")",")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                ",337],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_message",338],"(",["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","__",338],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid email address.'",338],")",",",["T_WHITESPACE"," ",338],["T_STRING","self",338],["T_DOUBLE_COLON","::",338],["T_STRING","MESSAGE_STATUS_ERROR",338],")",";",["T_WHITESPACE","\n                ",338],["T_RETURN","return",339],";",["T_WHITESPACE","\n            ",339],"}",["T_WHITESPACE","\n            ",340],["T_VARIABLE","$customer",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_STRING","Mage",341],["T_DOUBLE_COLON","::",341],["T_STRING","getModel",341],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",341],")",["T_OBJECT_OPERATOR","->",341],["T_STRING","setWebsiteId",341],"(",["T_STRING","Mage",341],["T_DOUBLE_COLON","::",341],["T_STRING","app",341],"(",")",["T_OBJECT_OPERATOR","->",341],["T_STRING","getStore",341],"(",")",["T_OBJECT_OPERATOR","->",341],["T_STRING","getWebsiteId",341],"(",")",")",["T_WHITESPACE","\n                ",341],["T_OBJECT_OPERATOR","->",342],["T_STRING","loadByEmail",342],"(",["T_VARIABLE","$email",342],")",";",["T_WHITESPACE","\n\n            ",342],["T_IF","if",344],["T_WHITESPACE"," ",344],"(",["T_VARIABLE","$customer",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getId",344],"(",")",")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n                ",344],["T_TRY","try",345],["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n                    ",345],["T_VARIABLE","$newPassword",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_VARIABLE","$customer",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","generatePassword",346],"(",")",";",["T_WHITESPACE","\n                    ",346],["T_VARIABLE","$customer",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","changePassword",347],"(",["T_VARIABLE","$newPassword",347],",",["T_WHITESPACE"," ",347],["T_STRING","false",347],")",";",["T_WHITESPACE","\n                    ",347],["T_VARIABLE","$customer",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","sendPasswordReminderEmail",348],"(",")",";",["T_WHITESPACE","\n                    ",348],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_message",349],"(",["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","__",349],"(",["T_CONSTANT_ENCAPSED_STRING","'A new password has been sent.'",349],")",",",["T_WHITESPACE"," ",349],["T_STRING","self",349],["T_DOUBLE_COLON","::",349],["T_STRING","MESSAGE_STATUS_SUCCESS",349],")",";",["T_WHITESPACE","\n                    ",349],["T_RETURN","return",350],";",["T_WHITESPACE","\n                ",350],"}",["T_WHITESPACE"," ",351],["T_CATCH","catch",351],["T_WHITESPACE"," ",351],"(",["T_STRING","Mage_Core_Exception",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$e",351],")",["T_WHITESPACE"," ",351],"{",["T_WHITESPACE","\n                    ",351],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","_message",352],"(",["T_VARIABLE","$e",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getMessage",352],"(",")",",",["T_WHITESPACE"," ",352],["T_STRING","self",352],["T_DOUBLE_COLON","::",352],["T_STRING","MESSAGE_STATUS_ERROR",352],")",";",["T_WHITESPACE","\n                ",352],"}",["T_WHITESPACE"," ",353],["T_CATCH","catch",353],["T_WHITESPACE"," ",353],"(",["T_STRING","Exception",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$e",353],")",["T_WHITESPACE"," ",353],"{",["T_WHITESPACE","\n                    ",353],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","_message",354],"(",["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","__",354],"(",["T_CONSTANT_ENCAPSED_STRING","'Problem changing or sending password.'",354],")",",",["T_WHITESPACE"," ",354],["T_STRING","self",354],["T_DOUBLE_COLON","::",354],["T_STRING","MESSAGE_STATUS_ERROR",354],")",";",["T_WHITESPACE","\n                ",354],"}",["T_WHITESPACE","\n            ",355],"}",["T_WHITESPACE"," ",356],["T_ELSE","else",356],["T_WHITESPACE"," ",356],"{",["T_WHITESPACE","\n                ",356],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_message",357],"(",["T_WHITESPACE","\n                    ",357],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","__",358],"(",["T_CONSTANT_ENCAPSED_STRING","'This email address was not found in our records.'",358],")",",",["T_WHITESPACE"," ",358],["T_STRING","self",358],["T_DOUBLE_COLON","::",358],["T_STRING","MESSAGE_STATUS_ERROR",358],["T_WHITESPACE","\n                ",358],")",";",["T_WHITESPACE","\n            ",359],"}",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE"," ",361],["T_ELSE","else",361],["T_WHITESPACE"," ",361],"{",["T_WHITESPACE","\n            ",361],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","_message",362],"(",["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","__",362],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer email not specified.'",362],")",",",["T_WHITESPACE"," ",362],["T_STRING","self",362],["T_DOUBLE_COLON","::",362],["T_STRING","MESSAGE_STATUS_ERROR",362],")",";",["T_WHITESPACE","\n        ",362],"}",["T_WHITESPACE","\n    ",363],"}",["T_WHITESPACE","\n\n    ",364],["T_DOC_COMMENT","\/**\n     * Customer addresses list\n     *\n     * @return null\n     *\/",366],["T_WHITESPACE","\n    ",370],["T_PUBLIC","public",371],["T_WHITESPACE"," ",371],["T_FUNCTION","function",371],["T_WHITESPACE"," ",371],["T_STRING","addressAction",371],"(",")",["T_WHITESPACE","\n    ",371],"{",["T_WHITESPACE","\n        ",372],["T_IF","if",373],["T_WHITESPACE"," ",373],"(","!",["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","_isCustomerLoggedIn",373],"(",")",")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n            ",373],["T_RETURN","return",374],";",["T_WHITESPACE","\n        ",374],"}",["T_WHITESPACE","\n\n        ",375],["T_IF","if",377],["T_WHITESPACE"," ",377],"(",["T_STRING","count",377],"(",["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","_getSession",377],"(",")",["T_OBJECT_OPERATOR","->",377],["T_STRING","getCustomer",377],"(",")",["T_OBJECT_OPERATOR","->",377],["T_STRING","getAddresses",377],"(",")",")",")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n            ",377],["T_TRY","try",378],["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n                ",378],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","loadLayout",379],"(",["T_STRING","false",379],")",";",["T_WHITESPACE","\n                ",379],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","renderLayout",380],"(",")",";",["T_WHITESPACE","\n            ",380],"}",["T_WHITESPACE"," ",381],["T_CATCH","catch",381],["T_WHITESPACE"," ",381],"(",["T_STRING","Mage_Core_Exception",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$e",381],")",["T_WHITESPACE"," ",381],"{",["T_WHITESPACE","\n                ",381],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_message",382],"(",["T_VARIABLE","$e",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getMessage",382],"(",")",",",["T_WHITESPACE"," ",382],["T_STRING","self",382],["T_DOUBLE_COLON","::",382],["T_STRING","MESSAGE_STATUS_ERROR",382],")",";",["T_WHITESPACE","\n            ",382],"}",["T_WHITESPACE"," ",383],["T_CATCH","catch",383],["T_WHITESPACE"," ",383],"(",["T_STRING","Exception",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$e",383],")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n                ",383],["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_message",384],"(",["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","__",384],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to load addresses.'",384],")",",",["T_WHITESPACE"," ",384],["T_STRING","self",384],["T_DOUBLE_COLON","::",384],["T_STRING","MESSAGE_STATUS_ERROR",384],")",";",["T_WHITESPACE","\n                ",384],["T_STRING","Mage",385],["T_DOUBLE_COLON","::",385],["T_STRING","logException",385],"(",["T_VARIABLE","$e",385],")",";",["T_WHITESPACE","\n            ",385],"}",["T_WHITESPACE","\n        ",386],"}",["T_WHITESPACE"," ",387],["T_ELSE","else",387],["T_WHITESPACE"," ",387],"{",["T_WHITESPACE","\n            ",387],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",388],["T_WHITESPACE","\n            ",388],["T_VARIABLE","$message",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_STRING","Mage",389],["T_DOUBLE_COLON","::",389],["T_STRING","getModel",389],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",389],",",["T_WHITESPACE"," ",389],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",389],")",";",["T_WHITESPACE","\n            ",389],["T_VARIABLE","$message",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","addChild",390],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",390],",",["T_WHITESPACE"," ",390],["T_STRING","self",390],["T_DOUBLE_COLON","::",390],["T_STRING","MESSAGE_STATUS_ERROR",390],")",";",["T_WHITESPACE","\n            ",390],["T_VARIABLE","$message",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","addChild",391],"(",["T_CONSTANT_ENCAPSED_STRING","'is_empty_address_book'",391],",",["T_WHITESPACE"," ",391],["T_LNUMBER","1",391],")",";",["T_WHITESPACE","\n            ",391],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","getResponse",392],"(",")",["T_OBJECT_OPERATOR","->",392],["T_STRING","setBody",392],"(",["T_VARIABLE","$message",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","asNiceXml",392],"(",")",")",";",["T_WHITESPACE","\n        ",392],"}",["T_WHITESPACE","\n    ",393],"}",["T_WHITESPACE","\n\n    ",394],["T_DOC_COMMENT","\/**\n     * Customer add\/edit address form\n     *\n     * @return null\n     *\/",396],["T_WHITESPACE","\n    ",400],["T_PUBLIC","public",401],["T_WHITESPACE"," ",401],["T_FUNCTION","function",401],["T_WHITESPACE"," ",401],["T_STRING","addressFormAction",401],"(",")",["T_WHITESPACE","\n    ",401],"{",["T_WHITESPACE","\n        ",402],["T_IF","if",403],["T_WHITESPACE"," ",403],"(","!",["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_isCustomerLoggedIn",403],"(",")",")",["T_WHITESPACE"," ",403],"{",["T_WHITESPACE","\n            ",403],["T_RETURN","return",404],";",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE","\n\n        ",405],["T_VARIABLE","$address",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_STRING","Mage",407],["T_DOUBLE_COLON","::",407],["T_STRING","getModel",407],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",407],")",";",["T_WHITESPACE","\n        ",407],["T_VARIABLE","$addressId",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_INT_CAST","(int)",408],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getRequest",408],"(",")",["T_OBJECT_OPERATOR","->",408],["T_STRING","getParam",408],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",408],")",";",["T_WHITESPACE","\n        ",408],["T_TRY","try",409],["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_IF","if",410],["T_WHITESPACE"," ",410],"(",["T_VARIABLE","$addressId",410],")",["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n                ",410],["T_DOC_COMMENT","\/**\n                 * Init address object\n                 *\/",411],["T_WHITESPACE","\n                ",413],["T_VARIABLE","$address",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","load",414],"(",["T_VARIABLE","$addressId",414],")",";",["T_WHITESPACE","\n                ",414],["T_IF","if",415],["T_WHITESPACE"," ",415],"(",["T_VARIABLE","$address",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getCustomerId",415],"(",")",["T_WHITESPACE"," ",415],["T_IS_NOT_EQUAL","!=",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_getSession",415],"(",")",["T_OBJECT_OPERATOR","->",415],["T_STRING","getCustomerId",415],"(",")",")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n                    ",415],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","_message",416],"(",["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","__",416],"(",["T_CONSTANT_ENCAPSED_STRING","'Specified address does not exist.'",416],")",",",["T_WHITESPACE"," ",416],["T_STRING","self",416],["T_DOUBLE_COLON","::",416],["T_STRING","MESSAGE_STATUS_ERROR",416],")",";",["T_WHITESPACE","\n                    ",416],["T_RETURN","return",417],";",["T_WHITESPACE","\n                ",417],"}",["T_WHITESPACE","\n            ",418],"}",["T_WHITESPACE","\n            ",419],["T_DOC_COMMENT","\/** @var $formBlock Mage_XmlConnect_Block_Customer_Address_Form *\/",420],["T_WHITESPACE","\n            ",420],["T_VARIABLE","$formBlock",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","loadLayout",421],"(",["T_STRING","false",421],")",["T_OBJECT_OPERATOR","->",421],["T_STRING","getLayout",421],"(",")",["T_OBJECT_OPERATOR","->",421],["T_STRING","getBlock",421],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect.customer.address.form'",421],")",["T_WHITESPACE","\n                ",421],["T_OBJECT_OPERATOR","->",422],["T_STRING","setAddress",422],"(",["T_VARIABLE","$address",422],")",";",["T_WHITESPACE","\n            ",422],["T_IF","if",423],["T_WHITESPACE"," ",423],"(",["T_STRING","Mage",423],["T_DOUBLE_COLON","::",423],["T_STRING","helper",423],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",423],")",["T_OBJECT_OPERATOR","->",423],["T_STRING","checkApiVersion",423],"(",["T_STRING","Mage_XmlConnect_Helper_Data",423],["T_DOUBLE_COLON","::",423],["T_STRING","DEVICE_API_V_23",423],")",")",["T_WHITESPACE"," ",423],"{",["T_WHITESPACE","\n                ",423],["T_VARIABLE","$formBlock",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","setNewCountryList",424],"(",["T_STRING","true",424],")",";",["T_WHITESPACE","\n            ",424],"}",["T_WHITESPACE","\n            ",425],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","renderLayout",426],"(",")",";",["T_WHITESPACE","\n        ",426],"}",["T_WHITESPACE"," ",427],["T_CATCH","catch",427],["T_WHITESPACE"," ",427],"(",["T_STRING","Mage_Core_Exception",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$e",427],")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n            ",427],["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","_message",428],"(",["T_VARIABLE","$e",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getMessage",428],"(",")",",",["T_WHITESPACE"," ",428],["T_STRING","self",428],["T_DOUBLE_COLON","::",428],["T_STRING","MESSAGE_STATUS_ERROR",428],")",";",["T_WHITESPACE","\n            ",428],["T_STRING","Mage",429],["T_DOUBLE_COLON","::",429],["T_STRING","logException",429],"(",["T_VARIABLE","$e",429],")",";",["T_WHITESPACE","\n        ",429],"}",["T_WHITESPACE"," ",430],["T_CATCH","catch",430],["T_WHITESPACE"," ",430],"(",["T_STRING","Exception",430],["T_WHITESPACE"," ",430],["T_VARIABLE","$e",430],")",["T_WHITESPACE"," ",430],"{",["T_WHITESPACE","\n            ",430],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_message",431],"(",["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","__",431],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t load customer form.'",431],")",",",["T_WHITESPACE"," ",431],["T_STRING","self",431],["T_DOUBLE_COLON","::",431],["T_STRING","MESSAGE_STATUS_ERROR",431],")",";",["T_WHITESPACE","\n            ",431],["T_STRING","Mage",432],["T_DOUBLE_COLON","::",432],["T_STRING","logException",432],"(",["T_VARIABLE","$e",432],")",";",["T_WHITESPACE","\n        ",432],"}",["T_WHITESPACE","\n    ",433],"}",["T_WHITESPACE","\n\n    ",434],["T_DOC_COMMENT","\/**\n     * Remove customer address\n     *\n     * @return null\n     *\/",436],["T_WHITESPACE","\n    ",440],["T_PUBLIC","public",441],["T_WHITESPACE"," ",441],["T_FUNCTION","function",441],["T_WHITESPACE"," ",441],["T_STRING","deleteAddressAction",441],"(",")",["T_WHITESPACE","\n    ",441],"{",["T_WHITESPACE","\n        ",442],["T_IF","if",443],["T_WHITESPACE"," ",443],"(","!",["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","_isCustomerLoggedIn",443],"(",")",")",["T_WHITESPACE"," ",443],"{",["T_WHITESPACE","\n            ",443],["T_RETURN","return",444],";",["T_WHITESPACE","\n        ",444],"}",["T_WHITESPACE","\n\n        ",445],["T_VARIABLE","$addressId",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getRequest",447],"(",")",["T_OBJECT_OPERATOR","->",447],["T_STRING","getParam",447],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",447],",",["T_WHITESPACE"," ",447],["T_STRING","false",447],")",";",["T_WHITESPACE","\n\n        ",447],["T_IF","if",449],["T_WHITESPACE"," ",449],"(",["T_VARIABLE","$addressId",449],")",["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$address",450],["T_WHITESPACE"," ",450],"=",["T_WHITESPACE"," ",450],["T_STRING","Mage",450],["T_DOUBLE_COLON","::",450],["T_STRING","getModel",450],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",450],")",["T_OBJECT_OPERATOR","->",450],["T_STRING","load",450],"(",["T_VARIABLE","$addressId",450],")",";",["T_WHITESPACE","\n\n            ",450],["T_COMMENT","\/\/ Validate address_id <=> customer_id\n",452],["T_WHITESPACE","            ",453],["T_IF","if",453],["T_WHITESPACE"," ",453],"(",["T_VARIABLE","$address",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","getCustomerId",453],"(",")",["T_WHITESPACE"," ",453],["T_IS_NOT_EQUAL","!=",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","_getSession",453],"(",")",["T_OBJECT_OPERATOR","->",453],["T_STRING","getCustomerId",453],"(",")",")",["T_WHITESPACE"," ",453],"{",["T_WHITESPACE","\n                ",453],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","_message",454],"(",["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","__",454],"(",["T_CONSTANT_ENCAPSED_STRING","'Address does not belong to this customer.'",454],")",",",["T_WHITESPACE"," ",454],["T_STRING","self",454],["T_DOUBLE_COLON","::",454],["T_STRING","MESSAGE_STATUS_ERROR",454],")",";",["T_WHITESPACE","\n                ",454],["T_RETURN","return",455],";",["T_WHITESPACE","\n            ",455],"}",["T_WHITESPACE","\n\n            ",456],["T_TRY","try",458],["T_WHITESPACE"," ",458],"{",["T_WHITESPACE","\n                ",458],["T_VARIABLE","$address",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","delete",459],"(",")",";",["T_WHITESPACE","\n                ",459],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","_message",460],"(",["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","__",460],"(",["T_CONSTANT_ENCAPSED_STRING","'Address has been deleted.'",460],")",",",["T_WHITESPACE"," ",460],["T_STRING","self",460],["T_DOUBLE_COLON","::",460],["T_STRING","MESSAGE_STATUS_SUCCESS",460],")",";",["T_WHITESPACE","\n            ",460],"}",["T_WHITESPACE"," ",461],["T_CATCH","catch",461],["T_WHITESPACE"," ",461],"(",["T_STRING","Exception",461],["T_WHITESPACE"," ",461],["T_VARIABLE","$e",461],")",["T_WHITESPACE"," ",461],"{",["T_WHITESPACE","\n                ",461],["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","_message",462],"(",["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","__",462],"(",["T_CONSTANT_ENCAPSED_STRING","'An error occurred while deleting the address.'",462],")",",",["T_WHITESPACE"," ",462],["T_STRING","self",462],["T_DOUBLE_COLON","::",462],["T_STRING","MESSAGE_STATUS_ERROR",462],")",";",["T_WHITESPACE","\n                ",462],["T_STRING","Mage",463],["T_DOUBLE_COLON","::",463],["T_STRING","logException",463],"(",["T_VARIABLE","$e",463],")",";",["T_WHITESPACE","\n            ",463],"}",["T_WHITESPACE","\n        ",464],"}",["T_WHITESPACE","\n    ",465],"}",["T_WHITESPACE","\n\n    ",466],["T_DOC_COMMENT","\/**\n     * Add\/Save customer address\n     *\n     * @return null\n     *\/",468],["T_WHITESPACE","\n    ",472],["T_PUBLIC","public",473],["T_WHITESPACE"," ",473],["T_FUNCTION","function",473],["T_WHITESPACE"," ",473],["T_STRING","saveAddressAction",473],"(",")",["T_WHITESPACE","\n    ",473],"{",["T_WHITESPACE","\n        ",474],["T_IF","if",475],["T_WHITESPACE"," ",475],"(","!",["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","_isCustomerLoggedIn",475],"(",")",")",["T_WHITESPACE"," ",475],"{",["T_WHITESPACE","\n            ",475],["T_RETURN","return",476],";",["T_WHITESPACE","\n        ",476],"}",["T_WHITESPACE","\n\n        ",477],["T_COMMENT","\/\/ Save data\n",479],["T_WHITESPACE","        ",480],["T_IF","if",480],["T_WHITESPACE"," ",480],"(",["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getRequest",480],"(",")",["T_OBJECT_OPERATOR","->",480],["T_STRING","isPost",480],"(",")",")",["T_WHITESPACE"," ",480],"{",["T_WHITESPACE","\n            ",480],["T_VARIABLE","$customer",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","_getSession",481],"(",")",["T_OBJECT_OPERATOR","->",481],["T_STRING","getCustomer",481],"(",")",";",["T_WHITESPACE","\n            ",481],["T_COMMENT","\/* @var $address Mage_Customer_Model_Address *\/",482],["T_WHITESPACE","\n            ",482],["T_VARIABLE","$address",483],["T_WHITESPACE","    ",483],"=",["T_WHITESPACE"," ",483],["T_STRING","Mage",483],["T_DOUBLE_COLON","::",483],["T_STRING","getModel",483],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",483],")",";",["T_WHITESPACE","\n            ",483],["T_VARIABLE","$addressId",484],["T_WHITESPACE","  ",484],"=",["T_WHITESPACE"," ",484],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getRequest",484],"(",")",["T_OBJECT_OPERATOR","->",484],["T_STRING","getParam",484],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",484],")",";",["T_WHITESPACE","\n            ",484],["T_IF","if",485],["T_WHITESPACE"," ",485],"(",["T_VARIABLE","$addressId",485],")",["T_WHITESPACE"," ",485],"{",["T_WHITESPACE","\n                ",485],["T_VARIABLE","$existsAddress",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$customer",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getAddressById",486],"(",["T_VARIABLE","$addressId",486],")",";",["T_WHITESPACE","\n                ",486],["T_IF","if",487],["T_WHITESPACE"," ",487],"(",["T_VARIABLE","$existsAddress",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getId",487],"(",")",["T_WHITESPACE"," ",487],["T_BOOLEAN_AND","&&",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$existsAddress",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getCustomerId",487],"(",")",["T_WHITESPACE"," ",487],["T_IS_EQUAL","==",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$customer",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getId",487],"(",")",")",["T_WHITESPACE"," ",487],"{",["T_WHITESPACE","\n                    ",487],["T_VARIABLE","$address",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","setId",488],"(",["T_VARIABLE","$existsAddress",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getId",488],"(",")",")",";",["T_WHITESPACE","\n                ",488],"}",["T_WHITESPACE","\n            ",489],"}",["T_WHITESPACE","\n\n            ",490],["T_VARIABLE","$errors",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_ARRAY","array",492],"(",")",";",["T_WHITESPACE","\n\n            ",492],["T_COMMENT","\/* @var $addressForm Mage_Customer_Model_Form *\/",494],["T_WHITESPACE","\n            ",494],["T_VARIABLE","$addressForm",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_STRING","Mage",495],["T_DOUBLE_COLON","::",495],["T_STRING","getModel",495],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",495],")",";",["T_WHITESPACE","\n            ",495],["T_VARIABLE","$addressForm",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","setFormCode",496],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_address_edit'",496],")",["T_OBJECT_OPERATOR","->",496],["T_STRING","setEntity",496],"(",["T_VARIABLE","$address",496],")",";",["T_WHITESPACE","\n            ",496],["T_VARIABLE","$addressData",497],["T_WHITESPACE","    ",497],"=",["T_WHITESPACE"," ",497],["T_VARIABLE","$addressForm",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","extractData",497],"(",["T_VARIABLE","$this",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getRequest",497],"(",")",")",";",["T_WHITESPACE","\n            ",497],["T_VARIABLE","$addressErrors",498],["T_WHITESPACE","  ",498],"=",["T_WHITESPACE"," ",498],["T_VARIABLE","$addressForm",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","validateData",498],"(",["T_VARIABLE","$addressData",498],")",";",["T_WHITESPACE","\n            ",498],["T_IF","if",499],["T_WHITESPACE"," ",499],"(",["T_VARIABLE","$addressErrors",499],["T_WHITESPACE"," ",499],["T_IS_NOT_IDENTICAL","!==",499],["T_WHITESPACE"," ",499],["T_STRING","true",499],")",["T_WHITESPACE"," ",499],"{",["T_WHITESPACE","\n                ",499],["T_VARIABLE","$errors",500],["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_VARIABLE","$addressErrors",500],";",["T_WHITESPACE","\n            ",500],"}",["T_WHITESPACE","\n\n            ",501],["T_TRY","try",503],["T_WHITESPACE"," ",503],"{",["T_WHITESPACE","\n                ",503],["T_VARIABLE","$addressForm",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","compactData",504],"(",["T_VARIABLE","$addressData",504],")",";",["T_WHITESPACE","\n                ",504],["T_VARIABLE","$address",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","setCustomerId",505],"(",["T_VARIABLE","$customer",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getId",505],"(",")",")",["T_WHITESPACE","\n                    ",505],["T_OBJECT_OPERATOR","->",506],["T_STRING","setIsDefaultBilling",506],"(",["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getRequest",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","getParam",506],"(",["T_CONSTANT_ENCAPSED_STRING","'default_billing'",506],",",["T_WHITESPACE"," ",506],["T_STRING","false",506],")",")",["T_WHITESPACE","\n                    ",506],["T_OBJECT_OPERATOR","->",507],["T_STRING","setIsDefaultShipping",507],"(",["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getRequest",507],"(",")",["T_OBJECT_OPERATOR","->",507],["T_STRING","getParam",507],"(",["T_CONSTANT_ENCAPSED_STRING","'default_shipping'",507],",",["T_WHITESPACE"," ",507],["T_STRING","false",507],")",")",";",["T_WHITESPACE","\n\n                ",507],["T_VARIABLE","$addressErrors",509],["T_WHITESPACE"," ",509],"=",["T_WHITESPACE"," ",509],["T_VARIABLE","$address",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","validate",509],"(",")",";",["T_WHITESPACE","\n                ",509],["T_IF","if",510],["T_WHITESPACE"," ",510],"(",["T_VARIABLE","$addressErrors",510],["T_WHITESPACE"," ",510],["T_IS_NOT_IDENTICAL","!==",510],["T_WHITESPACE"," ",510],["T_STRING","true",510],")",["T_WHITESPACE"," ",510],"{",["T_WHITESPACE","\n                    ",510],["T_VARIABLE","$errors",511],["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_STRING","array_merge",511],"(",["T_VARIABLE","$errors",511],",",["T_WHITESPACE"," ",511],["T_VARIABLE","$addressErrors",511],")",";",["T_WHITESPACE","\n                ",511],"}",["T_WHITESPACE","\n\n                ",512],["T_VARIABLE","$addressValidation",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_STRING","count",514],"(",["T_VARIABLE","$errors",514],")",["T_WHITESPACE"," ",514],["T_IS_EQUAL","==",514],["T_WHITESPACE"," ",514],["T_LNUMBER","0",514],";",["T_WHITESPACE","\n\n                ",514],["T_IF","if",516],["T_WHITESPACE"," ",516],"(",["T_STRING","true",516],["T_WHITESPACE"," ",516],["T_IS_IDENTICAL","===",516],["T_WHITESPACE"," ",516],["T_VARIABLE","$addressValidation",516],")",["T_WHITESPACE"," ",516],"{",["T_WHITESPACE","\n                    ",516],["T_VARIABLE","$address",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","save",517],"(",")",";",["T_WHITESPACE","\n                    ",517],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",518],["T_WHITESPACE","\n                    ",518],["T_VARIABLE","$message",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_STRING","Mage",519],["T_DOUBLE_COLON","::",519],["T_STRING","getModel",519],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",519],",",["T_WHITESPACE"," ",519],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",519],")",";",["T_WHITESPACE","\n                    ",519],["T_VARIABLE","$message",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","addChild",520],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",520],",",["T_WHITESPACE"," ",520],["T_STRING","self",520],["T_DOUBLE_COLON","::",520],["T_STRING","MESSAGE_STATUS_SUCCESS",520],")",";",["T_WHITESPACE","\n                    ",520],["T_VARIABLE","$message",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","addChild",521],"(",["T_CONSTANT_ENCAPSED_STRING","'text'",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","__",521],"(",["T_CONSTANT_ENCAPSED_STRING","'Address has been saved.'",521],")",")",";",["T_WHITESPACE","\n                    ",521],["T_VARIABLE","$message",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","addChild",522],"(",["T_CONSTANT_ENCAPSED_STRING","'address_id'",522],",",["T_WHITESPACE"," ",522],["T_VARIABLE","$address",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getId",522],"(",")",")",";",["T_WHITESPACE","\n                    ",522],["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","getResponse",523],"(",")",["T_OBJECT_OPERATOR","->",523],["T_STRING","setBody",523],"(",["T_VARIABLE","$message",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","asNiceXml",523],"(",")",")",";",["T_WHITESPACE","\n                    ",523],["T_RETURN","return",524],";",["T_WHITESPACE","\n                ",524],"}",["T_WHITESPACE"," ",525],["T_ELSE","else",525],["T_WHITESPACE"," ",525],"{",["T_WHITESPACE","\n                    ",525],["T_IF","if",526],["T_WHITESPACE"," ",526],"(",["T_STRING","is_array",526],"(",["T_VARIABLE","$errors",526],")",")",["T_WHITESPACE"," ",526],"{",["T_WHITESPACE","\n                        ",526],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","_message",527],"(",["T_STRING","implode",527],"(",["T_CONSTANT_ENCAPSED_STRING","'. '",527],",",["T_WHITESPACE"," ",527],["T_VARIABLE","$errors",527],")",",",["T_WHITESPACE"," ",527],["T_STRING","self",527],["T_DOUBLE_COLON","::",527],["T_STRING","MESSAGE_STATUS_ERROR",527],")",";",["T_WHITESPACE","\n                    ",527],"}",["T_WHITESPACE"," ",528],["T_ELSE","else",528],["T_WHITESPACE"," ",528],"{",["T_WHITESPACE","\n                        ",528],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","_message",529],"(",["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","__",529],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t save address.'",529],")",",",["T_WHITESPACE"," ",529],["T_STRING","self",529],["T_DOUBLE_COLON","::",529],["T_STRING","MESSAGE_STATUS_ERROR",529],")",";",["T_WHITESPACE","\n                    ",529],"}",["T_WHITESPACE","\n                ",530],"}",["T_WHITESPACE","\n            ",531],"}",["T_WHITESPACE"," ",532],["T_CATCH","catch",532],["T_WHITESPACE"," ",532],"(",["T_STRING","Mage_Core_Exception",532],["T_WHITESPACE"," ",532],["T_VARIABLE","$e",532],")",["T_WHITESPACE"," ",532],"{",["T_WHITESPACE","\n                ",532],["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","_message",533],"(",["T_VARIABLE","$e",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getMessage",533],"(",")",",",["T_WHITESPACE"," ",533],["T_STRING","self",533],["T_DOUBLE_COLON","::",533],["T_STRING","MESSAGE_STATUS_ERROR",533],")",";",["T_WHITESPACE","\n            ",533],"}",["T_WHITESPACE"," ",534],["T_CATCH","catch",534],["T_WHITESPACE"," ",534],"(",["T_STRING","Exception",534],["T_WHITESPACE"," ",534],["T_VARIABLE","$e",534],")",["T_WHITESPACE"," ",534],"{",["T_WHITESPACE","\n                ",534],["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","_message",535],"(",["T_VARIABLE","$this",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","__",535],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t save address.'",535],")",",",["T_WHITESPACE"," ",535],["T_STRING","self",535],["T_DOUBLE_COLON","::",535],["T_STRING","MESSAGE_STATUS_ERROR",535],")",";",["T_WHITESPACE","\n                ",535],["T_STRING","Mage",536],["T_DOUBLE_COLON","::",536],["T_STRING","logException",536],"(",["T_VARIABLE","$e",536],")",";",["T_WHITESPACE","\n            ",536],"}",["T_WHITESPACE","\n        ",537],"}",["T_WHITESPACE"," ",538],["T_ELSE","else",538],["T_WHITESPACE"," ",538],"{",["T_WHITESPACE","\n            ",538],["T_VARIABLE","$this",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","_message",539],"(",["T_VARIABLE","$this",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","__",539],"(",["T_CONSTANT_ENCAPSED_STRING","'Address data not specified.'",539],")",",",["T_WHITESPACE"," ",539],["T_STRING","self",539],["T_DOUBLE_COLON","::",539],["T_STRING","MESSAGE_STATUS_ERROR",539],")",";",["T_WHITESPACE","\n        ",539],"}",["T_WHITESPACE","\n    ",540],"}",["T_WHITESPACE","\n\n    ",541],["T_DOC_COMMENT","\/**\n     * Customer orders list\n     *\n     * @return null\n     *\/",543],["T_WHITESPACE","\n    ",547],["T_PUBLIC","public",548],["T_WHITESPACE"," ",548],["T_FUNCTION","function",548],["T_WHITESPACE"," ",548],["T_STRING","orderListAction",548],"(",")",["T_WHITESPACE","\n    ",548],"{",["T_WHITESPACE","\n        ",549],["T_IF","if",550],["T_WHITESPACE"," ",550],"(","!",["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_isCustomerLoggedIn",550],"(",")",")",["T_WHITESPACE"," ",550],"{",["T_WHITESPACE","\n            ",550],["T_RETURN","return",551],";",["T_WHITESPACE","\n        ",551],"}",["T_WHITESPACE","\n\n        ",552],["T_TRY","try",554],["T_WHITESPACE"," ",554],"{",["T_WHITESPACE","\n            ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","loadLayout",555],"(",["T_STRING","false",555],")",";",["T_WHITESPACE","\n            ",555],["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","renderLayout",556],"(",")",";",["T_WHITESPACE","\n        ",556],"}",["T_WHITESPACE"," ",557],["T_CATCH","catch",557],["T_WHITESPACE"," ",557],"(",["T_STRING","Mage_Core_Exception",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$e",557],")",["T_WHITESPACE"," ",557],"{",["T_WHITESPACE","\n            ",557],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","_message",558],"(",["T_VARIABLE","$e",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getMessage",558],"(",")",",",["T_WHITESPACE"," ",558],["T_STRING","self",558],["T_DOUBLE_COLON","::",558],["T_STRING","MESSAGE_STATUS_ERROR",558],")",";",["T_WHITESPACE","\n        ",558],"}",["T_WHITESPACE"," ",559],["T_CATCH","catch",559],["T_WHITESPACE"," ",559],"(",["T_STRING","Exception",559],["T_WHITESPACE"," ",559],["T_VARIABLE","$e",559],")",["T_WHITESPACE"," ",559],"{",["T_WHITESPACE","\n            ",559],["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","_message",560],"(",["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","__",560],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to load order list.'",560],")",",",["T_WHITESPACE"," ",560],["T_STRING","self",560],["T_DOUBLE_COLON","::",560],["T_STRING","MESSAGE_STATUS_ERROR",560],")",";",["T_WHITESPACE","\n            ",560],["T_STRING","Mage",561],["T_DOUBLE_COLON","::",561],["T_STRING","logException",561],"(",["T_VARIABLE","$e",561],")",";",["T_WHITESPACE","\n        ",561],"}",["T_WHITESPACE","\n    ",562],"}",["T_WHITESPACE","\n\n    ",563],["T_DOC_COMMENT","\/**\n     * Customer order details\n     *\n     * @return null\n     *\/",565],["T_WHITESPACE","\n    ",569],["T_PUBLIC","public",570],["T_WHITESPACE"," ",570],["T_FUNCTION","function",570],["T_WHITESPACE"," ",570],["T_STRING","orderDetailsAction",570],"(",")",["T_WHITESPACE","\n    ",570],"{",["T_WHITESPACE","\n        ",571],["T_TRY","try",572],["T_WHITESPACE"," ",572],"{",["T_WHITESPACE","\n            ",572],["T_IF","if",573],["T_WHITESPACE"," ",573],"(","!",["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","_isCustomerLoggedIn",573],"(",")",")",["T_WHITESPACE"," ",573],"{",["T_WHITESPACE","\n                ",573],["T_RETURN","return",574],";",["T_WHITESPACE","\n            ",574],"}",["T_WHITESPACE","\n\n            ",575],["T_VARIABLE","$orderId",577],["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_INT_CAST","(int)",577],["T_WHITESPACE"," ",577],["T_VARIABLE","$this",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","getRequest",577],"(",")",["T_OBJECT_OPERATOR","->",577],["T_STRING","getParam",577],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",577],")",";",["T_WHITESPACE","\n            ",577],["T_IF","if",578],["T_WHITESPACE"," ",578],"(","!",["T_VARIABLE","$orderId",578],")",["T_WHITESPACE"," ",578],"{",["T_WHITESPACE","\n                ",578],["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","_message",579],"(",["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","__",579],"(",["T_CONSTANT_ENCAPSED_STRING","'Order id is not specified.'",579],")",",",["T_WHITESPACE"," ",579],["T_STRING","self",579],["T_DOUBLE_COLON","::",579],["T_STRING","MESSAGE_STATUS_ERROR",579],")",";",["T_WHITESPACE","\n                ",579],["T_RETURN","return",580],";",["T_WHITESPACE","\n            ",580],"}",["T_WHITESPACE","\n\n            ",581],["T_VARIABLE","$order",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_STRING","Mage",583],["T_DOUBLE_COLON","::",583],["T_STRING","getModel",583],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",583],")",["T_OBJECT_OPERATOR","->",583],["T_STRING","load",583],"(",["T_VARIABLE","$orderId",583],")",";",["T_WHITESPACE","\n\n            ",583],["T_IF","if",585],["T_WHITESPACE"," ",585],"(",["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","_canViewOrder",585],"(",["T_VARIABLE","$order",585],")",")",["T_WHITESPACE"," ",585],"{",["T_WHITESPACE","\n                ",585],["T_STRING","Mage",586],["T_DOUBLE_COLON","::",586],["T_STRING","register",586],"(",["T_CONSTANT_ENCAPSED_STRING","'current_order'",586],",",["T_WHITESPACE"," ",586],["T_VARIABLE","$order",586],")",";",["T_WHITESPACE","\n            ",586],"}",["T_WHITESPACE"," ",587],["T_ELSE","else",587],["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n                ",587],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","_message",588],"(",["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","__",588],"(",["T_CONSTANT_ENCAPSED_STRING","'Order is not available.'",588],")",",",["T_WHITESPACE"," ",588],["T_STRING","self",588],["T_DOUBLE_COLON","::",588],["T_STRING","MESSAGE_STATUS_ERROR",588],")",";",["T_WHITESPACE","\n                ",588],["T_RETURN","return",589],";",["T_WHITESPACE","\n            ",589],"}",["T_WHITESPACE","\n\n            ",590],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","loadLayout",592],"(",["T_STRING","false",592],")",";",["T_WHITESPACE","\n            ",592],["T_IF","if",593],["T_WHITESPACE"," ",593],"(",["T_STRING","Mage",593],["T_DOUBLE_COLON","::",593],["T_STRING","helper",593],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",593],")",["T_OBJECT_OPERATOR","->",593],["T_STRING","checkApiVersion",593],"(",["T_STRING","Mage_XmlConnect_Helper_Data",593],["T_DOUBLE_COLON","::",593],["T_STRING","DEVICE_API_V_23",593],")",")",["T_WHITESPACE"," ",593],"{",["T_WHITESPACE","\n                ",593],["T_VARIABLE","$this",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","getLayout",594],"(",")",["T_OBJECT_OPERATOR","->",594],["T_STRING","getBlock",594],"(",["T_CONSTANT_ENCAPSED_STRING","'order.items'",594],")",["T_OBJECT_OPERATOR","->",594],["T_STRING","setNewApi",594],"(",["T_STRING","true",594],")",";",["T_WHITESPACE","\n                ",594],["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","getLayout",595],"(",")",["T_OBJECT_OPERATOR","->",595],["T_STRING","getBlock",595],"(",["T_CONSTANT_ENCAPSED_STRING","'order.totals'",595],")",["T_OBJECT_OPERATOR","->",595],["T_STRING","setNewApi",595],"(",["T_STRING","true",595],")",";",["T_WHITESPACE","\n            ",595],"}",["T_WHITESPACE","\n            ",596],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","renderLayout",597],"(",")",";",["T_WHITESPACE","\n            ",597],["T_RETURN","return",598],";",["T_WHITESPACE","\n        ",598],"}",["T_WHITESPACE"," ",599],["T_CATCH","catch",599],["T_WHITESPACE"," ",599],"(",["T_STRING","Mage_Core_Exception",599],["T_WHITESPACE"," ",599],["T_VARIABLE","$e",599],")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n            ",599],["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","_message",600],"(",["T_VARIABLE","$e",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","getMessage",600],"(",")",",",["T_WHITESPACE"," ",600],["T_STRING","self",600],["T_DOUBLE_COLON","::",600],["T_STRING","MESSAGE_STATUS_ERROR",600],")",";",["T_WHITESPACE","\n        ",600],"}",["T_WHITESPACE"," ",601],["T_CATCH","catch",601],["T_WHITESPACE"," ",601],"(",["T_STRING","Exception",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$e",601],")",["T_WHITESPACE"," ",601],"{",["T_WHITESPACE","\n            ",601],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","_message",602],"(",["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","__",602],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to render an order.'",602],")",",",["T_WHITESPACE"," ",602],["T_STRING","self",602],["T_DOUBLE_COLON","::",602],["T_STRING","MESSAGE_STATUS_ERROR",602],")",";",["T_WHITESPACE","\n            ",602],["T_STRING","Mage",603],["T_DOUBLE_COLON","::",603],["T_STRING","logException",603],"(",["T_VARIABLE","$e",603],")",";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE","\n    ",604],"}",["T_WHITESPACE","\n\n    ",605],["T_DOC_COMMENT","\/**\n     * Check order view availability\n     *\n     * @param   Mage_Sales_Model_Order $order\n     * @return  bool\n     *\/",607],["T_WHITESPACE","\n    ",612],["T_PROTECTED","protected",613],["T_WHITESPACE"," ",613],["T_FUNCTION","function",613],["T_WHITESPACE"," ",613],["T_STRING","_canViewOrder",613],"(",["T_VARIABLE","$order",613],")",["T_WHITESPACE","\n    ",613],"{",["T_WHITESPACE","\n        ",614],["T_VARIABLE","$customerId",615],["T_WHITESPACE"," ",615],"=",["T_WHITESPACE"," ",615],["T_STRING","Mage",615],["T_DOUBLE_COLON","::",615],["T_STRING","getSingleton",615],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",615],")",["T_OBJECT_OPERATOR","->",615],["T_STRING","getCustomerId",615],"(",")",";",["T_WHITESPACE","\n        ",615],["T_VARIABLE","$availableStates",616],["T_WHITESPACE"," ",616],"=",["T_WHITESPACE"," ",616],["T_STRING","Mage",616],["T_DOUBLE_COLON","::",616],["T_STRING","getSingleton",616],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_config'",616],")",["T_OBJECT_OPERATOR","->",616],["T_STRING","getVisibleOnFrontStates",616],"(",")",";",["T_WHITESPACE","\n        ",616],["T_IF","if",617],["T_WHITESPACE"," ",617],"(",["T_VARIABLE","$order",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getId",617],"(",")",["T_WHITESPACE"," ",617],["T_BOOLEAN_AND","&&",617],["T_WHITESPACE"," ",617],["T_VARIABLE","$order",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getCustomerId",617],"(",")",["T_WHITESPACE"," ",617],["T_BOOLEAN_AND","&&",617],["T_WHITESPACE"," ",617],"(",["T_VARIABLE","$order",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","getCustomerId",617],"(",")",["T_WHITESPACE"," ",617],["T_IS_EQUAL","==",617],["T_WHITESPACE"," ",617],["T_VARIABLE","$customerId",617],")",["T_WHITESPACE","\n            ",617],["T_BOOLEAN_AND","&&",618],["T_WHITESPACE"," ",618],["T_STRING","in_array",618],"(",["T_VARIABLE","$order",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getState",618],"(",")",",",["T_WHITESPACE"," ",618],["T_VARIABLE","$availableStates",618],",",["T_WHITESPACE"," ",618],["T_STRING","true",618],")",["T_WHITESPACE","\n        ",618],")",["T_WHITESPACE"," ",619],"{",["T_WHITESPACE","\n            ",619],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_STRING","true",620],";",["T_WHITESPACE","\n        ",620],"}",["T_WHITESPACE","\n        ",621],["T_RETURN","return",622],["T_WHITESPACE"," ",622],["T_STRING","false",622],";",["T_WHITESPACE","\n    ",622],"}",["T_WHITESPACE","\n\n    ",623],["T_DOC_COMMENT","\/**\n     * Check if customer is loggined\n     *\n     * @return null\n     *\/",625],["T_WHITESPACE","\n    ",629],["T_PUBLIC","public",630],["T_WHITESPACE"," ",630],["T_FUNCTION","function",630],["T_WHITESPACE"," ",630],["T_STRING","isLogginedAction",630],"(",")",["T_WHITESPACE","\n    ",630],"{",["T_WHITESPACE","\n        ",631],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",632],["T_WHITESPACE","\n        ",632],["T_VARIABLE","$message",633],["T_WHITESPACE"," ",633],"=",["T_WHITESPACE"," ",633],["T_STRING","Mage",633],["T_DOUBLE_COLON","::",633],["T_STRING","getModel",633],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",633],",",["T_WHITESPACE"," ",633],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",633],")",";",["T_WHITESPACE","\n        ",633],["T_VARIABLE","$message",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","addChild",634],"(",["T_CONSTANT_ENCAPSED_STRING","'is_loggined'",634],",",["T_WHITESPACE"," ",634],["T_INT_CAST","(int)",634],["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","_getSession",634],"(",")",["T_OBJECT_OPERATOR","->",634],["T_STRING","isLoggedIn",634],"(",")",")",";",["T_WHITESPACE","\n        ",634],["T_VARIABLE","$this",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","getResponse",635],"(",")",["T_OBJECT_OPERATOR","->",635],["T_STRING","setBody",635],"(",["T_VARIABLE","$message",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","asNiceXml",635],"(",")",")",";",["T_WHITESPACE","\n    ",635],"}",["T_WHITESPACE","\n\n    ",636],["T_DOC_COMMENT","\/**\n     * Filtering posted data. Converting localized data if needed\n     *\n     * @param array $data\n     * @return array\n     *\/",638],["T_WHITESPACE","\n    ",643],["T_PROTECTED","protected",644],["T_WHITESPACE"," ",644],["T_FUNCTION","function",644],["T_WHITESPACE"," ",644],["T_STRING","_filterPostData",644],"(",["T_VARIABLE","$data",644],")",["T_WHITESPACE","\n    ",644],"{",["T_WHITESPACE","\n        ",645],["T_VARIABLE","$data",646],["T_WHITESPACE"," ",646],"=",["T_WHITESPACE"," ",646],["T_VARIABLE","$this",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","_filterDates",646],"(",["T_VARIABLE","$data",646],",",["T_WHITESPACE"," ",646],["T_ARRAY","array",646],"(",["T_CONSTANT_ENCAPSED_STRING","'dob'",646],")",")",";",["T_WHITESPACE","\n        ",646],["T_RETURN","return",647],["T_WHITESPACE"," ",647],["T_VARIABLE","$data",647],";",["T_WHITESPACE","\n    ",647],"}",["T_WHITESPACE","\n\n    ",648],["T_DOC_COMMENT","\/**\n     * Get customer session model\n     *\n     * @return Mage_Customer_Model_Session\n     *\/",650],["T_WHITESPACE","\n    ",654],["T_PROTECTED","protected",655],["T_WHITESPACE"," ",655],["T_FUNCTION","function",655],["T_WHITESPACE"," ",655],["T_STRING","_getSession",655],"(",")",["T_WHITESPACE","\n    ",655],"{",["T_WHITESPACE","\n        ",656],["T_RETURN","return",657],["T_WHITESPACE"," ",657],["T_STRING","Mage",657],["T_DOUBLE_COLON","::",657],["T_STRING","getSingleton",657],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",657],")",";",["T_WHITESPACE","\n    ",657],"}",["T_WHITESPACE","\n\n    ",658],["T_DOC_COMMENT","\/**\n     * Store Credit info\n     *\n     * @return null\n     *\/",660],["T_WHITESPACE","\n    ",664],["T_PUBLIC","public",665],["T_WHITESPACE"," ",665],["T_FUNCTION","function",665],["T_WHITESPACE"," ",665],["T_STRING","storeCreditAction",665],"(",")",["T_WHITESPACE","\n    ",665],"{",["T_WHITESPACE","\n        ",666],["T_TRY","try",667],["T_WHITESPACE"," ",667],"{",["T_WHITESPACE","\n            ",667],["T_DOC_COMMENT","\/**\n             * Check is available Customer Balance\n             *\/",668],["T_WHITESPACE","\n            ",670],["T_IF","if",671],["T_WHITESPACE"," ",671],"(","!",["T_STRING","is_object",671],"(",["T_STRING","Mage",671],["T_DOUBLE_COLON","::",671],["T_STRING","getConfig",671],"(",")",["T_OBJECT_OPERATOR","->",671],["T_STRING","getNode",671],"(",["T_CONSTANT_ENCAPSED_STRING","'modules\/Enterprise_CustomerBalance'",671],")",")",")",["T_WHITESPACE"," ",671],"{",["T_WHITESPACE","\n                ",671],["T_VARIABLE","$this",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","_message",672],"(",["T_WHITESPACE","\n                    ",672],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","__",673],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer balance available in enterprise version of Magento only.'",673],")",",",["T_WHITESPACE","\n                    ",673],["T_STRING","self",674],["T_DOUBLE_COLON","::",674],["T_STRING","MESSAGE_STATUS_ERROR",674],["T_WHITESPACE","\n                ",674],")",";",["T_WHITESPACE","\n                ",675],["T_RETURN","return",676],";",["T_WHITESPACE","\n            ",676],"}",["T_WHITESPACE","\n            ",677],["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","loadLayout",678],"(",["T_STRING","false",678],")",";",["T_WHITESPACE","\n            ",678],["T_VARIABLE","$this",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","renderLayout",679],"(",")",";",["T_WHITESPACE","\n            ",679],["T_RETURN","return",680],";",["T_WHITESPACE","\n        ",680],"}",["T_WHITESPACE"," ",681],["T_CATCH","catch",681],["T_WHITESPACE"," ",681],"(",["T_STRING","Mage_Core_Exception",681],["T_WHITESPACE"," ",681],["T_VARIABLE","$e",681],")",["T_WHITESPACE"," ",681],"{",["T_WHITESPACE","\n            ",681],["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","_message",682],"(",["T_VARIABLE","$e",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getMessage",682],"(",")",",",["T_WHITESPACE"," ",682],["T_STRING","self",682],["T_DOUBLE_COLON","::",682],["T_STRING","MESSAGE_STATUS_ERROR",682],")",";",["T_WHITESPACE","\n        ",682],"}",["T_WHITESPACE"," ",683],["T_CATCH","catch",683],["T_WHITESPACE"," ",683],"(",["T_STRING","Exception",683],["T_WHITESPACE"," ",683],["T_VARIABLE","$e",683],")",["T_WHITESPACE"," ",683],"{",["T_WHITESPACE","\n            ",683],["T_VARIABLE","$this",684],["T_OBJECT_OPERATOR","->",684],["T_STRING","_message",684],"(",["T_VARIABLE","$this",684],["T_OBJECT_OPERATOR","->",684],["T_STRING","__",684],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to render the store credits.'",684],")",",",["T_WHITESPACE"," ",684],["T_STRING","self",684],["T_DOUBLE_COLON","::",684],["T_STRING","MESSAGE_STATUS_ERROR",684],")",";",["T_WHITESPACE","\n            ",684],["T_STRING","Mage",685],["T_DOUBLE_COLON","::",685],["T_STRING","logException",685],"(",["T_VARIABLE","$e",685],")",";",["T_WHITESPACE","\n        ",685],"}",["T_WHITESPACE","\n    ",686],"}",["T_WHITESPACE","\n\n    ",687],["T_DOC_COMMENT","\/**\n     * Check Gift card action\n     *\n     * @return null\n     *\/",689],["T_WHITESPACE","\n    ",693],["T_PUBLIC","public",694],["T_WHITESPACE"," ",694],["T_FUNCTION","function",694],["T_WHITESPACE"," ",694],["T_STRING","giftcardCheckAction",694],"(",")",["T_WHITESPACE","\n    ",694],"{",["T_WHITESPACE","\n        ",695],["T_TRY","try",696],["T_WHITESPACE"," ",696],"{",["T_WHITESPACE","\n            ",696],["T_DOC_COMMENT","\/**\n             * Check is available Customer Balance\n             *\/",697],["T_WHITESPACE","\n            ",699],["T_IF","if",700],["T_WHITESPACE"," ",700],"(","!",["T_STRING","is_object",700],"(",["T_STRING","Mage",700],["T_DOUBLE_COLON","::",700],["T_STRING","getConfig",700],"(",")",["T_OBJECT_OPERATOR","->",700],["T_STRING","getNode",700],"(",["T_CONSTANT_ENCAPSED_STRING","'modules\/Enterprise_GiftCardAccount'",700],")",")",")",["T_WHITESPACE"," ",700],"{",["T_WHITESPACE","\n                ",700],["T_VARIABLE","$this",701],["T_OBJECT_OPERATOR","->",701],["T_STRING","_message",701],"(",["T_WHITESPACE","\n                    ",701],["T_VARIABLE","$this",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","__",702],"(",["T_CONSTANT_ENCAPSED_STRING","'Gift card account available in enterprise version of Magento only.'",702],")",",",["T_WHITESPACE","\n                    ",702],["T_STRING","self",703],["T_DOUBLE_COLON","::",703],["T_STRING","MESSAGE_STATUS_ERROR",703],["T_WHITESPACE","\n                ",703],")",";",["T_WHITESPACE","\n                ",704],["T_RETURN","return",705],";",["T_WHITESPACE","\n            ",705],"}",["T_WHITESPACE","\n            ",706],["T_VARIABLE","$code",707],["T_WHITESPACE"," ",707],"=",["T_WHITESPACE"," ",707],["T_VARIABLE","$this",707],["T_OBJECT_OPERATOR","->",707],["T_STRING","getRequest",707],"(",")",["T_OBJECT_OPERATOR","->",707],["T_STRING","getPost",707],"(",["T_CONSTANT_ENCAPSED_STRING","'giftcard_code'",707],",",["T_WHITESPACE"," ",707],["T_CONSTANT_ENCAPSED_STRING","''",707],")",";",["T_WHITESPACE","\n            ",707],["T_IF","if",708],["T_WHITESPACE"," ",708],"(","!",["T_VARIABLE","$code",708],")",["T_WHITESPACE"," ",708],"{",["T_WHITESPACE","\n                ",708],["T_VARIABLE","$this",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","_message",709],"(",["T_VARIABLE","$this",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","__",709],"(",["T_CONSTANT_ENCAPSED_STRING","'Gift Card code is empty.'",709],")",",",["T_WHITESPACE"," ",709],["T_STRING","self",709],["T_DOUBLE_COLON","::",709],["T_STRING","MESSAGE_STATUS_ERROR",709],")",";",["T_WHITESPACE","\n                ",709],["T_RETURN","return",710],";",["T_WHITESPACE","\n            ",710],"}",["T_WHITESPACE","\n            ",711],["T_COMMENT","\/* @var $card Enterprise_GiftCardAccount_Model_Giftcardaccount *\/",712],["T_WHITESPACE","\n            ",712],["T_VARIABLE","$card",713],["T_WHITESPACE"," ",713],"=",["T_WHITESPACE"," ",713],["T_STRING","Mage",713],["T_DOUBLE_COLON","::",713],["T_STRING","getModel",713],"(",["T_CONSTANT_ENCAPSED_STRING","'enterprise_giftcardaccount\/giftcardaccount'",713],")",["T_OBJECT_OPERATOR","->",713],["T_STRING","loadByCode",713],"(",["T_VARIABLE","$code",713],")",";",["T_WHITESPACE","\n            ",713],["T_STRING","Mage",714],["T_DOUBLE_COLON","::",714],["T_STRING","register",714],"(",["T_CONSTANT_ENCAPSED_STRING","'current_giftcardaccount'",714],",",["T_WHITESPACE"," ",714],["T_VARIABLE","$card",714],")",";",["T_WHITESPACE","\n\n            ",714],["T_VARIABLE","$card",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","isValid",716],"(",["T_STRING","true",716],",",["T_WHITESPACE"," ",716],["T_STRING","true",716],",",["T_WHITESPACE"," ",716],["T_STRING","true",716],",",["T_WHITESPACE"," ",716],["T_STRING","false",716],")",";",["T_WHITESPACE","\n\n            ",716],["T_VARIABLE","$this",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","loadLayout",718],"(",["T_STRING","false",718],")",";",["T_WHITESPACE","\n            ",718],["T_VARIABLE","$this",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","renderLayout",719],"(",")",";",["T_WHITESPACE","\n            ",719],["T_RETURN","return",720],";",["T_WHITESPACE","\n        ",720],"}",["T_WHITESPACE"," ",721],["T_CATCH","catch",721],["T_WHITESPACE"," ",721],"(",["T_STRING","Mage_Core_Exception",721],["T_WHITESPACE"," ",721],["T_VARIABLE","$e",721],")",["T_WHITESPACE"," ",721],"{",["T_WHITESPACE","\n            ",721],["T_VARIABLE","$card",722],["T_OBJECT_OPERATOR","->",722],["T_STRING","unsetData",722],"(",")",";",["T_WHITESPACE","\n            ",722],["T_VARIABLE","$this",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","_message",723],"(",["T_VARIABLE","$e",723],["T_OBJECT_OPERATOR","->",723],["T_STRING","getMessage",723],"(",")",",",["T_WHITESPACE"," ",723],["T_STRING","self",723],["T_DOUBLE_COLON","::",723],["T_STRING","MESSAGE_STATUS_ERROR",723],")",";",["T_WHITESPACE","\n        ",723],"}",["T_WHITESPACE"," ",724],["T_CATCH","catch",724],["T_WHITESPACE"," ",724],"(",["T_STRING","Exception",724],["T_WHITESPACE"," ",724],["T_VARIABLE","$e",724],")",["T_WHITESPACE"," ",724],"{",["T_WHITESPACE","\n            ",724],["T_VARIABLE","$this",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","_message",725],"(",["T_VARIABLE","$this",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","__",725],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to render a gift card account.'",725],")",",",["T_WHITESPACE"," ",725],["T_STRING","self",725],["T_DOUBLE_COLON","::",725],["T_STRING","MESSAGE_STATUS_ERROR",725],")",";",["T_WHITESPACE","\n            ",725],["T_STRING","Mage",726],["T_DOUBLE_COLON","::",726],["T_STRING","logException",726],"(",["T_VARIABLE","$e",726],")",";",["T_WHITESPACE","\n        ",726],"}",["T_WHITESPACE","\n    ",727],"}",["T_WHITESPACE","\n\n    ",728],["T_DOC_COMMENT","\/**\n     * Redeem Gift card action\n     *\n     * @return null\n     *\/",730],["T_WHITESPACE","\n    ",734],["T_PUBLIC","public",735],["T_WHITESPACE"," ",735],["T_FUNCTION","function",735],["T_WHITESPACE"," ",735],["T_STRING","giftcardRedeemAction",735],"(",")",["T_WHITESPACE","\n    ",735],"{",["T_WHITESPACE","\n        ",736],["T_TRY","try",737],["T_WHITESPACE"," ",737],"{",["T_WHITESPACE","\n            ",737],["T_DOC_COMMENT","\/**\n             * Check is available Customer Balance\n             *\/",738],["T_WHITESPACE","\n            ",740],["T_IF","if",741],["T_WHITESPACE"," ",741],"(","!",["T_STRING","is_object",741],"(",["T_STRING","Mage",741],["T_DOUBLE_COLON","::",741],["T_STRING","getConfig",741],"(",")",["T_OBJECT_OPERATOR","->",741],["T_STRING","getNode",741],"(",["T_CONSTANT_ENCAPSED_STRING","'modules\/Enterprise_GiftCardAccount'",741],")",")",")",["T_WHITESPACE"," ",741],"{",["T_WHITESPACE","\n                ",741],["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","_message",742],"(",["T_WHITESPACE","\n                    ",742],["T_VARIABLE","$this",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","__",743],"(",["T_CONSTANT_ENCAPSED_STRING","'Gift card account available in enterprise version of Magento only.'",743],")",",",["T_WHITESPACE","\n                    ",743],["T_STRING","self",744],["T_DOUBLE_COLON","::",744],["T_STRING","MESSAGE_STATUS_ERROR",744],["T_WHITESPACE","\n                ",744],")",";",["T_WHITESPACE","\n                ",745],["T_RETURN","return",746],";",["T_WHITESPACE","\n            ",746],"}",["T_WHITESPACE","\n\n            ",747],["T_VARIABLE","$code",749],["T_WHITESPACE"," ",749],"=",["T_WHITESPACE"," ",749],["T_VARIABLE","$this",749],["T_OBJECT_OPERATOR","->",749],["T_STRING","getRequest",749],"(",")",["T_OBJECT_OPERATOR","->",749],["T_STRING","getPost",749],"(",["T_CONSTANT_ENCAPSED_STRING","'giftcard_code'",749],",",["T_WHITESPACE"," ",749],["T_CONSTANT_ENCAPSED_STRING","''",749],")",";",["T_WHITESPACE","\n            ",749],["T_IF","if",750],["T_WHITESPACE"," ",750],"(",["T_VARIABLE","$code",750],")",["T_WHITESPACE"," ",750],"{",["T_WHITESPACE","\n                ",750],["T_IF","if",751],["T_WHITESPACE"," ",751],"(","!",["T_STRING","Mage",751],["T_DOUBLE_COLON","::",751],["T_STRING","helper",751],"(",["T_CONSTANT_ENCAPSED_STRING","'enterprise_customerbalance'",751],")",["T_OBJECT_OPERATOR","->",751],["T_STRING","isEnabled",751],"(",")",")",["T_WHITESPACE"," ",751],"{",["T_WHITESPACE","\n                    ",751],["T_STRING","Mage",752],["T_DOUBLE_COLON","::",752],["T_STRING","throwException",752],"(",["T_VARIABLE","$this",752],["T_OBJECT_OPERATOR","->",752],["T_STRING","__",752],"(",["T_CONSTANT_ENCAPSED_STRING","'Redemption functionality is disabled.'",752],")",")",";",["T_WHITESPACE","\n                ",752],"}",["T_WHITESPACE","\n                ",753],["T_STRING","Mage",754],["T_DOUBLE_COLON","::",754],["T_STRING","getModel",754],"(",["T_CONSTANT_ENCAPSED_STRING","'enterprise_giftcardaccount\/giftcardaccount'",754],")",["T_OBJECT_OPERATOR","->",754],["T_STRING","loadByCode",754],"(",["T_VARIABLE","$code",754],")",["T_OBJECT_OPERATOR","->",754],["T_STRING","setIsRedeemed",754],"(",["T_STRING","true",754],")",["T_WHITESPACE","\n                    ",754],["T_OBJECT_OPERATOR","->",755],["T_STRING","redeem",755],"(",")",";",["T_WHITESPACE","\n\n                ",755],["T_VARIABLE","$this",757],["T_OBJECT_OPERATOR","->",757],["T_STRING","_message",757],"(",["T_WHITESPACE","\n                    ",757],["T_VARIABLE","$this",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","__",758],"(",["T_CONSTANT_ENCAPSED_STRING","'Gift Card \"%s\" was redeemed.'",758],",",["T_WHITESPACE"," ",758],["T_STRING","Mage",758],["T_DOUBLE_COLON","::",758],["T_STRING","helper",758],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",758],")",["T_OBJECT_OPERATOR","->",758],["T_STRING","escapeHtml",758],"(",["T_VARIABLE","$code",758],")",")",",",["T_WHITESPACE","\n                    ",758],["T_STRING","self",759],["T_DOUBLE_COLON","::",759],["T_STRING","MESSAGE_STATUS_SUCCESS",759],["T_WHITESPACE","\n                ",759],")",";",["T_WHITESPACE","\n            ",760],"}",["T_WHITESPACE"," ",761],["T_ELSE","else",761],["T_WHITESPACE"," ",761],"{",["T_WHITESPACE","\n                ",761],["T_VARIABLE","$this",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","_message",762],"(",["T_VARIABLE","$this",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","__",762],"(",["T_CONSTANT_ENCAPSED_STRING","'Gift Card code is empty.'",762],")",",",["T_WHITESPACE"," ",762],["T_STRING","self",762],["T_DOUBLE_COLON","::",762],["T_STRING","MESSAGE_STATUS_ERROR",762],")",";",["T_WHITESPACE","\n            ",762],"}",["T_WHITESPACE","\n            ",763],["T_RETURN","return",764],";",["T_WHITESPACE","\n        ",764],"}",["T_WHITESPACE"," ",765],["T_CATCH","catch",765],["T_WHITESPACE"," ",765],"(",["T_STRING","Mage_Core_Exception",765],["T_WHITESPACE"," ",765],["T_VARIABLE","$e",765],")",["T_WHITESPACE"," ",765],"{",["T_WHITESPACE","\n            ",765],["T_IF","if",766],["T_WHITESPACE"," ",766],"(",["T_ISSET","isset",766],"(",["T_VARIABLE","$card",766],")",["T_WHITESPACE"," ",766],["T_BOOLEAN_AND","&&",766],["T_WHITESPACE"," ",766],["T_STRING","is_object",766],"(",["T_VARIABLE","$card",766],")",")",["T_WHITESPACE"," ",766],"{",["T_WHITESPACE","\n                ",766],["T_VARIABLE","$card",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","unsetData",767],"(",")",";",["T_WHITESPACE","\n            ",767],"}",["T_WHITESPACE","\n            ",768],["T_VARIABLE","$this",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","_message",769],"(",["T_VARIABLE","$e",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","getMessage",769],"(",")",",",["T_WHITESPACE"," ",769],["T_STRING","self",769],["T_DOUBLE_COLON","::",769],["T_STRING","MESSAGE_STATUS_ERROR",769],")",";",["T_WHITESPACE","\n        ",769],"}",["T_WHITESPACE"," ",770],["T_CATCH","catch",770],["T_WHITESPACE"," ",770],"(",["T_STRING","Exception",770],["T_WHITESPACE"," ",770],["T_VARIABLE","$e",770],")",["T_WHITESPACE"," ",770],"{",["T_WHITESPACE","\n            ",770],["T_VARIABLE","$this",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","_message",771],"(",["T_VARIABLE","$this",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","__",771],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot redeem Gift Card.'",771],")",",",["T_WHITESPACE"," ",771],["T_STRING","self",771],["T_DOUBLE_COLON","::",771],["T_STRING","MESSAGE_STATUS_ERROR",771],")",";",["T_WHITESPACE","\n            ",771],["T_STRING","Mage",772],["T_DOUBLE_COLON","::",772],["T_STRING","logException",772],"(",["T_VARIABLE","$e",772],")",";",["T_WHITESPACE","\n        ",772],"}",["T_WHITESPACE","\n    ",773],"}",["T_WHITESPACE","\n\n    ",774],["T_DOC_COMMENT","\/**\n     * Customer Downloadable Products list\n     *\n     * @return null\n     *\/",776],["T_WHITESPACE","\n    ",780],["T_PUBLIC","public",781],["T_WHITESPACE"," ",781],["T_FUNCTION","function",781],["T_WHITESPACE"," ",781],["T_STRING","downloadsAction",781],"(",")",["T_WHITESPACE","\n    ",781],"{",["T_WHITESPACE","\n        ",782],["T_TRY","try",783],["T_WHITESPACE"," ",783],"{",["T_WHITESPACE","\n            ",783],["T_VARIABLE","$this",784],["T_OBJECT_OPERATOR","->",784],["T_STRING","loadLayout",784],"(",["T_STRING","false",784],")",";",["T_WHITESPACE","\n            ",784],["T_VARIABLE","$this",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","renderLayout",785],"(",")",";",["T_WHITESPACE","\n            ",785],["T_RETURN","return",786],";",["T_WHITESPACE","\n        ",786],"}",["T_WHITESPACE"," ",787],["T_CATCH","catch",787],["T_WHITESPACE"," ",787],"(",["T_STRING","Mage_Core_Exception",787],["T_WHITESPACE"," ",787],["T_VARIABLE","$e",787],")",["T_WHITESPACE"," ",787],"{",["T_WHITESPACE","\n            ",787],["T_VARIABLE","$this",788],["T_OBJECT_OPERATOR","->",788],["T_STRING","_message",788],"(",["T_VARIABLE","$e",788],["T_OBJECT_OPERATOR","->",788],["T_STRING","getMessage",788],"(",")",",",["T_WHITESPACE"," ",788],["T_STRING","self",788],["T_DOUBLE_COLON","::",788],["T_STRING","MESSAGE_STATUS_ERROR",788],")",";",["T_WHITESPACE","\n        ",788],"}",["T_WHITESPACE"," ",789],["T_CATCH","catch",789],["T_WHITESPACE"," ",789],"(",["T_STRING","Exception",789],["T_WHITESPACE"," ",789],["T_VARIABLE","$e",789],")",["T_WHITESPACE"," ",789],"{",["T_WHITESPACE","\n            ",789],["T_VARIABLE","$this",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","_message",790],"(",["T_VARIABLE","$this",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","__",790],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to render downloadable products.'",790],")",",",["T_WHITESPACE"," ",790],["T_STRING","self",790],["T_DOUBLE_COLON","::",790],["T_STRING","MESSAGE_STATUS_ERROR",790],")",";",["T_WHITESPACE","\n            ",790],["T_STRING","Mage",791],["T_DOUBLE_COLON","::",791],["T_STRING","logException",791],"(",["T_VARIABLE","$e",791],")",";",["T_WHITESPACE","\n        ",791],"}",["T_WHITESPACE","\n    ",792],"}",["T_WHITESPACE","\n\n    ",793],["T_DOC_COMMENT","\/**\n     * Customer registration account form\n     *\n     * @return null\n     *\/",795],["T_WHITESPACE","\n    ",799],["T_PUBLIC","public",800],["T_WHITESPACE"," ",800],["T_FUNCTION","function",800],["T_WHITESPACE"," ",800],["T_STRING","checkoutRegistrationAction",800],"(",")",["T_WHITESPACE","\n    ",800],"{",["T_WHITESPACE","\n        ",801],["T_TRY","try",802],["T_WHITESPACE"," ",802],"{",["T_WHITESPACE","\n            ",802],["T_VARIABLE","$this",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","loadLayout",803],"(",["T_STRING","false",803],")",["T_OBJECT_OPERATOR","->",803],["T_STRING","getLayout",803],"(",")",["T_OBJECT_OPERATOR","->",803],["T_STRING","getBlock",803],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect.customer.checkout.registration'",803],")",["T_WHITESPACE","\n                ",803],["T_OBJECT_OPERATOR","->",804],["T_STRING","setCustomer",804],"(",["T_STRING","Mage",804],["T_DOUBLE_COLON","::",804],["T_STRING","getModel",804],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",804],")",")",["T_WHITESPACE","\n                ",804],["T_OBJECT_OPERATOR","->",805],["T_STRING","setAttributesBlockName",805],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_form_customer_user_defined_attributes'",805],")",["T_WHITESPACE","\n                ",805],["T_OBJECT_OPERATOR","->",806],["T_STRING","setCustomerFormCode",806],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_register'",806],")",["T_OBJECT_OPERATOR","->",806],["T_STRING","setCheckoutPageRegistration",806],"(",["T_STRING","true",806],")",["T_OBJECT_OPERATOR","->",806],["T_STRING","setIsEditPage",806],"(",["T_STRING","false",806],")",";",["T_WHITESPACE","\n            ",806],["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","renderLayout",807],"(",")",";",["T_WHITESPACE","\n        ",807],"}",["T_WHITESPACE"," ",808],["T_CATCH","catch",808],["T_WHITESPACE"," ",808],"(",["T_STRING","Mage_Core_Exception",808],["T_WHITESPACE"," ",808],["T_VARIABLE","$e",808],")",["T_WHITESPACE"," ",808],"{",["T_WHITESPACE","\n            ",808],["T_VARIABLE","$this",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","_message",809],"(",["T_VARIABLE","$e",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getMessage",809],"(",")",",",["T_WHITESPACE"," ",809],["T_STRING","self",809],["T_DOUBLE_COLON","::",809],["T_STRING","MESSAGE_STATUS_ERROR",809],")",";",["T_WHITESPACE","\n        ",809],"}",["T_WHITESPACE"," ",810],["T_CATCH","catch",810],["T_WHITESPACE"," ",810],"(",["T_STRING","Exception",810],["T_WHITESPACE"," ",810],["T_VARIABLE","$e",810],")",["T_WHITESPACE"," ",810],"{",["T_WHITESPACE","\n            ",810],["T_STRING","Mage",811],["T_DOUBLE_COLON","::",811],["T_STRING","logException",811],"(",["T_VARIABLE","$e",811],")",";",["T_WHITESPACE","\n            ",811],["T_VARIABLE","$this",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","_message",812],"(",["T_VARIABLE","$this",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","__",812],"(",["T_CONSTANT_ENCAPSED_STRING","'Can\\'t load customer form.'",812],")",",",["T_WHITESPACE"," ",812],["T_STRING","self",812],["T_DOUBLE_COLON","::",812],["T_STRING","MESSAGE_STATUS_ERROR",812],")",";",["T_WHITESPACE","\n        ",812],"}",["T_WHITESPACE","\n    ",813],"}",["T_WHITESPACE","\n\n    ",814],["T_DOC_COMMENT","\/**\n     * Check customer access\n     *\n     * @param bool $isCustomerLogged true - allow only logged customer, false - allow only unregistered customer\n     * @return bool\n     *\/",816],["T_WHITESPACE","\n    ",821],["T_PROTECTED","protected",822],["T_WHITESPACE"," ",822],["T_FUNCTION","function",822],["T_WHITESPACE"," ",822],["T_STRING","_isCustomerLoggedIn",822],"(",["T_VARIABLE","$isCustomerLogged",822],["T_WHITESPACE"," ",822],"=",["T_WHITESPACE"," ",822],["T_STRING","true",822],")",["T_WHITESPACE","\n    ",822],"{",["T_WHITESPACE","\n        ",823],["T_IF","if",824],["T_WHITESPACE"," ",824],"(",["T_VARIABLE","$isCustomerLogged",824],")",["T_WHITESPACE"," ",824],"{",["T_WHITESPACE","\n            ",824],["T_IF","if",825],["T_WHITESPACE"," ",825],"(","!",["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","_getSession",825],"(",")",["T_OBJECT_OPERATOR","->",825],["T_STRING","isLoggedIn",825],"(",")",")",["T_WHITESPACE"," ",825],"{",["T_WHITESPACE","\n                ",825],["T_VARIABLE","$this",826],["T_OBJECT_OPERATOR","->",826],["T_STRING","_message",826],"(",["T_WHITESPACE","\n                    ",826],["T_VARIABLE","$this",827],["T_OBJECT_OPERATOR","->",827],["T_STRING","__",827],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer not logged in.'",827],")",",",["T_WHITESPACE"," ",827],["T_STRING","self",827],["T_DOUBLE_COLON","::",827],["T_STRING","MESSAGE_STATUS_ERROR",827],",",["T_WHITESPACE"," ",827],["T_ARRAY","array",827],"(",["T_CONSTANT_ENCAPSED_STRING","'logged_in'",827],["T_WHITESPACE"," ",827],["T_DOUBLE_ARROW","=>",827],["T_WHITESPACE"," ",827],["T_CONSTANT_ENCAPSED_STRING","'0'",827],")",["T_WHITESPACE","\n                ",827],")",";",["T_WHITESPACE","\n                ",828],["T_RETURN","return",829],["T_WHITESPACE"," ",829],["T_STRING","false",829],";",["T_WHITESPACE","\n            ",829],"}",["T_WHITESPACE","\n        ",830],"}",["T_WHITESPACE"," ",831],["T_ELSE","else",831],["T_WHITESPACE"," ",831],"{",["T_WHITESPACE","\n            ",831],["T_IF","if",832],["T_WHITESPACE"," ",832],"(",["T_VARIABLE","$this",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","_getSession",832],"(",")",["T_OBJECT_OPERATOR","->",832],["T_STRING","isLoggedIn",832],"(",")",")",["T_WHITESPACE"," ",832],"{",["T_WHITESPACE","\n                ",832],["T_VARIABLE","$this",833],["T_OBJECT_OPERATOR","->",833],["T_STRING","_message",833],"(",["T_WHITESPACE","\n                    ",833],["T_VARIABLE","$this",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","__",834],"(",["T_CONSTANT_ENCAPSED_STRING","'You are already logged in.'",834],")",",",["T_WHITESPACE"," ",834],["T_STRING","self",834],["T_DOUBLE_COLON","::",834],["T_STRING","MESSAGE_STATUS_ERROR",834],",",["T_WHITESPACE"," ",834],["T_ARRAY","array",834],"(",["T_CONSTANT_ENCAPSED_STRING","'logged_in'",834],["T_WHITESPACE"," ",834],["T_DOUBLE_ARROW","=>",834],["T_WHITESPACE"," ",834],["T_CONSTANT_ENCAPSED_STRING","'1'",834],")",["T_WHITESPACE","\n                ",834],")",";",["T_WHITESPACE","\n                ",835],["T_RETURN","return",836],["T_WHITESPACE"," ",836],["T_STRING","false",836],";",["T_WHITESPACE","\n            ",836],"}",["T_WHITESPACE","\n        ",837],"}",["T_WHITESPACE","\n\n        ",838],["T_RETURN","return",840],["T_WHITESPACE"," ",840],["T_STRING","true",840],";",["T_WHITESPACE","\n    ",840],"}",["T_WHITESPACE","\n",841],"}",["T_WHITESPACE","\n",842]]