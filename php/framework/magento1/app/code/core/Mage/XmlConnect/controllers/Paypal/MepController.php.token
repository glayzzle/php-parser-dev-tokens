[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * XmlConnect checkout controller\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_XmlConnect_Paypal_MepController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_XmlConnect_Controller_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Store MEP checkout model instance\n     *\n     * @var Mage_XmlConnect_Model_Paypal_Mep_Checkout\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_checkout",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","null",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Store Quote mdoel instance\n     *\n     * @var Mage_Sales_Model_Quote\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_quote",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","false",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Make sure customer is logged in\n     *\n     * @return null\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","preDispatch",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_STRING","parent",57],["T_DOUBLE_COLON","::",57],["T_STRING","preDispatch",57],"(",")",";",["T_WHITESPACE","\n        ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(","!",["T_STRING","Mage",58],["T_DOUBLE_COLON","::",58],["T_STRING","getSingleton",58],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",58],")",["T_OBJECT_OPERATOR","->",58],["T_STRING","isLoggedIn",58],"(",")",["T_WHITESPACE","\n            ",58],["T_BOOLEAN_AND","&&",59],["T_WHITESPACE"," ",59],"!",["T_STRING","Mage",59],["T_DOUBLE_COLON","::",59],["T_STRING","getSingleton",59],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",59],")",["T_OBJECT_OPERATOR","->",59],["T_STRING","getQuote",59],"(",")",["T_OBJECT_OPERATOR","->",59],["T_STRING","isAllowedGuestCheckout",59],"(",")",["T_WHITESPACE","\n        ",59],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","setFlag",61],"(",["T_CONSTANT_ENCAPSED_STRING","''",61],",",["T_WHITESPACE"," ",61],["T_STRING","self",61],["T_DOUBLE_COLON","::",61],["T_STRING","FLAG_NO_DISPATCH",61],",",["T_WHITESPACE"," ",61],["T_STRING","true",61],")",";",["T_WHITESPACE","\n            ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_message",62],"(",["T_WHITESPACE","\n                ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","__",63],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer not logged in.'",63],")",",",["T_WHITESPACE"," ",63],["T_STRING","self",63],["T_DOUBLE_COLON","::",63],["T_STRING","MESSAGE_STATUS_ERROR",63],",",["T_WHITESPACE"," ",63],["T_ARRAY","array",63],"(",["T_CONSTANT_ENCAPSED_STRING","'logged_in'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'0'",63],")",["T_WHITESPACE","\n            ",63],")",";",["T_WHITESPACE","\n            ",64],["T_RETURN","return",65],";",["T_WHITESPACE","\n        ",65],"}",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Start MEP Checkout\n     *\n     * @return null\n     *\/",69],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","indexAction",74],"(",")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_TRY","try",76],["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_IF","if",77],["T_WHITESPACE"," ",77],"(",["T_STRING","is_object",77],"(",["T_STRING","Mage",77],["T_DOUBLE_COLON","::",77],["T_STRING","getConfig",77],"(",")",["T_OBJECT_OPERATOR","->",77],["T_STRING","getNode",77],"(",["T_CONSTANT_ENCAPSED_STRING","'modules\/Enterprise_GiftCardAccount'",77],")",")",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$giftcardInfoBlock",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getLayout",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","addBlock",78],"(",["T_WHITESPACE","\n                    ",78],["T_CONSTANT_ENCAPSED_STRING","'enterprise_giftcardaccount\/checkout_onepage_payment_additional'",79],",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'giftcard_info'",79],["T_WHITESPACE","\n                ",79],")",";",["T_WHITESPACE","\n\n                ",80],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_STRING","intval",82],"(",["T_VARIABLE","$giftcardInfoBlock",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getAppliedGiftCardAmount",82],"(",")",")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n                    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_message",83],"(",["T_WHITESPACE","\n                        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","__",84],"(",["T_CONSTANT_ENCAPSED_STRING","'Paypal MEP doesn\\'t support checkout with any discount.'",84],")",",",["T_WHITESPACE","\n                        ",84],["T_STRING","self",85],["T_DOUBLE_COLON","::",85],["T_STRING","MESSAGE_STATUS_ERROR",85],["T_WHITESPACE","\n                    ",85],")",";",["T_WHITESPACE","\n                    ",86],["T_RETURN","return",87],";",["T_WHITESPACE","\n                ",87],"}",["T_WHITESPACE","\n            ",88],"}",["T_WHITESPACE","\n\n            ",89],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_initCheckout",91],"(",")",";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_checkout",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","initCheckout",92],"(",")",";",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_message",93],"(",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","__",93],"(",["T_CONSTANT_ENCAPSED_STRING","'Checkout has been initialized.'",93],")",",",["T_WHITESPACE"," ",93],["T_STRING","self",93],["T_DOUBLE_COLON","::",93],["T_STRING","MESSAGE_STATUS_SUCCESS",93],")",";",["T_WHITESPACE","\n            ",93],["T_RETURN","return",94],";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE"," ",95],["T_CATCH","catch",95],["T_WHITESPACE"," ",95],"(",["T_STRING","Mage_Core_Exception",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$e",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_message",96],"(",["T_VARIABLE","$e",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getMessage",96],"(",")",",",["T_WHITESPACE"," ",96],["T_STRING","self",96],["T_DOUBLE_COLON","::",96],["T_STRING","MESSAGE_STATUS_ERROR",96],")",";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE"," ",97],["T_CATCH","catch",97],["T_WHITESPACE"," ",97],"(",["T_STRING","Exception",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$e",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_message",98],"(",["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","__",98],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to start MEP Checkout.'",98],")",",",["T_WHITESPACE"," ",98],["T_STRING","self",98],["T_DOUBLE_COLON","::",98],["T_STRING","MESSAGE_STATUS_ERROR",98],")",";",["T_WHITESPACE","\n            ",98],["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","logException",99],"(",["T_VARIABLE","$e",99],")",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Save shipping address to current quote using onepage model\n     *\n     * @return null\n     *\/",103],["T_WHITESPACE","\n    ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","saveShippingAddressAction",108],"(",")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(","!",["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getRequest",110],"(",")",["T_OBJECT_OPERATOR","->",110],["T_STRING","isPost",110],"(",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_message",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","__",111],"(",["T_CONSTANT_ENCAPSED_STRING","'Specified invalid data.'",111],")",",",["T_WHITESPACE"," ",111],["T_STRING","self",111],["T_DOUBLE_COLON","::",111],["T_STRING","MESSAGE_STATUS_ERROR",111],")",";",["T_WHITESPACE","\n            ",111],["T_RETURN","return",112],";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n        ",113],["T_TRY","try",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_initCheckout",116],"(",")",";",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$data",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getRequest",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getPost",117],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",117],",",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",")",")",";",["T_WHITESPACE","\n\n            ",117],["T_STRING","array_walk_recursive",119],"(",["T_VARIABLE","$data",119],",",["T_WHITESPACE"," ",119],["T_STRING","create_function",119],"(",["T_CONSTANT_ENCAPSED_STRING","'&$val'",119],",",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'$val = trim($val);'",119],")",")",";",["T_WHITESPACE","\n\n            ",119],["T_IF","if",121],["T_WHITESPACE"," ",121],"(","!",["T_EMPTY","empty",121],"(",["T_VARIABLE","$data",121],"[",["T_CONSTANT_ENCAPSED_STRING","'region'",121],"]",")",["T_WHITESPACE"," ",121],["T_BOOLEAN_AND","&&",121],["T_WHITESPACE"," ",121],["T_ISSET","isset",121],"(",["T_VARIABLE","$data",121],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",121],"]",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                ",121],["T_VARIABLE","$region",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","Mage",122],["T_DOUBLE_COLON","::",122],["T_STRING","getModel",122],"(",["T_CONSTANT_ENCAPSED_STRING","'directory\/region'",122],")",["T_OBJECT_OPERATOR","->",122],["T_STRING","loadByCode",122],"(",["T_VARIABLE","$data",122],"[",["T_CONSTANT_ENCAPSED_STRING","'region'",122],"]",",",["T_WHITESPACE"," ",122],["T_VARIABLE","$data",122],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",122],"]",")",";",["T_WHITESPACE","\n                ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$region",123],["T_WHITESPACE"," ",123],["T_BOOLEAN_AND","&&",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$region",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getId",123],"(",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n                    ",123],["T_VARIABLE","$data",124],"[",["T_CONSTANT_ENCAPSED_STRING","'region_id'",124],"]",["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$region",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getId",124],"(",")",";",["T_WHITESPACE","\n                ",124],"}",["T_WHITESPACE","\n            ",125],"}",["T_WHITESPACE","\n\n            ",126],["T_VARIABLE","$result",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_checkout",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","saveShipping",128],"(",["T_VARIABLE","$data",128],")",";",["T_WHITESPACE","\n            ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(","!",["T_ISSET","isset",129],"(",["T_VARIABLE","$result",129],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",129],"]",")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_message",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","__",130],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping address has been set.'",130],")",",",["T_WHITESPACE"," ",130],["T_STRING","self",130],["T_DOUBLE_COLON","::",130],["T_STRING","MESSAGE_STATUS_SUCCESS",130],")",";",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE"," ",131],["T_ELSE","else",131],["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n                ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(","!",["T_STRING","is_array",132],"(",["T_VARIABLE","$result",132],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",132],"]",")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                    ",132],["T_VARIABLE","$result",133],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",133],"]",["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",["T_VARIABLE","$result",133],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",133],"]",")",";",["T_WHITESPACE","\n                ",133],"}",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_message",135],"(",["T_STRING","implode",135],"(",["T_CONSTANT_ENCAPSED_STRING","'. '",135],",",["T_WHITESPACE"," ",135],["T_VARIABLE","$result",135],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",135],"]",")",",",["T_WHITESPACE"," ",135],["T_STRING","self",135],["T_DOUBLE_COLON","::",135],["T_STRING","MESSAGE_STATUS_ERROR",135],")",";",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE"," ",137],["T_CATCH","catch",137],["T_WHITESPACE"," ",137],"(",["T_STRING","Mage_Core_Exception",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$e",137],")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n            ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_message",138],"(",["T_VARIABLE","$e",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getMessage",138],"(",")",",",["T_WHITESPACE"," ",138],["T_STRING","self",138],["T_DOUBLE_COLON","::",138],["T_STRING","MESSAGE_STATUS_ERROR",138],")",";",["T_WHITESPACE","\n            ",138],["T_STRING","Mage",139],["T_DOUBLE_COLON","::",139],["T_STRING","logException",139],"(",["T_VARIABLE","$e",139],")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE"," ",140],["T_CATCH","catch",140],["T_WHITESPACE"," ",140],"(",["T_STRING","Exception",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$e",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_message",141],"(",["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","__",141],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to save shipping address.'",141],")",",",["T_WHITESPACE"," ",141],["T_STRING","self",141],["T_DOUBLE_COLON","::",141],["T_STRING","MESSAGE_STATUS_ERROR",141],")",";",["T_WHITESPACE","\n            ",141],["T_STRING","Mage",142],["T_DOUBLE_COLON","::",142],["T_STRING","logException",142],"(",["T_VARIABLE","$e",142],")",";",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE","\n    ",143],"}",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * Get shipping methods for current quote\n     *\n     * @return null\n     *\/",146],["T_WHITESPACE","\n    ",150],["T_PUBLIC","public",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","shippingMethodsAction",151],"(",")",["T_WHITESPACE","\n    ",151],"{",["T_WHITESPACE","\n        ",152],["T_TRY","try",153],["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_initCheckout",154],"(",")",";",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","loadLayout",155],"(",["T_STRING","false",155],")",";",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","renderLayout",156],"(",")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE"," ",157],["T_CATCH","catch",157],["T_WHITESPACE"," ",157],"(",["T_STRING","Mage_Core_Exception",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$e",157],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_message",158],"(",["T_VARIABLE","$e",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getMessage",158],"(",")",",",["T_WHITESPACE"," ",158],["T_STRING","self",158],["T_DOUBLE_COLON","::",158],["T_STRING","MESSAGE_STATUS_ERROR",158],")",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE"," ",159],["T_CATCH","catch",159],["T_WHITESPACE"," ",159],"(",["T_STRING","Exception",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$e",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_message",160],"(",["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","__",160],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to get shipping methods list.'",160],")",",",["T_WHITESPACE"," ",160],["T_STRING","self",160],["T_DOUBLE_COLON","::",160],["T_STRING","MESSAGE_STATUS_ERROR",160],")",";",["T_WHITESPACE","\n            ",160],["T_STRING","Mage",161],["T_DOUBLE_COLON","::",161],["T_STRING","logException",161],"(",["T_VARIABLE","$e",161],")",";",["T_WHITESPACE","\n        ",161],"}",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n\n    ",163],["T_DOC_COMMENT","\/**\n     * Shipping method save action\n     *\n     * @return null\n     *\/",165],["T_WHITESPACE","\n    ",169],["T_PUBLIC","public",170],["T_WHITESPACE"," ",170],["T_FUNCTION","function",170],["T_WHITESPACE"," ",170],["T_STRING","saveShippingMethodAction",170],"(",")",["T_WHITESPACE","\n    ",170],"{",["T_WHITESPACE","\n        ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(","!",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getRequest",172],"(",")",["T_OBJECT_OPERATOR","->",172],["T_STRING","isPost",172],"(",")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_message",173],"(",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","__",173],"(",["T_CONSTANT_ENCAPSED_STRING","'Specified invalid data.'",173],")",",",["T_WHITESPACE"," ",173],["T_STRING","self",173],["T_DOUBLE_COLON","::",173],["T_STRING","MESSAGE_STATUS_ERROR",173],")",";",["T_WHITESPACE","\n            ",173],["T_RETURN","return",174],";",["T_WHITESPACE","\n        ",174],"}",["T_WHITESPACE","\n\n        ",175],["T_TRY","try",177],["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_initCheckout",178],"(",")",";",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$data",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getRequest",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","getPost",179],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",179],",",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","''",179],")",";",["T_WHITESPACE","\n            ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_getQuote",180],"(",")",["T_OBJECT_OPERATOR","->",180],["T_STRING","getShippingAddress",180],"(",")",["T_OBJECT_OPERATOR","->",180],["T_STRING","setShippingMethod",180],"(",["T_VARIABLE","$data",180],")",["T_OBJECT_OPERATOR","->",180],["T_STRING","setCollectShippingRates",180],"(",["T_STRING","true",180],")",["T_OBJECT_OPERATOR","->",180],["T_STRING","save",180],"(",")",";",["T_WHITESPACE","\n\n            ",180],["T_VARIABLE","$result",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_checkout",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","saveShippingMethod",182],"(",["T_VARIABLE","$data",182],")",";",["T_WHITESPACE","\n\n            ",182],["T_IF","if",184],["T_WHITESPACE"," ",184],"(","!",["T_ISSET","isset",184],"(",["T_VARIABLE","$result",184],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",184],"]",")",")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n                ",184],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",185],["T_WHITESPACE","\n                ",185],["T_VARIABLE","$message",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","Mage",186],["T_DOUBLE_COLON","::",186],["T_STRING","getModel",186],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",186],")",";",["T_WHITESPACE","\n                ",186],["T_VARIABLE","$message",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","addChild",187],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",187],",",["T_WHITESPACE"," ",187],["T_STRING","self",187],["T_DOUBLE_COLON","::",187],["T_STRING","MESSAGE_STATUS_SUCCESS",187],")",";",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$message",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","addChild",188],"(",["T_CONSTANT_ENCAPSED_STRING","'text'",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","__",188],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping method has been set.'",188],")",")",";",["T_WHITESPACE","\n                ",188],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_getQuote",189],"(",")",["T_OBJECT_OPERATOR","->",189],["T_STRING","isVirtual",189],"(",")",")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n                    ",189],["T_VARIABLE","$quoteAddress",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_getQuote",190],"(",")",["T_OBJECT_OPERATOR","->",190],["T_STRING","getBillingAddress",190],"(",")",";",["T_WHITESPACE","\n                ",190],"}",["T_WHITESPACE"," ",191],["T_ELSE","else",191],["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n                    ",191],["T_VARIABLE","$quoteAddress",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_getQuote",192],"(",")",["T_OBJECT_OPERATOR","->",192],["T_STRING","getShippingAddress",192],"(",")",";",["T_WHITESPACE","\n                ",192],"}",["T_WHITESPACE","\n                ",193],["T_VARIABLE","$taxAmount",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","helper",194],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",194],")",["T_OBJECT_OPERATOR","->",194],["T_STRING","currency",194],"(",["T_VARIABLE","$quoteAddress",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getBaseTaxAmount",194],"(",")",",",["T_WHITESPACE"," ",194],["T_STRING","false",194],",",["T_WHITESPACE"," ",194],["T_STRING","false",194],")",";",["T_WHITESPACE","\n                ",194],["T_VARIABLE","$message",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","addChild",195],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",195],",",["T_WHITESPACE"," ",195],["T_STRING","Mage",195],["T_DOUBLE_COLON","::",195],["T_STRING","helper",195],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect'",195],")",["T_OBJECT_OPERATOR","->",195],["T_STRING","formatPriceForXml",195],"(",["T_VARIABLE","$taxAmount",195],")",")",";",["T_WHITESPACE","\n                ",195],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_getQuote",196],"(",")",["T_OBJECT_OPERATOR","->",196],["T_STRING","collectTotals",196],"(",")",["T_OBJECT_OPERATOR","->",196],["T_STRING","save",196],"(",")",";",["T_WHITESPACE","\n                ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getResponse",197],"(",")",["T_OBJECT_OPERATOR","->",197],["T_STRING","setBody",197],"(",["T_VARIABLE","$message",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","asNiceXml",197],"(",")",")",";",["T_WHITESPACE","\n            ",197],"}",["T_WHITESPACE"," ",198],["T_ELSE","else",198],["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n                ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(","!",["T_STRING","is_array",199],"(",["T_VARIABLE","$result",199],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",199],"]",")",")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n                    ",199],["T_VARIABLE","$result",200],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",200],"]",["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_ARRAY","array",200],"(",["T_VARIABLE","$result",200],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",200],"]",")",";",["T_WHITESPACE","\n                ",200],"}",["T_WHITESPACE","\n                ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_message",202],"(",["T_STRING","implode",202],"(",["T_CONSTANT_ENCAPSED_STRING","'. '",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$result",202],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",202],"]",")",",",["T_WHITESPACE"," ",202],["T_STRING","self",202],["T_DOUBLE_COLON","::",202],["T_STRING","MESSAGE_STATUS_ERROR",202],")",";",["T_WHITESPACE","\n            ",202],"}",["T_WHITESPACE","\n        ",203],"}",["T_WHITESPACE"," ",204],["T_CATCH","catch",204],["T_WHITESPACE"," ",204],"(",["T_STRING","Mage_Core_Exception",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$e",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_message",205],"(",["T_VARIABLE","$e",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getMessage",205],"(",")",",",["T_WHITESPACE"," ",205],["T_STRING","self",205],["T_DOUBLE_COLON","::",205],["T_STRING","MESSAGE_STATUS_ERROR",205],")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE"," ",206],["T_CATCH","catch",206],["T_WHITESPACE"," ",206],"(",["T_STRING","Exception",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$e",206],")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_message",207],"(",["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","__",207],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to save shipping method.'",207],")",",",["T_WHITESPACE"," ",207],["T_STRING","self",207],["T_DOUBLE_COLON","::",207],["T_STRING","MESSAGE_STATUS_ERROR",207],")",";",["T_WHITESPACE","\n            ",207],["T_STRING","Mage",208],["T_DOUBLE_COLON","::",208],["T_STRING","logException",208],"(",["T_VARIABLE","$e",208],")",";",["T_WHITESPACE","\n        ",208],"}",["T_WHITESPACE","\n    ",209],"}",["T_WHITESPACE","\n\n    ",210],["T_DOC_COMMENT","\/**\n     * Shopping cart totals\n     *\n     * @return null\n     *\/",212],["T_WHITESPACE","\n    ",216],["T_PUBLIC","public",217],["T_WHITESPACE"," ",217],["T_FUNCTION","function",217],["T_WHITESPACE"," ",217],["T_STRING","cartTotalsAction",217],"(",")",["T_WHITESPACE","\n    ",217],"{",["T_WHITESPACE","\n        ",218],["T_TRY","try",219],["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_initCheckout",220],"(",")",";",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","loadLayout",221],"(",["T_STRING","false",221],")",";",["T_WHITESPACE","\n            ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","renderLayout",222],"(",")",";",["T_WHITESPACE","\n            ",222],["T_RETURN","return",223],";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE"," ",224],["T_CATCH","catch",224],["T_WHITESPACE"," ",224],"(",["T_STRING","Mage_Core_Exception",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$e",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_message",225],"(",["T_VARIABLE","$e",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getMessage",225],"(",")",",",["T_WHITESPACE"," ",225],["T_STRING","self",225],["T_DOUBLE_COLON","::",225],["T_STRING","MESSAGE_STATUS_ERROR",225],")",";",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE"," ",226],["T_CATCH","catch",226],["T_WHITESPACE"," ",226],"(",["T_STRING","Exception",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$e",226],")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_message",227],"(",["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","__",227],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to collect cart totals.'",227],")",",",["T_WHITESPACE"," ",227],["T_STRING","self",227],["T_DOUBLE_COLON","::",227],["T_STRING","MESSAGE_STATUS_ERROR",227],")",";",["T_WHITESPACE","\n            ",227],["T_STRING","Mage",228],["T_DOUBLE_COLON","::",228],["T_STRING","logException",228],"(",["T_VARIABLE","$e",228],")",";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n    ",229],"}",["T_WHITESPACE","\n\n    ",230],["T_DOC_COMMENT","\/**\n     * Submit the order\n     *\n     * @return null\n     *\/",232],["T_WHITESPACE","\n    ",236],["T_PUBLIC","public",237],["T_WHITESPACE"," ",237],["T_FUNCTION","function",237],["T_WHITESPACE"," ",237],["T_STRING","saveOrderAction",237],"(",")",["T_WHITESPACE","\n    ",237],"{",["T_WHITESPACE","\n        ",238],["T_IF","if",239],["T_WHITESPACE"," ",239],"(","!",["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getRequest",239],"(",")",["T_OBJECT_OPERATOR","->",239],["T_STRING","isPost",239],"(",")",")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_message",240],"(",["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","__",240],"(",["T_CONSTANT_ENCAPSED_STRING","'Specified invalid data.'",240],")",",",["T_WHITESPACE"," ",240],["T_STRING","self",240],["T_DOUBLE_COLON","::",240],["T_STRING","MESSAGE_STATUS_ERROR",240],")",";",["T_WHITESPACE","\n            ",240],["T_RETURN","return",241],";",["T_WHITESPACE","\n        ",241],"}",["T_WHITESPACE","\n\n        ",242],["T_TRY","try",244],["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n            ",244],["T_DOC_COMMENT","\/**\n             * Init checkout\n             *\/",245],["T_WHITESPACE","\n            ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","_initCheckout",248],"(",")",";",["T_WHITESPACE","\n\n            ",248],["T_DOC_COMMENT","\/**\n             * Set payment data\n             *\/",250],["T_WHITESPACE","\n            ",252],["T_VARIABLE","$data",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getRequest",253],"(",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","getPost",253],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",253],",",["T_WHITESPACE"," ",253],["T_ARRAY","array",253],"(",")",")",";",["T_WHITESPACE","\n\n            ",253],["T_IF","if",255],["T_WHITESPACE"," ",255],"(",["T_STRING","Mage",255],["T_DOUBLE_COLON","::",255],["T_STRING","getSingleton",255],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",255],")",["T_OBJECT_OPERATOR","->",255],["T_STRING","isLoggedIn",255],"(",")",")",["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n                ",255],["T_VARIABLE","$data",256],"[",["T_CONSTANT_ENCAPSED_STRING","'payer'",256],"]",["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_STRING","Mage",256],["T_DOUBLE_COLON","::",256],["T_STRING","getSingleton",256],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",256],")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getCustomer",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getEmail",256],"(",")",";",["T_WHITESPACE","\n            ",256],"}",["T_WHITESPACE","\n\n            ",257],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_checkout",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","savePayment",259],"(",["T_VARIABLE","$data",259],")",";",["T_WHITESPACE","\n\n            ",259],["T_DOC_COMMENT","\/**\n             * Place order\n             *\/",261],["T_WHITESPACE","\n            ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_checkout",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","saveOrder",264],"(",")",";",["T_WHITESPACE","\n\n            ",264],["T_DOC_COMMENT","\/**\n             * Format success report\n             *\/",266],["T_WHITESPACE","\n            ",268],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",269],["T_WHITESPACE","\n            ",269],["T_VARIABLE","$message",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_STRING","Mage",270],["T_DOUBLE_COLON","::",270],["T_STRING","getModel",270],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",270],",",["T_WHITESPACE"," ",270],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",270],")",";",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$message",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","addChild",271],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",271],",",["T_WHITESPACE"," ",271],["T_STRING","self",271],["T_DOUBLE_COLON","::",271],["T_STRING","MESSAGE_STATUS_SUCCESS",271],")",";",["T_WHITESPACE","\n\n            ",271],["T_VARIABLE","$orderId",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_checkout",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getLastOrderId",273],"(",")",";",["T_WHITESPACE","\n\n            ",273],["T_VARIABLE","$text",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","__",275],"(",["T_CONSTANT_ENCAPSED_STRING","'Thank you for your purchase! '",275],")",";",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$text",276],["T_WHITESPACE"," ",276],["T_CONCAT_EQUAL",".=",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","__",276],"(",["T_CONSTANT_ENCAPSED_STRING","'Your order # is: %s. '",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$orderId",276],")",";",["T_WHITESPACE","\n            ",276],["T_VARIABLE","$text",277],["T_WHITESPACE"," ",277],["T_CONCAT_EQUAL",".=",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","__",277],"(",["T_CONSTANT_ENCAPSED_STRING","'You will receive an order confirmation email with details of your order and a link to track its progress.'",277],")",";",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$message",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","addChild",278],"(",["T_CONSTANT_ENCAPSED_STRING","'text'",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$text",278],")",";",["T_WHITESPACE","\n\n            ",278],["T_VARIABLE","$message",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","addChild",280],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",280],",",["T_WHITESPACE"," ",280],["T_VARIABLE","$orderId",280],")",";",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getResponse",281],"(",")",["T_OBJECT_OPERATOR","->",281],["T_STRING","setBody",281],"(",["T_VARIABLE","$message",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","asNiceXml",281],"(",")",")",";",["T_WHITESPACE","\n            ",281],["T_RETURN","return",282],";",["T_WHITESPACE","\n        ",282],"}",["T_WHITESPACE"," ",283],["T_CATCH","catch",283],["T_WHITESPACE"," ",283],"(",["T_STRING","Mage_Core_Exception",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$e",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","_message",284],"(",["T_VARIABLE","$e",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getMessage",284],"(",")",",",["T_WHITESPACE"," ",284],["T_STRING","self",284],["T_DOUBLE_COLON","::",284],["T_STRING","MESSAGE_STATUS_ERROR",284],")",";",["T_WHITESPACE","\n        ",284],"}",["T_WHITESPACE"," ",285],["T_CATCH","catch",285],["T_WHITESPACE"," ",285],"(",["T_STRING","Exception",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$e",285],")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n            ",285],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_message",286],"(",["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","__",286],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to place the order.'",286],")",",",["T_WHITESPACE"," ",286],["T_STRING","self",286],["T_DOUBLE_COLON","::",286],["T_STRING","MESSAGE_STATUS_ERROR",286],")",";",["T_WHITESPACE","\n            ",286],["T_STRING","Mage",287],["T_DOUBLE_COLON","::",287],["T_STRING","logException",287],"(",["T_VARIABLE","$e",287],")",";",["T_WHITESPACE","\n        ",287],"}",["T_WHITESPACE","\n    ",288],"}",["T_WHITESPACE","\n\n    ",289],["T_DOC_COMMENT","\/**\n     * Instantiate quote and checkout\n     *\n     * @throws Mage_Core_Exception\n     * @return null\n     *\/",291],["T_WHITESPACE","\n    ",296],["T_PROTECTED","protected",297],["T_WHITESPACE"," ",297],["T_FUNCTION","function",297],["T_WHITESPACE"," ",297],["T_STRING","_initCheckout",297],"(",")",["T_WHITESPACE","\n    ",297],"{",["T_WHITESPACE","\n\n        ",298],["T_VARIABLE","$quote",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","_getQuote",300],"(",")",";",["T_WHITESPACE","\n        ",300],["T_IF","if",301],["T_WHITESPACE"," ",301],"(","!",["T_VARIABLE","$quote",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","hasItems",301],"(",")",["T_WHITESPACE"," ",301],["T_BOOLEAN_OR","||",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$quote",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getHasError",301],"(",")",")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n            ",301],["T_STRING","Mage",302],["T_DOUBLE_COLON","::",302],["T_STRING","throwException",302],"(",["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","__",302],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize MEP Checkout.'",302],")",")",";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE","\n        ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(","!",["T_VARIABLE","$quote",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","validateMinimumAmount",304],"(",")",")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n            ",304],["T_VARIABLE","$error",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_STRING","Mage",305],["T_DOUBLE_COLON","::",305],["T_STRING","getStoreConfig",305],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/error_message'",305],")",";",["T_WHITESPACE","\n            ",305],["T_STRING","Mage",306],["T_DOUBLE_COLON","::",306],["T_STRING","throwException",306],"(",["T_VARIABLE","$error",306],")",";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_getCheckoutSession",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","setCartWasUpdated",308],"(",["T_STRING","false",308],")",";",["T_WHITESPACE","\n\n        ",308],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_checkout",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_STRING","Mage",310],["T_DOUBLE_COLON","::",310],["T_STRING","getSingleton",310],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/paypal_mep_checkout'",310],",",["T_WHITESPACE"," ",310],["T_ARRAY","array",310],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",310],["T_WHITESPACE","  ",310],["T_DOUBLE_ARROW","=>",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$quote",310],")",")",";",["T_WHITESPACE","\n    ",310],"}",["T_WHITESPACE","\n\n    ",311],["T_DOC_COMMENT","\/**\n     * Return checkout session object\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",313],["T_WHITESPACE","\n    ",317],["T_PROTECTED","protected",318],["T_WHITESPACE"," ",318],["T_FUNCTION","function",318],["T_WHITESPACE"," ",318],["T_STRING","_getCheckoutSession",318],"(",")",["T_WHITESPACE","\n    ",318],"{",["T_WHITESPACE","\n        ",319],["T_RETURN","return",320],["T_WHITESPACE"," ",320],["T_STRING","Mage",320],["T_DOUBLE_COLON","::",320],["T_STRING","getSingleton",320],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",320],")",";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * Return checkout quote object\n     *\n     * @return Mage_Sale_Model_Quote\n     *\/",323],["T_WHITESPACE","\n    ",327],["T_PROTECTED","protected",328],["T_WHITESPACE"," ",328],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","_getQuote",328],"(",")",["T_WHITESPACE","\n    ",328],"{",["T_WHITESPACE","\n        ",329],["T_IF","if",330],["T_WHITESPACE"," ",330],"(","!",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_quote",330],")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n            ",330],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","_quote",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","_getCheckoutSession",331],"(",")",["T_OBJECT_OPERATOR","->",331],["T_STRING","getQuote",331],"(",")",";",["T_WHITESPACE","\n        ",331],"}",["T_WHITESPACE","\n        ",332],["T_RETURN","return",333],["T_WHITESPACE"," ",333],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","_quote",333],";",["T_WHITESPACE","\n    ",333],"}",["T_WHITESPACE","\n",334],"}",["T_WHITESPACE","\n",335]]