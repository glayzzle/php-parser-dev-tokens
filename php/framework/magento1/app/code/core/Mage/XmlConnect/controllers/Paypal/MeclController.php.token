[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * XmlConnect PayPal Mobile Express Checkout Library checkout controller\n *\n * @category    Mage\n * @package     Mage_XmlConnect\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_XmlConnect_Paypal_MeclController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_XmlConnect_Controller_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Config mode type\n     *\n     * @var string\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_configType",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/payment_method_paypal_config'",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Config method type\n     *\n     * @var string\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_configMethod",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","Mage_XmlConnect_Model_Payment_Method_Paypal_Mecl",48],["T_DOUBLE_COLON","::",48],["T_STRING","MECL_METHOD_CODE",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Checkout mode type\n     *\n     * @var string\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_checkoutType",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/paypal_mecl_checkout'",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Paypal Mobile Express Checkout Library\n     *\n     * @var Mage_XmlConnect_Model_Payment_Method_Paypal_Mecl\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_checkout",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_STRING","null",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * PayPal Mobile Express Checkout Library config model\n     *\n     * @var Mage_XmlConnect_Model_Payment_Method_Paypal_Config\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$_config",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","null",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Checkout Quote\n     *\n     * @var Mage_Sales_Model_Quote\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$_quote",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","false",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Instantiate config\n     *\/",78],["T_WHITESPACE","\n    ",80],["T_PROTECTED","protected",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","_construct",81],"(",")",["T_WHITESPACE","\n    ",81],"{",["T_WHITESPACE","\n        ",82],["T_STRING","parent",83],["T_DOUBLE_COLON","::",83],["T_STRING","_construct",83],"(",")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_config",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","getModel",84],"(",["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_configType",84],",",["T_WHITESPACE"," ",84],["T_ARRAY","array",84],"(",["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_configMethod",84],")",")",";",["T_WHITESPACE","\n    ",84],"}",["T_WHITESPACE","\n\n    ",85],["T_DOC_COMMENT","\/**\n     * Make sure customer is logged in\n     *\n     * @return null\n     *\/",87],["T_WHITESPACE","\n    ",91],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","preDispatch",92],"(",")",["T_WHITESPACE","\n    ",92],"{",["T_WHITESPACE","\n        ",93],["T_STRING","parent",94],["T_DOUBLE_COLON","::",94],["T_STRING","preDispatch",94],"(",")",";",["T_WHITESPACE","\n        ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(","!",["T_STRING","Mage",95],["T_DOUBLE_COLON","::",95],["T_STRING","getSingleton",95],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",95],")",["T_OBJECT_OPERATOR","->",95],["T_STRING","isLoggedIn",95],"(",")",["T_WHITESPACE","\n            ",95],["T_BOOLEAN_AND","&&",96],["T_WHITESPACE"," ",96],"!",["T_STRING","Mage",96],["T_DOUBLE_COLON","::",96],["T_STRING","getSingleton",96],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",96],")",["T_OBJECT_OPERATOR","->",96],["T_STRING","getQuote",96],"(",")",["T_OBJECT_OPERATOR","->",96],["T_STRING","isAllowedGuestCheckout",96],"(",")",["T_WHITESPACE","\n        ",96],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","setFlag",98],"(",["T_CONSTANT_ENCAPSED_STRING","''",98],",",["T_WHITESPACE"," ",98],["T_STRING","self",98],["T_DOUBLE_COLON","::",98],["T_STRING","FLAG_NO_DISPATCH",98],",",["T_WHITESPACE"," ",98],["T_STRING","true",98],")",";",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_message",99],"(",["T_WHITESPACE","\n                ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","__",100],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer not logged in.'",100],")",",",["T_WHITESPACE"," ",100],["T_STRING","self",100],["T_DOUBLE_COLON","::",100],["T_STRING","MESSAGE_STATUS_ERROR",100],",",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],"(",["T_CONSTANT_ENCAPSED_STRING","'logged_in'",100],["T_WHITESPACE"," ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'0'",100],")",["T_WHITESPACE","\n            ",100],")",";",["T_WHITESPACE","\n            ",101],["T_RETURN","return",102],";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Start Mobile Express Checkout by requesting initial token and dispatching customer to PayPal\n     *\/",106],["T_WHITESPACE","\n    ",108],["T_PUBLIC","public",109],["T_WHITESPACE"," ",109],["T_FUNCTION","function",109],["T_WHITESPACE"," ",109],["T_STRING","startAction",109],"(",")",["T_WHITESPACE","\n    ",109],"{",["T_WHITESPACE","\n        ",110],["T_TRY","try",111],["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_initCheckout",112],"(",")",";",["T_WHITESPACE","\n\n            ",112],["T_VARIABLE","$customer",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","Mage",114],["T_DOUBLE_COLON","::",114],["T_STRING","getSingleton",114],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",114],")",["T_OBJECT_OPERATOR","->",114],["T_STRING","getCustomer",114],"(",")",";",["T_WHITESPACE","\n            ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$customer",115],["T_WHITESPACE"," ",115],["T_BOOLEAN_AND","&&",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$customer",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getId",115],"(",")",")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_checkout",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","setCustomerWithAddressChange",116],"(",["T_WHITESPACE","\n                    ",116],["T_VARIABLE","$customer",117],",",["T_WHITESPACE"," ",117],["T_STRING","null",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_getQuote",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getShippingAddress",117],"(",")",["T_WHITESPACE","\n                ",117],")",";",["T_WHITESPACE","\n            ",118],"}",["T_WHITESPACE","\n\n            ",119],["T_VARIABLE","$token",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_checkout",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","start",121],"(",["T_STRING","Mage",121],["T_DOUBLE_COLON","::",121],["T_STRING","getUrl",121],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/return'",121],")",",",["T_WHITESPACE"," ",121],["T_STRING","Mage",121],["T_DOUBLE_COLON","::",121],["T_STRING","getUrl",121],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/cancel'",121],")",")",";",["T_WHITESPACE","\n\n            ",121],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$token",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_initToken",124],"(",["T_VARIABLE","$token",124],")",";",["T_WHITESPACE","\n                ",124],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",125],["T_WHITESPACE","\n                ",125],["T_VARIABLE","$message",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","getModel",126],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",126],",",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",126],")",";",["T_WHITESPACE","\n                ",126],["T_VARIABLE","$message",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","addChild",127],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",127],",",["T_WHITESPACE"," ",127],["T_STRING","self",127],["T_DOUBLE_COLON","::",127],["T_STRING","MESSAGE_STATUS_SUCCESS",127],")",";",["T_WHITESPACE","\n                ",127],["T_VARIABLE","$message",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","addChild",128],"(",["T_CONSTANT_ENCAPSED_STRING","'token'",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$token",128],")",";",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getResponse",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","setBody",129],"(",["T_VARIABLE","$message",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","asNiceXml",129],"(",")",")",";",["T_WHITESPACE","\n            ",129],"}",["T_WHITESPACE"," ",130],["T_ELSE","else",130],["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_message",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","__",131],"(",["T_CONSTANT_ENCAPSED_STRING","'Token has not been set.'",131],")",",",["T_WHITESPACE"," ",131],["T_STRING","self",131],["T_DOUBLE_COLON","::",131],["T_STRING","MESSAGE_STATUS_ERROR",131],")",";",["T_WHITESPACE","\n            ",131],"}",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE"," ",133],["T_CATCH","catch",133],["T_WHITESPACE"," ",133],"(",["T_STRING","Mage_Core_Exception",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$e",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_message",134],"(",["T_VARIABLE","$e",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getMessage",134],"(",")",",",["T_WHITESPACE"," ",134],["T_STRING","self",134],["T_DOUBLE_COLON","::",134],["T_STRING","MESSAGE_STATUS_ERROR",134],")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE"," ",135],["T_CATCH","catch",135],["T_WHITESPACE"," ",135],"(",["T_STRING","Exception",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$e",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_message",136],"(",["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","__",136],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to start Mobile Express Checkout.'",136],")",",",["T_WHITESPACE"," ",136],["T_STRING","self",136],["T_DOUBLE_COLON","::",136],["T_STRING","MESSAGE_STATUS_ERROR",136],")",";",["T_WHITESPACE","\n            ",136],["T_STRING","Mage",137],["T_DOUBLE_COLON","::",137],["T_STRING","logException",137],"(",["T_VARIABLE","$e",137],")",";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n\n    ",139],["T_DOC_COMMENT","\/**\n     * Return from PayPal and dispatch customer to order review page\n     * (GetExpressCheckoutDetails method call)\n     *\/",141],["T_WHITESPACE","\n    ",144],["T_PUBLIC","public",145],["T_WHITESPACE"," ",145],["T_FUNCTION","function",145],["T_WHITESPACE"," ",145],["T_STRING","returnAction",145],"(",")",["T_WHITESPACE","\n    ",145],"{",["T_WHITESPACE","\n        ",146],["T_TRY","try",147],["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_initCheckout",148],"(",")",";",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_checkout",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","returnFromPaypal",149],"(",["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_initToken",149],"(",")",")",";",["T_WHITESPACE","\n\n            ",149],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_message",151],"(",["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","__",151],"(",["T_CONSTANT_ENCAPSED_STRING","'Mobile Express Checkout processed successfully.'",151],")",",",["T_WHITESPACE"," ",151],["T_STRING","self",151],["T_DOUBLE_COLON","::",151],["T_STRING","MESSAGE_STATUS_SUCCESS",151],")",";",["T_WHITESPACE","\n            ",151],["T_RETURN","return",152],";",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE"," ",153],["T_CATCH","catch",153],["T_WHITESPACE"," ",153],"(",["T_STRING","Mage_Core_Exception",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$e",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_message",154],"(",["T_VARIABLE","$e",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getMessage",154],"(",")",",",["T_WHITESPACE"," ",154],["T_STRING","self",154],["T_DOUBLE_COLON","::",154],["T_STRING","MESSAGE_STATUS_ERROR",154],")",";",["T_WHITESPACE","\n        ",154],"}",["T_WHITESPACE"," ",155],["T_CATCH","catch",155],["T_WHITESPACE"," ",155],"(",["T_STRING","Exception",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$e",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n            ",155],["T_STRING","Mage",156],["T_DOUBLE_COLON","::",156],["T_STRING","logException",156],"(",["T_VARIABLE","$e",156],")",";",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_message",157],"(",["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","__",157],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize return action.'",157],")",",",["T_WHITESPACE"," ",157],["T_STRING","self",157],["T_DOUBLE_COLON","::",157],["T_STRING","MESSAGE_STATUS_ERROR",157],")",";",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * Review order after returning from PayPal\n     *\/",161],["T_WHITESPACE","\n    ",163],["T_PUBLIC","public",164],["T_WHITESPACE"," ",164],["T_FUNCTION","function",164],["T_WHITESPACE"," ",164],["T_STRING","reviewAction",164],"(",")",["T_WHITESPACE","\n    ",164],"{",["T_WHITESPACE","\n        ",165],["T_IF","if",166],["T_WHITESPACE"," ",166],"(",["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_checkApiForward",166],"(",["T_CONSTANT_ENCAPSED_STRING","'orderReview'",166],",",["T_WHITESPACE"," ",166],["T_STRING","Mage_XmlConnect_Helper_Data",166],["T_DOUBLE_COLON","::",166],["T_STRING","DEVICE_API_V_23",166],")",")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_RETURN","return",167],";",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n        ",168],["T_TRY","try",169],["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_initCheckout",170],"(",")",";",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_checkout",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","prepareOrderReview",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_initToken",171],"(",")",")",";",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","loadLayout",172],"(",["T_STRING","false",172],")",";",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_initLayoutMessages",173],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/session'",173],")",";",["T_WHITESPACE","\n\n            ",173],["T_VARIABLE","$messages",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_getSession",175],"(",")",["T_OBJECT_OPERATOR","->",175],["T_STRING","getMessages",175],"(",["T_STRING","true",175],")",";",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$messageArray",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_ARRAY","array",176],"(",")",";",["T_WHITESPACE","\n            ",176],["T_FOREACH","foreach",177],["T_WHITESPACE"," ",177],"(",["T_VARIABLE","$messages",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getItems",177],"(",")",["T_WHITESPACE"," ",177],["T_AS","as",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$message",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$messageArray",178],"[","]",["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$message",178],";",["T_WHITESPACE","\n            ",178],"}",["T_WHITESPACE","\n\n            ",179],["T_VARIABLE","$detailsBlock",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getLayout",181],"(",")",["T_OBJECT_OPERATOR","->",181],["T_STRING","getBlock",181],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect.cart.paypal.mecl.review'",181],")",";",["T_WHITESPACE","\n            ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(",["T_STRING","count",182],"(",["T_VARIABLE","$messageArray",182],")",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n                ",182],["T_VARIABLE","$detailsBlock",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","setPaypalMessages",183],"(",["T_VARIABLE","$messageArray",183],")",";",["T_WHITESPACE","\n            ",183],"}",["T_WHITESPACE","\n\n            ",184],["T_VARIABLE","$detailsBlock",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","setQuote",186],"(",["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_getQuote",186],"(",")",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","getChild",186],"(",["T_CONSTANT_ENCAPSED_STRING","'details'",186],")",["T_OBJECT_OPERATOR","->",186],["T_STRING","setQuote",186],"(",["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_getQuote",186],"(",")",")",["T_WHITESPACE","\n                ",186],["T_OBJECT_OPERATOR","->",187],["T_STRING","getChild",187],"(",["T_CONSTANT_ENCAPSED_STRING","'totals'",187],")",["T_OBJECT_OPERATOR","->",187],["T_STRING","setQuote",187],"(",["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_getQuote",187],"(",")",")",";",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","renderLayout",188],"(",")",";",["T_WHITESPACE","\n            ",188],["T_RETURN","return",189],";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE"," ",190],["T_CATCH","catch",190],["T_WHITESPACE"," ",190],"(",["T_STRING","Mage_Core_Exception",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$e",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_message",191],"(",["T_VARIABLE","$e",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getMessage",191],"(",")",",",["T_WHITESPACE"," ",191],["T_STRING","self",191],["T_DOUBLE_COLON","::",191],["T_STRING","MESSAGE_STATUS_ERROR",191],")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE"," ",192],["T_CATCH","catch",192],["T_WHITESPACE"," ",192],"(",["T_STRING","Exception",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$e",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_message",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","__",193],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize express checkout review.'",193],")",",",["T_WHITESPACE"," ",193],["T_STRING","self",193],["T_DOUBLE_COLON","::",193],["T_STRING","MESSAGE_STATUS_ERROR",193],")",";",["T_WHITESPACE","\n            ",193],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","logException",194],"(",["T_VARIABLE","$e",194],")",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Order review after returning from PayPal\n     *\/",198],["T_WHITESPACE","\n    ",200],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","orderReviewAction",201],"(",")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_TRY","try",203],["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_initCheckout",204],"(",")",";",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_checkout",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","prepareOrderReview",205],"(",["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_initToken",205],"(",")",")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","loadLayout",206],"(",["T_STRING","false",206],")",";",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_initLayoutMessages",207],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/session'",207],")",";",["T_WHITESPACE","\n\n            ",207],["T_VARIABLE","$messages",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_getSession",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","getMessages",209],"(",["T_STRING","true",209],")",";",["T_WHITESPACE","\n            ",209],["T_VARIABLE","$messageArray",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],"(",")",";",["T_WHITESPACE","\n            ",210],["T_FOREACH","foreach",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$messages",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getItems",211],"(",")",["T_WHITESPACE"," ",211],["T_AS","as",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$message",211],")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n                ",211],["T_VARIABLE","$messageArray",212],"[","]",["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_VARIABLE","$message",212],";",["T_WHITESPACE","\n            ",212],"}",["T_WHITESPACE","\n\n            ",213],["T_VARIABLE","$detailsBlock",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getLayout",215],"(",")",["T_OBJECT_OPERATOR","->",215],["T_STRING","getBlock",215],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect.cart.paypal.mecl.review'",215],")",";",["T_WHITESPACE","\n            ",215],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_STRING","count",216],"(",["T_VARIABLE","$messageArray",216],")",")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n                ",216],["T_VARIABLE","$detailsBlock",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","setPaypalMessages",217],"(",["T_VARIABLE","$messageArray",217],")",";",["T_WHITESPACE","\n            ",217],"}",["T_WHITESPACE","\n\n            ",218],["T_VARIABLE","$detailsBlock",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","setQuote",220],"(",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_getQuote",220],"(",")",")",["T_OBJECT_OPERATOR","->",220],["T_STRING","getChild",220],"(",["T_CONSTANT_ENCAPSED_STRING","'details'",220],")",["T_OBJECT_OPERATOR","->",220],["T_STRING","setQuote",220],"(",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_getQuote",220],"(",")",")",["T_WHITESPACE","\n                ",220],["T_OBJECT_OPERATOR","->",221],["T_STRING","getChild",221],"(",["T_CONSTANT_ENCAPSED_STRING","'totals'",221],")",";",["T_WHITESPACE","\n\n            ",221],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","renderLayout",223],"(",")",";",["T_WHITESPACE","\n            ",223],["T_RETURN","return",224],";",["T_WHITESPACE","\n        ",224],"}",["T_WHITESPACE"," ",225],["T_CATCH","catch",225],["T_WHITESPACE"," ",225],"(",["T_STRING","Mage_Core_Exception",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$e",225],")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n            ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_message",226],"(",["T_VARIABLE","$e",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getMessage",226],"(",")",",",["T_WHITESPACE"," ",226],["T_STRING","self",226],["T_DOUBLE_COLON","::",226],["T_STRING","MESSAGE_STATUS_ERROR",226],")",";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE"," ",227],["T_CATCH","catch",227],["T_WHITESPACE"," ",227],"(",["T_STRING","Exception",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$e",227],")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_message",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","__",228],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize express checkout review.'",228],")",",",["T_WHITESPACE"," ",228],["T_STRING","self",228],["T_DOUBLE_COLON","::",228],["T_STRING","MESSAGE_STATUS_ERROR",228],")",";",["T_WHITESPACE","\n            ",228],["T_STRING","Mage",229],["T_DOUBLE_COLON","::",229],["T_STRING","logException",229],"(",["T_VARIABLE","$e",229],")",";",["T_WHITESPACE","\n        ",229],"}",["T_WHITESPACE","\n    ",230],"}",["T_WHITESPACE","\n\n    ",231],["T_DOC_COMMENT","\/**\n     * Get shipping method list for PayPal\n     *\/",233],["T_WHITESPACE","\n    ",235],["T_PUBLIC","public",236],["T_WHITESPACE"," ",236],["T_FUNCTION","function",236],["T_WHITESPACE"," ",236],["T_STRING","shippingMethodsAction",236],"(",")",["T_WHITESPACE","\n    ",236],"{",["T_WHITESPACE","\n        ",237],["T_TRY","try",238],["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","_initCheckout",239],"(",")",";",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_checkout",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","prepareOrderReview",240],"(",["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_initToken",240],"(",")",")",";",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","loadLayout",241],"(",["T_STRING","false",241],")",";",["T_WHITESPACE","\n\n            ",241],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getLayout",243],"(",")",["T_OBJECT_OPERATOR","->",243],["T_STRING","getBlock",243],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect.cart.paypal.mecl.shippingmethods'",243],")",["T_OBJECT_OPERATOR","->",243],["T_STRING","setQuote",243],"(",["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_getQuote",243],"(",")",")",";",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","renderLayout",244],"(",")",";",["T_WHITESPACE","\n            ",244],["T_RETURN","return",245],";",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE"," ",246],["T_CATCH","catch",246],["T_WHITESPACE"," ",246],"(",["T_STRING","Mage_Core_Exception",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$e",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_message",247],"(",["T_VARIABLE","$e",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getMessage",247],"(",")",",",["T_WHITESPACE"," ",247],["T_STRING","self",247],["T_DOUBLE_COLON","::",247],["T_STRING","MESSAGE_STATUS_ERROR",247],")",";",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE"," ",248],["T_CATCH","catch",248],["T_WHITESPACE"," ",248],"(",["T_STRING","Exception",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$e",248],")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","_message",249],"(",["T_WHITESPACE","\n                ",249],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","__",250],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize express checkout shipping method list.'",250],")",",",["T_WHITESPACE"," ",250],["T_STRING","self",250],["T_DOUBLE_COLON","::",250],["T_STRING","MESSAGE_STATUS_ERROR",250],["T_WHITESPACE","\n            ",250],")",";",["T_WHITESPACE","\n            ",251],["T_STRING","Mage",252],["T_DOUBLE_COLON","::",252],["T_STRING","logException",252],"(",["T_VARIABLE","$e",252],")",";",["T_WHITESPACE","\n        ",252],"}",["T_WHITESPACE","\n    ",253],"}",["T_WHITESPACE","\n\n    ",254],["T_DOC_COMMENT","\/**\n     * Update shipping method (combined action for ajax and regular request)\n     *\/",256],["T_WHITESPACE","\n    ",258],["T_PUBLIC","public",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","saveShippingMethodAction",259],"(",")",["T_WHITESPACE","\n    ",259],"{",["T_WHITESPACE","\n        ",260],["T_TRY","try",261],["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","_initCheckout",262],"(",")",";",["T_WHITESPACE","\n            ",262],["T_IF","if",263],["T_WHITESPACE"," ",263],"(",["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getRequest",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","getParam",263],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",263],",",["T_WHITESPACE"," ",263],["T_STRING","false",263],")",")",["T_WHITESPACE"," ",263],"{",["T_WHITESPACE","\n                ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_checkout",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","updateShippingMethod",264],"(",["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getRequest",264],"(",")",["T_OBJECT_OPERATOR","->",264],["T_STRING","getParam",264],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",264],")",")",";",["T_WHITESPACE","\n                ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_getQuote",265],"(",")",["T_OBJECT_OPERATOR","->",265],["T_STRING","save",265],"(",")",";",["T_WHITESPACE","\n                ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","_message",266],"(",["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","__",266],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping method successfully updated'",266],")",",",["T_WHITESPACE"," ",266],["T_STRING","self",266],["T_DOUBLE_COLON","::",266],["T_STRING","MESSAGE_STATUS_SUCCESS",266],")",";",["T_WHITESPACE","\n            ",266],"}",["T_WHITESPACE"," ",267],["T_ELSE","else",267],["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n                ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_message",268],"(",["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","__",268],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping method is required'",268],")",",",["T_WHITESPACE"," ",268],["T_STRING","self",268],["T_DOUBLE_COLON","::",268],["T_STRING","MESSAGE_STATUS_ERROR",268],")",";",["T_WHITESPACE","\n            ",268],"}",["T_WHITESPACE","\n            ",269],["T_RETURN","return",270],";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE"," ",271],["T_CATCH","catch",271],["T_WHITESPACE"," ",271],"(",["T_STRING","Mage_Core_Exception",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$e",271],")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n            ",271],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","_message",272],"(",["T_VARIABLE","$e",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getMessage",272],"(",")",",",["T_WHITESPACE"," ",272],["T_STRING","self",272],["T_DOUBLE_COLON","::",272],["T_STRING","MESSAGE_STATUS_ERROR",272],")",";",["T_WHITESPACE","\n        ",272],"}",["T_WHITESPACE"," ",273],["T_CATCH","catch",273],["T_WHITESPACE"," ",273],"(",["T_STRING","Exception",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$e",273],")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_message",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","__",274],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to update shipping method.'",274],")",",",["T_WHITESPACE"," ",274],["T_STRING","self",274],["T_DOUBLE_COLON","::",274],["T_STRING","MESSAGE_STATUS_ERROR",274],")",";",["T_WHITESPACE","\n            ",274],["T_STRING","Mage",275],["T_DOUBLE_COLON","::",275],["T_STRING","logException",275],"(",["T_VARIABLE","$e",275],")",";",["T_WHITESPACE","\n        ",275],"}",["T_WHITESPACE","\n    ",276],"}",["T_WHITESPACE","\n\n    ",277],["T_DOC_COMMENT","\/**\n     * Submit the order\n     *\/",279],["T_WHITESPACE","\n    ",281],["T_PUBLIC","public",282],["T_WHITESPACE"," ",282],["T_FUNCTION","function",282],["T_WHITESPACE"," ",282],["T_STRING","placeOrderAction",282],"(",")",["T_WHITESPACE","\n    ",282],"{",["T_WHITESPACE","\n        ",283],["T_TRY","try",284],["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$requiredAgreements",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_STRING","Mage",285],["T_DOUBLE_COLON","::",285],["T_STRING","helper",285],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",285],")",["T_OBJECT_OPERATOR","->",285],["T_STRING","getRequiredAgreementIds",285],"(",")",";",["T_WHITESPACE","\n            ",285],["T_IF","if",286],["T_WHITESPACE"," ",286],"(","!",["T_EMPTY","empty",286],"(",["T_VARIABLE","$requiredAgreements",286],")",")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n                ",286],["T_VARIABLE","$postedAgreements",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_STRING","array_keys",287],"(",["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getRequest",287],"(",")",["T_OBJECT_OPERATOR","->",287],["T_STRING","getPost",287],"(",["T_CONSTANT_ENCAPSED_STRING","'agreement'",287],",",["T_WHITESPACE"," ",287],["T_ARRAY","array",287],"(",")",")",")",";",["T_WHITESPACE","\n                ",287],["T_IF","if",288],["T_WHITESPACE"," ",288],"(",["T_STRING","array_diff",288],"(",["T_VARIABLE","$requiredAgreements",288],",",["T_WHITESPACE"," ",288],["T_VARIABLE","$postedAgreements",288],")",")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n                    ",288],["T_VARIABLE","$error",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","__",289],"(",["T_CONSTANT_ENCAPSED_STRING","'Please agree to all the terms and conditions before placing the order.'",289],")",";",["T_WHITESPACE","\n                    ",289],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_message",290],"(",["T_VARIABLE","$error",290],",",["T_WHITESPACE"," ",290],["T_STRING","self",290],["T_DOUBLE_COLON","::",290],["T_STRING","MESSAGE_STATUS_ERROR",290],")",";",["T_WHITESPACE","\n                    ",290],["T_RETURN","return",291],";",["T_WHITESPACE","\n                ",291],"}",["T_WHITESPACE","\n            ",292],"}",["T_WHITESPACE","\n\n            ",293],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_initCheckout",295],"(",")",";",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_checkout",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","place",296],"(",["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","_initToken",296],"(",")",")",";",["T_WHITESPACE","\n\n            ",296],["T_COMMENT","\/\/ prepare session to success or cancellation page\n",298],["T_WHITESPACE","            ",299],["T_VARIABLE","$session",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_getCheckoutSession",299],"(",")",";",["T_WHITESPACE","\n            ",299],["T_VARIABLE","$session",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","clearHelperData",300],"(",")",";",["T_WHITESPACE","\n\n            ",300],["T_COMMENT","\/\/ \"last successful quote\"\n",302],["T_WHITESPACE","            ",303],["T_VARIABLE","$quoteId",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_getQuote",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","getId",303],"(",")",";",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$session",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","setLastQuoteId",304],"(",["T_VARIABLE","$quoteId",304],")",["T_OBJECT_OPERATOR","->",304],["T_STRING","setLastSuccessQuoteId",304],"(",["T_VARIABLE","$quoteId",304],")",";",["T_WHITESPACE","\n\n            ",304],["T_COMMENT","\/\/ an order may be created\n",306],["T_WHITESPACE","            ",307],["T_VARIABLE","$order",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","_checkout",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getOrder",307],"(",")",";",["T_WHITESPACE","\n            ",307],["T_IF","if",308],["T_WHITESPACE"," ",308],"(",["T_VARIABLE","$order",308],")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n                ",308],["T_VARIABLE","$orderId",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$order",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getId",309],"(",")",";",["T_WHITESPACE","\n                ",309],["T_VARIABLE","$realOrderId",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_VARIABLE","$order",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getIncrementId",310],"(",")",";",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$session",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","setLastOrderId",311],"(",["T_VARIABLE","$order",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getId",311],"(",")",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","setLastRealOrderId",311],"(",["T_VARIABLE","$order",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getIncrementId",311],"(",")",")",";",["T_WHITESPACE","\n            ",311],"}",["T_WHITESPACE","\n\n            ",312],["T_COMMENT","\/\/ recurring profiles may be created along with the order or without it\n",314],["T_WHITESPACE","            ",315],["T_VARIABLE","$profiles",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_checkout",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getRecurringPaymentProfiles",315],"(",")",";",["T_WHITESPACE","\n            ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(",["T_VARIABLE","$profiles",316],")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n                ",316],["T_VARIABLE","$ids",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_ARRAY","array",317],"(",")",";",["T_WHITESPACE","\n                ",317],["T_FOREACH","foreach",318],"(",["T_VARIABLE","$profiles",318],["T_WHITESPACE"," ",318],["T_AS","as",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$profile",318],")",["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n                    ",318],["T_VARIABLE","$ids",319],"[","]",["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_VARIABLE","$profile",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getId",319],"(",")",";",["T_WHITESPACE","\n                ",319],"}",["T_WHITESPACE","\n                ",320],["T_VARIABLE","$session",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","setLastRecurringProfileIds",321],"(",["T_VARIABLE","$ids",321],")",";",["T_WHITESPACE","\n            ",321],"}",["T_WHITESPACE","\n\n            ",322],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_initToken",324],"(",["T_STRING","false",324],")",";",["T_WHITESPACE"," ",324],["T_COMMENT","\/\/ no need in token anymore\n",324],["T_WHITESPACE","\n            ",325],["T_DOC_COMMENT","\/** @var $message Mage_XmlConnect_Model_Simplexml_Element *\/",326],["T_WHITESPACE","\n            ",326],["T_VARIABLE","$message",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_STRING","Mage",327],["T_DOUBLE_COLON","::",327],["T_STRING","getModel",327],"(",["T_CONSTANT_ENCAPSED_STRING","'xmlconnect\/simplexml_element'",327],",",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'<message><\/message>'",327],")",";",["T_WHITESPACE","\n            ",327],["T_VARIABLE","$message",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","addChild",328],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",328],",",["T_WHITESPACE"," ",328],["T_STRING","self",328],["T_DOUBLE_COLON","::",328],["T_STRING","MESSAGE_STATUS_SUCCESS",328],")",";",["T_WHITESPACE","\n\n            ",328],["T_VARIABLE","$text",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","__",330],"(",["T_CONSTANT_ENCAPSED_STRING","'Thank you for your purchase! '",330],")",";",["T_WHITESPACE","\n            ",330],["T_VARIABLE","$text",331],["T_WHITESPACE"," ",331],["T_CONCAT_EQUAL",".=",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","__",331],"(",["T_CONSTANT_ENCAPSED_STRING","'Your order # is: %s. '",331],",",["T_WHITESPACE"," ",331],["T_VARIABLE","$realOrderId",331],")",";",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$text",332],["T_WHITESPACE"," ",332],["T_CONCAT_EQUAL",".=",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","__",332],"(",["T_CONSTANT_ENCAPSED_STRING","'You will receive an order confirmation email with details of your order and a link to track its progress.'",332],")",";",["T_WHITESPACE","\n            ",332],["T_VARIABLE","$message",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","addChild",333],"(",["T_CONSTANT_ENCAPSED_STRING","'text'",333],",",["T_WHITESPACE"," ",333],["T_VARIABLE","$text",333],")",";",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$message",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","addChild",334],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",334],",",["T_WHITESPACE"," ",334],["T_VARIABLE","$orderId",334],")",";",["T_WHITESPACE","\n            ",334],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getResponse",335],"(",")",["T_OBJECT_OPERATOR","->",335],["T_STRING","setBody",335],"(",["T_VARIABLE","$message",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","asNiceXml",335],"(",")",")",";",["T_WHITESPACE","\n            ",335],["T_RETURN","return",336],";",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE"," ",337],["T_CATCH","catch",337],["T_WHITESPACE"," ",337],"(",["T_STRING","Mage_Core_Exception",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$e",337],")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n            ",337],["T_VARIABLE","$this",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","_message",338],"(",["T_VARIABLE","$e",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getMessage",338],"(",")",",",["T_WHITESPACE"," ",338],["T_STRING","self",338],["T_DOUBLE_COLON","::",338],["T_STRING","MESSAGE_STATUS_ERROR",338],")",";",["T_WHITESPACE","\n        ",338],"}",["T_WHITESPACE"," ",339],["T_CATCH","catch",339],["T_WHITESPACE"," ",339],"(",["T_STRING","Exception",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$e",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","_message",340],"(",["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","__",340],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to place the order.'",340],")",",",["T_WHITESPACE"," ",340],["T_STRING","self",340],["T_DOUBLE_COLON","::",340],["T_STRING","MESSAGE_STATUS_ERROR",340],")",";",["T_WHITESPACE","\n            ",340],["T_STRING","Mage",341],["T_DOUBLE_COLON","::",341],["T_STRING","logException",341],"(",["T_VARIABLE","$e",341],")",";",["T_WHITESPACE","\n        ",341],"}",["T_WHITESPACE","\n    ",342],"}",["T_WHITESPACE","\n\n    ",343],["T_DOC_COMMENT","\/**\n     * Cancel Mobile Express Checkout\n     *\/",345],["T_WHITESPACE","\n    ",347],["T_PUBLIC","public",348],["T_WHITESPACE"," ",348],["T_FUNCTION","function",348],["T_WHITESPACE"," ",348],["T_STRING","cancelAction",348],"(",")",["T_WHITESPACE","\n    ",348],"{",["T_WHITESPACE","\n        ",349],["T_TRY","try",350],["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n            ",350],["T_COMMENT","\/\/ if there is an order - cancel it\n",351],["T_WHITESPACE","            ",352],["T_VARIABLE","$orderId",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","_getCheckoutSession",352],"(",")",["T_OBJECT_OPERATOR","->",352],["T_STRING","getLastOrderId",352],"(",")",";",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$order",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],"(",["T_VARIABLE","$orderId",353],")",["T_WHITESPACE"," ",353],"?",["T_WHITESPACE"," ",353],["T_STRING","Mage",353],["T_DOUBLE_COLON","::",353],["T_STRING","getModel",353],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",353],")",["T_OBJECT_OPERATOR","->",353],["T_STRING","load",353],"(",["T_VARIABLE","$orderId",353],")",["T_WHITESPACE"," ",353],":",["T_WHITESPACE"," ",353],["T_STRING","false",353],";",["T_WHITESPACE","\n\n            ",353],["T_IF","if",355],["T_WHITESPACE"," ",355],"(",["T_VARIABLE","$order",355],["T_WHITESPACE"," ",355],["T_BOOLEAN_AND","&&",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$order",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getId",355],"(",")",["T_WHITESPACE"," ",355],["T_BOOLEAN_AND","&&",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$order",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getQuoteId",355],"(",")",["T_WHITESPACE"," ",355],["T_IS_EQUAL","==",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","_getCheckoutSession",355],"(",")",["T_OBJECT_OPERATOR","->",355],["T_STRING","getQuoteId",355],"(",")",")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n                ",355],["T_VARIABLE","$order",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","cancel",356],"(",")",["T_OBJECT_OPERATOR","->",356],["T_STRING","save",356],"(",")",";",["T_WHITESPACE","\n                ",356],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_getCheckoutSession",357],"(",")",["T_OBJECT_OPERATOR","->",357],["T_STRING","unsLastQuoteId",357],"(",")",["T_OBJECT_OPERATOR","->",357],["T_STRING","unsLastSuccessQuoteId",357],"(",")",["T_OBJECT_OPERATOR","->",357],["T_STRING","unsLastOrderId",357],"(",")",["T_WHITESPACE","\n                    ",357],["T_OBJECT_OPERATOR","->",358],["T_STRING","unsLastRealOrderId",358],"(",")",";",["T_WHITESPACE","\n            ",358],"}",["T_WHITESPACE","\n            ",359],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","_initToken",360],"(",["T_STRING","false",360],")",";",["T_WHITESPACE","\n            ",360],["T_VARIABLE","$this",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","_message",361],"(",["T_VARIABLE","$this",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","__",361],"(",["T_CONSTANT_ENCAPSED_STRING","'Mobile Express Checkout has been canceled.'",361],")",",",["T_WHITESPACE"," ",361],["T_STRING","self",361],["T_DOUBLE_COLON","::",361],["T_STRING","MESSAGE_STATUS_SUCCESS",361],")",";",["T_WHITESPACE","\n        ",361],"}",["T_WHITESPACE"," ",362],["T_CATCH","catch",362],["T_WHITESPACE"," ",362],"(",["T_STRING","Mage_Core_Exception",362],["T_WHITESPACE"," ",362],["T_VARIABLE","$e",362],")",["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n            ",362],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","_message",363],"(",["T_VARIABLE","$e",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getMessage",363],"(",")",",",["T_WHITESPACE"," ",363],["T_STRING","self",363],["T_DOUBLE_COLON","::",363],["T_STRING","MESSAGE_STATUS_ERROR",363],")",";",["T_WHITESPACE","\n        ",363],"}",["T_WHITESPACE"," ",364],["T_CATCH","catch",364],["T_WHITESPACE"," ",364],"(",["T_STRING","Exception",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$e",364],")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n            ",364],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_message",365],"(",["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","__",365],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to cancel Mobile Express Checkout.'",365],")",",",["T_WHITESPACE"," ",365],["T_STRING","self",365],["T_DOUBLE_COLON","::",365],["T_STRING","MESSAGE_STATUS_ERROR",365],")",";",["T_WHITESPACE","\n            ",365],["T_STRING","Mage",366],["T_DOUBLE_COLON","::",366],["T_STRING","logException",366],"(",["T_VARIABLE","$e",366],")",";",["T_WHITESPACE","\n        ",366],"}",["T_WHITESPACE","\n    ",367],"}",["T_WHITESPACE","\n\n    ",368],["T_DOC_COMMENT","\/**\n     * Instantiate quote and checkout\n     *\n     * @throws Mage_Core_Exception\n     * @return null\n     *\/",370],["T_WHITESPACE","\n    ",375],["T_PROTECTED","protected",376],["T_WHITESPACE"," ",376],["T_FUNCTION","function",376],["T_WHITESPACE"," ",376],["T_STRING","_initCheckout",376],"(",")",["T_WHITESPACE","\n    ",376],"{",["T_WHITESPACE","\n        ",377],["T_VARIABLE","$quote",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_getQuote",378],"(",")",";",["T_WHITESPACE","\n        ",378],["T_IF","if",379],["T_WHITESPACE"," ",379],"(","!",["T_VARIABLE","$quote",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","hasItems",379],"(",")",["T_WHITESPACE"," ",379],["T_BOOLEAN_OR","||",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$quote",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","getHasError",379],"(",")",")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n            ",379],["T_STRING","Mage",380],["T_DOUBLE_COLON","::",380],["T_STRING","throwException",380],"(",["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","__",380],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to initialize PayPal Mobile Express Checkout.'",380],")",")",";",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE","\n        ",381],["T_IF","if",382],["T_WHITESPACE"," ",382],"(","!",["T_VARIABLE","$quote",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","validateMinimumAmount",382],"(",")",")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_VARIABLE","$error",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_STRING","Mage",383],["T_DOUBLE_COLON","::",383],["T_STRING","getStoreConfig",383],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/error_message'",383],")",";",["T_WHITESPACE","\n            ",383],["T_STRING","Mage",384],["T_DOUBLE_COLON","::",384],["T_STRING","throwException",384],"(",["T_VARIABLE","$error",384],")",";",["T_WHITESPACE","\n        ",384],"}",["T_WHITESPACE","\n        ",385],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_getCheckoutSession",386],"(",")",["T_OBJECT_OPERATOR","->",386],["T_STRING","setCartWasUpdated",386],"(",["T_STRING","false",386],")",";",["T_WHITESPACE","\n\n        ",386],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","_checkout",388],["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_STRING","Mage",388],["T_DOUBLE_COLON","::",388],["T_STRING","getSingleton",388],"(",["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","_checkoutType",388],",",["T_WHITESPACE"," ",388],["T_ARRAY","array",388],"(",["T_WHITESPACE","\n            ",388],["T_CONSTANT_ENCAPSED_STRING","'config'",389],["T_WHITESPACE"," ",389],["T_DOUBLE_ARROW","=>",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_config",389],",",["T_WHITESPACE"," ",389],["T_CONSTANT_ENCAPSED_STRING","'quote'",389],["T_WHITESPACE","  ",389],["T_DOUBLE_ARROW","=>",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$quote",389],["T_WHITESPACE","\n        ",389],")",")",";",["T_WHITESPACE","\n    ",390],"}",["T_WHITESPACE","\n\n    ",391],["T_DOC_COMMENT","\/**\n     * Return checkout session object\n     *\n     * @return Mage_Checkout_Model_Session\n     *\/",393],["T_WHITESPACE","\n    ",397],["T_PROTECTED","protected",398],["T_WHITESPACE"," ",398],["T_FUNCTION","function",398],["T_WHITESPACE"," ",398],["T_STRING","_getCheckoutSession",398],"(",")",["T_WHITESPACE","\n    ",398],"{",["T_WHITESPACE","\n        ",399],["T_RETURN","return",400],["T_WHITESPACE"," ",400],["T_STRING","Mage",400],["T_DOUBLE_COLON","::",400],["T_STRING","getSingleton",400],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",400],")",";",["T_WHITESPACE","\n    ",400],"}",["T_WHITESPACE","\n\n    ",401],["T_DOC_COMMENT","\/**\n     * Return checkout quote object\n     *\n     * @return Mage_Sale_Model_Quote\n     *\/",403],["T_WHITESPACE","\n    ",407],["T_PROTECTED","protected",408],["T_WHITESPACE"," ",408],["T_FUNCTION","function",408],["T_WHITESPACE"," ",408],["T_STRING","_getQuote",408],"(",")",["T_WHITESPACE","\n    ",408],"{",["T_WHITESPACE","\n        ",409],["T_IF","if",410],["T_WHITESPACE"," ",410],"(","!",["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_quote",410],")",["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n            ",410],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_quote",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_getCheckoutSession",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","getQuote",411],"(",")",";",["T_WHITESPACE","\n        ",411],"}",["T_WHITESPACE","\n        ",412],["T_RETURN","return",413],["T_WHITESPACE"," ",413],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_quote",413],";",["T_WHITESPACE","\n    ",413],"}",["T_WHITESPACE","\n\n    ",414],["T_DOC_COMMENT","\/**\n     * Search for proper checkout token in request or session or (un)set specified one\n     * Combined getter\/setter\n     *\n     * @param string $setToken\n     * @return Mage_Paypal_ExpressController|string\n     *\/",416],["T_WHITESPACE","\n    ",422],["T_PROTECTED","protected",423],["T_WHITESPACE"," ",423],["T_FUNCTION","function",423],["T_WHITESPACE"," ",423],["T_STRING","_initToken",423],"(",["T_VARIABLE","$setToken",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_STRING","null",423],")",["T_WHITESPACE","\n    ",423],"{",["T_WHITESPACE","\n        ",424],["T_IF","if",425],["T_WHITESPACE"," ",425],"(",["T_STRING","null",425],["T_WHITESPACE"," ",425],["T_IS_NOT_IDENTICAL","!==",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$setToken",425],")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n            ",425],["T_IF","if",426],["T_WHITESPACE"," ",426],"(",["T_STRING","false",426],["T_WHITESPACE"," ",426],["T_IS_IDENTICAL","===",426],["T_WHITESPACE"," ",426],["T_VARIABLE","$setToken",426],")",["T_WHITESPACE"," ",426],"{",["T_WHITESPACE","\n                ",426],["T_IF","if",427],["T_WHITESPACE"," ",427],"(","!",["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","_getSession",427],"(",")",["T_OBJECT_OPERATOR","->",427],["T_STRING","getExpressCheckoutToken",427],"(",")",")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE"," ",427],["T_COMMENT","\/\/ security measure for avoid unset token twice\n",427],["T_WHITESPACE","                    ",428],["T_STRING","Mage",428],["T_DOUBLE_COLON","::",428],["T_STRING","throwException",428],"(",["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","__",428],"(",["T_CONSTANT_ENCAPSED_STRING","'PayPal Mobile Express Checkout Token does not exist.'",428],")",")",";",["T_WHITESPACE","\n                ",428],"}",["T_WHITESPACE","\n                ",429],["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","_getSession",430],"(",")",["T_OBJECT_OPERATOR","->",430],["T_STRING","unsExpressCheckoutToken",430],"(",")",";",["T_WHITESPACE","\n            ",430],"}",["T_WHITESPACE"," ",431],["T_ELSE","else",431],["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n                ",431],["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","_getSession",432],"(",")",["T_OBJECT_OPERATOR","->",432],["T_STRING","setExpressCheckoutToken",432],"(",["T_VARIABLE","$setToken",432],")",";",["T_WHITESPACE","\n            ",432],"}",["T_WHITESPACE","\n            ",433],["T_RETURN","return",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$this",434],";",["T_WHITESPACE","\n        ",434],"}",["T_WHITESPACE","\n\n        ",435],["T_VARIABLE","$setToken",437],["T_WHITESPACE"," ",437],"=",["T_WHITESPACE"," ",437],["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","getRequest",437],"(",")",["T_OBJECT_OPERATOR","->",437],["T_STRING","getParam",437],"(",["T_CONSTANT_ENCAPSED_STRING","'token'",437],")",";",["T_WHITESPACE","\n        ",437],["T_IF","if",438],["T_WHITESPACE"," ",438],"(",["T_VARIABLE","$setToken",438],")",["T_WHITESPACE"," ",438],"{",["T_WHITESPACE","\n            ",438],["T_IF","if",439],["T_WHITESPACE"," ",439],"(",["T_VARIABLE","$setToken",439],["T_WHITESPACE"," ",439],["T_IS_NOT_IDENTICAL","!==",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$this",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","_getSession",439],"(",")",["T_OBJECT_OPERATOR","->",439],["T_STRING","getExpressCheckoutToken",439],"(",")",")",["T_WHITESPACE"," ",439],"{",["T_WHITESPACE","\n                ",439],["T_STRING","Mage",440],["T_DOUBLE_COLON","::",440],["T_STRING","throwException",440],"(",["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","__",440],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong PayPal Mobile Express Checkout Token specified.'",440],")",")",";",["T_WHITESPACE","\n            ",440],"}",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE"," ",442],["T_ELSE","else",442],["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n            ",442],["T_VARIABLE","$setToken",443],["T_WHITESPACE"," ",443],"=",["T_WHITESPACE"," ",443],["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","_getSession",443],"(",")",["T_OBJECT_OPERATOR","->",443],["T_STRING","getExpressCheckoutToken",443],"(",")",";",["T_WHITESPACE","\n        ",443],"}",["T_WHITESPACE","\n        ",444],["T_RETURN","return",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$setToken",445],";",["T_WHITESPACE","\n    ",445],"}",["T_WHITESPACE","\n\n    ",446],["T_DOC_COMMENT","\/**\n     * PayPal session instance getter\n     *\n     * @return Mage_PayPal_Model_Session\n     *\/",448],["T_WHITESPACE","\n    ",452],["T_PRIVATE","private",453],["T_WHITESPACE"," ",453],["T_FUNCTION","function",453],["T_WHITESPACE"," ",453],["T_STRING","_getSession",453],"(",")",["T_WHITESPACE","\n    ",453],"{",["T_WHITESPACE","\n        ",454],["T_RETURN","return",455],["T_WHITESPACE"," ",455],["T_STRING","Mage",455],["T_DOUBLE_COLON","::",455],["T_STRING","getSingleton",455],"(",["T_CONSTANT_ENCAPSED_STRING","'paypal\/session'",455],")",";",["T_WHITESPACE","\n    ",455],"}",["T_WHITESPACE","\n",456],"}",["T_WHITESPACE","\n",457]]