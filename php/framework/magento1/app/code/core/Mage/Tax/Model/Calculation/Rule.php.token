[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tax\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Tax Rule Model\n *\n * @method Mage_Tax_Model_Resource_Calculation_Rule _getResource()\n * @method Mage_Tax_Model_Resource_Calculation_Rule getResource()\n * @method string getCode()\n * @method Mage_Tax_Model_Calculation_Rule setCode(string $value)\n * @method int getPriority()\n * @method Mage_Tax_Model_Calculation_Rule setPriority(int $value)\n * @method int getPosition()\n * @method Mage_Tax_Model_Calculation_Rule setPosition(int $value)\n *\n * @category    Mage\n * @package     Mage_Tax\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",42],["T_CLASS","class",43],["T_WHITESPACE"," ",43],["T_STRING","Mage_Tax_Model_Calculation_Rule",43],["T_WHITESPACE"," ",43],["T_EXTENDS","extends",43],["T_WHITESPACE"," ",43],["T_STRING","Mage_Core_Model_Abstract",43],["T_WHITESPACE","\n",43],"{",["T_WHITESPACE","\n    ",44],["T_DOC_COMMENT","\/**\n     * No references found in the project. Variable kept for backward compatibility\n     *\n     * @var null\n     *\/",45],["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$_ctcs",50],["T_WHITESPACE","                ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","null",50],";",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * No references found in the project. Variable kept for backward compatibility\n     *\n     * @var null\n     *\/",52],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$_ptcs",57],["T_WHITESPACE","                ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","null",57],";",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * No references found in the project. Variable kept for backward compatibility\n     *\n     * @var null\n     *\/",59],["T_WHITESPACE","\n    ",63],["T_PROTECTED","protected",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$_rates",64],["T_WHITESPACE","               ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","null",64],";",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * No references found in the project. Variable kept for backward compatibility\n     *\n     * @var null\n     *\/",66],["T_WHITESPACE","\n    ",70],["T_PROTECTED","protected",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$_ctcModel",71],["T_WHITESPACE","            ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","null",71],";",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * No references found in the project. Variable kept for backward compatibility\n     *\n     * @var null\n     *\/",73],["T_WHITESPACE","\n    ",77],["T_PROTECTED","protected",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$_ptcModel",78],["T_WHITESPACE","            ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","null",78],";",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * No references found in the project. Variable kept for backward compatibility\n     *\n     * @var Mage_Tax_Model_Calculation_Rate\n     *\/",80],["T_WHITESPACE","\n    ",84],["T_PROTECTED","protected",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$_rateModel",85],["T_WHITESPACE","           ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","null",85],";",["T_WHITESPACE","\n\n    ",85],["T_DOC_COMMENT","\/**\n     * Holds the tax Calculation model\n     *\n     * @var Mage_Tax_Model_Calculation\n     *\/",87],["T_WHITESPACE","\n    ",91],["T_PROTECTED","protected",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$_calculationModel",92],["T_WHITESPACE","    ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","null",92],";",["T_WHITESPACE","\n\n    ",92],["T_DOC_COMMENT","\/**\n     * Varien model constructor\n     *\/",94],["T_WHITESPACE","\n    ",96],["T_PROTECTED","protected",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","_construct",97],"(",")",["T_WHITESPACE","\n    ",97],"{",["T_WHITESPACE","\n        ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_init",99],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation_rule'",99],")",";",["T_WHITESPACE","\n    ",99],"}",["T_WHITESPACE","\n\n    ",100],["T_DOC_COMMENT","\/**\n     * After save rule\n     * Re - declared for populate rate calculations\n     *\n     * @return Mage_Tax_Model_Calculation_Rule\n     *\/",102],["T_WHITESPACE","\n    ",107],["T_PROTECTED","protected",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","_afterSave",108],"(",")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_STRING","parent",110],["T_DOUBLE_COLON","::",110],["T_STRING","_afterSave",110],"(",")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","saveCalculationData",111],"(",")",";",["T_WHITESPACE","\n        ",111],["T_STRING","Mage",112],["T_DOUBLE_COLON","::",112],["T_STRING","dispatchEvent",112],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_settings_change_after'",112],")",";",["T_WHITESPACE","\n        ",112],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * After rule delete\n     * redeclared for dispatch tax_settings_change_after event\n     *\n     * @return Mage_Tax_Model_Calculation_Rule\n     *\/",116],["T_WHITESPACE","\n    ",121],["T_PROTECTED","protected",122],["T_WHITESPACE"," ",122],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","_afterDelete",122],"(",")",["T_WHITESPACE","\n    ",122],"{",["T_WHITESPACE","\n        ",123],["T_STRING","Mage",124],["T_DOUBLE_COLON","::",124],["T_STRING","dispatchEvent",124],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_settings_change_after'",124],")",";",["T_WHITESPACE","\n        ",124],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_STRING","parent",125],["T_DOUBLE_COLON","::",125],["T_STRING","_afterDelete",125],"(",")",";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Saves the Calculation Data\n     *\/",128],["T_WHITESPACE","\n    ",130],["T_PUBLIC","public",131],["T_WHITESPACE"," ",131],["T_FUNCTION","function",131],["T_WHITESPACE"," ",131],["T_STRING","saveCalculationData",131],"(",")",["T_WHITESPACE","\n    ",131],"{",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$ctc",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getData",133],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_customer_class'",133],")",";",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$ptc",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getData",134],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_product_class'",134],")",";",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$rates",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getData",135],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_rate'",135],")",";",["T_WHITESPACE","\n\n        ",135],["T_STRING","Mage",137],["T_DOUBLE_COLON","::",137],["T_STRING","getSingleton",137],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",137],")",["T_OBJECT_OPERATOR","->",137],["T_STRING","deleteByRuleId",137],"(",["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getId",137],"(",")",")",";",["T_WHITESPACE","\n        ",137],["T_FOREACH","foreach",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$ctc",138],["T_WHITESPACE"," ",138],["T_AS","as",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$c",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_FOREACH","foreach",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$ptc",139],["T_WHITESPACE"," ",139],["T_AS","as",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$p",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_FOREACH","foreach",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$rates",140],["T_WHITESPACE"," ",140],["T_AS","as",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$r",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                    ",140],["T_VARIABLE","$dataArray",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_ARRAY","array",141],"(",["T_WHITESPACE","\n                        ",141],["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rule_id'",142],["T_WHITESPACE","   ",142],["T_DOUBLE_ARROW","=>",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getId",142],"(",")",",",["T_WHITESPACE","\n                        ",142],["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rate_id'",143],["T_WHITESPACE","   ",143],["T_DOUBLE_ARROW","=>",143],["T_VARIABLE","$r",143],",",["T_WHITESPACE","\n                        ",143],["T_CONSTANT_ENCAPSED_STRING","'customer_tax_class_id'",144],["T_WHITESPACE","     ",144],["T_DOUBLE_ARROW","=>",144],["T_VARIABLE","$c",144],",",["T_WHITESPACE","\n                        ",144],["T_CONSTANT_ENCAPSED_STRING","'product_tax_class_id'",145],["T_WHITESPACE","      ",145],["T_DOUBLE_ARROW","=>",145],["T_VARIABLE","$p",145],",",["T_WHITESPACE","\n                    ",145],")",";",["T_WHITESPACE","\n                    ",146],["T_STRING","Mage",147],["T_DOUBLE_COLON","::",147],["T_STRING","getSingleton",147],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",147],")",["T_OBJECT_OPERATOR","->",147],["T_STRING","setData",147],"(",["T_VARIABLE","$dataArray",147],")",["T_OBJECT_OPERATOR","->",147],["T_STRING","save",147],"(",")",";",["T_WHITESPACE","\n                ",147],"}",["T_WHITESPACE","\n            ",148],"}",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * @return Mage_Core_Model_Abstract|Mage_Tax_Model_Calculation|null\n     *\/",153],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","getCalculationModel",156],"(",")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_STRING","is_null",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_calculationModel",158],")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_calculationModel",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","Mage",159],["T_DOUBLE_COLON","::",159],["T_STRING","getSingleton",159],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",159],")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n        ",160],["T_RETURN","return",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_calculationModel",161],";",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * @return mixed\n     *\/",164],["T_WHITESPACE","\n    ",166],["T_PUBLIC","public",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","getRates",167],"(",")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_RETURN","return",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getCalculationModel",169],"(",")",["T_OBJECT_OPERATOR","->",169],["T_STRING","getRates",169],"(",["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getId",169],"(",")",")",";",["T_WHITESPACE","\n    ",169],"}",["T_WHITESPACE","\n\n    ",170],["T_DOC_COMMENT","\/**\n     * @return mixed\n     *\/",172],["T_WHITESPACE","\n    ",174],["T_PUBLIC","public",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","getCustomerTaxClasses",175],"(",")",["T_WHITESPACE","\n    ",175],"{",["T_WHITESPACE","\n        ",176],["T_RETURN","return",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getCalculationModel",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","getCustomerTaxClasses",177],"(",["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getId",177],"(",")",")",";",["T_WHITESPACE","\n    ",177],"}",["T_WHITESPACE","\n\n    ",178],["T_DOC_COMMENT","\/**\n     * @return mixed\n     *\/",180],["T_WHITESPACE","\n    ",182],["T_PUBLIC","public",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","getProductTaxClasses",183],"(",")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getCalculationModel",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","getProductTaxClasses",185],"(",["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getId",185],"(",")",")",";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Fetches rules by rate, customer tax class and product tax class\n     * and product tax class combination\n     *\n     * @param array $rateId\n     * @param array $customerTaxClassId\n     * @param array $productTaxClassId\n     * @return array\n     *\/",189],["T_WHITESPACE","\n    ",197],["T_PUBLIC","public",198],["T_WHITESPACE"," ",198],["T_FUNCTION","function",198],["T_WHITESPACE"," ",198],["T_STRING","fetchRuleCodes",198],"(",["T_VARIABLE","$rateId",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$customerTaxClassId",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$productTaxClassId",198],")",["T_WHITESPACE","\n    ",198],"{",["T_WHITESPACE","\n        ",199],["T_RETURN","return",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getResource",200],"(",")",["T_OBJECT_OPERATOR","->",200],["T_STRING","fetchRuleCodes",200],"(",["T_VARIABLE","$rateId",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$customerTaxClassId",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$productTaxClassId",200],")",";",["T_WHITESPACE","\n    ",200],"}",["T_WHITESPACE","\n",201],"}",["T_WHITESPACE","\n\n",202]]