[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tax\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog data helper\n *\/",27],["T_WHITESPACE","\n",29],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Tax_Helper_Data",30],["T_WHITESPACE"," ",30],["T_EXTENDS","extends",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Core_Helper_Abstract",30],["T_WHITESPACE","\n",30],"{",["T_WHITESPACE","\n    ",31],["T_DOC_COMMENT","\/**\n     * Price conversion constant for positive\n     *\/",32],["T_WHITESPACE","\n    ",34],["T_CONST","const",35],["T_WHITESPACE"," ",35],["T_STRING","PRICE_CONVERSION_PLUS",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_LNUMBER","1",35],";",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * Price conversion constat for negative\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","PRICE_CONVERSION_MINUS",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_LNUMBER","2",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Tax configuration object\n     *\n     * @var Mage_Tax_Model_Config\n     *\/",42],["T_WHITESPACE","\n    ",46],["T_PROTECTED","protected",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$_config",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","null",47],";",["T_WHITESPACE","\n\n    ",47],["T_DOC_COMMENT","\/**\n     * Tax calculator\n     *\n     * @var Mage_Tac_Model_Calculation\n     *\/",49],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_calculator",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","null",54],";",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Display tax column\n     *\n     * @var bool\n     *\/",56],["T_WHITESPACE","\n    ",60],["T_PROTECTED","protected",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$_displayTaxColumn",61],";",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Tax data\n     *\n     * @var mixed\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$_taxData",68],";",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Price includes tax\n     *\n     * @var bool\n     *\/",70],["T_WHITESPACE","\n    ",74],["T_PROTECTED","protected",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$_priceIncludesTax",75],";",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Shipping price includes tax\n     *\n     * @var bool\n     *\/",77],["T_WHITESPACE","\n    ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$_shippingPriceIncludesTax",82],";",["T_WHITESPACE","\n\n    ",82],["T_DOC_COMMENT","\/**\n     * Apply tax after discount\n     *\n     * @var bool\n     *\/",84],["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$_applyTaxAfterDiscount",89],";",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Price display type\n     *\n     * @var int\n     *\/",91],["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$_priceDisplayType",96],";",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Shipping price display type\n     *\n     * @var int\n     *\/",98],["T_WHITESPACE","\n    ",102],["T_PROTECTED","protected",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$_shippingPriceDisplayType",103],";",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Postcode cut to this length when creating search templates\n     *\n     * @var integer\n     *\/",105],["T_WHITESPACE","\n    ",109],["T_PROTECTED","protected",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$_postCodeSubStringLength",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_LNUMBER","10",110],";",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Application instance\n     *\n     * @var Mage_Core_Model_App\n     *\/",112],["T_WHITESPACE","\n    ",116],["T_PROTECTED","protected",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$_app",117],";",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * Initialize helper instance\n     *\n     * @param array $args\n     *\/",119],["T_WHITESPACE","\n    ",123],["T_PUBLIC","public",124],["T_WHITESPACE"," ",124],["T_FUNCTION","function",124],["T_WHITESPACE","  ",124],["T_STRING","__construct",124],"(",["T_ARRAY","array",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$args",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_ARRAY","array",124],"(",")",")",["T_WHITESPACE","\n    ",124],"{",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","_config",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","getSingleton",126],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/config'",126],")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_app",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],"!",["T_EMPTY","empty",127],"(",["T_VARIABLE","$args",127],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",127],"]",")",["T_WHITESPACE"," ",127],"?",["T_WHITESPACE"," ",127],["T_VARIABLE","$args",127],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",127],"]",["T_WHITESPACE"," ",127],":",["T_WHITESPACE"," ",127],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","app",127],"(",")",";",["T_WHITESPACE","\n    ",127],"}",["T_WHITESPACE","\n\n    ",128],["T_DOC_COMMENT","\/**\n     * Return max postcode length to create search templates\n     *\n     * @return integer  $len\n     *\/",130],["T_WHITESPACE","\n    ",134],["T_PUBLIC","public",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","getPostCodeSubStringLength",135],"(",")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$len",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_INT_CAST","(int)",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_postCodeSubStringLength",137],";",["T_WHITESPACE","\n        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$len",138],["T_WHITESPACE"," ",138],["T_IS_SMALLER_OR_EQUAL","<=",138],["T_WHITESPACE"," ",138],["T_LNUMBER","0",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$len",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_LNUMBER","10",139],";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n        ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$len",141],";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Get tax configuration object\n     *\n     * @return Mage_Tax_Model_Config\n     *\/",144],["T_WHITESPACE","\n    ",148],["T_PUBLIC","public",149],["T_WHITESPACE"," ",149],["T_FUNCTION","function",149],["T_WHITESPACE"," ",149],["T_STRING","getConfig",149],"(",")",["T_WHITESPACE","\n    ",149],"{",["T_WHITESPACE","\n        ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_config",151],";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Get tax calculation object\n     *\n     * @return  Mage_Tac_Model_Calculation\n     *\/",154],["T_WHITESPACE","\n    ",158],["T_PUBLIC","public",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","getCalculator",159],"(",")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_calculator",161],["T_WHITESPACE"," ",161],["T_IS_IDENTICAL","===",161],["T_WHITESPACE"," ",161],["T_STRING","null",161],")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_calculator",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","Mage",162],["T_DOUBLE_COLON","::",162],["T_STRING","getSingleton",162],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",162],")",";",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n        ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_calculator",164],";",["T_WHITESPACE","\n    ",164],"}",["T_WHITESPACE","\n\n    ",165],["T_DOC_COMMENT","\/**\n     * Get product price including store conversion rate\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @param   null|string $format\n     * @return  float|string\n     *\/",167],["T_WHITESPACE","\n    ",173],["T_PUBLIC","public",174],["T_WHITESPACE"," ",174],["T_FUNCTION","function",174],["T_WHITESPACE"," ",174],["T_STRING","getProductPrice",174],"(",["T_VARIABLE","$product",174],",",["T_WHITESPACE"," ",174],["T_VARIABLE","$format",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_STRING","null",174],")",["T_WHITESPACE","\n    ",174],"{",["T_WHITESPACE","\n        ",175],["T_TRY","try",176],["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$value",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$product",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getPrice",177],"(",")",";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$value",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_app",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getStore",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","convertPrice",178],"(",["T_VARIABLE","$value",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$format",178],")",";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE"," ",179],["T_CATCH","catch",179],["T_WHITESPACE"," ",179],"(",["T_STRING","Exception",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$e",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n            ",179],["T_VARIABLE","$value",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$e",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getMessage",180],"(",")",";",["T_WHITESPACE","\n        ",180],"}",["T_WHITESPACE","\n        ",181],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$value",182],";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Check if product prices inputted include tax\n     *\n     * @param   mix $store\n     * @return  bool\n     *\/",185],["T_WHITESPACE","\n    ",190],["T_PUBLIC","public",191],["T_WHITESPACE"," ",191],["T_FUNCTION","function",191],["T_WHITESPACE"," ",191],["T_STRING","priceIncludesTax",191],"(",["T_VARIABLE","$store",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","null",191],")",["T_WHITESPACE","\n    ",191],"{",["T_WHITESPACE","\n        ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_config",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","priceIncludesTax",193],"(",["T_VARIABLE","$store",193],")",["T_WHITESPACE"," ",193],["T_BOOLEAN_OR","||",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_config",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getNeedUseShippingExcludeTax",193],"(",")",";",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n\n    ",194],["T_DOC_COMMENT","\/**\n     * Check what taxes should be applied after discount\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",196],["T_WHITESPACE","\n    ",201],["T_PUBLIC","public",202],["T_WHITESPACE"," ",202],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","applyTaxAfterDiscount",202],"(",["T_VARIABLE","$store",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","null",202],")",["T_WHITESPACE","\n    ",202],"{",["T_WHITESPACE","\n        ",203],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_config",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","applyTaxAfterDiscount",204],"(",["T_VARIABLE","$store",204],")",";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Output\n     *\n     * @param bool $flag\n     * @param mixed $store\n     * @return string\n     *\/",207],["T_WHITESPACE","\n    ",213],["T_PUBLIC","public",214],["T_WHITESPACE"," ",214],["T_FUNCTION","function",214],["T_WHITESPACE"," ",214],["T_STRING","getIncExcText",214],"(",["T_VARIABLE","$flag",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$store",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_STRING","null",214],")",["T_WHITESPACE","\n    ",214],"{",["T_WHITESPACE","\n        ",215],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$flag",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$s",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","__",217],"(",["T_CONSTANT_ENCAPSED_STRING","'Incl. Tax'",217],")",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE"," ",218],["T_ELSE","else",218],["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$s",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","__",219],"(",["T_CONSTANT_ENCAPSED_STRING","'Excl. Tax'",219],")",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE","\n        ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$s",221],";",["T_WHITESPACE","\n    ",221],"}",["T_WHITESPACE","\n\n    ",222],["T_DOC_COMMENT","\/**\n     * Get product price display type\n     *  1 - Excluding tax\n     *  2 - Including tax\n     *  3 - Both\n     *\n     * @param   mixed $store\n     * @return  int\n     *\/",224],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","getPriceDisplayType",233],"(",["T_VARIABLE","$store",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_STRING","null",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_config",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getPriceDisplayType",235],"(",["T_VARIABLE","$store",235],")",";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_DOC_COMMENT","\/**\n     * Check if necessary do product price conversion\n     * If it necessary will be returned conversion type (minus or plus)\n     *\n     * @param   mixed $store\n     * @return  false | int\n     *\/",238],["T_WHITESPACE","\n    ",244],["T_PUBLIC","public",245],["T_WHITESPACE"," ",245],["T_FUNCTION","function",245],["T_WHITESPACE"," ",245],["T_STRING","needPriceConversion",245],"(",["T_VARIABLE","$store",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_STRING","null",245],")",["T_WHITESPACE","\n    ",245],"{",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$res",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_STRING","false",247],";",["T_WHITESPACE","\n        ",247],["T_IF","if",248],["T_WHITESPACE"," ",248],"(",["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","priceIncludesTax",248],"(",["T_VARIABLE","$store",248],")",")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n            ",248],["T_SWITCH","switch",249],["T_WHITESPACE"," ",249],"(",["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getPriceDisplayType",249],"(",["T_VARIABLE","$store",249],")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                ",249],["T_CASE","case",250],["T_WHITESPACE"," ",250],["T_STRING","Mage_Tax_Model_Config",250],["T_DOUBLE_COLON","::",250],["T_STRING","DISPLAY_TYPE_EXCLUDING_TAX",250],":",["T_WHITESPACE","\n                ",250],["T_CASE","case",251],["T_WHITESPACE"," ",251],["T_STRING","Mage_Tax_Model_Config",251],["T_DOUBLE_COLON","::",251],["T_STRING","DISPLAY_TYPE_BOTH",251],":",["T_WHITESPACE","\n                    ",251],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_STRING","self",252],["T_DOUBLE_COLON","::",252],["T_STRING","PRICE_CONVERSION_MINUS",252],";",["T_WHITESPACE","\n                ",252],["T_CASE","case",253],["T_WHITESPACE"," ",253],["T_STRING","Mage_Tax_Model_Config",253],["T_DOUBLE_COLON","::",253],["T_STRING","DISPLAY_TYPE_INCLUDING_TAX",253],":",["T_WHITESPACE","\n                    ",253],["T_VARIABLE","$res",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_STRING","true",254],";",["T_WHITESPACE","\n            ",254],"}",["T_WHITESPACE","\n        ",255],"}",["T_WHITESPACE"," ",256],["T_ELSE","else",256],["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_SWITCH","switch",257],["T_WHITESPACE"," ",257],"(",["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getPriceDisplayType",257],"(",["T_VARIABLE","$store",257],")",")",["T_WHITESPACE"," ",257],"{",["T_WHITESPACE","\n                ",257],["T_CASE","case",258],["T_WHITESPACE"," ",258],["T_STRING","Mage_Tax_Model_Config",258],["T_DOUBLE_COLON","::",258],["T_STRING","DISPLAY_TYPE_INCLUDING_TAX",258],":",["T_WHITESPACE","\n                ",258],["T_CASE","case",259],["T_WHITESPACE"," ",259],["T_STRING","Mage_Tax_Model_Config",259],["T_DOUBLE_COLON","::",259],["T_STRING","DISPLAY_TYPE_BOTH",259],":",["T_WHITESPACE","\n                    ",259],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_STRING","self",260],["T_DOUBLE_COLON","::",260],["T_STRING","PRICE_CONVERSION_PLUS",260],";",["T_WHITESPACE","\n                ",260],["T_CASE","case",261],["T_WHITESPACE"," ",261],["T_STRING","Mage_Tax_Model_Config",261],["T_DOUBLE_COLON","::",261],["T_STRING","DISPLAY_TYPE_EXCLUDING_TAX",261],":",["T_WHITESPACE","\n                    ",261],["T_VARIABLE","$res",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_STRING","false",262],";",["T_WHITESPACE","\n            ",262],"}",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n\n        ",264],["T_IF","if",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$res",266],["T_WHITESPACE"," ",266],["T_IS_IDENTICAL","===",266],["T_WHITESPACE"," ",266],["T_STRING","false",266],")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_VARIABLE","$res",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","displayTaxColumn",267],"(",["T_VARIABLE","$store",267],")",";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE","\n        ",268],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$res",269],";",["T_WHITESPACE","\n    ",269],"}",["T_WHITESPACE","\n\n    ",270],["T_DOC_COMMENT","\/**\n     * Check if need display full tax summary information in totals block\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",272],["T_WHITESPACE","\n    ",277],["T_PUBLIC","public",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","displayFullSummary",278],"(",["T_VARIABLE","$store",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_STRING","null",278],")",["T_WHITESPACE","\n    ",278],"{",["T_WHITESPACE","\n        ",279],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","_config",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","displayCartFullSummary",280],"(",["T_VARIABLE","$store",280],")",";",["T_WHITESPACE","\n    ",280],"}",["T_WHITESPACE","\n\n    ",281],["T_DOC_COMMENT","\/**\n     * Check if need display zero tax in subtotal\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",283],["T_WHITESPACE","\n    ",288],["T_PUBLIC","public",289],["T_WHITESPACE"," ",289],["T_FUNCTION","function",289],["T_WHITESPACE"," ",289],["T_STRING","displayZeroTax",289],"(",["T_VARIABLE","$store",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_STRING","null",289],")",["T_WHITESPACE","\n    ",289],"{",["T_WHITESPACE","\n        ",290],["T_RETURN","return",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","_config",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","displayCartZeroTax",291],"(",["T_VARIABLE","$store",291],")",";",["T_WHITESPACE","\n    ",291],"}",["T_WHITESPACE","\n\n    ",292],["T_DOC_COMMENT","\/**\n     * Check if need display cart prices included tax\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",294],["T_WHITESPACE","\n    ",299],["T_PUBLIC","public",300],["T_WHITESPACE"," ",300],["T_FUNCTION","function",300],["T_WHITESPACE"," ",300],["T_STRING","displayCartPriceInclTax",300],"(",["T_VARIABLE","$store",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_STRING","null",300],")",["T_WHITESPACE","\n    ",300],"{",["T_WHITESPACE","\n        ",301],["T_RETURN","return",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_config",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","displayCartPricesInclTax",302],"(",["T_VARIABLE","$store",302],")",";",["T_WHITESPACE","\n    ",302],"}",["T_WHITESPACE","\n\n    ",303],["T_DOC_COMMENT","\/**\n     * Check if need display cart prices excluding price\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",305],["T_WHITESPACE","\n    ",310],["T_PUBLIC","public",311],["T_WHITESPACE"," ",311],["T_FUNCTION","function",311],["T_WHITESPACE"," ",311],["T_STRING","displayCartPriceExclTax",311],"(",["T_VARIABLE","$store",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_STRING","null",311],")",["T_WHITESPACE","\n    ",311],"{",["T_WHITESPACE","\n        ",312],["T_RETURN","return",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_config",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","displayCartPricesExclTax",313],"(",["T_VARIABLE","$store",313],")",";",["T_WHITESPACE","\n    ",313],"}",["T_WHITESPACE","\n\n    ",314],["T_DOC_COMMENT","\/**\n     * Check if need display cart prices excluding and including tax\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",316],["T_WHITESPACE","\n    ",321],["T_PUBLIC","public",322],["T_WHITESPACE"," ",322],["T_FUNCTION","function",322],["T_WHITESPACE"," ",322],["T_STRING","displayCartBothPrices",322],"(",["T_VARIABLE","$store",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_STRING","null",322],")",["T_WHITESPACE","\n    ",322],"{",["T_WHITESPACE","\n        ",323],["T_RETURN","return",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_config",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","displayCartPricesBoth",324],"(",["T_VARIABLE","$store",324],")",";",["T_WHITESPACE","\n    ",324],"}",["T_WHITESPACE","\n\n    ",325],["T_DOC_COMMENT","\/**\n     * Check if need display order prices included tax\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",327],["T_WHITESPACE","\n    ",332],["T_PUBLIC","public",333],["T_WHITESPACE"," ",333],["T_FUNCTION","function",333],["T_WHITESPACE"," ",333],["T_STRING","displaySalesPriceInclTax",333],"(",["T_VARIABLE","$store",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_STRING","null",333],")",["T_WHITESPACE","\n    ",333],"{",["T_WHITESPACE","\n        ",334],["T_RETURN","return",335],["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","_config",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","displaySalesPricesInclTax",335],"(",["T_VARIABLE","$store",335],")",";",["T_WHITESPACE","\n    ",335],"}",["T_WHITESPACE","\n\n    ",336],["T_DOC_COMMENT","\/**\n     * Check if need display order prices excluding price\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",338],["T_WHITESPACE","\n    ",343],["T_PUBLIC","public",344],["T_WHITESPACE"," ",344],["T_FUNCTION","function",344],["T_WHITESPACE"," ",344],["T_STRING","displaySalesPriceExclTax",344],"(",["T_VARIABLE","$store",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_STRING","null",344],")",["T_WHITESPACE","\n    ",344],"{",["T_WHITESPACE","\n        ",345],["T_RETURN","return",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_config",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","displaySalesPricesExclTax",346],"(",["T_VARIABLE","$store",346],")",";",["T_WHITESPACE","\n    ",346],"}",["T_WHITESPACE","\n\n    ",347],["T_DOC_COMMENT","\/**\n     * Check if need display order prices excluding and including tax\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",349],["T_WHITESPACE","\n    ",354],["T_PUBLIC","public",355],["T_WHITESPACE"," ",355],["T_FUNCTION","function",355],["T_WHITESPACE"," ",355],["T_STRING","displaySalesBothPrices",355],"(",["T_VARIABLE","$store",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_STRING","null",355],")",["T_WHITESPACE","\n    ",355],"{",["T_WHITESPACE","\n        ",356],["T_RETURN","return",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","_config",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","displaySalesPricesBoth",357],"(",["T_VARIABLE","$store",357],")",";",["T_WHITESPACE","\n    ",357],"}",["T_WHITESPACE","\n\n\n    ",358],["T_DOC_COMMENT","\/**\n     * Check if we need display price include and exclude tax for order\/invoice subtotal\n     *\n     * @param mixed $store\n     * @return bool\n     *\/",361],["T_WHITESPACE","\n    ",366],["T_PUBLIC","public",367],["T_WHITESPACE"," ",367],["T_FUNCTION","function",367],["T_WHITESPACE"," ",367],["T_STRING","displaySalesSubtotalBoth",367],"(",["T_VARIABLE","$store",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_STRING","null",367],")",["T_WHITESPACE","\n    ",367],"{",["T_WHITESPACE","\n        ",368],["T_RETURN","return",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","_config",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","displaySalesSubtotalBoth",369],"(",["T_VARIABLE","$store",369],")",";",["T_WHITESPACE","\n    ",369],"}",["T_WHITESPACE","\n\n    ",370],["T_DOC_COMMENT","\/**\n     * Check if we need display price include tax for order\/invoice subtotal\n     *\n     * @param mixed $store\n     * @return bool\n     *\/",372],["T_WHITESPACE","\n    ",377],["T_PUBLIC","public",378],["T_WHITESPACE"," ",378],["T_FUNCTION","function",378],["T_WHITESPACE"," ",378],["T_STRING","displaySalesSubtotalInclTax",378],"(",["T_VARIABLE","$store",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_STRING","null",378],")",["T_WHITESPACE","\n    ",378],"{",["T_WHITESPACE","\n        ",379],["T_RETURN","return",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","_config",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","displaySalesSubtotalInclTax",380],"(",["T_VARIABLE","$store",380],")",";",["T_WHITESPACE","\n    ",380],"}",["T_WHITESPACE","\n\n    ",381],["T_DOC_COMMENT","\/**\n     * Check if we need display price exclude tax for order\/invoice subtotal\n     *\n     * @param mixed $store\n     * @return bool\n     *\/",383],["T_WHITESPACE","\n    ",388],["T_PUBLIC","public",389],["T_WHITESPACE"," ",389],["T_FUNCTION","function",389],["T_WHITESPACE"," ",389],["T_STRING","displaySalesSubtotalExclTax",389],"(",["T_VARIABLE","$store",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_STRING","null",389],")",["T_WHITESPACE","\n    ",389],"{",["T_WHITESPACE","\n        ",390],["T_RETURN","return",391],["T_WHITESPACE"," ",391],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","_config",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","displaySalesSubtotalExclTax",391],"(",["T_VARIABLE","$store",391],")",";",["T_WHITESPACE","\n    ",391],"}",["T_WHITESPACE","\n\n    ",392],["T_DOC_COMMENT","\/**\n     * Check if need display tax column in for shopping cart\/order items\n     *\n     * @param   mixed $store\n     * @return  bool\n     *\/",394],["T_WHITESPACE","\n    ",399],["T_PUBLIC","public",400],["T_WHITESPACE"," ",400],["T_FUNCTION","function",400],["T_WHITESPACE"," ",400],["T_STRING","displayTaxColumn",400],"(",["T_VARIABLE","$store",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_STRING","null",400],")",["T_WHITESPACE","\n    ",400],"{",["T_WHITESPACE","\n        ",401],["T_RETURN","return",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$this",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","_config",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","displayCartPricesBoth",402],"(",")",";",["T_WHITESPACE","\n    ",402],"}",["T_WHITESPACE","\n\n    ",403],["T_DOC_COMMENT","\/**\n     * Get prices javascript format json\n     *\n     * @param   mixed $store\n     * @return  string\n     *\/",405],["T_WHITESPACE","\n    ",410],["T_PUBLIC","public",411],["T_WHITESPACE"," ",411],["T_FUNCTION","function",411],["T_WHITESPACE"," ",411],["T_STRING","getPriceFormat",411],"(",["T_VARIABLE","$store",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_STRING","null",411],")",["T_WHITESPACE","\n    ",411],"{",["T_WHITESPACE","\n        ",412],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_app",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getLocale",413],"(",")",["T_OBJECT_OPERATOR","->",413],["T_STRING","emulate",413],"(",["T_VARIABLE","$store",413],")",";",["T_WHITESPACE","\n        ",413],["T_VARIABLE","$priceFormat",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","_app",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getLocale",414],"(",")",["T_OBJECT_OPERATOR","->",414],["T_STRING","getJsPriceFormat",414],"(",")",";",["T_WHITESPACE","\n        ",414],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_app",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getLocale",415],"(",")",["T_OBJECT_OPERATOR","->",415],["T_STRING","revert",415],"(",")",";",["T_WHITESPACE","\n        ",415],["T_IF","if",416],["T_WHITESPACE"," ",416],"(",["T_VARIABLE","$store",416],")",["T_WHITESPACE"," ",416],"{",["T_WHITESPACE","\n            ",416],["T_VARIABLE","$priceFormat",417],"[",["T_CONSTANT_ENCAPSED_STRING","'pattern'",417],"]",["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","_app",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getStore",417],"(",["T_VARIABLE","$store",417],")",["T_OBJECT_OPERATOR","->",417],["T_STRING","getCurrentCurrency",417],"(",")",["T_OBJECT_OPERATOR","->",417],["T_STRING","getOutputFormat",417],"(",")",";",["T_WHITESPACE","\n        ",417],"}",["T_WHITESPACE","\n        ",418],["T_RETURN","return",419],["T_WHITESPACE"," ",419],["T_STRING","Mage",419],["T_DOUBLE_COLON","::",419],["T_STRING","helper",419],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",419],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","jsonEncode",419],"(",["T_VARIABLE","$priceFormat",419],")",";",["T_WHITESPACE","\n    ",419],"}",["T_WHITESPACE","\n\n    ",420],["T_DOC_COMMENT","\/**\n     * Get all tax rates JSON for all product tax classes\n     *\n     * array(\n     *      value_{$productTaxVlassId} => $rate\n     * )\n     * @deprecated after 1.4 - please use getAllRatesByProductClass\n     * @return string\n     *\/",422],["T_WHITESPACE","\n    ",430],["T_PUBLIC","public",431],["T_WHITESPACE"," ",431],["T_FUNCTION","function",431],["T_WHITESPACE"," ",431],["T_STRING","getTaxRatesByProductClass",431],"(",")",["T_WHITESPACE","\n    ",431],"{",["T_WHITESPACE","\n        ",432],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","_getAllRatesByProductClass",433],"(",")",";",["T_WHITESPACE","\n    ",433],"}",["T_WHITESPACE","\n\n    ",434],["T_DOC_COMMENT","\/**\n     * Get all tax rates JSON for all product tax classes of specific store\n     *\n     * array(\n     *      value_{$productTaxVlassId} => $rate\n     * )\n     *\n     * @param mixed $store\n     * @return string\n     *\/",436],["T_WHITESPACE","\n    ",445],["T_PUBLIC","public",446],["T_WHITESPACE"," ",446],["T_FUNCTION","function",446],["T_WHITESPACE"," ",446],["T_STRING","getAllRatesByProductClass",446],"(",["T_VARIABLE","$store",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_STRING","null",446],")",["T_WHITESPACE","\n    ",446],"{",["T_WHITESPACE","\n        ",447],["T_RETURN","return",448],["T_WHITESPACE"," ",448],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","_getAllRatesByProductClass",448],"(",["T_VARIABLE","$store",448],")",";",["T_WHITESPACE","\n    ",448],"}",["T_WHITESPACE","\n\n\n    ",449],["T_DOC_COMMENT","\/**\n     * Get all tax rates JSON for all product tax classes of specific store\n     *\n     * array(\n     *      value_{$productTaxVlassId} => $rate\n     * )\n     *\n     * @param mixed $store\n     * @return string\n     *\/",452],["T_WHITESPACE","\n    ",461],["T_PROTECTED","protected",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","_getAllRatesByProductClass",462],"(",["T_VARIABLE","$store",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_STRING","null",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$result",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_ARRAY","array",464],"(",")",";",["T_WHITESPACE","\n        ",464],["T_VARIABLE","$calc",465],["T_WHITESPACE"," ",465],"=",["T_WHITESPACE"," ",465],["T_STRING","Mage",465],["T_DOUBLE_COLON","::",465],["T_STRING","getSingleton",465],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",465],")",";",["T_WHITESPACE","\n        ",465],["T_VARIABLE","$rates",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_VARIABLE","$calc",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","getRatesForAllProductTaxClasses",466],"(",["T_VARIABLE","$calc",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","getDefaultRateRequest",466],"(",["T_VARIABLE","$store",466],")",")",";",["T_WHITESPACE","\n\n        ",466],["T_FOREACH","foreach",468],["T_WHITESPACE"," ",468],"(",["T_VARIABLE","$rates",468],["T_WHITESPACE"," ",468],["T_AS","as",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$class",468],["T_WHITESPACE"," ",468],["T_DOUBLE_ARROW","=>",468],["T_WHITESPACE"," ",468],["T_VARIABLE","$rate",468],")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n            ",468],["T_VARIABLE","$result",469],"[","\"",["T_ENCAPSED_AND_WHITESPACE","value_",469],["T_CURLY_OPEN","{",469],["T_VARIABLE","$class",469],"}","\"","]",["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$rate",469],";",["T_WHITESPACE","\n        ",469],"}",["T_WHITESPACE","\n\n        ",470],["T_RETURN","return",472],["T_WHITESPACE"," ",472],["T_STRING","Mage",472],["T_DOUBLE_COLON","::",472],["T_STRING","helper",472],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",472],")",["T_OBJECT_OPERATOR","->",472],["T_STRING","jsonEncode",472],"(",["T_VARIABLE","$result",472],")",";",["T_WHITESPACE","\n    ",472],"}",["T_WHITESPACE","\n\n    ",473],["T_DOC_COMMENT","\/**\n     * Get product price with all tax settings processing\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @param   float $price inputed product price\n     * @param   bool $includingTax return price include tax flag\n     * @param   null|Mage_Customer_Model_Address $shippingAddress\n     * @param   null|Mage_Customer_Model_Address $billingAddress\n     * @param   null|int $ctc customer tax class\n     * @param   null|Mage_Core_Model_Store $store\n     * @param   bool $priceIncludesTax flag what price parameter contain tax\n     * @return  float\n     *\/",475],["T_WHITESPACE","\n    ",487],["T_PUBLIC","public",488],["T_WHITESPACE"," ",488],["T_FUNCTION","function",488],["T_WHITESPACE"," ",488],["T_STRING","getPrice",488],"(",["T_VARIABLE","$product",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$price",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$includingTax",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_STRING","null",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$shippingAddress",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_STRING","null",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$billingAddress",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_STRING","null",488],",",["T_WHITESPACE","\n                             ",488],["T_VARIABLE","$ctc",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_STRING","null",489],",",["T_WHITESPACE"," ",489],["T_VARIABLE","$store",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_STRING","null",489],",",["T_WHITESPACE"," ",489],["T_VARIABLE","$priceIncludesTax",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_STRING","null",489],",",["T_WHITESPACE"," ",489],["T_VARIABLE","$roundPrice",489],["T_WHITESPACE"," ",489],"=",["T_WHITESPACE"," ",489],["T_STRING","true",489],")",["T_WHITESPACE","\n    ",489],"{",["T_WHITESPACE","\n        ",490],["T_IF","if",491],["T_WHITESPACE"," ",491],"(","!",["T_VARIABLE","$price",491],")",["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n            ",491],["T_RETURN","return",492],["T_WHITESPACE"," ",492],["T_VARIABLE","$price",492],";",["T_WHITESPACE","\n        ",492],"}",["T_WHITESPACE","\n        ",493],["T_VARIABLE","$store",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","_app",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getStore",494],"(",["T_VARIABLE","$store",494],")",";",["T_WHITESPACE","\n        ",494],["T_IF","if",495],["T_WHITESPACE"," ",495],"(","!",["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","needPriceConversion",495],"(",["T_VARIABLE","$store",495],")",")",["T_WHITESPACE"," ",495],"{",["T_WHITESPACE","\n            ",495],["T_RETURN","return",496],["T_WHITESPACE"," ",496],["T_VARIABLE","$store",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","roundPrice",496],"(",["T_VARIABLE","$price",496],")",";",["T_WHITESPACE","\n        ",496],"}",["T_WHITESPACE","\n        ",497],["T_IF","if",498],["T_WHITESPACE"," ",498],"(",["T_STRING","is_null",498],"(",["T_VARIABLE","$priceIncludesTax",498],")",")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n            ",498],["T_VARIABLE","$priceIncludesTax",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","priceIncludesTax",499],"(",["T_VARIABLE","$store",499],")",";",["T_WHITESPACE","\n        ",499],"}",["T_WHITESPACE","\n\n        ",500],["T_VARIABLE","$percent",502],["T_WHITESPACE"," ",502],"=",["T_WHITESPACE"," ",502],["T_VARIABLE","$product",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getTaxPercent",502],"(",")",";",["T_WHITESPACE","\n        ",502],["T_VARIABLE","$includingPercent",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_STRING","null",503],";",["T_WHITESPACE","\n\n        ",503],["T_VARIABLE","$taxClassId",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_VARIABLE","$product",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getTaxClassId",505],"(",")",";",["T_WHITESPACE","\n        ",505],["T_IF","if",506],["T_WHITESPACE"," ",506],"(",["T_STRING","is_null",506],"(",["T_VARIABLE","$percent",506],")",")",["T_WHITESPACE"," ",506],"{",["T_WHITESPACE","\n            ",506],["T_IF","if",507],["T_WHITESPACE"," ",507],"(",["T_VARIABLE","$taxClassId",507],")",["T_WHITESPACE"," ",507],"{",["T_WHITESPACE","\n                ",507],["T_VARIABLE","$request",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_STRING","Mage",508],["T_DOUBLE_COLON","::",508],["T_STRING","getSingleton",508],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",508],")",["T_WHITESPACE","\n                    ",508],["T_OBJECT_OPERATOR","->",509],["T_STRING","getRateRequest",509],"(",["T_VARIABLE","$shippingAddress",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$billingAddress",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$ctc",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$store",509],")",";",["T_WHITESPACE","\n                ",509],["T_VARIABLE","$percent",510],["T_WHITESPACE"," ",510],"=",["T_WHITESPACE"," ",510],["T_STRING","Mage",510],["T_DOUBLE_COLON","::",510],["T_STRING","getSingleton",510],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",510],")",["T_WHITESPACE","\n                    ",510],["T_OBJECT_OPERATOR","->",511],["T_STRING","getRate",511],"(",["T_VARIABLE","$request",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","setProductClassId",511],"(",["T_VARIABLE","$taxClassId",511],")",")",";",["T_WHITESPACE","\n            ",511],"}",["T_WHITESPACE","\n        ",512],"}",["T_WHITESPACE","\n        ",513],["T_IF","if",514],["T_WHITESPACE"," ",514],"(",["T_VARIABLE","$taxClassId",514],["T_WHITESPACE"," ",514],["T_BOOLEAN_AND","&&",514],["T_WHITESPACE"," ",514],["T_VARIABLE","$priceIncludesTax",514],")",["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n            ",514],["T_IF","if",515],["T_WHITESPACE"," ",515],"(",["T_VARIABLE","$this",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","isCrossBorderTradeEnabled",515],"(",["T_VARIABLE","$store",515],")",")",["T_WHITESPACE"," ",515],"{",["T_WHITESPACE","\n                ",515],["T_VARIABLE","$includingPercent",516],["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_VARIABLE","$percent",516],";",["T_WHITESPACE","\n            ",516],"}",["T_WHITESPACE"," ",517],["T_ELSE","else",517],["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n                ",517],["T_VARIABLE","$request",518],["T_WHITESPACE"," ",518],"=",["T_WHITESPACE"," ",518],["T_STRING","Mage",518],["T_DOUBLE_COLON","::",518],["T_STRING","getSingleton",518],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",518],")",["T_OBJECT_OPERATOR","->",518],["T_STRING","getRateOriginRequest",518],"(",["T_VARIABLE","$store",518],")",";",["T_WHITESPACE","\n                ",518],["T_VARIABLE","$includingPercent",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_STRING","Mage",519],["T_DOUBLE_COLON","::",519],["T_STRING","getSingleton",519],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",519],")",["T_WHITESPACE","\n                    ",519],["T_OBJECT_OPERATOR","->",520],["T_STRING","getRate",520],"(",["T_VARIABLE","$request",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","setProductClassId",520],"(",["T_VARIABLE","$taxClassId",520],")",")",";",["T_WHITESPACE","\n            ",520],"}",["T_WHITESPACE","\n        ",521],"}",["T_WHITESPACE","\n\n        ",522],["T_IF","if",524],["T_WHITESPACE"," ",524],"(",["T_VARIABLE","$percent",524],["T_WHITESPACE"," ",524],["T_IS_IDENTICAL","===",524],["T_WHITESPACE"," ",524],["T_STRING","false",524],["T_WHITESPACE"," ",524],["T_BOOLEAN_OR","||",524],["T_WHITESPACE"," ",524],["T_STRING","is_null",524],"(",["T_VARIABLE","$percent",524],")",")",["T_WHITESPACE"," ",524],"{",["T_WHITESPACE","\n            ",524],["T_IF","if",525],["T_WHITESPACE"," ",525],"(",["T_VARIABLE","$priceIncludesTax",525],["T_WHITESPACE"," ",525],["T_BOOLEAN_AND","&&",525],["T_WHITESPACE"," ",525],"!",["T_VARIABLE","$includingPercent",525],")",["T_WHITESPACE"," ",525],"{",["T_WHITESPACE","\n                ",525],["T_RETURN","return",526],["T_WHITESPACE"," ",526],["T_VARIABLE","$price",526],";",["T_WHITESPACE","\n            ",526],"}",["T_WHITESPACE","\n        ",527],"}",["T_WHITESPACE","\n\n        ",528],["T_VARIABLE","$product",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","setTaxPercent",530],"(",["T_VARIABLE","$percent",530],")",";",["T_WHITESPACE","\n        ",530],["T_IF","if",531],["T_WHITESPACE"," ",531],"(",["T_VARIABLE","$product",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","getAppliedRates",531],"(",")",["T_WHITESPACE"," ",531],["T_IS_EQUAL","==",531],["T_WHITESPACE"," ",531],["T_STRING","null",531],")",["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n            ",531],["T_VARIABLE","$request",532],["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],["T_STRING","Mage",532],["T_DOUBLE_COLON","::",532],["T_STRING","getSingleton",532],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",532],")",["T_WHITESPACE","\n                    ",532],["T_OBJECT_OPERATOR","->",533],["T_STRING","getRateRequest",533],"(",["T_VARIABLE","$shippingAddress",533],",",["T_WHITESPACE"," ",533],["T_VARIABLE","$billingAddress",533],",",["T_WHITESPACE"," ",533],["T_VARIABLE","$ctc",533],",",["T_WHITESPACE"," ",533],["T_VARIABLE","$store",533],")",";",["T_WHITESPACE","\n            ",533],["T_VARIABLE","$request",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","setProductClassId",534],"(",["T_VARIABLE","$taxClassId",534],")",";",["T_WHITESPACE","\n            ",534],["T_VARIABLE","$appliedRates",535],["T_WHITESPACE"," ",535],"=",["T_WHITESPACE","  ",535],["T_STRING","Mage",535],["T_DOUBLE_COLON","::",535],["T_STRING","getSingleton",535],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",535],")",["T_OBJECT_OPERATOR","->",535],["T_STRING","getAppliedRates",535],"(",["T_VARIABLE","$request",535],")",";",["T_WHITESPACE","\n            ",535],["T_VARIABLE","$product",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","setAppliedRates",536],"(",["T_VARIABLE","$appliedRates",536],")",";",["T_WHITESPACE","\n        ",536],"}",["T_WHITESPACE","\n\n        ",537],["T_IF","if",539],["T_WHITESPACE"," ",539],"(","!",["T_STRING","is_null",539],"(",["T_VARIABLE","$includingTax",539],")",")",["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n            ",539],["T_IF","if",540],["T_WHITESPACE"," ",540],"(",["T_VARIABLE","$priceIncludesTax",540],")",["T_WHITESPACE"," ",540],"{",["T_WHITESPACE","\n                ",540],["T_IF","if",541],["T_WHITESPACE"," ",541],"(",["T_VARIABLE","$includingTax",541],")",["T_WHITESPACE"," ",541],"{",["T_WHITESPACE","\n                    ",541],["T_DOC_COMMENT","\/**\n                     * Recalculate price include tax in case of different rates.  Otherwise price remains the same.\n                     *\/",542],["T_WHITESPACE","\n                    ",544],["T_IF","if",545],["T_WHITESPACE"," ",545],"(",["T_VARIABLE","$includingPercent",545],["T_WHITESPACE"," ",545],["T_IS_NOT_EQUAL","!=",545],["T_WHITESPACE"," ",545],["T_VARIABLE","$percent",545],")",["T_WHITESPACE"," ",545],"{",["T_WHITESPACE","\n                        ",545],["T_COMMENT","\/\/ determine the customer's price that includes tax\n",546],["T_WHITESPACE","                        ",547],["T_VARIABLE","$price",547],["T_WHITESPACE"," ",547],"=",["T_WHITESPACE"," ",547],["T_VARIABLE","$this",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","_calculatePriceInclTax",547],"(",["T_VARIABLE","$price",547],",",["T_WHITESPACE"," ",547],["T_VARIABLE","$includingPercent",547],",",["T_WHITESPACE"," ",547],["T_VARIABLE","$percent",547],",",["T_WHITESPACE"," ",547],["T_VARIABLE","$store",547],")",";",["T_WHITESPACE","\n                    ",547],"}",["T_WHITESPACE","\n                ",548],"}",["T_WHITESPACE"," ",549],["T_ELSE","else",549],["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n                    ",549],["T_VARIABLE","$price",550],["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_calculatePrice",550],"(",["T_VARIABLE","$price",550],",",["T_WHITESPACE"," ",550],["T_VARIABLE","$includingPercent",550],",",["T_WHITESPACE"," ",550],["T_STRING","false",550],")",";",["T_WHITESPACE","\n                ",550],"}",["T_WHITESPACE","\n            ",551],"}",["T_WHITESPACE"," ",552],["T_ELSE","else",552],["T_WHITESPACE"," ",552],"{",["T_WHITESPACE","\n                ",552],["T_IF","if",553],["T_WHITESPACE"," ",553],"(",["T_VARIABLE","$includingTax",553],")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n                    ",553],["T_VARIABLE","$appliedRates",554],["T_WHITESPACE"," ",554],"=",["T_WHITESPACE"," ",554],["T_VARIABLE","$product",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","getAppliedRates",554],"(",")",";",["T_WHITESPACE","\n                    ",554],["T_IF","if",555],["T_WHITESPACE"," ",555],"(",["T_STRING","count",555],"(",["T_VARIABLE","$appliedRates",555],")",["T_WHITESPACE"," ",555],">",["T_WHITESPACE"," ",555],["T_LNUMBER","1",555],")",["T_WHITESPACE"," ",555],"{",["T_WHITESPACE","\n                        ",555],["T_VARIABLE","$price",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","_calculatePriceInclTaxWithMultipleRates",556],"(",["T_VARIABLE","$price",556],",",["T_WHITESPACE"," ",556],["T_VARIABLE","$appliedRates",556],")",";",["T_WHITESPACE","\n                    ",556],"}",["T_WHITESPACE"," ",557],["T_ELSE","else",557],["T_WHITESPACE"," ",557],"{",["T_WHITESPACE","\n                        ",557],["T_VARIABLE","$price",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE"," ",558],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","_calculatePrice",558],"(",["T_VARIABLE","$price",558],",",["T_WHITESPACE"," ",558],["T_VARIABLE","$percent",558],",",["T_WHITESPACE"," ",558],["T_STRING","true",558],")",";",["T_WHITESPACE","\n                    ",558],"}",["T_WHITESPACE","\n                ",559],"}",["T_WHITESPACE","\n            ",560],"}",["T_WHITESPACE","\n        ",561],"}",["T_WHITESPACE"," ",562],["T_ELSE","else",562],["T_WHITESPACE"," ",562],"{",["T_WHITESPACE","\n            ",562],["T_IF","if",563],["T_WHITESPACE"," ",563],"(",["T_VARIABLE","$priceIncludesTax",563],")",["T_WHITESPACE"," ",563],"{",["T_WHITESPACE","\n                ",563],["T_SWITCH","switch",564],["T_WHITESPACE"," ",564],"(",["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","getPriceDisplayType",564],"(",["T_VARIABLE","$store",564],")",")",["T_WHITESPACE"," ",564],"{",["T_WHITESPACE","\n                    ",564],["T_CASE","case",565],["T_WHITESPACE"," ",565],["T_STRING","Mage_Tax_Model_Config",565],["T_DOUBLE_COLON","::",565],["T_STRING","DISPLAY_TYPE_EXCLUDING_TAX",565],":",["T_WHITESPACE","\n                    ",565],["T_CASE","case",566],["T_WHITESPACE"," ",566],["T_STRING","Mage_Tax_Model_Config",566],["T_DOUBLE_COLON","::",566],["T_STRING","DISPLAY_TYPE_BOTH",566],":",["T_WHITESPACE","\n                        ",566],["T_IF","if",567],["T_WHITESPACE"," ",567],"(",["T_VARIABLE","$includingPercent",567],["T_WHITESPACE"," ",567],["T_IS_NOT_EQUAL","!=",567],["T_WHITESPACE"," ",567],["T_VARIABLE","$percent",567],")",["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n                            ",567],["T_COMMENT","\/\/ determine the customer's price that includes tax\n",568],["T_WHITESPACE","                            ",569],["T_VARIABLE","$taxablePrice",569],["T_WHITESPACE"," ",569],"=",["T_WHITESPACE"," ",569],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_calculatePriceInclTax",569],"(",["T_VARIABLE","$price",569],",",["T_WHITESPACE"," ",569],["T_VARIABLE","$includingPercent",569],",",["T_WHITESPACE"," ",569],["T_VARIABLE","$percent",569],",",["T_WHITESPACE"," ",569],["T_VARIABLE","$store",569],")",";",["T_WHITESPACE","\n                            ",569],["T_COMMENT","\/\/ determine the customer's tax amount,\n",570],["T_WHITESPACE","                            ",571],["T_COMMENT","\/\/ round tax unless $roundPrice is set explicitly to false\n",571],["T_WHITESPACE","                            ",572],["T_VARIABLE","$tax",572],["T_WHITESPACE"," ",572],"=",["T_WHITESPACE"," ",572],["T_VARIABLE","$this",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","getCalculator",572],"(",")",["T_OBJECT_OPERATOR","->",572],["T_STRING","calcTaxAmount",572],"(",["T_VARIABLE","$taxablePrice",572],",",["T_WHITESPACE"," ",572],["T_VARIABLE","$percent",572],",",["T_WHITESPACE"," ",572],["T_STRING","true",572],",",["T_WHITESPACE"," ",572],["T_VARIABLE","$roundPrice",572],")",";",["T_WHITESPACE","\n                            ",572],["T_COMMENT","\/\/ determine the customer's price without taxes\n",573],["T_WHITESPACE","                            ",574],["T_VARIABLE","$price",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_VARIABLE","$taxablePrice",574],["T_WHITESPACE"," ",574],"-",["T_WHITESPACE"," ",574],["T_VARIABLE","$tax",574],";",["T_WHITESPACE","\n                        ",574],"}",["T_WHITESPACE"," ",575],["T_ELSE","else",575],["T_WHITESPACE"," ",575],"{",["T_WHITESPACE","\n                            ",575],["T_COMMENT","\/\/round tax first unless $roundPrice is set to false explicitly\n",576],["T_WHITESPACE","                            ",577],["T_VARIABLE","$price",577],["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_VARIABLE","$this",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","_calculatePrice",577],"(",["T_VARIABLE","$price",577],",",["T_WHITESPACE"," ",577],["T_VARIABLE","$includingPercent",577],",",["T_WHITESPACE"," ",577],["T_STRING","false",577],",",["T_WHITESPACE"," ",577],["T_VARIABLE","$roundPrice",577],")",";",["T_WHITESPACE","\n                        ",577],"}",["T_WHITESPACE","\n                        ",578],["T_BREAK","break",579],";",["T_WHITESPACE","\n\n                    ",579],["T_CASE","case",581],["T_WHITESPACE"," ",581],["T_STRING","Mage_Tax_Model_Config",581],["T_DOUBLE_COLON","::",581],["T_STRING","DISPLAY_TYPE_INCLUDING_TAX",581],":",["T_WHITESPACE","\n                        ",581],["T_VARIABLE","$price",582],["T_WHITESPACE"," ",582],"=",["T_WHITESPACE"," ",582],["T_VARIABLE","$this",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","_calculatePrice",582],"(",["T_VARIABLE","$price",582],",",["T_WHITESPACE"," ",582],["T_VARIABLE","$includingPercent",582],",",["T_WHITESPACE"," ",582],["T_STRING","false",582],")",";",["T_WHITESPACE","\n                        ",582],["T_VARIABLE","$price",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","_calculatePrice",583],"(",["T_VARIABLE","$price",583],",",["T_WHITESPACE"," ",583],["T_VARIABLE","$percent",583],",",["T_WHITESPACE"," ",583],["T_STRING","true",583],")",";",["T_WHITESPACE","\n                        ",583],["T_BREAK","break",584],";",["T_WHITESPACE","\n                ",584],"}",["T_WHITESPACE","\n            ",585],"}",["T_WHITESPACE"," ",586],["T_ELSE","else",586],["T_WHITESPACE"," ",586],"{",["T_WHITESPACE","\n                ",586],["T_SWITCH","switch",587],["T_WHITESPACE"," ",587],"(",["T_VARIABLE","$this",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getPriceDisplayType",587],"(",["T_VARIABLE","$store",587],")",")",["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n                    ",587],["T_CASE","case",588],["T_WHITESPACE"," ",588],["T_STRING","Mage_Tax_Model_Config",588],["T_DOUBLE_COLON","::",588],["T_STRING","DISPLAY_TYPE_INCLUDING_TAX",588],":",["T_WHITESPACE","\n                        ",588],["T_VARIABLE","$appliedRates",589],["T_WHITESPACE"," ",589],"=",["T_WHITESPACE"," ",589],["T_VARIABLE","$product",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getAppliedRates",589],"(",")",";",["T_WHITESPACE","\n                        ",589],["T_IF","if",590],["T_WHITESPACE"," ",590],"(",["T_STRING","count",590],"(",["T_VARIABLE","$appliedRates",590],")",["T_WHITESPACE"," ",590],">",["T_WHITESPACE"," ",590],["T_LNUMBER","1",590],")",["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n                            ",590],["T_VARIABLE","$price",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_calculatePriceInclTaxWithMultipleRates",591],"(",["T_VARIABLE","$price",591],",",["T_WHITESPACE"," ",591],["T_VARIABLE","$appliedRates",591],")",";",["T_WHITESPACE","\n                        ",591],"}",["T_WHITESPACE"," ",592],["T_ELSE","else",592],["T_WHITESPACE"," ",592],"{",["T_WHITESPACE","\n                            ",592],["T_VARIABLE","$price",593],["T_WHITESPACE"," ",593],"=",["T_WHITESPACE"," ",593],["T_VARIABLE","$this",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","_calculatePrice",593],"(",["T_VARIABLE","$price",593],",",["T_WHITESPACE"," ",593],["T_VARIABLE","$percent",593],",",["T_WHITESPACE"," ",593],["T_STRING","true",593],")",";",["T_WHITESPACE","\n                        ",593],"}",["T_WHITESPACE","\n                        ",594],["T_BREAK","break",595],";",["T_WHITESPACE","\n\n                    ",595],["T_CASE","case",597],["T_WHITESPACE"," ",597],["T_STRING","Mage_Tax_Model_Config",597],["T_DOUBLE_COLON","::",597],["T_STRING","DISPLAY_TYPE_BOTH",597],":",["T_WHITESPACE","\n                    ",597],["T_CASE","case",598],["T_WHITESPACE"," ",598],["T_STRING","Mage_Tax_Model_Config",598],["T_DOUBLE_COLON","::",598],["T_STRING","DISPLAY_TYPE_EXCLUDING_TAX",598],":",["T_WHITESPACE","\n                        ",598],["T_BREAK","break",599],";",["T_WHITESPACE","\n                ",599],"}",["T_WHITESPACE","\n            ",600],"}",["T_WHITESPACE","\n        ",601],"}",["T_WHITESPACE","\n        ",602],["T_IF","if",603],["T_WHITESPACE"," ",603],"(",["T_VARIABLE","$roundPrice",603],")",["T_WHITESPACE"," ",603],"{",["T_WHITESPACE","\n            ",603],["T_RETURN","return",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$store",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","roundPrice",604],"(",["T_VARIABLE","$price",604],")",";",["T_WHITESPACE","\n        ",604],"}",["T_WHITESPACE"," ",605],["T_ELSE","else",605],["T_WHITESPACE"," ",605],"{",["T_WHITESPACE","\n            ",605],["T_RETURN","return",606],["T_WHITESPACE"," ",606],["T_VARIABLE","$price",606],";",["T_WHITESPACE","\n        ",606],"}",["T_WHITESPACE","\n    ",607],"}",["T_WHITESPACE","\n\n    ",608],["T_DOC_COMMENT","\/**\n     * Given a store price that includes tax at the store rate, this function will back out the store's tax, and add in\n     * the customer's tax.  Returns this new price which is the customer's price including tax.\n     *\n     * @param float $storePriceInclTax\n     * @param float $storePercent\n     * @param float $customerPercent\n     * @param Mage_Core_Model_Store $store\n     * @return float\n     *\/",610],["T_WHITESPACE","\n    ",619],["T_PROTECTED","protected",620],["T_WHITESPACE"," ",620],["T_FUNCTION","function",620],["T_WHITESPACE"," ",620],["T_STRING","_calculatePriceInclTax",620],"(",["T_VARIABLE","$storePriceInclTax",620],",",["T_WHITESPACE"," ",620],["T_VARIABLE","$storePercent",620],",",["T_WHITESPACE"," ",620],["T_VARIABLE","$customerPercent",620],",",["T_WHITESPACE"," ",620],["T_VARIABLE","$store",620],")",["T_WHITESPACE","\n    ",620],"{",["T_WHITESPACE","\n        ",621],["T_VARIABLE","$priceExclTax",622],["T_WHITESPACE","         ",622],"=",["T_WHITESPACE"," ",622],["T_VARIABLE","$this",622],["T_OBJECT_OPERATOR","->",622],["T_STRING","_calculatePrice",622],"(",["T_VARIABLE","$storePriceInclTax",622],",",["T_WHITESPACE"," ",622],["T_VARIABLE","$storePercent",622],",",["T_WHITESPACE"," ",622],["T_STRING","false",622],",",["T_WHITESPACE"," ",622],["T_STRING","false",622],")",";",["T_WHITESPACE","\n        ",622],["T_VARIABLE","$customerTax",623],["T_WHITESPACE","          ",623],"=",["T_WHITESPACE"," ",623],["T_VARIABLE","$this",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","getCalculator",623],"(",")",["T_OBJECT_OPERATOR","->",623],["T_STRING","calcTaxAmount",623],"(",["T_VARIABLE","$priceExclTax",623],",",["T_WHITESPACE"," ",623],["T_VARIABLE","$customerPercent",623],",",["T_WHITESPACE"," ",623],["T_STRING","false",623],",",["T_WHITESPACE"," ",623],["T_STRING","false",623],")",";",["T_WHITESPACE","\n        ",623],["T_VARIABLE","$customerPriceInclTax",624],["T_WHITESPACE"," ",624],"=",["T_WHITESPACE"," ",624],["T_VARIABLE","$store",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","roundPrice",624],"(",["T_VARIABLE","$priceExclTax",624],["T_WHITESPACE"," ",624],"+",["T_WHITESPACE"," ",624],["T_VARIABLE","$customerTax",624],")",";",["T_WHITESPACE","\n        ",624],["T_RETURN","return",625],["T_WHITESPACE"," ",625],["T_VARIABLE","$customerPriceInclTax",625],";",["T_WHITESPACE","\n    ",625],"}",["T_WHITESPACE","\n\n    ",626],["T_DOC_COMMENT","\/**\n     * Check if we have display in catalog prices including tax\n     *\n     * @return bool\n     *\/",628],["T_WHITESPACE","\n    ",632],["T_PUBLIC","public",633],["T_WHITESPACE"," ",633],["T_FUNCTION","function",633],["T_WHITESPACE"," ",633],["T_STRING","displayPriceIncludingTax",633],"(",")",["T_WHITESPACE","\n    ",633],"{",["T_WHITESPACE","\n        ",634],["T_RETURN","return",635],["T_WHITESPACE"," ",635],["T_VARIABLE","$this",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","getPriceDisplayType",635],"(",")",["T_WHITESPACE"," ",635],["T_IS_EQUAL","==",635],["T_WHITESPACE"," ",635],["T_STRING","Mage_Tax_Model_Config",635],["T_DOUBLE_COLON","::",635],["T_STRING","DISPLAY_TYPE_INCLUDING_TAX",635],";",["T_WHITESPACE","\n    ",635],"}",["T_WHITESPACE","\n\n    ",636],["T_DOC_COMMENT","\/**\n     * Check if we have display in catalog prices excluding tax\n     *\n     * @return bool\n     *\/",638],["T_WHITESPACE","\n    ",642],["T_PUBLIC","public",643],["T_WHITESPACE"," ",643],["T_FUNCTION","function",643],["T_WHITESPACE"," ",643],["T_STRING","displayPriceExcludingTax",643],"(",")",["T_WHITESPACE","\n    ",643],"{",["T_WHITESPACE","\n        ",644],["T_RETURN","return",645],["T_WHITESPACE"," ",645],["T_VARIABLE","$this",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","getPriceDisplayType",645],"(",")",["T_WHITESPACE"," ",645],["T_IS_EQUAL","==",645],["T_WHITESPACE"," ",645],["T_STRING","Mage_Tax_Model_Config",645],["T_DOUBLE_COLON","::",645],["T_STRING","DISPLAY_TYPE_EXCLUDING_TAX",645],";",["T_WHITESPACE","\n    ",645],"}",["T_WHITESPACE","\n\n    ",646],["T_DOC_COMMENT","\/**\n     * Check if we have display in catalog prices including and excluding tax\n     *\n     * @param int $store\n     * @return bool\n     *\/",648],["T_WHITESPACE","\n    ",653],["T_PUBLIC","public",654],["T_WHITESPACE"," ",654],["T_FUNCTION","function",654],["T_WHITESPACE"," ",654],["T_STRING","displayBothPrices",654],"(",["T_VARIABLE","$store",654],["T_WHITESPACE"," ",654],"=",["T_WHITESPACE"," ",654],["T_STRING","null",654],")",["T_WHITESPACE","\n    ",654],"{",["T_WHITESPACE","\n        ",655],["T_RETURN","return",656],["T_WHITESPACE"," ",656],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","getPriceDisplayType",656],"(",["T_VARIABLE","$store",656],")",["T_WHITESPACE"," ",656],["T_IS_EQUAL","==",656],["T_WHITESPACE"," ",656],["T_STRING","Mage_Tax_Model_Config",656],["T_DOUBLE_COLON","::",656],["T_STRING","DISPLAY_TYPE_BOTH",656],";",["T_WHITESPACE","\n    ",656],"}",["T_WHITESPACE","\n\n    ",657],["T_DOC_COMMENT","\/**\n     * Calculate price imcluding\/excluding tax base on tax rate percent\n     *\n     * @param   float $price\n     * @param   float $percent\n     * @param   bool $type true - to calculate the price including tax and false if calculating price to exclude tax\n     * @param   bool $roundTaxFirst\n     * @return  float\n     *\/",659],["T_WHITESPACE","\n    ",667],["T_PROTECTED","protected",668],["T_WHITESPACE"," ",668],["T_FUNCTION","function",668],["T_WHITESPACE"," ",668],["T_STRING","_calculatePrice",668],"(",["T_VARIABLE","$price",668],",",["T_WHITESPACE"," ",668],["T_VARIABLE","$percent",668],",",["T_WHITESPACE"," ",668],["T_VARIABLE","$type",668],",",["T_WHITESPACE"," ",668],["T_VARIABLE","$roundTaxFirst",668],["T_WHITESPACE"," ",668],"=",["T_WHITESPACE"," ",668],["T_STRING","false",668],")",["T_WHITESPACE","\n    ",668],"{",["T_WHITESPACE","\n        ",669],["T_VARIABLE","$calculator",670],["T_WHITESPACE"," ",670],"=",["T_WHITESPACE"," ",670],["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getCalculator",670],"(",")",";",["T_WHITESPACE","\n        ",670],["T_IF","if",671],["T_WHITESPACE"," ",671],"(",["T_VARIABLE","$type",671],")",["T_WHITESPACE"," ",671],"{",["T_WHITESPACE","\n            ",671],["T_VARIABLE","$taxAmount",672],["T_WHITESPACE"," ",672],"=",["T_WHITESPACE"," ",672],["T_VARIABLE","$calculator",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","calcTaxAmount",672],"(",["T_VARIABLE","$price",672],",",["T_WHITESPACE"," ",672],["T_VARIABLE","$percent",672],",",["T_WHITESPACE"," ",672],["T_STRING","false",672],",",["T_WHITESPACE"," ",672],["T_VARIABLE","$roundTaxFirst",672],")",";",["T_WHITESPACE","\n            ",672],["T_RETURN","return",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$price",673],["T_WHITESPACE"," ",673],"+",["T_WHITESPACE"," ",673],["T_VARIABLE","$taxAmount",673],";",["T_WHITESPACE","\n        ",673],"}",["T_WHITESPACE"," ",674],["T_ELSE","else",674],["T_WHITESPACE"," ",674],"{",["T_WHITESPACE","\n            ",674],["T_VARIABLE","$taxAmount",675],["T_WHITESPACE"," ",675],"=",["T_WHITESPACE"," ",675],["T_VARIABLE","$calculator",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","calcTaxAmount",675],"(",["T_VARIABLE","$price",675],",",["T_WHITESPACE"," ",675],["T_VARIABLE","$percent",675],",",["T_WHITESPACE"," ",675],["T_STRING","true",675],",",["T_WHITESPACE"," ",675],["T_VARIABLE","$roundTaxFirst",675],")",";",["T_WHITESPACE","\n            ",675],["T_RETURN","return",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$price",676],["T_WHITESPACE"," ",676],"-",["T_WHITESPACE"," ",676],["T_VARIABLE","$taxAmount",676],";",["T_WHITESPACE","\n        ",676],"}",["T_WHITESPACE","\n    ",677],"}",["T_WHITESPACE","\n\n    ",678],["T_DOC_COMMENT","\/**\n     * Calculate price including tax when multiple taxes is applied and rounded\n     * independently.\n     *\n     * @param foat $price\n     * @param array $appliedRates\n     * @return float\n     *\/",680],["T_WHITESPACE","\n    ",687],["T_PROTECTED","protected",688],["T_WHITESPACE"," ",688],["T_FUNCTION","function",688],["T_WHITESPACE"," ",688],["T_STRING","_calculatePriceInclTaxWithMultipleRates",688],"(",["T_VARIABLE","$price",688],",",["T_WHITESPACE"," ",688],["T_VARIABLE","$appliedRates",688],")",["T_WHITESPACE","\n    ",688],"{",["T_WHITESPACE","\n        ",689],["T_VARIABLE","$calculator",690],["T_WHITESPACE"," ",690],"=",["T_WHITESPACE"," ",690],["T_VARIABLE","$this",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","getCalculator",690],"(",")",";",["T_WHITESPACE","\n        ",690],["T_VARIABLE","$tax",691],["T_WHITESPACE"," ",691],"=",["T_WHITESPACE"," ",691],["T_LNUMBER","0",691],";",["T_WHITESPACE","\n        ",691],["T_FOREACH","foreach",692],["T_WHITESPACE"," ",692],"(",["T_VARIABLE","$appliedRates",692],["T_WHITESPACE"," ",692],["T_AS","as",692],["T_WHITESPACE"," ",692],["T_VARIABLE","$appliedRate",692],")",["T_WHITESPACE"," ",692],"{",["T_WHITESPACE","\n            ",692],["T_VARIABLE","$taxRate",693],["T_WHITESPACE"," ",693],"=",["T_WHITESPACE"," ",693],["T_VARIABLE","$appliedRate",693],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",693],"]",";",["T_WHITESPACE","\n            ",693],["T_VARIABLE","$tax",694],["T_WHITESPACE"," ",694],["T_PLUS_EQUAL","+=",694],["T_WHITESPACE"," ",694],["T_VARIABLE","$calculator",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","round",694],"(",["T_VARIABLE","$price",694],["T_WHITESPACE"," ",694],"*",["T_WHITESPACE"," ",694],["T_VARIABLE","$taxRate",694],["T_WHITESPACE"," ",694],"\/",["T_WHITESPACE"," ",694],["T_LNUMBER","100",694],")",";",["T_WHITESPACE","\n        ",694],"}",["T_WHITESPACE","\n        ",695],["T_RETURN","return",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$tax",696],["T_WHITESPACE"," ",696],"+",["T_WHITESPACE"," ",696],["T_VARIABLE","$price",696],";",["T_WHITESPACE","\n    ",696],"}",["T_WHITESPACE","\n\n    ",697],["T_DOC_COMMENT","\/**\n     * Returns the include \/ exclude tax label\n     *\n     * @param bool $flag\n     * @return string\n     *\/",699],["T_WHITESPACE","\n    ",704],["T_PUBLIC","public",705],["T_WHITESPACE"," ",705],["T_FUNCTION","function",705],["T_WHITESPACE"," ",705],["T_STRING","getIncExcTaxLabel",705],"(",["T_VARIABLE","$flag",705],")",["T_WHITESPACE","\n    ",705],"{",["T_WHITESPACE","\n        ",706],["T_VARIABLE","$text",707],["T_WHITESPACE"," ",707],"=",["T_WHITESPACE"," ",707],["T_VARIABLE","$this",707],["T_OBJECT_OPERATOR","->",707],["T_STRING","getIncExcText",707],"(",["T_VARIABLE","$flag",707],")",";",["T_WHITESPACE","\n        ",707],["T_RETURN","return",708],["T_WHITESPACE"," ",708],["T_VARIABLE","$text",708],["T_WHITESPACE"," ",708],"?",["T_WHITESPACE"," ",708],["T_CONSTANT_ENCAPSED_STRING","' <span class=\"tax-flag\">('",708],["T_WHITESPACE"," ",708],".",["T_WHITESPACE"," ",708],["T_VARIABLE","$text",708],["T_WHITESPACE"," ",708],".",["T_WHITESPACE"," ",708],["T_CONSTANT_ENCAPSED_STRING","')<\/span>'",708],["T_WHITESPACE"," ",708],":",["T_WHITESPACE"," ",708],["T_CONSTANT_ENCAPSED_STRING","''",708],";",["T_WHITESPACE","\n    ",708],"}",["T_WHITESPACE","\n\n    ",709],["T_DOC_COMMENT","\/**\n     * Check if shipping prices include tax\n     *\n     * @param mixed $store\n     * @return bool\n     *\/",711],["T_WHITESPACE","\n    ",716],["T_PUBLIC","public",717],["T_WHITESPACE"," ",717],["T_FUNCTION","function",717],["T_WHITESPACE"," ",717],["T_STRING","shippingPriceIncludesTax",717],"(",["T_VARIABLE","$store",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_STRING","null",717],")",["T_WHITESPACE","\n    ",717],"{",["T_WHITESPACE","\n        ",718],["T_RETURN","return",719],["T_WHITESPACE"," ",719],["T_VARIABLE","$this",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","_config",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","shippingPriceIncludesTax",719],"(",["T_VARIABLE","$store",719],")",";",["T_WHITESPACE","\n    ",719],"}",["T_WHITESPACE","\n\n    ",720],["T_DOC_COMMENT","\/**\n     * Get shipping methods prices display type\n     *\n     * @param mixed $store\n     * @return int\n     *\/",722],["T_WHITESPACE","\n    ",727],["T_PUBLIC","public",728],["T_WHITESPACE"," ",728],["T_FUNCTION","function",728],["T_WHITESPACE"," ",728],["T_STRING","getShippingPriceDisplayType",728],"(",["T_VARIABLE","$store",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_STRING","null",728],")",["T_WHITESPACE","\n    ",728],"{",["T_WHITESPACE","\n        ",729],["T_RETURN","return",730],["T_WHITESPACE"," ",730],["T_VARIABLE","$this",730],["T_OBJECT_OPERATOR","->",730],["T_STRING","_config",730],["T_OBJECT_OPERATOR","->",730],["T_STRING","getShippingPriceDisplayType",730],"(",["T_VARIABLE","$store",730],")",";",["T_WHITESPACE","\n    ",730],"}",["T_WHITESPACE","\n\n    ",731],["T_DOC_COMMENT","\/**\n     * Returns whether the shipping price should display with taxes included\n     *\n     * @return bool\n     *\/",733],["T_WHITESPACE","\n    ",737],["T_PUBLIC","public",738],["T_WHITESPACE"," ",738],["T_FUNCTION","function",738],["T_WHITESPACE"," ",738],["T_STRING","displayShippingPriceIncludingTax",738],"(",")",["T_WHITESPACE","\n    ",738],"{",["T_WHITESPACE","\n        ",739],["T_RETURN","return",740],["T_WHITESPACE"," ",740],["T_VARIABLE","$this",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","getShippingPriceDisplayType",740],"(",")",["T_WHITESPACE"," ",740],["T_IS_EQUAL","==",740],["T_WHITESPACE"," ",740],["T_STRING","Mage_Tax_Model_Config",740],["T_DOUBLE_COLON","::",740],["T_STRING","DISPLAY_TYPE_INCLUDING_TAX",740],";",["T_WHITESPACE","\n    ",740],"}",["T_WHITESPACE","\n\n    ",741],["T_DOC_COMMENT","\/**\n     * Returns whether the shipping price should display without taxes\n     *\n     * @return bool\n     *\/",743],["T_WHITESPACE","\n    ",747],["T_PUBLIC","public",748],["T_WHITESPACE"," ",748],["T_FUNCTION","function",748],["T_WHITESPACE"," ",748],["T_STRING","displayShippingPriceExcludingTax",748],"(",")",["T_WHITESPACE","\n    ",748],"{",["T_WHITESPACE","\n        ",749],["T_RETURN","return",750],["T_WHITESPACE"," ",750],["T_VARIABLE","$this",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","getShippingPriceDisplayType",750],"(",")",["T_WHITESPACE"," ",750],["T_IS_EQUAL","==",750],["T_WHITESPACE"," ",750],["T_STRING","Mage_Tax_Model_Config",750],["T_DOUBLE_COLON","::",750],["T_STRING","DISPLAY_TYPE_EXCLUDING_TAX",750],";",["T_WHITESPACE","\n    ",750],"}",["T_WHITESPACE","\n\n    ",751],["T_DOC_COMMENT","\/**\n     * Returns whether the shipping price should display both with and without taxes\n     *\n     * @return bool\n     *\/",753],["T_WHITESPACE","\n    ",757],["T_PUBLIC","public",758],["T_WHITESPACE"," ",758],["T_FUNCTION","function",758],["T_WHITESPACE"," ",758],["T_STRING","displayShippingBothPrices",758],"(",")",["T_WHITESPACE","\n    ",758],"{",["T_WHITESPACE","\n        ",759],["T_RETURN","return",760],["T_WHITESPACE"," ",760],["T_VARIABLE","$this",760],["T_OBJECT_OPERATOR","->",760],["T_STRING","getShippingPriceDisplayType",760],"(",")",["T_WHITESPACE"," ",760],["T_IS_EQUAL","==",760],["T_WHITESPACE"," ",760],["T_STRING","Mage_Tax_Model_Config",760],["T_DOUBLE_COLON","::",760],["T_STRING","DISPLAY_TYPE_BOTH",760],";",["T_WHITESPACE","\n    ",760],"}",["T_WHITESPACE","\n\n    ",761],["T_DOC_COMMENT","\/**\n     * Get tax class id specified for shipping tax estimation\n     *\n     * @param mixed $store\n     * @return int\n     *\/",763],["T_WHITESPACE","\n    ",768],["T_PUBLIC","public",769],["T_WHITESPACE"," ",769],["T_FUNCTION","function",769],["T_WHITESPACE"," ",769],["T_STRING","getShippingTaxClass",769],"(",["T_VARIABLE","$store",769],")",["T_WHITESPACE","\n    ",769],"{",["T_WHITESPACE","\n        ",770],["T_RETURN","return",771],["T_WHITESPACE"," ",771],["T_VARIABLE","$this",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","_config",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getShippingTaxClass",771],"(",["T_VARIABLE","$store",771],")",";",["T_WHITESPACE","\n    ",771],"}",["T_WHITESPACE","\n\n    ",772],["T_DOC_COMMENT","\/**\n     * Get Shipping Price\n     *\n     * @param float $price\n     * @param null|bool $includingTax\n     * @param mixed $shippingAddress\n     * @param mixed $ctc\n     * @param mixed $store\n     * @return float\n     *\/",774],["T_WHITESPACE","\n    ",783],["T_PUBLIC","public",784],["T_WHITESPACE"," ",784],["T_FUNCTION","function",784],["T_WHITESPACE"," ",784],["T_STRING","getShippingPrice",784],"(",["T_VARIABLE","$price",784],",",["T_WHITESPACE"," ",784],["T_VARIABLE","$includingTax",784],["T_WHITESPACE"," ",784],"=",["T_WHITESPACE"," ",784],["T_STRING","null",784],",",["T_WHITESPACE"," ",784],["T_VARIABLE","$shippingAddress",784],["T_WHITESPACE"," ",784],"=",["T_WHITESPACE"," ",784],["T_STRING","null",784],",",["T_WHITESPACE"," ",784],["T_VARIABLE","$ctc",784],["T_WHITESPACE"," ",784],"=",["T_WHITESPACE"," ",784],["T_STRING","null",784],",",["T_WHITESPACE"," ",784],["T_VARIABLE","$store",784],["T_WHITESPACE"," ",784],"=",["T_WHITESPACE"," ",784],["T_STRING","null",784],")",["T_WHITESPACE","\n    ",784],"{",["T_WHITESPACE","\n        ",785],["T_VARIABLE","$pseudoProduct",786],["T_WHITESPACE"," ",786],"=",["T_WHITESPACE"," ",786],["T_NEW","new",786],["T_WHITESPACE"," ",786],["T_STRING","Varien_Object",786],"(",")",";",["T_WHITESPACE","\n        ",786],["T_VARIABLE","$pseudoProduct",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","setTaxClassId",787],"(",["T_VARIABLE","$this",787],["T_OBJECT_OPERATOR","->",787],["T_STRING","getShippingTaxClass",787],"(",["T_VARIABLE","$store",787],")",")",";",["T_WHITESPACE","\n\n        ",787],["T_VARIABLE","$billingAddress",789],["T_WHITESPACE"," ",789],"=",["T_WHITESPACE"," ",789],["T_STRING","false",789],";",["T_WHITESPACE","\n        ",789],["T_IF","if",790],["T_WHITESPACE"," ",790],"(",["T_VARIABLE","$shippingAddress",790],["T_WHITESPACE"," ",790],["T_BOOLEAN_AND","&&",790],["T_WHITESPACE"," ",790],["T_VARIABLE","$shippingAddress",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","getQuote",790],"(",")",["T_WHITESPACE"," ",790],["T_BOOLEAN_AND","&&",790],["T_WHITESPACE"," ",790],["T_VARIABLE","$shippingAddress",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","getQuote",790],"(",")",["T_OBJECT_OPERATOR","->",790],["T_STRING","getBillingAddress",790],"(",")",")",["T_WHITESPACE"," ",790],"{",["T_WHITESPACE","\n            ",790],["T_VARIABLE","$billingAddress",791],["T_WHITESPACE"," ",791],"=",["T_WHITESPACE"," ",791],["T_VARIABLE","$shippingAddress",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","getQuote",791],"(",")",["T_OBJECT_OPERATOR","->",791],["T_STRING","getBillingAddress",791],"(",")",";",["T_WHITESPACE","\n        ",791],"}",["T_WHITESPACE","\n\n        ",792],["T_VARIABLE","$price",794],["T_WHITESPACE"," ",794],"=",["T_WHITESPACE"," ",794],["T_VARIABLE","$this",794],["T_OBJECT_OPERATOR","->",794],["T_STRING","getPrice",794],"(",["T_WHITESPACE","\n            ",794],["T_VARIABLE","$pseudoProduct",795],",",["T_WHITESPACE","\n            ",795],["T_VARIABLE","$price",796],",",["T_WHITESPACE","\n            ",796],["T_VARIABLE","$includingTax",797],",",["T_WHITESPACE","\n            ",797],["T_VARIABLE","$shippingAddress",798],",",["T_WHITESPACE","\n            ",798],["T_VARIABLE","$billingAddress",799],",",["T_WHITESPACE","\n            ",799],["T_VARIABLE","$ctc",800],",",["T_WHITESPACE","\n            ",800],["T_VARIABLE","$store",801],",",["T_WHITESPACE","\n            ",801],["T_VARIABLE","$this",802],["T_OBJECT_OPERATOR","->",802],["T_STRING","shippingPriceIncludesTax",802],"(",["T_VARIABLE","$store",802],")",["T_WHITESPACE","\n        ",802],")",";",["T_WHITESPACE","\n        ",803],["T_RETURN","return",804],["T_WHITESPACE"," ",804],["T_VARIABLE","$price",804],";",["T_WHITESPACE","\n    ",804],"}",["T_WHITESPACE","\n\n    ",805],["T_DOC_COMMENT","\/**\n     * Returns the SQL for the price tax\n     *\n     * @param string $priceField\n     * @param string $taxClassField\n     * @return string\n     *\/",807],["T_WHITESPACE","\n    ",813],["T_PUBLIC","public",814],["T_WHITESPACE"," ",814],["T_FUNCTION","function",814],["T_WHITESPACE"," ",814],["T_STRING","getPriceTaxSql",814],"(",["T_VARIABLE","$priceField",814],",",["T_WHITESPACE"," ",814],["T_VARIABLE","$taxClassField",814],")",["T_WHITESPACE","\n    ",814],"{",["T_WHITESPACE","\n        ",815],["T_IF","if",816],["T_WHITESPACE"," ",816],"(","!",["T_VARIABLE","$this",816],["T_OBJECT_OPERATOR","->",816],["T_STRING","priceIncludesTax",816],"(",")",["T_WHITESPACE"," ",816],["T_BOOLEAN_AND","&&",816],["T_WHITESPACE"," ",816],["T_VARIABLE","$this",816],["T_OBJECT_OPERATOR","->",816],["T_STRING","displayPriceExcludingTax",816],"(",")",")",["T_WHITESPACE"," ",816],"{",["T_WHITESPACE","\n            ",816],["T_RETURN","return",817],["T_WHITESPACE"," ",817],["T_CONSTANT_ENCAPSED_STRING","''",817],";",["T_WHITESPACE","\n        ",817],"}",["T_WHITESPACE","\n\n        ",818],["T_VARIABLE","$request",820],["T_WHITESPACE"," ",820],"=",["T_WHITESPACE"," ",820],["T_STRING","Mage",820],["T_DOUBLE_COLON","::",820],["T_STRING","getSingleton",820],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",820],")",["T_OBJECT_OPERATOR","->",820],["T_STRING","getDefaultRateRequest",820],"(",")",";",["T_WHITESPACE","\n        ",820],["T_VARIABLE","$defaultTaxes",821],["T_WHITESPACE"," ",821],"=",["T_WHITESPACE"," ",821],["T_STRING","Mage",821],["T_DOUBLE_COLON","::",821],["T_STRING","getSingleton",821],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",821],")",["T_OBJECT_OPERATOR","->",821],["T_STRING","getRatesForAllProductTaxClasses",821],"(",["T_VARIABLE","$request",821],")",";",["T_WHITESPACE","\n\n        ",821],["T_VARIABLE","$request",823],["T_WHITESPACE"," ",823],"=",["T_WHITESPACE"," ",823],["T_STRING","Mage",823],["T_DOUBLE_COLON","::",823],["T_STRING","getSingleton",823],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",823],")",["T_OBJECT_OPERATOR","->",823],["T_STRING","getRateRequest",823],"(",")",";",["T_WHITESPACE","\n        ",823],["T_VARIABLE","$currentTaxes",824],["T_WHITESPACE"," ",824],"=",["T_WHITESPACE"," ",824],["T_STRING","Mage",824],["T_DOUBLE_COLON","::",824],["T_STRING","getSingleton",824],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",824],")",["T_OBJECT_OPERATOR","->",824],["T_STRING","getRatesForAllProductTaxClasses",824],"(",["T_VARIABLE","$request",824],")",";",["T_WHITESPACE","\n\n        ",824],["T_VARIABLE","$defaultTaxString",826],["T_WHITESPACE"," ",826],"=",["T_WHITESPACE"," ",826],["T_VARIABLE","$currentTaxString",826],["T_WHITESPACE"," ",826],"=",["T_WHITESPACE"," ",826],["T_CONSTANT_ENCAPSED_STRING","''",826],";",["T_WHITESPACE","\n\n        ",826],["T_VARIABLE","$rateToVariable",828],["T_WHITESPACE"," ",828],"=",["T_WHITESPACE"," ",828],["T_ARRAY","array",828],"(",["T_WHITESPACE","\n            ",828],["T_CONSTANT_ENCAPSED_STRING","'defaultTaxString'",829],["T_WHITESPACE"," ",829],["T_DOUBLE_ARROW","=>",829],["T_WHITESPACE"," ",829],["T_CONSTANT_ENCAPSED_STRING","'defaultTaxes'",829],",",["T_WHITESPACE","\n            ",829],["T_CONSTANT_ENCAPSED_STRING","'currentTaxString'",830],["T_WHITESPACE"," ",830],["T_DOUBLE_ARROW","=>",830],["T_WHITESPACE"," ",830],["T_CONSTANT_ENCAPSED_STRING","'currentTaxes'",830],",",["T_WHITESPACE","\n        ",830],")",";",["T_WHITESPACE","\n        ",831],["T_FOREACH","foreach",832],["T_WHITESPACE"," ",832],"(",["T_VARIABLE","$rateToVariable",832],["T_WHITESPACE"," ",832],["T_AS","as",832],["T_WHITESPACE"," ",832],["T_VARIABLE","$rateVariable",832],["T_WHITESPACE"," ",832],["T_DOUBLE_ARROW","=>",832],["T_WHITESPACE"," ",832],["T_VARIABLE","$rateArray",832],")",["T_WHITESPACE"," ",832],"{",["T_WHITESPACE","\n            ",832],["T_IF","if",833],["T_WHITESPACE"," ",833],"(","$",["T_VARIABLE","$rateArray",833],["T_WHITESPACE"," ",833],["T_BOOLEAN_AND","&&",833],["T_WHITESPACE"," ",833],["T_STRING","is_array",833],"(","$",["T_VARIABLE","$rateArray",833],")",")",["T_WHITESPACE"," ",833],"{",["T_WHITESPACE","\n                ",833],"$",["T_VARIABLE","$rateVariable",834],["T_WHITESPACE"," ",834],"=",["T_WHITESPACE"," ",834],["T_CONSTANT_ENCAPSED_STRING","''",834],";",["T_WHITESPACE","\n                ",834],["T_FOREACH","foreach",835],["T_WHITESPACE"," ",835],"(","$",["T_VARIABLE","$rateArray",835],["T_WHITESPACE"," ",835],["T_AS","as",835],["T_WHITESPACE"," ",835],["T_VARIABLE","$classId",835],["T_WHITESPACE"," ",835],["T_DOUBLE_ARROW","=>",835],["T_WHITESPACE"," ",835],["T_VARIABLE","$rate",835],")",["T_WHITESPACE"," ",835],"{",["T_WHITESPACE","\n                    ",835],["T_IF","if",836],["T_WHITESPACE"," ",836],"(",["T_VARIABLE","$rate",836],")",["T_WHITESPACE"," ",836],"{",["T_WHITESPACE","\n                        ",836],"$",["T_VARIABLE","$rateVariable",837],["T_WHITESPACE"," ",837],["T_CONCAT_EQUAL",".=",837],["T_WHITESPACE"," ",837],["T_STRING","sprintf",837],"(",["T_CONSTANT_ENCAPSED_STRING","\"WHEN %d THEN %12.4f \"",837],",",["T_WHITESPACE"," ",837],["T_VARIABLE","$classId",837],",",["T_WHITESPACE"," ",837],["T_VARIABLE","$rate",837],["T_WHITESPACE"," ",837],"\/",["T_WHITESPACE"," ",837],["T_LNUMBER","100",837],")",";",["T_WHITESPACE","\n                    ",837],"}",["T_WHITESPACE","\n                ",838],"}",["T_WHITESPACE","\n                ",839],["T_IF","if",840],["T_WHITESPACE"," ",840],"(","$",["T_VARIABLE","$rateVariable",840],")",["T_WHITESPACE"," ",840],"{",["T_WHITESPACE","\n                    ",840],"$",["T_VARIABLE","$rateVariable",841],["T_WHITESPACE"," ",841],"=",["T_WHITESPACE"," ",841],"\"",["T_ENCAPSED_AND_WHITESPACE","CASE ",841],["T_CURLY_OPEN","{",841],["T_VARIABLE","$taxClassField",841],"}",["T_ENCAPSED_AND_WHITESPACE"," ",841],["T_CURLY_OPEN","{",841],"$",["T_VARIABLE","$rateVariable",841],"}",["T_ENCAPSED_AND_WHITESPACE"," ELSE 0 END",841],"\"",";",["T_WHITESPACE","\n                ",841],"}",["T_WHITESPACE","\n            ",842],"}",["T_WHITESPACE","\n        ",843],"}",["T_WHITESPACE","\n\n        ",844],["T_VARIABLE","$result",846],["T_WHITESPACE"," ",846],"=",["T_WHITESPACE"," ",846],["T_CONSTANT_ENCAPSED_STRING","''",846],";",["T_WHITESPACE","\n\n        ",846],["T_IF","if",848],["T_WHITESPACE"," ",848],"(",["T_VARIABLE","$this",848],["T_OBJECT_OPERATOR","->",848],["T_STRING","priceIncludesTax",848],"(",")",")",["T_WHITESPACE"," ",848],"{",["T_WHITESPACE","\n            ",848],["T_IF","if",849],["T_WHITESPACE"," ",849],"(",["T_VARIABLE","$defaultTaxString",849],")",["T_WHITESPACE"," ",849],"{",["T_WHITESPACE","\n                ",849],["T_VARIABLE","$result",850],["T_WHITESPACE"," ",850],"=",["T_WHITESPACE"," ",850],"\"",["T_ENCAPSED_AND_WHITESPACE","-(",850],["T_CURLY_OPEN","{",850],["T_VARIABLE","$priceField",850],"}",["T_ENCAPSED_AND_WHITESPACE","\/(1+(",850],["T_CURLY_OPEN","{",850],["T_VARIABLE","$defaultTaxString",850],"}",["T_ENCAPSED_AND_WHITESPACE","))*",850],["T_CURLY_OPEN","{",850],["T_VARIABLE","$defaultTaxString",850],"}",["T_ENCAPSED_AND_WHITESPACE",")",850],"\"",";",["T_WHITESPACE","\n            ",850],"}",["T_WHITESPACE","\n            ",851],["T_IF","if",852],["T_WHITESPACE"," ",852],"(","!",["T_VARIABLE","$this",852],["T_OBJECT_OPERATOR","->",852],["T_STRING","displayPriceExcludingTax",852],"(",")",["T_WHITESPACE"," ",852],["T_BOOLEAN_AND","&&",852],["T_WHITESPACE"," ",852],["T_VARIABLE","$currentTaxString",852],")",["T_WHITESPACE"," ",852],"{",["T_WHITESPACE","\n                ",852],["T_VARIABLE","$result",853],["T_WHITESPACE"," ",853],["T_CONCAT_EQUAL",".=",853],["T_WHITESPACE"," ",853],"\"",["T_ENCAPSED_AND_WHITESPACE","+((",853],["T_CURLY_OPEN","{",853],["T_VARIABLE","$priceField",853],"}",["T_CURLY_OPEN","{",853],["T_VARIABLE","$result",853],"}",["T_ENCAPSED_AND_WHITESPACE",")*",853],["T_CURLY_OPEN","{",853],["T_VARIABLE","$currentTaxString",853],"}",["T_ENCAPSED_AND_WHITESPACE",")",853],"\"",";",["T_WHITESPACE","\n            ",853],"}",["T_WHITESPACE","\n        ",854],"}",["T_WHITESPACE"," ",855],["T_ELSE","else",855],["T_WHITESPACE"," ",855],"{",["T_WHITESPACE","\n            ",855],["T_IF","if",856],["T_WHITESPACE"," ",856],"(",["T_VARIABLE","$this",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","displayPriceIncludingTax",856],"(",")",")",["T_WHITESPACE"," ",856],"{",["T_WHITESPACE","\n                ",856],["T_IF","if",857],["T_WHITESPACE"," ",857],"(",["T_VARIABLE","$currentTaxString",857],")",["T_WHITESPACE"," ",857],"{",["T_WHITESPACE","\n                    ",857],["T_VARIABLE","$result",858],["T_WHITESPACE"," ",858],["T_CONCAT_EQUAL",".=",858],["T_WHITESPACE"," ",858],"\"",["T_ENCAPSED_AND_WHITESPACE","+(",858],["T_CURLY_OPEN","{",858],["T_VARIABLE","$priceField",858],"}",["T_ENCAPSED_AND_WHITESPACE","*",858],["T_CURLY_OPEN","{",858],["T_VARIABLE","$currentTaxString",858],"}",["T_ENCAPSED_AND_WHITESPACE",")",858],"\"",";",["T_WHITESPACE","\n                ",858],"}",["T_WHITESPACE","\n            ",859],"}",["T_WHITESPACE","\n        ",860],"}",["T_WHITESPACE","\n        ",861],["T_RETURN","return",862],["T_WHITESPACE"," ",862],["T_VARIABLE","$result",862],";",["T_WHITESPACE","\n    ",862],"}",["T_WHITESPACE","\n\n    ",863],["T_DOC_COMMENT","\/**\n     * Join tax class\n     * @param Varien_Db_Select $select\n     * @param int $storeId\n     * @param string $priceTable\n     * @return Mage_Tax_Helper_Data\n     *\/",865],["T_WHITESPACE","\n    ",871],["T_PUBLIC","public",872],["T_WHITESPACE"," ",872],["T_FUNCTION","function",872],["T_WHITESPACE"," ",872],["T_STRING","joinTaxClass",872],"(",["T_VARIABLE","$select",872],",",["T_WHITESPACE"," ",872],["T_VARIABLE","$storeId",872],",",["T_WHITESPACE"," ",872],["T_VARIABLE","$priceTable",872],["T_WHITESPACE"," ",872],"=",["T_WHITESPACE"," ",872],["T_CONSTANT_ENCAPSED_STRING","'main_table'",872],")",["T_WHITESPACE","\n    ",872],"{",["T_WHITESPACE","\n        ",873],["T_VARIABLE","$taxClassAttribute",874],["T_WHITESPACE"," ",874],"=",["T_WHITESPACE"," ",874],["T_STRING","Mage",874],["T_DOUBLE_COLON","::",874],["T_STRING","getModel",874],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/entity_attribute'",874],")",["T_WHITESPACE","\n            ",874],["T_OBJECT_OPERATOR","->",875],["T_STRING","loadByCode",875],"(",["T_STRING","Mage_Catalog_Model_Product",875],["T_DOUBLE_COLON","::",875],["T_STRING","ENTITY",875],",",["T_WHITESPACE"," ",875],["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",875],")",";",["T_WHITESPACE","\n        ",875],["T_VARIABLE","$joinConditionD",876],["T_WHITESPACE"," ",876],"=",["T_WHITESPACE"," ",876],["T_STRING","implode",876],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",876],",",["T_WHITESPACE"," ",876],["T_ARRAY","array",876],"(",["T_WHITESPACE","\n            ",876],"\"",["T_ENCAPSED_AND_WHITESPACE","tax_class_d.entity_id = ",877],["T_CURLY_OPEN","{",877],["T_VARIABLE","$priceTable",877],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_id",877],"\"",",",["T_WHITESPACE","\n            ",877],["T_VARIABLE","$select",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","getAdapter",878],"(",")",["T_OBJECT_OPERATOR","->",878],["T_STRING","quoteInto",878],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_d.attribute_id = ?'",878],",",["T_WHITESPACE"," ",878],["T_INT_CAST","(int)",878],["T_VARIABLE","$taxClassAttribute",878],["T_OBJECT_OPERATOR","->",878],["T_STRING","getId",878],"(",")",")",",",["T_WHITESPACE","\n            ",878],["T_CONSTANT_ENCAPSED_STRING","'tax_class_d.store_id = 0'",879],["T_WHITESPACE","\n        ",879],")",")",";",["T_WHITESPACE","\n        ",880],["T_VARIABLE","$joinConditionC",881],["T_WHITESPACE"," ",881],"=",["T_WHITESPACE"," ",881],["T_STRING","implode",881],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",881],",",["T_WHITESPACE"," ",881],["T_ARRAY","array",881],"(",["T_WHITESPACE","\n            ",881],"\"",["T_ENCAPSED_AND_WHITESPACE","tax_class_c.entity_id = ",882],["T_CURLY_OPEN","{",882],["T_VARIABLE","$priceTable",882],"}",["T_ENCAPSED_AND_WHITESPACE",".entity_id",882],"\"",",",["T_WHITESPACE","\n            ",882],["T_VARIABLE","$select",883],["T_OBJECT_OPERATOR","->",883],["T_STRING","getAdapter",883],"(",")",["T_OBJECT_OPERATOR","->",883],["T_STRING","quoteInto",883],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_c.attribute_id = ?'",883],",",["T_WHITESPACE"," ",883],["T_INT_CAST","(int)",883],["T_VARIABLE","$taxClassAttribute",883],["T_OBJECT_OPERATOR","->",883],["T_STRING","getId",883],"(",")",")",",",["T_WHITESPACE","\n            ",883],["T_VARIABLE","$select",884],["T_OBJECT_OPERATOR","->",884],["T_STRING","getAdapter",884],"(",")",["T_OBJECT_OPERATOR","->",884],["T_STRING","quoteInto",884],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_c.store_id = ?'",884],",",["T_WHITESPACE"," ",884],["T_INT_CAST","(int)",884],["T_VARIABLE","$storeId",884],")",["T_WHITESPACE","\n        ",884],")",")",";",["T_WHITESPACE","\n        ",885],["T_VARIABLE","$select",886],["T_WHITESPACE","\n            ",886],["T_OBJECT_OPERATOR","->",887],["T_STRING","joinLeft",887],"(",["T_WHITESPACE","\n                ",887],["T_ARRAY","array",888],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_d'",888],["T_WHITESPACE"," ",888],["T_DOUBLE_ARROW","=>",888],["T_WHITESPACE"," ",888],["T_VARIABLE","$taxClassAttribute",888],["T_OBJECT_OPERATOR","->",888],["T_STRING","getBackend",888],"(",")",["T_OBJECT_OPERATOR","->",888],["T_STRING","getTable",888],"(",")",")",",",["T_WHITESPACE","\n                ",888],["T_VARIABLE","$joinConditionD",889],",",["T_WHITESPACE","\n                ",889],["T_ARRAY","array",890],"(",")",")",["T_WHITESPACE","\n            ",890],["T_OBJECT_OPERATOR","->",891],["T_STRING","joinLeft",891],"(",["T_WHITESPACE","\n                ",891],["T_ARRAY","array",892],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_class_c'",892],["T_WHITESPACE"," ",892],["T_DOUBLE_ARROW","=>",892],["T_WHITESPACE"," ",892],["T_VARIABLE","$taxClassAttribute",892],["T_OBJECT_OPERATOR","->",892],["T_STRING","getBackend",892],"(",")",["T_OBJECT_OPERATOR","->",892],["T_STRING","getTable",892],"(",")",")",",",["T_WHITESPACE","\n                ",892],["T_VARIABLE","$joinConditionC",893],",",["T_WHITESPACE","\n                ",893],["T_ARRAY","array",894],"(",")",")",";",["T_WHITESPACE","\n\n        ",894],["T_RETURN","return",896],["T_WHITESPACE"," ",896],["T_VARIABLE","$this",896],";",["T_WHITESPACE","\n    ",896],"}",["T_WHITESPACE","\n\n    ",897],["T_DOC_COMMENT","\/**\n     * Get configuration setting \"Apply Discount On Prices Including Tax\" value\n     *\n     * @param   null|int $store\n     * @return  0|1\n     *\/",899],["T_WHITESPACE","\n    ",904],["T_PUBLIC","public",905],["T_WHITESPACE"," ",905],["T_FUNCTION","function",905],["T_WHITESPACE"," ",905],["T_STRING","discountTax",905],"(",["T_VARIABLE","$store",905],["T_WHITESPACE"," ",905],"=",["T_WHITESPACE"," ",905],["T_STRING","null",905],")",["T_WHITESPACE","\n    ",905],"{",["T_WHITESPACE","\n        ",906],["T_RETURN","return",907],["T_WHITESPACE"," ",907],["T_VARIABLE","$this",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","_config",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","discountTax",907],"(",["T_VARIABLE","$store",907],")",";",["T_WHITESPACE","\n    ",907],"}",["T_WHITESPACE","\n\n    ",908],["T_DOC_COMMENT","\/**\n     * Get value of \"Apply Tax On\" custom\/original price configuration settings.\n     * Result is 0 or 1\n     *\n     * @param mixed $store\n     * @return mixed\n     *\/",910],["T_WHITESPACE","\n    ",916],["T_PUBLIC","public",917],["T_WHITESPACE"," ",917],["T_FUNCTION","function",917],["T_WHITESPACE"," ",917],["T_STRING","getTaxBasedOn",917],"(",["T_VARIABLE","$store",917],["T_WHITESPACE"," ",917],"=",["T_WHITESPACE"," ",917],["T_STRING","null",917],")",["T_WHITESPACE","\n    ",917],"{",["T_WHITESPACE","\n        ",918],["T_RETURN","return",919],["T_WHITESPACE"," ",919],["T_STRING","Mage",919],["T_DOUBLE_COLON","::",919],["T_STRING","getStoreConfig",919],"(",["T_STRING","Mage_Tax_Model_Config",919],["T_DOUBLE_COLON","::",919],["T_STRING","CONFIG_XML_PATH_BASED_ON",919],",",["T_WHITESPACE"," ",919],["T_VARIABLE","$store",919],")",";",["T_WHITESPACE","\n    ",919],"}",["T_WHITESPACE","\n\n    ",920],["T_DOC_COMMENT","\/**\n     * Check if tax can be applied to custom price\n     *\n     * @param $store\n     * @return bool\n     *\/",922],["T_WHITESPACE","\n    ",927],["T_PUBLIC","public",928],["T_WHITESPACE"," ",928],["T_FUNCTION","function",928],["T_WHITESPACE"," ",928],["T_STRING","applyTaxOnCustomPrice",928],"(",["T_VARIABLE","$store",928],["T_WHITESPACE"," ",928],"=",["T_WHITESPACE"," ",928],["T_STRING","null",928],")",["T_WHITESPACE","\n    ",928],"{",["T_WHITESPACE","\n        ",929],["T_RETURN","return",930],["T_WHITESPACE"," ",930],"(",["T_INT_CAST","(int)",930],["T_STRING","Mage",930],["T_DOUBLE_COLON","::",930],["T_STRING","getStoreConfig",930],"(",["T_STRING","Mage_Tax_Model_Config",930],["T_DOUBLE_COLON","::",930],["T_STRING","CONFIG_XML_PATH_APPLY_ON",930],",",["T_WHITESPACE"," ",930],["T_VARIABLE","$store",930],")",["T_WHITESPACE"," ",930],["T_IS_EQUAL","==",930],["T_WHITESPACE"," ",930],["T_LNUMBER","0",930],")",";",["T_WHITESPACE","\n    ",930],"}",["T_WHITESPACE","\n\n    ",931],["T_DOC_COMMENT","\/**\n     * Check if tax should be applied just to original price\n     *\n     * @param $store\n     * @return bool\n     *\/",933],["T_WHITESPACE","\n    ",938],["T_PUBLIC","public",939],["T_WHITESPACE"," ",939],["T_FUNCTION","function",939],["T_WHITESPACE"," ",939],["T_STRING","applyTaxOnOriginalPrice",939],"(",["T_VARIABLE","$store",939],["T_WHITESPACE"," ",939],"=",["T_WHITESPACE"," ",939],["T_STRING","null",939],")",["T_WHITESPACE","\n    ",939],"{",["T_WHITESPACE","\n        ",940],["T_RETURN","return",941],["T_WHITESPACE"," ",941],"(",["T_INT_CAST","(int)",941],["T_STRING","Mage",941],["T_DOUBLE_COLON","::",941],["T_STRING","getStoreConfig",941],"(",["T_STRING","Mage_Tax_Model_Config",941],["T_DOUBLE_COLON","::",941],["T_STRING","CONFIG_XML_PATH_APPLY_ON",941],",",["T_WHITESPACE"," ",941],["T_VARIABLE","$store",941],")",["T_WHITESPACE"," ",941],["T_IS_EQUAL","==",941],["T_WHITESPACE"," ",941],["T_LNUMBER","1",941],")",";",["T_WHITESPACE","\n    ",941],"}",["T_WHITESPACE","\n\n    ",942],["T_DOC_COMMENT","\/**\n     * Get taxes\/discounts calculation sequence.\n     * This sequence depends on \"Catalog price include tax\", \"Apply Tax After Discount\"\n     * and \"Apply Discount On Prices Including Tax\" configuration options.\n     *\n     * @param   null|int|string|Mage_Core_Model_Store $store\n     * @return  string\n     *\/",944],["T_WHITESPACE","\n    ",951],["T_PUBLIC","public",952],["T_WHITESPACE"," ",952],["T_FUNCTION","function",952],["T_WHITESPACE"," ",952],["T_STRING","getCalculationSequence",952],"(",["T_VARIABLE","$store",952],["T_WHITESPACE"," ",952],"=",["T_WHITESPACE"," ",952],["T_STRING","null",952],")",["T_WHITESPACE","\n    ",952],"{",["T_WHITESPACE","\n        ",953],["T_RETURN","return",954],["T_WHITESPACE"," ",954],["T_VARIABLE","$this",954],["T_OBJECT_OPERATOR","->",954],["T_STRING","_config",954],["T_OBJECT_OPERATOR","->",954],["T_STRING","getCalculationSequence",954],"(",["T_VARIABLE","$store",954],")",";",["T_WHITESPACE","\n    ",954],"}",["T_WHITESPACE","\n\n    ",955],["T_DOC_COMMENT","\/**\n     * Get tax calculation algorithm code\n     *\n     * @param   null|int $store\n     * @return  string\n     *\/",957],["T_WHITESPACE","\n    ",962],["T_PUBLIC","public",963],["T_WHITESPACE"," ",963],["T_FUNCTION","function",963],["T_WHITESPACE"," ",963],["T_STRING","getCalculationAgorithm",963],"(",["T_VARIABLE","$store",963],["T_WHITESPACE"," ",963],"=",["T_WHITESPACE"," ",963],["T_STRING","null",963],")",["T_WHITESPACE","\n    ",963],"{",["T_WHITESPACE","\n        ",964],["T_RETURN","return",965],["T_WHITESPACE"," ",965],["T_VARIABLE","$this",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","_config",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","getAlgorithm",965],"(",["T_VARIABLE","$store",965],")",";",["T_WHITESPACE","\n    ",965],"}",["T_WHITESPACE","\n\n    ",966],["T_DOC_COMMENT","\/**\n     * Get calculated taxes for each tax class\n     *\n     * This method returns array with format:\n     * array(\n     *  $index => array(\n     *      'tax_amount'        => $taxAmount,\n     *      'base_tax_amount'   => $baseTaxAmount,\n     *      'hidden_tax_amount' => $hiddenTaxAmount,\n     *      'title'             => $title,\n     *      'percent'           => $percent\n     *  )\n     * )\n     *\n     * @param Mage_Sales_Model_Order $source\n     * @return array\n     *\/",968],["T_WHITESPACE","\n    ",984],["T_PUBLIC","public",985],["T_WHITESPACE"," ",985],["T_FUNCTION","function",985],["T_WHITESPACE"," ",985],["T_STRING","getCalculatedTaxes",985],"(",["T_VARIABLE","$source",985],")",["T_WHITESPACE","\n    ",985],"{",["T_WHITESPACE","\n        ",986],["T_IF","if",987],["T_WHITESPACE"," ",987],"(",["T_VARIABLE","$this",987],["T_OBJECT_OPERATOR","->",987],["T_STRING","_getFromRegistry",987],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",987],")",")",["T_WHITESPACE"," ",987],"{",["T_WHITESPACE","\n            ",987],["T_VARIABLE","$current",988],["T_WHITESPACE"," ",988],"=",["T_WHITESPACE"," ",988],["T_VARIABLE","$this",988],["T_OBJECT_OPERATOR","->",988],["T_STRING","_getFromRegistry",988],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",988],")",";",["T_WHITESPACE","\n        ",988],"}",["T_WHITESPACE"," ",989],["T_ELSEIF","elseif",989],["T_WHITESPACE"," ",989],"(",["T_VARIABLE","$this",989],["T_OBJECT_OPERATOR","->",989],["T_STRING","_getFromRegistry",989],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",989],")",")",["T_WHITESPACE"," ",989],"{",["T_WHITESPACE","\n            ",989],["T_VARIABLE","$current",990],["T_WHITESPACE"," ",990],"=",["T_WHITESPACE"," ",990],["T_VARIABLE","$this",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","_getFromRegistry",990],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",990],")",";",["T_WHITESPACE","\n        ",990],"}",["T_WHITESPACE"," ",991],["T_ELSE","else",991],["T_WHITESPACE"," ",991],"{",["T_WHITESPACE","\n            ",991],["T_VARIABLE","$current",992],["T_WHITESPACE"," ",992],"=",["T_WHITESPACE"," ",992],["T_VARIABLE","$source",992],";",["T_WHITESPACE","\n        ",992],"}",["T_WHITESPACE","\n\n        ",993],["T_VARIABLE","$taxClassAmount",995],["T_WHITESPACE"," ",995],"=",["T_WHITESPACE"," ",995],["T_ARRAY","array",995],"(",")",";",["T_WHITESPACE","\n        ",995],["T_IF","if",996],["T_WHITESPACE"," ",996],"(",["T_VARIABLE","$current",996],["T_WHITESPACE"," ",996],["T_BOOLEAN_AND","&&",996],["T_WHITESPACE"," ",996],["T_VARIABLE","$source",996],")",["T_WHITESPACE"," ",996],"{",["T_WHITESPACE","\n            ",996],["T_IF","if",997],["T_WHITESPACE"," ",997],"(",["T_VARIABLE","$current",997],["T_WHITESPACE"," ",997],["T_IS_EQUAL","==",997],["T_WHITESPACE"," ",997],["T_VARIABLE","$source",997],")",["T_WHITESPACE"," ",997],"{",["T_WHITESPACE","\n                ",997],["T_COMMENT","\/\/ use the actuals\n",998],["T_WHITESPACE","                ",999],["T_VARIABLE","$rates",999],["T_WHITESPACE"," ",999],"=",["T_WHITESPACE"," ",999],["T_VARIABLE","$this",999],["T_OBJECT_OPERATOR","->",999],["T_STRING","_getTaxRateSubtotals",999],"(",["T_VARIABLE","$source",999],")",";",["T_WHITESPACE","\n                ",999],["T_FOREACH","foreach",1000],["T_WHITESPACE"," ",1000],"(",["T_VARIABLE","$rates",1000],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",1000],"]",["T_WHITESPACE"," ",1000],["T_AS","as",1000],["T_WHITESPACE"," ",1000],["T_VARIABLE","$rate",1000],")",["T_WHITESPACE"," ",1000],"{",["T_WHITESPACE","\n                    ",1000],["T_VARIABLE","$taxClassId",1001],["T_WHITESPACE"," ",1001],"=",["T_WHITESPACE"," ",1001],["T_VARIABLE","$rate",1001],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_id'",1001],"]",";",["T_WHITESPACE","\n                    ",1001],["T_VARIABLE","$taxClassAmount",1002],"[",["T_VARIABLE","$taxClassId",1002],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",1002],"]",["T_WHITESPACE"," ",1002],"=",["T_WHITESPACE"," ",1002],["T_VARIABLE","$rate",1002],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",1002],"]",";",["T_WHITESPACE","\n                    ",1002],["T_VARIABLE","$taxClassAmount",1003],"[",["T_VARIABLE","$taxClassId",1003],"]","[",["T_CONSTANT_ENCAPSED_STRING","'base_tax_amount'",1003],"]",["T_WHITESPACE"," ",1003],"=",["T_WHITESPACE"," ",1003],["T_VARIABLE","$rate",1003],"[",["T_CONSTANT_ENCAPSED_STRING","'base_amount'",1003],"]",";",["T_WHITESPACE","\n                    ",1003],["T_VARIABLE","$taxClassAmount",1004],"[",["T_VARIABLE","$taxClassId",1004],"]","[",["T_CONSTANT_ENCAPSED_STRING","'title'",1004],"]",["T_WHITESPACE"," ",1004],"=",["T_WHITESPACE"," ",1004],["T_VARIABLE","$rate",1004],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",1004],"]",";",["T_WHITESPACE","\n                    ",1004],["T_VARIABLE","$taxClassAmount",1005],"[",["T_VARIABLE","$taxClassId",1005],"]","[",["T_CONSTANT_ENCAPSED_STRING","'percent'",1005],"]",["T_WHITESPACE"," ",1005],"=",["T_WHITESPACE"," ",1005],["T_VARIABLE","$rate",1005],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",1005],"]",";",["T_WHITESPACE","\n                ",1005],"}",["T_WHITESPACE","\n            ",1006],"}",["T_WHITESPACE"," ",1007],["T_ELSE","else",1007],["T_WHITESPACE"," ",1007],"{",["T_WHITESPACE","\n                ",1007],["T_COMMENT","\/\/ regenerate tax subtotals\n",1008],["T_WHITESPACE","                ",1009],["T_COMMENT","\/\/ Calculate taxes for shipping\n",1009],["T_WHITESPACE","                ",1010],["T_VARIABLE","$shippingTaxAmount",1010],["T_WHITESPACE"," ",1010],"=",["T_WHITESPACE"," ",1010],["T_VARIABLE","$current",1010],["T_OBJECT_OPERATOR","->",1010],["T_STRING","getShippingTaxAmount",1010],"(",")",";",["T_WHITESPACE","\n                ",1010],["T_IF","if",1011],["T_WHITESPACE"," ",1011],"(",["T_VARIABLE","$shippingTaxAmount",1011],")",["T_WHITESPACE"," ",1011],"{",["T_WHITESPACE","\n                    ",1011],["T_VARIABLE","$shippingTax",1012],["T_WHITESPACE","    ",1012],"=",["T_WHITESPACE"," ",1012],["T_STRING","Mage",1012],["T_DOUBLE_COLON","::",1012],["T_STRING","helper",1012],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",1012],")",["T_OBJECT_OPERATOR","->",1012],["T_STRING","getShippingTax",1012],"(",["T_VARIABLE","$current",1012],")",";",["T_WHITESPACE","\n                    ",1012],["T_VARIABLE","$taxClassAmount",1013],["T_WHITESPACE"," ",1013],"=",["T_WHITESPACE"," ",1013],["T_STRING","array_merge",1013],"(",["T_VARIABLE","$taxClassAmount",1013],",",["T_WHITESPACE"," ",1013],["T_VARIABLE","$shippingTax",1013],")",";",["T_WHITESPACE","\n                ",1013],"}",["T_WHITESPACE","\n\n                ",1014],["T_FOREACH","foreach",1016],["T_WHITESPACE"," ",1016],"(",["T_VARIABLE","$current",1016],["T_OBJECT_OPERATOR","->",1016],["T_STRING","getItemsCollection",1016],"(",")",["T_WHITESPACE"," ",1016],["T_AS","as",1016],["T_WHITESPACE"," ",1016],["T_VARIABLE","$item",1016],")",["T_WHITESPACE"," ",1016],"{",["T_WHITESPACE","\n                    ",1016],["T_VARIABLE","$taxCollection",1017],["T_WHITESPACE"," ",1017],"=",["T_WHITESPACE"," ",1017],["T_STRING","Mage",1017],["T_DOUBLE_COLON","::",1017],["T_STRING","getResourceModel",1017],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/sales_order_tax_item'",1017],")",["T_WHITESPACE","\n                        ",1017],["T_OBJECT_OPERATOR","->",1018],["T_STRING","getTaxItemsByItemId",1018],"(",["T_WHITESPACE","\n                            ",1018],["T_VARIABLE","$item",1019],["T_OBJECT_OPERATOR","->",1019],["T_STRING","getOrderItemId",1019],"(",")",["T_WHITESPACE"," ",1019],"?",["T_WHITESPACE"," ",1019],["T_VARIABLE","$item",1019],["T_OBJECT_OPERATOR","->",1019],["T_STRING","getOrderItemId",1019],"(",")",["T_WHITESPACE"," ",1019],":",["T_WHITESPACE"," ",1019],["T_VARIABLE","$item",1019],["T_OBJECT_OPERATOR","->",1019],["T_STRING","getItemId",1019],"(",")",["T_WHITESPACE","\n                        ",1019],")",";",["T_WHITESPACE","\n\n                    ",1020],["T_FOREACH","foreach",1022],["T_WHITESPACE"," ",1022],"(",["T_VARIABLE","$taxCollection",1022],["T_WHITESPACE"," ",1022],["T_AS","as",1022],["T_WHITESPACE"," ",1022],["T_VARIABLE","$tax",1022],")",["T_WHITESPACE"," ",1022],"{",["T_WHITESPACE","\n                        ",1022],["T_VARIABLE","$taxClassId",1023],["T_WHITESPACE"," ",1023],"=",["T_WHITESPACE"," ",1023],["T_VARIABLE","$tax",1023],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_id'",1023],"]",";",["T_WHITESPACE","\n                        ",1023],["T_VARIABLE","$percent",1024],["T_WHITESPACE"," ",1024],"=",["T_WHITESPACE"," ",1024],["T_VARIABLE","$tax",1024],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_percent'",1024],"]",";",["T_WHITESPACE","\n\n                        ",1024],["T_VARIABLE","$price",1026],["T_WHITESPACE"," ",1026],"=",["T_WHITESPACE"," ",1026],["T_VARIABLE","$item",1026],["T_OBJECT_OPERATOR","->",1026],["T_STRING","getRowTotal",1026],"(",")",";",["T_WHITESPACE","\n                        ",1026],["T_VARIABLE","$basePrice",1027],["T_WHITESPACE"," ",1027],"=",["T_WHITESPACE"," ",1027],["T_VARIABLE","$item",1027],["T_OBJECT_OPERATOR","->",1027],["T_STRING","getBaseRowTotal",1027],"(",")",";",["T_WHITESPACE","\n                        ",1027],["T_IF","if",1028],["T_WHITESPACE"," ",1028],"(",["T_VARIABLE","$this",1028],["T_OBJECT_OPERATOR","->",1028],["T_STRING","applyTaxAfterDiscount",1028],"(",["T_VARIABLE","$item",1028],["T_OBJECT_OPERATOR","->",1028],["T_STRING","getStoreId",1028],"(",")",")",")",["T_WHITESPACE"," ",1028],"{",["T_WHITESPACE","\n                            ",1028],["T_VARIABLE","$price",1029],["T_WHITESPACE"," ",1029],"=",["T_WHITESPACE"," ",1029],["T_VARIABLE","$price",1029],["T_WHITESPACE"," ",1029],"-",["T_WHITESPACE"," ",1029],["T_VARIABLE","$item",1029],["T_OBJECT_OPERATOR","->",1029],["T_STRING","getDiscountAmount",1029],"(",")",["T_WHITESPACE"," ",1029],"+",["T_WHITESPACE"," ",1029],["T_VARIABLE","$item",1029],["T_OBJECT_OPERATOR","->",1029],["T_STRING","getHiddenTaxAmount",1029],"(",")",";",["T_WHITESPACE","\n                            ",1029],["T_VARIABLE","$basePrice",1030],["T_WHITESPACE"," ",1030],"=",["T_WHITESPACE"," ",1030],["T_VARIABLE","$basePrice",1030],["T_WHITESPACE"," ",1030],"-",["T_WHITESPACE"," ",1030],["T_VARIABLE","$item",1030],["T_OBJECT_OPERATOR","->",1030],["T_STRING","getBaseDiscountAmount",1030],"(",")",["T_WHITESPACE"," ",1030],"+",["T_WHITESPACE"," ",1030],["T_VARIABLE","$item",1030],["T_OBJECT_OPERATOR","->",1030],["T_STRING","getBaseHiddenTaxAmount",1030],"(",")",";",["T_WHITESPACE","\n                        ",1030],"}",["T_WHITESPACE","\n                        ",1031],["T_VARIABLE","$tax_amount",1032],["T_WHITESPACE"," ",1032],"=",["T_WHITESPACE"," ",1032],["T_VARIABLE","$price",1032],["T_WHITESPACE"," ",1032],"*",["T_WHITESPACE"," ",1032],["T_VARIABLE","$percent",1032],["T_WHITESPACE"," ",1032],"\/",["T_WHITESPACE"," ",1032],["T_LNUMBER","100",1032],";",["T_WHITESPACE","\n                        ",1032],["T_VARIABLE","$base_tax_amount",1033],["T_WHITESPACE"," ",1033],"=",["T_WHITESPACE"," ",1033],["T_VARIABLE","$basePrice",1033],["T_WHITESPACE"," ",1033],"*",["T_WHITESPACE"," ",1033],["T_VARIABLE","$percent",1033],["T_WHITESPACE"," ",1033],"\/",["T_WHITESPACE"," ",1033],["T_LNUMBER","100",1033],";",["T_WHITESPACE","\n\n                        ",1033],["T_IF","if",1035],["T_WHITESPACE"," ",1035],"(",["T_ISSET","isset",1035],"(",["T_VARIABLE","$taxClassAmount",1035],"[",["T_VARIABLE","$taxClassId",1035],"]",")",")",["T_WHITESPACE"," ",1035],"{",["T_WHITESPACE","\n                            ",1035],["T_VARIABLE","$taxClassAmount",1036],"[",["T_VARIABLE","$taxClassId",1036],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",1036],"]",["T_WHITESPACE"," ",1036],["T_PLUS_EQUAL","+=",1036],["T_WHITESPACE"," ",1036],["T_VARIABLE","$tax_amount",1036],";",["T_WHITESPACE","\n                            ",1036],["T_VARIABLE","$taxClassAmount",1037],"[",["T_VARIABLE","$taxClassId",1037],"]","[",["T_CONSTANT_ENCAPSED_STRING","'base_tax_amount'",1037],"]",["T_WHITESPACE"," ",1037],["T_PLUS_EQUAL","+=",1037],["T_WHITESPACE"," ",1037],["T_VARIABLE","$base_tax_amount",1037],";",["T_WHITESPACE","\n                        ",1037],"}",["T_WHITESPACE"," ",1038],["T_ELSE","else",1038],["T_WHITESPACE"," ",1038],"{",["T_WHITESPACE","\n                            ",1038],["T_VARIABLE","$taxClassAmount",1039],"[",["T_VARIABLE","$taxClassId",1039],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",1039],"]",["T_WHITESPACE"," ",1039],"=",["T_WHITESPACE"," ",1039],["T_VARIABLE","$tax_amount",1039],";",["T_WHITESPACE","\n                            ",1039],["T_VARIABLE","$taxClassAmount",1040],"[",["T_VARIABLE","$taxClassId",1040],"]","[",["T_CONSTANT_ENCAPSED_STRING","'base_tax_amount'",1040],"]",["T_WHITESPACE"," ",1040],"=",["T_WHITESPACE"," ",1040],["T_VARIABLE","$base_tax_amount",1040],";",["T_WHITESPACE","\n                            ",1040],["T_VARIABLE","$taxClassAmount",1041],"[",["T_VARIABLE","$taxClassId",1041],"]","[",["T_CONSTANT_ENCAPSED_STRING","'title'",1041],"]",["T_WHITESPACE"," ",1041],"=",["T_WHITESPACE"," ",1041],["T_VARIABLE","$tax",1041],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",1041],"]",";",["T_WHITESPACE","\n                            ",1041],["T_VARIABLE","$taxClassAmount",1042],"[",["T_VARIABLE","$taxClassId",1042],"]","[",["T_CONSTANT_ENCAPSED_STRING","'percent'",1042],"]",["T_WHITESPACE"," ",1042],"=",["T_WHITESPACE"," ",1042],["T_VARIABLE","$tax",1042],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",1042],"]",";",["T_WHITESPACE","\n                        ",1042],"}",["T_WHITESPACE","\n                    ",1043],"}",["T_WHITESPACE","\n                ",1044],"}",["T_WHITESPACE","\n            ",1045],"}",["T_WHITESPACE","\n\n            ",1046],["T_FOREACH","foreach",1048],["T_WHITESPACE"," ",1048],"(",["T_VARIABLE","$taxClassAmount",1048],["T_WHITESPACE"," ",1048],["T_AS","as",1048],["T_WHITESPACE"," ",1048],["T_VARIABLE","$key",1048],["T_WHITESPACE"," ",1048],["T_DOUBLE_ARROW","=>",1048],["T_WHITESPACE"," ",1048],["T_VARIABLE","$tax",1048],")",["T_WHITESPACE"," ",1048],"{",["T_WHITESPACE","\n                ",1048],["T_IF","if",1049],["T_WHITESPACE"," ",1049],"(",["T_VARIABLE","$tax",1049],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",1049],"]",["T_WHITESPACE"," ",1049],["T_IS_EQUAL","==",1049],["T_WHITESPACE"," ",1049],["T_LNUMBER","0",1049],["T_WHITESPACE"," ",1049],["T_BOOLEAN_AND","&&",1049],["T_WHITESPACE"," ",1049],["T_VARIABLE","$tax",1049],"[",["T_CONSTANT_ENCAPSED_STRING","'base_tax_amount'",1049],"]",["T_WHITESPACE"," ",1049],["T_IS_EQUAL","==",1049],["T_WHITESPACE"," ",1049],["T_LNUMBER","0",1049],")",["T_WHITESPACE"," ",1049],"{",["T_WHITESPACE","\n                    ",1049],["T_UNSET","unset",1050],"(",["T_VARIABLE","$taxClassAmount",1050],"[",["T_VARIABLE","$key",1050],"]",")",";",["T_WHITESPACE","\n                ",1050],"}",["T_WHITESPACE","\n            ",1051],"}",["T_WHITESPACE","\n\n            ",1052],["T_VARIABLE","$taxClassAmount",1054],["T_WHITESPACE"," ",1054],"=",["T_WHITESPACE"," ",1054],["T_STRING","array_values",1054],"(",["T_VARIABLE","$taxClassAmount",1054],")",";",["T_WHITESPACE","\n        ",1054],"}",["T_WHITESPACE","\n\n        ",1055],["T_RETURN","return",1057],["T_WHITESPACE"," ",1057],["T_VARIABLE","$taxClassAmount",1057],";",["T_WHITESPACE","\n    ",1057],"}",["T_WHITESPACE","\n\n    ",1058],["T_DOC_COMMENT","\/**\n     * Returns the array of tax rates for the order\n     *\n     * @param Mage_Sales_Model_Order $order\n     * @return array\n     *\/",1060],["T_WHITESPACE","\n    ",1065],["T_PROTECTED","protected",1066],["T_WHITESPACE"," ",1066],["T_FUNCTION","function",1066],["T_WHITESPACE"," ",1066],["T_STRING","_getTaxRateSubtotals",1066],"(",["T_VARIABLE","$order",1066],")",["T_WHITESPACE","\n    ",1066],"{",["T_WHITESPACE","\n        ",1067],["T_RETURN","return",1068],["T_WHITESPACE"," ",1068],["T_STRING","Mage",1068],["T_DOUBLE_COLON","::",1068],["T_STRING","getModel",1068],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/sales_order_tax'",1068],")",["T_OBJECT_OPERATOR","->",1068],["T_STRING","getCollection",1068],"(",")",["T_OBJECT_OPERATOR","->",1068],["T_STRING","loadByOrder",1068],"(",["T_VARIABLE","$order",1068],")",["T_OBJECT_OPERATOR","->",1068],["T_STRING","toArray",1068],"(",")",";",["T_WHITESPACE","\n    ",1068],"}",["T_WHITESPACE","\n\n    ",1069],["T_DOC_COMMENT","\/**\n     * Retrieve a value from registry by a key\n     *\n     * @param string $key\n     * @return mixed\n     *\/",1071],["T_WHITESPACE","\n    ",1076],["T_PROTECTED","protected",1077],["T_WHITESPACE"," ",1077],["T_FUNCTION","function",1077],["T_WHITESPACE"," ",1077],["T_STRING","_getFromRegistry",1077],"(",["T_VARIABLE","$key",1077],")",["T_WHITESPACE","\n    ",1077],"{",["T_WHITESPACE","\n        ",1078],["T_RETURN","return",1079],["T_WHITESPACE"," ",1079],["T_STRING","Mage",1079],["T_DOUBLE_COLON","::",1079],["T_STRING","registry",1079],"(",["T_VARIABLE","$key",1079],")",";",["T_WHITESPACE","\n    ",1079],"}",["T_WHITESPACE","\n\n    ",1080],["T_DOC_COMMENT","\/**\n     * Get calculated Shipping & Handling Tax\n     *\n     * This method returns array with format:\n     * array(\n     *  $index => array(\n     *      'tax_amount'        => $taxAmount,\n     *      'base_tax_amount'   => $baseTaxAmount,\n     *      'hidden_tax_amount' => $hiddenTaxAmount\n     *      'title'             => $title\n     *      'percent'           => $percent\n     *  )\n     * )\n     *\n     * @param Mage_Sales_Model_Order $source\n     * @return array\n     *\/",1082],["T_WHITESPACE","\n    ",1098],["T_PUBLIC","public",1099],["T_WHITESPACE"," ",1099],["T_FUNCTION","function",1099],["T_WHITESPACE"," ",1099],["T_STRING","getShippingTax",1099],"(",["T_VARIABLE","$source",1099],")",["T_WHITESPACE","\n    ",1099],"{",["T_WHITESPACE","\n        ",1100],["T_IF","if",1101],["T_WHITESPACE"," ",1101],"(",["T_STRING","Mage",1101],["T_DOUBLE_COLON","::",1101],["T_STRING","registry",1101],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",1101],")",")",["T_WHITESPACE"," ",1101],"{",["T_WHITESPACE","\n            ",1101],["T_VARIABLE","$current",1102],["T_WHITESPACE"," ",1102],"=",["T_WHITESPACE"," ",1102],["T_STRING","Mage",1102],["T_DOUBLE_COLON","::",1102],["T_STRING","registry",1102],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",1102],")",";",["T_WHITESPACE","\n        ",1102],"}",["T_WHITESPACE"," ",1103],["T_ELSEIF","elseif",1103],["T_WHITESPACE"," ",1103],"(",["T_STRING","Mage",1103],["T_DOUBLE_COLON","::",1103],["T_STRING","registry",1103],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",1103],")",")",["T_WHITESPACE"," ",1103],"{",["T_WHITESPACE","\n            ",1103],["T_VARIABLE","$current",1104],["T_WHITESPACE"," ",1104],"=",["T_WHITESPACE"," ",1104],["T_STRING","Mage",1104],["T_DOUBLE_COLON","::",1104],["T_STRING","registry",1104],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",1104],")",";",["T_WHITESPACE","\n        ",1104],"}",["T_WHITESPACE"," ",1105],["T_ELSE","else",1105],["T_WHITESPACE"," ",1105],"{",["T_WHITESPACE","\n            ",1105],["T_VARIABLE","$current",1106],["T_WHITESPACE"," ",1106],"=",["T_WHITESPACE"," ",1106],["T_VARIABLE","$source",1106],";",["T_WHITESPACE","\n        ",1106],"}",["T_WHITESPACE","\n\n        ",1107],["T_VARIABLE","$taxClassAmount",1109],["T_WHITESPACE"," ",1109],"=",["T_WHITESPACE"," ",1109],["T_ARRAY","array",1109],"(",")",";",["T_WHITESPACE","\n        ",1109],["T_IF","if",1110],["T_WHITESPACE"," ",1110],"(",["T_VARIABLE","$current",1110],["T_WHITESPACE"," ",1110],["T_BOOLEAN_AND","&&",1110],["T_WHITESPACE"," ",1110],["T_VARIABLE","$source",1110],")",["T_WHITESPACE"," ",1110],"{",["T_WHITESPACE","\n            ",1110],["T_IF","if",1111],["T_WHITESPACE"," ",1111],"(",["T_VARIABLE","$current",1111],["T_OBJECT_OPERATOR","->",1111],["T_STRING","getShippingTaxAmount",1111],"(",")",["T_WHITESPACE"," ",1111],["T_IS_NOT_EQUAL","!=",1111],["T_WHITESPACE"," ",1111],["T_LNUMBER","0",1111],["T_WHITESPACE"," ",1111],["T_BOOLEAN_AND","&&",1111],["T_WHITESPACE"," ",1111],["T_VARIABLE","$current",1111],["T_OBJECT_OPERATOR","->",1111],["T_STRING","getBaseShippingTaxAmount",1111],"(",")",["T_WHITESPACE"," ",1111],["T_IS_NOT_EQUAL","!=",1111],["T_WHITESPACE"," ",1111],["T_LNUMBER","0",1111],")",["T_WHITESPACE"," ",1111],"{",["T_WHITESPACE","\n                ",1111],["T_VARIABLE","$taxClassAmount",1112],"[",["T_LNUMBER","0",1112],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",1112],"]",["T_WHITESPACE"," ",1112],"=",["T_WHITESPACE"," ",1112],["T_VARIABLE","$current",1112],["T_OBJECT_OPERATOR","->",1112],["T_STRING","getShippingTaxAmount",1112],"(",")",";",["T_WHITESPACE","\n                ",1112],["T_VARIABLE","$taxClassAmount",1113],"[",["T_LNUMBER","0",1113],"]","[",["T_CONSTANT_ENCAPSED_STRING","'base_tax_amount'",1113],"]",["T_WHITESPACE"," ",1113],"=",["T_WHITESPACE"," ",1113],["T_VARIABLE","$current",1113],["T_OBJECT_OPERATOR","->",1113],["T_STRING","getBaseShippingTaxAmount",1113],"(",")",";",["T_WHITESPACE","\n                ",1113],["T_IF","if",1114],["T_WHITESPACE"," ",1114],"(",["T_VARIABLE","$current",1114],["T_OBJECT_OPERATOR","->",1114],["T_STRING","getShippingHiddenTaxAmount",1114],"(",")",["T_WHITESPACE"," ",1114],">",["T_WHITESPACE"," ",1114],["T_LNUMBER","0",1114],")",["T_WHITESPACE"," ",1114],"{",["T_WHITESPACE","\n                    ",1114],["T_VARIABLE","$taxClassAmount",1115],"[",["T_LNUMBER","0",1115],"]","[",["T_CONSTANT_ENCAPSED_STRING","'hidden_tax_amount'",1115],"]",["T_WHITESPACE"," ",1115],"=",["T_WHITESPACE"," ",1115],["T_VARIABLE","$current",1115],["T_OBJECT_OPERATOR","->",1115],["T_STRING","getShippingHiddenTaxAmount",1115],"(",")",";",["T_WHITESPACE","\n                ",1115],"}",["T_WHITESPACE","\n                ",1116],["T_VARIABLE","$taxClassAmount",1117],"[",["T_LNUMBER","0",1117],"]","[",["T_CONSTANT_ENCAPSED_STRING","'title'",1117],"]",["T_WHITESPACE"," ",1117],"=",["T_WHITESPACE"," ",1117],["T_VARIABLE","$this",1117],["T_OBJECT_OPERATOR","->",1117],["T_STRING","__",1117],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping & Handling Tax'",1117],")",";",["T_WHITESPACE","\n                ",1117],["T_VARIABLE","$taxClassAmount",1118],"[",["T_LNUMBER","0",1118],"]","[",["T_CONSTANT_ENCAPSED_STRING","'percent'",1118],"]",["T_WHITESPACE"," ",1118],"=",["T_WHITESPACE"," ",1118],["T_STRING","NULL",1118],";",["T_WHITESPACE","\n            ",1118],"}",["T_WHITESPACE","\n        ",1119],"}",["T_WHITESPACE","\n\n        ",1120],["T_RETURN","return",1122],["T_WHITESPACE"," ",1122],["T_VARIABLE","$taxClassAmount",1122],";",["T_WHITESPACE","\n    ",1122],"}",["T_WHITESPACE","\n\n    ",1123],["T_DOC_COMMENT","\/**\n     * Get all FPTs\n     *\n     * @return array\n     *\/",1125],["T_WHITESPACE","\n    ",1129],["T_PUBLIC","public",1130],["T_WHITESPACE"," ",1130],["T_FUNCTION","function",1130],["T_WHITESPACE"," ",1130],["T_STRING","getAllWeee",1130],"(",["T_VARIABLE","$source",1130],["T_WHITESPACE"," ",1130],"=",["T_WHITESPACE"," ",1130],["T_STRING","null",1130],")",["T_WHITESPACE","\n    ",1130],"{",["T_WHITESPACE","\n        ",1131],["T_VARIABLE","$allWeee",1132],["T_WHITESPACE"," ",1132],"=",["T_WHITESPACE"," ",1132],["T_ARRAY","array",1132],"(",")",";",["T_WHITESPACE","\n        ",1132],["T_VARIABLE","$store",1133],["T_WHITESPACE"," ",1133],"=",["T_WHITESPACE"," ",1133],["T_VARIABLE","$this",1133],["T_OBJECT_OPERATOR","->",1133],["T_STRING","_app",1133],["T_OBJECT_OPERATOR","->",1133],["T_STRING","getStore",1133],"(",")",";",["T_WHITESPACE","\n\n        ",1133],["T_IF","if",1135],["T_WHITESPACE"," ",1135],"(",["T_STRING","Mage",1135],["T_DOUBLE_COLON","::",1135],["T_STRING","registry",1135],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",1135],")",")",["T_WHITESPACE"," ",1135],"{",["T_WHITESPACE","\n            ",1135],["T_VARIABLE","$source",1136],["T_WHITESPACE"," ",1136],"=",["T_WHITESPACE"," ",1136],["T_STRING","Mage",1136],["T_DOUBLE_COLON","::",1136],["T_STRING","registry",1136],"(",["T_CONSTANT_ENCAPSED_STRING","'current_invoice'",1136],")",";",["T_WHITESPACE","\n        ",1136],"}",["T_WHITESPACE"," ",1137],["T_ELSEIF","elseif",1137],["T_WHITESPACE"," ",1137],"(",["T_STRING","Mage",1137],["T_DOUBLE_COLON","::",1137],["T_STRING","registry",1137],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",1137],")",")",["T_WHITESPACE"," ",1137],"{",["T_WHITESPACE","\n            ",1137],["T_VARIABLE","$source",1138],["T_WHITESPACE"," ",1138],"=",["T_WHITESPACE"," ",1138],["T_STRING","Mage",1138],["T_DOUBLE_COLON","::",1138],["T_STRING","registry",1138],"(",["T_CONSTANT_ENCAPSED_STRING","'current_creditmemo'",1138],")",";",["T_WHITESPACE","\n        ",1138],"}",["T_WHITESPACE"," ",1139],["T_ELSEIF","elseif",1139],["T_WHITESPACE"," ",1139],"(",["T_VARIABLE","$source",1139],["T_WHITESPACE"," ",1139],["T_IS_EQUAL","==",1139],["T_WHITESPACE"," ",1139],["T_STRING","null",1139],")",["T_WHITESPACE"," ",1139],"{",["T_WHITESPACE","\n            ",1139],["T_VARIABLE","$source",1140],["T_WHITESPACE"," ",1140],"=",["T_WHITESPACE"," ",1140],["T_VARIABLE","$this",1140],["T_OBJECT_OPERATOR","->",1140],["T_STRING","_app",1140],["T_OBJECT_OPERATOR","->",1140],["T_STRING","getOrder",1140],"(",")",";",["T_WHITESPACE","\n        ",1140],"}",["T_WHITESPACE","\n\n        ",1141],["T_VARIABLE","$helper",1143],["T_WHITESPACE"," ",1143],"=",["T_WHITESPACE"," ",1143],["T_STRING","Mage",1143],["T_DOUBLE_COLON","::",1143],["T_STRING","helper",1143],"(",["T_CONSTANT_ENCAPSED_STRING","'weee'",1143],")",";",["T_WHITESPACE","\n        ",1143],["T_IF","if",1144],["T_WHITESPACE"," ",1144],"(","!",["T_VARIABLE","$helper",1144],["T_OBJECT_OPERATOR","->",1144],["T_STRING","includeInSubtotal",1144],"(",["T_VARIABLE","$store",1144],")",")",["T_WHITESPACE"," ",1144],"{",["T_WHITESPACE","\n            ",1144],["T_FOREACH","foreach",1145],["T_WHITESPACE"," ",1145],"(",["T_VARIABLE","$source",1145],["T_OBJECT_OPERATOR","->",1145],["T_STRING","getAllItems",1145],"(",")",["T_WHITESPACE"," ",1145],["T_AS","as",1145],["T_WHITESPACE"," ",1145],["T_VARIABLE","$item",1145],")",["T_WHITESPACE"," ",1145],"{",["T_WHITESPACE","\n                ",1145],["T_FOREACH","foreach",1146],["T_WHITESPACE"," ",1146],"(",["T_VARIABLE","$helper",1146],["T_OBJECT_OPERATOR","->",1146],["T_STRING","getApplied",1146],"(",["T_VARIABLE","$item",1146],")",["T_WHITESPACE"," ",1146],["T_AS","as",1146],["T_WHITESPACE"," ",1146],["T_VARIABLE","$tax",1146],")",["T_WHITESPACE"," ",1146],"{",["T_WHITESPACE","\n                    ",1146],["T_VARIABLE","$weeeDiscount",1147],["T_WHITESPACE"," ",1147],"=",["T_WHITESPACE"," ",1147],["T_ISSET","isset",1147],"(",["T_VARIABLE","$tax",1147],"[",["T_CONSTANT_ENCAPSED_STRING","'weee_discount'",1147],"]",")",["T_WHITESPACE"," ",1147],"?",["T_WHITESPACE"," ",1147],["T_VARIABLE","$tax",1147],"[",["T_CONSTANT_ENCAPSED_STRING","'weee_discount'",1147],"]",["T_WHITESPACE"," ",1147],":",["T_WHITESPACE"," ",1147],["T_LNUMBER","0",1147],";",["T_WHITESPACE","\n                    ",1147],["T_VARIABLE","$title",1148],["T_WHITESPACE"," ",1148],"=",["T_WHITESPACE"," ",1148],["T_VARIABLE","$tax",1148],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",1148],"]",";",["T_WHITESPACE","\n\n                    ",1148],["T_VARIABLE","$rowAmount",1150],["T_WHITESPACE"," ",1150],"=",["T_WHITESPACE"," ",1150],["T_ISSET","isset",1150],"(",["T_VARIABLE","$tax",1150],"[",["T_CONSTANT_ENCAPSED_STRING","'row_amount'",1150],"]",")",["T_WHITESPACE"," ",1150],"?",["T_WHITESPACE"," ",1150],["T_VARIABLE","$tax",1150],"[",["T_CONSTANT_ENCAPSED_STRING","'row_amount'",1150],"]",["T_WHITESPACE"," ",1150],":",["T_WHITESPACE"," ",1150],["T_LNUMBER","0",1150],";",["T_WHITESPACE","\n                    ",1150],["T_VARIABLE","$rowAmountInclTax",1151],["T_WHITESPACE"," ",1151],"=",["T_WHITESPACE"," ",1151],["T_ISSET","isset",1151],"(",["T_VARIABLE","$tax",1151],"[",["T_CONSTANT_ENCAPSED_STRING","'row_amount_incl_tax'",1151],"]",")",["T_WHITESPACE"," ",1151],"?",["T_WHITESPACE"," ",1151],["T_VARIABLE","$tax",1151],"[",["T_CONSTANT_ENCAPSED_STRING","'row_amount_incl_tax'",1151],"]",["T_WHITESPACE"," ",1151],":",["T_WHITESPACE"," ",1151],["T_LNUMBER","0",1151],";",["T_WHITESPACE","\n                    ",1151],["T_VARIABLE","$amountDisplayed",1152],["T_WHITESPACE"," ",1152],"=",["T_WHITESPACE"," ",1152],"(",["T_VARIABLE","$helper",1152],["T_OBJECT_OPERATOR","->",1152],["T_STRING","isTaxIncluded",1152],"(",")",")",["T_WHITESPACE"," ",1152],"?",["T_WHITESPACE"," ",1152],["T_VARIABLE","$rowAmountInclTax",1152],["T_WHITESPACE"," ",1152],":",["T_WHITESPACE"," ",1152],["T_VARIABLE","$rowAmount",1152],";",["T_WHITESPACE","\n\n                    ",1152],["T_IF","if",1154],["T_WHITESPACE"," ",1154],"(",["T_STRING","array_key_exists",1154],"(",["T_VARIABLE","$title",1154],",",["T_WHITESPACE"," ",1154],["T_VARIABLE","$allWeee",1154],")",")",["T_WHITESPACE"," ",1154],"{",["T_WHITESPACE","\n                        ",1154],["T_VARIABLE","$allWeee",1155],"[",["T_VARIABLE","$title",1155],"]",["T_WHITESPACE"," ",1155],"=",["T_WHITESPACE"," ",1155],["T_VARIABLE","$allWeee",1155],"[",["T_VARIABLE","$title",1155],"]",["T_WHITESPACE"," ",1155],"+",["T_WHITESPACE"," ",1155],["T_VARIABLE","$amountDisplayed",1155],["T_WHITESPACE"," ",1155],"-",["T_WHITESPACE"," ",1155],["T_VARIABLE","$weeeDiscount",1155],";",["T_WHITESPACE","\n                    ",1155],"}",["T_WHITESPACE"," ",1156],["T_ELSE","else",1156],["T_WHITESPACE"," ",1156],"{",["T_WHITESPACE","\n                        ",1156],["T_VARIABLE","$allWeee",1157],"[",["T_VARIABLE","$title",1157],"]",["T_WHITESPACE"," ",1157],"=",["T_WHITESPACE"," ",1157],["T_VARIABLE","$amountDisplayed",1157],["T_WHITESPACE"," ",1157],"-",["T_WHITESPACE"," ",1157],["T_VARIABLE","$weeeDiscount",1157],";",["T_WHITESPACE","\n                    ",1157],"}",["T_WHITESPACE","\n                ",1158],"}",["T_WHITESPACE","\n            ",1159],"}",["T_WHITESPACE","\n        ",1160],"}",["T_WHITESPACE","\n\n        ",1161],["T_RETURN","return",1163],["T_WHITESPACE"," ",1163],["T_VARIABLE","$allWeee",1163],";",["T_WHITESPACE","\n    ",1163],"}",["T_WHITESPACE","\n\n    ",1164],["T_DOC_COMMENT","\/**\n     * Check if do not show notification about wrong display settings\n     *\n     * @return bool\n     *\/",1166],["T_WHITESPACE","\n    ",1170],["T_PUBLIC","public",1171],["T_WHITESPACE"," ",1171],["T_FUNCTION","function",1171],["T_WHITESPACE"," ",1171],["T_STRING","isWrongDisplaySettingsIgnored",1171],"(",")",["T_WHITESPACE","\n    ",1171],"{",["T_WHITESPACE","\n        ",1172],["T_RETURN","return",1173],["T_WHITESPACE"," ",1173],["T_BOOL_CAST","(bool)",1173],["T_VARIABLE","$this",1173],["T_OBJECT_OPERATOR","->",1173],["T_STRING","_app",1173],["T_OBJECT_OPERATOR","->",1173],["T_STRING","getStore",1173],"(",")",["T_OBJECT_OPERATOR","->",1173],["T_STRING","getConfig",1173],"(",["T_STRING","Mage_Tax_Model_Config",1173],["T_DOUBLE_COLON","::",1173],["T_STRING","XML_PATH_TAX_NOTIFICATION_PRICE_DISPLAY",1173],")",";",["T_WHITESPACE","\n    ",1173],"}",["T_WHITESPACE","\n\n    ",1174],["T_DOC_COMMENT","\/**\n     * Check if do not show notification about wrong discount settings\n     *\n     * @return bool\n     *\/",1176],["T_WHITESPACE","\n    ",1180],["T_PUBLIC","public",1181],["T_WHITESPACE"," ",1181],["T_FUNCTION","function",1181],["T_WHITESPACE"," ",1181],["T_STRING","isWrongDiscountSettingsIgnored",1181],"(",")",["T_WHITESPACE","\n    ",1181],"{",["T_WHITESPACE","\n        ",1182],["T_RETURN","return",1183],["T_WHITESPACE"," ",1183],["T_BOOL_CAST","(bool)",1183],["T_VARIABLE","$this",1183],["T_OBJECT_OPERATOR","->",1183],["T_STRING","_app",1183],["T_OBJECT_OPERATOR","->",1183],["T_STRING","getStore",1183],"(",")",["T_OBJECT_OPERATOR","->",1183],["T_STRING","getConfig",1183],"(",["T_STRING","Mage_Tax_Model_Config",1183],["T_DOUBLE_COLON","::",1183],["T_STRING","XML_PATH_TAX_NOTIFICATION_DISCOUNT",1183],")",";",["T_WHITESPACE","\n    ",1183],"}",["T_WHITESPACE","\n\n    ",1184],["T_DOC_COMMENT","\/**\n     * Check if warning about conflicting FPT configuration should be shown\n     *\n     * @return bool\n     *\/",1186],["T_WHITESPACE","\n    ",1190],["T_PUBLIC","public",1191],["T_WHITESPACE"," ",1191],["T_FUNCTION","function",1191],["T_WHITESPACE"," ",1191],["T_STRING","isConflictingFptTaxConfigurationSettingsIgnored",1191],"(",")",["T_WHITESPACE","\n    ",1191],"{",["T_WHITESPACE","\n        ",1192],["T_RETURN","return",1193],["T_WHITESPACE"," ",1193],["T_BOOL_CAST","(bool)",1193],["T_WHITESPACE"," ",1193],["T_VARIABLE","$this",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","_app",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","getStore",1193],"(",")",["T_WHITESPACE","\n            ",1193],["T_OBJECT_OPERATOR","->",1194],["T_STRING","getConfig",1194],"(",["T_STRING","Mage_Tax_Model_Config",1194],["T_DOUBLE_COLON","::",1194],["T_STRING","XML_PATH_TAX_NOTIFICATION_FPT_CONFIGURATION",1194],")",";",["T_WHITESPACE","\n    ",1194],"}",["T_WHITESPACE","\n\n    ",1195],["T_DOC_COMMENT","\/**\n     * Return whether cross border trade is enabled or not\n     *\n     * @param   null|int $store\n     * @return boolean\n     *\/",1197],["T_WHITESPACE","\n    ",1202],["T_PUBLIC","public",1203],["T_WHITESPACE"," ",1203],["T_FUNCTION","function",1203],["T_WHITESPACE"," ",1203],["T_STRING","isCrossBorderTradeEnabled",1203],"(",["T_VARIABLE","$store",1203],["T_WHITESPACE"," ",1203],"=",["T_WHITESPACE"," ",1203],["T_STRING","null",1203],")",["T_WHITESPACE","\n    ",1203],"{",["T_WHITESPACE","\n        ",1204],["T_RETURN","return",1205],["T_WHITESPACE"," ",1205],["T_BOOL_CAST","(bool)",1205],["T_VARIABLE","$this",1205],["T_OBJECT_OPERATOR","->",1205],["T_STRING","_config",1205],["T_OBJECT_OPERATOR","->",1205],["T_STRING","crossBorderTradeEnabled",1205],"(",["T_VARIABLE","$store",1205],")",";",["T_WHITESPACE","\n    ",1205],"}",["T_WHITESPACE","\n",1206],"}",["T_WHITESPACE","\n",1207]]