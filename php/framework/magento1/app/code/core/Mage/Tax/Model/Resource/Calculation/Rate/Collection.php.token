[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tax\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Tax rate collection\n *\n * @category    Mage\n * @package     Mage_Tax\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Tax_Model_Resource_Calculation_Rate_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Collection_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Value of fetched from DB of rules per cycle\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","TAX_RULES_CHUNK_SIZE",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_LNUMBER","1000",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Resource initialization\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","_construct",45],"(",")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_init",47],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation_rate'",47],")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Join country table to result\n     *\n     * @return Mage_Tax_Model_Resource_Calculation_Rate_Collection\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","joinCountryTable",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_select",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","join",57],"(",["T_WHITESPACE","\n            ",57],["T_ARRAY","array",58],"(",["T_CONSTANT_ENCAPSED_STRING","'country_table'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getTable",58],"(",["T_CONSTANT_ENCAPSED_STRING","'directory\/country'",58],")",")",",",["T_WHITESPACE","\n            ",58],["T_CONSTANT_ENCAPSED_STRING","'main_table.tax_country_id = country_table.country_id'",59],",",["T_WHITESPACE","\n            ",59],["T_ARRAY","array",60],"(",["T_CONSTANT_ENCAPSED_STRING","'country_name'",60],["T_WHITESPACE"," ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'iso2_code'",60],")",["T_WHITESPACE","\n        ",60],")",";",["T_WHITESPACE","\n\n        ",61],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],";",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * Join Region Table\n     *\n     * @return Mage_Tax_Model_Resource_Calculation_Rate_Collection\n     *\/",66],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","joinRegionTable",71],"(",")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_select",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","joinLeft",73],"(",["T_WHITESPACE","\n            ",73],["T_ARRAY","array",74],"(",["T_CONSTANT_ENCAPSED_STRING","'region_table'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getTable",74],"(",["T_CONSTANT_ENCAPSED_STRING","'directory\/country_region'",74],")",")",",",["T_WHITESPACE","\n            ",74],["T_CONSTANT_ENCAPSED_STRING","'main_table.tax_region_id = region_table.region_id'",75],",",["T_WHITESPACE","\n            ",75],["T_ARRAY","array",76],"(",["T_CONSTANT_ENCAPSED_STRING","'region_name'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'code'",76],")",["T_WHITESPACE","\n        ",76],")",";",["T_WHITESPACE","\n        ",77],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Join rate title for specified store\n     *\n     * @param Mage_Core_Model_Store|string|int $store\n     * @return Mage_Tax_Model_Resource_Calculation_Rate_Collection\n     *\/",81],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","joinTitle",87],"(",["T_VARIABLE","$store",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","null",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$storeId",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_INT_CAST","(int)",89],["T_STRING","Mage",89],["T_DOUBLE_COLON","::",89],["T_STRING","app",89],"(",")",["T_OBJECT_OPERATOR","->",89],["T_STRING","getStore",89],"(",["T_VARIABLE","$store",89],")",["T_OBJECT_OPERATOR","->",89],["T_STRING","getId",89],"(",")",";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_select",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","joinLeft",90],"(",["T_WHITESPACE","\n            ",90],["T_ARRAY","array",91],"(",["T_CONSTANT_ENCAPSED_STRING","'title_table'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getTable",91],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/tax_calculation_rate_title'",91],")",")",",",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getConnection",92],"(",")",["T_OBJECT_OPERATOR","->",92],["T_STRING","quoteInto",92],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.tax_calculation_rate_id = title_table.tax_calculation_rate_id'",92],["T_WHITESPACE","\n                ",92],".",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","' AND title_table.store_id = ?'",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$storeId",93],")",",",["T_WHITESPACE","\n            ",93],["T_ARRAY","array",94],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","'value'",94],")",["T_WHITESPACE","\n        ",94],")",";",["T_WHITESPACE","\n\n        ",95],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Joins store titles for rates\n     *\n     * @return Mage_Tax_Model_Resource_Calculation_Rate_Collection\n     *\/",100],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","joinStoreTitles",105],"(",")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$storeCollection",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE","  ",107],["T_STRING","Mage",107],["T_DOUBLE_COLON","::",107],["T_STRING","app",107],"(",")",["T_OBJECT_OPERATOR","->",107],["T_STRING","getStores",107],"(",["T_STRING","true",107],")",";",["T_WHITESPACE","\n        ",107],["T_FOREACH","foreach",108],["T_WHITESPACE"," ",108],"(",["T_VARIABLE","$storeCollection",108],["T_WHITESPACE"," ",108],["T_AS","as",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$store",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$tableAlias",109],["T_WHITESPACE","    ",109],"=",["T_WHITESPACE"," ",109],["T_STRING","sprintf",109],"(",["T_CONSTANT_ENCAPSED_STRING","'title_table_%s'",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$store",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getId",109],"(",")",")",";",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$joinCondition",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_STRING","implode",110],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",110],",",["T_WHITESPACE"," ",110],["T_ARRAY","array",110],"(",["T_WHITESPACE","\n                ",110],"\"",["T_ENCAPSED_AND_WHITESPACE","main_table.tax_calculation_rate_id = ",111],["T_CURLY_OPEN","{",111],["T_VARIABLE","$tableAlias",111],"}",["T_ENCAPSED_AND_WHITESPACE",".tax_calculation_rate_id",111],"\"",",",["T_WHITESPACE","\n                ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getConnection",112],"(",")",["T_OBJECT_OPERATOR","->",112],["T_STRING","quoteInto",112],"(",["T_VARIABLE","$tableAlias",112],["T_WHITESPACE"," ",112],".",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'.store_id = ?'",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$store",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getId",112],"(",")",")",["T_WHITESPACE","\n            ",112],")",")",";",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_select",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","joinLeft",114],"(",["T_WHITESPACE","\n                ",114],["T_ARRAY","array",115],"(",["T_VARIABLE","$tableAlias",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getTable",115],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/tax_calculation_rate_title'",115],")",")",",",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$joinCondition",116],",",["T_WHITESPACE","\n                ",116],["T_ARRAY","array",117],"(",["T_VARIABLE","$tableAlias",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'value'",117],")",["T_WHITESPACE","\n            ",117],")",";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE","\n        ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Add rate filter\n     *\n     * @param int $rateId\n     * @return Mage_Tax_Model_Resource_Calculation_Rate_Collection\n     *\/",123],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","addRateFilter",129],"(",["T_VARIABLE","$rateId",129],")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_IF","if",131],["T_WHITESPACE"," ",131],"(",["T_STRING","is_int",131],"(",["T_VARIABLE","$rateId",131],")",["T_WHITESPACE"," ",131],["T_BOOLEAN_AND","&&",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$rateId",131],["T_WHITESPACE"," ",131],">",["T_WHITESPACE"," ",131],["T_LNUMBER","0",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_RETURN","return",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","addFieldToFilter",132],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.tax_rate_id'",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$rateId",132],")",";",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE","\n\n        ",133],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Retrieve option array\n     *\n     * @return array\n     *\/",138],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","toOptionArray",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_toOptionArray",145],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rate_id'",145],",",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'code'",145],")",";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Retrieve option hash\n     *\n     * @return array\n     *\/",148],["T_WHITESPACE","\n    ",152],["T_PUBLIC","public",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","toOptionHash",153],"(",")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_toOptionHash",155],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rate_id'",155],",",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'code'",155],")",";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Convert items array to hash for select options\n     * unsing fetchItem method\n     *\n     * @see     _toOptionHashOptimized()\n     *\n     * @return  array\n     *\/",158],["T_WHITESPACE","\n    ",165],["T_PUBLIC","public",166],["T_WHITESPACE"," ",166],["T_FUNCTION","function",166],["T_WHITESPACE"," ",166],["T_STRING","toOptionHashOptimized",166],"(",")",["T_WHITESPACE","\n    ",166],"{",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_toOptionHashOptimized",168],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rate_id'",168],",",["T_WHITESPACE"," ",168],["T_CONSTANT_ENCAPSED_STRING","'code'",168],")",";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Get rates array without memory leak\n     *\n     * @return array\n     *\/",171],["T_WHITESPACE","\n    ",175],["T_PUBLIC","public",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","getOptionRates",176],"(",")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$size",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_STRING","self",178],["T_DOUBLE_COLON","::",178],["T_STRING","TAX_RULES_CHUNK_SIZE",178],";",["T_WHITESPACE","\n        ",178],["T_VARIABLE","$page",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_LNUMBER","1",179],";",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$rates",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_ARRAY","array",180],"(",")",";",["T_WHITESPACE","\n        ",180],["T_DO","do",181],["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n            ",181],["T_VARIABLE","$offset",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$size",182],["T_WHITESPACE"," ",182],"*",["T_WHITESPACE"," ",182],"(",["T_VARIABLE","$page",182],["T_WHITESPACE"," ",182],"-",["T_WHITESPACE"," ",182],["T_LNUMBER","1",182],")",";",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getSelect",183],"(",")",["T_OBJECT_OPERATOR","->",183],["T_STRING","reset",183],"(",")",";",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getSelect",184],"(",")",["T_WHITESPACE","\n                ",184],["T_OBJECT_OPERATOR","->",185],["T_STRING","from",185],"(",["T_WHITESPACE","\n                    ",185],["T_ARRAY","array",186],"(",["T_CONSTANT_ENCAPSED_STRING","'rates'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getMainTable",186],"(",")",")",",",["T_WHITESPACE","\n                ",186],["T_ARRAY","array",187],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rate_id'",187],",",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'code'",187],")",")",["T_WHITESPACE","\n                ",187],["T_OBJECT_OPERATOR","->",188],["T_STRING","limit",188],"(",["T_VARIABLE","$size",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$offset",188],")",";",["T_WHITESPACE","\n\n            ",188],["T_VARIABLE","$rates",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_STRING","array_merge",190],"(",["T_VARIABLE","$rates",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","toOptionArray",190],"(",")",")",";",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","clear",191],"(",")",";",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$page",192],["T_INC","++",192],";",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE"," ",193],["T_WHILE","while",193],["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getSize",193],"(",")",["T_WHITESPACE"," ",193],">",["T_WHITESPACE"," ",193],["T_VARIABLE","$offset",193],")",";",["T_WHITESPACE","\n\n        ",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$rates",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n",196],"}",["T_WHITESPACE","\n",197]]