[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tax\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Tax Calculation Model\n *\n * @author Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Tax_Model_Calculation",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Core_Model_Abstract",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_COMMENT","\/*\n     * Identifier constant for Tax calculation before discount excluding TAX\n     *\/",34],["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","CALC_TAX_BEFORE_DISCOUNT_ON_EXCL",37],["T_WHITESPACE","      ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'0_0'",37],";",["T_WHITESPACE","\n    ",37],["T_COMMENT","\/***\/",38],["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Identifier constant for Tax calculation before discount including TAX\n     *\/",40],["T_WHITESPACE","\n    ",42],["T_CONST","const",43],["T_WHITESPACE"," ",43],["T_STRING","CALC_TAX_BEFORE_DISCOUNT_ON_INCL",43],["T_WHITESPACE","      ",43],"=",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'0_1'",43],";",["T_WHITESPACE","\n\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Identifier constant for Tax calculation after discount excluding TAX\n     *\/",46],["T_WHITESPACE","\n    ",48],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","CALC_TAX_AFTER_DISCOUNT_ON_EXCL",49],["T_WHITESPACE","       ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'1_0'",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Identifier constant for Tax calculation after discount including TAX\n     *\/",51],["T_WHITESPACE","\n    ",53],["T_CONST","const",54],["T_WHITESPACE"," ",54],["T_STRING","CALC_TAX_AFTER_DISCOUNT_ON_INCL",54],["T_WHITESPACE","       ",54],"=",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'1_1'",54],";",["T_WHITESPACE","\n\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Identifier constant for unit based calculation\n     *\/",57],["T_WHITESPACE","\n    ",59],["T_PROTECTED","protected",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$_rates",60],["T_WHITESPACE","                           ",60],"=",["T_WHITESPACE"," ",60],["T_ARRAY","array",60],"(",")",";",["T_WHITESPACE","\n    ",60],["T_DOC_COMMENT","\/**\n     * Identifier constant for row based calculation\n     *\/",61],["T_WHITESPACE","\n    ",63],["T_PROTECTED","protected",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$_ctc",64],["T_WHITESPACE","                             ",64],"=",["T_WHITESPACE"," ",64],["T_ARRAY","array",64],"(",")",";",["T_WHITESPACE","\n    ",64],["T_DOC_COMMENT","\/**\n     * Identifier constant for total based calculation\n     *\/",65],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$_ptc",68],["T_WHITESPACE","                             ",68],"=",["T_WHITESPACE"," ",68],["T_ARRAY","array",68],"(",")",";",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * CALC_UNIT_BASE\n     *\/",70],["T_WHITESPACE","\n    ",72],["T_CONST","const",73],["T_WHITESPACE"," ",73],["T_STRING","CALC_UNIT_BASE",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'UNIT_BASE_CALCULATION'",73],";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * CALC_ROW_BASE\n     *\/",75],["T_WHITESPACE","\n    ",77],["T_CONST","const",78],["T_WHITESPACE"," ",78],["T_STRING","CALC_ROW_BASE",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'ROW_BASE_CALCULATION'",78],";",["T_WHITESPACE","\n\n    ",78],["T_DOC_COMMENT","\/**\n     * CALC_TOTAL_BASE\n     *\/",80],["T_WHITESPACE","\n    ",82],["T_CONST","const",83],["T_WHITESPACE"," ",83],["T_STRING","CALC_TOTAL_BASE",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'TOTAL_BASE_CALCULATION'",83],";",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Cache to hold the rates\n     *\n     * @var array\n     *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$_rateCache",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_ARRAY","array",90],"(",")",";",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Store the rate calculation process\n     *\n     * @var array\n     *\/",92],["T_WHITESPACE","\n    ",96],["T_PROTECTED","protected",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$_rateCalculationProcess",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_ARRAY","array",97],"(",")",";",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Hold the customer\n     *\n     * @var Mage_Customer_Model_Customer\n     *\/",99],["T_WHITESPACE","\n    ",103],["T_PROTECTED","protected",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$_customer",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_STRING","null",104],";",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Customer group\n     *\n     * @var string\n     *\/",106],["T_WHITESPACE","\n    ",110],["T_PROTECTED","protected",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$_defaultCustomerTaxClass",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","null",111],";",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Tax helper\n     *\n     * @var Mage_Tax_Helper_Data\n     *\/",113],["T_WHITESPACE","\n    ",117],["T_PROTECTED","protected",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$_taxHelper",118],";",["T_WHITESPACE","\n\n    ",118],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\/",120],["T_WHITESPACE","\n    ",122],["T_PROTECTED","protected",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","_construct",123],"(",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_init",125],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",125],")",";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Initialize tax helper\n     *\n     * @param array $args\n     *\/",128],["T_WHITESPACE","\n    ",132],["T_PUBLIC","public",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","__construct",133],"(",["T_ARRAY","array",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$args",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_ARRAY","array",133],"(",")",")",["T_WHITESPACE","\n    ",133],"{",["T_WHITESPACE","\n        ",134],["T_STRING","parent",135],["T_DOUBLE_COLON","::",135],["T_STRING","__construct",135],"(",")",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_taxHelper",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],"!",["T_EMPTY","empty",136],"(",["T_VARIABLE","$args",136],"[",["T_CONSTANT_ENCAPSED_STRING","'helper'",136],"]",")",["T_WHITESPACE"," ",136],"?",["T_WHITESPACE"," ",136],["T_VARIABLE","$args",136],"[",["T_CONSTANT_ENCAPSED_STRING","'helper'",136],"]",["T_WHITESPACE"," ",136],":",["T_WHITESPACE"," ",136],["T_STRING","Mage",136],["T_DOUBLE_COLON","::",136],["T_STRING","helper",136],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",136],")",";",["T_WHITESPACE","\n    ",136],"}",["T_WHITESPACE","\n\n    ",137],["T_DOC_COMMENT","\/**\n     * Specify customer object which can be used for rate calculation\n     *\n     * @param   Mage_Customer_Model_Customer $customer\n     * @return  Mage_Tax_Model_Calculation\n     *\/",139],["T_WHITESPACE","\n    ",144],["T_PUBLIC","public",145],["T_WHITESPACE"," ",145],["T_FUNCTION","function",145],["T_WHITESPACE"," ",145],["T_STRING","setCustomer",145],"(",["T_STRING","Mage_Customer_Model_Customer",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$customer",145],")",["T_WHITESPACE","\n    ",145],"{",["T_WHITESPACE","\n        ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_customer",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$customer",147],";",["T_WHITESPACE","\n        ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Get the customer default customer class\n     *\n     * @param null|Mage_Core_Model_Store $store\n     * @return string\n     *\/",151],["T_WHITESPACE","\n    ",156],["T_PUBLIC","public",157],["T_WHITESPACE"," ",157],["T_FUNCTION","function",157],["T_WHITESPACE"," ",157],["T_STRING","getDefaultCustomerTaxClass",157],"(",["T_VARIABLE","$store",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_STRING","null",157],")",["T_WHITESPACE","\n    ",157],"{",["T_WHITESPACE","\n        ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_defaultCustomerTaxClass",159],["T_WHITESPACE"," ",159],["T_IS_IDENTICAL","===",159],["T_WHITESPACE"," ",159],["T_STRING","null",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_VARIABLE","$defaultCustomerGroup",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","Mage",160],["T_DOUBLE_COLON","::",160],["T_STRING","helper",160],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",160],")",["T_OBJECT_OPERATOR","->",160],["T_STRING","getDefaultCustomerGroupId",160],"(",["T_VARIABLE","$store",160],")",";",["T_WHITESPACE","\n            ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_defaultCustomerTaxClass",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_STRING","Mage",161],["T_DOUBLE_COLON","::",161],["T_STRING","getModel",161],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/group'",161],")",["T_OBJECT_OPERATOR","->",161],["T_STRING","getTaxClassId",161],"(",["T_VARIABLE","$defaultCustomerGroup",161],")",";",["T_WHITESPACE","\n        ",161],"}",["T_WHITESPACE","\n        ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_defaultCustomerTaxClass",163],";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Get customer object\n     *\n     * @return  Mage_Customer_Model_Customer | false\n     *\/",166],["T_WHITESPACE","\n    ",170],["T_PUBLIC","public",171],["T_WHITESPACE"," ",171],["T_FUNCTION","function",171],["T_WHITESPACE"," ",171],["T_STRING","getCustomer",171],"(",")",["T_WHITESPACE","\n    ",171],"{",["T_WHITESPACE","\n        ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_customer",173],["T_WHITESPACE"," ",173],["T_IS_IDENTICAL","===",173],["T_WHITESPACE"," ",173],["T_STRING","null",173],")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_VARIABLE","$session",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_STRING","Mage",174],["T_DOUBLE_COLON","::",174],["T_STRING","getSingleton",174],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",174],")",";",["T_WHITESPACE","\n            ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_VARIABLE","$session",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","isLoggedIn",175],"(",")",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_customer",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$session",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getCustomer",176],"(",")",";",["T_WHITESPACE","\n            ",176],"}",["T_WHITESPACE"," ",177],["T_ELSEIF","elseif",177],["T_WHITESPACE"," ",177],"(",["T_VARIABLE","$session",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getCustomerId",177],"(",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_customer",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_STRING","Mage",178],["T_DOUBLE_COLON","::",178],["T_STRING","getModel",178],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",178],")",["T_OBJECT_OPERATOR","->",178],["T_STRING","load",178],"(",["T_VARIABLE","$session",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getCustomerId",178],"(",")",")",";",["T_WHITESPACE","\n            ",178],"}",["T_WHITESPACE"," ",179],["T_ELSE","else",179],["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_customer",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","false",180],";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n        ",182],["T_RETURN","return",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","_customer",183],";",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n\n    ",184],["T_DOC_COMMENT","\/**\n     * Delete calculation settings by rule id\n     *\n     * @param   int $ruleId\n     * @return  Mage_Tax_Model_Calculation\n     *\/",186],["T_WHITESPACE","\n    ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","deleteByRuleId",192],"(",["T_VARIABLE","$ruleId",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_getResource",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","deleteByRuleId",194],"(",["T_VARIABLE","$ruleId",194],")",";",["T_WHITESPACE","\n        ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Get calculation rates by rule id\n     *\n     * @param   int $ruleId\n     * @return  array\n     *\/",198],["T_WHITESPACE","\n    ",203],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","getRates",204],"(",["T_VARIABLE","$ruleId",204],")",["T_WHITESPACE","\n    ",204],"{",["T_WHITESPACE","\n        ",205],["T_IF","if",206],["T_WHITESPACE"," ",206],"(","!",["T_ISSET","isset",206],"(",["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_rates",206],"[",["T_VARIABLE","$ruleId",206],"]",")",")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_rates",207],"[",["T_VARIABLE","$ruleId",207],"]",["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_getResource",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","getDistinct",207],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_calculation_rate_id'",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$ruleId",207],")",";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n        ",208],["T_RETURN","return",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_rates",209],"[",["T_VARIABLE","$ruleId",209],"]",";",["T_WHITESPACE","\n    ",209],"}",["T_WHITESPACE","\n\n    ",210],["T_DOC_COMMENT","\/**\n     * Get allowed customer tax classes by rule id\n     *\n     * @param   int $ruleId\n     * @return  array\n     *\/",212],["T_WHITESPACE","\n    ",217],["T_PUBLIC","public",218],["T_WHITESPACE"," ",218],["T_FUNCTION","function",218],["T_WHITESPACE"," ",218],["T_STRING","getCustomerTaxClasses",218],"(",["T_VARIABLE","$ruleId",218],")",["T_WHITESPACE","\n    ",218],"{",["T_WHITESPACE","\n        ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(","!",["T_ISSET","isset",220],"(",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_ctc",220],"[",["T_VARIABLE","$ruleId",220],"]",")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","_ctc",221],"[",["T_VARIABLE","$ruleId",221],"]",["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","_getResource",221],"(",")",["T_OBJECT_OPERATOR","->",221],["T_STRING","getDistinct",221],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_tax_class_id'",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$ruleId",221],")",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE","\n        ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_ctc",223],"[",["T_VARIABLE","$ruleId",223],"]",";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Get allowed product tax classes by rule id\n     *\n     * @param   int $ruleId\n     * @return  array\n     *\/",226],["T_WHITESPACE","\n    ",231],["T_PUBLIC","public",232],["T_WHITESPACE"," ",232],["T_FUNCTION","function",232],["T_WHITESPACE"," ",232],["T_STRING","getProductTaxClasses",232],"(",["T_VARIABLE","$ruleId",232],")",["T_WHITESPACE","\n    ",232],"{",["T_WHITESPACE","\n        ",233],["T_IF","if",234],["T_WHITESPACE"," ",234],"(","!",["T_ISSET","isset",234],"(",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_ptc",234],"[",["T_VARIABLE","$ruleId",234],"]",")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_ptc",235],"[",["T_VARIABLE","$ruleId",235],"]",["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getResource",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","getDistinct",235],"(",["T_CONSTANT_ENCAPSED_STRING","'product_tax_class_id'",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$ruleId",235],")",";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE","\n        ",236],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_ptc",237],"[",["T_VARIABLE","$ruleId",237],"]",";",["T_WHITESPACE","\n    ",237],"}",["T_WHITESPACE","\n\n    ",238],["T_DOC_COMMENT","\/**\n     * Aggregate tax calculation data to array\n     *\n     * @return array\n     *\/",240],["T_WHITESPACE","\n    ",244],["T_PROTECTED","protected",245],["T_WHITESPACE"," ",245],["T_FUNCTION","function",245],["T_WHITESPACE"," ",245],["T_STRING","_formCalculationProcess",245],"(",")",["T_WHITESPACE","\n    ",245],"{",["T_WHITESPACE","\n        ",246],["T_VARIABLE","$title",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getRateTitle",247],"(",")",";",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$value",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getRateValue",248],"(",")",";",["T_WHITESPACE","\n        ",248],["T_VARIABLE","$id",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getRateId",249],"(",")",";",["T_WHITESPACE","\n\n        ",249],["T_VARIABLE","$rate",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_ARRAY","array",251],"(",["T_WHITESPACE","\n            ",251],["T_CONSTANT_ENCAPSED_STRING","'code'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$title",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'title'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$title",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'percent'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$value",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'position'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_LNUMBER","1",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'priority'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_LNUMBER","1",252],")",";",["T_WHITESPACE","\n\n        ",252],["T_VARIABLE","$process",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_ARRAY","array",254],"(",")",";",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$process",255],"[",["T_CONSTANT_ENCAPSED_STRING","'percent'",255],"]",["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$value",255],";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$process",256],"[",["T_CONSTANT_ENCAPSED_STRING","'id'",256],"]",["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],"\"",["T_CURLY_OPEN","{",256],["T_VARIABLE","$id",256],"}",["T_ENCAPSED_AND_WHITESPACE","-",256],["T_CURLY_OPEN","{",256],["T_VARIABLE","$value",256],"}","\"",";",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$process",257],"[",["T_CONSTANT_ENCAPSED_STRING","'rates'",257],"]","[","]",["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$rate",257],";",["T_WHITESPACE","\n\n        ",257],["T_RETURN","return",259],["T_WHITESPACE"," ",259],["T_ARRAY","array",259],"(",["T_VARIABLE","$process",259],")",";",["T_WHITESPACE","\n    ",259],"}",["T_WHITESPACE","\n\n    ",260],["T_DOC_COMMENT","\/**\n     * Get calculation tax rate by specific request\n     *\n     * @param   Varien_Object $request\n     * @return  float\n     *\/",262],["T_WHITESPACE","\n    ",267],["T_PUBLIC","public",268],["T_WHITESPACE"," ",268],["T_FUNCTION","function",268],["T_WHITESPACE"," ",268],["T_STRING","getRate",268],"(",["T_VARIABLE","$request",268],")",["T_WHITESPACE","\n    ",268],"{",["T_WHITESPACE","\n        ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(","!",["T_VARIABLE","$request",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getCountryId",270],"(",")",["T_WHITESPACE"," ",270],["T_BOOLEAN_OR","||",270],["T_WHITESPACE"," ",270],"!",["T_VARIABLE","$request",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getCustomerClassId",270],"(",")",["T_WHITESPACE"," ",270],["T_BOOLEAN_OR","||",270],["T_WHITESPACE"," ",270],"!",["T_VARIABLE","$request",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getProductClassId",270],"(",")",")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_RETURN","return",271],["T_WHITESPACE"," ",271],["T_LNUMBER","0",271],";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE","\n\n        ",272],["T_VARIABLE","$cacheKey",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_getRequestCacheKey",274],"(",["T_VARIABLE","$request",274],")",";",["T_WHITESPACE","\n        ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(","!",["T_ISSET","isset",275],"(",["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_rateCache",275],"[",["T_VARIABLE","$cacheKey",275],"]",")",")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","unsRateValue",276],"(",")",";",["T_WHITESPACE","\n            ",276],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","unsCalculationProcess",277],"(",")",";",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","unsEventModuleId",278],"(",")",";",["T_WHITESPACE","\n            ",278],["T_STRING","Mage",279],["T_DOUBLE_COLON","::",279],["T_STRING","dispatchEvent",279],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_rate_data_fetch'",279],",",["T_WHITESPACE"," ",279],["T_ARRAY","array",279],"(",["T_WHITESPACE","\n                ",279],["T_CONSTANT_ENCAPSED_STRING","'request'",280],["T_WHITESPACE"," ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$request",280],")",")",";",["T_WHITESPACE","\n            ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(","!",["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","hasRateValue",281],"(",")",")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n                ",281],["T_VARIABLE","$rateInfo",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","_getResource",282],"(",")",["T_OBJECT_OPERATOR","->",282],["T_STRING","getRateInfo",282],"(",["T_VARIABLE","$request",282],")",";",["T_WHITESPACE","\n                ",282],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","setCalculationProcess",283],"(",["T_VARIABLE","$rateInfo",283],"[",["T_CONSTANT_ENCAPSED_STRING","'process'",283],"]",")",";",["T_WHITESPACE","\n                ",283],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","setRateValue",284],"(",["T_VARIABLE","$rateInfo",284],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",284],"]",")",";",["T_WHITESPACE","\n            ",284],"}",["T_WHITESPACE"," ",285],["T_ELSE","else",285],["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n                ",285],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","setCalculationProcess",286],"(",["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_formCalculationProcess",286],"(",")",")",";",["T_WHITESPACE","\n            ",286],"}",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_rateCache",288],"[",["T_VARIABLE","$cacheKey",288],"]",["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getRateValue",288],"(",")",";",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","_rateCalculationProcess",289],"[",["T_VARIABLE","$cacheKey",289],"]",["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getCalculationProcess",289],"(",")",";",["T_WHITESPACE","\n        ",289],"}",["T_WHITESPACE","\n        ",290],["T_RETURN","return",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","_rateCache",291],"[",["T_VARIABLE","$cacheKey",291],"]",";",["T_WHITESPACE","\n    ",291],"}",["T_WHITESPACE","\n\n    ",292],["T_DOC_COMMENT","\/**\n     * Get cache key value for specific tax rate request\n     *\n     * @param   $request\n     * @return  string\n     *\/",294],["T_WHITESPACE","\n    ",299],["T_PROTECTED","protected",300],["T_WHITESPACE"," ",300],["T_FUNCTION","function",300],["T_WHITESPACE"," ",300],["T_STRING","_getRequestCacheKey",300],"(",["T_VARIABLE","$request",300],")",["T_WHITESPACE","\n    ",300],"{",["T_WHITESPACE","\n        ",301],["T_VARIABLE","$key",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$request",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getStore",302],"(",")",["T_WHITESPACE"," ",302],"?",["T_WHITESPACE"," ",302],["T_VARIABLE","$request",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getStore",302],"(",")",["T_OBJECT_OPERATOR","->",302],["T_STRING","getId",302],"(",")",["T_WHITESPACE"," ",302],".",["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","'|'",302],["T_WHITESPACE"," ",302],":",["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","''",302],";",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$key",303],["T_WHITESPACE"," ",303],["T_CONCAT_EQUAL",".=",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$request",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getProductClassId",303],"(",")",["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'|'",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_VARIABLE","$request",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getCustomerClassId",303],"(",")",["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'|'",303],["T_WHITESPACE","\n            ",303],".",["T_WHITESPACE"," ",304],["T_VARIABLE","$request",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getCountryId",304],"(",")",["T_WHITESPACE"," ",304],".",["T_WHITESPACE"," ",304],["T_CONSTANT_ENCAPSED_STRING","'|'",304],["T_WHITESPACE"," ",304],".",["T_WHITESPACE"," ",304],["T_VARIABLE","$request",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getRegionId",304],"(",")",["T_WHITESPACE"," ",304],".",["T_WHITESPACE"," ",304],["T_CONSTANT_ENCAPSED_STRING","'|'",304],["T_WHITESPACE"," ",304],".",["T_WHITESPACE"," ",304],["T_VARIABLE","$request",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getPostcode",304],"(",")",";",["T_WHITESPACE","\n        ",304],["T_RETURN","return",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$key",305],";",["T_WHITESPACE","\n    ",305],"}",["T_WHITESPACE","\n\n    ",306],["T_DOC_COMMENT","\/**\n     * Get tax rate based on store shipping origin address settings\n     * This rate can be used for conversion store price including tax to\n     * store price excluding tax\n     *\n     * @param   Varien_Object $request\n     * @return  float\n     *\/",308],["T_WHITESPACE","\n    ",315],["T_PUBLIC","public",316],["T_WHITESPACE"," ",316],["T_FUNCTION","function",316],["T_WHITESPACE"," ",316],["T_STRING","getStoreRate",316],"(",["T_VARIABLE","$request",316],",",["T_WHITESPACE"," ",316],["T_VARIABLE","$store",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_STRING","null",316],")",["T_WHITESPACE","\n    ",316],"{",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$storeRequest",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getRateOriginRequest",318],"(",["T_VARIABLE","$store",318],")",["T_WHITESPACE","\n            ",318],["T_OBJECT_OPERATOR","->",319],["T_STRING","setProductClassId",319],"(",["T_VARIABLE","$request",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getProductClassId",319],"(",")",")",";",["T_WHITESPACE","\n        ",319],["T_RETURN","return",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getRate",320],"(",["T_VARIABLE","$storeRequest",320],")",";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * Get tax rate based on store shipping origin address settings\n     * This rate can be used for conversion store price including tax to\n     * store price excluding tax\n     *\n     * @param Mage_Sales_Model_Quote_Item_Abstract $item\n     * @param null|Mage_Core_Model_Store $store\n     * @return float\n     *\/",323],["T_WHITESPACE","\n    ",331],["T_PUBLIC","public",332],["T_WHITESPACE"," ",332],["T_FUNCTION","function",332],["T_WHITESPACE"," ",332],["T_STRING","getStoreRateForItem",332],"(",["T_VARIABLE","$item",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$store",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_STRING","null",332],")",["T_WHITESPACE","\n    ",332],"{",["T_WHITESPACE","\n        ",333],["T_VARIABLE","$storeRequest",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getRateOriginRequest",334],"(",["T_VARIABLE","$store",334],")",["T_WHITESPACE","\n            ",334],["T_OBJECT_OPERATOR","->",335],["T_STRING","setProductClassId",335],"(",["T_VARIABLE","$item",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getProduct",335],"(",")",["T_OBJECT_OPERATOR","->",335],["T_STRING","getTaxClassId",335],"(",")",")",";",["T_WHITESPACE","\n        ",335],["T_RETURN","return",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getRate",336],"(",["T_VARIABLE","$storeRequest",336],")",";",["T_WHITESPACE","\n    ",336],"}",["T_WHITESPACE","\n\n    ",337],["T_DOC_COMMENT","\/**\n     * Get request object for getting tax rate based on store shippig original address\n     *\n     * @param   null|store $store\n     * @return  Varien_Object\n     *\/",339],["T_WHITESPACE","\n    ",344],["T_PUBLIC","public",345],["T_WHITESPACE"," ",345],["T_FUNCTION","function",345],["T_WHITESPACE"," ",345],["T_STRING","getRateOriginRequest",345],"(",["T_VARIABLE","$store",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_STRING","null",345],")",["T_WHITESPACE","\n    ",345],"{",["T_WHITESPACE","\n        ",346],["T_VARIABLE","$request",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_NEW","new",347],["T_WHITESPACE"," ",347],["T_STRING","Varien_Object",347],"(",")",";",["T_WHITESPACE","\n        ",347],["T_VARIABLE","$request",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","setCountryId",348],"(",["T_STRING","Mage",348],["T_DOUBLE_COLON","::",348],["T_STRING","getStoreConfig",348],"(",["T_STRING","Mage_Shipping_Model_Config",348],["T_DOUBLE_COLON","::",348],["T_STRING","XML_PATH_ORIGIN_COUNTRY_ID",348],",",["T_WHITESPACE"," ",348],["T_VARIABLE","$store",348],")",")",["T_WHITESPACE","\n            ",348],["T_OBJECT_OPERATOR","->",349],["T_STRING","setRegionId",349],"(",["T_STRING","Mage",349],["T_DOUBLE_COLON","::",349],["T_STRING","getStoreConfig",349],"(",["T_STRING","Mage_Shipping_Model_Config",349],["T_DOUBLE_COLON","::",349],["T_STRING","XML_PATH_ORIGIN_REGION_ID",349],",",["T_WHITESPACE"," ",349],["T_VARIABLE","$store",349],")",")",["T_WHITESPACE","\n            ",349],["T_OBJECT_OPERATOR","->",350],["T_STRING","setPostcode",350],"(",["T_STRING","Mage",350],["T_DOUBLE_COLON","::",350],["T_STRING","getStoreConfig",350],"(",["T_STRING","Mage_Shipping_Model_Config",350],["T_DOUBLE_COLON","::",350],["T_STRING","XML_PATH_ORIGIN_POSTCODE",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$store",350],")",")",["T_WHITESPACE","\n            ",350],["T_OBJECT_OPERATOR","->",351],["T_STRING","setCustomerClassId",351],"(",["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getDefaultCustomerTaxClass",351],"(",["T_VARIABLE","$store",351],")",")",["T_WHITESPACE","\n            ",351],["T_OBJECT_OPERATOR","->",352],["T_STRING","setStore",352],"(",["T_VARIABLE","$store",352],")",";",["T_WHITESPACE","\n        ",352],["T_RETURN","return",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$request",353],";",["T_WHITESPACE","\n    ",353],"}",["T_WHITESPACE","\n\n    ",354],["T_DOC_COMMENT","\/**\n     * Return the default rate request. It can be either based on store address or customer address\n     *\n     * @param type $store\n     * @return \\Varien_Object\n     *\/",356],["T_WHITESPACE","\n    ",361],["T_PUBLIC","public",362],["T_WHITESPACE"," ",362],["T_FUNCTION","function",362],["T_WHITESPACE"," ",362],["T_STRING","getDefaultRateRequest",362],"(",["T_VARIABLE","$store",362],["T_WHITESPACE"," ",362],"=",["T_STRING","null",362],")",["T_WHITESPACE","\n    ",362],"{",["T_WHITESPACE","\n        ",363],["T_IF","if",364],["T_WHITESPACE"," ",364],"(",["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_taxHelper",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","isCrossBorderTradeEnabled",364],"(",["T_VARIABLE","$store",364],")",")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n            ",364],["T_COMMENT","\/\/If cross border trade is enabled, we will use customer tax rate as store tax rate\n",365],["T_WHITESPACE","            ",366],["T_RETURN","return",366],["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getRateRequest",366],"(",["T_STRING","null",366],",",["T_WHITESPACE"," ",366],["T_STRING","null",366],",",["T_WHITESPACE"," ",366],["T_STRING","null",366],",",["T_WHITESPACE"," ",366],["T_VARIABLE","$store",366],")",";",["T_WHITESPACE","\n        ",366],"}",["T_WHITESPACE"," ",367],["T_ELSE","else",367],["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n            ",367],["T_RETURN","return",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getRateOriginRequest",368],"(",["T_VARIABLE","$store",368],")",";",["T_WHITESPACE","\n        ",368],"}",["T_WHITESPACE","\n    ",369],"}",["T_WHITESPACE","\n\n    ",370],["T_DOC_COMMENT","\/**\n     * Get request object with information necessary for getting tax rate\n     * Request object contain:\n     *  country_id (->getCountryId())\n     *  region_id (->getRegionId())\n     *  postcode (->getPostcode())\n     *  customer_class_id (->getCustomerClassId())\n     *  store (->getStore())\n     *\n     * @param   null|false|Varien_Object $shippingAddress\n     * @param   null|false|Varien_Object $billingAddress\n     * @param   null|int $customerTaxClass\n     * @param   null|int $store\n     * @return  Varien_Object\n     *\/",372],["T_WHITESPACE","\n    ",386],["T_PUBLIC","public",387],["T_WHITESPACE"," ",387],["T_FUNCTION","function",387],["T_WHITESPACE"," ",387],["T_STRING","getRateRequest",387],"(",["T_WHITESPACE","\n        ",387],["T_VARIABLE","$shippingAddress",388],["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_STRING","null",388],",",["T_WHITESPACE","\n        ",388],["T_VARIABLE","$billingAddress",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_STRING","null",389],",",["T_WHITESPACE","\n        ",389],["T_VARIABLE","$customerTaxClass",390],["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_STRING","null",390],",",["T_WHITESPACE","\n        ",390],["T_VARIABLE","$store",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_STRING","null",391],")",["T_WHITESPACE","\n    ",391],"{",["T_WHITESPACE","\n        ",392],["T_IF","if",393],["T_WHITESPACE"," ",393],"(",["T_VARIABLE","$shippingAddress",393],["T_WHITESPACE"," ",393],["T_IS_IDENTICAL","===",393],["T_WHITESPACE"," ",393],["T_STRING","false",393],["T_WHITESPACE"," ",393],["T_BOOLEAN_AND","&&",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$billingAddress",393],["T_WHITESPACE"," ",393],["T_IS_IDENTICAL","===",393],["T_WHITESPACE"," ",393],["T_STRING","false",393],["T_WHITESPACE"," ",393],["T_BOOLEAN_AND","&&",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$customerTaxClass",393],["T_WHITESPACE"," ",393],["T_IS_IDENTICAL","===",393],["T_WHITESPACE"," ",393],["T_STRING","false",393],")",["T_WHITESPACE"," ",393],"{",["T_WHITESPACE","\n            ",393],["T_RETURN","return",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getRateOriginRequest",394],"(",["T_VARIABLE","$store",394],")",";",["T_WHITESPACE","\n        ",394],"}",["T_WHITESPACE","\n        ",395],["T_VARIABLE","$address",396],["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_NEW","new",396],["T_WHITESPACE"," ",396],["T_STRING","Varien_Object",396],"(",")",";",["T_WHITESPACE","\n        ",396],["T_VARIABLE","$customer",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getCustomer",397],"(",")",";",["T_WHITESPACE","\n        ",397],["T_VARIABLE","$basedOn",398],["T_WHITESPACE"," ",398],"=",["T_WHITESPACE"," ",398],["T_STRING","Mage",398],["T_DOUBLE_COLON","::",398],["T_STRING","getStoreConfig",398],"(",["T_STRING","Mage_Tax_Model_Config",398],["T_DOUBLE_COLON","::",398],["T_STRING","CONFIG_XML_PATH_BASED_ON",398],",",["T_WHITESPACE"," ",398],["T_VARIABLE","$store",398],")",";",["T_WHITESPACE","\n\n        ",398],["T_IF","if",400],["T_WHITESPACE"," ",400],"(","(",["T_VARIABLE","$shippingAddress",400],["T_WHITESPACE"," ",400],["T_IS_IDENTICAL","===",400],["T_WHITESPACE"," ",400],["T_STRING","false",400],["T_WHITESPACE"," ",400],["T_BOOLEAN_AND","&&",400],["T_WHITESPACE"," ",400],["T_VARIABLE","$basedOn",400],["T_WHITESPACE"," ",400],["T_IS_EQUAL","==",400],["T_WHITESPACE"," ",400],["T_CONSTANT_ENCAPSED_STRING","'shipping'",400],")",["T_WHITESPACE","\n            ",400],["T_BOOLEAN_OR","||",401],["T_WHITESPACE"," ",401],"(",["T_VARIABLE","$billingAddress",401],["T_WHITESPACE"," ",401],["T_IS_IDENTICAL","===",401],["T_WHITESPACE"," ",401],["T_STRING","false",401],["T_WHITESPACE"," ",401],["T_BOOLEAN_AND","&&",401],["T_WHITESPACE"," ",401],["T_VARIABLE","$basedOn",401],["T_WHITESPACE"," ",401],["T_IS_EQUAL","==",401],["T_WHITESPACE"," ",401],["T_CONSTANT_ENCAPSED_STRING","'billing'",401],")",["T_WHITESPACE","\n        ",401],")",["T_WHITESPACE"," ",402],"{",["T_WHITESPACE","\n            ",402],["T_VARIABLE","$basedOn",403],["T_WHITESPACE"," ",403],"=",["T_WHITESPACE"," ",403],["T_CONSTANT_ENCAPSED_STRING","'default'",403],";",["T_WHITESPACE","\n        ",403],"}",["T_WHITESPACE"," ",404],["T_ELSE","else",404],["T_WHITESPACE"," ",404],"{",["T_WHITESPACE","\n            ",404],["T_IF","if",405],["T_WHITESPACE"," ",405],"(","(","(",["T_VARIABLE","$billingAddress",405],["T_WHITESPACE"," ",405],["T_IS_IDENTICAL","===",405],["T_WHITESPACE"," ",405],["T_STRING","false",405],["T_WHITESPACE"," ",405],["T_BOOLEAN_OR","||",405],["T_WHITESPACE"," ",405],["T_STRING","is_null",405],"(",["T_VARIABLE","$billingAddress",405],")",["T_WHITESPACE"," ",405],["T_BOOLEAN_OR","||",405],["T_WHITESPACE"," ",405],"!",["T_VARIABLE","$billingAddress",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","getCountryId",405],"(",")",")",["T_WHITESPACE","\n                ",405],["T_BOOLEAN_AND","&&",406],["T_WHITESPACE"," ",406],["T_VARIABLE","$basedOn",406],["T_WHITESPACE"," ",406],["T_IS_EQUAL","==",406],["T_WHITESPACE"," ",406],["T_CONSTANT_ENCAPSED_STRING","'billing'",406],")",["T_WHITESPACE","\n                ",406],["T_BOOLEAN_OR","||",407],["T_WHITESPACE"," ",407],"(","(",["T_VARIABLE","$shippingAddress",407],["T_WHITESPACE"," ",407],["T_IS_IDENTICAL","===",407],["T_WHITESPACE"," ",407],["T_STRING","false",407],["T_WHITESPACE"," ",407],["T_BOOLEAN_OR","||",407],["T_WHITESPACE"," ",407],["T_STRING","is_null",407],"(",["T_VARIABLE","$shippingAddress",407],")",["T_WHITESPACE"," ",407],["T_BOOLEAN_OR","||",407],["T_WHITESPACE"," ",407],"!",["T_VARIABLE","$shippingAddress",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getCountryId",407],"(",")",")",["T_WHITESPACE","\n                    ",407],["T_BOOLEAN_AND","&&",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$basedOn",408],["T_WHITESPACE"," ",408],["T_IS_EQUAL","==",408],["T_WHITESPACE"," ",408],["T_CONSTANT_ENCAPSED_STRING","'shipping'",408],")",["T_WHITESPACE","\n            ",408],")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n                ",409],["T_IF","if",410],["T_WHITESPACE"," ",410],"(",["T_VARIABLE","$customer",410],")",["T_WHITESPACE"," ",410],"{",["T_WHITESPACE","\n                    ",410],["T_VARIABLE","$defBilling",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$customer",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getDefaultBillingAddress",411],"(",")",";",["T_WHITESPACE","\n                    ",411],["T_VARIABLE","$defShipping",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_VARIABLE","$customer",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getDefaultShippingAddress",412],"(",")",";",["T_WHITESPACE","\n\n                    ",412],["T_IF","if",414],["T_WHITESPACE"," ",414],"(",["T_VARIABLE","$basedOn",414],["T_WHITESPACE"," ",414],["T_IS_EQUAL","==",414],["T_WHITESPACE"," ",414],["T_CONSTANT_ENCAPSED_STRING","'billing'",414],["T_WHITESPACE"," ",414],["T_BOOLEAN_AND","&&",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$defBilling",414],["T_WHITESPACE"," ",414],["T_BOOLEAN_AND","&&",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$defBilling",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getCountryId",414],"(",")",")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n                        ",414],["T_VARIABLE","$billingAddress",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_VARIABLE","$defBilling",415],";",["T_WHITESPACE","\n                    ",415],"}",["T_WHITESPACE"," ",416],["T_ELSE","else",416],["T_WHITESPACE"," ",416],["T_IF","if",416],["T_WHITESPACE"," ",416],"(",["T_VARIABLE","$basedOn",416],["T_WHITESPACE"," ",416],["T_IS_EQUAL","==",416],["T_WHITESPACE"," ",416],["T_CONSTANT_ENCAPSED_STRING","'shipping'",416],["T_WHITESPACE"," ",416],["T_BOOLEAN_AND","&&",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$defShipping",416],["T_WHITESPACE"," ",416],["T_BOOLEAN_AND","&&",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$defShipping",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getCountryId",416],"(",")",")",["T_WHITESPACE"," ",416],"{",["T_WHITESPACE","\n                        ",416],["T_VARIABLE","$shippingAddress",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$defShipping",417],";",["T_WHITESPACE","\n                    ",417],"}",["T_WHITESPACE"," ",418],["T_ELSE","else",418],["T_WHITESPACE"," ",418],"{",["T_WHITESPACE","\n                        ",418],["T_VARIABLE","$basedOn",419],["T_WHITESPACE"," ",419],"=",["T_WHITESPACE"," ",419],["T_CONSTANT_ENCAPSED_STRING","'default'",419],";",["T_WHITESPACE","\n                    ",419],"}",["T_WHITESPACE","\n                ",420],"}",["T_WHITESPACE"," ",421],["T_ELSE","else",421],["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n                    ",421],["T_VARIABLE","$basedOn",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_CONSTANT_ENCAPSED_STRING","'default'",422],";",["T_WHITESPACE","\n                ",422],"}",["T_WHITESPACE","\n            ",423],"}",["T_WHITESPACE","\n        ",424],"}",["T_WHITESPACE","\n\n        ",425],["T_SWITCH","switch",427],["T_WHITESPACE"," ",427],"(",["T_VARIABLE","$basedOn",427],")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n            ",427],["T_CASE","case",428],["T_WHITESPACE"," ",428],["T_CONSTANT_ENCAPSED_STRING","'billing'",428],":",["T_WHITESPACE","\n                ",428],["T_VARIABLE","$address",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$billingAddress",429],";",["T_WHITESPACE","\n                ",429],["T_BREAK","break",430],";",["T_WHITESPACE","\n            ",430],["T_CASE","case",431],["T_WHITESPACE"," ",431],["T_CONSTANT_ENCAPSED_STRING","'shipping'",431],":",["T_WHITESPACE","\n                ",431],["T_VARIABLE","$address",432],["T_WHITESPACE"," ",432],"=",["T_WHITESPACE"," ",432],["T_VARIABLE","$shippingAddress",432],";",["T_WHITESPACE","\n                ",432],["T_BREAK","break",433],";",["T_WHITESPACE","\n            ",433],["T_CASE","case",434],["T_WHITESPACE"," ",434],["T_CONSTANT_ENCAPSED_STRING","'origin'",434],":",["T_WHITESPACE","\n                ",434],["T_VARIABLE","$address",435],["T_WHITESPACE"," ",435],"=",["T_WHITESPACE"," ",435],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getRateOriginRequest",435],"(",["T_VARIABLE","$store",435],")",";",["T_WHITESPACE","\n                ",435],["T_BREAK","break",436],";",["T_WHITESPACE","\n            ",436],["T_CASE","case",437],["T_WHITESPACE"," ",437],["T_CONSTANT_ENCAPSED_STRING","'default'",437],":",["T_WHITESPACE","\n                ",437],["T_VARIABLE","$address",438],["T_WHITESPACE","\n                    ",438],["T_OBJECT_OPERATOR","->",439],["T_STRING","setCountryId",439],"(",["T_STRING","Mage",439],["T_DOUBLE_COLON","::",439],["T_STRING","getStoreConfig",439],"(",["T_WHITESPACE","\n                    ",439],["T_STRING","Mage_Tax_Model_Config",440],["T_DOUBLE_COLON","::",440],["T_STRING","CONFIG_XML_PATH_DEFAULT_COUNTRY",440],",",["T_WHITESPACE","\n                    ",440],["T_VARIABLE","$store",441],")",")",["T_WHITESPACE","\n                    ",441],["T_OBJECT_OPERATOR","->",442],["T_STRING","setRegionId",442],"(",["T_STRING","Mage",442],["T_DOUBLE_COLON","::",442],["T_STRING","getStoreConfig",442],"(",["T_STRING","Mage_Tax_Model_Config",442],["T_DOUBLE_COLON","::",442],["T_STRING","CONFIG_XML_PATH_DEFAULT_REGION",442],",",["T_WHITESPACE"," ",442],["T_VARIABLE","$store",442],")",")",["T_WHITESPACE","\n                    ",442],["T_OBJECT_OPERATOR","->",443],["T_STRING","setPostcode",443],"(",["T_STRING","Mage",443],["T_DOUBLE_COLON","::",443],["T_STRING","getStoreConfig",443],"(",["T_WHITESPACE","\n                    ",443],["T_STRING","Mage_Tax_Model_Config",444],["T_DOUBLE_COLON","::",444],["T_STRING","CONFIG_XML_PATH_DEFAULT_POSTCODE",444],",",["T_WHITESPACE","\n                    ",444],["T_VARIABLE","$store",445],")",")",";",["T_WHITESPACE","\n                ",445],["T_BREAK","break",446],";",["T_WHITESPACE","\n        ",446],"}",["T_WHITESPACE","\n\n        ",447],["T_IF","if",449],["T_WHITESPACE"," ",449],"(",["T_STRING","is_null",449],"(",["T_VARIABLE","$customerTaxClass",449],")",["T_WHITESPACE"," ",449],["T_BOOLEAN_AND","&&",449],["T_WHITESPACE"," ",449],["T_VARIABLE","$customer",449],")",["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$customerTaxClass",450],["T_WHITESPACE"," ",450],"=",["T_WHITESPACE"," ",450],["T_VARIABLE","$customer",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getTaxClassId",450],"(",")",";",["T_WHITESPACE","\n        ",450],"}",["T_WHITESPACE"," ",451],["T_ELSEIF","elseif",451],["T_WHITESPACE"," ",451],"(","(",["T_VARIABLE","$customerTaxClass",451],["T_WHITESPACE"," ",451],["T_IS_IDENTICAL","===",451],["T_WHITESPACE"," ",451],["T_STRING","false",451],")",["T_WHITESPACE"," ",451],["T_BOOLEAN_OR","||",451],["T_WHITESPACE"," ",451],"!",["T_VARIABLE","$customer",451],")",["T_WHITESPACE"," ",451],"{",["T_WHITESPACE","\n            ",451],["T_VARIABLE","$customerTaxClass",452],["T_WHITESPACE"," ",452],"=",["T_WHITESPACE"," ",452],["T_STRING","Mage",452],["T_DOUBLE_COLON","::",452],["T_STRING","getModel",452],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/group'",452],")",["T_WHITESPACE","\n                    ",452],["T_OBJECT_OPERATOR","->",453],["T_STRING","getTaxClassId",453],"(",["T_STRING","Mage_Customer_Model_Group",453],["T_DOUBLE_COLON","::",453],["T_STRING","NOT_LOGGED_IN_ID",453],")",";",["T_WHITESPACE","\n        ",453],"}",["T_WHITESPACE","\n\n        ",454],["T_VARIABLE","$request",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_NEW","new",456],["T_WHITESPACE"," ",456],["T_STRING","Varien_Object",456],"(",")",";",["T_WHITESPACE","\n        ",456],["T_VARIABLE","$request",457],["T_WHITESPACE","\n            ",457],["T_OBJECT_OPERATOR","->",458],["T_STRING","setCountryId",458],"(",["T_VARIABLE","$address",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getCountryId",458],"(",")",")",["T_WHITESPACE","\n            ",458],["T_OBJECT_OPERATOR","->",459],["T_STRING","setRegionId",459],"(",["T_VARIABLE","$address",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","getRegionId",459],"(",")",")",["T_WHITESPACE","\n            ",459],["T_OBJECT_OPERATOR","->",460],["T_STRING","setPostcode",460],"(",["T_VARIABLE","$address",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getPostcode",460],"(",")",")",["T_WHITESPACE","\n            ",460],["T_OBJECT_OPERATOR","->",461],["T_STRING","setStore",461],"(",["T_VARIABLE","$store",461],")",["T_WHITESPACE","\n            ",461],["T_OBJECT_OPERATOR","->",462],["T_STRING","setCustomerClassId",462],"(",["T_VARIABLE","$customerTaxClass",462],")",";",["T_WHITESPACE","\n        ",462],["T_RETURN","return",463],["T_WHITESPACE"," ",463],["T_VARIABLE","$request",463],";",["T_WHITESPACE","\n    ",463],"}",["T_WHITESPACE","\n\n    ",464],["T_DOC_COMMENT","\/**\n     * Compare data and rates for two tax rate requests for same products (product tax class ids).\n     * Returns true if requests are similar (i.e. equal taxes rates will be applied to them)\n     *\n     * Notice:\n     * a) productClassId MUST be identical for both requests, because we intend to check selling SAME products to DIFFERENT locations\n     * b) due to optimization productClassId can be array of ids, not only single id\n     *\n     * @param   Varien_Object $first\n     * @param   Varien_Object $second\n     * @return  bool\n     *\/",466],["T_WHITESPACE","\n    ",477],["T_PUBLIC","public",478],["T_WHITESPACE"," ",478],["T_FUNCTION","function",478],["T_WHITESPACE"," ",478],["T_STRING","compareRequests",478],"(",["T_VARIABLE","$first",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$second",478],")",["T_WHITESPACE","\n    ",478],"{",["T_WHITESPACE","\n        ",479],["T_VARIABLE","$country",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$first",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getCountryId",480],"(",")",["T_WHITESPACE"," ",480],["T_IS_EQUAL","==",480],["T_WHITESPACE"," ",480],["T_VARIABLE","$second",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getCountryId",480],"(",")",";",["T_WHITESPACE","\n        ",480],["T_COMMENT","\/\/ \"0\" support for admin dropdown with --please select--\n",481],["T_WHITESPACE","        ",482],["T_VARIABLE","$region",482],["T_WHITESPACE","  ",482],"=",["T_WHITESPACE"," ",482],["T_INT_CAST","(int)",482],["T_VARIABLE","$first",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getRegionId",482],"(",")",["T_WHITESPACE"," ",482],["T_IS_EQUAL","==",482],["T_WHITESPACE"," ",482],["T_INT_CAST","(int)",482],["T_VARIABLE","$second",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getRegionId",482],"(",")",";",["T_WHITESPACE","\n        ",482],["T_VARIABLE","$postcode",483],["T_WHITESPACE"," ",483],"=",["T_WHITESPACE"," ",483],["T_VARIABLE","$first",483],["T_OBJECT_OPERATOR","->",483],["T_WHITESPACE"," ",483],["T_STRING","getPostcode",483],"(",")",["T_WHITESPACE"," ",483],["T_IS_EQUAL","==",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$second",483],["T_OBJECT_OPERATOR","->",483],["T_WHITESPACE"," ",483],["T_STRING","getPostcode",483],"(",")",";",["T_WHITESPACE","\n        ",483],["T_VARIABLE","$taxClass",484],["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_VARIABLE","$first",484],["T_OBJECT_OPERATOR","->",484],["T_WHITESPACE"," ",484],["T_STRING","getCustomerClassId",484],"(",")",["T_WHITESPACE"," ",484],["T_IS_EQUAL","==",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$second",484],["T_OBJECT_OPERATOR","->",484],["T_WHITESPACE"," ",484],["T_STRING","getCustomerClassId",484],"(",")",";",["T_WHITESPACE","\n\n        ",484],["T_IF","if",486],["T_WHITESPACE"," ",486],"(",["T_VARIABLE","$country",486],["T_WHITESPACE"," ",486],["T_BOOLEAN_AND","&&",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$region",486],["T_WHITESPACE"," ",486],["T_BOOLEAN_AND","&&",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$postcode",486],["T_WHITESPACE"," ",486],["T_BOOLEAN_AND","&&",486],["T_WHITESPACE"," ",486],["T_VARIABLE","$taxClass",486],")",["T_WHITESPACE"," ",486],"{",["T_WHITESPACE","\n            ",486],["T_RETURN","return",487],["T_WHITESPACE"," ",487],["T_STRING","true",487],";",["T_WHITESPACE","\n        ",487],"}",["T_WHITESPACE","\n        ",488],["T_DOC_COMMENT","\/**\n         * Compare available tax rates for both requests\n         *\/",489],["T_WHITESPACE","\n        ",491],["T_VARIABLE","$firstReqRates",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","_getResource",492],"(",")",["T_OBJECT_OPERATOR","->",492],["T_STRING","getRateIds",492],"(",["T_VARIABLE","$first",492],")",";",["T_WHITESPACE","\n        ",492],["T_VARIABLE","$secondReqRates",493],["T_WHITESPACE"," ",493],"=",["T_WHITESPACE"," ",493],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","_getResource",493],"(",")",["T_OBJECT_OPERATOR","->",493],["T_STRING","getRateIds",493],"(",["T_VARIABLE","$second",493],")",";",["T_WHITESPACE","\n        ",493],["T_IF","if",494],["T_WHITESPACE"," ",494],"(",["T_VARIABLE","$firstReqRates",494],["T_WHITESPACE"," ",494],["T_IS_IDENTICAL","===",494],["T_WHITESPACE"," ",494],["T_VARIABLE","$secondReqRates",494],")",["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n            ",494],["T_RETURN","return",495],["T_WHITESPACE"," ",495],["T_STRING","true",495],";",["T_WHITESPACE","\n        ",495],"}",["T_WHITESPACE","\n\n        ",496],["T_DOC_COMMENT","\/**\n         * If rates are not equal by ids then compare actual values\n         * All product classes must have same rates to assume requests been similar\n         *\/",498],["T_WHITESPACE","\n        ",501],["T_VARIABLE","$productClassId1",502],["T_WHITESPACE"," ",502],"=",["T_WHITESPACE"," ",502],["T_VARIABLE","$first",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getProductClassId",502],"(",")",";",["T_WHITESPACE"," ",502],["T_COMMENT","\/\/ Save to set it back later\n",502],["T_WHITESPACE","        ",503],["T_VARIABLE","$productClassId2",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_VARIABLE","$second",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","getProductClassId",503],"(",")",";",["T_WHITESPACE"," ",503],["T_COMMENT","\/\/ Save to set it back later\n",503],["T_WHITESPACE","\n        ",504],["T_COMMENT","\/\/ Ids are equal for both requests, so take any of them to process\n",505],["T_WHITESPACE","        ",506],["T_VARIABLE","$ids",506],["T_WHITESPACE"," ",506],"=",["T_WHITESPACE"," ",506],["T_STRING","is_array",506],"(",["T_VARIABLE","$productClassId1",506],")",["T_WHITESPACE"," ",506],"?",["T_WHITESPACE"," ",506],["T_VARIABLE","$productClassId1",506],["T_WHITESPACE"," ",506],":",["T_WHITESPACE"," ",506],["T_ARRAY","array",506],"(",["T_VARIABLE","$productClassId1",506],")",";",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$identical",507],["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_STRING","true",507],";",["T_WHITESPACE","\n        ",507],["T_FOREACH","foreach",508],["T_WHITESPACE"," ",508],"(",["T_VARIABLE","$ids",508],["T_WHITESPACE"," ",508],["T_AS","as",508],["T_WHITESPACE"," ",508],["T_VARIABLE","$productClassId",508],")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n            ",508],["T_VARIABLE","$first",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","setProductClassId",509],"(",["T_VARIABLE","$productClassId",509],")",";",["T_WHITESPACE","\n            ",509],["T_VARIABLE","$rate1",510],["T_WHITESPACE"," ",510],"=",["T_WHITESPACE"," ",510],["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","getRate",510],"(",["T_VARIABLE","$first",510],")",";",["T_WHITESPACE","\n\n            ",510],["T_VARIABLE","$second",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","setProductClassId",512],"(",["T_VARIABLE","$productClassId",512],")",";",["T_WHITESPACE","\n            ",512],["T_VARIABLE","$rate2",513],["T_WHITESPACE"," ",513],"=",["T_WHITESPACE"," ",513],["T_VARIABLE","$this",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getRate",513],"(",["T_VARIABLE","$second",513],")",";",["T_WHITESPACE","\n\n            ",513],["T_IF","if",515],["T_WHITESPACE"," ",515],"(",["T_VARIABLE","$rate1",515],["T_WHITESPACE"," ",515],["T_IS_NOT_EQUAL","!=",515],["T_WHITESPACE"," ",515],["T_VARIABLE","$rate2",515],")",["T_WHITESPACE"," ",515],"{",["T_WHITESPACE","\n                ",515],["T_VARIABLE","$identical",516],["T_WHITESPACE"," ",516],"=",["T_WHITESPACE"," ",516],["T_STRING","false",516],";",["T_WHITESPACE","\n                ",516],["T_BREAK","break",517],";",["T_WHITESPACE","\n            ",517],"}",["T_WHITESPACE","\n        ",518],"}",["T_WHITESPACE","\n\n        ",519],["T_VARIABLE","$first",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","setProductClassId",521],"(",["T_VARIABLE","$productClassId1",521],")",";",["T_WHITESPACE","\n        ",521],["T_VARIABLE","$second",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","setProductClassId",522],"(",["T_VARIABLE","$productClassId2",522],")",";",["T_WHITESPACE","\n\n        ",522],["T_RETURN","return",524],["T_WHITESPACE"," ",524],["T_VARIABLE","$identical",524],";",["T_WHITESPACE","\n    ",524],"}",["T_WHITESPACE","\n\n    ",525],["T_DOC_COMMENT","\/**\n     * Gets the tax rates by type\n     *\n     * @param Varien_Object $request\n     * @param string $fieldName\n     * @param string $type\n     * @return array\n     *\/",527],["T_WHITESPACE","\n    ",534],["T_PROTECTED","protected",535],["T_WHITESPACE"," ",535],["T_FUNCTION","function",535],["T_WHITESPACE"," ",535],["T_STRING","_getRates",535],"(",["T_VARIABLE","$request",535],",",["T_WHITESPACE"," ",535],["T_VARIABLE","$fieldName",535],",",["T_WHITESPACE"," ",535],["T_VARIABLE","$type",535],")",["T_WHITESPACE","\n    ",535],"{",["T_WHITESPACE","\n        ",536],["T_VARIABLE","$result",537],["T_WHITESPACE"," ",537],"=",["T_WHITESPACE"," ",537],["T_ARRAY","array",537],"(",")",";",["T_WHITESPACE","\n        ",537],["T_VARIABLE","$classes",538],["T_WHITESPACE"," ",538],"=",["T_WHITESPACE"," ",538],["T_STRING","Mage",538],["T_DOUBLE_COLON","::",538],["T_STRING","getModel",538],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/class'",538],")",["T_OBJECT_OPERATOR","->",538],["T_STRING","getCollection",538],"(",")",["T_WHITESPACE","\n            ",538],["T_OBJECT_OPERATOR","->",539],["T_STRING","addFieldToFilter",539],"(",["T_CONSTANT_ENCAPSED_STRING","'class_type'",539],",",["T_WHITESPACE"," ",539],["T_VARIABLE","$type",539],")",["T_WHITESPACE","\n            ",539],["T_OBJECT_OPERATOR","->",540],["T_STRING","load",540],"(",")",";",["T_WHITESPACE","\n        ",540],["T_FOREACH","foreach",541],["T_WHITESPACE"," ",541],"(",["T_VARIABLE","$classes",541],["T_WHITESPACE"," ",541],["T_AS","as",541],["T_WHITESPACE"," ",541],["T_VARIABLE","$class",541],")",["T_WHITESPACE"," ",541],"{",["T_WHITESPACE","\n            ",541],["T_VARIABLE","$request",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","setData",542],"(",["T_VARIABLE","$fieldName",542],",",["T_WHITESPACE"," ",542],["T_VARIABLE","$class",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getId",542],"(",")",")",";",["T_WHITESPACE","\n            ",542],["T_VARIABLE","$result",543],"[",["T_VARIABLE","$class",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","getId",543],"(",")","]",["T_WHITESPACE"," ",543],"=",["T_WHITESPACE"," ",543],["T_VARIABLE","$this",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","getRate",543],"(",["T_VARIABLE","$request",543],")",";",["T_WHITESPACE","\n        ",543],"}",["T_WHITESPACE","\n\n        ",544],["T_RETURN","return",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$result",546],";",["T_WHITESPACE","\n    ",546],"}",["T_WHITESPACE","\n\n    ",547],["T_DOC_COMMENT","\/**\n     * Gets rates for all the product tax classes\n     *\n     * @param Varien_Object $request\n     * @return array\n     *\/",549],["T_WHITESPACE","\n    ",554],["T_PUBLIC","public",555],["T_WHITESPACE"," ",555],["T_FUNCTION","function",555],["T_WHITESPACE"," ",555],["T_STRING","getRatesForAllProductTaxClasses",555],"(",["T_VARIABLE","$request",555],")",["T_WHITESPACE","\n    ",555],"{",["T_WHITESPACE","\n        ",556],["T_RETURN","return",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_getRates",557],"(",["T_VARIABLE","$request",557],",",["T_WHITESPACE"," ",557],["T_CONSTANT_ENCAPSED_STRING","'product_class_id'",557],",",["T_WHITESPACE"," ",557],["T_STRING","Mage_Tax_Model_Class",557],["T_DOUBLE_COLON","::",557],["T_STRING","TAX_CLASS_TYPE_PRODUCT",557],")",";",["T_WHITESPACE","\n    ",557],"}",["T_WHITESPACE","\n\n    ",558],["T_DOC_COMMENT","\/**\n     * Gets rates for all the customer tax classes\n     *\n     * @param Varien_Object $request\n     * @return array\n     *\/",560],["T_WHITESPACE","\n    ",565],["T_PUBLIC","public",566],["T_WHITESPACE"," ",566],["T_FUNCTION","function",566],["T_WHITESPACE"," ",566],["T_STRING","getRatesForAllCustomerTaxClasses",566],"(",["T_VARIABLE","$request",566],")",["T_WHITESPACE","\n    ",566],"{",["T_WHITESPACE","\n        ",567],["T_RETURN","return",568],["T_WHITESPACE"," ",568],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_getRates",568],"(",["T_VARIABLE","$request",568],",",["T_WHITESPACE"," ",568],["T_CONSTANT_ENCAPSED_STRING","'customer_class_id'",568],",",["T_WHITESPACE"," ",568],["T_STRING","Mage_Tax_Model_Class",568],["T_DOUBLE_COLON","::",568],["T_STRING","TAX_CLASS_TYPE_CUSTOMER",568],")",";",["T_WHITESPACE","\n    ",568],"}",["T_WHITESPACE","\n\n    ",569],["T_DOC_COMMENT","\/**\n     * Get information about tax rates applied to request\n     *\n     * @param   Varien_Object $request\n     * @return  array\n     *\/",571],["T_WHITESPACE","\n    ",576],["T_PUBLIC","public",577],["T_WHITESPACE"," ",577],["T_FUNCTION","function",577],["T_WHITESPACE"," ",577],["T_STRING","getAppliedRates",577],"(",["T_VARIABLE","$request",577],")",["T_WHITESPACE","\n    ",577],"{",["T_WHITESPACE","\n        ",578],["T_IF","if",579],["T_WHITESPACE"," ",579],"(","!",["T_VARIABLE","$request",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","getCountryId",579],"(",")",["T_WHITESPACE"," ",579],["T_BOOLEAN_OR","||",579],["T_WHITESPACE"," ",579],"!",["T_VARIABLE","$request",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","getCustomerClassId",579],"(",")",["T_WHITESPACE"," ",579],["T_BOOLEAN_OR","||",579],["T_WHITESPACE"," ",579],"!",["T_VARIABLE","$request",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","getProductClassId",579],"(",")",")",["T_WHITESPACE"," ",579],"{",["T_WHITESPACE","\n            ",579],["T_RETURN","return",580],["T_WHITESPACE"," ",580],["T_ARRAY","array",580],"(",")",";",["T_WHITESPACE","\n        ",580],"}",["T_WHITESPACE","\n\n        ",581],["T_VARIABLE","$cacheKey",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","_getRequestCacheKey",583],"(",["T_VARIABLE","$request",583],")",";",["T_WHITESPACE","\n        ",583],["T_IF","if",584],["T_WHITESPACE"," ",584],"(","!",["T_ISSET","isset",584],"(",["T_VARIABLE","$this",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","_rateCalculationProcess",584],"[",["T_VARIABLE","$cacheKey",584],"]",")",")",["T_WHITESPACE"," ",584],"{",["T_WHITESPACE","\n            ",584],["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","_rateCalculationProcess",585],"[",["T_VARIABLE","$cacheKey",585],"]",["T_WHITESPACE"," ",585],"=",["T_WHITESPACE"," ",585],["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","_getResource",585],"(",")",["T_OBJECT_OPERATOR","->",585],["T_STRING","getCalculationProcess",585],"(",["T_VARIABLE","$request",585],")",";",["T_WHITESPACE","\n        ",585],"}",["T_WHITESPACE","\n        ",586],["T_RETURN","return",587],["T_WHITESPACE"," ",587],["T_VARIABLE","$this",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","_rateCalculationProcess",587],"[",["T_VARIABLE","$cacheKey",587],"]",";",["T_WHITESPACE","\n    ",587],"}",["T_WHITESPACE","\n\n    ",588],["T_DOC_COMMENT","\/**\n     * Get rate ids applicable for some address\n     *\n     * @param Varien_Object $request\n     * @return array\n     *\/",590],["T_WHITESPACE","\n    ",595],["T_PUBLIC","public",596],["T_WHITESPACE"," ",596],["T_FUNCTION","function",596],["T_WHITESPACE"," ",596],["T_STRING","getApplicableRateIds",596],"(",["T_VARIABLE","$request",596],")",["T_WHITESPACE","\n    ",596],"{",["T_WHITESPACE","\n        ",597],["T_RETURN","return",598],["T_WHITESPACE"," ",598],["T_VARIABLE","$this",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","_getResource",598],"(",")",["T_OBJECT_OPERATOR","->",598],["T_STRING","getApplicableRateIds",598],"(",["T_VARIABLE","$request",598],")",";",["T_WHITESPACE","\n    ",598],"}",["T_WHITESPACE","\n\n    ",599],["T_DOC_COMMENT","\/**\n     * Get the calculation process\n     *\n     * @param array $rates\n     * @return mixed\n     *\/",601],["T_WHITESPACE","\n    ",606],["T_PUBLIC","public",607],["T_WHITESPACE"," ",607],["T_FUNCTION","function",607],["T_WHITESPACE"," ",607],["T_STRING","reproduceProcess",607],"(",["T_VARIABLE","$rates",607],")",["T_WHITESPACE","\n    ",607],"{",["T_WHITESPACE","\n        ",608],["T_RETURN","return",609],["T_WHITESPACE"," ",609],["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","getResource",609],"(",")",["T_OBJECT_OPERATOR","->",609],["T_STRING","getCalculationProcess",609],"(",["T_STRING","null",609],",",["T_WHITESPACE"," ",609],["T_VARIABLE","$rates",609],")",";",["T_WHITESPACE","\n    ",609],"}",["T_WHITESPACE","\n\n    ",610],["T_DOC_COMMENT","\/**\n     * Get rates by customer tax class\n     *\n     * @param int $customerTaxClass\n     * @return mixed\n     *\/",612],["T_WHITESPACE","\n    ",617],["T_PUBLIC","public",618],["T_WHITESPACE"," ",618],["T_FUNCTION","function",618],["T_WHITESPACE"," ",618],["T_STRING","getRatesByCustomerTaxClass",618],"(",["T_VARIABLE","$customerTaxClass",618],")",["T_WHITESPACE","\n    ",618],"{",["T_WHITESPACE","\n        ",619],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_VARIABLE","$this",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","getResource",620],"(",")",["T_OBJECT_OPERATOR","->",620],["T_STRING","getRatesByCustomerTaxClass",620],"(",["T_VARIABLE","$customerTaxClass",620],")",";",["T_WHITESPACE","\n    ",620],"}",["T_WHITESPACE","\n\n    ",621],["T_DOC_COMMENT","\/**\n     * Get rates by customer and product classes\n     *\n     * @param int $customerTaxClass\n     * @param int $productTaxClass\n     * @return mixed\n     *\/",623],["T_WHITESPACE","\n    ",629],["T_PUBLIC","public",630],["T_WHITESPACE"," ",630],["T_FUNCTION","function",630],["T_WHITESPACE"," ",630],["T_STRING","getRatesByCustomerAndProductTaxClasses",630],"(",["T_VARIABLE","$customerTaxClass",630],",",["T_WHITESPACE"," ",630],["T_VARIABLE","$productTaxClass",630],")",["T_WHITESPACE","\n    ",630],"{",["T_WHITESPACE","\n        ",631],["T_RETURN","return",632],["T_WHITESPACE"," ",632],["T_VARIABLE","$this",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","getResource",632],"(",")",["T_OBJECT_OPERATOR","->",632],["T_STRING","getRatesByCustomerTaxClass",632],"(",["T_VARIABLE","$customerTaxClass",632],",",["T_WHITESPACE"," ",632],["T_VARIABLE","$productTaxClass",632],")",";",["T_WHITESPACE","\n    ",632],"}",["T_WHITESPACE","\n\n    ",633],["T_DOC_COMMENT","\/**\n     * Calculate rated tax abount based on price and tax rate.\n     * If you are using price including tax $priceIncludeTax should be true.\n     *\n     * @param   float $price\n     * @param   float $taxRate\n     * @param   boolean $priceIncludeTax\n     * @param   boolean $round\n     * @return  float\n     *\/",635],["T_WHITESPACE","\n    ",644],["T_PUBLIC","public",645],["T_WHITESPACE"," ",645],["T_FUNCTION","function",645],["T_WHITESPACE"," ",645],["T_STRING","calcTaxAmount",645],"(",["T_VARIABLE","$price",645],",",["T_WHITESPACE"," ",645],["T_VARIABLE","$taxRate",645],",",["T_WHITESPACE"," ",645],["T_VARIABLE","$priceIncludeTax",645],["T_WHITESPACE"," ",645],"=",["T_WHITESPACE"," ",645],["T_STRING","false",645],",",["T_WHITESPACE"," ",645],["T_VARIABLE","$round",645],["T_WHITESPACE"," ",645],"=",["T_WHITESPACE"," ",645],["T_STRING","true",645],")",["T_WHITESPACE","\n    ",645],"{",["T_WHITESPACE","\n        ",646],["T_VARIABLE","$taxRate",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_VARIABLE","$taxRate",647],["T_WHITESPACE"," ",647],"\/",["T_WHITESPACE"," ",647],["T_LNUMBER","100",647],";",["T_WHITESPACE","\n\n        ",647],["T_IF","if",649],["T_WHITESPACE"," ",649],"(",["T_VARIABLE","$priceIncludeTax",649],")",["T_WHITESPACE"," ",649],"{",["T_WHITESPACE","\n            ",649],["T_VARIABLE","$amount",650],["T_WHITESPACE"," ",650],"=",["T_WHITESPACE"," ",650],["T_VARIABLE","$price",650],["T_WHITESPACE"," ",650],"*",["T_WHITESPACE"," ",650],"(",["T_LNUMBER","1",650],["T_WHITESPACE"," ",650],"-",["T_WHITESPACE"," ",650],["T_LNUMBER","1",650],["T_WHITESPACE"," ",650],"\/",["T_WHITESPACE"," ",650],"(",["T_LNUMBER","1",650],["T_WHITESPACE"," ",650],"+",["T_WHITESPACE"," ",650],["T_VARIABLE","$taxRate",650],")",")",";",["T_WHITESPACE","\n        ",650],"}",["T_WHITESPACE"," ",651],["T_ELSE","else",651],["T_WHITESPACE"," ",651],"{",["T_WHITESPACE","\n            ",651],["T_VARIABLE","$amount",652],["T_WHITESPACE"," ",652],"=",["T_WHITESPACE"," ",652],["T_VARIABLE","$price",652],["T_WHITESPACE"," ",652],"*",["T_WHITESPACE"," ",652],["T_VARIABLE","$taxRate",652],";",["T_WHITESPACE","\n        ",652],"}",["T_WHITESPACE","\n\n        ",653],["T_IF","if",655],["T_WHITESPACE"," ",655],"(",["T_VARIABLE","$round",655],")",["T_WHITESPACE"," ",655],"{",["T_WHITESPACE","\n            ",655],["T_RETURN","return",656],["T_WHITESPACE"," ",656],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","round",656],"(",["T_VARIABLE","$amount",656],")",";",["T_WHITESPACE","\n        ",656],"}",["T_WHITESPACE","\n\n        ",657],["T_RETURN","return",659],["T_WHITESPACE"," ",659],["T_VARIABLE","$amount",659],";",["T_WHITESPACE","\n    ",659],"}",["T_WHITESPACE","\n\n    ",660],["T_DOC_COMMENT","\/**\n     * Truncate number to specified precision\n     *\n     * @param   float $price\n     * @param   int $precision\n     * @return  float\n     *\/",662],["T_WHITESPACE","\n    ",668],["T_PUBLIC","public",669],["T_WHITESPACE"," ",669],["T_FUNCTION","function",669],["T_WHITESPACE"," ",669],["T_STRING","truncate",669],"(",["T_VARIABLE","$price",669],",",["T_WHITESPACE"," ",669],["T_VARIABLE","$precision",669],["T_WHITESPACE"," ",669],"=",["T_WHITESPACE"," ",669],["T_LNUMBER","4",669],")",["T_WHITESPACE","\n    ",669],"{",["T_WHITESPACE","\n        ",670],["T_VARIABLE","$exp",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_STRING","pow",671],"(",["T_LNUMBER","10",671],",",["T_WHITESPACE"," ",671],["T_VARIABLE","$precision",671],")",";",["T_WHITESPACE","\n        ",671],["T_VARIABLE","$price",672],["T_WHITESPACE"," ",672],"=",["T_WHITESPACE"," ",672],["T_STRING","floor",672],"(",["T_VARIABLE","$price",672],["T_WHITESPACE"," ",672],"*",["T_WHITESPACE"," ",672],["T_VARIABLE","$exp",672],")",["T_WHITESPACE"," ",672],"\/",["T_WHITESPACE"," ",672],["T_VARIABLE","$exp",672],";",["T_WHITESPACE","\n        ",672],["T_RETURN","return",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$price",673],";",["T_WHITESPACE","\n    ",673],"}",["T_WHITESPACE","\n\n    ",674],["T_DOC_COMMENT","\/**\n     * Round tax amount\n     *\n     * @param   float $price\n     * @return  float\n     *\/",676],["T_WHITESPACE","\n    ",681],["T_PUBLIC","public",682],["T_WHITESPACE"," ",682],["T_FUNCTION","function",682],["T_WHITESPACE"," ",682],["T_STRING","round",682],"(",["T_VARIABLE","$price",682],")",["T_WHITESPACE","\n    ",682],"{",["T_WHITESPACE","\n        ",683],["T_RETURN","return",684],["T_WHITESPACE"," ",684],["T_STRING","Mage",684],["T_DOUBLE_COLON","::",684],["T_STRING","app",684],"(",")",["T_OBJECT_OPERATOR","->",684],["T_STRING","getStore",684],"(",")",["T_OBJECT_OPERATOR","->",684],["T_STRING","roundPrice",684],"(",["T_VARIABLE","$price",684],")",";",["T_WHITESPACE","\n    ",684],"}",["T_WHITESPACE","\n\n    ",685],["T_DOC_COMMENT","\/**\n     * Round price up\n     *\n     * @param   float $price\n     * @return  float\n     *\/",687],["T_WHITESPACE","\n    ",692],["T_PUBLIC","public",693],["T_WHITESPACE"," ",693],["T_FUNCTION","function",693],["T_WHITESPACE"," ",693],["T_STRING","roundUp",693],"(",["T_VARIABLE","$price",693],")",["T_WHITESPACE","\n    ",693],"{",["T_WHITESPACE","\n        ",694],["T_RETURN","return",695],["T_WHITESPACE"," ",695],["T_STRING","ceil",695],"(",["T_VARIABLE","$price",695],["T_WHITESPACE"," ",695],"*",["T_WHITESPACE"," ",695],["T_LNUMBER","100",695],")",["T_WHITESPACE"," ",695],"\/",["T_WHITESPACE"," ",695],["T_LNUMBER","100",695],";",["T_WHITESPACE","\n    ",695],"}",["T_WHITESPACE","\n\n    ",696],["T_DOC_COMMENT","\/**\n     * Round price down\n     *\n     * @param   float $price\n     * @return  float\n     *\/",698],["T_WHITESPACE","\n    ",703],["T_PUBLIC","public",704],["T_WHITESPACE"," ",704],["T_FUNCTION","function",704],["T_WHITESPACE"," ",704],["T_STRING","roundDown",704],"(",["T_VARIABLE","$price",704],")",["T_WHITESPACE","\n    ",704],"{",["T_WHITESPACE","\n        ",705],["T_RETURN","return",706],["T_WHITESPACE"," ",706],["T_STRING","floor",706],"(",["T_VARIABLE","$price",706],["T_WHITESPACE"," ",706],"*",["T_WHITESPACE"," ",706],["T_LNUMBER","100",706],")",["T_WHITESPACE"," ",706],"\/",["T_WHITESPACE"," ",706],["T_LNUMBER","100",706],";",["T_WHITESPACE","\n    ",706],"}",["T_WHITESPACE","\n",707],"}",["T_WHITESPACE","\n",708]]