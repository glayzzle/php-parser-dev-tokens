[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_ConfigurableSwatches\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Class Mage_ConfigurableSwatches_Helper_Productimg\n *\/",27],["T_WHITESPACE","\n",29],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_ConfigurableSwatches_Helper_Productimg",30],["T_WHITESPACE"," ",30],["T_EXTENDS","extends",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Core_Helper_Abstract",30],["T_WHITESPACE","\n",30],"{",["T_WHITESPACE","\n    ",31],["T_DOC_COMMENT","\/**\n     * This array stores product images and separates them:\n     * One group keyed by labels that match attribute values, another for all other images\n     *\n     * @var array\n     *\/",32],["T_WHITESPACE","\n    ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$_productImagesByLabel",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",")",";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * This array stores all possible labels and swatch labels used for associating gallery\n     * images with swatches and main image swaps. It's use is for filtering the image gallery.\n     *\n     * @var array\n     *\/",40],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$_productImageFilters",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_ARRAY","array",46],"(",")",";",["T_WHITESPACE","\n\n    ",46],["T_CONST","const",48],["T_WHITESPACE"," ",48],["T_STRING","SWATCH_LABEL_SUFFIX",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'-swatch'",48],";",["T_WHITESPACE","\n    ",48],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","SWATCH_FALLBACK_MEDIA_DIR",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'wysiwyg\/swatches'",49],";",["T_WHITESPACE","\n    ",49],["T_CONST","const",50],["T_WHITESPACE"," ",50],["T_STRING","SWATCH_CACHE_DIR",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'catalog\/swatches'",50],";",["T_WHITESPACE","\n    ",50],["T_CONST","const",51],["T_WHITESPACE"," ",51],["T_STRING","SWATCH_FILE_EXT",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'.png'",51],";",["T_WHITESPACE","\n\n    ",51],["T_CONST","const",53],["T_WHITESPACE"," ",53],["T_STRING","MEDIA_IMAGE_TYPE_BASE",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'base_image'",53],";",["T_WHITESPACE","\n    ",53],["T_CONST","const",54],["T_WHITESPACE"," ",54],["T_STRING","MEDIA_IMAGE_TYPE_SMALL",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'small_image'",54],";",["T_WHITESPACE","\n\n    ",54],["T_CONST","const",56],["T_WHITESPACE"," ",56],["T_STRING","SWATCH_DEFAULT_WIDTH",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_LNUMBER","21",56],";",["T_WHITESPACE","\n    ",56],["T_CONST","const",57],["T_WHITESPACE"," ",57],["T_STRING","SWATCH_DEFAULT_HEIGHT",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_LNUMBER","21",57],";",["T_WHITESPACE","\n\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Determine if the passed text matches the label of any of the passed product's images\n     *\n     * @param string $text\n     * @param Mage_Catalog_Model_Product $product\n     * @param string $type\n     * @return Varien_Object|null\n     *\/",60],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","getProductImgByLabel",68],"(",["T_VARIABLE","$text",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$product",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$type",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","null",68],")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","indexProductImages",70],"(",["T_VARIABLE","$product",70],")",";",["T_WHITESPACE","\n\n        ",70],["T_COMMENT","\/\/Get the product's image array and prepare the text\n",72],["T_WHITESPACE","        ",73],["T_VARIABLE","$images",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_productImagesByLabel",73],"[",["T_VARIABLE","$product",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getId",73],"(",")","]",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$text",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","Mage_ConfigurableSwatches_Helper_Data",74],["T_DOUBLE_COLON","::",74],["T_STRING","normalizeKey",74],"(",["T_VARIABLE","$text",74],")",";",["T_WHITESPACE","\n\n        ",74],["T_VARIABLE","$resultImages",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_ARRAY","array",76],"(",["T_WHITESPACE","\n            ",76],["T_CONSTANT_ENCAPSED_STRING","'standard'",77],["T_WHITESPACE"," ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_ISSET","isset",77],"(",["T_VARIABLE","$images",77],"[",["T_VARIABLE","$text",77],"]",")",["T_WHITESPACE"," ",77],"?",["T_WHITESPACE"," ",77],["T_VARIABLE","$images",77],"[",["T_VARIABLE","$text",77],"]",["T_WHITESPACE"," ",77],":",["T_WHITESPACE"," ",77],["T_STRING","null",77],",",["T_WHITESPACE","\n            ",77],["T_CONSTANT_ENCAPSED_STRING","'swatch'",78],["T_WHITESPACE"," ",78],["T_DOUBLE_ARROW","=>",78],["T_WHITESPACE"," ",78],["T_ISSET","isset",78],"(",["T_VARIABLE","$images",78],"[",["T_VARIABLE","$text",78],["T_WHITESPACE"," ",78],".",["T_WHITESPACE"," ",78],["T_STRING","self",78],["T_DOUBLE_COLON","::",78],["T_STRING","SWATCH_LABEL_SUFFIX",78],"]",")",["T_WHITESPACE"," ",78],"?",["T_WHITESPACE"," ",78],["T_VARIABLE","$images",78],"[",["T_VARIABLE","$text",78],["T_WHITESPACE"," ",78],".",["T_WHITESPACE"," ",78],["T_STRING","self",78],["T_DOUBLE_COLON","::",78],["T_STRING","SWATCH_LABEL_SUFFIX",78],"]",["T_WHITESPACE","\n                ",78],":",["T_WHITESPACE"," ",79],["T_STRING","null",79],",",["T_WHITESPACE","\n        ",79],")",";",["T_WHITESPACE","\n\n        ",80],["T_IF","if",82],["T_WHITESPACE"," ",82],"(","!",["T_STRING","is_null",82],"(",["T_VARIABLE","$type",82],")",["T_WHITESPACE"," ",82],["T_BOOLEAN_AND","&&",82],["T_WHITESPACE"," ",82],["T_STRING","array_key_exists",82],"(",["T_VARIABLE","$type",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$resultImages",82],")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$image",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$resultImages",83],"[",["T_VARIABLE","$type",83],"]",";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE"," ",84],["T_ELSE","else",84],["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$image",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],"(","!",["T_STRING","is_null",85],"(",["T_VARIABLE","$resultImages",85],"[",["T_CONSTANT_ENCAPSED_STRING","'swatch'",85],"]",")",")",["T_WHITESPACE"," ",85],"?",["T_WHITESPACE"," ",85],["T_VARIABLE","$resultImages",85],"[",["T_CONSTANT_ENCAPSED_STRING","'swatch'",85],"]",["T_WHITESPACE"," ",85],":",["T_WHITESPACE"," ",85],["T_VARIABLE","$resultImages",85],"[",["T_CONSTANT_ENCAPSED_STRING","'standard'",85],"]",";",["T_WHITESPACE","\n        ",85],"}",["T_WHITESPACE","\n\n        ",86],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$image",88],";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Create the separated index of product images\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param array|null $preValues\n     * @return Mage_ConfigurableSwatches_Helper_Data\n     *\/",91],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","indexProductImages",98],"(",["T_VARIABLE","$product",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$preValues",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","null",98],")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$product",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getTypeId",100],"(",")",["T_WHITESPACE"," ",100],["T_IS_NOT_EQUAL","!=",100],["T_WHITESPACE"," ",100],["T_STRING","Mage_Catalog_Model_Product_Type",100],["T_DOUBLE_COLON","::",100],["T_STRING","TYPE_CONFIGURABLE",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_RETURN","return",101],";",["T_WHITESPACE"," ",101],["T_COMMENT","\/\/ we only index images on configurable products\n",101],["T_WHITESPACE","        ",102],"}",["T_WHITESPACE","\n\n        ",102],["T_IF","if",104],["T_WHITESPACE"," ",104],"(","!",["T_ISSET","isset",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_productImagesByLabel",104],"[",["T_VARIABLE","$product",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getId",104],"(",")","]",")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$images",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_ARRAY","array",105],"(",")",";",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$searchValues",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_ARRAY","array",106],"(",")",";",["T_WHITESPACE","\n\n            ",106],["T_IF","if",108],["T_WHITESPACE"," ",108],"(","!",["T_STRING","is_null",108],"(",["T_VARIABLE","$preValues",108],")",["T_WHITESPACE"," ",108],["T_BOOLEAN_AND","&&",108],["T_WHITESPACE"," ",108],["T_STRING","is_array",108],"(",["T_VARIABLE","$preValues",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE"," ",108],["T_COMMENT","\/\/ If a pre-defined list of valid values was passed\n",108],["T_WHITESPACE","                ",109],["T_VARIABLE","$preValues",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_STRING","array_map",109],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_ConfigurableSwatches_Helper_Data::normalizeKey'",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$preValues",109],")",";",["T_WHITESPACE","\n                ",109],["T_FOREACH","foreach",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$preValues",110],["T_WHITESPACE"," ",110],["T_AS","as",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$value",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                    ",110],["T_VARIABLE","$searchValues",111],"[","]",["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$value",111],";",["T_WHITESPACE","\n                ",111],"}",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE"," ",113],["T_ELSE","else",113],["T_WHITESPACE"," ",113],"{",["T_WHITESPACE"," ",113],["T_COMMENT","\/\/ we get them from all config attributes if no pre-defined list is passed in\n",113],["T_WHITESPACE","                ",114],["T_VARIABLE","$attributes",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$product",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getTypeInstance",114],"(",["T_STRING","true",114],")",["T_OBJECT_OPERATOR","->",114],["T_STRING","getConfigurableAttributes",114],"(",["T_VARIABLE","$product",114],")",";",["T_WHITESPACE","\n\n                ",114],["T_COMMENT","\/\/ Collect valid values of image type attributes\n",116],["T_WHITESPACE","                ",117],["T_FOREACH","foreach",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$attributes",117],["T_WHITESPACE"," ",117],["T_AS","as",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$attribute",117],")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n                    ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","helper",118],"(",["T_CONSTANT_ENCAPSED_STRING","'configurableswatches'",118],")",["T_OBJECT_OPERATOR","->",118],["T_STRING","attrIsSwatchType",118],"(",["T_VARIABLE","$attribute",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getAttributeId",118],"(",")",")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n                        ",118],["T_FOREACH","foreach",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$attribute",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getPrices",119],"(",")",["T_WHITESPACE"," ",119],["T_AS","as",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$option",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE"," ",119],["T_COMMENT","\/\/ getPrices returns info on individual options\n",119],["T_WHITESPACE","                            ",120],["T_VARIABLE","$searchValues",120],"[","]",["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","Mage_ConfigurableSwatches_Helper_Data",120],["T_DOUBLE_COLON","::",120],["T_STRING","normalizeKey",120],"(",["T_VARIABLE","$option",120],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",120],"]",")",";",["T_WHITESPACE","\n                        ",120],"}",["T_WHITESPACE","\n                    ",121],"}",["T_WHITESPACE","\n                ",122],"}",["T_WHITESPACE","\n            ",123],"}",["T_WHITESPACE","\n\n            ",124],["T_VARIABLE","$mapping",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$product",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getChildAttributeLabelMapping",126],"(",")",";",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$mediaGallery",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$product",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getMediaGallery",127],"(",")",";",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$mediaGalleryImages",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$product",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getMediaGalleryImages",128],"(",")",";",["T_WHITESPACE","\n\n            ",128],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_EMPTY","empty",130],"(",["T_VARIABLE","$mediaGallery",130],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",130],"]",")",["T_WHITESPACE"," ",130],["T_BOOLEAN_OR","||",130],["T_WHITESPACE"," ",130],["T_EMPTY","empty",130],"(",["T_VARIABLE","$mediaGalleryImages",130],")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_productImagesByLabel",131],"[",["T_VARIABLE","$product",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getId",131],"(",")","]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_ARRAY","array",131],"(",")",";",["T_WHITESPACE","\n                ",131],["T_RETURN","return",132],";",["T_WHITESPACE"," ",132],["T_COMMENT","\/\/nothing to do here\n",132],["T_WHITESPACE","            ",133],"}",["T_WHITESPACE","\n\n            ",133],["T_VARIABLE","$imageHaystack",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","array_map",135],"(",["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$value",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                ",135],["T_RETURN","return",136],["T_WHITESPACE"," ",136],["T_STRING","Mage_ConfigurableSwatches_Helper_Data",136],["T_DOUBLE_COLON","::",136],["T_STRING","normalizeKey",136],"(",["T_VARIABLE","$value",136],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",136],"]",")",";",["T_WHITESPACE","\n            ",136],"}",",",["T_WHITESPACE"," ",137],["T_VARIABLE","$mediaGallery",137],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",137],"]",")",";",["T_WHITESPACE","\n\n            ",137],["T_FOREACH","foreach",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$searchValues",139],["T_WHITESPACE"," ",139],["T_AS","as",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$label",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$imageKeys",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_ARRAY","array",140],"(",")",";",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$swatchLabel",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$label",141],["T_WHITESPACE"," ",141],".",["T_WHITESPACE"," ",141],["T_STRING","self",141],["T_DOUBLE_COLON","::",141],["T_STRING","SWATCH_LABEL_SUFFIX",141],";",["T_WHITESPACE","\n\n                ",141],["T_VARIABLE","$imageKeys",143],"[",["T_VARIABLE","$label",143],"]",["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_STRING","array_search",143],"(",["T_VARIABLE","$label",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$imageHaystack",143],")",";",["T_WHITESPACE","\n                ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(",["T_VARIABLE","$imageKeys",144],"[",["T_VARIABLE","$label",144],"]",["T_WHITESPACE"," ",144],["T_IS_IDENTICAL","===",144],["T_WHITESPACE"," ",144],["T_STRING","false",144],")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                    ",144],["T_VARIABLE","$imageKeys",145],"[",["T_VARIABLE","$label",145],"]",["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_STRING","array_search",145],"(",["T_VARIABLE","$mapping",145],"[",["T_VARIABLE","$label",145],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default_label'",145],"]",",",["T_WHITESPACE"," ",145],["T_VARIABLE","$imageHaystack",145],")",";",["T_WHITESPACE","\n                ",145],"}",["T_WHITESPACE","\n\n                ",146],["T_VARIABLE","$imageKeys",148],"[",["T_VARIABLE","$swatchLabel",148],"]",["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_STRING","array_search",148],"(",["T_VARIABLE","$swatchLabel",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$imageHaystack",148],")",";",["T_WHITESPACE","\n                ",148],["T_IF","if",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$imageKeys",149],"[",["T_VARIABLE","$swatchLabel",149],"]",["T_WHITESPACE"," ",149],["T_IS_IDENTICAL","===",149],["T_WHITESPACE"," ",149],["T_STRING","false",149],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n                    ",149],["T_VARIABLE","$imageKeys",150],"[",["T_VARIABLE","$swatchLabel",150],"]",["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","array_search",150],"(",["T_WHITESPACE","\n                        ",150],["T_VARIABLE","$mapping",151],"[",["T_VARIABLE","$label",151],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default_label'",151],"]",["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_STRING","self",151],["T_DOUBLE_COLON","::",151],["T_STRING","SWATCH_LABEL_SUFFIX",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$imageHaystack",151],["T_WHITESPACE","\n                    ",151],")",";",["T_WHITESPACE","\n                ",152],"}",["T_WHITESPACE","\n\n                ",153],["T_FOREACH","foreach",155],["T_WHITESPACE"," ",155],"(",["T_VARIABLE","$imageKeys",155],["T_WHITESPACE"," ",155],["T_AS","as",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$imageLabel",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$imageKey",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n                    ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_VARIABLE","$imageKey",156],["T_WHITESPACE"," ",156],["T_IS_NOT_IDENTICAL","!==",156],["T_WHITESPACE"," ",156],["T_STRING","false",156],")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                        ",156],["T_VARIABLE","$imageId",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$mediaGallery",157],"[",["T_CONSTANT_ENCAPSED_STRING","'images'",157],"]","[",["T_VARIABLE","$imageKey",157],"]","[",["T_CONSTANT_ENCAPSED_STRING","'value_id'",157],"]",";",["T_WHITESPACE","\n                        ",157],["T_VARIABLE","$images",158],"[",["T_VARIABLE","$imageLabel",158],"]",["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$mediaGalleryImages",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getItemById",158],"(",["T_VARIABLE","$imageId",158],")",";",["T_WHITESPACE","\n                    ",158],"}",["T_WHITESPACE","\n                ",159],"}",["T_WHITESPACE","\n            ",160],"}",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_productImagesByLabel",162],"[",["T_VARIABLE","$product",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getId",162],"(",")","]",["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$images",162],";",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Return the appropriate swatch URL for the given value (matches against product's image labels)\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param string $value\n     * @param int $width\n     * @param int $height\n     * @param $swatchType\n     * @param string $fallbackFileExt\n     * @return string\n     *\/",166],["T_WHITESPACE","\n    ",176],["T_PUBLIC","public",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","getSwatchUrl",177],"(",["T_VARIABLE","$product",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$value",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$width",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","self",177],["T_DOUBLE_COLON","::",177],["T_STRING","SWATCH_DEFAULT_WIDTH",177],",",["T_WHITESPACE","\n         ",177],["T_VARIABLE","$height",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_STRING","self",178],["T_DOUBLE_COLON","::",178],["T_STRING","SWATCH_DEFAULT_HEIGHT",178],",",["T_WHITESPACE"," ",178],"&",["T_VARIABLE","$swatchType",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$fallbackFileExt",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_STRING","null",178],["T_WHITESPACE","\n    ",178],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$url",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_CONSTANT_ENCAPSED_STRING","''",180],";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$swatchType",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'none'",181],";",["T_WHITESPACE","\n\n        ",181],["T_COMMENT","\/\/ Get the (potential) swatch image that matches the value\n",183],["T_WHITESPACE","        ",184],["T_VARIABLE","$image",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getProductImgByLabel",184],"(",["T_VARIABLE","$value",184],",",["T_WHITESPACE"," ",184],["T_VARIABLE","$product",184],",",["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'swatch'",184],")",";",["T_WHITESPACE","\n\n        ",184],["T_COMMENT","\/\/ Check in swatch directory if $image is null\n",186],["T_WHITESPACE","        ",187],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_STRING","is_null",187],"(",["T_VARIABLE","$image",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_COMMENT","\/\/ Check if file exists in fallback directory\n",188],["T_WHITESPACE","            ",189],["T_VARIABLE","$fallbackUrl",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getGlobalSwatchUrl",189],"(",["T_VARIABLE","$product",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$value",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$width",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$height",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$fallbackFileExt",189],")",";",["T_WHITESPACE","\n            ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_EMPTY","empty",190],"(",["T_VARIABLE","$fallbackUrl",190],")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$url",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$fallbackUrl",191],";",["T_WHITESPACE","\n                ",191],["T_VARIABLE","$swatchType",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_CONSTANT_ENCAPSED_STRING","'media'",192],";",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n\n        ",194],["T_COMMENT","\/\/ If we still don't have a URL or matching product image, look for one that matches just\n",196],["T_WHITESPACE","        ",197],["T_COMMENT","\/\/ the label (not specifically the swatch suffix)\n",197],["T_WHITESPACE","        ",198],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_EMPTY","empty",198],"(",["T_VARIABLE","$url",198],")",["T_WHITESPACE"," ",198],["T_BOOLEAN_AND","&&",198],["T_WHITESPACE"," ",198],["T_STRING","is_null",198],"(",["T_VARIABLE","$image",198],")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$image",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getProductImgByLabel",199],"(",["T_VARIABLE","$value",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$product",199],",",["T_WHITESPACE"," ",199],["T_CONSTANT_ENCAPSED_STRING","'standard'",199],")",";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n\n        ",200],["T_IF","if",202],["T_WHITESPACE"," ",202],"(","!",["T_STRING","is_null",202],"(",["T_VARIABLE","$image",202],")",")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$filename",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$image",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getFile",203],"(",")",";",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$swatchImage",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_resizeSwatchImage",204],"(",["T_VARIABLE","$filename",204],",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'product'",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$width",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$height",204],")",";",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$swatchType",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'product'",205],";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$url",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_STRING","Mage",206],["T_DOUBLE_COLON","::",206],["T_STRING","getBaseUrl",206],"(",["T_STRING","Mage_Core_Model_Store",206],["T_DOUBLE_COLON","::",206],["T_STRING","URL_TYPE_MEDIA",206],")",["T_WHITESPACE"," ",206],".",["T_WHITESPACE"," ",206],["T_VARIABLE","$swatchImage",206],";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n\n        ",207],["T_RETURN","return",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$url",209],";",["T_WHITESPACE","\n    ",209],"}",["T_WHITESPACE","\n\n    ",210],["T_DOC_COMMENT","\/**\n     * Return URL for a matching swatch image from the global directory\n     *\n     * @param Mage_Catalog_Model_Product|Mage_Catalog_Model_Layer_Filter_Item $object\n     * @param string $value\n     * @param int $width\n     * @param int $height\n     * @param string $fileExt\n     * @throws Mage_Core_Exception\n     * @return string\n     *\/",212],["T_WHITESPACE","\n    ",222],["T_PUBLIC","public",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","getGlobalSwatchUrl",223],"(",["T_VARIABLE","$object",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$value",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$width",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_STRING","self",223],["T_DOUBLE_COLON","::",223],["T_STRING","SWATCH_DEFAULT_WIDTH",223],",",["T_WHITESPACE","\n        ",223],["T_VARIABLE","$height",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","self",224],["T_DOUBLE_COLON","::",224],["T_STRING","SWATCH_DEFAULT_HEIGHT",224],",",["T_WHITESPACE"," ",224],["T_VARIABLE","$fileExt",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","null",224],["T_WHITESPACE","\n    ",224],")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n        ",225],["T_IF","if",226],["T_WHITESPACE"," ",226],"(",["T_STRING","is_null",226],"(",["T_VARIABLE","$fileExt",226],")",")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$fileExt",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_STRING","self",227],["T_DOUBLE_COLON","::",227],["T_STRING","SWATCH_FILE_EXT",227],";",["T_WHITESPACE","\n        ",227],"}",["T_WHITESPACE","\n\n        ",228],["T_COMMENT","\/\/ normalize to all lower case so that value can be used as array key below\n",230],["T_WHITESPACE","        ",231],["T_VARIABLE","$value",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","Mage_ConfigurableSwatches_Helper_Data",231],["T_DOUBLE_COLON","::",231],["T_STRING","normalizeKey",231],"(",["T_VARIABLE","$value",231],")",";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$defaultValue",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_VARIABLE","$value",232],";",["T_WHITESPACE"," ",232],["T_COMMENT","\/\/ default to no fallback value\n",232],["T_WHITESPACE","        ",233],["T_IF","if",233],["T_WHITESPACE"," ",233],"(",["T_VARIABLE","$object",233],["T_WHITESPACE"," ",233],["T_INSTANCEOF","instanceof",233],["T_WHITESPACE"," ",233],["T_STRING","Mage_Catalog_Model_Layer_Filter_Item",233],")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE"," ",233],["T_COMMENT","\/\/ fallback for swatches loaded for nav filters\n",233],["T_WHITESPACE","            ",234],["T_VARIABLE","$source",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$object",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getFilter",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","getAttributeModel",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","getFrontend",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","getAttribute",234],"(",")",["T_OBJECT_OPERATOR","->",234],["T_STRING","getSource",234],"(",")",";",["T_WHITESPACE","\n            ",234],["T_FOREACH","foreach",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$source",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getAllOptions",235],"(",["T_STRING","false",235],",",["T_WHITESPACE"," ",235],["T_STRING","true",235],")",["T_WHITESPACE"," ",235],["T_AS","as",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$option",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n                ",235],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$option",236],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",236],"]",["T_WHITESPACE"," ",236],["T_IS_EQUAL","==",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$object",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getValue",236],"(",")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n                    ",236],["T_VARIABLE","$defaultValue",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_STRING","Mage_ConfigurableSwatches_Helper_Data",237],["T_DOUBLE_COLON","::",237],["T_STRING","normalizeKey",237],"(",["T_VARIABLE","$option",237],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",237],"]",")",";",["T_WHITESPACE","\n                    ",237],["T_BREAK","break",238],";",["T_WHITESPACE","\n                ",238],"}",["T_WHITESPACE","\n            ",239],"}",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE"," ",241],["T_ELSEIF","elseif",241],["T_WHITESPACE"," ",241],"(",["T_VARIABLE","$object",241],["T_WHITESPACE"," ",241],["T_INSTANCEOF","instanceof",241],["T_WHITESPACE"," ",241],["T_STRING","Mage_Catalog_Model_Product",241],")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","  ",241],["T_COMMENT","\/\/ fallback for swatches loaded for product view\n",241],["T_WHITESPACE","            ",242],["T_VARIABLE","$mapping",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$object",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getChildAttributeLabelMapping",242],"(",")",";",["T_WHITESPACE","\n            ",242],["T_IF","if",243],["T_WHITESPACE"," ",243],"(",["T_ISSET","isset",243],"(",["T_VARIABLE","$mapping",243],"[",["T_VARIABLE","$value",243],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default_label'",243],"]",")",")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n                ",243],["T_VARIABLE","$defaultValue",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$mapping",244],"[",["T_VARIABLE","$value",244],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default_label'",244],"]",";",["T_WHITESPACE","\n            ",244],"}",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE","\n\n        ",246],["T_DO","do",248],["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$filename",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_STRING","Mage",249],["T_DOUBLE_COLON","::",249],["T_STRING","helper",249],"(",["T_CONSTANT_ENCAPSED_STRING","'configurableswatches'",249],")",["T_OBJECT_OPERATOR","->",249],["T_STRING","getHyphenatedString",249],"(",["T_VARIABLE","$value",249],")",["T_WHITESPACE"," ",249],".",["T_WHITESPACE"," ",249],["T_VARIABLE","$fileExt",249],";",["T_WHITESPACE","\n            ",249],["T_VARIABLE","$swatchImage",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","_resizeSwatchImage",250],"(",["T_VARIABLE","$filename",250],",",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","'media'",250],",",["T_WHITESPACE"," ",250],["T_VARIABLE","$width",250],",",["T_WHITESPACE"," ",250],["T_VARIABLE","$height",250],")",";",["T_WHITESPACE","\n            ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(","!",["T_VARIABLE","$swatchImage",251],["T_WHITESPACE"," ",251],["T_BOOLEAN_AND","&&",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$defaultValue",251],["T_WHITESPACE"," ",251],["T_IS_EQUAL","==",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$value",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n                ",251],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","''",252],";",["T_WHITESPACE","  ",252],["T_COMMENT","\/\/ no image found and no further fallback\n",252],["T_WHITESPACE","            ",253],"}",["T_WHITESPACE"," ",253],["T_ELSEIF","elseif",253],["T_WHITESPACE"," ",253],"(","!",["T_VARIABLE","$swatchImage",253],")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n                ",253],["T_VARIABLE","$value",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$defaultValue",254],";",["T_WHITESPACE"," ",254],["T_COMMENT","\/\/ fallback to default value\n",254],["T_WHITESPACE","            ",255],"}",["T_WHITESPACE"," ",255],["T_ELSE","else",255],["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n                ",255],["T_BREAK","break",256],";",["T_WHITESPACE","  ",256],["T_COMMENT","\/\/ we found an image\n",256],["T_WHITESPACE","            ",257],"}",["T_WHITESPACE","\n        ",257],"}",["T_WHITESPACE"," ",258],["T_WHILE","while",258],["T_WHITESPACE"," ",258],"(",["T_STRING","true",258],")",";",["T_WHITESPACE","\n\n        ",258],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_STRING","Mage",260],["T_DOUBLE_COLON","::",260],["T_STRING","getBaseUrl",260],"(",["T_STRING","Mage_Core_Model_Store",260],["T_DOUBLE_COLON","::",260],["T_STRING","URL_TYPE_MEDIA",260],")",["T_WHITESPACE"," ",260],".",["T_WHITESPACE"," ",260],["T_VARIABLE","$swatchImage",260],";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n\n    ",261],["T_DOC_COMMENT","\/**\n     * Performs the resize operation on the given swatch image file and returns a\n     * relative path to the resulting image file\n     *\n     * @param string $filename\n     * @param string $tag\n     * @param int $width\n     * @param int $height\n     * @return string\n     *\/",263],["T_WHITESPACE","\n    ",272],["T_PROTECTED","protected",273],["T_WHITESPACE"," ",273],["T_FUNCTION","function",273],["T_WHITESPACE"," ",273],["T_STRING","_resizeSwatchImage",273],"(",["T_VARIABLE","$filename",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$tag",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$width",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$height",273],")",["T_WHITESPACE","\n    ",273],"{",["T_WHITESPACE","\n        ",274],["T_COMMENT","\/\/ Form full path to where we want to cache resized version\n",275],["T_WHITESPACE","        ",276],["T_VARIABLE","$destPathArr",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_ARRAY","array",276],"(",["T_WHITESPACE","\n            ",276],["T_STRING","self",277],["T_DOUBLE_COLON","::",277],["T_STRING","SWATCH_CACHE_DIR",277],",",["T_WHITESPACE","\n            ",277],["T_STRING","Mage",278],["T_DOUBLE_COLON","::",278],["T_STRING","app",278],"(",")",["T_OBJECT_OPERATOR","->",278],["T_STRING","getStore",278],"(",")",["T_OBJECT_OPERATOR","->",278],["T_STRING","getId",278],"(",")",",",["T_WHITESPACE","\n            ",278],["T_VARIABLE","$width",279],["T_WHITESPACE"," ",279],".",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'x'",279],["T_WHITESPACE"," ",279],".",["T_WHITESPACE"," ",279],["T_VARIABLE","$height",279],",",["T_WHITESPACE","\n            ",279],["T_VARIABLE","$tag",280],",",["T_WHITESPACE","\n            ",280],["T_STRING","trim",281],"(",["T_VARIABLE","$filename",281],",",["T_WHITESPACE"," ",281],["T_CONSTANT_ENCAPSED_STRING","'\/'",281],")",",",["T_WHITESPACE","\n        ",281],")",";",["T_WHITESPACE","\n\n        ",282],["T_VARIABLE","$destPath",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_STRING","implode",284],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",284],",",["T_WHITESPACE"," ",284],["T_VARIABLE","$destPathArr",284],")",";",["T_WHITESPACE","\n\n        ",284],["T_COMMENT","\/\/ Check if cached image exists already\n",286],["T_WHITESPACE","        ",287],["T_IF","if",287],["T_WHITESPACE"," ",287],"(","!",["T_STRING","file_exists",287],"(",["T_STRING","Mage",287],["T_DOUBLE_COLON","::",287],["T_STRING","getBaseDir",287],"(",["T_STRING","Mage_Core_Model_Store",287],["T_DOUBLE_COLON","::",287],["T_STRING","URL_TYPE_MEDIA",287],")",["T_WHITESPACE"," ",287],".",["T_WHITESPACE"," ",287],["T_STRING","DS",287],["T_WHITESPACE"," ",287],".",["T_WHITESPACE"," ",287],["T_VARIABLE","$destPath",287],")",")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n            ",287],["T_COMMENT","\/\/ Check for source image\n",288],["T_WHITESPACE","            ",289],["T_IF","if",289],["T_WHITESPACE"," ",289],"(",["T_VARIABLE","$tag",289],["T_WHITESPACE"," ",289],["T_IS_EQUAL","==",289],["T_WHITESPACE"," ",289],["T_CONSTANT_ENCAPSED_STRING","'product'",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n                ",289],["T_VARIABLE","$sourceFilePath",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","Mage",290],["T_DOUBLE_COLON","::",290],["T_STRING","getSingleton",290],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_media_config'",290],")",["T_OBJECT_OPERATOR","->",290],["T_STRING","getBaseMediaPath",290],"(",")",["T_WHITESPACE"," ",290],".",["T_WHITESPACE"," ",290],["T_VARIABLE","$filename",290],";",["T_WHITESPACE","\n            ",290],"}",["T_WHITESPACE"," ",291],["T_ELSE","else",291],["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n                ",291],["T_VARIABLE","$sourceFilePath",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_STRING","Mage",292],["T_DOUBLE_COLON","::",292],["T_STRING","getBaseDir",292],"(",["T_STRING","Mage_Core_Model_Store",292],["T_DOUBLE_COLON","::",292],["T_STRING","URL_TYPE_MEDIA",292],")",["T_WHITESPACE","\n                    ",292],".",["T_WHITESPACE"," ",293],["T_STRING","DS",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_STRING","self",293],["T_DOUBLE_COLON","::",293],["T_STRING","SWATCH_FALLBACK_MEDIA_DIR",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_STRING","DS",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_VARIABLE","$filename",293],";",["T_WHITESPACE","\n            ",293],"}",["T_WHITESPACE","\n\n            ",294],["T_IF","if",296],["T_WHITESPACE"," ",296],"(","!",["T_STRING","file_exists",296],"(",["T_VARIABLE","$sourceFilePath",296],")",")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n                ",296],["T_RETURN","return",297],["T_WHITESPACE"," ",297],["T_STRING","false",297],";",["T_WHITESPACE","\n            ",297],"}",["T_WHITESPACE","\n\n            ",298],["T_COMMENT","\/\/ Do resize and save\n",300],["T_WHITESPACE","            ",301],["T_VARIABLE","$processor",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_NEW","new",301],["T_WHITESPACE"," ",301],["T_STRING","Varien_Image",301],"(",["T_VARIABLE","$sourceFilePath",301],")",";",["T_WHITESPACE","\n            ",301],["T_VARIABLE","$processor",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","resize",302],"(",["T_VARIABLE","$width",302],",",["T_WHITESPACE"," ",302],["T_VARIABLE","$height",302],")",";",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$processor",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","save",303],"(",["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","getBaseDir",303],"(",["T_STRING","Mage_Core_Model_Store",303],["T_DOUBLE_COLON","::",303],["T_STRING","URL_TYPE_MEDIA",303],")",["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_STRING","DS",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_VARIABLE","$destPath",303],")",";",["T_WHITESPACE","\n            ",303],["T_STRING","Mage",304],["T_DOUBLE_COLON","::",304],["T_STRING","helper",304],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",304],")",["T_OBJECT_OPERATOR","->",304],["T_STRING","saveFile",304],"(",["T_VARIABLE","$destPath",304],")",";",["T_WHITESPACE","\n        ",304],"}",["T_WHITESPACE","\n\n        ",305],["T_RETURN","return",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$destPath",307],";",["T_WHITESPACE","\n    ",307],"}",["T_WHITESPACE","\n\n    ",308],["T_DOC_COMMENT","\/**\n     * Cleans out the swatch image cache dir\n     *\/",310],["T_WHITESPACE","\n    ",312],["T_PUBLIC","public",313],["T_WHITESPACE"," ",313],["T_FUNCTION","function",313],["T_WHITESPACE"," ",313],["T_STRING","clearSwatchesCache",313],"(",")",["T_WHITESPACE","\n    ",313],"{",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$directory",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","getBaseDir",315],"(",["T_STRING","Mage_Core_Model_Store",315],["T_DOUBLE_COLON","::",315],["T_STRING","URL_TYPE_MEDIA",315],")",["T_WHITESPACE"," ",315],".",["T_WHITESPACE"," ",315],["T_STRING","DS",315],["T_WHITESPACE"," ",315],".",["T_WHITESPACE"," ",315],["T_STRING","self",315],["T_DOUBLE_COLON","::",315],["T_STRING","SWATCH_CACHE_DIR",315],";",["T_WHITESPACE","\n        ",315],["T_VARIABLE","$io",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_NEW","new",316],["T_WHITESPACE"," ",316],["T_STRING","Varien_Io_File",316],"(",")",";",["T_WHITESPACE","\n        ",316],["T_VARIABLE","$io",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","rmdir",317],"(",["T_VARIABLE","$directory",317],",",["T_WHITESPACE"," ",317],["T_STRING","true",317],")",";",["T_WHITESPACE","\n\n        ",317],["T_STRING","Mage",319],["T_DOUBLE_COLON","::",319],["T_STRING","helper",319],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",319],")",["T_OBJECT_OPERATOR","->",319],["T_STRING","deleteFolder",319],"(",["T_VARIABLE","$directory",319],")",";",["T_WHITESPACE","\n    ",319],"}",["T_WHITESPACE","\n\n    ",320],["T_DOC_COMMENT","\/**\n     * Determine whether to show an image in the product media gallery\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @param Varien_Object $image\n     * @return bool\n     *\/",322],["T_WHITESPACE","\n    ",328],["T_PUBLIC","public",329],["T_WHITESPACE"," ",329],["T_FUNCTION","function",329],["T_WHITESPACE"," ",329],["T_STRING","filterImageInGallery",329],"(",["T_VARIABLE","$product",329],",",["T_WHITESPACE"," ",329],["T_VARIABLE","$image",329],")",["T_WHITESPACE","\n    ",329],"{",["T_WHITESPACE","\n        ",330],["T_IF","if",331],["T_WHITESPACE"," ",331],"(","!",["T_STRING","Mage",331],["T_DOUBLE_COLON","::",331],["T_STRING","helper",331],"(",["T_CONSTANT_ENCAPSED_STRING","'configurableswatches'",331],")",["T_OBJECT_OPERATOR","->",331],["T_STRING","isEnabled",331],"(",")",")",["T_WHITESPACE"," ",331],"{",["T_WHITESPACE","\n            ",331],["T_RETURN","return",332],["T_WHITESPACE"," ",332],["T_STRING","true",332],";",["T_WHITESPACE","\n        ",332],"}",["T_WHITESPACE","\n\n        ",333],["T_IF","if",335],["T_WHITESPACE"," ",335],"(","!",["T_ISSET","isset",335],"(",["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","_productImageFilters",335],"[",["T_VARIABLE","$product",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getId",335],"(",")","]",")",")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n            ",335],["T_VARIABLE","$mapping",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_STRING","call_user_func_array",336],"(",["T_CONSTANT_ENCAPSED_STRING","\"array_merge_recursive\"",336],",",["T_WHITESPACE"," ",336],["T_VARIABLE","$product",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getChildAttributeLabelMapping",336],"(",")",")",";",["T_WHITESPACE","\n            ",336],["T_VARIABLE","$filters",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_STRING","array_unique",337],"(",["T_VARIABLE","$mapping",337],"[",["T_CONSTANT_ENCAPSED_STRING","'labels'",337],"]",")",";",["T_WHITESPACE","\n            ",337],["T_VARIABLE","$filters",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_STRING","array_merge",338],"(",["T_VARIABLE","$filters",338],",",["T_WHITESPACE"," ",338],["T_STRING","array_map",338],"(",["T_FUNCTION","function",338],["T_WHITESPACE"," ",338],"(",["T_VARIABLE","$label",338],")",["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n                ",338],["T_RETURN","return",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$label",339],["T_WHITESPACE"," ",339],".",["T_WHITESPACE"," ",339],["T_STRING","Mage_ConfigurableSwatches_Helper_Productimg",339],["T_DOUBLE_COLON","::",339],["T_STRING","SWATCH_LABEL_SUFFIX",339],";",["T_WHITESPACE","\n            ",339],"}",",",["T_WHITESPACE"," ",340],["T_VARIABLE","$filters",340],")",")",";",["T_WHITESPACE","\n            ",340],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_productImageFilters",341],"[",["T_VARIABLE","$product",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getId",341],"(",")","]",["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_VARIABLE","$filters",341],";",["T_WHITESPACE","\n        ",341],"}",["T_WHITESPACE","\n\n        ",342],["T_RETURN","return",344],["T_WHITESPACE"," ",344],"!",["T_STRING","in_array",344],"(",["T_STRING","Mage_ConfigurableSwatches_Helper_Data",344],["T_DOUBLE_COLON","::",344],["T_STRING","normalizeKey",344],"(",["T_VARIABLE","$image",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getLabel",344],"(",")",")",",",["T_WHITESPACE","\n            ",344],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_productImageFilters",345],"[",["T_VARIABLE","$product",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getId",345],"(",")","]",")",";",["T_WHITESPACE","\n    ",345],"}",["T_WHITESPACE","\n",346],"}",["T_WHITESPACE","\n",347]]