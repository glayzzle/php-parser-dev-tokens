[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Rating\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Rating votes collection\n *\n * @category    Mage\n * @package     Mage_Rating\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Rating_Model_Resource_Rating_Option_Vote_Collection",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Resource_Db_Collection_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Define model\n     *\n     *\/",36],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","_construct",40],"(",")",["T_WHITESPACE","\n    ",40],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","_init",42],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_vote'",42],")",";",["T_WHITESPACE","\n    ",42],"}",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Set review filter\n     *\n     * @param int $reviewId\n     * @return Mage_Rating_Model_Resource_Rating_Option_Vote_Collection\n     *\/",45],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","setReviewFilter",51],"(",["T_VARIABLE","$reviewId",51],")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getSelect",53],"(",")",["T_WHITESPACE","\n            ",53],["T_OBJECT_OPERATOR","->",54],["T_STRING","where",54],"(",["T_CONSTANT_ENCAPSED_STRING","\"main_table.review_id = ?\"",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$reviewId",54],")",";",["T_WHITESPACE","\n        ",54],["T_RETURN","return",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Set EntityPk filter\n     *\n     * @param int $entityId\n     * @return Mage_Rating_Model_Resource_Rating_Option_Vote_Collection\n     *\/",58],["T_WHITESPACE","\n    ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","setEntityPkFilter",64],"(",["T_VARIABLE","$entityId",64],")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getSelect",66],"(",")",["T_WHITESPACE","\n            ",66],["T_OBJECT_OPERATOR","->",67],["T_STRING","where",67],"(",["T_CONSTANT_ENCAPSED_STRING","\"entity_pk_value = ?\"",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$entityId",67],")",";",["T_WHITESPACE","\n        ",67],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Set store filter\n     *\n     * @param int $storeId\n     * @return Mage_Rating_Model_Resource_Rating_Option_Vote_Collection\n     *\/",71],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","setStoreFilter",77],"(",["T_VARIABLE","$storeId",77],")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getSelect",79],"(",")",["T_WHITESPACE","\n            ",79],["T_OBJECT_OPERATOR","->",80],["T_STRING","join",80],"(",["T_ARRAY","array",80],"(",["T_CONSTANT_ENCAPSED_STRING","'rstore'",80],["T_DOUBLE_ARROW","=>",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getTable",80],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_store'",80],")",")",",",["T_WHITESPACE","\n                ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getConnection",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","quoteInto",81],"(",["T_WHITESPACE","\n                    ",81],["T_CONSTANT_ENCAPSED_STRING","'main_table.review_id=rstore.review_id AND rstore.store_id=?'",82],",",["T_WHITESPACE","\n                    ",82],["T_INT_CAST","(int)",83],["T_VARIABLE","$storeId",83],")",",",["T_WHITESPACE","\n            ",83],["T_ARRAY","array",84],"(",")",")",";",["T_WHITESPACE","\n        ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Add rating info to select\n     *\n     * @param int $storeId\n     * @return Mage_Rating_Model_Resource_Rating_Option_Vote_Collection\n     *\/",88],["T_WHITESPACE","\n    ",93],["T_PUBLIC","public",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","addRatingInfo",94],"(",["T_VARIABLE","$storeId",94],"=",["T_STRING","null",94],")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$adapter",96],"=",["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getConnection",96],"(",")",";",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$ratingCodeCond",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$adapter",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getIfNullSql",97],"(",["T_CONSTANT_ENCAPSED_STRING","'title.value'",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'rating.rating_code'",97],")",";",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getSelect",98],"(",")",["T_WHITESPACE","\n            ",98],["T_OBJECT_OPERATOR","->",99],["T_STRING","join",99],"(",["T_WHITESPACE","\n                ",99],["T_ARRAY","array",100],"(",["T_CONSTANT_ENCAPSED_STRING","'rating'",100],["T_WHITESPACE","    ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getTable",100],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating'",100],")",")",",",["T_WHITESPACE","\n                ",100],["T_CONSTANT_ENCAPSED_STRING","'rating.rating_id = main_table.rating_id'",101],",",["T_WHITESPACE","\n                ",101],["T_ARRAY","array",102],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_code'",102],")",")",["T_WHITESPACE","\n            ",102],["T_OBJECT_OPERATOR","->",103],["T_STRING","joinLeft",103],"(",["T_WHITESPACE","\n                ",103],["T_ARRAY","array",104],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getTable",104],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_title'",104],")",")",",",["T_WHITESPACE","\n                ",104],["T_VARIABLE","$adapter",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","quoteInto",105],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.rating_id=title.rating_id AND title.store_id = ?'",105],",",["T_WHITESPACE","\n                    ",105],["T_INT_CAST","(int)",106],["T_STRING","Mage",106],["T_DOUBLE_COLON","::",106],["T_STRING","app",106],"(",")",["T_OBJECT_OPERATOR","->",106],["T_STRING","getStore",106],"(",")",["T_OBJECT_OPERATOR","->",106],["T_STRING","getId",106],"(",")",")",",",["T_WHITESPACE","\n                ",106],["T_ARRAY","array",107],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_code'",107],["T_WHITESPACE"," ",107],["T_DOUBLE_ARROW","=>",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$ratingCodeCond",107],")",")",";",["T_WHITESPACE","\n\n        ",107],["T_IF","if",109],["T_WHITESPACE"," ",109],"(",["T_VARIABLE","$storeId",109],["T_WHITESPACE"," ",109],["T_IS_EQUAL","==",109],["T_WHITESPACE"," ",109],["T_STRING","null",109],")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$storeId",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_STRING","Mage",110],["T_DOUBLE_COLON","::",110],["T_STRING","app",110],"(",")",["T_OBJECT_OPERATOR","->",110],["T_STRING","getStore",110],"(",")",["T_OBJECT_OPERATOR","->",110],["T_STRING","getId",110],"(",")",";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_STRING","is_array",113],"(",["T_VARIABLE","$storeId",113],")",")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$condition",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$adapter",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","prepareSqlCondition",114],"(",["T_CONSTANT_ENCAPSED_STRING","'store.store_id'",114],",",["T_WHITESPACE"," ",114],["T_ARRAY","array",114],"(",["T_WHITESPACE","\n                ",114],["T_CONSTANT_ENCAPSED_STRING","'in'",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$storeId",115],["T_WHITESPACE","\n            ",115],")",")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE"," ",117],["T_ELSE","else",117],["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$condition",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$adapter",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","quoteInto",118],"(",["T_CONSTANT_ENCAPSED_STRING","'store.store_id = ?'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$storeId",118],")",";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE","\n\n        ",119],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getSelect",121],"(",")",["T_WHITESPACE","\n            ",121],["T_OBJECT_OPERATOR","->",122],["T_STRING","join",122],"(",["T_WHITESPACE","\n                ",122],["T_ARRAY","array",123],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getTable",123],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",123],")",")",",",["T_WHITESPACE","\n                ",123],["T_CONSTANT_ENCAPSED_STRING","'main_table.rating_id = store.rating_id AND '",124],["T_WHITESPACE"," ",124],".",["T_WHITESPACE"," ",124],["T_VARIABLE","$condition",124],")",["T_WHITESPACE","\n",124],["T_COMMENT","\/\/            ->group('main_table.vote_id')\n",125],["T_WHITESPACE","        ",126],";",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$adapter",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","fetchAll",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getSelect",128],"(",")",")",";",["T_WHITESPACE","\n        ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Add option info to select\n     *\n     * @return Mage_Rating_Model_Resource_Rating_Option_Vote_Collection\n     *\/",132],["T_WHITESPACE","\n    ",136],["T_PUBLIC","public",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","addOptionInfo",137],"(",")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getSelect",139],"(",")",["T_WHITESPACE","\n            ",139],["T_OBJECT_OPERATOR","->",140],["T_STRING","join",140],"(",["T_ARRAY","array",140],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option'",140],["T_WHITESPACE"," ",140],["T_DOUBLE_ARROW","=>",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getTable",140],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option'",140],")",")",",",["T_WHITESPACE","\n                ",140],["T_CONSTANT_ENCAPSED_STRING","'main_table.option_id = rating_option.option_id'",141],")",";",["T_WHITESPACE","\n        ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_DOC_COMMENT","\/**\n     * Add rating options\n     *\n     * @return Mage_Rating_Model_Resource_Rating_Option_Vote_Collection\n     *\/",145],["T_WHITESPACE","\n    ",149],["T_PUBLIC","public",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","addRatingOptions",150],"(",")",["T_WHITESPACE","\n    ",150],"{",["T_WHITESPACE","\n        ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(","!",["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getSize",152],"(",")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n        ",154],["T_FOREACH","foreach",155],["T_WHITESPACE"," ",155],"(",["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getItems",155],"(",")",["T_WHITESPACE"," ",155],["T_AS","as",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$item",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$options",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_STRING","Mage",156],["T_DOUBLE_COLON","::",156],["T_STRING","getModel",156],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option'",156],")",["T_WHITESPACE","\n                    ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","getResourceCollection",157],"(",")",["T_WHITESPACE","\n                    ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","addRatingFilter",158],"(",["T_VARIABLE","$item",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getRatingId",158],"(",")",")",["T_WHITESPACE","\n                    ",158],["T_OBJECT_OPERATOR","->",159],["T_STRING","load",159],"(",")",";",["T_WHITESPACE","\n\n            ",159],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$item",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getRatingId",161],"(",")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$item",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","setRatingOptions",162],"(",["T_VARIABLE","$options",162],")",";",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE"," ",163],["T_ELSE","else",163],["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_RETURN","return",164],";",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n        ",166],["T_RETURN","return",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],";",["T_WHITESPACE","\n    ",167],"}",["T_WHITESPACE","\n",168],"}",["T_WHITESPACE","\n",169]]