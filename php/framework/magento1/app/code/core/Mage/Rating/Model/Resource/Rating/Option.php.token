[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Rating\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Rating option resource model\n *\n * @category    Mage\n * @package     Mage_Rating\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Rating_Model_Resource_Rating_Option",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Review table\n     *\n     * @var string\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_reviewTable",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Rating option table\n     *\n     * @var string\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_ratingOptionTable",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Rating vote table\n     *\n     * @var string\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_ratingVoteTable",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Aggregate table\n     *\n     * @var string\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_aggregateTable",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Review store table\n     *\n     * @var string\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$_reviewStoreTable",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Rating store table\n     *\n     * @var string\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$_ratingStoreTable",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n    * Option data\n    *\n    * @var array\n    *\/",78],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$_optionData",83],";",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n    * Option id\n    *\n    * @var int\n    *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$_optionId",90],";",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Resource initialization. Define other tables name\n     *\n     *\/",92],["T_WHITESPACE","\n    ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","_construct",96],"(",")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","_init",98],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option'",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'option_id'",98],")",";",["T_WHITESPACE","\n\n        ",98],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","_reviewTable",100],["T_WHITESPACE","         ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getTable",100],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review'",100],")",";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_ratingOptionTable",101],["T_WHITESPACE","   ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getTable",101],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option'",101],")",";",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_ratingVoteTable",102],["T_WHITESPACE","     ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getTable",102],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_vote'",102],")",";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_aggregateTable",103],["T_WHITESPACE","      ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getTable",103],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_vote_aggregated'",103],")",";",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_reviewStoreTable",104],["T_WHITESPACE","    ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getTable",104],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_store'",104],")",";",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_ratingStoreTable",105],["T_WHITESPACE","    ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getTable",105],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_store'",105],")",";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Add vote\n     *\n     * @param Mage_Rating_Model_Rating_Option $option\n     * @return Mage_Rating_Model_Resource_Rating_Option\n     *\/",108],["T_WHITESPACE","\n    ",113],["T_PUBLIC","public",114],["T_WHITESPACE"," ",114],["T_FUNCTION","function",114],["T_WHITESPACE"," ",114],["T_STRING","addVote",114],"(",["T_VARIABLE","$option",114],")",["T_WHITESPACE","\n    ",114],"{",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$adapter",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_getWriteAdapter",116],"(",")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$optionData",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","loadDataById",117],"(",["T_VARIABLE","$option",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getId",117],"(",")",")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$data",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],"(",["T_WHITESPACE","\n            ",118],["T_CONSTANT_ENCAPSED_STRING","'option_id'",119],["T_WHITESPACE","     ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$option",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getId",119],"(",")",",",["T_WHITESPACE","\n            ",119],["T_CONSTANT_ENCAPSED_STRING","'review_id'",120],["T_WHITESPACE","     ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$option",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getReviewId",120],"(",")",",",["T_WHITESPACE","\n            ",120],["T_CONSTANT_ENCAPSED_STRING","'percent'",121],["T_WHITESPACE","       ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],"(","(",["T_VARIABLE","$optionData",121],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",121],"]",["T_WHITESPACE"," ",121],"\/",["T_WHITESPACE"," ",121],["T_LNUMBER","5",121],")",["T_WHITESPACE"," ",121],"*",["T_WHITESPACE"," ",121],["T_LNUMBER","100",121],")",",",["T_WHITESPACE","\n            ",121],["T_CONSTANT_ENCAPSED_STRING","'value'",122],["T_WHITESPACE","         ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$optionData",122],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",122],"]",["T_WHITESPACE","\n        ",122],")",";",["T_WHITESPACE","\n\n        ",123],["T_IF","if",125],["T_WHITESPACE"," ",125],"(","!",["T_VARIABLE","$option",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getDoUpdate",125],"(",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$data",126],"[",["T_CONSTANT_ENCAPSED_STRING","'remote_ip'",126],"]",["T_WHITESPACE","       ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","helper",126],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/http'",126],")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getRemoteAddr",126],"(",")",";",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$data",127],"[",["T_CONSTANT_ENCAPSED_STRING","'remote_ip_long'",127],"]",["T_WHITESPACE","  ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","helper",127],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/http'",127],")",["T_OBJECT_OPERATOR","->",127],["T_STRING","getRemoteAddr",127],"(",["T_STRING","true",127],")",";",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$data",128],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",128],"]",["T_WHITESPACE","     ",128],"=",["T_WHITESPACE"," ",128],["T_STRING","Mage",128],["T_DOUBLE_COLON","::",128],["T_STRING","getSingleton",128],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",128],")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getCustomerId",128],"(",")",";",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$data",129],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",129],"]",["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$option",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getEntityPkValue",129],"(",")",";",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$data",130],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",130],"]",["T_WHITESPACE","       ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$option",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getRatingId",130],"(",")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n\n        ",131],["T_VARIABLE","$adapter",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","beginTransaction",133],"(",")",";",["T_WHITESPACE","\n        ",133],["T_TRY","try",134],["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n            ",134],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$option",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getDoUpdate",135],"(",")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                ",135],["T_VARIABLE","$condition",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_ARRAY","array",136],"(",["T_WHITESPACE","\n                    ",136],["T_CONSTANT_ENCAPSED_STRING","'vote_id = ?'",137],["T_WHITESPACE","   ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$option",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getVoteId",137],"(",")",",",["T_WHITESPACE","\n                    ",137],["T_CONSTANT_ENCAPSED_STRING","'review_id = ?'",138],["T_WHITESPACE"," ",138],["T_DOUBLE_ARROW","=>",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$option",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getReviewId",138],"(",")",["T_WHITESPACE","\n                ",138],")",";",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$adapter",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","update",140],"(",["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_ratingVoteTable",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$data",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$condition",140],")",";",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","aggregate",141],"(",["T_VARIABLE","$option",141],")",";",["T_WHITESPACE","\n            ",141],"}",["T_WHITESPACE"," ",142],["T_ELSE","else",142],["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$adapter",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","insert",143],"(",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_ratingVoteTable",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$data",143],")",";",["T_WHITESPACE","\n                ",143],["T_VARIABLE","$option",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","setVoteId",144],"(",["T_VARIABLE","$adapter",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","lastInsertId",144],"(",["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_ratingVoteTable",144],")",")",";",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","aggregate",145],"(",["T_VARIABLE","$option",145],")",";",["T_WHITESPACE","\n            ",145],"}",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$adapter",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","commit",147],"(",")",";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE"," ",148],["T_CATCH","catch",148],["T_WHITESPACE"," ",148],"(",["T_STRING","Exception",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$e",148],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$adapter",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","rollback",149],"(",")",";",["T_WHITESPACE","\n            ",149],["T_THROW","throw",150],["T_WHITESPACE"," ",150],["T_NEW","new",150],["T_WHITESPACE"," ",150],["T_STRING","Exception",150],"(",["T_VARIABLE","$e",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getMessage",150],"(",")",")",";",["T_WHITESPACE","\n        ",150],"}",["T_WHITESPACE","\n        ",151],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_DOC_COMMENT","\/**\n     * Aggregate options\n     *\n     * @param Mage_Rating_Model_Rating_Option $option\n     *\/",155],["T_WHITESPACE","\n    ",159],["T_PUBLIC","public",160],["T_WHITESPACE"," ",160],["T_FUNCTION","function",160],["T_WHITESPACE"," ",160],["T_STRING","aggregate",160],"(",["T_VARIABLE","$option",160],")",["T_WHITESPACE","\n    ",160],"{",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$vote",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","Mage",162],["T_DOUBLE_COLON","::",162],["T_STRING","getModel",162],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_vote'",162],")",["T_OBJECT_OPERATOR","->",162],["T_STRING","load",162],"(",["T_VARIABLE","$option",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getVoteId",162],"(",")",")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","aggregateEntityByRatingId",163],"(",["T_VARIABLE","$vote",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getRatingId",163],"(",")",",",["T_WHITESPACE"," ",163],["T_VARIABLE","$vote",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getEntityPkValue",163],"(",")",")",";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Aggregate entity by rating id\n     *\n     * @param int $ratingId\n     * @param int $entityPkValue\n     *\/",166],["T_WHITESPACE","\n    ",171],["T_PUBLIC","public",172],["T_WHITESPACE"," ",172],["T_FUNCTION","function",172],["T_WHITESPACE"," ",172],["T_STRING","aggregateEntityByRatingId",172],"(",["T_VARIABLE","$ratingId",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$entityPkValue",172],")",["T_WHITESPACE","\n    ",172],"{",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$readAdapter",174],["T_WHITESPACE","  ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","_getReadAdapter",174],"(",")",";",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$writeAdapter",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","_getWriteAdapter",175],"(",")",";",["T_WHITESPACE","\n\n        ",175],["T_VARIABLE","$select",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$readAdapter",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","select",177],"(",")",["T_WHITESPACE","\n            ",177],["T_OBJECT_OPERATOR","->",178],["T_STRING","from",178],"(",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_aggregateTable",178],",",["T_WHITESPACE"," ",178],["T_ARRAY","array",178],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",178],",",["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","'primary_id'",178],")",")",["T_WHITESPACE","\n            ",178],["T_OBJECT_OPERATOR","->",179],["T_STRING","where",179],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id = :rating_id'",179],")",["T_WHITESPACE","\n            ",179],["T_OBJECT_OPERATOR","->",180],["T_STRING","where",180],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value = :pk_value'",180],")",";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$bind",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_ARRAY","array",181],"(",["T_CONSTANT_ENCAPSED_STRING","':rating_id'",181],["T_WHITESPACE"," ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$ratingId",181],",",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","':pk_value'",181],["T_WHITESPACE"," ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$entityPkValue",181],")",";",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$oldData",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$readAdapter",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","fetchPairs",182],"(",["T_VARIABLE","$select",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$bind",182],")",";",["T_WHITESPACE","\n\n        ",182],["T_VARIABLE","$appVoteCountCond",184],["T_WHITESPACE","    ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$readAdapter",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getCheckSql",184],"(",["T_CONSTANT_ENCAPSED_STRING","'review.status_id=1'",184],",",["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'vote.vote_id'",184],",",["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'NULL'",184],")",";",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$appVoteValueSumCond",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$readAdapter",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getCheckSql",185],"(",["T_CONSTANT_ENCAPSED_STRING","'review.status_id=1'",185],",",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'vote.value'",185],",",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'0'",185],")",";",["T_WHITESPACE","\n\n        ",185],["T_VARIABLE","$select",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$readAdapter",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","select",187],"(",")",["T_WHITESPACE","\n            ",187],["T_OBJECT_OPERATOR","->",188],["T_STRING","from",188],"(",["T_ARRAY","array",188],"(",["T_CONSTANT_ENCAPSED_STRING","'vote'",188],["T_DOUBLE_ARROW","=>",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_ratingVoteTable",188],")",",",["T_WHITESPACE","\n                ",188],["T_ARRAY","array",189],"(",["T_WHITESPACE","\n                    ",189],["T_CONSTANT_ENCAPSED_STRING","'vote_count'",190],["T_WHITESPACE","         ",190],["T_DOUBLE_ARROW","=>",190],["T_WHITESPACE"," ",190],["T_NEW","new",190],["T_WHITESPACE"," ",190],["T_STRING","Zend_Db_Expr",190],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(vote.vote_id)'",190],")",",",["T_WHITESPACE","\n                    ",190],["T_CONSTANT_ENCAPSED_STRING","'vote_value_sum'",191],["T_WHITESPACE","     ",191],["T_DOUBLE_ARROW","=>",191],["T_WHITESPACE"," ",191],["T_NEW","new",191],["T_WHITESPACE"," ",191],["T_STRING","Zend_Db_Expr",191],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(vote.value)'",191],")",",",["T_WHITESPACE","\n                    ",191],["T_CONSTANT_ENCAPSED_STRING","'app_vote_count'",192],["T_WHITESPACE","     ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_NEW","new",192],["T_WHITESPACE"," ",192],["T_STRING","Zend_Db_Expr",192],"(","\"",["T_ENCAPSED_AND_WHITESPACE","COUNT(",192],["T_CURLY_OPEN","{",192],["T_VARIABLE","$appVoteCountCond",192],"}",["T_ENCAPSED_AND_WHITESPACE",")",192],"\"",")",",",["T_WHITESPACE","\n                    ",192],["T_CONSTANT_ENCAPSED_STRING","'app_vote_value_sum'",193],["T_WHITESPACE"," ",193],["T_DOUBLE_ARROW","=>",193],["T_WHITESPACE"," ",193],["T_NEW","new",193],["T_WHITESPACE"," ",193],["T_STRING","Zend_Db_Expr",193],"(","\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",193],["T_CURLY_OPEN","{",193],["T_VARIABLE","$appVoteValueSumCond",193],"}",["T_ENCAPSED_AND_WHITESPACE",")",193],"\"",")",["T_WHITESPACE"," ",193],")",")",["T_WHITESPACE","\n            ",193],["T_OBJECT_OPERATOR","->",194],["T_STRING","join",194],"(",["T_ARRAY","array",194],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",194],["T_WHITESPACE","   ",194],["T_DOUBLE_ARROW","=>",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_reviewTable",194],")",",",["T_WHITESPACE","\n                ",194],["T_CONSTANT_ENCAPSED_STRING","'vote.review_id=review.review_id'",195],",",["T_WHITESPACE","\n                ",195],["T_ARRAY","array",196],"(",")",")",["T_WHITESPACE","\n            ",196],["T_OBJECT_OPERATOR","->",197],["T_STRING","joinLeft",197],"(",["T_ARRAY","array",197],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",197],["T_DOUBLE_ARROW","=>",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_reviewStoreTable",197],")",",",["T_WHITESPACE","\n                ",197],["T_CONSTANT_ENCAPSED_STRING","'vote.review_id=store.review_id'",198],",",["T_WHITESPACE"," ",198],["T_CONSTANT_ENCAPSED_STRING","'store_id'",198],")",["T_WHITESPACE","\n            ",198],["T_OBJECT_OPERATOR","->",199],["T_STRING","join",199],"(",["T_ARRAY","array",199],"(",["T_CONSTANT_ENCAPSED_STRING","'rstore'",199],["T_WHITESPACE","   ",199],["T_DOUBLE_ARROW","=>",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_ratingStoreTable",199],")",",",["T_WHITESPACE","\n                ",199],["T_CONSTANT_ENCAPSED_STRING","'vote.rating_id=rstore.rating_id AND rstore.store_id=store.store_id'",200],",",["T_WHITESPACE","\n                ",200],["T_ARRAY","array",201],"(",")",")",["T_WHITESPACE","\n            ",201],["T_OBJECT_OPERATOR","->",202],["T_STRING","where",202],"(",["T_CONSTANT_ENCAPSED_STRING","'vote.rating_id = :rating_id'",202],")",["T_WHITESPACE","\n            ",202],["T_OBJECT_OPERATOR","->",203],["T_STRING","where",203],"(",["T_CONSTANT_ENCAPSED_STRING","'vote.entity_pk_value = :pk_value'",203],")",["T_WHITESPACE","\n            ",203],["T_OBJECT_OPERATOR","->",204],["T_STRING","group",204],"(",["T_ARRAY","array",204],"(",["T_WHITESPACE","\n                ",204],["T_CONSTANT_ENCAPSED_STRING","'vote.rating_id'",205],",",["T_WHITESPACE","\n                ",205],["T_CONSTANT_ENCAPSED_STRING","'vote.entity_pk_value'",206],",",["T_WHITESPACE","\n                ",206],["T_CONSTANT_ENCAPSED_STRING","'store.store_id'",207],["T_WHITESPACE","\n            ",207],")",")",";",["T_WHITESPACE","\n\n        ",208],["T_VARIABLE","$perStoreInfo",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$readAdapter",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","fetchAll",210],"(",["T_VARIABLE","$select",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$bind",210],")",";",["T_WHITESPACE","\n\n        ",210],["T_VARIABLE","$usedStores",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_ARRAY","array",212],"(",")",";",["T_WHITESPACE","\n        ",212],["T_FOREACH","foreach",213],["T_WHITESPACE"," ",213],"(",["T_VARIABLE","$perStoreInfo",213],["T_WHITESPACE"," ",213],["T_AS","as",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$row",213],")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$saveData",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_ARRAY","array",214],"(",["T_WHITESPACE","\n                ",214],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",215],["T_WHITESPACE","        ",215],["T_DOUBLE_ARROW","=>",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$ratingId",215],",",["T_WHITESPACE","\n                ",215],["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",216],["T_WHITESPACE","  ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$entityPkValue",216],",",["T_WHITESPACE","\n                ",216],["T_CONSTANT_ENCAPSED_STRING","'vote_count'",217],["T_WHITESPACE","       ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$row",217],"[",["T_CONSTANT_ENCAPSED_STRING","'vote_count'",217],"]",",",["T_WHITESPACE","\n                ",217],["T_CONSTANT_ENCAPSED_STRING","'vote_value_sum'",218],["T_WHITESPACE","   ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$row",218],"[",["T_CONSTANT_ENCAPSED_STRING","'vote_value_sum'",218],"]",",",["T_WHITESPACE","\n                ",218],["T_CONSTANT_ENCAPSED_STRING","'percent'",219],["T_WHITESPACE","          ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],"(","(",["T_VARIABLE","$row",219],"[",["T_CONSTANT_ENCAPSED_STRING","'vote_value_sum'",219],"]","\/",["T_VARIABLE","$row",219],"[",["T_CONSTANT_ENCAPSED_STRING","'vote_count'",219],"]",")","\/",["T_LNUMBER","5",219],")",["T_WHITESPACE"," ",219],"*",["T_WHITESPACE"," ",219],["T_LNUMBER","100",219],",",["T_WHITESPACE","\n                ",219],["T_CONSTANT_ENCAPSED_STRING","'percent_approved'",220],["T_WHITESPACE"," ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$row",220],"[",["T_CONSTANT_ENCAPSED_STRING","'app_vote_count'",220],"]",["T_WHITESPACE"," ",220],"?",["T_WHITESPACE"," ",220],"(","(","(",["T_VARIABLE","$row",220],"[",["T_CONSTANT_ENCAPSED_STRING","'app_vote_value_sum'",220],"]","\/",["T_VARIABLE","$row",220],"[",["T_CONSTANT_ENCAPSED_STRING","'app_vote_count'",220],"]",")","\/",["T_LNUMBER","5",220],")",["T_WHITESPACE"," ",220],"*",["T_WHITESPACE"," ",220],["T_LNUMBER","100",220],")",["T_WHITESPACE"," ",220],":",["T_WHITESPACE"," ",220],["T_LNUMBER","0",220],")",",",["T_WHITESPACE","\n                ",220],["T_CONSTANT_ENCAPSED_STRING","'store_id'",221],["T_WHITESPACE","         ",221],["T_DOUBLE_ARROW","=>",221],["T_WHITESPACE"," ",221],["T_VARIABLE","$row",221],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",221],"]",",",["T_WHITESPACE","\n            ",221],")",";",["T_WHITESPACE","\n\n            ",222],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_ISSET","isset",224],"(",["T_VARIABLE","$oldData",224],"[",["T_VARIABLE","$row",224],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",224],"]","]",")",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                ",224],["T_VARIABLE","$condition",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_ARRAY","array",225],"(",["T_CONSTANT_ENCAPSED_STRING","'primary_id = ?'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$oldData",225],"[",["T_VARIABLE","$row",225],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",225],"]","]",")",";",["T_WHITESPACE","\n                ",225],["T_VARIABLE","$writeAdapter",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","update",226],"(",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_aggregateTable",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$saveData",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$condition",226],")",";",["T_WHITESPACE","\n            ",226],"}",["T_WHITESPACE"," ",227],["T_ELSE","else",227],["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n                ",227],["T_VARIABLE","$writeAdapter",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","insert",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_aggregateTable",228],",",["T_WHITESPACE"," ",228],["T_VARIABLE","$saveData",228],")",";",["T_WHITESPACE","\n            ",228],"}",["T_WHITESPACE","\n\n            ",229],["T_VARIABLE","$usedStores",231],"[","]",["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$row",231],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",231],"]",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$toDelete",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","array_diff",234],"(",["T_STRING","array_keys",234],"(",["T_VARIABLE","$oldData",234],")",",",["T_WHITESPACE"," ",234],["T_VARIABLE","$usedStores",234],")",";",["T_WHITESPACE","\n\n        ",234],["T_FOREACH","foreach",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$toDelete",236],["T_WHITESPACE"," ",236],["T_AS","as",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$storeId",236],")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$condition",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_ARRAY","array",237],"(",["T_CONSTANT_ENCAPSED_STRING","'primary_id = ?'",237],["T_WHITESPACE"," ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$oldData",237],"[",["T_VARIABLE","$storeId",237],"]",")",";",["T_WHITESPACE","\n            ",237],["T_VARIABLE","$writeAdapter",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","delete",238],"(",["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_aggregateTable",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$condition",238],")",";",["T_WHITESPACE","\n        ",238],"}",["T_WHITESPACE","\n    ",239],"}",["T_WHITESPACE","\n\n    ",240],["T_DOC_COMMENT","\/**\n     * Load object data by optionId\n     * Method renamed from 'load'.\n     *\n     * @param int $optionId\n     * @return array\n     *\/",242],["T_WHITESPACE","\n    ",248],["T_PUBLIC","public",249],["T_WHITESPACE"," ",249],["T_FUNCTION","function",249],["T_WHITESPACE"," ",249],["T_STRING","loadDataById",249],"(",["T_VARIABLE","$optionId",249],")",["T_WHITESPACE","\n    ",249],"{",["T_WHITESPACE","\n        ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(","!",["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","_optionData",251],["T_WHITESPACE"," ",251],["T_BOOLEAN_OR","||",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","_optionId",251],["T_WHITESPACE"," ",251],["T_IS_NOT_EQUAL","!=",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$optionId",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n            ",251],["T_VARIABLE","$adapter",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","_getReadAdapter",252],"(",")",";",["T_WHITESPACE","\n            ",252],["T_VARIABLE","$select",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$adapter",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","select",253],"(",")",";",["T_WHITESPACE","\n            ",253],["T_VARIABLE","$select",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","from",254],"(",["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","_ratingOptionTable",254],")",["T_WHITESPACE","\n                ",254],["T_OBJECT_OPERATOR","->",255],["T_STRING","where",255],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id = :option_id'",255],")",";",["T_WHITESPACE","\n\n            ",255],["T_VARIABLE","$data",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$adapter",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","fetchRow",257],"(",["T_VARIABLE","$select",257],",",["T_WHITESPACE"," ",257],["T_ARRAY","array",257],"(",["T_CONSTANT_ENCAPSED_STRING","':option_id'",257],["T_WHITESPACE"," ",257],["T_DOUBLE_ARROW","=>",257],["T_WHITESPACE"," ",257],["T_VARIABLE","$optionId",257],")",")",";",["T_WHITESPACE","\n\n            ",257],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_optionData",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$data",259],";",["T_WHITESPACE","\n            ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","_optionId",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_VARIABLE","$optionId",260],";",["T_WHITESPACE","\n            ",260],["T_RETURN","return",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$data",261],";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n\n        ",262],["T_RETURN","return",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_optionData",264],";",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n\n",265],"}",["T_WHITESPACE","\n",267]]