[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Rating\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Rating collection resource model\n *\n * @category    Mage\n * @package     Mage_Rating\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Rating_Model_Resource_Rating_Collection",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Resource_Db_Collection_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * @var bool\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$_isStoreJoined",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_STRING","false",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Resource initialization\n     *\n     *\/",41],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","_construct",45],"(",")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_init",47],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating'",47],")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Add entity filter\n     *\n     * @param   int|string $entity\n     * @return  Mage_Rating_Model_Resource_Rating_Collection\n     *\/",50],["T_WHITESPACE","\n    ",55],["T_PUBLIC","public",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","addEntityFilter",56],"(",["T_VARIABLE","$entity",56],")",["T_WHITESPACE","\n    ",56],"{",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$adapter",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getConnection",58],"(",")",";",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getSelect",60],"(",")",["T_WHITESPACE","\n            ",60],["T_OBJECT_OPERATOR","->",61],["T_STRING","join",61],"(",["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getTable",61],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_entity'",61],")",",",["T_WHITESPACE","\n                ",61],["T_CONSTANT_ENCAPSED_STRING","'main_table.entity_id='",62],["T_WHITESPACE"," ",62],".",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getTable",62],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_entity'",62],")",["T_WHITESPACE"," ",62],".",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'.entity_id'",62],",",["T_WHITESPACE","\n                ",62],["T_ARRAY","array",63],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_code'",63],")",")",";",["T_WHITESPACE","\n\n        ",63],["T_IF","if",65],["T_WHITESPACE"," ",65],"(",["T_STRING","is_numeric",65],"(",["T_VARIABLE","$entity",65],")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","addFilter",66],"(",["T_CONSTANT_ENCAPSED_STRING","'entity'",66],",",["T_WHITESPACE","\n                ",66],["T_VARIABLE","$adapter",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","quoteInto",67],"(",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getTable",67],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_entity'",67],")",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'.entity_id=?'",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$entity",67],")",",",["T_WHITESPACE","\n                ",67],["T_CONSTANT_ENCAPSED_STRING","'string'",68],")",";",["T_WHITESPACE","\n        ",68],"}",["T_WHITESPACE"," ",69],["T_ELSEIF","elseif",69],["T_WHITESPACE"," ",69],"(",["T_STRING","is_string",69],"(",["T_VARIABLE","$entity",69],")",")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","addFilter",70],"(",["T_CONSTANT_ENCAPSED_STRING","'entity'",70],",",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$adapter",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","quoteInto",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getTable",71],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_entity'",71],")",["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'.entity_code=?'",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$entity",71],")",",",["T_WHITESPACE","\n                ",71],["T_CONSTANT_ENCAPSED_STRING","'string'",72],")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n        ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * set order by position field\n     *\n     * @param   string $dir\n     * @return  Mage_Rating_Model_Resource_Rating_Collection\n     *\/",77],["T_WHITESPACE","\n    ",82],["T_PUBLIC","public",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","setPositionOrder",83],"(",["T_VARIABLE","$dir",83],"=",["T_CONSTANT_ENCAPSED_STRING","'ASC'",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","setOrder",85],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.position'",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$dir",85],")",";",["T_WHITESPACE","\n        ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Set store filter\n     *\n     * @param int_type $storeId\n     * @return Mage_Rating_Model_Resource_Rating_Collection\n     *\/",89],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","setStoreFilter",95],"(",["T_VARIABLE","$storeId",95],")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$adapter",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getConnection",97],"(",")",";",["T_WHITESPACE","\n        ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_STRING","is_array",98],"(",["T_VARIABLE","$storeId",98],")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$storeId",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",["T_VARIABLE","$storeId",99],["T_WHITESPACE"," ",99],["T_IS_IDENTICAL","===",99],["T_WHITESPACE"," ",99],["T_STRING","null",99],["T_WHITESPACE"," ",99],"?",["T_WHITESPACE"," ",99],"-",["T_LNUMBER","1",99],["T_WHITESPACE"," ",99],":",["T_WHITESPACE"," ",99],["T_VARIABLE","$storeId",99],")",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n        ",100],["T_IF","if",101],["T_WHITESPACE"," ",101],"(",["T_EMPTY","empty",101],"(",["T_VARIABLE","$storeId",101],")",")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(","!",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_isStoreJoined",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getSelect",105],"(",")",["T_WHITESPACE","\n                ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","distinct",106],"(",["T_STRING","true",106],")",["T_WHITESPACE","\n                ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","join",107],"(",["T_WHITESPACE","\n                    ",107],["T_ARRAY","array",108],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",108],["T_DOUBLE_ARROW","=>",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getTable",108],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",108],")",")",",",["T_WHITESPACE","\n                    ",108],["T_CONSTANT_ENCAPSED_STRING","'main_table.rating_id = store.rating_id'",109],",",["T_WHITESPACE","\n                    ",109],["T_ARRAY","array",110],"(",")",")",["T_WHITESPACE","\n        ",110],["T_COMMENT","\/\/        ->group('main_table.rating_id')\n",111],["T_WHITESPACE","                ",112],";",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_isStoreJoined",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","true",113],";",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$inCond",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$adapter",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","prepareSqlCondition",115],"(",["T_CONSTANT_ENCAPSED_STRING","'store.store_id'",115],",",["T_WHITESPACE"," ",115],["T_ARRAY","array",115],"(",["T_WHITESPACE","\n            ",115],["T_CONSTANT_ENCAPSED_STRING","'in'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$storeId",116],["T_WHITESPACE","\n        ",116],")",")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getSelect",118],"(",")",["T_WHITESPACE","\n            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","where",119],"(",["T_VARIABLE","$inCond",119],")",";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","setPositionOrder",120],"(",")",";",["T_WHITESPACE","\n        ",120],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Add options to ratings in collection\n     *\n     * @return Mage_Rating_Model_Resource_Rating_Collection\n     *\/",124],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","addOptionToItems",129],"(",")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$arrRatingId",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getColumnValues",131],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",131],")",";",["T_WHITESPACE","\n\n        ",131],["T_IF","if",133],["T_WHITESPACE"," ",133],"(","!",["T_EMPTY","empty",133],"(",["T_VARIABLE","$arrRatingId",133],")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$collection",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_STRING","Mage",134],["T_DOUBLE_COLON","::",134],["T_STRING","getResourceModel",134],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_collection'",134],")",["T_WHITESPACE","\n                ",134],["T_OBJECT_OPERATOR","->",135],["T_STRING","addRatingFilter",135],"(",["T_VARIABLE","$arrRatingId",135],")",["T_WHITESPACE","\n                ",135],["T_OBJECT_OPERATOR","->",136],["T_STRING","setPositionOrder",136],"(",")",["T_WHITESPACE","\n                ",136],["T_OBJECT_OPERATOR","->",137],["T_STRING","load",137],"(",")",";",["T_WHITESPACE","\n\n            ",137],["T_FOREACH","foreach",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$this",139],["T_WHITESPACE"," ",139],["T_AS","as",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$rating",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$rating",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","setOptions",140],"(",["T_VARIABLE","$collection",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getItemsByColumnValue",140],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$rating",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getId",140],"(",")",")",")",";",["T_WHITESPACE","\n            ",140],"}",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n\n        ",142],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Add entity summary to item\n     *\n     * @param int $entityPkValue\n     * @param int $storeId\n     * @return Mage_Rating_Model_Resource_Rating_Collection\n     *\/",147],["T_WHITESPACE","\n    ",153],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","addEntitySummaryToItem",154],"(",["T_VARIABLE","$entityPkValue",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$storeId",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$arrRatingId",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getColumnValues",156],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",156],")",";",["T_WHITESPACE","\n        ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_STRING","count",157],"(",["T_VARIABLE","$arrRatingId",157],")",["T_WHITESPACE"," ",157],["T_IS_EQUAL","==",157],["T_WHITESPACE"," ",157],["T_LNUMBER","0",157],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n\n        ",159],["T_VARIABLE","$adapter",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getConnection",161],"(",")",";",["T_WHITESPACE","\n\n        ",161],["T_VARIABLE","$inCond",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$adapter",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","prepareSqlCondition",163],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote.rating_id'",163],",",["T_WHITESPACE"," ",163],["T_ARRAY","array",163],"(",["T_WHITESPACE","\n            ",163],["T_CONSTANT_ENCAPSED_STRING","'in'",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$arrRatingId",164],["T_WHITESPACE","\n        ",164],")",")",";",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$sumCond",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_NEW","new",166],["T_WHITESPACE"," ",166],["T_STRING","Zend_Db_Expr",166],"(","\"",["T_ENCAPSED_AND_WHITESPACE","SUM(rating_option_vote.",166],["T_CURLY_OPEN","{",166],["T_VARIABLE","$adapter",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","quoteIdentifier",166],"(",["T_CONSTANT_ENCAPSED_STRING","'percent'",166],")","}",["T_ENCAPSED_AND_WHITESPACE",")",166],"\"",")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$countCond",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_NEW","new",167],["T_WHITESPACE"," ",167],["T_STRING","Zend_Db_Expr",167],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",167],")",";",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$select",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$adapter",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","select",168],"(",")",["T_WHITESPACE","\n            ",168],["T_OBJECT_OPERATOR","->",169],["T_STRING","from",169],"(",["T_ARRAY","array",169],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote'",169],["T_WHITESPACE","  ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getTable",169],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_vote'",169],")",")",",",["T_WHITESPACE","\n                ",169],["T_ARRAY","array",170],"(",["T_WHITESPACE","\n                    ",170],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",171],["T_WHITESPACE"," ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote.rating_id'",171],",",["T_WHITESPACE","\n                    ",171],["T_CONSTANT_ENCAPSED_STRING","'sum'",172],["T_WHITESPACE","         ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$sumCond",172],",",["T_WHITESPACE","\n                    ",172],["T_CONSTANT_ENCAPSED_STRING","'count'",173],["T_WHITESPACE","       ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$countCond",173],["T_WHITESPACE","\n                ",173],")",")",["T_WHITESPACE","\n            ",174],["T_OBJECT_OPERATOR","->",175],["T_STRING","join",175],"(",["T_WHITESPACE","\n                ",175],["T_ARRAY","array",176],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store'",176],["T_WHITESPACE"," ",176],["T_DOUBLE_ARROW","=>",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getTable",176],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_store'",176],")",")",",",["T_WHITESPACE","\n                ",176],["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote.review_id=review_store.review_id AND review_store.store_id = :store_id'",177],",",["T_WHITESPACE","\n                ",177],["T_ARRAY","array",178],"(",")",")",["T_WHITESPACE","\n            ",178],["T_OBJECT_OPERATOR","->",179],["T_STRING","join",179],"(",["T_WHITESPACE","\n                ",179],["T_ARRAY","array",180],"(",["T_CONSTANT_ENCAPSED_STRING","'rst'",180],["T_WHITESPACE"," ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getTable",180],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_store'",180],")",")",",",["T_WHITESPACE","\n                ",180],["T_CONSTANT_ENCAPSED_STRING","'rst.rating_id = rating_option_vote.rating_id AND rst.store_id = :rst_store_id'",181],",",["T_WHITESPACE","\n                ",181],["T_ARRAY","array",182],"(",")",")",["T_WHITESPACE","\n            ",182],["T_OBJECT_OPERATOR","->",183],["T_STRING","join",183],"(",["T_ARRAY","array",183],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",183],["T_WHITESPACE","              ",183],["T_DOUBLE_ARROW","=>",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getTable",183],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review'",183],")",")",",",["T_WHITESPACE","\n                ",183],["T_CONSTANT_ENCAPSED_STRING","'review_store.review_id=review.review_id AND review.status_id=1'",184],",",["T_WHITESPACE","\n                ",184],["T_ARRAY","array",185],"(",")",")",["T_WHITESPACE","\n            ",185],["T_OBJECT_OPERATOR","->",186],["T_STRING","where",186],"(",["T_VARIABLE","$inCond",186],")",["T_WHITESPACE","\n            ",186],["T_OBJECT_OPERATOR","->",187],["T_STRING","where",187],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote.entity_pk_value=:pk_value'",187],")",["T_WHITESPACE","\n            ",187],["T_OBJECT_OPERATOR","->",188],["T_STRING","group",188],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_option_vote.rating_id'",188],")",";",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$bind",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_ARRAY","array",189],"(",["T_WHITESPACE","\n            ",189],["T_CONSTANT_ENCAPSED_STRING","':store_id'",190],["T_WHITESPACE"," ",190],["T_DOUBLE_ARROW","=>",190],["T_WHITESPACE"," ",190],["T_INT_CAST","(int)",190],["T_VARIABLE","$storeId",190],",",["T_WHITESPACE","\n            ",190],["T_CONSTANT_ENCAPSED_STRING","':rst_store_id'",191],["T_WHITESPACE"," ",191],["T_DOUBLE_ARROW","=>",191],["T_WHITESPACE"," ",191],["T_INT_CAST","(int)",191],["T_VARIABLE","$storeId",191],",",["T_WHITESPACE","\n            ",191],["T_CONSTANT_ENCAPSED_STRING","':pk_value'",192],["T_WHITESPACE","     ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$entityPkValue",192],["T_WHITESPACE","\n        ",192],")",";",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$data",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getConnection",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","fetchAll",194],"(",["T_VARIABLE","$select",194],",",["T_WHITESPACE"," ",194],["T_VARIABLE","$bind",194],")",";",["T_WHITESPACE","\n\n        ",194],["T_FOREACH","foreach",196],["T_WHITESPACE"," ",196],"(",["T_VARIABLE","$data",196],["T_WHITESPACE"," ",196],["T_AS","as",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$item",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$rating",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getItemById",197],"(",["T_VARIABLE","$item",197],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",197],"]",")",";",["T_WHITESPACE","\n            ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$rating",198],["T_WHITESPACE"," ",198],["T_BOOLEAN_AND","&&",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$item",198],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",198],"]",">",["T_LNUMBER","0",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n                ",198],["T_VARIABLE","$rating",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","setSummary",199],"(",["T_VARIABLE","$item",199],"[",["T_CONSTANT_ENCAPSED_STRING","'sum'",199],"]","\/",["T_VARIABLE","$item",199],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",199],"]",")",";",["T_WHITESPACE","\n            ",199],"}",["T_WHITESPACE","\n        ",200],"}",["T_WHITESPACE","\n        ",201],["T_RETURN","return",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],";",["T_WHITESPACE","\n    ",202],"}",["T_WHITESPACE","\n\n    ",203],["T_DOC_COMMENT","\/**\n     * Add rating store name\n     *\n     * @param int $storeId\n     * @return Mage_Rating_Model_Resource_Rating_Collection\n     *\/",205],["T_WHITESPACE","\n    ",210],["T_PUBLIC","public",211],["T_WHITESPACE"," ",211],["T_FUNCTION","function",211],["T_WHITESPACE"," ",211],["T_STRING","addRatingPerStoreName",211],"(",["T_VARIABLE","$storeId",211],")",["T_WHITESPACE","\n    ",211],"{",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$adapter",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getConnection",213],"(",")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$ratingCodeCond",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$adapter",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getIfNullSql",214],"(",["T_CONSTANT_ENCAPSED_STRING","'title.value'",214],",",["T_WHITESPACE"," ",214],["T_CONSTANT_ENCAPSED_STRING","'main_table.rating_code'",214],")",";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getSelect",215],"(",")",["T_WHITESPACE","\n            ",215],["T_OBJECT_OPERATOR","->",216],["T_STRING","joinLeft",216],"(",["T_ARRAY","array",216],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getTable",216],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_title'",216],")",")",",",["T_WHITESPACE","\n                ",216],["T_VARIABLE","$adapter",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","quoteInto",217],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.rating_id=title.rating_id AND title.store_id = ?'",217],",",["T_WHITESPACE"," ",217],["T_INT_CAST","(int)",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$storeId",217],")",",",["T_WHITESPACE","\n                ",217],["T_ARRAY","array",218],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_code'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$ratingCodeCond",218],")",")",";",["T_WHITESPACE","\n        ",218],["T_RETURN","return",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],";",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n\n    ",220],["T_DOC_COMMENT","\/**\n     * Add stores to collection\n     *\n     * @return Mage_Rating_Model_Resource_Rating_Collection\n     *\/",222],["T_WHITESPACE","\n    ",226],["T_PUBLIC","public",227],["T_WHITESPACE"," ",227],["T_FUNCTION","function",227],["T_WHITESPACE"," ",227],["T_STRING","addStoresToCollection",227],"(",")",["T_WHITESPACE","\n    ",227],"{",["T_WHITESPACE","\n        ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(","!",["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","_isCollectionLoaded",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n            ",229],["T_RETURN","return",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],";",["T_WHITESPACE","\n        ",230],"}",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$ratingIds",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_ARRAY","array",232],"(",")",";",["T_WHITESPACE","\n        ",232],["T_FOREACH","foreach",233],["T_WHITESPACE"," ",233],"(",["T_VARIABLE","$this",233],["T_WHITESPACE"," ",233],["T_AS","as",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$item",233],")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n            ",233],["T_VARIABLE","$ratingIds",234],"[","]",["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$item",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getId",234],"(",")",";",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$item",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","setStores",235],"(",["T_ARRAY","array",235],"(",")",")",";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE","\n        ",236],["T_IF","if",237],["T_WHITESPACE"," ",237],"(","!",["T_VARIABLE","$ratingIds",237],")",["T_WHITESPACE"," ",237],"{",["T_WHITESPACE","\n            ",237],["T_RETURN","return",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],";",["T_WHITESPACE","\n        ",238],"}",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$adapter",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getConnection",240],"(",")",";",["T_WHITESPACE","\n\n        ",240],["T_VARIABLE","$inCond",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$adapter",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","prepareSqlCondition",242],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",242],",",["T_WHITESPACE"," ",242],["T_ARRAY","array",242],"(",["T_WHITESPACE","\n            ",242],["T_CONSTANT_ENCAPSED_STRING","'in'",243],["T_WHITESPACE"," ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$ratingIds",243],["T_WHITESPACE","\n        ",243],")",")",";",["T_WHITESPACE","\n\n        ",244],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_select",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$adapter",246],["T_WHITESPACE","\n            ",246],["T_OBJECT_OPERATOR","->",247],["T_STRING","select",247],"(",")",["T_WHITESPACE","\n            ",247],["T_OBJECT_OPERATOR","->",248],["T_STRING","from",248],"(",["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","getTable",248],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",248],")",")",["T_WHITESPACE","\n            ",248],["T_OBJECT_OPERATOR","->",249],["T_STRING","where",249],"(",["T_VARIABLE","$inCond",249],")",";",["T_WHITESPACE","\n\n        ",249],["T_VARIABLE","$data",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_VARIABLE","$adapter",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","fetchAll",251],"(",["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","_select",251],")",";",["T_WHITESPACE","\n        ",251],["T_IF","if",252],["T_WHITESPACE"," ",252],"(",["T_STRING","is_array",252],"(",["T_VARIABLE","$data",252],")",["T_WHITESPACE"," ",252],["T_BOOLEAN_AND","&&",252],["T_WHITESPACE"," ",252],["T_STRING","count",252],"(",["T_VARIABLE","$data",252],")",["T_WHITESPACE"," ",252],">",["T_WHITESPACE"," ",252],["T_LNUMBER","0",252],")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n            ",252],["T_FOREACH","foreach",253],["T_WHITESPACE"," ",253],"(",["T_VARIABLE","$data",253],["T_WHITESPACE"," ",253],["T_AS","as",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$row",253],")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n                ",253],["T_VARIABLE","$item",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getItemById",254],"(",["T_VARIABLE","$row",254],"[",["T_CONSTANT_ENCAPSED_STRING","'rating_id'",254],"]",")",";",["T_WHITESPACE","\n                ",254],["T_VARIABLE","$item",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","setStores",255],"(",["T_STRING","array_merge",255],"(",["T_VARIABLE","$item",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getStores",255],"(",")",",",["T_WHITESPACE"," ",255],["T_ARRAY","array",255],"(",["T_VARIABLE","$row",255],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",255],"]",")",")",")",";",["T_WHITESPACE","\n            ",255],"}",["T_WHITESPACE","\n        ",256],"}",["T_WHITESPACE","\n        ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$this",258],";",["T_WHITESPACE","\n    ",258],"}",["T_WHITESPACE","\n",259],"}",["T_WHITESPACE","\n",260]]