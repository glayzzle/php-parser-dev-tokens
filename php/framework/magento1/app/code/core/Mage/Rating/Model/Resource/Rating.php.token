[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Rating\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Rating resource model\n *\n * @category    Mage\n * @package     Mage_Rating\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Rating_Model_Resource_Rating",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","RATING_STATUS_APPROVED",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'Approved'",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Resource initialization\n     *\/",38],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_init",43],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Initialize unique fields\n     *\n     * @return Mage_Rating_Model_Resource_Rating\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","_initUniqueFields",51],"(",")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_uniqueFields",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_ARRAY","array",53],"(",["T_ARRAY","array",53],"(",["T_WHITESPACE","\n            ",53],["T_CONSTANT_ENCAPSED_STRING","'field'",54],["T_WHITESPACE"," ",54],["T_DOUBLE_ARROW","=>",54],["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'rating_code'",54],",",["T_WHITESPACE","\n            ",54],["T_CONSTANT_ENCAPSED_STRING","'title'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_COMMENT","\/* Mage::helper('rating')->__('Rating with the same title')*\/",55],["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","''",55],["T_WHITESPACE","\n        ",55],")",")",";",["T_WHITESPACE","\n        ",56],["T_RETURN","return",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Retrieve select object for load object data\n     *\n     * @param string $field\n     * @param mixed $value\n     * @param Mage_Rating_Model_Rating $object\n     * @return Varien_Db_Select\n     *\/",60],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","_getLoadSelect",68],"(",["T_VARIABLE","$field",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$value",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$object",68],")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$adapter",70],["T_WHITESPACE","    ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_getReadAdapter",70],"(",")",";",["T_WHITESPACE","\n\n        ",70],["T_VARIABLE","$table",72],["T_WHITESPACE","      ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getMainTable",72],"(",")",";",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$storeId",73],["T_WHITESPACE","    ",73],"=",["T_WHITESPACE"," ",73],["T_INT_CAST","(int)",73],["T_STRING","Mage",73],["T_DOUBLE_COLON","::",73],["T_STRING","app",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getStore",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getId",73],"(",")",";",["T_WHITESPACE","\n        ",73],["T_VARIABLE","$select",74],["T_WHITESPACE","     ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","parent",74],["T_DOUBLE_COLON","::",74],["T_STRING","_getLoadSelect",74],"(",["T_VARIABLE","$field",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$value",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$object",74],")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$codeExpr",75],["T_WHITESPACE","   ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$adapter",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getIfNullSql",75],"(",["T_CONSTANT_ENCAPSED_STRING","'title.value'",75],",",["T_WHITESPACE"," ",75],"\"",["T_CURLY_OPEN","{",75],["T_VARIABLE","$table",75],"}",["T_ENCAPSED_AND_WHITESPACE",".rating_code",75],"\"",")",";",["T_WHITESPACE","\n\n        ",75],["T_VARIABLE","$select",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","joinLeft",77],"(",["T_WHITESPACE","\n            ",77],["T_ARRAY","array",78],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",78],["T_WHITESPACE"," ",78],["T_DOUBLE_ARROW","=>",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getTable",78],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_title'",78],")",")",",",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$adapter",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","quoteInto",79],"(","\"",["T_CURLY_OPEN","{",79],["T_VARIABLE","$table",79],"}",["T_ENCAPSED_AND_WHITESPACE",".rating_id = title.rating_id AND title.store_id = ?",79],"\"",",",["T_WHITESPACE"," ",79],["T_VARIABLE","$storeId",79],")",",",["T_WHITESPACE","\n            ",79],["T_ARRAY","array",80],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_code'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$codeExpr",80],")",")",";",["T_WHITESPACE","\n\n        ",80],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$select",82],";",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Actions after load\n     *\n     * @param Mage_Rating_Model_Rating $object\n     * @return Mage_Rating_Model_Resource_Rating\n     *\/",85],["T_WHITESPACE","\n    ",90],["T_PROTECTED","protected",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","_afterLoad",91],"(",["T_STRING","Mage_Core_Model_Abstract",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$object",91],")",["T_WHITESPACE","\n    ",91],"{",["T_WHITESPACE","\n        ",92],["T_STRING","parent",93],["T_DOUBLE_COLON","::",93],["T_STRING","_afterLoad",93],"(",["T_VARIABLE","$object",93],")",";",["T_WHITESPACE","\n\n        ",93],["T_IF","if",95],["T_WHITESPACE"," ",95],"(","!",["T_VARIABLE","$object",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getId",95],"(",")",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE","\n\n        ",97],["T_VARIABLE","$adapter",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_getReadAdapter",99],"(",")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$bind",100],["T_WHITESPACE","    ",100],"=",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],"(",["T_CONSTANT_ENCAPSED_STRING","':rating_id'",100],["T_WHITESPACE"," ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_INT_CAST","(int)",100],["T_VARIABLE","$object",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getId",100],"(",")",")",";",["T_WHITESPACE","\n        ",100],["T_COMMENT","\/\/ load rating titles\n",101],["T_WHITESPACE","        ",102],["T_VARIABLE","$select",102],["T_WHITESPACE","  ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$adapter",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","select",102],"(",")",["T_WHITESPACE","\n            ",102],["T_OBJECT_OPERATOR","->",103],["T_STRING","from",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getTable",103],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_title'",103],")",",",["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'value'",103],")",")",["T_WHITESPACE","\n            ",103],["T_OBJECT_OPERATOR","->",104],["T_STRING","where",104],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id=:rating_id'",104],")",";",["T_WHITESPACE","\n\n        ",104],["T_VARIABLE","$result",106],["T_WHITESPACE","  ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$adapter",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","fetchPairs",106],"(",["T_VARIABLE","$select",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$bind",106],")",";",["T_WHITESPACE","\n        ",106],["T_IF","if",107],["T_WHITESPACE"," ",107],"(",["T_VARIABLE","$result",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$object",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","setRatingCodes",108],"(",["T_VARIABLE","$result",108],")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n\n        ",109],["T_COMMENT","\/\/ load rating available in stores\n",111],["T_WHITESPACE","        ",112],["T_VARIABLE","$object",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","setStores",112],"(",["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getStores",112],"(",["T_INT_CAST","(int)",112],["T_VARIABLE","$object",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getId",112],"(",")",")",")",";",["T_WHITESPACE","\n\n        ",112],["T_RETURN","return",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Retrieve store IDs related to given rating\n     *\n     * @param  int $ratingId\n     * @return array\n     *\/",117],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","getStores",123],"(",["T_VARIABLE","$ratingId",123],")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$select",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_getReadAdapter",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","select",125],"(",")",["T_WHITESPACE","\n            ",125],["T_OBJECT_OPERATOR","->",126],["T_STRING","from",126],"(",["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getTable",126],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_store'",126],")",",",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'store_id'",126],")",["T_WHITESPACE","\n            ",126],["T_OBJECT_OPERATOR","->",127],["T_STRING","where",127],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id = ?'",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$ratingId",127],")",";",["T_WHITESPACE","\n        ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_getReadAdapter",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","fetchCol",128],"(",["T_VARIABLE","$select",128],")",";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * Actions after save\n     *\n     * @param Mage_Rating_Model_Rating $object\n     * @return Mage_Rating_Model_Resource_Rating\n     *\/",131],["T_WHITESPACE","\n    ",136],["T_PROTECTED","protected",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","_afterSave",137],"(",["T_STRING","Mage_Core_Model_Abstract",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$object",137],")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_STRING","parent",139],["T_DOUBLE_COLON","::",139],["T_STRING","_afterSave",139],"(",["T_VARIABLE","$object",139],")",";",["T_WHITESPACE","\n\n        ",139],["T_VARIABLE","$adapter",141],["T_WHITESPACE","  ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_getWriteAdapter",141],"(",")",";",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$ratingId",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_INT_CAST","(int)",142],["T_VARIABLE","$object",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getId",142],"(",")",";",["T_WHITESPACE","\n\n        ",142],["T_IF","if",144],["T_WHITESPACE"," ",144],"(",["T_VARIABLE","$object",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","hasRatingCodes",144],"(",")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$ratingTitleTable",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getTable",145],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_title'",145],")",";",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$adapter",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","beginTransaction",146],"(",")",";",["T_WHITESPACE","\n            ",146],["T_TRY","try",147],["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                ",147],["T_VARIABLE","$select",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_VARIABLE","$adapter",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","select",148],"(",")",["T_WHITESPACE","\n                    ",148],["T_OBJECT_OPERATOR","->",149],["T_STRING","from",149],"(",["T_VARIABLE","$ratingTitleTable",149],",",["T_WHITESPACE"," ",149],["T_ARRAY","array",149],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",149],",",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'value'",149],")",")",["T_WHITESPACE","\n                    ",149],["T_OBJECT_OPERATOR","->",150],["T_STRING","where",150],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id = :rating_id'",150],")",";",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$old",151],["T_WHITESPACE","    ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$adapter",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","fetchPairs",151],"(",["T_VARIABLE","$select",151],",",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_CONSTANT_ENCAPSED_STRING","':rating_id'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$ratingId",151],")",")",";",["T_WHITESPACE","\n                ",151],["T_VARIABLE","$new",152],["T_WHITESPACE","    ",152],"=",["T_WHITESPACE"," ",152],["T_STRING","array_filter",152],"(",["T_STRING","array_map",152],"(",["T_CONSTANT_ENCAPSED_STRING","'trim'",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$object",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getRatingCodes",152],"(",")",")",")",";",["T_WHITESPACE","\n\n                ",152],["T_VARIABLE","$insert",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_STRING","array_diff_assoc",154],"(",["T_VARIABLE","$new",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$old",154],")",";",["T_WHITESPACE","\n                ",154],["T_VARIABLE","$delete",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_STRING","array_diff_assoc",155],"(",["T_VARIABLE","$old",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$new",155],")",";",["T_WHITESPACE","\n                ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(","!",["T_EMPTY","empty",156],"(",["T_VARIABLE","$delete",156],")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                    ",156],["T_VARIABLE","$where",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_ARRAY","array",157],"(",["T_WHITESPACE","\n                        ",157],["T_CONSTANT_ENCAPSED_STRING","'rating_id = ?'",158],["T_WHITESPACE"," ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$ratingId",158],",",["T_WHITESPACE","\n                        ",158],["T_CONSTANT_ENCAPSED_STRING","'store_id IN(?)'",159],["T_WHITESPACE"," ",159],["T_DOUBLE_ARROW","=>",159],["T_WHITESPACE"," ",159],["T_STRING","array_keys",159],"(",["T_VARIABLE","$delete",159],")",["T_WHITESPACE","\n                    ",159],")",";",["T_WHITESPACE","\n                    ",160],["T_VARIABLE","$adapter",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","delete",161],"(",["T_VARIABLE","$ratingTitleTable",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$where",161],")",";",["T_WHITESPACE","\n                ",161],"}",["T_WHITESPACE","\n\n                ",162],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$insert",164],")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n                    ",164],["T_VARIABLE","$data",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_ARRAY","array",165],"(",")",";",["T_WHITESPACE","\n                    ",165],["T_FOREACH","foreach",166],["T_WHITESPACE"," ",166],"(",["T_VARIABLE","$insert",166],["T_WHITESPACE"," ",166],["T_AS","as",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$storeId",166],["T_WHITESPACE"," ",166],["T_DOUBLE_ARROW","=>",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$title",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n                        ",166],["T_VARIABLE","$data",167],"[","]",["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",["T_WHITESPACE","\n                            ",167],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",168],["T_WHITESPACE"," ",168],["T_DOUBLE_ARROW","=>",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$ratingId",168],",",["T_WHITESPACE","\n                            ",168],["T_CONSTANT_ENCAPSED_STRING","'store_id'",169],["T_WHITESPACE","  ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_INT_CAST","(int)",169],["T_VARIABLE","$storeId",169],",",["T_WHITESPACE","\n                            ",169],["T_CONSTANT_ENCAPSED_STRING","'value'",170],["T_WHITESPACE","     ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$title",170],["T_WHITESPACE","\n                        ",170],")",";",["T_WHITESPACE","\n                    ",171],"}",["T_WHITESPACE","\n                    ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(","!",["T_EMPTY","empty",173],"(",["T_VARIABLE","$data",173],")",")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n                        ",173],["T_VARIABLE","$adapter",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","insertMultiple",174],"(",["T_VARIABLE","$ratingTitleTable",174],",",["T_WHITESPACE"," ",174],["T_VARIABLE","$data",174],")",";",["T_WHITESPACE","\n                    ",174],"}",["T_WHITESPACE","\n                ",175],"}",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$adapter",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","commit",177],"(",")",";",["T_WHITESPACE","\n            ",177],"}",["T_WHITESPACE"," ",178],["T_CATCH","catch",178],["T_WHITESPACE"," ",178],"(",["T_STRING","Exception",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$e",178],")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n                ",178],["T_STRING","Mage",179],["T_DOUBLE_COLON","::",179],["T_STRING","logException",179],"(",["T_VARIABLE","$e",179],")",";",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$adapter",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","rollBack",180],"(",")",";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n\n        ",182],["T_IF","if",184],["T_WHITESPACE"," ",184],"(",["T_VARIABLE","$object",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","hasStores",184],"(",")",")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$ratingStoreTable",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getTable",185],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_store'",185],")",";",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$adapter",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","beginTransaction",186],"(",")",";",["T_WHITESPACE","\n            ",186],["T_TRY","try",187],["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$select",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$adapter",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","select",188],"(",")",["T_WHITESPACE","\n                    ",188],["T_OBJECT_OPERATOR","->",189],["T_STRING","from",189],"(",["T_VARIABLE","$ratingStoreTable",189],",",["T_WHITESPACE"," ",189],["T_ARRAY","array",189],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",189],")",")",["T_WHITESPACE","\n                    ",189],["T_OBJECT_OPERATOR","->",190],["T_STRING","where",190],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_id = :rating_id'",190],")",";",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$old",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$adapter",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","fetchCol",191],"(",["T_VARIABLE","$select",191],",",["T_WHITESPACE"," ",191],["T_ARRAY","array",191],"(",["T_CONSTANT_ENCAPSED_STRING","':rating_id'",191],["T_WHITESPACE"," ",191],["T_DOUBLE_ARROW","=>",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$ratingId",191],")",")",";",["T_WHITESPACE","\n                ",191],["T_VARIABLE","$new",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$object",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getStores",192],"(",")",";",["T_WHITESPACE","\n\n                ",192],["T_VARIABLE","$insert",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_STRING","array_diff",194],"(",["T_VARIABLE","$new",194],",",["T_WHITESPACE"," ",194],["T_VARIABLE","$old",194],")",";",["T_WHITESPACE","\n                ",194],["T_VARIABLE","$delete",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_STRING","array_diff",195],"(",["T_VARIABLE","$old",195],",",["T_WHITESPACE"," ",195],["T_VARIABLE","$new",195],")",";",["T_WHITESPACE","\n\n                ",195],["T_IF","if",197],["T_WHITESPACE"," ",197],"(",["T_VARIABLE","$delete",197],")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n                    ",197],["T_VARIABLE","$where",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_ARRAY","array",198],"(",["T_WHITESPACE","\n                        ",198],["T_CONSTANT_ENCAPSED_STRING","'rating_id = ?'",199],["T_WHITESPACE"," ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$ratingId",199],",",["T_WHITESPACE","\n                        ",199],["T_CONSTANT_ENCAPSED_STRING","'store_id IN(?)'",200],["T_WHITESPACE"," ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$delete",200],["T_WHITESPACE","\n                    ",200],")",";",["T_WHITESPACE","\n                    ",201],["T_VARIABLE","$adapter",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","delete",202],"(",["T_VARIABLE","$ratingStoreTable",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$where",202],")",";",["T_WHITESPACE","\n                ",202],"}",["T_WHITESPACE","\n\n                ",203],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_VARIABLE","$insert",205],")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n                    ",205],["T_VARIABLE","$data",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_ARRAY","array",206],"(",")",";",["T_WHITESPACE","\n                    ",206],["T_FOREACH","foreach",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$insert",207],["T_WHITESPACE"," ",207],["T_AS","as",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$storeId",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                        ",207],["T_VARIABLE","$data",208],"[","]",["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_ARRAY","array",208],"(",["T_WHITESPACE","\n                            ",208],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",209],["T_WHITESPACE"," ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$ratingId",209],",",["T_WHITESPACE","\n                            ",209],["T_CONSTANT_ENCAPSED_STRING","'store_id'",210],["T_WHITESPACE","  ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_INT_CAST","(int)",210],["T_VARIABLE","$storeId",210],",",["T_WHITESPACE","\n                        ",210],")",";",["T_WHITESPACE","\n                    ",211],"}",["T_WHITESPACE","\n                    ",212],["T_VARIABLE","$adapter",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","insertMultiple",213],"(",["T_VARIABLE","$ratingStoreTable",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$data",213],")",";",["T_WHITESPACE","\n                ",213],"}",["T_WHITESPACE","\n\n                ",214],["T_VARIABLE","$adapter",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","commit",216],"(",")",";",["T_WHITESPACE","\n            ",216],"}",["T_WHITESPACE"," ",217],["T_CATCH","catch",217],["T_WHITESPACE"," ",217],"(",["T_STRING","Exception",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$e",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n                ",217],["T_STRING","Mage",218],["T_DOUBLE_COLON","::",218],["T_STRING","logException",218],"(",["T_VARIABLE","$e",218],")",";",["T_WHITESPACE","\n                ",218],["T_VARIABLE","$adapter",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","rollBack",219],"(",")",";",["T_WHITESPACE","\n            ",219],"}",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n\n        ",221],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Perform actions after object delete\n     * Prepare rating data for reaggregate all data for reviews\n     *\n     * @param Mage_Rating_Model_Rating $object\n     * @return Mage_Rating_Model_Resource_Rating\n     *\/",226],["T_WHITESPACE","\n    ",232],["T_PROTECTED","protected",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","_afterDelete",233],"(",["T_STRING","Mage_Core_Model_Abstract",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$object",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_STRING","parent",235],["T_DOUBLE_COLON","::",235],["T_STRING","_afterDelete",235],"(",["T_VARIABLE","$object",235],")",";",["T_WHITESPACE","\n        ",235],["T_IF","if",236],["T_WHITESPACE"," ",236],"(","!",["T_STRING","Mage",236],["T_DOUBLE_COLON","::",236],["T_STRING","helper",236],"(",["T_CONSTANT_ENCAPSED_STRING","'rating'",236],")",["T_OBJECT_OPERATOR","->",236],["T_STRING","isModuleEnabled",236],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Review'",236],")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_RETURN","return",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n        ",238],["T_VARIABLE","$data",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","_getEntitySummaryData",239],"(",["T_VARIABLE","$object",239],")",";",["T_WHITESPACE","\n        ",239],["T_VARIABLE","$summary",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_ARRAY","array",240],"(",")",";",["T_WHITESPACE","\n        ",240],["T_FOREACH","foreach",241],["T_WHITESPACE"," ",241],"(",["T_VARIABLE","$data",241],["T_WHITESPACE"," ",241],["T_AS","as",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$row",241],")",["T_WHITESPACE"," ",241],"{",["T_WHITESPACE","\n            ",241],["T_VARIABLE","$clone",242],["T_WHITESPACE"," ",242],"=",["T_WHITESPACE"," ",242],["T_CLONE","clone",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$object",242],";",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$clone",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","addData",243],"(",["T_VARIABLE","$row",243],")",";",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$summary",244],"[",["T_VARIABLE","$clone",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getStoreId",244],"(",")","]","[",["T_VARIABLE","$clone",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getEntityPkValue",244],"(",")","]",["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_VARIABLE","$clone",244],";",["T_WHITESPACE","\n        ",244],"}",["T_WHITESPACE","\n        ",245],["T_STRING","Mage",246],["T_DOUBLE_COLON","::",246],["T_STRING","getResourceModel",246],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_summary'",246],")",["T_OBJECT_OPERATOR","->",246],["T_STRING","reAggregate",246],"(",["T_VARIABLE","$summary",246],")",";",["T_WHITESPACE","\n        ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],";",["T_WHITESPACE","\n    ",247],"}",["T_WHITESPACE","\n\n    ",248],["T_DOC_COMMENT","\/**\n     * Return array of rating summary\n     *\n     * @param Mage_Rating_Model_Rating $object\n     * @param boolean $onlyForCurrentStore\n     * @return array\n     *\/",250],["T_WHITESPACE","\n    ",256],["T_PUBLIC","public",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","getEntitySummary",257],"(",["T_VARIABLE","$object",257],",",["T_WHITESPACE"," ",257],["T_VARIABLE","$onlyForCurrentStore",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","true",257],")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$data",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_getEntitySummaryData",259],"(",["T_VARIABLE","$object",259],")",";",["T_WHITESPACE","\n\n        ",259],["T_IF","if",261],["T_WHITESPACE"," ",261],"(",["T_VARIABLE","$onlyForCurrentStore",261],")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_FOREACH","foreach",262],["T_WHITESPACE"," ",262],"(",["T_VARIABLE","$data",262],["T_WHITESPACE"," ",262],["T_AS","as",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$row",262],")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n                ",262],["T_IF","if",263],["T_WHITESPACE"," ",263],"(",["T_VARIABLE","$row",263],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",263],"]",["T_IS_EQUAL","==",263],["T_STRING","Mage",263],["T_DOUBLE_COLON","::",263],["T_STRING","app",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","getStore",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","getId",263],"(",")",")",["T_WHITESPACE"," ",263],"{",["T_WHITESPACE","\n                    ",263],["T_VARIABLE","$object",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","addData",264],"(",["T_VARIABLE","$row",264],")",";",["T_WHITESPACE","\n                ",264],"}",["T_WHITESPACE","\n            ",265],"}",["T_WHITESPACE","\n            ",266],["T_RETURN","return",267],["T_WHITESPACE"," ",267],["T_VARIABLE","$object",267],";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE","\n\n        ",268],["T_VARIABLE","$result",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_ARRAY","array",270],"(",")",";",["T_WHITESPACE","\n\n        ",270],["T_COMMENT","\/\/$stores = Mage::app()->getStore()->getResourceCollection()->load();\n",272],["T_WHITESPACE","        ",273],["T_VARIABLE","$stores",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","Mage",273],["T_DOUBLE_COLON","::",273],["T_STRING","getModel",273],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/store'",273],")",["T_OBJECT_OPERATOR","->",273],["T_STRING","getResourceCollection",273],"(",")",["T_OBJECT_OPERATOR","->",273],["T_STRING","load",273],"(",")",";",["T_WHITESPACE","\n\n        ",273],["T_FOREACH","foreach",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$data",275],["T_WHITESPACE"," ",275],["T_AS","as",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$row",275],")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$clone",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_CLONE","clone",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$object",276],";",["T_WHITESPACE","\n            ",276],["T_VARIABLE","$clone",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","addData",277],"(",["T_VARIABLE","$row",277],")",";",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$result",278],"[",["T_VARIABLE","$clone",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getStoreId",278],"(",")","]",["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$clone",278],";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n\n        ",279],["T_VARIABLE","$usedStoresId",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","array_keys",281],"(",["T_VARIABLE","$result",281],")",";",["T_WHITESPACE","\n\n        ",281],["T_FOREACH","foreach",283],["T_WHITESPACE"," ",283],"(",["T_VARIABLE","$stores",283],["T_WHITESPACE"," ",283],["T_AS","as",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$store",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(","!",["T_STRING","in_array",284],"(",["T_VARIABLE","$store",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getId",284],"(",")",",",["T_WHITESPACE"," ",284],["T_VARIABLE","$usedStoresId",284],")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                ",284],["T_VARIABLE","$clone",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_CLONE","clone",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$object",285],";",["T_WHITESPACE","\n                ",285],["T_VARIABLE","$clone",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","setCount",286],"(",["T_LNUMBER","0",286],")",";",["T_WHITESPACE","\n                ",286],["T_VARIABLE","$clone",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","setSum",287],"(",["T_LNUMBER","0",287],")",";",["T_WHITESPACE","\n                ",287],["T_VARIABLE","$clone",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","setStoreId",288],"(",["T_VARIABLE","$store",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getId",288],"(",")",")",";",["T_WHITESPACE","\n                ",288],["T_VARIABLE","$result",289],"[",["T_VARIABLE","$store",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getId",289],"(",")","]",["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$clone",289],";",["T_WHITESPACE","\n            ",289],"}",["T_WHITESPACE","\n        ",290],"}",["T_WHITESPACE","\n\n        ",291],["T_RETURN","return",293],["T_WHITESPACE"," ",293],["T_STRING","array_values",293],"(",["T_VARIABLE","$result",293],")",";",["T_WHITESPACE","\n    ",293],"}",["T_WHITESPACE","\n\n    ",294],["T_DOC_COMMENT","\/**\n     * Return data of rating summary\n     *\n     * @param Mage_Rating_Model_Rating $object\n     * @return array\n     *\/",296],["T_WHITESPACE","\n    ",301],["T_PROTECTED","protected",302],["T_WHITESPACE"," ",302],["T_FUNCTION","function",302],["T_WHITESPACE"," ",302],["T_STRING","_getEntitySummaryData",302],"(",["T_VARIABLE","$object",302],")",["T_WHITESPACE","\n    ",302],"{",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$adapter",304],["T_WHITESPACE","    ",304],"=",["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_getReadAdapter",304],"(",")",";",["T_WHITESPACE","\n\n        ",304],["T_VARIABLE","$sumColumn",306],["T_WHITESPACE","      ",306],"=",["T_WHITESPACE"," ",306],["T_NEW","new",306],["T_WHITESPACE"," ",306],["T_STRING","Zend_Db_Expr",306],"(","\"",["T_ENCAPSED_AND_WHITESPACE","SUM(rating_vote.",306],["T_CURLY_OPEN","{",306],["T_VARIABLE","$adapter",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","quoteIdentifier",306],"(",["T_CONSTANT_ENCAPSED_STRING","'percent'",306],")","}",["T_ENCAPSED_AND_WHITESPACE",")",306],"\"",")",";",["T_WHITESPACE","\n        ",306],["T_VARIABLE","$countColumn",307],["T_WHITESPACE","    ",307],"=",["T_WHITESPACE"," ",307],["T_NEW","new",307],["T_WHITESPACE"," ",307],["T_STRING","Zend_Db_Expr",307],"(",["T_CONSTANT_ENCAPSED_STRING","\"COUNT(*)\"",307],")",";",["T_WHITESPACE","\n\n        ",307],["T_VARIABLE","$select",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$adapter",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","select",309],"(",")",["T_WHITESPACE","\n            ",309],["T_OBJECT_OPERATOR","->",310],["T_STRING","from",310],"(",["T_ARRAY","array",310],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_vote'",310],["T_WHITESPACE"," ",310],["T_DOUBLE_ARROW","=>",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getTable",310],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_vote'",310],")",")",",",["T_WHITESPACE","\n                ",310],["T_ARRAY","array",311],"(",["T_WHITESPACE","\n                    ",311],["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",312],["T_WHITESPACE"," ",312],["T_DOUBLE_ARROW","=>",312],["T_WHITESPACE"," ",312],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.entity_pk_value'",312],",",["T_WHITESPACE","\n                    ",312],["T_CONSTANT_ENCAPSED_STRING","'sum'",313],["T_WHITESPACE","             ",313],["T_DOUBLE_ARROW","=>",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$sumColumn",313],",",["T_WHITESPACE","\n                    ",313],["T_CONSTANT_ENCAPSED_STRING","'count'",314],["T_WHITESPACE","           ",314],["T_DOUBLE_ARROW","=>",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$countColumn",314],")",")",["T_WHITESPACE","\n            ",314],["T_OBJECT_OPERATOR","->",315],["T_STRING","join",315],"(",["T_ARRAY","array",315],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",315],["T_WHITESPACE"," ",315],["T_DOUBLE_ARROW","=>",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getTable",315],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review'",315],")",")",",",["T_WHITESPACE","\n                ",315],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id=review.review_id'",316],",",["T_WHITESPACE","\n                ",316],["T_ARRAY","array",317],"(",")",")",["T_WHITESPACE","\n            ",317],["T_OBJECT_OPERATOR","->",318],["T_STRING","joinLeft",318],"(",["T_ARRAY","array",318],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store'",318],["T_WHITESPACE"," ",318],["T_DOUBLE_ARROW","=>",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getTable",318],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_store'",318],")",")",",",["T_WHITESPACE","\n                ",318],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id=review_store.review_id'",319],",",["T_WHITESPACE","\n                ",319],["T_ARRAY","array",320],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",320],")",")",["T_WHITESPACE","\n            ",320],["T_OBJECT_OPERATOR","->",321],["T_STRING","join",321],"(",["T_ARRAY","array",321],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",321],["T_WHITESPACE"," ",321],["T_DOUBLE_ARROW","=>",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","getTable",321],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_store'",321],")",")",",",["T_WHITESPACE","\n                ",321],["T_CONSTANT_ENCAPSED_STRING","'rating_store.rating_id = rating_vote.rating_id AND rating_store.store_id = review_store.store_id'",322],",",["T_WHITESPACE","\n                ",322],["T_ARRAY","array",323],"(",")",")",["T_WHITESPACE","\n            ",323],["T_OBJECT_OPERATOR","->",324],["T_STRING","join",324],"(",["T_ARRAY","array",324],"(",["T_CONSTANT_ENCAPSED_STRING","'review_status'",324],["T_WHITESPACE"," ",324],["T_DOUBLE_ARROW","=>",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","getTable",324],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_status'",324],")",")",",",["T_WHITESPACE","\n                ",324],["T_CONSTANT_ENCAPSED_STRING","'review.status_id = review_status.status_id'",325],",",["T_WHITESPACE","\n                ",325],["T_ARRAY","array",326],"(",")",")",["T_WHITESPACE","\n            ",326],["T_OBJECT_OPERATOR","->",327],["T_STRING","where",327],"(",["T_CONSTANT_ENCAPSED_STRING","'review_status.status_code = :status_code'",327],")",["T_WHITESPACE","\n            ",327],["T_OBJECT_OPERATOR","->",328],["T_STRING","group",328],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_vote.entity_pk_value'",328],")",["T_WHITESPACE","\n            ",328],["T_OBJECT_OPERATOR","->",329],["T_STRING","group",329],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",329],")",";",["T_WHITESPACE","\n        ",329],["T_VARIABLE","$bind",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_ARRAY","array",330],"(",["T_CONSTANT_ENCAPSED_STRING","':status_code'",330],["T_WHITESPACE"," ",330],["T_DOUBLE_ARROW","=>",330],["T_WHITESPACE"," ",330],["T_STRING","self",330],["T_DOUBLE_COLON","::",330],["T_STRING","RATING_STATUS_APPROVED",330],")",";",["T_WHITESPACE","\n\n        ",330],["T_VARIABLE","$entityPkValue",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$object",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getEntityPkValue",332],"(",")",";",["T_WHITESPACE","\n        ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$entityPkValue",333],")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$select",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","where",334],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_vote.entity_pk_value = :pk_value'",334],")",";",["T_WHITESPACE","\n            ",334],["T_VARIABLE","$bind",335],"[",["T_CONSTANT_ENCAPSED_STRING","':pk_value'",335],"]",["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_VARIABLE","$entityPkValue",335],";",["T_WHITESPACE","\n        ",335],"}",["T_WHITESPACE","\n\n        ",336],["T_RETURN","return",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$adapter",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","fetchAll",338],"(",["T_VARIABLE","$select",338],",",["T_WHITESPACE"," ",338],["T_VARIABLE","$bind",338],")",";",["T_WHITESPACE","\n    ",338],"}",["T_WHITESPACE","\n\n    ",339],["T_DOC_COMMENT","\/**\n     * Review summary\n     *\n     * @param Mage_Rating_Model_Rating $object\n     * @param boolean $onlyForCurrentStore\n     * @return array\n     *\/",341],["T_WHITESPACE","\n    ",347],["T_PUBLIC","public",348],["T_WHITESPACE"," ",348],["T_FUNCTION","function",348],["T_WHITESPACE"," ",348],["T_STRING","getReviewSummary",348],"(",["T_VARIABLE","$object",348],",",["T_WHITESPACE"," ",348],["T_VARIABLE","$onlyForCurrentStore",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_STRING","true",348],")",["T_WHITESPACE","\n    ",348],"{",["T_WHITESPACE","\n        ",349],["T_VARIABLE","$adapter",350],["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_VARIABLE","$this",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","_getReadAdapter",350],"(",")",";",["T_WHITESPACE","\n\n        ",350],["T_VARIABLE","$sumColumn",352],["T_WHITESPACE","      ",352],"=",["T_WHITESPACE"," ",352],["T_NEW","new",352],["T_WHITESPACE"," ",352],["T_STRING","Zend_Db_Expr",352],"(","\"",["T_ENCAPSED_AND_WHITESPACE","SUM(rating_vote.",352],["T_CURLY_OPEN","{",352],["T_VARIABLE","$adapter",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","quoteIdentifier",352],"(",["T_CONSTANT_ENCAPSED_STRING","'percent'",352],")","}",["T_ENCAPSED_AND_WHITESPACE",")",352],"\"",")",";",["T_WHITESPACE","\n        ",352],["T_VARIABLE","$countColumn",353],["T_WHITESPACE","    ",353],"=",["T_WHITESPACE"," ",353],["T_NEW","new",353],["T_WHITESPACE"," ",353],["T_STRING","Zend_Db_Expr",353],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",353],")",";",["T_WHITESPACE","\n        ",353],["T_VARIABLE","$select",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_VARIABLE","$adapter",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","select",354],"(",")",["T_WHITESPACE","\n            ",354],["T_OBJECT_OPERATOR","->",355],["T_STRING","from",355],"(",["T_ARRAY","array",355],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_vote'",355],["T_WHITESPACE"," ",355],["T_DOUBLE_ARROW","=>",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getTable",355],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_vote'",355],")",")",",",["T_WHITESPACE","\n                ",355],["T_ARRAY","array",356],"(",["T_WHITESPACE","\n                    ",356],["T_CONSTANT_ENCAPSED_STRING","'sum'",357],["T_WHITESPACE","   ",357],["T_DOUBLE_ARROW","=>",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$sumColumn",357],",",["T_WHITESPACE","\n                    ",357],["T_CONSTANT_ENCAPSED_STRING","'count'",358],["T_WHITESPACE"," ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$countColumn",358],["T_WHITESPACE","\n                ",358],")",")",["T_WHITESPACE","\n            ",359],["T_OBJECT_OPERATOR","->",360],["T_STRING","joinLeft",360],"(",["T_ARRAY","array",360],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store'",360],["T_WHITESPACE"," ",360],["T_DOUBLE_ARROW","=>",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getTable",360],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_store'",360],")",")",",",["T_WHITESPACE","\n                ",360],["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id = review_store.review_id'",361],",",["T_WHITESPACE","\n                ",361],["T_ARRAY","array",362],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",362],")",")",["T_WHITESPACE","\n            ",362],["T_OBJECT_OPERATOR","->",363],["T_STRING","join",363],"(",["T_ARRAY","array",363],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_store'",363],["T_WHITESPACE"," ",363],["T_DOUBLE_ARROW","=>",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getTable",363],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_store'",363],")",")",",",["T_WHITESPACE","\n                ",363],["T_CONSTANT_ENCAPSED_STRING","'rating_store.rating_id = rating_vote.rating_id AND rating_store.store_id = review_store.store_id'",364],",",["T_WHITESPACE","\n                ",364],["T_ARRAY","array",365],"(",")",")",["T_WHITESPACE","\n            ",365],["T_OBJECT_OPERATOR","->",366],["T_STRING","where",366],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id = :review_id'",366],")",["T_WHITESPACE","\n            ",366],["T_OBJECT_OPERATOR","->",367],["T_STRING","group",367],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_vote.review_id'",367],")",["T_WHITESPACE","\n            ",367],["T_OBJECT_OPERATOR","->",368],["T_STRING","group",368],"(",["T_CONSTANT_ENCAPSED_STRING","'review_store.store_id'",368],")",";",["T_WHITESPACE","\n\n        ",368],["T_VARIABLE","$data",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_VARIABLE","$adapter",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","fetchAll",370],"(",["T_VARIABLE","$select",370],",",["T_WHITESPACE"," ",370],["T_ARRAY","array",370],"(",["T_CONSTANT_ENCAPSED_STRING","':review_id'",370],["T_WHITESPACE"," ",370],["T_DOUBLE_ARROW","=>",370],["T_WHITESPACE"," ",370],["T_VARIABLE","$object",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getReviewId",370],"(",")",")",")",";",["T_WHITESPACE","\n\n        ",370],["T_IF","if",372],["T_WHITESPACE"," ",372],"(",["T_VARIABLE","$onlyForCurrentStore",372],")",["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n            ",372],["T_FOREACH","foreach",373],["T_WHITESPACE"," ",373],"(",["T_VARIABLE","$data",373],["T_WHITESPACE"," ",373],["T_AS","as",373],["T_WHITESPACE"," ",373],["T_VARIABLE","$row",373],")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n                ",373],["T_IF","if",374],["T_WHITESPACE"," ",374],"(",["T_VARIABLE","$row",374],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",374],"]",["T_WHITESPACE"," ",374],["T_IS_EQUAL","==",374],["T_WHITESPACE"," ",374],["T_STRING","Mage",374],["T_DOUBLE_COLON","::",374],["T_STRING","app",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","getStore",374],"(",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","getId",374],"(",")",")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n                    ",374],["T_VARIABLE","$object",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","addData",375],"(",["T_VARIABLE","$row",375],")",";",["T_WHITESPACE","\n                ",375],"}",["T_WHITESPACE","\n            ",376],"}",["T_WHITESPACE","\n            ",377],["T_RETURN","return",378],["T_WHITESPACE"," ",378],["T_VARIABLE","$object",378],";",["T_WHITESPACE","\n        ",378],"}",["T_WHITESPACE","\n\n        ",379],["T_VARIABLE","$result",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_ARRAY","array",381],"(",")",";",["T_WHITESPACE","\n\n        ",381],["T_VARIABLE","$stores",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_STRING","Mage",383],["T_DOUBLE_COLON","::",383],["T_STRING","app",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","getStore",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","getResourceCollection",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","load",383],"(",")",";",["T_WHITESPACE","\n\n        ",383],["T_FOREACH","foreach",385],["T_WHITESPACE"," ",385],"(",["T_VARIABLE","$data",385],["T_WHITESPACE"," ",385],["T_AS","as",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$row",385],")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n            ",385],["T_VARIABLE","$clone",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_CLONE","clone",386],["T_WHITESPACE"," ",386],["T_VARIABLE","$object",386],";",["T_WHITESPACE","\n            ",386],["T_VARIABLE","$clone",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","addData",387],"(",["T_VARIABLE","$row",387],")",";",["T_WHITESPACE","\n            ",387],["T_VARIABLE","$result",388],"[",["T_VARIABLE","$clone",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","getStoreId",388],"(",")","]",["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_VARIABLE","$clone",388],";",["T_WHITESPACE","\n        ",388],"}",["T_WHITESPACE","\n\n        ",389],["T_VARIABLE","$usedStoresId",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_STRING","array_keys",391],"(",["T_VARIABLE","$result",391],")",";",["T_WHITESPACE","\n\n        ",391],["T_FOREACH","foreach",393],["T_WHITESPACE"," ",393],"(",["T_VARIABLE","$stores",393],["T_WHITESPACE"," ",393],["T_AS","as",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$store",393],")",["T_WHITESPACE"," ",393],"{",["T_WHITESPACE","\n               ",393],["T_IF","if",394],["T_WHITESPACE"," ",394],"(","!",["T_STRING","in_array",394],"(",["T_VARIABLE","$store",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","getId",394],"(",")",",",["T_WHITESPACE"," ",394],["T_VARIABLE","$usedStoresId",394],")",")",["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n                   ",394],["T_VARIABLE","$clone",395],["T_WHITESPACE"," ",395],"=",["T_WHITESPACE"," ",395],["T_CLONE","clone",395],["T_WHITESPACE"," ",395],["T_VARIABLE","$object",395],";",["T_WHITESPACE","\n                ",395],["T_VARIABLE","$clone",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","setCount",396],"(",["T_LNUMBER","0",396],")",";",["T_WHITESPACE","\n                ",396],["T_VARIABLE","$clone",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","setSum",397],"(",["T_LNUMBER","0",397],")",";",["T_WHITESPACE","\n                ",397],["T_VARIABLE","$clone",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","setStoreId",398],"(",["T_VARIABLE","$store",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","getId",398],"(",")",")",";",["T_WHITESPACE","\n                ",398],["T_VARIABLE","$result",399],"[",["T_VARIABLE","$store",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getId",399],"(",")","]",["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_VARIABLE","$clone",399],";",["T_WHITESPACE","\n\n               ",399],"}",["T_WHITESPACE","\n        ",401],"}",["T_WHITESPACE","\n\n        ",402],["T_RETURN","return",404],["T_WHITESPACE"," ",404],["T_STRING","array_values",404],"(",["T_VARIABLE","$result",404],")",";",["T_WHITESPACE","\n    ",404],"}",["T_WHITESPACE","\n\n    ",405],["T_DOC_COMMENT","\/**\n     * Get rating entity type id by code\n     *\n     * @param string $entityCode\n     * @return int\n     *\/",407],["T_WHITESPACE","\n    ",412],["T_PUBLIC","public",413],["T_WHITESPACE"," ",413],["T_FUNCTION","function",413],["T_WHITESPACE"," ",413],["T_STRING","getEntityIdByCode",413],"(",["T_VARIABLE","$entityCode",413],")",["T_WHITESPACE","\n    ",413],"{",["T_WHITESPACE","\n        ",414],["T_VARIABLE","$select",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","_getReadAdapter",415],"(",")",["T_OBJECT_OPERATOR","->",415],["T_STRING","select",415],"(",")",["T_WHITESPACE","\n            ",415],["T_OBJECT_OPERATOR","->",416],["T_STRING","from",416],"(",["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getTable",416],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_entity'",416],")",",",["T_WHITESPACE"," ",416],["T_ARRAY","array",416],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",416],")",")",["T_WHITESPACE","\n            ",416],["T_OBJECT_OPERATOR","->",417],["T_STRING","where",417],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_code = :entity_code'",417],")",";",["T_WHITESPACE","\n\n        ",417],["T_RETURN","return",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","_getReadAdapter",419],"(",")",["T_OBJECT_OPERATOR","->",419],["T_STRING","fetchOne",419],"(",["T_VARIABLE","$select",419],",",["T_WHITESPACE"," ",419],["T_ARRAY","array",419],"(",["T_CONSTANT_ENCAPSED_STRING","':entity_code'",419],["T_WHITESPACE"," ",419],["T_DOUBLE_ARROW","=>",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$entityCode",419],")",")",";",["T_WHITESPACE","\n    ",419],"}",["T_WHITESPACE","\n\n    ",420],["T_DOC_COMMENT","\/**\n     * Delete ratings by product id\n     *\n     * @param int $productId\n     * @return Mage_Rating_Model_Resource_Rating\n     *\/",422],["T_WHITESPACE","\n    ",427],["T_PUBLIC","public",428],["T_WHITESPACE"," ",428],["T_FUNCTION","function",428],["T_WHITESPACE"," ",428],["T_STRING","deleteAggregatedRatingsByProductId",428],"(",["T_VARIABLE","$productId",428],")",["T_WHITESPACE","\n    ",428],"{",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$entityId",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getEntityIdByCode",430],"(",["T_STRING","Mage_Rating_Model_Rating",430],["T_DOUBLE_COLON","::",430],["T_STRING","ENTITY_PRODUCT_CODE",430],")",";",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$adapter",431],["T_WHITESPACE","  ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_getWriteAdapter",431],"(",")",";",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$select",432],["T_WHITESPACE","   ",432],"=",["T_WHITESPACE"," ",432],["T_VARIABLE","$adapter",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","select",432],"(",")",["T_WHITESPACE","\n            ",432],["T_OBJECT_OPERATOR","->",433],["T_STRING","from",433],"(",["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getMainTable",433],"(",")",",",["T_WHITESPACE"," ",433],["T_CONSTANT_ENCAPSED_STRING","'rating_id'",433],")",["T_WHITESPACE","\n            ",433],["T_OBJECT_OPERATOR","->",434],["T_STRING","where",434],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",434],")",";",["T_WHITESPACE","\n        ",434],["T_VARIABLE","$ratingIds",435],["T_WHITESPACE"," ",435],"=",["T_WHITESPACE"," ",435],["T_VARIABLE","$adapter",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","fetchCol",435],"(",["T_VARIABLE","$select",435],",",["T_WHITESPACE"," ",435],["T_ARRAY","array",435],"(",["T_CONSTANT_ENCAPSED_STRING","':entity_id'",435],["T_WHITESPACE"," ",435],["T_DOUBLE_ARROW","=>",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$entityId",435],")",")",";",["T_WHITESPACE","\n\n        ",435],["T_IF","if",437],["T_WHITESPACE"," ",437],"(",["T_VARIABLE","$ratingIds",437],")",["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n            ",437],["T_VARIABLE","$where",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_ARRAY","array",438],"(",["T_WHITESPACE","\n                ",438],["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value = ?'",439],["T_WHITESPACE"," ",439],["T_DOUBLE_ARROW","=>",439],["T_WHITESPACE"," ",439],["T_INT_CAST","(int)",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$productId",439],",",["T_WHITESPACE","\n                ",439],["T_CONSTANT_ENCAPSED_STRING","'rating_id IN(?)'",440],["T_WHITESPACE","     ",440],["T_DOUBLE_ARROW","=>",440],["T_WHITESPACE"," ",440],["T_VARIABLE","$ratingIds",440],["T_WHITESPACE","\n            ",440],")",";",["T_WHITESPACE","\n            ",441],["T_VARIABLE","$adapter",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","delete",442],"(",["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","getTable",442],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_vote_aggregated'",442],")",",",["T_WHITESPACE"," ",442],["T_VARIABLE","$where",442],")",";",["T_WHITESPACE","\n        ",442],"}",["T_WHITESPACE","\n\n        ",443],["T_RETURN","return",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],";",["T_WHITESPACE","\n    ",445],"}",["T_WHITESPACE","\n",446],"}",["T_WHITESPACE","\n",447]]