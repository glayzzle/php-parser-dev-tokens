[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Oauth\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * OAuth Helper\n *\n * @category    Mage\n * @package     Mage_Oauth\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Oauth_Helper_Data",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Helper_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_COMMENT","\/**#@+\n     * Endpoint types with appropriate routes\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","ENDPOINT_AUTHORIZE_CUSTOMER",39],["T_WHITESPACE","        ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'oauth\/authorize'",39],";",["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","ENDPOINT_AUTHORIZE_ADMIN",40],["T_WHITESPACE","           ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/oauth_authorize'",40],";",["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","ENDPOINT_AUTHORIZE_CUSTOMER_SIMPLE",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'oauth\/authorize\/simple'",41],";",["T_WHITESPACE","\n    ",41],["T_CONST","const",42],["T_WHITESPACE"," ",42],["T_STRING","ENDPOINT_AUTHORIZE_ADMIN_SIMPLE",42],["T_WHITESPACE","    ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/oauth_authorize\/simple'",42],";",["T_WHITESPACE","\n    ",42],["T_CONST","const",43],["T_WHITESPACE"," ",43],["T_STRING","ENDPOINT_INITIATE",43],["T_WHITESPACE","                  ",43],"=",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'oauth\/initiate'",43],";",["T_WHITESPACE","\n    ",43],["T_CONST","const",44],["T_WHITESPACE"," ",44],["T_STRING","ENDPOINT_TOKEN",44],["T_WHITESPACE","                     ",44],"=",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'oauth\/token'",44],";",["T_WHITESPACE","\n    ",44],["T_COMMENT","\/**#@-*\/",45],["T_WHITESPACE","\n\n    ",45],["T_COMMENT","\/**#@+\n     * Cleanup xpath config settings\n     *\/",47],["T_WHITESPACE","\n    ",49],["T_CONST","const",50],["T_WHITESPACE"," ",50],["T_STRING","XML_PATH_CLEANUP_PROBABILITY",50],["T_WHITESPACE","       ",50],"=",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'oauth\/cleanup\/cleanup_probability'",50],";",["T_WHITESPACE","\n    ",50],["T_CONST","const",51],["T_WHITESPACE"," ",51],["T_STRING","XML_PATH_CLEANUP_EXPIRATION_PERIOD",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'oauth\/cleanup\/expiration_period'",51],";",["T_WHITESPACE","\n    ",51],["T_COMMENT","\/**#@-*\/",52],["T_WHITESPACE","\n\n    ",52],["T_COMMENT","\/**#@+ Email template *\/",54],["T_WHITESPACE","\n    ",54],["T_CONST","const",55],["T_WHITESPACE"," ",55],["T_STRING","XML_PATH_EMAIL_TEMPLATE",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'oauth\/email\/template'",55],";",["T_WHITESPACE","\n    ",55],["T_CONST","const",56],["T_WHITESPACE"," ",56],["T_STRING","XML_PATH_EMAIL_IDENTITY",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'oauth\/email\/identity'",56],";",["T_WHITESPACE","\n    ",56],["T_COMMENT","\/**#@-*\/",57],["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Cleanup expiration period in minutes\n     *\/",59],["T_WHITESPACE","\n    ",61],["T_CONST","const",62],["T_WHITESPACE"," ",62],["T_STRING","CLEANUP_EXPIRATION_PERIOD_DEFAULT",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_LNUMBER","120",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Query parameter as a sign that user rejects\n     *\/",64],["T_WHITESPACE","\n    ",66],["T_CONST","const",67],["T_WHITESPACE"," ",67],["T_STRING","QUERY_PARAM_REJECTED",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'rejected'",67],";",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Available endpoints list\n     *\n     * @var array\n     *\/",69],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$_endpoints",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_ARRAY","array",74],"(",["T_WHITESPACE","\n        ",74],["T_STRING","self",75],["T_DOUBLE_COLON","::",75],["T_STRING","ENDPOINT_AUTHORIZE_CUSTOMER",75],",",["T_WHITESPACE","\n        ",75],["T_STRING","self",76],["T_DOUBLE_COLON","::",76],["T_STRING","ENDPOINT_AUTHORIZE_ADMIN",76],",",["T_WHITESPACE","\n        ",76],["T_STRING","self",77],["T_DOUBLE_COLON","::",77],["T_STRING","ENDPOINT_AUTHORIZE_CUSTOMER_SIMPLE",77],",",["T_WHITESPACE","\n        ",77],["T_STRING","self",78],["T_DOUBLE_COLON","::",78],["T_STRING","ENDPOINT_AUTHORIZE_ADMIN_SIMPLE",78],",",["T_WHITESPACE","\n        ",78],["T_STRING","self",79],["T_DOUBLE_COLON","::",79],["T_STRING","ENDPOINT_INITIATE",79],",",["T_WHITESPACE","\n        ",79],["T_STRING","self",80],["T_DOUBLE_COLON","::",80],["T_STRING","ENDPOINT_TOKEN",80],["T_WHITESPACE","\n    ",80],")",";",["T_WHITESPACE","\n\n    ",81],["T_DOC_COMMENT","\/**\n     * Generate random string for token or secret or verifier\n     *\n     * @param int $length String length\n     * @return string\n     *\/",83],["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","_generateRandomString",89],"(",["T_VARIABLE","$length",89],")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_IF","if",91],["T_WHITESPACE"," ",91],"(",["T_STRING","function_exists",91],"(",["T_CONSTANT_ENCAPSED_STRING","'openssl_random_pseudo_bytes'",91],")",")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_COMMENT","\/\/ use openssl lib if it is install. It provides a better randomness\n",92],["T_WHITESPACE","            ",93],["T_VARIABLE","$bytes",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_STRING","openssl_random_pseudo_bytes",93],"(",["T_STRING","ceil",93],"(",["T_VARIABLE","$length",93],"\/",["T_LNUMBER","2",93],")",",",["T_WHITESPACE"," ",93],["T_VARIABLE","$strong",93],")",";",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$hex",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","bin2hex",94],"(",["T_VARIABLE","$bytes",94],")",";",["T_WHITESPACE"," ",94],["T_COMMENT","\/\/ hex() doubles the length of the string\n",94],["T_WHITESPACE","            ",95],["T_VARIABLE","$randomString",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","substr",95],"(",["T_VARIABLE","$hex",95],",",["T_WHITESPACE"," ",95],["T_LNUMBER","0",95],",",["T_WHITESPACE"," ",95],["T_VARIABLE","$length",95],")",";",["T_WHITESPACE"," ",95],["T_COMMENT","\/\/ we truncate at most 1 char if length parameter is an odd number\n",95],["T_WHITESPACE","        ",96],"}",["T_WHITESPACE"," ",96],["T_ELSE","else",96],["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n            ",96],["T_COMMENT","\/\/ fallback to mt_rand() if openssl is not installed\n",97],["T_WHITESPACE","            ",98],["T_DOC_COMMENT","\/** @var $helper Mage_Core_Helper_Data *\/",98],["T_WHITESPACE","\n            ",98],["T_VARIABLE","$helper",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","helper",99],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",99],")",";",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$randomString",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$helper",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getRandomString",100],"(",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$length",101],",",["T_WHITESPACE"," ",101],["T_STRING","Mage_Core_Helper_Data",101],["T_DOUBLE_COLON","::",101],["T_STRING","CHARS_DIGITS",101],["T_WHITESPACE"," ",101],".",["T_WHITESPACE"," ",101],["T_STRING","Mage_Core_Helper_Data",101],["T_DOUBLE_COLON","::",101],["T_STRING","CHARS_LOWERS",101],["T_WHITESPACE","\n            ",101],")",";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n\n        ",103],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$randomString",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Generate random string for token\n     *\n     * @return string\n     *\/",108],["T_WHITESPACE","\n    ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","generateToken",113],"(",")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_generateRandomString",115],"(",["T_STRING","Mage_Oauth_Model_Token",115],["T_DOUBLE_COLON","::",115],["T_STRING","LENGTH_TOKEN",115],")",";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Generate random string for token secret\n     *\n     * @return string\n     *\/",118],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","generateTokenSecret",123],"(",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_generateRandomString",125],"(",["T_STRING","Mage_Oauth_Model_Token",125],["T_DOUBLE_COLON","::",125],["T_STRING","LENGTH_SECRET",125],")",";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Generate random string for verifier\n     *\n     * @return string\n     *\/",128],["T_WHITESPACE","\n    ",132],["T_PUBLIC","public",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","generateVerifier",133],"(",")",["T_WHITESPACE","\n    ",133],"{",["T_WHITESPACE","\n        ",134],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_generateRandomString",135],"(",["T_STRING","Mage_Oauth_Model_Token",135],["T_DOUBLE_COLON","::",135],["T_STRING","LENGTH_VERIFIER",135],")",";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Generate random string for consumer key\n     *\n     * @return string\n     *\/",138],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","generateConsumerKey",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_generateRandomString",145],"(",["T_STRING","Mage_Oauth_Model_Consumer",145],["T_DOUBLE_COLON","::",145],["T_STRING","KEY_LENGTH",145],")",";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Generate random string for consumer secret\n     *\n     * @return string\n     *\/",148],["T_WHITESPACE","\n    ",152],["T_PUBLIC","public",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","generateConsumerSecret",153],"(",")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_generateRandomString",155],"(",["T_STRING","Mage_Oauth_Model_Consumer",155],["T_DOUBLE_COLON","::",155],["T_STRING","SECRET_LENGTH",155],")",";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Return complete callback URL or boolean FALSE if no callback provided\n     *\n     * @param Mage_Oauth_Model_Token $token Token object\n     * @param bool $rejected OPTIONAL Add user reject sign\n     * @return bool|string\n     *\/",158],["T_WHITESPACE","\n    ",164],["T_PUBLIC","public",165],["T_WHITESPACE"," ",165],["T_FUNCTION","function",165],["T_WHITESPACE"," ",165],["T_STRING","getFullCallbackUrl",165],"(",["T_STRING","Mage_Oauth_Model_Token",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$token",165],",",["T_WHITESPACE"," ",165],["T_VARIABLE","$rejected",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_STRING","false",165],")",["T_WHITESPACE","\n    ",165],"{",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$callbackUrl",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$token",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getCallbackUrl",167],"(",")",";",["T_WHITESPACE","\n\n        ",167],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_STRING","Mage_Oauth_Model_Server",169],["T_DOUBLE_COLON","::",169],["T_STRING","CALLBACK_ESTABLISHED",169],["T_WHITESPACE"," ",169],["T_IS_EQUAL","==",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$callbackUrl",169],")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_RETURN","return",170],["T_WHITESPACE"," ",170],["T_STRING","false",170],";",["T_WHITESPACE","\n        ",170],"}",["T_WHITESPACE","\n        ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$rejected",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_DOC_COMMENT","\/** @var $consumer Mage_Oauth_Model_Consumer *\/",173],["T_WHITESPACE","\n            ",173],["T_VARIABLE","$consumer",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_STRING","Mage",174],["T_DOUBLE_COLON","::",174],["T_STRING","getModel",174],"(",["T_CONSTANT_ENCAPSED_STRING","'oauth\/consumer'",174],")",["T_OBJECT_OPERATOR","->",174],["T_STRING","load",174],"(",["T_VARIABLE","$token",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getConsumerId",174],"(",")",")",";",["T_WHITESPACE","\n\n            ",174],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$consumer",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getId",176],"(",")",["T_WHITESPACE"," ",176],["T_BOOLEAN_AND","&&",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$consumer",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getRejectedCallbackUrl",176],"(",")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$callbackUrl",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$consumer",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getRejectedCallbackUrl",177],"(",")",";",["T_WHITESPACE","\n            ",177],"}",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE"," ",179],["T_ELSEIF","elseif",179],["T_WHITESPACE"," ",179],"(","!",["T_VARIABLE","$token",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getAuthorized",179],"(",")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n            ",179],["T_STRING","Mage",180],["T_DOUBLE_COLON","::",180],["T_STRING","throwException",180],"(",["T_CONSTANT_ENCAPSED_STRING","'Token is not authorized'",180],")",";",["T_WHITESPACE","\n        ",180],"}",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$callbackUrl",182],["T_WHITESPACE"," ",182],["T_CONCAT_EQUAL",".=",182],["T_WHITESPACE"," ",182],"(",["T_STRING","false",182],["T_WHITESPACE"," ",182],["T_IS_IDENTICAL","===",182],["T_WHITESPACE"," ",182],["T_STRING","strpos",182],"(",["T_VARIABLE","$callbackUrl",182],",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'?'",182],")",["T_WHITESPACE"," ",182],"?",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'?'",182],["T_WHITESPACE"," ",182],":",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'&'",182],")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$callbackUrl",183],["T_WHITESPACE"," ",183],["T_CONCAT_EQUAL",".=",183],["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'oauth_token='",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_VARIABLE","$token",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getToken",183],"(",")",["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'&'",183],";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$callbackUrl",184],["T_WHITESPACE"," ",184],["T_CONCAT_EQUAL",".=",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$rejected",184],["T_WHITESPACE"," ",184],"?",["T_WHITESPACE"," ",184],["T_STRING","self",184],["T_DOUBLE_COLON","::",184],["T_STRING","QUERY_PARAM_REJECTED",184],["T_WHITESPACE"," ",184],".",["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'=1'",184],["T_WHITESPACE"," ",184],":",["T_WHITESPACE"," ",184],["T_CONSTANT_ENCAPSED_STRING","'oauth_verifier='",184],["T_WHITESPACE"," ",184],".",["T_WHITESPACE"," ",184],["T_VARIABLE","$token",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getVerifier",184],"(",")",";",["T_WHITESPACE","\n\n        ",184],["T_RETURN","return",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$callbackUrl",186],";",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n\n    ",187],["T_DOC_COMMENT","\/**\n     * Retrieve URL of specified endpoint.\n     *\n     * @param string $type Endpoint type (one of ENDPOINT_ constants)\n     * @return string\n     * @throws Exception    Exception when endpoint not found\n     *\/",189],["T_WHITESPACE","\n    ",195],["T_PUBLIC","public",196],["T_WHITESPACE"," ",196],["T_FUNCTION","function",196],["T_WHITESPACE"," ",196],["T_STRING","getProtocolEndpointUrl",196],"(",["T_VARIABLE","$type",196],")",["T_WHITESPACE","\n    ",196],"{",["T_WHITESPACE","\n        ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(","!",["T_STRING","in_array",198],"(",["T_VARIABLE","$type",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","_endpoints",198],")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_THROW","throw",199],["T_WHITESPACE"," ",199],["T_NEW","new",199],["T_WHITESPACE"," ",199],["T_STRING","Exception",199],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid endpoint type passed.'",199],")",";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n        ",200],["T_RETURN","return",201],["T_WHITESPACE"," ",201],["T_STRING","rtrim",201],"(",["T_STRING","Mage",201],["T_DOUBLE_COLON","::",201],["T_STRING","getUrl",201],"(",["T_VARIABLE","$type",201],")",",",["T_WHITESPACE"," ",201],["T_CONSTANT_ENCAPSED_STRING","'\/'",201],")",";",["T_WHITESPACE","\n    ",201],"}",["T_WHITESPACE","\n\n    ",202],["T_DOC_COMMENT","\/**\n     * Calculate cleanup possibility for data with lifetime property\n     *\n     * @return bool\n     *\/",204],["T_WHITESPACE","\n    ",208],["T_PUBLIC","public",209],["T_WHITESPACE"," ",209],["T_FUNCTION","function",209],["T_WHITESPACE"," ",209],["T_STRING","isCleanupProbability",209],"(",")",["T_WHITESPACE","\n    ",209],"{",["T_WHITESPACE","\n        ",210],["T_COMMENT","\/\/ Safe get cleanup probability value from system configuration\n",211],["T_WHITESPACE","        ",212],["T_VARIABLE","$configValue",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_INT_CAST","(int)",212],["T_WHITESPACE"," ",212],["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","getStoreConfig",212],"(",["T_STRING","self",212],["T_DOUBLE_COLON","::",212],["T_STRING","XML_PATH_CLEANUP_PROBABILITY",212],")",";",["T_WHITESPACE","\n        ",212],["T_RETURN","return",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$configValue",213],["T_WHITESPACE"," ",213],">",["T_WHITESPACE"," ",213],["T_LNUMBER","0",213],["T_WHITESPACE"," ",213],"?",["T_WHITESPACE"," ",213],["T_LNUMBER","1",213],["T_WHITESPACE"," ",213],["T_IS_EQUAL","==",213],["T_WHITESPACE"," ",213],["T_STRING","mt_rand",213],"(",["T_LNUMBER","1",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$configValue",213],")",["T_WHITESPACE"," ",213],":",["T_WHITESPACE"," ",213],["T_STRING","false",213],";",["T_WHITESPACE","\n    ",213],"}",["T_WHITESPACE","\n\n    ",214],["T_DOC_COMMENT","\/**\n     * Get cleanup expiration period value from system configuration in minutes\n     *\n     * @return int\n     *\/",216],["T_WHITESPACE","\n    ",220],["T_PUBLIC","public",221],["T_WHITESPACE"," ",221],["T_FUNCTION","function",221],["T_WHITESPACE"," ",221],["T_STRING","getCleanupExpirationPeriod",221],"(",")",["T_WHITESPACE","\n    ",221],"{",["T_WHITESPACE","\n        ",222],["T_VARIABLE","$minutes",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_INT_CAST","(int)",223],["T_WHITESPACE"," ",223],["T_STRING","Mage",223],["T_DOUBLE_COLON","::",223],["T_STRING","getStoreConfig",223],"(",["T_STRING","self",223],["T_DOUBLE_COLON","::",223],["T_STRING","XML_PATH_CLEANUP_EXPIRATION_PERIOD",223],")",";",["T_WHITESPACE","\n        ",223],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$minutes",224],["T_WHITESPACE"," ",224],">",["T_WHITESPACE"," ",224],["T_LNUMBER","0",224],["T_WHITESPACE"," ",224],"?",["T_WHITESPACE"," ",224],["T_VARIABLE","$minutes",224],["T_WHITESPACE"," ",224],":",["T_WHITESPACE"," ",224],["T_STRING","self",224],["T_DOUBLE_COLON","::",224],["T_STRING","CLEANUP_EXPIRATION_PERIOD_DEFAULT",224],";",["T_WHITESPACE","\n    ",224],"}",["T_WHITESPACE","\n\n    ",225],["T_DOC_COMMENT","\/**\n     * Send Email to Token owner\n     *\n     * @param string $userEmail\n     * @param string $userName\n     * @param string $applicationName\n     * @param string $status\n     *\/",227],["T_WHITESPACE","\n    ",234],["T_PUBLIC","public",235],["T_WHITESPACE"," ",235],["T_FUNCTION","function",235],["T_WHITESPACE"," ",235],["T_STRING","sendNotificationOnTokenStatusChange",235],"(",["T_VARIABLE","$userEmail",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$userName",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$applicationName",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$status",235],")",["T_WHITESPACE","\n    ",235],"{",["T_WHITESPACE","\n        ",236],["T_COMMENT","\/* @var $mailTemplate Mage_Core_Model_Email_Template *\/",237],["T_WHITESPACE","\n        ",237],["T_VARIABLE","$mailTemplate",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_STRING","Mage",238],["T_DOUBLE_COLON","::",238],["T_STRING","getModel",238],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template'",238],")",";",["T_WHITESPACE","\n\n        ",238],["T_VARIABLE","$mailTemplate",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","sendTransactional",240],"(",["T_WHITESPACE","\n            ",240],["T_STRING","Mage",241],["T_DOUBLE_COLON","::",241],["T_STRING","getStoreConfig",241],"(",["T_STRING","self",241],["T_DOUBLE_COLON","::",241],["T_STRING","XML_PATH_EMAIL_TEMPLATE",241],")",",",["T_WHITESPACE","\n            ",241],["T_STRING","Mage",242],["T_DOUBLE_COLON","::",242],["T_STRING","getStoreConfig",242],"(",["T_STRING","self",242],["T_DOUBLE_COLON","::",242],["T_STRING","XML_PATH_EMAIL_IDENTITY",242],")",",",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$userEmail",243],",",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$userName",244],",",["T_WHITESPACE","\n            ",244],["T_ARRAY","array",245],"(",["T_WHITESPACE","\n                ",245],["T_CONSTANT_ENCAPSED_STRING","'name'",246],["T_WHITESPACE","              ",246],["T_DOUBLE_ARROW","=>",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$userName",246],",",["T_WHITESPACE","\n                ",246],["T_CONSTANT_ENCAPSED_STRING","'email'",247],["T_WHITESPACE","             ",247],["T_DOUBLE_ARROW","=>",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$userEmail",247],",",["T_WHITESPACE","\n                ",247],["T_CONSTANT_ENCAPSED_STRING","'applicationName'",248],["T_WHITESPACE","   ",248],["T_DOUBLE_ARROW","=>",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$applicationName",248],",",["T_WHITESPACE","\n                ",248],["T_CONSTANT_ENCAPSED_STRING","'status'",249],["T_WHITESPACE","            ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$status",249],",",["T_WHITESPACE","\n\n            ",249],")",["T_WHITESPACE","\n        ",251],")",";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Is current authorize page is simple\n     *\n     * @return boolean\n     *\/",255],["T_WHITESPACE","\n    ",259],["T_PROTECTED","protected",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","_getIsSimple",260],"(",")",["T_WHITESPACE","\n    ",260],"{",["T_WHITESPACE","\n        ",261],["T_VARIABLE","$simple",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_STRING","false",262],";",["T_WHITESPACE","\n        ",262],["T_IF","if",263],["T_WHITESPACE"," ",263],"(",["T_STRING","stristr",263],"(",["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_getRequest",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","getActionName",263],"(",")",",",["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","'simple'",263],")",["T_WHITESPACE","\n            ",263],["T_BOOLEAN_OR","||",264],["T_WHITESPACE"," ",264],"!",["T_STRING","is_null",264],"(",["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_getRequest",264],"(",")",["T_OBJECT_OPERATOR","->",264],["T_STRING","getParam",264],"(",["T_CONSTANT_ENCAPSED_STRING","'simple'",264],",",["T_WHITESPACE"," ",264],["T_STRING","null",264],")",")",["T_WHITESPACE","\n        ",264],")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n            ",265],["T_VARIABLE","$simple",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_STRING","true",266],";",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n\n        ",267],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$simple",269],";",["T_WHITESPACE","\n    ",269],"}",["T_WHITESPACE","\n\n    ",270],["T_DOC_COMMENT","\/**\n     * Get authorize endpoint url\n     *\n     * @param string $userType\n     * @return string\n     *\/",272],["T_WHITESPACE","\n    ",277],["T_PUBLIC","public",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","getAuthorizeUrl",278],"(",["T_VARIABLE","$userType",278],")",["T_WHITESPACE","\n    ",278],"{",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$simple",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","_getIsSimple",280],"(",")",";",["T_WHITESPACE","\n\n        ",280],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_STRING","Mage_Oauth_Model_Token",282],["T_DOUBLE_COLON","::",282],["T_STRING","USER_TYPE_CUSTOMER",282],["T_WHITESPACE"," ",282],["T_IS_EQUAL","==",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$userType",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_IF","if",283],["T_WHITESPACE"," ",283],"(",["T_VARIABLE","$simple",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n                ",283],["T_VARIABLE","$route",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_STRING","self",284],["T_DOUBLE_COLON","::",284],["T_STRING","ENDPOINT_AUTHORIZE_CUSTOMER_SIMPLE",284],";",["T_WHITESPACE","\n            ",284],"}",["T_WHITESPACE"," ",285],["T_ELSE","else",285],["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n                ",285],["T_VARIABLE","$route",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_STRING","self",286],["T_DOUBLE_COLON","::",286],["T_STRING","ENDPOINT_AUTHORIZE_CUSTOMER",286],";",["T_WHITESPACE","\n            ",286],"}",["T_WHITESPACE","\n        ",287],"}",["T_WHITESPACE"," ",288],["T_ELSEIF","elseif",288],["T_WHITESPACE"," ",288],"(",["T_STRING","Mage_Oauth_Model_Token",288],["T_DOUBLE_COLON","::",288],["T_STRING","USER_TYPE_ADMIN",288],["T_WHITESPACE"," ",288],["T_IS_EQUAL","==",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$userType",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n            ",288],["T_IF","if",289],["T_WHITESPACE"," ",289],"(",["T_VARIABLE","$simple",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n                ",289],["T_VARIABLE","$route",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","self",290],["T_DOUBLE_COLON","::",290],["T_STRING","ENDPOINT_AUTHORIZE_ADMIN_SIMPLE",290],";",["T_WHITESPACE","\n            ",290],"}",["T_WHITESPACE"," ",291],["T_ELSE","else",291],["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n                ",291],["T_VARIABLE","$route",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_STRING","self",292],["T_DOUBLE_COLON","::",292],["T_STRING","ENDPOINT_AUTHORIZE_ADMIN",292],";",["T_WHITESPACE","\n            ",292],"}",["T_WHITESPACE","\n        ",293],"}",["T_WHITESPACE"," ",294],["T_ELSE","else",294],["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n            ",294],["T_THROW","throw",295],["T_WHITESPACE"," ",295],["T_NEW","new",295],["T_WHITESPACE"," ",295],["T_STRING","Exception",295],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid user type.'",295],")",";",["T_WHITESPACE","\n        ",295],"}",["T_WHITESPACE","\n\n        ",296],["T_RETURN","return",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_getUrl",298],"(",["T_VARIABLE","$route",298],",",["T_WHITESPACE"," ",298],["T_ARRAY","array",298],"(",["T_CONSTANT_ENCAPSED_STRING","'_query'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_ARRAY","array",298],"(",["T_CONSTANT_ENCAPSED_STRING","'oauth_token'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getOauthToken",298],"(",")",")",")",")",";",["T_WHITESPACE","\n    ",298],"}",["T_WHITESPACE","\n\n    ",299],["T_DOC_COMMENT","\/**\n     * Retrieve oauth_token param from request\n     *\n     * @return string|null\n     *\/",301],["T_WHITESPACE","\n    ",305],["T_PUBLIC","public",306],["T_WHITESPACE"," ",306],["T_FUNCTION","function",306],["T_WHITESPACE"," ",306],["T_STRING","getOauthToken",306],"(",")",["T_WHITESPACE","\n    ",306],"{",["T_WHITESPACE","\n        ",307],["T_RETURN","return",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_getRequest",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getParam",308],"(",["T_CONSTANT_ENCAPSED_STRING","'oauth_token'",308],",",["T_WHITESPACE"," ",308],["T_STRING","null",308],")",";",["T_WHITESPACE","\n    ",308],"}",["T_WHITESPACE","\n",309],"}",["T_WHITESPACE","\n",310]]