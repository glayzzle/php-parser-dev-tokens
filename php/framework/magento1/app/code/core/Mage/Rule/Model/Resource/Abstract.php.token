[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Rule\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Abstract Rule entity resource model\n *\n * @category Mage\n * @package Mage_Rule\n * @author Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_ABSTRACT","abstract",34],["T_WHITESPACE"," ",34],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Rule_Model_Resource_Abstract",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Store associated with rule entities information map\n     *\n     * Example:\n     * array(\n     *    'entity_type1' => array(\n     *        'associations_table' => 'table_name',\n     *        'rule_id_field'      => 'rule_id',\n     *        'entity_id_field'    => 'entity_id'\n     *    ),\n     *    'entity_type2' => array(\n     *        'associations_table' => 'table_name',\n     *        'rule_id_field'      => 'rule_id',\n     *        'entity_id_field'    => 'entity_id'\n     *    )\n     *    ....\n     * )\n     *\n     * @var array\n     *\/",36],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_associatedEntitiesMap",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",")",";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Prepare rule's active \"from\" and \"to\" dates\n     *\n     * @param Mage_Core_Model_Abstract $object\n     *\n     * @return Mage_Rule_Model_Resource_Abstract\n     *\/",58],["T_WHITESPACE","\n    ",64],["T_PUBLIC","public",65],["T_WHITESPACE"," ",65],["T_FUNCTION","function",65],["T_WHITESPACE"," ",65],["T_STRING","_beforeSave",65],"(",["T_STRING","Mage_Core_Model_Abstract",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$object",65],")",["T_WHITESPACE","\n    ",65],"{",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$fromDate",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$object",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getFromDate",67],"(",")",";",["T_WHITESPACE","\n        ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$fromDate",68],["T_WHITESPACE"," ",68],["T_INSTANCEOF","instanceof",68],["T_WHITESPACE"," ",68],["T_STRING","Zend_Date",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$object",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","setFromDate",69],"(",["T_VARIABLE","$fromDate",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","toString",69],"(",["T_STRING","Varien_Date",69],["T_DOUBLE_COLON","::",69],["T_STRING","DATETIME_INTERNAL_FORMAT",69],")",")",";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE"," ",70],["T_ELSEIF","elseif",70],["T_WHITESPACE"," ",70],"(","!",["T_STRING","is_string",70],"(",["T_VARIABLE","$fromDate",70],")",["T_WHITESPACE"," ",70],["T_BOOLEAN_OR","||",70],["T_WHITESPACE"," ",70],["T_EMPTY","empty",70],"(",["T_VARIABLE","$fromDate",70],")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$object",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","setFromDate",71],"(",["T_STRING","null",71],")",";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n\n        ",72],["T_VARIABLE","$toDate",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$object",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getToDate",74],"(",")",";",["T_WHITESPACE","\n        ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(",["T_VARIABLE","$toDate",75],["T_WHITESPACE"," ",75],["T_INSTANCEOF","instanceof",75],["T_WHITESPACE"," ",75],["T_STRING","Zend_Date",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$object",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","setToDate",76],"(",["T_VARIABLE","$toDate",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","toString",76],"(",["T_STRING","Varien_Date",76],["T_DOUBLE_COLON","::",76],["T_STRING","DATETIME_INTERNAL_FORMAT",76],")",")",";",["T_WHITESPACE","\n        ",76],"}",["T_WHITESPACE"," ",77],["T_ELSEIF","elseif",77],["T_WHITESPACE"," ",77],"(","!",["T_STRING","is_string",77],"(",["T_VARIABLE","$toDate",77],")",["T_WHITESPACE"," ",77],["T_BOOLEAN_OR","||",77],["T_WHITESPACE"," ",77],["T_EMPTY","empty",77],"(",["T_VARIABLE","$toDate",77],")",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$object",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","setToDate",78],"(",["T_STRING","null",78],")",";",["T_WHITESPACE","\n        ",78],"}",["T_WHITESPACE","\n\n        ",79],["T_STRING","parent",81],["T_DOUBLE_COLON","::",81],["T_STRING","_beforeSave",81],"(",["T_VARIABLE","$object",81],")",";",["T_WHITESPACE","\n        ",81],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],";",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Prepare select for condition\n     *\n     * @param int $storeId\n     * @param Mage_Rule_Model_Condition_Abstract $condition\n     * @return Varien_Db_Select\n     *\/",85],["T_WHITESPACE","\n    ",91],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","getProductFlatSelect",92],"(",["T_VARIABLE","$storeId",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$condition",92],")",["T_WHITESPACE","\n    ",92],"{",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$select",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_getReadAdapter",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","select",94],"(",")",";",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$select",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","from",95],"(",["T_WHITESPACE","\n                ",95],["T_ARRAY","array",96],"(",["T_CONSTANT_ENCAPSED_STRING","'p'",96],["T_WHITESPACE"," ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getTable",96],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",96],")",")",",",["T_WHITESPACE","\n                ",96],["T_ARRAY","array",97],"(",["T_NEW","new",97],["T_WHITESPACE"," ",97],["T_STRING","Zend_Db_Expr",97],"(",["T_CONSTANT_ENCAPSED_STRING","'DISTINCT p.entity_id'",97],")",")",["T_WHITESPACE","\n            ",97],")",["T_WHITESPACE","\n            ",98],["T_OBJECT_OPERATOR","->",99],["T_STRING","joinInner",99],"(",["T_WHITESPACE","\n                ",99],["T_ARRAY","array",100],"(",["T_CONSTANT_ENCAPSED_STRING","'cpf'",100],["T_WHITESPACE"," ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getTable",100],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_flat'",100],")",["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'_'",100],["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_VARIABLE","$storeId",100],")",",",["T_WHITESPACE","\n                ",100],["T_CONSTANT_ENCAPSED_STRING","'cpf.entity_id = p.entity_id'",101],",",["T_WHITESPACE","\n                ",101],["T_ARRAY","array",102],"(",")",["T_WHITESPACE","\n            ",102],")",["T_OBJECT_OPERATOR","->",103],["T_STRING","joinLeft",103],"(",["T_WHITESPACE","\n                ",103],["T_ARRAY","array",104],"(",["T_CONSTANT_ENCAPSED_STRING","'ccp'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getTable",104],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/category_product'",104],")",")",",",["T_WHITESPACE","\n                ",104],["T_CONSTANT_ENCAPSED_STRING","'ccp.product_id = p.entity_id'",105],",",["T_WHITESPACE","\n                ",105],["T_ARRAY","array",106],"(",")",["T_WHITESPACE","\n            ",106],")",";",["T_WHITESPACE","\n\n        ",107],["T_VARIABLE","$where",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$condition",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","prepareConditionSql",109],"(",")",";",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(","!",["T_EMPTY","empty",110],"(",["T_VARIABLE","$where",110],")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$select",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","where",111],"(",["T_VARIABLE","$where",111],")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n\n        ",112],["T_RETURN","return",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$select",114],";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Bind specified rules to entities\n     *\n     * @param array|int|string $ruleIds\n     * @param array|int|string $entityIds\n     * @param string $entityType\n     * @param bool $deleteOldResults\n     *\n     * @throws Exception\n     * @return Mage_Rule_Model_Resource_Abstract\n     *\/",117],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","bindRuleToEntity",128],"(",["T_VARIABLE","$ruleIds",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$entityIds",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$entityType",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$deleteOldResults",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_STRING","true",128],")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_EMPTY","empty",130],"(",["T_VARIABLE","$ruleIds",130],")",["T_WHITESPACE"," ",130],["T_BOOLEAN_OR","||",130],["T_WHITESPACE"," ",130],["T_EMPTY","empty",130],"(",["T_VARIABLE","$entityIds",130],")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_RETURN","return",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],";",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$adapter",133],["T_WHITESPACE","    ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_getWriteAdapter",133],"(",")",";",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$entityInfo",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_getAssociatedEntityInfo",134],"(",["T_VARIABLE","$entityType",134],")",";",["T_WHITESPACE","\n\n        ",134],["T_IF","if",136],["T_WHITESPACE"," ",136],"(","!",["T_STRING","is_array",136],"(",["T_VARIABLE","$ruleIds",136],")",")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$ruleIds",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_ARRAY","array",137],"(",["T_INT_CAST","(int)",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$ruleIds",137],")",";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n        ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(","!",["T_STRING","is_array",139],"(",["T_VARIABLE","$entityIds",139],")",")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$entityIds",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_ARRAY","array",140],"(",["T_INT_CAST","(int)",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$entityIds",140],")",";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n\n        ",141],["T_VARIABLE","$data",143],["T_WHITESPACE","  ",143],"=",["T_WHITESPACE"," ",143],["T_ARRAY","array",143],"(",")",";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$count",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_LNUMBER","0",144],";",["T_WHITESPACE","\n\n        ",144],["T_VARIABLE","$adapter",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","beginTransaction",146],"(",")",";",["T_WHITESPACE","\n\n        ",146],["T_TRY","try",148],["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_FOREACH","foreach",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$ruleIds",149],["T_WHITESPACE"," ",149],["T_AS","as",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$ruleId",149],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n                ",149],["T_FOREACH","foreach",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$entityIds",150],["T_WHITESPACE"," ",150],["T_AS","as",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$entityId",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                    ",150],["T_VARIABLE","$data",151],"[","]",["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_WHITESPACE","\n                        ",151],["T_VARIABLE","$entityInfo",152],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",152],"]",["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$entityId",152],",",["T_WHITESPACE","\n                        ",152],["T_VARIABLE","$entityInfo",153],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",153],"]",["T_WHITESPACE"," ",153],["T_DOUBLE_ARROW","=>",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$ruleId",153],["T_WHITESPACE","\n                    ",153],")",";",["T_WHITESPACE","\n                    ",154],["T_VARIABLE","$count",155],["T_INC","++",155],";",["T_WHITESPACE","\n                    ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(","(",["T_VARIABLE","$count",156],["T_WHITESPACE"," ",156],"%",["T_WHITESPACE"," ",156],["T_LNUMBER","1000",156],")",["T_WHITESPACE"," ",156],["T_IS_EQUAL","==",156],["T_WHITESPACE"," ",156],["T_LNUMBER","0",156],")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                        ",156],["T_VARIABLE","$adapter",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","insertOnDuplicate",157],"(",["T_WHITESPACE","\n                            ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getTable",158],"(",["T_VARIABLE","$entityInfo",158],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",158],"]",")",",",["T_WHITESPACE","\n                            ",158],["T_VARIABLE","$data",159],",",["T_WHITESPACE","\n                            ",159],["T_ARRAY","array",160],"(",["T_VARIABLE","$entityInfo",160],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",160],"]",")",["T_WHITESPACE","\n                        ",160],")",";",["T_WHITESPACE","\n                        ",161],["T_VARIABLE","$data",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_ARRAY","array",162],"(",")",";",["T_WHITESPACE","\n                    ",162],"}",["T_WHITESPACE","\n                ",163],"}",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE","\n            ",165],["T_IF","if",166],["T_WHITESPACE"," ",166],"(","!",["T_EMPTY","empty",166],"(",["T_VARIABLE","$data",166],")",")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n                ",166],["T_VARIABLE","$adapter",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","insertOnDuplicate",167],"(",["T_WHITESPACE","\n                    ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getTable",168],"(",["T_VARIABLE","$entityInfo",168],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",168],"]",")",",",["T_WHITESPACE","\n                    ",168],["T_VARIABLE","$data",169],",",["T_WHITESPACE","\n                    ",169],["T_ARRAY","array",170],"(",["T_VARIABLE","$entityInfo",170],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",170],"]",")",["T_WHITESPACE","\n                ",170],")",";",["T_WHITESPACE","\n            ",171],"}",["T_WHITESPACE","\n\n            ",172],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_VARIABLE","$deleteOldResults",174],")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n                ",174],["T_VARIABLE","$adapter",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","delete",175],"(",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getTable",175],"(",["T_VARIABLE","$entityInfo",175],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",175],"]",")",",",["T_WHITESPACE","\n                    ",175],["T_VARIABLE","$adapter",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","quoteInto",176],"(",["T_VARIABLE","$entityInfo",176],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",176],"]",["T_WHITESPACE","   ",176],".",["T_WHITESPACE"," ",176],["T_CONSTANT_ENCAPSED_STRING","' IN (?) AND '",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$ruleIds",176],")",["T_WHITESPACE"," ",176],".",["T_WHITESPACE","\n                    ",176],["T_VARIABLE","$adapter",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","quoteInto",177],"(",["T_VARIABLE","$entityInfo",177],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",177],"]",["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","' NOT IN (?)'",177],",",["T_WHITESPACE","  ",177],["T_VARIABLE","$entityIds",177],")",["T_WHITESPACE","\n                ",177],")",";",["T_WHITESPACE","\n            ",178],"}",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE"," ",180],["T_CATCH","catch",180],["T_WHITESPACE"," ",180],"(",["T_STRING","Exception",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$e",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$adapter",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","rollback",181],"(",")",";",["T_WHITESPACE","\n            ",181],["T_THROW","throw",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$e",182],";",["T_WHITESPACE","\n\n        ",182],"}",["T_WHITESPACE","\n\n        ",184],["T_VARIABLE","$adapter",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","commit",186],"(",")",";",["T_WHITESPACE","\n\n        ",186],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Unbind specified rules from entities\n     *\n     * @param array|int|string $ruleIds\n     * @param array|int|string $entityIds\n     * @param string $entityType\n     *\n     * @return Mage_Rule_Model_Resource_Abstract\n     *\/",191],["T_WHITESPACE","\n    ",199],["T_PUBLIC","public",200],["T_WHITESPACE"," ",200],["T_FUNCTION","function",200],["T_WHITESPACE"," ",200],["T_STRING","unbindRuleFromEntity",200],"(",["T_VARIABLE","$ruleIds",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_ARRAY","array",200],"(",")",",",["T_WHITESPACE"," ",200],["T_VARIABLE","$entityIds",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_ARRAY","array",200],"(",")",",",["T_WHITESPACE"," ",200],["T_VARIABLE","$entityType",200],")",["T_WHITESPACE","\n    ",200],"{",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$writeAdapter",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_getWriteAdapter",202],"(",")",";",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$entityInfo",203],["T_WHITESPACE","   ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_getAssociatedEntityInfo",203],"(",["T_VARIABLE","$entityType",203],")",";",["T_WHITESPACE","\n\n        ",203],["T_IF","if",205],["T_WHITESPACE"," ",205],"(","!",["T_STRING","is_array",205],"(",["T_VARIABLE","$entityIds",205],")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$entityIds",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_ARRAY","array",206],"(",["T_INT_CAST","(int)",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$entityIds",206],")",";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n        ",207],["T_IF","if",208],["T_WHITESPACE"," ",208],"(","!",["T_STRING","is_array",208],"(",["T_VARIABLE","$ruleIds",208],")",")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$ruleIds",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_ARRAY","array",209],"(",["T_INT_CAST","(int)",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$ruleIds",209],")",";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n\n        ",210],["T_VARIABLE","$where",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_ARRAY","array",212],"(",")",";",["T_WHITESPACE","\n        ",212],["T_IF","if",213],["T_WHITESPACE"," ",213],"(","!",["T_EMPTY","empty",213],"(",["T_VARIABLE","$ruleIds",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$where",214],"[","]",["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$writeAdapter",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","quoteInto",214],"(",["T_VARIABLE","$entityInfo",214],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",214],"]",["T_WHITESPACE"," ",214],".",["T_WHITESPACE"," ",214],["T_CONSTANT_ENCAPSED_STRING","' IN (?)'",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$ruleIds",214],")",";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n        ",215],["T_IF","if",216],["T_WHITESPACE"," ",216],"(","!",["T_EMPTY","empty",216],"(",["T_VARIABLE","$entityIds",216],")",")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$where",217],"[","]",["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$writeAdapter",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","quoteInto",217],"(",["T_VARIABLE","$entityInfo",217],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",217],"]",["T_WHITESPACE"," ",217],".",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","' IN (?)'",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$entityIds",217],")",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n\n        ",218],["T_VARIABLE","$writeAdapter",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","delete",220],"(",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getTable",220],"(",["T_VARIABLE","$entityInfo",220],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",220],"]",")",",",["T_WHITESPACE"," ",220],["T_STRING","implode",220],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$where",220],")",")",";",["T_WHITESPACE","\n\n        ",220],["T_RETURN","return",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],";",["T_WHITESPACE","\n    ",222],"}",["T_WHITESPACE","\n\n    ",223],["T_DOC_COMMENT","\/**\n     * Retrieve rule's associated entity Ids by entity type\n     *\n     * @param int $ruleId\n     * @param string $entityType\n     *\n     * @return array\n     *\/",225],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","getAssociatedEntityIds",233],"(",["T_VARIABLE","$ruleId",233],",",["T_WHITESPACE"," ",233],["T_VARIABLE","$entityType",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$entityInfo",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_getAssociatedEntityInfo",235],"(",["T_VARIABLE","$entityType",235],")",";",["T_WHITESPACE","\n\n        ",235],["T_VARIABLE","$select",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_getReadAdapter",237],"(",")",["T_OBJECT_OPERATOR","->",237],["T_STRING","select",237],"(",")",["T_WHITESPACE","\n            ",237],["T_OBJECT_OPERATOR","->",238],["T_STRING","from",238],"(",["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getTable",238],"(",["T_VARIABLE","$entityInfo",238],"[",["T_CONSTANT_ENCAPSED_STRING","'associations_table'",238],"]",")",",",["T_WHITESPACE"," ",238],["T_ARRAY","array",238],"(",["T_VARIABLE","$entityInfo",238],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id_field'",238],"]",")",")",["T_WHITESPACE","\n            ",238],["T_OBJECT_OPERATOR","->",239],["T_STRING","where",239],"(",["T_VARIABLE","$entityInfo",239],"[",["T_CONSTANT_ENCAPSED_STRING","'rule_id_field'",239],"]",["T_WHITESPACE"," ",239],".",["T_WHITESPACE"," ",239],["T_CONSTANT_ENCAPSED_STRING","' = ?'",239],",",["T_WHITESPACE"," ",239],["T_VARIABLE","$ruleId",239],")",";",["T_WHITESPACE","\n\n        ",239],["T_RETURN","return",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_getReadAdapter",241],"(",")",["T_OBJECT_OPERATOR","->",241],["T_STRING","fetchCol",241],"(",["T_VARIABLE","$select",241],")",";",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n\n    ",242],["T_DOC_COMMENT","\/**\n     * Retrieve website ids of specified rule\n     *\n     * @param int $ruleId\n     * @return array\n     *\/",244],["T_WHITESPACE","\n    ",249],["T_PUBLIC","public",250],["T_WHITESPACE"," ",250],["T_FUNCTION","function",250],["T_WHITESPACE"," ",250],["T_STRING","getWebsiteIds",250],"(",["T_VARIABLE","$ruleId",250],")",["T_WHITESPACE","\n    ",250],"{",["T_WHITESPACE","\n        ",251],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getAssociatedEntityIds",252],"(",["T_VARIABLE","$ruleId",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'website'",252],")",";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Retrieve customer group ids of specified rule\n     *\n     * @param int $ruleId\n     * @return array\n     *\/",255],["T_WHITESPACE","\n    ",260],["T_PUBLIC","public",261],["T_WHITESPACE"," ",261],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","getCustomerGroupIds",261],"(",["T_VARIABLE","$ruleId",261],")",["T_WHITESPACE","\n    ",261],"{",["T_WHITESPACE","\n        ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getAssociatedEntityIds",263],"(",["T_VARIABLE","$ruleId",263],",",["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","'customer_group'",263],")",";",["T_WHITESPACE","\n    ",263],"}",["T_WHITESPACE","\n\n    ",264],["T_DOC_COMMENT","\/**\n     * Retrieve correspondent entity information (associations table name, columns names)\n     * of rule's associated entity by specified entity type\n     *\n     * @param string $entityType\n     *\n     * @return array\n     *\/",266],["T_WHITESPACE","\n    ",273],["T_PROTECTED","protected",274],["T_WHITESPACE"," ",274],["T_FUNCTION","function",274],["T_WHITESPACE"," ",274],["T_STRING","_getAssociatedEntityInfo",274],"(",["T_VARIABLE","$entityType",274],")",["T_WHITESPACE","\n    ",274],"{",["T_WHITESPACE","\n        ",275],["T_IF","if",276],["T_WHITESPACE"," ",276],"(",["T_ISSET","isset",276],"(",["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_associatedEntitiesMap",276],"[",["T_VARIABLE","$entityType",276],"]",")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n            ",276],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_associatedEntitiesMap",277],"[",["T_VARIABLE","$entityType",277],"]",";",["T_WHITESPACE","\n        ",277],"}",["T_WHITESPACE","\n\n        ",278],["T_VARIABLE","$e",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_STRING","Mage",280],["T_DOUBLE_COLON","::",280],["T_STRING","exception",280],"(",["T_WHITESPACE","\n            ",280],["T_CONSTANT_ENCAPSED_STRING","'Mage_Core'",281],",",["T_WHITESPACE","\n            ",281],["T_STRING","Mage",282],["T_DOUBLE_COLON","::",282],["T_STRING","helper",282],"(",["T_CONSTANT_ENCAPSED_STRING","'rule'",282],")",["T_OBJECT_OPERATOR","->",282],["T_STRING","__",282],"(",["T_CONSTANT_ENCAPSED_STRING","'There is no information about associated entity type \"%s\".'",282],",",["T_WHITESPACE"," ",282],["T_VARIABLE","$entityType",282],")",["T_WHITESPACE","\n        ",282],")",";",["T_WHITESPACE","\n        ",283],["T_THROW","throw",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$e",284],";",["T_WHITESPACE","\n    ",284],"}",["T_WHITESPACE","\n",285],"}",["T_WHITESPACE","\n",286]]