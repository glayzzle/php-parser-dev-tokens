[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogSearch\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_CLASS","class",27],["T_WHITESPACE"," ",27],["T_STRING","Mage_CatalogSearch_Model_Layer",27],["T_WHITESPACE"," ",27],["T_EXTENDS","extends",27],["T_WHITESPACE"," ",27],["T_STRING","Mage_Catalog_Model_Layer",27],["T_WHITESPACE","\n",27],"{",["T_WHITESPACE","\n    ",28],["T_CONST","const",29],["T_WHITESPACE"," ",29],["T_STRING","XML_PATH_DISPLAY_LAYER_COUNT",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'catalog\/search\/use_layered_navigation_count'",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * Get current layer product collection\n     *\n     * @return Mage_Catalog_Model_Resource_Eav_Resource_Product_Collection\n     *\/",31],["T_WHITESPACE","\n    ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","getProductCollection",36],"(",")",["T_WHITESPACE","\n    ",36],"{",["T_WHITESPACE","\n        ",37],["T_IF","if",38],["T_WHITESPACE"," ",38],"(",["T_ISSET","isset",38],"(",["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","_productCollections",38],"[",["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getCurrentCategory",38],"(",")",["T_OBJECT_OPERATOR","->",38],["T_STRING","getId",38],"(",")","]",")",")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n            ",38],["T_VARIABLE","$collection",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","_productCollections",39],"[",["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","getCurrentCategory",39],"(",")",["T_OBJECT_OPERATOR","->",39],["T_STRING","getId",39],"(",")","]",";",["T_WHITESPACE","\n        ",39],"}",["T_WHITESPACE"," ",40],["T_ELSE","else",40],["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n            ",40],["T_VARIABLE","$collection",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_STRING","Mage",41],["T_DOUBLE_COLON","::",41],["T_STRING","getResourceModel",41],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogsearch\/fulltext_collection'",41],")",";",["T_WHITESPACE","\n            ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","prepareProductCollection",42],"(",["T_VARIABLE","$collection",42],")",";",["T_WHITESPACE","\n            ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_productCollections",43],"[",["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getCurrentCategory",43],"(",")",["T_OBJECT_OPERATOR","->",43],["T_STRING","getId",43],"(",")","]",["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$collection",43],";",["T_WHITESPACE","\n        ",43],"}",["T_WHITESPACE","\n        ",44],["T_RETURN","return",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$collection",45],";",["T_WHITESPACE","\n    ",45],"}",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Prepare product collection\n     *\n     * @param Mage_Catalog_Model_Resource_Eav_Resource_Product_Collection $collection\n     * @return Mage_Catalog_Model_Layer\n     *\/",48],["T_WHITESPACE","\n    ",53],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","prepareProductCollection",54],"(",["T_VARIABLE","$collection",54],")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$collection",56],["T_WHITESPACE","\n            ",56],["T_OBJECT_OPERATOR","->",57],["T_STRING","addAttributeToSelect",57],"(",["T_STRING","Mage",57],["T_DOUBLE_COLON","::",57],["T_STRING","getSingleton",57],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/config'",57],")",["T_OBJECT_OPERATOR","->",57],["T_STRING","getProductAttributes",57],"(",")",")",["T_WHITESPACE","\n            ",57],["T_OBJECT_OPERATOR","->",58],["T_STRING","addSearchFilter",58],"(",["T_STRING","Mage",58],["T_DOUBLE_COLON","::",58],["T_STRING","helper",58],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogsearch'",58],")",["T_OBJECT_OPERATOR","->",58],["T_STRING","getQuery",58],"(",")",["T_OBJECT_OPERATOR","->",58],["T_STRING","getQueryText",58],"(",")",")",["T_WHITESPACE","\n            ",58],["T_OBJECT_OPERATOR","->",59],["T_STRING","setStore",59],"(",["T_STRING","Mage",59],["T_DOUBLE_COLON","::",59],["T_STRING","app",59],"(",")",["T_OBJECT_OPERATOR","->",59],["T_STRING","getStore",59],"(",")",")",["T_WHITESPACE","\n            ",59],["T_OBJECT_OPERATOR","->",60],["T_STRING","addMinimalPrice",60],"(",")",["T_WHITESPACE","\n            ",60],["T_OBJECT_OPERATOR","->",61],["T_STRING","addFinalPrice",61],"(",")",["T_WHITESPACE","\n            ",61],["T_OBJECT_OPERATOR","->",62],["T_STRING","addTaxPercents",62],"(",")",["T_WHITESPACE","\n            ",62],["T_OBJECT_OPERATOR","->",63],["T_STRING","addStoreFilter",63],"(",")",["T_WHITESPACE","\n            ",63],["T_OBJECT_OPERATOR","->",64],["T_STRING","addUrlRewrite",64],"(",")",";",["T_WHITESPACE","\n\n        ",64],["T_STRING","Mage",66],["T_DOUBLE_COLON","::",66],["T_STRING","getSingleton",66],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_status'",66],")",["T_OBJECT_OPERATOR","->",66],["T_STRING","addVisibleFilterToCollection",66],"(",["T_VARIABLE","$collection",66],")",";",["T_WHITESPACE","\n        ",66],["T_STRING","Mage",67],["T_DOUBLE_COLON","::",67],["T_STRING","getSingleton",67],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_visibility'",67],")",["T_OBJECT_OPERATOR","->",67],["T_STRING","addVisibleInSearchFilterToCollection",67],"(",["T_VARIABLE","$collection",67],")",";",["T_WHITESPACE","\n\n        ",67],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Get layer state key\n     *\n     * @return string\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","getStateKey",77],"(",")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_stateKey",79],["T_WHITESPACE"," ",79],["T_IS_IDENTICAL","===",79],["T_WHITESPACE"," ",79],["T_STRING","null",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_stateKey",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'Q_'",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_STRING","Mage",80],["T_DOUBLE_COLON","::",80],["T_STRING","helper",80],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogsearch'",80],")",["T_OBJECT_OPERATOR","->",80],["T_STRING","getQuery",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","getId",80],"(",")",["T_WHITESPACE","\n                ",80],".",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'_'",81],".",["T_WHITESPACE"," ",81],["T_STRING","parent",81],["T_DOUBLE_COLON","::",81],["T_STRING","getStateKey",81],"(",")",";",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE","\n        ",82],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_stateKey",83],";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Get default tags for current layer state\n     *\n     * @param   array $additionalTags\n     * @return  array\n     *\/",86],["T_WHITESPACE","\n    ",91],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","getStateTags",92],"(",["T_ARRAY","array",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$additionalTags",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_ARRAY","array",92],"(",")",")",["T_WHITESPACE","\n    ",92],"{",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$additionalTags",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","parent",94],["T_DOUBLE_COLON","::",94],["T_STRING","getStateTags",94],"(",["T_VARIABLE","$additionalTags",94],")",";",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$additionalTags",95],"[","]",["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","Mage_CatalogSearch_Model_Query",95],["T_DOUBLE_COLON","::",95],["T_STRING","CACHE_TAG",95],";",["T_WHITESPACE","\n        ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$additionalTags",96],";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Add filters to attribute collection\n     *\n     * @param   Mage_Catalog_Model_Resource_Eav_Resource_Product_Attribute_Collection $collection\n     * @return  Mage_Catalog_Model_Resource_Eav_Resource_Product_Attribute_Collection\n     *\/",99],["T_WHITESPACE","\n    ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","_prepareAttributeCollection",105],"(",["T_VARIABLE","$collection",105],")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$collection",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","addIsFilterableInSearchFilter",107],"(",")",["T_WHITESPACE","\n            ",107],["T_OBJECT_OPERATOR","->",108],["T_STRING","addVisibleFilter",108],"(",")",";",["T_WHITESPACE","\n        ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$collection",109],";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Prepare attribute for use in layered navigation\n     *\n     * @param   Mage_Eav_Model_Entity_Attribute $attribute\n     * @return  Mage_Eav_Model_Entity_Attribute\n     *\/",112],["T_WHITESPACE","\n    ",117],["T_PROTECTED","protected",118],["T_WHITESPACE"," ",118],["T_FUNCTION","function",118],["T_WHITESPACE"," ",118],["T_STRING","_prepareAttribute",118],"(",["T_VARIABLE","$attribute",118],")",["T_WHITESPACE","\n    ",118],"{",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$attribute",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","parent",120],["T_DOUBLE_COLON","::",120],["T_STRING","_prepareAttribute",120],"(",["T_VARIABLE","$attribute",120],")",";",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$attribute",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","setIsFilterable",121],"(",["T_STRING","Mage_Catalog_Model_Layer_Filter_Attribute",121],["T_DOUBLE_COLON","::",121],["T_STRING","OPTIONS_ONLY_WITH_RESULTS",121],")",";",["T_WHITESPACE","\n        ",121],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$attribute",122],";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n",123],"}",["T_WHITESPACE","\n",124]]