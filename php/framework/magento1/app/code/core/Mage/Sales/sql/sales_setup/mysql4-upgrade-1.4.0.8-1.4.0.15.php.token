[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_COMMENT","\/* @var $installer Mage_Sales_Model_Entity_Setup *\/",27],["T_WHITESPACE","\n",27],["T_VARIABLE","$installer",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$this",28],";",["T_WHITESPACE","\n\n",28],["T_VARIABLE","$orderGridTable",30],["T_WHITESPACE","             ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$installer",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","getTable",30],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_grid'",30],")",";",["T_WHITESPACE","\n",30],["T_VARIABLE","$orderTable",31],["T_WHITESPACE","                 ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$installer",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","getTable",31],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",31],")",";",["T_WHITESPACE","\n",31],["T_VARIABLE","$paymentTransactionTable",32],["T_WHITESPACE","    ",32],"=",["T_WHITESPACE"," ",32],["T_VARIABLE","$installer",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","getTable",32],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/payment_transaction'",32],")",";",["T_WHITESPACE","\n",32],["T_VARIABLE","$profileTable",33],["T_WHITESPACE","               ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$installer",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","getTable",33],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_recurring_profile'",33],")",";",["T_WHITESPACE","\n",33],["T_VARIABLE","$orderItemTable",34],["T_WHITESPACE","             ",34],"=",["T_WHITESPACE"," ",34],["T_VARIABLE","$installer",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","getTable",34],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_flat_order_item'",34],")",";",["T_WHITESPACE","\n",34],["T_VARIABLE","$flatOrderTable",35],["T_WHITESPACE","             ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$installer",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","getTable",35],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_flat_order'",35],")",";",["T_WHITESPACE","\n",35],["T_VARIABLE","$profileOrderTable",36],["T_WHITESPACE","          ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$installer",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","getTable",36],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_recurring_profile_order'",36],")",";",["T_WHITESPACE","\n",36],["T_VARIABLE","$customerEntityTable",37],["T_WHITESPACE","        ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$installer",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","getTable",37],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_entity'",37],")",";",["T_WHITESPACE","\n",37],["T_VARIABLE","$coreStoreTable",38],["T_WHITESPACE","             ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$installer",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getTable",38],"(",["T_CONSTANT_ENCAPSED_STRING","'core_store'",38],")",";",["T_WHITESPACE","\n",38],["T_VARIABLE","$billingAgreementTable",39],["T_WHITESPACE","      ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$installer",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","getTable",39],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement'",39],")",";",["T_WHITESPACE","\n",39],["T_VARIABLE","$billingAgreementOrderTable",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$installer",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","getTable",40],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement_order'",40],")",";",["T_WHITESPACE","\n\n",40],["T_COMMENT","\/\/-------\n",42],["T_VARIABLE","$installer",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getConnection",43],"(",")",["T_OBJECT_OPERATOR","->",43],["T_STRING","addColumn",43],"(",["T_VARIABLE","$orderGridTable",43],",",["T_WHITESPACE","\n    ",43],["T_CONSTANT_ENCAPSED_STRING","'store_name'",44],",",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'varchar(255) null default null AFTER `store_id`'",44],")",";",["T_WHITESPACE","\n\n",44],["T_VARIABLE","$installer",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","run",46],"(","\"",["T_ENCAPSED_AND_WHITESPACE","\n    UPDATE ",46],["T_CURLY_OPEN","{",47],["T_VARIABLE","$orderGridTable",47],"}",["T_ENCAPSED_AND_WHITESPACE"," AS og\n        INNER JOIN  ",47],["T_CURLY_OPEN","{",48],["T_VARIABLE","$orderTable",48],"}",["T_ENCAPSED_AND_WHITESPACE"," AS o on (og.entity_id=o.entity_id)\n    SET\n        og.store_name = o.store_name\n",48],"\"",")",";",["T_WHITESPACE","\n\n",51],["T_COMMENT","\/\/-------\n",53],["T_VARIABLE","$installer",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getConnection",54],"(",")",["T_OBJECT_OPERATOR","->",54],["T_STRING","addColumn",54],"(",["T_VARIABLE","$paymentTransactionTable",54],",",["T_WHITESPACE","\n    ",54],["T_CONSTANT_ENCAPSED_STRING","'created_at'",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'DATETIME NULL'",55],")",";",["T_WHITESPACE","\n\n",55],["T_COMMENT","\/\/-------\n",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getConnection",58],"(",")",["T_OBJECT_OPERATOR","->",58],["T_STRING","addColumn",58],"(",["T_VARIABLE","$orderItemTable",58],",",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'is_nominal'",58],",",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'int NOT NULL DEFAULT \\'0\\''",58],")",";",["T_WHITESPACE","\n\n",58],["T_COMMENT","\/\/-------\n",60],["T_VARIABLE","$installer",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","run",61],"(","\"",["T_ENCAPSED_AND_WHITESPACE","\n    CREATE TABLE `",61],["T_CURLY_OPEN","{",62],["T_VARIABLE","$billingAgreementTable",62],"}",["T_ENCAPSED_AND_WHITESPACE","` (\n      `agreement_id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n      `customer_id` int(10) unsigned NOT NULL,\n      `method_code` varchar(32) NOT NULL,\n      `reference_id` varchar(32) NOT NULL,\n      `status` varchar(20) NOT NULL,\n      `created_at` datetime NOT NULL,\n      `updated_at` datetime DEFAULT NULL,\n      PRIMARY KEY (`agreement_id`),\n      KEY `IDX_CUSTOMER` (`customer_id`)\n    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n",62],"\"",")",";",["T_WHITESPACE","\n\n",73],["T_VARIABLE","$installer",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getConnection",75],"(",")",["T_OBJECT_OPERATOR","->",75],["T_STRING","addConstraint",75],"(",["T_WHITESPACE","\n    ",75],["T_CONSTANT_ENCAPSED_STRING","'FK_BILLING_AGREEMENT_CUSTOMER'",76],",",["T_WHITESPACE","\n    ",76],["T_VARIABLE","$billingAgreementTable",77],",",["T_WHITESPACE","\n    ",77],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",78],",",["T_WHITESPACE","\n    ",78],["T_VARIABLE","$installer",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getTable",79],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/entity'",79],")",",",["T_WHITESPACE","\n    ",79],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",80],["T_WHITESPACE","\n\n",80],")",";",["T_WHITESPACE","\n\n",82],["T_COMMENT","\/\/-------\n",84],["T_VARIABLE","$installer",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","run",85],"(","\"",["T_ENCAPSED_AND_WHITESPACE","\n    CREATE TABLE `",85],["T_CURLY_OPEN","{",86],["T_VARIABLE","$billingAgreementOrderTable",86],"}",["T_ENCAPSED_AND_WHITESPACE","` (\n      `agreement_id` int(10) unsigned NOT NULL,\n      `order_id` int(10) unsigned NOT NULL,\n      UNIQUE KEY `UNQ_BILLING_AGREEMENT_ORDER` (`agreement_id`,`order_id`)\n    ) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n",86],"\"",")",";",["T_WHITESPACE","\n\n",91],["T_VARIABLE","$installer",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getConnection",93],"(",")",["T_OBJECT_OPERATOR","->",93],["T_STRING","addConstraint",93],"(",["T_WHITESPACE","\n    ",93],["T_CONSTANT_ENCAPSED_STRING","'FK_BILLING_AGREEMENT_ORDER_AGREEMENT'",94],",",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$billingAgreementOrderTable",95],",",["T_WHITESPACE","\n    ",95],["T_CONSTANT_ENCAPSED_STRING","'agreement_id'",96],",",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$billingAgreementTable",97],",",["T_WHITESPACE","\n    ",97],["T_CONSTANT_ENCAPSED_STRING","'agreement_id'",98],["T_WHITESPACE","\n",98],")",";",["T_WHITESPACE","\n\n",99],["T_VARIABLE","$installer",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getConnection",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","addConstraint",101],"(",["T_WHITESPACE","\n    ",101],["T_CONSTANT_ENCAPSED_STRING","'FK_BILLING_AGREEMENT_ORDER_ORDER'",102],",",["T_WHITESPACE","\n    ",102],["T_VARIABLE","$billingAgreementOrderTable",103],",",["T_WHITESPACE","\n    ",103],["T_CONSTANT_ENCAPSED_STRING","'order_id'",104],",",["T_WHITESPACE","\n    ",104],["T_VARIABLE","$orderTable",105],",",["T_WHITESPACE","\n    ",105],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",106],["T_WHITESPACE","\n",106],")",";",["T_WHITESPACE","\n\n",107],["T_COMMENT","\/\/-------\n",109],["T_WHITESPACE","\n",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","run",111],"(","\"",["T_ENCAPSED_AND_WHITESPACE","\nCREATE TABLE `",111],["T_CURLY_OPEN","{",112],["T_VARIABLE","$profileTable",112],"}",["T_ENCAPSED_AND_WHITESPACE","` (\n  `profile_id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `state` varchar(20) NOT NULL,\n  `customer_id` int(10) unsigned DEFAULT NULL,\n  `store_id` smallint(5) unsigned DEFAULT NULL,\n  `method_code` varchar(32) NOT NULL,\n  `created_at` datetime NOT NULL,\n  `updated_at` datetime DEFAULT NULL,\n  `reference_id` varchar(32) DEFAULT NULL,\n  `subscriber_name` varchar(150) DEFAULT NULL,\n  `start_datetime` datetime NOT NULL,\n  `internal_reference_id` varchar(42) NOT NULL,\n  `schedule_description` varchar(255) NOT NULL,\n  `suspension_threshold` smallint(6) unsigned DEFAULT NULL,\n  `bill_failed_later` tinyint(1) unsigned NOT NULL DEFAULT '0',\n  `period_unit` varchar(20) NOT NULL,\n  `period_frequency` tinyint(3) unsigned DEFAULT NULL,\n  `period_max_cycles` tinyint(3) unsigned DEFAULT NULL,\n  `billing_amount` double(12,4) unsigned NOT NULL DEFAULT '0.0000',\n  `trial_period_unit` varchar(20) DEFAULT NULL,\n  `trial_period_frequency` tinyint(3) unsigned DEFAULT NULL,\n  `trial_period_max_cycles` tinyint(3) unsigned DEFAULT NULL,\n  `trial_billing_amount` double(12,4) unsigned DEFAULT NULL,\n  `currency_code` char(3) NOT NULL,\n  `shipping_amount` decimal(12,4) unsigned DEFAULT NULL,\n  `tax_amount` decimal(12,4) unsigned DEFAULT NULL,\n  `init_amount` decimal(12,4) unsigned DEFAULT NULL,\n  `init_may_fail` tinyint(1) unsigned NOT NULL DEFAULT '0',\n  `order_info` text NOT NULL,\n  `order_item_info` text NOT NULL,\n  `billing_address_info` text NOT NULL,\n  `shipping_address_info` text DEFAULT NULL,\n  `profile_vendor_info` text DEFAULT NULL,\n  `additional_info` text DEFAULT NULL,\n  PRIMARY KEY (`profile_id`),\n  UNIQUE KEY `UNQ_INTERNAL_REF_ID` (`internal_reference_id`),\n  KEY `IDX_RECURRING_PROFILE_CUSTOMER` (`customer_id`),\n  KEY `IDX_RECURRING_PROFILE_STORE` (`store_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;",112],"\"",")",";",["T_WHITESPACE","\n\n",150],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getConnection",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","addConstraint",152],"(",["T_CONSTANT_ENCAPSED_STRING","'FK_RECURRING_PROFILE_CUSTOMER'",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$profileTable",152],",",["T_WHITESPACE"," ",152],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",152],",",["T_WHITESPACE","\n    ",152],["T_VARIABLE","$customerEntityTable",153],",",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",153],",",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'SET NULL'",153],["T_WHITESPACE","\n",153],")",";",["T_WHITESPACE","\n\n",154],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getConnection",156],"(",")",["T_OBJECT_OPERATOR","->",156],["T_STRING","addConstraint",156],"(",["T_CONSTANT_ENCAPSED_STRING","'FK_RECURRING_PROFILE_STORE'",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$profileTable",156],",",["T_WHITESPACE"," ",156],["T_CONSTANT_ENCAPSED_STRING","'store_id'",156],",",["T_WHITESPACE","\n    ",156],["T_VARIABLE","$coreStoreTable",157],",",["T_WHITESPACE"," ",157],["T_CONSTANT_ENCAPSED_STRING","'store_id'",157],",",["T_WHITESPACE"," ",157],["T_CONSTANT_ENCAPSED_STRING","'SET NULL'",157],["T_WHITESPACE","\n",157],")",";",["T_WHITESPACE","\n\n",158],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","run",160],"(","\"",["T_ENCAPSED_AND_WHITESPACE","\nCREATE TABLE `",160],["T_CURLY_OPEN","{",161],["T_VARIABLE","$profileOrderTable",161],"}",["T_ENCAPSED_AND_WHITESPACE","` (\n  `link_id` int(10) unsigned NOT NULL AUTO_INCREMENT,\n  `profile_id` int(10) unsigned NOT NULL DEFAULT '0',\n  `order_id` int(10) unsigned NOT NULL DEFAULT '0',\n  PRIMARY KEY (`link_id`),\n  UNIQUE KEY `UNQ_PROFILE_ORDER` (`profile_id`,`order_id`),\n  KEY `IDX_ORDER` (`order_id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n",161],"\"",")",";",["T_WHITESPACE","\n\n",169],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getConnection",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","addConstraint",171],"(",["T_CONSTANT_ENCAPSED_STRING","'FK_RECURRING_PROFILE_ORDER_PROFILE'",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$profileOrderTable",171],",",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'profile_id'",171],",",["T_WHITESPACE","\n    ",171],["T_VARIABLE","$profileTable",172],",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'profile_id'",172],["T_WHITESPACE","\n",172],")",";",["T_WHITESPACE","\n\n",173],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getConnection",175],"(",")",["T_OBJECT_OPERATOR","->",175],["T_STRING","addConstraint",175],"(",["T_CONSTANT_ENCAPSED_STRING","'FK_RECURRING_PROFILE_ORDER_ORDER'",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$profileOrderTable",175],",",["T_WHITESPACE"," ",175],["T_CONSTANT_ENCAPSED_STRING","'order_id'",175],",",["T_WHITESPACE","\n    ",175],["T_VARIABLE","$flatOrderTable",176],",",["T_WHITESPACE"," ",176],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",176],["T_WHITESPACE","\n",176],")",";",["T_WHITESPACE","\n",177]]