[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_CLASS","class",28],["T_WHITESPACE"," ",28],["T_STRING","Mage_Sales_Model_Order_Invoice_Total_Tax",28],["T_WHITESPACE"," ",28],["T_EXTENDS","extends",28],["T_WHITESPACE"," ",28],["T_STRING","Mage_Sales_Model_Order_Invoice_Total_Abstract",28],["T_WHITESPACE","\n",28],"{",["T_WHITESPACE","\n    ",29],["T_DOC_COMMENT","\/**\n     * Collect invoice tax amount\n     *\n     * @param Mage_Sales_Model_Order_Invoice $invoice\n     * @return Mage_Sales_Model_Order_Invoice_Total_Tax\n     *\/",30],["T_WHITESPACE","\n    ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","collect",36],"(",["T_STRING","Mage_Sales_Model_Order_Invoice",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$invoice",36],")",["T_WHITESPACE","\n    ",36],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$totalTax",38],["T_WHITESPACE","       ",38],"=",["T_WHITESPACE"," ",38],["T_LNUMBER","0",38],";",["T_WHITESPACE","\n        ",38],["T_VARIABLE","$baseTotalTax",39],["T_WHITESPACE","   ",39],"=",["T_WHITESPACE"," ",39],["T_LNUMBER","0",39],";",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$totalHiddenTax",40],["T_WHITESPACE","      ",40],"=",["T_WHITESPACE"," ",40],["T_LNUMBER","0",40],";",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$baseTotalHiddenTax",41],["T_WHITESPACE","  ",41],"=",["T_WHITESPACE"," ",41],["T_LNUMBER","0",41],";",["T_WHITESPACE","\n\n        ",41],["T_VARIABLE","$order",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$invoice",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getOrder",43],"(",")",";",["T_WHITESPACE","\n\n        ",43],["T_DOC_COMMENT","\/** @var $item Mage_Sales_Model_Order_Invoice_Item *\/",45],["T_WHITESPACE","\n        ",45],["T_FOREACH","foreach",46],["T_WHITESPACE"," ",46],"(",["T_VARIABLE","$invoice",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getAllItems",46],"(",")",["T_WHITESPACE"," ",46],["T_AS","as",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$item",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n            ",46],["T_VARIABLE","$orderItem",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$item",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getOrderItem",47],"(",")",";",["T_WHITESPACE","\n            ",47],["T_VARIABLE","$orderItemQty",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$orderItem",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getQtyOrdered",48],"(",")",";",["T_WHITESPACE","\n\n            ",48],["T_IF","if",50],["T_WHITESPACE"," ",50],"(","(",["T_VARIABLE","$orderItem",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getTaxAmount",50],"(",")",["T_WHITESPACE"," ",50],["T_BOOLEAN_OR","||",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$orderItem",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getHiddenTaxAmount",50],"(",")",")",["T_WHITESPACE"," ",50],["T_BOOLEAN_AND","&&",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$orderItemQty",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n                ",50],["T_IF","if",51],["T_WHITESPACE"," ",51],"(",["T_VARIABLE","$item",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getOrderItem",51],"(",")",["T_OBJECT_OPERATOR","->",51],["T_STRING","isDummy",51],"(",")",")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n                    ",51],["T_CONTINUE","continue",52],";",["T_WHITESPACE","\n                ",52],"}",["T_WHITESPACE","\n\n                ",53],["T_DOC_COMMENT","\/**\n                 * Resolve rounding problems\n                 *\/",55],["T_WHITESPACE","\n                ",57],["T_VARIABLE","$tax",58],["T_WHITESPACE","            ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$orderItem",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getTaxAmount",58],"(",")",["T_WHITESPACE"," ",58],"-",["T_WHITESPACE"," ",58],["T_VARIABLE","$orderItem",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getTaxInvoiced",58],"(",")",";",["T_WHITESPACE","\n                ",58],["T_VARIABLE","$baseTax",59],["T_WHITESPACE","        ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$orderItem",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getBaseTaxAmount",59],"(",")",["T_WHITESPACE"," ",59],"-",["T_WHITESPACE"," ",59],["T_VARIABLE","$orderItem",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getBaseTaxInvoiced",59],"(",")",";",["T_WHITESPACE","\n                ",59],["T_VARIABLE","$hiddenTax",60],["T_WHITESPACE","      ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$orderItem",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getHiddenTaxAmount",60],"(",")",["T_WHITESPACE"," ",60],"-",["T_WHITESPACE"," ",60],["T_VARIABLE","$orderItem",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getHiddenTaxInvoiced",60],"(",")",";",["T_WHITESPACE","\n                ",60],["T_VARIABLE","$baseHiddenTax",61],["T_WHITESPACE","  ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$orderItem",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getBaseHiddenTaxAmount",61],"(",")",["T_WHITESPACE"," ",61],"-",["T_WHITESPACE"," ",61],["T_VARIABLE","$orderItem",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getBaseHiddenTaxInvoiced",61],"(",")",";",["T_WHITESPACE","\n                ",61],["T_IF","if",62],["T_WHITESPACE"," ",62],"(","!",["T_VARIABLE","$item",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","isLast",62],"(",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n                    ",62],["T_VARIABLE","$availableQty",63],["T_WHITESPACE","  ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$orderItemQty",63],["T_WHITESPACE"," ",63],"-",["T_WHITESPACE"," ",63],["T_VARIABLE","$orderItem",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getQtyInvoiced",63],"(",")",";",["T_WHITESPACE","\n                    ",63],["T_VARIABLE","$tax",64],["T_WHITESPACE","           ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$invoice",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","roundPrice",64],"(",["T_VARIABLE","$tax",64],["T_WHITESPACE"," ",64],"\/",["T_WHITESPACE"," ",64],["T_VARIABLE","$availableQty",64],["T_WHITESPACE"," ",64],"*",["T_WHITESPACE"," ",64],["T_VARIABLE","$item",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getQty",64],"(",")",")",";",["T_WHITESPACE","\n                    ",64],["T_VARIABLE","$baseTax",65],["T_WHITESPACE","       ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$invoice",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","roundPrice",65],"(",["T_VARIABLE","$baseTax",65],["T_WHITESPACE"," ",65],"\/",["T_WHITESPACE"," ",65],["T_VARIABLE","$availableQty",65],["T_WHITESPACE"," ",65],"*",["T_WHITESPACE"," ",65],["T_VARIABLE","$item",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getQty",65],"(",")",",",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'base'",65],")",";",["T_WHITESPACE","\n                    ",65],["T_VARIABLE","$hiddenTax",66],["T_WHITESPACE","     ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$invoice",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","roundPrice",66],"(",["T_VARIABLE","$hiddenTax",66],["T_WHITESPACE"," ",66],"\/",["T_WHITESPACE"," ",66],["T_VARIABLE","$availableQty",66],["T_WHITESPACE"," ",66],"*",["T_WHITESPACE"," ",66],["T_VARIABLE","$item",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getQty",66],"(",")",")",";",["T_WHITESPACE","\n                    ",66],["T_VARIABLE","$baseHiddenTax",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$invoice",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","roundPrice",67],"(",["T_VARIABLE","$baseHiddenTax",67],["T_WHITESPACE"," ",67],"\/",["T_WHITESPACE"," ",67],["T_VARIABLE","$availableQty",67],["T_WHITESPACE"," ",67],"*",["T_WHITESPACE"," ",67],["T_VARIABLE","$item",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getQty",67],"(",")",",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'base'",67],")",";",["T_WHITESPACE","\n                ",67],"}",["T_WHITESPACE","\n\n                ",68],["T_VARIABLE","$item",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","setTaxAmount",70],"(",["T_VARIABLE","$tax",70],")",";",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$item",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","setBaseTaxAmount",71],"(",["T_VARIABLE","$baseTax",71],")",";",["T_WHITESPACE","\n                ",71],["T_VARIABLE","$item",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","setHiddenTaxAmount",72],"(",["T_VARIABLE","$hiddenTax",72],")",";",["T_WHITESPACE","\n                ",72],["T_VARIABLE","$item",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","setBaseHiddenTaxAmount",73],"(",["T_VARIABLE","$baseHiddenTax",73],")",";",["T_WHITESPACE","\n\n                ",73],["T_VARIABLE","$totalTax",75],["T_WHITESPACE"," ",75],["T_PLUS_EQUAL","+=",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$tax",75],";",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$baseTotalTax",76],["T_WHITESPACE"," ",76],["T_PLUS_EQUAL","+=",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$baseTax",76],";",["T_WHITESPACE","\n                ",76],["T_VARIABLE","$totalHiddenTax",77],["T_WHITESPACE"," ",77],["T_PLUS_EQUAL","+=",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$hiddenTax",77],";",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$baseTotalHiddenTax",78],["T_WHITESPACE"," ",78],["T_PLUS_EQUAL","+=",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$baseHiddenTax",78],";",["T_WHITESPACE","\n            ",78],"}",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n\n        ",80],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_canIncludeShipping",82],"(",["T_VARIABLE","$invoice",82],")",")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$totalTax",83],["T_WHITESPACE","           ",83],["T_PLUS_EQUAL","+=",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$order",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getShippingTaxAmount",83],"(",")",";",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$baseTotalTax",84],["T_WHITESPACE","       ",84],["T_PLUS_EQUAL","+=",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$order",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getBaseShippingTaxAmount",84],"(",")",";",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$totalHiddenTax",85],["T_WHITESPACE","     ",85],["T_PLUS_EQUAL","+=",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$order",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getShippingHiddenTaxAmount",85],"(",")",";",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$baseTotalHiddenTax",86],["T_WHITESPACE"," ",86],["T_PLUS_EQUAL","+=",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$order",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getBaseShippingHiddenTaxAmount",86],"(",")",";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$invoice",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","setShippingTaxAmount",87],"(",["T_VARIABLE","$order",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getShippingTaxAmount",87],"(",")",")",";",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$invoice",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","setBaseShippingTaxAmount",88],"(",["T_VARIABLE","$order",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getBaseShippingTaxAmount",88],"(",")",")",";",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$invoice",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","setShippingHiddenTaxAmount",89],"(",["T_VARIABLE","$order",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getShippingHiddenTaxAmount",89],"(",")",")",";",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$invoice",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setBaseShippingHiddenTaxAmount",90],"(",["T_VARIABLE","$order",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getBaseShippingHiddenTaxAmount",90],"(",")",")",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$allowedTax",92],["T_WHITESPACE","     ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$order",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTaxAmount",92],"(",")",["T_WHITESPACE"," ",92],"-",["T_WHITESPACE"," ",92],["T_VARIABLE","$order",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTaxInvoiced",92],"(",")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$allowedBaseTax",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$order",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getBaseTaxAmount",93],"(",")",["T_WHITESPACE"," ",93],"-",["T_WHITESPACE"," ",93],["T_VARIABLE","$order",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getBaseTaxInvoiced",93],"(",")",";",";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$allowedHiddenTax",94],["T_WHITESPACE","     ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$order",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getHiddenTaxAmount",94],"(",")",["T_WHITESPACE"," ",94],"+",["T_WHITESPACE"," ",94],["T_VARIABLE","$order",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getShippingHiddenTaxAmount",94],"(",")",["T_WHITESPACE","\n            ",94],"-",["T_WHITESPACE"," ",95],["T_VARIABLE","$order",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getHiddenTaxInvoiced",95],"(",")",["T_WHITESPACE"," ",95],"-",["T_WHITESPACE"," ",95],["T_VARIABLE","$order",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getShippingHiddenTaxInvoiced",95],"(",")",";",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$allowedBaseHiddenTax",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$order",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getBaseHiddenTaxAmount",96],"(",")",["T_WHITESPACE"," ",96],"+",["T_WHITESPACE"," ",96],["T_VARIABLE","$order",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getBaseShippingHiddenTaxAmount",96],"(",")",["T_WHITESPACE","\n            ",96],"-",["T_WHITESPACE"," ",97],["T_VARIABLE","$order",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getBaseHiddenTaxInvoiced",97],"(",")",["T_WHITESPACE"," ",97],"-",["T_WHITESPACE"," ",97],["T_VARIABLE","$order",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getBaseShippingHiddenTaxInvoiced",97],"(",")",";",["T_WHITESPACE","\n\n        ",97],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$invoice",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","isLast",99],"(",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$totalTax",100],["T_WHITESPACE","           ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$allowedTax",100],";",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$baseTotalTax",101],["T_WHITESPACE","       ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$allowedBaseTax",101],";",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$totalHiddenTax",102],["T_WHITESPACE","     ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$allowedHiddenTax",102],";",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$baseTotalHiddenTax",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$allowedBaseHiddenTax",103],";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE"," ",104],["T_ELSE","else",104],["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$totalTax",105],["T_WHITESPACE","           ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","min",105],"(",["T_VARIABLE","$allowedTax",105],",",["T_WHITESPACE"," ",105],["T_VARIABLE","$totalTax",105],")",";",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$baseTotalTax",106],["T_WHITESPACE","       ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","min",106],"(",["T_VARIABLE","$allowedBaseTax",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$baseTotalTax",106],")",";",["T_WHITESPACE","\n            ",106],["T_VARIABLE","$totalHiddenTax",107],["T_WHITESPACE","     ",107],"=",["T_WHITESPACE"," ",107],["T_STRING","min",107],"(",["T_VARIABLE","$allowedHiddenTax",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$totalHiddenTax",107],")",";",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$baseTotalHiddenTax",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","min",108],"(",["T_VARIABLE","$allowedBaseHiddenTax",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$baseTotalHiddenTax",108],")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n\n        ",109],["T_VARIABLE","$invoice",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","setTaxAmount",111],"(",["T_VARIABLE","$totalTax",111],")",";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$invoice",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","setBaseTaxAmount",112],"(",["T_VARIABLE","$baseTotalTax",112],")",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$invoice",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","setHiddenTaxAmount",113],"(",["T_VARIABLE","$totalHiddenTax",113],")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$invoice",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","setBaseHiddenTaxAmount",114],"(",["T_VARIABLE","$baseTotalHiddenTax",114],")",";",["T_WHITESPACE","\n\n        ",114],["T_VARIABLE","$invoice",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","setGrandTotal",116],"(",["T_VARIABLE","$invoice",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getGrandTotal",116],"(",")",["T_WHITESPACE"," ",116],"+",["T_WHITESPACE"," ",116],["T_VARIABLE","$totalTax",116],["T_WHITESPACE"," ",116],"+",["T_WHITESPACE"," ",116],["T_VARIABLE","$totalHiddenTax",116],")",";",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$invoice",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","setBaseGrandTotal",117],"(",["T_VARIABLE","$invoice",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getBaseGrandTotal",117],"(",")",["T_WHITESPACE"," ",117],"+",["T_WHITESPACE"," ",117],["T_VARIABLE","$baseTotalTax",117],["T_WHITESPACE"," ",117],"+",["T_WHITESPACE"," ",117],["T_VARIABLE","$baseTotalHiddenTax",117],")",";",["T_WHITESPACE","\n\n        ",117],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Check if shipping tax calculation can be included to current invoice\n     * @param Mage_Sales_Model_Order_Invoice $invoice\n     * @return boolean\n     *\/",122],["T_WHITESPACE","\n    ",126],["T_PROTECTED","protected",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","_canIncludeShipping",127],"(",["T_VARIABLE","$invoice",127],")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$includeShippingTax",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_STRING","true",129],";",["T_WHITESPACE","\n        ",129],["T_DOC_COMMENT","\/**\n         * Check shipping amount in previous invoices\n         *\/",130],["T_WHITESPACE","\n        ",132],["T_FOREACH","foreach",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$invoice",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getOrder",133],"(",")",["T_OBJECT_OPERATOR","->",133],["T_STRING","getInvoiceCollection",133],"(",")",["T_WHITESPACE"," ",133],["T_AS","as",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$previusInvoice",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$previusInvoice",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getShippingAmount",134],"(",")",["T_WHITESPACE"," ",134],["T_BOOLEAN_AND","&&",134],["T_WHITESPACE"," ",134],"!",["T_VARIABLE","$previusInvoice",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","isCanceled",134],"(",")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$includeShippingTax",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","false",135],";",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n        ",137],["T_RETURN","return",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$includeShippingTax",138],";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n",139],"}",["T_WHITESPACE","\n",140]]