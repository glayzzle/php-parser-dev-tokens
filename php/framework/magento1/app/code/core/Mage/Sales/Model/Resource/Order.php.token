[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Flat sales order resource\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Order",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Order_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Event prefix\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_eventPrefix",42],["T_WHITESPACE","                  ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'sales_order_resource'",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Event object\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_eventObject",49],["T_WHITESPACE","                  ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'resource'",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Is grid\n     *\n     * @var boolean\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_grid",56],["T_WHITESPACE","                         ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","true",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Use increment id\n     *\n     * @var boolean\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_useIncrementId",63],["T_WHITESPACE","               ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","true",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Entity code for increment id\n     *\n     * @var string\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_entityCodeForIncrementId",70],["T_WHITESPACE","     ",70],"=",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'order'",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Model Initialization\n     *\n     *\/",72],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","_construct",76],"(",")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_init",78],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",78],")",";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Init virtual grid records for entity\n     *\n     * @return Mage_Sales_Model_Resource_Order\n     *\/",81],["T_WHITESPACE","\n    ",85],["T_PROTECTED","protected",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","_initVirtualGridColumns",86],"(",")",["T_WHITESPACE","\n    ",86],"{",["T_WHITESPACE","\n        ",87],["T_STRING","parent",88],["T_DOUBLE_COLON","::",88],["T_STRING","_initVirtualGridColumns",88],"(",")",";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$adapter",89],["T_WHITESPACE","       ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getReadConnection",89],"(",")",";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$ifnullFirst",90],["T_WHITESPACE","   ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$adapter",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getIfNullSql",90],"(",["T_CONSTANT_ENCAPSED_STRING","'{{table}}.firstname'",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$adapter",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","quote",90],"(",["T_CONSTANT_ENCAPSED_STRING","''",90],")",")",";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$ifnullMiddle",91],["T_WHITESPACE","  ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$adapter",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getIfNullSql",91],"(",["T_CONSTANT_ENCAPSED_STRING","'{{table}}.middlename'",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$adapter",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","quote",91],"(",["T_CONSTANT_ENCAPSED_STRING","''",91],")",")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$ifnullLast",92],["T_WHITESPACE","    ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$adapter",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getIfNullSql",92],"(",["T_CONSTANT_ENCAPSED_STRING","'{{table}}.lastname'",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$adapter",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","quote",92],"(",["T_CONSTANT_ENCAPSED_STRING","''",92],")",")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$concatAddress",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$adapter",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getConcatSql",93],"(",["T_ARRAY","array",93],"(",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$ifnullFirst",94],",",["T_WHITESPACE","\n            ",94],["T_VARIABLE","$adapter",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","quote",95],"(",["T_CONSTANT_ENCAPSED_STRING","' '",95],")",",",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$ifnullMiddle",96],",",["T_WHITESPACE","\n            ",96],["T_VARIABLE","$adapter",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","quote",97],"(",["T_CONSTANT_ENCAPSED_STRING","' '",97],")",",",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$ifnullLast",98],["T_WHITESPACE","\n        ",98],")",")",";",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","addVirtualGridColumn",100],"(",["T_WHITESPACE","\n                ",100],["T_CONSTANT_ENCAPSED_STRING","'billing_name'",101],",",["T_WHITESPACE","\n                ",101],["T_CONSTANT_ENCAPSED_STRING","'sales\/order_address'",102],",",["T_WHITESPACE","\n                ",102],["T_ARRAY","array",103],"(",["T_CONSTANT_ENCAPSED_STRING","'billing_address_id'",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",103],")",",",["T_WHITESPACE","\n                ",103],["T_VARIABLE","$concatAddress",104],["T_WHITESPACE","\n            ",104],")",["T_WHITESPACE","\n            ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","addVirtualGridColumn",106],"(",["T_WHITESPACE","\n                ",106],["T_CONSTANT_ENCAPSED_STRING","'shipping_name'",107],",",["T_WHITESPACE","\n                ",107],["T_CONSTANT_ENCAPSED_STRING","'sales\/order_address'",108],",",["T_WHITESPACE","\n                 ",108],["T_ARRAY","array",109],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_address_id'",109],["T_WHITESPACE"," ",109],["T_DOUBLE_ARROW","=>",109],["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",109],")",",",["T_WHITESPACE","\n                 ",109],["T_VARIABLE","$concatAddress",110],["T_WHITESPACE","\n            ",110],")",";",["T_WHITESPACE","\n\n        ",111],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Count existent products of order items by specified product types\n     *\n     * @param int $orderId\n     * @param array $productTypeIds\n     * @param bool $isProductTypeIn\n     * @return array\n     *\/",116],["T_WHITESPACE","\n    ",123],["T_PUBLIC","public",124],["T_WHITESPACE"," ",124],["T_FUNCTION","function",124],["T_WHITESPACE"," ",124],["T_STRING","aggregateProductsByTypes",124],"(",["T_VARIABLE","$orderId",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$productTypeIds",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_ARRAY","array",124],"(",")",",",["T_WHITESPACE"," ",124],["T_VARIABLE","$isProductTypeIn",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","false",124],")",["T_WHITESPACE","\n    ",124],"{",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$adapter",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getReadConnection",126],"(",")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$select",127],["T_WHITESPACE","  ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$adapter",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","select",127],"(",")",["T_WHITESPACE","\n            ",127],["T_OBJECT_OPERATOR","->",128],["T_STRING","from",128],"(",["T_WHITESPACE","\n                ",128],["T_ARRAY","array",129],"(",["T_CONSTANT_ENCAPSED_STRING","'o'",129],["T_WHITESPACE"," ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getTable",129],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_item'",129],")",")",",",["T_WHITESPACE","\n                ",129],["T_ARRAY","array",130],"(",["T_CONSTANT_ENCAPSED_STRING","'o.product_type'",130],",",["T_WHITESPACE"," ",130],["T_NEW","new",130],["T_WHITESPACE"," ",130],["T_STRING","Zend_Db_Expr",130],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",130],")",")",")",["T_WHITESPACE","\n            ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","joinInner",131],"(",["T_WHITESPACE","\n                ",131],["T_ARRAY","array",132],"(",["T_CONSTANT_ENCAPSED_STRING","'p'",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getTable",132],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",132],")",")",",",["T_WHITESPACE","\n                ",132],["T_CONSTANT_ENCAPSED_STRING","'o.product_id=p.entity_id'",133],",",["T_WHITESPACE","\n                ",133],["T_ARRAY","array",134],"(",")",")",["T_WHITESPACE","\n            ",134],["T_OBJECT_OPERATOR","->",135],["T_STRING","where",135],"(",["T_CONSTANT_ENCAPSED_STRING","'o.order_id=?'",135],",",["T_WHITESPACE"," ",135],["T_VARIABLE","$orderId",135],")",["T_WHITESPACE","\n            ",135],["T_OBJECT_OPERATOR","->",136],["T_STRING","group",136],"(",["T_CONSTANT_ENCAPSED_STRING","'o.product_type'",136],")",["T_WHITESPACE","\n        ",136],";",["T_WHITESPACE","\n        ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$productTypeIds",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$select",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","where",139],"(",["T_WHITESPACE","\n                ",139],["T_STRING","sprintf",140],"(",["T_CONSTANT_ENCAPSED_STRING","'(o.product_type %s (?))'",140],",",["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$isProductTypeIn",140],["T_WHITESPACE"," ",140],"?",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'IN'",140],["T_WHITESPACE"," ",140],":",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'NOT IN'",140],")",")",",",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$productTypeIds",141],")",";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n        ",142],["T_RETURN","return",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$adapter",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","fetchPairs",143],"(",["T_VARIABLE","$select",143],")",";",["T_WHITESPACE","\n    ",143],"}",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * Retrieve order_increment_id by order_id\n     *\n     * @param int $orderId\n     * @return string\n     *\/",146],["T_WHITESPACE","\n    ",151],["T_PUBLIC","public",152],["T_WHITESPACE"," ",152],["T_FUNCTION","function",152],["T_WHITESPACE"," ",152],["T_STRING","getIncrementId",152],"(",["T_VARIABLE","$orderId",152],")",["T_WHITESPACE","\n    ",152],"{",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$adapter",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getReadConnection",154],"(",")",";",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$bind",155],["T_WHITESPACE","    ",155],"=",["T_WHITESPACE"," ",155],["T_ARRAY","array",155],"(",["T_CONSTANT_ENCAPSED_STRING","':entity_id'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$orderId",155],")",";",["T_WHITESPACE","\n        ",155],["T_VARIABLE","$select",156],["T_WHITESPACE","  ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$adapter",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","select",156],"(",")",["T_WHITESPACE","\n            ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","from",157],"(",["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getMainTable",157],"(",")",",",["T_WHITESPACE"," ",157],["T_ARRAY","array",157],"(",["T_CONSTANT_ENCAPSED_STRING","\"increment_id\"",157],")",")",["T_WHITESPACE","\n            ",157],["T_OBJECT_OPERATOR","->",158],["T_STRING","where",158],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",158],")",";",["T_WHITESPACE","\n        ",158],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$adapter",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","fetchOne",159],"(",["T_VARIABLE","$select",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$bind",159],")",";",["T_WHITESPACE","\n    ",159],"}",["T_WHITESPACE","\n",160],"}",["T_WHITESPACE","\n",161]]