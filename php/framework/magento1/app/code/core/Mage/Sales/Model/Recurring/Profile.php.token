[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Sales implementation of recurring payment profiles\n * Implements saving and manageing profiles\n *\n * @method Mage_Sales_Model_Resource_Recurring_Profile _getResource()\n * @method Mage_Sales_Model_Resource_Recurring_Profile getResource()\n * @method string getState()\n * @method Mage_Sales_Model_Recurring_Profile setState(string $value)\n * @method int getCustomerId()\n * @method Mage_Sales_Model_Recurring_Profile setCustomerId(int $value)\n * @method int getStoreId()\n * @method Mage_Sales_Model_Recurring_Profile setStoreId(int $value)\n * @method string getMethodCode()\n * @method Mage_Sales_Model_Recurring_Profile setMethodCode(string $value)\n * @method string getCreatedAt()\n * @method Mage_Sales_Model_Recurring_Profile setCreatedAt(string $value)\n * @method string getUpdatedAt()\n * @method Mage_Sales_Model_Recurring_Profile setUpdatedAt(string $value)\n * @method string getReferenceId()\n * @method Mage_Sales_Model_Recurring_Profile setReferenceId(string $value)\n * @method string getSubscriberName()\n * @method Mage_Sales_Model_Recurring_Profile setSubscriberName(string $value)\n * @method string getStartDatetime()\n * @method Mage_Sales_Model_Recurring_Profile setStartDatetime(string $value)\n * @method string getInternalReferenceId()\n * @method Mage_Sales_Model_Recurring_Profile setInternalReferenceId(string $value)\n * @method string getScheduleDescription()\n * @method Mage_Sales_Model_Recurring_Profile setScheduleDescription(string $value)\n * @method int getSuspensionThreshold()\n * @method Mage_Sales_Model_Recurring_Profile setSuspensionThreshold(int $value)\n * @method int getBillFailedLater()\n * @method Mage_Sales_Model_Recurring_Profile setBillFailedLater(int $value)\n * @method string getPeriodUnit()\n * @method Mage_Sales_Model_Recurring_Profile setPeriodUnit(string $value)\n * @method int getPeriodFrequency()\n * @method Mage_Sales_Model_Recurring_Profile setPeriodFrequency(int $value)\n * @method int getPeriodMaxCycles()\n * @method Mage_Sales_Model_Recurring_Profile setPeriodMaxCycles(int $value)\n * @method float getBillingAmount()\n * @method Mage_Sales_Model_Recurring_Profile setBillingAmount(float $value)\n * @method string getTrialPeriodUnit()\n * @method Mage_Sales_Model_Recurring_Profile setTrialPeriodUnit(string $value)\n * @method int getTrialPeriodFrequency()\n * @method Mage_Sales_Model_Recurring_Profile setTrialPeriodFrequency(int $value)\n * @method int getTrialPeriodMaxCycles()\n * @method Mage_Sales_Model_Recurring_Profile setTrialPeriodMaxCycles(int $value)\n * @method float getTrialBillingAmount()\n * @method Mage_Sales_Model_Recurring_Profile setTrialBillingAmount(float $value)\n * @method string getCurrencyCode()\n * @method Mage_Sales_Model_Recurring_Profile setCurrencyCode(string $value)\n * @method float getShippingAmount()\n * @method Mage_Sales_Model_Recurring_Profile setShippingAmount(float $value)\n * @method float getTaxAmount()\n * @method Mage_Sales_Model_Recurring_Profile setTaxAmount(float $value)\n * @method float getInitAmount()\n * @method Mage_Sales_Model_Recurring_Profile setInitAmount(float $value)\n * @method int getInitMayFail()\n * @method Mage_Sales_Model_Recurring_Profile setInitMayFail(int $value)\n * @method string getOrderInfo()\n * @method Mage_Sales_Model_Recurring_Profile setOrderInfo(string $value)\n * @method string getOrderItemInfo()\n * @method Mage_Sales_Model_Recurring_Profile setOrderItemInfo(string $value)\n * @method string getBillingAddressInfo()\n * @method Mage_Sales_Model_Recurring_Profile setBillingAddressInfo(string $value)\n * @method string getShippingAddressInfo()\n * @method Mage_Sales_Model_Recurring_Profile setShippingAddressInfo(string $value)\n * @method string getProfileVendorInfo()\n * @method Mage_Sales_Model_Recurring_Profile setProfileVendorInfo(string $value)\n * @method string getAdditionalInfo()\n * @method Mage_Sales_Model_Recurring_Profile setAdditionalInfo(string $value)\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",101],["T_CLASS","class",102],["T_WHITESPACE"," ",102],["T_STRING","Mage_Sales_Model_Recurring_Profile",102],["T_WHITESPACE"," ",102],["T_EXTENDS","extends",102],["T_WHITESPACE"," ",102],["T_STRING","Mage_Payment_Model_Recurring_Profile",102],["T_WHITESPACE","\n",102],"{",["T_WHITESPACE","\n    ",103],["T_DOC_COMMENT","\/**\n     * Available states\n     *\n     * @var string\n     *\/",104],["T_WHITESPACE","\n    ",108],["T_CONST","const",109],["T_WHITESPACE"," ",109],["T_STRING","STATE_UNKNOWN",109],["T_WHITESPACE","   ",109],"=",["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'unknown'",109],";",["T_WHITESPACE","\n    ",109],["T_CONST","const",110],["T_WHITESPACE"," ",110],["T_STRING","STATE_PENDING",110],["T_WHITESPACE","   ",110],"=",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","'pending'",110],";",["T_WHITESPACE","\n    ",110],["T_CONST","const",111],["T_WHITESPACE"," ",111],["T_STRING","STATE_ACTIVE",111],["T_WHITESPACE","    ",111],"=",["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'active'",111],";",["T_WHITESPACE","\n    ",111],["T_CONST","const",112],["T_WHITESPACE"," ",112],["T_STRING","STATE_SUSPENDED",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'suspended'",112],";",["T_WHITESPACE","\n    ",112],["T_CONST","const",113],["T_WHITESPACE"," ",113],["T_STRING","STATE_CANCELED",113],["T_WHITESPACE","  ",113],"=",["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'canceled'",113],";",["T_WHITESPACE","\n    ",113],["T_CONST","const",114],["T_WHITESPACE"," ",114],["T_STRING","STATE_EXPIRED",114],["T_WHITESPACE","   ",114],"=",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'expired'",114],";",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Payment types\n     *\n     * @var string\n     *\/",116],["T_WHITESPACE","\n    ",120],["T_CONST","const",121],["T_WHITESPACE"," ",121],["T_STRING","PAYMENT_TYPE_REGULAR",121],["T_WHITESPACE","   ",121],"=",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'regular'",121],";",["T_WHITESPACE","\n    ",121],["T_CONST","const",122],["T_WHITESPACE"," ",122],["T_STRING","PAYMENT_TYPE_TRIAL",122],["T_WHITESPACE","     ",122],"=",["T_WHITESPACE"," ",122],["T_CONSTANT_ENCAPSED_STRING","'trial'",122],";",["T_WHITESPACE","\n    ",122],["T_CONST","const",123],["T_WHITESPACE"," ",123],["T_STRING","PAYMENT_TYPE_INITIAL",123],["T_WHITESPACE","   ",123],"=",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'initial'",123],";",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * Allowed actions matrix\n     *\n     * @var array\n     *\/",125],["T_WHITESPACE","\n    ",129],["T_PROTECTED","protected",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$_workflow",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","null",130],";",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Load order by system increment identifier\n     *\n     * @param string $incrementId\n     * @return Mage_Sales_Model_Order\n     *\/",132],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","loadByInternalReferenceId",138],"(",["T_VARIABLE","$internalReferenceId",138],")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","load",140],"(",["T_VARIABLE","$internalReferenceId",140],",",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'internal_reference_id'",140],")",";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Submit a recurring profile right after an order is placed\n     *\n     *\/",143],["T_WHITESPACE","\n    ",146],["T_PUBLIC","public",147],["T_WHITESPACE"," ",147],["T_FUNCTION","function",147],["T_WHITESPACE"," ",147],["T_STRING","submit",147],"(",")",["T_WHITESPACE","\n    ",147],"{",["T_WHITESPACE","\n        ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_getResource",149],"(",")",["T_OBJECT_OPERATOR","->",149],["T_STRING","beginTransaction",149],"(",")",";",["T_WHITESPACE","\n        ",149],["T_TRY","try",150],["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","setInternalReferenceId",151],"(",["T_STRING","Mage",151],["T_DOUBLE_COLON","::",151],["T_STRING","helper",151],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",151],")",["T_OBJECT_OPERATOR","->",151],["T_STRING","uniqHash",151],"(",["T_CONSTANT_ENCAPSED_STRING","'temporary-'",151],")",")",";",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","save",152],"(",")",";",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","setInternalReferenceId",153],"(",["T_STRING","Mage",153],["T_DOUBLE_COLON","::",153],["T_STRING","helper",153],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",153],")",["T_OBJECT_OPERATOR","->",153],["T_STRING","uniqHash",153],"(",["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getId",153],"(",")",["T_WHITESPACE"," ",153],".",["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'-'",153],")",")",";",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getMethodInstance",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","submitRecurringProfile",154],"(",["T_VARIABLE","$this",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getQuote",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","getPayment",154],"(",")",")",";",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","save",155],"(",")",";",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_getResource",156],"(",")",["T_OBJECT_OPERATOR","->",156],["T_STRING","commit",156],"(",")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE"," ",157],["T_CATCH","catch",157],["T_WHITESPACE"," ",157],"(",["T_STRING","Exception",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$e",157],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getResource",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","rollBack",158],"(",")",";",["T_WHITESPACE","\n            ",158],["T_THROW","throw",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$e",159],";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Activate the suspended profile\n     *\/",163],["T_WHITESPACE","\n    ",165],["T_PUBLIC","public",166],["T_WHITESPACE"," ",166],["T_FUNCTION","function",166],["T_WHITESPACE"," ",166],["T_STRING","activate",166],"(",")",["T_WHITESPACE","\n    ",166],"{",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_checkWorkflow",168],"(",["T_STRING","self",168],["T_DOUBLE_COLON","::",168],["T_STRING","STATE_ACTIVE",168],",",["T_WHITESPACE"," ",168],["T_STRING","false",168],")",";",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","setNewState",169],"(",["T_STRING","self",169],["T_DOUBLE_COLON","::",169],["T_STRING","STATE_ACTIVE",169],")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getMethodInstance",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","updateRecurringProfileStatus",170],"(",["T_VARIABLE","$this",170],")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setState",171],"(",["T_STRING","self",171],["T_DOUBLE_COLON","::",171],["T_STRING","STATE_ACTIVE",171],")",["T_WHITESPACE","\n            ",171],["T_OBJECT_OPERATOR","->",172],["T_STRING","save",172],"(",")",";",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n\n    ",173],["T_DOC_COMMENT","\/**\n     * Check whether the workflow allows to activate the profile\n     *\n     * @return bool\n     *\/",175],["T_WHITESPACE","\n    ",179],["T_PUBLIC","public",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","canActivate",180],"(",")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_checkWorkflow",182],"(",["T_STRING","self",182],["T_DOUBLE_COLON","::",182],["T_STRING","STATE_ACTIVE",182],")",";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Suspend active profile\n     *\/",185],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","suspend",188],"(",")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_checkWorkflow",190],"(",["T_STRING","self",190],["T_DOUBLE_COLON","::",190],["T_STRING","STATE_SUSPENDED",190],",",["T_WHITESPACE"," ",190],["T_STRING","false",190],")",";",["T_WHITESPACE","\n        ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","setNewState",191],"(",["T_STRING","self",191],["T_DOUBLE_COLON","::",191],["T_STRING","STATE_SUSPENDED",191],")",";",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getMethodInstance",192],"(",")",["T_OBJECT_OPERATOR","->",192],["T_STRING","updateRecurringProfileStatus",192],"(",["T_VARIABLE","$this",192],")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","setState",193],"(",["T_STRING","self",193],["T_DOUBLE_COLON","::",193],["T_STRING","STATE_SUSPENDED",193],")",["T_WHITESPACE","\n            ",193],["T_OBJECT_OPERATOR","->",194],["T_STRING","save",194],"(",")",";",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Check whether the workflow allows to suspend the profile\n     *\n     * @return bool\n     *\/",197],["T_WHITESPACE","\n    ",201],["T_PUBLIC","public",202],["T_WHITESPACE"," ",202],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","canSuspend",202],"(",")",["T_WHITESPACE","\n    ",202],"{",["T_WHITESPACE","\n        ",203],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_checkWorkflow",204],"(",["T_STRING","self",204],["T_DOUBLE_COLON","::",204],["T_STRING","STATE_SUSPENDED",204],")",";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Cancel active or suspended profile\n     *\/",207],["T_WHITESPACE","\n    ",209],["T_PUBLIC","public",210],["T_WHITESPACE"," ",210],["T_FUNCTION","function",210],["T_WHITESPACE"," ",210],["T_STRING","cancel",210],"(",")",["T_WHITESPACE","\n    ",210],"{",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","_checkWorkflow",212],"(",["T_STRING","self",212],["T_DOUBLE_COLON","::",212],["T_STRING","STATE_CANCELED",212],",",["T_WHITESPACE"," ",212],["T_STRING","false",212],")",";",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","setNewState",213],"(",["T_STRING","self",213],["T_DOUBLE_COLON","::",213],["T_STRING","STATE_CANCELED",213],")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getMethodInstance",214],"(",")",["T_OBJECT_OPERATOR","->",214],["T_STRING","updateRecurringProfileStatus",214],"(",["T_VARIABLE","$this",214],")",";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","setState",215],"(",["T_STRING","self",215],["T_DOUBLE_COLON","::",215],["T_STRING","STATE_CANCELED",215],")",["T_WHITESPACE","\n            ",215],["T_OBJECT_OPERATOR","->",216],["T_STRING","save",216],"(",")",";",["T_WHITESPACE","\n    ",216],"}",["T_WHITESPACE","\n\n    ",217],["T_DOC_COMMENT","\/**\n     * Check whether the workflow allows to cancel the profile\n     *\n     * @return bool\n     *\/",219],["T_WHITESPACE","\n    ",223],["T_PUBLIC","public",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","canCancel",224],"(",")",["T_WHITESPACE","\n    ",224],"{",["T_WHITESPACE","\n        ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_checkWorkflow",226],"(",["T_STRING","self",226],["T_DOUBLE_COLON","::",226],["T_STRING","STATE_CANCELED",226],")",";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_PUBLIC","public",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","fetchUpdate",229],"(",")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$result",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_NEW","new",231],["T_WHITESPACE"," ",231],["T_STRING","Varien_Object",231],"(",")",";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getMethodInstance",232],"(",")",["T_OBJECT_OPERATOR","->",232],["T_STRING","getRecurringProfileDetails",232],"(",["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getReferenceId",232],"(",")",",",["T_WHITESPACE"," ",232],["T_VARIABLE","$result",232],")",";",["T_WHITESPACE","\n\n        ",232],["T_IF","if",234],["T_WHITESPACE"," ",234],"(",["T_VARIABLE","$result",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getIsProfileActive",234],"(",")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","setState",235],"(",["T_STRING","self",235],["T_DOUBLE_COLON","::",235],["T_STRING","STATE_ACTIVE",235],")",";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE"," ",236],["T_ELSEIF","elseif",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$result",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getIsProfilePending",236],"(",")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","setState",237],"(",["T_STRING","self",237],["T_DOUBLE_COLON","::",237],["T_STRING","STATE_PENDING",237],")",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE"," ",238],["T_ELSEIF","elseif",238],["T_WHITESPACE"," ",238],"(",["T_VARIABLE","$result",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getIsProfileCanceled",238],"(",")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","setState",239],"(",["T_STRING","self",239],["T_DOUBLE_COLON","::",239],["T_STRING","STATE_CANCELED",239],")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE"," ",240],["T_ELSEIF","elseif",240],["T_WHITESPACE"," ",240],"(",["T_VARIABLE","$result",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getIsProfileSuspended",240],"(",")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setState",241],"(",["T_STRING","self",241],["T_DOUBLE_COLON","::",241],["T_STRING","STATE_SUSPENDED",241],")",";",["T_WHITESPACE","\n        ",241],"}",["T_WHITESPACE"," ",242],["T_ELSEIF","elseif",242],["T_WHITESPACE"," ",242],"(",["T_VARIABLE","$result",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","getIsProfileExpired",242],"(",")",")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","setState",243],"(",["T_STRING","self",243],["T_DOUBLE_COLON","::",243],["T_STRING","STATE_EXPIRED",243],")",";",["T_WHITESPACE","\n        ",243],"}",["T_WHITESPACE","\n    ",244],"}",["T_WHITESPACE","\n\n    ",245],["T_PUBLIC","public",247],["T_WHITESPACE"," ",247],["T_FUNCTION","function",247],["T_WHITESPACE"," ",247],["T_STRING","canFetchUpdate",247],"(",")",["T_WHITESPACE","\n    ",247],"{",["T_WHITESPACE","\n        ",248],["T_RETURN","return",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getMethodInstance",249],"(",")",["T_OBJECT_OPERATOR","->",249],["T_STRING","canGetRecurringProfileDetails",249],"(",")",";",["T_WHITESPACE","\n    ",249],"}",["T_WHITESPACE","\n\n    ",250],["T_DOC_COMMENT","\/**\n     * Initialize new order based on profile data\n     *\n     * Takes arbitrary number of Varien_Object instances to be treated as items for new order\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",252],["T_WHITESPACE","\n    ",258],["T_PUBLIC","public",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","createOrder",259],"(",")",["T_WHITESPACE","\n    ",259],"{",["T_WHITESPACE","\n        ",260],["T_VARIABLE","$items",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_ARRAY","array",261],"(",")",";",["T_WHITESPACE","\n        ",261],["T_VARIABLE","$itemInfoObjects",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_STRING","func_get_args",262],"(",")",";",["T_WHITESPACE","\n\n        ",262],["T_VARIABLE","$billingAmount",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_LNUMBER","0",264],";",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$shippingAmount",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_LNUMBER","0",265],";",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$taxAmount",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_LNUMBER","0",266],";",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$isVirtual",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_LNUMBER","1",267],";",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$weight",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_LNUMBER","0",268],";",["T_WHITESPACE","\n        ",268],["T_FOREACH","foreach",269],["T_WHITESPACE"," ",269],"(",["T_VARIABLE","$itemInfoObjects",269],["T_WHITESPACE"," ",269],["T_AS","as",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$itemInfo",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$item",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_getItem",270],"(",["T_VARIABLE","$itemInfo",270],")",";",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$billingAmount",271],["T_WHITESPACE"," ",271],["T_PLUS_EQUAL","+=",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$item",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getPrice",271],"(",")",";",["T_WHITESPACE","\n            ",271],["T_VARIABLE","$shippingAmount",272],["T_WHITESPACE"," ",272],["T_PLUS_EQUAL","+=",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$item",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getShippingAmount",272],"(",")",";",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$taxAmount",273],["T_WHITESPACE"," ",273],["T_PLUS_EQUAL","+=",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$item",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getTaxAmount",273],"(",")",";",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$weight",274],["T_WHITESPACE"," ",274],["T_PLUS_EQUAL","+=",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$item",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getWeight",274],"(",")",";",["T_WHITESPACE","\n            ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(","!",["T_VARIABLE","$item",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getIsVirtual",275],"(",")",")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n                ",275],["T_VARIABLE","$isVirtual",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_LNUMBER","0",276],";",["T_WHITESPACE","\n            ",276],"}",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$items",278],"[","]",["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$item",278],";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$grandTotal",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$billingAmount",280],["T_WHITESPACE"," ",280],"+",["T_WHITESPACE"," ",280],["T_VARIABLE","$shippingAmount",280],["T_WHITESPACE"," ",280],"+",["T_WHITESPACE"," ",280],["T_VARIABLE","$taxAmount",280],";",["T_WHITESPACE","\n\n        ",280],["T_VARIABLE","$order",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_STRING","Mage",282],["T_DOUBLE_COLON","::",282],["T_STRING","getModel",282],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",282],")",";",["T_WHITESPACE","\n\n        ",282],["T_VARIABLE","$billingAddress",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_STRING","Mage",284],["T_DOUBLE_COLON","::",284],["T_STRING","getModel",284],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_address'",284],")",["T_WHITESPACE","\n            ",284],["T_OBJECT_OPERATOR","->",285],["T_STRING","setData",285],"(",["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getBillingAddressInfo",285],"(",")",")",["T_WHITESPACE","\n            ",285],["T_OBJECT_OPERATOR","->",286],["T_STRING","setId",286],"(",["T_STRING","null",286],")",";",["T_WHITESPACE","\n\n        ",286],["T_VARIABLE","$shippingInfo",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getShippingAddressInfo",288],"(",")",";",["T_WHITESPACE","\n        ",288],["T_VARIABLE","$shippingAddress",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","getModel",289],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_address'",289],")",["T_WHITESPACE","\n            ",289],["T_OBJECT_OPERATOR","->",290],["T_STRING","setData",290],"(",["T_VARIABLE","$shippingInfo",290],")",["T_WHITESPACE","\n            ",290],["T_OBJECT_OPERATOR","->",291],["T_STRING","setId",291],"(",["T_STRING","null",291],")",";",["T_WHITESPACE","\n\n        ",291],["T_VARIABLE","$payment",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_STRING","Mage",293],["T_DOUBLE_COLON","::",293],["T_STRING","getModel",293],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_payment'",293],")",["T_WHITESPACE","\n            ",293],["T_OBJECT_OPERATOR","->",294],["T_STRING","setMethod",294],"(",["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getMethodCode",294],"(",")",")",";",["T_WHITESPACE","\n\n        ",294],["T_VARIABLE","$transferDataKays",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_ARRAY","array",296],"(",["T_WHITESPACE","\n            ",296],["T_CONSTANT_ENCAPSED_STRING","'store_id'",297],",",["T_WHITESPACE","             ",297],["T_CONSTANT_ENCAPSED_STRING","'store_name'",297],",",["T_WHITESPACE","           ",297],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",297],",",["T_WHITESPACE","          ",297],["T_CONSTANT_ENCAPSED_STRING","'customer_email'",297],",",["T_WHITESPACE","\n            ",297],["T_CONSTANT_ENCAPSED_STRING","'customer_firstname'",298],",",["T_WHITESPACE","   ",298],["T_CONSTANT_ENCAPSED_STRING","'customer_lastname'",298],",",["T_WHITESPACE","    ",298],["T_CONSTANT_ENCAPSED_STRING","'customer_middlename'",298],",",["T_WHITESPACE","  ",298],["T_CONSTANT_ENCAPSED_STRING","'customer_prefix'",298],",",["T_WHITESPACE","\n            ",298],["T_CONSTANT_ENCAPSED_STRING","'customer_suffix'",299],",",["T_WHITESPACE","      ",299],["T_CONSTANT_ENCAPSED_STRING","'customer_taxvat'",299],",",["T_WHITESPACE","      ",299],["T_CONSTANT_ENCAPSED_STRING","'customer_gender'",299],",",["T_WHITESPACE","      ",299],["T_CONSTANT_ENCAPSED_STRING","'customer_is_guest'",299],",",["T_WHITESPACE","\n            ",299],["T_CONSTANT_ENCAPSED_STRING","'customer_note_notify'",300],",",["T_WHITESPACE"," ",300],["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",300],",",["T_WHITESPACE","    ",300],["T_CONSTANT_ENCAPSED_STRING","'customer_note'",300],",",["T_WHITESPACE","        ",300],["T_CONSTANT_ENCAPSED_STRING","'shipping_method'",300],",",["T_WHITESPACE","\n            ",300],["T_CONSTANT_ENCAPSED_STRING","'shipping_description'",301],",",["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","'base_currency_code'",301],",",["T_WHITESPACE","   ",301],["T_CONSTANT_ENCAPSED_STRING","'global_currency_code'",301],",",["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","'order_currency_code'",301],",",["T_WHITESPACE","\n            ",301],["T_CONSTANT_ENCAPSED_STRING","'store_currency_code'",302],",",["T_WHITESPACE","  ",302],["T_CONSTANT_ENCAPSED_STRING","'base_to_global_rate'",302],",",["T_WHITESPACE","  ",302],["T_CONSTANT_ENCAPSED_STRING","'base_to_order_rate'",302],",",["T_WHITESPACE","   ",302],["T_CONSTANT_ENCAPSED_STRING","'store_to_base_rate'",302],",",["T_WHITESPACE","\n            ",302],["T_CONSTANT_ENCAPSED_STRING","'store_to_order_rate'",303],["T_WHITESPACE","\n        ",303],")",";",["T_WHITESPACE","\n\n        ",304],["T_VARIABLE","$orderInfo",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getOrderInfo",306],"(",")",";",["T_WHITESPACE","\n        ",306],["T_FOREACH","foreach",307],["T_WHITESPACE"," ",307],"(",["T_VARIABLE","$transferDataKays",307],["T_WHITESPACE"," ",307],["T_AS","as",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$key",307],")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n            ",307],["T_IF","if",308],["T_WHITESPACE"," ",308],"(",["T_ISSET","isset",308],"(",["T_VARIABLE","$orderInfo",308],"[",["T_VARIABLE","$key",308],"]",")",")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n                ",308],["T_VARIABLE","$order",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","setData",309],"(",["T_VARIABLE","$key",309],",",["T_WHITESPACE"," ",309],["T_VARIABLE","$orderInfo",309],"[",["T_VARIABLE","$key",309],"]",")",";",["T_WHITESPACE","\n            ",309],"}",["T_WHITESPACE"," ",310],["T_ELSEIF","elseif",310],["T_WHITESPACE"," ",310],"(",["T_ISSET","isset",310],"(",["T_VARIABLE","$shippingInfo",310],"[",["T_VARIABLE","$key",310],"]",")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$order",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","setData",311],"(",["T_VARIABLE","$key",311],",",["T_WHITESPACE"," ",311],["T_VARIABLE","$shippingInfo",311],"[",["T_VARIABLE","$key",311],"]",")",";",["T_WHITESPACE","\n            ",311],"}",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n\n        ",313],["T_VARIABLE","$order",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","setStoreId",315],"(",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getStoreId",315],"(",")",")",["T_WHITESPACE","\n            ",315],["T_OBJECT_OPERATOR","->",316],["T_STRING","setState",316],"(",["T_STRING","Mage_Sales_Model_Order",316],["T_DOUBLE_COLON","::",316],["T_STRING","STATE_NEW",316],")",["T_WHITESPACE","\n            ",316],["T_OBJECT_OPERATOR","->",317],["T_STRING","setBaseToOrderRate",317],"(",["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getInfoValue",317],"(",["T_CONSTANT_ENCAPSED_STRING","'order_info'",317],",",["T_WHITESPACE"," ",317],["T_CONSTANT_ENCAPSED_STRING","'base_to_quote_rate'",317],")",")",["T_WHITESPACE","\n            ",317],["T_OBJECT_OPERATOR","->",318],["T_STRING","setStoreToOrderRate",318],"(",["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getInfoValue",318],"(",["T_CONSTANT_ENCAPSED_STRING","'order_info'",318],",",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'store_to_quote_rate'",318],")",")",["T_WHITESPACE","\n            ",318],["T_OBJECT_OPERATOR","->",319],["T_STRING","setOrderCurrencyCode",319],"(",["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","getInfoValue",319],"(",["T_CONSTANT_ENCAPSED_STRING","'order_info'",319],",",["T_WHITESPACE"," ",319],["T_CONSTANT_ENCAPSED_STRING","'quote_currency_code'",319],")",")",["T_WHITESPACE","\n            ",319],["T_OBJECT_OPERATOR","->",320],["T_STRING","setBaseSubtotal",320],"(",["T_VARIABLE","$billingAmount",320],")",["T_WHITESPACE","\n            ",320],["T_OBJECT_OPERATOR","->",321],["T_STRING","setSubtotal",321],"(",["T_VARIABLE","$billingAmount",321],")",["T_WHITESPACE","\n            ",321],["T_OBJECT_OPERATOR","->",322],["T_STRING","setBaseShippingAmount",322],"(",["T_VARIABLE","$shippingAmount",322],")",["T_WHITESPACE","\n            ",322],["T_OBJECT_OPERATOR","->",323],["T_STRING","setShippingAmount",323],"(",["T_VARIABLE","$shippingAmount",323],")",["T_WHITESPACE","\n            ",323],["T_OBJECT_OPERATOR","->",324],["T_STRING","setBaseTaxAmount",324],"(",["T_VARIABLE","$taxAmount",324],")",["T_WHITESPACE","\n            ",324],["T_OBJECT_OPERATOR","->",325],["T_STRING","setTaxAmount",325],"(",["T_VARIABLE","$taxAmount",325],")",["T_WHITESPACE","\n            ",325],["T_OBJECT_OPERATOR","->",326],["T_STRING","setBaseGrandTotal",326],"(",["T_VARIABLE","$grandTotal",326],")",["T_WHITESPACE","\n            ",326],["T_OBJECT_OPERATOR","->",327],["T_STRING","setGrandTotal",327],"(",["T_VARIABLE","$grandTotal",327],")",["T_WHITESPACE","\n            ",327],["T_OBJECT_OPERATOR","->",328],["T_STRING","setIsVirtual",328],"(",["T_VARIABLE","$isVirtual",328],")",["T_WHITESPACE","\n            ",328],["T_OBJECT_OPERATOR","->",329],["T_STRING","setWeight",329],"(",["T_VARIABLE","$weight",329],")",["T_WHITESPACE","\n            ",329],["T_OBJECT_OPERATOR","->",330],["T_STRING","setTotalQtyOrdered",330],"(",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getInfoValue",330],"(",["T_CONSTANT_ENCAPSED_STRING","'order_info'",330],",",["T_WHITESPACE"," ",330],["T_CONSTANT_ENCAPSED_STRING","'items_qty'",330],")",")",["T_WHITESPACE","\n            ",330],["T_OBJECT_OPERATOR","->",331],["T_STRING","setBillingAddress",331],"(",["T_VARIABLE","$billingAddress",331],")",["T_WHITESPACE","\n            ",331],["T_OBJECT_OPERATOR","->",332],["T_STRING","setShippingAddress",332],"(",["T_VARIABLE","$shippingAddress",332],")",["T_WHITESPACE","\n            ",332],["T_OBJECT_OPERATOR","->",333],["T_STRING","setPayment",333],"(",["T_VARIABLE","$payment",333],")",";",["T_WHITESPACE","\n\n        ",333],["T_FOREACH","foreach",335],["T_WHITESPACE"," ",335],"(",["T_VARIABLE","$items",335],["T_WHITESPACE"," ",335],["T_AS","as",335],["T_WHITESPACE"," ",335],["T_VARIABLE","$item",335],")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n            ",335],["T_VARIABLE","$order",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","addItem",336],"(",["T_VARIABLE","$item",336],")",";",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE","\n\n        ",337],["T_RETURN","return",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$order",339],";",["T_WHITESPACE","\n    ",339],"}",["T_WHITESPACE","\n\n    ",340],["T_DOC_COMMENT","\/**\n     * Validate states\n     *\n     * @return bool\n     *\/",342],["T_WHITESPACE","\n    ",346],["T_PUBLIC","public",347],["T_WHITESPACE"," ",347],["T_FUNCTION","function",347],["T_WHITESPACE"," ",347],["T_STRING","isValid",347],"(",")",["T_WHITESPACE","\n    ",347],"{",["T_WHITESPACE","\n        ",348],["T_STRING","parent",349],["T_DOUBLE_COLON","::",349],["T_STRING","isValid",349],"(",")",";",["T_WHITESPACE","\n\n        ",349],["T_COMMENT","\/\/ state\n",351],["T_WHITESPACE","        ",352],["T_IF","if",352],["T_WHITESPACE"," ",352],"(","!",["T_STRING","in_array",352],"(",["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getState",352],"(",")",",",["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getAllStates",352],"(",["T_STRING","false",352],")",",",["T_WHITESPACE"," ",352],["T_STRING","true",352],")",")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_errors",353],"[",["T_CONSTANT_ENCAPSED_STRING","'state'",353],"]","[","]",["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_STRING","Mage",353],["T_DOUBLE_COLON","::",353],["T_STRING","helper",353],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",353],")",["T_OBJECT_OPERATOR","->",353],["T_STRING","__",353],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong state: \"%s\".'",353],",",["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getState",353],"(",")",")",";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE","\n\n        ",354],["T_RETURN","return",356],["T_WHITESPACE"," ",356],["T_EMPTY","empty",356],"(",["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","_errors",356],")",";",["T_WHITESPACE","\n    ",356],"}",["T_WHITESPACE","\n\n    ",357],["T_DOC_COMMENT","\/**\n     * Import quote information to the profile\n     *\n     * @param Mage_Sales_Model_Quote_ $quote\n     * @return Mage_Sales_Model_Recurring_Profile\n     *\/",359],["T_WHITESPACE","\n    ",364],["T_PUBLIC","public",365],["T_WHITESPACE"," ",365],["T_FUNCTION","function",365],["T_WHITESPACE"," ",365],["T_STRING","importQuote",365],"(",["T_STRING","Mage_Sales_Model_Quote",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$quote",365],")",["T_WHITESPACE","\n    ",365],"{",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","setQuote",367],"(",["T_VARIABLE","$quote",367],")",";",["T_WHITESPACE","\n\n        ",367],["T_IF","if",369],["T_WHITESPACE"," ",369],"(",["T_VARIABLE","$quote",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getPayment",369],"(",")",["T_WHITESPACE"," ",369],["T_BOOLEAN_AND","&&",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$quote",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getPayment",369],"(",")",["T_OBJECT_OPERATOR","->",369],["T_STRING","getMethod",369],"(",")",")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","setMethodInstance",370],"(",["T_VARIABLE","$quote",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getPayment",370],"(",")",["T_OBJECT_OPERATOR","->",370],["T_STRING","getMethodInstance",370],"(",")",")",";",["T_WHITESPACE","\n        ",370],"}",["T_WHITESPACE","\n\n        ",371],["T_VARIABLE","$orderInfo",373],["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],["T_VARIABLE","$quote",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getData",373],"(",")",";",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_cleanupArray",374],"(",["T_VARIABLE","$orderInfo",374],")",";",["T_WHITESPACE","\n        ",374],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","setOrderInfo",375],"(",["T_VARIABLE","$orderInfo",375],")",";",["T_WHITESPACE","\n\n        ",375],["T_VARIABLE","$addressInfo",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_VARIABLE","$quote",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getBillingAddress",377],"(",")",["T_OBJECT_OPERATOR","->",377],["T_STRING","getData",377],"(",")",";",["T_WHITESPACE","\n        ",377],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_cleanupArray",378],"(",["T_VARIABLE","$addressInfo",378],")",";",["T_WHITESPACE","\n        ",378],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","setBillingAddressInfo",379],"(",["T_VARIABLE","$addressInfo",379],")",";",["T_WHITESPACE","\n        ",379],["T_IF","if",380],["T_WHITESPACE"," ",380],"(","!",["T_VARIABLE","$quote",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","isVirtual",380],"(",")",")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n            ",380],["T_VARIABLE","$addressInfo",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_VARIABLE","$quote",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getShippingAddress",381],"(",")",["T_OBJECT_OPERATOR","->",381],["T_STRING","getData",381],"(",")",";",["T_WHITESPACE","\n            ",381],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_cleanupArray",382],"(",["T_VARIABLE","$addressInfo",382],")",";",["T_WHITESPACE","\n            ",382],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","setShippingAddressInfo",383],"(",["T_VARIABLE","$addressInfo",383],")",";",["T_WHITESPACE","\n        ",383],"}",["T_WHITESPACE","\n\n        ",384],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","setCurrencyCode",386],"(",["T_VARIABLE","$quote",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getBaseCurrencyCode",386],"(",")",")",";",["T_WHITESPACE","\n        ",386],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","setCustomerId",387],"(",["T_VARIABLE","$quote",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getCustomerId",387],"(",")",")",";",["T_WHITESPACE","\n        ",387],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","setStoreId",388],"(",["T_VARIABLE","$quote",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","getStoreId",388],"(",")",")",";",["T_WHITESPACE","\n\n        ",388],["T_RETURN","return",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$this",390],";",["T_WHITESPACE","\n    ",390],"}",["T_WHITESPACE","\n\n    ",391],["T_DOC_COMMENT","\/**\n     * Import quote item information to the profile\n     *\n     * @param Mage_Sales_Model_Quote_Item_Abstract $item\n     * @return Mage_Sales_Model_Recurring_Profile\n     *\/",393],["T_WHITESPACE","\n    ",398],["T_PUBLIC","public",399],["T_WHITESPACE"," ",399],["T_FUNCTION","function",399],["T_WHITESPACE"," ",399],["T_STRING","importQuoteItem",399],"(",["T_STRING","Mage_Sales_Model_Quote_Item_Abstract",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$item",399],")",["T_WHITESPACE","\n    ",399],"{",["T_WHITESPACE","\n        ",400],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","setQuoteItemInfo",401],"(",["T_VARIABLE","$item",401],")",";",["T_WHITESPACE","\n\n        ",401],["T_COMMENT","\/\/ TODO: make it abstract from amounts\n",403],["T_WHITESPACE","        ",404],["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","setBillingAmount",404],"(",["T_VARIABLE","$item",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","getBaseRowTotal",404],"(",")",")",["T_WHITESPACE","\n            ",404],["T_OBJECT_OPERATOR","->",405],["T_STRING","setTaxAmount",405],"(",["T_VARIABLE","$item",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","getBaseTaxAmount",405],"(",")",")",["T_WHITESPACE","\n            ",405],["T_OBJECT_OPERATOR","->",406],["T_STRING","setShippingAmount",406],"(",["T_VARIABLE","$item",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","getBaseShippingAmount",406],"(",")",")",["T_WHITESPACE","\n        ",406],";",["T_WHITESPACE","\n        ",407],["T_IF","if",408],["T_WHITESPACE"," ",408],"(","!",["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getScheduleDescription",408],"(",")",")",["T_WHITESPACE"," ",408],"{",["T_WHITESPACE","\n            ",408],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","setScheduleDescription",409],"(",["T_VARIABLE","$item",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getName",409],"(",")",")",";",["T_WHITESPACE","\n        ",409],"}",["T_WHITESPACE","\n\n        ",410],["T_VARIABLE","$orderItemInfo",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_VARIABLE","$item",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","getData",412],"(",")",";",["T_WHITESPACE","\n        ",412],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","_cleanupArray",413],"(",["T_VARIABLE","$orderItemInfo",413],")",";",["T_WHITESPACE","\n\n        ",413],["T_VARIABLE","$customOptions",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_VARIABLE","$item",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getOptionsByCode",415],"(",")",";",["T_WHITESPACE","\n        ",415],["T_IF","if",416],["T_WHITESPACE"," ",416],"(",["T_VARIABLE","$customOptions",416],"[",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",416],"]",")",["T_WHITESPACE"," ",416],"{",["T_WHITESPACE","\n            ",416],["T_VARIABLE","$orderItemInfo",417],"[",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",417],"]",["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$customOptions",417],"[",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",417],"]",["T_OBJECT_OPERATOR","->",417],["T_STRING","getValue",417],"(",")",";",["T_WHITESPACE","\n        ",417],"}",["T_WHITESPACE","\n\n        ",418],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","setOrderItemInfo",420],"(",["T_VARIABLE","$orderItemInfo",420],")",";",["T_WHITESPACE","\n\n        ",420],["T_RETURN","return",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_filterValues",422],"(",")",";",["T_WHITESPACE","\n    ",422],"}",["T_WHITESPACE","\n\n    ",423],["T_DOC_COMMENT","\/**\n     * Getter for sales-related field labels\n     *\n     * @param string $field\n     * @return string|null\n     *\/",425],["T_WHITESPACE","\n    ",430],["T_PUBLIC","public",431],["T_WHITESPACE"," ",431],["T_FUNCTION","function",431],["T_WHITESPACE"," ",431],["T_STRING","getFieldLabel",431],"(",["T_VARIABLE","$field",431],")",["T_WHITESPACE","\n    ",431],"{",["T_WHITESPACE","\n        ",432],["T_SWITCH","switch",433],["T_WHITESPACE"," ",433],"(",["T_VARIABLE","$field",433],")",["T_WHITESPACE"," ",433],"{",["T_WHITESPACE","\n            ",433],["T_CASE","case",434],["T_WHITESPACE"," ",434],["T_CONSTANT_ENCAPSED_STRING","'order_item_id'",434],":",["T_WHITESPACE","\n                ",434],["T_RETURN","return",435],["T_WHITESPACE"," ",435],["T_STRING","Mage",435],["T_DOUBLE_COLON","::",435],["T_STRING","helper",435],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",435],")",["T_OBJECT_OPERATOR","->",435],["T_STRING","__",435],"(",["T_CONSTANT_ENCAPSED_STRING","'Purchased Item'",435],")",";",["T_WHITESPACE","\n            ",435],["T_CASE","case",436],["T_WHITESPACE"," ",436],["T_CONSTANT_ENCAPSED_STRING","'state'",436],":",["T_WHITESPACE","\n                ",436],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_STRING","Mage",437],["T_DOUBLE_COLON","::",437],["T_STRING","helper",437],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",437],")",["T_OBJECT_OPERATOR","->",437],["T_STRING","__",437],"(",["T_CONSTANT_ENCAPSED_STRING","'Profile State'",437],")",";",["T_WHITESPACE","\n            ",437],["T_CASE","case",438],["T_WHITESPACE"," ",438],["T_CONSTANT_ENCAPSED_STRING","'created_at'",438],":",["T_WHITESPACE","\n                ",438],["T_RETURN","return",439],["T_WHITESPACE"," ",439],["T_STRING","Mage",439],["T_DOUBLE_COLON","::",439],["T_STRING","helper",439],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",439],")",["T_OBJECT_OPERATOR","->",439],["T_STRING","__",439],"(",["T_CONSTANT_ENCAPSED_STRING","'Created At'",439],")",";",["T_WHITESPACE","\n            ",439],["T_CASE","case",440],["T_WHITESPACE"," ",440],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",440],":",["T_WHITESPACE","\n                ",440],["T_RETURN","return",441],["T_WHITESPACE"," ",441],["T_STRING","Mage",441],["T_DOUBLE_COLON","::",441],["T_STRING","helper",441],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",441],")",["T_OBJECT_OPERATOR","->",441],["T_STRING","__",441],"(",["T_CONSTANT_ENCAPSED_STRING","'Updated At'",441],")",";",["T_WHITESPACE","\n            ",441],["T_DEFAULT","default",442],":",["T_WHITESPACE","\n                ",442],["T_RETURN","return",443],["T_WHITESPACE"," ",443],["T_STRING","parent",443],["T_DOUBLE_COLON","::",443],["T_STRING","getFieldLabel",443],"(",["T_VARIABLE","$field",443],")",";",["T_WHITESPACE","\n        ",443],"}",["T_WHITESPACE","\n    ",444],"}",["T_WHITESPACE","\n\n    ",445],["T_DOC_COMMENT","\/**\n     * Getter for sales-related field comments\n     *\n     * @param string $field\n     * @return string|null\n     *\/",447],["T_WHITESPACE","\n    ",452],["T_PUBLIC","public",453],["T_WHITESPACE"," ",453],["T_FUNCTION","function",453],["T_WHITESPACE"," ",453],["T_STRING","getFieldComment",453],"(",["T_VARIABLE","$field",453],")",["T_WHITESPACE","\n    ",453],"{",["T_WHITESPACE","\n        ",454],["T_SWITCH","switch",455],["T_WHITESPACE"," ",455],"(",["T_VARIABLE","$field",455],")",["T_WHITESPACE"," ",455],"{",["T_WHITESPACE","\n            ",455],["T_CASE","case",456],["T_WHITESPACE"," ",456],["T_CONSTANT_ENCAPSED_STRING","'order_item_id'",456],":",["T_WHITESPACE","\n                ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_STRING","Mage",457],["T_DOUBLE_COLON","::",457],["T_STRING","helper",457],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",457],")",["T_OBJECT_OPERATOR","->",457],["T_STRING","__",457],"(",["T_CONSTANT_ENCAPSED_STRING","'Original order item that recurring payment profile correspondss to.'",457],")",";",["T_WHITESPACE","\n            ",457],["T_DEFAULT","default",458],":",["T_WHITESPACE","\n                ",458],["T_RETURN","return",459],["T_WHITESPACE"," ",459],["T_STRING","parent",459],["T_DOUBLE_COLON","::",459],["T_STRING","getFieldComment",459],"(",["T_VARIABLE","$field",459],")",";",["T_WHITESPACE","\n        ",459],"}",["T_WHITESPACE","\n    ",460],"}",["T_WHITESPACE","\n\n    ",461],["T_DOC_COMMENT","\/**\n     * Getter for all available states\n     *\n     * @param bool $withLabels\n     * @return array\n     *\/",463],["T_WHITESPACE","\n    ",468],["T_PUBLIC","public",469],["T_WHITESPACE"," ",469],["T_FUNCTION","function",469],["T_WHITESPACE"," ",469],["T_STRING","getAllStates",469],"(",["T_VARIABLE","$withLabels",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_STRING","true",469],")",["T_WHITESPACE","\n    ",469],"{",["T_WHITESPACE","\n        ",470],["T_VARIABLE","$states",471],["T_WHITESPACE"," ",471],"=",["T_WHITESPACE"," ",471],["T_ARRAY","array",471],"(",["T_STRING","self",471],["T_DOUBLE_COLON","::",471],["T_STRING","STATE_UNKNOWN",471],",",["T_WHITESPACE"," ",471],["T_STRING","self",471],["T_DOUBLE_COLON","::",471],["T_STRING","STATE_PENDING",471],",",["T_WHITESPACE"," ",471],["T_STRING","self",471],["T_DOUBLE_COLON","::",471],["T_STRING","STATE_ACTIVE",471],",",["T_WHITESPACE","\n            ",471],["T_STRING","self",472],["T_DOUBLE_COLON","::",472],["T_STRING","STATE_SUSPENDED",472],",",["T_WHITESPACE"," ",472],["T_STRING","self",472],["T_DOUBLE_COLON","::",472],["T_STRING","STATE_CANCELED",472],",",["T_WHITESPACE"," ",472],["T_STRING","self",472],["T_DOUBLE_COLON","::",472],["T_STRING","STATE_EXPIRED",472],",",["T_WHITESPACE","\n        ",472],")",";",["T_WHITESPACE","\n        ",473],["T_IF","if",474],["T_WHITESPACE"," ",474],"(",["T_VARIABLE","$withLabels",474],")",["T_WHITESPACE"," ",474],"{",["T_WHITESPACE","\n            ",474],["T_VARIABLE","$result",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_ARRAY","array",475],"(",")",";",["T_WHITESPACE","\n            ",475],["T_FOREACH","foreach",476],["T_WHITESPACE"," ",476],"(",["T_VARIABLE","$states",476],["T_WHITESPACE"," ",476],["T_AS","as",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$state",476],")",["T_WHITESPACE"," ",476],"{",["T_WHITESPACE","\n                ",476],["T_VARIABLE","$result",477],"[",["T_VARIABLE","$state",477],"]",["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getStateLabel",477],"(",["T_VARIABLE","$state",477],")",";",["T_WHITESPACE","\n            ",477],"}",["T_WHITESPACE","\n            ",478],["T_RETURN","return",479],["T_WHITESPACE"," ",479],["T_VARIABLE","$result",479],";",["T_WHITESPACE","\n        ",479],"}",["T_WHITESPACE","\n        ",480],["T_RETURN","return",481],["T_WHITESPACE"," ",481],["T_VARIABLE","$states",481],";",["T_WHITESPACE","\n    ",481],"}",["T_WHITESPACE","\n\n    ",482],["T_DOC_COMMENT","\/**\n     * Get state label based on the code\n     *\n     * @param string $state\n     * @return string\n     *\/",484],["T_WHITESPACE","\n    ",489],["T_PUBLIC","public",490],["T_WHITESPACE"," ",490],["T_FUNCTION","function",490],["T_WHITESPACE"," ",490],["T_STRING","getStateLabel",490],"(",["T_VARIABLE","$state",490],")",["T_WHITESPACE","\n    ",490],"{",["T_WHITESPACE","\n        ",491],["T_SWITCH","switch",492],["T_WHITESPACE"," ",492],"(",["T_VARIABLE","$state",492],")",["T_WHITESPACE"," ",492],"{",["T_WHITESPACE","\n            ",492],["T_CASE","case",493],["T_WHITESPACE"," ",493],["T_STRING","self",493],["T_DOUBLE_COLON","::",493],["T_STRING","STATE_UNKNOWN",493],":",["T_WHITESPACE","   ",493],["T_RETURN","return",493],["T_WHITESPACE"," ",493],["T_STRING","Mage",493],["T_DOUBLE_COLON","::",493],["T_STRING","helper",493],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",493],")",["T_OBJECT_OPERATOR","->",493],["T_STRING","__",493],"(",["T_CONSTANT_ENCAPSED_STRING","'Not Initialized'",493],")",";",["T_WHITESPACE","\n            ",493],["T_CASE","case",494],["T_WHITESPACE"," ",494],["T_STRING","self",494],["T_DOUBLE_COLON","::",494],["T_STRING","STATE_PENDING",494],":",["T_WHITESPACE","   ",494],["T_RETURN","return",494],["T_WHITESPACE"," ",494],["T_STRING","Mage",494],["T_DOUBLE_COLON","::",494],["T_STRING","helper",494],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",494],")",["T_OBJECT_OPERATOR","->",494],["T_STRING","__",494],"(",["T_CONSTANT_ENCAPSED_STRING","'Pending'",494],")",";",["T_WHITESPACE","\n            ",494],["T_CASE","case",495],["T_WHITESPACE"," ",495],["T_STRING","self",495],["T_DOUBLE_COLON","::",495],["T_STRING","STATE_ACTIVE",495],":",["T_WHITESPACE","    ",495],["T_RETURN","return",495],["T_WHITESPACE"," ",495],["T_STRING","Mage",495],["T_DOUBLE_COLON","::",495],["T_STRING","helper",495],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",495],")",["T_OBJECT_OPERATOR","->",495],["T_STRING","__",495],"(",["T_CONSTANT_ENCAPSED_STRING","'Active'",495],")",";",["T_WHITESPACE","\n            ",495],["T_CASE","case",496],["T_WHITESPACE"," ",496],["T_STRING","self",496],["T_DOUBLE_COLON","::",496],["T_STRING","STATE_SUSPENDED",496],":",["T_WHITESPACE"," ",496],["T_RETURN","return",496],["T_WHITESPACE"," ",496],["T_STRING","Mage",496],["T_DOUBLE_COLON","::",496],["T_STRING","helper",496],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",496],")",["T_OBJECT_OPERATOR","->",496],["T_STRING","__",496],"(",["T_CONSTANT_ENCAPSED_STRING","'Suspended'",496],")",";",["T_WHITESPACE","\n            ",496],["T_CASE","case",497],["T_WHITESPACE"," ",497],["T_STRING","self",497],["T_DOUBLE_COLON","::",497],["T_STRING","STATE_CANCELED",497],":",["T_WHITESPACE","  ",497],["T_RETURN","return",497],["T_WHITESPACE"," ",497],["T_STRING","Mage",497],["T_DOUBLE_COLON","::",497],["T_STRING","helper",497],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",497],")",["T_OBJECT_OPERATOR","->",497],["T_STRING","__",497],"(",["T_CONSTANT_ENCAPSED_STRING","'Canceled'",497],")",";",["T_WHITESPACE","\n            ",497],["T_CASE","case",498],["T_WHITESPACE"," ",498],["T_STRING","self",498],["T_DOUBLE_COLON","::",498],["T_STRING","STATE_EXPIRED",498],":",["T_WHITESPACE","   ",498],["T_RETURN","return",498],["T_WHITESPACE"," ",498],["T_STRING","Mage",498],["T_DOUBLE_COLON","::",498],["T_STRING","helper",498],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",498],")",["T_OBJECT_OPERATOR","->",498],["T_STRING","__",498],"(",["T_CONSTANT_ENCAPSED_STRING","'Expired'",498],")",";",["T_WHITESPACE","\n            ",498],["T_DEFAULT","default",499],":",["T_WHITESPACE"," ",499],["T_RETURN","return",499],["T_WHITESPACE"," ",499],["T_VARIABLE","$state",499],";",["T_WHITESPACE","\n        ",499],"}",["T_WHITESPACE","\n    ",500],"}",["T_WHITESPACE","\n\n    ",501],["T_DOC_COMMENT","\/**\n     * Render state as label\n     *\n     * @param string $key\n     * @return mixed\n     *\/",503],["T_WHITESPACE","\n    ",508],["T_PUBLIC","public",509],["T_WHITESPACE"," ",509],["T_FUNCTION","function",509],["T_WHITESPACE"," ",509],["T_STRING","renderData",509],"(",["T_VARIABLE","$key",509],")",["T_WHITESPACE","\n    ",509],"{",["T_WHITESPACE","\n        ",510],["T_VARIABLE","$value",511],["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","_getData",511],"(",["T_VARIABLE","$key",511],")",";",["T_WHITESPACE","\n        ",511],["T_SWITCH","switch",512],["T_WHITESPACE"," ",512],"(",["T_VARIABLE","$key",512],")",["T_WHITESPACE"," ",512],"{",["T_WHITESPACE","\n            ",512],["T_CASE","case",513],["T_WHITESPACE"," ",513],["T_CONSTANT_ENCAPSED_STRING","'state'",513],":",["T_WHITESPACE","\n                ",513],["T_RETURN","return",514],["T_WHITESPACE"," ",514],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","getStateLabel",514],"(",["T_VARIABLE","$value",514],")",";",["T_WHITESPACE","\n        ",514],"}",["T_WHITESPACE","\n        ",515],["T_RETURN","return",516],["T_WHITESPACE"," ",516],["T_STRING","parent",516],["T_DOUBLE_COLON","::",516],["T_STRING","renderData",516],"(",["T_VARIABLE","$key",516],")",";",["T_WHITESPACE","\n    ",516],"}",["T_WHITESPACE","\n\n    ",517],["T_DOC_COMMENT","\/**\n     * Getter for additional information value\n     * It is assumed that the specified additional info is an object or associative array\n     *\n     * @param string $infoKey\n     * @param string $infoValueKey\n     * @return mixed|null\n     *\/",519],["T_WHITESPACE","\n    ",526],["T_PUBLIC","public",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","getInfoValue",527],"(",["T_VARIABLE","$infoKey",527],",",["T_WHITESPACE"," ",527],["T_VARIABLE","$infoValueKey",527],")",["T_WHITESPACE","\n    ",527],"{",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$info",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getData",529],"(",["T_VARIABLE","$infoKey",529],")",";",["T_WHITESPACE","\n        ",529],["T_IF","if",530],["T_WHITESPACE"," ",530],"(","!",["T_VARIABLE","$info",530],")",["T_WHITESPACE"," ",530],"{",["T_WHITESPACE","\n            ",530],["T_RETURN","return",531],";",["T_WHITESPACE","\n        ",531],"}",["T_WHITESPACE","\n        ",532],["T_IF","if",533],["T_WHITESPACE"," ",533],"(","!",["T_STRING","is_object",533],"(",["T_VARIABLE","$info",533],")",")",["T_WHITESPACE"," ",533],"{",["T_WHITESPACE","\n            ",533],["T_IF","if",534],["T_WHITESPACE"," ",534],"(",["T_STRING","is_array",534],"(",["T_VARIABLE","$info",534],")",["T_WHITESPACE"," ",534],["T_BOOLEAN_AND","&&",534],["T_WHITESPACE"," ",534],["T_ISSET","isset",534],"(",["T_VARIABLE","$info",534],"[",["T_VARIABLE","$infoValueKey",534],"]",")",")",["T_WHITESPACE"," ",534],"{",["T_WHITESPACE","\n                ",534],["T_RETURN","return",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$info",535],"[",["T_VARIABLE","$infoValueKey",535],"]",";",["T_WHITESPACE","\n            ",535],"}",["T_WHITESPACE","\n        ",536],"}",["T_WHITESPACE"," ",537],["T_ELSE","else",537],["T_WHITESPACE"," ",537],"{",["T_WHITESPACE","\n            ",537],["T_IF","if",538],["T_WHITESPACE"," ",538],"(",["T_VARIABLE","$info",538],["T_WHITESPACE"," ",538],["T_INSTANCEOF","instanceof",538],["T_WHITESPACE"," ",538],["T_STRING","Varien_Object",538],")",["T_WHITESPACE"," ",538],"{",["T_WHITESPACE","\n                ",538],["T_RETURN","return",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$info",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","getDataUsingMethod",539],"(",["T_VARIABLE","$infoValueKey",539],")",";",["T_WHITESPACE","\n            ",539],"}",["T_WHITESPACE"," ",540],["T_ELSEIF","elseif",540],["T_WHITESPACE"," ",540],"(",["T_ISSET","isset",540],"(",["T_VARIABLE","$info",540],["T_OBJECT_OPERATOR","->",540],["T_VARIABLE","$infoValueKey",540],")",")",["T_WHITESPACE"," ",540],"{",["T_WHITESPACE","\n                ",540],["T_RETURN","return",541],["T_WHITESPACE"," ",541],["T_VARIABLE","$info",541],["T_OBJECT_OPERATOR","->",541],["T_VARIABLE","$infoValueKey",541],";",["T_WHITESPACE","\n            ",541],"}",["T_WHITESPACE","\n        ",542],"}",["T_WHITESPACE","\n    ",543],"}",["T_WHITESPACE","\n\n    ",544],["T_DOC_COMMENT","\/**\n     * Initialize resource model\n     *\/",546],["T_WHITESPACE","\n    ",548],["T_PROTECTED","protected",549],["T_WHITESPACE"," ",549],["T_FUNCTION","function",549],["T_WHITESPACE"," ",549],["T_STRING","_construct",549],"(",")",["T_WHITESPACE","\n    ",549],"{",["T_WHITESPACE","\n        ",550],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_init",551],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/recurring_profile'",551],")",";",["T_WHITESPACE","\n    ",551],"}",["T_WHITESPACE","\n\n    ",552],["T_DOC_COMMENT","\/**\n     * Automatically set \"unknown\" state if not defined\n     *\n     * @return Mage_Payment_Model_Recurring_Profile\n     *\/",554],["T_WHITESPACE","\n    ",558],["T_PROTECTED","protected",559],["T_WHITESPACE"," ",559],["T_FUNCTION","function",559],["T_WHITESPACE"," ",559],["T_STRING","_filterValues",559],"(",")",["T_WHITESPACE","\n    ",559],"{",["T_WHITESPACE","\n        ",560],["T_VARIABLE","$result",561],["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_STRING","parent",561],["T_DOUBLE_COLON","::",561],["T_STRING","_filterValues",561],"(",")",";",["T_WHITESPACE","\n\n        ",561],["T_IF","if",563],["T_WHITESPACE"," ",563],"(","!",["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","getState",563],"(",")",")",["T_WHITESPACE"," ",563],"{",["T_WHITESPACE","\n            ",563],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","setState",564],"(",["T_STRING","self",564],["T_DOUBLE_COLON","::",564],["T_STRING","STATE_UNKNOWN",564],")",";",["T_WHITESPACE","\n        ",564],"}",["T_WHITESPACE","\n\n        ",565],["T_RETURN","return",567],["T_WHITESPACE"," ",567],["T_VARIABLE","$result",567],";",["T_WHITESPACE","\n    ",567],"}",["T_WHITESPACE","\n\n    ",568],["T_DOC_COMMENT","\/**\n     * Initialize the workflow reference\n     *\/",570],["T_WHITESPACE","\n    ",572],["T_PROTECTED","protected",573],["T_WHITESPACE"," ",573],["T_FUNCTION","function",573],["T_WHITESPACE"," ",573],["T_STRING","_initWorkflow",573],"(",")",["T_WHITESPACE","\n    ",573],"{",["T_WHITESPACE","\n        ",574],["T_IF","if",575],["T_WHITESPACE"," ",575],"(",["T_STRING","null",575],["T_WHITESPACE"," ",575],["T_IS_IDENTICAL","===",575],["T_WHITESPACE"," ",575],["T_VARIABLE","$this",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","_workflow",575],")",["T_WHITESPACE"," ",575],"{",["T_WHITESPACE","\n            ",575],["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","_workflow",576],["T_WHITESPACE"," ",576],"=",["T_WHITESPACE"," ",576],["T_ARRAY","array",576],"(",["T_WHITESPACE","\n                ",576],["T_CONSTANT_ENCAPSED_STRING","'unknown'",577],["T_WHITESPACE","   ",577],["T_DOUBLE_ARROW","=>",577],["T_WHITESPACE"," ",577],["T_ARRAY","array",577],"(",["T_CONSTANT_ENCAPSED_STRING","'pending'",577],",",["T_WHITESPACE"," ",577],["T_CONSTANT_ENCAPSED_STRING","'active'",577],",",["T_WHITESPACE"," ",577],["T_CONSTANT_ENCAPSED_STRING","'suspended'",577],",",["T_WHITESPACE"," ",577],["T_CONSTANT_ENCAPSED_STRING","'canceled'",577],")",",",["T_WHITESPACE","\n                ",577],["T_CONSTANT_ENCAPSED_STRING","'pending'",578],["T_WHITESPACE","   ",578],["T_DOUBLE_ARROW","=>",578],["T_WHITESPACE"," ",578],["T_ARRAY","array",578],"(",["T_CONSTANT_ENCAPSED_STRING","'active'",578],",",["T_WHITESPACE"," ",578],["T_CONSTANT_ENCAPSED_STRING","'canceled'",578],")",",",["T_WHITESPACE","\n                ",578],["T_CONSTANT_ENCAPSED_STRING","'active'",579],["T_WHITESPACE","    ",579],["T_DOUBLE_ARROW","=>",579],["T_WHITESPACE"," ",579],["T_ARRAY","array",579],"(",["T_CONSTANT_ENCAPSED_STRING","'suspended'",579],",",["T_WHITESPACE"," ",579],["T_CONSTANT_ENCAPSED_STRING","'canceled'",579],")",",",["T_WHITESPACE","\n                ",579],["T_CONSTANT_ENCAPSED_STRING","'suspended'",580],["T_WHITESPACE"," ",580],["T_DOUBLE_ARROW","=>",580],["T_WHITESPACE"," ",580],["T_ARRAY","array",580],"(",["T_CONSTANT_ENCAPSED_STRING","'active'",580],",",["T_WHITESPACE"," ",580],["T_CONSTANT_ENCAPSED_STRING","'canceled'",580],")",",",["T_WHITESPACE","\n                ",580],["T_CONSTANT_ENCAPSED_STRING","'canceled'",581],["T_WHITESPACE","  ",581],["T_DOUBLE_ARROW","=>",581],["T_WHITESPACE"," ",581],["T_ARRAY","array",581],"(",")",",",["T_WHITESPACE","\n                ",581],["T_CONSTANT_ENCAPSED_STRING","'expired'",582],["T_WHITESPACE","   ",582],["T_DOUBLE_ARROW","=>",582],["T_WHITESPACE"," ",582],["T_ARRAY","array",582],"(",")",",",["T_WHITESPACE","\n            ",582],")",";",["T_WHITESPACE","\n        ",583],"}",["T_WHITESPACE","\n    ",584],"}",["T_WHITESPACE","\n\n    ",585],["T_DOC_COMMENT","\/**\n     * Check whether profile can be changed to specified state\n     *\n     * @param string $againstState\n     * @param bool $soft\n     * @return bool\n     * @throws Mage_Core_Exception\n     *\/",587],["T_WHITESPACE","\n    ",594],["T_PROTECTED","protected",595],["T_WHITESPACE"," ",595],["T_FUNCTION","function",595],["T_WHITESPACE"," ",595],["T_STRING","_checkWorkflow",595],"(",["T_VARIABLE","$againstState",595],",",["T_WHITESPACE"," ",595],["T_VARIABLE","$soft",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],["T_STRING","true",595],")",["T_WHITESPACE","\n    ",595],"{",["T_WHITESPACE","\n        ",596],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","_initWorkflow",597],"(",")",";",["T_WHITESPACE","\n        ",597],["T_VARIABLE","$state",598],["T_WHITESPACE"," ",598],"=",["T_WHITESPACE"," ",598],["T_VARIABLE","$this",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getState",598],"(",")",";",["T_WHITESPACE","\n        ",598],["T_VARIABLE","$result",599],["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],"(","!",["T_EMPTY","empty",599],"(",["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","_workflow",599],"[",["T_VARIABLE","$state",599],"]",")",")",["T_WHITESPACE"," ",599],["T_BOOLEAN_AND","&&",599],["T_WHITESPACE"," ",599],["T_STRING","in_array",599],"(",["T_VARIABLE","$againstState",599],",",["T_WHITESPACE"," ",599],["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","_workflow",599],"[",["T_VARIABLE","$state",599],"]",")",";",["T_WHITESPACE","\n        ",599],["T_IF","if",600],["T_WHITESPACE"," ",600],"(","!",["T_VARIABLE","$soft",600],["T_WHITESPACE"," ",600],["T_BOOLEAN_AND","&&",600],["T_WHITESPACE"," ",600],"!",["T_VARIABLE","$result",600],")",["T_WHITESPACE"," ",600],"{",["T_WHITESPACE","\n            ",600],["T_STRING","Mage",601],["T_DOUBLE_COLON","::",601],["T_STRING","throwException",601],"(",["T_WHITESPACE","\n                ",601],["T_STRING","Mage",602],["T_DOUBLE_COLON","::",602],["T_STRING","helper",602],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",602],")",["T_OBJECT_OPERATOR","->",602],["T_STRING","__",602],"(",["T_CONSTANT_ENCAPSED_STRING","'This profile state cannot be changed to \"%s\".'",602],",",["T_WHITESPACE"," ",602],["T_VARIABLE","$againstState",602],")",["T_WHITESPACE","\n            ",602],")",";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE","\n        ",604],["T_RETURN","return",605],["T_WHITESPACE"," ",605],["T_VARIABLE","$result",605],";",["T_WHITESPACE","\n    ",605],"}",["T_WHITESPACE","\n\n    ",606],["T_DOC_COMMENT","\/**\n     * Return recurring profile child orders Ids\n     *\n     * @return array\n     *\/",608],["T_WHITESPACE","\n    ",612],["T_PUBLIC","public",613],["T_WHITESPACE"," ",613],["T_FUNCTION","function",613],["T_WHITESPACE"," ",613],["T_STRING","getChildOrderIds",613],"(",")",["T_WHITESPACE","\n    ",613],"{",["T_WHITESPACE","\n        ",614],["T_VARIABLE","$ids",615],["T_WHITESPACE"," ",615],"=",["T_WHITESPACE"," ",615],["T_VARIABLE","$this",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","_getResource",615],"(",")",["T_OBJECT_OPERATOR","->",615],["T_STRING","getChildOrderIds",615],"(",["T_VARIABLE","$this",615],")",";",["T_WHITESPACE","\n        ",615],["T_IF","if",616],["T_WHITESPACE"," ",616],"(",["T_EMPTY","empty",616],"(",["T_VARIABLE","$ids",616],")",")","{",["T_WHITESPACE","\n            ",616],["T_VARIABLE","$ids",617],"[","]",["T_WHITESPACE"," ",617],"=",["T_WHITESPACE"," ",617],["T_CONSTANT_ENCAPSED_STRING","'-1'",617],";",["T_WHITESPACE","\n        ",617],"}",["T_WHITESPACE","\n        ",618],["T_RETURN","return",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$ids",619],";",["T_WHITESPACE","\n    ",619],"}",["T_WHITESPACE","\n\n    ",620],["T_DOC_COMMENT","\/**\n     * Add order relation to recurring profile\n     *\n     * @param int $recurringProfileId\n     * @return Mage_Sales_Model_Recurring_Profile\n     *\/",622],["T_WHITESPACE","\n    ",627],["T_PUBLIC","public",628],["T_WHITESPACE"," ",628],["T_FUNCTION","function",628],["T_WHITESPACE"," ",628],["T_STRING","addOrderRelation",628],"(",["T_VARIABLE","$orderId",628],")",["T_WHITESPACE","\n    ",628],"{",["T_WHITESPACE","\n        ",629],["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","getResource",630],"(",")",["T_OBJECT_OPERATOR","->",630],["T_STRING","addOrderRelation",630],"(",["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","getId",630],"(",")",",",["T_WHITESPACE"," ",630],["T_VARIABLE","$orderId",630],")",";",["T_WHITESPACE","\n        ",630],["T_RETURN","return",631],["T_WHITESPACE"," ",631],["T_VARIABLE","$this",631],";",["T_WHITESPACE","\n    ",631],"}",["T_WHITESPACE","\n\n    ",632],["T_DOC_COMMENT","\/**\n     * Create and return new order item based on profile item data and $itemInfo\n     *\n     * @param Varien_Object $itemInfo\n     * @return Mage_Sales_Model_Order_Item\n     *\/",634],["T_WHITESPACE","\n    ",639],["T_PROTECTED","protected",640],["T_WHITESPACE"," ",640],["T_FUNCTION","function",640],["T_WHITESPACE"," ",640],["T_STRING","_getItem",640],"(",["T_VARIABLE","$itemInfo",640],")",["T_WHITESPACE","\n    ",640],"{",["T_WHITESPACE","\n        ",641],["T_VARIABLE","$paymentType",642],["T_WHITESPACE"," ",642],"=",["T_WHITESPACE"," ",642],["T_VARIABLE","$itemInfo",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","getPaymentType",642],"(",")",";",["T_WHITESPACE","\n        ",642],["T_IF","if",643],["T_WHITESPACE"," ",643],"(","!",["T_VARIABLE","$paymentType",643],")",["T_WHITESPACE"," ",643],"{",["T_WHITESPACE","\n            ",643],["T_THROW","throw",644],["T_WHITESPACE"," ",644],["T_NEW","new",644],["T_WHITESPACE"," ",644],["T_STRING","Exception",644],"(",["T_CONSTANT_ENCAPSED_STRING","\"Recurring profile payment type is not specified.\"",644],")",";",["T_WHITESPACE","\n        ",644],"}",["T_WHITESPACE","\n\n        ",645],["T_SWITCH","switch",647],["T_WHITESPACE"," ",647],"(",["T_VARIABLE","$paymentType",647],")",["T_WHITESPACE"," ",647],"{",["T_WHITESPACE","\n            ",647],["T_CASE","case",648],["T_WHITESPACE"," ",648],["T_STRING","self",648],["T_DOUBLE_COLON","::",648],["T_STRING","PAYMENT_TYPE_REGULAR",648],":",["T_WHITESPACE"," ",648],["T_RETURN","return",648],["T_WHITESPACE"," ",648],["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","_getRegularItem",648],"(",["T_VARIABLE","$itemInfo",648],")",";",["T_WHITESPACE","\n            ",648],["T_CASE","case",649],["T_WHITESPACE"," ",649],["T_STRING","self",649],["T_DOUBLE_COLON","::",649],["T_STRING","PAYMENT_TYPE_TRIAL",649],":",["T_WHITESPACE"," ",649],["T_RETURN","return",649],["T_WHITESPACE"," ",649],["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","_getTrialItem",649],"(",["T_VARIABLE","$itemInfo",649],")",";",["T_WHITESPACE","\n            ",649],["T_CASE","case",650],["T_WHITESPACE"," ",650],["T_STRING","self",650],["T_DOUBLE_COLON","::",650],["T_STRING","PAYMENT_TYPE_INITIAL",650],":",["T_WHITESPACE"," ",650],["T_RETURN","return",650],["T_WHITESPACE"," ",650],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","_getInitialItem",650],"(",["T_VARIABLE","$itemInfo",650],")",";",["T_WHITESPACE","\n            ",650],["T_DEFAULT","default",651],":",["T_WHITESPACE"," ",651],["T_NEW","new",651],["T_WHITESPACE"," ",651],["T_STRING","Exception",651],"(","\"",["T_ENCAPSED_AND_WHITESPACE","Invalid recurring profile payment type '",651],["T_CURLY_OPEN","{",651],["T_VARIABLE","$paymentType",651],"}",["T_ENCAPSED_AND_WHITESPACE","'.",651],"\"",")",";",["T_WHITESPACE","\n        ",651],"}",["T_WHITESPACE","\n    ",652],"}",["T_WHITESPACE","\n\n    ",653],["T_DOC_COMMENT","\/**\n     * Create and return new order item based on profile item data and $itemInfo\n     * for regular payment\n     *\n     * @param Varien_Object $itemInfo\n     * @return Mage_Sales_Model_Order_Item\n     *\/",655],["T_WHITESPACE","\n    ",661],["T_PROTECTED","protected",662],["T_WHITESPACE"," ",662],["T_FUNCTION","function",662],["T_WHITESPACE"," ",662],["T_STRING","_getRegularItem",662],"(",["T_VARIABLE","$itemInfo",662],")",["T_WHITESPACE","\n    ",662],"{",["T_WHITESPACE","\n        ",663],["T_VARIABLE","$price",664],["T_WHITESPACE"," ",664],"=",["T_WHITESPACE"," ",664],["T_VARIABLE","$itemInfo",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","getPrice",664],"(",")",["T_WHITESPACE"," ",664],"?",["T_WHITESPACE"," ",664],["T_VARIABLE","$itemInfo",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","getPrice",664],"(",")",["T_WHITESPACE"," ",664],":",["T_WHITESPACE"," ",664],["T_VARIABLE","$this",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","getBillingAmount",664],"(",")",";",["T_WHITESPACE","\n        ",664],["T_VARIABLE","$shippingAmount",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$itemInfo",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","getShippingAmount",665],"(",")",["T_WHITESPACE"," ",665],"?",["T_WHITESPACE"," ",665],["T_VARIABLE","$itemInfo",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","getShippingAmount",665],"(",")",["T_WHITESPACE"," ",665],":",["T_WHITESPACE"," ",665],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","getShippingAmount",665],"(",")",";",["T_WHITESPACE","\n        ",665],["T_VARIABLE","$taxAmount",666],["T_WHITESPACE"," ",666],"=",["T_WHITESPACE"," ",666],["T_VARIABLE","$itemInfo",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getTaxAmount",666],"(",")",["T_WHITESPACE"," ",666],"?",["T_WHITESPACE"," ",666],["T_VARIABLE","$itemInfo",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getTaxAmount",666],"(",")",["T_WHITESPACE"," ",666],":",["T_WHITESPACE"," ",666],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getTaxAmount",666],"(",")",";",["T_WHITESPACE","\n\n        ",666],["T_VARIABLE","$item",668],["T_WHITESPACE"," ",668],"=",["T_WHITESPACE"," ",668],["T_STRING","Mage",668],["T_DOUBLE_COLON","::",668],["T_STRING","getModel",668],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_item'",668],")",["T_WHITESPACE","\n            ",668],["T_OBJECT_OPERATOR","->",669],["T_STRING","setData",669],"(",["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getOrderItemInfo",669],"(",")",")",["T_WHITESPACE","\n            ",669],["T_OBJECT_OPERATOR","->",670],["T_STRING","setQtyOrdered",670],"(",["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getInfoValue",670],"(",["T_CONSTANT_ENCAPSED_STRING","'order_item_info'",670],",",["T_WHITESPACE"," ",670],["T_CONSTANT_ENCAPSED_STRING","'qty'",670],")",")",["T_WHITESPACE","\n            ",670],["T_OBJECT_OPERATOR","->",671],["T_STRING","setBaseOriginalPrice",671],"(",["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","getInfoValue",671],"(",["T_CONSTANT_ENCAPSED_STRING","'order_item_info'",671],",",["T_WHITESPACE"," ",671],["T_CONSTANT_ENCAPSED_STRING","'price'",671],")",")",["T_WHITESPACE","\n            ",671],["T_OBJECT_OPERATOR","->",672],["T_STRING","setPrice",672],"(",["T_VARIABLE","$price",672],")",["T_WHITESPACE","\n            ",672],["T_OBJECT_OPERATOR","->",673],["T_STRING","setBasePrice",673],"(",["T_VARIABLE","$price",673],")",["T_WHITESPACE","\n            ",673],["T_OBJECT_OPERATOR","->",674],["T_STRING","setRowTotal",674],"(",["T_VARIABLE","$price",674],")",["T_WHITESPACE","\n            ",674],["T_OBJECT_OPERATOR","->",675],["T_STRING","setBaseRowTotal",675],"(",["T_VARIABLE","$price",675],")",["T_WHITESPACE","\n            ",675],["T_OBJECT_OPERATOR","->",676],["T_STRING","setTaxAmount",676],"(",["T_VARIABLE","$taxAmount",676],")",["T_WHITESPACE","\n            ",676],["T_OBJECT_OPERATOR","->",677],["T_STRING","setShippingAmount",677],"(",["T_VARIABLE","$shippingAmount",677],")",["T_WHITESPACE","\n            ",677],["T_OBJECT_OPERATOR","->",678],["T_STRING","setId",678],"(",["T_STRING","null",678],")",";",["T_WHITESPACE","\n        ",678],["T_RETURN","return",679],["T_WHITESPACE"," ",679],["T_VARIABLE","$item",679],";",["T_WHITESPACE","\n    ",679],"}",["T_WHITESPACE","\n\n    ",680],["T_DOC_COMMENT","\/**\n     * Create and return new order item based on profile item data and $itemInfo\n     * for trial payment\n     *\n     * @param Varien_Object $itemInfo\n     * @return Mage_Sales_Model_Order_Item\n     *\/",682],["T_WHITESPACE","\n    ",688],["T_PROTECTED","protected",689],["T_WHITESPACE"," ",689],["T_FUNCTION","function",689],["T_WHITESPACE"," ",689],["T_STRING","_getTrialItem",689],"(",["T_VARIABLE","$itemInfo",689],")",["T_WHITESPACE","\n    ",689],"{",["T_WHITESPACE","\n        ",690],["T_VARIABLE","$item",691],["T_WHITESPACE"," ",691],"=",["T_WHITESPACE"," ",691],["T_VARIABLE","$this",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","_getRegularItem",691],"(",["T_VARIABLE","$itemInfo",691],")",";",["T_WHITESPACE","\n\n        ",691],["T_VARIABLE","$item",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","setName",693],"(",["T_WHITESPACE","\n            ",693],["T_STRING","Mage",694],["T_DOUBLE_COLON","::",694],["T_STRING","helper",694],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",694],")",["T_OBJECT_OPERATOR","->",694],["T_STRING","__",694],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial '",694],")",["T_WHITESPACE"," ",694],".",["T_WHITESPACE"," ",694],["T_VARIABLE","$item",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","getName",694],"(",")",["T_WHITESPACE","\n        ",694],")",";",["T_WHITESPACE","\n\n        ",695],["T_VARIABLE","$option",697],["T_WHITESPACE"," ",697],"=",["T_WHITESPACE"," ",697],["T_ARRAY","array",697],"(",["T_WHITESPACE","\n            ",697],["T_CONSTANT_ENCAPSED_STRING","'label'",698],["T_WHITESPACE"," ",698],["T_DOUBLE_ARROW","=>",698],["T_WHITESPACE"," ",698],["T_STRING","Mage",698],["T_DOUBLE_COLON","::",698],["T_STRING","helper",698],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",698],")",["T_OBJECT_OPERATOR","->",698],["T_STRING","__",698],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment type'",698],")",",",["T_WHITESPACE","\n            ",698],["T_CONSTANT_ENCAPSED_STRING","'value'",699],["T_WHITESPACE"," ",699],["T_DOUBLE_ARROW","=>",699],["T_WHITESPACE"," ",699],["T_STRING","Mage",699],["T_DOUBLE_COLON","::",699],["T_STRING","helper",699],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",699],")",["T_OBJECT_OPERATOR","->",699],["T_STRING","__",699],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial period payment'",699],")",["T_WHITESPACE","\n        ",699],")",";",["T_WHITESPACE","\n\n        ",700],["T_VARIABLE","$this",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","_addAdditionalOptionToItem",702],"(",["T_VARIABLE","$item",702],",",["T_WHITESPACE"," ",702],["T_VARIABLE","$option",702],")",";",["T_WHITESPACE","\n\n        ",702],["T_RETURN","return",704],["T_WHITESPACE"," ",704],["T_VARIABLE","$item",704],";",["T_WHITESPACE","\n    ",704],"}",["T_WHITESPACE","\n\n    ",705],["T_DOC_COMMENT","\/**\n     * Create and return new order item based on profile item data and $itemInfo\n     * for initial payment\n     *\n     * @param Varien_Object $itemInfo\n     * @return Mage_Sales_Model_Order_Item\n     *\/",707],["T_WHITESPACE","\n    ",713],["T_PROTECTED","protected",714],["T_WHITESPACE"," ",714],["T_FUNCTION","function",714],["T_WHITESPACE"," ",714],["T_STRING","_getInitialItem",714],"(",["T_VARIABLE","$itemInfo",714],")",["T_WHITESPACE","\n    ",714],"{",["T_WHITESPACE","\n        ",715],["T_VARIABLE","$price",716],["T_WHITESPACE"," ",716],"=",["T_WHITESPACE"," ",716],["T_VARIABLE","$itemInfo",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","getPrice",716],"(",")",["T_WHITESPACE"," ",716],"?",["T_WHITESPACE"," ",716],["T_VARIABLE","$itemInfo",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","getPrice",716],"(",")",["T_WHITESPACE"," ",716],":",["T_WHITESPACE"," ",716],["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","getInitAmount",716],"(",")",";",["T_WHITESPACE","\n        ",716],["T_VARIABLE","$shippingAmount",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_VARIABLE","$itemInfo",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","getShippingAmount",717],"(",")",["T_WHITESPACE"," ",717],"?",["T_WHITESPACE"," ",717],["T_VARIABLE","$itemInfo",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","getShippingAmount",717],"(",")",["T_WHITESPACE"," ",717],":",["T_WHITESPACE"," ",717],["T_LNUMBER","0",717],";",["T_WHITESPACE","\n        ",717],["T_VARIABLE","$taxAmount",718],["T_WHITESPACE"," ",718],"=",["T_WHITESPACE"," ",718],["T_VARIABLE","$itemInfo",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getTaxAmount",718],"(",")",["T_WHITESPACE"," ",718],"?",["T_WHITESPACE"," ",718],["T_VARIABLE","$itemInfo",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getTaxAmount",718],"(",")",["T_WHITESPACE"," ",718],":",["T_WHITESPACE"," ",718],["T_LNUMBER","0",718],";",["T_WHITESPACE","\n        ",718],["T_VARIABLE","$item",719],["T_WHITESPACE"," ",719],"=",["T_WHITESPACE"," ",719],["T_STRING","Mage",719],["T_DOUBLE_COLON","::",719],["T_STRING","getModel",719],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_item'",719],")",["T_WHITESPACE","\n            ",719],["T_OBJECT_OPERATOR","->",720],["T_STRING","setStoreId",720],"(",["T_VARIABLE","$this",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","getStoreId",720],"(",")",")",["T_WHITESPACE","\n            ",720],["T_OBJECT_OPERATOR","->",721],["T_STRING","setProductType",721],"(",["T_STRING","Mage_Catalog_Model_Product_Type",721],["T_DOUBLE_COLON","::",721],["T_STRING","TYPE_VIRTUAL",721],")",["T_WHITESPACE","\n            ",721],["T_OBJECT_OPERATOR","->",722],["T_STRING","setIsVirtual",722],"(",["T_LNUMBER","1",722],")",["T_WHITESPACE","\n            ",722],["T_OBJECT_OPERATOR","->",723],["T_STRING","setSku",723],"(",["T_CONSTANT_ENCAPSED_STRING","'initial_fee'",723],")",["T_WHITESPACE","\n            ",723],["T_OBJECT_OPERATOR","->",724],["T_STRING","setName",724],"(",["T_STRING","Mage",724],["T_DOUBLE_COLON","::",724],["T_STRING","helper",724],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",724],")",["T_OBJECT_OPERATOR","->",724],["T_STRING","__",724],"(",["T_CONSTANT_ENCAPSED_STRING","'Recurring Profile Initial Fee'",724],")",")",["T_WHITESPACE","\n            ",724],["T_OBJECT_OPERATOR","->",725],["T_STRING","setDescription",725],"(",["T_CONSTANT_ENCAPSED_STRING","''",725],")",["T_WHITESPACE","\n            ",725],["T_OBJECT_OPERATOR","->",726],["T_STRING","setWeight",726],"(",["T_LNUMBER","0",726],")",["T_WHITESPACE","\n            ",726],["T_OBJECT_OPERATOR","->",727],["T_STRING","setQtyOrdered",727],"(",["T_LNUMBER","1",727],")",["T_WHITESPACE","\n            ",727],["T_OBJECT_OPERATOR","->",728],["T_STRING","setPrice",728],"(",["T_VARIABLE","$price",728],")",["T_WHITESPACE","\n            ",728],["T_OBJECT_OPERATOR","->",729],["T_STRING","setOriginalPrice",729],"(",["T_VARIABLE","$price",729],")",["T_WHITESPACE","\n            ",729],["T_OBJECT_OPERATOR","->",730],["T_STRING","setBasePrice",730],"(",["T_VARIABLE","$price",730],")",["T_WHITESPACE","\n            ",730],["T_OBJECT_OPERATOR","->",731],["T_STRING","setBaseOriginalPrice",731],"(",["T_VARIABLE","$price",731],")",["T_WHITESPACE","\n            ",731],["T_OBJECT_OPERATOR","->",732],["T_STRING","setRowTotal",732],"(",["T_VARIABLE","$price",732],")",["T_WHITESPACE","\n            ",732],["T_OBJECT_OPERATOR","->",733],["T_STRING","setBaseRowTotal",733],"(",["T_VARIABLE","$price",733],")",["T_WHITESPACE","\n            ",733],["T_OBJECT_OPERATOR","->",734],["T_STRING","setTaxAmount",734],"(",["T_VARIABLE","$taxAmount",734],")",["T_WHITESPACE","\n            ",734],["T_OBJECT_OPERATOR","->",735],["T_STRING","setShippingAmount",735],"(",["T_VARIABLE","$shippingAmount",735],")",";",["T_WHITESPACE","\n\n        ",735],["T_VARIABLE","$option",737],["T_WHITESPACE"," ",737],"=",["T_WHITESPACE"," ",737],["T_ARRAY","array",737],"(",["T_WHITESPACE","\n            ",737],["T_CONSTANT_ENCAPSED_STRING","'label'",738],["T_WHITESPACE"," ",738],["T_DOUBLE_ARROW","=>",738],["T_WHITESPACE"," ",738],["T_STRING","Mage",738],["T_DOUBLE_COLON","::",738],["T_STRING","helper",738],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",738],")",["T_OBJECT_OPERATOR","->",738],["T_STRING","__",738],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment type'",738],")",",",["T_WHITESPACE","\n            ",738],["T_CONSTANT_ENCAPSED_STRING","'value'",739],["T_WHITESPACE"," ",739],["T_DOUBLE_ARROW","=>",739],["T_WHITESPACE"," ",739],["T_STRING","Mage",739],["T_DOUBLE_COLON","::",739],["T_STRING","helper",739],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",739],")",["T_OBJECT_OPERATOR","->",739],["T_STRING","__",739],"(",["T_CONSTANT_ENCAPSED_STRING","'Initial period payment'",739],")",["T_WHITESPACE","\n        ",739],")",";",["T_WHITESPACE","\n\n        ",740],["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","_addAdditionalOptionToItem",742],"(",["T_VARIABLE","$item",742],",",["T_WHITESPACE"," ",742],["T_VARIABLE","$option",742],")",";",["T_WHITESPACE","\n        ",742],["T_RETURN","return",743],["T_WHITESPACE"," ",743],["T_VARIABLE","$item",743],";",["T_WHITESPACE","\n    ",743],"}",["T_WHITESPACE","\n\n    ",744],["T_DOC_COMMENT","\/**\n     * Add additional options suboption into itev\n     *\n     * @param Mage_Sales_Model_Order_Item $itemInfo\n     * @param array $option\n     *\/",746],["T_WHITESPACE","\n    ",751],["T_PROTECTED","protected",752],["T_WHITESPACE"," ",752],["T_FUNCTION","function",752],["T_WHITESPACE"," ",752],["T_STRING","_addAdditionalOptionToItem",752],"(",["T_VARIABLE","$item",752],",",["T_WHITESPACE"," ",752],["T_VARIABLE","$option",752],")",["T_WHITESPACE","\n    ",752],"{",["T_WHITESPACE","\n        ",753],["T_VARIABLE","$options",754],["T_WHITESPACE"," ",754],"=",["T_WHITESPACE"," ",754],["T_VARIABLE","$item",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","getProductOptions",754],"(",")",";",["T_WHITESPACE","\n        ",754],["T_VARIABLE","$additionalOptions",755],["T_WHITESPACE"," ",755],"=",["T_WHITESPACE"," ",755],["T_VARIABLE","$item",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","getProductOptionByCode",755],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",755],")",";",["T_WHITESPACE","\n        ",755],["T_IF","if",756],["T_WHITESPACE"," ",756],"(",["T_STRING","is_array",756],"(",["T_VARIABLE","$additionalOptions",756],")",")",["T_WHITESPACE"," ",756],"{",["T_WHITESPACE","\n            ",756],["T_VARIABLE","$additionalOptions",757],"[","]",["T_WHITESPACE"," ",757],"=",["T_WHITESPACE"," ",757],["T_VARIABLE","$option",757],";",["T_WHITESPACE","\n        ",757],"}",["T_WHITESPACE"," ",758],["T_ELSE","else",758],["T_WHITESPACE"," ",758],"{",["T_WHITESPACE","\n            ",758],["T_VARIABLE","$additionalOptions",759],["T_WHITESPACE"," ",759],"=",["T_WHITESPACE"," ",759],["T_ARRAY","array",759],"(",["T_VARIABLE","$option",759],")",";",["T_WHITESPACE","\n        ",759],"}",["T_WHITESPACE","\n        ",760],["T_VARIABLE","$options",761],"[",["T_CONSTANT_ENCAPSED_STRING","'additional_options'",761],"]",["T_WHITESPACE"," ",761],"=",["T_WHITESPACE"," ",761],["T_VARIABLE","$additionalOptions",761],";",["T_WHITESPACE","\n        ",761],["T_VARIABLE","$item",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","setProductOptions",762],"(",["T_VARIABLE","$options",762],")",";",["T_WHITESPACE","\n    ",762],"}",["T_WHITESPACE","\n\n    ",763],["T_DOC_COMMENT","\/**\n     * Recursively cleanup array from objects\n     *\n     * @param array &$array\n     *\/",765],["T_WHITESPACE","\n    ",769],["T_PRIVATE","private",770],["T_WHITESPACE"," ",770],["T_FUNCTION","function",770],["T_WHITESPACE"," ",770],["T_STRING","_cleanupArray",770],"(","&",["T_VARIABLE","$array",770],")",["T_WHITESPACE","\n    ",770],"{",["T_WHITESPACE","\n        ",771],["T_IF","if",772],["T_WHITESPACE"," ",772],"(","!",["T_VARIABLE","$array",772],")",["T_WHITESPACE"," ",772],"{",["T_WHITESPACE","\n            ",772],["T_RETURN","return",773],";",["T_WHITESPACE","\n        ",773],"}",["T_WHITESPACE","\n        ",774],["T_FOREACH","foreach",775],["T_WHITESPACE"," ",775],"(",["T_VARIABLE","$array",775],["T_WHITESPACE"," ",775],["T_AS","as",775],["T_WHITESPACE"," ",775],["T_VARIABLE","$key",775],["T_WHITESPACE"," ",775],["T_DOUBLE_ARROW","=>",775],["T_WHITESPACE"," ",775],["T_VARIABLE","$value",775],")",["T_WHITESPACE"," ",775],"{",["T_WHITESPACE","\n            ",775],["T_IF","if",776],["T_WHITESPACE"," ",776],"(",["T_STRING","is_object",776],"(",["T_VARIABLE","$value",776],")",")",["T_WHITESPACE"," ",776],"{",["T_WHITESPACE","\n                ",776],["T_UNSET","unset",777],"(",["T_VARIABLE","$array",777],"[",["T_VARIABLE","$key",777],"]",")",";",["T_WHITESPACE","\n            ",777],"}",["T_WHITESPACE"," ",778],["T_ELSEIF","elseif",778],["T_WHITESPACE"," ",778],"(",["T_STRING","is_array",778],"(",["T_VARIABLE","$value",778],")",")",["T_WHITESPACE"," ",778],"{",["T_WHITESPACE","\n                ",778],["T_VARIABLE","$this",779],["T_OBJECT_OPERATOR","->",779],["T_STRING","_cleanupArray",779],"(",["T_VARIABLE","$array",779],"[",["T_VARIABLE","$key",779],"]",")",";",["T_WHITESPACE","\n            ",779],"}",["T_WHITESPACE","\n        ",780],"}",["T_WHITESPACE","\n    ",781],"}",["T_WHITESPACE","\n",782],"}",["T_WHITESPACE","\n",783]]