[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Bestsellers report resource model\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Report_Bestsellers",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Report_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","AGGREGATION_DAILY",37],["T_WHITESPACE","   ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'daily'",37],";",["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","AGGREGATION_MONTHLY",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'monthly'",38],";",["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","AGGREGATION_YEARLY",39],["T_WHITESPACE","  ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'yearly'",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Model initialization\n     *\n     *\/",41],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","_construct",45],"(",")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_init",47],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/bestsellers_aggregated_'",47],["T_WHITESPACE"," ",47],".",["T_WHITESPACE"," ",47],["T_STRING","self",47],["T_DOUBLE_COLON","::",47],["T_STRING","AGGREGATION_DAILY",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'id'",47],")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Aggregate Orders data by order created at\n     *\n     * @param mixed $from\n     * @param mixed $to\n     * @return Mage_Sales_Model_Resource_Report_Bestsellers\n     *\/",50],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","aggregate",57],"(",["T_VARIABLE","$from",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","null",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$to",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","null",57],")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_COMMENT","\/\/ convert input dates to UTC to be comparable with DATETIME fields in DB\n",59],["T_WHITESPACE","        ",60],["T_VARIABLE","$from",60],["T_WHITESPACE","    ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_dateToUtc",60],"(",["T_VARIABLE","$from",60],")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$to",61],["T_WHITESPACE","      ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_dateToUtc",61],"(",["T_VARIABLE","$to",61],")",";",["T_WHITESPACE","\n\n        ",61],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","_checkDates",63],"(",["T_VARIABLE","$from",63],",",["T_WHITESPACE"," ",63],["T_VARIABLE","$to",63],")",";",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$adapter",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_getWriteAdapter",64],"(",")",";",["T_WHITESPACE","\n        ",64],["T_COMMENT","\/\/$this->_getWriteAdapter()->beginTransaction();\n",65],["T_WHITESPACE","\n        ",66],["T_TRY","try",67],["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n            ",67],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$from",68],["T_WHITESPACE"," ",68],["T_IS_NOT_IDENTICAL","!==",68],["T_WHITESPACE"," ",68],["T_STRING","null",68],["T_WHITESPACE"," ",68],["T_BOOLEAN_OR","||",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$to",68],["T_WHITESPACE"," ",68],["T_IS_NOT_IDENTICAL","!==",68],["T_WHITESPACE"," ",68],["T_STRING","null",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n                ",68],["T_VARIABLE","$subSelect",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_getTableDateRangeSelect",69],"(",["T_WHITESPACE","\n                    ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getTable",70],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",70],")",",",["T_WHITESPACE","\n                    ",70],["T_CONSTANT_ENCAPSED_STRING","'created_at'",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$from",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$to",71],["T_WHITESPACE","\n                ",71],")",";",["T_WHITESPACE","\n            ",72],"}",["T_WHITESPACE"," ",73],["T_ELSE","else",73],["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n                ",73],["T_VARIABLE","$subSelect",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","null",74],";",["T_WHITESPACE","\n            ",74],"}",["T_WHITESPACE","\n\n            ",75],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_clearTableByDateRange",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getMainTable",77],"(",")",",",["T_WHITESPACE"," ",77],["T_VARIABLE","$from",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$to",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$subSelect",77],")",";",["T_WHITESPACE","\n            ",77],["T_COMMENT","\/\/ convert dates from UTC to current admin timezone\n",78],["T_WHITESPACE","            ",79],["T_VARIABLE","$periodExpr",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$adapter",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getDatePartSql",79],"(",["T_WHITESPACE","\n                ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getStoreTZOffsetQuery",80],"(",["T_WHITESPACE","\n                    ",80],["T_ARRAY","array",81],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table'",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getTable",81],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",81],")",")",",",["T_WHITESPACE","\n                    ",81],["T_CONSTANT_ENCAPSED_STRING","'source_table.created_at'",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$from",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$to",82],["T_WHITESPACE","\n                ",82],")",["T_WHITESPACE","\n            ",83],")",";",["T_WHITESPACE","\n\n            ",84],["T_VARIABLE","$helper",86],["T_WHITESPACE","                        ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","getResourceHelper",86],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",86],")",";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$select",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$adapter",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","select",87],"(",")",";",["T_WHITESPACE","\n\n            ",87],["T_VARIABLE","$select",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","group",89],"(",["T_ARRAY","array",89],"(",["T_WHITESPACE","\n                ",89],["T_VARIABLE","$periodExpr",90],",",["T_WHITESPACE","\n                ",90],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",91],",",["T_WHITESPACE","\n                ",91],["T_CONSTANT_ENCAPSED_STRING","'order_item.product_id'",92],["T_WHITESPACE","\n            ",92],")",")",";",["T_WHITESPACE","\n\n            ",93],["T_VARIABLE","$columns",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_ARRAY","array",95],"(",["T_WHITESPACE","\n                ",95],["T_CONSTANT_ENCAPSED_STRING","'period'",96],["T_WHITESPACE","                 ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$periodExpr",96],",",["T_WHITESPACE","\n                ",96],["T_CONSTANT_ENCAPSED_STRING","'store_id'",97],["T_WHITESPACE","               ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",97],",",["T_WHITESPACE","\n                ",97],["T_CONSTANT_ENCAPSED_STRING","'product_id'",98],["T_WHITESPACE","             ",98],["T_DOUBLE_ARROW","=>",98],["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'order_item.product_id'",98],",",["T_WHITESPACE","\n                ",98],["T_CONSTANT_ENCAPSED_STRING","'product_type_id'",99],["T_WHITESPACE","        ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'product.type_id'",99],",",["T_WHITESPACE","\n                ",99],["T_CONSTANT_ENCAPSED_STRING","'product_name'",100],["T_WHITESPACE","           ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_NEW","new",100],["T_WHITESPACE"," ",100],["T_STRING","Zend_Db_Expr",100],"(",["T_WHITESPACE","\n                    ",100],["T_STRING","sprintf",101],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(%s)'",101],",",["T_WHITESPACE","\n                        ",101],["T_VARIABLE","$adapter",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getIfNullSql",102],"(",["T_CONSTANT_ENCAPSED_STRING","'product_name.value'",102],",",["T_CONSTANT_ENCAPSED_STRING","'product_default_name.value'",102],")",["T_WHITESPACE","\n                    ",102],")",["T_WHITESPACE","\n                ",103],")",",",["T_WHITESPACE","\n                ",104],["T_CONSTANT_ENCAPSED_STRING","'product_price'",105],["T_WHITESPACE","          ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_NEW","new",105],["T_WHITESPACE"," ",105],["T_STRING","Zend_Db_Expr",105],"(",["T_WHITESPACE","\n                    ",105],["T_STRING","sprintf",106],"(",["T_CONSTANT_ENCAPSED_STRING","'%s'",106],",",["T_WHITESPACE","\n                            ",106],["T_VARIABLE","$helper",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","prepareColumn",107],"(",["T_WHITESPACE","\n                                ",107],["T_STRING","sprintf",108],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(%s)'",108],",",["T_WHITESPACE","\n                                    ",108],["T_VARIABLE","$adapter",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getIfNullSql",109],"(",["T_WHITESPACE","\n                                        ",109],["T_VARIABLE","$adapter",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getIfNullSql",110],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price.value'",110],",",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.value'",110],")",",",["T_WHITESPACE"," ",110],["T_LNUMBER","0",110],")",["T_WHITESPACE","\n                                ",110],")",",",["T_WHITESPACE","\n                                ",111],["T_VARIABLE","$select",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getPart",112],"(",["T_STRING","Zend_Db_Select",112],["T_DOUBLE_COLON","::",112],["T_STRING","GROUP",112],")",["T_WHITESPACE","\n                        ",112],")",["T_WHITESPACE","\n                    ",113],")",["T_WHITESPACE","\n                ",114],")",",",["T_WHITESPACE","\n                ",115],["T_CONSTANT_ENCAPSED_STRING","'qty_ordered'",116],["T_WHITESPACE","            ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_NEW","new",116],["T_WHITESPACE"," ",116],["T_STRING","Zend_Db_Expr",116],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(order_item.qty_ordered)'",116],")",["T_WHITESPACE","\n            ",116],")",";",["T_WHITESPACE","\n\n            ",117],["T_VARIABLE","$select",119],["T_WHITESPACE","\n                ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","from",120],"(",["T_WHITESPACE","\n                    ",120],["T_ARRAY","array",121],"(",["T_WHITESPACE","\n                        ",121],["T_CONSTANT_ENCAPSED_STRING","'source_table'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getTable",122],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",122],")",")",",",["T_WHITESPACE","\n                    ",122],["T_VARIABLE","$columns",123],")",["T_WHITESPACE","\n                ",123],["T_OBJECT_OPERATOR","->",124],["T_STRING","joinInner",124],"(",["T_WHITESPACE","\n                    ",124],["T_ARRAY","array",125],"(",["T_WHITESPACE","\n                        ",125],["T_CONSTANT_ENCAPSED_STRING","'order_item'",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getTable",126],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_item'",126],")",")",",",["T_WHITESPACE","\n                    ",126],["T_CONSTANT_ENCAPSED_STRING","'order_item.order_id = source_table.entity_id'",127],",",["T_WHITESPACE","\n                    ",127],["T_ARRAY","array",128],"(",")",["T_WHITESPACE","\n                ",128],")",["T_WHITESPACE","\n                ",129],["T_OBJECT_OPERATOR","->",130],["T_STRING","where",130],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table.state != ?'",130],",",["T_WHITESPACE"," ",130],["T_STRING","Mage_Sales_Model_Order",130],["T_DOUBLE_COLON","::",130],["T_STRING","STATE_CANCELED",130],")",";",["T_WHITESPACE","\n\n\n            ",130],["T_DOC_COMMENT","\/** @var Mage_Catalog_Model_Resource_Product $product *\/",133],["T_WHITESPACE","\n            ",133],["T_VARIABLE","$product",134],["T_WHITESPACE","  ",134],"=",["T_WHITESPACE"," ",134],["T_STRING","Mage",134],["T_DOUBLE_COLON","::",134],["T_STRING","getResourceSingleton",134],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",134],")",";",["T_WHITESPACE","\n\n            ",134],["T_VARIABLE","$joinExpr",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_ARRAY","array",136],"(",["T_WHITESPACE","\n                ",136],["T_CONSTANT_ENCAPSED_STRING","'product.entity_id = order_item.product_id'",137],",",["T_WHITESPACE","\n                ",137],["T_VARIABLE","$adapter",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","quoteInto",138],"(",["T_CONSTANT_ENCAPSED_STRING","'product.entity_type_id = ?'",138],",",["T_WHITESPACE"," ",138],["T_VARIABLE","$product",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getTypeId",138],"(",")",")",["T_WHITESPACE","\n            ",138],")",";",["T_WHITESPACE","\n\n            ",139],["T_VARIABLE","$joinExpr",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","implode",141],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$joinExpr",141],")",";",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$select",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","joinInner",142],"(",["T_WHITESPACE","\n                ",142],["T_ARRAY","array",143],"(",["T_WHITESPACE","\n                    ",143],["T_CONSTANT_ENCAPSED_STRING","'product'",144],["T_WHITESPACE"," ",144],["T_DOUBLE_ARROW","=>",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getTable",144],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",144],")",")",",",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$joinExpr",145],",",["T_WHITESPACE","\n                ",145],["T_ARRAY","array",146],"(",")",["T_WHITESPACE","\n            ",146],")",";",["T_WHITESPACE","\n\n            ",147],["T_COMMENT","\/\/ join product attributes Name & Price\n",149],["T_WHITESPACE","            ",150],["T_VARIABLE","$attr",150],["T_WHITESPACE","     ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$product",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getAttribute",150],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",150],")",";",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$joinExprProductName",151],["T_WHITESPACE","       ",151],"=",["T_WHITESPACE"," ",151],["T_ARRAY","array",151],"(",["T_WHITESPACE","\n                ",151],["T_CONSTANT_ENCAPSED_STRING","'product_name.entity_id = product.entity_id'",152],",",["T_WHITESPACE","\n                ",152],["T_CONSTANT_ENCAPSED_STRING","'product_name.store_id = source_table.store_id'",153],",",["T_WHITESPACE","\n                ",153],["T_VARIABLE","$adapter",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","quoteInto",154],"(",["T_CONSTANT_ENCAPSED_STRING","'product_name.entity_type_id = ?'",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$product",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getTypeId",154],"(",")",")",",",["T_WHITESPACE","\n                ",154],["T_VARIABLE","$adapter",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","quoteInto",155],"(",["T_CONSTANT_ENCAPSED_STRING","'product_name.attribute_id = ?'",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$attr",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getAttributeId",155],"(",")",")",["T_WHITESPACE","\n            ",155],")",";",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$joinExprProductName",157],["T_WHITESPACE","        ",157],"=",["T_WHITESPACE"," ",157],["T_STRING","implode",157],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$joinExprProductName",157],")",";",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$joinExprProductDefaultName",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_ARRAY","array",158],"(",["T_WHITESPACE","\n                ",158],["T_CONSTANT_ENCAPSED_STRING","'product_default_name.entity_id = product.entity_id'",159],",",["T_WHITESPACE","\n                ",159],["T_CONSTANT_ENCAPSED_STRING","'product_default_name.store_id = 0'",160],",",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$adapter",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","quoteInto",161],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_name.entity_type_id = ?'",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$product",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getTypeId",161],"(",")",")",",",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$adapter",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","quoteInto",162],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_name.attribute_id = ?'",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$attr",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getAttributeId",162],"(",")",")",["T_WHITESPACE","\n            ",162],")",";",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$joinExprProductDefaultName",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_STRING","implode",164],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$joinExprProductDefaultName",164],")",";",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$select",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","joinLeft",165],"(",["T_WHITESPACE","\n                ",165],["T_ARRAY","array",166],"(",["T_WHITESPACE","\n                    ",166],["T_CONSTANT_ENCAPSED_STRING","'product_name'",167],["T_WHITESPACE"," ",167],["T_DOUBLE_ARROW","=>",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$attr",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getBackend",167],"(",")",["T_OBJECT_OPERATOR","->",167],["T_STRING","getTable",167],"(",")",")",",",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$joinExprProductName",168],",",["T_WHITESPACE","\n                ",168],["T_ARRAY","array",169],"(",")",["T_WHITESPACE","\n            ",169],")",["T_WHITESPACE","\n            ",170],["T_OBJECT_OPERATOR","->",171],["T_STRING","joinLeft",171],"(",["T_WHITESPACE","\n                ",171],["T_ARRAY","array",172],"(",["T_WHITESPACE","\n                    ",172],["T_CONSTANT_ENCAPSED_STRING","'product_default_name'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$attr",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getBackend",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","getTable",173],"(",")",")",",",["T_WHITESPACE","\n                ",173],["T_VARIABLE","$joinExprProductDefaultName",174],",",["T_WHITESPACE","\n                ",174],["T_ARRAY","array",175],"(",")",["T_WHITESPACE","\n            ",175],")",";",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$attr",177],["T_WHITESPACE","                    ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$product",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getAttribute",177],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",177],")",";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$joinExprProductPrice",178],["T_WHITESPACE","    ",178],"=",["T_WHITESPACE"," ",178],["T_ARRAY","array",178],"(",["T_WHITESPACE","\n                ",178],["T_CONSTANT_ENCAPSED_STRING","'product_price.entity_id = product.entity_id'",179],",",["T_WHITESPACE","\n                ",179],["T_CONSTANT_ENCAPSED_STRING","'product_price.store_id = source_table.store_id'",180],",",["T_WHITESPACE","\n                ",180],["T_VARIABLE","$adapter",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","quoteInto",181],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price.entity_type_id = ?'",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$product",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getTypeId",181],"(",")",")",",",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$adapter",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","quoteInto",182],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price.attribute_id = ?'",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$attr",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getAttributeId",182],"(",")",")",["T_WHITESPACE","\n            ",182],")",";",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$joinExprProductPrice",184],["T_WHITESPACE","    ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","implode",184],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",184],",",["T_WHITESPACE"," ",184],["T_VARIABLE","$joinExprProductPrice",184],")",";",["T_WHITESPACE","\n\n            ",184],["T_VARIABLE","$joinExprProductDefPrice",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_ARRAY","array",186],"(",["T_WHITESPACE","\n                ",186],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.entity_id = product.entity_id'",187],",",["T_WHITESPACE","\n                ",187],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.store_id = 0'",188],",",["T_WHITESPACE","\n                ",188],["T_VARIABLE","$adapter",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","quoteInto",189],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.entity_type_id = ?'",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$product",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getTypeId",189],"(",")",")",",",["T_WHITESPACE","\n                ",189],["T_VARIABLE","$adapter",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","quoteInto",190],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.attribute_id = ?'",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$attr",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getAttributeId",190],"(",")",")",["T_WHITESPACE","\n            ",190],")",";",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$joinExprProductDefPrice",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_STRING","implode",192],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",192],",",["T_WHITESPACE"," ",192],["T_VARIABLE","$joinExprProductDefPrice",192],")",";",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$select",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","joinLeft",193],"(",["T_WHITESPACE","\n                ",193],["T_ARRAY","array",194],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$attr",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getBackend",194],"(",")",["T_OBJECT_OPERATOR","->",194],["T_STRING","getTable",194],"(",")",")",",",["T_WHITESPACE","\n                ",194],["T_VARIABLE","$joinExprProductPrice",195],",",["T_WHITESPACE","\n                ",195],["T_ARRAY","array",196],"(",")",["T_WHITESPACE","\n            ",196],")",["T_WHITESPACE","\n            ",197],["T_OBJECT_OPERATOR","->",198],["T_STRING","joinLeft",198],"(",["T_WHITESPACE","\n                ",198],["T_ARRAY","array",199],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price'",199],["T_WHITESPACE"," ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$attr",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getBackend",199],"(",")",["T_OBJECT_OPERATOR","->",199],["T_STRING","getTable",199],"(",")",")",",",["T_WHITESPACE","\n                ",199],["T_VARIABLE","$joinExprProductDefPrice",200],",",["T_WHITESPACE","\n                ",200],["T_ARRAY","array",201],"(",")",["T_WHITESPACE","\n            ",201],")",";",["T_WHITESPACE","\n\n            ",202],["T_IF","if",204],["T_WHITESPACE"," ",204],"(",["T_VARIABLE","$subSelect",204],["T_WHITESPACE"," ",204],["T_IS_NOT_IDENTICAL","!==",204],["T_WHITESPACE"," ",204],["T_STRING","null",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n                ",204],["T_VARIABLE","$select",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","having",205],"(",["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_makeConditionFromDateRangeSelect",205],"(",["T_VARIABLE","$subSelect",205],",",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'period'",205],")",")",";",["T_WHITESPACE","\n            ",205],"}",["T_WHITESPACE","\n\n\n            ",206],["T_VARIABLE","$select",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","useStraightJoin",209],"(",")",";",["T_WHITESPACE","  ",209],["T_COMMENT","\/\/ important!\n",209],["T_WHITESPACE","            ",210],["T_VARIABLE","$insertQuery",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$helper",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getInsertFromSelectUsingAnalytic",210],"(",["T_VARIABLE","$select",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getMainTable",210],"(",")",",",["T_WHITESPACE","\n                ",210],["T_STRING","array_keys",211],"(",["T_VARIABLE","$columns",211],")",")",";",["T_WHITESPACE","\n            ",211],["T_VARIABLE","$adapter",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","query",212],"(",["T_VARIABLE","$insertQuery",212],")",";",["T_WHITESPACE","\n\n\n            ",212],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_aggregateDefault",215],"(",["T_VARIABLE","$subSelect",215],")",";",["T_WHITESPACE","\n\n            ",215],["T_COMMENT","\/\/ update rating\n",217],["T_WHITESPACE","            ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_updateRatingPos",218],"(",["T_STRING","self",218],["T_DOUBLE_COLON","::",218],["T_STRING","AGGREGATION_DAILY",218],")",";",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_updateRatingPos",219],"(",["T_STRING","self",219],["T_DOUBLE_COLON","::",219],["T_STRING","AGGREGATION_MONTHLY",219],")",";",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_updateRatingPos",220],"(",["T_STRING","self",220],["T_DOUBLE_COLON","::",220],["T_STRING","AGGREGATION_YEARLY",220],")",";",["T_WHITESPACE","\n\n\n            ",220],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_setFlagData",223],"(",["T_STRING","Mage_Reports_Model_Flag",223],["T_DOUBLE_COLON","::",223],["T_STRING","REPORT_BESTSELLERS_FLAG_CODE",223],")",";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE"," ",224],["T_CATCH","catch",224],["T_WHITESPACE"," ",224],"(",["T_STRING","Exception",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$e",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n            ",224],["T_COMMENT","\/\/$this->_getWriteAdapter()->rollBack();\n",225],["T_WHITESPACE","            ",226],["T_THROW","throw",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$e",226],";",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE","\n\n        ",227],["T_COMMENT","\/\/$this->_getWriteAdapter()->commit();\n",229],["T_WHITESPACE","        ",230],["T_RETURN","return",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$this",230],";",["T_WHITESPACE","\n    ",230],"}",["T_WHITESPACE","\n\n    ",231],["T_DOC_COMMENT","\/**\n     * Aggregate Orders data for default store\n     *\n     * @param object Varien_Db_Select|null $subSelect\n     * @return Mage_Sales_Model_Resource_Report_Bestsellers\n     *\/",233],["T_WHITESPACE","\n    ",238],["T_PROTECTED","protected",239],["T_WHITESPACE"," ",239],["T_FUNCTION","function",239],["T_WHITESPACE"," ",239],["T_STRING","_aggregateDefault",239],"(",["T_VARIABLE","$subSelect",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_STRING","null",239],")",["T_WHITESPACE","\n    ",239],"{",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$adapter",241],["T_WHITESPACE","    ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_getWriteAdapter",241],"(",")",";",["T_WHITESPACE","\n        ",241],["T_VARIABLE","$select",242],["T_WHITESPACE","     ",242],"=",["T_WHITESPACE"," ",242],["T_VARIABLE","$adapter",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","select",242],"(",")",";",["T_WHITESPACE","\n        ",242],["T_DOC_COMMENT","\/** @var Mage_Catalog_Model_Resource_Product $product *\/",243],["T_WHITESPACE","\n        ",243],["T_VARIABLE","$product",244],["T_WHITESPACE","    ",244],"=",["T_WHITESPACE"," ",244],["T_STRING","Mage",244],["T_DOUBLE_COLON","::",244],["T_STRING","getResourceSingleton",244],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",244],")",";",["T_WHITESPACE","\n        ",244],["T_VARIABLE","$attr",245],["T_WHITESPACE","       ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$product",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getAttribute",245],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",245],")",";",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$helper",246],["T_WHITESPACE","     ",246],"=",["T_WHITESPACE"," ",246],["T_STRING","Mage",246],["T_DOUBLE_COLON","::",246],["T_STRING","getResourceHelper",246],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",246],")",";",["T_WHITESPACE","\n\n        ",246],["T_VARIABLE","$columns",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_ARRAY","array",248],"(",["T_WHITESPACE","\n            ",248],["T_CONSTANT_ENCAPSED_STRING","'period'",249],["T_WHITESPACE","            ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_CONSTANT_ENCAPSED_STRING","'period'",249],",",["T_WHITESPACE","\n            ",249],["T_CONSTANT_ENCAPSED_STRING","'store_id'",250],["T_WHITESPACE","          ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_NEW","new",250],["T_WHITESPACE"," ",250],["T_STRING","Zend_Db_Expr",250],"(",["T_STRING","Mage_Core_Model_App",250],["T_DOUBLE_COLON","::",250],["T_STRING","ADMIN_STORE_ID",250],")",",",["T_WHITESPACE","\n            ",250],["T_CONSTANT_ENCAPSED_STRING","'product_id'",251],["T_WHITESPACE","        ",251],["T_DOUBLE_ARROW","=>",251],["T_WHITESPACE"," ",251],["T_CONSTANT_ENCAPSED_STRING","'product_id'",251],",",["T_WHITESPACE","\n            ",251],["T_CONSTANT_ENCAPSED_STRING","'product_type_id'",252],["T_WHITESPACE","   ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'product_type_id'",252],",",["T_WHITESPACE","\n            ",252],["T_CONSTANT_ENCAPSED_STRING","'product_name'",253],["T_WHITESPACE","      ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_NEW","new",253],["T_WHITESPACE"," ",253],["T_STRING","Zend_Db_Expr",253],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(product_name)'",253],")",",",["T_WHITESPACE","\n            ",253],["T_CONSTANT_ENCAPSED_STRING","'product_price'",254],["T_WHITESPACE","     ",254],["T_DOUBLE_ARROW","=>",254],["T_WHITESPACE"," ",254],["T_NEW","new",254],["T_WHITESPACE"," ",254],["T_STRING","Zend_Db_Expr",254],"(",["T_WHITESPACE","\n                ",254],["T_STRING","sprintf",255],"(",["T_CONSTANT_ENCAPSED_STRING","'%s'",255],",",["T_WHITESPACE","\n                    ",255],["T_VARIABLE","$helper",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","prepareColumn",256],"(",["T_WHITESPACE","\n                        ",256],["T_STRING","sprintf",257],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(%s)'",257],",",["T_WHITESPACE","\n                            ",257],["T_VARIABLE","$adapter",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getIfNullSql",258],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.value'",258],",",["T_WHITESPACE"," ",258],["T_LNUMBER","0",258],")",["T_WHITESPACE","\n                        ",258],")",",",["T_WHITESPACE","\n                        ",259],["T_VARIABLE","$select",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getPart",260],"(",["T_STRING","Zend_Db_Select",260],["T_DOUBLE_COLON","::",260],["T_STRING","GROUP",260],")",["T_WHITESPACE","\n                    ",260],")",["T_WHITESPACE","\n                ",261],")",["T_WHITESPACE","\n            ",262],")",",",["T_WHITESPACE","\n            ",263],["T_CONSTANT_ENCAPSED_STRING","'qty_ordered'",264],["T_WHITESPACE","       ",264],["T_DOUBLE_ARROW","=>",264],["T_WHITESPACE"," ",264],["T_NEW","new",264],["T_WHITESPACE"," ",264],["T_STRING","Zend_Db_Expr",264],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(qty_ordered)'",264],")",",",["T_WHITESPACE","\n        ",264],")",";",["T_WHITESPACE","\n\n        ",265],["T_VARIABLE","$select",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","from",267],"(",["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getMainTable",267],"(",")",",",["T_WHITESPACE"," ",267],["T_VARIABLE","$columns",267],")",["T_WHITESPACE","\n            ",267],["T_OBJECT_OPERATOR","->",268],["T_STRING","where",268],"(",["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getMainTable",268],"(",")",["T_WHITESPACE"," ",268],".",["T_WHITESPACE"," ",268],["T_CONSTANT_ENCAPSED_STRING","'.store_id <> ?'",268],",",["T_WHITESPACE"," ",268],["T_LNUMBER","0",268],")",";",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$joinExprProductDefPrice",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_ARRAY","array",269],"(",["T_WHITESPACE","\n            ",269],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.entity_id = '",270],["T_WHITESPACE"," ",270],".",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getMainTable",270],"(",")",["T_WHITESPACE"," ",270],".",["T_WHITESPACE"," ",270],["T_CONSTANT_ENCAPSED_STRING","'.product_id'",270],",",["T_WHITESPACE","\n            ",270],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.store_id = 0'",271],",",["T_WHITESPACE","\n            ",271],["T_VARIABLE","$adapter",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","quoteInto",272],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.entity_type_id = ?'",272],",",["T_WHITESPACE"," ",272],["T_VARIABLE","$product",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getTypeId",272],"(",")",")",",",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$adapter",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","quoteInto",273],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.attribute_id = ?'",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$attr",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getAttributeId",273],"(",")",")",["T_WHITESPACE","\n        ",273],")",";",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$joinExprProductDefPrice",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_STRING","implode",275],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",275],",",["T_WHITESPACE"," ",275],["T_VARIABLE","$joinExprProductDefPrice",275],")",";",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$select",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","joinLeft",276],"(",["T_WHITESPACE","\n            ",276],["T_ARRAY","array",277],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price'",277],["T_WHITESPACE"," ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$attr",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getBackend",277],"(",")",["T_OBJECT_OPERATOR","->",277],["T_STRING","getTable",277],"(",")",")",",",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$joinExprProductDefPrice",278],",",["T_WHITESPACE","\n            ",278],["T_ARRAY","array",279],"(",")",["T_WHITESPACE","\n        ",279],")",";",["T_WHITESPACE","\n\n        ",280],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$subSelect",282],["T_WHITESPACE"," ",282],["T_IS_NOT_IDENTICAL","!==",282],["T_WHITESPACE"," ",282],["T_STRING","null",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$select",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","where",283],"(",["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_makeConditionFromDateRangeSelect",283],"(",["T_VARIABLE","$subSelect",283],",",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'period'",283],")",")",";",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE","\n\n        ",284],["T_VARIABLE","$select",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","group",286],"(",["T_ARRAY","array",286],"(",["T_WHITESPACE","\n            ",286],["T_CONSTANT_ENCAPSED_STRING","'period'",287],",",["T_WHITESPACE","\n            ",287],["T_CONSTANT_ENCAPSED_STRING","'product_id'",288],["T_WHITESPACE","\n        ",288],")",")",";",["T_WHITESPACE","\n\n        ",289],["T_VARIABLE","$insertQuery",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$helper",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getInsertFromSelectUsingAnalytic",291],"(",["T_VARIABLE","$select",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getMainTable",291],"(",")",",",["T_WHITESPACE","\n            ",291],["T_STRING","array_keys",292],"(",["T_VARIABLE","$columns",292],")",")",";",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$adapter",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","query",293],"(",["T_VARIABLE","$insertQuery",293],")",";",["T_WHITESPACE","\n\n        ",293],["T_RETURN","return",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],";",["T_WHITESPACE","\n    ",295],"}",["T_WHITESPACE","\n\n    ",296],["T_DOC_COMMENT","\/**\n     * Update rating position\n     *\n     * @param string $aggregation One of Mage_Sales_Model_Resource_Report_Bestsellers::AGGREGATION_XXX constants\n     * @return Mage_Sales_Model_Resource_Report_Bestsellers\n     *\/",298],["T_WHITESPACE","\n    ",303],["T_PROTECTED","protected",304],["T_WHITESPACE"," ",304],["T_FUNCTION","function",304],["T_WHITESPACE"," ",304],["T_STRING","_updateRatingPos",304],"(",["T_VARIABLE","$aggregation",304],")",["T_WHITESPACE","\n    ",304],"{",["T_WHITESPACE","\n        ",305],["T_VARIABLE","$aggregationTable",306],["T_WHITESPACE","   ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getTable",306],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/bestsellers_aggregated_'",306],["T_WHITESPACE"," ",306],".",["T_WHITESPACE"," ",306],["T_VARIABLE","$aggregation",306],")",";",["T_WHITESPACE","\n\n        ",306],["T_VARIABLE","$aggregationAliases",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_ARRAY","array",308],"(",["T_WHITESPACE","\n            ",308],["T_CONSTANT_ENCAPSED_STRING","'daily'",309],["T_WHITESPACE","   ",309],["T_DOUBLE_ARROW","=>",309],["T_WHITESPACE"," ",309],["T_STRING","self",309],["T_DOUBLE_COLON","::",309],["T_STRING","AGGREGATION_DAILY",309],",",["T_WHITESPACE","\n            ",309],["T_CONSTANT_ENCAPSED_STRING","'monthly'",310],["T_WHITESPACE"," ",310],["T_DOUBLE_ARROW","=>",310],["T_WHITESPACE"," ",310],["T_STRING","self",310],["T_DOUBLE_COLON","::",310],["T_STRING","AGGREGATION_MONTHLY",310],",",["T_WHITESPACE","\n            ",310],["T_CONSTANT_ENCAPSED_STRING","'yearly'",311],["T_WHITESPACE","  ",311],["T_DOUBLE_ARROW","=>",311],["T_WHITESPACE"," ",311],["T_STRING","self",311],["T_DOUBLE_COLON","::",311],["T_STRING","AGGREGATION_YEARLY",311],["T_WHITESPACE","\n        ",311],")",";",["T_WHITESPACE","\n        ",312],["T_STRING","Mage",313],["T_DOUBLE_COLON","::",313],["T_STRING","getResourceHelper",313],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",313],")",["T_WHITESPACE","\n            ",313],["T_OBJECT_OPERATOR","->",314],["T_STRING","getBestsellersReportUpdateRatingPos",314],"(",["T_VARIABLE","$aggregation",314],",",["T_WHITESPACE"," ",314],["T_VARIABLE","$aggregationAliases",314],",",["T_WHITESPACE","\n                ",314],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getMainTable",315],"(",")",",",["T_WHITESPACE"," ",315],["T_VARIABLE","$aggregationTable",315],")",";",["T_WHITESPACE","\n\n        ",315],["T_RETURN","return",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$this",317],";",["T_WHITESPACE","\n    ",317],"}",["T_WHITESPACE","\n",318],"}",["T_WHITESPACE","\n",319]]