[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Order model\n *\n * Supported events:\n *  sales_order_load_after\n *  sales_order_save_before\n *  sales_order_save_after\n *  sales_order_delete_before\n *  sales_order_delete_after\n *\n * @method Mage_Sales_Model_Resource_Order _getResource()\n * @method Mage_Sales_Model_Resource_Order getResource()\n * @method string getState()\n * @method string getStatus()\n * @method Mage_Sales_Model_Order setStatus(string $value)\n * @method string getCouponCode()\n * @method Mage_Sales_Model_Order setCouponCode(string $value)\n * @method string getProtectCode()\n * @method Mage_Sales_Model_Order setProtectCode(string $value)\n * @method string getShippingDescription()\n * @method Mage_Sales_Model_Order setShippingDescription(string $value)\n * @method int getIsVirtual()\n * @method Mage_Sales_Model_Order setIsVirtual(int $value)\n * @method int getStoreId()\n * @method Mage_Sales_Model_Order setStoreId(int $value)\n * @method int getCustomerId()\n * @method Mage_Sales_Model_Order setCustomerId(int $value)\n * @method float getBaseDiscountAmount()\n * @method Mage_Sales_Model_Order setBaseDiscountAmount(float $value)\n * @method float getBaseDiscountCanceled()\n * @method Mage_Sales_Model_Order setBaseDiscountCanceled(float $value)\n * @method float getBaseDiscountInvoiced()\n * @method Mage_Sales_Model_Order setBaseDiscountInvoiced(float $value)\n * @method float getBaseDiscountRefunded()\n * @method Mage_Sales_Model_Order setBaseDiscountRefunded(float $value)\n * @method float getBaseGrandTotal()\n * @method Mage_Sales_Model_Order setBaseGrandTotal(float $value)\n * @method float getBaseShippingAmount()\n * @method Mage_Sales_Model_Order setBaseShippingAmount(float $value)\n * @method float getBaseShippingCanceled()\n * @method Mage_Sales_Model_Order setBaseShippingCanceled(float $value)\n * @method float getBaseShippingInvoiced()\n * @method Mage_Sales_Model_Order setBaseShippingInvoiced(float $value)\n * @method float getBaseShippingRefunded()\n * @method Mage_Sales_Model_Order setBaseShippingRefunded(float $value)\n * @method float getBaseShippingTaxAmount()\n * @method Mage_Sales_Model_Order setBaseShippingTaxAmount(float $value)\n * @method float getBaseShippingTaxRefunded()\n * @method Mage_Sales_Model_Order setBaseShippingTaxRefunded(float $value)\n * @method float getBaseSubtotal()\n * @method Mage_Sales_Model_Order setBaseSubtotal(float $value)\n * @method float getBaseSubtotalCanceled()\n * @method Mage_Sales_Model_Order setBaseSubtotalCanceled(float $value)\n * @method float getBaseSubtotalInvoiced()\n * @method Mage_Sales_Model_Order setBaseSubtotalInvoiced(float $value)\n * @method float getBaseSubtotalRefunded()\n * @method Mage_Sales_Model_Order setBaseSubtotalRefunded(float $value)\n * @method float getBaseTaxAmount()\n * @method Mage_Sales_Model_Order setBaseTaxAmount(float $value)\n * @method float getBaseTaxCanceled()\n * @method Mage_Sales_Model_Order setBaseTaxCanceled(float $value)\n * @method float getBaseTaxInvoiced()\n * @method Mage_Sales_Model_Order setBaseTaxInvoiced(float $value)\n * @method float getBaseTaxRefunded()\n * @method Mage_Sales_Model_Order setBaseTaxRefunded(float $value)\n * @method float getBaseToGlobalRate()\n * @method Mage_Sales_Model_Order setBaseToGlobalRate(float $value)\n * @method float getBaseToOrderRate()\n * @method Mage_Sales_Model_Order setBaseToOrderRate(float $value)\n * @method float getBaseTotalCanceled()\n * @method Mage_Sales_Model_Order setBaseTotalCanceled(float $value)\n * @method float getBaseTotalInvoiced()\n * @method Mage_Sales_Model_Order setBaseTotalInvoiced(float $value)\n * @method float getBaseTotalInvoicedCost()\n * @method Mage_Sales_Model_Order setBaseTotalInvoicedCost(float $value)\n * @method float getBaseTotalOfflineRefunded()\n * @method Mage_Sales_Model_Order setBaseTotalOfflineRefunded(float $value)\n * @method float getBaseTotalOnlineRefunded()\n * @method Mage_Sales_Model_Order setBaseTotalOnlineRefunded(float $value)\n * @method float getBaseTotalPaid()\n * @method Mage_Sales_Model_Order setBaseTotalPaid(float $value)\n * @method float getBaseTotalQtyOrdered()\n * @method Mage_Sales_Model_Order setBaseTotalQtyOrdered(float $value)\n * @method float getBaseTotalRefunded()\n * @method Mage_Sales_Model_Order setBaseTotalRefunded(float $value)\n * @method float getDiscountAmount()\n * @method Mage_Sales_Model_Order setDiscountAmount(float $value)\n * @method float getDiscountCanceled()\n * @method Mage_Sales_Model_Order setDiscountCanceled(float $value)\n * @method float getDiscountInvoiced()\n * @method Mage_Sales_Model_Order setDiscountInvoiced(float $value)\n * @method float getDiscountRefunded()\n * @method Mage_Sales_Model_Order setDiscountRefunded(float $value)\n * @method float getGrandTotal()\n * @method Mage_Sales_Model_Order setGrandTotal(float $value)\n * @method float getShippingAmount()\n * @method Mage_Sales_Model_Order setShippingAmount(float $value)\n * @method float getShippingCanceled()\n * @method Mage_Sales_Model_Order setShippingCanceled(float $value)\n * @method float getShippingInvoiced()\n * @method Mage_Sales_Model_Order setShippingInvoiced(float $value)\n * @method float getShippingRefunded()\n * @method Mage_Sales_Model_Order setShippingRefunded(float $value)\n * @method float getShippingTaxAmount()\n * @method Mage_Sales_Model_Order setShippingTaxAmount(float $value)\n * @method float getShippingTaxRefunded()\n * @method Mage_Sales_Model_Order setShippingTaxRefunded(float $value)\n * @method float getStoreToBaseRate()\n * @method Mage_Sales_Model_Order setStoreToBaseRate(float $value)\n * @method float getStoreToOrderRate()\n * @method Mage_Sales_Model_Order setStoreToOrderRate(float $value)\n * @method float getSubtotal()\n * @method Mage_Sales_Model_Order setSubtotal(float $value)\n * @method float getSubtotalCanceled()\n * @method Mage_Sales_Model_Order setSubtotalCanceled(float $value)\n * @method float getSubtotalInvoiced()\n * @method Mage_Sales_Model_Order setSubtotalInvoiced(float $value)\n * @method float getSubtotalRefunded()\n * @method Mage_Sales_Model_Order setSubtotalRefunded(float $value)\n * @method float getTaxAmount()\n * @method Mage_Sales_Model_Order setTaxAmount(float $value)\n * @method float getTaxCanceled()\n * @method Mage_Sales_Model_Order setTaxCanceled(float $value)\n * @method float getTaxInvoiced()\n * @method Mage_Sales_Model_Order setTaxInvoiced(float $value)\n * @method float getTaxRefunded()\n * @method Mage_Sales_Model_Order setTaxRefunded(float $value)\n * @method float getTotalCanceled()\n * @method Mage_Sales_Model_Order setTotalCanceled(float $value)\n * @method float getTotalInvoiced()\n * @method Mage_Sales_Model_Order setTotalInvoiced(float $value)\n * @method float getTotalOfflineRefunded()\n * @method Mage_Sales_Model_Order setTotalOfflineRefunded(float $value)\n * @method float getTotalOnlineRefunded()\n * @method Mage_Sales_Model_Order setTotalOnlineRefunded(float $value)\n * @method float getTotalPaid()\n * @method Mage_Sales_Model_Order setTotalPaid(float $value)\n * @method float getTotalQtyOrdered()\n * @method Mage_Sales_Model_Order setTotalQtyOrdered(float $value)\n * @method float getTotalRefunded()\n * @method Mage_Sales_Model_Order setTotalRefunded(float $value)\n * @method int getCanShipPartially()\n * @method Mage_Sales_Model_Order setCanShipPartially(int $value)\n * @method int getCanShipPartiallyItem()\n * @method Mage_Sales_Model_Order setCanShipPartiallyItem(int $value)\n * @method int getCustomerIsGuest()\n * @method Mage_Sales_Model_Order setCustomerIsGuest(int $value)\n * @method int getCustomerNoteNotify()\n * @method Mage_Sales_Model_Order setCustomerNoteNotify(int $value)\n * @method int getBillingAddressId()\n * @method Mage_Sales_Model_Order setBillingAddressId(int $value)\n * @method int getCustomerGroupId()\n * @method Mage_Sales_Model_Order setCustomerGroupId(int $value)\n * @method int getEditIncrement()\n * @method Mage_Sales_Model_Order setEditIncrement(int $value)\n * @method int getEmailSent()\n * @method Mage_Sales_Model_Order setEmailSent(int $value)\n * @method int getForcedDoShipmentWithInvoice()\n * @method Mage_Sales_Model_Order setForcedDoShipmentWithInvoice(int $value)\n * @method int getGiftMessageId()\n * @method Mage_Sales_Model_Order setGiftMessageId(int $value)\n * @method int getPaymentAuthorizationExpiration()\n * @method Mage_Sales_Model_Order setPaymentAuthorizationExpiration(int $value)\n * @method int getPaypalIpnCustomerNotified()\n * @method Mage_Sales_Model_Order setPaypalIpnCustomerNotified(int $value)\n * @method int getQuoteAddressId()\n * @method Mage_Sales_Model_Order setQuoteAddressId(int $value)\n * @method int getQuoteId()\n * @method Mage_Sales_Model_Order setQuoteId(int $value)\n * @method int getShippingAddressId()\n * @method Mage_Sales_Model_Order setShippingAddressId(int $value)\n * @method float getAdjustmentNegative()\n * @method Mage_Sales_Model_Order setAdjustmentNegative(float $value)\n * @method float getAdjustmentPositive()\n * @method Mage_Sales_Model_Order setAdjustmentPositive(float $value)\n * @method float getBaseAdjustmentNegative()\n * @method Mage_Sales_Model_Order setBaseAdjustmentNegative(float $value)\n * @method float getBaseAdjustmentPositive()\n * @method Mage_Sales_Model_Order setBaseAdjustmentPositive(float $value)\n * @method float getBaseShippingDiscountAmount()\n * @method Mage_Sales_Model_Order setBaseShippingDiscountAmount(float $value)\n * @method float getBaseSubtotalInclTax()\n * @method Mage_Sales_Model_Order setBaseSubtotalInclTax(float $value)\n * @method Mage_Sales_Model_Order setBaseTotalDue(float $value)\n * @method float getPaymentAuthorizationAmount()\n * @method Mage_Sales_Model_Order setPaymentAuthorizationAmount(float $value)\n * @method float getShippingDiscountAmount()\n * @method Mage_Sales_Model_Order setShippingDiscountAmount(float $value)\n * @method float getSubtotalInclTax()\n * @method Mage_Sales_Model_Order setSubtotalInclTax(float $value)\n * @method Mage_Sales_Model_Order setTotalDue(float $value)\n * @method float getWeight()\n * @method Mage_Sales_Model_Order setWeight(float $value)\n * @method string getCustomerDob()\n * @method Mage_Sales_Model_Order setCustomerDob(string $value)\n * @method string getIncrementId()\n * @method Mage_Sales_Model_Order setIncrementId(string $value)\n * @method string getAppliedRuleIds()\n * @method Mage_Sales_Model_Order setAppliedRuleIds(string $value)\n * @method string getBaseCurrencyCode()\n * @method Mage_Sales_Model_Order setBaseCurrencyCode(string $value)\n * @method string getCustomerEmail()\n * @method Mage_Sales_Model_Order setCustomerEmail(string $value)\n * @method string getCustomerFirstname()\n * @method Mage_Sales_Model_Order setCustomerFirstname(string $value)\n * @method string getCustomerMiddlename()\n * @method Mage_Sales_Model_Order setCustomerMiddlename(string $value)\n * @method string getCustomerLastname()\n * @method Mage_Sales_Model_Order setCustomerLastname(string $value)\n * @method string getCustomerPrefix()\n * @method Mage_Sales_Model_Order setCustomerPrefix(string $value)\n * @method string getCustomerSuffix()\n * @method Mage_Sales_Model_Order setCustomerSuffix(string $value)\n * @method string getCustomerTaxvat()\n * @method Mage_Sales_Model_Order setCustomerTaxvat(string $value)\n * @method string getDiscountDescription()\n * @method Mage_Sales_Model_Order setDiscountDescription(string $value)\n * @method string getExtCustomerId()\n * @method Mage_Sales_Model_Order setExtCustomerId(string $value)\n * @method string getExtOrderId()\n * @method Mage_Sales_Model_Order setExtOrderId(string $value)\n * @method string getGlobalCurrencyCode()\n * @method Mage_Sales_Model_Order setGlobalCurrencyCode(string $value)\n * @method string getHoldBeforeState()\n * @method Mage_Sales_Model_Order setHoldBeforeState(string $value)\n * @method string getHoldBeforeStatus()\n * @method Mage_Sales_Model_Order setHoldBeforeStatus(string $value)\n * @method string getOrderCurrencyCode()\n * @method Mage_Sales_Model_Order setOrderCurrencyCode(string $value)\n * @method string getOriginalIncrementId()\n * @method Mage_Sales_Model_Order setOriginalIncrementId(string $value)\n * @method string getRelationChildId()\n * @method Mage_Sales_Model_Order setRelationChildId(string $value)\n * @method string getRelationChildRealId()\n * @method Mage_Sales_Model_Order setRelationChildRealId(string $value)\n * @method string getRelationParentId()\n * @method Mage_Sales_Model_Order setRelationParentId(string $value)\n * @method string getRelationParentRealId()\n * @method Mage_Sales_Model_Order setRelationParentRealId(string $value)\n * @method string getRemoteIp()\n * @method Mage_Sales_Model_Order setRemoteIp(string $value)\n * @method Mage_Sales_Model_Order setShippingMethod(string $value)\n * @method string getStoreCurrencyCode()\n * @method Mage_Sales_Model_Order setStoreCurrencyCode(string $value)\n * @method string getStoreName()\n * @method Mage_Sales_Model_Order setStoreName(string $value)\n * @method string getXForwardedFor()\n * @method Mage_Sales_Model_Order setXForwardedFor(string $value)\n * @method string getCustomerNote()\n * @method Mage_Sales_Model_Order setCustomerNote(string $value)\n * @method string getCreatedAt()\n * @method Mage_Sales_Model_Order setCreatedAt(string $value)\n * @method string getUpdatedAt()\n * @method Mage_Sales_Model_Order setUpdatedAt(string $value)\n * @method int getTotalItemCount()\n * @method Mage_Sales_Model_Order setTotalItemCount(int $value)\n * @method int getCustomerGender()\n * @method Mage_Sales_Model_Order setCustomerGender(int $value)\n * @method float getHiddenTaxAmount()\n * @method Mage_Sales_Model_Order setHiddenTaxAmount(float $value)\n * @method float getBaseHiddenTaxAmount()\n * @method Mage_Sales_Model_Order setBaseHiddenTaxAmount(float $value)\n * @method float getShippingHiddenTaxAmount()\n * @method Mage_Sales_Model_Order setShippingHiddenTaxAmount(float $value)\n * @method float getBaseShippingHiddenTaxAmount()\n * @method Mage_Sales_Model_Order setBaseShippingHiddenTaxAmount(float $value)\n * @method float getHiddenTaxInvoiced()\n * @method Mage_Sales_Model_Order setHiddenTaxInvoiced(float $value)\n * @method float getBaseHiddenTaxInvoiced()\n * @method Mage_Sales_Model_Order setBaseHiddenTaxInvoiced(float $value)\n * @method float getHiddenTaxRefunded()\n * @method Mage_Sales_Model_Order setHiddenTaxRefunded(float $value)\n * @method float getBaseHiddenTaxRefunded()\n * @method Mage_Sales_Model_Order setBaseHiddenTaxRefunded(float $value)\n * @method float getShippingInclTax()\n * @method Mage_Sales_Model_Order setShippingInclTax(float $value)\n * @method float getBaseShippingInclTax()\n * @method Mage_Sales_Model_Order setBaseShippingInclTax(float $value)\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",309],["T_CLASS","class",310],["T_WHITESPACE"," ",310],["T_STRING","Mage_Sales_Model_Order",310],["T_WHITESPACE"," ",310],["T_EXTENDS","extends",310],["T_WHITESPACE"," ",310],["T_STRING","Mage_Sales_Model_Abstract",310],["T_WHITESPACE","\n",310],"{",["T_WHITESPACE","\n    ",311],["T_DOC_COMMENT","\/**\n     * Identifier for history item\n     *\/",312],["T_WHITESPACE","\n    ",314],["T_CONST","const",315],["T_WHITESPACE"," ",315],["T_STRING","ENTITY",315],["T_WHITESPACE","                                ",315],"=",["T_WHITESPACE"," ",315],["T_CONSTANT_ENCAPSED_STRING","'order'",315],";",["T_WHITESPACE","\n\n    ",315],["T_DOC_COMMENT","\/**\n     * Event type names for order emails\n     *\/",317],["T_WHITESPACE","\n    ",319],["T_CONST","const",320],["T_WHITESPACE"," ",320],["T_STRING","EMAIL_EVENT_NAME_NEW_ORDER",320],["T_WHITESPACE","    ",320],"=",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'new_order'",320],";",["T_WHITESPACE","\n    ",320],["T_CONST","const",321],["T_WHITESPACE"," ",321],["T_STRING","EMAIL_EVENT_NAME_UPDATE_ORDER",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_CONSTANT_ENCAPSED_STRING","'update_order'",321],";",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * XML configuration paths\n     *\/",323],["T_WHITESPACE","\n    ",325],["T_CONST","const",326],["T_WHITESPACE"," ",326],["T_STRING","XML_PATH_EMAIL_TEMPLATE",326],["T_WHITESPACE","               ",326],"=",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order\/template'",326],";",["T_WHITESPACE","\n    ",326],["T_CONST","const",327],["T_WHITESPACE"," ",327],["T_STRING","XML_PATH_EMAIL_GUEST_TEMPLATE",327],["T_WHITESPACE","         ",327],"=",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order\/guest_template'",327],";",["T_WHITESPACE","\n    ",327],["T_CONST","const",328],["T_WHITESPACE"," ",328],["T_STRING","XML_PATH_EMAIL_IDENTITY",328],["T_WHITESPACE","               ",328],"=",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order\/identity'",328],";",["T_WHITESPACE","\n    ",328],["T_CONST","const",329],["T_WHITESPACE"," ",329],["T_STRING","XML_PATH_EMAIL_COPY_TO",329],["T_WHITESPACE","                ",329],"=",["T_WHITESPACE"," ",329],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order\/copy_to'",329],";",["T_WHITESPACE","\n    ",329],["T_CONST","const",330],["T_WHITESPACE"," ",330],["T_STRING","XML_PATH_EMAIL_COPY_METHOD",330],["T_WHITESPACE","            ",330],"=",["T_WHITESPACE"," ",330],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order\/copy_method'",330],";",["T_WHITESPACE","\n    ",330],["T_CONST","const",331],["T_WHITESPACE"," ",331],["T_STRING","XML_PATH_EMAIL_ENABLED",331],["T_WHITESPACE","                ",331],"=",["T_WHITESPACE"," ",331],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order\/enabled'",331],";",["T_WHITESPACE","\n\n    ",331],["T_CONST","const",333],["T_WHITESPACE"," ",333],["T_STRING","XML_PATH_UPDATE_EMAIL_TEMPLATE",333],["T_WHITESPACE","        ",333],"=",["T_WHITESPACE"," ",333],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order_comment\/template'",333],";",["T_WHITESPACE","\n    ",333],["T_CONST","const",334],["T_WHITESPACE"," ",334],["T_STRING","XML_PATH_UPDATE_EMAIL_GUEST_TEMPLATE",334],["T_WHITESPACE","  ",334],"=",["T_WHITESPACE"," ",334],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order_comment\/guest_template'",334],";",["T_WHITESPACE","\n    ",334],["T_CONST","const",335],["T_WHITESPACE"," ",335],["T_STRING","XML_PATH_UPDATE_EMAIL_IDENTITY",335],["T_WHITESPACE","        ",335],"=",["T_WHITESPACE"," ",335],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order_comment\/identity'",335],";",["T_WHITESPACE","\n    ",335],["T_CONST","const",336],["T_WHITESPACE"," ",336],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_TO",336],["T_WHITESPACE","         ",336],"=",["T_WHITESPACE"," ",336],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order_comment\/copy_to'",336],";",["T_WHITESPACE","\n    ",336],["T_CONST","const",337],["T_WHITESPACE"," ",337],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_METHOD",337],["T_WHITESPACE","     ",337],"=",["T_WHITESPACE"," ",337],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order_comment\/copy_method'",337],";",["T_WHITESPACE","\n    ",337],["T_CONST","const",338],["T_WHITESPACE"," ",338],["T_STRING","XML_PATH_UPDATE_EMAIL_ENABLED",338],["T_WHITESPACE","         ",338],"=",["T_WHITESPACE"," ",338],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/order_comment\/enabled'",338],";",["T_WHITESPACE","\n\n    ",338],["T_DOC_COMMENT","\/**\n     * Order states\n     *\/",340],["T_WHITESPACE","\n    ",342],["T_CONST","const",343],["T_WHITESPACE"," ",343],["T_STRING","STATE_NEW",343],["T_WHITESPACE","             ",343],"=",["T_WHITESPACE"," ",343],["T_CONSTANT_ENCAPSED_STRING","'new'",343],";",["T_WHITESPACE","\n    ",343],["T_CONST","const",344],["T_WHITESPACE"," ",344],["T_STRING","STATE_PENDING_PAYMENT",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","'pending_payment'",344],";",["T_WHITESPACE","\n    ",344],["T_CONST","const",345],["T_WHITESPACE"," ",345],["T_STRING","STATE_PROCESSING",345],["T_WHITESPACE","      ",345],"=",["T_WHITESPACE"," ",345],["T_CONSTANT_ENCAPSED_STRING","'processing'",345],";",["T_WHITESPACE","\n    ",345],["T_CONST","const",346],["T_WHITESPACE"," ",346],["T_STRING","STATE_COMPLETE",346],["T_WHITESPACE","        ",346],"=",["T_WHITESPACE"," ",346],["T_CONSTANT_ENCAPSED_STRING","'complete'",346],";",["T_WHITESPACE","\n    ",346],["T_CONST","const",347],["T_WHITESPACE"," ",347],["T_STRING","STATE_CLOSED",347],["T_WHITESPACE","          ",347],"=",["T_WHITESPACE"," ",347],["T_CONSTANT_ENCAPSED_STRING","'closed'",347],";",["T_WHITESPACE","\n    ",347],["T_CONST","const",348],["T_WHITESPACE"," ",348],["T_STRING","STATE_CANCELED",348],["T_WHITESPACE","        ",348],"=",["T_WHITESPACE"," ",348],["T_CONSTANT_ENCAPSED_STRING","'canceled'",348],";",["T_WHITESPACE","\n    ",348],["T_CONST","const",349],["T_WHITESPACE"," ",349],["T_STRING","STATE_HOLDED",349],["T_WHITESPACE","          ",349],"=",["T_WHITESPACE"," ",349],["T_CONSTANT_ENCAPSED_STRING","'holded'",349],";",["T_WHITESPACE","\n    ",349],["T_CONST","const",350],["T_WHITESPACE"," ",350],["T_STRING","STATE_PAYMENT_REVIEW",350],["T_WHITESPACE","  ",350],"=",["T_WHITESPACE"," ",350],["T_CONSTANT_ENCAPSED_STRING","'payment_review'",350],";",["T_WHITESPACE","\n\n    ",350],["T_DOC_COMMENT","\/**\n     * Order statuses\n     *\/",352],["T_WHITESPACE","\n    ",354],["T_CONST","const",355],["T_WHITESPACE"," ",355],["T_STRING","STATUS_FRAUD",355],["T_WHITESPACE","  ",355],"=",["T_WHITESPACE"," ",355],["T_CONSTANT_ENCAPSED_STRING","'fraud'",355],";",["T_WHITESPACE","\n\n    ",355],["T_DOC_COMMENT","\/**\n     * Order flags\n     *\/",357],["T_WHITESPACE","\n    ",359],["T_CONST","const",360],["T_WHITESPACE"," ",360],["T_STRING","ACTION_FLAG_CANCEL",360],["T_WHITESPACE","                    ",360],"=",["T_WHITESPACE"," ",360],["T_CONSTANT_ENCAPSED_STRING","'cancel'",360],";",["T_WHITESPACE","\n    ",360],["T_CONST","const",361],["T_WHITESPACE"," ",361],["T_STRING","ACTION_FLAG_HOLD",361],["T_WHITESPACE","                      ",361],"=",["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","'hold'",361],";",["T_WHITESPACE","\n    ",361],["T_CONST","const",362],["T_WHITESPACE"," ",362],["T_STRING","ACTION_FLAG_UNHOLD",362],["T_WHITESPACE","                    ",362],"=",["T_WHITESPACE"," ",362],["T_CONSTANT_ENCAPSED_STRING","'unhold'",362],";",["T_WHITESPACE","\n    ",362],["T_CONST","const",363],["T_WHITESPACE"," ",363],["T_STRING","ACTION_FLAG_EDIT",363],["T_WHITESPACE","                      ",363],"=",["T_WHITESPACE"," ",363],["T_CONSTANT_ENCAPSED_STRING","'edit'",363],";",["T_WHITESPACE","\n    ",363],["T_CONST","const",364],["T_WHITESPACE"," ",364],["T_STRING","ACTION_FLAG_CREDITMEMO",364],["T_WHITESPACE","                ",364],"=",["T_WHITESPACE"," ",364],["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",364],";",["T_WHITESPACE","\n    ",364],["T_CONST","const",365],["T_WHITESPACE"," ",365],["T_STRING","ACTION_FLAG_INVOICE",365],["T_WHITESPACE","                   ",365],"=",["T_WHITESPACE"," ",365],["T_CONSTANT_ENCAPSED_STRING","'invoice'",365],";",["T_WHITESPACE","\n    ",365],["T_CONST","const",366],["T_WHITESPACE"," ",366],["T_STRING","ACTION_FLAG_REORDER",366],["T_WHITESPACE","                   ",366],"=",["T_WHITESPACE"," ",366],["T_CONSTANT_ENCAPSED_STRING","'reorder'",366],";",["T_WHITESPACE","\n    ",366],["T_CONST","const",367],["T_WHITESPACE"," ",367],["T_STRING","ACTION_FLAG_SHIP",367],["T_WHITESPACE","                      ",367],"=",["T_WHITESPACE"," ",367],["T_CONSTANT_ENCAPSED_STRING","'ship'",367],";",["T_WHITESPACE","\n    ",367],["T_CONST","const",368],["T_WHITESPACE"," ",368],["T_STRING","ACTION_FLAG_COMMENT",368],["T_WHITESPACE","                   ",368],"=",["T_WHITESPACE"," ",368],["T_CONSTANT_ENCAPSED_STRING","'comment'",368],";",["T_WHITESPACE","\n    ",368],["T_CONST","const",369],["T_WHITESPACE"," ",369],["T_STRING","ACTION_FLAG_PRODUCTS_PERMISSION_DENIED",369],"=",["T_WHITESPACE"," ",369],["T_CONSTANT_ENCAPSED_STRING","'product_permission_denied'",369],";",["T_WHITESPACE","\n\n    ",369],["T_DOC_COMMENT","\/**\n     * Report date types\n     *\/",371],["T_WHITESPACE","\n    ",373],["T_CONST","const",374],["T_WHITESPACE"," ",374],["T_STRING","REPORT_DATE_TYPE_CREATED",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_CONSTANT_ENCAPSED_STRING","'created'",374],";",["T_WHITESPACE","\n    ",374],["T_CONST","const",375],["T_WHITESPACE"," ",375],["T_STRING","REPORT_DATE_TYPE_UPDATED",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_CONSTANT_ENCAPSED_STRING","'updated'",375],";",["T_WHITESPACE","\n    ",375],["T_COMMENT","\/*\n     * Identifier for history item\n     *\/",376],["T_WHITESPACE","\n    ",378],["T_CONST","const",379],["T_WHITESPACE"," ",379],["T_STRING","HISTORY_ENTITY_NAME",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_CONSTANT_ENCAPSED_STRING","'order'",379],";",["T_WHITESPACE","\n\n    ",379],["T_PROTECTED","protected",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$_eventPrefix",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_CONSTANT_ENCAPSED_STRING","'sales_order'",381],";",["T_WHITESPACE","\n    ",381],["T_PROTECTED","protected",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$_eventObject",382],["T_WHITESPACE"," ",382],"=",["T_WHITESPACE"," ",382],["T_CONSTANT_ENCAPSED_STRING","'order'",382],";",["T_WHITESPACE","\n\n    ",382],["T_PROTECTED","protected",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$_addresses",384],["T_WHITESPACE","       ",384],"=",["T_WHITESPACE"," ",384],["T_STRING","null",384],";",["T_WHITESPACE","\n    ",384],["T_PROTECTED","protected",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$_items",385],["T_WHITESPACE","           ",385],"=",["T_WHITESPACE"," ",385],["T_STRING","null",385],";",["T_WHITESPACE","\n    ",385],["T_PROTECTED","protected",386],["T_WHITESPACE"," ",386],["T_VARIABLE","$_payments",386],["T_WHITESPACE","        ",386],"=",["T_WHITESPACE"," ",386],["T_STRING","null",386],";",["T_WHITESPACE","\n    ",386],["T_PROTECTED","protected",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$_statusHistory",387],["T_WHITESPACE","   ",387],"=",["T_WHITESPACE"," ",387],["T_STRING","null",387],";",["T_WHITESPACE","\n    ",387],["T_PROTECTED","protected",388],["T_WHITESPACE"," ",388],["T_VARIABLE","$_invoices",388],";",["T_WHITESPACE","\n    ",388],["T_PROTECTED","protected",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$_tracks",389],";",["T_WHITESPACE","\n    ",389],["T_PROTECTED","protected",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$_shipments",390],";",["T_WHITESPACE","\n    ",390],["T_PROTECTED","protected",391],["T_WHITESPACE"," ",391],["T_VARIABLE","$_creditmemos",391],";",["T_WHITESPACE","\n\n    ",391],["T_PROTECTED","protected",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$_relatedObjects",393],["T_WHITESPACE","  ",393],"=",["T_WHITESPACE"," ",393],["T_ARRAY","array",393],"(",")",";",["T_WHITESPACE","\n    ",393],["T_PROTECTED","protected",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$_orderCurrency",394],["T_WHITESPACE","   ",394],"=",["T_WHITESPACE"," ",394],["T_STRING","null",394],";",["T_WHITESPACE","\n    ",394],["T_PROTECTED","protected",395],["T_WHITESPACE"," ",395],["T_VARIABLE","$_baseCurrency",395],["T_WHITESPACE","    ",395],"=",["T_WHITESPACE"," ",395],["T_STRING","null",395],";",["T_WHITESPACE","\n\n    ",395],["T_DOC_COMMENT","\/**\n     * Array of action flags for canUnhold, canEdit, etc.\n     *\n     * @var array\n     *\/",397],["T_WHITESPACE","\n    ",401],["T_PROTECTED","protected",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$_actionFlag",402],["T_WHITESPACE"," ",402],"=",["T_WHITESPACE"," ",402],["T_ARRAY","array",402],"(",")",";",["T_WHITESPACE","\n\n    ",402],["T_DOC_COMMENT","\/**\n     * Flag: if after order placing we can send new email to the customer.\n     *\n     * @var bool\n     *\/",404],["T_WHITESPACE","\n    ",408],["T_PROTECTED","protected",409],["T_WHITESPACE"," ",409],["T_VARIABLE","$_canSendNewEmailFlag",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_STRING","true",409],";",["T_WHITESPACE","\n\n    ",409],["T_COMMENT","\/*\n     * Identifier for history item\n     *\n     * @var string\n     *\/",411],["T_WHITESPACE","\n    ",415],["T_PROTECTED","protected",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$_historyEntityName",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_STRING","self",416],["T_DOUBLE_COLON","::",416],["T_STRING","HISTORY_ENTITY_NAME",416],";",["T_WHITESPACE","\n\n    ",416],["T_DOC_COMMENT","\/**\n     * Initialize resource model\n     *\/",418],["T_WHITESPACE","\n    ",420],["T_PROTECTED","protected",421],["T_WHITESPACE"," ",421],["T_FUNCTION","function",421],["T_WHITESPACE"," ",421],["T_STRING","_construct",421],"(",")",["T_WHITESPACE","\n    ",421],"{",["T_WHITESPACE","\n        ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","_init",423],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",423],")",";",["T_WHITESPACE","\n    ",423],"}",["T_WHITESPACE","\n\n     ",424],["T_DOC_COMMENT","\/**\n     * Init mapping array of short fields to\n     * its full names\n     *\n     * @return Varien_Object\n     *\/",426],["T_WHITESPACE","\n    ",431],["T_PROTECTED","protected",432],["T_WHITESPACE"," ",432],["T_FUNCTION","function",432],["T_WHITESPACE"," ",432],["T_STRING","_initOldFieldsMap",432],"(",")",["T_WHITESPACE","\n    ",432],"{",["T_WHITESPACE","\n        ",433],["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","_oldFieldsMap",434],["T_WHITESPACE"," ",434],"=",["T_WHITESPACE"," ",434],["T_STRING","Mage",434],["T_DOUBLE_COLON","::",434],["T_STRING","helper",434],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",434],")",["T_OBJECT_OPERATOR","->",434],["T_STRING","getOldFieldMap",434],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",434],")",";",["T_WHITESPACE","\n        ",434],["T_RETURN","return",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$this",435],";",["T_WHITESPACE","\n    ",435],"}",["T_WHITESPACE","\n\n    ",436],["T_DOC_COMMENT","\/**\n     * Clear order object data\n     *\n     * @param string $key data key\n     * @return Mage_Sales_Model_Order\n     *\/",438],["T_WHITESPACE","\n    ",443],["T_PUBLIC","public",444],["T_WHITESPACE"," ",444],["T_FUNCTION","function",444],["T_WHITESPACE"," ",444],["T_STRING","unsetData",444],"(",["T_VARIABLE","$key",444],"=",["T_STRING","null",444],")",["T_WHITESPACE","\n    ",444],"{",["T_WHITESPACE","\n        ",445],["T_STRING","parent",446],["T_DOUBLE_COLON","::",446],["T_STRING","unsetData",446],"(",["T_VARIABLE","$key",446],")",";",["T_WHITESPACE","\n        ",446],["T_IF","if",447],["T_WHITESPACE"," ",447],"(",["T_STRING","is_null",447],"(",["T_VARIABLE","$key",447],")",")",["T_WHITESPACE"," ",447],"{",["T_WHITESPACE","\n            ",447],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","_items",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_STRING","null",448],";",["T_WHITESPACE","\n        ",448],"}",["T_WHITESPACE","\n        ",449],["T_RETURN","return",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$this",450],";",["T_WHITESPACE","\n    ",450],"}",["T_WHITESPACE","\n\n    ",451],["T_DOC_COMMENT","\/**\n     * Retrieve can flag for action (edit, unhold, etc..)\n     *\n     * @param string $action\n     * @return boolean|null\n     *\/",453],["T_WHITESPACE","\n    ",458],["T_PUBLIC","public",459],["T_WHITESPACE"," ",459],["T_FUNCTION","function",459],["T_WHITESPACE"," ",459],["T_STRING","getActionFlag",459],"(",["T_VARIABLE","$action",459],")",["T_WHITESPACE","\n    ",459],"{",["T_WHITESPACE","\n        ",460],["T_IF","if",461],["T_WHITESPACE"," ",461],"(",["T_ISSET","isset",461],"(",["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","_actionFlag",461],"[",["T_VARIABLE","$action",461],"]",")",")",["T_WHITESPACE"," ",461],"{",["T_WHITESPACE","\n            ",461],["T_RETURN","return",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","_actionFlag",462],"[",["T_VARIABLE","$action",462],"]",";",["T_WHITESPACE","\n        ",462],"}",["T_WHITESPACE","\n        ",463],["T_RETURN","return",464],["T_WHITESPACE"," ",464],["T_STRING","null",464],";",["T_WHITESPACE","\n    ",464],"}",["T_WHITESPACE","\n\n    ",465],["T_DOC_COMMENT","\/**\n     * Set can flag value for action (edit, unhold, etc...)\n     *\n     * @param string $action\n     * @param boolean $flag\n     * @return Mage_Sales_Model_Order\n     *\/",467],["T_WHITESPACE","\n    ",473],["T_PUBLIC","public",474],["T_WHITESPACE"," ",474],["T_FUNCTION","function",474],["T_WHITESPACE"," ",474],["T_STRING","setActionFlag",474],"(",["T_VARIABLE","$action",474],",",["T_WHITESPACE"," ",474],["T_VARIABLE","$flag",474],")",["T_WHITESPACE","\n    ",474],"{",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","_actionFlag",476],"[",["T_VARIABLE","$action",476],"]",["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_BOOL_CAST","(boolean)",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$flag",476],";",["T_WHITESPACE","\n        ",476],["T_RETURN","return",477],["T_WHITESPACE"," ",477],["T_VARIABLE","$this",477],";",["T_WHITESPACE","\n    ",477],"}",["T_WHITESPACE","\n\n    ",478],["T_DOC_COMMENT","\/**\n     * Return flag for order if it can sends new email to customer.\n     *\n     * @return bool\n     *\/",480],["T_WHITESPACE","\n    ",484],["T_PUBLIC","public",485],["T_WHITESPACE"," ",485],["T_FUNCTION","function",485],["T_WHITESPACE"," ",485],["T_STRING","getCanSendNewEmailFlag",485],"(",")",["T_WHITESPACE","\n    ",485],"{",["T_WHITESPACE","\n        ",486],["T_RETURN","return",487],["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","_canSendNewEmailFlag",487],";",["T_WHITESPACE","\n    ",487],"}",["T_WHITESPACE","\n\n    ",488],["T_DOC_COMMENT","\/**\n     * Set flag for order if it can sends new email to customer.\n     *\n     * @param bool $flag\n     * @return Mage_Sales_Model_Order\n     *\/",490],["T_WHITESPACE","\n    ",495],["T_PUBLIC","public",496],["T_WHITESPACE"," ",496],["T_FUNCTION","function",496],["T_WHITESPACE"," ",496],["T_STRING","setCanSendNewEmailFlag",496],"(",["T_VARIABLE","$flag",496],")",["T_WHITESPACE","\n    ",496],"{",["T_WHITESPACE","\n        ",497],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","_canSendNewEmailFlag",498],["T_WHITESPACE"," ",498],"=",["T_WHITESPACE"," ",498],["T_BOOL_CAST","(boolean)",498],["T_WHITESPACE"," ",498],["T_VARIABLE","$flag",498],";",["T_WHITESPACE","\n        ",498],["T_RETURN","return",499],["T_WHITESPACE"," ",499],["T_VARIABLE","$this",499],";",["T_WHITESPACE","\n    ",499],"}",["T_WHITESPACE","\n\n    ",500],["T_DOC_COMMENT","\/**\n     * Load order by system increment identifier\n     *\n     * @param string $incrementId\n     * @return Mage_Sales_Model_Order\n     *\/",502],["T_WHITESPACE","\n    ",507],["T_PUBLIC","public",508],["T_WHITESPACE"," ",508],["T_FUNCTION","function",508],["T_WHITESPACE"," ",508],["T_STRING","loadByIncrementId",508],"(",["T_VARIABLE","$incrementId",508],")",["T_WHITESPACE","\n    ",508],"{",["T_WHITESPACE","\n        ",509],["T_RETURN","return",510],["T_WHITESPACE"," ",510],["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","loadByAttribute",510],"(",["T_CONSTANT_ENCAPSED_STRING","'increment_id'",510],",",["T_WHITESPACE"," ",510],["T_VARIABLE","$incrementId",510],")",";",["T_WHITESPACE","\n    ",510],"}",["T_WHITESPACE","\n\n    ",511],["T_DOC_COMMENT","\/**\n     * Load order by custom attribute value. Attribute value should be unique\n     *\n     * @param string $attribute\n     * @param string $value\n     * @return Mage_Sales_Model_Order\n     *\/",513],["T_WHITESPACE","\n    ",519],["T_PUBLIC","public",520],["T_WHITESPACE"," ",520],["T_FUNCTION","function",520],["T_WHITESPACE"," ",520],["T_STRING","loadByAttribute",520],"(",["T_VARIABLE","$attribute",520],",",["T_WHITESPACE"," ",520],["T_VARIABLE","$value",520],")",["T_WHITESPACE","\n    ",520],"{",["T_WHITESPACE","\n        ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","load",522],"(",["T_VARIABLE","$value",522],",",["T_WHITESPACE"," ",522],["T_VARIABLE","$attribute",522],")",";",["T_WHITESPACE","\n        ",522],["T_RETURN","return",523],["T_WHITESPACE"," ",523],["T_VARIABLE","$this",523],";",["T_WHITESPACE","\n    ",523],"}",["T_WHITESPACE","\n\n    ",524],["T_DOC_COMMENT","\/**\n     * Retrieve store model instance\n     *\n     * @return Mage_Core_Model_Store\n     *\/",526],["T_WHITESPACE","\n    ",530],["T_PUBLIC","public",531],["T_WHITESPACE"," ",531],["T_FUNCTION","function",531],["T_WHITESPACE"," ",531],["T_STRING","getStore",531],"(",")",["T_WHITESPACE","\n    ",531],"{",["T_WHITESPACE","\n        ",532],["T_VARIABLE","$storeId",533],["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_VARIABLE","$this",533],["T_OBJECT_OPERATOR","->",533],["T_STRING","getStoreId",533],"(",")",";",["T_WHITESPACE","\n        ",533],["T_IF","if",534],["T_WHITESPACE"," ",534],"(",["T_VARIABLE","$storeId",534],")",["T_WHITESPACE"," ",534],"{",["T_WHITESPACE","\n            ",534],["T_RETURN","return",535],["T_WHITESPACE"," ",535],["T_STRING","Mage",535],["T_DOUBLE_COLON","::",535],["T_STRING","app",535],"(",")",["T_OBJECT_OPERATOR","->",535],["T_STRING","getStore",535],"(",["T_VARIABLE","$storeId",535],")",";",["T_WHITESPACE","\n        ",535],"}",["T_WHITESPACE","\n        ",536],["T_RETURN","return",537],["T_WHITESPACE"," ",537],["T_STRING","Mage",537],["T_DOUBLE_COLON","::",537],["T_STRING","app",537],"(",")",["T_OBJECT_OPERATOR","->",537],["T_STRING","getStore",537],"(",")",";",["T_WHITESPACE","\n    ",537],"}",["T_WHITESPACE","\n\n    ",538],["T_DOC_COMMENT","\/**\n     * Retrieve order cancel availability\n     *\n     * @return bool\n     *\/",540],["T_WHITESPACE","\n    ",544],["T_PUBLIC","public",545],["T_WHITESPACE"," ",545],["T_FUNCTION","function",545],["T_WHITESPACE"," ",545],["T_STRING","canCancel",545],"(",")",["T_WHITESPACE","\n    ",545],"{",["T_WHITESPACE","\n        ",546],["T_IF","if",547],["T_WHITESPACE"," ",547],"(","!",["T_VARIABLE","$this",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","_canVoidOrder",547],"(",")",")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n            ",547],["T_RETURN","return",548],["T_WHITESPACE"," ",548],["T_STRING","false",548],";",["T_WHITESPACE","\n        ",548],"}",["T_WHITESPACE","\n        ",549],["T_IF","if",550],["T_WHITESPACE"," ",550],"(",["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","canUnhold",550],"(",")",")",["T_WHITESPACE"," ",550],"{",["T_WHITESPACE","  ",550],["T_COMMENT","\/\/ $this->isPaymentReview()\n",550],["T_WHITESPACE","            ",551],["T_RETURN","return",551],["T_WHITESPACE"," ",551],["T_STRING","false",551],";",["T_WHITESPACE","\n        ",551],"}",["T_WHITESPACE","\n\n        ",552],["T_VARIABLE","$allInvoiced",554],["T_WHITESPACE"," ",554],"=",["T_WHITESPACE"," ",554],["T_STRING","true",554],";",["T_WHITESPACE","\n        ",554],["T_FOREACH","foreach",555],["T_WHITESPACE"," ",555],"(",["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","getAllItems",555],"(",")",["T_WHITESPACE"," ",555],["T_AS","as",555],["T_WHITESPACE"," ",555],["T_VARIABLE","$item",555],")",["T_WHITESPACE"," ",555],"{",["T_WHITESPACE","\n            ",555],["T_IF","if",556],["T_WHITESPACE"," ",556],"(",["T_VARIABLE","$item",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","getQtyToInvoice",556],"(",")",")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n                ",556],["T_VARIABLE","$allInvoiced",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_STRING","false",557],";",["T_WHITESPACE","\n                ",557],["T_BREAK","break",558],";",["T_WHITESPACE","\n            ",558],"}",["T_WHITESPACE","\n        ",559],"}",["T_WHITESPACE","\n        ",560],["T_IF","if",561],["T_WHITESPACE"," ",561],"(",["T_VARIABLE","$allInvoiced",561],")",["T_WHITESPACE"," ",561],"{",["T_WHITESPACE","\n            ",561],["T_RETURN","return",562],["T_WHITESPACE"," ",562],["T_STRING","false",562],";",["T_WHITESPACE","\n        ",562],"}",["T_WHITESPACE","\n\n        ",563],["T_VARIABLE","$state",565],["T_WHITESPACE"," ",565],"=",["T_WHITESPACE"," ",565],["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","getState",565],"(",")",";",["T_WHITESPACE","\n        ",565],["T_IF","if",566],["T_WHITESPACE"," ",566],"(",["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","isCanceled",566],"(",")",["T_WHITESPACE"," ",566],["T_BOOLEAN_OR","||",566],["T_WHITESPACE"," ",566],["T_VARIABLE","$state",566],["T_WHITESPACE"," ",566],["T_IS_IDENTICAL","===",566],["T_WHITESPACE"," ",566],["T_STRING","self",566],["T_DOUBLE_COLON","::",566],["T_STRING","STATE_COMPLETE",566],["T_WHITESPACE"," ",566],["T_BOOLEAN_OR","||",566],["T_WHITESPACE"," ",566],["T_VARIABLE","$state",566],["T_WHITESPACE"," ",566],["T_IS_IDENTICAL","===",566],["T_WHITESPACE"," ",566],["T_STRING","self",566],["T_DOUBLE_COLON","::",566],["T_STRING","STATE_CLOSED",566],")",["T_WHITESPACE"," ",566],"{",["T_WHITESPACE","\n            ",566],["T_RETURN","return",567],["T_WHITESPACE"," ",567],["T_STRING","false",567],";",["T_WHITESPACE","\n        ",567],"}",["T_WHITESPACE","\n\n        ",568],["T_IF","if",570],["T_WHITESPACE"," ",570],"(",["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","getActionFlag",570],"(",["T_STRING","self",570],["T_DOUBLE_COLON","::",570],["T_STRING","ACTION_FLAG_CANCEL",570],")",["T_WHITESPACE"," ",570],["T_IS_IDENTICAL","===",570],["T_WHITESPACE"," ",570],["T_STRING","false",570],")",["T_WHITESPACE"," ",570],"{",["T_WHITESPACE","\n            ",570],["T_RETURN","return",571],["T_WHITESPACE"," ",571],["T_STRING","false",571],";",["T_WHITESPACE","\n        ",571],"}",["T_WHITESPACE","\n        ",572],["T_DOC_COMMENT","\/**\n         * Use only state for availability detect\n         *\/",573],["T_WHITESPACE","\n        ",575],["T_COMMENT","\/*foreach ($this->getAllItems() as $item) {\n            if ($item->getQtyToCancel()>0) {\n                return true;\n            }\n        }\n        return false;*\/",576],["T_WHITESPACE","\n        ",581],["T_RETURN","return",582],["T_WHITESPACE"," ",582],["T_STRING","true",582],";",["T_WHITESPACE","\n    ",582],"}",["T_WHITESPACE","\n\n    ",583],["T_DOC_COMMENT","\/**\n     * Getter whether the payment can be voided\n     *\n     * @return bool\n     *\/",585],["T_WHITESPACE","\n    ",589],["T_PUBLIC","public",590],["T_WHITESPACE"," ",590],["T_FUNCTION","function",590],["T_WHITESPACE"," ",590],["T_STRING","canVoidPayment",590],"(",")",["T_WHITESPACE","\n    ",590],"{",["T_WHITESPACE","\n        ",591],["T_RETURN","return",592],["T_WHITESPACE"," ",592],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","_canVoidOrder",592],"(",")",["T_WHITESPACE"," ",592],"?",["T_WHITESPACE"," ",592],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","getPayment",592],"(",")",["T_OBJECT_OPERATOR","->",592],["T_STRING","canVoid",592],"(",["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","getPayment",592],"(",")",")",["T_WHITESPACE"," ",592],":",["T_WHITESPACE"," ",592],["T_STRING","false",592],";",["T_WHITESPACE","\n    ",592],"}",["T_WHITESPACE","\n\n    ",593],["T_DOC_COMMENT","\/**\n     * Check whether order could be canceled by states and flags\n     *\n     * @return bool\n     *\/",595],["T_WHITESPACE","\n    ",599],["T_PROTECTED","protected",600],["T_WHITESPACE"," ",600],["T_FUNCTION","function",600],["T_WHITESPACE"," ",600],["T_STRING","_canVoidOrder",600],"(",")",["T_WHITESPACE","\n    ",600],"{",["T_WHITESPACE","\n        ",601],["T_IF","if",602],["T_WHITESPACE"," ",602],"(",["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","canUnhold",602],"(",")",["T_WHITESPACE"," ",602],["T_BOOLEAN_OR","||",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","isPaymentReview",602],"(",")",")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n            ",602],["T_RETURN","return",603],["T_WHITESPACE"," ",603],["T_STRING","false",603],";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE","\n        ",604],["T_RETURN","return",605],["T_WHITESPACE"," ",605],["T_STRING","true",605],";",["T_WHITESPACE","\n    ",605],"}",["T_WHITESPACE","\n\n    ",606],["T_DOC_COMMENT","\/**\n     * Retrieve order invoice availability\n     *\n     * @return bool\n     *\/",608],["T_WHITESPACE","\n    ",612],["T_PUBLIC","public",613],["T_WHITESPACE"," ",613],["T_FUNCTION","function",613],["T_WHITESPACE"," ",613],["T_STRING","canInvoice",613],"(",")",["T_WHITESPACE","\n    ",613],"{",["T_WHITESPACE","\n        ",614],["T_IF","if",615],["T_WHITESPACE"," ",615],"(",["T_VARIABLE","$this",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","canUnhold",615],"(",")",["T_WHITESPACE"," ",615],["T_BOOLEAN_OR","||",615],["T_WHITESPACE"," ",615],["T_VARIABLE","$this",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","isPaymentReview",615],"(",")",")",["T_WHITESPACE"," ",615],"{",["T_WHITESPACE","\n            ",615],["T_RETURN","return",616],["T_WHITESPACE"," ",616],["T_STRING","false",616],";",["T_WHITESPACE","\n        ",616],"}",["T_WHITESPACE","\n        ",617],["T_VARIABLE","$state",618],["T_WHITESPACE"," ",618],"=",["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","getState",618],"(",")",";",["T_WHITESPACE","\n        ",618],["T_IF","if",619],["T_WHITESPACE"," ",619],"(",["T_VARIABLE","$this",619],["T_OBJECT_OPERATOR","->",619],["T_STRING","isCanceled",619],"(",")",["T_WHITESPACE"," ",619],["T_BOOLEAN_OR","||",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$state",619],["T_WHITESPACE"," ",619],["T_IS_IDENTICAL","===",619],["T_WHITESPACE"," ",619],["T_STRING","self",619],["T_DOUBLE_COLON","::",619],["T_STRING","STATE_COMPLETE",619],["T_WHITESPACE"," ",619],["T_BOOLEAN_OR","||",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$state",619],["T_WHITESPACE"," ",619],["T_IS_IDENTICAL","===",619],["T_WHITESPACE"," ",619],["T_STRING","self",619],["T_DOUBLE_COLON","::",619],["T_STRING","STATE_CLOSED",619],")",["T_WHITESPACE"," ",619],"{",["T_WHITESPACE","\n            ",619],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_STRING","false",620],";",["T_WHITESPACE","\n        ",620],"}",["T_WHITESPACE","\n\n        ",621],["T_IF","if",623],["T_WHITESPACE"," ",623],"(",["T_VARIABLE","$this",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","getActionFlag",623],"(",["T_STRING","self",623],["T_DOUBLE_COLON","::",623],["T_STRING","ACTION_FLAG_INVOICE",623],")",["T_WHITESPACE"," ",623],["T_IS_IDENTICAL","===",623],["T_WHITESPACE"," ",623],["T_STRING","false",623],")",["T_WHITESPACE"," ",623],"{",["T_WHITESPACE","\n            ",623],["T_RETURN","return",624],["T_WHITESPACE"," ",624],["T_STRING","false",624],";",["T_WHITESPACE","\n        ",624],"}",["T_WHITESPACE","\n\n        ",625],["T_FOREACH","foreach",627],["T_WHITESPACE"," ",627],"(",["T_VARIABLE","$this",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","getAllItems",627],"(",")",["T_WHITESPACE"," ",627],["T_AS","as",627],["T_WHITESPACE"," ",627],["T_VARIABLE","$item",627],")",["T_WHITESPACE"," ",627],"{",["T_WHITESPACE","\n            ",627],["T_IF","if",628],["T_WHITESPACE"," ",628],"(",["T_VARIABLE","$item",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","getQtyToInvoice",628],"(",")",">",["T_LNUMBER","0",628],["T_WHITESPACE"," ",628],["T_BOOLEAN_AND","&&",628],["T_WHITESPACE"," ",628],"!",["T_VARIABLE","$item",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","getLockedDoInvoice",628],"(",")",")",["T_WHITESPACE"," ",628],"{",["T_WHITESPACE","\n                ",628],["T_RETURN","return",629],["T_WHITESPACE"," ",629],["T_STRING","true",629],";",["T_WHITESPACE","\n            ",629],"}",["T_WHITESPACE","\n        ",630],"}",["T_WHITESPACE","\n        ",631],["T_RETURN","return",632],["T_WHITESPACE"," ",632],["T_STRING","false",632],";",["T_WHITESPACE","\n    ",632],"}",["T_WHITESPACE","\n\n    ",633],["T_DOC_COMMENT","\/**\n     * Retrieve order credit memo (refund) availability\n     *\n     * @return bool\n     *\/",635],["T_WHITESPACE","\n    ",639],["T_PUBLIC","public",640],["T_WHITESPACE"," ",640],["T_FUNCTION","function",640],["T_WHITESPACE"," ",640],["T_STRING","canCreditmemo",640],"(",")",["T_WHITESPACE","\n    ",640],"{",["T_WHITESPACE","\n        ",641],["T_IF","if",642],["T_WHITESPACE"," ",642],"(",["T_VARIABLE","$this",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","hasForcedCanCreditmemo",642],"(",")",")",["T_WHITESPACE"," ",642],"{",["T_WHITESPACE","\n            ",642],["T_RETURN","return",643],["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","getForcedCanCreditmemo",643],"(",")",";",["T_WHITESPACE","\n        ",643],"}",["T_WHITESPACE","\n\n        ",644],["T_IF","if",646],["T_WHITESPACE"," ",646],"(",["T_VARIABLE","$this",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","canUnhold",646],"(",")",["T_WHITESPACE"," ",646],["T_BOOLEAN_OR","||",646],["T_WHITESPACE"," ",646],["T_VARIABLE","$this",646],["T_OBJECT_OPERATOR","->",646],["T_STRING","isPaymentReview",646],"(",")",")",["T_WHITESPACE"," ",646],"{",["T_WHITESPACE","\n            ",646],["T_RETURN","return",647],["T_WHITESPACE"," ",647],["T_STRING","false",647],";",["T_WHITESPACE","\n        ",647],"}",["T_WHITESPACE","\n\n        ",648],["T_IF","if",650],["T_WHITESPACE"," ",650],"(",["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","isCanceled",650],"(",")",["T_WHITESPACE"," ",650],["T_BOOLEAN_OR","||",650],["T_WHITESPACE"," ",650],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getState",650],"(",")",["T_WHITESPACE"," ",650],["T_IS_IDENTICAL","===",650],["T_WHITESPACE"," ",650],["T_STRING","self",650],["T_DOUBLE_COLON","::",650],["T_STRING","STATE_CLOSED",650],")",["T_WHITESPACE"," ",650],"{",["T_WHITESPACE","\n            ",650],["T_RETURN","return",651],["T_WHITESPACE"," ",651],["T_STRING","false",651],";",["T_WHITESPACE","\n        ",651],"}",["T_WHITESPACE","\n\n        ",652],["T_DOC_COMMENT","\/**\n         * We can have problem with float in php (on some server $a=762.73;$b=762.73; $a-$b!=0)\n         * for this we have additional diapason for 0\n         * TotalPaid - contains amount, that were not rounded.\n         *\/",654],["T_WHITESPACE","\n        ",658],["T_IF","if",659],["T_WHITESPACE"," ",659],"(",["T_STRING","abs",659],"(",["T_VARIABLE","$this",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","getStore",659],"(",")",["T_OBJECT_OPERATOR","->",659],["T_STRING","roundPrice",659],"(",["T_VARIABLE","$this",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","getTotalPaid",659],"(",")",")",["T_WHITESPACE"," ",659],"-",["T_WHITESPACE"," ",659],["T_VARIABLE","$this",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","getTotalRefunded",659],"(",")",")",["T_WHITESPACE"," ",659],"<",["T_WHITESPACE"," ",659],["T_DNUMBER",".0001",659],")",["T_WHITESPACE"," ",659],"{",["T_WHITESPACE","\n            ",659],["T_RETURN","return",660],["T_WHITESPACE"," ",660],["T_STRING","false",660],";",["T_WHITESPACE","\n        ",660],"}",["T_WHITESPACE","\n\n        ",661],["T_IF","if",663],["T_WHITESPACE"," ",663],"(",["T_VARIABLE","$this",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","getActionFlag",663],"(",["T_STRING","self",663],["T_DOUBLE_COLON","::",663],["T_STRING","ACTION_FLAG_EDIT",663],")",["T_WHITESPACE"," ",663],["T_IS_IDENTICAL","===",663],["T_WHITESPACE"," ",663],["T_STRING","false",663],")",["T_WHITESPACE"," ",663],"{",["T_WHITESPACE","\n            ",663],["T_RETURN","return",664],["T_WHITESPACE"," ",664],["T_STRING","false",664],";",["T_WHITESPACE","\n        ",664],"}",["T_WHITESPACE","\n        ",665],["T_RETURN","return",666],["T_WHITESPACE"," ",666],["T_STRING","true",666],";",["T_WHITESPACE","\n    ",666],"}",["T_WHITESPACE","\n\n    ",667],["T_DOC_COMMENT","\/**\n     * Retrieve order hold availability\n     *\n     * @return bool\n     *\/",669],["T_WHITESPACE","\n    ",673],["T_PUBLIC","public",674],["T_WHITESPACE"," ",674],["T_FUNCTION","function",674],["T_WHITESPACE"," ",674],["T_STRING","canHold",674],"(",")",["T_WHITESPACE","\n    ",674],"{",["T_WHITESPACE","\n        ",675],["T_VARIABLE","$state",676],["T_WHITESPACE"," ",676],"=",["T_WHITESPACE"," ",676],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getState",676],"(",")",";",["T_WHITESPACE","\n        ",676],["T_IF","if",677],["T_WHITESPACE"," ",677],"(",["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","isCanceled",677],"(",")",["T_WHITESPACE"," ",677],["T_BOOLEAN_OR","||",677],["T_WHITESPACE"," ",677],["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","isPaymentReview",677],"(",")",["T_WHITESPACE","\n            ",677],["T_BOOLEAN_OR","||",678],["T_WHITESPACE"," ",678],["T_VARIABLE","$state",678],["T_WHITESPACE"," ",678],["T_IS_IDENTICAL","===",678],["T_WHITESPACE"," ",678],["T_STRING","self",678],["T_DOUBLE_COLON","::",678],["T_STRING","STATE_COMPLETE",678],["T_WHITESPACE"," ",678],["T_BOOLEAN_OR","||",678],["T_WHITESPACE"," ",678],["T_VARIABLE","$state",678],["T_WHITESPACE"," ",678],["T_IS_IDENTICAL","===",678],["T_WHITESPACE"," ",678],["T_STRING","self",678],["T_DOUBLE_COLON","::",678],["T_STRING","STATE_CLOSED",678],["T_WHITESPACE"," ",678],["T_BOOLEAN_OR","||",678],["T_WHITESPACE"," ",678],["T_VARIABLE","$state",678],["T_WHITESPACE"," ",678],["T_IS_IDENTICAL","===",678],["T_WHITESPACE"," ",678],["T_STRING","self",678],["T_DOUBLE_COLON","::",678],["T_STRING","STATE_HOLDED",678],")",["T_WHITESPACE"," ",678],"{",["T_WHITESPACE","\n            ",678],["T_RETURN","return",679],["T_WHITESPACE"," ",679],["T_STRING","false",679],";",["T_WHITESPACE","\n        ",679],"}",["T_WHITESPACE","\n\n        ",680],["T_IF","if",682],["T_WHITESPACE"," ",682],"(",["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getActionFlag",682],"(",["T_STRING","self",682],["T_DOUBLE_COLON","::",682],["T_STRING","ACTION_FLAG_HOLD",682],")",["T_WHITESPACE"," ",682],["T_IS_IDENTICAL","===",682],["T_WHITESPACE"," ",682],["T_STRING","false",682],")",["T_WHITESPACE"," ",682],"{",["T_WHITESPACE","\n            ",682],["T_RETURN","return",683],["T_WHITESPACE"," ",683],["T_STRING","false",683],";",["T_WHITESPACE","\n        ",683],"}",["T_WHITESPACE","\n        ",684],["T_RETURN","return",685],["T_WHITESPACE"," ",685],["T_STRING","true",685],";",["T_WHITESPACE","\n    ",685],"}",["T_WHITESPACE","\n\n    ",686],["T_DOC_COMMENT","\/**\n     * Retrieve order unhold availability\n     *\n     * @return bool\n     *\/",688],["T_WHITESPACE","\n    ",692],["T_PUBLIC","public",693],["T_WHITESPACE"," ",693],["T_FUNCTION","function",693],["T_WHITESPACE"," ",693],["T_STRING","canUnhold",693],"(",")",["T_WHITESPACE","\n    ",693],"{",["T_WHITESPACE","\n        ",694],["T_IF","if",695],["T_WHITESPACE"," ",695],"(",["T_VARIABLE","$this",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","getActionFlag",695],"(",["T_STRING","self",695],["T_DOUBLE_COLON","::",695],["T_STRING","ACTION_FLAG_UNHOLD",695],")",["T_WHITESPACE"," ",695],["T_IS_IDENTICAL","===",695],["T_WHITESPACE"," ",695],["T_STRING","false",695],["T_WHITESPACE"," ",695],["T_BOOLEAN_OR","||",695],["T_WHITESPACE"," ",695],["T_VARIABLE","$this",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","isPaymentReview",695],"(",")",")",["T_WHITESPACE"," ",695],"{",["T_WHITESPACE","\n            ",695],["T_RETURN","return",696],["T_WHITESPACE"," ",696],["T_STRING","false",696],";",["T_WHITESPACE","\n        ",696],"}",["T_WHITESPACE","\n        ",697],["T_RETURN","return",698],["T_WHITESPACE"," ",698],["T_VARIABLE","$this",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","getState",698],"(",")",["T_WHITESPACE"," ",698],["T_IS_IDENTICAL","===",698],["T_WHITESPACE"," ",698],["T_STRING","self",698],["T_DOUBLE_COLON","::",698],["T_STRING","STATE_HOLDED",698],";",["T_WHITESPACE","\n    ",698],"}",["T_WHITESPACE","\n\n    ",699],["T_DOC_COMMENT","\/**\n     * Check if comment can be added to order history\n     *\n     * @return bool\n     *\/",701],["T_WHITESPACE","\n    ",705],["T_PUBLIC","public",706],["T_WHITESPACE"," ",706],["T_FUNCTION","function",706],["T_WHITESPACE"," ",706],["T_STRING","canComment",706],"(",")",["T_WHITESPACE","\n    ",706],"{",["T_WHITESPACE","\n        ",707],["T_IF","if",708],["T_WHITESPACE"," ",708],"(",["T_VARIABLE","$this",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","getActionFlag",708],"(",["T_STRING","self",708],["T_DOUBLE_COLON","::",708],["T_STRING","ACTION_FLAG_COMMENT",708],")",["T_WHITESPACE"," ",708],["T_IS_IDENTICAL","===",708],["T_WHITESPACE"," ",708],["T_STRING","false",708],")",["T_WHITESPACE"," ",708],"{",["T_WHITESPACE","\n            ",708],["T_RETURN","return",709],["T_WHITESPACE"," ",709],["T_STRING","false",709],";",["T_WHITESPACE","\n        ",709],"}",["T_WHITESPACE","\n        ",710],["T_RETURN","return",711],["T_WHITESPACE"," ",711],["T_STRING","true",711],";",["T_WHITESPACE","\n    ",711],"}",["T_WHITESPACE","\n\n    ",712],["T_DOC_COMMENT","\/**\n     * Retrieve order shipment availability\n     *\n     * @return bool\n     *\/",714],["T_WHITESPACE","\n    ",718],["T_PUBLIC","public",719],["T_WHITESPACE"," ",719],["T_FUNCTION","function",719],["T_WHITESPACE"," ",719],["T_STRING","canShip",719],"(",")",["T_WHITESPACE","\n    ",719],"{",["T_WHITESPACE","\n        ",720],["T_IF","if",721],["T_WHITESPACE"," ",721],"(",["T_VARIABLE","$this",721],["T_OBJECT_OPERATOR","->",721],["T_STRING","canUnhold",721],"(",")",["T_WHITESPACE"," ",721],["T_BOOLEAN_OR","||",721],["T_WHITESPACE"," ",721],["T_VARIABLE","$this",721],["T_OBJECT_OPERATOR","->",721],["T_STRING","isPaymentReview",721],"(",")",")",["T_WHITESPACE"," ",721],"{",["T_WHITESPACE","\n            ",721],["T_RETURN","return",722],["T_WHITESPACE"," ",722],["T_STRING","false",722],";",["T_WHITESPACE","\n        ",722],"}",["T_WHITESPACE","\n\n        ",723],["T_IF","if",725],["T_WHITESPACE"," ",725],"(",["T_VARIABLE","$this",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","getIsVirtual",725],"(",")",["T_WHITESPACE"," ",725],["T_BOOLEAN_OR","||",725],["T_WHITESPACE"," ",725],["T_VARIABLE","$this",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","isCanceled",725],"(",")",")",["T_WHITESPACE"," ",725],"{",["T_WHITESPACE","\n            ",725],["T_RETURN","return",726],["T_WHITESPACE"," ",726],["T_STRING","false",726],";",["T_WHITESPACE","\n        ",726],"}",["T_WHITESPACE","\n\n        ",727],["T_IF","if",729],["T_WHITESPACE"," ",729],"(",["T_VARIABLE","$this",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","getActionFlag",729],"(",["T_STRING","self",729],["T_DOUBLE_COLON","::",729],["T_STRING","ACTION_FLAG_SHIP",729],")",["T_WHITESPACE"," ",729],["T_IS_IDENTICAL","===",729],["T_WHITESPACE"," ",729],["T_STRING","false",729],")",["T_WHITESPACE"," ",729],"{",["T_WHITESPACE","\n            ",729],["T_RETURN","return",730],["T_WHITESPACE"," ",730],["T_STRING","false",730],";",["T_WHITESPACE","\n        ",730],"}",["T_WHITESPACE","\n\n        ",731],["T_FOREACH","foreach",733],["T_WHITESPACE"," ",733],"(",["T_VARIABLE","$this",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","getAllItems",733],"(",")",["T_WHITESPACE"," ",733],["T_AS","as",733],["T_WHITESPACE"," ",733],["T_VARIABLE","$item",733],")",["T_WHITESPACE"," ",733],"{",["T_WHITESPACE","\n            ",733],["T_IF","if",734],["T_WHITESPACE"," ",734],"(",["T_VARIABLE","$item",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","getQtyToShip",734],"(",")",">",["T_LNUMBER","0",734],["T_WHITESPACE"," ",734],["T_BOOLEAN_AND","&&",734],["T_WHITESPACE"," ",734],"!",["T_VARIABLE","$item",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","getIsVirtual",734],"(",")",["T_WHITESPACE","\n                ",734],["T_BOOLEAN_AND","&&",735],["T_WHITESPACE"," ",735],"!",["T_VARIABLE","$item",735],["T_OBJECT_OPERATOR","->",735],["T_STRING","getLockedDoShip",735],"(",")",")",["T_WHITESPACE","\n            ",735],"{",["T_WHITESPACE","\n                ",736],["T_RETURN","return",737],["T_WHITESPACE"," ",737],["T_STRING","true",737],";",["T_WHITESPACE","\n            ",737],"}",["T_WHITESPACE","\n        ",738],"}",["T_WHITESPACE","\n        ",739],["T_RETURN","return",740],["T_WHITESPACE"," ",740],["T_STRING","false",740],";",["T_WHITESPACE","\n    ",740],"}",["T_WHITESPACE","\n\n    ",741],["T_DOC_COMMENT","\/**\n     * Retrieve order edit availability\n     *\n     * @return bool\n     *\/",743],["T_WHITESPACE","\n    ",747],["T_PUBLIC","public",748],["T_WHITESPACE"," ",748],["T_FUNCTION","function",748],["T_WHITESPACE"," ",748],["T_STRING","canEdit",748],"(",")",["T_WHITESPACE","\n    ",748],"{",["T_WHITESPACE","\n        ",749],["T_IF","if",750],["T_WHITESPACE"," ",750],"(",["T_VARIABLE","$this",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","canUnhold",750],"(",")",")",["T_WHITESPACE"," ",750],"{",["T_WHITESPACE","\n            ",750],["T_RETURN","return",751],["T_WHITESPACE"," ",751],["T_STRING","false",751],";",["T_WHITESPACE","\n        ",751],"}",["T_WHITESPACE","\n\n        ",752],["T_VARIABLE","$state",754],["T_WHITESPACE"," ",754],"=",["T_WHITESPACE"," ",754],["T_VARIABLE","$this",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","getState",754],"(",")",";",["T_WHITESPACE","\n        ",754],["T_IF","if",755],["T_WHITESPACE"," ",755],"(",["T_VARIABLE","$this",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","isCanceled",755],"(",")",["T_WHITESPACE"," ",755],["T_BOOLEAN_OR","||",755],["T_WHITESPACE"," ",755],["T_VARIABLE","$this",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","isPaymentReview",755],"(",")",["T_WHITESPACE","\n            ",755],["T_BOOLEAN_OR","||",756],["T_WHITESPACE"," ",756],["T_VARIABLE","$state",756],["T_WHITESPACE"," ",756],["T_IS_IDENTICAL","===",756],["T_WHITESPACE"," ",756],["T_STRING","self",756],["T_DOUBLE_COLON","::",756],["T_STRING","STATE_COMPLETE",756],["T_WHITESPACE"," ",756],["T_BOOLEAN_OR","||",756],["T_WHITESPACE"," ",756],["T_VARIABLE","$state",756],["T_WHITESPACE"," ",756],["T_IS_IDENTICAL","===",756],["T_WHITESPACE"," ",756],["T_STRING","self",756],["T_DOUBLE_COLON","::",756],["T_STRING","STATE_CLOSED",756],")",["T_WHITESPACE"," ",756],"{",["T_WHITESPACE","\n            ",756],["T_RETURN","return",757],["T_WHITESPACE"," ",757],["T_STRING","false",757],";",["T_WHITESPACE","\n        ",757],"}",["T_WHITESPACE","\n\n        ",758],["T_IF","if",760],["T_WHITESPACE"," ",760],"(","!",["T_VARIABLE","$this",760],["T_OBJECT_OPERATOR","->",760],["T_STRING","getPayment",760],"(",")",["T_OBJECT_OPERATOR","->",760],["T_STRING","getMethodInstance",760],"(",")",["T_OBJECT_OPERATOR","->",760],["T_STRING","canEdit",760],"(",")",")",["T_WHITESPACE"," ",760],"{",["T_WHITESPACE","\n            ",760],["T_RETURN","return",761],["T_WHITESPACE"," ",761],["T_STRING","false",761],";",["T_WHITESPACE","\n        ",761],"}",["T_WHITESPACE","\n\n        ",762],["T_IF","if",764],["T_WHITESPACE"," ",764],"(",["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","getActionFlag",764],"(",["T_STRING","self",764],["T_DOUBLE_COLON","::",764],["T_STRING","ACTION_FLAG_EDIT",764],")",["T_WHITESPACE"," ",764],["T_IS_IDENTICAL","===",764],["T_WHITESPACE"," ",764],["T_STRING","false",764],")",["T_WHITESPACE"," ",764],"{",["T_WHITESPACE","\n            ",764],["T_RETURN","return",765],["T_WHITESPACE"," ",765],["T_STRING","false",765],";",["T_WHITESPACE","\n        ",765],"}",["T_WHITESPACE","\n\n        ",766],["T_RETURN","return",768],["T_WHITESPACE"," ",768],["T_STRING","true",768],";",["T_WHITESPACE","\n    ",768],"}",["T_WHITESPACE","\n\n    ",769],["T_DOC_COMMENT","\/**\n     * Retrieve order reorder availability\n     *\n     * @return bool\n     *\/",771],["T_WHITESPACE","\n    ",775],["T_PUBLIC","public",776],["T_WHITESPACE"," ",776],["T_FUNCTION","function",776],["T_WHITESPACE"," ",776],["T_STRING","canReorder",776],"(",")",["T_WHITESPACE","\n    ",776],"{",["T_WHITESPACE","\n        ",777],["T_RETURN","return",778],["T_WHITESPACE"," ",778],["T_VARIABLE","$this",778],["T_OBJECT_OPERATOR","->",778],["T_STRING","_canReorder",778],"(",["T_STRING","false",778],")",";",["T_WHITESPACE","\n    ",778],"}",["T_WHITESPACE","\n\n    ",779],["T_DOC_COMMENT","\/**\n     * Check the ability to reorder ignoring the availability in stock or status of the ordered products\n     *\n     * @return bool\n     *\/",781],["T_WHITESPACE","\n    ",785],["T_PUBLIC","public",786],["T_WHITESPACE"," ",786],["T_FUNCTION","function",786],["T_WHITESPACE"," ",786],["T_STRING","canReorderIgnoreSalable",786],"(",")",["T_WHITESPACE","\n    ",786],"{",["T_WHITESPACE","\n        ",787],["T_RETURN","return",788],["T_WHITESPACE"," ",788],["T_VARIABLE","$this",788],["T_OBJECT_OPERATOR","->",788],["T_STRING","_canReorder",788],"(",["T_STRING","true",788],")",";",["T_WHITESPACE","\n    ",788],"}",["T_WHITESPACE","\n\n    ",789],["T_DOC_COMMENT","\/**\n     * Retrieve order reorder availability\n     *\n     * @param bool $ignoreSalable\n     * @return bool\n     *\/",791],["T_WHITESPACE","\n    ",796],["T_PROTECTED","protected",797],["T_WHITESPACE"," ",797],["T_FUNCTION","function",797],["T_WHITESPACE"," ",797],["T_STRING","_canReorder",797],"(",["T_VARIABLE","$ignoreSalable",797],["T_WHITESPACE"," ",797],"=",["T_WHITESPACE"," ",797],["T_STRING","false",797],")",["T_WHITESPACE","\n    ",797],"{",["T_WHITESPACE","\n        ",798],["T_IF","if",799],["T_WHITESPACE"," ",799],"(",["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","canUnhold",799],"(",")",["T_WHITESPACE"," ",799],["T_BOOLEAN_OR","||",799],["T_WHITESPACE"," ",799],["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","isPaymentReview",799],"(",")",["T_WHITESPACE"," ",799],["T_BOOLEAN_OR","||",799],["T_WHITESPACE"," ",799],"!",["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","getCustomerId",799],"(",")",")",["T_WHITESPACE"," ",799],"{",["T_WHITESPACE","\n            ",799],["T_RETURN","return",800],["T_WHITESPACE"," ",800],["T_STRING","false",800],";",["T_WHITESPACE","\n        ",800],"}",["T_WHITESPACE","\n\n        ",801],["T_IF","if",803],["T_WHITESPACE"," ",803],"(",["T_VARIABLE","$this",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","getActionFlag",803],"(",["T_STRING","self",803],["T_DOUBLE_COLON","::",803],["T_STRING","ACTION_FLAG_REORDER",803],")",["T_WHITESPACE"," ",803],["T_IS_IDENTICAL","===",803],["T_WHITESPACE"," ",803],["T_STRING","false",803],")",["T_WHITESPACE"," ",803],"{",["T_WHITESPACE","\n            ",803],["T_RETURN","return",804],["T_WHITESPACE"," ",804],["T_STRING","false",804],";",["T_WHITESPACE","\n        ",804],"}",["T_WHITESPACE","\n\n        ",805],["T_VARIABLE","$products",807],["T_WHITESPACE"," ",807],"=",["T_WHITESPACE"," ",807],["T_ARRAY","array",807],"(",")",";",["T_WHITESPACE","\n        ",807],["T_FOREACH","foreach",808],["T_WHITESPACE"," ",808],"(",["T_VARIABLE","$this",808],["T_OBJECT_OPERATOR","->",808],["T_STRING","getItemsCollection",808],"(",")",["T_WHITESPACE"," ",808],["T_AS","as",808],["T_WHITESPACE"," ",808],["T_VARIABLE","$item",808],")",["T_WHITESPACE"," ",808],"{",["T_WHITESPACE","\n            ",808],["T_VARIABLE","$products",809],"[","]",["T_WHITESPACE"," ",809],"=",["T_WHITESPACE"," ",809],["T_VARIABLE","$item",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getProductId",809],"(",")",";",["T_WHITESPACE","\n        ",809],"}",["T_WHITESPACE","\n\n        ",810],["T_IF","if",812],["T_WHITESPACE"," ",812],"(","!",["T_EMPTY","empty",812],"(",["T_VARIABLE","$products",812],")",")",["T_WHITESPACE"," ",812],"{",["T_WHITESPACE","\n            ",812],["T_COMMENT","\/*\n             * @TODO ACPAOC: Use product collection here, but ensure that product\n             * is loaded with order store id, otherwise there'll be problems with isSalable()\n             * for configurables, bundles and other composites\n             *\n             *\/",813],["T_WHITESPACE","\n            ",818],["T_COMMENT","\/*\n            $productsCollection = Mage::getModel('catalog\/product')->getCollection()\n                ->setStoreId($this->getStoreId())\n                ->addIdFilter($products)\n                ->addAttributeToSelect('status')\n                ->load();\n\n            foreach ($productsCollection as $product) {\n                if (!$product->isSalable()) {\n                    return false;\n                }\n            }\n            *\/",819],["T_WHITESPACE","\n\n            ",831],["T_FOREACH","foreach",833],["T_WHITESPACE"," ",833],"(",["T_VARIABLE","$products",833],["T_WHITESPACE"," ",833],["T_AS","as",833],["T_WHITESPACE"," ",833],["T_VARIABLE","$productId",833],")",["T_WHITESPACE"," ",833],"{",["T_WHITESPACE","\n                    ",833],["T_VARIABLE","$product",834],["T_WHITESPACE"," ",834],"=",["T_WHITESPACE"," ",834],["T_STRING","Mage",834],["T_DOUBLE_COLON","::",834],["T_STRING","getModel",834],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",834],")",["T_WHITESPACE","\n                        ",834],["T_OBJECT_OPERATOR","->",835],["T_STRING","setStoreId",835],"(",["T_VARIABLE","$this",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","getStoreId",835],"(",")",")",["T_WHITESPACE","\n                        ",835],["T_OBJECT_OPERATOR","->",836],["T_STRING","load",836],"(",["T_VARIABLE","$productId",836],")",";",["T_WHITESPACE","\n                ",836],"}",["T_WHITESPACE","\n                ",837],["T_IF","if",838],["T_WHITESPACE"," ",838],"(","!",["T_VARIABLE","$product",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","getId",838],"(",")",["T_WHITESPACE"," ",838],["T_BOOLEAN_OR","||",838],["T_WHITESPACE"," ",838],"(","!",["T_VARIABLE","$ignoreSalable",838],["T_WHITESPACE"," ",838],["T_BOOLEAN_AND","&&",838],["T_WHITESPACE"," ",838],"!",["T_VARIABLE","$product",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","isSalable",838],"(",")",")",")",["T_WHITESPACE"," ",838],"{",["T_WHITESPACE","\n                    ",838],["T_RETURN","return",839],["T_WHITESPACE"," ",839],["T_STRING","false",839],";",["T_WHITESPACE","\n                ",839],"}",["T_WHITESPACE","\n            ",840],"}",["T_WHITESPACE","\n\n        ",841],["T_RETURN","return",843],["T_WHITESPACE"," ",843],["T_STRING","true",843],";",["T_WHITESPACE","\n    ",843],"}",["T_WHITESPACE","\n\n    ",844],["T_DOC_COMMENT","\/**\n     * Check whether the payment is in payment review state\n     * In this state order cannot be normally processed. Possible actions can be:\n     * - accept or deny payment\n     * - fetch transaction information\n     *\n     * @return bool\n     *\/",846],["T_WHITESPACE","\n    ",853],["T_PUBLIC","public",854],["T_WHITESPACE"," ",854],["T_FUNCTION","function",854],["T_WHITESPACE"," ",854],["T_STRING","isPaymentReview",854],"(",")",["T_WHITESPACE","\n    ",854],"{",["T_WHITESPACE","\n        ",855],["T_RETURN","return",856],["T_WHITESPACE"," ",856],["T_VARIABLE","$this",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","getState",856],"(",")",["T_WHITESPACE"," ",856],["T_IS_IDENTICAL","===",856],["T_WHITESPACE"," ",856],["T_STRING","self",856],["T_DOUBLE_COLON","::",856],["T_STRING","STATE_PAYMENT_REVIEW",856],";",["T_WHITESPACE","\n    ",856],"}",["T_WHITESPACE","\n\n    ",857],["T_DOC_COMMENT","\/**\n     * Check whether payment can be accepted or denied\n     *\n     * @return bool\n     *\/",859],["T_WHITESPACE","\n    ",863],["T_PUBLIC","public",864],["T_WHITESPACE"," ",864],["T_FUNCTION","function",864],["T_WHITESPACE"," ",864],["T_STRING","canReviewPayment",864],"(",")",["T_WHITESPACE","\n    ",864],"{",["T_WHITESPACE","\n        ",865],["T_RETURN","return",866],["T_WHITESPACE"," ",866],["T_VARIABLE","$this",866],["T_OBJECT_OPERATOR","->",866],["T_STRING","isPaymentReview",866],"(",")",["T_WHITESPACE"," ",866],["T_BOOLEAN_AND","&&",866],["T_WHITESPACE"," ",866],["T_VARIABLE","$this",866],["T_OBJECT_OPERATOR","->",866],["T_STRING","getPayment",866],"(",")",["T_OBJECT_OPERATOR","->",866],["T_STRING","canReviewPayment",866],"(",")",";",["T_WHITESPACE","\n    ",866],"}",["T_WHITESPACE","\n\n    ",867],["T_DOC_COMMENT","\/**\n     * Check whether there can be a transaction update fetched for payment in review state\n     *\n     * @return bool\n     *\/",869],["T_WHITESPACE","\n    ",873],["T_PUBLIC","public",874],["T_WHITESPACE"," ",874],["T_FUNCTION","function",874],["T_WHITESPACE"," ",874],["T_STRING","canFetchPaymentReviewUpdate",874],"(",")",["T_WHITESPACE","\n    ",874],"{",["T_WHITESPACE","\n        ",875],["T_RETURN","return",876],["T_WHITESPACE"," ",876],["T_VARIABLE","$this",876],["T_OBJECT_OPERATOR","->",876],["T_STRING","isPaymentReview",876],"(",")",["T_WHITESPACE"," ",876],["T_BOOLEAN_AND","&&",876],["T_WHITESPACE"," ",876],["T_VARIABLE","$this",876],["T_OBJECT_OPERATOR","->",876],["T_STRING","getPayment",876],"(",")",["T_OBJECT_OPERATOR","->",876],["T_STRING","canFetchTransactionInfo",876],"(",")",";",["T_WHITESPACE","\n    ",876],"}",["T_WHITESPACE","\n\n    ",877],["T_DOC_COMMENT","\/**\n     * Retrieve order configuration model\n     *\n     * @return Mage_Sales_Model_Order_Config\n     *\/",879],["T_WHITESPACE","\n    ",883],["T_PUBLIC","public",884],["T_WHITESPACE"," ",884],["T_FUNCTION","function",884],["T_WHITESPACE"," ",884],["T_STRING","getConfig",884],"(",")",["T_WHITESPACE","\n    ",884],"{",["T_WHITESPACE","\n        ",885],["T_RETURN","return",886],["T_WHITESPACE"," ",886],["T_STRING","Mage",886],["T_DOUBLE_COLON","::",886],["T_STRING","getSingleton",886],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_config'",886],")",";",["T_WHITESPACE","\n    ",886],"}",["T_WHITESPACE","\n\n    ",887],["T_DOC_COMMENT","\/**\n     * Place order payments\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",889],["T_WHITESPACE","\n    ",893],["T_PROTECTED","protected",894],["T_WHITESPACE"," ",894],["T_FUNCTION","function",894],["T_WHITESPACE"," ",894],["T_STRING","_placePayment",894],"(",")",["T_WHITESPACE","\n    ",894],"{",["T_WHITESPACE","\n        ",895],["T_VARIABLE","$this",896],["T_OBJECT_OPERATOR","->",896],["T_STRING","getPayment",896],"(",")",["T_OBJECT_OPERATOR","->",896],["T_STRING","place",896],"(",")",";",["T_WHITESPACE","\n        ",896],["T_RETURN","return",897],["T_WHITESPACE"," ",897],["T_VARIABLE","$this",897],";",["T_WHITESPACE","\n    ",897],"}",["T_WHITESPACE","\n\n    ",898],["T_DOC_COMMENT","\/**\n     * Retrieve order payment model object\n     *\n     * @return Mage_Sales_Model_Order_Payment\n     *\/",900],["T_WHITESPACE","\n    ",904],["T_PUBLIC","public",905],["T_WHITESPACE"," ",905],["T_FUNCTION","function",905],["T_WHITESPACE"," ",905],["T_STRING","getPayment",905],"(",")",["T_WHITESPACE","\n    ",905],"{",["T_WHITESPACE","\n        ",906],["T_FOREACH","foreach",907],["T_WHITESPACE"," ",907],"(",["T_VARIABLE","$this",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","getPaymentsCollection",907],"(",")",["T_WHITESPACE"," ",907],["T_AS","as",907],["T_WHITESPACE"," ",907],["T_VARIABLE","$payment",907],")",["T_WHITESPACE"," ",907],"{",["T_WHITESPACE","\n            ",907],["T_IF","if",908],["T_WHITESPACE"," ",908],"(","!",["T_VARIABLE","$payment",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","isDeleted",908],"(",")",")",["T_WHITESPACE"," ",908],"{",["T_WHITESPACE","\n                ",908],["T_RETURN","return",909],["T_WHITESPACE"," ",909],["T_VARIABLE","$payment",909],";",["T_WHITESPACE","\n            ",909],"}",["T_WHITESPACE","\n        ",910],"}",["T_WHITESPACE","\n        ",911],["T_RETURN","return",912],["T_WHITESPACE"," ",912],["T_STRING","false",912],";",["T_WHITESPACE","\n    ",912],"}",["T_WHITESPACE","\n\n    ",913],["T_DOC_COMMENT","\/**\n     * Declare order billing address\n     *\n     * @param   Mage_Sales_Model_Order_Address $address\n     * @return  Mage_Sales_Model_Order\n     *\/",915],["T_WHITESPACE","\n    ",920],["T_PUBLIC","public",921],["T_WHITESPACE"," ",921],["T_FUNCTION","function",921],["T_WHITESPACE"," ",921],["T_STRING","setBillingAddress",921],"(",["T_STRING","Mage_Sales_Model_Order_Address",921],["T_WHITESPACE"," ",921],["T_VARIABLE","$address",921],")",["T_WHITESPACE","\n    ",921],"{",["T_WHITESPACE","\n        ",922],["T_VARIABLE","$old",923],["T_WHITESPACE"," ",923],"=",["T_WHITESPACE"," ",923],["T_VARIABLE","$this",923],["T_OBJECT_OPERATOR","->",923],["T_STRING","getBillingAddress",923],"(",")",";",["T_WHITESPACE","\n        ",923],["T_IF","if",924],["T_WHITESPACE"," ",924],"(","!",["T_EMPTY","empty",924],"(",["T_VARIABLE","$old",924],")",")",["T_WHITESPACE"," ",924],"{",["T_WHITESPACE","\n            ",924],["T_VARIABLE","$address",925],["T_OBJECT_OPERATOR","->",925],["T_STRING","setId",925],"(",["T_VARIABLE","$old",925],["T_OBJECT_OPERATOR","->",925],["T_STRING","getId",925],"(",")",")",";",["T_WHITESPACE","\n        ",925],"}",["T_WHITESPACE","\n        ",926],["T_VARIABLE","$this",927],["T_OBJECT_OPERATOR","->",927],["T_STRING","addAddress",927],"(",["T_VARIABLE","$address",927],["T_OBJECT_OPERATOR","->",927],["T_STRING","setAddressType",927],"(",["T_CONSTANT_ENCAPSED_STRING","'billing'",927],")",")",";",["T_WHITESPACE","\n        ",927],["T_RETURN","return",928],["T_WHITESPACE"," ",928],["T_VARIABLE","$this",928],";",["T_WHITESPACE","\n    ",928],"}",["T_WHITESPACE","\n\n    ",929],["T_DOC_COMMENT","\/**\n     * Declare order shipping address\n     *\n     * @param   Mage_Sales_Model_Order_Address $address\n     * @return  Mage_Sales_Model_Order\n     *\/",931],["T_WHITESPACE","\n    ",936],["T_PUBLIC","public",937],["T_WHITESPACE"," ",937],["T_FUNCTION","function",937],["T_WHITESPACE"," ",937],["T_STRING","setShippingAddress",937],"(",["T_STRING","Mage_Sales_Model_Order_Address",937],["T_WHITESPACE"," ",937],["T_VARIABLE","$address",937],")",["T_WHITESPACE","\n    ",937],"{",["T_WHITESPACE","\n        ",938],["T_VARIABLE","$old",939],["T_WHITESPACE"," ",939],"=",["T_WHITESPACE"," ",939],["T_VARIABLE","$this",939],["T_OBJECT_OPERATOR","->",939],["T_STRING","getShippingAddress",939],"(",")",";",["T_WHITESPACE","\n        ",939],["T_IF","if",940],["T_WHITESPACE"," ",940],"(","!",["T_EMPTY","empty",940],"(",["T_VARIABLE","$old",940],")",")",["T_WHITESPACE"," ",940],"{",["T_WHITESPACE","\n            ",940],["T_VARIABLE","$address",941],["T_OBJECT_OPERATOR","->",941],["T_STRING","setId",941],"(",["T_VARIABLE","$old",941],["T_OBJECT_OPERATOR","->",941],["T_STRING","getId",941],"(",")",")",";",["T_WHITESPACE","\n        ",941],"}",["T_WHITESPACE","\n        ",942],["T_VARIABLE","$this",943],["T_OBJECT_OPERATOR","->",943],["T_STRING","addAddress",943],"(",["T_VARIABLE","$address",943],["T_OBJECT_OPERATOR","->",943],["T_STRING","setAddressType",943],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping'",943],")",")",";",["T_WHITESPACE","\n        ",943],["T_RETURN","return",944],["T_WHITESPACE"," ",944],["T_VARIABLE","$this",944],";",["T_WHITESPACE","\n    ",944],"}",["T_WHITESPACE","\n\n    ",945],["T_DOC_COMMENT","\/**\n     * Retrieve order billing address\n     *\n     * @return Mage_Sales_Model_Order_Address\n     *\/",947],["T_WHITESPACE","\n    ",951],["T_PUBLIC","public",952],["T_WHITESPACE"," ",952],["T_FUNCTION","function",952],["T_WHITESPACE"," ",952],["T_STRING","getBillingAddress",952],"(",")",["T_WHITESPACE","\n    ",952],"{",["T_WHITESPACE","\n        ",953],["T_FOREACH","foreach",954],["T_WHITESPACE"," ",954],"(",["T_VARIABLE","$this",954],["T_OBJECT_OPERATOR","->",954],["T_STRING","getAddressesCollection",954],"(",")",["T_WHITESPACE"," ",954],["T_AS","as",954],["T_WHITESPACE"," ",954],["T_VARIABLE","$address",954],")",["T_WHITESPACE"," ",954],"{",["T_WHITESPACE","\n            ",954],["T_IF","if",955],["T_WHITESPACE"," ",955],"(",["T_VARIABLE","$address",955],["T_OBJECT_OPERATOR","->",955],["T_STRING","getAddressType",955],"(",")",["T_IS_EQUAL","==",955],["T_CONSTANT_ENCAPSED_STRING","'billing'",955],["T_WHITESPACE"," ",955],["T_BOOLEAN_AND","&&",955],["T_WHITESPACE"," ",955],"!",["T_VARIABLE","$address",955],["T_OBJECT_OPERATOR","->",955],["T_STRING","isDeleted",955],"(",")",")",["T_WHITESPACE"," ",955],"{",["T_WHITESPACE","\n                ",955],["T_RETURN","return",956],["T_WHITESPACE"," ",956],["T_VARIABLE","$address",956],";",["T_WHITESPACE","\n            ",956],"}",["T_WHITESPACE","\n        ",957],"}",["T_WHITESPACE","\n        ",958],["T_RETURN","return",959],["T_WHITESPACE"," ",959],["T_STRING","false",959],";",["T_WHITESPACE","\n    ",959],"}",["T_WHITESPACE","\n\n    ",960],["T_DOC_COMMENT","\/**\n     * Retrieve order shipping address\n     *\n     * @return Mage_Sales_Model_Order_Address\n     *\/",962],["T_WHITESPACE","\n    ",966],["T_PUBLIC","public",967],["T_WHITESPACE"," ",967],["T_FUNCTION","function",967],["T_WHITESPACE"," ",967],["T_STRING","getShippingAddress",967],"(",")",["T_WHITESPACE","\n    ",967],"{",["T_WHITESPACE","\n        ",968],["T_FOREACH","foreach",969],["T_WHITESPACE"," ",969],"(",["T_VARIABLE","$this",969],["T_OBJECT_OPERATOR","->",969],["T_STRING","getAddressesCollection",969],"(",")",["T_WHITESPACE"," ",969],["T_AS","as",969],["T_WHITESPACE"," ",969],["T_VARIABLE","$address",969],")",["T_WHITESPACE"," ",969],"{",["T_WHITESPACE","\n            ",969],["T_IF","if",970],["T_WHITESPACE"," ",970],"(",["T_VARIABLE","$address",970],["T_OBJECT_OPERATOR","->",970],["T_STRING","getAddressType",970],"(",")",["T_IS_EQUAL","==",970],["T_CONSTANT_ENCAPSED_STRING","'shipping'",970],["T_WHITESPACE"," ",970],["T_BOOLEAN_AND","&&",970],["T_WHITESPACE"," ",970],"!",["T_VARIABLE","$address",970],["T_OBJECT_OPERATOR","->",970],["T_STRING","isDeleted",970],"(",")",")",["T_WHITESPACE"," ",970],"{",["T_WHITESPACE","\n                ",970],["T_RETURN","return",971],["T_WHITESPACE"," ",971],["T_VARIABLE","$address",971],";",["T_WHITESPACE","\n            ",971],"}",["T_WHITESPACE","\n        ",972],"}",["T_WHITESPACE","\n        ",973],["T_RETURN","return",974],["T_WHITESPACE"," ",974],["T_STRING","false",974],";",["T_WHITESPACE","\n    ",974],"}",["T_WHITESPACE","\n\n    ",975],["T_DOC_COMMENT","\/**\n     * Order state setter.\n     * If status is specified, will add order status history with specified comment\n     * the setData() cannot be overriden because of compatibility issues with resource model\n     *\n     * @param string $state\n     * @param string|bool $status\n     * @param string $comment\n     * @param bool $isCustomerNotified\n     * @return Mage_Sales_Model_Order\n     *\/",977],["T_WHITESPACE","\n    ",987],["T_PUBLIC","public",988],["T_WHITESPACE"," ",988],["T_FUNCTION","function",988],["T_WHITESPACE"," ",988],["T_STRING","setState",988],"(",["T_VARIABLE","$state",988],",",["T_WHITESPACE"," ",988],["T_VARIABLE","$status",988],["T_WHITESPACE"," ",988],"=",["T_WHITESPACE"," ",988],["T_STRING","false",988],",",["T_WHITESPACE"," ",988],["T_VARIABLE","$comment",988],["T_WHITESPACE"," ",988],"=",["T_WHITESPACE"," ",988],["T_CONSTANT_ENCAPSED_STRING","''",988],",",["T_WHITESPACE"," ",988],["T_VARIABLE","$isCustomerNotified",988],["T_WHITESPACE"," ",988],"=",["T_WHITESPACE"," ",988],["T_STRING","null",988],")",["T_WHITESPACE","\n    ",988],"{",["T_WHITESPACE","\n        ",989],["T_RETURN","return",990],["T_WHITESPACE"," ",990],["T_VARIABLE","$this",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","_setState",990],"(",["T_VARIABLE","$state",990],",",["T_WHITESPACE"," ",990],["T_VARIABLE","$status",990],",",["T_WHITESPACE"," ",990],["T_VARIABLE","$comment",990],",",["T_WHITESPACE"," ",990],["T_VARIABLE","$isCustomerNotified",990],",",["T_WHITESPACE"," ",990],["T_STRING","true",990],")",";",["T_WHITESPACE","\n    ",990],"}",["T_WHITESPACE","\n\n    ",991],["T_DOC_COMMENT","\/**\n     * Order state protected setter.\n     * By default allows to set any state. Can also update status to default or specified value\n     * \u00d0\u00a1omplete and closed states are encapsulated intentionally, see the _checkState()\n     *\n     * @param string $state\n     * @param string|bool $status\n     * @param string $comment\n     * @param bool $isCustomerNotified\n     * @param $shouldProtectState\n     * @return Mage_Sales_Model_Order\n     *\/",993],["T_WHITESPACE","\n    ",1004],["T_PROTECTED","protected",1005],["T_WHITESPACE"," ",1005],["T_FUNCTION","function",1005],["T_WHITESPACE"," ",1005],["T_STRING","_setState",1005],"(",["T_VARIABLE","$state",1005],",",["T_WHITESPACE"," ",1005],["T_VARIABLE","$status",1005],["T_WHITESPACE"," ",1005],"=",["T_WHITESPACE"," ",1005],["T_STRING","false",1005],",",["T_WHITESPACE"," ",1005],["T_VARIABLE","$comment",1005],["T_WHITESPACE"," ",1005],"=",["T_WHITESPACE"," ",1005],["T_CONSTANT_ENCAPSED_STRING","''",1005],",",["T_WHITESPACE","\n        ",1005],["T_VARIABLE","$isCustomerNotified",1006],["T_WHITESPACE"," ",1006],"=",["T_WHITESPACE"," ",1006],["T_STRING","null",1006],",",["T_WHITESPACE"," ",1006],["T_VARIABLE","$shouldProtectState",1006],["T_WHITESPACE"," ",1006],"=",["T_WHITESPACE"," ",1006],["T_STRING","false",1006],")",["T_WHITESPACE","\n    ",1006],"{",["T_WHITESPACE","\n        ",1007],["T_COMMENT","\/\/ attempt to set the specified state\n",1008],["T_WHITESPACE","        ",1009],["T_IF","if",1009],["T_WHITESPACE"," ",1009],"(",["T_VARIABLE","$shouldProtectState",1009],")",["T_WHITESPACE"," ",1009],"{",["T_WHITESPACE","\n            ",1009],["T_IF","if",1010],["T_WHITESPACE"," ",1010],"(",["T_VARIABLE","$this",1010],["T_OBJECT_OPERATOR","->",1010],["T_STRING","isStateProtected",1010],"(",["T_VARIABLE","$state",1010],")",")",["T_WHITESPACE"," ",1010],"{",["T_WHITESPACE","\n                ",1010],["T_STRING","Mage",1011],["T_DOUBLE_COLON","::",1011],["T_STRING","throwException",1011],"(",["T_WHITESPACE","\n                    ",1011],["T_STRING","Mage",1012],["T_DOUBLE_COLON","::",1012],["T_STRING","helper",1012],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1012],")",["T_OBJECT_OPERATOR","->",1012],["T_STRING","__",1012],"(",["T_CONSTANT_ENCAPSED_STRING","'The Order State \"%s\" must not be set manually.'",1012],",",["T_WHITESPACE"," ",1012],["T_VARIABLE","$state",1012],")",["T_WHITESPACE","\n                ",1012],")",";",["T_WHITESPACE","\n            ",1013],"}",["T_WHITESPACE","\n        ",1014],"}",["T_WHITESPACE","\n        ",1015],["T_VARIABLE","$this",1016],["T_OBJECT_OPERATOR","->",1016],["T_STRING","setData",1016],"(",["T_CONSTANT_ENCAPSED_STRING","'state'",1016],",",["T_WHITESPACE"," ",1016],["T_VARIABLE","$state",1016],")",";",["T_WHITESPACE","\n\n        ",1016],["T_COMMENT","\/\/ add status history\n",1018],["T_WHITESPACE","        ",1019],["T_IF","if",1019],["T_WHITESPACE"," ",1019],"(",["T_VARIABLE","$status",1019],")",["T_WHITESPACE"," ",1019],"{",["T_WHITESPACE","\n            ",1019],["T_IF","if",1020],["T_WHITESPACE"," ",1020],"(",["T_VARIABLE","$status",1020],["T_WHITESPACE"," ",1020],["T_IS_IDENTICAL","===",1020],["T_WHITESPACE"," ",1020],["T_STRING","true",1020],")",["T_WHITESPACE"," ",1020],"{",["T_WHITESPACE","\n                ",1020],["T_VARIABLE","$status",1021],["T_WHITESPACE"," ",1021],"=",["T_WHITESPACE"," ",1021],["T_VARIABLE","$this",1021],["T_OBJECT_OPERATOR","->",1021],["T_STRING","getConfig",1021],"(",")",["T_OBJECT_OPERATOR","->",1021],["T_STRING","getStateDefaultStatus",1021],"(",["T_VARIABLE","$state",1021],")",";",["T_WHITESPACE","\n            ",1021],"}",["T_WHITESPACE","\n            ",1022],["T_VARIABLE","$this",1023],["T_OBJECT_OPERATOR","->",1023],["T_STRING","setStatus",1023],"(",["T_VARIABLE","$status",1023],")",";",["T_WHITESPACE","\n            ",1023],["T_VARIABLE","$history",1024],["T_WHITESPACE"," ",1024],"=",["T_WHITESPACE"," ",1024],["T_VARIABLE","$this",1024],["T_OBJECT_OPERATOR","->",1024],["T_STRING","addStatusHistoryComment",1024],"(",["T_VARIABLE","$comment",1024],",",["T_WHITESPACE"," ",1024],["T_STRING","false",1024],")",";",["T_WHITESPACE"," ",1024],["T_COMMENT","\/\/ no sense to set $status again\n",1024],["T_WHITESPACE","            ",1025],["T_VARIABLE","$history",1025],["T_OBJECT_OPERATOR","->",1025],["T_STRING","setIsCustomerNotified",1025],"(",["T_VARIABLE","$isCustomerNotified",1025],")",";",["T_WHITESPACE"," ",1025],["T_COMMENT","\/\/ for backwards compatibility\n",1025],["T_WHITESPACE","        ",1026],"}",["T_WHITESPACE","\n        ",1026],["T_RETURN","return",1027],["T_WHITESPACE"," ",1027],["T_VARIABLE","$this",1027],";",["T_WHITESPACE","\n    ",1027],"}",["T_WHITESPACE","\n\n    ",1028],["T_DOC_COMMENT","\/**\n     * Whether specified state can be set from outside\n     * @param $state\n     * @return bool\n     *\/",1030],["T_WHITESPACE","\n    ",1034],["T_PUBLIC","public",1035],["T_WHITESPACE"," ",1035],["T_FUNCTION","function",1035],["T_WHITESPACE"," ",1035],["T_STRING","isStateProtected",1035],"(",["T_VARIABLE","$state",1035],")",["T_WHITESPACE","\n    ",1035],"{",["T_WHITESPACE","\n        ",1036],["T_IF","if",1037],["T_WHITESPACE"," ",1037],"(",["T_EMPTY","empty",1037],"(",["T_VARIABLE","$state",1037],")",")",["T_WHITESPACE"," ",1037],"{",["T_WHITESPACE","\n            ",1037],["T_RETURN","return",1038],["T_WHITESPACE"," ",1038],["T_STRING","false",1038],";",["T_WHITESPACE","\n        ",1038],"}",["T_WHITESPACE","\n        ",1039],["T_RETURN","return",1040],["T_WHITESPACE"," ",1040],["T_STRING","self",1040],["T_DOUBLE_COLON","::",1040],["T_STRING","STATE_COMPLETE",1040],["T_WHITESPACE"," ",1040],["T_IS_EQUAL","==",1040],["T_WHITESPACE"," ",1040],["T_VARIABLE","$state",1040],["T_WHITESPACE"," ",1040],["T_BOOLEAN_OR","||",1040],["T_WHITESPACE"," ",1040],["T_STRING","self",1040],["T_DOUBLE_COLON","::",1040],["T_STRING","STATE_CLOSED",1040],["T_WHITESPACE"," ",1040],["T_IS_EQUAL","==",1040],["T_WHITESPACE"," ",1040],["T_VARIABLE","$state",1040],";",["T_WHITESPACE","\n    ",1040],"}",["T_WHITESPACE","\n\n    ",1041],["T_DOC_COMMENT","\/**\n     * Retrieve label of order status\n     *\n     * @return string\n     *\/",1043],["T_WHITESPACE","\n    ",1047],["T_PUBLIC","public",1048],["T_WHITESPACE"," ",1048],["T_FUNCTION","function",1048],["T_WHITESPACE"," ",1048],["T_STRING","getStatusLabel",1048],"(",")",["T_WHITESPACE","\n    ",1048],"{",["T_WHITESPACE","\n        ",1049],["T_RETURN","return",1050],["T_WHITESPACE"," ",1050],["T_VARIABLE","$this",1050],["T_OBJECT_OPERATOR","->",1050],["T_STRING","getConfig",1050],"(",")",["T_OBJECT_OPERATOR","->",1050],["T_STRING","getStatusLabel",1050],"(",["T_VARIABLE","$this",1050],["T_OBJECT_OPERATOR","->",1050],["T_STRING","getStatus",1050],"(",")",")",";",["T_WHITESPACE","\n    ",1050],"}",["T_WHITESPACE","\n\n    ",1051],["T_DOC_COMMENT","\/**\n     * Add status change information to history\n     * @deprecated after 1.4.0.0-alpha3\n     *\n     * @param  string $status\n     * @param  string $comment\n     * @param  bool $isCustomerNotified\n     * @return Mage_Sales_Model_Order\n     *\/",1053],["T_WHITESPACE","\n    ",1061],["T_PUBLIC","public",1062],["T_WHITESPACE"," ",1062],["T_FUNCTION","function",1062],["T_WHITESPACE"," ",1062],["T_STRING","addStatusToHistory",1062],"(",["T_VARIABLE","$status",1062],",",["T_WHITESPACE"," ",1062],["T_VARIABLE","$comment",1062],["T_WHITESPACE"," ",1062],"=",["T_WHITESPACE"," ",1062],["T_CONSTANT_ENCAPSED_STRING","''",1062],",",["T_WHITESPACE"," ",1062],["T_VARIABLE","$isCustomerNotified",1062],["T_WHITESPACE"," ",1062],"=",["T_WHITESPACE"," ",1062],["T_STRING","false",1062],")",["T_WHITESPACE","\n    ",1062],"{",["T_WHITESPACE","\n        ",1063],["T_VARIABLE","$history",1064],["T_WHITESPACE"," ",1064],"=",["T_WHITESPACE"," ",1064],["T_VARIABLE","$this",1064],["T_OBJECT_OPERATOR","->",1064],["T_STRING","addStatusHistoryComment",1064],"(",["T_VARIABLE","$comment",1064],",",["T_WHITESPACE"," ",1064],["T_VARIABLE","$status",1064],")",["T_WHITESPACE","\n            ",1064],["T_OBJECT_OPERATOR","->",1065],["T_STRING","setIsCustomerNotified",1065],"(",["T_VARIABLE","$isCustomerNotified",1065],")",";",["T_WHITESPACE","\n        ",1065],["T_RETURN","return",1066],["T_WHITESPACE"," ",1066],["T_VARIABLE","$this",1066],";",["T_WHITESPACE","\n    ",1066],"}",["T_WHITESPACE","\n\n    ",1067],["T_COMMENT","\/*\n     * Add a comment to order\n     * Different or default status may be specified\n     *\n     * @param string $comment\n     * @param string $status\n     * @return Mage_Sales_Model_Order_Status_History\n     *\/",1069],["T_WHITESPACE","\n    ",1076],["T_PUBLIC","public",1077],["T_WHITESPACE"," ",1077],["T_FUNCTION","function",1077],["T_WHITESPACE"," ",1077],["T_STRING","addStatusHistoryComment",1077],"(",["T_VARIABLE","$comment",1077],",",["T_WHITESPACE"," ",1077],["T_VARIABLE","$status",1077],["T_WHITESPACE"," ",1077],"=",["T_WHITESPACE"," ",1077],["T_STRING","false",1077],")",["T_WHITESPACE","\n    ",1077],"{",["T_WHITESPACE","\n        ",1078],["T_IF","if",1079],["T_WHITESPACE"," ",1079],"(",["T_STRING","false",1079],["T_WHITESPACE"," ",1079],["T_IS_IDENTICAL","===",1079],["T_WHITESPACE"," ",1079],["T_VARIABLE","$status",1079],")",["T_WHITESPACE"," ",1079],"{",["T_WHITESPACE","\n            ",1079],["T_VARIABLE","$status",1080],["T_WHITESPACE"," ",1080],"=",["T_WHITESPACE"," ",1080],["T_VARIABLE","$this",1080],["T_OBJECT_OPERATOR","->",1080],["T_STRING","getStatus",1080],"(",")",";",["T_WHITESPACE","\n        ",1080],"}",["T_WHITESPACE"," ",1081],["T_ELSEIF","elseif",1081],["T_WHITESPACE"," ",1081],"(",["T_STRING","true",1081],["T_WHITESPACE"," ",1081],["T_IS_IDENTICAL","===",1081],["T_WHITESPACE"," ",1081],["T_VARIABLE","$status",1081],")",["T_WHITESPACE"," ",1081],"{",["T_WHITESPACE","\n            ",1081],["T_VARIABLE","$status",1082],["T_WHITESPACE"," ",1082],"=",["T_WHITESPACE"," ",1082],["T_VARIABLE","$this",1082],["T_OBJECT_OPERATOR","->",1082],["T_STRING","getConfig",1082],"(",")",["T_OBJECT_OPERATOR","->",1082],["T_STRING","getStateDefaultStatus",1082],"(",["T_VARIABLE","$this",1082],["T_OBJECT_OPERATOR","->",1082],["T_STRING","getState",1082],"(",")",")",";",["T_WHITESPACE","\n        ",1082],"}",["T_WHITESPACE"," ",1083],["T_ELSE","else",1083],["T_WHITESPACE"," ",1083],"{",["T_WHITESPACE","\n            ",1083],["T_VARIABLE","$this",1084],["T_OBJECT_OPERATOR","->",1084],["T_STRING","setStatus",1084],"(",["T_VARIABLE","$status",1084],")",";",["T_WHITESPACE","\n        ",1084],"}",["T_WHITESPACE","\n        ",1085],["T_VARIABLE","$history",1086],["T_WHITESPACE"," ",1086],"=",["T_WHITESPACE"," ",1086],["T_STRING","Mage",1086],["T_DOUBLE_COLON","::",1086],["T_STRING","getModel",1086],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_status_history'",1086],")",["T_WHITESPACE","\n            ",1086],["T_OBJECT_OPERATOR","->",1087],["T_STRING","setStatus",1087],"(",["T_VARIABLE","$status",1087],")",["T_WHITESPACE","\n            ",1087],["T_OBJECT_OPERATOR","->",1088],["T_STRING","setComment",1088],"(",["T_VARIABLE","$comment",1088],")",["T_WHITESPACE","\n            ",1088],["T_OBJECT_OPERATOR","->",1089],["T_STRING","setEntityName",1089],"(",["T_VARIABLE","$this",1089],["T_OBJECT_OPERATOR","->",1089],["T_STRING","_historyEntityName",1089],")",";",["T_WHITESPACE","\n        ",1089],["T_VARIABLE","$this",1090],["T_OBJECT_OPERATOR","->",1090],["T_STRING","addStatusHistory",1090],"(",["T_VARIABLE","$history",1090],")",";",["T_WHITESPACE","\n        ",1090],["T_RETURN","return",1091],["T_WHITESPACE"," ",1091],["T_VARIABLE","$history",1091],";",["T_WHITESPACE","\n    ",1091],"}",["T_WHITESPACE","\n\n    ",1092],["T_DOC_COMMENT","\/**\n     * Overrides entity id, which will be saved to comments history status\n     *\n     * @param string $status\n     * @return Mage_Sales_Model_Order\n     *\/",1094],["T_WHITESPACE","\n    ",1099],["T_PUBLIC","public",1100],["T_WHITESPACE"," ",1100],["T_FUNCTION","function",1100],["T_WHITESPACE"," ",1100],["T_STRING","setHistoryEntityName",1100],"(",["T_WHITESPACE"," ",1100],["T_VARIABLE","$entityName",1100],["T_WHITESPACE"," ",1100],")",["T_WHITESPACE","\n    ",1100],"{",["T_WHITESPACE","\n        ",1101],["T_VARIABLE","$this",1102],["T_OBJECT_OPERATOR","->",1102],["T_STRING","_historyEntityName",1102],["T_WHITESPACE"," ",1102],"=",["T_WHITESPACE"," ",1102],["T_VARIABLE","$entityName",1102],";",["T_WHITESPACE","\n        ",1102],["T_RETURN","return",1103],["T_WHITESPACE"," ",1103],["T_VARIABLE","$this",1103],";",["T_WHITESPACE","\n    ",1103],"}",["T_WHITESPACE","\n\n    ",1104],["T_DOC_COMMENT","\/**\n     * Place order\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",1106],["T_WHITESPACE","\n    ",1110],["T_PUBLIC","public",1111],["T_WHITESPACE"," ",1111],["T_FUNCTION","function",1111],["T_WHITESPACE"," ",1111],["T_STRING","place",1111],"(",")",["T_WHITESPACE","\n    ",1111],"{",["T_WHITESPACE","\n        ",1112],["T_STRING","Mage",1113],["T_DOUBLE_COLON","::",1113],["T_STRING","dispatchEvent",1113],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_place_before'",1113],",",["T_WHITESPACE"," ",1113],["T_ARRAY","array",1113],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",1113],["T_DOUBLE_ARROW","=>",1113],["T_VARIABLE","$this",1113],")",")",";",["T_WHITESPACE","\n        ",1113],["T_VARIABLE","$this",1114],["T_OBJECT_OPERATOR","->",1114],["T_STRING","_placePayment",1114],"(",")",";",["T_WHITESPACE","\n        ",1114],["T_STRING","Mage",1115],["T_DOUBLE_COLON","::",1115],["T_STRING","dispatchEvent",1115],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_place_after'",1115],",",["T_WHITESPACE"," ",1115],["T_ARRAY","array",1115],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",1115],["T_DOUBLE_ARROW","=>",1115],["T_VARIABLE","$this",1115],")",")",";",["T_WHITESPACE","\n        ",1115],["T_RETURN","return",1116],["T_WHITESPACE"," ",1116],["T_VARIABLE","$this",1116],";",["T_WHITESPACE","\n    ",1116],"}",["T_WHITESPACE","\n\n    ",1117],["T_PUBLIC","public",1119],["T_WHITESPACE"," ",1119],["T_FUNCTION","function",1119],["T_WHITESPACE"," ",1119],["T_STRING","hold",1119],"(",")",["T_WHITESPACE","\n    ",1119],"{",["T_WHITESPACE","\n        ",1120],["T_IF","if",1121],["T_WHITESPACE"," ",1121],"(","!",["T_VARIABLE","$this",1121],["T_OBJECT_OPERATOR","->",1121],["T_STRING","canHold",1121],"(",")",")",["T_WHITESPACE"," ",1121],"{",["T_WHITESPACE","\n            ",1121],["T_STRING","Mage",1122],["T_DOUBLE_COLON","::",1122],["T_STRING","throwException",1122],"(",["T_STRING","Mage",1122],["T_DOUBLE_COLON","::",1122],["T_STRING","helper",1122],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1122],")",["T_OBJECT_OPERATOR","->",1122],["T_STRING","__",1122],"(",["T_CONSTANT_ENCAPSED_STRING","'Hold action is not available.'",1122],")",")",";",["T_WHITESPACE","\n        ",1122],"}",["T_WHITESPACE","\n        ",1123],["T_VARIABLE","$this",1124],["T_OBJECT_OPERATOR","->",1124],["T_STRING","setHoldBeforeState",1124],"(",["T_VARIABLE","$this",1124],["T_OBJECT_OPERATOR","->",1124],["T_STRING","getState",1124],"(",")",")",";",["T_WHITESPACE","\n        ",1124],["T_VARIABLE","$this",1125],["T_OBJECT_OPERATOR","->",1125],["T_STRING","setHoldBeforeStatus",1125],"(",["T_VARIABLE","$this",1125],["T_OBJECT_OPERATOR","->",1125],["T_STRING","getStatus",1125],"(",")",")",";",["T_WHITESPACE","\n        ",1125],["T_VARIABLE","$this",1126],["T_OBJECT_OPERATOR","->",1126],["T_STRING","setState",1126],"(",["T_STRING","self",1126],["T_DOUBLE_COLON","::",1126],["T_STRING","STATE_HOLDED",1126],",",["T_WHITESPACE"," ",1126],["T_STRING","true",1126],")",";",["T_WHITESPACE","\n        ",1126],["T_RETURN","return",1127],["T_WHITESPACE"," ",1127],["T_VARIABLE","$this",1127],";",["T_WHITESPACE","\n    ",1127],"}",["T_WHITESPACE","\n\n    ",1128],["T_DOC_COMMENT","\/**\n     * Attempt to unhold the order\n     *\n     * @return Mage_Sales_Model_Order\n     * @throws Mage_Core_Exception\n     *\/",1130],["T_WHITESPACE","\n    ",1135],["T_PUBLIC","public",1136],["T_WHITESPACE"," ",1136],["T_FUNCTION","function",1136],["T_WHITESPACE"," ",1136],["T_STRING","unhold",1136],"(",")",["T_WHITESPACE","\n    ",1136],"{",["T_WHITESPACE","\n        ",1137],["T_IF","if",1138],["T_WHITESPACE"," ",1138],"(","!",["T_VARIABLE","$this",1138],["T_OBJECT_OPERATOR","->",1138],["T_STRING","canUnhold",1138],"(",")",")",["T_WHITESPACE"," ",1138],"{",["T_WHITESPACE","\n            ",1138],["T_STRING","Mage",1139],["T_DOUBLE_COLON","::",1139],["T_STRING","throwException",1139],"(",["T_STRING","Mage",1139],["T_DOUBLE_COLON","::",1139],["T_STRING","helper",1139],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1139],")",["T_OBJECT_OPERATOR","->",1139],["T_STRING","__",1139],"(",["T_CONSTANT_ENCAPSED_STRING","'Unhold action is not available.'",1139],")",")",";",["T_WHITESPACE","\n        ",1139],"}",["T_WHITESPACE","\n        ",1140],["T_VARIABLE","$this",1141],["T_OBJECT_OPERATOR","->",1141],["T_STRING","setState",1141],"(",["T_VARIABLE","$this",1141],["T_OBJECT_OPERATOR","->",1141],["T_STRING","getHoldBeforeState",1141],"(",")",",",["T_WHITESPACE"," ",1141],["T_VARIABLE","$this",1141],["T_OBJECT_OPERATOR","->",1141],["T_STRING","getHoldBeforeStatus",1141],"(",")",")",";",["T_WHITESPACE","\n        ",1141],["T_VARIABLE","$this",1142],["T_OBJECT_OPERATOR","->",1142],["T_STRING","setHoldBeforeState",1142],"(",["T_STRING","null",1142],")",";",["T_WHITESPACE","\n        ",1142],["T_VARIABLE","$this",1143],["T_OBJECT_OPERATOR","->",1143],["T_STRING","setHoldBeforeStatus",1143],"(",["T_STRING","null",1143],")",";",["T_WHITESPACE","\n        ",1143],["T_RETURN","return",1144],["T_WHITESPACE"," ",1144],["T_VARIABLE","$this",1144],";",["T_WHITESPACE","\n    ",1144],"}",["T_WHITESPACE","\n\n    ",1145],["T_DOC_COMMENT","\/**\n     * Cancel order\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",1147],["T_WHITESPACE","\n    ",1151],["T_PUBLIC","public",1152],["T_WHITESPACE"," ",1152],["T_FUNCTION","function",1152],["T_WHITESPACE"," ",1152],["T_STRING","cancel",1152],"(",")",["T_WHITESPACE","\n    ",1152],"{",["T_WHITESPACE","\n        ",1153],["T_IF","if",1154],["T_WHITESPACE"," ",1154],"(",["T_VARIABLE","$this",1154],["T_OBJECT_OPERATOR","->",1154],["T_STRING","canCancel",1154],"(",")",")",["T_WHITESPACE"," ",1154],"{",["T_WHITESPACE","\n            ",1154],["T_VARIABLE","$this",1155],["T_OBJECT_OPERATOR","->",1155],["T_STRING","getPayment",1155],"(",")",["T_OBJECT_OPERATOR","->",1155],["T_STRING","cancel",1155],"(",")",";",["T_WHITESPACE","\n            ",1155],["T_VARIABLE","$this",1156],["T_OBJECT_OPERATOR","->",1156],["T_STRING","registerCancellation",1156],"(",")",";",["T_WHITESPACE","\n\n            ",1156],["T_STRING","Mage",1158],["T_DOUBLE_COLON","::",1158],["T_STRING","dispatchEvent",1158],"(",["T_CONSTANT_ENCAPSED_STRING","'order_cancel_after'",1158],",",["T_WHITESPACE"," ",1158],["T_ARRAY","array",1158],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",1158],["T_WHITESPACE"," ",1158],["T_DOUBLE_ARROW","=>",1158],["T_WHITESPACE"," ",1158],["T_VARIABLE","$this",1158],")",")",";",["T_WHITESPACE","\n        ",1158],"}",["T_WHITESPACE","\n\n        ",1159],["T_RETURN","return",1161],["T_WHITESPACE"," ",1161],["T_VARIABLE","$this",1161],";",["T_WHITESPACE","\n    ",1161],"}",["T_WHITESPACE","\n\n    ",1162],["T_DOC_COMMENT","\/**\n     * Prepare order totals to cancellation\n     * @param string $comment\n     * @param bool $graceful\n     * @return Mage_Sales_Model_Order\n     * @throws Mage_Core_Exception\n     *\/",1164],["T_WHITESPACE","\n    ",1170],["T_PUBLIC","public",1171],["T_WHITESPACE"," ",1171],["T_FUNCTION","function",1171],["T_WHITESPACE"," ",1171],["T_STRING","registerCancellation",1171],"(",["T_VARIABLE","$comment",1171],["T_WHITESPACE"," ",1171],"=",["T_WHITESPACE"," ",1171],["T_CONSTANT_ENCAPSED_STRING","''",1171],",",["T_WHITESPACE"," ",1171],["T_VARIABLE","$graceful",1171],["T_WHITESPACE"," ",1171],"=",["T_WHITESPACE"," ",1171],["T_STRING","true",1171],")",["T_WHITESPACE","\n    ",1171],"{",["T_WHITESPACE","\n        ",1172],["T_IF","if",1173],["T_WHITESPACE"," ",1173],"(",["T_VARIABLE","$this",1173],["T_OBJECT_OPERATOR","->",1173],["T_STRING","canCancel",1173],"(",")",["T_WHITESPACE"," ",1173],["T_BOOLEAN_OR","||",1173],["T_WHITESPACE"," ",1173],["T_VARIABLE","$this",1173],["T_OBJECT_OPERATOR","->",1173],["T_STRING","isPaymentReview",1173],"(",")",")",["T_WHITESPACE"," ",1173],"{",["T_WHITESPACE","\n            ",1173],["T_VARIABLE","$cancelState",1174],["T_WHITESPACE"," ",1174],"=",["T_WHITESPACE"," ",1174],["T_STRING","self",1174],["T_DOUBLE_COLON","::",1174],["T_STRING","STATE_CANCELED",1174],";",["T_WHITESPACE","\n            ",1174],["T_FOREACH","foreach",1175],["T_WHITESPACE"," ",1175],"(",["T_VARIABLE","$this",1175],["T_OBJECT_OPERATOR","->",1175],["T_STRING","getAllItems",1175],"(",")",["T_WHITESPACE"," ",1175],["T_AS","as",1175],["T_WHITESPACE"," ",1175],["T_VARIABLE","$item",1175],")",["T_WHITESPACE"," ",1175],"{",["T_WHITESPACE","\n                ",1175],["T_IF","if",1176],["T_WHITESPACE"," ",1176],"(",["T_VARIABLE","$cancelState",1176],["T_WHITESPACE"," ",1176],["T_IS_NOT_EQUAL","!=",1176],["T_WHITESPACE"," ",1176],["T_STRING","self",1176],["T_DOUBLE_COLON","::",1176],["T_STRING","STATE_PROCESSING",1176],["T_WHITESPACE"," ",1176],["T_BOOLEAN_AND","&&",1176],["T_WHITESPACE"," ",1176],["T_VARIABLE","$item",1176],["T_OBJECT_OPERATOR","->",1176],["T_STRING","getQtyToRefund",1176],"(",")",")",["T_WHITESPACE"," ",1176],"{",["T_WHITESPACE","\n                    ",1176],["T_IF","if",1177],["T_WHITESPACE"," ",1177],"(",["T_VARIABLE","$item",1177],["T_OBJECT_OPERATOR","->",1177],["T_STRING","getQtyToShip",1177],"(",")",["T_WHITESPACE"," ",1177],">",["T_WHITESPACE"," ",1177],["T_VARIABLE","$item",1177],["T_OBJECT_OPERATOR","->",1177],["T_STRING","getQtyToCancel",1177],"(",")",")",["T_WHITESPACE"," ",1177],"{",["T_WHITESPACE","\n                        ",1177],["T_VARIABLE","$cancelState",1178],["T_WHITESPACE"," ",1178],"=",["T_WHITESPACE"," ",1178],["T_STRING","self",1178],["T_DOUBLE_COLON","::",1178],["T_STRING","STATE_PROCESSING",1178],";",["T_WHITESPACE","\n                    ",1178],"}",["T_WHITESPACE"," ",1179],["T_ELSE","else",1179],["T_WHITESPACE"," ",1179],"{",["T_WHITESPACE","\n                        ",1179],["T_VARIABLE","$cancelState",1180],["T_WHITESPACE"," ",1180],"=",["T_WHITESPACE"," ",1180],["T_STRING","self",1180],["T_DOUBLE_COLON","::",1180],["T_STRING","STATE_COMPLETE",1180],";",["T_WHITESPACE","\n                    ",1180],"}",["T_WHITESPACE","\n                ",1181],"}",["T_WHITESPACE","\n                ",1182],["T_VARIABLE","$item",1183],["T_OBJECT_OPERATOR","->",1183],["T_STRING","cancel",1183],"(",")",";",["T_WHITESPACE","\n            ",1183],"}",["T_WHITESPACE","\n\n            ",1184],["T_VARIABLE","$this",1186],["T_OBJECT_OPERATOR","->",1186],["T_STRING","setSubtotalCanceled",1186],"(",["T_VARIABLE","$this",1186],["T_OBJECT_OPERATOR","->",1186],["T_STRING","getSubtotal",1186],"(",")",["T_WHITESPACE"," ",1186],"-",["T_WHITESPACE"," ",1186],["T_VARIABLE","$this",1186],["T_OBJECT_OPERATOR","->",1186],["T_STRING","getSubtotalInvoiced",1186],"(",")",")",";",["T_WHITESPACE","\n            ",1186],["T_VARIABLE","$this",1187],["T_OBJECT_OPERATOR","->",1187],["T_STRING","setBaseSubtotalCanceled",1187],"(",["T_VARIABLE","$this",1187],["T_OBJECT_OPERATOR","->",1187],["T_STRING","getBaseSubtotal",1187],"(",")",["T_WHITESPACE"," ",1187],"-",["T_WHITESPACE"," ",1187],["T_VARIABLE","$this",1187],["T_OBJECT_OPERATOR","->",1187],["T_STRING","getBaseSubtotalInvoiced",1187],"(",")",")",";",["T_WHITESPACE","\n\n            ",1187],["T_VARIABLE","$this",1189],["T_OBJECT_OPERATOR","->",1189],["T_STRING","setTaxCanceled",1189],"(",["T_VARIABLE","$this",1189],["T_OBJECT_OPERATOR","->",1189],["T_STRING","getTaxAmount",1189],"(",")",["T_WHITESPACE"," ",1189],"-",["T_WHITESPACE"," ",1189],["T_VARIABLE","$this",1189],["T_OBJECT_OPERATOR","->",1189],["T_STRING","getTaxInvoiced",1189],"(",")",")",";",["T_WHITESPACE","\n            ",1189],["T_VARIABLE","$this",1190],["T_OBJECT_OPERATOR","->",1190],["T_STRING","setBaseTaxCanceled",1190],"(",["T_VARIABLE","$this",1190],["T_OBJECT_OPERATOR","->",1190],["T_STRING","getBaseTaxAmount",1190],"(",")",["T_WHITESPACE"," ",1190],"-",["T_WHITESPACE"," ",1190],["T_VARIABLE","$this",1190],["T_OBJECT_OPERATOR","->",1190],["T_STRING","getBaseTaxInvoiced",1190],"(",")",")",";",["T_WHITESPACE","\n\n            ",1190],["T_VARIABLE","$this",1192],["T_OBJECT_OPERATOR","->",1192],["T_STRING","setShippingCanceled",1192],"(",["T_VARIABLE","$this",1192],["T_OBJECT_OPERATOR","->",1192],["T_STRING","getShippingAmount",1192],"(",")",["T_WHITESPACE"," ",1192],"-",["T_WHITESPACE"," ",1192],["T_VARIABLE","$this",1192],["T_OBJECT_OPERATOR","->",1192],["T_STRING","getShippingInvoiced",1192],"(",")",")",";",["T_WHITESPACE","\n            ",1192],["T_VARIABLE","$this",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","setBaseShippingCanceled",1193],"(",["T_VARIABLE","$this",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","getBaseShippingAmount",1193],"(",")",["T_WHITESPACE"," ",1193],"-",["T_WHITESPACE"," ",1193],["T_VARIABLE","$this",1193],["T_OBJECT_OPERATOR","->",1193],["T_STRING","getBaseShippingInvoiced",1193],"(",")",")",";",["T_WHITESPACE","\n\n            ",1193],["T_VARIABLE","$this",1195],["T_OBJECT_OPERATOR","->",1195],["T_STRING","setDiscountCanceled",1195],"(",["T_STRING","abs",1195],"(",["T_VARIABLE","$this",1195],["T_OBJECT_OPERATOR","->",1195],["T_STRING","getDiscountAmount",1195],"(",")",")",["T_WHITESPACE"," ",1195],"-",["T_WHITESPACE"," ",1195],["T_VARIABLE","$this",1195],["T_OBJECT_OPERATOR","->",1195],["T_STRING","getDiscountInvoiced",1195],"(",")",")",";",["T_WHITESPACE","\n            ",1195],["T_VARIABLE","$this",1196],["T_OBJECT_OPERATOR","->",1196],["T_STRING","setBaseDiscountCanceled",1196],"(",["T_STRING","abs",1196],"(",["T_VARIABLE","$this",1196],["T_OBJECT_OPERATOR","->",1196],["T_STRING","getBaseDiscountAmount",1196],"(",")",")",["T_WHITESPACE"," ",1196],"-",["T_WHITESPACE"," ",1196],["T_VARIABLE","$this",1196],["T_OBJECT_OPERATOR","->",1196],["T_STRING","getBaseDiscountInvoiced",1196],"(",")",")",";",["T_WHITESPACE","\n\n            ",1196],["T_VARIABLE","$this",1198],["T_OBJECT_OPERATOR","->",1198],["T_STRING","setTotalCanceled",1198],"(",["T_VARIABLE","$this",1198],["T_OBJECT_OPERATOR","->",1198],["T_STRING","getGrandTotal",1198],"(",")",["T_WHITESPACE"," ",1198],"-",["T_WHITESPACE"," ",1198],["T_VARIABLE","$this",1198],["T_OBJECT_OPERATOR","->",1198],["T_STRING","getTotalPaid",1198],"(",")",")",";",["T_WHITESPACE","\n            ",1198],["T_VARIABLE","$this",1199],["T_OBJECT_OPERATOR","->",1199],["T_STRING","setBaseTotalCanceled",1199],"(",["T_VARIABLE","$this",1199],["T_OBJECT_OPERATOR","->",1199],["T_STRING","getBaseGrandTotal",1199],"(",")",["T_WHITESPACE"," ",1199],"-",["T_WHITESPACE"," ",1199],["T_VARIABLE","$this",1199],["T_OBJECT_OPERATOR","->",1199],["T_STRING","getBaseTotalPaid",1199],"(",")",")",";",["T_WHITESPACE","\n\n            ",1199],["T_VARIABLE","$this",1201],["T_OBJECT_OPERATOR","->",1201],["T_STRING","_setState",1201],"(",["T_VARIABLE","$cancelState",1201],",",["T_WHITESPACE"," ",1201],["T_STRING","true",1201],",",["T_WHITESPACE"," ",1201],["T_VARIABLE","$comment",1201],")",";",["T_WHITESPACE","\n        ",1201],"}",["T_WHITESPACE"," ",1202],["T_ELSEIF","elseif",1202],["T_WHITESPACE"," ",1202],"(","!",["T_VARIABLE","$graceful",1202],")",["T_WHITESPACE"," ",1202],"{",["T_WHITESPACE","\n            ",1202],["T_STRING","Mage",1203],["T_DOUBLE_COLON","::",1203],["T_STRING","throwException",1203],"(",["T_STRING","Mage",1203],["T_DOUBLE_COLON","::",1203],["T_STRING","helper",1203],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1203],")",["T_OBJECT_OPERATOR","->",1203],["T_STRING","__",1203],"(",["T_CONSTANT_ENCAPSED_STRING","'Order does not allow to be canceled.'",1203],")",")",";",["T_WHITESPACE","\n        ",1203],"}",["T_WHITESPACE","\n        ",1204],["T_RETURN","return",1205],["T_WHITESPACE"," ",1205],["T_VARIABLE","$this",1205],";",["T_WHITESPACE","\n    ",1205],"}",["T_WHITESPACE","\n\n    ",1206],["T_DOC_COMMENT","\/**\n     * Retrieve tracking numbers\n     *\n     * @return array\n     *\/",1208],["T_WHITESPACE","\n    ",1212],["T_PUBLIC","public",1213],["T_WHITESPACE"," ",1213],["T_FUNCTION","function",1213],["T_WHITESPACE"," ",1213],["T_STRING","getTrackingNumbers",1213],"(",")",["T_WHITESPACE","\n    ",1213],"{",["T_WHITESPACE","\n        ",1214],["T_IF","if",1215],["T_WHITESPACE"," ",1215],"(",["T_VARIABLE","$this",1215],["T_OBJECT_OPERATOR","->",1215],["T_STRING","getData",1215],"(",["T_CONSTANT_ENCAPSED_STRING","'tracking_numbers'",1215],")",")",["T_WHITESPACE"," ",1215],"{",["T_WHITESPACE","\n            ",1215],["T_RETURN","return",1216],["T_WHITESPACE"," ",1216],["T_STRING","explode",1216],"(",["T_CONSTANT_ENCAPSED_STRING","','",1216],",",["T_WHITESPACE"," ",1216],["T_VARIABLE","$this",1216],["T_OBJECT_OPERATOR","->",1216],["T_STRING","getData",1216],"(",["T_CONSTANT_ENCAPSED_STRING","'tracking_numbers'",1216],")",")",";",["T_WHITESPACE","\n        ",1216],"}",["T_WHITESPACE","\n        ",1217],["T_RETURN","return",1218],["T_WHITESPACE"," ",1218],["T_ARRAY","array",1218],"(",")",";",["T_WHITESPACE","\n    ",1218],"}",["T_WHITESPACE","\n\n    ",1219],["T_DOC_COMMENT","\/**\n     * Return model of shipping carrier\n     *\n     * @return bool|float|Mage_Shipping_Model_Carrier_Abstract\n     *\/",1221],["T_WHITESPACE","\n    ",1225],["T_PUBLIC","public",1226],["T_WHITESPACE"," ",1226],["T_FUNCTION","function",1226],["T_WHITESPACE"," ",1226],["T_STRING","getShippingCarrier",1226],"(",")",["T_WHITESPACE","\n    ",1226],"{",["T_WHITESPACE","\n        ",1227],["T_VARIABLE","$carrierModel",1228],["T_WHITESPACE"," ",1228],"=",["T_WHITESPACE"," ",1228],["T_VARIABLE","$this",1228],["T_OBJECT_OPERATOR","->",1228],["T_STRING","getData",1228],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_carrier'",1228],")",";",["T_WHITESPACE","\n        ",1228],["T_IF","if",1229],["T_WHITESPACE"," ",1229],"(",["T_STRING","is_null",1229],"(",["T_VARIABLE","$carrierModel",1229],")",")",["T_WHITESPACE"," ",1229],"{",["T_WHITESPACE","\n            ",1229],["T_VARIABLE","$carrierModel",1230],["T_WHITESPACE"," ",1230],"=",["T_WHITESPACE"," ",1230],["T_STRING","false",1230],";",["T_WHITESPACE","\n            ",1230],["T_DOC_COMMENT","\/**\n             * $method - carrier_method\n             *\/",1231],["T_WHITESPACE","\n            ",1233],["T_VARIABLE","$method",1234],["T_WHITESPACE"," ",1234],"=",["T_WHITESPACE"," ",1234],["T_VARIABLE","$this",1234],["T_OBJECT_OPERATOR","->",1234],["T_STRING","getShippingMethod",1234],"(",["T_STRING","true",1234],")",";",["T_WHITESPACE","\n            ",1234],["T_IF","if",1235],["T_WHITESPACE"," ",1235],"(",["T_VARIABLE","$method",1235],["T_WHITESPACE"," ",1235],["T_INSTANCEOF","instanceof",1235],["T_WHITESPACE"," ",1235],["T_STRING","Varien_Object",1235],")",["T_WHITESPACE"," ",1235],"{",["T_WHITESPACE","\n                ",1235],["T_VARIABLE","$className",1236],["T_WHITESPACE"," ",1236],"=",["T_WHITESPACE"," ",1236],["T_STRING","Mage",1236],["T_DOUBLE_COLON","::",1236],["T_STRING","getStoreConfig",1236],"(",["T_CONSTANT_ENCAPSED_STRING","'carriers\/'",1236],["T_WHITESPACE"," ",1236],".",["T_WHITESPACE"," ",1236],["T_VARIABLE","$method",1236],["T_OBJECT_OPERATOR","->",1236],["T_STRING","getCarrierCode",1236],"(",")",["T_WHITESPACE"," ",1236],".",["T_WHITESPACE"," ",1236],["T_CONSTANT_ENCAPSED_STRING","'\/model'",1236],")",";",["T_WHITESPACE","\n                ",1236],["T_IF","if",1237],["T_WHITESPACE"," ",1237],"(",["T_VARIABLE","$className",1237],")",["T_WHITESPACE"," ",1237],"{",["T_WHITESPACE","\n                    ",1237],["T_VARIABLE","$carrierModel",1238],["T_WHITESPACE"," ",1238],"=",["T_WHITESPACE"," ",1238],["T_STRING","Mage",1238],["T_DOUBLE_COLON","::",1238],["T_STRING","getModel",1238],"(",["T_VARIABLE","$className",1238],")",";",["T_WHITESPACE","\n                ",1238],"}",["T_WHITESPACE","\n            ",1239],"}",["T_WHITESPACE","\n            ",1240],["T_VARIABLE","$this",1241],["T_OBJECT_OPERATOR","->",1241],["T_STRING","setData",1241],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_carrier'",1241],",",["T_WHITESPACE"," ",1241],["T_VARIABLE","$carrierModel",1241],")",";",["T_WHITESPACE","\n        ",1241],"}",["T_WHITESPACE","\n        ",1242],["T_RETURN","return",1243],["T_WHITESPACE"," ",1243],["T_VARIABLE","$carrierModel",1243],";",["T_WHITESPACE","\n    ",1243],"}",["T_WHITESPACE","\n\n    ",1244],["T_DOC_COMMENT","\/**\n     * Retrieve shipping method\n     *\n     * @param bool $asObject return carrier code and shipping method data as object\n     * @return string|Varien_Object\n     *\/",1246],["T_WHITESPACE","\n    ",1251],["T_PUBLIC","public",1252],["T_WHITESPACE"," ",1252],["T_FUNCTION","function",1252],["T_WHITESPACE"," ",1252],["T_STRING","getShippingMethod",1252],"(",["T_VARIABLE","$asObject",1252],["T_WHITESPACE"," ",1252],"=",["T_WHITESPACE"," ",1252],["T_STRING","false",1252],")",["T_WHITESPACE","\n    ",1252],"{",["T_WHITESPACE","\n        ",1253],["T_VARIABLE","$shippingMethod",1254],["T_WHITESPACE"," ",1254],"=",["T_WHITESPACE"," ",1254],["T_STRING","parent",1254],["T_DOUBLE_COLON","::",1254],["T_STRING","getShippingMethod",1254],"(",")",";",["T_WHITESPACE","\n        ",1254],["T_IF","if",1255],["T_WHITESPACE"," ",1255],"(","!",["T_VARIABLE","$asObject",1255],")",["T_WHITESPACE"," ",1255],"{",["T_WHITESPACE","\n            ",1255],["T_RETURN","return",1256],["T_WHITESPACE"," ",1256],["T_VARIABLE","$shippingMethod",1256],";",["T_WHITESPACE","\n        ",1256],"}",["T_WHITESPACE"," ",1257],["T_ELSE","else",1257],["T_WHITESPACE"," ",1257],"{",["T_WHITESPACE","\n            ",1257],["T_VARIABLE","$segments",1258],["T_WHITESPACE"," ",1258],"=",["T_WHITESPACE"," ",1258],["T_STRING","explode",1258],"(",["T_CONSTANT_ENCAPSED_STRING","'_'",1258],",",["T_WHITESPACE"," ",1258],["T_VARIABLE","$shippingMethod",1258],",",["T_WHITESPACE"," ",1258],["T_LNUMBER","2",1258],")",";",["T_WHITESPACE","\n            ",1258],["T_IF","if",1259],["T_WHITESPACE"," ",1259],"(","!",["T_ISSET","isset",1259],"(",["T_VARIABLE","$segments",1259],"[",["T_LNUMBER","1",1259],"]",")",")",["T_WHITESPACE"," ",1259],"{",["T_WHITESPACE","\n                ",1259],["T_VARIABLE","$segments",1260],"[",["T_LNUMBER","1",1260],"]",["T_WHITESPACE"," ",1260],"=",["T_WHITESPACE"," ",1260],["T_VARIABLE","$segments",1260],"[",["T_LNUMBER","0",1260],"]",";",["T_WHITESPACE","\n            ",1260],"}",["T_WHITESPACE","\n            ",1261],["T_LIST","list",1262],"(",["T_VARIABLE","$carrierCode",1262],",",["T_WHITESPACE"," ",1262],["T_VARIABLE","$method",1262],")",["T_WHITESPACE"," ",1262],"=",["T_WHITESPACE"," ",1262],["T_VARIABLE","$segments",1262],";",["T_WHITESPACE","\n            ",1262],["T_RETURN","return",1263],["T_WHITESPACE"," ",1263],["T_NEW","new",1263],["T_WHITESPACE"," ",1263],["T_STRING","Varien_Object",1263],"(",["T_ARRAY","array",1263],"(",["T_WHITESPACE","\n                ",1263],["T_CONSTANT_ENCAPSED_STRING","'carrier_code'",1264],["T_WHITESPACE"," ",1264],["T_DOUBLE_ARROW","=>",1264],["T_WHITESPACE"," ",1264],["T_VARIABLE","$carrierCode",1264],",",["T_WHITESPACE","\n                ",1264],["T_CONSTANT_ENCAPSED_STRING","'method'",1265],["T_WHITESPACE","       ",1265],["T_DOUBLE_ARROW","=>",1265],["T_WHITESPACE"," ",1265],["T_VARIABLE","$method",1265],["T_WHITESPACE","\n            ",1265],")",")",";",["T_WHITESPACE","\n        ",1266],"}",["T_WHITESPACE","\n    ",1267],"}",["T_WHITESPACE","\n\n    ",1268],["T_DOC_COMMENT","\/**\n     * Queue email with new order data\n     *\n     * @param bool $forceMode if true then email will be sent regardless of the fact that it was already sent previously\n     *\n     * @return Mage_Sales_Model_Order\n     * @throws Exception\n     *\/",1270],["T_WHITESPACE","\n    ",1277],["T_PUBLIC","public",1278],["T_WHITESPACE"," ",1278],["T_FUNCTION","function",1278],["T_WHITESPACE"," ",1278],["T_STRING","queueNewOrderEmail",1278],"(",["T_VARIABLE","$forceMode",1278],["T_WHITESPACE"," ",1278],"=",["T_WHITESPACE"," ",1278],["T_STRING","false",1278],")",["T_WHITESPACE","\n    ",1278],"{",["T_WHITESPACE","\n        ",1279],["T_VARIABLE","$storeId",1280],["T_WHITESPACE"," ",1280],"=",["T_WHITESPACE"," ",1280],["T_VARIABLE","$this",1280],["T_OBJECT_OPERATOR","->",1280],["T_STRING","getStore",1280],"(",")",["T_OBJECT_OPERATOR","->",1280],["T_STRING","getId",1280],"(",")",";",["T_WHITESPACE","\n\n        ",1280],["T_IF","if",1282],["T_WHITESPACE"," ",1282],"(","!",["T_STRING","Mage",1282],["T_DOUBLE_COLON","::",1282],["T_STRING","helper",1282],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1282],")",["T_OBJECT_OPERATOR","->",1282],["T_STRING","canSendNewOrderEmail",1282],"(",["T_VARIABLE","$storeId",1282],")",")",["T_WHITESPACE"," ",1282],"{",["T_WHITESPACE","\n            ",1282],["T_RETURN","return",1283],["T_WHITESPACE"," ",1283],["T_VARIABLE","$this",1283],";",["T_WHITESPACE","\n        ",1283],"}",["T_WHITESPACE","\n\n        ",1284],["T_COMMENT","\/\/ Get the destination email addresses to send copies to\n",1286],["T_WHITESPACE","        ",1287],["T_VARIABLE","$copyTo",1287],["T_WHITESPACE"," ",1287],"=",["T_WHITESPACE"," ",1287],["T_VARIABLE","$this",1287],["T_OBJECT_OPERATOR","->",1287],["T_STRING","_getEmails",1287],"(",["T_STRING","self",1287],["T_DOUBLE_COLON","::",1287],["T_STRING","XML_PATH_EMAIL_COPY_TO",1287],")",";",["T_WHITESPACE","\n        ",1287],["T_VARIABLE","$copyMethod",1288],["T_WHITESPACE"," ",1288],"=",["T_WHITESPACE"," ",1288],["T_STRING","Mage",1288],["T_DOUBLE_COLON","::",1288],["T_STRING","getStoreConfig",1288],"(",["T_STRING","self",1288],["T_DOUBLE_COLON","::",1288],["T_STRING","XML_PATH_EMAIL_COPY_METHOD",1288],",",["T_WHITESPACE"," ",1288],["T_VARIABLE","$storeId",1288],")",";",["T_WHITESPACE","\n\n        ",1288],["T_COMMENT","\/\/ Start store emulation process\n",1290],["T_WHITESPACE","        ",1291],["T_DOC_COMMENT","\/** @var $appEmulation Mage_Core_Model_App_Emulation *\/",1291],["T_WHITESPACE","\n        ",1291],["T_VARIABLE","$appEmulation",1292],["T_WHITESPACE"," ",1292],"=",["T_WHITESPACE"," ",1292],["T_STRING","Mage",1292],["T_DOUBLE_COLON","::",1292],["T_STRING","getSingleton",1292],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/app_emulation'",1292],")",";",["T_WHITESPACE","\n        ",1292],["T_VARIABLE","$initialEnvironmentInfo",1293],["T_WHITESPACE"," ",1293],"=",["T_WHITESPACE"," ",1293],["T_VARIABLE","$appEmulation",1293],["T_OBJECT_OPERATOR","->",1293],["T_STRING","startEnvironmentEmulation",1293],"(",["T_VARIABLE","$storeId",1293],")",";",["T_WHITESPACE","\n\n        ",1293],["T_TRY","try",1295],["T_WHITESPACE"," ",1295],"{",["T_WHITESPACE","\n            ",1295],["T_COMMENT","\/\/ Retrieve specified view block from appropriate design package (depends on emulated store)\n",1296],["T_WHITESPACE","            ",1297],["T_VARIABLE","$paymentBlock",1297],["T_WHITESPACE"," ",1297],"=",["T_WHITESPACE"," ",1297],["T_STRING","Mage",1297],["T_DOUBLE_COLON","::",1297],["T_STRING","helper",1297],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",1297],")",["T_OBJECT_OPERATOR","->",1297],["T_STRING","getInfoBlock",1297],"(",["T_VARIABLE","$this",1297],["T_OBJECT_OPERATOR","->",1297],["T_STRING","getPayment",1297],"(",")",")",["T_WHITESPACE","\n                ",1297],["T_OBJECT_OPERATOR","->",1298],["T_STRING","setIsSecureMode",1298],"(",["T_STRING","true",1298],")",";",["T_WHITESPACE","\n            ",1298],["T_VARIABLE","$paymentBlock",1299],["T_OBJECT_OPERATOR","->",1299],["T_STRING","getMethod",1299],"(",")",["T_OBJECT_OPERATOR","->",1299],["T_STRING","setStore",1299],"(",["T_VARIABLE","$storeId",1299],")",";",["T_WHITESPACE","\n            ",1299],["T_VARIABLE","$paymentBlockHtml",1300],["T_WHITESPACE"," ",1300],"=",["T_WHITESPACE"," ",1300],["T_VARIABLE","$paymentBlock",1300],["T_OBJECT_OPERATOR","->",1300],["T_STRING","toHtml",1300],"(",")",";",["T_WHITESPACE","\n        ",1300],"}",["T_WHITESPACE"," ",1301],["T_CATCH","catch",1301],["T_WHITESPACE"," ",1301],"(",["T_STRING","Exception",1301],["T_WHITESPACE"," ",1301],["T_VARIABLE","$exception",1301],")",["T_WHITESPACE"," ",1301],"{",["T_WHITESPACE","\n            ",1301],["T_COMMENT","\/\/ Stop store emulation process\n",1302],["T_WHITESPACE","            ",1303],["T_VARIABLE","$appEmulation",1303],["T_OBJECT_OPERATOR","->",1303],["T_STRING","stopEnvironmentEmulation",1303],"(",["T_VARIABLE","$initialEnvironmentInfo",1303],")",";",["T_WHITESPACE","\n            ",1303],["T_THROW","throw",1304],["T_WHITESPACE"," ",1304],["T_VARIABLE","$exception",1304],";",["T_WHITESPACE","\n        ",1304],"}",["T_WHITESPACE","\n\n        ",1305],["T_COMMENT","\/\/ Stop store emulation process\n",1307],["T_WHITESPACE","        ",1308],["T_VARIABLE","$appEmulation",1308],["T_OBJECT_OPERATOR","->",1308],["T_STRING","stopEnvironmentEmulation",1308],"(",["T_VARIABLE","$initialEnvironmentInfo",1308],")",";",["T_WHITESPACE","\n\n        ",1308],["T_COMMENT","\/\/ Retrieve corresponding email template id and customer name\n",1310],["T_WHITESPACE","        ",1311],["T_IF","if",1311],["T_WHITESPACE"," ",1311],"(",["T_VARIABLE","$this",1311],["T_OBJECT_OPERATOR","->",1311],["T_STRING","getCustomerIsGuest",1311],"(",")",")",["T_WHITESPACE"," ",1311],"{",["T_WHITESPACE","\n            ",1311],["T_VARIABLE","$templateId",1312],["T_WHITESPACE"," ",1312],"=",["T_WHITESPACE"," ",1312],["T_STRING","Mage",1312],["T_DOUBLE_COLON","::",1312],["T_STRING","getStoreConfig",1312],"(",["T_STRING","self",1312],["T_DOUBLE_COLON","::",1312],["T_STRING","XML_PATH_EMAIL_GUEST_TEMPLATE",1312],",",["T_WHITESPACE"," ",1312],["T_VARIABLE","$storeId",1312],")",";",["T_WHITESPACE","\n            ",1312],["T_VARIABLE","$customerName",1313],["T_WHITESPACE"," ",1313],"=",["T_WHITESPACE"," ",1313],["T_VARIABLE","$this",1313],["T_OBJECT_OPERATOR","->",1313],["T_STRING","getBillingAddress",1313],"(",")",["T_OBJECT_OPERATOR","->",1313],["T_STRING","getName",1313],"(",")",";",["T_WHITESPACE","\n        ",1313],"}",["T_WHITESPACE"," ",1314],["T_ELSE","else",1314],["T_WHITESPACE"," ",1314],"{",["T_WHITESPACE","\n            ",1314],["T_VARIABLE","$templateId",1315],["T_WHITESPACE"," ",1315],"=",["T_WHITESPACE"," ",1315],["T_STRING","Mage",1315],["T_DOUBLE_COLON","::",1315],["T_STRING","getStoreConfig",1315],"(",["T_STRING","self",1315],["T_DOUBLE_COLON","::",1315],["T_STRING","XML_PATH_EMAIL_TEMPLATE",1315],",",["T_WHITESPACE"," ",1315],["T_VARIABLE","$storeId",1315],")",";",["T_WHITESPACE","\n            ",1315],["T_VARIABLE","$customerName",1316],["T_WHITESPACE"," ",1316],"=",["T_WHITESPACE"," ",1316],["T_VARIABLE","$this",1316],["T_OBJECT_OPERATOR","->",1316],["T_STRING","getCustomerName",1316],"(",")",";",["T_WHITESPACE","\n        ",1316],"}",["T_WHITESPACE","\n\n        ",1317],["T_DOC_COMMENT","\/** @var $mailer Mage_Core_Model_Email_Template_Mailer *\/",1319],["T_WHITESPACE","\n        ",1319],["T_VARIABLE","$mailer",1320],["T_WHITESPACE"," ",1320],"=",["T_WHITESPACE"," ",1320],["T_STRING","Mage",1320],["T_DOUBLE_COLON","::",1320],["T_STRING","getModel",1320],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template_mailer'",1320],")",";",["T_WHITESPACE","\n        ",1320],["T_DOC_COMMENT","\/** @var $emailInfo Mage_Core_Model_Email_Info *\/",1321],["T_WHITESPACE","\n        ",1321],["T_VARIABLE","$emailInfo",1322],["T_WHITESPACE"," ",1322],"=",["T_WHITESPACE"," ",1322],["T_STRING","Mage",1322],["T_DOUBLE_COLON","::",1322],["T_STRING","getModel",1322],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",1322],")",";",["T_WHITESPACE","\n        ",1322],["T_VARIABLE","$emailInfo",1323],["T_OBJECT_OPERATOR","->",1323],["T_STRING","addTo",1323],"(",["T_VARIABLE","$this",1323],["T_OBJECT_OPERATOR","->",1323],["T_STRING","getCustomerEmail",1323],"(",")",",",["T_WHITESPACE"," ",1323],["T_VARIABLE","$customerName",1323],")",";",["T_WHITESPACE","\n        ",1323],["T_IF","if",1324],["T_WHITESPACE"," ",1324],"(",["T_VARIABLE","$copyTo",1324],["T_WHITESPACE"," ",1324],["T_BOOLEAN_AND","&&",1324],["T_WHITESPACE"," ",1324],["T_VARIABLE","$copyMethod",1324],["T_WHITESPACE"," ",1324],["T_IS_EQUAL","==",1324],["T_WHITESPACE"," ",1324],["T_CONSTANT_ENCAPSED_STRING","'bcc'",1324],")",["T_WHITESPACE"," ",1324],"{",["T_WHITESPACE","\n            ",1324],["T_COMMENT","\/\/ Add bcc to customer email\n",1325],["T_WHITESPACE","            ",1326],["T_FOREACH","foreach",1326],["T_WHITESPACE"," ",1326],"(",["T_VARIABLE","$copyTo",1326],["T_WHITESPACE"," ",1326],["T_AS","as",1326],["T_WHITESPACE"," ",1326],["T_VARIABLE","$email",1326],")",["T_WHITESPACE"," ",1326],"{",["T_WHITESPACE","\n                ",1326],["T_VARIABLE","$emailInfo",1327],["T_OBJECT_OPERATOR","->",1327],["T_STRING","addBcc",1327],"(",["T_VARIABLE","$email",1327],")",";",["T_WHITESPACE","\n            ",1327],"}",["T_WHITESPACE","\n        ",1328],"}",["T_WHITESPACE","\n        ",1329],["T_VARIABLE","$mailer",1330],["T_OBJECT_OPERATOR","->",1330],["T_STRING","addEmailInfo",1330],"(",["T_VARIABLE","$emailInfo",1330],")",";",["T_WHITESPACE","\n\n        ",1330],["T_COMMENT","\/\/ Email copies are sent as separated emails if their copy method is 'copy'\n",1332],["T_WHITESPACE","        ",1333],["T_IF","if",1333],["T_WHITESPACE"," ",1333],"(",["T_VARIABLE","$copyTo",1333],["T_WHITESPACE"," ",1333],["T_BOOLEAN_AND","&&",1333],["T_WHITESPACE"," ",1333],["T_VARIABLE","$copyMethod",1333],["T_WHITESPACE"," ",1333],["T_IS_EQUAL","==",1333],["T_WHITESPACE"," ",1333],["T_CONSTANT_ENCAPSED_STRING","'copy'",1333],")",["T_WHITESPACE"," ",1333],"{",["T_WHITESPACE","\n            ",1333],["T_FOREACH","foreach",1334],["T_WHITESPACE"," ",1334],"(",["T_VARIABLE","$copyTo",1334],["T_WHITESPACE"," ",1334],["T_AS","as",1334],["T_WHITESPACE"," ",1334],["T_VARIABLE","$email",1334],")",["T_WHITESPACE"," ",1334],"{",["T_WHITESPACE","\n                ",1334],["T_VARIABLE","$emailInfo",1335],["T_WHITESPACE"," ",1335],"=",["T_WHITESPACE"," ",1335],["T_STRING","Mage",1335],["T_DOUBLE_COLON","::",1335],["T_STRING","getModel",1335],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",1335],")",";",["T_WHITESPACE","\n                ",1335],["T_VARIABLE","$emailInfo",1336],["T_OBJECT_OPERATOR","->",1336],["T_STRING","addTo",1336],"(",["T_VARIABLE","$email",1336],")",";",["T_WHITESPACE","\n                ",1336],["T_VARIABLE","$mailer",1337],["T_OBJECT_OPERATOR","->",1337],["T_STRING","addEmailInfo",1337],"(",["T_VARIABLE","$emailInfo",1337],")",";",["T_WHITESPACE","\n            ",1337],"}",["T_WHITESPACE","\n        ",1338],"}",["T_WHITESPACE","\n\n        ",1339],["T_COMMENT","\/\/ Set all required params and send emails\n",1341],["T_WHITESPACE","        ",1342],["T_VARIABLE","$mailer",1342],["T_OBJECT_OPERATOR","->",1342],["T_STRING","setSender",1342],"(",["T_STRING","Mage",1342],["T_DOUBLE_COLON","::",1342],["T_STRING","getStoreConfig",1342],"(",["T_STRING","self",1342],["T_DOUBLE_COLON","::",1342],["T_STRING","XML_PATH_EMAIL_IDENTITY",1342],",",["T_WHITESPACE"," ",1342],["T_VARIABLE","$storeId",1342],")",")",";",["T_WHITESPACE","\n        ",1342],["T_VARIABLE","$mailer",1343],["T_OBJECT_OPERATOR","->",1343],["T_STRING","setStoreId",1343],"(",["T_VARIABLE","$storeId",1343],")",";",["T_WHITESPACE","\n        ",1343],["T_VARIABLE","$mailer",1344],["T_OBJECT_OPERATOR","->",1344],["T_STRING","setTemplateId",1344],"(",["T_VARIABLE","$templateId",1344],")",";",["T_WHITESPACE","\n        ",1344],["T_VARIABLE","$mailer",1345],["T_OBJECT_OPERATOR","->",1345],["T_STRING","setTemplateParams",1345],"(",["T_ARRAY","array",1345],"(",["T_WHITESPACE","\n            ",1345],["T_CONSTANT_ENCAPSED_STRING","'order'",1346],["T_WHITESPACE","        ",1346],["T_DOUBLE_ARROW","=>",1346],["T_WHITESPACE"," ",1346],["T_VARIABLE","$this",1346],",",["T_WHITESPACE","\n            ",1346],["T_CONSTANT_ENCAPSED_STRING","'billing'",1347],["T_WHITESPACE","      ",1347],["T_DOUBLE_ARROW","=>",1347],["T_WHITESPACE"," ",1347],["T_VARIABLE","$this",1347],["T_OBJECT_OPERATOR","->",1347],["T_STRING","getBillingAddress",1347],"(",")",",",["T_WHITESPACE","\n            ",1347],["T_CONSTANT_ENCAPSED_STRING","'payment_html'",1348],["T_WHITESPACE"," ",1348],["T_DOUBLE_ARROW","=>",1348],["T_WHITESPACE"," ",1348],["T_VARIABLE","$paymentBlockHtml",1348],["T_WHITESPACE","\n        ",1348],")",")",";",["T_WHITESPACE","\n\n        ",1349],["T_DOC_COMMENT","\/** @var $emailQueue Mage_Core_Model_Email_Queue *\/",1351],["T_WHITESPACE","\n        ",1351],["T_VARIABLE","$emailQueue",1352],["T_WHITESPACE"," ",1352],"=",["T_WHITESPACE"," ",1352],["T_STRING","Mage",1352],["T_DOUBLE_COLON","::",1352],["T_STRING","getModel",1352],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_queue'",1352],")",";",["T_WHITESPACE","\n        ",1352],["T_VARIABLE","$emailQueue",1353],["T_OBJECT_OPERATOR","->",1353],["T_STRING","setEntityId",1353],"(",["T_VARIABLE","$this",1353],["T_OBJECT_OPERATOR","->",1353],["T_STRING","getId",1353],"(",")",")",["T_WHITESPACE","\n            ",1353],["T_OBJECT_OPERATOR","->",1354],["T_STRING","setEntityType",1354],"(",["T_STRING","self",1354],["T_DOUBLE_COLON","::",1354],["T_STRING","ENTITY",1354],")",["T_WHITESPACE","\n            ",1354],["T_OBJECT_OPERATOR","->",1355],["T_STRING","setEventType",1355],"(",["T_STRING","self",1355],["T_DOUBLE_COLON","::",1355],["T_STRING","EMAIL_EVENT_NAME_NEW_ORDER",1355],")",["T_WHITESPACE","\n            ",1355],["T_OBJECT_OPERATOR","->",1356],["T_STRING","setIsForceCheck",1356],"(","!",["T_VARIABLE","$forceMode",1356],")",";",["T_WHITESPACE","\n\n        ",1356],["T_VARIABLE","$mailer",1358],["T_OBJECT_OPERATOR","->",1358],["T_STRING","setQueue",1358],"(",["T_VARIABLE","$emailQueue",1358],")",["T_OBJECT_OPERATOR","->",1358],["T_STRING","send",1358],"(",")",";",["T_WHITESPACE","\n\n        ",1358],["T_VARIABLE","$this",1360],["T_OBJECT_OPERATOR","->",1360],["T_STRING","setEmailSent",1360],"(",["T_STRING","true",1360],")",";",["T_WHITESPACE","\n        ",1360],["T_VARIABLE","$this",1361],["T_OBJECT_OPERATOR","->",1361],["T_STRING","_getResource",1361],"(",")",["T_OBJECT_OPERATOR","->",1361],["T_STRING","saveAttribute",1361],"(",["T_VARIABLE","$this",1361],",",["T_WHITESPACE"," ",1361],["T_CONSTANT_ENCAPSED_STRING","'email_sent'",1361],")",";",["T_WHITESPACE","\n\n        ",1361],["T_RETURN","return",1363],["T_WHITESPACE"," ",1363],["T_VARIABLE","$this",1363],";",["T_WHITESPACE","\n    ",1363],"}",["T_WHITESPACE","\n\n    ",1364],["T_DOC_COMMENT","\/**\n     * Send email with order data\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",1366],["T_WHITESPACE","\n    ",1370],["T_PUBLIC","public",1371],["T_WHITESPACE"," ",1371],["T_FUNCTION","function",1371],["T_WHITESPACE"," ",1371],["T_STRING","sendNewOrderEmail",1371],"(",")",["T_WHITESPACE","\n    ",1371],"{",["T_WHITESPACE","\n        ",1372],["T_VARIABLE","$this",1373],["T_OBJECT_OPERATOR","->",1373],["T_STRING","queueNewOrderEmail",1373],"(",["T_STRING","true",1373],")",";",["T_WHITESPACE","\n        ",1373],["T_RETURN","return",1374],["T_WHITESPACE"," ",1374],["T_VARIABLE","$this",1374],";",["T_WHITESPACE","\n    ",1374],"}",["T_WHITESPACE","\n\n    ",1375],["T_DOC_COMMENT","\/**\n     * Queue email with order update information\n     *\n     * @param boolean $notifyCustomer\n     * @param string $comment\n     * @param bool $forceMode if true then email will be sent regardless of the fact that it was already sent previously\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",1377],["T_WHITESPACE","\n    ",1385],["T_PUBLIC","public",1386],["T_WHITESPACE"," ",1386],["T_FUNCTION","function",1386],["T_WHITESPACE"," ",1386],["T_STRING","queueOrderUpdateEmail",1386],"(",["T_VARIABLE","$notifyCustomer",1386],["T_WHITESPACE"," ",1386],"=",["T_WHITESPACE"," ",1386],["T_STRING","true",1386],",",["T_WHITESPACE"," ",1386],["T_VARIABLE","$comment",1386],["T_WHITESPACE"," ",1386],"=",["T_WHITESPACE"," ",1386],["T_CONSTANT_ENCAPSED_STRING","''",1386],",",["T_WHITESPACE"," ",1386],["T_VARIABLE","$forceMode",1386],["T_WHITESPACE"," ",1386],"=",["T_WHITESPACE"," ",1386],["T_STRING","false",1386],")",["T_WHITESPACE","\n    ",1386],"{",["T_WHITESPACE","\n        ",1387],["T_VARIABLE","$storeId",1388],["T_WHITESPACE"," ",1388],"=",["T_WHITESPACE"," ",1388],["T_VARIABLE","$this",1388],["T_OBJECT_OPERATOR","->",1388],["T_STRING","getStore",1388],"(",")",["T_OBJECT_OPERATOR","->",1388],["T_STRING","getId",1388],"(",")",";",["T_WHITESPACE","\n\n        ",1388],["T_IF","if",1390],["T_WHITESPACE"," ",1390],"(","!",["T_STRING","Mage",1390],["T_DOUBLE_COLON","::",1390],["T_STRING","helper",1390],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1390],")",["T_OBJECT_OPERATOR","->",1390],["T_STRING","canSendOrderCommentEmail",1390],"(",["T_VARIABLE","$storeId",1390],")",")",["T_WHITESPACE"," ",1390],"{",["T_WHITESPACE","\n            ",1390],["T_RETURN","return",1391],["T_WHITESPACE"," ",1391],["T_VARIABLE","$this",1391],";",["T_WHITESPACE","\n        ",1391],"}",["T_WHITESPACE","\n        ",1392],["T_COMMENT","\/\/ Get the destination email addresses to send copies to\n",1393],["T_WHITESPACE","        ",1394],["T_VARIABLE","$copyTo",1394],["T_WHITESPACE"," ",1394],"=",["T_WHITESPACE"," ",1394],["T_VARIABLE","$this",1394],["T_OBJECT_OPERATOR","->",1394],["T_STRING","_getEmails",1394],"(",["T_STRING","self",1394],["T_DOUBLE_COLON","::",1394],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_TO",1394],")",";",["T_WHITESPACE","\n        ",1394],["T_VARIABLE","$copyMethod",1395],["T_WHITESPACE"," ",1395],"=",["T_WHITESPACE"," ",1395],["T_STRING","Mage",1395],["T_DOUBLE_COLON","::",1395],["T_STRING","getStoreConfig",1395],"(",["T_STRING","self",1395],["T_DOUBLE_COLON","::",1395],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_METHOD",1395],",",["T_WHITESPACE"," ",1395],["T_VARIABLE","$storeId",1395],")",";",["T_WHITESPACE","\n        ",1395],["T_COMMENT","\/\/ Check if at least one recipient is found\n",1396],["T_WHITESPACE","        ",1397],["T_IF","if",1397],["T_WHITESPACE"," ",1397],"(","!",["T_VARIABLE","$notifyCustomer",1397],["T_WHITESPACE"," ",1397],["T_BOOLEAN_AND","&&",1397],["T_WHITESPACE"," ",1397],"!",["T_VARIABLE","$copyTo",1397],")",["T_WHITESPACE"," ",1397],"{",["T_WHITESPACE","\n            ",1397],["T_RETURN","return",1398],["T_WHITESPACE"," ",1398],["T_VARIABLE","$this",1398],";",["T_WHITESPACE","\n        ",1398],"}",["T_WHITESPACE","\n\n        ",1399],["T_COMMENT","\/\/ Retrieve corresponding email template id and customer name\n",1401],["T_WHITESPACE","        ",1402],["T_IF","if",1402],["T_WHITESPACE"," ",1402],"(",["T_VARIABLE","$this",1402],["T_OBJECT_OPERATOR","->",1402],["T_STRING","getCustomerIsGuest",1402],"(",")",")",["T_WHITESPACE"," ",1402],"{",["T_WHITESPACE","\n            ",1402],["T_VARIABLE","$templateId",1403],["T_WHITESPACE"," ",1403],"=",["T_WHITESPACE"," ",1403],["T_STRING","Mage",1403],["T_DOUBLE_COLON","::",1403],["T_STRING","getStoreConfig",1403],"(",["T_STRING","self",1403],["T_DOUBLE_COLON","::",1403],["T_STRING","XML_PATH_UPDATE_EMAIL_GUEST_TEMPLATE",1403],",",["T_WHITESPACE"," ",1403],["T_VARIABLE","$storeId",1403],")",";",["T_WHITESPACE","\n            ",1403],["T_VARIABLE","$customerName",1404],["T_WHITESPACE"," ",1404],"=",["T_WHITESPACE"," ",1404],["T_VARIABLE","$this",1404],["T_OBJECT_OPERATOR","->",1404],["T_STRING","getBillingAddress",1404],"(",")",["T_OBJECT_OPERATOR","->",1404],["T_STRING","getName",1404],"(",")",";",["T_WHITESPACE","\n        ",1404],"}",["T_WHITESPACE"," ",1405],["T_ELSE","else",1405],["T_WHITESPACE"," ",1405],"{",["T_WHITESPACE","\n            ",1405],["T_VARIABLE","$templateId",1406],["T_WHITESPACE"," ",1406],"=",["T_WHITESPACE"," ",1406],["T_STRING","Mage",1406],["T_DOUBLE_COLON","::",1406],["T_STRING","getStoreConfig",1406],"(",["T_STRING","self",1406],["T_DOUBLE_COLON","::",1406],["T_STRING","XML_PATH_UPDATE_EMAIL_TEMPLATE",1406],",",["T_WHITESPACE"," ",1406],["T_VARIABLE","$storeId",1406],")",";",["T_WHITESPACE","\n            ",1406],["T_VARIABLE","$customerName",1407],["T_WHITESPACE"," ",1407],"=",["T_WHITESPACE"," ",1407],["T_VARIABLE","$this",1407],["T_OBJECT_OPERATOR","->",1407],["T_STRING","getCustomerName",1407],"(",")",";",["T_WHITESPACE","\n        ",1407],"}",["T_WHITESPACE","\n\n        ",1408],["T_DOC_COMMENT","\/** @var $mailer Mage_Core_Model_Email_Template_Mailer *\/",1410],["T_WHITESPACE","\n        ",1410],["T_VARIABLE","$mailer",1411],["T_WHITESPACE"," ",1411],"=",["T_WHITESPACE"," ",1411],["T_STRING","Mage",1411],["T_DOUBLE_COLON","::",1411],["T_STRING","getModel",1411],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template_mailer'",1411],")",";",["T_WHITESPACE","\n        ",1411],["T_IF","if",1412],["T_WHITESPACE"," ",1412],"(",["T_VARIABLE","$notifyCustomer",1412],")",["T_WHITESPACE"," ",1412],"{",["T_WHITESPACE","\n            ",1412],["T_DOC_COMMENT","\/** @var $emailInfo Mage_Core_Model_Email_Info *\/",1413],["T_WHITESPACE","\n            ",1413],["T_VARIABLE","$emailInfo",1414],["T_WHITESPACE"," ",1414],"=",["T_WHITESPACE"," ",1414],["T_STRING","Mage",1414],["T_DOUBLE_COLON","::",1414],["T_STRING","getModel",1414],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",1414],")",";",["T_WHITESPACE","\n            ",1414],["T_VARIABLE","$emailInfo",1415],["T_OBJECT_OPERATOR","->",1415],["T_STRING","addTo",1415],"(",["T_VARIABLE","$this",1415],["T_OBJECT_OPERATOR","->",1415],["T_STRING","getCustomerEmail",1415],"(",")",",",["T_WHITESPACE"," ",1415],["T_VARIABLE","$customerName",1415],")",";",["T_WHITESPACE","\n            ",1415],["T_IF","if",1416],["T_WHITESPACE"," ",1416],"(",["T_VARIABLE","$copyTo",1416],["T_WHITESPACE"," ",1416],["T_BOOLEAN_AND","&&",1416],["T_WHITESPACE"," ",1416],["T_VARIABLE","$copyMethod",1416],["T_WHITESPACE"," ",1416],["T_IS_EQUAL","==",1416],["T_WHITESPACE"," ",1416],["T_CONSTANT_ENCAPSED_STRING","'bcc'",1416],")",["T_WHITESPACE"," ",1416],"{",["T_WHITESPACE","\n                ",1416],["T_COMMENT","\/\/ Add bcc to customer email\n",1417],["T_WHITESPACE","                ",1418],["T_FOREACH","foreach",1418],["T_WHITESPACE"," ",1418],"(",["T_VARIABLE","$copyTo",1418],["T_WHITESPACE"," ",1418],["T_AS","as",1418],["T_WHITESPACE"," ",1418],["T_VARIABLE","$email",1418],")",["T_WHITESPACE"," ",1418],"{",["T_WHITESPACE","\n                    ",1418],["T_VARIABLE","$emailInfo",1419],["T_OBJECT_OPERATOR","->",1419],["T_STRING","addBcc",1419],"(",["T_VARIABLE","$email",1419],")",";",["T_WHITESPACE","\n                ",1419],"}",["T_WHITESPACE","\n            ",1420],"}",["T_WHITESPACE","\n            ",1421],["T_VARIABLE","$mailer",1422],["T_OBJECT_OPERATOR","->",1422],["T_STRING","addEmailInfo",1422],"(",["T_VARIABLE","$emailInfo",1422],")",";",["T_WHITESPACE","\n        ",1422],"}",["T_WHITESPACE","\n\n        ",1423],["T_COMMENT","\/\/ Email copies are sent as separated emails if their copy method is\n",1425],["T_WHITESPACE","        ",1426],["T_COMMENT","\/\/ 'copy' or a customer should not be notified\n",1426],["T_WHITESPACE","        ",1427],["T_IF","if",1427],["T_WHITESPACE"," ",1427],"(",["T_VARIABLE","$copyTo",1427],["T_WHITESPACE"," ",1427],["T_BOOLEAN_AND","&&",1427],["T_WHITESPACE"," ",1427],"(",["T_VARIABLE","$copyMethod",1427],["T_WHITESPACE"," ",1427],["T_IS_EQUAL","==",1427],["T_WHITESPACE"," ",1427],["T_CONSTANT_ENCAPSED_STRING","'copy'",1427],["T_WHITESPACE"," ",1427],["T_BOOLEAN_OR","||",1427],["T_WHITESPACE"," ",1427],"!",["T_VARIABLE","$notifyCustomer",1427],")",")",["T_WHITESPACE"," ",1427],"{",["T_WHITESPACE","\n            ",1427],["T_FOREACH","foreach",1428],["T_WHITESPACE"," ",1428],"(",["T_VARIABLE","$copyTo",1428],["T_WHITESPACE"," ",1428],["T_AS","as",1428],["T_WHITESPACE"," ",1428],["T_VARIABLE","$email",1428],")",["T_WHITESPACE"," ",1428],"{",["T_WHITESPACE","\n                ",1428],["T_VARIABLE","$emailInfo",1429],["T_WHITESPACE"," ",1429],"=",["T_WHITESPACE"," ",1429],["T_STRING","Mage",1429],["T_DOUBLE_COLON","::",1429],["T_STRING","getModel",1429],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",1429],")",";",["T_WHITESPACE","\n                ",1429],["T_VARIABLE","$emailInfo",1430],["T_OBJECT_OPERATOR","->",1430],["T_STRING","addTo",1430],"(",["T_VARIABLE","$email",1430],")",";",["T_WHITESPACE","\n                ",1430],["T_VARIABLE","$mailer",1431],["T_OBJECT_OPERATOR","->",1431],["T_STRING","addEmailInfo",1431],"(",["T_VARIABLE","$emailInfo",1431],")",";",["T_WHITESPACE","\n            ",1431],"}",["T_WHITESPACE","\n        ",1432],"}",["T_WHITESPACE","\n\n        ",1433],["T_COMMENT","\/\/ Set all required params and send emails\n",1435],["T_WHITESPACE","        ",1436],["T_VARIABLE","$mailer",1436],["T_OBJECT_OPERATOR","->",1436],["T_STRING","setSender",1436],"(",["T_STRING","Mage",1436],["T_DOUBLE_COLON","::",1436],["T_STRING","getStoreConfig",1436],"(",["T_STRING","self",1436],["T_DOUBLE_COLON","::",1436],["T_STRING","XML_PATH_UPDATE_EMAIL_IDENTITY",1436],",",["T_WHITESPACE"," ",1436],["T_VARIABLE","$storeId",1436],")",")",";",["T_WHITESPACE","\n        ",1436],["T_VARIABLE","$mailer",1437],["T_OBJECT_OPERATOR","->",1437],["T_STRING","setStoreId",1437],"(",["T_VARIABLE","$storeId",1437],")",";",["T_WHITESPACE","\n        ",1437],["T_VARIABLE","$mailer",1438],["T_OBJECT_OPERATOR","->",1438],["T_STRING","setTemplateId",1438],"(",["T_VARIABLE","$templateId",1438],")",";",["T_WHITESPACE","\n        ",1438],["T_VARIABLE","$mailer",1439],["T_OBJECT_OPERATOR","->",1439],["T_STRING","setTemplateParams",1439],"(",["T_ARRAY","array",1439],"(",["T_WHITESPACE","\n                ",1439],["T_CONSTANT_ENCAPSED_STRING","'order'",1440],["T_WHITESPACE","   ",1440],["T_DOUBLE_ARROW","=>",1440],["T_WHITESPACE"," ",1440],["T_VARIABLE","$this",1440],",",["T_WHITESPACE","\n                ",1440],["T_CONSTANT_ENCAPSED_STRING","'comment'",1441],["T_WHITESPACE"," ",1441],["T_DOUBLE_ARROW","=>",1441],["T_WHITESPACE"," ",1441],["T_VARIABLE","$comment",1441],",",["T_WHITESPACE","\n                ",1441],["T_CONSTANT_ENCAPSED_STRING","'billing'",1442],["T_WHITESPACE"," ",1442],["T_DOUBLE_ARROW","=>",1442],["T_WHITESPACE"," ",1442],["T_VARIABLE","$this",1442],["T_OBJECT_OPERATOR","->",1442],["T_STRING","getBillingAddress",1442],"(",")",["T_WHITESPACE","\n            ",1442],")",["T_WHITESPACE","\n        ",1443],")",";",["T_WHITESPACE","\n\n        ",1444],["T_DOC_COMMENT","\/** @var $emailQueue Mage_Core_Model_Email_Queue *\/",1446],["T_WHITESPACE","\n        ",1446],["T_VARIABLE","$emailQueue",1447],["T_WHITESPACE"," ",1447],"=",["T_WHITESPACE"," ",1447],["T_STRING","Mage",1447],["T_DOUBLE_COLON","::",1447],["T_STRING","getModel",1447],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_queue'",1447],")",";",["T_WHITESPACE","\n        ",1447],["T_VARIABLE","$emailQueue",1448],["T_OBJECT_OPERATOR","->",1448],["T_STRING","setEntityId",1448],"(",["T_VARIABLE","$this",1448],["T_OBJECT_OPERATOR","->",1448],["T_STRING","getId",1448],"(",")",")",["T_WHITESPACE","\n            ",1448],["T_OBJECT_OPERATOR","->",1449],["T_STRING","setEntityType",1449],"(",["T_STRING","self",1449],["T_DOUBLE_COLON","::",1449],["T_STRING","ENTITY",1449],")",["T_WHITESPACE","\n            ",1449],["T_OBJECT_OPERATOR","->",1450],["T_STRING","setEventType",1450],"(",["T_STRING","self",1450],["T_DOUBLE_COLON","::",1450],["T_STRING","EMAIL_EVENT_NAME_UPDATE_ORDER",1450],")",["T_WHITESPACE","\n            ",1450],["T_OBJECT_OPERATOR","->",1451],["T_STRING","setIsForceCheck",1451],"(","!",["T_VARIABLE","$forceMode",1451],")",";",["T_WHITESPACE","\n        ",1451],["T_VARIABLE","$mailer",1452],["T_OBJECT_OPERATOR","->",1452],["T_STRING","setQueue",1452],"(",["T_VARIABLE","$emailQueue",1452],")",["T_OBJECT_OPERATOR","->",1452],["T_STRING","send",1452],"(",")",";",["T_WHITESPACE","\n\n        ",1452],["T_RETURN","return",1454],["T_WHITESPACE"," ",1454],["T_VARIABLE","$this",1454],";",["T_WHITESPACE","\n    ",1454],"}",["T_WHITESPACE","\n\n    ",1455],["T_DOC_COMMENT","\/**\n     * Send email with order update information\n     *\n     * @param bool $notifyCustomer\n     * @param string $comment\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",1457],["T_WHITESPACE","\n    ",1464],["T_PUBLIC","public",1465],["T_WHITESPACE"," ",1465],["T_FUNCTION","function",1465],["T_WHITESPACE"," ",1465],["T_STRING","sendOrderUpdateEmail",1465],"(",["T_VARIABLE","$notifyCustomer",1465],["T_WHITESPACE"," ",1465],"=",["T_WHITESPACE"," ",1465],["T_STRING","true",1465],",",["T_WHITESPACE"," ",1465],["T_VARIABLE","$comment",1465],["T_WHITESPACE"," ",1465],"=",["T_WHITESPACE"," ",1465],["T_CONSTANT_ENCAPSED_STRING","''",1465],")",["T_WHITESPACE","\n    ",1465],"{",["T_WHITESPACE","\n        ",1466],["T_VARIABLE","$this",1467],["T_OBJECT_OPERATOR","->",1467],["T_STRING","queueOrderUpdateEmail",1467],"(",["T_VARIABLE","$notifyCustomer",1467],",",["T_WHITESPACE"," ",1467],["T_VARIABLE","$comment",1467],",",["T_WHITESPACE"," ",1467],["T_STRING","true",1467],")",";",["T_WHITESPACE","\n         ",1467],["T_RETURN","return",1468],["T_WHITESPACE"," ",1468],["T_VARIABLE","$this",1468],";",["T_WHITESPACE","\n     ",1468],"}",["T_WHITESPACE","\n\n    ",1469],["T_PROTECTED","protected",1471],["T_WHITESPACE"," ",1471],["T_FUNCTION","function",1471],["T_WHITESPACE"," ",1471],["T_STRING","_getEmails",1471],"(",["T_VARIABLE","$configPath",1471],")",["T_WHITESPACE","\n    ",1471],"{",["T_WHITESPACE","\n        ",1472],["T_VARIABLE","$data",1473],["T_WHITESPACE"," ",1473],"=",["T_WHITESPACE"," ",1473],["T_STRING","Mage",1473],["T_DOUBLE_COLON","::",1473],["T_STRING","getStoreConfig",1473],"(",["T_VARIABLE","$configPath",1473],",",["T_WHITESPACE"," ",1473],["T_VARIABLE","$this",1473],["T_OBJECT_OPERATOR","->",1473],["T_STRING","getStoreId",1473],"(",")",")",";",["T_WHITESPACE","\n        ",1473],["T_IF","if",1474],["T_WHITESPACE"," ",1474],"(","!",["T_EMPTY","empty",1474],"(",["T_VARIABLE","$data",1474],")",")",["T_WHITESPACE"," ",1474],"{",["T_WHITESPACE","\n            ",1474],["T_RETURN","return",1475],["T_WHITESPACE"," ",1475],["T_STRING","explode",1475],"(",["T_CONSTANT_ENCAPSED_STRING","','",1475],",",["T_WHITESPACE"," ",1475],["T_VARIABLE","$data",1475],")",";",["T_WHITESPACE","\n        ",1475],"}",["T_WHITESPACE","\n        ",1476],["T_RETURN","return",1477],["T_WHITESPACE"," ",1477],["T_STRING","false",1477],";",["T_WHITESPACE","\n    ",1477],"}",["T_WHITESPACE","\n\n",1478],["T_COMMENT","\/*********************** ADDRESSES ***************************\/",1480],["T_WHITESPACE","\n\n    ",1480],["T_PUBLIC","public",1482],["T_WHITESPACE"," ",1482],["T_FUNCTION","function",1482],["T_WHITESPACE"," ",1482],["T_STRING","getAddressesCollection",1482],"(",")",["T_WHITESPACE","\n    ",1482],"{",["T_WHITESPACE","\n        ",1483],["T_IF","if",1484],["T_WHITESPACE"," ",1484],"(",["T_STRING","is_null",1484],"(",["T_VARIABLE","$this",1484],["T_OBJECT_OPERATOR","->",1484],["T_STRING","_addresses",1484],")",")",["T_WHITESPACE"," ",1484],"{",["T_WHITESPACE","\n            ",1484],["T_VARIABLE","$this",1485],["T_OBJECT_OPERATOR","->",1485],["T_STRING","_addresses",1485],["T_WHITESPACE"," ",1485],"=",["T_WHITESPACE"," ",1485],["T_STRING","Mage",1485],["T_DOUBLE_COLON","::",1485],["T_STRING","getResourceModel",1485],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_address_collection'",1485],")",["T_WHITESPACE","\n                ",1485],["T_OBJECT_OPERATOR","->",1486],["T_STRING","setOrderFilter",1486],"(",["T_VARIABLE","$this",1486],")",";",["T_WHITESPACE","\n\n            ",1486],["T_IF","if",1488],["T_WHITESPACE"," ",1488],"(",["T_VARIABLE","$this",1488],["T_OBJECT_OPERATOR","->",1488],["T_STRING","getId",1488],"(",")",")",["T_WHITESPACE"," ",1488],"{",["T_WHITESPACE","\n                ",1488],["T_FOREACH","foreach",1489],["T_WHITESPACE"," ",1489],"(",["T_VARIABLE","$this",1489],["T_OBJECT_OPERATOR","->",1489],["T_STRING","_addresses",1489],["T_WHITESPACE"," ",1489],["T_AS","as",1489],["T_WHITESPACE"," ",1489],["T_VARIABLE","$address",1489],")",["T_WHITESPACE"," ",1489],"{",["T_WHITESPACE","\n                    ",1489],["T_VARIABLE","$address",1490],["T_OBJECT_OPERATOR","->",1490],["T_STRING","setOrder",1490],"(",["T_VARIABLE","$this",1490],")",";",["T_WHITESPACE","\n                ",1490],"}",["T_WHITESPACE","\n            ",1491],"}",["T_WHITESPACE","\n        ",1492],"}",["T_WHITESPACE","\n\n        ",1493],["T_RETURN","return",1495],["T_WHITESPACE"," ",1495],["T_VARIABLE","$this",1495],["T_OBJECT_OPERATOR","->",1495],["T_STRING","_addresses",1495],";",["T_WHITESPACE","\n    ",1495],"}",["T_WHITESPACE","\n\n    ",1496],["T_PUBLIC","public",1498],["T_WHITESPACE"," ",1498],["T_FUNCTION","function",1498],["T_WHITESPACE"," ",1498],["T_STRING","getAddressById",1498],"(",["T_VARIABLE","$addressId",1498],")",["T_WHITESPACE","\n    ",1498],"{",["T_WHITESPACE","\n        ",1499],["T_FOREACH","foreach",1500],["T_WHITESPACE"," ",1500],"(",["T_VARIABLE","$this",1500],["T_OBJECT_OPERATOR","->",1500],["T_STRING","getAddressesCollection",1500],"(",")",["T_WHITESPACE"," ",1500],["T_AS","as",1500],["T_WHITESPACE"," ",1500],["T_VARIABLE","$address",1500],")",["T_WHITESPACE"," ",1500],"{",["T_WHITESPACE","\n            ",1500],["T_IF","if",1501],["T_WHITESPACE"," ",1501],"(",["T_VARIABLE","$address",1501],["T_OBJECT_OPERATOR","->",1501],["T_STRING","getId",1501],"(",")",["T_IS_EQUAL","==",1501],["T_VARIABLE","$addressId",1501],")",["T_WHITESPACE"," ",1501],"{",["T_WHITESPACE","\n                ",1501],["T_RETURN","return",1502],["T_WHITESPACE"," ",1502],["T_VARIABLE","$address",1502],";",["T_WHITESPACE","\n            ",1502],"}",["T_WHITESPACE","\n        ",1503],"}",["T_WHITESPACE","\n        ",1504],["T_RETURN","return",1505],["T_WHITESPACE"," ",1505],["T_STRING","false",1505],";",["T_WHITESPACE","\n    ",1505],"}",["T_WHITESPACE","\n\n    ",1506],["T_PUBLIC","public",1508],["T_WHITESPACE"," ",1508],["T_FUNCTION","function",1508],["T_WHITESPACE"," ",1508],["T_STRING","addAddress",1508],"(",["T_STRING","Mage_Sales_Model_Order_Address",1508],["T_WHITESPACE"," ",1508],["T_VARIABLE","$address",1508],")",["T_WHITESPACE","\n    ",1508],"{",["T_WHITESPACE","\n        ",1509],["T_VARIABLE","$address",1510],["T_OBJECT_OPERATOR","->",1510],["T_STRING","setOrder",1510],"(",["T_VARIABLE","$this",1510],")",["T_OBJECT_OPERATOR","->",1510],["T_STRING","setParentId",1510],"(",["T_VARIABLE","$this",1510],["T_OBJECT_OPERATOR","->",1510],["T_STRING","getId",1510],"(",")",")",";",["T_WHITESPACE","\n        ",1510],["T_IF","if",1511],["T_WHITESPACE"," ",1511],"(","!",["T_VARIABLE","$address",1511],["T_OBJECT_OPERATOR","->",1511],["T_STRING","getId",1511],"(",")",")",["T_WHITESPACE"," ",1511],"{",["T_WHITESPACE","\n            ",1511],["T_VARIABLE","$this",1512],["T_OBJECT_OPERATOR","->",1512],["T_STRING","getAddressesCollection",1512],"(",")",["T_OBJECT_OPERATOR","->",1512],["T_STRING","addItem",1512],"(",["T_VARIABLE","$address",1512],")",";",["T_WHITESPACE","\n        ",1512],"}",["T_WHITESPACE","\n        ",1513],["T_RETURN","return",1514],["T_WHITESPACE"," ",1514],["T_VARIABLE","$this",1514],";",["T_WHITESPACE","\n    ",1514],"}",["T_WHITESPACE","\n\n    ",1515],["T_PUBLIC","public",1517],["T_WHITESPACE"," ",1517],["T_FUNCTION","function",1517],["T_WHITESPACE"," ",1517],["T_STRING","getItemsCollection",1517],"(",["T_VARIABLE","$filterByTypes",1517],["T_WHITESPACE"," ",1517],"=",["T_WHITESPACE"," ",1517],["T_ARRAY","array",1517],"(",")",",",["T_WHITESPACE"," ",1517],["T_VARIABLE","$nonChildrenOnly",1517],["T_WHITESPACE"," ",1517],"=",["T_WHITESPACE"," ",1517],["T_STRING","false",1517],")",["T_WHITESPACE","\n    ",1517],"{",["T_WHITESPACE","\n        ",1518],["T_IF","if",1519],["T_WHITESPACE"," ",1519],"(",["T_STRING","is_null",1519],"(",["T_VARIABLE","$this",1519],["T_OBJECT_OPERATOR","->",1519],["T_STRING","_items",1519],")",")",["T_WHITESPACE"," ",1519],"{",["T_WHITESPACE","\n            ",1519],["T_VARIABLE","$this",1520],["T_OBJECT_OPERATOR","->",1520],["T_STRING","_items",1520],["T_WHITESPACE"," ",1520],"=",["T_WHITESPACE"," ",1520],["T_STRING","Mage",1520],["T_DOUBLE_COLON","::",1520],["T_STRING","getResourceModel",1520],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_item_collection'",1520],")",["T_WHITESPACE","\n                ",1520],["T_OBJECT_OPERATOR","->",1521],["T_STRING","setOrderFilter",1521],"(",["T_VARIABLE","$this",1521],")",";",["T_WHITESPACE","\n\n            ",1521],["T_IF","if",1523],["T_WHITESPACE"," ",1523],"(",["T_VARIABLE","$filterByTypes",1523],")",["T_WHITESPACE"," ",1523],"{",["T_WHITESPACE","\n                ",1523],["T_VARIABLE","$this",1524],["T_OBJECT_OPERATOR","->",1524],["T_STRING","_items",1524],["T_OBJECT_OPERATOR","->",1524],["T_STRING","filterByTypes",1524],"(",["T_VARIABLE","$filterByTypes",1524],")",";",["T_WHITESPACE","\n            ",1524],"}",["T_WHITESPACE","\n            ",1525],["T_IF","if",1526],["T_WHITESPACE"," ",1526],"(",["T_VARIABLE","$nonChildrenOnly",1526],")",["T_WHITESPACE"," ",1526],"{",["T_WHITESPACE","\n                ",1526],["T_VARIABLE","$this",1527],["T_OBJECT_OPERATOR","->",1527],["T_STRING","_items",1527],["T_OBJECT_OPERATOR","->",1527],["T_STRING","filterByParent",1527],"(",")",";",["T_WHITESPACE","\n            ",1527],"}",["T_WHITESPACE","\n\n            ",1528],["T_IF","if",1530],["T_WHITESPACE"," ",1530],"(",["T_VARIABLE","$this",1530],["T_OBJECT_OPERATOR","->",1530],["T_STRING","getId",1530],"(",")",")",["T_WHITESPACE"," ",1530],"{",["T_WHITESPACE","\n                ",1530],["T_FOREACH","foreach",1531],["T_WHITESPACE"," ",1531],"(",["T_VARIABLE","$this",1531],["T_OBJECT_OPERATOR","->",1531],["T_STRING","_items",1531],["T_WHITESPACE"," ",1531],["T_AS","as",1531],["T_WHITESPACE"," ",1531],["T_VARIABLE","$item",1531],")",["T_WHITESPACE"," ",1531],"{",["T_WHITESPACE","\n                    ",1531],["T_VARIABLE","$item",1532],["T_OBJECT_OPERATOR","->",1532],["T_STRING","setOrder",1532],"(",["T_VARIABLE","$this",1532],")",";",["T_WHITESPACE","\n                ",1532],"}",["T_WHITESPACE","\n            ",1533],"}",["T_WHITESPACE","\n        ",1534],"}",["T_WHITESPACE","\n        ",1535],["T_RETURN","return",1536],["T_WHITESPACE"," ",1536],["T_VARIABLE","$this",1536],["T_OBJECT_OPERATOR","->",1536],["T_STRING","_items",1536],";",["T_WHITESPACE","\n    ",1536],"}",["T_WHITESPACE","\n\n    ",1537],["T_DOC_COMMENT","\/**\n     * Get random items collection with related children\n     *\n     * @param int $limit\n     * @return Mage_Sales_Model_Mysql4_Order_Item_Collection\n     *\/",1539],["T_WHITESPACE","\n    ",1544],["T_PUBLIC","public",1545],["T_WHITESPACE"," ",1545],["T_FUNCTION","function",1545],["T_WHITESPACE"," ",1545],["T_STRING","getItemsRandomCollection",1545],"(",["T_VARIABLE","$limit",1545],["T_WHITESPACE"," ",1545],"=",["T_WHITESPACE"," ",1545],["T_LNUMBER","1",1545],")",["T_WHITESPACE","\n    ",1545],"{",["T_WHITESPACE","\n        ",1546],["T_RETURN","return",1547],["T_WHITESPACE"," ",1547],["T_VARIABLE","$this",1547],["T_OBJECT_OPERATOR","->",1547],["T_STRING","_getItemsRandomCollection",1547],"(",["T_VARIABLE","$limit",1547],")",";",["T_WHITESPACE","\n    ",1547],"}",["T_WHITESPACE","\n\n    ",1548],["T_DOC_COMMENT","\/**\n     * Get random items collection without related children\n     *\n     * @param int $limit\n     * @return Mage_Sales_Model_Mysql4_Order_Item_Collection\n     *\/",1550],["T_WHITESPACE","\n    ",1555],["T_PUBLIC","public",1556],["T_WHITESPACE"," ",1556],["T_FUNCTION","function",1556],["T_WHITESPACE"," ",1556],["T_STRING","getParentItemsRandomCollection",1556],"(",["T_VARIABLE","$limit",1556],["T_WHITESPACE"," ",1556],"=",["T_WHITESPACE"," ",1556],["T_LNUMBER","1",1556],")",["T_WHITESPACE","\n    ",1556],"{",["T_WHITESPACE","\n        ",1557],["T_RETURN","return",1558],["T_WHITESPACE"," ",1558],["T_VARIABLE","$this",1558],["T_OBJECT_OPERATOR","->",1558],["T_STRING","_getItemsRandomCollection",1558],"(",["T_VARIABLE","$limit",1558],",",["T_WHITESPACE"," ",1558],["T_STRING","true",1558],")",";",["T_WHITESPACE","\n    ",1558],"}",["T_WHITESPACE","\n\n    ",1559],["T_DOC_COMMENT","\/**\n     * Get random items collection with or without related children\n     *\n     * @param int $limit\n     * @param bool $nonChildrenOnly\n     * @return Mage_Sales_Model_Mysql4_Order_Item_Collection\n     *\/",1561],["T_WHITESPACE","\n    ",1567],["T_PROTECTED","protected",1568],["T_WHITESPACE"," ",1568],["T_FUNCTION","function",1568],["T_WHITESPACE"," ",1568],["T_STRING","_getItemsRandomCollection",1568],"(",["T_VARIABLE","$limit",1568],",",["T_WHITESPACE"," ",1568],["T_VARIABLE","$nonChildrenOnly",1568],["T_WHITESPACE"," ",1568],"=",["T_WHITESPACE"," ",1568],["T_STRING","false",1568],")",["T_WHITESPACE","\n    ",1568],"{",["T_WHITESPACE","\n        ",1569],["T_VARIABLE","$collection",1570],["T_WHITESPACE"," ",1570],"=",["T_WHITESPACE"," ",1570],["T_STRING","Mage",1570],["T_DOUBLE_COLON","::",1570],["T_STRING","getModel",1570],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_item'",1570],")",["T_OBJECT_OPERATOR","->",1570],["T_STRING","getCollection",1570],"(",")",["T_WHITESPACE","\n            ",1570],["T_OBJECT_OPERATOR","->",1571],["T_STRING","setOrderFilter",1571],"(",["T_VARIABLE","$this",1571],")",["T_WHITESPACE","\n            ",1571],["T_OBJECT_OPERATOR","->",1572],["T_STRING","setRandomOrder",1572],"(",")",";",["T_WHITESPACE","\n\n        ",1572],["T_IF","if",1574],["T_WHITESPACE"," ",1574],"(",["T_VARIABLE","$nonChildrenOnly",1574],")",["T_WHITESPACE"," ",1574],"{",["T_WHITESPACE","\n            ",1574],["T_VARIABLE","$collection",1575],["T_OBJECT_OPERATOR","->",1575],["T_STRING","filterByParent",1575],"(",")",";",["T_WHITESPACE","\n        ",1575],"}",["T_WHITESPACE","\n        ",1576],["T_VARIABLE","$products",1577],["T_WHITESPACE"," ",1577],"=",["T_WHITESPACE"," ",1577],["T_ARRAY","array",1577],"(",")",";",["T_WHITESPACE","\n        ",1577],["T_FOREACH","foreach",1578],["T_WHITESPACE"," ",1578],"(",["T_VARIABLE","$collection",1578],["T_WHITESPACE"," ",1578],["T_AS","as",1578],["T_WHITESPACE"," ",1578],["T_VARIABLE","$item",1578],")",["T_WHITESPACE"," ",1578],"{",["T_WHITESPACE","\n            ",1578],["T_VARIABLE","$products",1579],"[","]",["T_WHITESPACE"," ",1579],"=",["T_WHITESPACE"," ",1579],["T_VARIABLE","$item",1579],["T_OBJECT_OPERATOR","->",1579],["T_STRING","getProductId",1579],"(",")",";",["T_WHITESPACE","\n        ",1579],"}",["T_WHITESPACE","\n\n        ",1580],["T_VARIABLE","$productsCollection",1582],["T_WHITESPACE"," ",1582],"=",["T_WHITESPACE"," ",1582],["T_STRING","Mage",1582],["T_DOUBLE_COLON","::",1582],["T_STRING","getModel",1582],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",1582],")",["T_WHITESPACE","\n            ",1582],["T_OBJECT_OPERATOR","->",1583],["T_STRING","getCollection",1583],"(",")",["T_WHITESPACE","\n            ",1583],["T_OBJECT_OPERATOR","->",1584],["T_STRING","addIdFilter",1584],"(",["T_VARIABLE","$products",1584],")",["T_WHITESPACE","\n            ",1584],["T_OBJECT_OPERATOR","->",1585],["T_STRING","setVisibility",1585],"(",["T_STRING","Mage",1585],["T_DOUBLE_COLON","::",1585],["T_STRING","getSingleton",1585],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_visibility'",1585],")",["T_OBJECT_OPERATOR","->",1585],["T_STRING","getVisibleInSiteIds",1585],"(",")",")",["T_WHITESPACE","\n            ",1585],["T_COMMENT","\/* Price data is added to consider item stock status using price index *\/",1586],["T_WHITESPACE","\n            ",1586],["T_OBJECT_OPERATOR","->",1587],["T_STRING","addPriceData",1587],"(",")",["T_WHITESPACE","\n            ",1587],["T_OBJECT_OPERATOR","->",1588],["T_STRING","setPageSize",1588],"(",["T_VARIABLE","$limit",1588],")",["T_WHITESPACE","\n            ",1588],["T_OBJECT_OPERATOR","->",1589],["T_STRING","load",1589],"(",")",";",["T_WHITESPACE","\n\n        ",1589],["T_FOREACH","foreach",1591],["T_WHITESPACE"," ",1591],"(",["T_VARIABLE","$collection",1591],["T_WHITESPACE"," ",1591],["T_AS","as",1591],["T_WHITESPACE"," ",1591],["T_VARIABLE","$item",1591],")",["T_WHITESPACE"," ",1591],"{",["T_WHITESPACE","\n            ",1591],["T_VARIABLE","$product",1592],["T_WHITESPACE"," ",1592],"=",["T_WHITESPACE"," ",1592],["T_VARIABLE","$productsCollection",1592],["T_OBJECT_OPERATOR","->",1592],["T_STRING","getItemById",1592],"(",["T_VARIABLE","$item",1592],["T_OBJECT_OPERATOR","->",1592],["T_STRING","getProductId",1592],"(",")",")",";",["T_WHITESPACE","\n            ",1592],["T_IF","if",1593],["T_WHITESPACE"," ",1593],"(",["T_VARIABLE","$product",1593],")",["T_WHITESPACE"," ",1593],"{",["T_WHITESPACE","\n                ",1593],["T_VARIABLE","$item",1594],["T_OBJECT_OPERATOR","->",1594],["T_STRING","setProduct",1594],"(",["T_VARIABLE","$product",1594],")",";",["T_WHITESPACE","\n            ",1594],"}",["T_WHITESPACE","\n        ",1595],"}",["T_WHITESPACE","\n\n        ",1596],["T_RETURN","return",1598],["T_WHITESPACE"," ",1598],["T_VARIABLE","$collection",1598],";",["T_WHITESPACE","\n    ",1598],"}",["T_WHITESPACE","\n\n    ",1599],["T_PUBLIC","public",1601],["T_WHITESPACE"," ",1601],["T_FUNCTION","function",1601],["T_WHITESPACE"," ",1601],["T_STRING","getAllItems",1601],"(",")",["T_WHITESPACE","\n    ",1601],"{",["T_WHITESPACE","\n        ",1602],["T_VARIABLE","$items",1603],["T_WHITESPACE"," ",1603],"=",["T_WHITESPACE"," ",1603],["T_ARRAY","array",1603],"(",")",";",["T_WHITESPACE","\n        ",1603],["T_FOREACH","foreach",1604],["T_WHITESPACE"," ",1604],"(",["T_VARIABLE","$this",1604],["T_OBJECT_OPERATOR","->",1604],["T_STRING","getItemsCollection",1604],"(",")",["T_WHITESPACE"," ",1604],["T_AS","as",1604],["T_WHITESPACE"," ",1604],["T_VARIABLE","$item",1604],")",["T_WHITESPACE"," ",1604],"{",["T_WHITESPACE","\n            ",1604],["T_IF","if",1605],["T_WHITESPACE"," ",1605],"(","!",["T_VARIABLE","$item",1605],["T_OBJECT_OPERATOR","->",1605],["T_STRING","isDeleted",1605],"(",")",")",["T_WHITESPACE"," ",1605],"{",["T_WHITESPACE","\n                ",1605],["T_VARIABLE","$items",1606],"[","]",["T_WHITESPACE"," ",1606],"=",["T_WHITESPACE","  ",1606],["T_VARIABLE","$item",1606],";",["T_WHITESPACE","\n            ",1606],"}",["T_WHITESPACE","\n        ",1607],"}",["T_WHITESPACE","\n        ",1608],["T_RETURN","return",1609],["T_WHITESPACE"," ",1609],["T_VARIABLE","$items",1609],";",["T_WHITESPACE","\n    ",1609],"}",["T_WHITESPACE","\n\n    ",1610],["T_PUBLIC","public",1612],["T_WHITESPACE"," ",1612],["T_FUNCTION","function",1612],["T_WHITESPACE"," ",1612],["T_STRING","getAllVisibleItems",1612],"(",")",["T_WHITESPACE","\n    ",1612],"{",["T_WHITESPACE","\n        ",1613],["T_VARIABLE","$items",1614],["T_WHITESPACE"," ",1614],"=",["T_WHITESPACE"," ",1614],["T_ARRAY","array",1614],"(",")",";",["T_WHITESPACE","\n        ",1614],["T_FOREACH","foreach",1615],["T_WHITESPACE"," ",1615],"(",["T_VARIABLE","$this",1615],["T_OBJECT_OPERATOR","->",1615],["T_STRING","getItemsCollection",1615],"(",")",["T_WHITESPACE"," ",1615],["T_AS","as",1615],["T_WHITESPACE"," ",1615],["T_VARIABLE","$item",1615],")",["T_WHITESPACE"," ",1615],"{",["T_WHITESPACE","\n            ",1615],["T_IF","if",1616],["T_WHITESPACE"," ",1616],"(","!",["T_VARIABLE","$item",1616],["T_OBJECT_OPERATOR","->",1616],["T_STRING","isDeleted",1616],"(",")",["T_WHITESPACE"," ",1616],["T_BOOLEAN_AND","&&",1616],["T_WHITESPACE"," ",1616],"!",["T_VARIABLE","$item",1616],["T_OBJECT_OPERATOR","->",1616],["T_STRING","getParentItemId",1616],"(",")",")",["T_WHITESPACE"," ",1616],"{",["T_WHITESPACE","\n                ",1616],["T_VARIABLE","$items",1617],"[","]",["T_WHITESPACE"," ",1617],"=",["T_WHITESPACE","  ",1617],["T_VARIABLE","$item",1617],";",["T_WHITESPACE","\n            ",1617],"}",["T_WHITESPACE","\n        ",1618],"}",["T_WHITESPACE","\n        ",1619],["T_RETURN","return",1620],["T_WHITESPACE"," ",1620],["T_VARIABLE","$items",1620],";",["T_WHITESPACE","\n    ",1620],"}",["T_WHITESPACE","\n\n    ",1621],["T_PUBLIC","public",1623],["T_WHITESPACE"," ",1623],["T_FUNCTION","function",1623],["T_WHITESPACE"," ",1623],["T_STRING","getItemById",1623],"(",["T_VARIABLE","$itemId",1623],")",["T_WHITESPACE","\n    ",1623],"{",["T_WHITESPACE","\n        ",1624],["T_RETURN","return",1625],["T_WHITESPACE"," ",1625],["T_VARIABLE","$this",1625],["T_OBJECT_OPERATOR","->",1625],["T_STRING","getItemsCollection",1625],"(",")",["T_OBJECT_OPERATOR","->",1625],["T_STRING","getItemById",1625],"(",["T_VARIABLE","$itemId",1625],")",";",["T_WHITESPACE","\n    ",1625],"}",["T_WHITESPACE","\n\n    ",1626],["T_PUBLIC","public",1628],["T_WHITESPACE"," ",1628],["T_FUNCTION","function",1628],["T_WHITESPACE"," ",1628],["T_STRING","getItemByQuoteItemId",1628],"(",["T_VARIABLE","$quoteItemId",1628],")",["T_WHITESPACE","\n    ",1628],"{",["T_WHITESPACE","\n        ",1629],["T_FOREACH","foreach",1630],["T_WHITESPACE"," ",1630],"(",["T_VARIABLE","$this",1630],["T_OBJECT_OPERATOR","->",1630],["T_STRING","getItemsCollection",1630],"(",")",["T_WHITESPACE"," ",1630],["T_AS","as",1630],["T_WHITESPACE"," ",1630],["T_VARIABLE","$item",1630],")",["T_WHITESPACE"," ",1630],"{",["T_WHITESPACE","\n            ",1630],["T_IF","if",1631],["T_WHITESPACE"," ",1631],"(",["T_VARIABLE","$item",1631],["T_OBJECT_OPERATOR","->",1631],["T_STRING","getQuoteItemId",1631],"(",")",["T_IS_EQUAL","==",1631],["T_VARIABLE","$quoteItemId",1631],")",["T_WHITESPACE"," ",1631],"{",["T_WHITESPACE","\n                ",1631],["T_RETURN","return",1632],["T_WHITESPACE"," ",1632],["T_VARIABLE","$item",1632],";",["T_WHITESPACE","\n            ",1632],"}",["T_WHITESPACE","\n        ",1633],"}",["T_WHITESPACE","\n        ",1634],["T_RETURN","return",1635],["T_WHITESPACE"," ",1635],["T_STRING","null",1635],";",["T_WHITESPACE","\n    ",1635],"}",["T_WHITESPACE","\n\n    ",1636],["T_PUBLIC","public",1638],["T_WHITESPACE"," ",1638],["T_FUNCTION","function",1638],["T_WHITESPACE"," ",1638],["T_STRING","addItem",1638],"(",["T_STRING","Mage_Sales_Model_Order_Item",1638],["T_WHITESPACE"," ",1638],["T_VARIABLE","$item",1638],")",["T_WHITESPACE","\n    ",1638],"{",["T_WHITESPACE","\n        ",1639],["T_VARIABLE","$item",1640],["T_OBJECT_OPERATOR","->",1640],["T_STRING","setOrder",1640],"(",["T_VARIABLE","$this",1640],")",";",["T_WHITESPACE","\n        ",1640],["T_IF","if",1641],["T_WHITESPACE"," ",1641],"(","!",["T_VARIABLE","$item",1641],["T_OBJECT_OPERATOR","->",1641],["T_STRING","getId",1641],"(",")",")",["T_WHITESPACE"," ",1641],"{",["T_WHITESPACE","\n            ",1641],["T_VARIABLE","$this",1642],["T_OBJECT_OPERATOR","->",1642],["T_STRING","getItemsCollection",1642],"(",")",["T_OBJECT_OPERATOR","->",1642],["T_STRING","addItem",1642],"(",["T_VARIABLE","$item",1642],")",";",["T_WHITESPACE","\n        ",1642],"}",["T_WHITESPACE","\n        ",1643],["T_RETURN","return",1644],["T_WHITESPACE"," ",1644],["T_VARIABLE","$this",1644],";",["T_WHITESPACE","\n    ",1644],"}",["T_WHITESPACE","\n\n    ",1645],["T_DOC_COMMENT","\/**\n     * Whether the order has nominal items only\n     *\n     * @return bool\n     *\/",1647],["T_WHITESPACE","\n    ",1651],["T_PUBLIC","public",1652],["T_WHITESPACE"," ",1652],["T_FUNCTION","function",1652],["T_WHITESPACE"," ",1652],["T_STRING","isNominal",1652],"(",")",["T_WHITESPACE","\n    ",1652],"{",["T_WHITESPACE","\n        ",1653],["T_FOREACH","foreach",1654],["T_WHITESPACE"," ",1654],"(",["T_VARIABLE","$this",1654],["T_OBJECT_OPERATOR","->",1654],["T_STRING","getAllVisibleItems",1654],"(",")",["T_WHITESPACE"," ",1654],["T_AS","as",1654],["T_WHITESPACE"," ",1654],["T_VARIABLE","$item",1654],")",["T_WHITESPACE"," ",1654],"{",["T_WHITESPACE","\n            ",1654],["T_IF","if",1655],["T_WHITESPACE"," ",1655],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",1655],["T_WHITESPACE"," ",1655],["T_IS_EQUAL","==",1655],["T_WHITESPACE"," ",1655],["T_VARIABLE","$item",1655],["T_OBJECT_OPERATOR","->",1655],["T_STRING","getIsNominal",1655],"(",")",")",["T_WHITESPACE"," ",1655],"{",["T_WHITESPACE","\n                ",1655],["T_RETURN","return",1656],["T_WHITESPACE"," ",1656],["T_STRING","false",1656],";",["T_WHITESPACE","\n            ",1656],"}",["T_WHITESPACE","\n        ",1657],"}",["T_WHITESPACE","\n        ",1658],["T_RETURN","return",1659],["T_WHITESPACE"," ",1659],["T_STRING","true",1659],";",["T_WHITESPACE","\n    ",1659],"}",["T_WHITESPACE","\n\n",1660],["T_COMMENT","\/*********************** PAYMENTS ***************************\/",1662],["T_WHITESPACE","\n\n    ",1662],["T_PUBLIC","public",1664],["T_WHITESPACE"," ",1664],["T_FUNCTION","function",1664],["T_WHITESPACE"," ",1664],["T_STRING","getPaymentsCollection",1664],"(",")",["T_WHITESPACE","\n    ",1664],"{",["T_WHITESPACE","\n        ",1665],["T_IF","if",1666],["T_WHITESPACE"," ",1666],"(",["T_STRING","is_null",1666],"(",["T_VARIABLE","$this",1666],["T_OBJECT_OPERATOR","->",1666],["T_STRING","_payments",1666],")",")",["T_WHITESPACE"," ",1666],"{",["T_WHITESPACE","\n            ",1666],["T_VARIABLE","$this",1667],["T_OBJECT_OPERATOR","->",1667],["T_STRING","_payments",1667],["T_WHITESPACE"," ",1667],"=",["T_WHITESPACE"," ",1667],["T_STRING","Mage",1667],["T_DOUBLE_COLON","::",1667],["T_STRING","getResourceModel",1667],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_payment_collection'",1667],")",["T_WHITESPACE","\n                ",1667],["T_OBJECT_OPERATOR","->",1668],["T_STRING","setOrderFilter",1668],"(",["T_VARIABLE","$this",1668],")",";",["T_WHITESPACE","\n\n            ",1668],["T_IF","if",1670],["T_WHITESPACE"," ",1670],"(",["T_VARIABLE","$this",1670],["T_OBJECT_OPERATOR","->",1670],["T_STRING","getId",1670],"(",")",")",["T_WHITESPACE"," ",1670],"{",["T_WHITESPACE","\n                ",1670],["T_FOREACH","foreach",1671],["T_WHITESPACE"," ",1671],"(",["T_VARIABLE","$this",1671],["T_OBJECT_OPERATOR","->",1671],["T_STRING","_payments",1671],["T_WHITESPACE"," ",1671],["T_AS","as",1671],["T_WHITESPACE"," ",1671],["T_VARIABLE","$payment",1671],")",["T_WHITESPACE"," ",1671],"{",["T_WHITESPACE","\n                    ",1671],["T_VARIABLE","$payment",1672],["T_OBJECT_OPERATOR","->",1672],["T_STRING","setOrder",1672],"(",["T_VARIABLE","$this",1672],")",";",["T_WHITESPACE","\n                ",1672],"}",["T_WHITESPACE","\n            ",1673],"}",["T_WHITESPACE","\n        ",1674],"}",["T_WHITESPACE","\n        ",1675],["T_RETURN","return",1676],["T_WHITESPACE"," ",1676],["T_VARIABLE","$this",1676],["T_OBJECT_OPERATOR","->",1676],["T_STRING","_payments",1676],";",["T_WHITESPACE","\n    ",1676],"}",["T_WHITESPACE","\n\n    ",1677],["T_PUBLIC","public",1679],["T_WHITESPACE"," ",1679],["T_FUNCTION","function",1679],["T_WHITESPACE"," ",1679],["T_STRING","getAllPayments",1679],"(",")",["T_WHITESPACE","\n    ",1679],"{",["T_WHITESPACE","\n        ",1680],["T_VARIABLE","$payments",1681],["T_WHITESPACE"," ",1681],"=",["T_WHITESPACE"," ",1681],["T_ARRAY","array",1681],"(",")",";",["T_WHITESPACE","\n        ",1681],["T_FOREACH","foreach",1682],["T_WHITESPACE"," ",1682],"(",["T_VARIABLE","$this",1682],["T_OBJECT_OPERATOR","->",1682],["T_STRING","getPaymentsCollection",1682],"(",")",["T_WHITESPACE"," ",1682],["T_AS","as",1682],["T_WHITESPACE"," ",1682],["T_VARIABLE","$payment",1682],")",["T_WHITESPACE"," ",1682],"{",["T_WHITESPACE","\n            ",1682],["T_IF","if",1683],["T_WHITESPACE"," ",1683],"(","!",["T_VARIABLE","$payment",1683],["T_OBJECT_OPERATOR","->",1683],["T_STRING","isDeleted",1683],"(",")",")",["T_WHITESPACE"," ",1683],"{",["T_WHITESPACE","\n                ",1683],["T_VARIABLE","$payments",1684],"[","]",["T_WHITESPACE"," ",1684],"=",["T_WHITESPACE","  ",1684],["T_VARIABLE","$payment",1684],";",["T_WHITESPACE","\n            ",1684],"}",["T_WHITESPACE","\n        ",1685],"}",["T_WHITESPACE","\n        ",1686],["T_RETURN","return",1687],["T_WHITESPACE"," ",1687],["T_VARIABLE","$payments",1687],";",["T_WHITESPACE","\n    ",1687],"}",["T_WHITESPACE","\n\n\n    ",1688],["T_PUBLIC","public",1691],["T_WHITESPACE"," ",1691],["T_FUNCTION","function",1691],["T_WHITESPACE"," ",1691],["T_STRING","getPaymentById",1691],"(",["T_VARIABLE","$paymentId",1691],")",["T_WHITESPACE","\n    ",1691],"{",["T_WHITESPACE","\n        ",1692],["T_FOREACH","foreach",1693],["T_WHITESPACE"," ",1693],"(",["T_VARIABLE","$this",1693],["T_OBJECT_OPERATOR","->",1693],["T_STRING","getPaymentsCollection",1693],"(",")",["T_WHITESPACE"," ",1693],["T_AS","as",1693],["T_WHITESPACE"," ",1693],["T_VARIABLE","$payment",1693],")",["T_WHITESPACE"," ",1693],"{",["T_WHITESPACE","\n            ",1693],["T_IF","if",1694],["T_WHITESPACE"," ",1694],"(",["T_VARIABLE","$payment",1694],["T_OBJECT_OPERATOR","->",1694],["T_STRING","getId",1694],"(",")",["T_IS_EQUAL","==",1694],["T_VARIABLE","$paymentId",1694],")",["T_WHITESPACE"," ",1694],"{",["T_WHITESPACE","\n                ",1694],["T_RETURN","return",1695],["T_WHITESPACE"," ",1695],["T_VARIABLE","$payment",1695],";",["T_WHITESPACE","\n            ",1695],"}",["T_WHITESPACE","\n        ",1696],"}",["T_WHITESPACE","\n        ",1697],["T_RETURN","return",1698],["T_WHITESPACE"," ",1698],["T_STRING","false",1698],";",["T_WHITESPACE","\n    ",1698],"}",["T_WHITESPACE","\n\n    ",1699],["T_PUBLIC","public",1701],["T_WHITESPACE"," ",1701],["T_FUNCTION","function",1701],["T_WHITESPACE"," ",1701],["T_STRING","addPayment",1701],"(",["T_STRING","Mage_Sales_Model_Order_Payment",1701],["T_WHITESPACE"," ",1701],["T_VARIABLE","$payment",1701],")",["T_WHITESPACE","\n    ",1701],"{",["T_WHITESPACE","\n        ",1702],["T_VARIABLE","$payment",1703],["T_OBJECT_OPERATOR","->",1703],["T_STRING","setOrder",1703],"(",["T_VARIABLE","$this",1703],")",["T_WHITESPACE","\n            ",1703],["T_OBJECT_OPERATOR","->",1704],["T_STRING","setParentId",1704],"(",["T_VARIABLE","$this",1704],["T_OBJECT_OPERATOR","->",1704],["T_STRING","getId",1704],"(",")",")",";",["T_WHITESPACE","\n        ",1704],["T_IF","if",1705],["T_WHITESPACE"," ",1705],"(","!",["T_VARIABLE","$payment",1705],["T_OBJECT_OPERATOR","->",1705],["T_STRING","getId",1705],"(",")",")",["T_WHITESPACE"," ",1705],"{",["T_WHITESPACE","\n            ",1705],["T_VARIABLE","$this",1706],["T_OBJECT_OPERATOR","->",1706],["T_STRING","getPaymentsCollection",1706],"(",")",["T_OBJECT_OPERATOR","->",1706],["T_STRING","addItem",1706],"(",["T_VARIABLE","$payment",1706],")",";",["T_WHITESPACE","\n        ",1706],"}",["T_WHITESPACE","\n        ",1707],["T_RETURN","return",1708],["T_WHITESPACE"," ",1708],["T_VARIABLE","$this",1708],";",["T_WHITESPACE","\n    ",1708],"}",["T_WHITESPACE","\n\n    ",1709],["T_PUBLIC","public",1711],["T_WHITESPACE"," ",1711],["T_FUNCTION","function",1711],["T_WHITESPACE"," ",1711],["T_STRING","setPayment",1711],"(",["T_STRING","Mage_Sales_Model_Order_Payment",1711],["T_WHITESPACE"," ",1711],["T_VARIABLE","$payment",1711],")",["T_WHITESPACE","\n    ",1711],"{",["T_WHITESPACE","\n        ",1712],["T_IF","if",1713],["T_WHITESPACE"," ",1713],"(","!",["T_VARIABLE","$this",1713],["T_OBJECT_OPERATOR","->",1713],["T_STRING","getIsMultiPayment",1713],"(",")",["T_WHITESPACE"," ",1713],["T_BOOLEAN_AND","&&",1713],["T_WHITESPACE"," ",1713],"(",["T_VARIABLE","$old",1713],["T_WHITESPACE"," ",1713],"=",["T_WHITESPACE"," ",1713],["T_VARIABLE","$this",1713],["T_OBJECT_OPERATOR","->",1713],["T_STRING","getPayment",1713],"(",")",")",")",["T_WHITESPACE"," ",1713],"{",["T_WHITESPACE","\n            ",1713],["T_VARIABLE","$payment",1714],["T_OBJECT_OPERATOR","->",1714],["T_STRING","setId",1714],"(",["T_VARIABLE","$old",1714],["T_OBJECT_OPERATOR","->",1714],["T_STRING","getId",1714],"(",")",")",";",["T_WHITESPACE","\n        ",1714],"}",["T_WHITESPACE","\n        ",1715],["T_VARIABLE","$this",1716],["T_OBJECT_OPERATOR","->",1716],["T_STRING","addPayment",1716],"(",["T_VARIABLE","$payment",1716],")",";",["T_WHITESPACE","\n        ",1716],["T_RETURN","return",1717],["T_WHITESPACE"," ",1717],["T_VARIABLE","$payment",1717],";",["T_WHITESPACE","\n    ",1717],"}",["T_WHITESPACE","\n\n",1718],["T_COMMENT","\/*********************** STATUSES ***************************\/",1720],["T_WHITESPACE","\n\n    ",1720],["T_DOC_COMMENT","\/**\n     * Enter description here...\n     *\n     * @return Mage_Sales_Model_Entity_Order_Status_History_Collection\n     *\/",1722],["T_WHITESPACE","\n    ",1726],["T_PUBLIC","public",1727],["T_WHITESPACE"," ",1727],["T_FUNCTION","function",1727],["T_WHITESPACE"," ",1727],["T_STRING","getStatusHistoryCollection",1727],"(",["T_VARIABLE","$reload",1727],"=",["T_STRING","false",1727],")",["T_WHITESPACE","\n    ",1727],"{",["T_WHITESPACE","\n        ",1728],["T_IF","if",1729],["T_WHITESPACE"," ",1729],"(",["T_STRING","is_null",1729],"(",["T_VARIABLE","$this",1729],["T_OBJECT_OPERATOR","->",1729],["T_STRING","_statusHistory",1729],")",["T_WHITESPACE"," ",1729],["T_BOOLEAN_OR","||",1729],["T_WHITESPACE"," ",1729],["T_VARIABLE","$reload",1729],")",["T_WHITESPACE"," ",1729],"{",["T_WHITESPACE","\n            ",1729],["T_VARIABLE","$this",1730],["T_OBJECT_OPERATOR","->",1730],["T_STRING","_statusHistory",1730],["T_WHITESPACE"," ",1730],"=",["T_WHITESPACE"," ",1730],["T_STRING","Mage",1730],["T_DOUBLE_COLON","::",1730],["T_STRING","getResourceModel",1730],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_status_history_collection'",1730],")",["T_WHITESPACE","\n                ",1730],["T_OBJECT_OPERATOR","->",1731],["T_STRING","setOrderFilter",1731],"(",["T_VARIABLE","$this",1731],")",["T_WHITESPACE","\n                ",1731],["T_OBJECT_OPERATOR","->",1732],["T_STRING","setOrder",1732],"(",["T_CONSTANT_ENCAPSED_STRING","'created_at'",1732],",",["T_WHITESPACE"," ",1732],["T_CONSTANT_ENCAPSED_STRING","'desc'",1732],")",["T_WHITESPACE","\n                ",1732],["T_OBJECT_OPERATOR","->",1733],["T_STRING","setOrder",1733],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",1733],",",["T_WHITESPACE"," ",1733],["T_CONSTANT_ENCAPSED_STRING","'desc'",1733],")",";",["T_WHITESPACE","\n\n            ",1733],["T_IF","if",1735],["T_WHITESPACE"," ",1735],"(",["T_VARIABLE","$this",1735],["T_OBJECT_OPERATOR","->",1735],["T_STRING","getId",1735],"(",")",")",["T_WHITESPACE"," ",1735],"{",["T_WHITESPACE","\n                ",1735],["T_FOREACH","foreach",1736],["T_WHITESPACE"," ",1736],"(",["T_VARIABLE","$this",1736],["T_OBJECT_OPERATOR","->",1736],["T_STRING","_statusHistory",1736],["T_WHITESPACE"," ",1736],["T_AS","as",1736],["T_WHITESPACE"," ",1736],["T_VARIABLE","$status",1736],")",["T_WHITESPACE"," ",1736],"{",["T_WHITESPACE","\n                    ",1736],["T_VARIABLE","$status",1737],["T_OBJECT_OPERATOR","->",1737],["T_STRING","setOrder",1737],"(",["T_VARIABLE","$this",1737],")",";",["T_WHITESPACE","\n                ",1737],"}",["T_WHITESPACE","\n            ",1738],"}",["T_WHITESPACE","\n        ",1739],"}",["T_WHITESPACE","\n        ",1740],["T_RETURN","return",1741],["T_WHITESPACE"," ",1741],["T_VARIABLE","$this",1741],["T_OBJECT_OPERATOR","->",1741],["T_STRING","_statusHistory",1741],";",["T_WHITESPACE","\n    ",1741],"}",["T_WHITESPACE","\n\n    ",1742],["T_DOC_COMMENT","\/**\n     * Return collection of order status history items.\n     *\n     * @return array\n     *\/",1744],["T_WHITESPACE","\n    ",1748],["T_PUBLIC","public",1749],["T_WHITESPACE"," ",1749],["T_FUNCTION","function",1749],["T_WHITESPACE"," ",1749],["T_STRING","getAllStatusHistory",1749],"(",")",["T_WHITESPACE","\n    ",1749],"{",["T_WHITESPACE","\n        ",1750],["T_VARIABLE","$history",1751],["T_WHITESPACE"," ",1751],"=",["T_WHITESPACE"," ",1751],["T_ARRAY","array",1751],"(",")",";",["T_WHITESPACE","\n        ",1751],["T_FOREACH","foreach",1752],["T_WHITESPACE"," ",1752],"(",["T_VARIABLE","$this",1752],["T_OBJECT_OPERATOR","->",1752],["T_STRING","getStatusHistoryCollection",1752],"(",")",["T_WHITESPACE"," ",1752],["T_AS","as",1752],["T_WHITESPACE"," ",1752],["T_VARIABLE","$status",1752],")",["T_WHITESPACE"," ",1752],"{",["T_WHITESPACE","\n            ",1752],["T_IF","if",1753],["T_WHITESPACE"," ",1753],"(","!",["T_VARIABLE","$status",1753],["T_OBJECT_OPERATOR","->",1753],["T_STRING","isDeleted",1753],"(",")",")",["T_WHITESPACE"," ",1753],"{",["T_WHITESPACE","\n                ",1753],["T_VARIABLE","$history",1754],"[","]",["T_WHITESPACE"," ",1754],"=",["T_WHITESPACE","  ",1754],["T_VARIABLE","$status",1754],";",["T_WHITESPACE","\n            ",1754],"}",["T_WHITESPACE","\n        ",1755],"}",["T_WHITESPACE","\n        ",1756],["T_RETURN","return",1757],["T_WHITESPACE"," ",1757],["T_VARIABLE","$history",1757],";",["T_WHITESPACE","\n    ",1757],"}",["T_WHITESPACE","\n\n    ",1758],["T_DOC_COMMENT","\/**\n     * Return collection of visible on frontend order status history items.\n     *\n     * @return array\n     *\/",1760],["T_WHITESPACE","\n    ",1764],["T_PUBLIC","public",1765],["T_WHITESPACE"," ",1765],["T_FUNCTION","function",1765],["T_WHITESPACE"," ",1765],["T_STRING","getVisibleStatusHistory",1765],"(",")",["T_WHITESPACE","\n    ",1765],"{",["T_WHITESPACE","\n        ",1766],["T_VARIABLE","$history",1767],["T_WHITESPACE"," ",1767],"=",["T_WHITESPACE"," ",1767],["T_ARRAY","array",1767],"(",")",";",["T_WHITESPACE","\n        ",1767],["T_FOREACH","foreach",1768],["T_WHITESPACE"," ",1768],"(",["T_VARIABLE","$this",1768],["T_OBJECT_OPERATOR","->",1768],["T_STRING","getStatusHistoryCollection",1768],"(",")",["T_WHITESPACE"," ",1768],["T_AS","as",1768],["T_WHITESPACE"," ",1768],["T_VARIABLE","$status",1768],")",["T_WHITESPACE"," ",1768],"{",["T_WHITESPACE","\n            ",1768],["T_IF","if",1769],["T_WHITESPACE"," ",1769],"(","!",["T_VARIABLE","$status",1769],["T_OBJECT_OPERATOR","->",1769],["T_STRING","isDeleted",1769],"(",")",["T_WHITESPACE"," ",1769],["T_BOOLEAN_AND","&&",1769],["T_WHITESPACE"," ",1769],["T_VARIABLE","$status",1769],["T_OBJECT_OPERATOR","->",1769],["T_STRING","getComment",1769],"(",")",["T_WHITESPACE"," ",1769],["T_BOOLEAN_AND","&&",1769],["T_WHITESPACE"," ",1769],["T_VARIABLE","$status",1769],["T_OBJECT_OPERATOR","->",1769],["T_STRING","getIsVisibleOnFront",1769],"(",")",")",["T_WHITESPACE"," ",1769],"{",["T_WHITESPACE","\n                ",1769],["T_VARIABLE","$history",1770],"[","]",["T_WHITESPACE"," ",1770],"=",["T_WHITESPACE","  ",1770],["T_VARIABLE","$status",1770],";",["T_WHITESPACE","\n            ",1770],"}",["T_WHITESPACE","\n        ",1771],"}",["T_WHITESPACE","\n        ",1772],["T_RETURN","return",1773],["T_WHITESPACE"," ",1773],["T_VARIABLE","$history",1773],";",["T_WHITESPACE","\n    ",1773],"}",["T_WHITESPACE","\n\n    ",1774],["T_PUBLIC","public",1776],["T_WHITESPACE"," ",1776],["T_FUNCTION","function",1776],["T_WHITESPACE"," ",1776],["T_STRING","getStatusHistoryById",1776],"(",["T_VARIABLE","$statusId",1776],")",["T_WHITESPACE","\n    ",1776],"{",["T_WHITESPACE","\n        ",1777],["T_FOREACH","foreach",1778],["T_WHITESPACE"," ",1778],"(",["T_VARIABLE","$this",1778],["T_OBJECT_OPERATOR","->",1778],["T_STRING","getStatusHistoryCollection",1778],"(",")",["T_WHITESPACE"," ",1778],["T_AS","as",1778],["T_WHITESPACE"," ",1778],["T_VARIABLE","$status",1778],")",["T_WHITESPACE"," ",1778],"{",["T_WHITESPACE","\n            ",1778],["T_IF","if",1779],["T_WHITESPACE"," ",1779],"(",["T_VARIABLE","$status",1779],["T_OBJECT_OPERATOR","->",1779],["T_STRING","getId",1779],"(",")",["T_IS_EQUAL","==",1779],["T_VARIABLE","$statusId",1779],")",["T_WHITESPACE"," ",1779],"{",["T_WHITESPACE","\n                ",1779],["T_RETURN","return",1780],["T_WHITESPACE"," ",1780],["T_VARIABLE","$status",1780],";",["T_WHITESPACE","\n            ",1780],"}",["T_WHITESPACE","\n        ",1781],"}",["T_WHITESPACE","\n        ",1782],["T_RETURN","return",1783],["T_WHITESPACE"," ",1783],["T_STRING","false",1783],";",["T_WHITESPACE","\n    ",1783],"}",["T_WHITESPACE","\n\n    ",1784],["T_DOC_COMMENT","\/**\n     * Set the order status history object and the order object to each other\n     * Adds the object to the status history collection, which is automatically saved when the order is saved.\n     * See the entity_id attribute backend model.\n     * Or the history record can be saved standalone after this.\n     *\n     * @param Mage_Sales_Model_Order_Status_History $status\n     * @return Mage_Sales_Model_Order\n     *\/",1786],["T_WHITESPACE","\n    ",1794],["T_PUBLIC","public",1795],["T_WHITESPACE"," ",1795],["T_FUNCTION","function",1795],["T_WHITESPACE"," ",1795],["T_STRING","addStatusHistory",1795],"(",["T_STRING","Mage_Sales_Model_Order_Status_History",1795],["T_WHITESPACE"," ",1795],["T_VARIABLE","$history",1795],")",["T_WHITESPACE","\n    ",1795],"{",["T_WHITESPACE","\n        ",1796],["T_VARIABLE","$history",1797],["T_OBJECT_OPERATOR","->",1797],["T_STRING","setOrder",1797],"(",["T_VARIABLE","$this",1797],")",";",["T_WHITESPACE","\n        ",1797],["T_VARIABLE","$this",1798],["T_OBJECT_OPERATOR","->",1798],["T_STRING","setStatus",1798],"(",["T_VARIABLE","$history",1798],["T_OBJECT_OPERATOR","->",1798],["T_STRING","getStatus",1798],"(",")",")",";",["T_WHITESPACE","\n        ",1798],["T_IF","if",1799],["T_WHITESPACE"," ",1799],"(","!",["T_VARIABLE","$history",1799],["T_OBJECT_OPERATOR","->",1799],["T_STRING","getId",1799],"(",")",")",["T_WHITESPACE"," ",1799],"{",["T_WHITESPACE","\n            ",1799],["T_VARIABLE","$this",1800],["T_OBJECT_OPERATOR","->",1800],["T_STRING","getStatusHistoryCollection",1800],"(",")",["T_OBJECT_OPERATOR","->",1800],["T_STRING","addItem",1800],"(",["T_VARIABLE","$history",1800],")",";",["T_WHITESPACE","\n        ",1800],"}",["T_WHITESPACE","\n        ",1801],["T_RETURN","return",1802],["T_WHITESPACE"," ",1802],["T_VARIABLE","$this",1802],";",["T_WHITESPACE","\n    ",1802],"}",["T_WHITESPACE","\n\n\n    ",1803],["T_DOC_COMMENT","\/**\n     * Enter description here...\n     *\n     * @return string\n     *\/",1806],["T_WHITESPACE","\n    ",1810],["T_PUBLIC","public",1811],["T_WHITESPACE"," ",1811],["T_FUNCTION","function",1811],["T_WHITESPACE"," ",1811],["T_STRING","getRealOrderId",1811],"(",")",["T_WHITESPACE","\n    ",1811],"{",["T_WHITESPACE","\n        ",1812],["T_VARIABLE","$id",1813],["T_WHITESPACE"," ",1813],"=",["T_WHITESPACE"," ",1813],["T_VARIABLE","$this",1813],["T_OBJECT_OPERATOR","->",1813],["T_STRING","getData",1813],"(",["T_CONSTANT_ENCAPSED_STRING","'real_order_id'",1813],")",";",["T_WHITESPACE","\n        ",1813],["T_IF","if",1814],["T_WHITESPACE"," ",1814],"(",["T_STRING","is_null",1814],"(",["T_VARIABLE","$id",1814],")",")",["T_WHITESPACE"," ",1814],"{",["T_WHITESPACE","\n            ",1814],["T_VARIABLE","$id",1815],["T_WHITESPACE"," ",1815],"=",["T_WHITESPACE"," ",1815],["T_VARIABLE","$this",1815],["T_OBJECT_OPERATOR","->",1815],["T_STRING","getIncrementId",1815],"(",")",";",["T_WHITESPACE","\n        ",1815],"}",["T_WHITESPACE","\n        ",1816],["T_RETURN","return",1817],["T_WHITESPACE"," ",1817],["T_VARIABLE","$id",1817],";",["T_WHITESPACE","\n    ",1817],"}",["T_WHITESPACE","\n\n    ",1818],["T_DOC_COMMENT","\/**\n     * Get currency model instance. Will be used currency with which order placed\n     *\n     * @return Mage_Directory_Model_Currency\n     *\/",1820],["T_WHITESPACE","\n    ",1824],["T_PUBLIC","public",1825],["T_WHITESPACE"," ",1825],["T_FUNCTION","function",1825],["T_WHITESPACE"," ",1825],["T_STRING","getOrderCurrency",1825],"(",")",["T_WHITESPACE","\n    ",1825],"{",["T_WHITESPACE","\n        ",1826],["T_IF","if",1827],["T_WHITESPACE"," ",1827],"(",["T_STRING","is_null",1827],"(",["T_VARIABLE","$this",1827],["T_OBJECT_OPERATOR","->",1827],["T_STRING","_orderCurrency",1827],")",")",["T_WHITESPACE"," ",1827],"{",["T_WHITESPACE","\n            ",1827],["T_VARIABLE","$this",1828],["T_OBJECT_OPERATOR","->",1828],["T_STRING","_orderCurrency",1828],["T_WHITESPACE"," ",1828],"=",["T_WHITESPACE"," ",1828],["T_STRING","Mage",1828],["T_DOUBLE_COLON","::",1828],["T_STRING","getModel",1828],"(",["T_CONSTANT_ENCAPSED_STRING","'directory\/currency'",1828],")",["T_OBJECT_OPERATOR","->",1828],["T_STRING","load",1828],"(",["T_VARIABLE","$this",1828],["T_OBJECT_OPERATOR","->",1828],["T_STRING","getOrderCurrencyCode",1828],"(",")",")",";",["T_WHITESPACE","\n        ",1828],"}",["T_WHITESPACE","\n        ",1829],["T_RETURN","return",1830],["T_WHITESPACE"," ",1830],["T_VARIABLE","$this",1830],["T_OBJECT_OPERATOR","->",1830],["T_STRING","_orderCurrency",1830],";",["T_WHITESPACE","\n    ",1830],"}",["T_WHITESPACE","\n\n    ",1831],["T_DOC_COMMENT","\/**\n     * Get formated price value including order currency rate to order website currency\n     *\n     * @param   float $price\n     * @param   bool  $addBrackets\n     * @return  string\n     *\/",1833],["T_WHITESPACE","\n    ",1839],["T_PUBLIC","public",1840],["T_WHITESPACE"," ",1840],["T_FUNCTION","function",1840],["T_WHITESPACE"," ",1840],["T_STRING","formatPrice",1840],"(",["T_VARIABLE","$price",1840],",",["T_WHITESPACE"," ",1840],["T_VARIABLE","$addBrackets",1840],["T_WHITESPACE"," ",1840],"=",["T_WHITESPACE"," ",1840],["T_STRING","false",1840],")",["T_WHITESPACE","\n    ",1840],"{",["T_WHITESPACE","\n        ",1841],["T_RETURN","return",1842],["T_WHITESPACE"," ",1842],["T_VARIABLE","$this",1842],["T_OBJECT_OPERATOR","->",1842],["T_STRING","formatPricePrecision",1842],"(",["T_VARIABLE","$price",1842],",",["T_WHITESPACE"," ",1842],["T_LNUMBER","2",1842],",",["T_WHITESPACE"," ",1842],["T_VARIABLE","$addBrackets",1842],")",";",["T_WHITESPACE","\n    ",1842],"}",["T_WHITESPACE","\n\n    ",1843],["T_PUBLIC","public",1845],["T_WHITESPACE"," ",1845],["T_FUNCTION","function",1845],["T_WHITESPACE"," ",1845],["T_STRING","formatPricePrecision",1845],"(",["T_VARIABLE","$price",1845],",",["T_WHITESPACE"," ",1845],["T_VARIABLE","$precision",1845],",",["T_WHITESPACE"," ",1845],["T_VARIABLE","$addBrackets",1845],["T_WHITESPACE"," ",1845],"=",["T_WHITESPACE"," ",1845],["T_STRING","false",1845],")",["T_WHITESPACE","\n    ",1845],"{",["T_WHITESPACE","\n        ",1846],["T_RETURN","return",1847],["T_WHITESPACE"," ",1847],["T_VARIABLE","$this",1847],["T_OBJECT_OPERATOR","->",1847],["T_STRING","getOrderCurrency",1847],"(",")",["T_OBJECT_OPERATOR","->",1847],["T_STRING","formatPrecision",1847],"(",["T_VARIABLE","$price",1847],",",["T_WHITESPACE"," ",1847],["T_VARIABLE","$precision",1847],",",["T_WHITESPACE"," ",1847],["T_ARRAY","array",1847],"(",")",",",["T_WHITESPACE"," ",1847],["T_STRING","true",1847],",",["T_WHITESPACE"," ",1847],["T_VARIABLE","$addBrackets",1847],")",";",["T_WHITESPACE","\n    ",1847],"}",["T_WHITESPACE","\n\n    ",1848],["T_DOC_COMMENT","\/**\n     * Retrieve text formated price value includeing order rate\n     *\n     * @param   float $price\n     * @return  string\n     *\/",1850],["T_WHITESPACE","\n    ",1855],["T_PUBLIC","public",1856],["T_WHITESPACE"," ",1856],["T_FUNCTION","function",1856],["T_WHITESPACE"," ",1856],["T_STRING","formatPriceTxt",1856],"(",["T_VARIABLE","$price",1856],")",["T_WHITESPACE","\n    ",1856],"{",["T_WHITESPACE","\n        ",1857],["T_RETURN","return",1858],["T_WHITESPACE"," ",1858],["T_VARIABLE","$this",1858],["T_OBJECT_OPERATOR","->",1858],["T_STRING","getOrderCurrency",1858],"(",")",["T_OBJECT_OPERATOR","->",1858],["T_STRING","formatTxt",1858],"(",["T_VARIABLE","$price",1858],")",";",["T_WHITESPACE","\n    ",1858],"}",["T_WHITESPACE","\n\n    ",1859],["T_DOC_COMMENT","\/**\n     * Retrieve order website currency for working with base prices\n     *\n     * @return Mage_Directory_Model_Currency\n     *\/",1861],["T_WHITESPACE","\n    ",1865],["T_PUBLIC","public",1866],["T_WHITESPACE"," ",1866],["T_FUNCTION","function",1866],["T_WHITESPACE"," ",1866],["T_STRING","getBaseCurrency",1866],"(",")",["T_WHITESPACE","\n    ",1866],"{",["T_WHITESPACE","\n        ",1867],["T_IF","if",1868],["T_WHITESPACE"," ",1868],"(",["T_STRING","is_null",1868],"(",["T_VARIABLE","$this",1868],["T_OBJECT_OPERATOR","->",1868],["T_STRING","_baseCurrency",1868],")",")",["T_WHITESPACE"," ",1868],"{",["T_WHITESPACE","\n            ",1868],["T_VARIABLE","$this",1869],["T_OBJECT_OPERATOR","->",1869],["T_STRING","_baseCurrency",1869],["T_WHITESPACE"," ",1869],"=",["T_WHITESPACE"," ",1869],["T_STRING","Mage",1869],["T_DOUBLE_COLON","::",1869],["T_STRING","getModel",1869],"(",["T_CONSTANT_ENCAPSED_STRING","'directory\/currency'",1869],")",["T_OBJECT_OPERATOR","->",1869],["T_STRING","load",1869],"(",["T_VARIABLE","$this",1869],["T_OBJECT_OPERATOR","->",1869],["T_STRING","getBaseCurrencyCode",1869],"(",")",")",";",["T_WHITESPACE","\n        ",1869],"}",["T_WHITESPACE","\n        ",1870],["T_RETURN","return",1871],["T_WHITESPACE"," ",1871],["T_VARIABLE","$this",1871],["T_OBJECT_OPERATOR","->",1871],["T_STRING","_baseCurrency",1871],";",["T_WHITESPACE","\n    ",1871],"}",["T_WHITESPACE","\n\n    ",1872],["T_DOC_COMMENT","\/**\n     * Retrieve order website currency for working with base prices\n     * @deprecated  please use getBaseCurrency instead.\n     *\n     * @return Mage_Directory_Model_Currency\n     *\/",1874],["T_WHITESPACE","\n    ",1879],["T_PUBLIC","public",1880],["T_WHITESPACE"," ",1880],["T_FUNCTION","function",1880],["T_WHITESPACE"," ",1880],["T_STRING","getStoreCurrency",1880],"(",")",["T_WHITESPACE","\n    ",1880],"{",["T_WHITESPACE","\n        ",1881],["T_RETURN","return",1882],["T_WHITESPACE"," ",1882],["T_VARIABLE","$this",1882],["T_OBJECT_OPERATOR","->",1882],["T_STRING","getData",1882],"(",["T_CONSTANT_ENCAPSED_STRING","'store_currency'",1882],")",";",["T_WHITESPACE","\n    ",1882],"}",["T_WHITESPACE","\n\n    ",1883],["T_PUBLIC","public",1885],["T_WHITESPACE"," ",1885],["T_FUNCTION","function",1885],["T_WHITESPACE"," ",1885],["T_STRING","formatBasePrice",1885],"(",["T_VARIABLE","$price",1885],")",["T_WHITESPACE","\n    ",1885],"{",["T_WHITESPACE","\n        ",1886],["T_RETURN","return",1887],["T_WHITESPACE"," ",1887],["T_VARIABLE","$this",1887],["T_OBJECT_OPERATOR","->",1887],["T_STRING","formatBasePricePrecision",1887],"(",["T_VARIABLE","$price",1887],",",["T_WHITESPACE"," ",1887],["T_LNUMBER","2",1887],")",";",["T_WHITESPACE","\n    ",1887],"}",["T_WHITESPACE","\n\n    ",1888],["T_PUBLIC","public",1890],["T_WHITESPACE"," ",1890],["T_FUNCTION","function",1890],["T_WHITESPACE"," ",1890],["T_STRING","formatBasePricePrecision",1890],"(",["T_VARIABLE","$price",1890],",",["T_WHITESPACE"," ",1890],["T_VARIABLE","$precision",1890],")",["T_WHITESPACE","\n    ",1890],"{",["T_WHITESPACE","\n        ",1891],["T_RETURN","return",1892],["T_WHITESPACE"," ",1892],["T_VARIABLE","$this",1892],["T_OBJECT_OPERATOR","->",1892],["T_STRING","getBaseCurrency",1892],"(",")",["T_OBJECT_OPERATOR","->",1892],["T_STRING","formatPrecision",1892],"(",["T_VARIABLE","$price",1892],",",["T_WHITESPACE"," ",1892],["T_VARIABLE","$precision",1892],")",";",["T_WHITESPACE","\n    ",1892],"}",["T_WHITESPACE","\n\n    ",1893],["T_PUBLIC","public",1895],["T_WHITESPACE"," ",1895],["T_FUNCTION","function",1895],["T_WHITESPACE"," ",1895],["T_STRING","isCurrencyDifferent",1895],"(",")",["T_WHITESPACE","\n    ",1895],"{",["T_WHITESPACE","\n        ",1896],["T_RETURN","return",1897],["T_WHITESPACE"," ",1897],["T_VARIABLE","$this",1897],["T_OBJECT_OPERATOR","->",1897],["T_STRING","getOrderCurrencyCode",1897],"(",")",["T_WHITESPACE"," ",1897],["T_IS_NOT_EQUAL","!=",1897],["T_WHITESPACE"," ",1897],["T_VARIABLE","$this",1897],["T_OBJECT_OPERATOR","->",1897],["T_STRING","getBaseCurrencyCode",1897],"(",")",";",["T_WHITESPACE","\n    ",1897],"}",["T_WHITESPACE","\n\n    ",1898],["T_DOC_COMMENT","\/**\n     * Retrieve order total due value\n     *\n     * @return float\n     *\/",1900],["T_WHITESPACE","\n    ",1904],["T_PUBLIC","public",1905],["T_WHITESPACE"," ",1905],["T_FUNCTION","function",1905],["T_WHITESPACE"," ",1905],["T_STRING","getTotalDue",1905],"(",")",["T_WHITESPACE","\n    ",1905],"{",["T_WHITESPACE","\n        ",1906],["T_VARIABLE","$total",1907],["T_WHITESPACE"," ",1907],"=",["T_WHITESPACE"," ",1907],["T_VARIABLE","$this",1907],["T_OBJECT_OPERATOR","->",1907],["T_STRING","getGrandTotal",1907],"(",")","-",["T_VARIABLE","$this",1907],["T_OBJECT_OPERATOR","->",1907],["T_STRING","getTotalPaid",1907],"(",")",";",["T_WHITESPACE","\n        ",1907],["T_VARIABLE","$total",1908],["T_WHITESPACE"," ",1908],"=",["T_WHITESPACE"," ",1908],["T_STRING","Mage",1908],["T_DOUBLE_COLON","::",1908],["T_STRING","app",1908],"(",")",["T_OBJECT_OPERATOR","->",1908],["T_STRING","getStore",1908],"(",["T_VARIABLE","$this",1908],["T_OBJECT_OPERATOR","->",1908],["T_STRING","getStoreId",1908],"(",")",")",["T_OBJECT_OPERATOR","->",1908],["T_STRING","roundPrice",1908],"(",["T_VARIABLE","$total",1908],")",";",["T_WHITESPACE","\n        ",1908],["T_RETURN","return",1909],["T_WHITESPACE"," ",1909],["T_STRING","max",1909],"(",["T_VARIABLE","$total",1909],",",["T_WHITESPACE"," ",1909],["T_LNUMBER","0",1909],")",";",["T_WHITESPACE","\n    ",1909],"}",["T_WHITESPACE","\n\n    ",1910],["T_DOC_COMMENT","\/**\n     * Retrieve order total due value\n     *\n     * @return float\n     *\/",1912],["T_WHITESPACE","\n    ",1916],["T_PUBLIC","public",1917],["T_WHITESPACE"," ",1917],["T_FUNCTION","function",1917],["T_WHITESPACE"," ",1917],["T_STRING","getBaseTotalDue",1917],"(",")",["T_WHITESPACE","\n    ",1917],"{",["T_WHITESPACE","\n        ",1918],["T_VARIABLE","$total",1919],["T_WHITESPACE"," ",1919],"=",["T_WHITESPACE"," ",1919],["T_VARIABLE","$this",1919],["T_OBJECT_OPERATOR","->",1919],["T_STRING","getBaseGrandTotal",1919],"(",")","-",["T_VARIABLE","$this",1919],["T_OBJECT_OPERATOR","->",1919],["T_STRING","getBaseTotalPaid",1919],"(",")",";",["T_WHITESPACE","\n        ",1919],["T_VARIABLE","$total",1920],["T_WHITESPACE"," ",1920],"=",["T_WHITESPACE"," ",1920],["T_STRING","Mage",1920],["T_DOUBLE_COLON","::",1920],["T_STRING","app",1920],"(",")",["T_OBJECT_OPERATOR","->",1920],["T_STRING","getStore",1920],"(",["T_VARIABLE","$this",1920],["T_OBJECT_OPERATOR","->",1920],["T_STRING","getStoreId",1920],"(",")",")",["T_OBJECT_OPERATOR","->",1920],["T_STRING","roundPrice",1920],"(",["T_VARIABLE","$total",1920],")",";",["T_WHITESPACE","\n        ",1920],["T_RETURN","return",1921],["T_WHITESPACE"," ",1921],["T_STRING","max",1921],"(",["T_VARIABLE","$total",1921],",",["T_WHITESPACE"," ",1921],["T_LNUMBER","0",1921],")",";",["T_WHITESPACE","\n    ",1921],"}",["T_WHITESPACE","\n\n    ",1922],["T_PUBLIC","public",1924],["T_WHITESPACE"," ",1924],["T_FUNCTION","function",1924],["T_WHITESPACE"," ",1924],["T_STRING","getData",1924],"(",["T_VARIABLE","$key",1924],"=",["T_CONSTANT_ENCAPSED_STRING","''",1924],",",["T_WHITESPACE"," ",1924],["T_VARIABLE","$index",1924],"=",["T_STRING","null",1924],")",["T_WHITESPACE","\n    ",1924],"{",["T_WHITESPACE","\n        ",1925],["T_IF","if",1926],["T_WHITESPACE"," ",1926],"(",["T_VARIABLE","$key",1926],["T_WHITESPACE"," ",1926],["T_IS_EQUAL","==",1926],["T_WHITESPACE"," ",1926],["T_CONSTANT_ENCAPSED_STRING","'total_due'",1926],")",["T_WHITESPACE"," ",1926],"{",["T_WHITESPACE","\n            ",1926],["T_RETURN","return",1927],["T_WHITESPACE"," ",1927],["T_VARIABLE","$this",1927],["T_OBJECT_OPERATOR","->",1927],["T_STRING","getTotalDue",1927],"(",")",";",["T_WHITESPACE","\n        ",1927],"}",["T_WHITESPACE","\n        ",1928],["T_IF","if",1929],["T_WHITESPACE"," ",1929],"(",["T_VARIABLE","$key",1929],["T_WHITESPACE"," ",1929],["T_IS_EQUAL","==",1929],["T_WHITESPACE"," ",1929],["T_CONSTANT_ENCAPSED_STRING","'base_total_due'",1929],")",["T_WHITESPACE"," ",1929],"{",["T_WHITESPACE","\n            ",1929],["T_RETURN","return",1930],["T_WHITESPACE"," ",1930],["T_VARIABLE","$this",1930],["T_OBJECT_OPERATOR","->",1930],["T_STRING","getBaseTotalDue",1930],"(",")",";",["T_WHITESPACE","\n        ",1930],"}",["T_WHITESPACE","\n        ",1931],["T_RETURN","return",1932],["T_WHITESPACE"," ",1932],["T_STRING","parent",1932],["T_DOUBLE_COLON","::",1932],["T_STRING","getData",1932],"(",["T_VARIABLE","$key",1932],",",["T_WHITESPACE"," ",1932],["T_VARIABLE","$index",1932],")",";",["T_WHITESPACE","\n    ",1932],"}",["T_WHITESPACE","\n\n    ",1933],["T_DOC_COMMENT","\/**\n     * Retrieve order invoices collection\n     *\n     * @return unknown\n     *\/",1935],["T_WHITESPACE","\n    ",1939],["T_PUBLIC","public",1940],["T_WHITESPACE"," ",1940],["T_FUNCTION","function",1940],["T_WHITESPACE"," ",1940],["T_STRING","getInvoiceCollection",1940],"(",")",["T_WHITESPACE","\n    ",1940],"{",["T_WHITESPACE","\n        ",1941],["T_IF","if",1942],["T_WHITESPACE"," ",1942],"(",["T_STRING","is_null",1942],"(",["T_VARIABLE","$this",1942],["T_OBJECT_OPERATOR","->",1942],["T_STRING","_invoices",1942],")",")",["T_WHITESPACE"," ",1942],"{",["T_WHITESPACE","\n            ",1942],["T_VARIABLE","$this",1943],["T_OBJECT_OPERATOR","->",1943],["T_STRING","_invoices",1943],["T_WHITESPACE"," ",1943],"=",["T_WHITESPACE"," ",1943],["T_STRING","Mage",1943],["T_DOUBLE_COLON","::",1943],["T_STRING","getResourceModel",1943],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice_collection'",1943],")",["T_WHITESPACE","\n                ",1943],["T_OBJECT_OPERATOR","->",1944],["T_STRING","setOrderFilter",1944],"(",["T_VARIABLE","$this",1944],")",";",["T_WHITESPACE","\n\n            ",1944],["T_IF","if",1946],["T_WHITESPACE"," ",1946],"(",["T_VARIABLE","$this",1946],["T_OBJECT_OPERATOR","->",1946],["T_STRING","getId",1946],"(",")",")",["T_WHITESPACE"," ",1946],"{",["T_WHITESPACE","\n                ",1946],["T_FOREACH","foreach",1947],["T_WHITESPACE"," ",1947],"(",["T_VARIABLE","$this",1947],["T_OBJECT_OPERATOR","->",1947],["T_STRING","_invoices",1947],["T_WHITESPACE"," ",1947],["T_AS","as",1947],["T_WHITESPACE"," ",1947],["T_VARIABLE","$invoice",1947],")",["T_WHITESPACE"," ",1947],"{",["T_WHITESPACE","\n                    ",1947],["T_VARIABLE","$invoice",1948],["T_OBJECT_OPERATOR","->",1948],["T_STRING","setOrder",1948],"(",["T_VARIABLE","$this",1948],")",";",["T_WHITESPACE","\n                ",1948],"}",["T_WHITESPACE","\n            ",1949],"}",["T_WHITESPACE","\n        ",1950],"}",["T_WHITESPACE","\n        ",1951],["T_RETURN","return",1952],["T_WHITESPACE"," ",1952],["T_VARIABLE","$this",1952],["T_OBJECT_OPERATOR","->",1952],["T_STRING","_invoices",1952],";",["T_WHITESPACE","\n    ",1952],"}",["T_WHITESPACE","\n\n     ",1953],["T_DOC_COMMENT","\/**\n     * Retrieve order shipments collection\n     *\n     * @return unknown\n     *\/",1955],["T_WHITESPACE","\n    ",1959],["T_PUBLIC","public",1960],["T_WHITESPACE"," ",1960],["T_FUNCTION","function",1960],["T_WHITESPACE"," ",1960],["T_STRING","getShipmentsCollection",1960],"(",")",["T_WHITESPACE","\n    ",1960],"{",["T_WHITESPACE","\n        ",1961],["T_IF","if",1962],["T_WHITESPACE"," ",1962],"(",["T_EMPTY","empty",1962],"(",["T_VARIABLE","$this",1962],["T_OBJECT_OPERATOR","->",1962],["T_STRING","_shipments",1962],")",")",["T_WHITESPACE"," ",1962],"{",["T_WHITESPACE","\n            ",1962],["T_IF","if",1963],["T_WHITESPACE"," ",1963],"(",["T_VARIABLE","$this",1963],["T_OBJECT_OPERATOR","->",1963],["T_STRING","getId",1963],"(",")",")",["T_WHITESPACE"," ",1963],"{",["T_WHITESPACE","\n                ",1963],["T_VARIABLE","$this",1964],["T_OBJECT_OPERATOR","->",1964],["T_STRING","_shipments",1964],["T_WHITESPACE"," ",1964],"=",["T_WHITESPACE"," ",1964],["T_STRING","Mage",1964],["T_DOUBLE_COLON","::",1964],["T_STRING","getResourceModel",1964],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_collection'",1964],")",["T_WHITESPACE","\n                    ",1964],["T_OBJECT_OPERATOR","->",1965],["T_STRING","setOrderFilter",1965],"(",["T_VARIABLE","$this",1965],")",["T_WHITESPACE","\n                    ",1965],["T_OBJECT_OPERATOR","->",1966],["T_STRING","load",1966],"(",")",";",["T_WHITESPACE","\n            ",1966],"}",["T_WHITESPACE"," ",1967],["T_ELSE","else",1967],["T_WHITESPACE"," ",1967],"{",["T_WHITESPACE","\n                ",1967],["T_RETURN","return",1968],["T_WHITESPACE"," ",1968],["T_STRING","false",1968],";",["T_WHITESPACE","\n            ",1968],"}",["T_WHITESPACE","\n        ",1969],"}",["T_WHITESPACE","\n        ",1970],["T_RETURN","return",1971],["T_WHITESPACE"," ",1971],["T_VARIABLE","$this",1971],["T_OBJECT_OPERATOR","->",1971],["T_STRING","_shipments",1971],";",["T_WHITESPACE","\n    ",1971],"}",["T_WHITESPACE","\n\n    ",1972],["T_DOC_COMMENT","\/**\n     * Retrieve order creditmemos collection\n     *\n     * @return unknown\n     *\/",1974],["T_WHITESPACE","\n    ",1978],["T_PUBLIC","public",1979],["T_WHITESPACE"," ",1979],["T_FUNCTION","function",1979],["T_WHITESPACE"," ",1979],["T_STRING","getCreditmemosCollection",1979],"(",")",["T_WHITESPACE","\n    ",1979],"{",["T_WHITESPACE","\n        ",1980],["T_IF","if",1981],["T_WHITESPACE"," ",1981],"(",["T_EMPTY","empty",1981],"(",["T_VARIABLE","$this",1981],["T_OBJECT_OPERATOR","->",1981],["T_STRING","_creditmemos",1981],")",")",["T_WHITESPACE"," ",1981],"{",["T_WHITESPACE","\n            ",1981],["T_IF","if",1982],["T_WHITESPACE"," ",1982],"(",["T_VARIABLE","$this",1982],["T_OBJECT_OPERATOR","->",1982],["T_STRING","getId",1982],"(",")",")",["T_WHITESPACE"," ",1982],"{",["T_WHITESPACE","\n                ",1982],["T_VARIABLE","$this",1983],["T_OBJECT_OPERATOR","->",1983],["T_STRING","_creditmemos",1983],["T_WHITESPACE"," ",1983],"=",["T_WHITESPACE"," ",1983],["T_STRING","Mage",1983],["T_DOUBLE_COLON","::",1983],["T_STRING","getResourceModel",1983],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo_collection'",1983],")",["T_WHITESPACE","\n                    ",1983],["T_OBJECT_OPERATOR","->",1984],["T_STRING","setOrderFilter",1984],"(",["T_VARIABLE","$this",1984],")",["T_WHITESPACE","\n                    ",1984],["T_OBJECT_OPERATOR","->",1985],["T_STRING","load",1985],"(",")",";",["T_WHITESPACE","\n            ",1985],"}",["T_WHITESPACE"," ",1986],["T_ELSE","else",1986],["T_WHITESPACE"," ",1986],"{",["T_WHITESPACE","\n                ",1986],["T_RETURN","return",1987],["T_WHITESPACE"," ",1987],["T_STRING","false",1987],";",["T_WHITESPACE","\n            ",1987],"}",["T_WHITESPACE","\n        ",1988],"}",["T_WHITESPACE","\n        ",1989],["T_RETURN","return",1990],["T_WHITESPACE"," ",1990],["T_VARIABLE","$this",1990],["T_OBJECT_OPERATOR","->",1990],["T_STRING","_creditmemos",1990],";",["T_WHITESPACE","\n    ",1990],"}",["T_WHITESPACE","\n\n    ",1991],["T_DOC_COMMENT","\/**\n     * Retrieve order tracking numbers collection\n     *\n     * @return unknown\n     *\/",1993],["T_WHITESPACE","\n    ",1997],["T_PUBLIC","public",1998],["T_WHITESPACE"," ",1998],["T_FUNCTION","function",1998],["T_WHITESPACE"," ",1998],["T_STRING","getTracksCollection",1998],"(",")",["T_WHITESPACE","\n    ",1998],"{",["T_WHITESPACE","\n        ",1999],["T_IF","if",2000],["T_WHITESPACE"," ",2000],"(",["T_EMPTY","empty",2000],"(",["T_VARIABLE","$this",2000],["T_OBJECT_OPERATOR","->",2000],["T_STRING","_tracks",2000],")",")",["T_WHITESPACE"," ",2000],"{",["T_WHITESPACE","\n            ",2000],["T_VARIABLE","$this",2001],["T_OBJECT_OPERATOR","->",2001],["T_STRING","_tracks",2001],["T_WHITESPACE"," ",2001],"=",["T_WHITESPACE"," ",2001],["T_STRING","Mage",2001],["T_DOUBLE_COLON","::",2001],["T_STRING","getResourceModel",2001],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track_collection'",2001],")",["T_WHITESPACE","\n                ",2001],["T_OBJECT_OPERATOR","->",2002],["T_STRING","setOrderFilter",2002],"(",["T_VARIABLE","$this",2002],")",";",["T_WHITESPACE","\n\n            ",2002],["T_IF","if",2004],["T_WHITESPACE"," ",2004],"(",["T_VARIABLE","$this",2004],["T_OBJECT_OPERATOR","->",2004],["T_STRING","getId",2004],"(",")",")",["T_WHITESPACE"," ",2004],"{",["T_WHITESPACE","\n                ",2004],["T_VARIABLE","$this",2005],["T_OBJECT_OPERATOR","->",2005],["T_STRING","_tracks",2005],["T_OBJECT_OPERATOR","->",2005],["T_STRING","load",2005],"(",")",";",["T_WHITESPACE","\n            ",2005],"}",["T_WHITESPACE","\n        ",2006],"}",["T_WHITESPACE","\n        ",2007],["T_RETURN","return",2008],["T_WHITESPACE"," ",2008],["T_VARIABLE","$this",2008],["T_OBJECT_OPERATOR","->",2008],["T_STRING","_tracks",2008],";",["T_WHITESPACE","\n    ",2008],"}",["T_WHITESPACE","\n\n    ",2009],["T_DOC_COMMENT","\/**\n     * Check order invoices availability\n     *\n     * @return bool\n     *\/",2011],["T_WHITESPACE","\n    ",2015],["T_PUBLIC","public",2016],["T_WHITESPACE"," ",2016],["T_FUNCTION","function",2016],["T_WHITESPACE"," ",2016],["T_STRING","hasInvoices",2016],"(",")",["T_WHITESPACE","\n    ",2016],"{",["T_WHITESPACE","\n        ",2017],["T_RETURN","return",2018],["T_WHITESPACE"," ",2018],["T_VARIABLE","$this",2018],["T_OBJECT_OPERATOR","->",2018],["T_STRING","getInvoiceCollection",2018],"(",")",["T_OBJECT_OPERATOR","->",2018],["T_STRING","count",2018],"(",")",";",["T_WHITESPACE","\n    ",2018],"}",["T_WHITESPACE","\n\n    ",2019],["T_DOC_COMMENT","\/**\n     * Check order shipments availability\n     *\n     * @return bool\n     *\/",2021],["T_WHITESPACE","\n    ",2025],["T_PUBLIC","public",2026],["T_WHITESPACE"," ",2026],["T_FUNCTION","function",2026],["T_WHITESPACE"," ",2026],["T_STRING","hasShipments",2026],"(",")",["T_WHITESPACE","\n    ",2026],"{",["T_WHITESPACE","\n        ",2027],["T_VARIABLE","$result",2028],["T_WHITESPACE"," ",2028],"=",["T_WHITESPACE"," ",2028],["T_STRING","false",2028],";",["T_WHITESPACE","\n        ",2028],["T_VARIABLE","$shipmentsCollection",2029],["T_WHITESPACE"," ",2029],"=",["T_WHITESPACE"," ",2029],["T_VARIABLE","$this",2029],["T_OBJECT_OPERATOR","->",2029],["T_STRING","getShipmentsCollection",2029],"(",")",";",["T_WHITESPACE","\n        ",2029],["T_IF","if",2030],["T_WHITESPACE"," ",2030],"(",["T_VARIABLE","$shipmentsCollection",2030],")",["T_WHITESPACE"," ",2030],"{",["T_WHITESPACE","\n            ",2030],["T_VARIABLE","$result",2031],["T_WHITESPACE"," ",2031],"=",["T_WHITESPACE"," ",2031],["T_BOOL_CAST","(bool)",2031],["T_VARIABLE","$shipmentsCollection",2031],["T_OBJECT_OPERATOR","->",2031],["T_STRING","count",2031],"(",")",";",["T_WHITESPACE","\n        ",2031],"}",["T_WHITESPACE","\n        ",2032],["T_RETURN","return",2033],["T_WHITESPACE"," ",2033],["T_VARIABLE","$result",2033],";",["T_WHITESPACE","\n    ",2033],"}",["T_WHITESPACE","\n\n    ",2034],["T_DOC_COMMENT","\/**\n     * Check order creditmemos availability\n     *\n     * @return bool\n     *\/",2036],["T_WHITESPACE","\n    ",2040],["T_PUBLIC","public",2041],["T_WHITESPACE"," ",2041],["T_FUNCTION","function",2041],["T_WHITESPACE"," ",2041],["T_STRING","hasCreditmemos",2041],"(",")",["T_WHITESPACE","\n    ",2041],"{",["T_WHITESPACE","\n        ",2042],["T_VARIABLE","$result",2043],["T_WHITESPACE"," ",2043],"=",["T_WHITESPACE"," ",2043],["T_STRING","false",2043],";",["T_WHITESPACE","\n        ",2043],["T_VARIABLE","$creditmemosCollection",2044],["T_WHITESPACE"," ",2044],"=",["T_WHITESPACE"," ",2044],["T_VARIABLE","$this",2044],["T_OBJECT_OPERATOR","->",2044],["T_STRING","getCreditmemosCollection",2044],"(",")",";",["T_WHITESPACE","\n        ",2044],["T_IF","if",2045],["T_WHITESPACE"," ",2045],"(",["T_VARIABLE","$creditmemosCollection",2045],")",["T_WHITESPACE"," ",2045],"{",["T_WHITESPACE","\n            ",2045],["T_VARIABLE","$result",2046],["T_WHITESPACE"," ",2046],"=",["T_WHITESPACE"," ",2046],["T_BOOL_CAST","(bool)",2046],["T_VARIABLE","$creditmemosCollection",2046],["T_OBJECT_OPERATOR","->",2046],["T_STRING","count",2046],"(",")",";",["T_WHITESPACE","\n        ",2046],"}",["T_WHITESPACE","\n        ",2047],["T_RETURN","return",2048],["T_WHITESPACE"," ",2048],["T_VARIABLE","$result",2048],";",["T_WHITESPACE","\n    ",2048],"}",["T_WHITESPACE","\n\n\n    ",2049],["T_DOC_COMMENT","\/**\n     * Retrieve array of related objects\n     *\n     * Used for order saving\n     *\n     * @return array\n     *\/",2052],["T_WHITESPACE","\n    ",2058],["T_PUBLIC","public",2059],["T_WHITESPACE"," ",2059],["T_FUNCTION","function",2059],["T_WHITESPACE"," ",2059],["T_STRING","getRelatedObjects",2059],"(",")",["T_WHITESPACE","\n    ",2059],"{",["T_WHITESPACE","\n        ",2060],["T_RETURN","return",2061],["T_WHITESPACE"," ",2061],["T_VARIABLE","$this",2061],["T_OBJECT_OPERATOR","->",2061],["T_STRING","_relatedObjects",2061],";",["T_WHITESPACE","\n    ",2061],"}",["T_WHITESPACE","\n\n    ",2062],["T_DOC_COMMENT","\/**\n     * Retrieve customer name\n     *\n     * @return string\n     *\/",2064],["T_WHITESPACE","\n    ",2068],["T_PUBLIC","public",2069],["T_WHITESPACE"," ",2069],["T_FUNCTION","function",2069],["T_WHITESPACE"," ",2069],["T_STRING","getCustomerName",2069],"(",")",["T_WHITESPACE","\n    ",2069],"{",["T_WHITESPACE","\n        ",2070],["T_IF","if",2071],["T_WHITESPACE"," ",2071],"(",["T_VARIABLE","$this",2071],["T_OBJECT_OPERATOR","->",2071],["T_STRING","getCustomerFirstname",2071],"(",")",")",["T_WHITESPACE"," ",2071],"{",["T_WHITESPACE","\n            ",2071],["T_VARIABLE","$customerName",2072],["T_WHITESPACE"," ",2072],"=",["T_WHITESPACE"," ",2072],["T_STRING","Mage",2072],["T_DOUBLE_COLON","::",2072],["T_STRING","helper",2072],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",2072],")",["T_OBJECT_OPERATOR","->",2072],["T_STRING","getFullCustomerName",2072],"(",["T_VARIABLE","$this",2072],")",";",["T_WHITESPACE","\n        ",2072],"}",["T_WHITESPACE"," ",2073],["T_ELSE","else",2073],["T_WHITESPACE"," ",2073],"{",["T_WHITESPACE","\n            ",2073],["T_VARIABLE","$customerName",2074],["T_WHITESPACE"," ",2074],"=",["T_WHITESPACE"," ",2074],["T_STRING","Mage",2074],["T_DOUBLE_COLON","::",2074],["T_STRING","helper",2074],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",2074],")",["T_OBJECT_OPERATOR","->",2074],["T_STRING","__",2074],"(",["T_CONSTANT_ENCAPSED_STRING","'Guest'",2074],")",";",["T_WHITESPACE","\n        ",2074],"}",["T_WHITESPACE","\n        ",2075],["T_RETURN","return",2076],["T_WHITESPACE"," ",2076],["T_VARIABLE","$customerName",2076],";",["T_WHITESPACE","\n    ",2076],"}",["T_WHITESPACE","\n\n    ",2077],["T_DOC_COMMENT","\/**\n     * Add New object to related array\n     *\n     * @param   Mage_Core_Model_Abstract $object\n     * @return  Mage_Sales_Model_Order\n     *\/",2079],["T_WHITESPACE","\n    ",2084],["T_PUBLIC","public",2085],["T_WHITESPACE"," ",2085],["T_FUNCTION","function",2085],["T_WHITESPACE"," ",2085],["T_STRING","addRelatedObject",2085],"(",["T_STRING","Mage_Core_Model_Abstract",2085],["T_WHITESPACE"," ",2085],["T_VARIABLE","$object",2085],")",["T_WHITESPACE","\n    ",2085],"{",["T_WHITESPACE","\n        ",2086],["T_VARIABLE","$this",2087],["T_OBJECT_OPERATOR","->",2087],["T_STRING","_relatedObjects",2087],"[","]",["T_WHITESPACE"," ",2087],"=",["T_WHITESPACE"," ",2087],["T_VARIABLE","$object",2087],";",["T_WHITESPACE","\n        ",2087],["T_RETURN","return",2088],["T_WHITESPACE"," ",2088],["T_VARIABLE","$this",2088],";",["T_WHITESPACE","\n    ",2088],"}",["T_WHITESPACE","\n\n    ",2089],["T_DOC_COMMENT","\/**\n     * Get formated order created date in store timezone\n     *\n     * @param   string $format date format type (short|medium|long|full)\n     * @return  string\n     *\/",2091],["T_WHITESPACE","\n    ",2096],["T_PUBLIC","public",2097],["T_WHITESPACE"," ",2097],["T_FUNCTION","function",2097],["T_WHITESPACE"," ",2097],["T_STRING","getCreatedAtFormated",2097],"(",["T_VARIABLE","$format",2097],")",["T_WHITESPACE","\n    ",2097],"{",["T_WHITESPACE","\n        ",2098],["T_RETURN","return",2099],["T_WHITESPACE"," ",2099],["T_STRING","Mage",2099],["T_DOUBLE_COLON","::",2099],["T_STRING","helper",2099],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",2099],")",["T_OBJECT_OPERATOR","->",2099],["T_STRING","formatDate",2099],"(",["T_VARIABLE","$this",2099],["T_OBJECT_OPERATOR","->",2099],["T_STRING","getCreatedAtStoreDate",2099],"(",")",",",["T_WHITESPACE"," ",2099],["T_VARIABLE","$format",2099],",",["T_WHITESPACE"," ",2099],["T_STRING","true",2099],")",";",["T_WHITESPACE","\n    ",2099],"}",["T_WHITESPACE","\n\n    ",2100],["T_PUBLIC","public",2102],["T_WHITESPACE"," ",2102],["T_FUNCTION","function",2102],["T_WHITESPACE"," ",2102],["T_STRING","getEmailCustomerNote",2102],"(",")",["T_WHITESPACE","\n    ",2102],"{",["T_WHITESPACE","\n        ",2103],["T_IF","if",2104],["T_WHITESPACE"," ",2104],"(",["T_VARIABLE","$this",2104],["T_OBJECT_OPERATOR","->",2104],["T_STRING","getCustomerNoteNotify",2104],"(",")",")",["T_WHITESPACE"," ",2104],"{",["T_WHITESPACE","\n            ",2104],["T_RETURN","return",2105],["T_WHITESPACE"," ",2105],["T_VARIABLE","$this",2105],["T_OBJECT_OPERATOR","->",2105],["T_STRING","getCustomerNote",2105],"(",")",";",["T_WHITESPACE","\n        ",2105],"}",["T_WHITESPACE","\n        ",2106],["T_RETURN","return",2107],["T_WHITESPACE"," ",2107],["T_CONSTANT_ENCAPSED_STRING","''",2107],";",["T_WHITESPACE","\n    ",2107],"}",["T_WHITESPACE","\n\n    ",2108],["T_DOC_COMMENT","\/**\n     * Processing object before save data\n     *\n     * @return Mage_Core_Model_Abstract\n     *\/",2110],["T_WHITESPACE","\n    ",2114],["T_PROTECTED","protected",2115],["T_WHITESPACE"," ",2115],["T_FUNCTION","function",2115],["T_WHITESPACE"," ",2115],["T_STRING","_beforeSave",2115],"(",")",["T_WHITESPACE","\n    ",2115],"{",["T_WHITESPACE","\n        ",2116],["T_STRING","parent",2117],["T_DOUBLE_COLON","::",2117],["T_STRING","_beforeSave",2117],"(",")",";",["T_WHITESPACE","\n        ",2117],["T_VARIABLE","$this",2118],["T_OBJECT_OPERATOR","->",2118],["T_STRING","_checkState",2118],"(",")",";",["T_WHITESPACE","\n        ",2118],["T_IF","if",2119],["T_WHITESPACE"," ",2119],"(","!",["T_VARIABLE","$this",2119],["T_OBJECT_OPERATOR","->",2119],["T_STRING","getId",2119],"(",")",")",["T_WHITESPACE"," ",2119],"{",["T_WHITESPACE","\n            ",2119],["T_VARIABLE","$store",2120],["T_WHITESPACE"," ",2120],"=",["T_WHITESPACE"," ",2120],["T_VARIABLE","$this",2120],["T_OBJECT_OPERATOR","->",2120],["T_STRING","getStore",2120],"(",")",";",["T_WHITESPACE","\n            ",2120],["T_VARIABLE","$name",2121],["T_WHITESPACE"," ",2121],"=",["T_WHITESPACE"," ",2121],["T_ARRAY","array",2121],"(",["T_VARIABLE","$store",2121],["T_OBJECT_OPERATOR","->",2121],["T_STRING","getWebsite",2121],"(",")",["T_OBJECT_OPERATOR","->",2121],["T_STRING","getName",2121],"(",")",",",["T_VARIABLE","$store",2121],["T_OBJECT_OPERATOR","->",2121],["T_STRING","getGroup",2121],"(",")",["T_OBJECT_OPERATOR","->",2121],["T_STRING","getName",2121],"(",")",",",["T_VARIABLE","$store",2121],["T_OBJECT_OPERATOR","->",2121],["T_STRING","getName",2121],"(",")",")",";",["T_WHITESPACE","\n            ",2121],["T_VARIABLE","$this",2122],["T_OBJECT_OPERATOR","->",2122],["T_STRING","setStoreName",2122],"(",["T_STRING","implode",2122],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",2122],",",["T_WHITESPACE"," ",2122],["T_VARIABLE","$name",2122],")",")",";",["T_WHITESPACE","\n        ",2122],"}",["T_WHITESPACE","\n\n        ",2123],["T_IF","if",2125],["T_WHITESPACE"," ",2125],"(","!",["T_VARIABLE","$this",2125],["T_OBJECT_OPERATOR","->",2125],["T_STRING","getIncrementId",2125],"(",")",")",["T_WHITESPACE"," ",2125],"{",["T_WHITESPACE","\n            ",2125],["T_VARIABLE","$incrementId",2126],["T_WHITESPACE"," ",2126],"=",["T_WHITESPACE"," ",2126],["T_STRING","Mage",2126],["T_DOUBLE_COLON","::",2126],["T_STRING","getSingleton",2126],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",2126],")",["T_WHITESPACE","\n                ",2126],["T_OBJECT_OPERATOR","->",2127],["T_STRING","getEntityType",2127],"(",["T_CONSTANT_ENCAPSED_STRING","'order'",2127],")",["T_WHITESPACE","\n                ",2127],["T_OBJECT_OPERATOR","->",2128],["T_STRING","fetchNewIncrementId",2128],"(",["T_VARIABLE","$this",2128],["T_OBJECT_OPERATOR","->",2128],["T_STRING","getStoreId",2128],"(",")",")",";",["T_WHITESPACE","\n            ",2128],["T_VARIABLE","$this",2129],["T_OBJECT_OPERATOR","->",2129],["T_STRING","setIncrementId",2129],"(",["T_VARIABLE","$incrementId",2129],")",";",["T_WHITESPACE","\n        ",2129],"}",["T_WHITESPACE","\n\n        ",2130],["T_DOC_COMMENT","\/**\n         * Process items dependency for new order\n         *\/",2132],["T_WHITESPACE","\n        ",2134],["T_IF","if",2135],["T_WHITESPACE"," ",2135],"(","!",["T_VARIABLE","$this",2135],["T_OBJECT_OPERATOR","->",2135],["T_STRING","getId",2135],"(",")",")",["T_WHITESPACE"," ",2135],"{",["T_WHITESPACE","\n            ",2135],["T_VARIABLE","$itemsCount",2136],["T_WHITESPACE"," ",2136],"=",["T_WHITESPACE"," ",2136],["T_LNUMBER","0",2136],";",["T_WHITESPACE","\n            ",2136],["T_FOREACH","foreach",2137],["T_WHITESPACE"," ",2137],"(",["T_VARIABLE","$this",2137],["T_OBJECT_OPERATOR","->",2137],["T_STRING","getAllItems",2137],"(",")",["T_WHITESPACE"," ",2137],["T_AS","as",2137],["T_WHITESPACE"," ",2137],["T_VARIABLE","$item",2137],")",["T_WHITESPACE"," ",2137],"{",["T_WHITESPACE","\n                ",2137],["T_VARIABLE","$parent",2138],["T_WHITESPACE"," ",2138],"=",["T_WHITESPACE"," ",2138],["T_VARIABLE","$item",2138],["T_OBJECT_OPERATOR","->",2138],["T_STRING","getQuoteParentItemId",2138],"(",")",";",["T_WHITESPACE","\n                ",2138],["T_IF","if",2139],["T_WHITESPACE"," ",2139],"(",["T_VARIABLE","$parent",2139],["T_WHITESPACE"," ",2139],["T_BOOLEAN_AND","&&",2139],["T_WHITESPACE"," ",2139],"!",["T_VARIABLE","$item",2139],["T_OBJECT_OPERATOR","->",2139],["T_STRING","getParentItem",2139],"(",")",")",["T_WHITESPACE"," ",2139],"{",["T_WHITESPACE","\n                    ",2139],["T_VARIABLE","$item",2140],["T_OBJECT_OPERATOR","->",2140],["T_STRING","setParentItem",2140],"(",["T_VARIABLE","$this",2140],["T_OBJECT_OPERATOR","->",2140],["T_STRING","getItemByQuoteItemId",2140],"(",["T_VARIABLE","$parent",2140],")",")",";",["T_WHITESPACE","\n                ",2140],"}",["T_WHITESPACE"," ",2141],["T_ELSEIF","elseif",2141],["T_WHITESPACE"," ",2141],"(","!",["T_VARIABLE","$parent",2141],")",["T_WHITESPACE"," ",2141],"{",["T_WHITESPACE","\n                    ",2141],["T_VARIABLE","$itemsCount",2142],["T_INC","++",2142],";",["T_WHITESPACE","\n                ",2142],"}",["T_WHITESPACE","\n            ",2143],"}",["T_WHITESPACE","\n            ",2144],["T_COMMENT","\/\/ Set items count\n",2145],["T_WHITESPACE","            ",2146],["T_VARIABLE","$this",2146],["T_OBJECT_OPERATOR","->",2146],["T_STRING","setTotalItemCount",2146],"(",["T_VARIABLE","$itemsCount",2146],")",";",["T_WHITESPACE","\n        ",2146],"}",["T_WHITESPACE","\n        ",2147],["T_IF","if",2148],["T_WHITESPACE"," ",2148],"(",["T_VARIABLE","$this",2148],["T_OBJECT_OPERATOR","->",2148],["T_STRING","getCustomer",2148],"(",")",")",["T_WHITESPACE"," ",2148],"{",["T_WHITESPACE","\n            ",2148],["T_VARIABLE","$this",2149],["T_OBJECT_OPERATOR","->",2149],["T_STRING","setCustomerId",2149],"(",["T_VARIABLE","$this",2149],["T_OBJECT_OPERATOR","->",2149],["T_STRING","getCustomer",2149],"(",")",["T_OBJECT_OPERATOR","->",2149],["T_STRING","getId",2149],"(",")",")",";",["T_WHITESPACE","\n        ",2149],"}",["T_WHITESPACE","\n\n        ",2150],["T_IF","if",2152],["T_WHITESPACE"," ",2152],"(",["T_VARIABLE","$this",2152],["T_OBJECT_OPERATOR","->",2152],["T_STRING","hasBillingAddressId",2152],"(",")",["T_WHITESPACE"," ",2152],["T_BOOLEAN_AND","&&",2152],["T_WHITESPACE"," ",2152],["T_VARIABLE","$this",2152],["T_OBJECT_OPERATOR","->",2152],["T_STRING","getBillingAddressId",2152],"(",")",["T_WHITESPACE"," ",2152],["T_IS_IDENTICAL","===",2152],["T_WHITESPACE"," ",2152],["T_STRING","null",2152],")",["T_WHITESPACE"," ",2152],"{",["T_WHITESPACE","\n            ",2152],["T_VARIABLE","$this",2153],["T_OBJECT_OPERATOR","->",2153],["T_STRING","unsBillingAddressId",2153],"(",")",";",["T_WHITESPACE","\n        ",2153],"}",["T_WHITESPACE","\n\n        ",2154],["T_IF","if",2156],["T_WHITESPACE"," ",2156],"(",["T_VARIABLE","$this",2156],["T_OBJECT_OPERATOR","->",2156],["T_STRING","hasShippingAddressId",2156],"(",")",["T_WHITESPACE"," ",2156],["T_BOOLEAN_AND","&&",2156],["T_WHITESPACE"," ",2156],["T_VARIABLE","$this",2156],["T_OBJECT_OPERATOR","->",2156],["T_STRING","getShippingAddressId",2156],"(",")",["T_WHITESPACE"," ",2156],["T_IS_IDENTICAL","===",2156],["T_WHITESPACE"," ",2156],["T_STRING","null",2156],")",["T_WHITESPACE"," ",2156],"{",["T_WHITESPACE","\n            ",2156],["T_VARIABLE","$this",2157],["T_OBJECT_OPERATOR","->",2157],["T_STRING","unsShippingAddressId",2157],"(",")",";",["T_WHITESPACE","\n        ",2157],"}",["T_WHITESPACE","\n\n        ",2158],["T_VARIABLE","$this",2160],["T_OBJECT_OPERATOR","->",2160],["T_STRING","setData",2160],"(",["T_CONSTANT_ENCAPSED_STRING","'protect_code'",2160],",",["T_WHITESPACE"," ",2160],["T_STRING","substr",2160],"(",["T_STRING","md5",2160],"(",["T_STRING","uniqid",2160],"(",["T_STRING","mt_rand",2160],"(",")",",",["T_WHITESPACE"," ",2160],["T_STRING","true",2160],")",["T_WHITESPACE"," ",2160],".",["T_WHITESPACE"," ",2160],["T_CONSTANT_ENCAPSED_STRING","':'",2160],["T_WHITESPACE"," ",2160],".",["T_WHITESPACE"," ",2160],["T_STRING","microtime",2160],"(",["T_STRING","true",2160],")",")",",",["T_WHITESPACE"," ",2160],["T_LNUMBER","5",2160],",",["T_WHITESPACE"," ",2160],["T_LNUMBER","6",2160],")",")",";",["T_WHITESPACE","\n        ",2160],["T_RETURN","return",2161],["T_WHITESPACE"," ",2161],["T_VARIABLE","$this",2161],";",["T_WHITESPACE","\n    ",2161],"}",["T_WHITESPACE","\n\n    ",2162],["T_DOC_COMMENT","\/**\n     * Check order state before saving\n     *\/",2164],["T_WHITESPACE","\n    ",2166],["T_PROTECTED","protected",2167],["T_WHITESPACE"," ",2167],["T_FUNCTION","function",2167],["T_WHITESPACE"," ",2167],["T_STRING","_checkState",2167],"(",")",["T_WHITESPACE","\n    ",2167],"{",["T_WHITESPACE","\n        ",2168],["T_IF","if",2169],["T_WHITESPACE"," ",2169],"(","!",["T_VARIABLE","$this",2169],["T_OBJECT_OPERATOR","->",2169],["T_STRING","getId",2169],"(",")",")",["T_WHITESPACE"," ",2169],"{",["T_WHITESPACE","\n            ",2169],["T_RETURN","return",2170],["T_WHITESPACE"," ",2170],["T_VARIABLE","$this",2170],";",["T_WHITESPACE","\n        ",2170],"}",["T_WHITESPACE","\n\n        ",2171],["T_VARIABLE","$userNotification",2173],["T_WHITESPACE"," ",2173],"=",["T_WHITESPACE"," ",2173],["T_VARIABLE","$this",2173],["T_OBJECT_OPERATOR","->",2173],["T_STRING","hasCustomerNoteNotify",2173],"(",")",["T_WHITESPACE"," ",2173],"?",["T_WHITESPACE"," ",2173],["T_VARIABLE","$this",2173],["T_OBJECT_OPERATOR","->",2173],["T_STRING","getCustomerNoteNotify",2173],"(",")",["T_WHITESPACE"," ",2173],":",["T_WHITESPACE"," ",2173],["T_STRING","null",2173],";",["T_WHITESPACE","\n\n        ",2173],["T_IF","if",2175],["T_WHITESPACE"," ",2175],"(","!",["T_VARIABLE","$this",2175],["T_OBJECT_OPERATOR","->",2175],["T_STRING","isCanceled",2175],"(",")",["T_WHITESPACE","\n            ",2175],["T_BOOLEAN_AND","&&",2176],["T_WHITESPACE"," ",2176],"!",["T_VARIABLE","$this",2176],["T_OBJECT_OPERATOR","->",2176],["T_STRING","canUnhold",2176],"(",")",["T_WHITESPACE","\n            ",2176],["T_BOOLEAN_AND","&&",2177],["T_WHITESPACE"," ",2177],"!",["T_VARIABLE","$this",2177],["T_OBJECT_OPERATOR","->",2177],["T_STRING","canInvoice",2177],"(",")",["T_WHITESPACE","\n            ",2177],["T_BOOLEAN_AND","&&",2178],["T_WHITESPACE"," ",2178],"!",["T_VARIABLE","$this",2178],["T_OBJECT_OPERATOR","->",2178],["T_STRING","canShip",2178],"(",")",")",["T_WHITESPACE"," ",2178],"{",["T_WHITESPACE","\n            ",2178],["T_IF","if",2179],["T_WHITESPACE"," ",2179],"(",["T_LNUMBER","0",2179],["T_WHITESPACE"," ",2179],["T_IS_EQUAL","==",2179],["T_WHITESPACE"," ",2179],["T_VARIABLE","$this",2179],["T_OBJECT_OPERATOR","->",2179],["T_STRING","getBaseGrandTotal",2179],"(",")",["T_WHITESPACE"," ",2179],["T_BOOLEAN_OR","||",2179],["T_WHITESPACE"," ",2179],["T_VARIABLE","$this",2179],["T_OBJECT_OPERATOR","->",2179],["T_STRING","canCreditmemo",2179],"(",")",")",["T_WHITESPACE"," ",2179],"{",["T_WHITESPACE","\n                ",2179],["T_IF","if",2180],["T_WHITESPACE"," ",2180],"(",["T_VARIABLE","$this",2180],["T_OBJECT_OPERATOR","->",2180],["T_STRING","getState",2180],"(",")",["T_WHITESPACE"," ",2180],["T_IS_NOT_IDENTICAL","!==",2180],["T_WHITESPACE"," ",2180],["T_STRING","self",2180],["T_DOUBLE_COLON","::",2180],["T_STRING","STATE_COMPLETE",2180],")",["T_WHITESPACE"," ",2180],"{",["T_WHITESPACE","\n                    ",2180],["T_VARIABLE","$this",2181],["T_OBJECT_OPERATOR","->",2181],["T_STRING","_setState",2181],"(",["T_STRING","self",2181],["T_DOUBLE_COLON","::",2181],["T_STRING","STATE_COMPLETE",2181],",",["T_WHITESPACE"," ",2181],["T_STRING","true",2181],",",["T_WHITESPACE"," ",2181],["T_CONSTANT_ENCAPSED_STRING","''",2181],",",["T_WHITESPACE"," ",2181],["T_VARIABLE","$userNotification",2181],")",";",["T_WHITESPACE","\n                ",2181],"}",["T_WHITESPACE","\n            ",2182],"}",["T_WHITESPACE","\n            ",2183],["T_DOC_COMMENT","\/**\n             * Order can be closed just in case when we have refunded amount.\n             * In case of \"0\" grand total order checking ForcedCanCreditmemo flag\n             *\/",2184],["T_WHITESPACE","\n            ",2187],["T_ELSEIF","elseif",2188],["T_WHITESPACE"," ",2188],"(",["T_STRING","floatval",2188],"(",["T_VARIABLE","$this",2188],["T_OBJECT_OPERATOR","->",2188],["T_STRING","getTotalRefunded",2188],"(",")",")",["T_WHITESPACE"," ",2188],["T_BOOLEAN_OR","||",2188],["T_WHITESPACE"," ",2188],"(","!",["T_VARIABLE","$this",2188],["T_OBJECT_OPERATOR","->",2188],["T_STRING","getTotalRefunded",2188],"(",")",["T_WHITESPACE","\n                ",2188],["T_BOOLEAN_AND","&&",2189],["T_WHITESPACE"," ",2189],["T_VARIABLE","$this",2189],["T_OBJECT_OPERATOR","->",2189],["T_STRING","hasForcedCanCreditmemo",2189],"(",")",")",["T_WHITESPACE","\n            ",2189],")",["T_WHITESPACE"," ",2190],"{",["T_WHITESPACE","\n                ",2190],["T_IF","if",2191],["T_WHITESPACE"," ",2191],"(",["T_VARIABLE","$this",2191],["T_OBJECT_OPERATOR","->",2191],["T_STRING","getState",2191],"(",")",["T_WHITESPACE"," ",2191],["T_IS_NOT_IDENTICAL","!==",2191],["T_WHITESPACE"," ",2191],["T_STRING","self",2191],["T_DOUBLE_COLON","::",2191],["T_STRING","STATE_CLOSED",2191],")",["T_WHITESPACE"," ",2191],"{",["T_WHITESPACE","\n                    ",2191],["T_VARIABLE","$this",2192],["T_OBJECT_OPERATOR","->",2192],["T_STRING","_setState",2192],"(",["T_STRING","self",2192],["T_DOUBLE_COLON","::",2192],["T_STRING","STATE_CLOSED",2192],",",["T_WHITESPACE"," ",2192],["T_STRING","true",2192],",",["T_WHITESPACE"," ",2192],["T_CONSTANT_ENCAPSED_STRING","''",2192],",",["T_WHITESPACE"," ",2192],["T_VARIABLE","$userNotification",2192],")",";",["T_WHITESPACE","\n                ",2192],"}",["T_WHITESPACE","\n            ",2193],"}",["T_WHITESPACE","\n        ",2194],"}",["T_WHITESPACE","\n\n        ",2195],["T_IF","if",2197],["T_WHITESPACE"," ",2197],"(",["T_VARIABLE","$this",2197],["T_OBJECT_OPERATOR","->",2197],["T_STRING","getState",2197],"(",")",["T_WHITESPACE"," ",2197],["T_IS_EQUAL","==",2197],["T_WHITESPACE"," ",2197],["T_STRING","self",2197],["T_DOUBLE_COLON","::",2197],["T_STRING","STATE_NEW",2197],["T_WHITESPACE"," ",2197],["T_BOOLEAN_AND","&&",2197],["T_WHITESPACE"," ",2197],["T_VARIABLE","$this",2197],["T_OBJECT_OPERATOR","->",2197],["T_STRING","getIsInProcess",2197],"(",")",")",["T_WHITESPACE"," ",2197],"{",["T_WHITESPACE","\n            ",2197],["T_VARIABLE","$this",2198],["T_OBJECT_OPERATOR","->",2198],["T_STRING","setState",2198],"(",["T_STRING","self",2198],["T_DOUBLE_COLON","::",2198],["T_STRING","STATE_PROCESSING",2198],",",["T_WHITESPACE"," ",2198],["T_STRING","true",2198],",",["T_WHITESPACE"," ",2198],["T_CONSTANT_ENCAPSED_STRING","''",2198],",",["T_WHITESPACE"," ",2198],["T_VARIABLE","$userNotification",2198],")",";",["T_WHITESPACE","\n        ",2198],"}",["T_WHITESPACE","\n        ",2199],["T_RETURN","return",2200],["T_WHITESPACE"," ",2200],["T_VARIABLE","$this",2200],";",["T_WHITESPACE","\n    ",2200],"}",["T_WHITESPACE","\n\n    ",2201],["T_DOC_COMMENT","\/**\n     * Save order related objects\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",2203],["T_WHITESPACE","\n    ",2207],["T_PROTECTED","protected",2208],["T_WHITESPACE"," ",2208],["T_FUNCTION","function",2208],["T_WHITESPACE"," ",2208],["T_STRING","_afterSave",2208],"(",")",["T_WHITESPACE","\n    ",2208],"{",["T_WHITESPACE","\n        ",2209],["T_IF","if",2210],["T_WHITESPACE"," ",2210],"(",["T_STRING","null",2210],["T_WHITESPACE"," ",2210],["T_IS_NOT_IDENTICAL","!==",2210],["T_WHITESPACE"," ",2210],["T_VARIABLE","$this",2210],["T_OBJECT_OPERATOR","->",2210],["T_STRING","_addresses",2210],")",["T_WHITESPACE"," ",2210],"{",["T_WHITESPACE","\n            ",2210],["T_VARIABLE","$this",2211],["T_OBJECT_OPERATOR","->",2211],["T_STRING","_addresses",2211],["T_OBJECT_OPERATOR","->",2211],["T_STRING","save",2211],"(",")",";",["T_WHITESPACE","\n            ",2211],["T_VARIABLE","$billingAddress",2212],["T_WHITESPACE"," ",2212],"=",["T_WHITESPACE"," ",2212],["T_VARIABLE","$this",2212],["T_OBJECT_OPERATOR","->",2212],["T_STRING","getBillingAddress",2212],"(",")",";",["T_WHITESPACE","\n            ",2212],["T_VARIABLE","$attributesForSave",2213],["T_WHITESPACE"," ",2213],"=",["T_WHITESPACE"," ",2213],["T_ARRAY","array",2213],"(",")",";",["T_WHITESPACE","\n            ",2213],["T_IF","if",2214],["T_WHITESPACE"," ",2214],"(",["T_VARIABLE","$billingAddress",2214],["T_WHITESPACE"," ",2214],["T_BOOLEAN_AND","&&",2214],["T_WHITESPACE"," ",2214],["T_VARIABLE","$this",2214],["T_OBJECT_OPERATOR","->",2214],["T_STRING","getBillingAddressId",2214],"(",")",["T_WHITESPACE"," ",2214],["T_IS_NOT_EQUAL","!=",2214],["T_WHITESPACE"," ",2214],["T_VARIABLE","$billingAddress",2214],["T_OBJECT_OPERATOR","->",2214],["T_STRING","getId",2214],"(",")",")",["T_WHITESPACE"," ",2214],"{",["T_WHITESPACE","\n                ",2214],["T_VARIABLE","$this",2215],["T_OBJECT_OPERATOR","->",2215],["T_STRING","setBillingAddressId",2215],"(",["T_VARIABLE","$billingAddress",2215],["T_OBJECT_OPERATOR","->",2215],["T_STRING","getId",2215],"(",")",")",";",["T_WHITESPACE","\n                ",2215],["T_VARIABLE","$attributesForSave",2216],"[","]",["T_WHITESPACE"," ",2216],"=",["T_WHITESPACE"," ",2216],["T_CONSTANT_ENCAPSED_STRING","'billing_address_id'",2216],";",["T_WHITESPACE","\n            ",2216],"}",["T_WHITESPACE","\n\n            ",2217],["T_VARIABLE","$shippingAddress",2219],["T_WHITESPACE"," ",2219],"=",["T_WHITESPACE"," ",2219],["T_VARIABLE","$this",2219],["T_OBJECT_OPERATOR","->",2219],["T_STRING","getShippingAddress",2219],"(",")",";",["T_WHITESPACE","\n            ",2219],["T_IF","if",2220],["T_WHITESPACE"," ",2220],"(",["T_VARIABLE","$shippingAddress",2220],["T_WHITESPACE"," ",2220],["T_BOOLEAN_AND","&&",2220],["T_WHITESPACE"," ",2220],["T_VARIABLE","$this",2220],["T_OBJECT_OPERATOR","->",2220],["T_STRING","getShippigAddressId",2220],"(",")",["T_WHITESPACE"," ",2220],["T_IS_NOT_EQUAL","!=",2220],["T_WHITESPACE"," ",2220],["T_VARIABLE","$shippingAddress",2220],["T_OBJECT_OPERATOR","->",2220],["T_STRING","getId",2220],"(",")",")",["T_WHITESPACE"," ",2220],"{",["T_WHITESPACE","\n                ",2220],["T_VARIABLE","$this",2221],["T_OBJECT_OPERATOR","->",2221],["T_STRING","setShippingAddressId",2221],"(",["T_VARIABLE","$shippingAddress",2221],["T_OBJECT_OPERATOR","->",2221],["T_STRING","getId",2221],"(",")",")",";",["T_WHITESPACE","\n                ",2221],["T_VARIABLE","$attributesForSave",2222],"[","]",["T_WHITESPACE"," ",2222],"=",["T_WHITESPACE"," ",2222],["T_CONSTANT_ENCAPSED_STRING","'shipping_address_id'",2222],";",["T_WHITESPACE","\n            ",2222],"}",["T_WHITESPACE","\n\n            ",2223],["T_IF","if",2225],["T_WHITESPACE"," ",2225],"(","!",["T_EMPTY","empty",2225],"(",["T_VARIABLE","$attributesForSave",2225],")",")",["T_WHITESPACE"," ",2225],"{",["T_WHITESPACE","\n                ",2225],["T_VARIABLE","$this",2226],["T_OBJECT_OPERATOR","->",2226],["T_STRING","_getResource",2226],"(",")",["T_OBJECT_OPERATOR","->",2226],["T_STRING","saveAttribute",2226],"(",["T_VARIABLE","$this",2226],",",["T_WHITESPACE"," ",2226],["T_VARIABLE","$attributesForSave",2226],")",";",["T_WHITESPACE","\n            ",2226],"}",["T_WHITESPACE","\n\n        ",2227],"}",["T_WHITESPACE","\n        ",2229],["T_IF","if",2230],["T_WHITESPACE"," ",2230],"(",["T_STRING","null",2230],["T_WHITESPACE"," ",2230],["T_IS_NOT_IDENTICAL","!==",2230],["T_WHITESPACE"," ",2230],["T_VARIABLE","$this",2230],["T_OBJECT_OPERATOR","->",2230],["T_STRING","_items",2230],")",["T_WHITESPACE"," ",2230],"{",["T_WHITESPACE","\n            ",2230],["T_VARIABLE","$this",2231],["T_OBJECT_OPERATOR","->",2231],["T_STRING","_items",2231],["T_OBJECT_OPERATOR","->",2231],["T_STRING","save",2231],"(",")",";",["T_WHITESPACE","\n        ",2231],"}",["T_WHITESPACE","\n        ",2232],["T_IF","if",2233],["T_WHITESPACE"," ",2233],"(",["T_STRING","null",2233],["T_WHITESPACE"," ",2233],["T_IS_NOT_IDENTICAL","!==",2233],["T_WHITESPACE"," ",2233],["T_VARIABLE","$this",2233],["T_OBJECT_OPERATOR","->",2233],["T_STRING","_payments",2233],")",["T_WHITESPACE"," ",2233],"{",["T_WHITESPACE","\n            ",2233],["T_VARIABLE","$this",2234],["T_OBJECT_OPERATOR","->",2234],["T_STRING","_payments",2234],["T_OBJECT_OPERATOR","->",2234],["T_STRING","save",2234],"(",")",";",["T_WHITESPACE","\n        ",2234],"}",["T_WHITESPACE","\n        ",2235],["T_IF","if",2236],["T_WHITESPACE"," ",2236],"(",["T_STRING","null",2236],["T_WHITESPACE"," ",2236],["T_IS_NOT_IDENTICAL","!==",2236],["T_WHITESPACE"," ",2236],["T_VARIABLE","$this",2236],["T_OBJECT_OPERATOR","->",2236],["T_STRING","_statusHistory",2236],")",["T_WHITESPACE"," ",2236],"{",["T_WHITESPACE","\n            ",2236],["T_VARIABLE","$this",2237],["T_OBJECT_OPERATOR","->",2237],["T_STRING","_statusHistory",2237],["T_OBJECT_OPERATOR","->",2237],["T_STRING","save",2237],"(",")",";",["T_WHITESPACE","\n        ",2237],"}",["T_WHITESPACE","\n        ",2238],["T_FOREACH","foreach",2239],["T_WHITESPACE"," ",2239],"(",["T_VARIABLE","$this",2239],["T_OBJECT_OPERATOR","->",2239],["T_STRING","getRelatedObjects",2239],"(",")",["T_WHITESPACE"," ",2239],["T_AS","as",2239],["T_WHITESPACE"," ",2239],["T_VARIABLE","$object",2239],")",["T_WHITESPACE"," ",2239],"{",["T_WHITESPACE","\n            ",2239],["T_VARIABLE","$object",2240],["T_OBJECT_OPERATOR","->",2240],["T_STRING","save",2240],"(",")",";",["T_WHITESPACE","\n        ",2240],"}",["T_WHITESPACE","\n        ",2241],["T_RETURN","return",2242],["T_WHITESPACE"," ",2242],["T_STRING","parent",2242],["T_DOUBLE_COLON","::",2242],["T_STRING","_afterSave",2242],"(",")",";",["T_WHITESPACE","\n    ",2242],"}",["T_WHITESPACE","\n\n    ",2243],["T_PUBLIC","public",2245],["T_WHITESPACE"," ",2245],["T_FUNCTION","function",2245],["T_WHITESPACE"," ",2245],["T_STRING","getStoreGroupName",2245],"(",")",["T_WHITESPACE","\n    ",2245],"{",["T_WHITESPACE","\n        ",2246],["T_VARIABLE","$storeId",2247],["T_WHITESPACE"," ",2247],"=",["T_WHITESPACE"," ",2247],["T_VARIABLE","$this",2247],["T_OBJECT_OPERATOR","->",2247],["T_STRING","getStoreId",2247],"(",")",";",["T_WHITESPACE","\n        ",2247],["T_IF","if",2248],["T_WHITESPACE"," ",2248],"(",["T_STRING","is_null",2248],"(",["T_VARIABLE","$storeId",2248],")",")",["T_WHITESPACE"," ",2248],"{",["T_WHITESPACE","\n            ",2248],["T_RETURN","return",2249],["T_WHITESPACE"," ",2249],["T_VARIABLE","$this",2249],["T_OBJECT_OPERATOR","->",2249],["T_STRING","getStoreName",2249],"(",["T_LNUMBER","1",2249],")",";",["T_WHITESPACE"," ",2249],["T_COMMENT","\/\/ 0 - website name, 1 - store group name, 2 - store name\n",2249],["T_WHITESPACE","        ",2250],"}",["T_WHITESPACE","\n        ",2250],["T_RETURN","return",2251],["T_WHITESPACE"," ",2251],["T_VARIABLE","$this",2251],["T_OBJECT_OPERATOR","->",2251],["T_STRING","getStore",2251],"(",")",["T_OBJECT_OPERATOR","->",2251],["T_STRING","getGroup",2251],"(",")",["T_OBJECT_OPERATOR","->",2251],["T_STRING","getName",2251],"(",")",";",["T_WHITESPACE","\n    ",2251],"}",["T_WHITESPACE","\n\n    ",2252],["T_DOC_COMMENT","\/**\n     * Resets all data in object\n     * so after another load it will be complete new object\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",2254],["T_WHITESPACE","\n    ",2259],["T_PUBLIC","public",2260],["T_WHITESPACE"," ",2260],["T_FUNCTION","function",2260],["T_WHITESPACE"," ",2260],["T_STRING","reset",2260],"(",")",["T_WHITESPACE","\n    ",2260],"{",["T_WHITESPACE","\n        ",2261],["T_VARIABLE","$this",2262],["T_OBJECT_OPERATOR","->",2262],["T_STRING","unsetData",2262],"(",")",";",["T_WHITESPACE","\n        ",2262],["T_VARIABLE","$this",2263],["T_OBJECT_OPERATOR","->",2263],["T_STRING","_actionFlag",2263],["T_WHITESPACE"," ",2263],"=",["T_WHITESPACE"," ",2263],["T_ARRAY","array",2263],"(",")",";",["T_WHITESPACE","\n        ",2263],["T_VARIABLE","$this",2264],["T_OBJECT_OPERATOR","->",2264],["T_STRING","_addresses",2264],["T_WHITESPACE"," ",2264],"=",["T_WHITESPACE"," ",2264],["T_STRING","null",2264],";",["T_WHITESPACE","\n        ",2264],["T_VARIABLE","$this",2265],["T_OBJECT_OPERATOR","->",2265],["T_STRING","_items",2265],["T_WHITESPACE"," ",2265],"=",["T_WHITESPACE"," ",2265],["T_STRING","null",2265],";",["T_WHITESPACE","\n        ",2265],["T_VARIABLE","$this",2266],["T_OBJECT_OPERATOR","->",2266],["T_STRING","_payments",2266],["T_WHITESPACE"," ",2266],"=",["T_WHITESPACE"," ",2266],["T_STRING","null",2266],";",["T_WHITESPACE","\n        ",2266],["T_VARIABLE","$this",2267],["T_OBJECT_OPERATOR","->",2267],["T_STRING","_statusHistory",2267],["T_WHITESPACE"," ",2267],"=",["T_WHITESPACE"," ",2267],["T_STRING","null",2267],";",["T_WHITESPACE","\n        ",2267],["T_VARIABLE","$this",2268],["T_OBJECT_OPERATOR","->",2268],["T_STRING","_invoices",2268],["T_WHITESPACE"," ",2268],"=",["T_WHITESPACE"," ",2268],["T_STRING","null",2268],";",["T_WHITESPACE","\n        ",2268],["T_VARIABLE","$this",2269],["T_OBJECT_OPERATOR","->",2269],["T_STRING","_tracks",2269],["T_WHITESPACE"," ",2269],"=",["T_WHITESPACE"," ",2269],["T_STRING","null",2269],";",["T_WHITESPACE","\n        ",2269],["T_VARIABLE","$this",2270],["T_OBJECT_OPERATOR","->",2270],["T_STRING","_shipments",2270],["T_WHITESPACE"," ",2270],"=",["T_WHITESPACE"," ",2270],["T_STRING","null",2270],";",["T_WHITESPACE","\n        ",2270],["T_VARIABLE","$this",2271],["T_OBJECT_OPERATOR","->",2271],["T_STRING","_creditmemos",2271],["T_WHITESPACE"," ",2271],"=",["T_WHITESPACE"," ",2271],["T_STRING","null",2271],";",["T_WHITESPACE","\n        ",2271],["T_VARIABLE","$this",2272],["T_OBJECT_OPERATOR","->",2272],["T_STRING","_relatedObjects",2272],["T_WHITESPACE"," ",2272],"=",["T_WHITESPACE"," ",2272],["T_ARRAY","array",2272],"(",")",";",["T_WHITESPACE","\n        ",2272],["T_VARIABLE","$this",2273],["T_OBJECT_OPERATOR","->",2273],["T_STRING","_orderCurrency",2273],["T_WHITESPACE"," ",2273],"=",["T_WHITESPACE"," ",2273],["T_STRING","null",2273],";",["T_WHITESPACE","\n        ",2273],["T_VARIABLE","$this",2274],["T_OBJECT_OPERATOR","->",2274],["T_STRING","_baseCurrency",2274],["T_WHITESPACE"," ",2274],"=",["T_WHITESPACE"," ",2274],["T_STRING","null",2274],";",["T_WHITESPACE","\n\n        ",2274],["T_RETURN","return",2276],["T_WHITESPACE"," ",2276],["T_VARIABLE","$this",2276],";",["T_WHITESPACE","\n    ",2276],"}",["T_WHITESPACE","\n\n    ",2277],["T_PUBLIC","public",2279],["T_WHITESPACE"," ",2279],["T_FUNCTION","function",2279],["T_WHITESPACE"," ",2279],["T_STRING","getIsNotVirtual",2279],"(",")",["T_WHITESPACE","\n    ",2279],"{",["T_WHITESPACE","\n        ",2280],["T_RETURN","return",2281],["T_WHITESPACE"," ",2281],"!",["T_VARIABLE","$this",2281],["T_OBJECT_OPERATOR","->",2281],["T_STRING","getIsVirtual",2281],"(",")",";",["T_WHITESPACE","\n    ",2281],"}",["T_WHITESPACE","\n\n    ",2282],["T_PUBLIC","public",2284],["T_WHITESPACE"," ",2284],["T_FUNCTION","function",2284],["T_WHITESPACE"," ",2284],["T_STRING","getFullTaxInfo",2284],"(",")",["T_WHITESPACE","\n    ",2284],"{",["T_WHITESPACE","\n        ",2285],["T_VARIABLE","$rates",2286],["T_WHITESPACE"," ",2286],"=",["T_WHITESPACE"," ",2286],["T_STRING","Mage",2286],["T_DOUBLE_COLON","::",2286],["T_STRING","getModel",2286],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/sales_order_tax'",2286],")",["T_OBJECT_OPERATOR","->",2286],["T_STRING","getCollection",2286],"(",")",["T_OBJECT_OPERATOR","->",2286],["T_STRING","loadByOrder",2286],"(",["T_VARIABLE","$this",2286],")",["T_OBJECT_OPERATOR","->",2286],["T_STRING","toArray",2286],"(",")",";",["T_WHITESPACE","\n        ",2286],["T_RETURN","return",2287],["T_WHITESPACE"," ",2287],["T_STRING","Mage",2287],["T_DOUBLE_COLON","::",2287],["T_STRING","getSingleton",2287],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",2287],")",["T_OBJECT_OPERATOR","->",2287],["T_STRING","reproduceProcess",2287],"(",["T_VARIABLE","$rates",2287],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",2287],"]",")",";",["T_WHITESPACE","\n    ",2287],"}",["T_WHITESPACE","\n\n    ",2288],["T_DOC_COMMENT","\/**\n     * Create new invoice with maximum qty for invoice for each item\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",2290],["T_WHITESPACE","\n    ",2294],["T_PUBLIC","public",2295],["T_WHITESPACE"," ",2295],["T_FUNCTION","function",2295],["T_WHITESPACE"," ",2295],["T_STRING","prepareInvoice",2295],"(",["T_VARIABLE","$qtys",2295],["T_WHITESPACE"," ",2295],"=",["T_WHITESPACE"," ",2295],["T_ARRAY","array",2295],"(",")",")",["T_WHITESPACE","\n    ",2295],"{",["T_WHITESPACE","\n        ",2296],["T_VARIABLE","$invoice",2297],["T_WHITESPACE"," ",2297],"=",["T_WHITESPACE"," ",2297],["T_STRING","Mage",2297],["T_DOUBLE_COLON","::",2297],["T_STRING","getModel",2297],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_order'",2297],",",["T_WHITESPACE"," ",2297],["T_VARIABLE","$this",2297],")",["T_OBJECT_OPERATOR","->",2297],["T_STRING","prepareInvoice",2297],"(",["T_VARIABLE","$qtys",2297],")",";",["T_WHITESPACE","\n        ",2297],["T_RETURN","return",2298],["T_WHITESPACE"," ",2298],["T_VARIABLE","$invoice",2298],";",["T_WHITESPACE","\n    ",2298],"}",["T_WHITESPACE","\n\n    ",2299],["T_DOC_COMMENT","\/**\n     * Create new shipment with maximum qty for shipping for each item\n     *\n     * @return Mage_Sales_Model_Order_Shipment\n     *\/",2301],["T_WHITESPACE","\n    ",2305],["T_PUBLIC","public",2306],["T_WHITESPACE"," ",2306],["T_FUNCTION","function",2306],["T_WHITESPACE"," ",2306],["T_STRING","prepareShipment",2306],"(",["T_VARIABLE","$qtys",2306],["T_WHITESPACE"," ",2306],"=",["T_WHITESPACE"," ",2306],["T_ARRAY","array",2306],"(",")",")",["T_WHITESPACE","\n    ",2306],"{",["T_WHITESPACE","\n        ",2307],["T_VARIABLE","$shipment",2308],["T_WHITESPACE"," ",2308],"=",["T_WHITESPACE"," ",2308],["T_STRING","Mage",2308],["T_DOUBLE_COLON","::",2308],["T_STRING","getModel",2308],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/service_order'",2308],",",["T_WHITESPACE"," ",2308],["T_VARIABLE","$this",2308],")",["T_OBJECT_OPERATOR","->",2308],["T_STRING","prepareShipment",2308],"(",["T_VARIABLE","$qtys",2308],")",";",["T_WHITESPACE","\n        ",2308],["T_RETURN","return",2309],["T_WHITESPACE"," ",2309],["T_VARIABLE","$shipment",2309],";",["T_WHITESPACE","\n    ",2309],"}",["T_WHITESPACE","\n\n    ",2310],["T_DOC_COMMENT","\/**\n     * Check whether order is canceled\n     *\n     * @return bool\n     *\/",2312],["T_WHITESPACE","\n    ",2316],["T_PUBLIC","public",2317],["T_WHITESPACE"," ",2317],["T_FUNCTION","function",2317],["T_WHITESPACE"," ",2317],["T_STRING","isCanceled",2317],"(",")",["T_WHITESPACE","\n    ",2317],"{",["T_WHITESPACE","\n        ",2318],["T_RETURN","return",2319],["T_WHITESPACE"," ",2319],"(",["T_VARIABLE","$this",2319],["T_OBJECT_OPERATOR","->",2319],["T_STRING","getState",2319],"(",")",["T_WHITESPACE"," ",2319],["T_IS_IDENTICAL","===",2319],["T_WHITESPACE"," ",2319],["T_STRING","self",2319],["T_DOUBLE_COLON","::",2319],["T_STRING","STATE_CANCELED",2319],")",";",["T_WHITESPACE","\n    ",2319],"}",["T_WHITESPACE","\n\n    ",2320],["T_DOC_COMMENT","\/**\n     * Protect order delete from not admin scope\n     * @return Mage_Sales_Model_Order\n     *\/",2322],["T_WHITESPACE","\n    ",2325],["T_PROTECTED","protected",2326],["T_WHITESPACE"," ",2326],["T_FUNCTION","function",2326],["T_WHITESPACE"," ",2326],["T_STRING","_beforeDelete",2326],"(",")",["T_WHITESPACE","\n    ",2326],"{",["T_WHITESPACE","\n        ",2327],["T_VARIABLE","$this",2328],["T_OBJECT_OPERATOR","->",2328],["T_STRING","_protectFromNonAdmin",2328],"(",")",";",["T_WHITESPACE","\n        ",2328],["T_RETURN","return",2329],["T_WHITESPACE"," ",2329],["T_STRING","parent",2329],["T_DOUBLE_COLON","::",2329],["T_STRING","_beforeDelete",2329],"(",")",";",["T_WHITESPACE","\n    ",2329],"}",["T_WHITESPACE","\n",2330],"}",["T_WHITESPACE","\n",2331]]