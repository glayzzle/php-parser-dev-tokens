[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Sales order shippment API\n *\n * @category   Mage\n * @package    Mage_Sales\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Sales_Model_Order_Shipment_Api",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Sales_Model_Api_Resource",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_PUBLIC","public",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","__construct",36],"(",")",["T_WHITESPACE","\n    ",36],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","_attributesMap",38],"[",["T_CONSTANT_ENCAPSED_STRING","'shipment'",38],"]",["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",["T_CONSTANT_ENCAPSED_STRING","'shipment_id'",38],["T_WHITESPACE"," ",38],["T_DOUBLE_ARROW","=>",38],["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",38],")",";",["T_WHITESPACE","\n\n        ",38],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","_attributesMap",40],"[",["T_CONSTANT_ENCAPSED_STRING","'shipment_item'",40],"]",["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_ARRAY","array",40],"(",["T_CONSTANT_ENCAPSED_STRING","'item_id'",40],["T_WHITESPACE","    ",40],["T_DOUBLE_ARROW","=>",40],["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",40],")",";",["T_WHITESPACE","\n\n        ",40],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","_attributesMap",42],"[",["T_CONSTANT_ENCAPSED_STRING","'shipment_comment'",42],"]",["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_ARRAY","array",42],"(",["T_CONSTANT_ENCAPSED_STRING","'comment_id'",42],["T_WHITESPACE"," ",42],["T_DOUBLE_ARROW","=>",42],["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",42],")",";",["T_WHITESPACE","\n\n        ",42],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","_attributesMap",44],"[",["T_CONSTANT_ENCAPSED_STRING","'shipment_track'",44],"]",["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_ARRAY","array",44],"(",["T_CONSTANT_ENCAPSED_STRING","'track_id'",44],["T_WHITESPACE","   ",44],["T_DOUBLE_ARROW","=>",44],["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",44],")",";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Retrieve shipments by filters\n     *\n     * @param null|object|array $filters\n     * @return array\n     *\/",47],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","items",53],"(",["T_VARIABLE","$filters",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","null",53],")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$shipments",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_ARRAY","array",55],"(",")",";",["T_WHITESPACE","\n        ",55],["T_COMMENT","\/\/TODO: add full name logic\n",56],["T_WHITESPACE","        ",57],["T_VARIABLE","$shipmentCollection",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","Mage",57],["T_DOUBLE_COLON","::",57],["T_STRING","getResourceModel",57],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_collection'",57],")",["T_WHITESPACE","\n            ",57],["T_OBJECT_OPERATOR","->",58],["T_STRING","addAttributeToSelect",58],"(",["T_CONSTANT_ENCAPSED_STRING","'increment_id'",58],")",["T_WHITESPACE","\n            ",58],["T_OBJECT_OPERATOR","->",59],["T_STRING","addAttributeToSelect",59],"(",["T_CONSTANT_ENCAPSED_STRING","'created_at'",59],")",["T_WHITESPACE","\n            ",59],["T_OBJECT_OPERATOR","->",60],["T_STRING","addAttributeToSelect",60],"(",["T_CONSTANT_ENCAPSED_STRING","'total_qty'",60],")",["T_WHITESPACE","\n            ",60],["T_OBJECT_OPERATOR","->",61],["T_STRING","joinAttribute",61],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_firstname'",61],",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'order_address\/firstname'",61],",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'shipping_address_id'",61],",",["T_WHITESPACE"," ",61],["T_STRING","null",61],",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'left'",61],")",["T_WHITESPACE","\n            ",61],["T_OBJECT_OPERATOR","->",62],["T_STRING","joinAttribute",62],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_lastname'",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'order_address\/lastname'",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'shipping_address_id'",62],",",["T_WHITESPACE"," ",62],["T_STRING","null",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'left'",62],")",["T_WHITESPACE","\n            ",62],["T_OBJECT_OPERATOR","->",63],["T_STRING","joinAttribute",63],"(",["T_CONSTANT_ENCAPSED_STRING","'order_increment_id'",63],",",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'order\/increment_id'",63],",",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'order_id'",63],",",["T_WHITESPACE"," ",63],["T_STRING","null",63],",",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'left'",63],")",["T_WHITESPACE","\n            ",63],["T_OBJECT_OPERATOR","->",64],["T_STRING","joinAttribute",64],"(",["T_CONSTANT_ENCAPSED_STRING","'order_created_at'",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'order\/created_at'",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'order_id'",64],",",["T_WHITESPACE"," ",64],["T_STRING","null",64],",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'left'",64],")",";",["T_WHITESPACE","\n\n        ",64],["T_DOC_COMMENT","\/** @var $apiHelper Mage_Api_Helper_Data *\/",66],["T_WHITESPACE","\n        ",66],["T_VARIABLE","$apiHelper",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_STRING","Mage",67],["T_DOUBLE_COLON","::",67],["T_STRING","helper",67],"(",["T_CONSTANT_ENCAPSED_STRING","'api'",67],")",";",["T_WHITESPACE","\n        ",67],["T_TRY","try",68],["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$filters",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$apiHelper",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","parseFilters",69],"(",["T_VARIABLE","$filters",69],",",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_attributesMap",69],"[",["T_CONSTANT_ENCAPSED_STRING","'shipment'",69],"]",")",";",["T_WHITESPACE","\n            ",69],["T_FOREACH","foreach",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$filters",70],["T_WHITESPACE"," ",70],["T_AS","as",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$field",70],["T_WHITESPACE"," ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$value",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$shipmentCollection",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","addFieldToFilter",71],"(",["T_VARIABLE","$field",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$value",71],")",";",["T_WHITESPACE","\n            ",71],"}",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE"," ",73],["T_CATCH","catch",73],["T_WHITESPACE"," ",73],"(",["T_STRING","Mage_Core_Exception",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$e",73],")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_fault",74],"(",["T_CONSTANT_ENCAPSED_STRING","'filters_invalid'",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$e",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getMessage",74],"(",")",")",";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n        ",75],["T_FOREACH","foreach",76],["T_WHITESPACE"," ",76],"(",["T_VARIABLE","$shipmentCollection",76],["T_WHITESPACE"," ",76],["T_AS","as",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$shipment",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$shipments",77],"[","]",["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_getAttributes",77],"(",["T_VARIABLE","$shipment",77],",",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'shipment'",77],")",";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_RETURN","return",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$shipments",80],";",["T_WHITESPACE","\n    ",80],"}",["T_WHITESPACE","\n\n    ",81],["T_DOC_COMMENT","\/**\n     * Retrieve shipment information\n     *\n     * @param string $shipmentIncrementId\n     * @return array\n     *\/",83],["T_WHITESPACE","\n    ",88],["T_PUBLIC","public",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","info",89],"(",["T_VARIABLE","$shipmentIncrementId",89],")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$shipment",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_STRING","Mage",91],["T_DOUBLE_COLON","::",91],["T_STRING","getModel",91],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment'",91],")",["T_OBJECT_OPERATOR","->",91],["T_STRING","loadByIncrementId",91],"(",["T_VARIABLE","$shipmentIncrementId",91],")",";",["T_WHITESPACE","\n\n        ",91],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",93],["T_WHITESPACE","\n\n        ",93],["T_IF","if",95],["T_WHITESPACE"," ",95],"(","!",["T_VARIABLE","$shipment",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getId",95],"(",")",")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_fault",96],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",96],")",";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE","\n\n        ",97],["T_VARIABLE","$result",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_getAttributes",99],"(",["T_VARIABLE","$shipment",99],",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'shipment'",99],")",";",["T_WHITESPACE","\n\n        ",99],["T_VARIABLE","$result",101],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",101],"]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_ARRAY","array",101],"(",")",";",["T_WHITESPACE","\n        ",101],["T_FOREACH","foreach",102],["T_WHITESPACE"," ",102],"(",["T_VARIABLE","$shipment",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getAllItems",102],"(",")",["T_WHITESPACE"," ",102],["T_AS","as",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$item",102],")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$result",103],"[",["T_CONSTANT_ENCAPSED_STRING","'items'",103],"]","[","]",["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_getAttributes",103],"(",["T_VARIABLE","$item",103],",",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'shipment_item'",103],")",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n\n        ",104],["T_VARIABLE","$result",106],"[",["T_CONSTANT_ENCAPSED_STRING","'tracks'",106],"]",["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_ARRAY","array",106],"(",")",";",["T_WHITESPACE","\n        ",106],["T_FOREACH","foreach",107],["T_WHITESPACE"," ",107],"(",["T_VARIABLE","$shipment",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getAllTracks",107],"(",")",["T_WHITESPACE"," ",107],["T_AS","as",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$track",107],")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$result",108],"[",["T_CONSTANT_ENCAPSED_STRING","'tracks'",108],"]","[","]",["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_getAttributes",108],"(",["T_VARIABLE","$track",108],",",["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'shipment_track'",108],")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n\n        ",109],["T_VARIABLE","$result",111],"[",["T_CONSTANT_ENCAPSED_STRING","'comments'",111],"]",["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_ARRAY","array",111],"(",")",";",["T_WHITESPACE","\n        ",111],["T_FOREACH","foreach",112],["T_WHITESPACE"," ",112],"(",["T_VARIABLE","$shipment",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getCommentsCollection",112],"(",")",["T_WHITESPACE"," ",112],["T_AS","as",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$comment",112],")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$result",113],"[",["T_CONSTANT_ENCAPSED_STRING","'comments'",113],"]","[","]",["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_getAttributes",113],"(",["T_VARIABLE","$comment",113],",",["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'shipment_comment'",113],")",";",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n\n        ",114],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$result",116],";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * Create new shipment for order\n     *\n     * @param string $orderIncrementId\n     * @param array $itemsQty\n     * @param string $comment\n     * @param booleam $email\n     * @param boolean $includeComment\n     * @return string\n     *\/",119],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","create",129],"(",["T_VARIABLE","$orderIncrementId",129],",",["T_WHITESPACE"," ",129],["T_VARIABLE","$itemsQty",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_ARRAY","array",129],"(",")",",",["T_WHITESPACE"," ",129],["T_VARIABLE","$comment",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_STRING","null",129],",",["T_WHITESPACE"," ",129],["T_VARIABLE","$email",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_STRING","false",129],",",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$includeComment",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","false",130],["T_WHITESPACE","\n    ",130],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$order",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","Mage",132],["T_DOUBLE_COLON","::",132],["T_STRING","getModel",132],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",132],")",["T_OBJECT_OPERATOR","->",132],["T_STRING","loadByIncrementId",132],"(",["T_VARIABLE","$orderIncrementId",132],")",";",["T_WHITESPACE","\n\n        ",132],["T_DOC_COMMENT","\/**\n          * Check order existing\n          *\/",134],["T_WHITESPACE","\n        ",136],["T_IF","if",137],["T_WHITESPACE"," ",137],"(","!",["T_VARIABLE","$order",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getId",137],"(",")",")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n             ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_fault",138],"(",["T_CONSTANT_ENCAPSED_STRING","'order_not_exists'",138],")",";",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n\n        ",139],["T_DOC_COMMENT","\/**\n         * Check shipment create availability\n         *\/",141],["T_WHITESPACE","\n        ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(","!",["T_VARIABLE","$order",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","canShip",144],"(",")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n             ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_fault",145],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",145],",",["T_WHITESPACE"," ",145],["T_STRING","Mage",145],["T_DOUBLE_COLON","::",145],["T_STRING","helper",145],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",145],")",["T_OBJECT_OPERATOR","->",145],["T_STRING","__",145],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot do shipment for order.'",145],")",")",";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n\n         ",146],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",148],["T_WHITESPACE","\n        ",148],["T_VARIABLE","$shipment",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$order",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","prepareShipment",149],"(",["T_VARIABLE","$itemsQty",149],")",";",["T_WHITESPACE","\n        ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$shipment",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$shipment",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","register",151],"(",")",";",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$shipment",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","addComment",152],"(",["T_VARIABLE","$comment",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$email",152],["T_WHITESPACE"," ",152],["T_BOOLEAN_AND","&&",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$includeComment",152],")",";",["T_WHITESPACE","\n            ",152],["T_IF","if",153],["T_WHITESPACE"," ",153],"(",["T_VARIABLE","$email",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                ",153],["T_VARIABLE","$shipment",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","setEmailSent",154],"(",["T_STRING","true",154],")",";",["T_WHITESPACE","\n            ",154],"}",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$shipment",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getOrder",156],"(",")",["T_OBJECT_OPERATOR","->",156],["T_STRING","setIsInProcess",156],"(",["T_STRING","true",156],")",";",["T_WHITESPACE","\n            ",156],["T_TRY","try",157],["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$transactionSave",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","Mage",158],["T_DOUBLE_COLON","::",158],["T_STRING","getModel",158],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource_transaction'",158],")",["T_WHITESPACE","\n                    ",158],["T_OBJECT_OPERATOR","->",159],["T_STRING","addObject",159],"(",["T_VARIABLE","$shipment",159],")",["T_WHITESPACE","\n                    ",159],["T_OBJECT_OPERATOR","->",160],["T_STRING","addObject",160],"(",["T_VARIABLE","$shipment",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getOrder",160],"(",")",")",["T_WHITESPACE","\n                    ",160],["T_OBJECT_OPERATOR","->",161],["T_STRING","save",161],"(",")",";",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$shipment",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","sendEmail",162],"(",["T_VARIABLE","$email",162],",",["T_WHITESPACE"," ",162],"(",["T_VARIABLE","$includeComment",162],["T_WHITESPACE"," ",162],"?",["T_WHITESPACE"," ",162],["T_VARIABLE","$comment",162],["T_WHITESPACE"," ",162],":",["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","''",162],")",")",";",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE"," ",163],["T_CATCH","catch",163],["T_WHITESPACE"," ",163],"(",["T_STRING","Mage_Core_Exception",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$e",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_fault",164],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$e",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getMessage",164],"(",")",")",";",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE","\n            ",165],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$shipment",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getIncrementId",166],"(",")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_STRING","null",168],";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Add tracking number to order\n     *\n     * @param string $shipmentIncrementId\n     * @param string $carrier\n     * @param string $title\n     * @param string $trackNumber\n     * @return int\n     *\/",171],["T_WHITESPACE","\n    ",179],["T_PUBLIC","public",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","addTrack",180],"(",["T_VARIABLE","$shipmentIncrementId",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$carrier",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$title",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$trackNumber",180],")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$shipment",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","Mage",182],["T_DOUBLE_COLON","::",182],["T_STRING","getModel",182],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment'",182],")",["T_OBJECT_OPERATOR","->",182],["T_STRING","loadByIncrementId",182],"(",["T_VARIABLE","$shipmentIncrementId",182],")",";",["T_WHITESPACE","\n\n        ",182],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",184],["T_WHITESPACE","\n\n        ",184],["T_IF","if",186],["T_WHITESPACE"," ",186],"(","!",["T_VARIABLE","$shipment",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getId",186],"(",")",")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_fault",187],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",187],")",";",["T_WHITESPACE","\n        ",187],"}",["T_WHITESPACE","\n\n        ",188],["T_VARIABLE","$carriers",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","_getCarriers",190],"(",["T_VARIABLE","$shipment",190],")",";",["T_WHITESPACE","\n\n        ",190],["T_IF","if",192],["T_WHITESPACE"," ",192],"(","!",["T_ISSET","isset",192],"(",["T_VARIABLE","$carriers",192],"[",["T_VARIABLE","$carrier",192],"]",")",")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_fault",193],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",193],",",["T_WHITESPACE"," ",193],["T_STRING","Mage",193],["T_DOUBLE_COLON","::",193],["T_STRING","helper",193],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",193],")",["T_OBJECT_OPERATOR","->",193],["T_STRING","__",193],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid carrier specified.'",193],")",")",";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n\n        ",194],["T_VARIABLE","$track",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_STRING","Mage",196],["T_DOUBLE_COLON","::",196],["T_STRING","getModel",196],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment_track'",196],")",["T_WHITESPACE","\n                    ",196],["T_OBJECT_OPERATOR","->",197],["T_STRING","setNumber",197],"(",["T_VARIABLE","$trackNumber",197],")",["T_WHITESPACE","\n                    ",197],["T_OBJECT_OPERATOR","->",198],["T_STRING","setCarrierCode",198],"(",["T_VARIABLE","$carrier",198],")",["T_WHITESPACE","\n                    ",198],["T_OBJECT_OPERATOR","->",199],["T_STRING","setTitle",199],"(",["T_VARIABLE","$title",199],")",";",["T_WHITESPACE","\n\n        ",199],["T_VARIABLE","$shipment",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","addTrack",201],"(",["T_VARIABLE","$track",201],")",";",["T_WHITESPACE","\n\n        ",201],["T_TRY","try",203],["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$shipment",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","save",204],"(",")",";",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$track",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","save",205],"(",")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE"," ",206],["T_CATCH","catch",206],["T_WHITESPACE"," ",206],"(",["T_STRING","Mage_Core_Exception",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$e",206],")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_fault",207],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$e",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getMessage",207],"(",")",")",";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n\n        ",208],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$track",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getId",210],"(",")",";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Remove tracking number\n     *\n     * @param string $shipmentIncrementId\n     * @param int $trackId\n     * @return boolean\n     *\/",213],["T_WHITESPACE","\n    ",219],["T_PUBLIC","public",220],["T_WHITESPACE"," ",220],["T_FUNCTION","function",220],["T_WHITESPACE"," ",220],["T_STRING","removeTrack",220],"(",["T_VARIABLE","$shipmentIncrementId",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$trackId",220],")",["T_WHITESPACE","\n    ",220],"{",["T_WHITESPACE","\n        ",221],["T_VARIABLE","$shipment",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_STRING","Mage",222],["T_DOUBLE_COLON","::",222],["T_STRING","getModel",222],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment'",222],")",["T_OBJECT_OPERATOR","->",222],["T_STRING","loadByIncrementId",222],"(",["T_VARIABLE","$shipmentIncrementId",222],")",";",["T_WHITESPACE","\n\n        ",222],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",224],["T_WHITESPACE","\n\n        ",224],["T_IF","if",226],["T_WHITESPACE"," ",226],"(","!",["T_VARIABLE","$shipment",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getId",226],"(",")",")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n            ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_fault",227],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",227],")",";",["T_WHITESPACE","\n        ",227],"}",["T_WHITESPACE","\n\n        ",228],["T_IF","if",230],"(","!",["T_VARIABLE","$track",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$shipment",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getTrackById",230],"(",["T_VARIABLE","$trackId",230],")",")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_fault",231],"(",["T_CONSTANT_ENCAPSED_STRING","'track_not_exists'",231],")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_TRY","try",234],["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$track",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","delete",235],"(",")",";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE"," ",236],["T_CATCH","catch",236],["T_WHITESPACE"," ",236],"(",["T_STRING","Mage_Core_Exception",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$e",236],")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_fault",237],"(",["T_CONSTANT_ENCAPSED_STRING","'track_not_deleted'",237],",",["T_WHITESPACE"," ",237],["T_VARIABLE","$e",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getMessage",237],"(",")",")",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n\n        ",238],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_STRING","true",240],";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n\n    ",241],["T_DOC_COMMENT","\/**\n     * Send email with shipment data to customer\n     *\n     * @param string $shipmentIncrementId\n     * @param string $comment\n     * @return bool\n     *\/",243],["T_WHITESPACE","\n    ",249],["T_PUBLIC","public",250],["T_WHITESPACE"," ",250],["T_FUNCTION","function",250],["T_WHITESPACE"," ",250],["T_STRING","sendInfo",250],"(",["T_VARIABLE","$shipmentIncrementId",250],",",["T_WHITESPACE"," ",250],["T_VARIABLE","$comment",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","''",250],")",["T_WHITESPACE","\n    ",250],"{",["T_WHITESPACE","\n        ",251],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",252],["T_WHITESPACE","\n        ",252],["T_VARIABLE","$shipment",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_STRING","Mage",253],["T_DOUBLE_COLON","::",253],["T_STRING","getModel",253],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment'",253],")",["T_OBJECT_OPERATOR","->",253],["T_STRING","loadByIncrementId",253],"(",["T_VARIABLE","$shipmentIncrementId",253],")",";",["T_WHITESPACE","\n\n        ",253],["T_IF","if",255],["T_WHITESPACE"," ",255],"(","!",["T_VARIABLE","$shipment",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getId",255],"(",")",")",["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n            ",255],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_fault",256],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",256],")",";",["T_WHITESPACE","\n        ",256],"}",["T_WHITESPACE","\n\n        ",257],["T_TRY","try",259],["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n            ",259],["T_VARIABLE","$shipment",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","sendEmail",260],"(",["T_STRING","true",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$comment",260],")",["T_WHITESPACE","\n                ",260],["T_OBJECT_OPERATOR","->",261],["T_STRING","setEmailSent",261],"(",["T_STRING","true",261],")",["T_WHITESPACE","\n                ",261],["T_OBJECT_OPERATOR","->",262],["T_STRING","save",262],"(",")",";",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$historyItem",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_STRING","Mage",263],["T_DOUBLE_COLON","::",263],["T_STRING","getResourceModel",263],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_status_history_collection'",263],")",["T_WHITESPACE","\n                ",263],["T_OBJECT_OPERATOR","->",264],["T_STRING","getUnnotifiedForInstance",264],"(",["T_VARIABLE","$shipment",264],",",["T_WHITESPACE"," ",264],["T_STRING","Mage_Sales_Model_Order_Shipment",264],["T_DOUBLE_COLON","::",264],["T_STRING","HISTORY_ENTITY_NAME",264],")",";",["T_WHITESPACE","\n            ",264],["T_IF","if",265],["T_WHITESPACE"," ",265],"(",["T_VARIABLE","$historyItem",265],")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n                ",265],["T_VARIABLE","$historyItem",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","setIsCustomerNotified",266],"(",["T_LNUMBER","1",266],")",";",["T_WHITESPACE","\n                ",266],["T_VARIABLE","$historyItem",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","save",267],"(",")",";",["T_WHITESPACE","\n            ",267],"}",["T_WHITESPACE","\n        ",268],"}",["T_WHITESPACE"," ",269],["T_CATCH","catch",269],["T_WHITESPACE"," ",269],"(",["T_STRING","Mage_Core_Exception",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$e",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_fault",270],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",270],",",["T_WHITESPACE"," ",270],["T_VARIABLE","$e",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getMessage",270],"(",")",")",";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n\n        ",271],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_STRING","true",273],";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Retrieve tracking number info\n     *\n     * @param string $shipmentIncrementId\n     * @param int $trackId\n     * @return mixed\n     *\/",276],["T_WHITESPACE","\n    ",282],["T_PUBLIC","public",283],["T_WHITESPACE"," ",283],["T_FUNCTION","function",283],["T_WHITESPACE"," ",283],["T_STRING","infoTrack",283],"(",["T_VARIABLE","$shipmentIncrementId",283],",",["T_WHITESPACE"," ",283],["T_VARIABLE","$trackId",283],")",["T_WHITESPACE","\n    ",283],"{",["T_WHITESPACE","\n         ",284],["T_VARIABLE","$shipment",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_STRING","Mage",285],["T_DOUBLE_COLON","::",285],["T_STRING","getModel",285],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment'",285],")",["T_OBJECT_OPERATOR","->",285],["T_STRING","loadByIncrementId",285],"(",["T_VARIABLE","$shipmentIncrementId",285],")",";",["T_WHITESPACE","\n\n        ",285],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",287],["T_WHITESPACE","\n\n        ",287],["T_IF","if",289],["T_WHITESPACE"," ",289],"(","!",["T_VARIABLE","$shipment",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getId",289],"(",")",")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_fault",290],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",290],")",";",["T_WHITESPACE","\n        ",290],"}",["T_WHITESPACE","\n\n        ",291],["T_IF","if",293],"(","!",["T_VARIABLE","$track",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$shipment",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","getTrackById",293],"(",["T_VARIABLE","$trackId",293],")",")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n            ",293],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","_fault",294],"(",["T_CONSTANT_ENCAPSED_STRING","'track_not_exists'",294],")",";",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE","\n\n        ",295],["T_COMMENT","\/* @var $track Mage_Sales_Model_Order_Shipment_Track *\/",297],["T_WHITESPACE","\n        ",297],["T_VARIABLE","$info",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$track",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getNumberDetail",298],"(",")",";",["T_WHITESPACE","\n\n        ",298],["T_IF","if",300],["T_WHITESPACE"," ",300],"(",["T_STRING","is_object",300],"(",["T_VARIABLE","$info",300],")",")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$info",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$info",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","toArray",301],"(",")",";",["T_WHITESPACE","\n        ",301],"}",["T_WHITESPACE","\n\n        ",302],["T_RETURN","return",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$info",304],";",["T_WHITESPACE","\n    ",304],"}",["T_WHITESPACE","\n\n    ",305],["T_DOC_COMMENT","\/**\n     * Add comment to shipment\n     *\n     * @param string $shipmentIncrementId\n     * @param string $comment\n     * @param boolean $email\n     * @param boolean $includeInEmail\n     * @return boolean\n     *\/",307],["T_WHITESPACE","\n    ",315],["T_PUBLIC","public",316],["T_WHITESPACE"," ",316],["T_FUNCTION","function",316],["T_WHITESPACE"," ",316],["T_STRING","addComment",316],"(",["T_VARIABLE","$shipmentIncrementId",316],",",["T_WHITESPACE"," ",316],["T_VARIABLE","$comment",316],",",["T_WHITESPACE"," ",316],["T_VARIABLE","$email",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_STRING","false",316],",",["T_WHITESPACE"," ",316],["T_VARIABLE","$includeInEmail",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_STRING","false",316],")",["T_WHITESPACE","\n    ",316],"{",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$shipment",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_STRING","Mage",318],["T_DOUBLE_COLON","::",318],["T_STRING","getModel",318],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_shipment'",318],")",["T_OBJECT_OPERATOR","->",318],["T_STRING","loadByIncrementId",318],"(",["T_VARIABLE","$shipmentIncrementId",318],")",";",["T_WHITESPACE","\n\n        ",318],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",320],["T_WHITESPACE","\n\n        ",320],["T_IF","if",322],["T_WHITESPACE"," ",322],"(","!",["T_VARIABLE","$shipment",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getId",322],"(",")",")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n            ",322],["T_VARIABLE","$this",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","_fault",323],"(",["T_CONSTANT_ENCAPSED_STRING","'not_exists'",323],")",";",["T_WHITESPACE","\n        ",323],"}",["T_WHITESPACE","\n\n\n        ",324],["T_TRY","try",327],["T_WHITESPACE"," ",327],"{",["T_WHITESPACE","\n            ",327],["T_VARIABLE","$shipment",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","addComment",328],"(",["T_VARIABLE","$comment",328],",",["T_WHITESPACE"," ",328],["T_VARIABLE","$email",328],")",";",["T_WHITESPACE","\n            ",328],["T_VARIABLE","$shipment",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","sendUpdateEmail",329],"(",["T_VARIABLE","$email",329],",",["T_WHITESPACE"," ",329],"(",["T_VARIABLE","$includeInEmail",329],["T_WHITESPACE"," ",329],"?",["T_WHITESPACE"," ",329],["T_VARIABLE","$comment",329],["T_WHITESPACE"," ",329],":",["T_WHITESPACE"," ",329],["T_CONSTANT_ENCAPSED_STRING","''",329],")",")",";",["T_WHITESPACE","\n            ",329],["T_VARIABLE","$shipment",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","save",330],"(",")",";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE"," ",331],["T_CATCH","catch",331],["T_WHITESPACE"," ",331],"(",["T_STRING","Mage_Core_Exception",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$e",331],")",["T_WHITESPACE"," ",331],"{",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","_fault",332],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$e",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getMessage",332],"(",")",")",";",["T_WHITESPACE","\n        ",332],"}",["T_WHITESPACE","\n\n        ",333],["T_RETURN","return",335],["T_WHITESPACE"," ",335],["T_STRING","true",335],";",["T_WHITESPACE","\n    ",335],"}",["T_WHITESPACE","\n\n    ",336],["T_DOC_COMMENT","\/**\n     * Retrieve allowed shipping carriers for specified order\n     *\n     * @param string $orderIncrementId\n     * @return array\n     *\/",338],["T_WHITESPACE","\n    ",343],["T_PUBLIC","public",344],["T_WHITESPACE"," ",344],["T_FUNCTION","function",344],["T_WHITESPACE"," ",344],["T_STRING","getCarriers",344],"(",["T_VARIABLE","$orderIncrementId",344],")",["T_WHITESPACE","\n    ",344],"{",["T_WHITESPACE","\n        ",345],["T_VARIABLE","$order",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_STRING","Mage",346],["T_DOUBLE_COLON","::",346],["T_STRING","getModel",346],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",346],")",["T_OBJECT_OPERATOR","->",346],["T_STRING","loadByIncrementId",346],"(",["T_VARIABLE","$orderIncrementId",346],")",";",["T_WHITESPACE","\n\n        ",346],["T_DOC_COMMENT","\/**\n          * Check order existing\n          *\/",348],["T_WHITESPACE","\n        ",350],["T_IF","if",351],["T_WHITESPACE"," ",351],"(","!",["T_VARIABLE","$order",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getId",351],"(",")",")",["T_WHITESPACE"," ",351],"{",["T_WHITESPACE","\n            ",351],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","_fault",352],"(",["T_CONSTANT_ENCAPSED_STRING","'order_not_exists'",352],")",";",["T_WHITESPACE","\n        ",352],"}",["T_WHITESPACE","\n\n        ",353],["T_RETURN","return",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","_getCarriers",355],"(",["T_VARIABLE","$order",355],")",";",["T_WHITESPACE","\n    ",355],"}",["T_WHITESPACE","\n\n    ",356],["T_DOC_COMMENT","\/**\n     * Retrieve shipping carriers for specified order\n     *\n     * @param Mage_Eav_Model_Entity_Abstract $object\n     * @return array\n     *\/",358],["T_WHITESPACE","\n    ",363],["T_PROTECTED","protected",364],["T_WHITESPACE"," ",364],["T_FUNCTION","function",364],["T_WHITESPACE"," ",364],["T_STRING","_getCarriers",364],"(",["T_VARIABLE","$object",364],")",["T_WHITESPACE","\n    ",364],"{",["T_WHITESPACE","\n        ",365],["T_VARIABLE","$carriers",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_ARRAY","array",366],"(",")",";",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$carrierInstances",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_STRING","Mage",367],["T_DOUBLE_COLON","::",367],["T_STRING","getSingleton",367],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping\/config'",367],")",["T_OBJECT_OPERATOR","->",367],["T_STRING","getAllCarriers",367],"(",["T_WHITESPACE","\n            ",367],["T_VARIABLE","$object",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getStoreId",368],"(",")",["T_WHITESPACE","\n        ",368],")",";",["T_WHITESPACE","\n\n        ",369],["T_VARIABLE","$carriers",371],"[",["T_CONSTANT_ENCAPSED_STRING","'custom'",371],"]",["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_STRING","Mage",371],["T_DOUBLE_COLON","::",371],["T_STRING","helper",371],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",371],")",["T_OBJECT_OPERATOR","->",371],["T_STRING","__",371],"(",["T_CONSTANT_ENCAPSED_STRING","'Custom Value'",371],")",";",["T_WHITESPACE","\n        ",371],["T_FOREACH","foreach",372],["T_WHITESPACE"," ",372],"(",["T_VARIABLE","$carrierInstances",372],["T_WHITESPACE"," ",372],["T_AS","as",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$code",372],["T_WHITESPACE"," ",372],["T_DOUBLE_ARROW","=>",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$carrier",372],")",["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n            ",372],["T_IF","if",373],["T_WHITESPACE"," ",373],"(",["T_VARIABLE","$carrier",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","isTrackingAvailable",373],"(",")",")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n                ",373],["T_VARIABLE","$carriers",374],"[",["T_VARIABLE","$code",374],"]",["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_VARIABLE","$carrier",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getConfigData",374],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",374],")",";",["T_WHITESPACE","\n            ",374],"}",["T_WHITESPACE","\n        ",375],"}",["T_WHITESPACE","\n\n        ",376],["T_RETURN","return",378],["T_WHITESPACE"," ",378],["T_VARIABLE","$carriers",378],";",["T_WHITESPACE","\n    ",378],"}",["T_WHITESPACE","\n\n",379],"}",["T_WHITESPACE"," ",381],["T_COMMENT","\/\/ Class Mage_Sales_Model_Order_Shipment_Api End\n",381]]