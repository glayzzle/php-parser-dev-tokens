[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Quote resource model\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Quote",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Initialize table nad PK name\n     *\n     *\/",37],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_init",43],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Retrieve select object for load object data\n     *\n     * @param string $field\n     * @param mixed $value\n     * @param Mage_Core_Model_Abstract $object\n     * @return Varien_Db_Select\n     *\/",46],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","_getLoadSelect",54],"(",["T_VARIABLE","$field",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$value",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$object",54],")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$select",56],["T_WHITESPACE","   ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","parent",56],["T_DOUBLE_COLON","::",56],["T_STRING","_getLoadSelect",56],"(",["T_VARIABLE","$field",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$value",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$object",56],")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$storeIds",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$object",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getSharedStoreIds",57],"(",")",";",["T_WHITESPACE","\n        ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_VARIABLE","$storeIds",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n            ",58],["T_VARIABLE","$select",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","where",59],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id IN (?)'",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$storeIds",59],")",";",["T_WHITESPACE","\n        ",59],"}",["T_WHITESPACE"," ",60],["T_ELSE","else",60],["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n            ",60],["T_DOC_COMMENT","\/**\n             * For empty result\n             *\/",61],["T_WHITESPACE","\n            ",63],["T_VARIABLE","$select",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","where",64],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id < ?'",64],",",["T_WHITESPACE"," ",64],["T_LNUMBER","0",64],")",";",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE","\n\n        ",65],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$select",67],";",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Load quote data by customer identifier\n     *\n     * @param Mage_Sales_Model_Quote $quote\n     * @param int $customerId\n     * @return Mage_Sales_Model_Resource_Quote\n     *\/",70],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","loadByCustomerId",77],"(",["T_VARIABLE","$quote",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$customerId",77],")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$adapter",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_getReadAdapter",79],"(",")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$select",80],["T_WHITESPACE","  ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_getLoadSelect",80],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$customerId",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$quote",80],")",["T_WHITESPACE","\n            ",80],["T_OBJECT_OPERATOR","->",81],["T_STRING","where",81],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active = ?'",81],",",["T_WHITESPACE"," ",81],["T_LNUMBER","1",81],")",["T_WHITESPACE","\n            ",81],["T_OBJECT_OPERATOR","->",82],["T_STRING","order",82],"(",["T_CONSTANT_ENCAPSED_STRING","'updated_at '",82],["T_WHITESPACE"," ",82],".",["T_WHITESPACE"," ",82],["T_STRING","Varien_Db_Select",82],["T_DOUBLE_COLON","::",82],["T_STRING","SQL_DESC",82],")",["T_WHITESPACE","\n            ",82],["T_OBJECT_OPERATOR","->",83],["T_STRING","limit",83],"(",["T_LNUMBER","1",83],")",";",["T_WHITESPACE","\n\n        ",83],["T_VARIABLE","$data",85],["T_WHITESPACE","    ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$adapter",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","fetchRow",85],"(",["T_VARIABLE","$select",85],")",";",["T_WHITESPACE","\n\n        ",85],["T_IF","if",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$data",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$quote",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","setData",88],"(",["T_VARIABLE","$data",88],")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n\n        ",89],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_afterLoad",91],"(",["T_VARIABLE","$quote",91],")",";",["T_WHITESPACE","\n\n        ",91],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Load only active quote\n     *\n     * @param Mage_Sales_Model_Quote $quote\n     * @param int $quoteId\n     * @return Mage_Sales_Model_Resource_Quote\n     *\/",96],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","loadActive",103],"(",["T_VARIABLE","$quote",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$quoteId",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$adapter",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_getReadAdapter",105],"(",")",";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$select",106],["T_WHITESPACE","  ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_getLoadSelect",106],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$quoteId",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$quote",106],")",["T_WHITESPACE","\n            ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","where",107],"(",["T_CONSTANT_ENCAPSED_STRING","'is_active = ?'",107],",",["T_WHITESPACE"," ",107],["T_LNUMBER","1",107],")",";",["T_WHITESPACE","\n\n        ",107],["T_VARIABLE","$data",109],["T_WHITESPACE","    ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$adapter",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","fetchRow",109],"(",["T_VARIABLE","$select",109],")",";",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$data",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$quote",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","setData",111],"(",["T_VARIABLE","$data",111],")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n\n        ",112],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_afterLoad",114],"(",["T_VARIABLE","$quote",114],")",";",["T_WHITESPACE","\n\n        ",114],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * Load quote data by identifier without store\n     *\n     * @param Mage_Sales_Model_Quote $quote\n     * @param int $quoteId\n     * @return Mage_Sales_Model_Resource_Quote\n     *\/",119],["T_WHITESPACE","\n    ",125],["T_PUBLIC","public",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","loadByIdWithoutStore",126],"(",["T_VARIABLE","$quote",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$quoteId",126],")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$read",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_getReadAdapter",128],"(",")",";",["T_WHITESPACE","\n        ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$read",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$select",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","parent",130],["T_DOUBLE_COLON","::",130],["T_STRING","_getLoadSelect",130],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$quoteId",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$quote",130],")",";",["T_WHITESPACE","\n\n            ",130],["T_VARIABLE","$data",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$read",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","fetchRow",132],"(",["T_VARIABLE","$select",132],")",";",["T_WHITESPACE","\n\n            ",132],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$data",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$quote",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","setData",135],"(",["T_VARIABLE","$data",135],")",";",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n\n        ",137],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_afterLoad",139],"(",["T_VARIABLE","$quote",139],")",";",["T_WHITESPACE","\n        ",139],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Get reserved order id\n     *\n     * @param Mage_Sales_Model_Quote $quote\n     * @return string\n     *\/",143],["T_WHITESPACE","\n    ",148],["T_PUBLIC","public",149],["T_WHITESPACE"," ",149],["T_FUNCTION","function",149],["T_WHITESPACE"," ",149],["T_STRING","getReservedOrderId",149],"(",["T_VARIABLE","$quote",149],")",["T_WHITESPACE","\n    ",149],"{",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$storeId",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_INT_CAST","(int)",151],["T_VARIABLE","$quote",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getStoreId",151],"(",")",";",["T_WHITESPACE","\n        ",151],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_STRING","Mage",152],["T_DOUBLE_COLON","::",152],["T_STRING","getSingleton",152],"(",["T_CONSTANT_ENCAPSED_STRING","'eav\/config'",152],")",["T_OBJECT_OPERATOR","->",152],["T_STRING","getEntityType",152],"(",["T_STRING","Mage_Sales_Model_Order",152],["T_DOUBLE_COLON","::",152],["T_STRING","ENTITY",152],")",["T_WHITESPACE","\n            ",152],["T_OBJECT_OPERATOR","->",153],["T_STRING","fetchNewIncrementId",153],"(",["T_VARIABLE","$storeId",153],")",";",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * Check is order increment id use in sales\/order table\n     *\n     * @param string $orderIncrementId\n     * @return boolean\n     *\/",156],["T_WHITESPACE","\n    ",161],["T_PUBLIC","public",162],["T_WHITESPACE"," ",162],["T_FUNCTION","function",162],["T_WHITESPACE"," ",162],["T_STRING","isOrderIncrementIdUsed",162],"(",["T_VARIABLE","$orderIncrementId",162],")",["T_WHITESPACE","\n    ",162],"{",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$adapter",164],["T_WHITESPACE","   ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_getReadAdapter",164],"(",")",";",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$bind",165],["T_WHITESPACE","      ",165],"=",["T_WHITESPACE"," ",165],["T_ARRAY","array",165],"(",["T_CONSTANT_ENCAPSED_STRING","':increment_id'",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$orderIncrementId",165],")",";",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$select",166],["T_WHITESPACE","    ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$adapter",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","select",166],"(",")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$select",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","from",167],"(",["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getTable",167],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",167],")",",",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",167],")",["T_WHITESPACE","\n            ",167],["T_OBJECT_OPERATOR","->",168],["T_STRING","where",168],"(",["T_CONSTANT_ENCAPSED_STRING","'increment_id = :increment_id'",168],")",";",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$entity_id",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$adapter",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","fetchOne",169],"(",["T_VARIABLE","$select",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$bind",169],")",";",["T_WHITESPACE","\n        ",169],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_VARIABLE","$entity_id",170],["T_WHITESPACE"," ",170],">",["T_WHITESPACE"," ",170],["T_LNUMBER","0",170],")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_STRING","true",171],";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n\n        ",172],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_STRING","false",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Mark quotes - that depend on catalog price rules - to be recollected on demand\n     *\n     *  @param  array|null $productIdList\n     *\n     * @return Mage_Sales_Model_Resource_Quote\n     *\/",177],["T_WHITESPACE","\n    ",183],["T_PUBLIC","public",184],["T_WHITESPACE"," ",184],["T_FUNCTION","function",184],["T_WHITESPACE"," ",184],["T_STRING","markQuotesRecollectByAffectedProduct",184],"(",["T_VARIABLE","$productIdList",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","null",184],")",["T_WHITESPACE","\n    ",184],"{",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$writeAdapter",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","_getWriteAdapter",186],"(",")",";",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$select",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$writeAdapter",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","select",187],"(",")",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$subSelect",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_CLONE","clone",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$select",188],";",["T_WHITESPACE","\n\n        ",188],["T_VARIABLE","$subSelect",190],["T_WHITESPACE","\n            ",190],["T_OBJECT_OPERATOR","->",191],["T_STRING","distinct",191],"(",")",["T_WHITESPACE","\n            ",191],["T_OBJECT_OPERATOR","->",192],["T_STRING","from",192],"(",["T_WHITESPACE","\n                   ",192],["T_ARRAY","array",193],"(",["T_CONSTANT_ENCAPSED_STRING","'qi'",193],["T_WHITESPACE"," ",193],["T_DOUBLE_ARROW","=>",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getTable",193],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_item'",193],")",")",",",["T_WHITESPACE","\n                   ",193],["T_ARRAY","array",194],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_CONSTANT_ENCAPSED_STRING","'quote_id'",194],")",")",["T_WHITESPACE","\n            ",194],["T_OBJECT_OPERATOR","->",195],["T_STRING","join",195],"(",["T_WHITESPACE","\n                   ",195],["T_ARRAY","array",196],"(",["T_CONSTANT_ENCAPSED_STRING","'pp'",196],["T_WHITESPACE"," ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getTable",196],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogrule\/rule_product_price'",196],")",")",",",["T_WHITESPACE","\n                   ",196],["T_CONSTANT_ENCAPSED_STRING","'qi.product_id = pp.product_id'",197],",",["T_WHITESPACE","\n                   ",197],["T_ARRAY","array",198],"(",")",")",";",["T_WHITESPACE","\n        ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$productIdList",199],["T_WHITESPACE"," ",199],["T_IS_NOT_IDENTICAL","!==",199],["T_WHITESPACE"," ",199],["T_STRING","null",199],")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n           ",199],["T_VARIABLE","$subSelect",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","where",200],"(",["T_CONSTANT_ENCAPSED_STRING","'qi.product_id IN (?)'",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$productIdList",200],")",";",["T_WHITESPACE","\n        ",200],"}",["T_WHITESPACE","\n\n        ",201],["T_VARIABLE","$select",203],["T_WHITESPACE","\n             ",203],["T_OBJECT_OPERATOR","->",204],["T_STRING","join",204],"(",["T_WHITESPACE","\n                    ",204],["T_ARRAY","array",205],"(",["T_CONSTANT_ENCAPSED_STRING","'tmp'",205],["T_WHITESPACE"," ",205],["T_DOUBLE_ARROW","=>",205],["T_WHITESPACE"," ",205],["T_VARIABLE","$subSelect",205],")",",",["T_WHITESPACE","\n                    ",205],["T_CONSTANT_ENCAPSED_STRING","'q.entity_id = tmp.entity_id'",206],",",["T_WHITESPACE","\n                    ",206],["T_ARRAY","array",207],"(",["T_CONSTANT_ENCAPSED_STRING","'trigger_recollect'",207],["T_WHITESPACE"," ",207],["T_DOUBLE_ARROW","=>",207],["T_WHITESPACE"," ",207],["T_NEW","new",207],["T_WHITESPACE"," ",207],["T_STRING","Zend_Db_Expr",207],"(",["T_LNUMBER","1",207],")",")",")",["T_WHITESPACE","\n             ",207],["T_OBJECT_OPERATOR","->",208],["T_STRING","where",208],"(",["T_CONSTANT_ENCAPSED_STRING","'q.is_active = ?'",208],",",["T_WHITESPACE"," ",208],["T_LNUMBER","1",208],")",";",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$sql",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$writeAdapter",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","updateFromSelect",209],"(",["T_VARIABLE","$select",209],",",["T_WHITESPACE"," ",209],["T_ARRAY","array",209],"(",["T_CONSTANT_ENCAPSED_STRING","'q'",209],["T_WHITESPACE"," ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getTable",209],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",209],")",")",")",";",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$writeAdapter",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","query",210],"(",["T_VARIABLE","$sql",210],")",";",["T_WHITESPACE","\n\n        ",210],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * Mark quotes - that depend on catalog price rules - to be recollected on demand\n     *\n     * @return Mage_Sales_Model_Resource_Quote\n     *\/",215],["T_WHITESPACE","\n    ",219],["T_PUBLIC","public",220],["T_WHITESPACE"," ",220],["T_FUNCTION","function",220],["T_WHITESPACE"," ",220],["T_STRING","markQuotesRecollectOnCatalogRules",220],"(",")",["T_WHITESPACE","\n    ",220],"{",["T_WHITESPACE","\n        ",221],["T_RETURN","return",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","markQuotesRecollectByAffectedProduct",222],"(",")",";",["T_WHITESPACE","\n    ",222],"}",["T_WHITESPACE","\n\n    ",223],["T_DOC_COMMENT","\/**\n     * Subtract product from all quotes quantities\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Sales_Model_Resource_Quote\n     *\/",225],["T_WHITESPACE","\n    ",230],["T_PUBLIC","public",231],["T_WHITESPACE"," ",231],["T_FUNCTION","function",231],["T_WHITESPACE"," ",231],["T_STRING","substractProductFromQuotes",231],"(",["T_VARIABLE","$product",231],")",["T_WHITESPACE","\n    ",231],"{",["T_WHITESPACE","\n        ",232],["T_VARIABLE","$productId",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_INT_CAST","(int)",233],["T_VARIABLE","$product",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getId",233],"(",")",";",["T_WHITESPACE","\n        ",233],["T_IF","if",234],["T_WHITESPACE"," ",234],"(","!",["T_VARIABLE","$productId",234],")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],";",["T_WHITESPACE","\n        ",235],"}",["T_WHITESPACE","\n        ",236],["T_VARIABLE","$adapter",237],["T_WHITESPACE","   ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","_getWriteAdapter",237],"(",")",";",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$subSelect",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$adapter",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","select",238],"(",")",";",["T_WHITESPACE","\n\n        ",238],["T_VARIABLE","$subSelect",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","from",240],"(",["T_STRING","false",240],",",["T_WHITESPACE"," ",240],["T_ARRAY","array",240],"(",["T_WHITESPACE","\n            ",240],["T_CONSTANT_ENCAPSED_STRING","'items_qty'",241],["T_WHITESPACE","   ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_NEW","new",241],["T_WHITESPACE"," ",241],["T_STRING","Zend_Db_Expr",241],"(",["T_WHITESPACE","\n                ",241],["T_VARIABLE","$adapter",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","quoteIdentifier",242],"(",["T_CONSTANT_ENCAPSED_STRING","'q.items_qty'",242],")",["T_WHITESPACE"," ",242],".",["T_WHITESPACE"," ",242],["T_CONSTANT_ENCAPSED_STRING","' - '",242],["T_WHITESPACE"," ",242],".",["T_WHITESPACE"," ",242],["T_VARIABLE","$adapter",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","quoteIdentifier",242],"(",["T_CONSTANT_ENCAPSED_STRING","'qi.qty'",242],")",")",",",["T_WHITESPACE","\n            ",242],["T_CONSTANT_ENCAPSED_STRING","'items_count'",243],["T_WHITESPACE"," ",243],["T_DOUBLE_ARROW","=>",243],["T_WHITESPACE"," ",243],["T_NEW","new",243],["T_WHITESPACE"," ",243],["T_STRING","Zend_Db_Expr",243],"(",["T_VARIABLE","$adapter",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","quoteIdentifier",243],"(",["T_CONSTANT_ENCAPSED_STRING","'q.items_count'",243],")",["T_WHITESPACE"," ",243],".",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","' - 1'",243],")",["T_WHITESPACE","\n        ",243],")",")",["T_WHITESPACE","\n        ",244],["T_OBJECT_OPERATOR","->",245],["T_STRING","where",245],"(",["T_CONSTANT_ENCAPSED_STRING","'q.items_count > 0'",245],")",["T_WHITESPACE","\n        ",245],["T_OBJECT_OPERATOR","->",246],["T_STRING","join",246],"(",["T_WHITESPACE","\n            ",246],["T_ARRAY","array",247],"(",["T_CONSTANT_ENCAPSED_STRING","'qi'",247],["T_WHITESPACE"," ",247],["T_DOUBLE_ARROW","=>",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getTable",247],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_item'",247],")",")",",",["T_WHITESPACE","\n            ",247],["T_STRING","implode",248],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",248],",",["T_WHITESPACE"," ",248],["T_ARRAY","array",248],"(",["T_WHITESPACE","\n                ",248],["T_CONSTANT_ENCAPSED_STRING","'q.entity_id = qi.quote_id'",249],",",["T_WHITESPACE","\n                ",249],["T_CONSTANT_ENCAPSED_STRING","'qi.parent_item_id IS NULL'",250],",",["T_WHITESPACE","\n                ",250],["T_VARIABLE","$adapter",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","quoteInto",251],"(",["T_CONSTANT_ENCAPSED_STRING","'qi.product_id = ?'",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$productId",251],")",["T_WHITESPACE","\n            ",251],")",")",",",["T_WHITESPACE","\n            ",252],["T_ARRAY","array",253],"(",")",["T_WHITESPACE","\n        ",253],")",";",["T_WHITESPACE","\n\n        ",254],["T_VARIABLE","$updateQuery",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$adapter",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","updateFromSelect",256],"(",["T_VARIABLE","$subSelect",256],",",["T_WHITESPACE"," ",256],["T_ARRAY","array",256],"(",["T_CONSTANT_ENCAPSED_STRING","'q'",256],["T_WHITESPACE"," ",256],["T_DOUBLE_ARROW","=>",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getTable",256],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",256],")",")",")",";",["T_WHITESPACE","\n\n        ",256],["T_VARIABLE","$adapter",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","query",258],"(",["T_VARIABLE","$updateQuery",258],")",";",["T_WHITESPACE","\n\n        ",258],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n\n    ",261],["T_DOC_COMMENT","\/**\n     * Mark recollect contain product(s) quotes\n     *\n     * @param array|int|Zend_Db_Expr $productIds\n     * @return Mage_Sales_Model_Resource_Quote\n     *\/",263],["T_WHITESPACE","\n    ",268],["T_PUBLIC","public",269],["T_WHITESPACE"," ",269],["T_FUNCTION","function",269],["T_WHITESPACE"," ",269],["T_STRING","markQuotesRecollect",269],"(",["T_VARIABLE","$productIds",269],")",["T_WHITESPACE","\n    ",269],"{",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$tableQuote",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getTable",271],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",271],")",";",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$tableItem",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getTable",272],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_item'",272],")",";",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$subSelect",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_getReadAdapter",273],"(",")",["T_WHITESPACE","\n            ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","select",274],"(",")",["T_WHITESPACE","\n            ",274],["T_OBJECT_OPERATOR","->",275],["T_STRING","from",275],"(",["T_VARIABLE","$tableItem",275],",",["T_WHITESPACE"," ",275],["T_ARRAY","array",275],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",275],["T_WHITESPACE"," ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_CONSTANT_ENCAPSED_STRING","'quote_id'",275],")",")",["T_WHITESPACE","\n            ",275],["T_OBJECT_OPERATOR","->",276],["T_STRING","where",276],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",276],",",["T_WHITESPACE"," ",276],["T_VARIABLE","$productIds",276],")",["T_WHITESPACE","\n            ",276],["T_OBJECT_OPERATOR","->",277],["T_STRING","group",277],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_id'",277],")",";",["T_WHITESPACE","\n\n        ",277],["T_VARIABLE","$select",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_getReadAdapter",279],"(",")",["T_OBJECT_OPERATOR","->",279],["T_STRING","select",279],"(",")",["T_OBJECT_OPERATOR","->",279],["T_STRING","join",279],"(",["T_WHITESPACE","\n            ",279],["T_ARRAY","array",280],"(",["T_CONSTANT_ENCAPSED_STRING","'t2'",280],["T_WHITESPACE"," ",280],["T_DOUBLE_ARROW","=>",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$subSelect",280],")",",",["T_WHITESPACE","\n            ",280],["T_CONSTANT_ENCAPSED_STRING","'t1.entity_id = t2.entity_id'",281],",",["T_WHITESPACE","\n            ",281],["T_ARRAY","array",282],"(",["T_CONSTANT_ENCAPSED_STRING","'trigger_recollect'",282],["T_WHITESPACE"," ",282],["T_DOUBLE_ARROW","=>",282],["T_WHITESPACE"," ",282],["T_NEW","new",282],["T_WHITESPACE"," ",282],["T_STRING","Zend_Db_Expr",282],"(",["T_CONSTANT_ENCAPSED_STRING","'1'",282],")",")",["T_WHITESPACE","\n        ",282],")",";",["T_WHITESPACE","\n        ",283],["T_VARIABLE","$updateQuery",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$select",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","crossUpdateFromSelect",284],"(",["T_ARRAY","array",284],"(",["T_CONSTANT_ENCAPSED_STRING","'t1'",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$tableQuote",284],")",")",";",["T_WHITESPACE","\n        ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","_getWriteAdapter",285],"(",")",["T_OBJECT_OPERATOR","->",285],["T_STRING","query",285],"(",["T_VARIABLE","$updateQuery",285],")",";",["T_WHITESPACE","\n\n        ",285],["T_RETURN","return",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$this",287],";",["T_WHITESPACE","\n    ",287],"}",["T_WHITESPACE","\n",288],"}",["T_WHITESPACE","\n\n",289]]