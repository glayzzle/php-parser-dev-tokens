[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Enter description here ...\n *\n * @method Mage_Sales_Model_Resource_Order_Invoice _getResource()\n * @method Mage_Sales_Model_Resource_Order_Invoice getResource()\n * @method int getStoreId()\n * @method Mage_Sales_Model_Order_Invoice setStoreId(int $value)\n * @method float getBaseGrandTotal()\n * @method Mage_Sales_Model_Order_Invoice setBaseGrandTotal(float $value)\n * @method float getShippingTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setShippingTaxAmount(float $value)\n * @method float getTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setTaxAmount(float $value)\n * @method float getBaseTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setBaseTaxAmount(float $value)\n * @method float getStoreToOrderRate()\n * @method Mage_Sales_Model_Order_Invoice setStoreToOrderRate(float $value)\n * @method float getBaseShippingTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setBaseShippingTaxAmount(float $value)\n * @method float getBaseDiscountAmount()\n * @method Mage_Sales_Model_Order_Invoice setBaseDiscountAmount(float $value)\n * @method float getBaseToOrderRate()\n * @method Mage_Sales_Model_Order_Invoice setBaseToOrderRate(float $value)\n * @method float getGrandTotal()\n * @method Mage_Sales_Model_Order_Invoice setGrandTotal(float $value)\n * @method float getShippingAmount()\n * @method Mage_Sales_Model_Order_Invoice setShippingAmount(float $value)\n * @method float getSubtotalInclTax()\n * @method Mage_Sales_Model_Order_Invoice setSubtotalInclTax(float $value)\n * @method float getBaseSubtotalInclTax()\n * @method Mage_Sales_Model_Order_Invoice setBaseSubtotalInclTax(float $value)\n * @method float getStoreToBaseRate()\n * @method Mage_Sales_Model_Order_Invoice setStoreToBaseRate(float $value)\n * @method float getBaseShippingAmount()\n * @method Mage_Sales_Model_Order_Invoice setBaseShippingAmount(float $value)\n * @method float getTotalQty()\n * @method Mage_Sales_Model_Order_Invoice setTotalQty(float $value)\n * @method float getBaseToGlobalRate()\n * @method Mage_Sales_Model_Order_Invoice setBaseToGlobalRate(float $value)\n * @method float getSubtotal()\n * @method Mage_Sales_Model_Order_Invoice setSubtotal(float $value)\n * @method float getBaseSubtotal()\n * @method Mage_Sales_Model_Order_Invoice setBaseSubtotal(float $value)\n * @method float getDiscountAmount()\n * @method Mage_Sales_Model_Order_Invoice setDiscountAmount(float $value)\n * @method int getBillingAddressId()\n * @method Mage_Sales_Model_Order_Invoice setBillingAddressId(int $value)\n * @method int getIsUsedForRefund()\n * @method Mage_Sales_Model_Order_Invoice setIsUsedForRefund(int $value)\n * @method int getOrderId()\n * @method Mage_Sales_Model_Order_Invoice setOrderId(int $value)\n * @method int getEmailSent()\n * @method Mage_Sales_Model_Order_Invoice setEmailSent(int $value)\n * @method int getCanVoidFlag()\n * @method Mage_Sales_Model_Order_Invoice setCanVoidFlag(int $value)\n * @method int getState()\n * @method Mage_Sales_Model_Order_Invoice setState(int $value)\n * @method int getShippingAddressId()\n * @method Mage_Sales_Model_Order_Invoice setShippingAddressId(int $value)\n * @method string getCybersourceToken()\n * @method Mage_Sales_Model_Order_Invoice setCybersourceToken(string $value)\n * @method string getStoreCurrencyCode()\n * @method Mage_Sales_Model_Order_Invoice setStoreCurrencyCode(string $value)\n * @method string getTransactionId()\n * @method Mage_Sales_Model_Order_Invoice setTransactionId(string $value)\n * @method string getOrderCurrencyCode()\n * @method Mage_Sales_Model_Order_Invoice setOrderCurrencyCode(string $value)\n * @method string getBaseCurrencyCode()\n * @method Mage_Sales_Model_Order_Invoice setBaseCurrencyCode(string $value)\n * @method string getGlobalCurrencyCode()\n * @method Mage_Sales_Model_Order_Invoice setGlobalCurrencyCode(string $value)\n * @method string getIncrementId()\n * @method Mage_Sales_Model_Order_Invoice setIncrementId(string $value)\n * @method string getCreatedAt()\n * @method Mage_Sales_Model_Order_Invoice setCreatedAt(string $value)\n * @method string getUpdatedAt()\n * @method Mage_Sales_Model_Order_Invoice setUpdatedAt(string $value)\n * @method float getHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setHiddenTaxAmount(float $value)\n * @method float getBaseHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setBaseHiddenTaxAmount(float $value)\n * @method float getShippingHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setShippingHiddenTaxAmount(float $value)\n * @method float getBaseShippingHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Invoice setBaseShippingHiddenTaxAmount(float $value)\n * @method float getShippingInclTax()\n * @method Mage_Sales_Model_Order_Invoice setShippingInclTax(float $value)\n * @method float getBaseShippingInclTax()\n * @method Mage_Sales_Model_Order_Invoice setBaseShippingInclTax(float $value)\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",121],["T_CLASS","class",122],["T_WHITESPACE"," ",122],["T_STRING","Mage_Sales_Model_Order_Invoice",122],["T_WHITESPACE"," ",122],["T_EXTENDS","extends",122],["T_WHITESPACE"," ",122],["T_STRING","Mage_Sales_Model_Abstract",122],["T_WHITESPACE","\n",122],"{",["T_WHITESPACE","\n    ",123],["T_DOC_COMMENT","\/**\n     * Invoice states\n     *\/",124],["T_WHITESPACE","\n    ",126],["T_CONST","const",127],["T_WHITESPACE"," ",127],["T_STRING","STATE_OPEN",127],["T_WHITESPACE","       ",127],"=",["T_WHITESPACE"," ",127],["T_LNUMBER","1",127],";",["T_WHITESPACE","\n    ",127],["T_CONST","const",128],["T_WHITESPACE"," ",128],["T_STRING","STATE_PAID",128],["T_WHITESPACE","       ",128],"=",["T_WHITESPACE"," ",128],["T_LNUMBER","2",128],";",["T_WHITESPACE","\n    ",128],["T_CONST","const",129],["T_WHITESPACE"," ",129],["T_STRING","STATE_CANCELED",129],["T_WHITESPACE","   ",129],"=",["T_WHITESPACE"," ",129],["T_LNUMBER","3",129],";",["T_WHITESPACE","\n\n    ",129],["T_CONST","const",131],["T_WHITESPACE"," ",131],["T_STRING","CAPTURE_ONLINE",131],["T_WHITESPACE","   ",131],"=",["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'online'",131],";",["T_WHITESPACE","\n    ",131],["T_CONST","const",132],["T_WHITESPACE"," ",132],["T_STRING","CAPTURE_OFFLINE",132],["T_WHITESPACE","  ",132],"=",["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'offline'",132],";",["T_WHITESPACE","\n    ",132],["T_CONST","const",133],["T_WHITESPACE"," ",133],["T_STRING","NOT_CAPTURE",133],["T_WHITESPACE","      ",133],"=",["T_WHITESPACE"," ",133],["T_CONSTANT_ENCAPSED_STRING","'not_capture'",133],";",["T_WHITESPACE","\n\n    ",133],["T_CONST","const",135],["T_WHITESPACE"," ",135],["T_STRING","XML_PATH_EMAIL_TEMPLATE",135],["T_WHITESPACE","               ",135],"=",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice\/template'",135],";",["T_WHITESPACE","\n    ",135],["T_CONST","const",136],["T_WHITESPACE"," ",136],["T_STRING","XML_PATH_EMAIL_GUEST_TEMPLATE",136],["T_WHITESPACE","         ",136],"=",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice\/guest_template'",136],";",["T_WHITESPACE","\n    ",136],["T_CONST","const",137],["T_WHITESPACE"," ",137],["T_STRING","XML_PATH_EMAIL_IDENTITY",137],["T_WHITESPACE","               ",137],"=",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice\/identity'",137],";",["T_WHITESPACE","\n    ",137],["T_CONST","const",138],["T_WHITESPACE"," ",138],["T_STRING","XML_PATH_EMAIL_COPY_TO",138],["T_WHITESPACE","                ",138],"=",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice\/copy_to'",138],";",["T_WHITESPACE","\n    ",138],["T_CONST","const",139],["T_WHITESPACE"," ",139],["T_STRING","XML_PATH_EMAIL_COPY_METHOD",139],["T_WHITESPACE","            ",139],"=",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice\/copy_method'",139],";",["T_WHITESPACE","\n    ",139],["T_CONST","const",140],["T_WHITESPACE"," ",140],["T_STRING","XML_PATH_EMAIL_ENABLED",140],["T_WHITESPACE","                ",140],"=",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice\/enabled'",140],";",["T_WHITESPACE","\n\n    ",140],["T_CONST","const",142],["T_WHITESPACE"," ",142],["T_STRING","XML_PATH_UPDATE_EMAIL_TEMPLATE",142],["T_WHITESPACE","        ",142],"=",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice_comment\/template'",142],";",["T_WHITESPACE","\n    ",142],["T_CONST","const",143],["T_WHITESPACE"," ",143],["T_STRING","XML_PATH_UPDATE_EMAIL_GUEST_TEMPLATE",143],["T_WHITESPACE","  ",143],"=",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice_comment\/guest_template'",143],";",["T_WHITESPACE","\n    ",143],["T_CONST","const",144],["T_WHITESPACE"," ",144],["T_STRING","XML_PATH_UPDATE_EMAIL_IDENTITY",144],["T_WHITESPACE","        ",144],"=",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice_comment\/identity'",144],";",["T_WHITESPACE","\n    ",144],["T_CONST","const",145],["T_WHITESPACE"," ",145],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_TO",145],["T_WHITESPACE","         ",145],"=",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice_comment\/copy_to'",145],";",["T_WHITESPACE","\n    ",145],["T_CONST","const",146],["T_WHITESPACE"," ",146],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_METHOD",146],["T_WHITESPACE","     ",146],"=",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice_comment\/copy_method'",146],";",["T_WHITESPACE","\n    ",146],["T_CONST","const",147],["T_WHITESPACE"," ",147],["T_STRING","XML_PATH_UPDATE_EMAIL_ENABLED",147],["T_WHITESPACE","         ",147],"=",["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/invoice_comment\/enabled'",147],";",["T_WHITESPACE","\n\n    ",147],["T_CONST","const",149],["T_WHITESPACE"," ",149],["T_STRING","REPORT_DATE_TYPE_ORDER_CREATED",149],["T_WHITESPACE","        ",149],"=",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'order_created'",149],";",["T_WHITESPACE","\n    ",149],["T_CONST","const",150],["T_WHITESPACE"," ",150],["T_STRING","REPORT_DATE_TYPE_INVOICE_CREATED",150],["T_WHITESPACE","      ",150],"=",["T_WHITESPACE"," ",150],["T_CONSTANT_ENCAPSED_STRING","'invoice_created'",150],";",["T_WHITESPACE","\n\n    ",150],["T_COMMENT","\/*\n     * Identifier for order history item\n     *\/",152],["T_WHITESPACE","\n    ",154],["T_CONST","const",155],["T_WHITESPACE"," ",155],["T_STRING","HISTORY_ENTITY_NAME",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'invoice'",155],";",["T_WHITESPACE","\n\n    ",155],["T_PROTECTED","protected",157],["T_WHITESPACE"," ",157],["T_STATIC","static",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$_states",157],";",["T_WHITESPACE","\n\n    ",157],["T_PROTECTED","protected",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$_items",159],";",["T_WHITESPACE","\n    ",159],["T_PROTECTED","protected",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$_comments",160],";",["T_WHITESPACE","\n    ",160],["T_PROTECTED","protected",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$_order",161],";",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Calculator instances for delta rounding of prices\n     *\n     * @var array\n     *\/",163],["T_WHITESPACE","\n    ",167],["T_PROTECTED","protected",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$_rounders",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_ARRAY","array",168],"(",")",";",["T_WHITESPACE","\n\n    ",168],["T_PROTECTED","protected",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$_saveBeforeDestruct",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_STRING","false",170],";",["T_WHITESPACE","\n\n    ",170],["T_PROTECTED","protected",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$_eventPrefix",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'sales_order_invoice'",172],";",["T_WHITESPACE","\n    ",172],["T_PROTECTED","protected",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$_eventObject",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'invoice'",173],";",["T_WHITESPACE","\n\n    ",173],["T_DOC_COMMENT","\/**\n     * Whether the pay() was called\n     * @var bool\n     *\/",175],["T_WHITESPACE","\n    ",178],["T_PROTECTED","protected",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$_wasPayCalled",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_STRING","false",179],";",["T_WHITESPACE","\n\n    ",179],["T_PUBLIC","public",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","__construct",181],"(",")",["T_WHITESPACE","\n    ",181],"{",["T_WHITESPACE","\n        ",182],["T_STRING","register_shutdown_function",183],"(",["T_ARRAY","array",183],"(",["T_VARIABLE","$this",183],",",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'destruct'",183],")",")",";",["T_WHITESPACE","\n        ",183],["T_STRING","parent",184],["T_DOUBLE_COLON","::",184],["T_STRING","__construct",184],"(",")",";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_DOC_COMMENT","\/**\n     * Uploader clean on shutdown\n     *\/",187],["T_WHITESPACE","\n    ",189],["T_PUBLIC","public",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","destruct",190],"(",")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_IF","if",192],["T_WHITESPACE"," ",192],"(",["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_saveBeforeDestruct",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","save",193],"(",")",";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n    ",194],"}",["T_WHITESPACE","\n\n    ",195],["T_DOC_COMMENT","\/**\n     * Initialize invoice resource model\n     *\/",197],["T_WHITESPACE","\n    ",199],["T_PROTECTED","protected",200],["T_WHITESPACE"," ",200],["T_FUNCTION","function",200],["T_WHITESPACE"," ",200],["T_STRING","_construct",200],"(",")",["T_WHITESPACE","\n    ",200],"{",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_init",202],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice'",202],")",";",["T_WHITESPACE","\n    ",202],"}",["T_WHITESPACE","\n\n\n    ",203],["T_DOC_COMMENT","\/**\n     * Init mapping array of short fields to its full names\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",206],["T_WHITESPACE","\n    ",210],["T_PROTECTED","protected",211],["T_WHITESPACE"," ",211],["T_FUNCTION","function",211],["T_WHITESPACE"," ",211],["T_STRING","_initOldFieldsMap",211],"(",")",["T_WHITESPACE","\n    ",211],"{",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_oldFieldsMap",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_STRING","Mage",213],["T_DOUBLE_COLON","::",213],["T_STRING","helper",213],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",213],")",["T_OBJECT_OPERATOR","->",213],["T_STRING","getOldFieldMap",213],"(",["T_CONSTANT_ENCAPSED_STRING","'order_invoice'",213],")",";",["T_WHITESPACE","\n        ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],";",["T_WHITESPACE","\n    ",214],"}",["T_WHITESPACE","\n\n    ",215],["T_DOC_COMMENT","\/**\n     * Load invoice by increment id\n     *\n     * @param string $incrementId\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",217],["T_WHITESPACE","\n    ",222],["T_PUBLIC","public",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","loadByIncrementId",223],"(",["T_VARIABLE","$incrementId",223],")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$ids",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getCollection",225],"(",")",["T_WHITESPACE","\n            ",225],["T_OBJECT_OPERATOR","->",226],["T_STRING","addAttributeToFilter",226],"(",["T_CONSTANT_ENCAPSED_STRING","'increment_id'",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$incrementId",226],")",["T_WHITESPACE","\n            ",226],["T_OBJECT_OPERATOR","->",227],["T_STRING","getAllIds",227],"(",")",";",["T_WHITESPACE","\n\n        ",227],["T_IF","if",229],["T_WHITESPACE"," ",229],"(","!",["T_EMPTY","empty",229],"(",["T_VARIABLE","$ids",229],")",")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n            ",229],["T_STRING","reset",230],"(",["T_VARIABLE","$ids",230],")",";",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","load",231],"(",["T_STRING","current",231],"(",["T_VARIABLE","$ids",231],")",")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n        ",232],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],";",["T_WHITESPACE","\n    ",233],"}",["T_WHITESPACE","\n\n    ",234],["T_DOC_COMMENT","\/**\n     * Retrieve invoice configuration model\n     *\n     * @return Mage_Sales_Model_Order_Invoice_Config\n     *\/",236],["T_WHITESPACE","\n    ",240],["T_PUBLIC","public",241],["T_WHITESPACE"," ",241],["T_FUNCTION","function",241],["T_WHITESPACE"," ",241],["T_STRING","getConfig",241],"(",")",["T_WHITESPACE","\n    ",241],"{",["T_WHITESPACE","\n        ",242],["T_RETURN","return",243],["T_WHITESPACE"," ",243],["T_STRING","Mage",243],["T_DOUBLE_COLON","::",243],["T_STRING","getSingleton",243],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice_config'",243],")",";",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n\n    ",244],["T_DOC_COMMENT","\/**\n     * Retrieve store model instance\n     *\n     * @return Mage_Core_Model_Store\n     *\/",246],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","getStore",251],"(",")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_RETURN","return",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getOrder",253],"(",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","getStore",253],"(",")",";",["T_WHITESPACE","\n    ",253],"}",["T_WHITESPACE","\n\n    ",254],["T_DOC_COMMENT","\/**\n     * Declare order for invoice\n     *\n     * @param   Mage_Sales_Model_Order $order\n     * @return  Mage_Sales_Model_Order_Invoice\n     *\/",256],["T_WHITESPACE","\n    ",261],["T_PUBLIC","public",262],["T_WHITESPACE"," ",262],["T_FUNCTION","function",262],["T_WHITESPACE"," ",262],["T_STRING","setOrder",262],"(",["T_STRING","Mage_Sales_Model_Order",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$order",262],")",["T_WHITESPACE","\n    ",262],"{",["T_WHITESPACE","\n        ",263],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_order",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$order",264],";",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","setOrderId",265],"(",["T_VARIABLE","$order",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getId",265],"(",")",")",["T_WHITESPACE","\n            ",265],["T_OBJECT_OPERATOR","->",266],["T_STRING","setStoreId",266],"(",["T_VARIABLE","$order",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getStoreId",266],"(",")",")",";",["T_WHITESPACE","\n        ",266],["T_RETURN","return",267],["T_WHITESPACE"," ",267],["T_VARIABLE","$this",267],";",["T_WHITESPACE","\n    ",267],"}",["T_WHITESPACE","\n\n    ",268],["T_DOC_COMMENT","\/**\n     * Retrieve the order the invoice for created for\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",270],["T_WHITESPACE","\n    ",274],["T_PUBLIC","public",275],["T_WHITESPACE"," ",275],["T_FUNCTION","function",275],["T_WHITESPACE"," ",275],["T_STRING","getOrder",275],"(",")",["T_WHITESPACE","\n    ",275],"{",["T_WHITESPACE","\n        ",276],["T_IF","if",277],["T_WHITESPACE"," ",277],"(","!",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_order",277],["T_WHITESPACE"," ",277],["T_INSTANCEOF","instanceof",277],["T_WHITESPACE"," ",277],["T_STRING","Mage_Sales_Model_Order",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_order",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_STRING","Mage",278],["T_DOUBLE_COLON","::",278],["T_STRING","getModel",278],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",278],")",["T_OBJECT_OPERATOR","->",278],["T_STRING","load",278],"(",["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","getOrderId",278],"(",")",")",";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n        ",279],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","_order",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","setHistoryEntityName",280],"(",["T_STRING","self",280],["T_DOUBLE_COLON","::",280],["T_STRING","HISTORY_ENTITY_NAME",280],")",";",["T_WHITESPACE","\n    ",280],"}",["T_WHITESPACE","\n\n    ",281],["T_DOC_COMMENT","\/**\n     * Retrieve the increment_id of the order\n     *\n     * @return string\n     *\/",283],["T_WHITESPACE","\n    ",287],["T_PUBLIC","public",288],["T_WHITESPACE"," ",288],["T_FUNCTION","function",288],["T_WHITESPACE"," ",288],["T_STRING","getOrderIncrementId",288],"(",")",["T_WHITESPACE","\n    ",288],"{",["T_WHITESPACE","\n        ",289],["T_RETURN","return",290],["T_WHITESPACE"," ",290],["T_STRING","Mage",290],["T_DOUBLE_COLON","::",290],["T_STRING","getModel",290],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",290],")",["T_OBJECT_OPERATOR","->",290],["T_STRING","getResource",290],"(",")",["T_OBJECT_OPERATOR","->",290],["T_STRING","getIncrementId",290],"(",["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getOrderId",290],"(",")",")",";",["T_WHITESPACE","\n    ",290],"}",["T_WHITESPACE","\n\n    ",291],["T_DOC_COMMENT","\/**\n     * Retrieve billing address\n     *\n     * @return Mage_Sales_Model_Order_Address\n     *\/",293],["T_WHITESPACE","\n    ",297],["T_PUBLIC","public",298],["T_WHITESPACE"," ",298],["T_FUNCTION","function",298],["T_WHITESPACE"," ",298],["T_STRING","getBillingAddress",298],"(",")",["T_WHITESPACE","\n    ",298],"{",["T_WHITESPACE","\n        ",299],["T_RETURN","return",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getOrder",300],"(",")",["T_OBJECT_OPERATOR","->",300],["T_STRING","getBillingAddress",300],"(",")",";",["T_WHITESPACE","\n    ",300],"}",["T_WHITESPACE","\n\n    ",301],["T_DOC_COMMENT","\/**\n     * Retrieve shipping address\n     *\n     * @return Mage_Sales_Model_Order_Address\n     *\/",303],["T_WHITESPACE","\n    ",307],["T_PUBLIC","public",308],["T_WHITESPACE"," ",308],["T_FUNCTION","function",308],["T_WHITESPACE"," ",308],["T_STRING","getShippingAddress",308],"(",")",["T_WHITESPACE","\n    ",308],"{",["T_WHITESPACE","\n        ",309],["T_RETURN","return",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getOrder",310],"(",")",["T_OBJECT_OPERATOR","->",310],["T_STRING","getShippingAddress",310],"(",")",";",["T_WHITESPACE","\n    ",310],"}",["T_WHITESPACE","\n\n    ",311],["T_DOC_COMMENT","\/**\n     * Check invoice cancel state\n     *\n     * @return bool\n     *\/",313],["T_WHITESPACE","\n    ",317],["T_PUBLIC","public",318],["T_WHITESPACE"," ",318],["T_FUNCTION","function",318],["T_WHITESPACE"," ",318],["T_STRING","isCanceled",318],"(",")",["T_WHITESPACE","\n    ",318],"{",["T_WHITESPACE","\n        ",319],["T_RETURN","return",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getState",320],"(",")",["T_WHITESPACE"," ",320],["T_IS_EQUAL","==",320],["T_WHITESPACE"," ",320],["T_STRING","self",320],["T_DOUBLE_COLON","::",320],["T_STRING","STATE_CANCELED",320],";",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * Check invice capture action availability\n     *\n     * @return bool\n     *\/",323],["T_WHITESPACE","\n    ",327],["T_PUBLIC","public",328],["T_WHITESPACE"," ",328],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","canCapture",328],"(",")",["T_WHITESPACE","\n    ",328],"{",["T_WHITESPACE","\n        ",329],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getState",330],"(",")",["T_WHITESPACE"," ",330],["T_IS_NOT_EQUAL","!=",330],["T_WHITESPACE"," ",330],["T_STRING","self",330],["T_DOUBLE_COLON","::",330],["T_STRING","STATE_CANCELED",330],["T_WHITESPACE","\n            ",330],["T_BOOLEAN_AND","&&",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getState",331],"(",")",["T_WHITESPACE"," ",331],["T_IS_NOT_EQUAL","!=",331],["T_WHITESPACE"," ",331],["T_STRING","self",331],["T_DOUBLE_COLON","::",331],["T_STRING","STATE_PAID",331],["T_WHITESPACE","\n            ",331],["T_BOOLEAN_AND","&&",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getOrder",332],"(",")",["T_OBJECT_OPERATOR","->",332],["T_STRING","getPayment",332],"(",")",["T_OBJECT_OPERATOR","->",332],["T_STRING","canCapture",332],"(",")",";",["T_WHITESPACE","\n    ",332],"}",["T_WHITESPACE","\n\n    ",333],["T_DOC_COMMENT","\/**\n     * Check invice void action availability\n     *\n     * @return bool\n     *\/",335],["T_WHITESPACE","\n    ",339],["T_PUBLIC","public",340],["T_WHITESPACE"," ",340],["T_FUNCTION","function",340],["T_WHITESPACE"," ",340],["T_STRING","canVoid",340],"(",")",["T_WHITESPACE","\n    ",340],"{",["T_WHITESPACE","\n        ",341],["T_VARIABLE","$canVoid",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_STRING","false",342],";",["T_WHITESPACE","\n        ",342],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getState",343],"(",")",["T_WHITESPACE"," ",343],["T_IS_EQUAL","==",343],["T_WHITESPACE"," ",343],["T_STRING","self",343],["T_DOUBLE_COLON","::",343],["T_STRING","STATE_PAID",343],")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n            ",343],["T_VARIABLE","$canVoid",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getCanVoidFlag",344],"(",")",";",["T_WHITESPACE","\n            ",344],["T_DOC_COMMENT","\/**\n             * If we not retrieve negative answer from payment yet\n             *\/",345],["T_WHITESPACE","\n            ",347],["T_IF","if",348],["T_WHITESPACE"," ",348],"(",["T_STRING","is_null",348],"(",["T_VARIABLE","$canVoid",348],")",")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n                ",348],["T_VARIABLE","$canVoid",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getOrder",349],"(",")",["T_OBJECT_OPERATOR","->",349],["T_STRING","getPayment",349],"(",")",["T_OBJECT_OPERATOR","->",349],["T_STRING","canVoid",349],"(",["T_VARIABLE","$this",349],")",";",["T_WHITESPACE","\n                ",349],["T_IF","if",350],["T_WHITESPACE"," ",350],"(",["T_VARIABLE","$canVoid",350],["T_WHITESPACE"," ",350],["T_IS_IDENTICAL","===",350],["T_WHITESPACE"," ",350],["T_STRING","false",350],")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                    ",350],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","setCanVoidFlag",351],"(",["T_STRING","false",351],")",";",["T_WHITESPACE","\n                    ",351],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","_saveBeforeDestruct",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_STRING","true",352],";",["T_WHITESPACE","\n                ",352],"}",["T_WHITESPACE","\n            ",353],"}",["T_WHITESPACE","\n            ",354],["T_ELSE","else",355],["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n                ",355],["T_VARIABLE","$canVoid",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_BOOL_CAST","(bool)",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$canVoid",356],";",["T_WHITESPACE","\n            ",356],"}",["T_WHITESPACE","\n        ",357],"}",["T_WHITESPACE","\n        ",358],["T_RETURN","return",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$canVoid",359],";",["T_WHITESPACE","\n    ",359],"}",["T_WHITESPACE","\n\n    ",360],["T_DOC_COMMENT","\/**\n     * Check invoice cancel action availability\n     *\n     * @return bool\n     *\/",362],["T_WHITESPACE","\n    ",366],["T_PUBLIC","public",367],["T_WHITESPACE"," ",367],["T_FUNCTION","function",367],["T_WHITESPACE"," ",367],["T_STRING","canCancel",367],"(",")",["T_WHITESPACE","\n    ",367],"{",["T_WHITESPACE","\n        ",368],["T_RETURN","return",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getState",369],"(",")",["T_WHITESPACE"," ",369],["T_IS_EQUAL","==",369],["T_WHITESPACE"," ",369],["T_STRING","self",369],["T_DOUBLE_COLON","::",369],["T_STRING","STATE_OPEN",369],";",["T_WHITESPACE","\n    ",369],"}",["T_WHITESPACE","\n\n    ",370],["T_DOC_COMMENT","\/**\n     * Check invoice refund action availability\n     *\n     * @return bool\n     *\/",372],["T_WHITESPACE","\n    ",376],["T_PUBLIC","public",377],["T_WHITESPACE"," ",377],["T_FUNCTION","function",377],["T_WHITESPACE"," ",377],["T_STRING","canRefund",377],"(",")",["T_WHITESPACE","\n    ",377],"{",["T_WHITESPACE","\n        ",378],["T_IF","if",379],["T_WHITESPACE"," ",379],"(",["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","getState",379],"(",")",["T_WHITESPACE"," ",379],["T_IS_NOT_EQUAL","!=",379],["T_WHITESPACE"," ",379],["T_STRING","self",379],["T_DOUBLE_COLON","::",379],["T_STRING","STATE_PAID",379],")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n            ",379],["T_RETURN","return",380],["T_WHITESPACE"," ",380],["T_STRING","false",380],";",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE","\n        ",381],["T_IF","if",382],["T_WHITESPACE"," ",382],"(",["T_STRING","abs",382],"(",["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getBaseGrandTotal",382],"(",")",["T_WHITESPACE"," ",382],"-",["T_WHITESPACE"," ",382],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getBaseTotalRefunded",382],"(",")",")",["T_WHITESPACE"," ",382],"<",["T_WHITESPACE"," ",382],["T_DNUMBER",".0001",382],")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_RETURN","return",383],["T_WHITESPACE"," ",383],["T_STRING","false",383],";",["T_WHITESPACE","\n        ",383],"}",["T_WHITESPACE","\n        ",384],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_STRING","true",385],";",["T_WHITESPACE","\n    ",385],"}",["T_WHITESPACE","\n\n    ",386],["T_DOC_COMMENT","\/**\n     * Capture invoice\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",388],["T_WHITESPACE","\n    ",392],["T_PUBLIC","public",393],["T_WHITESPACE"," ",393],["T_FUNCTION","function",393],["T_WHITESPACE"," ",393],["T_STRING","capture",393],"(",")",["T_WHITESPACE","\n    ",393],"{",["T_WHITESPACE","\n        ",394],["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getOrder",395],"(",")",["T_OBJECT_OPERATOR","->",395],["T_STRING","getPayment",395],"(",")",["T_OBJECT_OPERATOR","->",395],["T_STRING","capture",395],"(",["T_VARIABLE","$this",395],")",";",["T_WHITESPACE","\n        ",395],["T_IF","if",396],["T_WHITESPACE"," ",396],"(",["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getIsPaid",396],"(",")",")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n            ",396],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","pay",397],"(",")",";",["T_WHITESPACE","\n        ",397],"}",["T_WHITESPACE","\n        ",398],["T_RETURN","return",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],";",["T_WHITESPACE","\n    ",399],"}",["T_WHITESPACE","\n\n    ",400],["T_DOC_COMMENT","\/**\n     * Pay invoice\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",402],["T_WHITESPACE","\n    ",406],["T_PUBLIC","public",407],["T_WHITESPACE"," ",407],["T_FUNCTION","function",407],["T_WHITESPACE"," ",407],["T_STRING","pay",407],"(",")",["T_WHITESPACE","\n    ",407],"{",["T_WHITESPACE","\n        ",408],["T_IF","if",409],["T_WHITESPACE"," ",409],"(",["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","_wasPayCalled",409],")",["T_WHITESPACE"," ",409],"{",["T_WHITESPACE","\n            ",409],["T_RETURN","return",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE","\n        ",411],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","_wasPayCalled",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_STRING","true",412],";",["T_WHITESPACE","\n\n        ",412],["T_VARIABLE","$invoiceState",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_STRING","self",414],["T_DOUBLE_COLON","::",414],["T_STRING","STATE_PAID",414],";",["T_WHITESPACE","\n        ",414],["T_IF","if",415],["T_WHITESPACE"," ",415],"(",["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getOrder",415],"(",")",["T_OBJECT_OPERATOR","->",415],["T_STRING","getPayment",415],"(",")",["T_OBJECT_OPERATOR","->",415],["T_STRING","hasForcedState",415],"(",")",")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n            ",415],["T_VARIABLE","$invoiceState",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getOrder",416],"(",")",["T_OBJECT_OPERATOR","->",416],["T_STRING","getPayment",416],"(",")",["T_OBJECT_OPERATOR","->",416],["T_STRING","getForcedState",416],"(",")",";",["T_WHITESPACE","\n        ",416],"}",["T_WHITESPACE","\n\n        ",417],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","setState",419],"(",["T_VARIABLE","$invoiceState",419],")",";",["T_WHITESPACE","\n\n        ",419],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getOrder",421],"(",")",["T_OBJECT_OPERATOR","->",421],["T_STRING","getPayment",421],"(",")",["T_OBJECT_OPERATOR","->",421],["T_STRING","pay",421],"(",["T_VARIABLE","$this",421],")",";",["T_WHITESPACE","\n        ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getOrder",422],"(",")",["T_OBJECT_OPERATOR","->",422],["T_STRING","setTotalPaid",422],"(",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getOrder",423],"(",")",["T_OBJECT_OPERATOR","->",423],["T_STRING","getTotalPaid",423],"(",")","+",["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getGrandTotal",423],"(",")",["T_WHITESPACE","\n        ",423],")",";",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$this",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getOrder",425],"(",")",["T_OBJECT_OPERATOR","->",425],["T_STRING","setBaseTotalPaid",425],"(",["T_WHITESPACE","\n            ",425],["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getOrder",426],"(",")",["T_OBJECT_OPERATOR","->",426],["T_STRING","getBaseTotalPaid",426],"(",")","+",["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getBaseGrandTotal",426],"(",")",["T_WHITESPACE","\n        ",426],")",";",["T_WHITESPACE","\n        ",427],["T_STRING","Mage",428],["T_DOUBLE_COLON","::",428],["T_STRING","dispatchEvent",428],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_invoice_pay'",428],",",["T_WHITESPACE"," ",428],["T_ARRAY","array",428],"(",["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","_eventObject",428],["T_DOUBLE_ARROW","=>",428],["T_VARIABLE","$this",428],")",")",";",["T_WHITESPACE","\n        ",428],["T_RETURN","return",429],["T_WHITESPACE"," ",429],["T_VARIABLE","$this",429],";",["T_WHITESPACE","\n    ",429],"}",["T_WHITESPACE","\n\n    ",430],["T_DOC_COMMENT","\/**\n     * Whether pay() method was called (whether order and payment totals were updated)\n     * @return bool\n     *\/",432],["T_WHITESPACE","\n    ",435],["T_PUBLIC","public",436],["T_WHITESPACE"," ",436],["T_FUNCTION","function",436],["T_WHITESPACE"," ",436],["T_STRING","wasPayCalled",436],"(",")",["T_WHITESPACE","\n    ",436],"{",["T_WHITESPACE","\n        ",437],["T_RETURN","return",438],["T_WHITESPACE"," ",438],["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","_wasPayCalled",438],";",["T_WHITESPACE","\n    ",438],"}",["T_WHITESPACE","\n\n    ",439],["T_DOC_COMMENT","\/**\n     * Void invoice\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",441],["T_WHITESPACE","\n    ",445],["T_PUBLIC","public",446],["T_WHITESPACE"," ",446],["T_FUNCTION","function",446],["T_WHITESPACE"," ",446],["T_STRING","void",446],"(",")",["T_WHITESPACE","\n    ",446],"{",["T_WHITESPACE","\n        ",447],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","getOrder",448],"(",")",["T_OBJECT_OPERATOR","->",448],["T_STRING","getPayment",448],"(",")",["T_OBJECT_OPERATOR","->",448],["T_STRING","void",448],"(",["T_VARIABLE","$this",448],")",";",["T_WHITESPACE","\n        ",448],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","cancel",449],"(",")",";",["T_WHITESPACE","\n        ",449],["T_RETURN","return",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$this",450],";",["T_WHITESPACE","\n    ",450],"}",["T_WHITESPACE","\n\n    ",451],["T_DOC_COMMENT","\/**\n     * Cancel invoice action\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",453],["T_WHITESPACE","\n    ",457],["T_PUBLIC","public",458],["T_WHITESPACE"," ",458],["T_FUNCTION","function",458],["T_WHITESPACE"," ",458],["T_STRING","cancel",458],"(",")",["T_WHITESPACE","\n    ",458],"{",["T_WHITESPACE","\n        ",459],["T_VARIABLE","$order",460],["T_WHITESPACE"," ",460],"=",["T_WHITESPACE"," ",460],["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","getOrder",460],"(",")",";",["T_WHITESPACE","\n        ",460],["T_VARIABLE","$order",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","getPayment",461],"(",")",["T_OBJECT_OPERATOR","->",461],["T_STRING","cancelInvoice",461],"(",["T_VARIABLE","$this",461],")",";",["T_WHITESPACE","\n        ",461],["T_FOREACH","foreach",462],["T_WHITESPACE"," ",462],"(",["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","getAllItems",462],"(",")",["T_WHITESPACE"," ",462],["T_AS","as",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$item",462],")",["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n            ",462],["T_VARIABLE","$item",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","cancel",463],"(",")",";",["T_WHITESPACE","\n        ",463],"}",["T_WHITESPACE","\n\n        ",464],["T_DOC_COMMENT","\/**\n         * Unregister order totals only for invoices in state PAID\n         *\/",466],["T_WHITESPACE","\n        ",468],["T_VARIABLE","$order",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","setTotalInvoiced",469],"(",["T_VARIABLE","$order",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getTotalInvoiced",469],"(",")",["T_WHITESPACE"," ",469],"-",["T_WHITESPACE"," ",469],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getGrandTotal",469],"(",")",")",";",["T_WHITESPACE","\n        ",469],["T_VARIABLE","$order",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","setBaseTotalInvoiced",470],"(",["T_VARIABLE","$order",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","getBaseTotalInvoiced",470],"(",")",["T_WHITESPACE"," ",470],"-",["T_WHITESPACE"," ",470],["T_VARIABLE","$this",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","getBaseGrandTotal",470],"(",")",")",";",["T_WHITESPACE","\n\n        ",470],["T_VARIABLE","$order",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","setSubtotalInvoiced",472],"(",["T_VARIABLE","$order",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getSubtotalInvoiced",472],"(",")",["T_WHITESPACE"," ",472],"-",["T_WHITESPACE"," ",472],["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getSubtotal",472],"(",")",")",";",["T_WHITESPACE","\n        ",472],["T_VARIABLE","$order",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","setBaseSubtotalInvoiced",473],"(",["T_VARIABLE","$order",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getBaseSubtotalInvoiced",473],"(",")",["T_WHITESPACE"," ",473],"-",["T_WHITESPACE"," ",473],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getBaseSubtotal",473],"(",")",")",";",["T_WHITESPACE","\n\n        ",473],["T_VARIABLE","$order",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","setTaxInvoiced",475],"(",["T_VARIABLE","$order",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","getTaxInvoiced",475],"(",")",["T_WHITESPACE"," ",475],"-",["T_WHITESPACE"," ",475],["T_VARIABLE","$this",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","getTaxAmount",475],"(",")",")",";",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$order",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","setBaseTaxInvoiced",476],"(",["T_VARIABLE","$order",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getBaseTaxInvoiced",476],"(",")",["T_WHITESPACE"," ",476],"-",["T_WHITESPACE"," ",476],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getBaseTaxAmount",476],"(",")",")",";",["T_WHITESPACE","\n\n        ",476],["T_VARIABLE","$order",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","setHiddenTaxInvoiced",478],"(",["T_VARIABLE","$order",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getHiddenTaxInvoiced",478],"(",")",["T_WHITESPACE"," ",478],"-",["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getHiddenTaxAmount",478],"(",")",")",";",["T_WHITESPACE","\n        ",478],["T_VARIABLE","$order",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","setBaseHiddenTaxInvoiced",479],"(",["T_VARIABLE","$order",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getBaseHiddenTaxInvoiced",479],"(",")",["T_WHITESPACE"," ",479],"-",["T_WHITESPACE"," ",479],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getBaseHiddenTaxAmount",479],"(",")",")",";",["T_WHITESPACE","\n\n        ",479],["T_VARIABLE","$order",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","setShippingTaxInvoiced",481],"(",["T_VARIABLE","$order",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getShippingTaxInvoiced",481],"(",")",["T_WHITESPACE"," ",481],"-",["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getShippingTaxAmount",481],"(",")",")",";",["T_WHITESPACE","\n        ",481],["T_VARIABLE","$order",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","setBaseShippingTaxInvoiced",482],"(",["T_VARIABLE","$order",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getBaseShippingTaxInvoiced",482],"(",")",["T_WHITESPACE"," ",482],"-",["T_WHITESPACE"," ",482],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getBaseShippingTaxAmount",482],"(",")",")",";",["T_WHITESPACE","\n\n        ",482],["T_VARIABLE","$order",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","setShippingInvoiced",484],"(",["T_VARIABLE","$order",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getShippingInvoiced",484],"(",")",["T_WHITESPACE"," ",484],"-",["T_WHITESPACE"," ",484],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getShippingAmount",484],"(",")",")",";",["T_WHITESPACE","\n        ",484],["T_VARIABLE","$order",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","setBaseShippingInvoiced",485],"(",["T_VARIABLE","$order",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","getBaseShippingInvoiced",485],"(",")",["T_WHITESPACE"," ",485],"-",["T_WHITESPACE"," ",485],["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","getBaseShippingAmount",485],"(",")",")",";",["T_WHITESPACE","\n\n        ",485],["T_VARIABLE","$order",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","setDiscountInvoiced",487],"(",["T_VARIABLE","$order",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getDiscountInvoiced",487],"(",")",["T_WHITESPACE"," ",487],"-",["T_WHITESPACE"," ",487],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getDiscountAmount",487],"(",")",")",";",["T_WHITESPACE","\n        ",487],["T_VARIABLE","$order",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","setBaseDiscountInvoiced",488],"(",["T_VARIABLE","$order",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getBaseDiscountInvoiced",488],"(",")",["T_WHITESPACE"," ",488],"-",["T_WHITESPACE"," ",488],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getBaseDiscountAmount",488],"(",")",")",";",["T_WHITESPACE","\n        ",488],["T_VARIABLE","$order",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","setBaseTotalInvoicedCost",489],"(",["T_VARIABLE","$order",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getBaseTotalInvoicedCost",489],"(",")",["T_WHITESPACE"," ",489],"-",["T_WHITESPACE"," ",489],["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getBaseCost",489],"(",")",")",";",["T_WHITESPACE","\n\n\n        ",489],["T_IF","if",492],["T_WHITESPACE"," ",492],"(",["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getState",492],"(",")",["T_WHITESPACE"," ",492],["T_IS_EQUAL","==",492],["T_WHITESPACE"," ",492],["T_STRING","self",492],["T_DOUBLE_COLON","::",492],["T_STRING","STATE_PAID",492],")",["T_WHITESPACE"," ",492],"{",["T_WHITESPACE","\n            ",492],["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getOrder",493],"(",")",["T_OBJECT_OPERATOR","->",493],["T_STRING","setTotalPaid",493],"(",["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getOrder",493],"(",")",["T_OBJECT_OPERATOR","->",493],["T_STRING","getTotalPaid",493],"(",")","-",["T_VARIABLE","$this",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","getGrandTotal",493],"(",")",")",";",["T_WHITESPACE","\n            ",493],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getOrder",494],"(",")",["T_OBJECT_OPERATOR","->",494],["T_STRING","setBaseTotalPaid",494],"(",["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getOrder",494],"(",")",["T_OBJECT_OPERATOR","->",494],["T_STRING","getBaseTotalPaid",494],"(",")","-",["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getBaseGrandTotal",494],"(",")",")",";",["T_WHITESPACE","\n        ",494],"}",["T_WHITESPACE","\n        ",495],["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","setState",496],"(",["T_STRING","self",496],["T_DOUBLE_COLON","::",496],["T_STRING","STATE_CANCELED",496],")",";",["T_WHITESPACE","\n        ",496],["T_VARIABLE","$this",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","getOrder",497],"(",")",["T_OBJECT_OPERATOR","->",497],["T_STRING","setState",497],"(",["T_STRING","Mage_Sales_Model_Order",497],["T_DOUBLE_COLON","::",497],["T_STRING","STATE_PROCESSING",497],",",["T_WHITESPACE"," ",497],["T_STRING","true",497],")",";",["T_WHITESPACE","\n        ",497],["T_STRING","Mage",498],["T_DOUBLE_COLON","::",498],["T_STRING","dispatchEvent",498],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_invoice_cancel'",498],",",["T_WHITESPACE"," ",498],["T_ARRAY","array",498],"(",["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","_eventObject",498],["T_DOUBLE_ARROW","=>",498],["T_VARIABLE","$this",498],")",")",";",["T_WHITESPACE","\n        ",498],["T_RETURN","return",499],["T_WHITESPACE"," ",499],["T_VARIABLE","$this",499],";",["T_WHITESPACE","\n    ",499],"}",["T_WHITESPACE","\n\n    ",500],["T_DOC_COMMENT","\/**\n     * Invoice totals collecting\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",502],["T_WHITESPACE","\n    ",506],["T_PUBLIC","public",507],["T_WHITESPACE"," ",507],["T_FUNCTION","function",507],["T_WHITESPACE"," ",507],["T_STRING","collectTotals",507],"(",")",["T_WHITESPACE","\n    ",507],"{",["T_WHITESPACE","\n        ",508],["T_FOREACH","foreach",509],["T_WHITESPACE"," ",509],"(",["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getConfig",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","getTotalModels",509],"(",")",["T_WHITESPACE"," ",509],["T_AS","as",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$model",509],")",["T_WHITESPACE"," ",509],"{",["T_WHITESPACE","\n            ",509],["T_VARIABLE","$model",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","collect",510],"(",["T_VARIABLE","$this",510],")",";",["T_WHITESPACE","\n        ",510],"}",["T_WHITESPACE","\n        ",511],["T_RETURN","return",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$this",512],";",["T_WHITESPACE","\n    ",512],"}",["T_WHITESPACE","\n\n    ",513],["T_DOC_COMMENT","\/**\n     * Round price considering delta\n     *\n     * @param float $price\n     * @param string $type\n     * @param bool $negative Indicates if we perform addition (true) or subtraction (false) of rounded value\n     * @return float\n     *\/",515],["T_WHITESPACE","\n    ",522],["T_PUBLIC","public",523],["T_WHITESPACE"," ",523],["T_FUNCTION","function",523],["T_WHITESPACE"," ",523],["T_STRING","roundPrice",523],"(",["T_VARIABLE","$price",523],",",["T_WHITESPACE"," ",523],["T_VARIABLE","$type",523],["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_CONSTANT_ENCAPSED_STRING","'regular'",523],",",["T_WHITESPACE"," ",523],["T_VARIABLE","$negative",523],["T_WHITESPACE"," ",523],"=",["T_WHITESPACE"," ",523],["T_STRING","false",523],")",["T_WHITESPACE","\n    ",523],"{",["T_WHITESPACE","\n        ",524],["T_IF","if",525],["T_WHITESPACE"," ",525],"(",["T_VARIABLE","$price",525],")",["T_WHITESPACE"," ",525],"{",["T_WHITESPACE","\n            ",525],["T_IF","if",526],["T_WHITESPACE"," ",526],"(","!",["T_ISSET","isset",526],"(",["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","_rounders",526],"[",["T_VARIABLE","$type",526],"]",")",")",["T_WHITESPACE"," ",526],"{",["T_WHITESPACE","\n                ",526],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","_rounders",527],"[",["T_VARIABLE","$type",527],"]",["T_WHITESPACE"," ",527],"=",["T_WHITESPACE"," ",527],["T_STRING","Mage",527],["T_DOUBLE_COLON","::",527],["T_STRING","getModel",527],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/calculator'",527],",",["T_WHITESPACE"," ",527],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getStore",527],"(",")",")",";",["T_WHITESPACE","\n            ",527],"}",["T_WHITESPACE","\n            ",528],["T_VARIABLE","$price",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","_rounders",529],"[",["T_VARIABLE","$type",529],"]",["T_OBJECT_OPERATOR","->",529],["T_STRING","deltaRound",529],"(",["T_VARIABLE","$price",529],",",["T_WHITESPACE"," ",529],["T_VARIABLE","$negative",529],")",";",["T_WHITESPACE","\n        ",529],"}",["T_WHITESPACE","\n        ",530],["T_RETURN","return",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$price",531],";",["T_WHITESPACE","\n    ",531],"}",["T_WHITESPACE","\n\n    ",532],["T_DOC_COMMENT","\/**\n     * Get invoice items collection\n     *\n     * @return Mage_Sales_Model_Mysql4_Order_Invoice_Item_Collection\n     *\/",534],["T_WHITESPACE","\n    ",538],["T_PUBLIC","public",539],["T_WHITESPACE"," ",539],["T_FUNCTION","function",539],["T_WHITESPACE"," ",539],["T_STRING","getItemsCollection",539],"(",")",["T_WHITESPACE","\n    ",539],"{",["T_WHITESPACE","\n        ",540],["T_IF","if",541],["T_WHITESPACE"," ",541],"(",["T_EMPTY","empty",541],"(",["T_VARIABLE","$this",541],["T_OBJECT_OPERATOR","->",541],["T_STRING","_items",541],")",")",["T_WHITESPACE"," ",541],"{",["T_WHITESPACE","\n            ",541],["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","_items",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_STRING","Mage",542],["T_DOUBLE_COLON","::",542],["T_STRING","getResourceModel",542],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice_item_collection'",542],")",["T_WHITESPACE","\n                ",542],["T_OBJECT_OPERATOR","->",543],["T_STRING","setInvoiceFilter",543],"(",["T_VARIABLE","$this",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","getId",543],"(",")",")",";",["T_WHITESPACE","\n\n            ",543],["T_IF","if",545],["T_WHITESPACE"," ",545],"(",["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","getId",545],"(",")",")",["T_WHITESPACE"," ",545],"{",["T_WHITESPACE","\n                ",545],["T_FOREACH","foreach",546],["T_WHITESPACE"," ",546],"(",["T_VARIABLE","$this",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","_items",546],["T_WHITESPACE"," ",546],["T_AS","as",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$item",546],")",["T_WHITESPACE"," ",546],"{",["T_WHITESPACE","\n                    ",546],["T_VARIABLE","$item",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","setInvoice",547],"(",["T_VARIABLE","$this",547],")",";",["T_WHITESPACE","\n                ",547],"}",["T_WHITESPACE","\n            ",548],"}",["T_WHITESPACE","\n        ",549],"}",["T_WHITESPACE","\n        ",550],["T_RETURN","return",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_items",551],";",["T_WHITESPACE","\n    ",551],"}",["T_WHITESPACE","\n\n    ",552],["T_PUBLIC","public",554],["T_WHITESPACE"," ",554],["T_FUNCTION","function",554],["T_WHITESPACE"," ",554],["T_STRING","getAllItems",554],"(",")",["T_WHITESPACE","\n    ",554],"{",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$items",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_ARRAY","array",556],"(",")",";",["T_WHITESPACE","\n        ",556],["T_FOREACH","foreach",557],["T_WHITESPACE"," ",557],"(",["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getItemsCollection",557],"(",")",["T_WHITESPACE"," ",557],["T_AS","as",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$item",557],")",["T_WHITESPACE"," ",557],"{",["T_WHITESPACE","\n            ",557],["T_IF","if",558],["T_WHITESPACE"," ",558],"(","!",["T_VARIABLE","$item",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","isDeleted",558],"(",")",")",["T_WHITESPACE"," ",558],"{",["T_WHITESPACE","\n                ",558],["T_VARIABLE","$items",559],"[","]",["T_WHITESPACE"," ",559],"=",["T_WHITESPACE","  ",559],["T_VARIABLE","$item",559],";",["T_WHITESPACE","\n            ",559],"}",["T_WHITESPACE","\n        ",560],"}",["T_WHITESPACE","\n        ",561],["T_RETURN","return",562],["T_WHITESPACE"," ",562],["T_VARIABLE","$items",562],";",["T_WHITESPACE","\n    ",562],"}",["T_WHITESPACE","\n\n    ",563],["T_PUBLIC","public",565],["T_WHITESPACE"," ",565],["T_FUNCTION","function",565],["T_WHITESPACE"," ",565],["T_STRING","getItemById",565],"(",["T_VARIABLE","$itemId",565],")",["T_WHITESPACE","\n    ",565],"{",["T_WHITESPACE","\n        ",566],["T_FOREACH","foreach",567],["T_WHITESPACE"," ",567],"(",["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getItemsCollection",567],"(",")",["T_WHITESPACE"," ",567],["T_AS","as",567],["T_WHITESPACE"," ",567],["T_VARIABLE","$item",567],")",["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n            ",567],["T_IF","if",568],["T_WHITESPACE"," ",568],"(",["T_VARIABLE","$item",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getId",568],"(",")",["T_IS_EQUAL","==",568],["T_VARIABLE","$itemId",568],")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n                ",568],["T_RETURN","return",569],["T_WHITESPACE"," ",569],["T_VARIABLE","$item",569],";",["T_WHITESPACE","\n            ",569],"}",["T_WHITESPACE","\n        ",570],"}",["T_WHITESPACE","\n        ",571],["T_RETURN","return",572],["T_WHITESPACE"," ",572],["T_STRING","false",572],";",["T_WHITESPACE","\n    ",572],"}",["T_WHITESPACE","\n\n    ",573],["T_PUBLIC","public",575],["T_WHITESPACE"," ",575],["T_FUNCTION","function",575],["T_WHITESPACE"," ",575],["T_STRING","addItem",575],"(",["T_STRING","Mage_Sales_Model_Order_Invoice_Item",575],["T_WHITESPACE"," ",575],["T_VARIABLE","$item",575],")",["T_WHITESPACE","\n    ",575],"{",["T_WHITESPACE","\n        ",576],["T_VARIABLE","$item",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","setInvoice",577],"(",["T_VARIABLE","$this",577],")",["T_WHITESPACE","\n            ",577],["T_OBJECT_OPERATOR","->",578],["T_STRING","setParentId",578],"(",["T_VARIABLE","$this",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","getId",578],"(",")",")",["T_WHITESPACE","\n            ",578],["T_OBJECT_OPERATOR","->",579],["T_STRING","setStoreId",579],"(",["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","getStoreId",579],"(",")",")",";",["T_WHITESPACE","\n\n        ",579],["T_IF","if",581],["T_WHITESPACE"," ",581],"(","!",["T_VARIABLE","$item",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","getId",581],"(",")",")",["T_WHITESPACE"," ",581],"{",["T_WHITESPACE","\n            ",581],["T_VARIABLE","$this",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","getItemsCollection",582],"(",")",["T_OBJECT_OPERATOR","->",582],["T_STRING","addItem",582],"(",["T_VARIABLE","$item",582],")",";",["T_WHITESPACE","\n        ",582],"}",["T_WHITESPACE","\n        ",583],["T_RETURN","return",584],["T_WHITESPACE"," ",584],["T_VARIABLE","$this",584],";",["T_WHITESPACE","\n    ",584],"}",["T_WHITESPACE","\n\n    ",585],["T_DOC_COMMENT","\/**\n     * Retrieve invoice states array\n     *\n     * @return array\n     *\/",587],["T_WHITESPACE","\n    ",591],["T_PUBLIC","public",592],["T_WHITESPACE"," ",592],["T_STATIC","static",592],["T_WHITESPACE"," ",592],["T_FUNCTION","function",592],["T_WHITESPACE"," ",592],["T_STRING","getStates",592],"(",")",["T_WHITESPACE","\n    ",592],"{",["T_WHITESPACE","\n        ",593],["T_IF","if",594],["T_WHITESPACE"," ",594],"(",["T_STRING","is_null",594],"(",["T_STRING","self",594],["T_DOUBLE_COLON","::",594],["T_VARIABLE","$_states",594],")",")",["T_WHITESPACE"," ",594],"{",["T_WHITESPACE","\n            ",594],["T_STRING","self",595],["T_DOUBLE_COLON","::",595],["T_VARIABLE","$_states",595],["T_WHITESPACE"," ",595],"=",["T_WHITESPACE"," ",595],["T_ARRAY","array",595],"(",["T_WHITESPACE","\n                ",595],["T_STRING","self",596],["T_DOUBLE_COLON","::",596],["T_STRING","STATE_OPEN",596],["T_WHITESPACE","       ",596],["T_DOUBLE_ARROW","=>",596],["T_WHITESPACE"," ",596],["T_STRING","Mage",596],["T_DOUBLE_COLON","::",596],["T_STRING","helper",596],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",596],")",["T_OBJECT_OPERATOR","->",596],["T_STRING","__",596],"(",["T_CONSTANT_ENCAPSED_STRING","'Pending'",596],")",",",["T_WHITESPACE","\n                ",596],["T_STRING","self",597],["T_DOUBLE_COLON","::",597],["T_STRING","STATE_PAID",597],["T_WHITESPACE","       ",597],["T_DOUBLE_ARROW","=>",597],["T_WHITESPACE"," ",597],["T_STRING","Mage",597],["T_DOUBLE_COLON","::",597],["T_STRING","helper",597],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",597],")",["T_OBJECT_OPERATOR","->",597],["T_STRING","__",597],"(",["T_CONSTANT_ENCAPSED_STRING","'Paid'",597],")",",",["T_WHITESPACE","\n                ",597],["T_STRING","self",598],["T_DOUBLE_COLON","::",598],["T_STRING","STATE_CANCELED",598],["T_WHITESPACE","   ",598],["T_DOUBLE_ARROW","=>",598],["T_WHITESPACE"," ",598],["T_STRING","Mage",598],["T_DOUBLE_COLON","::",598],["T_STRING","helper",598],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",598],")",["T_OBJECT_OPERATOR","->",598],["T_STRING","__",598],"(",["T_CONSTANT_ENCAPSED_STRING","'Canceled'",598],")",",",["T_WHITESPACE","\n            ",598],")",";",["T_WHITESPACE","\n        ",599],"}",["T_WHITESPACE","\n        ",600],["T_RETURN","return",601],["T_WHITESPACE"," ",601],["T_STRING","self",601],["T_DOUBLE_COLON","::",601],["T_VARIABLE","$_states",601],";",["T_WHITESPACE","\n    ",601],"}",["T_WHITESPACE","\n\n    ",602],["T_DOC_COMMENT","\/**\n     * Retrieve invoice state name by state identifier\n     *\n     * @param   int $stateId\n     * @return  string\n     *\/",604],["T_WHITESPACE","\n    ",609],["T_PUBLIC","public",610],["T_WHITESPACE"," ",610],["T_FUNCTION","function",610],["T_WHITESPACE"," ",610],["T_STRING","getStateName",610],"(",["T_VARIABLE","$stateId",610],["T_WHITESPACE"," ",610],"=",["T_WHITESPACE"," ",610],["T_STRING","null",610],")",["T_WHITESPACE","\n    ",610],"{",["T_WHITESPACE","\n        ",611],["T_IF","if",612],["T_WHITESPACE"," ",612],"(",["T_STRING","is_null",612],"(",["T_VARIABLE","$stateId",612],")",")",["T_WHITESPACE"," ",612],"{",["T_WHITESPACE","\n            ",612],["T_VARIABLE","$stateId",613],["T_WHITESPACE"," ",613],"=",["T_WHITESPACE"," ",613],["T_VARIABLE","$this",613],["T_OBJECT_OPERATOR","->",613],["T_STRING","getState",613],"(",")",";",["T_WHITESPACE","\n        ",613],"}",["T_WHITESPACE","\n\n        ",614],["T_IF","if",616],["T_WHITESPACE"," ",616],"(",["T_STRING","is_null",616],"(",["T_STRING","self",616],["T_DOUBLE_COLON","::",616],["T_VARIABLE","$_states",616],")",")",["T_WHITESPACE"," ",616],"{",["T_WHITESPACE","\n            ",616],["T_STRING","self",617],["T_DOUBLE_COLON","::",617],["T_STRING","getStates",617],"(",")",";",["T_WHITESPACE","\n        ",617],"}",["T_WHITESPACE","\n        ",618],["T_IF","if",619],["T_WHITESPACE"," ",619],"(",["T_ISSET","isset",619],"(",["T_STRING","self",619],["T_DOUBLE_COLON","::",619],["T_VARIABLE","$_states",619],"[",["T_VARIABLE","$stateId",619],"]",")",")",["T_WHITESPACE"," ",619],"{",["T_WHITESPACE","\n            ",619],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_STRING","self",620],["T_DOUBLE_COLON","::",620],["T_VARIABLE","$_states",620],"[",["T_VARIABLE","$stateId",620],"]",";",["T_WHITESPACE","\n        ",620],"}",["T_WHITESPACE","\n        ",621],["T_RETURN","return",622],["T_WHITESPACE"," ",622],["T_STRING","Mage",622],["T_DOUBLE_COLON","::",622],["T_STRING","helper",622],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",622],")",["T_OBJECT_OPERATOR","->",622],["T_STRING","__",622],"(",["T_CONSTANT_ENCAPSED_STRING","'Unknown State'",622],")",";",["T_WHITESPACE","\n    ",622],"}",["T_WHITESPACE","\n\n    ",623],["T_DOC_COMMENT","\/**\n     * Register invoice\n     *\n     * Apply to order, order items etc.\n     *\n     * @return unknown\n     *\/",625],["T_WHITESPACE","\n    ",631],["T_PUBLIC","public",632],["T_WHITESPACE"," ",632],["T_FUNCTION","function",632],["T_WHITESPACE"," ",632],["T_STRING","register",632],"(",")",["T_WHITESPACE","\n    ",632],"{",["T_WHITESPACE","\n        ",633],["T_IF","if",634],["T_WHITESPACE"," ",634],"(",["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","getId",634],"(",")",")",["T_WHITESPACE"," ",634],"{",["T_WHITESPACE","\n            ",634],["T_STRING","Mage",635],["T_DOUBLE_COLON","::",635],["T_STRING","throwException",635],"(",["T_STRING","Mage",635],["T_DOUBLE_COLON","::",635],["T_STRING","helper",635],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",635],")",["T_OBJECT_OPERATOR","->",635],["T_STRING","__",635],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot register existing invoice'",635],")",")",";",["T_WHITESPACE","\n        ",635],"}",["T_WHITESPACE","\n\n        ",636],["T_FOREACH","foreach",638],["T_WHITESPACE"," ",638],"(",["T_VARIABLE","$this",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","getAllItems",638],"(",")",["T_WHITESPACE"," ",638],["T_AS","as",638],["T_WHITESPACE"," ",638],["T_VARIABLE","$item",638],")",["T_WHITESPACE"," ",638],"{",["T_WHITESPACE","\n            ",638],["T_IF","if",639],["T_WHITESPACE"," ",639],"(",["T_VARIABLE","$item",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","getQty",639],"(",")",">",["T_LNUMBER","0",639],")",["T_WHITESPACE"," ",639],"{",["T_WHITESPACE","\n                ",639],["T_VARIABLE","$item",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","register",640],"(",")",";",["T_WHITESPACE","\n            ",640],"}",["T_WHITESPACE","\n            ",641],["T_ELSE","else",642],["T_WHITESPACE"," ",642],"{",["T_WHITESPACE","\n                ",642],["T_VARIABLE","$item",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","isDeleted",643],"(",["T_STRING","true",643],")",";",["T_WHITESPACE","\n            ",643],"}",["T_WHITESPACE","\n        ",644],"}",["T_WHITESPACE","\n\n        ",645],["T_VARIABLE","$order",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_VARIABLE","$this",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","getOrder",647],"(",")",";",["T_WHITESPACE","\n        ",647],["T_VARIABLE","$captureCase",648],["T_WHITESPACE"," ",648],"=",["T_WHITESPACE"," ",648],["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getRequestedCaptureCase",648],"(",")",";",["T_WHITESPACE","\n        ",648],["T_IF","if",649],["T_WHITESPACE"," ",649],"(",["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","canCapture",649],"(",")",")",["T_WHITESPACE"," ",649],"{",["T_WHITESPACE","\n            ",649],["T_IF","if",650],["T_WHITESPACE"," ",650],"(",["T_VARIABLE","$captureCase",650],")",["T_WHITESPACE"," ",650],"{",["T_WHITESPACE","\n                ",650],["T_IF","if",651],["T_WHITESPACE"," ",651],"(",["T_VARIABLE","$captureCase",651],["T_WHITESPACE"," ",651],["T_IS_EQUAL","==",651],["T_WHITESPACE"," ",651],["T_STRING","self",651],["T_DOUBLE_COLON","::",651],["T_STRING","CAPTURE_ONLINE",651],")",["T_WHITESPACE"," ",651],"{",["T_WHITESPACE","\n                    ",651],["T_VARIABLE","$this",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","capture",652],"(",")",";",["T_WHITESPACE","\n                ",652],"}",["T_WHITESPACE","\n                ",653],["T_ELSEIF","elseif",654],["T_WHITESPACE"," ",654],"(",["T_VARIABLE","$captureCase",654],["T_WHITESPACE"," ",654],["T_IS_EQUAL","==",654],["T_WHITESPACE"," ",654],["T_STRING","self",654],["T_DOUBLE_COLON","::",654],["T_STRING","CAPTURE_OFFLINE",654],")",["T_WHITESPACE"," ",654],"{",["T_WHITESPACE","\n                    ",654],["T_VARIABLE","$this",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","setCanVoidFlag",655],"(",["T_STRING","false",655],")",";",["T_WHITESPACE","\n                    ",655],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","pay",656],"(",")",";",["T_WHITESPACE","\n                ",656],"}",["T_WHITESPACE","\n            ",657],"}",["T_WHITESPACE","\n        ",658],"}",["T_WHITESPACE"," ",659],["T_ELSEIF","elseif",659],"(","!",["T_VARIABLE","$order",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","getPayment",659],"(",")",["T_OBJECT_OPERATOR","->",659],["T_STRING","getMethodInstance",659],"(",")",["T_OBJECT_OPERATOR","->",659],["T_STRING","isGateway",659],"(",")",["T_WHITESPACE"," ",659],["T_BOOLEAN_OR","||",659],["T_WHITESPACE"," ",659],["T_VARIABLE","$captureCase",659],["T_WHITESPACE"," ",659],["T_IS_EQUAL","==",659],["T_WHITESPACE"," ",659],["T_STRING","self",659],["T_DOUBLE_COLON","::",659],["T_STRING","CAPTURE_OFFLINE",659],")",["T_WHITESPACE"," ",659],"{",["T_WHITESPACE","\n            ",659],["T_IF","if",660],["T_WHITESPACE"," ",660],"(","!",["T_VARIABLE","$order",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","getPayment",660],"(",")",["T_OBJECT_OPERATOR","->",660],["T_STRING","getIsTransactionPending",660],"(",")",")",["T_WHITESPACE"," ",660],"{",["T_WHITESPACE","\n                ",660],["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","setCanVoidFlag",661],"(",["T_STRING","false",661],")",";",["T_WHITESPACE","\n                ",661],["T_VARIABLE","$this",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","pay",662],"(",")",";",["T_WHITESPACE","\n            ",662],"}",["T_WHITESPACE","\n        ",663],"}",["T_WHITESPACE","\n\n        ",664],["T_VARIABLE","$order",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","setTotalInvoiced",666],"(",["T_VARIABLE","$order",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getTotalInvoiced",666],"(",")",["T_WHITESPACE"," ",666],"+",["T_WHITESPACE"," ",666],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getGrandTotal",666],"(",")",")",";",["T_WHITESPACE","\n        ",666],["T_VARIABLE","$order",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","setBaseTotalInvoiced",667],"(",["T_VARIABLE","$order",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","getBaseTotalInvoiced",667],"(",")",["T_WHITESPACE"," ",667],"+",["T_WHITESPACE"," ",667],["T_VARIABLE","$this",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","getBaseGrandTotal",667],"(",")",")",";",["T_WHITESPACE","\n\n        ",667],["T_VARIABLE","$order",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","setSubtotalInvoiced",669],"(",["T_VARIABLE","$order",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getSubtotalInvoiced",669],"(",")",["T_WHITESPACE"," ",669],"+",["T_WHITESPACE"," ",669],["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getSubtotal",669],"(",")",")",";",["T_WHITESPACE","\n        ",669],["T_VARIABLE","$order",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","setBaseSubtotalInvoiced",670],"(",["T_VARIABLE","$order",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getBaseSubtotalInvoiced",670],"(",")",["T_WHITESPACE"," ",670],"+",["T_WHITESPACE"," ",670],["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getBaseSubtotal",670],"(",")",")",";",["T_WHITESPACE","\n\n        ",670],["T_VARIABLE","$order",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","setTaxInvoiced",672],"(",["T_VARIABLE","$order",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","getTaxInvoiced",672],"(",")",["T_WHITESPACE"," ",672],"+",["T_WHITESPACE"," ",672],["T_VARIABLE","$this",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","getTaxAmount",672],"(",")",")",";",["T_WHITESPACE","\n        ",672],["T_VARIABLE","$order",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","setBaseTaxInvoiced",673],"(",["T_VARIABLE","$order",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","getBaseTaxInvoiced",673],"(",")",["T_WHITESPACE"," ",673],"+",["T_WHITESPACE"," ",673],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","getBaseTaxAmount",673],"(",")",")",";",["T_WHITESPACE","\n\n        ",673],["T_VARIABLE","$order",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","setHiddenTaxInvoiced",675],"(",["T_VARIABLE","$order",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getHiddenTaxInvoiced",675],"(",")",["T_WHITESPACE"," ",675],"+",["T_WHITESPACE"," ",675],["T_VARIABLE","$this",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getHiddenTaxAmount",675],"(",")",")",";",["T_WHITESPACE","\n        ",675],["T_VARIABLE","$order",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","setBaseHiddenTaxInvoiced",676],"(",["T_VARIABLE","$order",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getBaseHiddenTaxInvoiced",676],"(",")",["T_WHITESPACE"," ",676],"+",["T_WHITESPACE"," ",676],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getBaseHiddenTaxAmount",676],"(",")",")",";",["T_WHITESPACE","\n\n        ",676],["T_VARIABLE","$order",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","setShippingTaxInvoiced",678],"(",["T_VARIABLE","$order",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getShippingTaxInvoiced",678],"(",")",["T_WHITESPACE"," ",678],"+",["T_WHITESPACE"," ",678],["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getShippingTaxAmount",678],"(",")",")",";",["T_WHITESPACE","\n        ",678],["T_VARIABLE","$order",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","setBaseShippingTaxInvoiced",679],"(",["T_VARIABLE","$order",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getBaseShippingTaxInvoiced",679],"(",")",["T_WHITESPACE"," ",679],"+",["T_WHITESPACE"," ",679],["T_VARIABLE","$this",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getBaseShippingTaxAmount",679],"(",")",")",";",["T_WHITESPACE","\n\n\n        ",679],["T_VARIABLE","$order",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","setShippingInvoiced",682],"(",["T_VARIABLE","$order",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getShippingInvoiced",682],"(",")",["T_WHITESPACE"," ",682],"+",["T_WHITESPACE"," ",682],["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getShippingAmount",682],"(",")",")",";",["T_WHITESPACE","\n        ",682],["T_VARIABLE","$order",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","setBaseShippingInvoiced",683],"(",["T_VARIABLE","$order",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getBaseShippingInvoiced",683],"(",")",["T_WHITESPACE"," ",683],"+",["T_WHITESPACE"," ",683],["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getBaseShippingAmount",683],"(",")",")",";",["T_WHITESPACE","\n\n        ",683],["T_VARIABLE","$order",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","setDiscountInvoiced",685],"(",["T_VARIABLE","$order",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","getDiscountInvoiced",685],"(",")",["T_WHITESPACE"," ",685],"+",["T_WHITESPACE"," ",685],["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","getDiscountAmount",685],"(",")",")",";",["T_WHITESPACE","\n        ",685],["T_VARIABLE","$order",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","setBaseDiscountInvoiced",686],"(",["T_VARIABLE","$order",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","getBaseDiscountInvoiced",686],"(",")",["T_WHITESPACE"," ",686],"+",["T_WHITESPACE"," ",686],["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","getBaseDiscountAmount",686],"(",")",")",";",["T_WHITESPACE","\n        ",686],["T_VARIABLE","$order",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","setBaseTotalInvoicedCost",687],"(",["T_VARIABLE","$order",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","getBaseTotalInvoicedCost",687],"(",")",["T_WHITESPACE"," ",687],"+",["T_WHITESPACE"," ",687],["T_VARIABLE","$this",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","getBaseCost",687],"(",")",")",";",["T_WHITESPACE","\n\n        ",687],["T_VARIABLE","$state",689],["T_WHITESPACE"," ",689],"=",["T_WHITESPACE"," ",689],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","getState",689],"(",")",";",["T_WHITESPACE","\n        ",689],["T_IF","if",690],["T_WHITESPACE"," ",690],"(",["T_STRING","is_null",690],"(",["T_VARIABLE","$state",690],")",")",["T_WHITESPACE"," ",690],"{",["T_WHITESPACE","\n            ",690],["T_VARIABLE","$this",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","setState",691],"(",["T_STRING","self",691],["T_DOUBLE_COLON","::",691],["T_STRING","STATE_OPEN",691],")",";",["T_WHITESPACE","\n        ",691],"}",["T_WHITESPACE","\n\n        ",692],["T_STRING","Mage",694],["T_DOUBLE_COLON","::",694],["T_STRING","dispatchEvent",694],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_invoice_register'",694],",",["T_WHITESPACE"," ",694],["T_ARRAY","array",694],"(",["T_VARIABLE","$this",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","_eventObject",694],["T_DOUBLE_ARROW","=>",694],["T_VARIABLE","$this",694],",",["T_WHITESPACE"," ",694],["T_CONSTANT_ENCAPSED_STRING","'order'",694],["T_WHITESPACE"," ",694],["T_DOUBLE_ARROW","=>",694],["T_WHITESPACE"," ",694],["T_VARIABLE","$order",694],")",")",";",["T_WHITESPACE","\n        ",694],["T_RETURN","return",695],["T_WHITESPACE"," ",695],["T_VARIABLE","$this",695],";",["T_WHITESPACE","\n    ",695],"}",["T_WHITESPACE","\n\n    ",696],["T_DOC_COMMENT","\/**\n     * Checking if the invoice is last\n     *\n     * @return bool\n     *\/",698],["T_WHITESPACE","\n    ",702],["T_PUBLIC","public",703],["T_WHITESPACE"," ",703],["T_FUNCTION","function",703],["T_WHITESPACE"," ",703],["T_STRING","isLast",703],"(",")",["T_WHITESPACE","\n    ",703],"{",["T_WHITESPACE","\n        ",704],["T_FOREACH","foreach",705],["T_WHITESPACE"," ",705],"(",["T_VARIABLE","$this",705],["T_OBJECT_OPERATOR","->",705],["T_STRING","getAllItems",705],"(",")",["T_WHITESPACE"," ",705],["T_AS","as",705],["T_WHITESPACE"," ",705],["T_VARIABLE","$item",705],")",["T_WHITESPACE"," ",705],"{",["T_WHITESPACE","\n            ",705],["T_IF","if",706],["T_WHITESPACE"," ",706],"(","!",["T_VARIABLE","$item",706],["T_OBJECT_OPERATOR","->",706],["T_STRING","isLast",706],"(",")",")",["T_WHITESPACE"," ",706],"{",["T_WHITESPACE","\n                ",706],["T_RETURN","return",707],["T_WHITESPACE"," ",707],["T_STRING","false",707],";",["T_WHITESPACE","\n            ",707],"}",["T_WHITESPACE","\n        ",708],"}",["T_WHITESPACE","\n        ",709],["T_RETURN","return",710],["T_WHITESPACE"," ",710],["T_STRING","true",710],";",["T_WHITESPACE","\n    ",710],"}",["T_WHITESPACE","\n\n    ",711],["T_DOC_COMMENT","\/**\n     * Adds comment to invoice with additional possibility to send it to customer via email\n     * and show it in customer account\n     *\n     * @param bool $notify\n     * @param bool $visibleOnFront\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",713],["T_WHITESPACE","\n    ",721],["T_PUBLIC","public",722],["T_WHITESPACE"," ",722],["T_FUNCTION","function",722],["T_WHITESPACE"," ",722],["T_STRING","addComment",722],"(",["T_VARIABLE","$comment",722],",",["T_WHITESPACE"," ",722],["T_VARIABLE","$notify",722],"=",["T_STRING","false",722],",",["T_WHITESPACE"," ",722],["T_VARIABLE","$visibleOnFront",722],"=",["T_STRING","false",722],")",["T_WHITESPACE","\n    ",722],"{",["T_WHITESPACE","\n        ",723],["T_IF","if",724],["T_WHITESPACE"," ",724],"(","!","(",["T_VARIABLE","$comment",724],["T_WHITESPACE"," ",724],["T_INSTANCEOF","instanceof",724],["T_WHITESPACE"," ",724],["T_STRING","Mage_Sales_Model_Order_Invoice_Comment",724],")",")",["T_WHITESPACE"," ",724],"{",["T_WHITESPACE","\n            ",724],["T_VARIABLE","$comment",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","Mage",725],["T_DOUBLE_COLON","::",725],["T_STRING","getModel",725],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice_comment'",725],")",["T_WHITESPACE","\n                ",725],["T_OBJECT_OPERATOR","->",726],["T_STRING","setComment",726],"(",["T_VARIABLE","$comment",726],")",["T_WHITESPACE","\n                ",726],["T_OBJECT_OPERATOR","->",727],["T_STRING","setIsCustomerNotified",727],"(",["T_VARIABLE","$notify",727],")",["T_WHITESPACE","\n                ",727],["T_OBJECT_OPERATOR","->",728],["T_STRING","setIsVisibleOnFront",728],"(",["T_VARIABLE","$visibleOnFront",728],")",";",["T_WHITESPACE","\n        ",728],"}",["T_WHITESPACE","\n        ",729],["T_VARIABLE","$comment",730],["T_OBJECT_OPERATOR","->",730],["T_STRING","setInvoice",730],"(",["T_VARIABLE","$this",730],")",["T_WHITESPACE","\n            ",730],["T_OBJECT_OPERATOR","->",731],["T_STRING","setStoreId",731],"(",["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getStoreId",731],"(",")",")",["T_WHITESPACE","\n            ",731],["T_OBJECT_OPERATOR","->",732],["T_STRING","setParentId",732],"(",["T_VARIABLE","$this",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","getId",732],"(",")",")",";",["T_WHITESPACE","\n        ",732],["T_IF","if",733],["T_WHITESPACE"," ",733],"(","!",["T_VARIABLE","$comment",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","getId",733],"(",")",")",["T_WHITESPACE"," ",733],"{",["T_WHITESPACE","\n            ",733],["T_VARIABLE","$this",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","getCommentsCollection",734],"(",")",["T_OBJECT_OPERATOR","->",734],["T_STRING","addItem",734],"(",["T_VARIABLE","$comment",734],")",";",["T_WHITESPACE","\n        ",734],"}",["T_WHITESPACE","\n        ",735],["T_VARIABLE","$this",736],["T_OBJECT_OPERATOR","->",736],["T_STRING","_hasDataChanges",736],["T_WHITESPACE"," ",736],"=",["T_WHITESPACE"," ",736],["T_STRING","true",736],";",["T_WHITESPACE","\n        ",736],["T_RETURN","return",737],["T_WHITESPACE"," ",737],["T_VARIABLE","$this",737],";",["T_WHITESPACE","\n    ",737],"}",["T_WHITESPACE","\n\n    ",738],["T_PUBLIC","public",740],["T_WHITESPACE"," ",740],["T_FUNCTION","function",740],["T_WHITESPACE"," ",740],["T_STRING","getCommentsCollection",740],"(",["T_VARIABLE","$reload",740],"=",["T_STRING","false",740],")",["T_WHITESPACE","\n    ",740],"{",["T_WHITESPACE","\n        ",741],["T_IF","if",742],["T_WHITESPACE"," ",742],"(",["T_STRING","is_null",742],"(",["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","_comments",742],")",["T_WHITESPACE"," ",742],["T_BOOLEAN_OR","||",742],["T_WHITESPACE"," ",742],["T_VARIABLE","$reload",742],")",["T_WHITESPACE"," ",742],"{",["T_WHITESPACE","\n            ",742],["T_VARIABLE","$this",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","_comments",743],["T_WHITESPACE"," ",743],"=",["T_WHITESPACE"," ",743],["T_STRING","Mage",743],["T_DOUBLE_COLON","::",743],["T_STRING","getResourceModel",743],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_invoice_comment_collection'",743],")",["T_WHITESPACE","\n                ",743],["T_OBJECT_OPERATOR","->",744],["T_STRING","setInvoiceFilter",744],"(",["T_VARIABLE","$this",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","getId",744],"(",")",")",["T_WHITESPACE","\n                ",744],["T_OBJECT_OPERATOR","->",745],["T_STRING","setCreatedAtOrder",745],"(",")",";",["T_WHITESPACE","\n            ",745],["T_DOC_COMMENT","\/**\n             * When invoice created with adding comment, comments collection\n             * must be loaded before we added this comment.\n             *\/",746],["T_WHITESPACE","\n            ",749],["T_VARIABLE","$this",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","_comments",750],["T_OBJECT_OPERATOR","->",750],["T_STRING","load",750],"(",")",";",["T_WHITESPACE","\n\n            ",750],["T_IF","if",752],["T_WHITESPACE"," ",752],"(",["T_VARIABLE","$this",752],["T_OBJECT_OPERATOR","->",752],["T_STRING","getId",752],"(",")",")",["T_WHITESPACE"," ",752],"{",["T_WHITESPACE","\n                ",752],["T_FOREACH","foreach",753],["T_WHITESPACE"," ",753],"(",["T_VARIABLE","$this",753],["T_OBJECT_OPERATOR","->",753],["T_STRING","_comments",753],["T_WHITESPACE"," ",753],["T_AS","as",753],["T_WHITESPACE"," ",753],["T_VARIABLE","$comment",753],")",["T_WHITESPACE"," ",753],"{",["T_WHITESPACE","\n                    ",753],["T_VARIABLE","$comment",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","setInvoice",754],"(",["T_VARIABLE","$this",754],")",";",["T_WHITESPACE","\n                ",754],"}",["T_WHITESPACE","\n            ",755],"}",["T_WHITESPACE","\n        ",756],"}",["T_WHITESPACE","\n        ",757],["T_RETURN","return",758],["T_WHITESPACE"," ",758],["T_VARIABLE","$this",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","_comments",758],";",["T_WHITESPACE","\n    ",758],"}",["T_WHITESPACE","\n\n    ",759],["T_DOC_COMMENT","\/**\n     * Send email with invoice data\n     *\n     * @param boolean $notifyCustomer\n     * @param string $comment\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",761],["T_WHITESPACE","\n    ",767],["T_PUBLIC","public",768],["T_WHITESPACE"," ",768],["T_FUNCTION","function",768],["T_WHITESPACE"," ",768],["T_STRING","sendEmail",768],"(",["T_VARIABLE","$notifyCustomer",768],["T_WHITESPACE"," ",768],"=",["T_WHITESPACE"," ",768],["T_STRING","true",768],",",["T_WHITESPACE"," ",768],["T_VARIABLE","$comment",768],["T_WHITESPACE"," ",768],"=",["T_WHITESPACE"," ",768],["T_CONSTANT_ENCAPSED_STRING","''",768],")",["T_WHITESPACE","\n    ",768],"{",["T_WHITESPACE","\n        ",769],["T_VARIABLE","$order",770],["T_WHITESPACE"," ",770],"=",["T_WHITESPACE"," ",770],["T_VARIABLE","$this",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","getOrder",770],"(",")",";",["T_WHITESPACE","\n        ",770],["T_VARIABLE","$storeId",771],["T_WHITESPACE"," ",771],"=",["T_WHITESPACE"," ",771],["T_VARIABLE","$order",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getStore",771],"(",")",["T_OBJECT_OPERATOR","->",771],["T_STRING","getId",771],"(",")",";",["T_WHITESPACE","\n\n        ",771],["T_IF","if",773],["T_WHITESPACE"," ",773],"(","!",["T_STRING","Mage",773],["T_DOUBLE_COLON","::",773],["T_STRING","helper",773],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",773],")",["T_OBJECT_OPERATOR","->",773],["T_STRING","canSendNewInvoiceEmail",773],"(",["T_VARIABLE","$storeId",773],")",")",["T_WHITESPACE"," ",773],"{",["T_WHITESPACE","\n            ",773],["T_RETURN","return",774],["T_WHITESPACE"," ",774],["T_VARIABLE","$this",774],";",["T_WHITESPACE","\n        ",774],"}",["T_WHITESPACE","\n        ",775],["T_COMMENT","\/\/ Get the destination email addresses to send copies to\n",776],["T_WHITESPACE","        ",777],["T_VARIABLE","$copyTo",777],["T_WHITESPACE"," ",777],"=",["T_WHITESPACE"," ",777],["T_VARIABLE","$this",777],["T_OBJECT_OPERATOR","->",777],["T_STRING","_getEmails",777],"(",["T_STRING","self",777],["T_DOUBLE_COLON","::",777],["T_STRING","XML_PATH_EMAIL_COPY_TO",777],")",";",["T_WHITESPACE","\n        ",777],["T_VARIABLE","$copyMethod",778],["T_WHITESPACE"," ",778],"=",["T_WHITESPACE"," ",778],["T_STRING","Mage",778],["T_DOUBLE_COLON","::",778],["T_STRING","getStoreConfig",778],"(",["T_STRING","self",778],["T_DOUBLE_COLON","::",778],["T_STRING","XML_PATH_EMAIL_COPY_METHOD",778],",",["T_WHITESPACE"," ",778],["T_VARIABLE","$storeId",778],")",";",["T_WHITESPACE","\n        ",778],["T_COMMENT","\/\/ Check if at least one recepient is found\n",779],["T_WHITESPACE","        ",780],["T_IF","if",780],["T_WHITESPACE"," ",780],"(","!",["T_VARIABLE","$notifyCustomer",780],["T_WHITESPACE"," ",780],["T_BOOLEAN_AND","&&",780],["T_WHITESPACE"," ",780],"!",["T_VARIABLE","$copyTo",780],")",["T_WHITESPACE"," ",780],"{",["T_WHITESPACE","\n            ",780],["T_RETURN","return",781],["T_WHITESPACE"," ",781],["T_VARIABLE","$this",781],";",["T_WHITESPACE","\n        ",781],"}",["T_WHITESPACE","\n\n        ",782],["T_COMMENT","\/\/ Start store emulation process\n",784],["T_WHITESPACE","        ",785],["T_VARIABLE","$appEmulation",785],["T_WHITESPACE"," ",785],"=",["T_WHITESPACE"," ",785],["T_STRING","Mage",785],["T_DOUBLE_COLON","::",785],["T_STRING","getSingleton",785],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/app_emulation'",785],")",";",["T_WHITESPACE","\n        ",785],["T_VARIABLE","$initialEnvironmentInfo",786],["T_WHITESPACE"," ",786],"=",["T_WHITESPACE"," ",786],["T_VARIABLE","$appEmulation",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","startEnvironmentEmulation",786],"(",["T_VARIABLE","$storeId",786],")",";",["T_WHITESPACE","\n\n        ",786],["T_TRY","try",788],["T_WHITESPACE"," ",788],"{",["T_WHITESPACE","\n            ",788],["T_COMMENT","\/\/ Retrieve specified view block from appropriate design package (depends on emulated store)\n",789],["T_WHITESPACE","            ",790],["T_VARIABLE","$paymentBlock",790],["T_WHITESPACE"," ",790],"=",["T_WHITESPACE"," ",790],["T_STRING","Mage",790],["T_DOUBLE_COLON","::",790],["T_STRING","helper",790],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",790],")",["T_OBJECT_OPERATOR","->",790],["T_STRING","getInfoBlock",790],"(",["T_VARIABLE","$order",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","getPayment",790],"(",")",")",["T_WHITESPACE","\n                ",790],["T_OBJECT_OPERATOR","->",791],["T_STRING","setIsSecureMode",791],"(",["T_STRING","true",791],")",";",["T_WHITESPACE","\n            ",791],["T_VARIABLE","$paymentBlock",792],["T_OBJECT_OPERATOR","->",792],["T_STRING","getMethod",792],"(",")",["T_OBJECT_OPERATOR","->",792],["T_STRING","setStore",792],"(",["T_VARIABLE","$storeId",792],")",";",["T_WHITESPACE","\n            ",792],["T_VARIABLE","$paymentBlockHtml",793],["T_WHITESPACE"," ",793],"=",["T_WHITESPACE"," ",793],["T_VARIABLE","$paymentBlock",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","toHtml",793],"(",")",";",["T_WHITESPACE","\n        ",793],"}",["T_WHITESPACE"," ",794],["T_CATCH","catch",794],["T_WHITESPACE"," ",794],"(",["T_STRING","Exception",794],["T_WHITESPACE"," ",794],["T_VARIABLE","$exception",794],")",["T_WHITESPACE"," ",794],"{",["T_WHITESPACE","\n            ",794],["T_COMMENT","\/\/ Stop store emulation process\n",795],["T_WHITESPACE","            ",796],["T_VARIABLE","$appEmulation",796],["T_OBJECT_OPERATOR","->",796],["T_STRING","stopEnvironmentEmulation",796],"(",["T_VARIABLE","$initialEnvironmentInfo",796],")",";",["T_WHITESPACE","\n            ",796],["T_THROW","throw",797],["T_WHITESPACE"," ",797],["T_VARIABLE","$exception",797],";",["T_WHITESPACE","\n        ",797],"}",["T_WHITESPACE","\n\n        ",798],["T_COMMENT","\/\/ Stop store emulation process\n",800],["T_WHITESPACE","        ",801],["T_VARIABLE","$appEmulation",801],["T_OBJECT_OPERATOR","->",801],["T_STRING","stopEnvironmentEmulation",801],"(",["T_VARIABLE","$initialEnvironmentInfo",801],")",";",["T_WHITESPACE","\n\n        ",801],["T_COMMENT","\/\/ Retrieve corresponding email template id and customer name\n",803],["T_WHITESPACE","        ",804],["T_IF","if",804],["T_WHITESPACE"," ",804],"(",["T_VARIABLE","$order",804],["T_OBJECT_OPERATOR","->",804],["T_STRING","getCustomerIsGuest",804],"(",")",")",["T_WHITESPACE"," ",804],"{",["T_WHITESPACE","\n            ",804],["T_VARIABLE","$templateId",805],["T_WHITESPACE"," ",805],"=",["T_WHITESPACE"," ",805],["T_STRING","Mage",805],["T_DOUBLE_COLON","::",805],["T_STRING","getStoreConfig",805],"(",["T_STRING","self",805],["T_DOUBLE_COLON","::",805],["T_STRING","XML_PATH_EMAIL_GUEST_TEMPLATE",805],",",["T_WHITESPACE"," ",805],["T_VARIABLE","$storeId",805],")",";",["T_WHITESPACE","\n            ",805],["T_VARIABLE","$customerName",806],["T_WHITESPACE"," ",806],"=",["T_WHITESPACE"," ",806],["T_VARIABLE","$order",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getBillingAddress",806],"(",")",["T_OBJECT_OPERATOR","->",806],["T_STRING","getName",806],"(",")",";",["T_WHITESPACE","\n        ",806],"}",["T_WHITESPACE"," ",807],["T_ELSE","else",807],["T_WHITESPACE"," ",807],"{",["T_WHITESPACE","\n            ",807],["T_VARIABLE","$templateId",808],["T_WHITESPACE"," ",808],"=",["T_WHITESPACE"," ",808],["T_STRING","Mage",808],["T_DOUBLE_COLON","::",808],["T_STRING","getStoreConfig",808],"(",["T_STRING","self",808],["T_DOUBLE_COLON","::",808],["T_STRING","XML_PATH_EMAIL_TEMPLATE",808],",",["T_WHITESPACE"," ",808],["T_VARIABLE","$storeId",808],")",";",["T_WHITESPACE","\n            ",808],["T_VARIABLE","$customerName",809],["T_WHITESPACE"," ",809],"=",["T_WHITESPACE"," ",809],["T_VARIABLE","$order",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getCustomerName",809],"(",")",";",["T_WHITESPACE","\n        ",809],"}",["T_WHITESPACE","\n\n        ",810],["T_VARIABLE","$mailer",812],["T_WHITESPACE"," ",812],"=",["T_WHITESPACE"," ",812],["T_STRING","Mage",812],["T_DOUBLE_COLON","::",812],["T_STRING","getModel",812],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template_mailer'",812],")",";",["T_WHITESPACE","\n        ",812],["T_IF","if",813],["T_WHITESPACE"," ",813],"(",["T_VARIABLE","$notifyCustomer",813],")",["T_WHITESPACE"," ",813],"{",["T_WHITESPACE","\n            ",813],["T_VARIABLE","$emailInfo",814],["T_WHITESPACE"," ",814],"=",["T_WHITESPACE"," ",814],["T_STRING","Mage",814],["T_DOUBLE_COLON","::",814],["T_STRING","getModel",814],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",814],")",";",["T_WHITESPACE","\n            ",814],["T_VARIABLE","$emailInfo",815],["T_OBJECT_OPERATOR","->",815],["T_STRING","addTo",815],"(",["T_VARIABLE","$order",815],["T_OBJECT_OPERATOR","->",815],["T_STRING","getCustomerEmail",815],"(",")",",",["T_WHITESPACE"," ",815],["T_VARIABLE","$customerName",815],")",";",["T_WHITESPACE","\n            ",815],["T_IF","if",816],["T_WHITESPACE"," ",816],"(",["T_VARIABLE","$copyTo",816],["T_WHITESPACE"," ",816],["T_BOOLEAN_AND","&&",816],["T_WHITESPACE"," ",816],["T_VARIABLE","$copyMethod",816],["T_WHITESPACE"," ",816],["T_IS_EQUAL","==",816],["T_WHITESPACE"," ",816],["T_CONSTANT_ENCAPSED_STRING","'bcc'",816],")",["T_WHITESPACE"," ",816],"{",["T_WHITESPACE","\n                ",816],["T_COMMENT","\/\/ Add bcc to customer email\n",817],["T_WHITESPACE","                ",818],["T_FOREACH","foreach",818],["T_WHITESPACE"," ",818],"(",["T_VARIABLE","$copyTo",818],["T_WHITESPACE"," ",818],["T_AS","as",818],["T_WHITESPACE"," ",818],["T_VARIABLE","$email",818],")",["T_WHITESPACE"," ",818],"{",["T_WHITESPACE","\n                    ",818],["T_VARIABLE","$emailInfo",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","addBcc",819],"(",["T_VARIABLE","$email",819],")",";",["T_WHITESPACE","\n                ",819],"}",["T_WHITESPACE","\n            ",820],"}",["T_WHITESPACE","\n            ",821],["T_VARIABLE","$mailer",822],["T_OBJECT_OPERATOR","->",822],["T_STRING","addEmailInfo",822],"(",["T_VARIABLE","$emailInfo",822],")",";",["T_WHITESPACE","\n        ",822],"}",["T_WHITESPACE","\n\n        ",823],["T_COMMENT","\/\/ Email copies are sent as separated emails if their copy method is 'copy' or a customer should not be notified\n",825],["T_WHITESPACE","        ",826],["T_IF","if",826],["T_WHITESPACE"," ",826],"(",["T_VARIABLE","$copyTo",826],["T_WHITESPACE"," ",826],["T_BOOLEAN_AND","&&",826],["T_WHITESPACE"," ",826],"(",["T_VARIABLE","$copyMethod",826],["T_WHITESPACE"," ",826],["T_IS_EQUAL","==",826],["T_WHITESPACE"," ",826],["T_CONSTANT_ENCAPSED_STRING","'copy'",826],["T_WHITESPACE"," ",826],["T_BOOLEAN_OR","||",826],["T_WHITESPACE"," ",826],"!",["T_VARIABLE","$notifyCustomer",826],")",")",["T_WHITESPACE"," ",826],"{",["T_WHITESPACE","\n            ",826],["T_FOREACH","foreach",827],["T_WHITESPACE"," ",827],"(",["T_VARIABLE","$copyTo",827],["T_WHITESPACE"," ",827],["T_AS","as",827],["T_WHITESPACE"," ",827],["T_VARIABLE","$email",827],")",["T_WHITESPACE"," ",827],"{",["T_WHITESPACE","\n                ",827],["T_VARIABLE","$emailInfo",828],["T_WHITESPACE"," ",828],"=",["T_WHITESPACE"," ",828],["T_STRING","Mage",828],["T_DOUBLE_COLON","::",828],["T_STRING","getModel",828],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",828],")",";",["T_WHITESPACE","\n                ",828],["T_VARIABLE","$emailInfo",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","addTo",829],"(",["T_VARIABLE","$email",829],")",";",["T_WHITESPACE","\n                ",829],["T_VARIABLE","$mailer",830],["T_OBJECT_OPERATOR","->",830],["T_STRING","addEmailInfo",830],"(",["T_VARIABLE","$emailInfo",830],")",";",["T_WHITESPACE","\n            ",830],"}",["T_WHITESPACE","\n        ",831],"}",["T_WHITESPACE","\n\n        ",832],["T_COMMENT","\/\/ Set all required params and send emails\n",834],["T_WHITESPACE","        ",835],["T_VARIABLE","$mailer",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","setSender",835],"(",["T_STRING","Mage",835],["T_DOUBLE_COLON","::",835],["T_STRING","getStoreConfig",835],"(",["T_STRING","self",835],["T_DOUBLE_COLON","::",835],["T_STRING","XML_PATH_EMAIL_IDENTITY",835],",",["T_WHITESPACE"," ",835],["T_VARIABLE","$storeId",835],")",")",";",["T_WHITESPACE","\n        ",835],["T_VARIABLE","$mailer",836],["T_OBJECT_OPERATOR","->",836],["T_STRING","setStoreId",836],"(",["T_VARIABLE","$storeId",836],")",";",["T_WHITESPACE","\n        ",836],["T_VARIABLE","$mailer",837],["T_OBJECT_OPERATOR","->",837],["T_STRING","setTemplateId",837],"(",["T_VARIABLE","$templateId",837],")",";",["T_WHITESPACE","\n        ",837],["T_VARIABLE","$mailer",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","setTemplateParams",838],"(",["T_ARRAY","array",838],"(",["T_WHITESPACE","\n                ",838],["T_CONSTANT_ENCAPSED_STRING","'order'",839],["T_WHITESPACE","        ",839],["T_DOUBLE_ARROW","=>",839],["T_WHITESPACE"," ",839],["T_VARIABLE","$order",839],",",["T_WHITESPACE","\n                ",839],["T_CONSTANT_ENCAPSED_STRING","'invoice'",840],["T_WHITESPACE","      ",840],["T_DOUBLE_ARROW","=>",840],["T_WHITESPACE"," ",840],["T_VARIABLE","$this",840],",",["T_WHITESPACE","\n                ",840],["T_CONSTANT_ENCAPSED_STRING","'comment'",841],["T_WHITESPACE","      ",841],["T_DOUBLE_ARROW","=>",841],["T_WHITESPACE"," ",841],["T_VARIABLE","$comment",841],",",["T_WHITESPACE","\n                ",841],["T_CONSTANT_ENCAPSED_STRING","'billing'",842],["T_WHITESPACE","      ",842],["T_DOUBLE_ARROW","=>",842],["T_WHITESPACE"," ",842],["T_VARIABLE","$order",842],["T_OBJECT_OPERATOR","->",842],["T_STRING","getBillingAddress",842],"(",")",",",["T_WHITESPACE","\n                ",842],["T_CONSTANT_ENCAPSED_STRING","'payment_html'",843],["T_WHITESPACE"," ",843],["T_DOUBLE_ARROW","=>",843],["T_WHITESPACE"," ",843],["T_VARIABLE","$paymentBlockHtml",843],["T_WHITESPACE","\n            ",843],")",["T_WHITESPACE","\n        ",844],")",";",["T_WHITESPACE","\n        ",845],["T_VARIABLE","$mailer",846],["T_OBJECT_OPERATOR","->",846],["T_STRING","send",846],"(",")",";",["T_WHITESPACE","\n        ",846],["T_VARIABLE","$this",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","setEmailSent",847],"(",["T_STRING","true",847],")",";",["T_WHITESPACE","\n        ",847],["T_VARIABLE","$this",848],["T_OBJECT_OPERATOR","->",848],["T_STRING","_getResource",848],"(",")",["T_OBJECT_OPERATOR","->",848],["T_STRING","saveAttribute",848],"(",["T_VARIABLE","$this",848],",",["T_WHITESPACE"," ",848],["T_CONSTANT_ENCAPSED_STRING","'email_sent'",848],")",";",["T_WHITESPACE","\n\n        ",848],["T_RETURN","return",850],["T_WHITESPACE"," ",850],["T_VARIABLE","$this",850],";",["T_WHITESPACE","\n    ",850],"}",["T_WHITESPACE","\n\n    ",851],["T_DOC_COMMENT","\/**\n     * Send email with invoice update information\n     *\n     * @param boolean $notifyCustomer\n     * @param string $comment\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",853],["T_WHITESPACE","\n    ",859],["T_PUBLIC","public",860],["T_WHITESPACE"," ",860],["T_FUNCTION","function",860],["T_WHITESPACE"," ",860],["T_STRING","sendUpdateEmail",860],"(",["T_VARIABLE","$notifyCustomer",860],["T_WHITESPACE"," ",860],"=",["T_WHITESPACE"," ",860],["T_STRING","true",860],",",["T_WHITESPACE"," ",860],["T_VARIABLE","$comment",860],["T_WHITESPACE"," ",860],"=",["T_WHITESPACE"," ",860],["T_CONSTANT_ENCAPSED_STRING","''",860],")",["T_WHITESPACE","\n    ",860],"{",["T_WHITESPACE","\n        ",861],["T_VARIABLE","$order",862],["T_WHITESPACE"," ",862],"=",["T_WHITESPACE"," ",862],["T_VARIABLE","$this",862],["T_OBJECT_OPERATOR","->",862],["T_STRING","getOrder",862],"(",")",";",["T_WHITESPACE","\n        ",862],["T_VARIABLE","$storeId",863],["T_WHITESPACE"," ",863],"=",["T_WHITESPACE"," ",863],["T_VARIABLE","$order",863],["T_OBJECT_OPERATOR","->",863],["T_STRING","getStore",863],"(",")",["T_OBJECT_OPERATOR","->",863],["T_STRING","getId",863],"(",")",";",["T_WHITESPACE","\n\n        ",863],["T_IF","if",865],["T_WHITESPACE"," ",865],"(","!",["T_STRING","Mage",865],["T_DOUBLE_COLON","::",865],["T_STRING","helper",865],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",865],")",["T_OBJECT_OPERATOR","->",865],["T_STRING","canSendInvoiceCommentEmail",865],"(",["T_VARIABLE","$storeId",865],")",")",["T_WHITESPACE"," ",865],"{",["T_WHITESPACE","\n            ",865],["T_RETURN","return",866],["T_WHITESPACE"," ",866],["T_VARIABLE","$this",866],";",["T_WHITESPACE","\n        ",866],"}",["T_WHITESPACE","\n        ",867],["T_COMMENT","\/\/ Get the destination email addresses to send copies to\n",868],["T_WHITESPACE","        ",869],["T_VARIABLE","$copyTo",869],["T_WHITESPACE"," ",869],"=",["T_WHITESPACE"," ",869],["T_VARIABLE","$this",869],["T_OBJECT_OPERATOR","->",869],["T_STRING","_getEmails",869],"(",["T_STRING","self",869],["T_DOUBLE_COLON","::",869],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_TO",869],")",";",["T_WHITESPACE","\n        ",869],["T_VARIABLE","$copyMethod",870],["T_WHITESPACE"," ",870],"=",["T_WHITESPACE"," ",870],["T_STRING","Mage",870],["T_DOUBLE_COLON","::",870],["T_STRING","getStoreConfig",870],"(",["T_STRING","self",870],["T_DOUBLE_COLON","::",870],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_METHOD",870],",",["T_WHITESPACE"," ",870],["T_VARIABLE","$storeId",870],")",";",["T_WHITESPACE","\n        ",870],["T_COMMENT","\/\/ Check if at least one recepient is found\n",871],["T_WHITESPACE","        ",872],["T_IF","if",872],["T_WHITESPACE"," ",872],"(","!",["T_VARIABLE","$notifyCustomer",872],["T_WHITESPACE"," ",872],["T_BOOLEAN_AND","&&",872],["T_WHITESPACE"," ",872],"!",["T_VARIABLE","$copyTo",872],")",["T_WHITESPACE"," ",872],"{",["T_WHITESPACE","\n            ",872],["T_RETURN","return",873],["T_WHITESPACE"," ",873],["T_VARIABLE","$this",873],";",["T_WHITESPACE","\n        ",873],"}",["T_WHITESPACE","\n\n        ",874],["T_COMMENT","\/\/ Retrieve corresponding email template id and customer name\n",876],["T_WHITESPACE","        ",877],["T_IF","if",877],["T_WHITESPACE"," ",877],"(",["T_VARIABLE","$order",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","getCustomerIsGuest",877],"(",")",")",["T_WHITESPACE"," ",877],"{",["T_WHITESPACE","\n            ",877],["T_VARIABLE","$templateId",878],["T_WHITESPACE"," ",878],"=",["T_WHITESPACE"," ",878],["T_STRING","Mage",878],["T_DOUBLE_COLON","::",878],["T_STRING","getStoreConfig",878],"(",["T_STRING","self",878],["T_DOUBLE_COLON","::",878],["T_STRING","XML_PATH_UPDATE_EMAIL_GUEST_TEMPLATE",878],",",["T_WHITESPACE"," ",878],["T_VARIABLE","$storeId",878],")",";",["T_WHITESPACE","\n            ",878],["T_VARIABLE","$customerName",879],["T_WHITESPACE"," ",879],"=",["T_WHITESPACE"," ",879],["T_VARIABLE","$order",879],["T_OBJECT_OPERATOR","->",879],["T_STRING","getBillingAddress",879],"(",")",["T_OBJECT_OPERATOR","->",879],["T_STRING","getName",879],"(",")",";",["T_WHITESPACE","\n        ",879],"}",["T_WHITESPACE"," ",880],["T_ELSE","else",880],["T_WHITESPACE"," ",880],"{",["T_WHITESPACE","\n            ",880],["T_VARIABLE","$templateId",881],["T_WHITESPACE"," ",881],"=",["T_WHITESPACE"," ",881],["T_STRING","Mage",881],["T_DOUBLE_COLON","::",881],["T_STRING","getStoreConfig",881],"(",["T_STRING","self",881],["T_DOUBLE_COLON","::",881],["T_STRING","XML_PATH_UPDATE_EMAIL_TEMPLATE",881],",",["T_WHITESPACE"," ",881],["T_VARIABLE","$storeId",881],")",";",["T_WHITESPACE","\n            ",881],["T_VARIABLE","$customerName",882],["T_WHITESPACE"," ",882],"=",["T_WHITESPACE"," ",882],["T_VARIABLE","$order",882],["T_OBJECT_OPERATOR","->",882],["T_STRING","getCustomerName",882],"(",")",";",["T_WHITESPACE","\n        ",882],"}",["T_WHITESPACE","\n\n        ",883],["T_VARIABLE","$mailer",885],["T_WHITESPACE"," ",885],"=",["T_WHITESPACE"," ",885],["T_STRING","Mage",885],["T_DOUBLE_COLON","::",885],["T_STRING","getModel",885],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template_mailer'",885],")",";",["T_WHITESPACE","\n        ",885],["T_IF","if",886],["T_WHITESPACE"," ",886],"(",["T_VARIABLE","$notifyCustomer",886],")",["T_WHITESPACE"," ",886],"{",["T_WHITESPACE","\n            ",886],["T_VARIABLE","$emailInfo",887],["T_WHITESPACE"," ",887],"=",["T_WHITESPACE"," ",887],["T_STRING","Mage",887],["T_DOUBLE_COLON","::",887],["T_STRING","getModel",887],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",887],")",";",["T_WHITESPACE","\n            ",887],["T_VARIABLE","$emailInfo",888],["T_OBJECT_OPERATOR","->",888],["T_STRING","addTo",888],"(",["T_VARIABLE","$order",888],["T_OBJECT_OPERATOR","->",888],["T_STRING","getCustomerEmail",888],"(",")",",",["T_WHITESPACE"," ",888],["T_VARIABLE","$customerName",888],")",";",["T_WHITESPACE","\n            ",888],["T_IF","if",889],["T_WHITESPACE"," ",889],"(",["T_VARIABLE","$copyTo",889],["T_WHITESPACE"," ",889],["T_BOOLEAN_AND","&&",889],["T_WHITESPACE"," ",889],["T_VARIABLE","$copyMethod",889],["T_WHITESPACE"," ",889],["T_IS_EQUAL","==",889],["T_WHITESPACE"," ",889],["T_CONSTANT_ENCAPSED_STRING","'bcc'",889],")",["T_WHITESPACE"," ",889],"{",["T_WHITESPACE","\n                ",889],["T_COMMENT","\/\/ Add bcc to customer email\n",890],["T_WHITESPACE","                ",891],["T_FOREACH","foreach",891],["T_WHITESPACE"," ",891],"(",["T_VARIABLE","$copyTo",891],["T_WHITESPACE"," ",891],["T_AS","as",891],["T_WHITESPACE"," ",891],["T_VARIABLE","$email",891],")",["T_WHITESPACE"," ",891],"{",["T_WHITESPACE","\n                    ",891],["T_VARIABLE","$emailInfo",892],["T_OBJECT_OPERATOR","->",892],["T_STRING","addBcc",892],"(",["T_VARIABLE","$email",892],")",";",["T_WHITESPACE","\n                ",892],"}",["T_WHITESPACE","\n            ",893],"}",["T_WHITESPACE","\n            ",894],["T_VARIABLE","$mailer",895],["T_OBJECT_OPERATOR","->",895],["T_STRING","addEmailInfo",895],"(",["T_VARIABLE","$emailInfo",895],")",";",["T_WHITESPACE","\n        ",895],"}",["T_WHITESPACE","\n\n        ",896],["T_COMMENT","\/\/ Email copies are sent as separated emails if their copy method is 'copy' or a customer should not be notified\n",898],["T_WHITESPACE","        ",899],["T_IF","if",899],["T_WHITESPACE"," ",899],"(",["T_VARIABLE","$copyTo",899],["T_WHITESPACE"," ",899],["T_BOOLEAN_AND","&&",899],["T_WHITESPACE"," ",899],"(",["T_VARIABLE","$copyMethod",899],["T_WHITESPACE"," ",899],["T_IS_EQUAL","==",899],["T_WHITESPACE"," ",899],["T_CONSTANT_ENCAPSED_STRING","'copy'",899],["T_WHITESPACE"," ",899],["T_BOOLEAN_OR","||",899],["T_WHITESPACE"," ",899],"!",["T_VARIABLE","$notifyCustomer",899],")",")",["T_WHITESPACE"," ",899],"{",["T_WHITESPACE","\n            ",899],["T_FOREACH","foreach",900],["T_WHITESPACE"," ",900],"(",["T_VARIABLE","$copyTo",900],["T_WHITESPACE"," ",900],["T_AS","as",900],["T_WHITESPACE"," ",900],["T_VARIABLE","$email",900],")",["T_WHITESPACE"," ",900],"{",["T_WHITESPACE","\n                ",900],["T_VARIABLE","$emailInfo",901],["T_WHITESPACE"," ",901],"=",["T_WHITESPACE"," ",901],["T_STRING","Mage",901],["T_DOUBLE_COLON","::",901],["T_STRING","getModel",901],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",901],")",";",["T_WHITESPACE","\n                ",901],["T_VARIABLE","$emailInfo",902],["T_OBJECT_OPERATOR","->",902],["T_STRING","addTo",902],"(",["T_VARIABLE","$email",902],")",";",["T_WHITESPACE","\n                ",902],["T_VARIABLE","$mailer",903],["T_OBJECT_OPERATOR","->",903],["T_STRING","addEmailInfo",903],"(",["T_VARIABLE","$emailInfo",903],")",";",["T_WHITESPACE","\n            ",903],"}",["T_WHITESPACE","\n        ",904],"}",["T_WHITESPACE","\n\n        ",905],["T_COMMENT","\/\/ Set all required params and send emails\n",907],["T_WHITESPACE","        ",908],["T_VARIABLE","$mailer",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","setSender",908],"(",["T_STRING","Mage",908],["T_DOUBLE_COLON","::",908],["T_STRING","getStoreConfig",908],"(",["T_STRING","self",908],["T_DOUBLE_COLON","::",908],["T_STRING","XML_PATH_UPDATE_EMAIL_IDENTITY",908],",",["T_WHITESPACE"," ",908],["T_VARIABLE","$storeId",908],")",")",";",["T_WHITESPACE","\n        ",908],["T_VARIABLE","$mailer",909],["T_OBJECT_OPERATOR","->",909],["T_STRING","setStoreId",909],"(",["T_VARIABLE","$storeId",909],")",";",["T_WHITESPACE","\n        ",909],["T_VARIABLE","$mailer",910],["T_OBJECT_OPERATOR","->",910],["T_STRING","setTemplateId",910],"(",["T_VARIABLE","$templateId",910],")",";",["T_WHITESPACE","\n        ",910],["T_VARIABLE","$mailer",911],["T_OBJECT_OPERATOR","->",911],["T_STRING","setTemplateParams",911],"(",["T_ARRAY","array",911],"(",["T_WHITESPACE","\n                ",911],["T_CONSTANT_ENCAPSED_STRING","'order'",912],["T_WHITESPACE","        ",912],["T_DOUBLE_ARROW","=>",912],["T_WHITESPACE"," ",912],["T_VARIABLE","$order",912],",",["T_WHITESPACE","\n                ",912],["T_CONSTANT_ENCAPSED_STRING","'invoice'",913],["T_WHITESPACE","      ",913],["T_DOUBLE_ARROW","=>",913],["T_WHITESPACE"," ",913],["T_VARIABLE","$this",913],",",["T_WHITESPACE","\n                ",913],["T_CONSTANT_ENCAPSED_STRING","'comment'",914],["T_WHITESPACE","      ",914],["T_DOUBLE_ARROW","=>",914],["T_WHITESPACE"," ",914],["T_VARIABLE","$comment",914],",",["T_WHITESPACE","\n                ",914],["T_CONSTANT_ENCAPSED_STRING","'billing'",915],["T_WHITESPACE","      ",915],["T_DOUBLE_ARROW","=>",915],["T_WHITESPACE"," ",915],["T_VARIABLE","$order",915],["T_OBJECT_OPERATOR","->",915],["T_STRING","getBillingAddress",915],"(",")",["T_WHITESPACE","\n            ",915],")",["T_WHITESPACE","\n        ",916],")",";",["T_WHITESPACE","\n        ",917],["T_VARIABLE","$mailer",918],["T_OBJECT_OPERATOR","->",918],["T_STRING","send",918],"(",")",";",["T_WHITESPACE","\n\n        ",918],["T_RETURN","return",920],["T_WHITESPACE"," ",920],["T_VARIABLE","$this",920],";",["T_WHITESPACE","\n    ",920],"}",["T_WHITESPACE","\n\n    ",921],["T_PROTECTED","protected",923],["T_WHITESPACE"," ",923],["T_FUNCTION","function",923],["T_WHITESPACE"," ",923],["T_STRING","_getEmails",923],"(",["T_VARIABLE","$configPath",923],")",["T_WHITESPACE","\n    ",923],"{",["T_WHITESPACE","\n        ",924],["T_VARIABLE","$data",925],["T_WHITESPACE"," ",925],"=",["T_WHITESPACE"," ",925],["T_STRING","Mage",925],["T_DOUBLE_COLON","::",925],["T_STRING","getStoreConfig",925],"(",["T_VARIABLE","$configPath",925],",",["T_WHITESPACE"," ",925],["T_VARIABLE","$this",925],["T_OBJECT_OPERATOR","->",925],["T_STRING","getStoreId",925],"(",")",")",";",["T_WHITESPACE","\n        ",925],["T_IF","if",926],["T_WHITESPACE"," ",926],"(","!",["T_EMPTY","empty",926],"(",["T_VARIABLE","$data",926],")",")",["T_WHITESPACE"," ",926],"{",["T_WHITESPACE","\n            ",926],["T_RETURN","return",927],["T_WHITESPACE"," ",927],["T_STRING","explode",927],"(",["T_CONSTANT_ENCAPSED_STRING","','",927],",",["T_WHITESPACE"," ",927],["T_VARIABLE","$data",927],")",";",["T_WHITESPACE","\n        ",927],"}",["T_WHITESPACE","\n        ",928],["T_RETURN","return",929],["T_WHITESPACE"," ",929],["T_STRING","false",929],";",["T_WHITESPACE","\n    ",929],"}",["T_WHITESPACE","\n\n    ",930],["T_PROTECTED","protected",932],["T_WHITESPACE"," ",932],["T_FUNCTION","function",932],["T_WHITESPACE"," ",932],["T_STRING","_beforeDelete",932],"(",")",["T_WHITESPACE","\n    ",932],"{",["T_WHITESPACE","\n        ",933],["T_VARIABLE","$this",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","_protectFromNonAdmin",934],"(",")",";",["T_WHITESPACE","\n        ",934],["T_RETURN","return",935],["T_WHITESPACE"," ",935],["T_STRING","parent",935],["T_DOUBLE_COLON","::",935],["T_STRING","_beforeDelete",935],"(",")",";",["T_WHITESPACE","\n    ",935],"}",["T_WHITESPACE","\n\n    ",936],["T_DOC_COMMENT","\/**\n     * Reset invoice object\n     *\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",938],["T_WHITESPACE","\n    ",942],["T_PUBLIC","public",943],["T_WHITESPACE"," ",943],["T_FUNCTION","function",943],["T_WHITESPACE"," ",943],["T_STRING","reset",943],"(",")",["T_WHITESPACE","\n    ",943],"{",["T_WHITESPACE","\n        ",944],["T_VARIABLE","$this",945],["T_OBJECT_OPERATOR","->",945],["T_STRING","unsetData",945],"(",")",";",["T_WHITESPACE","\n        ",945],["T_VARIABLE","$this",946],["T_OBJECT_OPERATOR","->",946],["T_STRING","_origData",946],["T_WHITESPACE"," ",946],"=",["T_WHITESPACE"," ",946],["T_STRING","null",946],";",["T_WHITESPACE","\n        ",946],["T_VARIABLE","$this",947],["T_OBJECT_OPERATOR","->",947],["T_STRING","_items",947],["T_WHITESPACE"," ",947],"=",["T_WHITESPACE"," ",947],["T_STRING","null",947],";",["T_WHITESPACE","\n        ",947],["T_VARIABLE","$this",948],["T_OBJECT_OPERATOR","->",948],["T_STRING","_comments",948],["T_WHITESPACE"," ",948],"=",["T_WHITESPACE"," ",948],["T_STRING","null",948],";",["T_WHITESPACE","\n        ",948],["T_VARIABLE","$this",949],["T_OBJECT_OPERATOR","->",949],["T_STRING","_order",949],["T_WHITESPACE"," ",949],"=",["T_WHITESPACE"," ",949],["T_STRING","null",949],";",["T_WHITESPACE","\n        ",949],["T_VARIABLE","$this",950],["T_OBJECT_OPERATOR","->",950],["T_STRING","_saveBeforeDestruct",950],["T_WHITESPACE"," ",950],"=",["T_WHITESPACE"," ",950],["T_STRING","false",950],";",["T_WHITESPACE","\n        ",950],["T_VARIABLE","$this",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","_wasPayCalled",951],["T_WHITESPACE"," ",951],"=",["T_WHITESPACE"," ",951],["T_STRING","false",951],";",["T_WHITESPACE","\n        ",951],["T_RETURN","return",952],["T_WHITESPACE"," ",952],["T_VARIABLE","$this",952],";",["T_WHITESPACE","\n    ",952],"}",["T_WHITESPACE","\n\n    ",953],["T_DOC_COMMENT","\/**\n     * Before object save manipulations\n     *\n     * @return Mage_Sales_Model_Order_Shipment\n     *\/",955],["T_WHITESPACE","\n    ",959],["T_PROTECTED","protected",960],["T_WHITESPACE"," ",960],["T_FUNCTION","function",960],["T_WHITESPACE"," ",960],["T_STRING","_beforeSave",960],"(",")",["T_WHITESPACE","\n    ",960],"{",["T_WHITESPACE","\n        ",961],["T_STRING","parent",962],["T_DOUBLE_COLON","::",962],["T_STRING","_beforeSave",962],"(",")",";",["T_WHITESPACE","\n\n        ",962],["T_IF","if",964],["T_WHITESPACE"," ",964],"(","!",["T_VARIABLE","$this",964],["T_OBJECT_OPERATOR","->",964],["T_STRING","getOrderId",964],"(",")",["T_WHITESPACE"," ",964],["T_BOOLEAN_AND","&&",964],["T_WHITESPACE"," ",964],["T_VARIABLE","$this",964],["T_OBJECT_OPERATOR","->",964],["T_STRING","getOrder",964],"(",")",")",["T_WHITESPACE"," ",964],"{",["T_WHITESPACE","\n            ",964],["T_VARIABLE","$this",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","setOrderId",965],"(",["T_VARIABLE","$this",965],["T_OBJECT_OPERATOR","->",965],["T_STRING","getOrder",965],"(",")",["T_OBJECT_OPERATOR","->",965],["T_STRING","getId",965],"(",")",")",";",["T_WHITESPACE","\n            ",965],["T_VARIABLE","$this",966],["T_OBJECT_OPERATOR","->",966],["T_STRING","setBillingAddressId",966],"(",["T_VARIABLE","$this",966],["T_OBJECT_OPERATOR","->",966],["T_STRING","getOrder",966],"(",")",["T_OBJECT_OPERATOR","->",966],["T_STRING","getBillingAddress",966],"(",")",["T_OBJECT_OPERATOR","->",966],["T_STRING","getId",966],"(",")",")",";",["T_WHITESPACE","\n        ",966],"}",["T_WHITESPACE","\n\n        ",967],["T_RETURN","return",969],["T_WHITESPACE"," ",969],["T_VARIABLE","$this",969],";",["T_WHITESPACE","\n    ",969],"}",["T_WHITESPACE","\n\n    ",970],["T_DOC_COMMENT","\/**\n     * After object save manipulation\n     *\n     * @return Mage_Sales_Model_Order_Shipment\n     *\/",972],["T_WHITESPACE","\n    ",976],["T_PROTECTED","protected",977],["T_WHITESPACE"," ",977],["T_FUNCTION","function",977],["T_WHITESPACE"," ",977],["T_STRING","_afterSave",977],"(",")",["T_WHITESPACE","\n    ",977],"{",["T_WHITESPACE","\n\n        ",978],["T_IF","if",980],["T_WHITESPACE"," ",980],"(",["T_STRING","null",980],["T_WHITESPACE"," ",980],["T_IS_NOT_IDENTICAL","!==",980],["T_WHITESPACE"," ",980],["T_VARIABLE","$this",980],["T_OBJECT_OPERATOR","->",980],["T_STRING","_items",980],")",["T_WHITESPACE"," ",980],"{",["T_WHITESPACE","\n            ",980],["T_DOC_COMMENT","\/**\n             * Save invoice items\n             *\/",981],["T_WHITESPACE","\n            ",983],["T_FOREACH","foreach",984],["T_WHITESPACE"," ",984],"(",["T_VARIABLE","$this",984],["T_OBJECT_OPERATOR","->",984],["T_STRING","_items",984],["T_WHITESPACE"," ",984],["T_AS","as",984],["T_WHITESPACE"," ",984],["T_VARIABLE","$item",984],")",["T_WHITESPACE"," ",984],"{",["T_WHITESPACE","\n                ",984],["T_VARIABLE","$item",985],["T_OBJECT_OPERATOR","->",985],["T_STRING","setOrderItem",985],"(",["T_VARIABLE","$item",985],["T_OBJECT_OPERATOR","->",985],["T_STRING","getOrderItem",985],"(",")",")",";",["T_WHITESPACE","\n                ",985],["T_VARIABLE","$item",986],["T_OBJECT_OPERATOR","->",986],["T_STRING","save",986],"(",")",";",["T_WHITESPACE","\n            ",986],"}",["T_WHITESPACE","\n        ",987],"}",["T_WHITESPACE","\n\n        ",988],["T_IF","if",990],["T_WHITESPACE"," ",990],"(",["T_STRING","null",990],["T_WHITESPACE"," ",990],["T_IS_NOT_IDENTICAL","!==",990],["T_WHITESPACE"," ",990],["T_VARIABLE","$this",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","_comments",990],")",["T_WHITESPACE"," ",990],"{",["T_WHITESPACE","\n            ",990],["T_FOREACH","foreach",991],"(",["T_VARIABLE","$this",991],["T_OBJECT_OPERATOR","->",991],["T_STRING","_comments",991],["T_WHITESPACE"," ",991],["T_AS","as",991],["T_WHITESPACE"," ",991],["T_VARIABLE","$comment",991],")",["T_WHITESPACE"," ",991],"{",["T_WHITESPACE","\n                ",991],["T_VARIABLE","$comment",992],["T_OBJECT_OPERATOR","->",992],["T_STRING","save",992],"(",")",";",["T_WHITESPACE","\n            ",992],"}",["T_WHITESPACE","\n        ",993],"}",["T_WHITESPACE","\n\n        ",994],["T_RETURN","return",996],["T_WHITESPACE"," ",996],["T_STRING","parent",996],["T_DOUBLE_COLON","::",996],["T_STRING","_afterSave",996],"(",")",";",["T_WHITESPACE","\n    ",996],"}",["T_WHITESPACE","\n",997],"}",["T_WHITESPACE","\n",998]]