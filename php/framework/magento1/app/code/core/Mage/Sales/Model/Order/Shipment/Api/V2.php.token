[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Sales order shippment API V2\n *\n * @category   Mage\n * @package    Mage_Sales\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Sales_Model_Order_Shipment_Api_V2",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Sales_Model_Order_Shipment_Api",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_PROTECTED","protected",36],["T_WHITESPACE"," ",36],["T_FUNCTION","function",36],["T_WHITESPACE"," ",36],["T_STRING","_prepareItemQtyData",36],"(",["T_VARIABLE","$data",36],")",["T_WHITESPACE","\n    ",36],"{",["T_WHITESPACE","\n        ",37],["T_VARIABLE","$_data",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",")",";",["T_WHITESPACE","\n        ",38],["T_FOREACH","foreach",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$data",39],["T_WHITESPACE"," ",39],["T_AS","as",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$item",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n            ",39],["T_IF","if",40],["T_WHITESPACE"," ",40],"(",["T_ISSET","isset",40],"(",["T_VARIABLE","$item",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","order_item_id",40],")",["T_WHITESPACE"," ",40],["T_BOOLEAN_AND","&&",40],["T_WHITESPACE"," ",40],["T_ISSET","isset",40],"(",["T_VARIABLE","$item",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","qty",40],")",")",["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n                ",40],["T_VARIABLE","$_data",41],"[",["T_VARIABLE","$item",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","order_item_id",41],"]",["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$item",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","qty",41],";",["T_WHITESPACE","\n            ",41],"}",["T_WHITESPACE","\n        ",42],"}",["T_WHITESPACE","\n        ",43],["T_RETURN","return",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_data",44],";",["T_WHITESPACE","\n    ",44],"}",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Create new shipment for order\n     *\n     * @param string $orderIncrementId\n     * @param array $itemsQty\n     * @param string $comment\n     * @param boolean $email\n     * @param boolean $includeComment\n     * @return string\n     *\/",47],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","create",57],"(",["T_VARIABLE","$orderIncrementId",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$itemsQty",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_ARRAY","array",57],"(",")",",",["T_WHITESPACE"," ",57],["T_VARIABLE","$comment",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","null",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$email",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","false",57],",",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$includeComment",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_STRING","false",58],["T_WHITESPACE","\n    ",58],")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$order",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","Mage",60],["T_DOUBLE_COLON","::",60],["T_STRING","getModel",60],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",60],")",["T_OBJECT_OPERATOR","->",60],["T_STRING","loadByIncrementId",60],"(",["T_VARIABLE","$orderIncrementId",60],")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$itemsQty",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_prepareItemQtyData",61],"(",["T_VARIABLE","$itemsQty",61],")",";",["T_WHITESPACE","\n        ",61],["T_DOC_COMMENT","\/**\n          * Check order existing\n          *\/",62],["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(","!",["T_VARIABLE","$order",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getId",65],"(",")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n             ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_fault",66],"(",["T_CONSTANT_ENCAPSED_STRING","'order_not_exists'",66],")",";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE","\n\n        ",67],["T_DOC_COMMENT","\/**\n         * Check shipment create availability\n         *\/",69],["T_WHITESPACE","\n        ",71],["T_IF","if",72],["T_WHITESPACE"," ",72],"(","!",["T_VARIABLE","$order",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","canShip",72],"(",")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n             ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_fault",73],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",73],",",["T_WHITESPACE"," ",73],["T_STRING","Mage",73],["T_DOUBLE_COLON","::",73],["T_STRING","helper",73],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","__",73],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot do shipment for order.'",73],")",")",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE","\n\n         ",74],["T_COMMENT","\/* @var $shipment Mage_Sales_Model_Order_Shipment *\/",76],["T_WHITESPACE","\n        ",76],["T_VARIABLE","$shipment",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$order",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","prepareShipment",77],"(",["T_VARIABLE","$itemsQty",77],")",";",["T_WHITESPACE","\n        ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(",["T_VARIABLE","$shipment",78],")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$shipment",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","register",79],"(",")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$shipment",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","addComment",80],"(",["T_VARIABLE","$comment",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$email",80],["T_WHITESPACE"," ",80],["T_BOOLEAN_AND","&&",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$includeComment",80],")",";",["T_WHITESPACE","\n            ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$email",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n                ",81],["T_VARIABLE","$shipment",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","setEmailSent",82],"(",["T_STRING","true",82],")",";",["T_WHITESPACE","\n            ",82],"}",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$shipment",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getOrder",84],"(",")",["T_OBJECT_OPERATOR","->",84],["T_STRING","setIsInProcess",84],"(",["T_STRING","true",84],")",";",["T_WHITESPACE","\n            ",84],["T_TRY","try",85],["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                ",85],["T_VARIABLE","$transactionSave",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","getModel",86],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource_transaction'",86],")",["T_WHITESPACE","\n                    ",86],["T_OBJECT_OPERATOR","->",87],["T_STRING","addObject",87],"(",["T_VARIABLE","$shipment",87],")",["T_WHITESPACE","\n                    ",87],["T_OBJECT_OPERATOR","->",88],["T_STRING","addObject",88],"(",["T_VARIABLE","$shipment",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getOrder",88],"(",")",")",["T_WHITESPACE","\n                    ",88],["T_OBJECT_OPERATOR","->",89],["T_STRING","save",89],"(",")",";",["T_WHITESPACE","\n                ",89],["T_VARIABLE","$shipment",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","sendEmail",90],"(",["T_VARIABLE","$email",90],",",["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$includeComment",90],["T_WHITESPACE"," ",90],"?",["T_WHITESPACE"," ",90],["T_VARIABLE","$comment",90],["T_WHITESPACE"," ",90],":",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","''",90],")",")",";",["T_WHITESPACE","\n            ",90],"}",["T_WHITESPACE"," ",91],["T_CATCH","catch",91],["T_WHITESPACE"," ",91],"(",["T_STRING","Mage_Core_Exception",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$e",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n                ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_fault",92],"(",["T_CONSTANT_ENCAPSED_STRING","'data_invalid'",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$e",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getMessage",92],"(",")",")",";",["T_WHITESPACE","\n            ",92],"}",["T_WHITESPACE","\n            ",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$shipment",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getIncrementId",94],"(",")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n        ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_STRING","null",96],";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Retrieve allowed shipping carriers for specified order\n     *\n     * @param string $orderIncrementId\n     * @return array\n     *\/",99],["T_WHITESPACE","\n    ",104],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","getCarriers",105],"(",["T_VARIABLE","$orderIncrementId",105],")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$order",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_STRING","Mage",107],["T_DOUBLE_COLON","::",107],["T_STRING","getModel",107],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",107],")",["T_OBJECT_OPERATOR","->",107],["T_STRING","loadByIncrementId",107],"(",["T_VARIABLE","$orderIncrementId",107],")",";",["T_WHITESPACE","\n\n        ",107],["T_DOC_COMMENT","\/**\n          * Check order existing\n          *\/",109],["T_WHITESPACE","\n        ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(","!",["T_VARIABLE","$order",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getId",112],"(",")",")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_fault",113],"(",["T_CONSTANT_ENCAPSED_STRING","'order_not_exists'",113],")",";",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$carriers",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_ARRAY","array",115],"(",")",";",["T_WHITESPACE","\n        ",115],["T_FOREACH","foreach",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_getCarriers",116],"(",["T_VARIABLE","$order",116],")",["T_WHITESPACE"," ",116],["T_AS","as",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$key",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$value",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$carriers",117],"[","]",["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_ARRAY","array",117],"(",["T_CONSTANT_ENCAPSED_STRING","'key'",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$key",117],",",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'value'",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$value",117],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n\n        ",118],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$carriers",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n",121],"}",["T_WHITESPACE","\n",122]]