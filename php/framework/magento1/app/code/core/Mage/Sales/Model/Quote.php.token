[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Quote model\n *\n * Supported events:\n *  sales_quote_load_after\n *  sales_quote_save_before\n *  sales_quote_save_after\n *  sales_quote_delete_before\n *  sales_quote_delete_after\n *\n * @method Mage_Sales_Model_Resource_Quote _getResource()\n * @method Mage_Sales_Model_Resource_Quote getResource()\n * @method Mage_Sales_Model_Quote setStoreId(int $value)\n * @method string getCreatedAt()\n * @method Mage_Sales_Model_Quote setCreatedAt(string $value)\n * @method string getUpdatedAt()\n * @method Mage_Sales_Model_Quote setUpdatedAt(string $value)\n * @method string getConvertedAt()\n * @method Mage_Sales_Model_Quote setConvertedAt(string $value)\n * @method int getIsActive()\n * @method Mage_Sales_Model_Quote setIsActive(int $value)\n * @method Mage_Sales_Model_Quote setIsVirtual(int $value)\n * @method int getIsMultiShipping()\n * @method Mage_Sales_Model_Quote setIsMultiShipping(int $value)\n * @method int getItemsCount()\n * @method Mage_Sales_Model_Quote setItemsCount(int $value)\n * @method float getItemsQty()\n * @method Mage_Sales_Model_Quote setItemsQty(float $value)\n * @method int getOrigOrderId()\n * @method Mage_Sales_Model_Quote setOrigOrderId(int $value)\n * @method float getStoreToBaseRate()\n * @method Mage_Sales_Model_Quote setStoreToBaseRate(float $value)\n * @method float getStoreToQuoteRate()\n * @method Mage_Sales_Model_Quote setStoreToQuoteRate(float $value)\n * @method string getBaseCurrencyCode()\n * @method Mage_Sales_Model_Quote setBaseCurrencyCode(string $value)\n * @method string getStoreCurrencyCode()\n * @method Mage_Sales_Model_Quote setStoreCurrencyCode(string $value)\n * @method string getQuoteCurrencyCode()\n * @method Mage_Sales_Model_Quote setQuoteCurrencyCode(string $value)\n * @method float getGrandTotal()\n * @method Mage_Sales_Model_Quote setGrandTotal(float $value)\n * @method float getBaseGrandTotal()\n * @method Mage_Sales_Model_Quote setBaseGrandTotal(float $value)\n * @method Mage_Sales_Model_Quote setCheckoutMethod(string $value)\n * @method int getCustomerId()\n * @method Mage_Sales_Model_Quote setCustomerId(int $value)\n * @method Mage_Sales_Model_Quote setCustomerTaxClassId(int $value)\n * @method Mage_Sales_Model_Quote setCustomerGroupId(int $value)\n * @method string getCustomerEmail()\n * @method Mage_Sales_Model_Quote setCustomerEmail(string $value)\n * @method string getCustomerPrefix()\n * @method Mage_Sales_Model_Quote setCustomerPrefix(string $value)\n * @method string getCustomerFirstname()\n * @method Mage_Sales_Model_Quote setCustomerFirstname(string $value)\n * @method string getCustomerMiddlename()\n * @method Mage_Sales_Model_Quote setCustomerMiddlename(string $value)\n * @method string getCustomerLastname()\n * @method Mage_Sales_Model_Quote setCustomerLastname(string $value)\n * @method string getCustomerSuffix()\n * @method Mage_Sales_Model_Quote setCustomerSuffix(string $value)\n * @method string getCustomerDob()\n * @method Mage_Sales_Model_Quote setCustomerDob(string $value)\n * @method string getCustomerNote()\n * @method Mage_Sales_Model_Quote setCustomerNote(string $value)\n * @method int getCustomerNoteNotify()\n * @method Mage_Sales_Model_Quote setCustomerNoteNotify(int $value)\n * @method int getCustomerIsGuest()\n * @method Mage_Sales_Model_Quote setCustomerIsGuest(int $value)\n * @method string getRemoteIp()\n * @method Mage_Sales_Model_Quote setRemoteIp(string $value)\n * @method string getAppliedRuleIds()\n * @method Mage_Sales_Model_Quote setAppliedRuleIds(string $value)\n * @method string getReservedOrderId()\n * @method Mage_Sales_Model_Quote setReservedOrderId(string $value)\n * @method string getPasswordHash()\n * @method Mage_Sales_Model_Quote setPasswordHash(string $value)\n * @method string getCouponCode()\n * @method Mage_Sales_Model_Quote setCouponCode(string $value)\n * @method string getGlobalCurrencyCode()\n * @method Mage_Sales_Model_Quote setGlobalCurrencyCode(string $value)\n * @method float getBaseToGlobalRate()\n * @method Mage_Sales_Model_Quote setBaseToGlobalRate(float $value)\n * @method float getBaseToQuoteRate()\n * @method Mage_Sales_Model_Quote setBaseToQuoteRate(float $value)\n * @method string getCustomerTaxvat()\n * @method Mage_Sales_Model_Quote setCustomerTaxvat(string $value)\n * @method string getCustomerGender()\n * @method Mage_Sales_Model_Quote setCustomerGender(string $value)\n * @method float getSubtotal()\n * @method Mage_Sales_Model_Quote setSubtotal(float $value)\n * @method float getBaseSubtotal()\n * @method Mage_Sales_Model_Quote setBaseSubtotal(float $value)\n * @method float getSubtotalWithDiscount()\n * @method Mage_Sales_Model_Quote setSubtotalWithDiscount(float $value)\n * @method float getBaseSubtotalWithDiscount()\n * @method Mage_Sales_Model_Quote setBaseSubtotalWithDiscount(float $value)\n * @method int getIsChanged()\n * @method Mage_Sales_Model_Quote setIsChanged(int $value)\n * @method int getTriggerRecollect()\n * @method Mage_Sales_Model_Quote setTriggerRecollect(int $value)\n * @method string getExtShippingInfo()\n * @method Mage_Sales_Model_Quote setExtShippingInfo(string $value)\n * @method int getGiftMessageId()\n * @method Mage_Sales_Model_Quote setGiftMessageId(int $value)\n * @method bool|null getIsPersistent()\n * @method Mage_Sales_Model_Quote setIsPersistent(bool $value)\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",138],["T_CLASS","class",139],["T_WHITESPACE"," ",139],["T_STRING","Mage_Sales_Model_Quote",139],["T_WHITESPACE"," ",139],["T_EXTENDS","extends",139],["T_WHITESPACE"," ",139],["T_STRING","Mage_Core_Model_Abstract",139],["T_WHITESPACE","\n",139],"{",["T_WHITESPACE","\n    ",140],["T_PROTECTED","protected",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$_eventPrefix",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","'sales_quote'",141],";",["T_WHITESPACE","\n    ",141],["T_PROTECTED","protected",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$_eventObject",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'quote'",142],";",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Model cache tag for clear cache in after save and after delete\n     *\n     * When you use true - all cache will be clean\n     *\n     * @var string || true\n     *\/",144],["T_WHITESPACE","\n    ",150],["T_PROTECTED","protected",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$_cacheTag",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'quote'",151],";",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Quote customer model object\n     *\n     * @var Mage_Customer_Model_Customer\n     *\/",153],["T_WHITESPACE","\n    ",157],["T_PROTECTED","protected",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$_customer",158],";",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * Quote addresses collection\n     *\n     * @var Mage_Eav_Model_Entity_Collection_Abstract\n     *\/",160],["T_WHITESPACE","\n    ",164],["T_PROTECTED","protected",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$_addresses",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_STRING","null",165],";",["T_WHITESPACE","\n\n    ",165],["T_DOC_COMMENT","\/**\n     * Quote items collection\n     *\n     * @var Mage_Eav_Model_Entity_Collection_Abstract\n     *\/",167],["T_WHITESPACE","\n    ",171],["T_PROTECTED","protected",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$_items",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","null",172],";",["T_WHITESPACE","\n\n    ",172],["T_DOC_COMMENT","\/**\n     * Quote payments\n     *\n     * @var Mage_Eav_Model_Entity_Collection_Abstract\n     *\/",174],["T_WHITESPACE","\n    ",178],["T_PROTECTED","protected",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$_payments",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_STRING","null",179],";",["T_WHITESPACE","\n\n    ",179],["T_DOC_COMMENT","\/**\n     * Different groups of error infos\n     *\n     * @var array\n     *\/",181],["T_WHITESPACE","\n    ",185],["T_PROTECTED","protected",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$_errorInfoGroups",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_ARRAY","array",186],"(",")",";",["T_WHITESPACE","\n\n    ",186],["T_DOC_COMMENT","\/**\n     * Whether quote should not be saved\n     *\n     * @var bool\n     *\/",188],["T_WHITESPACE","\n    ",192],["T_PROTECTED","protected",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$_preventSaving",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_STRING","false",193],";",["T_WHITESPACE","\n\n    ",193],["T_DOC_COMMENT","\/**\n     * Init resource model\n     *\/",195],["T_WHITESPACE","\n    ",197],["T_PROTECTED","protected",198],["T_WHITESPACE"," ",198],["T_FUNCTION","function",198],["T_WHITESPACE"," ",198],["T_STRING","_construct",198],"(",")",["T_WHITESPACE","\n    ",198],"{",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_init",200],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",200],")",";",["T_WHITESPACE","\n    ",200],"}",["T_WHITESPACE","\n\n    ",201],["T_DOC_COMMENT","\/**\n     * Init mapping array of short fields to\n     * its full names\n     *\n     * @return Varien_Object\n     *\/",203],["T_WHITESPACE","\n    ",208],["T_PROTECTED","protected",209],["T_WHITESPACE"," ",209],["T_FUNCTION","function",209],["T_WHITESPACE"," ",209],["T_STRING","_initOldFieldsMap",209],"(",")",["T_WHITESPACE","\n    ",209],"{",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_oldFieldsMap",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_STRING","Mage",211],["T_DOUBLE_COLON","::",211],["T_STRING","helper",211],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",211],")",["T_OBJECT_OPERATOR","->",211],["T_STRING","getOldFieldMap",211],"(",["T_CONSTANT_ENCAPSED_STRING","'quote'",211],")",";",["T_WHITESPACE","\n        ",211],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * Get quote store identifier\n     *\n     * @return int\n     *\/",215],["T_WHITESPACE","\n    ",219],["T_PUBLIC","public",220],["T_WHITESPACE"," ",220],["T_FUNCTION","function",220],["T_WHITESPACE"," ",220],["T_STRING","getStoreId",220],"(",")",["T_WHITESPACE","\n    ",220],"{",["T_WHITESPACE","\n        ",221],["T_IF","if",222],["T_WHITESPACE"," ",222],"(","!",["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","hasStoreId",222],"(",")",")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_STRING","Mage",223],["T_DOUBLE_COLON","::",223],["T_STRING","app",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","getStore",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","getId",223],"(",")",";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE","\n        ",224],["T_RETURN","return",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_getData",225],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",225],")",";",["T_WHITESPACE","\n    ",225],"}",["T_WHITESPACE","\n\n    ",226],["T_DOC_COMMENT","\/**\n     * Get quote store model object\n     *\n     * @return  Mage_Core_Model_Store\n     *\/",228],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","getStore",233],"(",")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_STRING","Mage",235],["T_DOUBLE_COLON","::",235],["T_STRING","app",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","getStore",235],"(",["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getStoreId",235],"(",")",")",";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_DOC_COMMENT","\/**\n     * Declare quote store model\n     *\n     * @param   Mage_Core_Model_Store $store\n     * @return  Mage_Sales_Model_Quote\n     *\/",238],["T_WHITESPACE","\n    ",243],["T_PUBLIC","public",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","setStore",244],"(",["T_STRING","Mage_Core_Model_Store",244],["T_WHITESPACE"," ",244],["T_VARIABLE","$store",244],")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","setStoreId",246],"(",["T_VARIABLE","$store",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getId",246],"(",")",")",";",["T_WHITESPACE","\n        ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],";",["T_WHITESPACE","\n    ",247],"}",["T_WHITESPACE","\n\n    ",248],["T_DOC_COMMENT","\/**\n     * Get all available store ids for quote\n     *\n     * @return array\n     *\/",250],["T_WHITESPACE","\n    ",254],["T_PUBLIC","public",255],["T_WHITESPACE"," ",255],["T_FUNCTION","function",255],["T_WHITESPACE"," ",255],["T_STRING","getSharedStoreIds",255],"(",")",["T_WHITESPACE","\n    ",255],"{",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$ids",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","_getData",257],"(",["T_CONSTANT_ENCAPSED_STRING","'shared_store_ids'",257],")",";",["T_WHITESPACE","\n        ",257],["T_IF","if",258],["T_WHITESPACE"," ",258],"(",["T_STRING","is_null",258],"(",["T_VARIABLE","$ids",258],")",["T_WHITESPACE"," ",258],["T_BOOLEAN_OR","||",258],["T_WHITESPACE"," ",258],"!",["T_STRING","is_array",258],"(",["T_VARIABLE","$ids",258],")",")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_IF","if",259],["T_WHITESPACE"," ",259],"(",["T_VARIABLE","$website",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getWebsite",259],"(",")",")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n                ",259],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$website",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getStoreIds",260],"(",")",";",["T_WHITESPACE","\n            ",260],"}",["T_WHITESPACE","\n            ",261],["T_RETURN","return",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getStore",262],"(",")",["T_OBJECT_OPERATOR","->",262],["T_STRING","getWebsite",262],"(",")",["T_OBJECT_OPERATOR","->",262],["T_STRING","getStoreIds",262],"(",")",";",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n        ",263],["T_RETURN","return",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$ids",264],";",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n\n    ",265],["T_DOC_COMMENT","\/**\n     * Prepare data before save\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",267],["T_WHITESPACE","\n    ",271],["T_PROTECTED","protected",272],["T_WHITESPACE"," ",272],["T_FUNCTION","function",272],["T_WHITESPACE"," ",272],["T_STRING","_beforeSave",272],"(",")",["T_WHITESPACE","\n    ",272],"{",["T_WHITESPACE","\n        ",273],["T_DOC_COMMENT","\/**\n         * Currency logic\n         *\n         * global - currency which is set for default in backend\n         * base - currency which is set for current website. all attributes that\n         *      have 'base_' prefix saved in this currency\n         * store - all the time it was currency of website and all attributes\n         *      with 'base_' were saved in this currency. From now on it is\n         *      deprecated and will be duplication of base currency code.\n         * quote\/order - currency which was selected by customer or configured by\n         *      admin for current store. currency in which customer sees\n         *      price thought all checkout.\n         *\n         * Rates:\n         *      store_to_base & store_to_quote\/store_to_order - are deprecated\n         *      base_to_global & base_to_quote\/base_to_order - must be used instead\n         *\/",274],["T_WHITESPACE","\n\n        ",290],["T_VARIABLE","$globalCurrencyCode",292],["T_WHITESPACE","  ",292],"=",["T_WHITESPACE"," ",292],["T_STRING","Mage",292],["T_DOUBLE_COLON","::",292],["T_STRING","app",292],"(",")",["T_OBJECT_OPERATOR","->",292],["T_STRING","getBaseCurrencyCode",292],"(",")",";",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$baseCurrency",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","getStore",293],"(",")",["T_OBJECT_OPERATOR","->",293],["T_STRING","getBaseCurrency",293],"(",")",";",["T_WHITESPACE","\n\n        ",293],["T_IF","if",295],["T_WHITESPACE"," ",295],"(",["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","hasForcedCurrency",295],"(",")",")","{",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$quoteCurrency",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getForcedCurrency",296],"(",")",";",["T_WHITESPACE","\n        ",296],"}",["T_WHITESPACE"," ",297],["T_ELSE","else",297],["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n            ",297],["T_VARIABLE","$quoteCurrency",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getStore",298],"(",")",["T_OBJECT_OPERATOR","->",298],["T_STRING","getCurrentCurrency",298],"(",")",";",["T_WHITESPACE","\n        ",298],"}",["T_WHITESPACE","\n\n        ",299],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","setGlobalCurrencyCode",301],"(",["T_VARIABLE","$globalCurrencyCode",301],")",";",["T_WHITESPACE","\n        ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","setBaseCurrencyCode",302],"(",["T_VARIABLE","$baseCurrency",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getCode",302],"(",")",")",";",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","setStoreCurrencyCode",303],"(",["T_VARIABLE","$baseCurrency",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getCode",303],"(",")",")",";",["T_WHITESPACE","\n        ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","setQuoteCurrencyCode",304],"(",["T_VARIABLE","$quoteCurrency",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getCode",304],"(",")",")",";",["T_WHITESPACE","\n\n        ",304],["T_COMMENT","\/\/deprecated, read above\n",306],["T_WHITESPACE","        ",307],["T_VARIABLE","$this",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","setStoreToBaseRate",307],"(",["T_VARIABLE","$baseCurrency",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getRate",307],"(",["T_VARIABLE","$globalCurrencyCode",307],")",")",";",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","setStoreToQuoteRate",308],"(",["T_VARIABLE","$baseCurrency",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getRate",308],"(",["T_VARIABLE","$quoteCurrency",308],")",")",";",["T_WHITESPACE","\n\n        ",308],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","setBaseToGlobalRate",310],"(",["T_VARIABLE","$baseCurrency",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getRate",310],"(",["T_VARIABLE","$globalCurrencyCode",310],")",")",";",["T_WHITESPACE","\n        ",310],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","setBaseToQuoteRate",311],"(",["T_VARIABLE","$baseCurrency",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getRate",311],"(",["T_VARIABLE","$quoteCurrency",311],")",")",";",["T_WHITESPACE","\n\n        ",311],["T_IF","if",313],["T_WHITESPACE"," ",313],"(","!",["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","hasChangedFlag",313],"(",")",["T_WHITESPACE"," ",313],["T_BOOLEAN_OR","||",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getChangedFlag",313],"(",")",["T_WHITESPACE"," ",313],["T_IS_EQUAL","==",313],["T_WHITESPACE"," ",313],["T_STRING","true",313],")",["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n            ",313],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","setIsChanged",314],"(",["T_LNUMBER","1",314],")",";",["T_WHITESPACE","\n        ",314],"}",["T_WHITESPACE"," ",315],["T_ELSE","else",315],["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","setIsChanged",316],"(",["T_LNUMBER","0",316],")",";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE","\n\n        ",317],["T_IF","if",319],["T_WHITESPACE"," ",319],"(",["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_customer",319],")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n            ",319],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","setCustomerId",320],"(",["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_customer",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getId",320],"(",")",")",";",["T_WHITESPACE","\n        ",320],"}",["T_WHITESPACE","\n\n        ",321],["T_STRING","parent",323],["T_DOUBLE_COLON","::",323],["T_STRING","_beforeSave",323],"(",")",";",["T_WHITESPACE","\n    ",323],"}",["T_WHITESPACE","\n\n    ",324],["T_DOC_COMMENT","\/**\n     * Save related items\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",326],["T_WHITESPACE","\n    ",330],["T_PROTECTED","protected",331],["T_WHITESPACE"," ",331],["T_FUNCTION","function",331],["T_WHITESPACE"," ",331],["T_STRING","_afterSave",331],"(",")",["T_WHITESPACE","\n    ",331],"{",["T_WHITESPACE","\n        ",332],["T_STRING","parent",333],["T_DOUBLE_COLON","::",333],["T_STRING","_afterSave",333],"(",")",";",["T_WHITESPACE","\n\n        ",333],["T_IF","if",335],["T_WHITESPACE"," ",335],"(",["T_STRING","null",335],["T_WHITESPACE"," ",335],["T_IS_NOT_IDENTICAL","!==",335],["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","_addresses",335],")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n            ",335],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","getAddressesCollection",336],"(",")",["T_OBJECT_OPERATOR","->",336],["T_STRING","save",336],"(",")",";",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE","\n\n        ",337],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_STRING","null",339],["T_WHITESPACE"," ",339],["T_IS_NOT_IDENTICAL","!==",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","_items",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getItemsCollection",340],"(",")",["T_OBJECT_OPERATOR","->",340],["T_STRING","save",340],"(",")",";",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n\n        ",341],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_STRING","null",343],["T_WHITESPACE"," ",343],["T_IS_NOT_IDENTICAL","!==",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_payments",343],")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n            ",343],["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getPaymentsCollection",344],"(",")",["T_OBJECT_OPERATOR","->",344],["T_STRING","save",344],"(",")",";",["T_WHITESPACE","\n        ",344],"}",["T_WHITESPACE","\n        ",345],["T_RETURN","return",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],";",["T_WHITESPACE","\n    ",346],"}",["T_WHITESPACE","\n\n    ",347],["T_DOC_COMMENT","\/**\n     * Loading quote data by customer\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",349],["T_WHITESPACE","\n    ",353],["T_PUBLIC","public",354],["T_WHITESPACE"," ",354],["T_FUNCTION","function",354],["T_WHITESPACE"," ",354],["T_STRING","loadByCustomer",354],"(",["T_VARIABLE","$customer",354],")",["T_WHITESPACE","\n    ",354],"{",["T_WHITESPACE","\n        ",355],["T_IF","if",356],["T_WHITESPACE"," ",356],"(",["T_VARIABLE","$customer",356],["T_WHITESPACE"," ",356],["T_INSTANCEOF","instanceof",356],["T_WHITESPACE"," ",356],["T_STRING","Mage_Customer_Model_Customer",356],")",["T_WHITESPACE"," ",356],"{",["T_WHITESPACE","\n            ",356],["T_VARIABLE","$customerId",357],["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_VARIABLE","$customer",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getId",357],"(",")",";",["T_WHITESPACE","\n        ",357],"}",["T_WHITESPACE","\n        ",358],["T_ELSE","else",359],["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n            ",359],["T_VARIABLE","$customerId",360],["T_WHITESPACE"," ",360],"=",["T_WHITESPACE"," ",360],["T_INT_CAST","(int)",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$customer",360],";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n        ",361],["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","_getResource",362],"(",")",["T_OBJECT_OPERATOR","->",362],["T_STRING","loadByCustomerId",362],"(",["T_VARIABLE","$this",362],",",["T_WHITESPACE"," ",362],["T_VARIABLE","$customerId",362],")",";",["T_WHITESPACE","\n        ",362],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","_afterLoad",363],"(",")",";",["T_WHITESPACE","\n        ",363],["T_RETURN","return",364],["T_WHITESPACE"," ",364],["T_VARIABLE","$this",364],";",["T_WHITESPACE","\n    ",364],"}",["T_WHITESPACE","\n\n    ",365],["T_DOC_COMMENT","\/**\n     * Loading only active quote\n     *\n     * @param int $quoteId\n     * @return Mage_Sales_Model_Quote\n     *\/",367],["T_WHITESPACE","\n    ",372],["T_PUBLIC","public",373],["T_WHITESPACE"," ",373],["T_FUNCTION","function",373],["T_WHITESPACE"," ",373],["T_STRING","loadActive",373],"(",["T_VARIABLE","$quoteId",373],")",["T_WHITESPACE","\n    ",373],"{",["T_WHITESPACE","\n        ",374],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","_getResource",375],"(",")",["T_OBJECT_OPERATOR","->",375],["T_STRING","loadActive",375],"(",["T_VARIABLE","$this",375],",",["T_WHITESPACE"," ",375],["T_VARIABLE","$quoteId",375],")",";",["T_WHITESPACE","\n        ",375],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","_afterLoad",376],"(",")",";",["T_WHITESPACE","\n        ",376],["T_RETURN","return",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],";",["T_WHITESPACE","\n    ",377],"}",["T_WHITESPACE","\n\n    ",378],["T_DOC_COMMENT","\/**\n     * Loading quote by identifier\n     *\n     * @param int $quoteId\n     * @return Mage_Sales_Model_Quote\n     *\/",380],["T_WHITESPACE","\n    ",385],["T_PUBLIC","public",386],["T_WHITESPACE"," ",386],["T_FUNCTION","function",386],["T_WHITESPACE"," ",386],["T_STRING","loadByIdWithoutStore",386],"(",["T_VARIABLE","$quoteId",386],")",["T_WHITESPACE","\n    ",386],"{",["T_WHITESPACE","\n        ",387],["T_VARIABLE","$this",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","_getResource",388],"(",")",["T_OBJECT_OPERATOR","->",388],["T_STRING","loadByIdWithoutStore",388],"(",["T_VARIABLE","$this",388],",",["T_WHITESPACE"," ",388],["T_VARIABLE","$quoteId",388],")",";",["T_WHITESPACE","\n        ",388],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_afterLoad",389],"(",")",";",["T_WHITESPACE","\n        ",389],["T_RETURN","return",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$this",390],";",["T_WHITESPACE","\n    ",390],"}",["T_WHITESPACE","\n\n    ",391],["T_DOC_COMMENT","\/**\n     * Assign customer model object data to quote\n     *\n     * @param   Mage_Customer_Model_Customer $customer\n     * @return  Mage_Sales_Model_Quote\n     *\/",393],["T_WHITESPACE","\n    ",398],["T_PUBLIC","public",399],["T_WHITESPACE"," ",399],["T_FUNCTION","function",399],["T_WHITESPACE"," ",399],["T_STRING","assignCustomer",399],"(",["T_STRING","Mage_Customer_Model_Customer",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$customer",399],")",["T_WHITESPACE","\n    ",399],"{",["T_WHITESPACE","\n        ",400],["T_RETURN","return",401],["T_WHITESPACE"," ",401],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","assignCustomerWithAddressChange",401],"(",["T_VARIABLE","$customer",401],")",";",["T_WHITESPACE","\n    ",401],"}",["T_WHITESPACE","\n\n    ",402],["T_DOC_COMMENT","\/**\n     * Assign customer model to quote with billing and shipping address change\n     *\n     * @param  Mage_Customer_Model_Customer    $customer\n     * @param  Mage_Sales_Model_Quote_Address  $billingAddress\n     * @param  Mage_Sales_Model_Quote_Address  $shippingAddress\n     * @return Mage_Sales_Model_Quote\n     *\/",404],["T_WHITESPACE","\n    ",411],["T_PUBLIC","public",412],["T_WHITESPACE"," ",412],["T_FUNCTION","function",412],["T_WHITESPACE"," ",412],["T_STRING","assignCustomerWithAddressChange",412],"(",["T_WHITESPACE","\n        ",412],["T_STRING","Mage_Customer_Model_Customer",413],["T_WHITESPACE","    ",413],["T_VARIABLE","$customer",413],",",["T_WHITESPACE","\n        ",413],["T_STRING","Mage_Sales_Model_Quote_Address",414],["T_WHITESPACE","  ",414],["T_VARIABLE","$billingAddress",414],["T_WHITESPACE","  ",414],"=",["T_WHITESPACE"," ",414],["T_STRING","null",414],",",["T_WHITESPACE","\n        ",414],["T_STRING","Mage_Sales_Model_Quote_Address",415],["T_WHITESPACE","  ",415],["T_VARIABLE","$shippingAddress",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_STRING","null",415],["T_WHITESPACE","\n    ",415],")",["T_WHITESPACE","\n    ",416],"{",["T_WHITESPACE","\n        ",417],["T_IF","if",418],["T_WHITESPACE"," ",418],"(",["T_VARIABLE","$customer",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getId",418],"(",")",")",["T_WHITESPACE"," ",418],"{",["T_WHITESPACE","\n            ",418],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","setCustomer",419],"(",["T_VARIABLE","$customer",419],")",";",["T_WHITESPACE","\n\n            ",419],["T_IF","if",421],["T_WHITESPACE"," ",421],"(","!",["T_STRING","is_null",421],"(",["T_VARIABLE","$billingAddress",421],")",")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n                ",421],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","setBillingAddress",422],"(",["T_VARIABLE","$billingAddress",422],")",";",["T_WHITESPACE","\n            ",422],"}",["T_WHITESPACE"," ",423],["T_ELSE","else",423],["T_WHITESPACE"," ",423],"{",["T_WHITESPACE","\n                ",423],["T_VARIABLE","$defaultBillingAddress",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_VARIABLE","$customer",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getDefaultBillingAddress",424],"(",")",";",["T_WHITESPACE","\n                ",424],["T_IF","if",425],["T_WHITESPACE"," ",425],"(",["T_VARIABLE","$defaultBillingAddress",425],["T_WHITESPACE"," ",425],["T_BOOLEAN_AND","&&",425],["T_WHITESPACE"," ",425],["T_VARIABLE","$defaultBillingAddress",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getId",425],"(",")",")",["T_WHITESPACE"," ",425],"{",["T_WHITESPACE","\n                    ",425],["T_VARIABLE","$billingAddress",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_STRING","Mage",426],["T_DOUBLE_COLON","::",426],["T_STRING","getModel",426],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",426],")",["T_WHITESPACE","\n                        ",426],["T_OBJECT_OPERATOR","->",427],["T_STRING","importCustomerAddress",427],"(",["T_VARIABLE","$defaultBillingAddress",427],")",";",["T_WHITESPACE","\n                    ",427],["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","setBillingAddress",428],"(",["T_VARIABLE","$billingAddress",428],")",";",["T_WHITESPACE","\n                ",428],"}",["T_WHITESPACE","\n            ",429],"}",["T_WHITESPACE","\n\n            ",430],["T_IF","if",432],["T_WHITESPACE"," ",432],"(",["T_STRING","is_null",432],"(",["T_VARIABLE","$shippingAddress",432],")",")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n                ",432],["T_VARIABLE","$defaultShippingAddress",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_VARIABLE","$customer",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getDefaultShippingAddress",433],"(",")",";",["T_WHITESPACE","\n                ",433],["T_IF","if",434],["T_WHITESPACE"," ",434],"(",["T_VARIABLE","$defaultShippingAddress",434],["T_WHITESPACE"," ",434],["T_BOOLEAN_AND","&&",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$defaultShippingAddress",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getId",434],"(",")",")",["T_WHITESPACE"," ",434],"{",["T_WHITESPACE","\n                    ",434],["T_VARIABLE","$shippingAddress",435],["T_WHITESPACE"," ",435],"=",["T_WHITESPACE"," ",435],["T_STRING","Mage",435],["T_DOUBLE_COLON","::",435],["T_STRING","getModel",435],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",435],")",["T_WHITESPACE","\n                        ",435],["T_OBJECT_OPERATOR","->",436],["T_STRING","importCustomerAddress",436],"(",["T_VARIABLE","$defaultShippingAddress",436],")",";",["T_WHITESPACE","\n                ",436],"}",["T_WHITESPACE"," ",437],["T_ELSE","else",437],["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n                    ",437],["T_VARIABLE","$shippingAddress",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_STRING","Mage",438],["T_DOUBLE_COLON","::",438],["T_STRING","getModel",438],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",438],")",";",["T_WHITESPACE","\n                ",438],"}",["T_WHITESPACE","\n            ",439],"}",["T_WHITESPACE","\n            ",440],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","setShippingAddress",441],"(",["T_VARIABLE","$shippingAddress",441],")",";",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE","\n\n        ",442],["T_RETURN","return",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],";",["T_WHITESPACE","\n    ",444],"}",["T_WHITESPACE","\n\n    ",445],["T_DOC_COMMENT","\/**\n     * Define customer object\n     *\n     * @param   Mage_Customer_Model_Customer $customer\n     * @return  Mage_Sales_Model_Quote\n     *\/",447],["T_WHITESPACE","\n    ",452],["T_PUBLIC","public",453],["T_WHITESPACE"," ",453],["T_FUNCTION","function",453],["T_WHITESPACE"," ",453],["T_STRING","setCustomer",453],"(",["T_STRING","Mage_Customer_Model_Customer",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$customer",453],")",["T_WHITESPACE","\n    ",453],"{",["T_WHITESPACE","\n        ",454],["T_VARIABLE","$this",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","_customer",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_VARIABLE","$customer",455],";",["T_WHITESPACE","\n        ",455],["T_VARIABLE","$this",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","setCustomerId",456],"(",["T_VARIABLE","$customer",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","getId",456],"(",")",")",";",["T_WHITESPACE","\n        ",456],["T_STRING","Mage",457],["T_DOUBLE_COLON","::",457],["T_STRING","helper",457],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",457],")",["T_OBJECT_OPERATOR","->",457],["T_STRING","copyFieldset",457],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_account'",457],",",["T_WHITESPACE"," ",457],["T_CONSTANT_ENCAPSED_STRING","'to_quote'",457],",",["T_WHITESPACE"," ",457],["T_VARIABLE","$customer",457],",",["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],")",";",["T_WHITESPACE","\n        ",457],["T_RETURN","return",458],["T_WHITESPACE"," ",458],["T_VARIABLE","$this",458],";",["T_WHITESPACE","\n    ",458],"}",["T_WHITESPACE","\n\n    ",459],["T_DOC_COMMENT","\/**\n     * Retrieve customer model object\n     *\n     * @return Mage_Customer_Model_Customer\n     *\/",461],["T_WHITESPACE","\n    ",465],["T_PUBLIC","public",466],["T_WHITESPACE"," ",466],["T_FUNCTION","function",466],["T_WHITESPACE"," ",466],["T_STRING","getCustomer",466],"(",")",["T_WHITESPACE","\n    ",466],"{",["T_WHITESPACE","\n        ",467],["T_IF","if",468],["T_WHITESPACE"," ",468],"(",["T_STRING","is_null",468],"(",["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","_customer",468],")",")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n            ",468],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_customer",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_STRING","Mage",469],["T_DOUBLE_COLON","::",469],["T_STRING","getModel",469],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",469],")",";",["T_WHITESPACE","\n            ",469],["T_IF","if",470],["T_WHITESPACE"," ",470],"(",["T_VARIABLE","$customerId",470],["T_WHITESPACE"," ",470],"=",["T_WHITESPACE"," ",470],["T_VARIABLE","$this",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","getCustomerId",470],"(",")",")",["T_WHITESPACE"," ",470],"{",["T_WHITESPACE","\n                ",470],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","_customer",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","load",471],"(",["T_VARIABLE","$customerId",471],")",";",["T_WHITESPACE","\n                ",471],["T_IF","if",472],["T_WHITESPACE"," ",472],"(","!",["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","_customer",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","getId",472],"(",")",")",["T_WHITESPACE"," ",472],"{",["T_WHITESPACE","\n                    ",472],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","_customer",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","setCustomerId",473],"(",["T_STRING","null",473],")",";",["T_WHITESPACE","\n                ",473],"}",["T_WHITESPACE","\n            ",474],"}",["T_WHITESPACE","\n        ",475],"}",["T_WHITESPACE","\n        ",476],["T_RETURN","return",477],["T_WHITESPACE"," ",477],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","_customer",477],";",["T_WHITESPACE","\n    ",477],"}",["T_WHITESPACE","\n\n    ",478],["T_DOC_COMMENT","\/**\n     * Retrieve customer group id\n     *\n     * @return int\n     *\/",480],["T_WHITESPACE","\n    ",484],["T_PUBLIC","public",485],["T_WHITESPACE"," ",485],["T_FUNCTION","function",485],["T_WHITESPACE"," ",485],["T_STRING","getCustomerGroupId",485],"(",")",["T_WHITESPACE","\n    ",485],"{",["T_WHITESPACE","\n        ",486],["T_IF","if",487],["T_WHITESPACE"," ",487],"(",["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","hasData",487],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",487],")",")",["T_WHITESPACE"," ",487],"{",["T_WHITESPACE","\n            ",487],["T_RETURN","return",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getData",488],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_group_id'",488],")",";",["T_WHITESPACE","\n        ",488],"}",["T_WHITESPACE"," ",489],["T_ELSE","else",489],["T_WHITESPACE"," ",489],["T_IF","if",489],["T_WHITESPACE"," ",489],"(",["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getCustomerId",489],"(",")",")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n            ",489],["T_RETURN","return",490],["T_WHITESPACE"," ",490],["T_VARIABLE","$this",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","getCustomer",490],"(",")",["T_OBJECT_OPERATOR","->",490],["T_STRING","getGroupId",490],"(",")",";",["T_WHITESPACE","\n        ",490],"}",["T_WHITESPACE"," ",491],["T_ELSE","else",491],["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n            ",491],["T_RETURN","return",492],["T_WHITESPACE"," ",492],["T_STRING","Mage_Customer_Model_Group",492],["T_DOUBLE_COLON","::",492],["T_STRING","NOT_LOGGED_IN_ID",492],";",["T_WHITESPACE","\n        ",492],"}",["T_WHITESPACE","\n    ",493],"}",["T_WHITESPACE","\n\n    ",494],["T_PUBLIC","public",496],["T_WHITESPACE"," ",496],["T_FUNCTION","function",496],["T_WHITESPACE"," ",496],["T_STRING","getCustomerTaxClassId",496],"(",")",["T_WHITESPACE","\n    ",496],"{",["T_WHITESPACE","\n        ",497],["T_COMMENT","\/*\n        * tax class can vary at any time. so instead of using the value from session,\n        * we need to retrieve from db every time to get the correct tax class\n        *\/",498],["T_WHITESPACE","\n        ",501],["T_COMMENT","\/\/if (!$this->getData('customer_group_id') && !$this->getData('customer_tax_class_id')) {\n",502],["T_WHITESPACE","        ",503],["T_VARIABLE","$classId",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_STRING","Mage",503],["T_DOUBLE_COLON","::",503],["T_STRING","getModel",503],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/group'",503],")",["T_OBJECT_OPERATOR","->",503],["T_STRING","getTaxClassId",503],"(",["T_VARIABLE","$this",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","getCustomerGroupId",503],"(",")",")",";",["T_WHITESPACE","\n        ",503],["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","setCustomerTaxClassId",504],"(",["T_VARIABLE","$classId",504],")",";",["T_WHITESPACE","\n        ",504],["T_COMMENT","\/\/}\n",505],["T_WHITESPACE","\n        ",506],["T_RETURN","return",507],["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getData",507],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_tax_class_id'",507],")",";",["T_WHITESPACE","\n    ",507],"}",["T_WHITESPACE","\n\n    ",508],["T_DOC_COMMENT","\/**\n     * Retrieve quote address collection\n     *\n     * @return Mage_Eav_Model_Entity_Collection_Abstract\n     *\/",510],["T_WHITESPACE","\n    ",514],["T_PUBLIC","public",515],["T_WHITESPACE"," ",515],["T_FUNCTION","function",515],["T_WHITESPACE"," ",515],["T_STRING","getAddressesCollection",515],"(",")",["T_WHITESPACE","\n    ",515],"{",["T_WHITESPACE","\n        ",516],["T_IF","if",517],["T_WHITESPACE"," ",517],"(",["T_STRING","is_null",517],"(",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","_addresses",517],")",")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n            ",517],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","_addresses",518],["T_WHITESPACE"," ",518],"=",["T_WHITESPACE"," ",518],["T_STRING","Mage",518],["T_DOUBLE_COLON","::",518],["T_STRING","getModel",518],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",518],")",["T_OBJECT_OPERATOR","->",518],["T_STRING","getCollection",518],"(",")",["T_WHITESPACE","\n                ",518],["T_OBJECT_OPERATOR","->",519],["T_STRING","setQuoteFilter",519],"(",["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","getId",519],"(",")",")",";",["T_WHITESPACE","\n\n            ",519],["T_IF","if",521],["T_WHITESPACE"," ",521],"(",["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getId",521],"(",")",")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n                ",521],["T_FOREACH","foreach",522],["T_WHITESPACE"," ",522],"(",["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_addresses",522],["T_WHITESPACE"," ",522],["T_AS","as",522],["T_WHITESPACE"," ",522],["T_VARIABLE","$address",522],")",["T_WHITESPACE"," ",522],"{",["T_WHITESPACE","\n                    ",522],["T_VARIABLE","$address",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","setQuote",523],"(",["T_VARIABLE","$this",523],")",";",["T_WHITESPACE","\n                ",523],"}",["T_WHITESPACE","\n            ",524],"}",["T_WHITESPACE","\n        ",525],"}",["T_WHITESPACE","\n        ",526],["T_RETURN","return",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","_addresses",527],";",["T_WHITESPACE","\n    ",527],"}",["T_WHITESPACE","\n\n    ",528],["T_DOC_COMMENT","\/**\n     * Retrieve quote address by type\n     *\n     * @param   string $type\n     * @return  Mage_Sales_Model_Quote_Address\n     *\/",530],["T_WHITESPACE","\n    ",535],["T_PROTECTED","protected",536],["T_WHITESPACE"," ",536],["T_FUNCTION","function",536],["T_WHITESPACE"," ",536],["T_STRING","_getAddressByType",536],"(",["T_VARIABLE","$type",536],")",["T_WHITESPACE","\n    ",536],"{",["T_WHITESPACE","\n        ",537],["T_FOREACH","foreach",538],["T_WHITESPACE"," ",538],"(",["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","getAddressesCollection",538],"(",")",["T_WHITESPACE"," ",538],["T_AS","as",538],["T_WHITESPACE"," ",538],["T_VARIABLE","$address",538],")",["T_WHITESPACE"," ",538],"{",["T_WHITESPACE","\n            ",538],["T_IF","if",539],["T_WHITESPACE"," ",539],"(",["T_VARIABLE","$address",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","getAddressType",539],"(",")",["T_WHITESPACE"," ",539],["T_IS_EQUAL","==",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$type",539],["T_WHITESPACE"," ",539],["T_BOOLEAN_AND","&&",539],["T_WHITESPACE"," ",539],"!",["T_VARIABLE","$address",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","isDeleted",539],"(",")",")",["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n                ",539],["T_RETURN","return",540],["T_WHITESPACE"," ",540],["T_VARIABLE","$address",540],";",["T_WHITESPACE","\n            ",540],"}",["T_WHITESPACE","\n        ",541],"}",["T_WHITESPACE","\n\n        ",542],["T_VARIABLE","$address",544],["T_WHITESPACE"," ",544],"=",["T_WHITESPACE"," ",544],["T_STRING","Mage",544],["T_DOUBLE_COLON","::",544],["T_STRING","getModel",544],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_address'",544],")",["T_OBJECT_OPERATOR","->",544],["T_STRING","setAddressType",544],"(",["T_VARIABLE","$type",544],")",";",["T_WHITESPACE","\n        ",544],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","addAddress",545],"(",["T_VARIABLE","$address",545],")",";",["T_WHITESPACE","\n        ",545],["T_RETURN","return",546],["T_WHITESPACE"," ",546],["T_VARIABLE","$address",546],";",["T_WHITESPACE","\n    ",546],"}",["T_WHITESPACE","\n\n    ",547],["T_DOC_COMMENT","\/**\n     * Retrieve quote billing address\n     *\n     * @return Mage_Sales_Model_Quote_Address\n     *\/",549],["T_WHITESPACE","\n    ",553],["T_PUBLIC","public",554],["T_WHITESPACE"," ",554],["T_FUNCTION","function",554],["T_WHITESPACE"," ",554],["T_STRING","getBillingAddress",554],"(",")",["T_WHITESPACE","\n    ",554],"{",["T_WHITESPACE","\n        ",555],["T_RETURN","return",556],["T_WHITESPACE"," ",556],["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","_getAddressByType",556],"(",["T_STRING","Mage_Sales_Model_Quote_Address",556],["T_DOUBLE_COLON","::",556],["T_STRING","TYPE_BILLING",556],")",";",["T_WHITESPACE","\n    ",556],"}",["T_WHITESPACE","\n\n    ",557],["T_DOC_COMMENT","\/**\n     * Retrieve quote shipping address\n     *\n     * @return Mage_Sales_Model_Quote_Address\n     *\/",559],["T_WHITESPACE","\n    ",563],["T_PUBLIC","public",564],["T_WHITESPACE"," ",564],["T_FUNCTION","function",564],["T_WHITESPACE"," ",564],["T_STRING","getShippingAddress",564],"(",")",["T_WHITESPACE","\n    ",564],"{",["T_WHITESPACE","\n        ",565],["T_RETURN","return",566],["T_WHITESPACE"," ",566],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","_getAddressByType",566],"(",["T_STRING","Mage_Sales_Model_Quote_Address",566],["T_DOUBLE_COLON","::",566],["T_STRING","TYPE_SHIPPING",566],")",";",["T_WHITESPACE","\n    ",566],"}",["T_WHITESPACE","\n\n    ",567],["T_PUBLIC","public",569],["T_WHITESPACE"," ",569],["T_FUNCTION","function",569],["T_WHITESPACE"," ",569],["T_STRING","getAllShippingAddresses",569],"(",")",["T_WHITESPACE","\n    ",569],"{",["T_WHITESPACE","\n        ",570],["T_VARIABLE","$addresses",571],["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_ARRAY","array",571],"(",")",";",["T_WHITESPACE","\n        ",571],["T_FOREACH","foreach",572],["T_WHITESPACE"," ",572],"(",["T_VARIABLE","$this",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","getAddressesCollection",572],"(",")",["T_WHITESPACE"," ",572],["T_AS","as",572],["T_WHITESPACE"," ",572],["T_VARIABLE","$address",572],")",["T_WHITESPACE"," ",572],"{",["T_WHITESPACE","\n            ",572],["T_IF","if",573],["T_WHITESPACE"," ",573],"(",["T_VARIABLE","$address",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","getAddressType",573],"(",")",["T_IS_EQUAL","==",573],["T_STRING","Mage_Sales_Model_Quote_Address",573],["T_DOUBLE_COLON","::",573],["T_STRING","TYPE_SHIPPING",573],["T_WHITESPACE","\n                ",573],["T_BOOLEAN_AND","&&",574],["T_WHITESPACE"," ",574],"!",["T_VARIABLE","$address",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","isDeleted",574],"(",")",")",["T_WHITESPACE"," ",574],"{",["T_WHITESPACE","\n                ",574],["T_VARIABLE","$addresses",575],"[","]",["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_VARIABLE","$address",575],";",["T_WHITESPACE","\n            ",575],"}",["T_WHITESPACE","\n        ",576],"}",["T_WHITESPACE","\n        ",577],["T_RETURN","return",578],["T_WHITESPACE"," ",578],["T_VARIABLE","$addresses",578],";",["T_WHITESPACE","\n    ",578],"}",["T_WHITESPACE","\n\n    ",579],["T_PUBLIC","public",581],["T_WHITESPACE"," ",581],["T_FUNCTION","function",581],["T_WHITESPACE"," ",581],["T_STRING","getAllAddresses",581],"(",")",["T_WHITESPACE","\n    ",581],"{",["T_WHITESPACE","\n        ",582],["T_VARIABLE","$addresses",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_ARRAY","array",583],"(",")",";",["T_WHITESPACE","\n        ",583],["T_FOREACH","foreach",584],["T_WHITESPACE"," ",584],"(",["T_VARIABLE","$this",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","getAddressesCollection",584],"(",")",["T_WHITESPACE"," ",584],["T_AS","as",584],["T_WHITESPACE"," ",584],["T_VARIABLE","$address",584],")",["T_WHITESPACE"," ",584],"{",["T_WHITESPACE","\n            ",584],["T_IF","if",585],["T_WHITESPACE"," ",585],"(","!",["T_VARIABLE","$address",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","isDeleted",585],"(",")",")",["T_WHITESPACE"," ",585],"{",["T_WHITESPACE","\n                ",585],["T_VARIABLE","$addresses",586],"[","]",["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_VARIABLE","$address",586],";",["T_WHITESPACE","\n            ",586],"}",["T_WHITESPACE","\n        ",587],"}",["T_WHITESPACE","\n        ",588],["T_RETURN","return",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$addresses",589],";",["T_WHITESPACE","\n    ",589],"}",["T_WHITESPACE","\n\n    ",590],["T_DOC_COMMENT","\/**\n     *\n     * @param int $addressId\n     * @return Mage_Sales_Model_Quote_Address\n     *\/",592],["T_WHITESPACE","\n    ",596],["T_PUBLIC","public",597],["T_WHITESPACE"," ",597],["T_FUNCTION","function",597],["T_WHITESPACE"," ",597],["T_STRING","getAddressById",597],"(",["T_VARIABLE","$addressId",597],")",["T_WHITESPACE","\n    ",597],"{",["T_WHITESPACE","\n        ",598],["T_FOREACH","foreach",599],["T_WHITESPACE"," ",599],"(",["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","getAddressesCollection",599],"(",")",["T_WHITESPACE"," ",599],["T_AS","as",599],["T_WHITESPACE"," ",599],["T_VARIABLE","$address",599],")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n            ",599],["T_IF","if",600],["T_WHITESPACE"," ",600],"(",["T_VARIABLE","$address",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","getId",600],"(",")",["T_IS_EQUAL","==",600],["T_VARIABLE","$addressId",600],")",["T_WHITESPACE"," ",600],"{",["T_WHITESPACE","\n                ",600],["T_RETURN","return",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$address",601],";",["T_WHITESPACE","\n            ",601],"}",["T_WHITESPACE","\n        ",602],"}",["T_WHITESPACE","\n        ",603],["T_RETURN","return",604],["T_WHITESPACE"," ",604],["T_STRING","false",604],";",["T_WHITESPACE","\n    ",604],"}",["T_WHITESPACE","\n\n    ",605],["T_PUBLIC","public",607],["T_WHITESPACE"," ",607],["T_FUNCTION","function",607],["T_WHITESPACE"," ",607],["T_STRING","getAddressByCustomerAddressId",607],"(",["T_VARIABLE","$addressId",607],")",["T_WHITESPACE","\n    ",607],"{",["T_WHITESPACE","\n        ",608],["T_FOREACH","foreach",609],["T_WHITESPACE"," ",609],"(",["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","getAddressesCollection",609],"(",")",["T_WHITESPACE"," ",609],["T_AS","as",609],["T_WHITESPACE"," ",609],["T_VARIABLE","$address",609],")",["T_WHITESPACE"," ",609],"{",["T_WHITESPACE","\n            ",609],["T_IF","if",610],["T_WHITESPACE"," ",610],"(","!",["T_VARIABLE","$address",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","isDeleted",610],"(",")",["T_WHITESPACE"," ",610],["T_BOOLEAN_AND","&&",610],["T_WHITESPACE"," ",610],["T_VARIABLE","$address",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getCustomerAddressId",610],"(",")",["T_IS_EQUAL","==",610],["T_VARIABLE","$addressId",610],")",["T_WHITESPACE"," ",610],"{",["T_WHITESPACE","\n                ",610],["T_RETURN","return",611],["T_WHITESPACE"," ",611],["T_VARIABLE","$address",611],";",["T_WHITESPACE","\n            ",611],"}",["T_WHITESPACE","\n        ",612],"}",["T_WHITESPACE","\n        ",613],["T_RETURN","return",614],["T_WHITESPACE"," ",614],["T_STRING","false",614],";",["T_WHITESPACE","\n    ",614],"}",["T_WHITESPACE","\n\n    ",615],["T_PUBLIC","public",617],["T_WHITESPACE"," ",617],["T_FUNCTION","function",617],["T_WHITESPACE"," ",617],["T_STRING","getShippingAddressByCustomerAddressId",617],"(",["T_VARIABLE","$addressId",617],")",["T_WHITESPACE","\n    ",617],"{",["T_WHITESPACE","\n        ",618],["T_FOREACH","foreach",619],["T_WHITESPACE"," ",619],"(",["T_VARIABLE","$this",619],["T_OBJECT_OPERATOR","->",619],["T_STRING","getAddressesCollection",619],"(",")",["T_WHITESPACE"," ",619],["T_AS","as",619],["T_WHITESPACE"," ",619],["T_VARIABLE","$address",619],")",["T_WHITESPACE"," ",619],"{",["T_WHITESPACE","\n            ",619],["T_IF","if",620],["T_WHITESPACE"," ",620],"(","!",["T_VARIABLE","$address",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","isDeleted",620],"(",")",["T_WHITESPACE"," ",620],["T_BOOLEAN_AND","&&",620],["T_WHITESPACE"," ",620],["T_VARIABLE","$address",620],["T_OBJECT_OPERATOR","->",620],["T_STRING","getAddressType",620],"(",")",["T_IS_EQUAL","==",620],["T_STRING","Mage_Sales_Model_Quote_Address",620],["T_DOUBLE_COLON","::",620],["T_STRING","TYPE_SHIPPING",620],["T_WHITESPACE","\n                ",620],["T_BOOLEAN_AND","&&",621],["T_WHITESPACE"," ",621],["T_VARIABLE","$address",621],["T_OBJECT_OPERATOR","->",621],["T_STRING","getCustomerAddressId",621],"(",")",["T_IS_EQUAL","==",621],["T_VARIABLE","$addressId",621],")",["T_WHITESPACE"," ",621],"{",["T_WHITESPACE","\n                ",621],["T_RETURN","return",622],["T_WHITESPACE"," ",622],["T_VARIABLE","$address",622],";",["T_WHITESPACE","\n            ",622],"}",["T_WHITESPACE","\n        ",623],"}",["T_WHITESPACE","\n        ",624],["T_RETURN","return",625],["T_WHITESPACE"," ",625],["T_STRING","false",625],";",["T_WHITESPACE","\n    ",625],"}",["T_WHITESPACE","\n\n    ",626],["T_PUBLIC","public",628],["T_WHITESPACE"," ",628],["T_FUNCTION","function",628],["T_WHITESPACE"," ",628],["T_STRING","removeAddress",628],"(",["T_VARIABLE","$addressId",628],")",["T_WHITESPACE","\n    ",628],"{",["T_WHITESPACE","\n        ",629],["T_FOREACH","foreach",630],["T_WHITESPACE"," ",630],"(",["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","getAddressesCollection",630],"(",")",["T_WHITESPACE"," ",630],["T_AS","as",630],["T_WHITESPACE"," ",630],["T_VARIABLE","$address",630],")",["T_WHITESPACE"," ",630],"{",["T_WHITESPACE","\n            ",630],["T_IF","if",631],["T_WHITESPACE"," ",631],"(",["T_VARIABLE","$address",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","getId",631],"(",")",["T_IS_EQUAL","==",631],["T_VARIABLE","$addressId",631],")",["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n                ",631],["T_VARIABLE","$address",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","isDeleted",632],"(",["T_STRING","true",632],")",";",["T_WHITESPACE","\n                ",632],["T_BREAK","break",633],";",["T_WHITESPACE","\n            ",633],"}",["T_WHITESPACE","\n        ",634],"}",["T_WHITESPACE","\n        ",635],["T_RETURN","return",636],["T_WHITESPACE"," ",636],["T_VARIABLE","$this",636],";",["T_WHITESPACE","\n    ",636],"}",["T_WHITESPACE","\n\n    ",637],["T_DOC_COMMENT","\/**\n     * Leave no more than one billing and one shipping address, fill them with default data\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",639],["T_WHITESPACE","\n    ",643],["T_PUBLIC","public",644],["T_WHITESPACE"," ",644],["T_FUNCTION","function",644],["T_WHITESPACE"," ",644],["T_STRING","removeAllAddresses",644],"(",")",["T_WHITESPACE","\n    ",644],"{",["T_WHITESPACE","\n        ",645],["T_VARIABLE","$addressByType",646],["T_WHITESPACE"," ",646],"=",["T_WHITESPACE"," ",646],["T_ARRAY","array",646],"(",")",";",["T_WHITESPACE","\n        ",646],["T_VARIABLE","$addressesCollection",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_VARIABLE","$this",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","getAddressesCollection",647],"(",")",";",["T_WHITESPACE","\n\n        ",647],["T_COMMENT","\/\/ mark all addresses as deleted\n",649],["T_WHITESPACE","        ",650],["T_FOREACH","foreach",650],["T_WHITESPACE"," ",650],"(",["T_VARIABLE","$addressesCollection",650],["T_WHITESPACE"," ",650],["T_AS","as",650],["T_WHITESPACE"," ",650],["T_VARIABLE","$address",650],")",["T_WHITESPACE"," ",650],"{",["T_WHITESPACE","\n            ",650],["T_VARIABLE","$type",651],["T_WHITESPACE"," ",651],"=",["T_WHITESPACE"," ",651],["T_VARIABLE","$address",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","getAddressType",651],"(",")",";",["T_WHITESPACE","\n            ",651],["T_IF","if",652],["T_WHITESPACE"," ",652],"(","!",["T_ISSET","isset",652],"(",["T_VARIABLE","$addressByType",652],"[",["T_VARIABLE","$type",652],"]",")",["T_WHITESPACE"," ",652],["T_BOOLEAN_OR","||",652],["T_WHITESPACE"," ",652],["T_VARIABLE","$addressByType",652],"[",["T_VARIABLE","$type",652],"]",["T_OBJECT_OPERATOR","->",652],["T_STRING","getId",652],"(",")",["T_WHITESPACE"," ",652],">",["T_WHITESPACE"," ",652],["T_VARIABLE","$address",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","getId",652],"(",")",")",["T_WHITESPACE"," ",652],"{",["T_WHITESPACE","\n                ",652],["T_VARIABLE","$addressByType",653],"[",["T_VARIABLE","$type",653],"]",["T_WHITESPACE"," ",653],"=",["T_WHITESPACE"," ",653],["T_VARIABLE","$address",653],";",["T_WHITESPACE","\n            ",653],"}",["T_WHITESPACE","\n            ",654],["T_VARIABLE","$address",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","isDeleted",655],"(",["T_STRING","true",655],")",";",["T_WHITESPACE","\n        ",655],"}",["T_WHITESPACE","\n\n        ",656],["T_COMMENT","\/\/ create new billing and shipping addresses filled with default values, set this data to existing records\n",658],["T_WHITESPACE","        ",659],["T_FOREACH","foreach",659],["T_WHITESPACE"," ",659],"(",["T_VARIABLE","$addressByType",659],["T_WHITESPACE"," ",659],["T_AS","as",659],["T_WHITESPACE"," ",659],["T_VARIABLE","$type",659],["T_WHITESPACE"," ",659],["T_DOUBLE_ARROW","=>",659],["T_WHITESPACE"," ",659],["T_VARIABLE","$address",659],")",["T_WHITESPACE"," ",659],"{",["T_WHITESPACE","\n            ",659],["T_VARIABLE","$id",660],["T_WHITESPACE"," ",660],"=",["T_WHITESPACE"," ",660],["T_VARIABLE","$address",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","getId",660],"(",")",";",["T_WHITESPACE","\n            ",660],["T_VARIABLE","$emptyAddress",661],["T_WHITESPACE"," ",661],"=",["T_WHITESPACE"," ",661],["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","_getAddressByType",661],"(",["T_VARIABLE","$type",661],")",";",["T_WHITESPACE","\n            ",661],["T_VARIABLE","$address",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","setData",662],"(",["T_VARIABLE","$emptyAddress",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","getData",662],"(",")",")",["T_OBJECT_OPERATOR","->",662],["T_STRING","setId",662],"(",["T_VARIABLE","$id",662],")",["T_OBJECT_OPERATOR","->",662],["T_STRING","isDeleted",662],"(",["T_STRING","false",662],")",";",["T_WHITESPACE","\n            ",662],["T_VARIABLE","$emptyAddress",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","setDeleteImmediately",663],"(",["T_STRING","true",663],")",";",["T_WHITESPACE","\n        ",663],"}",["T_WHITESPACE","\n\n        ",664],["T_COMMENT","\/\/ remove newly created billing and shipping addresses from collection to avoid senseless delete queries\n",666],["T_WHITESPACE","        ",667],["T_FOREACH","foreach",667],["T_WHITESPACE"," ",667],"(",["T_VARIABLE","$addressesCollection",667],["T_WHITESPACE"," ",667],["T_AS","as",667],["T_WHITESPACE"," ",667],["T_VARIABLE","$key",667],["T_WHITESPACE"," ",667],["T_DOUBLE_ARROW","=>",667],["T_WHITESPACE"," ",667],["T_VARIABLE","$item",667],")",["T_WHITESPACE"," ",667],"{",["T_WHITESPACE","\n            ",667],["T_IF","if",668],["T_WHITESPACE"," ",668],"(",["T_VARIABLE","$item",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","getDeleteImmediately",668],"(",")",")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n                ",668],["T_VARIABLE","$addressesCollection",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","removeItemByKey",669],"(",["T_VARIABLE","$key",669],")",";",["T_WHITESPACE","\n            ",669],"}",["T_WHITESPACE","\n        ",670],"}",["T_WHITESPACE","\n\n        ",671],["T_RETURN","return",673],["T_WHITESPACE"," ",673],["T_VARIABLE","$this",673],";",["T_WHITESPACE","\n    ",673],"}",["T_WHITESPACE","\n\n    ",674],["T_PUBLIC","public",676],["T_WHITESPACE"," ",676],["T_FUNCTION","function",676],["T_WHITESPACE"," ",676],["T_STRING","addAddress",676],"(",["T_STRING","Mage_Sales_Model_Quote_Address",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$address",676],")",["T_WHITESPACE","\n    ",676],"{",["T_WHITESPACE","\n        ",677],["T_VARIABLE","$address",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","setQuote",678],"(",["T_VARIABLE","$this",678],")",";",["T_WHITESPACE","\n        ",678],["T_IF","if",679],["T_WHITESPACE"," ",679],"(","!",["T_VARIABLE","$address",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getId",679],"(",")",")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n            ",679],["T_VARIABLE","$this",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","getAddressesCollection",680],"(",")",["T_OBJECT_OPERATOR","->",680],["T_STRING","addItem",680],"(",["T_VARIABLE","$address",680],")",";",["T_WHITESPACE","\n        ",680],"}",["T_WHITESPACE","\n        ",681],["T_RETURN","return",682],["T_WHITESPACE"," ",682],["T_VARIABLE","$this",682],";",["T_WHITESPACE","\n    ",682],"}",["T_WHITESPACE","\n\n    ",683],["T_DOC_COMMENT","\/**\n     * Enter description here...\n     *\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @return Mage_Sales_Model_Quote\n     *\/",685],["T_WHITESPACE","\n    ",690],["T_PUBLIC","public",691],["T_WHITESPACE"," ",691],["T_FUNCTION","function",691],["T_WHITESPACE"," ",691],["T_STRING","setBillingAddress",691],"(",["T_STRING","Mage_Sales_Model_Quote_Address",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$address",691],")",["T_WHITESPACE","\n    ",691],"{",["T_WHITESPACE","\n        ",692],["T_VARIABLE","$old",693],["T_WHITESPACE"," ",693],"=",["T_WHITESPACE"," ",693],["T_VARIABLE","$this",693],["T_OBJECT_OPERATOR","->",693],["T_STRING","getBillingAddress",693],"(",")",";",["T_WHITESPACE","\n\n        ",693],["T_IF","if",695],["T_WHITESPACE"," ",695],"(","!",["T_EMPTY","empty",695],"(",["T_VARIABLE","$old",695],")",")",["T_WHITESPACE"," ",695],"{",["T_WHITESPACE","\n            ",695],["T_VARIABLE","$old",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","addData",696],"(",["T_VARIABLE","$address",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","getData",696],"(",")",")",";",["T_WHITESPACE","\n        ",696],"}",["T_WHITESPACE"," ",697],["T_ELSE","else",697],["T_WHITESPACE"," ",697],"{",["T_WHITESPACE","\n            ",697],["T_VARIABLE","$this",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","addAddress",698],"(",["T_VARIABLE","$address",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","setAddressType",698],"(",["T_STRING","Mage_Sales_Model_Quote_Address",698],["T_DOUBLE_COLON","::",698],["T_STRING","TYPE_BILLING",698],")",")",";",["T_WHITESPACE","\n        ",698],"}",["T_WHITESPACE","\n        ",699],["T_RETURN","return",700],["T_WHITESPACE"," ",700],["T_VARIABLE","$this",700],";",["T_WHITESPACE","\n    ",700],"}",["T_WHITESPACE","\n\n    ",701],["T_DOC_COMMENT","\/**\n     * Enter description here...\n     *\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @return Mage_Sales_Model_Quote\n     *\/",703],["T_WHITESPACE","\n    ",708],["T_PUBLIC","public",709],["T_WHITESPACE"," ",709],["T_FUNCTION","function",709],["T_WHITESPACE"," ",709],["T_STRING","setShippingAddress",709],"(",["T_STRING","Mage_Sales_Model_Quote_Address",709],["T_WHITESPACE"," ",709],["T_VARIABLE","$address",709],")",["T_WHITESPACE","\n    ",709],"{",["T_WHITESPACE","\n        ",710],["T_IF","if",711],["T_WHITESPACE"," ",711],"(",["T_VARIABLE","$this",711],["T_OBJECT_OPERATOR","->",711],["T_STRING","getIsMultiShipping",711],"(",")",")",["T_WHITESPACE"," ",711],"{",["T_WHITESPACE","\n            ",711],["T_VARIABLE","$this",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","addAddress",712],"(",["T_VARIABLE","$address",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","setAddressType",712],"(",["T_STRING","Mage_Sales_Model_Quote_Address",712],["T_DOUBLE_COLON","::",712],["T_STRING","TYPE_SHIPPING",712],")",")",";",["T_WHITESPACE","\n        ",712],"}",["T_WHITESPACE","\n        ",713],["T_ELSE","else",714],["T_WHITESPACE"," ",714],"{",["T_WHITESPACE","\n            ",714],["T_VARIABLE","$old",715],["T_WHITESPACE"," ",715],"=",["T_WHITESPACE"," ",715],["T_VARIABLE","$this",715],["T_OBJECT_OPERATOR","->",715],["T_STRING","getShippingAddress",715],"(",")",";",["T_WHITESPACE","\n\n            ",715],["T_IF","if",717],["T_WHITESPACE"," ",717],"(","!",["T_EMPTY","empty",717],"(",["T_VARIABLE","$old",717],")",")",["T_WHITESPACE"," ",717],"{",["T_WHITESPACE","\n                ",717],["T_VARIABLE","$old",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","addData",718],"(",["T_VARIABLE","$address",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getData",718],"(",")",")",";",["T_WHITESPACE","\n            ",718],"}",["T_WHITESPACE"," ",719],["T_ELSE","else",719],["T_WHITESPACE"," ",719],"{",["T_WHITESPACE","\n                ",719],["T_VARIABLE","$this",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","addAddress",720],"(",["T_VARIABLE","$address",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","setAddressType",720],"(",["T_STRING","Mage_Sales_Model_Quote_Address",720],["T_DOUBLE_COLON","::",720],["T_STRING","TYPE_SHIPPING",720],")",")",";",["T_WHITESPACE","\n            ",720],"}",["T_WHITESPACE","\n        ",721],"}",["T_WHITESPACE","\n        ",722],["T_RETURN","return",723],["T_WHITESPACE"," ",723],["T_VARIABLE","$this",723],";",["T_WHITESPACE","\n    ",723],"}",["T_WHITESPACE","\n\n    ",724],["T_PUBLIC","public",726],["T_WHITESPACE"," ",726],["T_FUNCTION","function",726],["T_WHITESPACE"," ",726],["T_STRING","addShippingAddress",726],"(",["T_STRING","Mage_Sales_Model_Quote_Address",726],["T_WHITESPACE"," ",726],["T_VARIABLE","$address",726],")",["T_WHITESPACE","\n    ",726],"{",["T_WHITESPACE","\n        ",727],["T_VARIABLE","$this",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","setShippingAddress",728],"(",["T_VARIABLE","$address",728],")",";",["T_WHITESPACE","\n        ",728],["T_RETURN","return",729],["T_WHITESPACE"," ",729],["T_VARIABLE","$this",729],";",["T_WHITESPACE","\n    ",729],"}",["T_WHITESPACE","\n\n    ",730],["T_DOC_COMMENT","\/**\n     * Retrieve quote items collection\n     *\n     * @param   bool $loaded\n     * @return  Mage_Eav_Model_Entity_Collection_Abstract\n     *\/",732],["T_WHITESPACE","\n    ",737],["T_PUBLIC","public",738],["T_WHITESPACE"," ",738],["T_FUNCTION","function",738],["T_WHITESPACE"," ",738],["T_STRING","getItemsCollection",738],"(",["T_VARIABLE","$useCache",738],["T_WHITESPACE"," ",738],"=",["T_WHITESPACE"," ",738],["T_STRING","true",738],")",["T_WHITESPACE","\n    ",738],"{",["T_WHITESPACE","\n        ",739],["T_IF","if",740],["T_WHITESPACE"," ",740],"(",["T_VARIABLE","$this",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","hasItemsCollection",740],"(",")",")",["T_WHITESPACE"," ",740],"{",["T_WHITESPACE","\n            ",740],["T_RETURN","return",741],["T_WHITESPACE"," ",741],["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","getData",741],"(",["T_CONSTANT_ENCAPSED_STRING","'items_collection'",741],")",";",["T_WHITESPACE","\n        ",741],"}",["T_WHITESPACE","\n        ",742],["T_IF","if",743],["T_WHITESPACE"," ",743],"(",["T_STRING","is_null",743],"(",["T_VARIABLE","$this",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","_items",743],")",")",["T_WHITESPACE"," ",743],"{",["T_WHITESPACE","\n            ",743],["T_VARIABLE","$this",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","_items",744],["T_WHITESPACE"," ",744],"=",["T_WHITESPACE"," ",744],["T_STRING","Mage",744],["T_DOUBLE_COLON","::",744],["T_STRING","getModel",744],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_item'",744],")",["T_OBJECT_OPERATOR","->",744],["T_STRING","getCollection",744],"(",")",";",["T_WHITESPACE","\n            ",744],["T_VARIABLE","$this",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","_items",745],["T_OBJECT_OPERATOR","->",745],["T_STRING","setQuote",745],"(",["T_VARIABLE","$this",745],")",";",["T_WHITESPACE","\n        ",745],"}",["T_WHITESPACE","\n        ",746],["T_RETURN","return",747],["T_WHITESPACE"," ",747],["T_VARIABLE","$this",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","_items",747],";",["T_WHITESPACE","\n    ",747],"}",["T_WHITESPACE","\n\n    ",748],["T_DOC_COMMENT","\/**\n     * Retrieve quote items array\n     *\n     * @return array\n     *\/",750],["T_WHITESPACE","\n    ",754],["T_PUBLIC","public",755],["T_WHITESPACE"," ",755],["T_FUNCTION","function",755],["T_WHITESPACE"," ",755],["T_STRING","getAllItems",755],"(",")",["T_WHITESPACE","\n    ",755],"{",["T_WHITESPACE","\n        ",756],["T_VARIABLE","$items",757],["T_WHITESPACE"," ",757],"=",["T_WHITESPACE"," ",757],["T_ARRAY","array",757],"(",")",";",["T_WHITESPACE","\n        ",757],["T_FOREACH","foreach",758],["T_WHITESPACE"," ",758],"(",["T_VARIABLE","$this",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","getItemsCollection",758],"(",")",["T_WHITESPACE"," ",758],["T_AS","as",758],["T_WHITESPACE"," ",758],["T_VARIABLE","$item",758],")",["T_WHITESPACE"," ",758],"{",["T_WHITESPACE","\n            ",758],["T_IF","if",759],["T_WHITESPACE"," ",759],"(","!",["T_VARIABLE","$item",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","isDeleted",759],"(",")",")",["T_WHITESPACE"," ",759],"{",["T_WHITESPACE","\n                ",759],["T_VARIABLE","$items",760],"[","]",["T_WHITESPACE"," ",760],"=",["T_WHITESPACE","  ",760],["T_VARIABLE","$item",760],";",["T_WHITESPACE","\n            ",760],"}",["T_WHITESPACE","\n        ",761],"}",["T_WHITESPACE","\n        ",762],["T_RETURN","return",763],["T_WHITESPACE"," ",763],["T_VARIABLE","$items",763],";",["T_WHITESPACE","\n    ",763],"}",["T_WHITESPACE","\n\n    ",764],["T_DOC_COMMENT","\/**\n     * Get array of all items what can be display directly\n     *\n     * @return array\n     *\/",766],["T_WHITESPACE","\n    ",770],["T_PUBLIC","public",771],["T_WHITESPACE"," ",771],["T_FUNCTION","function",771],["T_WHITESPACE"," ",771],["T_STRING","getAllVisibleItems",771],"(",")",["T_WHITESPACE","\n    ",771],"{",["T_WHITESPACE","\n        ",772],["T_VARIABLE","$items",773],["T_WHITESPACE"," ",773],"=",["T_WHITESPACE"," ",773],["T_ARRAY","array",773],"(",")",";",["T_WHITESPACE","\n        ",773],["T_FOREACH","foreach",774],["T_WHITESPACE"," ",774],"(",["T_VARIABLE","$this",774],["T_OBJECT_OPERATOR","->",774],["T_STRING","getItemsCollection",774],"(",")",["T_WHITESPACE"," ",774],["T_AS","as",774],["T_WHITESPACE"," ",774],["T_VARIABLE","$item",774],")",["T_WHITESPACE"," ",774],"{",["T_WHITESPACE","\n            ",774],["T_IF","if",775],["T_WHITESPACE"," ",775],"(","!",["T_VARIABLE","$item",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","isDeleted",775],"(",")",["T_WHITESPACE"," ",775],["T_BOOLEAN_AND","&&",775],["T_WHITESPACE"," ",775],"!",["T_VARIABLE","$item",775],["T_OBJECT_OPERATOR","->",775],["T_STRING","getParentItemId",775],"(",")",")",["T_WHITESPACE"," ",775],"{",["T_WHITESPACE","\n                ",775],["T_VARIABLE","$items",776],"[","]",["T_WHITESPACE"," ",776],"=",["T_WHITESPACE","  ",776],["T_VARIABLE","$item",776],";",["T_WHITESPACE","\n            ",776],"}",["T_WHITESPACE","\n        ",777],"}",["T_WHITESPACE","\n        ",778],["T_RETURN","return",779],["T_WHITESPACE"," ",779],["T_VARIABLE","$items",779],";",["T_WHITESPACE","\n    ",779],"}",["T_WHITESPACE","\n\n    ",780],["T_DOC_COMMENT","\/**\n     * Checking items availability\n     *\n     * @return bool\n     *\/",782],["T_WHITESPACE","\n    ",786],["T_PUBLIC","public",787],["T_WHITESPACE"," ",787],["T_FUNCTION","function",787],["T_WHITESPACE"," ",787],["T_STRING","hasItems",787],"(",")",["T_WHITESPACE","\n    ",787],"{",["T_WHITESPACE","\n        ",788],["T_RETURN","return",789],["T_WHITESPACE"," ",789],["T_STRING","sizeof",789],"(",["T_VARIABLE","$this",789],["T_OBJECT_OPERATOR","->",789],["T_STRING","getAllItems",789],"(",")",")",">",["T_LNUMBER","0",789],";",["T_WHITESPACE","\n    ",789],"}",["T_WHITESPACE","\n\n    ",790],["T_DOC_COMMENT","\/**\n     * Checking availability of items with decimal qty\n     *\n     * @return bool\n     *\/",792],["T_WHITESPACE","\n    ",796],["T_PUBLIC","public",797],["T_WHITESPACE"," ",797],["T_FUNCTION","function",797],["T_WHITESPACE"," ",797],["T_STRING","hasItemsWithDecimalQty",797],"(",")",["T_WHITESPACE","\n    ",797],"{",["T_WHITESPACE","\n        ",798],["T_FOREACH","foreach",799],["T_WHITESPACE"," ",799],"(",["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","getAllItems",799],"(",")",["T_WHITESPACE"," ",799],["T_AS","as",799],["T_WHITESPACE"," ",799],["T_VARIABLE","$item",799],")",["T_WHITESPACE"," ",799],"{",["T_WHITESPACE","\n            ",799],["T_IF","if",800],["T_WHITESPACE"," ",800],"(",["T_VARIABLE","$item",800],["T_OBJECT_OPERATOR","->",800],["T_STRING","getProduct",800],"(",")",["T_OBJECT_OPERATOR","->",800],["T_STRING","getStockItem",800],"(",")",["T_WHITESPACE","\n                ",800],["T_BOOLEAN_AND","&&",801],["T_WHITESPACE"," ",801],["T_VARIABLE","$item",801],["T_OBJECT_OPERATOR","->",801],["T_STRING","getProduct",801],"(",")",["T_OBJECT_OPERATOR","->",801],["T_STRING","getStockItem",801],"(",")",["T_OBJECT_OPERATOR","->",801],["T_STRING","getIsQtyDecimal",801],"(",")",")",["T_WHITESPACE"," ",801],"{",["T_WHITESPACE","\n                ",801],["T_RETURN","return",802],["T_WHITESPACE"," ",802],["T_STRING","true",802],";",["T_WHITESPACE","\n            ",802],"}",["T_WHITESPACE","\n        ",803],"}",["T_WHITESPACE","\n        ",804],["T_RETURN","return",805],["T_WHITESPACE"," ",805],["T_STRING","false",805],";",["T_WHITESPACE","\n    ",805],"}",["T_WHITESPACE","\n\n    ",806],["T_DOC_COMMENT","\/**\n     * Checking product exist in Quote\n     *\n     * @param int $productId\n     * @return bool\n     *\/",808],["T_WHITESPACE","\n    ",813],["T_PUBLIC","public",814],["T_WHITESPACE"," ",814],["T_FUNCTION","function",814],["T_WHITESPACE"," ",814],["T_STRING","hasProductId",814],"(",["T_VARIABLE","$productId",814],")",["T_WHITESPACE","\n    ",814],"{",["T_WHITESPACE","\n        ",815],["T_FOREACH","foreach",816],["T_WHITESPACE"," ",816],"(",["T_VARIABLE","$this",816],["T_OBJECT_OPERATOR","->",816],["T_STRING","getAllItems",816],"(",")",["T_WHITESPACE"," ",816],["T_AS","as",816],["T_WHITESPACE"," ",816],["T_VARIABLE","$item",816],")",["T_WHITESPACE"," ",816],"{",["T_WHITESPACE","\n            ",816],["T_IF","if",817],["T_WHITESPACE"," ",817],"(",["T_VARIABLE","$item",817],["T_OBJECT_OPERATOR","->",817],["T_STRING","getProductId",817],"(",")",["T_WHITESPACE"," ",817],["T_IS_EQUAL","==",817],["T_WHITESPACE"," ",817],["T_VARIABLE","$productId",817],")",["T_WHITESPACE"," ",817],"{",["T_WHITESPACE","\n                ",817],["T_RETURN","return",818],["T_WHITESPACE"," ",818],["T_STRING","true",818],";",["T_WHITESPACE","\n            ",818],"}",["T_WHITESPACE","\n        ",819],"}",["T_WHITESPACE","\n\n        ",820],["T_RETURN","return",822],["T_WHITESPACE"," ",822],["T_STRING","false",822],";",["T_WHITESPACE","\n    ",822],"}",["T_WHITESPACE","\n\n    ",823],["T_DOC_COMMENT","\/**\n     * Retrieve item model object by item identifier\n     *\n     * @param   int $itemId\n     * @return  Mage_Sales_Model_Quote_Item\n     *\/",825],["T_WHITESPACE","\n    ",830],["T_PUBLIC","public",831],["T_WHITESPACE"," ",831],["T_FUNCTION","function",831],["T_WHITESPACE"," ",831],["T_STRING","getItemById",831],"(",["T_VARIABLE","$itemId",831],")",["T_WHITESPACE","\n    ",831],"{",["T_WHITESPACE","\n        ",832],["T_RETURN","return",833],["T_WHITESPACE"," ",833],["T_VARIABLE","$this",833],["T_OBJECT_OPERATOR","->",833],["T_STRING","getItemsCollection",833],"(",")",["T_OBJECT_OPERATOR","->",833],["T_STRING","getItemById",833],"(",["T_VARIABLE","$itemId",833],")",";",["T_WHITESPACE","\n    ",833],"}",["T_WHITESPACE","\n\n    ",834],["T_DOC_COMMENT","\/**\n     * Delete quote item. If it does not have identifier then it will be only removed from collection\n     *\n     * @param   Mage_Sales_Model_Quote_Item $item\n     * @return  Mage_Sales_Model_Quote\n     *\/",836],["T_WHITESPACE","\n    ",841],["T_PUBLIC","public",842],["T_WHITESPACE"," ",842],["T_FUNCTION","function",842],["T_WHITESPACE"," ",842],["T_STRING","deleteItem",842],"(",["T_STRING","Mage_Sales_Model_Quote_Item",842],["T_WHITESPACE"," ",842],["T_VARIABLE","$item",842],")",["T_WHITESPACE","\n    ",842],"{",["T_WHITESPACE","\n        ",843],["T_IF","if",844],["T_WHITESPACE"," ",844],"(",["T_VARIABLE","$item",844],["T_OBJECT_OPERATOR","->",844],["T_STRING","getId",844],"(",")",")",["T_WHITESPACE"," ",844],"{",["T_WHITESPACE","\n            ",844],["T_VARIABLE","$this",845],["T_OBJECT_OPERATOR","->",845],["T_STRING","removeItem",845],"(",["T_VARIABLE","$item",845],["T_OBJECT_OPERATOR","->",845],["T_STRING","getId",845],"(",")",")",";",["T_WHITESPACE","\n        ",845],"}",["T_WHITESPACE"," ",846],["T_ELSE","else",846],["T_WHITESPACE"," ",846],"{",["T_WHITESPACE","\n            ",846],["T_VARIABLE","$quoteItems",847],["T_WHITESPACE"," ",847],"=",["T_WHITESPACE"," ",847],["T_VARIABLE","$this",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","getItemsCollection",847],"(",")",";",["T_WHITESPACE","\n            ",847],["T_VARIABLE","$items",848],["T_WHITESPACE"," ",848],"=",["T_WHITESPACE"," ",848],["T_ARRAY","array",848],"(",["T_VARIABLE","$item",848],")",";",["T_WHITESPACE","\n            ",848],["T_IF","if",849],["T_WHITESPACE"," ",849],"(",["T_VARIABLE","$item",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","getHasChildren",849],"(",")",")",["T_WHITESPACE"," ",849],"{",["T_WHITESPACE","\n                ",849],["T_FOREACH","foreach",850],["T_WHITESPACE"," ",850],"(",["T_VARIABLE","$item",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","getChildren",850],"(",")",["T_WHITESPACE"," ",850],["T_AS","as",850],["T_WHITESPACE"," ",850],["T_VARIABLE","$child",850],")",["T_WHITESPACE"," ",850],"{",["T_WHITESPACE","\n                    ",850],["T_VARIABLE","$items",851],"[","]",["T_WHITESPACE"," ",851],"=",["T_WHITESPACE"," ",851],["T_VARIABLE","$child",851],";",["T_WHITESPACE","\n                ",851],"}",["T_WHITESPACE","\n            ",852],"}",["T_WHITESPACE","\n            ",853],["T_FOREACH","foreach",854],["T_WHITESPACE"," ",854],"(",["T_VARIABLE","$quoteItems",854],["T_WHITESPACE"," ",854],["T_AS","as",854],["T_WHITESPACE"," ",854],["T_VARIABLE","$key",854],["T_WHITESPACE"," ",854],["T_DOUBLE_ARROW","=>",854],["T_WHITESPACE"," ",854],["T_VARIABLE","$quoteItem",854],")",["T_WHITESPACE"," ",854],"{",["T_WHITESPACE","\n                ",854],["T_FOREACH","foreach",855],["T_WHITESPACE"," ",855],"(",["T_VARIABLE","$items",855],["T_WHITESPACE"," ",855],["T_AS","as",855],["T_WHITESPACE"," ",855],["T_VARIABLE","$item",855],")",["T_WHITESPACE"," ",855],"{",["T_WHITESPACE","\n                    ",855],["T_IF","if",856],["T_WHITESPACE"," ",856],"(",["T_VARIABLE","$quoteItem",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","compare",856],"(",["T_VARIABLE","$item",856],")",")",["T_WHITESPACE"," ",856],"{",["T_WHITESPACE","\n                        ",856],["T_VARIABLE","$quoteItems",857],["T_OBJECT_OPERATOR","->",857],["T_STRING","removeItemByKey",857],"(",["T_VARIABLE","$key",857],")",";",["T_WHITESPACE","\n                    ",857],"}",["T_WHITESPACE","\n                ",858],"}",["T_WHITESPACE","\n            ",859],"}",["T_WHITESPACE","\n        ",860],"}",["T_WHITESPACE","\n\n        ",861],["T_RETURN","return",863],["T_WHITESPACE"," ",863],["T_VARIABLE","$this",863],";",["T_WHITESPACE","\n    ",863],"}",["T_WHITESPACE","\n\n    ",864],["T_DOC_COMMENT","\/**\n     * Remove quote item by item identifier\n     *\n     * @param   int $itemId\n     * @return  Mage_Sales_Model_Quote\n     *\/",866],["T_WHITESPACE","\n    ",871],["T_PUBLIC","public",872],["T_WHITESPACE"," ",872],["T_FUNCTION","function",872],["T_WHITESPACE"," ",872],["T_STRING","removeItem",872],"(",["T_VARIABLE","$itemId",872],")",["T_WHITESPACE","\n    ",872],"{",["T_WHITESPACE","\n        ",873],["T_VARIABLE","$item",874],["T_WHITESPACE"," ",874],"=",["T_WHITESPACE"," ",874],["T_VARIABLE","$this",874],["T_OBJECT_OPERATOR","->",874],["T_STRING","getItemById",874],"(",["T_VARIABLE","$itemId",874],")",";",["T_WHITESPACE","\n\n        ",874],["T_IF","if",876],["T_WHITESPACE"," ",876],"(",["T_VARIABLE","$item",876],")",["T_WHITESPACE"," ",876],"{",["T_WHITESPACE","\n            ",876],["T_VARIABLE","$item",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","setQuote",877],"(",["T_VARIABLE","$this",877],")",";",["T_WHITESPACE","\n            ",877],["T_DOC_COMMENT","\/**\n             * If we remove item from quote - we can't use multishipping mode\n             *\/",878],["T_WHITESPACE","\n            ",880],["T_VARIABLE","$this",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","setIsMultiShipping",881],"(",["T_STRING","false",881],")",";",["T_WHITESPACE","\n            ",881],["T_VARIABLE","$item",882],["T_OBJECT_OPERATOR","->",882],["T_STRING","isDeleted",882],"(",["T_STRING","true",882],")",";",["T_WHITESPACE","\n            ",882],["T_IF","if",883],["T_WHITESPACE"," ",883],"(",["T_VARIABLE","$item",883],["T_OBJECT_OPERATOR","->",883],["T_STRING","getHasChildren",883],"(",")",")",["T_WHITESPACE"," ",883],"{",["T_WHITESPACE","\n                ",883],["T_FOREACH","foreach",884],["T_WHITESPACE"," ",884],"(",["T_VARIABLE","$item",884],["T_OBJECT_OPERATOR","->",884],["T_STRING","getChildren",884],"(",")",["T_WHITESPACE"," ",884],["T_AS","as",884],["T_WHITESPACE"," ",884],["T_VARIABLE","$child",884],")",["T_WHITESPACE"," ",884],"{",["T_WHITESPACE","\n                    ",884],["T_VARIABLE","$child",885],["T_OBJECT_OPERATOR","->",885],["T_STRING","isDeleted",885],"(",["T_STRING","true",885],")",";",["T_WHITESPACE","\n                ",885],"}",["T_WHITESPACE","\n            ",886],"}",["T_WHITESPACE","\n\n            ",887],["T_VARIABLE","$parent",889],["T_WHITESPACE"," ",889],"=",["T_WHITESPACE"," ",889],["T_VARIABLE","$item",889],["T_OBJECT_OPERATOR","->",889],["T_STRING","getParentItem",889],"(",")",";",["T_WHITESPACE","\n            ",889],["T_IF","if",890],["T_WHITESPACE"," ",890],"(",["T_VARIABLE","$parent",890],")",["T_WHITESPACE"," ",890],"{",["T_WHITESPACE","\n                ",890],["T_VARIABLE","$parent",891],["T_OBJECT_OPERATOR","->",891],["T_STRING","isDeleted",891],"(",["T_STRING","true",891],")",";",["T_WHITESPACE","\n            ",891],"}",["T_WHITESPACE","\n\n            ",892],["T_STRING","Mage",894],["T_DOUBLE_COLON","::",894],["T_STRING","dispatchEvent",894],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_quote_remove_item'",894],",",["T_WHITESPACE"," ",894],["T_ARRAY","array",894],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_item'",894],["T_WHITESPACE"," ",894],["T_DOUBLE_ARROW","=>",894],["T_WHITESPACE"," ",894],["T_VARIABLE","$item",894],")",")",";",["T_WHITESPACE","\n        ",894],"}",["T_WHITESPACE","\n\n        ",895],["T_RETURN","return",897],["T_WHITESPACE"," ",897],["T_VARIABLE","$this",897],";",["T_WHITESPACE","\n    ",897],"}",["T_WHITESPACE","\n\n    ",898],["T_DOC_COMMENT","\/**\n     * Mark all quote items as deleted (empty quote)\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",900],["T_WHITESPACE","\n    ",904],["T_PUBLIC","public",905],["T_WHITESPACE"," ",905],["T_FUNCTION","function",905],["T_WHITESPACE"," ",905],["T_STRING","removeAllItems",905],"(",")",["T_WHITESPACE","\n    ",905],"{",["T_WHITESPACE","\n        ",906],["T_FOREACH","foreach",907],["T_WHITESPACE"," ",907],"(",["T_VARIABLE","$this",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","getItemsCollection",907],"(",")",["T_WHITESPACE"," ",907],["T_AS","as",907],["T_WHITESPACE"," ",907],["T_VARIABLE","$itemId",907],["T_WHITESPACE"," ",907],["T_DOUBLE_ARROW","=>",907],["T_WHITESPACE"," ",907],["T_VARIABLE","$item",907],")",["T_WHITESPACE"," ",907],"{",["T_WHITESPACE","\n            ",907],["T_IF","if",908],["T_WHITESPACE"," ",908],"(",["T_STRING","is_null",908],"(",["T_VARIABLE","$item",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","getId",908],"(",")",")",")",["T_WHITESPACE"," ",908],"{",["T_WHITESPACE","\n                ",908],["T_VARIABLE","$this",909],["T_OBJECT_OPERATOR","->",909],["T_STRING","getItemsCollection",909],"(",")",["T_OBJECT_OPERATOR","->",909],["T_STRING","removeItemByKey",909],"(",["T_VARIABLE","$itemId",909],")",";",["T_WHITESPACE","\n            ",909],"}",["T_WHITESPACE"," ",910],["T_ELSE","else",910],["T_WHITESPACE"," ",910],"{",["T_WHITESPACE","\n                ",910],["T_VARIABLE","$item",911],["T_OBJECT_OPERATOR","->",911],["T_STRING","isDeleted",911],"(",["T_STRING","true",911],")",";",["T_WHITESPACE","\n            ",911],"}",["T_WHITESPACE","\n        ",912],"}",["T_WHITESPACE","\n        ",913],["T_RETURN","return",914],["T_WHITESPACE"," ",914],["T_VARIABLE","$this",914],";",["T_WHITESPACE","\n    ",914],"}",["T_WHITESPACE","\n\n    ",915],["T_DOC_COMMENT","\/**\n     * Adding new item to quote\n     *\n     * @param   Mage_Sales_Model_Quote_Item $item\n     * @return  Mage_Sales_Model_Quote\n     *\/",917],["T_WHITESPACE","\n    ",922],["T_PUBLIC","public",923],["T_WHITESPACE"," ",923],["T_FUNCTION","function",923],["T_WHITESPACE"," ",923],["T_STRING","addItem",923],"(",["T_STRING","Mage_Sales_Model_Quote_Item",923],["T_WHITESPACE"," ",923],["T_VARIABLE","$item",923],")",["T_WHITESPACE","\n    ",923],"{",["T_WHITESPACE","\n        ",924],["T_DOC_COMMENT","\/**\n         * Temporary workaround for purchase process: it is too dangerous to purchase more than one nominal item\n         * or a mixture of nominal and non-nominal items, although technically possible.\n         *\n         * The problem is that currently it is implemented as sequential submission of nominal items and order, by one click.\n         * It makes logically impossible to make the process of the purchase failsafe.\n         * Proper solution is to submit items one by one with customer confirmation each time.\n         *\/",925],["T_WHITESPACE","\n        ",932],["T_IF","if",933],["T_WHITESPACE"," ",933],"(",["T_VARIABLE","$item",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","isNominal",933],"(",")",["T_WHITESPACE"," ",933],["T_BOOLEAN_AND","&&",933],["T_WHITESPACE"," ",933],["T_VARIABLE","$this",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","hasItems",933],"(",")",["T_WHITESPACE"," ",933],["T_BOOLEAN_OR","||",933],["T_WHITESPACE"," ",933],["T_VARIABLE","$this",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","hasNominalItems",933],"(",")",")",["T_WHITESPACE"," ",933],"{",["T_WHITESPACE","\n            ",933],["T_STRING","Mage",934],["T_DOUBLE_COLON","::",934],["T_STRING","throwException",934],"(",["T_WHITESPACE","\n                ",934],["T_STRING","Mage",935],["T_DOUBLE_COLON","::",935],["T_STRING","helper",935],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",935],")",["T_OBJECT_OPERATOR","->",935],["T_STRING","__",935],"(",["T_CONSTANT_ENCAPSED_STRING","'Nominal item can be purchased standalone only. To proceed please remove other items from the quote.'",935],")",["T_WHITESPACE","\n            ",935],")",";",["T_WHITESPACE","\n        ",936],"}",["T_WHITESPACE","\n\n        ",937],["T_VARIABLE","$item",939],["T_OBJECT_OPERATOR","->",939],["T_STRING","setQuote",939],"(",["T_VARIABLE","$this",939],")",";",["T_WHITESPACE","\n        ",939],["T_IF","if",940],["T_WHITESPACE"," ",940],"(","!",["T_VARIABLE","$item",940],["T_OBJECT_OPERATOR","->",940],["T_STRING","getId",940],"(",")",")",["T_WHITESPACE"," ",940],"{",["T_WHITESPACE","\n            ",940],["T_VARIABLE","$this",941],["T_OBJECT_OPERATOR","->",941],["T_STRING","getItemsCollection",941],"(",")",["T_OBJECT_OPERATOR","->",941],["T_STRING","addItem",941],"(",["T_VARIABLE","$item",941],")",";",["T_WHITESPACE","\n            ",941],["T_STRING","Mage",942],["T_DOUBLE_COLON","::",942],["T_STRING","dispatchEvent",942],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_quote_add_item'",942],",",["T_WHITESPACE"," ",942],["T_ARRAY","array",942],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_item'",942],["T_WHITESPACE"," ",942],["T_DOUBLE_ARROW","=>",942],["T_WHITESPACE"," ",942],["T_VARIABLE","$item",942],")",")",";",["T_WHITESPACE","\n        ",942],"}",["T_WHITESPACE","\n        ",943],["T_RETURN","return",944],["T_WHITESPACE"," ",944],["T_VARIABLE","$this",944],";",["T_WHITESPACE","\n    ",944],"}",["T_WHITESPACE","\n\n    ",945],["T_DOC_COMMENT","\/**\n     * Advanced func to add product to quote - processing mode can be specified there.\n     * Returns error message if product type instance can't prepare product.\n     *\n     * @param mixed $product\n     * @param null|float|Varien_Object $request\n     * @param null|string $processMode\n     * @return Mage_Sales_Model_Quote_Item|string\n     *\/",947],["T_WHITESPACE","\n    ",955],["T_PUBLIC","public",956],["T_WHITESPACE"," ",956],["T_FUNCTION","function",956],["T_WHITESPACE"," ",956],["T_STRING","addProductAdvanced",956],"(",["T_STRING","Mage_Catalog_Model_Product",956],["T_WHITESPACE"," ",956],["T_VARIABLE","$product",956],",",["T_WHITESPACE"," ",956],["T_VARIABLE","$request",956],["T_WHITESPACE"," ",956],"=",["T_WHITESPACE"," ",956],["T_STRING","null",956],",",["T_WHITESPACE"," ",956],["T_VARIABLE","$processMode",956],["T_WHITESPACE"," ",956],"=",["T_WHITESPACE"," ",956],["T_STRING","null",956],")",["T_WHITESPACE","\n    ",956],"{",["T_WHITESPACE","\n        ",957],["T_IF","if",958],["T_WHITESPACE"," ",958],"(",["T_VARIABLE","$request",958],["T_WHITESPACE"," ",958],["T_IS_IDENTICAL","===",958],["T_WHITESPACE"," ",958],["T_STRING","null",958],")",["T_WHITESPACE"," ",958],"{",["T_WHITESPACE","\n            ",958],["T_VARIABLE","$request",959],["T_WHITESPACE"," ",959],"=",["T_WHITESPACE"," ",959],["T_LNUMBER","1",959],";",["T_WHITESPACE","\n        ",959],"}",["T_WHITESPACE","\n        ",960],["T_IF","if",961],["T_WHITESPACE"," ",961],"(",["T_STRING","is_numeric",961],"(",["T_VARIABLE","$request",961],")",")",["T_WHITESPACE"," ",961],"{",["T_WHITESPACE","\n            ",961],["T_VARIABLE","$request",962],["T_WHITESPACE"," ",962],"=",["T_WHITESPACE"," ",962],["T_NEW","new",962],["T_WHITESPACE"," ",962],["T_STRING","Varien_Object",962],"(",["T_ARRAY","array",962],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",962],["T_DOUBLE_ARROW","=>",962],["T_VARIABLE","$request",962],")",")",";",["T_WHITESPACE","\n        ",962],"}",["T_WHITESPACE","\n        ",963],["T_IF","if",964],["T_WHITESPACE"," ",964],"(","!","(",["T_VARIABLE","$request",964],["T_WHITESPACE"," ",964],["T_INSTANCEOF","instanceof",964],["T_WHITESPACE"," ",964],["T_STRING","Varien_Object",964],")",")",["T_WHITESPACE"," ",964],"{",["T_WHITESPACE","\n            ",964],["T_STRING","Mage",965],["T_DOUBLE_COLON","::",965],["T_STRING","throwException",965],"(",["T_STRING","Mage",965],["T_DOUBLE_COLON","::",965],["T_STRING","helper",965],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",965],")",["T_OBJECT_OPERATOR","->",965],["T_STRING","__",965],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid request for adding product to quote.'",965],")",")",";",["T_WHITESPACE","\n        ",965],"}",["T_WHITESPACE","\n\n        ",966],["T_VARIABLE","$cartCandidates",968],["T_WHITESPACE"," ",968],"=",["T_WHITESPACE"," ",968],["T_VARIABLE","$product",968],["T_OBJECT_OPERATOR","->",968],["T_STRING","getTypeInstance",968],"(",["T_STRING","true",968],")",["T_WHITESPACE","\n            ",968],["T_OBJECT_OPERATOR","->",969],["T_STRING","prepareForCartAdvanced",969],"(",["T_VARIABLE","$request",969],",",["T_WHITESPACE"," ",969],["T_VARIABLE","$product",969],",",["T_WHITESPACE"," ",969],["T_VARIABLE","$processMode",969],")",";",["T_WHITESPACE","\n\n        ",969],["T_DOC_COMMENT","\/**\n         * Error message\n         *\/",971],["T_WHITESPACE","\n        ",973],["T_IF","if",974],["T_WHITESPACE"," ",974],"(",["T_STRING","is_string",974],"(",["T_VARIABLE","$cartCandidates",974],")",")",["T_WHITESPACE"," ",974],"{",["T_WHITESPACE","\n            ",974],["T_RETURN","return",975],["T_WHITESPACE"," ",975],["T_VARIABLE","$cartCandidates",975],";",["T_WHITESPACE","\n        ",975],"}",["T_WHITESPACE","\n\n        ",976],["T_DOC_COMMENT","\/**\n         * If prepare process return one object\n         *\/",978],["T_WHITESPACE","\n        ",980],["T_IF","if",981],["T_WHITESPACE"," ",981],"(","!",["T_STRING","is_array",981],"(",["T_VARIABLE","$cartCandidates",981],")",")",["T_WHITESPACE"," ",981],"{",["T_WHITESPACE","\n            ",981],["T_VARIABLE","$cartCandidates",982],["T_WHITESPACE"," ",982],"=",["T_WHITESPACE"," ",982],["T_ARRAY","array",982],"(",["T_VARIABLE","$cartCandidates",982],")",";",["T_WHITESPACE","\n        ",982],"}",["T_WHITESPACE","\n\n        ",983],["T_VARIABLE","$parentItem",985],["T_WHITESPACE"," ",985],"=",["T_WHITESPACE"," ",985],["T_STRING","null",985],";",["T_WHITESPACE","\n        ",985],["T_VARIABLE","$errors",986],["T_WHITESPACE"," ",986],"=",["T_WHITESPACE"," ",986],["T_ARRAY","array",986],"(",")",";",["T_WHITESPACE","\n        ",986],["T_VARIABLE","$items",987],["T_WHITESPACE"," ",987],"=",["T_WHITESPACE"," ",987],["T_ARRAY","array",987],"(",")",";",["T_WHITESPACE","\n        ",987],["T_FOREACH","foreach",988],["T_WHITESPACE"," ",988],"(",["T_VARIABLE","$cartCandidates",988],["T_WHITESPACE"," ",988],["T_AS","as",988],["T_WHITESPACE"," ",988],["T_VARIABLE","$candidate",988],")",["T_WHITESPACE"," ",988],"{",["T_WHITESPACE","\n            ",988],["T_COMMENT","\/\/ Child items can be sticked together only within their parent\n",989],["T_WHITESPACE","            ",990],["T_VARIABLE","$stickWithinParent",990],["T_WHITESPACE"," ",990],"=",["T_WHITESPACE"," ",990],["T_VARIABLE","$candidate",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","getParentProductId",990],"(",")",["T_WHITESPACE"," ",990],"?",["T_WHITESPACE"," ",990],["T_VARIABLE","$parentItem",990],["T_WHITESPACE"," ",990],":",["T_WHITESPACE"," ",990],["T_STRING","null",990],";",["T_WHITESPACE","\n            ",990],["T_VARIABLE","$candidate",991],["T_OBJECT_OPERATOR","->",991],["T_STRING","setStickWithinParent",991],"(",["T_VARIABLE","$stickWithinParent",991],")",";",["T_WHITESPACE","\n            ",991],["T_VARIABLE","$item",992],["T_WHITESPACE"," ",992],"=",["T_WHITESPACE"," ",992],["T_VARIABLE","$this",992],["T_OBJECT_OPERATOR","->",992],["T_STRING","_addCatalogProduct",992],"(",["T_VARIABLE","$candidate",992],",",["T_WHITESPACE"," ",992],["T_VARIABLE","$candidate",992],["T_OBJECT_OPERATOR","->",992],["T_STRING","getCartQty",992],"(",")",")",";",["T_WHITESPACE","\n            ",992],["T_IF","if",993],"(",["T_VARIABLE","$request",993],["T_OBJECT_OPERATOR","->",993],["T_STRING","getResetCount",993],"(",")",["T_WHITESPACE"," ",993],["T_BOOLEAN_AND","&&",993],["T_WHITESPACE"," ",993],"!",["T_VARIABLE","$stickWithinParent",993],["T_WHITESPACE"," ",993],["T_BOOLEAN_AND","&&",993],["T_WHITESPACE"," ",993],["T_VARIABLE","$item",993],["T_OBJECT_OPERATOR","->",993],["T_STRING","getId",993],"(",")",["T_WHITESPACE"," ",993],["T_IS_IDENTICAL","===",993],["T_WHITESPACE"," ",993],["T_VARIABLE","$request",993],["T_OBJECT_OPERATOR","->",993],["T_STRING","getId",993],"(",")",")",["T_WHITESPACE"," ",993],"{",["T_WHITESPACE","\n                ",993],["T_VARIABLE","$item",994],["T_OBJECT_OPERATOR","->",994],["T_STRING","setData",994],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",994],",",["T_WHITESPACE"," ",994],["T_LNUMBER","0",994],")",";",["T_WHITESPACE","\n            ",994],"}",["T_WHITESPACE","\n            ",995],["T_VARIABLE","$items",996],"[","]",["T_WHITESPACE"," ",996],"=",["T_WHITESPACE"," ",996],["T_VARIABLE","$item",996],";",["T_WHITESPACE","\n\n            ",996],["T_DOC_COMMENT","\/**\n             * As parent item we should always use the item of first added product\n             *\/",998],["T_WHITESPACE","\n            ",1000],["T_IF","if",1001],["T_WHITESPACE"," ",1001],"(","!",["T_VARIABLE","$parentItem",1001],")",["T_WHITESPACE"," ",1001],"{",["T_WHITESPACE","\n                ",1001],["T_VARIABLE","$parentItem",1002],["T_WHITESPACE"," ",1002],"=",["T_WHITESPACE"," ",1002],["T_VARIABLE","$item",1002],";",["T_WHITESPACE","\n            ",1002],"}",["T_WHITESPACE","\n            ",1003],["T_IF","if",1004],["T_WHITESPACE"," ",1004],"(",["T_VARIABLE","$parentItem",1004],["T_WHITESPACE"," ",1004],["T_BOOLEAN_AND","&&",1004],["T_WHITESPACE"," ",1004],["T_VARIABLE","$candidate",1004],["T_OBJECT_OPERATOR","->",1004],["T_STRING","getParentProductId",1004],"(",")",")",["T_WHITESPACE"," ",1004],"{",["T_WHITESPACE","\n                ",1004],["T_VARIABLE","$item",1005],["T_OBJECT_OPERATOR","->",1005],["T_STRING","setParentItem",1005],"(",["T_VARIABLE","$parentItem",1005],")",";",["T_WHITESPACE","\n            ",1005],"}",["T_WHITESPACE","\n\n            ",1006],["T_DOC_COMMENT","\/**\n             * We specify qty after we know about parent (for stock)\n             *\/",1008],["T_WHITESPACE","\n            ",1010],["T_VARIABLE","$item",1011],["T_OBJECT_OPERATOR","->",1011],["T_STRING","addQty",1011],"(",["T_VARIABLE","$candidate",1011],["T_OBJECT_OPERATOR","->",1011],["T_STRING","getCartQty",1011],"(",")",")",";",["T_WHITESPACE","\n\n            ",1011],["T_COMMENT","\/\/ collect errors instead of throwing first one\n",1013],["T_WHITESPACE","            ",1014],["T_IF","if",1014],["T_WHITESPACE"," ",1014],"(",["T_VARIABLE","$item",1014],["T_OBJECT_OPERATOR","->",1014],["T_STRING","getHasError",1014],"(",")",")",["T_WHITESPACE"," ",1014],"{",["T_WHITESPACE","\n                ",1014],["T_VARIABLE","$message",1015],["T_WHITESPACE"," ",1015],"=",["T_WHITESPACE"," ",1015],["T_VARIABLE","$item",1015],["T_OBJECT_OPERATOR","->",1015],["T_STRING","getMessage",1015],"(",")",";",["T_WHITESPACE","\n                ",1015],["T_IF","if",1016],["T_WHITESPACE"," ",1016],"(","!",["T_STRING","in_array",1016],"(",["T_VARIABLE","$message",1016],",",["T_WHITESPACE"," ",1016],["T_VARIABLE","$errors",1016],")",")",["T_WHITESPACE"," ",1016],"{",["T_WHITESPACE"," ",1016],["T_COMMENT","\/\/ filter duplicate messages\n",1016],["T_WHITESPACE","                    ",1017],["T_VARIABLE","$errors",1017],"[","]",["T_WHITESPACE"," ",1017],"=",["T_WHITESPACE"," ",1017],["T_VARIABLE","$message",1017],";",["T_WHITESPACE","\n                ",1017],"}",["T_WHITESPACE","\n            ",1018],"}",["T_WHITESPACE","\n        ",1019],"}",["T_WHITESPACE","\n        ",1020],["T_IF","if",1021],["T_WHITESPACE"," ",1021],"(","!",["T_EMPTY","empty",1021],"(",["T_VARIABLE","$errors",1021],")",")",["T_WHITESPACE"," ",1021],"{",["T_WHITESPACE","\n            ",1021],["T_STRING","Mage",1022],["T_DOUBLE_COLON","::",1022],["T_STRING","throwException",1022],"(",["T_STRING","implode",1022],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",1022],",",["T_WHITESPACE"," ",1022],["T_VARIABLE","$errors",1022],")",")",";",["T_WHITESPACE","\n        ",1022],"}",["T_WHITESPACE","\n\n        ",1023],["T_STRING","Mage",1025],["T_DOUBLE_COLON","::",1025],["T_STRING","dispatchEvent",1025],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_quote_product_add_after'",1025],",",["T_WHITESPACE"," ",1025],["T_ARRAY","array",1025],"(",["T_CONSTANT_ENCAPSED_STRING","'items'",1025],["T_WHITESPACE"," ",1025],["T_DOUBLE_ARROW","=>",1025],["T_WHITESPACE"," ",1025],["T_VARIABLE","$items",1025],")",")",";",["T_WHITESPACE","\n\n        ",1025],["T_RETURN","return",1027],["T_WHITESPACE"," ",1027],["T_VARIABLE","$item",1027],";",["T_WHITESPACE","\n    ",1027],"}",["T_WHITESPACE","\n\n\n    ",1028],["T_DOC_COMMENT","\/**\n     * Add product to quote\n     *\n     * return error message if product type instance can't prepare product\n     *\n     * @param mixed $product\n     * @param null|float|Varien_Object $request\n     * @return Mage_Sales_Model_Quote_Item|string\n     *\/",1031],["T_WHITESPACE","\n    ",1039],["T_PUBLIC","public",1040],["T_WHITESPACE"," ",1040],["T_FUNCTION","function",1040],["T_WHITESPACE"," ",1040],["T_STRING","addProduct",1040],"(",["T_STRING","Mage_Catalog_Model_Product",1040],["T_WHITESPACE"," ",1040],["T_VARIABLE","$product",1040],",",["T_WHITESPACE"," ",1040],["T_VARIABLE","$request",1040],["T_WHITESPACE"," ",1040],"=",["T_WHITESPACE"," ",1040],["T_STRING","null",1040],")",["T_WHITESPACE","\n    ",1040],"{",["T_WHITESPACE","\n        ",1041],["T_RETURN","return",1042],["T_WHITESPACE"," ",1042],["T_VARIABLE","$this",1042],["T_OBJECT_OPERATOR","->",1042],["T_STRING","addProductAdvanced",1042],"(",["T_WHITESPACE","\n            ",1042],["T_VARIABLE","$product",1043],",",["T_WHITESPACE","\n            ",1043],["T_VARIABLE","$request",1044],",",["T_WHITESPACE","\n            ",1044],["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",1045],["T_DOUBLE_COLON","::",1045],["T_STRING","PROCESS_MODE_FULL",1045],["T_WHITESPACE","\n        ",1045],")",";",["T_WHITESPACE","\n    ",1046],"}",["T_WHITESPACE","\n\n    ",1047],["T_DOC_COMMENT","\/**\n     * Adding catalog product object data to quote\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  Mage_Sales_Model_Quote_Item\n     *\/",1049],["T_WHITESPACE","\n    ",1054],["T_PROTECTED","protected",1055],["T_WHITESPACE"," ",1055],["T_FUNCTION","function",1055],["T_WHITESPACE"," ",1055],["T_STRING","_addCatalogProduct",1055],"(",["T_STRING","Mage_Catalog_Model_Product",1055],["T_WHITESPACE"," ",1055],["T_VARIABLE","$product",1055],",",["T_WHITESPACE"," ",1055],["T_VARIABLE","$qty",1055],["T_WHITESPACE"," ",1055],"=",["T_WHITESPACE"," ",1055],["T_LNUMBER","1",1055],")",["T_WHITESPACE","\n    ",1055],"{",["T_WHITESPACE","\n        ",1056],["T_VARIABLE","$newItem",1057],["T_WHITESPACE"," ",1057],"=",["T_WHITESPACE"," ",1057],["T_STRING","false",1057],";",["T_WHITESPACE","\n        ",1057],["T_VARIABLE","$item",1058],["T_WHITESPACE"," ",1058],"=",["T_WHITESPACE"," ",1058],["T_VARIABLE","$this",1058],["T_OBJECT_OPERATOR","->",1058],["T_STRING","getItemByProduct",1058],"(",["T_VARIABLE","$product",1058],")",";",["T_WHITESPACE","\n        ",1058],["T_IF","if",1059],["T_WHITESPACE"," ",1059],"(","!",["T_VARIABLE","$item",1059],")",["T_WHITESPACE"," ",1059],"{",["T_WHITESPACE","\n            ",1059],["T_VARIABLE","$item",1060],["T_WHITESPACE"," ",1060],"=",["T_WHITESPACE"," ",1060],["T_STRING","Mage",1060],["T_DOUBLE_COLON","::",1060],["T_STRING","getModel",1060],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_item'",1060],")",";",["T_WHITESPACE","\n            ",1060],["T_VARIABLE","$item",1061],["T_OBJECT_OPERATOR","->",1061],["T_STRING","setQuote",1061],"(",["T_VARIABLE","$this",1061],")",";",["T_WHITESPACE","\n            ",1061],["T_IF","if",1062],["T_WHITESPACE"," ",1062],"(",["T_STRING","Mage",1062],["T_DOUBLE_COLON","::",1062],["T_STRING","app",1062],"(",")",["T_OBJECT_OPERATOR","->",1062],["T_STRING","getStore",1062],"(",")",["T_OBJECT_OPERATOR","->",1062],["T_STRING","isAdmin",1062],"(",")",")",["T_WHITESPACE"," ",1062],"{",["T_WHITESPACE","\n                ",1062],["T_VARIABLE","$item",1063],["T_OBJECT_OPERATOR","->",1063],["T_STRING","setStoreId",1063],"(",["T_VARIABLE","$this",1063],["T_OBJECT_OPERATOR","->",1063],["T_STRING","getStore",1063],"(",")",["T_OBJECT_OPERATOR","->",1063],["T_STRING","getId",1063],"(",")",")",";",["T_WHITESPACE","\n            ",1063],"}",["T_WHITESPACE","\n            ",1064],["T_ELSE","else",1065],["T_WHITESPACE"," ",1065],"{",["T_WHITESPACE","\n                ",1065],["T_VARIABLE","$item",1066],["T_OBJECT_OPERATOR","->",1066],["T_STRING","setStoreId",1066],"(",["T_STRING","Mage",1066],["T_DOUBLE_COLON","::",1066],["T_STRING","app",1066],"(",")",["T_OBJECT_OPERATOR","->",1066],["T_STRING","getStore",1066],"(",")",["T_OBJECT_OPERATOR","->",1066],["T_STRING","getId",1066],"(",")",")",";",["T_WHITESPACE","\n            ",1066],"}",["T_WHITESPACE","\n            ",1067],["T_VARIABLE","$newItem",1068],["T_WHITESPACE"," ",1068],"=",["T_WHITESPACE"," ",1068],["T_STRING","true",1068],";",["T_WHITESPACE","\n        ",1068],"}",["T_WHITESPACE","\n\n        ",1069],["T_DOC_COMMENT","\/**\n         * We can't modify existing child items\n         *\/",1071],["T_WHITESPACE","\n        ",1073],["T_IF","if",1074],["T_WHITESPACE"," ",1074],"(",["T_VARIABLE","$item",1074],["T_OBJECT_OPERATOR","->",1074],["T_STRING","getId",1074],"(",")",["T_WHITESPACE"," ",1074],["T_BOOLEAN_AND","&&",1074],["T_WHITESPACE"," ",1074],["T_VARIABLE","$product",1074],["T_OBJECT_OPERATOR","->",1074],["T_STRING","getParentProductId",1074],"(",")",")",["T_WHITESPACE"," ",1074],"{",["T_WHITESPACE","\n            ",1074],["T_RETURN","return",1075],["T_WHITESPACE"," ",1075],["T_VARIABLE","$item",1075],";",["T_WHITESPACE","\n        ",1075],"}",["T_WHITESPACE","\n\n        ",1076],["T_VARIABLE","$item",1078],["T_OBJECT_OPERATOR","->",1078],["T_STRING","setOptions",1078],"(",["T_VARIABLE","$product",1078],["T_OBJECT_OPERATOR","->",1078],["T_STRING","getCustomOptions",1078],"(",")",")",["T_WHITESPACE","\n            ",1078],["T_OBJECT_OPERATOR","->",1079],["T_STRING","setProduct",1079],"(",["T_VARIABLE","$product",1079],")",";",["T_WHITESPACE","\n\n        ",1079],["T_COMMENT","\/\/ Add only item that is not in quote already (there can be other new or already saved item\n",1081],["T_WHITESPACE","        ",1082],["T_IF","if",1082],["T_WHITESPACE"," ",1082],"(",["T_VARIABLE","$newItem",1082],")",["T_WHITESPACE"," ",1082],"{",["T_WHITESPACE","\n            ",1082],["T_VARIABLE","$this",1083],["T_OBJECT_OPERATOR","->",1083],["T_STRING","addItem",1083],"(",["T_VARIABLE","$item",1083],")",";",["T_WHITESPACE","\n        ",1083],"}",["T_WHITESPACE","\n\n        ",1084],["T_RETURN","return",1086],["T_WHITESPACE"," ",1086],["T_VARIABLE","$item",1086],";",["T_WHITESPACE","\n    ",1086],"}",["T_WHITESPACE","\n\n    ",1087],["T_DOC_COMMENT","\/**\n     * Updates quote item with new configuration\n     *\n     * $params sets how current item configuration must be taken into account and additional options.\n     * It's passed to Mage_Catalog_Helper_Product->addParamsToBuyRequest() to compose resulting buyRequest.\n     *\n     * Basically it can hold\n     * - 'current_config', Varien_Object or array - current buyRequest that configures product in this item,\n     *   used to restore currently attached files\n     * - 'files_prefix': string[a-z0-9_] - prefix that was added at frontend to names of file options (file inputs), so they won't\n     *   intersect with other submitted options\n     *\n     * For more options see Mage_Catalog_Helper_Product->addParamsToBuyRequest()\n     *\n     * @param int $itemId\n     * @param Varien_Object $buyRequest\n     * @param null|array|Varien_Object $params\n     * @return Mage_Sales_Model_Quote_Item\n     *\n     * @see Mage_Catalog_Helper_Product::addParamsToBuyRequest()\n     *\/",1089],["T_WHITESPACE","\n    ",1109],["T_PUBLIC","public",1110],["T_WHITESPACE"," ",1110],["T_FUNCTION","function",1110],["T_WHITESPACE"," ",1110],["T_STRING","updateItem",1110],"(",["T_VARIABLE","$itemId",1110],",",["T_WHITESPACE"," ",1110],["T_VARIABLE","$buyRequest",1110],",",["T_WHITESPACE"," ",1110],["T_VARIABLE","$params",1110],["T_WHITESPACE"," ",1110],"=",["T_WHITESPACE"," ",1110],["T_STRING","null",1110],")",["T_WHITESPACE","\n    ",1110],"{",["T_WHITESPACE","\n        ",1111],["T_VARIABLE","$item",1112],["T_WHITESPACE"," ",1112],"=",["T_WHITESPACE"," ",1112],["T_VARIABLE","$this",1112],["T_OBJECT_OPERATOR","->",1112],["T_STRING","getItemById",1112],"(",["T_VARIABLE","$itemId",1112],")",";",["T_WHITESPACE","\n        ",1112],["T_IF","if",1113],["T_WHITESPACE"," ",1113],"(","!",["T_VARIABLE","$item",1113],")",["T_WHITESPACE"," ",1113],"{",["T_WHITESPACE","\n            ",1113],["T_STRING","Mage",1114],["T_DOUBLE_COLON","::",1114],["T_STRING","throwException",1114],"(",["T_STRING","Mage",1114],["T_DOUBLE_COLON","::",1114],["T_STRING","helper",1114],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1114],")",["T_OBJECT_OPERATOR","->",1114],["T_STRING","__",1114],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong quote item id to update configuration.'",1114],")",")",";",["T_WHITESPACE","\n        ",1114],"}",["T_WHITESPACE","\n        ",1115],["T_VARIABLE","$productId",1116],["T_WHITESPACE"," ",1116],"=",["T_WHITESPACE"," ",1116],["T_VARIABLE","$item",1116],["T_OBJECT_OPERATOR","->",1116],["T_STRING","getProduct",1116],"(",")",["T_OBJECT_OPERATOR","->",1116],["T_STRING","getId",1116],"(",")",";",["T_WHITESPACE","\n\n        ",1116],["T_COMMENT","\/\/We need to create new clear product instance with same $productId\n",1118],["T_WHITESPACE","        ",1119],["T_COMMENT","\/\/to set new option values from $buyRequest\n",1119],["T_WHITESPACE","        ",1120],["T_VARIABLE","$product",1120],["T_WHITESPACE"," ",1120],"=",["T_WHITESPACE"," ",1120],["T_STRING","Mage",1120],["T_DOUBLE_COLON","::",1120],["T_STRING","getModel",1120],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",1120],")",["T_WHITESPACE","\n            ",1120],["T_OBJECT_OPERATOR","->",1121],["T_STRING","setStoreId",1121],"(",["T_VARIABLE","$this",1121],["T_OBJECT_OPERATOR","->",1121],["T_STRING","getStore",1121],"(",")",["T_OBJECT_OPERATOR","->",1121],["T_STRING","getId",1121],"(",")",")",["T_WHITESPACE","\n            ",1121],["T_OBJECT_OPERATOR","->",1122],["T_STRING","load",1122],"(",["T_VARIABLE","$productId",1122],")",";",["T_WHITESPACE","\n\n        ",1122],["T_IF","if",1124],["T_WHITESPACE"," ",1124],"(","!",["T_VARIABLE","$params",1124],")",["T_WHITESPACE"," ",1124],"{",["T_WHITESPACE","\n            ",1124],["T_VARIABLE","$params",1125],["T_WHITESPACE"," ",1125],"=",["T_WHITESPACE"," ",1125],["T_NEW","new",1125],["T_WHITESPACE"," ",1125],["T_STRING","Varien_Object",1125],"(",")",";",["T_WHITESPACE","\n        ",1125],"}",["T_WHITESPACE"," ",1126],["T_ELSE","else",1126],["T_WHITESPACE"," ",1126],["T_IF","if",1126],["T_WHITESPACE"," ",1126],"(",["T_STRING","is_array",1126],"(",["T_VARIABLE","$params",1126],")",")",["T_WHITESPACE"," ",1126],"{",["T_WHITESPACE","\n            ",1126],["T_VARIABLE","$params",1127],["T_WHITESPACE"," ",1127],"=",["T_WHITESPACE"," ",1127],["T_NEW","new",1127],["T_WHITESPACE"," ",1127],["T_STRING","Varien_Object",1127],"(",["T_VARIABLE","$params",1127],")",";",["T_WHITESPACE","\n        ",1127],"}",["T_WHITESPACE","\n        ",1128],["T_VARIABLE","$params",1129],["T_OBJECT_OPERATOR","->",1129],["T_STRING","setCurrentConfig",1129],"(",["T_VARIABLE","$item",1129],["T_OBJECT_OPERATOR","->",1129],["T_STRING","getBuyRequest",1129],"(",")",")",";",["T_WHITESPACE","\n        ",1129],["T_VARIABLE","$buyRequest",1130],["T_WHITESPACE"," ",1130],"=",["T_WHITESPACE"," ",1130],["T_STRING","Mage",1130],["T_DOUBLE_COLON","::",1130],["T_STRING","helper",1130],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",1130],")",["T_OBJECT_OPERATOR","->",1130],["T_STRING","addParamsToBuyRequest",1130],"(",["T_VARIABLE","$buyRequest",1130],",",["T_WHITESPACE"," ",1130],["T_VARIABLE","$params",1130],")",";",["T_WHITESPACE","\n\n        ",1130],["T_VARIABLE","$buyRequest",1132],["T_OBJECT_OPERATOR","->",1132],["T_STRING","setResetCount",1132],"(",["T_STRING","true",1132],")",";",["T_WHITESPACE","\n        ",1132],["T_VARIABLE","$resultItem",1133],["T_WHITESPACE"," ",1133],"=",["T_WHITESPACE"," ",1133],["T_VARIABLE","$this",1133],["T_OBJECT_OPERATOR","->",1133],["T_STRING","addProduct",1133],"(",["T_VARIABLE","$product",1133],",",["T_WHITESPACE"," ",1133],["T_VARIABLE","$buyRequest",1133],")",";",["T_WHITESPACE","\n\n        ",1133],["T_IF","if",1135],["T_WHITESPACE"," ",1135],"(",["T_STRING","is_string",1135],"(",["T_VARIABLE","$resultItem",1135],")",")",["T_WHITESPACE"," ",1135],"{",["T_WHITESPACE","\n            ",1135],["T_STRING","Mage",1136],["T_DOUBLE_COLON","::",1136],["T_STRING","throwException",1136],"(",["T_VARIABLE","$resultItem",1136],")",";",["T_WHITESPACE","\n        ",1136],"}",["T_WHITESPACE","\n\n        ",1137],["T_IF","if",1139],["T_WHITESPACE"," ",1139],"(",["T_VARIABLE","$resultItem",1139],["T_OBJECT_OPERATOR","->",1139],["T_STRING","getParentItem",1139],"(",")",")",["T_WHITESPACE"," ",1139],"{",["T_WHITESPACE","\n            ",1139],["T_VARIABLE","$resultItem",1140],["T_WHITESPACE"," ",1140],"=",["T_WHITESPACE"," ",1140],["T_VARIABLE","$resultItem",1140],["T_OBJECT_OPERATOR","->",1140],["T_STRING","getParentItem",1140],"(",")",";",["T_WHITESPACE","\n        ",1140],"}",["T_WHITESPACE","\n\n        ",1141],["T_IF","if",1143],["T_WHITESPACE"," ",1143],"(",["T_VARIABLE","$resultItem",1143],["T_OBJECT_OPERATOR","->",1143],["T_STRING","getId",1143],"(",")",["T_WHITESPACE"," ",1143],["T_IS_NOT_EQUAL","!=",1143],["T_WHITESPACE"," ",1143],["T_VARIABLE","$itemId",1143],")",["T_WHITESPACE"," ",1143],"{",["T_WHITESPACE","\n            ",1143],["T_COMMENT","\/*\n             * Product configuration didn't stick to original quote item\n             * It either has same configuration as some other quote item's product or completely new configuration\n             *\/",1144],["T_WHITESPACE","\n            ",1147],["T_VARIABLE","$this",1148],["T_OBJECT_OPERATOR","->",1148],["T_STRING","removeItem",1148],"(",["T_VARIABLE","$itemId",1148],")",";",["T_WHITESPACE","\n\n            ",1148],["T_VARIABLE","$items",1150],["T_WHITESPACE"," ",1150],"=",["T_WHITESPACE"," ",1150],["T_VARIABLE","$this",1150],["T_OBJECT_OPERATOR","->",1150],["T_STRING","getAllItems",1150],"(",")",";",["T_WHITESPACE","\n            ",1150],["T_FOREACH","foreach",1151],["T_WHITESPACE"," ",1151],"(",["T_VARIABLE","$items",1151],["T_WHITESPACE"," ",1151],["T_AS","as",1151],["T_WHITESPACE"," ",1151],["T_VARIABLE","$item",1151],")",["T_WHITESPACE"," ",1151],"{",["T_WHITESPACE","\n                ",1151],["T_IF","if",1152],["T_WHITESPACE"," ",1152],"(","(",["T_VARIABLE","$item",1152],["T_OBJECT_OPERATOR","->",1152],["T_STRING","getProductId",1152],"(",")",["T_WHITESPACE"," ",1152],["T_IS_EQUAL","==",1152],["T_WHITESPACE"," ",1152],["T_VARIABLE","$productId",1152],")",["T_WHITESPACE"," ",1152],["T_BOOLEAN_AND","&&",1152],["T_WHITESPACE"," ",1152],"(",["T_VARIABLE","$item",1152],["T_OBJECT_OPERATOR","->",1152],["T_STRING","getId",1152],"(",")",["T_WHITESPACE"," ",1152],["T_IS_NOT_EQUAL","!=",1152],["T_WHITESPACE"," ",1152],["T_VARIABLE","$resultItem",1152],["T_OBJECT_OPERATOR","->",1152],["T_STRING","getId",1152],"(",")",")",")",["T_WHITESPACE"," ",1152],"{",["T_WHITESPACE","\n                    ",1152],["T_IF","if",1153],["T_WHITESPACE"," ",1153],"(",["T_VARIABLE","$resultItem",1153],["T_OBJECT_OPERATOR","->",1153],["T_STRING","compare",1153],"(",["T_VARIABLE","$item",1153],")",")",["T_WHITESPACE"," ",1153],"{",["T_WHITESPACE","\n                        ",1153],["T_COMMENT","\/\/ Product configuration is same as in other quote item\n",1154],["T_WHITESPACE","                        ",1155],["T_VARIABLE","$resultItem",1155],["T_OBJECT_OPERATOR","->",1155],["T_STRING","setQty",1155],"(",["T_VARIABLE","$resultItem",1155],["T_OBJECT_OPERATOR","->",1155],["T_STRING","getQty",1155],"(",")",["T_WHITESPACE"," ",1155],"+",["T_WHITESPACE"," ",1155],["T_VARIABLE","$item",1155],["T_OBJECT_OPERATOR","->",1155],["T_STRING","getQty",1155],"(",")",")",";",["T_WHITESPACE","\n                        ",1155],["T_VARIABLE","$this",1156],["T_OBJECT_OPERATOR","->",1156],["T_STRING","removeItem",1156],"(",["T_VARIABLE","$item",1156],["T_OBJECT_OPERATOR","->",1156],["T_STRING","getId",1156],"(",")",")",";",["T_WHITESPACE","\n                        ",1156],["T_BREAK","break",1157],";",["T_WHITESPACE","\n                    ",1157],"}",["T_WHITESPACE","\n                ",1158],"}",["T_WHITESPACE","\n            ",1159],"}",["T_WHITESPACE","\n        ",1160],"}",["T_WHITESPACE"," ",1161],["T_ELSE","else",1161],["T_WHITESPACE"," ",1161],"{",["T_WHITESPACE","\n            ",1161],["T_VARIABLE","$resultItem",1162],["T_OBJECT_OPERATOR","->",1162],["T_STRING","setQty",1162],"(",["T_VARIABLE","$buyRequest",1162],["T_OBJECT_OPERATOR","->",1162],["T_STRING","getQty",1162],"(",")",")",";",["T_WHITESPACE","\n        ",1162],"}",["T_WHITESPACE","\n\n        ",1163],["T_RETURN","return",1165],["T_WHITESPACE"," ",1165],["T_VARIABLE","$resultItem",1165],";",["T_WHITESPACE","\n    ",1165],"}",["T_WHITESPACE","\n\n    ",1166],["T_DOC_COMMENT","\/**\n     * Retrieve quote item by product id\n     *\n     * @param   Mage_Catalog_Model_Product $product\n     * @return  Mage_Sales_Model_Quote_Item || false\n     *\/",1168],["T_WHITESPACE","\n    ",1173],["T_PUBLIC","public",1174],["T_WHITESPACE"," ",1174],["T_FUNCTION","function",1174],["T_WHITESPACE"," ",1174],["T_STRING","getItemByProduct",1174],"(",["T_VARIABLE","$product",1174],")",["T_WHITESPACE","\n    ",1174],"{",["T_WHITESPACE","\n        ",1175],["T_FOREACH","foreach",1176],["T_WHITESPACE"," ",1176],"(",["T_VARIABLE","$this",1176],["T_OBJECT_OPERATOR","->",1176],["T_STRING","getAllItems",1176],"(",")",["T_WHITESPACE"," ",1176],["T_AS","as",1176],["T_WHITESPACE"," ",1176],["T_VARIABLE","$item",1176],")",["T_WHITESPACE"," ",1176],"{",["T_WHITESPACE","\n            ",1176],["T_IF","if",1177],["T_WHITESPACE"," ",1177],"(",["T_VARIABLE","$item",1177],["T_OBJECT_OPERATOR","->",1177],["T_STRING","representProduct",1177],"(",["T_VARIABLE","$product",1177],")",")",["T_WHITESPACE"," ",1177],"{",["T_WHITESPACE","\n                ",1177],["T_RETURN","return",1178],["T_WHITESPACE"," ",1178],["T_VARIABLE","$item",1178],";",["T_WHITESPACE","\n            ",1178],"}",["T_WHITESPACE","\n        ",1179],"}",["T_WHITESPACE","\n        ",1180],["T_RETURN","return",1181],["T_WHITESPACE"," ",1181],["T_STRING","false",1181],";",["T_WHITESPACE","\n    ",1181],"}",["T_WHITESPACE","\n\n    ",1182],["T_PUBLIC","public",1184],["T_WHITESPACE"," ",1184],["T_FUNCTION","function",1184],["T_WHITESPACE"," ",1184],["T_STRING","getItemsSummaryQty",1184],"(",")",["T_WHITESPACE","\n    ",1184],"{",["T_WHITESPACE","\n        ",1185],["T_VARIABLE","$qty",1186],["T_WHITESPACE"," ",1186],"=",["T_WHITESPACE"," ",1186],["T_VARIABLE","$this",1186],["T_OBJECT_OPERATOR","->",1186],["T_STRING","getData",1186],"(",["T_CONSTANT_ENCAPSED_STRING","'all_items_qty'",1186],")",";",["T_WHITESPACE","\n        ",1186],["T_IF","if",1187],["T_WHITESPACE"," ",1187],"(",["T_STRING","is_null",1187],"(",["T_VARIABLE","$qty",1187],")",")",["T_WHITESPACE"," ",1187],"{",["T_WHITESPACE","\n            ",1187],["T_VARIABLE","$qty",1188],["T_WHITESPACE"," ",1188],"=",["T_WHITESPACE"," ",1188],["T_LNUMBER","0",1188],";",["T_WHITESPACE","\n            ",1188],["T_FOREACH","foreach",1189],["T_WHITESPACE"," ",1189],"(",["T_VARIABLE","$this",1189],["T_OBJECT_OPERATOR","->",1189],["T_STRING","getAllItems",1189],"(",")",["T_WHITESPACE"," ",1189],["T_AS","as",1189],["T_WHITESPACE"," ",1189],["T_VARIABLE","$item",1189],")",["T_WHITESPACE"," ",1189],"{",["T_WHITESPACE","\n                ",1189],["T_IF","if",1190],["T_WHITESPACE"," ",1190],"(",["T_VARIABLE","$item",1190],["T_OBJECT_OPERATOR","->",1190],["T_STRING","getParentItem",1190],"(",")",")",["T_WHITESPACE"," ",1190],"{",["T_WHITESPACE","\n                    ",1190],["T_CONTINUE","continue",1191],";",["T_WHITESPACE","\n                ",1191],"}",["T_WHITESPACE","\n\n                ",1192],["T_IF","if",1194],["T_WHITESPACE"," ",1194],"(","(",["T_VARIABLE","$children",1194],["T_WHITESPACE"," ",1194],"=",["T_WHITESPACE"," ",1194],["T_VARIABLE","$item",1194],["T_OBJECT_OPERATOR","->",1194],["T_STRING","getChildren",1194],"(",")",")",["T_WHITESPACE"," ",1194],["T_BOOLEAN_AND","&&",1194],["T_WHITESPACE"," ",1194],["T_VARIABLE","$item",1194],["T_OBJECT_OPERATOR","->",1194],["T_STRING","isShipSeparately",1194],"(",")",")",["T_WHITESPACE"," ",1194],"{",["T_WHITESPACE","\n                    ",1194],["T_FOREACH","foreach",1195],["T_WHITESPACE"," ",1195],"(",["T_VARIABLE","$children",1195],["T_WHITESPACE"," ",1195],["T_AS","as",1195],["T_WHITESPACE"," ",1195],["T_VARIABLE","$child",1195],")",["T_WHITESPACE"," ",1195],"{",["T_WHITESPACE","\n                        ",1195],["T_VARIABLE","$qty",1196],["T_PLUS_EQUAL","+=",1196],["T_WHITESPACE"," ",1196],["T_VARIABLE","$child",1196],["T_OBJECT_OPERATOR","->",1196],["T_STRING","getQty",1196],"(",")","*",["T_VARIABLE","$item",1196],["T_OBJECT_OPERATOR","->",1196],["T_STRING","getQty",1196],"(",")",";",["T_WHITESPACE","\n                    ",1196],"}",["T_WHITESPACE","\n                ",1197],"}",["T_WHITESPACE"," ",1198],["T_ELSE","else",1198],["T_WHITESPACE"," ",1198],"{",["T_WHITESPACE","\n                    ",1198],["T_VARIABLE","$qty",1199],["T_PLUS_EQUAL","+=",1199],["T_WHITESPACE"," ",1199],["T_VARIABLE","$item",1199],["T_OBJECT_OPERATOR","->",1199],["T_STRING","getQty",1199],"(",")",";",["T_WHITESPACE","\n                ",1199],"}",["T_WHITESPACE","\n            ",1200],"}",["T_WHITESPACE","\n            ",1201],["T_VARIABLE","$this",1202],["T_OBJECT_OPERATOR","->",1202],["T_STRING","setData",1202],"(",["T_CONSTANT_ENCAPSED_STRING","'all_items_qty'",1202],",",["T_WHITESPACE"," ",1202],["T_VARIABLE","$qty",1202],")",";",["T_WHITESPACE","\n        ",1202],"}",["T_WHITESPACE","\n        ",1203],["T_RETURN","return",1204],["T_WHITESPACE"," ",1204],["T_VARIABLE","$qty",1204],";",["T_WHITESPACE","\n    ",1204],"}",["T_WHITESPACE","\n\n    ",1205],["T_PUBLIC","public",1207],["T_WHITESPACE"," ",1207],["T_FUNCTION","function",1207],["T_WHITESPACE"," ",1207],["T_STRING","getItemVirtualQty",1207],"(",")",["T_WHITESPACE","\n    ",1207],"{",["T_WHITESPACE","\n        ",1208],["T_VARIABLE","$qty",1209],["T_WHITESPACE"," ",1209],"=",["T_WHITESPACE"," ",1209],["T_VARIABLE","$this",1209],["T_OBJECT_OPERATOR","->",1209],["T_STRING","getData",1209],"(",["T_CONSTANT_ENCAPSED_STRING","'virtual_items_qty'",1209],")",";",["T_WHITESPACE","\n        ",1209],["T_IF","if",1210],["T_WHITESPACE"," ",1210],"(",["T_STRING","is_null",1210],"(",["T_VARIABLE","$qty",1210],")",")",["T_WHITESPACE"," ",1210],"{",["T_WHITESPACE","\n            ",1210],["T_VARIABLE","$qty",1211],["T_WHITESPACE"," ",1211],"=",["T_WHITESPACE"," ",1211],["T_LNUMBER","0",1211],";",["T_WHITESPACE","\n            ",1211],["T_FOREACH","foreach",1212],["T_WHITESPACE"," ",1212],"(",["T_VARIABLE","$this",1212],["T_OBJECT_OPERATOR","->",1212],["T_STRING","getAllItems",1212],"(",")",["T_WHITESPACE"," ",1212],["T_AS","as",1212],["T_WHITESPACE"," ",1212],["T_VARIABLE","$item",1212],")",["T_WHITESPACE"," ",1212],"{",["T_WHITESPACE","\n                ",1212],["T_IF","if",1213],["T_WHITESPACE"," ",1213],"(",["T_VARIABLE","$item",1213],["T_OBJECT_OPERATOR","->",1213],["T_STRING","getParentItem",1213],"(",")",")",["T_WHITESPACE"," ",1213],"{",["T_WHITESPACE","\n                    ",1213],["T_CONTINUE","continue",1214],";",["T_WHITESPACE","\n                ",1214],"}",["T_WHITESPACE","\n\n                ",1215],["T_IF","if",1217],["T_WHITESPACE"," ",1217],"(","(",["T_VARIABLE","$children",1217],["T_WHITESPACE"," ",1217],"=",["T_WHITESPACE"," ",1217],["T_VARIABLE","$item",1217],["T_OBJECT_OPERATOR","->",1217],["T_STRING","getChildren",1217],"(",")",")",["T_WHITESPACE"," ",1217],["T_BOOLEAN_AND","&&",1217],["T_WHITESPACE"," ",1217],["T_VARIABLE","$item",1217],["T_OBJECT_OPERATOR","->",1217],["T_STRING","isShipSeparately",1217],"(",")",")",["T_WHITESPACE"," ",1217],"{",["T_WHITESPACE","\n                    ",1217],["T_FOREACH","foreach",1218],["T_WHITESPACE"," ",1218],"(",["T_VARIABLE","$children",1218],["T_WHITESPACE"," ",1218],["T_AS","as",1218],["T_WHITESPACE"," ",1218],["T_VARIABLE","$child",1218],")",["T_WHITESPACE"," ",1218],"{",["T_WHITESPACE","\n                        ",1218],["T_IF","if",1219],["T_WHITESPACE"," ",1219],"(",["T_VARIABLE","$child",1219],["T_OBJECT_OPERATOR","->",1219],["T_STRING","getProduct",1219],"(",")",["T_OBJECT_OPERATOR","->",1219],["T_STRING","getIsVirtual",1219],"(",")",")",["T_WHITESPACE"," ",1219],"{",["T_WHITESPACE","\n                            ",1219],["T_VARIABLE","$qty",1220],["T_PLUS_EQUAL","+=",1220],["T_WHITESPACE"," ",1220],["T_VARIABLE","$child",1220],["T_OBJECT_OPERATOR","->",1220],["T_STRING","getQty",1220],"(",")",";",["T_WHITESPACE","\n                        ",1220],"}",["T_WHITESPACE","\n                    ",1221],"}",["T_WHITESPACE","\n                ",1222],"}",["T_WHITESPACE"," ",1223],["T_ELSE","else",1223],["T_WHITESPACE"," ",1223],"{",["T_WHITESPACE","\n                    ",1223],["T_IF","if",1224],["T_WHITESPACE"," ",1224],"(",["T_VARIABLE","$item",1224],["T_OBJECT_OPERATOR","->",1224],["T_STRING","getProduct",1224],"(",")",["T_OBJECT_OPERATOR","->",1224],["T_STRING","getIsVirtual",1224],"(",")",")",["T_WHITESPACE"," ",1224],"{",["T_WHITESPACE","\n                        ",1224],["T_VARIABLE","$qty",1225],["T_PLUS_EQUAL","+=",1225],["T_WHITESPACE"," ",1225],["T_VARIABLE","$item",1225],["T_OBJECT_OPERATOR","->",1225],["T_STRING","getQty",1225],"(",")",";",["T_WHITESPACE","\n                    ",1225],"}",["T_WHITESPACE","\n                ",1226],"}",["T_WHITESPACE","\n            ",1227],"}",["T_WHITESPACE","\n            ",1228],["T_VARIABLE","$this",1229],["T_OBJECT_OPERATOR","->",1229],["T_STRING","setData",1229],"(",["T_CONSTANT_ENCAPSED_STRING","'virtual_items_qty'",1229],",",["T_WHITESPACE"," ",1229],["T_VARIABLE","$qty",1229],")",";",["T_WHITESPACE","\n        ",1229],"}",["T_WHITESPACE","\n        ",1230],["T_RETURN","return",1231],["T_WHITESPACE"," ",1231],["T_VARIABLE","$qty",1231],";",["T_WHITESPACE","\n    ",1231],"}",["T_WHITESPACE","\n\n    ",1232],["T_COMMENT","\/*********************** PAYMENTS ***************************\/",1234],["T_WHITESPACE","\n    ",1234],["T_PUBLIC","public",1235],["T_WHITESPACE"," ",1235],["T_FUNCTION","function",1235],["T_WHITESPACE"," ",1235],["T_STRING","getPaymentsCollection",1235],"(",")",["T_WHITESPACE","\n    ",1235],"{",["T_WHITESPACE","\n        ",1236],["T_IF","if",1237],["T_WHITESPACE"," ",1237],"(",["T_STRING","is_null",1237],"(",["T_VARIABLE","$this",1237],["T_OBJECT_OPERATOR","->",1237],["T_STRING","_payments",1237],")",")",["T_WHITESPACE"," ",1237],"{",["T_WHITESPACE","\n            ",1237],["T_VARIABLE","$this",1238],["T_OBJECT_OPERATOR","->",1238],["T_STRING","_payments",1238],["T_WHITESPACE"," ",1238],"=",["T_WHITESPACE"," ",1238],["T_STRING","Mage",1238],["T_DOUBLE_COLON","::",1238],["T_STRING","getModel",1238],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_payment'",1238],")",["T_OBJECT_OPERATOR","->",1238],["T_STRING","getCollection",1238],"(",")",["T_WHITESPACE","\n                ",1238],["T_OBJECT_OPERATOR","->",1239],["T_STRING","setQuoteFilter",1239],"(",["T_VARIABLE","$this",1239],["T_OBJECT_OPERATOR","->",1239],["T_STRING","getId",1239],"(",")",")",";",["T_WHITESPACE","\n\n            ",1239],["T_IF","if",1241],["T_WHITESPACE"," ",1241],"(",["T_VARIABLE","$this",1241],["T_OBJECT_OPERATOR","->",1241],["T_STRING","getId",1241],"(",")",")",["T_WHITESPACE"," ",1241],"{",["T_WHITESPACE","\n                ",1241],["T_FOREACH","foreach",1242],["T_WHITESPACE"," ",1242],"(",["T_VARIABLE","$this",1242],["T_OBJECT_OPERATOR","->",1242],["T_STRING","_payments",1242],["T_WHITESPACE"," ",1242],["T_AS","as",1242],["T_WHITESPACE"," ",1242],["T_VARIABLE","$payment",1242],")",["T_WHITESPACE"," ",1242],"{",["T_WHITESPACE","\n                    ",1242],["T_VARIABLE","$payment",1243],["T_OBJECT_OPERATOR","->",1243],["T_STRING","setQuote",1243],"(",["T_VARIABLE","$this",1243],")",";",["T_WHITESPACE","\n                ",1243],"}",["T_WHITESPACE","\n            ",1244],"}",["T_WHITESPACE","\n        ",1245],"}",["T_WHITESPACE","\n        ",1246],["T_RETURN","return",1247],["T_WHITESPACE"," ",1247],["T_VARIABLE","$this",1247],["T_OBJECT_OPERATOR","->",1247],["T_STRING","_payments",1247],";",["T_WHITESPACE","\n    ",1247],"}",["T_WHITESPACE","\n\n    ",1248],["T_DOC_COMMENT","\/**\n     * @return Mage_Sales_Model_Quote_Payment\n     *\/",1250],["T_WHITESPACE","\n    ",1252],["T_PUBLIC","public",1253],["T_WHITESPACE"," ",1253],["T_FUNCTION","function",1253],["T_WHITESPACE"," ",1253],["T_STRING","getPayment",1253],"(",")",["T_WHITESPACE","\n    ",1253],"{",["T_WHITESPACE","\n        ",1254],["T_FOREACH","foreach",1255],["T_WHITESPACE"," ",1255],"(",["T_VARIABLE","$this",1255],["T_OBJECT_OPERATOR","->",1255],["T_STRING","getPaymentsCollection",1255],"(",")",["T_WHITESPACE"," ",1255],["T_AS","as",1255],["T_WHITESPACE"," ",1255],["T_VARIABLE","$payment",1255],")",["T_WHITESPACE"," ",1255],"{",["T_WHITESPACE","\n            ",1255],["T_IF","if",1256],["T_WHITESPACE"," ",1256],"(","!",["T_VARIABLE","$payment",1256],["T_OBJECT_OPERATOR","->",1256],["T_STRING","isDeleted",1256],"(",")",")",["T_WHITESPACE"," ",1256],"{",["T_WHITESPACE","\n                ",1256],["T_RETURN","return",1257],["T_WHITESPACE"," ",1257],["T_VARIABLE","$payment",1257],";",["T_WHITESPACE","\n            ",1257],"}",["T_WHITESPACE","\n        ",1258],"}",["T_WHITESPACE","\n        ",1259],["T_VARIABLE","$payment",1260],["T_WHITESPACE"," ",1260],"=",["T_WHITESPACE"," ",1260],["T_STRING","Mage",1260],["T_DOUBLE_COLON","::",1260],["T_STRING","getModel",1260],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_payment'",1260],")",";",["T_WHITESPACE","\n        ",1260],["T_VARIABLE","$this",1261],["T_OBJECT_OPERATOR","->",1261],["T_STRING","addPayment",1261],"(",["T_VARIABLE","$payment",1261],")",";",["T_WHITESPACE","\n        ",1261],["T_RETURN","return",1262],["T_WHITESPACE"," ",1262],["T_VARIABLE","$payment",1262],";",["T_WHITESPACE","\n    ",1262],"}",["T_WHITESPACE","\n\n    ",1263],["T_PUBLIC","public",1265],["T_WHITESPACE"," ",1265],["T_FUNCTION","function",1265],["T_WHITESPACE"," ",1265],["T_STRING","getPaymentById",1265],"(",["T_VARIABLE","$paymentId",1265],")",["T_WHITESPACE","\n    ",1265],"{",["T_WHITESPACE","\n        ",1266],["T_FOREACH","foreach",1267],["T_WHITESPACE"," ",1267],"(",["T_VARIABLE","$this",1267],["T_OBJECT_OPERATOR","->",1267],["T_STRING","getPaymentsCollection",1267],"(",")",["T_WHITESPACE"," ",1267],["T_AS","as",1267],["T_WHITESPACE"," ",1267],["T_VARIABLE","$payment",1267],")",["T_WHITESPACE"," ",1267],"{",["T_WHITESPACE","\n            ",1267],["T_IF","if",1268],["T_WHITESPACE"," ",1268],"(",["T_VARIABLE","$payment",1268],["T_OBJECT_OPERATOR","->",1268],["T_STRING","getId",1268],"(",")",["T_IS_EQUAL","==",1268],["T_VARIABLE","$paymentId",1268],")",["T_WHITESPACE"," ",1268],"{",["T_WHITESPACE","\n                ",1268],["T_RETURN","return",1269],["T_WHITESPACE"," ",1269],["T_VARIABLE","$payment",1269],";",["T_WHITESPACE","\n            ",1269],"}",["T_WHITESPACE","\n        ",1270],"}",["T_WHITESPACE","\n        ",1271],["T_RETURN","return",1272],["T_WHITESPACE"," ",1272],["T_STRING","false",1272],";",["T_WHITESPACE","\n    ",1272],"}",["T_WHITESPACE","\n\n    ",1273],["T_PUBLIC","public",1275],["T_WHITESPACE"," ",1275],["T_FUNCTION","function",1275],["T_WHITESPACE"," ",1275],["T_STRING","addPayment",1275],"(",["T_STRING","Mage_Sales_Model_Quote_Payment",1275],["T_WHITESPACE"," ",1275],["T_VARIABLE","$payment",1275],")",["T_WHITESPACE","\n    ",1275],"{",["T_WHITESPACE","\n        ",1276],["T_VARIABLE","$payment",1277],["T_OBJECT_OPERATOR","->",1277],["T_STRING","setQuote",1277],"(",["T_VARIABLE","$this",1277],")",";",["T_WHITESPACE","\n        ",1277],["T_IF","if",1278],["T_WHITESPACE"," ",1278],"(","!",["T_VARIABLE","$payment",1278],["T_OBJECT_OPERATOR","->",1278],["T_STRING","getId",1278],"(",")",")",["T_WHITESPACE"," ",1278],"{",["T_WHITESPACE","\n            ",1278],["T_VARIABLE","$this",1279],["T_OBJECT_OPERATOR","->",1279],["T_STRING","getPaymentsCollection",1279],"(",")",["T_OBJECT_OPERATOR","->",1279],["T_STRING","addItem",1279],"(",["T_VARIABLE","$payment",1279],")",";",["T_WHITESPACE","\n        ",1279],"}",["T_WHITESPACE","\n        ",1280],["T_RETURN","return",1281],["T_WHITESPACE"," ",1281],["T_VARIABLE","$this",1281],";",["T_WHITESPACE","\n    ",1281],"}",["T_WHITESPACE","\n\n    ",1282],["T_PUBLIC","public",1284],["T_WHITESPACE"," ",1284],["T_FUNCTION","function",1284],["T_WHITESPACE"," ",1284],["T_STRING","setPayment",1284],"(",["T_STRING","Mage_Sales_Model_Quote_Payment",1284],["T_WHITESPACE"," ",1284],["T_VARIABLE","$payment",1284],")",["T_WHITESPACE","\n    ",1284],"{",["T_WHITESPACE","\n        ",1285],["T_IF","if",1286],["T_WHITESPACE"," ",1286],"(","!",["T_VARIABLE","$this",1286],["T_OBJECT_OPERATOR","->",1286],["T_STRING","getIsMultiPayment",1286],"(",")",["T_WHITESPACE"," ",1286],["T_BOOLEAN_AND","&&",1286],["T_WHITESPACE"," ",1286],"(",["T_VARIABLE","$old",1286],["T_WHITESPACE"," ",1286],"=",["T_WHITESPACE"," ",1286],["T_VARIABLE","$this",1286],["T_OBJECT_OPERATOR","->",1286],["T_STRING","getPayment",1286],"(",")",")",")",["T_WHITESPACE"," ",1286],"{",["T_WHITESPACE","\n            ",1286],["T_VARIABLE","$payment",1287],["T_OBJECT_OPERATOR","->",1287],["T_STRING","setId",1287],"(",["T_VARIABLE","$old",1287],["T_OBJECT_OPERATOR","->",1287],["T_STRING","getId",1287],"(",")",")",";",["T_WHITESPACE","\n        ",1287],"}",["T_WHITESPACE","\n        ",1288],["T_VARIABLE","$this",1289],["T_OBJECT_OPERATOR","->",1289],["T_STRING","addPayment",1289],"(",["T_VARIABLE","$payment",1289],")",";",["T_WHITESPACE","\n\n        ",1289],["T_RETURN","return",1291],["T_WHITESPACE"," ",1291],["T_VARIABLE","$payment",1291],";",["T_WHITESPACE","\n    ",1291],"}",["T_WHITESPACE","\n\n    ",1292],["T_PUBLIC","public",1294],["T_WHITESPACE"," ",1294],["T_FUNCTION","function",1294],["T_WHITESPACE"," ",1294],["T_STRING","removePayment",1294],"(",")",["T_WHITESPACE","\n    ",1294],"{",["T_WHITESPACE","\n        ",1295],["T_VARIABLE","$this",1296],["T_OBJECT_OPERATOR","->",1296],["T_STRING","getPayment",1296],"(",")",["T_OBJECT_OPERATOR","->",1296],["T_STRING","isDeleted",1296],"(",["T_STRING","true",1296],")",";",["T_WHITESPACE","\n        ",1296],["T_RETURN","return",1297],["T_WHITESPACE"," ",1297],["T_VARIABLE","$this",1297],";",["T_WHITESPACE","\n    ",1297],"}",["T_WHITESPACE","\n\n    ",1298],["T_DOC_COMMENT","\/**\n     * Collect totals\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",1300],["T_WHITESPACE","\n    ",1304],["T_PUBLIC","public",1305],["T_WHITESPACE"," ",1305],["T_FUNCTION","function",1305],["T_WHITESPACE"," ",1305],["T_STRING","collectTotals",1305],"(",")",["T_WHITESPACE","\n    ",1305],"{",["T_WHITESPACE","\n        ",1306],["T_DOC_COMMENT","\/**\n         * Protect double totals collection\n         *\/",1307],["T_WHITESPACE","\n        ",1309],["T_IF","if",1310],["T_WHITESPACE"," ",1310],"(",["T_VARIABLE","$this",1310],["T_OBJECT_OPERATOR","->",1310],["T_STRING","getTotalsCollectedFlag",1310],"(",")",")",["T_WHITESPACE"," ",1310],"{",["T_WHITESPACE","\n            ",1310],["T_RETURN","return",1311],["T_WHITESPACE"," ",1311],["T_VARIABLE","$this",1311],";",["T_WHITESPACE","\n        ",1311],"}",["T_WHITESPACE","\n        ",1312],["T_STRING","Mage",1313],["T_DOUBLE_COLON","::",1313],["T_STRING","dispatchEvent",1313],"(",["T_VARIABLE","$this",1313],["T_OBJECT_OPERATOR","->",1313],["T_STRING","_eventPrefix",1313],["T_WHITESPACE"," ",1313],".",["T_WHITESPACE"," ",1313],["T_CONSTANT_ENCAPSED_STRING","'_collect_totals_before'",1313],",",["T_WHITESPACE"," ",1313],["T_ARRAY","array",1313],"(",["T_VARIABLE","$this",1313],["T_OBJECT_OPERATOR","->",1313],["T_STRING","_eventObject",1313],["T_WHITESPACE"," ",1313],["T_DOUBLE_ARROW","=>",1313],["T_WHITESPACE"," ",1313],["T_VARIABLE","$this",1313],")",")",";",["T_WHITESPACE","\n\n        ",1313],["T_VARIABLE","$this",1315],["T_OBJECT_OPERATOR","->",1315],["T_STRING","setSubtotal",1315],"(",["T_LNUMBER","0",1315],")",";",["T_WHITESPACE","\n        ",1315],["T_VARIABLE","$this",1316],["T_OBJECT_OPERATOR","->",1316],["T_STRING","setBaseSubtotal",1316],"(",["T_LNUMBER","0",1316],")",";",["T_WHITESPACE","\n\n        ",1316],["T_VARIABLE","$this",1318],["T_OBJECT_OPERATOR","->",1318],["T_STRING","setSubtotalWithDiscount",1318],"(",["T_LNUMBER","0",1318],")",";",["T_WHITESPACE","\n        ",1318],["T_VARIABLE","$this",1319],["T_OBJECT_OPERATOR","->",1319],["T_STRING","setBaseSubtotalWithDiscount",1319],"(",["T_LNUMBER","0",1319],")",";",["T_WHITESPACE","\n\n        ",1319],["T_VARIABLE","$this",1321],["T_OBJECT_OPERATOR","->",1321],["T_STRING","setGrandTotal",1321],"(",["T_LNUMBER","0",1321],")",";",["T_WHITESPACE","\n        ",1321],["T_VARIABLE","$this",1322],["T_OBJECT_OPERATOR","->",1322],["T_STRING","setBaseGrandTotal",1322],"(",["T_LNUMBER","0",1322],")",";",["T_WHITESPACE","\n\n        ",1322],["T_FOREACH","foreach",1324],["T_WHITESPACE"," ",1324],"(",["T_VARIABLE","$this",1324],["T_OBJECT_OPERATOR","->",1324],["T_STRING","getAllAddresses",1324],"(",")",["T_WHITESPACE"," ",1324],["T_AS","as",1324],["T_WHITESPACE"," ",1324],["T_VARIABLE","$address",1324],")",["T_WHITESPACE"," ",1324],"{",["T_WHITESPACE","\n            ",1324],["T_VARIABLE","$address",1325],["T_OBJECT_OPERATOR","->",1325],["T_STRING","setSubtotal",1325],"(",["T_LNUMBER","0",1325],")",";",["T_WHITESPACE","\n            ",1325],["T_VARIABLE","$address",1326],["T_OBJECT_OPERATOR","->",1326],["T_STRING","setBaseSubtotal",1326],"(",["T_LNUMBER","0",1326],")",";",["T_WHITESPACE","\n\n            ",1326],["T_VARIABLE","$address",1328],["T_OBJECT_OPERATOR","->",1328],["T_STRING","setGrandTotal",1328],"(",["T_LNUMBER","0",1328],")",";",["T_WHITESPACE","\n            ",1328],["T_VARIABLE","$address",1329],["T_OBJECT_OPERATOR","->",1329],["T_STRING","setBaseGrandTotal",1329],"(",["T_LNUMBER","0",1329],")",";",["T_WHITESPACE","\n\n            ",1329],["T_VARIABLE","$address",1331],["T_OBJECT_OPERATOR","->",1331],["T_STRING","collectTotals",1331],"(",")",";",["T_WHITESPACE","\n\n            ",1331],["T_VARIABLE","$this",1333],["T_OBJECT_OPERATOR","->",1333],["T_STRING","setSubtotal",1333],"(",["T_DOUBLE_CAST","(float)",1333],["T_WHITESPACE"," ",1333],["T_VARIABLE","$this",1333],["T_OBJECT_OPERATOR","->",1333],["T_STRING","getSubtotal",1333],"(",")",["T_WHITESPACE"," ",1333],"+",["T_WHITESPACE"," ",1333],["T_VARIABLE","$address",1333],["T_OBJECT_OPERATOR","->",1333],["T_STRING","getSubtotal",1333],"(",")",")",";",["T_WHITESPACE","\n            ",1333],["T_VARIABLE","$this",1334],["T_OBJECT_OPERATOR","->",1334],["T_STRING","setBaseSubtotal",1334],"(",["T_DOUBLE_CAST","(float)",1334],["T_WHITESPACE"," ",1334],["T_VARIABLE","$this",1334],["T_OBJECT_OPERATOR","->",1334],["T_STRING","getBaseSubtotal",1334],"(",")",["T_WHITESPACE"," ",1334],"+",["T_WHITESPACE"," ",1334],["T_VARIABLE","$address",1334],["T_OBJECT_OPERATOR","->",1334],["T_STRING","getBaseSubtotal",1334],"(",")",")",";",["T_WHITESPACE","\n\n            ",1334],["T_VARIABLE","$this",1336],["T_OBJECT_OPERATOR","->",1336],["T_STRING","setSubtotalWithDiscount",1336],"(",["T_WHITESPACE","\n                ",1336],["T_DOUBLE_CAST","(float)",1337],["T_WHITESPACE"," ",1337],["T_VARIABLE","$this",1337],["T_OBJECT_OPERATOR","->",1337],["T_STRING","getSubtotalWithDiscount",1337],"(",")",["T_WHITESPACE"," ",1337],"+",["T_WHITESPACE"," ",1337],["T_VARIABLE","$address",1337],["T_OBJECT_OPERATOR","->",1337],["T_STRING","getSubtotalWithDiscount",1337],"(",")",["T_WHITESPACE","\n            ",1337],")",";",["T_WHITESPACE","\n            ",1338],["T_VARIABLE","$this",1339],["T_OBJECT_OPERATOR","->",1339],["T_STRING","setBaseSubtotalWithDiscount",1339],"(",["T_WHITESPACE","\n                ",1339],["T_DOUBLE_CAST","(float)",1340],["T_WHITESPACE"," ",1340],["T_VARIABLE","$this",1340],["T_OBJECT_OPERATOR","->",1340],["T_STRING","getBaseSubtotalWithDiscount",1340],"(",")",["T_WHITESPACE"," ",1340],"+",["T_WHITESPACE"," ",1340],["T_VARIABLE","$address",1340],["T_OBJECT_OPERATOR","->",1340],["T_STRING","getBaseSubtotalWithDiscount",1340],"(",")",["T_WHITESPACE","\n            ",1340],")",";",["T_WHITESPACE","\n\n            ",1341],["T_VARIABLE","$this",1343],["T_OBJECT_OPERATOR","->",1343],["T_STRING","setGrandTotal",1343],"(",["T_DOUBLE_CAST","(float)",1343],["T_WHITESPACE"," ",1343],["T_VARIABLE","$this",1343],["T_OBJECT_OPERATOR","->",1343],["T_STRING","getGrandTotal",1343],"(",")",["T_WHITESPACE"," ",1343],"+",["T_WHITESPACE"," ",1343],["T_VARIABLE","$address",1343],["T_OBJECT_OPERATOR","->",1343],["T_STRING","getGrandTotal",1343],"(",")",")",";",["T_WHITESPACE","\n            ",1343],["T_VARIABLE","$this",1344],["T_OBJECT_OPERATOR","->",1344],["T_STRING","setBaseGrandTotal",1344],"(",["T_DOUBLE_CAST","(float)",1344],["T_WHITESPACE"," ",1344],["T_VARIABLE","$this",1344],["T_OBJECT_OPERATOR","->",1344],["T_STRING","getBaseGrandTotal",1344],"(",")",["T_WHITESPACE"," ",1344],"+",["T_WHITESPACE"," ",1344],["T_VARIABLE","$address",1344],["T_OBJECT_OPERATOR","->",1344],["T_STRING","getBaseGrandTotal",1344],"(",")",")",";",["T_WHITESPACE","\n        ",1344],"}",["T_WHITESPACE","\n\n        ",1345],["T_STRING","Mage",1347],["T_DOUBLE_COLON","::",1347],["T_STRING","helper",1347],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1347],")",["T_OBJECT_OPERATOR","->",1347],["T_STRING","checkQuoteAmount",1347],"(",["T_VARIABLE","$this",1347],",",["T_WHITESPACE"," ",1347],["T_VARIABLE","$this",1347],["T_OBJECT_OPERATOR","->",1347],["T_STRING","getGrandTotal",1347],"(",")",")",";",["T_WHITESPACE","\n        ",1347],["T_STRING","Mage",1348],["T_DOUBLE_COLON","::",1348],["T_STRING","helper",1348],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",1348],")",["T_OBJECT_OPERATOR","->",1348],["T_STRING","checkQuoteAmount",1348],"(",["T_VARIABLE","$this",1348],",",["T_WHITESPACE"," ",1348],["T_VARIABLE","$this",1348],["T_OBJECT_OPERATOR","->",1348],["T_STRING","getBaseGrandTotal",1348],"(",")",")",";",["T_WHITESPACE","\n\n        ",1348],["T_VARIABLE","$this",1350],["T_OBJECT_OPERATOR","->",1350],["T_STRING","setItemsCount",1350],"(",["T_LNUMBER","0",1350],")",";",["T_WHITESPACE","\n        ",1350],["T_VARIABLE","$this",1351],["T_OBJECT_OPERATOR","->",1351],["T_STRING","setItemsQty",1351],"(",["T_LNUMBER","0",1351],")",";",["T_WHITESPACE","\n        ",1351],["T_VARIABLE","$this",1352],["T_OBJECT_OPERATOR","->",1352],["T_STRING","setVirtualItemsQty",1352],"(",["T_LNUMBER","0",1352],")",";",["T_WHITESPACE","\n\n        ",1352],["T_FOREACH","foreach",1354],["T_WHITESPACE"," ",1354],"(",["T_VARIABLE","$this",1354],["T_OBJECT_OPERATOR","->",1354],["T_STRING","getAllVisibleItems",1354],"(",")",["T_WHITESPACE"," ",1354],["T_AS","as",1354],["T_WHITESPACE"," ",1354],["T_VARIABLE","$item",1354],")",["T_WHITESPACE"," ",1354],"{",["T_WHITESPACE","\n            ",1354],["T_IF","if",1355],["T_WHITESPACE"," ",1355],"(",["T_VARIABLE","$item",1355],["T_OBJECT_OPERATOR","->",1355],["T_STRING","getParentItem",1355],"(",")",")",["T_WHITESPACE"," ",1355],"{",["T_WHITESPACE","\n                ",1355],["T_CONTINUE","continue",1356],";",["T_WHITESPACE","\n            ",1356],"}",["T_WHITESPACE","\n\n            ",1357],["T_VARIABLE","$children",1359],["T_WHITESPACE"," ",1359],"=",["T_WHITESPACE"," ",1359],["T_VARIABLE","$item",1359],["T_OBJECT_OPERATOR","->",1359],["T_STRING","getChildren",1359],"(",")",";",["T_WHITESPACE","\n            ",1359],["T_IF","if",1360],["T_WHITESPACE"," ",1360],"(",["T_VARIABLE","$children",1360],["T_WHITESPACE"," ",1360],["T_BOOLEAN_AND","&&",1360],["T_WHITESPACE"," ",1360],["T_VARIABLE","$item",1360],["T_OBJECT_OPERATOR","->",1360],["T_STRING","isShipSeparately",1360],"(",")",")",["T_WHITESPACE"," ",1360],"{",["T_WHITESPACE","\n                ",1360],["T_FOREACH","foreach",1361],["T_WHITESPACE"," ",1361],"(",["T_VARIABLE","$children",1361],["T_WHITESPACE"," ",1361],["T_AS","as",1361],["T_WHITESPACE"," ",1361],["T_VARIABLE","$child",1361],")",["T_WHITESPACE"," ",1361],"{",["T_WHITESPACE","\n                    ",1361],["T_IF","if",1362],["T_WHITESPACE"," ",1362],"(",["T_VARIABLE","$child",1362],["T_OBJECT_OPERATOR","->",1362],["T_STRING","getProduct",1362],"(",")",["T_OBJECT_OPERATOR","->",1362],["T_STRING","getIsVirtual",1362],"(",")",")",["T_WHITESPACE"," ",1362],"{",["T_WHITESPACE","\n                        ",1362],["T_VARIABLE","$this",1363],["T_OBJECT_OPERATOR","->",1363],["T_STRING","setVirtualItemsQty",1363],"(",["T_VARIABLE","$this",1363],["T_OBJECT_OPERATOR","->",1363],["T_STRING","getVirtualItemsQty",1363],"(",")",["T_WHITESPACE"," ",1363],"+",["T_WHITESPACE"," ",1363],["T_VARIABLE","$child",1363],["T_OBJECT_OPERATOR","->",1363],["T_STRING","getQty",1363],"(",")","*",["T_VARIABLE","$item",1363],["T_OBJECT_OPERATOR","->",1363],["T_STRING","getQty",1363],"(",")",")",";",["T_WHITESPACE","\n                    ",1363],"}",["T_WHITESPACE","\n                ",1364],"}",["T_WHITESPACE","\n            ",1365],"}",["T_WHITESPACE","\n\n            ",1366],["T_IF","if",1368],["T_WHITESPACE"," ",1368],"(",["T_VARIABLE","$item",1368],["T_OBJECT_OPERATOR","->",1368],["T_STRING","getProduct",1368],"(",")",["T_OBJECT_OPERATOR","->",1368],["T_STRING","getIsVirtual",1368],"(",")",")",["T_WHITESPACE"," ",1368],"{",["T_WHITESPACE","\n                ",1368],["T_VARIABLE","$this",1369],["T_OBJECT_OPERATOR","->",1369],["T_STRING","setVirtualItemsQty",1369],"(",["T_VARIABLE","$this",1369],["T_OBJECT_OPERATOR","->",1369],["T_STRING","getVirtualItemsQty",1369],"(",")",["T_WHITESPACE"," ",1369],"+",["T_WHITESPACE"," ",1369],["T_VARIABLE","$item",1369],["T_OBJECT_OPERATOR","->",1369],["T_STRING","getQty",1369],"(",")",")",";",["T_WHITESPACE","\n            ",1369],"}",["T_WHITESPACE","\n            ",1370],["T_VARIABLE","$this",1371],["T_OBJECT_OPERATOR","->",1371],["T_STRING","setItemsCount",1371],"(",["T_VARIABLE","$this",1371],["T_OBJECT_OPERATOR","->",1371],["T_STRING","getItemsCount",1371],"(",")","+",["T_LNUMBER","1",1371],")",";",["T_WHITESPACE","\n            ",1371],["T_VARIABLE","$this",1372],["T_OBJECT_OPERATOR","->",1372],["T_STRING","setItemsQty",1372],"(",["T_DOUBLE_CAST","(float)",1372],["T_WHITESPACE"," ",1372],["T_VARIABLE","$this",1372],["T_OBJECT_OPERATOR","->",1372],["T_STRING","getItemsQty",1372],"(",")","+",["T_VARIABLE","$item",1372],["T_OBJECT_OPERATOR","->",1372],["T_STRING","getQty",1372],"(",")",")",";",["T_WHITESPACE","\n        ",1372],"}",["T_WHITESPACE","\n\n        ",1373],["T_VARIABLE","$this",1375],["T_OBJECT_OPERATOR","->",1375],["T_STRING","setData",1375],"(",["T_CONSTANT_ENCAPSED_STRING","'trigger_recollect'",1375],",",["T_WHITESPACE"," ",1375],["T_LNUMBER","0",1375],")",";",["T_WHITESPACE","\n        ",1375],["T_VARIABLE","$this",1376],["T_OBJECT_OPERATOR","->",1376],["T_STRING","_validateCouponCode",1376],"(",")",";",["T_WHITESPACE","\n\n        ",1376],["T_STRING","Mage",1378],["T_DOUBLE_COLON","::",1378],["T_STRING","dispatchEvent",1378],"(",["T_VARIABLE","$this",1378],["T_OBJECT_OPERATOR","->",1378],["T_STRING","_eventPrefix",1378],["T_WHITESPACE"," ",1378],".",["T_WHITESPACE"," ",1378],["T_CONSTANT_ENCAPSED_STRING","'_collect_totals_after'",1378],",",["T_WHITESPACE"," ",1378],["T_ARRAY","array",1378],"(",["T_VARIABLE","$this",1378],["T_OBJECT_OPERATOR","->",1378],["T_STRING","_eventObject",1378],["T_WHITESPACE"," ",1378],["T_DOUBLE_ARROW","=>",1378],["T_WHITESPACE"," ",1378],["T_VARIABLE","$this",1378],")",")",";",["T_WHITESPACE","\n\n        ",1378],["T_VARIABLE","$this",1380],["T_OBJECT_OPERATOR","->",1380],["T_STRING","setTotalsCollectedFlag",1380],"(",["T_STRING","true",1380],")",";",["T_WHITESPACE","\n        ",1380],["T_RETURN","return",1381],["T_WHITESPACE"," ",1381],["T_VARIABLE","$this",1381],";",["T_WHITESPACE","\n    ",1381],"}",["T_WHITESPACE","\n\n    ",1382],["T_DOC_COMMENT","\/**\n     * Get all quote totals (sorted by priority)\n     * Method process quote states isVirtual and isMultiShipping\n     *\n     * @return array\n     *\/",1384],["T_WHITESPACE","\n    ",1389],["T_PUBLIC","public",1390],["T_WHITESPACE"," ",1390],["T_FUNCTION","function",1390],["T_WHITESPACE"," ",1390],["T_STRING","getTotals",1390],"(",")",["T_WHITESPACE","\n    ",1390],"{",["T_WHITESPACE","\n        ",1391],["T_DOC_COMMENT","\/**\n         * If quote is virtual we are using totals of billing address because\n         * all items assigned to it\n         *\/",1392],["T_WHITESPACE","\n        ",1395],["T_IF","if",1396],["T_WHITESPACE"," ",1396],"(",["T_VARIABLE","$this",1396],["T_OBJECT_OPERATOR","->",1396],["T_STRING","isVirtual",1396],"(",")",")",["T_WHITESPACE"," ",1396],"{",["T_WHITESPACE","\n            ",1396],["T_RETURN","return",1397],["T_WHITESPACE"," ",1397],["T_VARIABLE","$this",1397],["T_OBJECT_OPERATOR","->",1397],["T_STRING","getBillingAddress",1397],"(",")",["T_OBJECT_OPERATOR","->",1397],["T_STRING","getTotals",1397],"(",")",";",["T_WHITESPACE","\n        ",1397],"}",["T_WHITESPACE","\n\n        ",1398],["T_VARIABLE","$shippingAddress",1400],["T_WHITESPACE"," ",1400],"=",["T_WHITESPACE"," ",1400],["T_VARIABLE","$this",1400],["T_OBJECT_OPERATOR","->",1400],["T_STRING","getShippingAddress",1400],"(",")",";",["T_WHITESPACE","\n        ",1400],["T_VARIABLE","$totals",1401],["T_WHITESPACE"," ",1401],"=",["T_WHITESPACE"," ",1401],["T_VARIABLE","$shippingAddress",1401],["T_OBJECT_OPERATOR","->",1401],["T_STRING","getTotals",1401],"(",")",";",["T_WHITESPACE","\n        ",1401],["T_COMMENT","\/\/ Going through all quote addresses and merge their totals\n",1402],["T_WHITESPACE","        ",1403],["T_FOREACH","foreach",1403],["T_WHITESPACE"," ",1403],"(",["T_VARIABLE","$this",1403],["T_OBJECT_OPERATOR","->",1403],["T_STRING","getAddressesCollection",1403],"(",")",["T_WHITESPACE"," ",1403],["T_AS","as",1403],["T_WHITESPACE"," ",1403],["T_VARIABLE","$address",1403],")",["T_WHITESPACE"," ",1403],"{",["T_WHITESPACE","\n            ",1403],["T_IF","if",1404],["T_WHITESPACE"," ",1404],"(",["T_VARIABLE","$address",1404],["T_OBJECT_OPERATOR","->",1404],["T_STRING","isDeleted",1404],"(",")",["T_WHITESPACE"," ",1404],["T_BOOLEAN_OR","||",1404],["T_WHITESPACE"," ",1404],["T_VARIABLE","$address",1404],["T_WHITESPACE"," ",1404],["T_IS_IDENTICAL","===",1404],["T_WHITESPACE"," ",1404],["T_VARIABLE","$shippingAddress",1404],")",["T_WHITESPACE"," ",1404],"{",["T_WHITESPACE","\n                ",1404],["T_CONTINUE","continue",1405],";",["T_WHITESPACE","\n            ",1405],"}",["T_WHITESPACE","\n            ",1406],["T_FOREACH","foreach",1407],["T_WHITESPACE"," ",1407],"(",["T_VARIABLE","$address",1407],["T_OBJECT_OPERATOR","->",1407],["T_STRING","getTotals",1407],"(",")",["T_WHITESPACE"," ",1407],["T_AS","as",1407],["T_WHITESPACE"," ",1407],["T_VARIABLE","$code",1407],["T_WHITESPACE"," ",1407],["T_DOUBLE_ARROW","=>",1407],["T_WHITESPACE"," ",1407],["T_VARIABLE","$total",1407],")",["T_WHITESPACE"," ",1407],"{",["T_WHITESPACE","\n                ",1407],["T_IF","if",1408],["T_WHITESPACE"," ",1408],"(",["T_ISSET","isset",1408],"(",["T_VARIABLE","$totals",1408],"[",["T_VARIABLE","$code",1408],"]",")",")",["T_WHITESPACE"," ",1408],"{",["T_WHITESPACE","\n                    ",1408],["T_VARIABLE","$totals",1409],"[",["T_VARIABLE","$code",1409],"]",["T_OBJECT_OPERATOR","->",1409],["T_STRING","merge",1409],"(",["T_VARIABLE","$total",1409],")",";",["T_WHITESPACE","\n                ",1409],"}",["T_WHITESPACE"," ",1410],["T_ELSE","else",1410],["T_WHITESPACE"," ",1410],"{",["T_WHITESPACE","\n                    ",1410],["T_VARIABLE","$totals",1411],"[",["T_VARIABLE","$code",1411],"]",["T_WHITESPACE"," ",1411],"=",["T_WHITESPACE"," ",1411],["T_VARIABLE","$total",1411],";",["T_WHITESPACE","\n                ",1411],"}",["T_WHITESPACE","\n            ",1412],"}",["T_WHITESPACE","\n        ",1413],"}",["T_WHITESPACE","\n\n        ",1414],["T_VARIABLE","$sortedTotals",1416],["T_WHITESPACE"," ",1416],"=",["T_WHITESPACE"," ",1416],["T_ARRAY","array",1416],"(",")",";",["T_WHITESPACE","\n        ",1416],["T_FOREACH","foreach",1417],["T_WHITESPACE"," ",1417],"(",["T_VARIABLE","$this",1417],["T_OBJECT_OPERATOR","->",1417],["T_STRING","getBillingAddress",1417],"(",")",["T_OBJECT_OPERATOR","->",1417],["T_STRING","getTotalModels",1417],"(",")",["T_WHITESPACE"," ",1417],["T_AS","as",1417],["T_WHITESPACE"," ",1417],["T_VARIABLE","$total",1417],")",["T_WHITESPACE"," ",1417],"{",["T_WHITESPACE","\n            ",1417],["T_COMMENT","\/* @var $total Mage_Sales_Model_Quote_Address_Total_Abstract *\/",1418],["T_WHITESPACE","\n            ",1418],["T_IF","if",1419],["T_WHITESPACE"," ",1419],"(",["T_ISSET","isset",1419],"(",["T_VARIABLE","$totals",1419],"[",["T_VARIABLE","$total",1419],["T_OBJECT_OPERATOR","->",1419],["T_STRING","getCode",1419],"(",")","]",")",")",["T_WHITESPACE"," ",1419],"{",["T_WHITESPACE","\n                ",1419],["T_VARIABLE","$sortedTotals",1420],"[",["T_VARIABLE","$total",1420],["T_OBJECT_OPERATOR","->",1420],["T_STRING","getCode",1420],"(",")","]",["T_WHITESPACE"," ",1420],"=",["T_WHITESPACE"," ",1420],["T_VARIABLE","$totals",1420],"[",["T_VARIABLE","$total",1420],["T_OBJECT_OPERATOR","->",1420],["T_STRING","getCode",1420],"(",")","]",";",["T_WHITESPACE","\n            ",1420],"}",["T_WHITESPACE","\n        ",1421],"}",["T_WHITESPACE","\n        ",1422],["T_RETURN","return",1423],["T_WHITESPACE"," ",1423],["T_VARIABLE","$sortedTotals",1423],";",["T_WHITESPACE","\n    ",1423],"}",["T_WHITESPACE","\n\n    ",1424],["T_PUBLIC","public",1426],["T_WHITESPACE"," ",1426],["T_FUNCTION","function",1426],["T_WHITESPACE"," ",1426],["T_STRING","addMessage",1426],"(",["T_VARIABLE","$message",1426],",",["T_WHITESPACE"," ",1426],["T_VARIABLE","$index",1426],["T_WHITESPACE"," ",1426],"=",["T_WHITESPACE"," ",1426],["T_CONSTANT_ENCAPSED_STRING","'error'",1426],")",["T_WHITESPACE","\n    ",1426],"{",["T_WHITESPACE","\n        ",1427],["T_VARIABLE","$messages",1428],["T_WHITESPACE"," ",1428],"=",["T_WHITESPACE"," ",1428],["T_VARIABLE","$this",1428],["T_OBJECT_OPERATOR","->",1428],["T_STRING","getData",1428],"(",["T_CONSTANT_ENCAPSED_STRING","'messages'",1428],")",";",["T_WHITESPACE","\n        ",1428],["T_IF","if",1429],["T_WHITESPACE"," ",1429],"(",["T_STRING","is_null",1429],"(",["T_VARIABLE","$messages",1429],")",")",["T_WHITESPACE"," ",1429],"{",["T_WHITESPACE","\n            ",1429],["T_VARIABLE","$messages",1430],["T_WHITESPACE"," ",1430],"=",["T_WHITESPACE"," ",1430],["T_ARRAY","array",1430],"(",")",";",["T_WHITESPACE","\n        ",1430],"}",["T_WHITESPACE","\n\n        ",1431],["T_IF","if",1433],["T_WHITESPACE"," ",1433],"(",["T_ISSET","isset",1433],"(",["T_VARIABLE","$messages",1433],"[",["T_VARIABLE","$index",1433],"]",")",")",["T_WHITESPACE"," ",1433],"{",["T_WHITESPACE","\n            ",1433],["T_RETURN","return",1434],["T_WHITESPACE"," ",1434],["T_VARIABLE","$this",1434],";",["T_WHITESPACE","\n        ",1434],"}",["T_WHITESPACE","\n\n        ",1435],["T_IF","if",1437],["T_WHITESPACE"," ",1437],"(",["T_STRING","is_string",1437],"(",["T_VARIABLE","$message",1437],")",")",["T_WHITESPACE"," ",1437],"{",["T_WHITESPACE","\n            ",1437],["T_VARIABLE","$message",1438],["T_WHITESPACE"," ",1438],"=",["T_WHITESPACE"," ",1438],["T_STRING","Mage",1438],["T_DOUBLE_COLON","::",1438],["T_STRING","getSingleton",1438],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/message'",1438],")",["T_OBJECT_OPERATOR","->",1438],["T_STRING","error",1438],"(",["T_VARIABLE","$message",1438],")",";",["T_WHITESPACE","\n        ",1438],"}",["T_WHITESPACE","\n\n        ",1439],["T_VARIABLE","$messages",1441],"[",["T_VARIABLE","$index",1441],"]",["T_WHITESPACE"," ",1441],"=",["T_WHITESPACE"," ",1441],["T_VARIABLE","$message",1441],";",["T_WHITESPACE","\n        ",1441],["T_VARIABLE","$this",1442],["T_OBJECT_OPERATOR","->",1442],["T_STRING","setData",1442],"(",["T_CONSTANT_ENCAPSED_STRING","'messages'",1442],",",["T_WHITESPACE"," ",1442],["T_VARIABLE","$messages",1442],")",";",["T_WHITESPACE","\n        ",1442],["T_RETURN","return",1443],["T_WHITESPACE"," ",1443],["T_VARIABLE","$this",1443],";",["T_WHITESPACE","\n    ",1443],"}",["T_WHITESPACE","\n\n    ",1444],["T_DOC_COMMENT","\/**\n     * Retrieve current quote messages\n     *\n     * @return array\n     *\/",1446],["T_WHITESPACE","\n    ",1450],["T_PUBLIC","public",1451],["T_WHITESPACE"," ",1451],["T_FUNCTION","function",1451],["T_WHITESPACE"," ",1451],["T_STRING","getMessages",1451],"(",")",["T_WHITESPACE","\n    ",1451],"{",["T_WHITESPACE","\n        ",1452],["T_VARIABLE","$messages",1453],["T_WHITESPACE"," ",1453],"=",["T_WHITESPACE"," ",1453],["T_VARIABLE","$this",1453],["T_OBJECT_OPERATOR","->",1453],["T_STRING","getData",1453],"(",["T_CONSTANT_ENCAPSED_STRING","'messages'",1453],")",";",["T_WHITESPACE","\n        ",1453],["T_IF","if",1454],["T_WHITESPACE"," ",1454],"(",["T_STRING","is_null",1454],"(",["T_VARIABLE","$messages",1454],")",")",["T_WHITESPACE"," ",1454],"{",["T_WHITESPACE","\n            ",1454],["T_VARIABLE","$messages",1455],["T_WHITESPACE"," ",1455],"=",["T_WHITESPACE"," ",1455],["T_ARRAY","array",1455],"(",")",";",["T_WHITESPACE","\n            ",1455],["T_VARIABLE","$this",1456],["T_OBJECT_OPERATOR","->",1456],["T_STRING","setData",1456],"(",["T_CONSTANT_ENCAPSED_STRING","'messages'",1456],",",["T_WHITESPACE"," ",1456],["T_VARIABLE","$messages",1456],")",";",["T_WHITESPACE","\n        ",1456],"}",["T_WHITESPACE","\n        ",1457],["T_RETURN","return",1458],["T_WHITESPACE"," ",1458],["T_VARIABLE","$messages",1458],";",["T_WHITESPACE","\n    ",1458],"}",["T_WHITESPACE","\n\n    ",1459],["T_DOC_COMMENT","\/**\n     * Retrieve current quote errors\n     *\n     * @return array\n     *\/",1461],["T_WHITESPACE","\n    ",1465],["T_PUBLIC","public",1466],["T_WHITESPACE"," ",1466],["T_FUNCTION","function",1466],["T_WHITESPACE"," ",1466],["T_STRING","getErrors",1466],"(",")",["T_WHITESPACE","\n    ",1466],"{",["T_WHITESPACE","\n        ",1467],["T_VARIABLE","$errors",1468],["T_WHITESPACE"," ",1468],"=",["T_WHITESPACE"," ",1468],["T_ARRAY","array",1468],"(",")",";",["T_WHITESPACE","\n        ",1468],["T_FOREACH","foreach",1469],["T_WHITESPACE"," ",1469],"(",["T_VARIABLE","$this",1469],["T_OBJECT_OPERATOR","->",1469],["T_STRING","getMessages",1469],"(",")",["T_WHITESPACE"," ",1469],["T_AS","as",1469],["T_WHITESPACE"," ",1469],["T_VARIABLE","$message",1469],")",["T_WHITESPACE"," ",1469],"{",["T_WHITESPACE","\n            ",1469],["T_COMMENT","\/* @var $error Mage_Core_Model_Message_Abstract *\/",1470],["T_WHITESPACE","\n            ",1470],["T_IF","if",1471],["T_WHITESPACE"," ",1471],"(",["T_VARIABLE","$message",1471],["T_OBJECT_OPERATOR","->",1471],["T_STRING","getType",1471],"(",")",["T_WHITESPACE"," ",1471],["T_IS_EQUAL","==",1471],["T_WHITESPACE"," ",1471],["T_STRING","Mage_Core_Model_Message",1471],["T_DOUBLE_COLON","::",1471],["T_STRING","ERROR",1471],")",["T_WHITESPACE"," ",1471],"{",["T_WHITESPACE","\n                ",1471],["T_STRING","array_push",1472],"(",["T_VARIABLE","$errors",1472],",",["T_WHITESPACE"," ",1472],["T_VARIABLE","$message",1472],")",";",["T_WHITESPACE","\n            ",1472],"}",["T_WHITESPACE","\n        ",1473],"}",["T_WHITESPACE","\n        ",1474],["T_RETURN","return",1475],["T_WHITESPACE"," ",1475],["T_VARIABLE","$errors",1475],";",["T_WHITESPACE","\n    ",1475],"}",["T_WHITESPACE","\n\n    ",1476],["T_DOC_COMMENT","\/**\n     * Sets flag, whether this quote has some error associated with it.\n     *\n     * @param bool $flag\n     * @return Mage_Sales_Model_Quote\n     *\/",1478],["T_WHITESPACE","\n    ",1483],["T_PROTECTED","protected",1484],["T_WHITESPACE"," ",1484],["T_FUNCTION","function",1484],["T_WHITESPACE"," ",1484],["T_STRING","_setHasError",1484],"(",["T_VARIABLE","$flag",1484],")",["T_WHITESPACE","\n    ",1484],"{",["T_WHITESPACE","\n        ",1485],["T_RETURN","return",1486],["T_WHITESPACE"," ",1486],["T_VARIABLE","$this",1486],["T_OBJECT_OPERATOR","->",1486],["T_STRING","setData",1486],"(",["T_CONSTANT_ENCAPSED_STRING","'has_error'",1486],",",["T_WHITESPACE"," ",1486],["T_VARIABLE","$flag",1486],")",";",["T_WHITESPACE","\n    ",1486],"}",["T_WHITESPACE","\n\n    ",1487],["T_DOC_COMMENT","\/**\n     * Sets flag, whether this quote has some error associated with it.\n     * When TRUE - also adds 'unknown' error information to list of quote errors.\n     * When FALSE - clears whole list of quote errors.\n     * It's recommended to use addErrorInfo() instead - to be able to remove error statuses later.\n     *\n     * @param bool $flag\n     * @return Mage_Sales_Model_Quote\n     * @see addErrorInfo()\n     *\/",1489],["T_WHITESPACE","\n    ",1498],["T_PUBLIC","public",1499],["T_WHITESPACE"," ",1499],["T_FUNCTION","function",1499],["T_WHITESPACE"," ",1499],["T_STRING","setHasError",1499],"(",["T_VARIABLE","$flag",1499],")",["T_WHITESPACE","\n    ",1499],"{",["T_WHITESPACE","\n        ",1500],["T_IF","if",1501],["T_WHITESPACE"," ",1501],"(",["T_VARIABLE","$flag",1501],")",["T_WHITESPACE"," ",1501],"{",["T_WHITESPACE","\n            ",1501],["T_VARIABLE","$this",1502],["T_OBJECT_OPERATOR","->",1502],["T_STRING","addErrorInfo",1502],"(",")",";",["T_WHITESPACE","\n        ",1502],"}",["T_WHITESPACE"," ",1503],["T_ELSE","else",1503],["T_WHITESPACE"," ",1503],"{",["T_WHITESPACE","\n            ",1503],["T_VARIABLE","$this",1504],["T_OBJECT_OPERATOR","->",1504],["T_STRING","_clearErrorInfo",1504],"(",")",";",["T_WHITESPACE","\n        ",1504],"}",["T_WHITESPACE","\n        ",1505],["T_RETURN","return",1506],["T_WHITESPACE"," ",1506],["T_VARIABLE","$this",1506],";",["T_WHITESPACE","\n    ",1506],"}",["T_WHITESPACE","\n\n    ",1507],["T_DOC_COMMENT","\/**\n     * Clears list of errors, associated with this quote.\n     * Also automatically removes error-flag from oneself.\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",1509],["T_WHITESPACE","\n    ",1514],["T_PROTECTED","protected",1515],["T_WHITESPACE"," ",1515],["T_FUNCTION","function",1515],["T_WHITESPACE"," ",1515],["T_STRING","_clearErrorInfo",1515],"(",")",["T_WHITESPACE","\n    ",1515],"{",["T_WHITESPACE","\n        ",1516],["T_VARIABLE","$this",1517],["T_OBJECT_OPERATOR","->",1517],["T_STRING","_errorInfoGroups",1517],["T_WHITESPACE"," ",1517],"=",["T_WHITESPACE"," ",1517],["T_ARRAY","array",1517],"(",")",";",["T_WHITESPACE","\n        ",1517],["T_VARIABLE","$this",1518],["T_OBJECT_OPERATOR","->",1518],["T_STRING","_setHasError",1518],"(",["T_STRING","false",1518],")",";",["T_WHITESPACE","\n        ",1518],["T_RETURN","return",1519],["T_WHITESPACE"," ",1519],["T_VARIABLE","$this",1519],";",["T_WHITESPACE","\n    ",1519],"}",["T_WHITESPACE","\n\n    ",1520],["T_DOC_COMMENT","\/**\n     * Adds error information to the quote.\n     * Automatically sets error flag.\n     *\n     * @param string $type An internal error type ('error', 'qty', etc.), passed then to adding messages routine\n     * @param string|null $origin Usually a name of module, that embeds error\n     * @param int|null $code Error code, unique for origin, that sets it\n     * @param string|null $message Error message\n     * @param Varien_Object|null $additionalData Any additional data, that caller would like to store\n     * @return Mage_Sales_Model_Quote\n     *\/",1522],["T_WHITESPACE","\n    ",1532],["T_PUBLIC","public",1533],["T_WHITESPACE"," ",1533],["T_FUNCTION","function",1533],["T_WHITESPACE"," ",1533],["T_STRING","addErrorInfo",1533],"(",["T_VARIABLE","$type",1533],["T_WHITESPACE"," ",1533],"=",["T_WHITESPACE"," ",1533],["T_CONSTANT_ENCAPSED_STRING","'error'",1533],",",["T_WHITESPACE"," ",1533],["T_VARIABLE","$origin",1533],["T_WHITESPACE"," ",1533],"=",["T_WHITESPACE"," ",1533],["T_STRING","null",1533],",",["T_WHITESPACE"," ",1533],["T_VARIABLE","$code",1533],["T_WHITESPACE"," ",1533],"=",["T_WHITESPACE"," ",1533],["T_STRING","null",1533],",",["T_WHITESPACE"," ",1533],["T_VARIABLE","$message",1533],["T_WHITESPACE"," ",1533],"=",["T_WHITESPACE"," ",1533],["T_STRING","null",1533],",",["T_WHITESPACE"," ",1533],["T_VARIABLE","$additionalData",1533],["T_WHITESPACE"," ",1533],"=",["T_WHITESPACE"," ",1533],["T_STRING","null",1533],")",["T_WHITESPACE","\n    ",1533],"{",["T_WHITESPACE","\n        ",1534],["T_IF","if",1535],["T_WHITESPACE"," ",1535],"(","!",["T_ISSET","isset",1535],"(",["T_VARIABLE","$this",1535],["T_OBJECT_OPERATOR","->",1535],["T_STRING","_errorInfoGroups",1535],"[",["T_VARIABLE","$type",1535],"]",")",")",["T_WHITESPACE"," ",1535],"{",["T_WHITESPACE","\n            ",1535],["T_VARIABLE","$this",1536],["T_OBJECT_OPERATOR","->",1536],["T_STRING","_errorInfoGroups",1536],"[",["T_VARIABLE","$type",1536],"]",["T_WHITESPACE"," ",1536],"=",["T_WHITESPACE"," ",1536],["T_STRING","Mage",1536],["T_DOUBLE_COLON","::",1536],["T_STRING","getModel",1536],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/status_list'",1536],")",";",["T_WHITESPACE","\n        ",1536],"}",["T_WHITESPACE","\n\n        ",1537],["T_VARIABLE","$this",1539],["T_OBJECT_OPERATOR","->",1539],["T_STRING","_errorInfoGroups",1539],"[",["T_VARIABLE","$type",1539],"]",["T_OBJECT_OPERATOR","->",1539],["T_STRING","addItem",1539],"(",["T_VARIABLE","$origin",1539],",",["T_WHITESPACE"," ",1539],["T_VARIABLE","$code",1539],",",["T_WHITESPACE"," ",1539],["T_VARIABLE","$message",1539],",",["T_WHITESPACE"," ",1539],["T_VARIABLE","$additionalData",1539],")",";",["T_WHITESPACE","\n\n        ",1539],["T_IF","if",1541],["T_WHITESPACE"," ",1541],"(",["T_VARIABLE","$message",1541],["T_WHITESPACE"," ",1541],["T_IS_NOT_IDENTICAL","!==",1541],["T_WHITESPACE"," ",1541],["T_STRING","null",1541],")",["T_WHITESPACE"," ",1541],"{",["T_WHITESPACE","\n            ",1541],["T_VARIABLE","$this",1542],["T_OBJECT_OPERATOR","->",1542],["T_STRING","addMessage",1542],"(",["T_VARIABLE","$message",1542],",",["T_WHITESPACE"," ",1542],["T_VARIABLE","$type",1542],")",";",["T_WHITESPACE","\n        ",1542],"}",["T_WHITESPACE","\n        ",1543],["T_VARIABLE","$this",1544],["T_OBJECT_OPERATOR","->",1544],["T_STRING","_setHasError",1544],"(",["T_STRING","true",1544],")",";",["T_WHITESPACE","\n\n        ",1544],["T_RETURN","return",1546],["T_WHITESPACE"," ",1546],["T_VARIABLE","$this",1546],";",["T_WHITESPACE","\n    ",1546],"}",["T_WHITESPACE","\n\n    ",1547],["T_DOC_COMMENT","\/**\n     * Removes error infos, that have parameters equal to passed in $params.\n     * $params can have following keys (if not set - then any item is good for this key):\n     *   'origin', 'code', 'message'\n     *\n     * @param string $type An internal error type ('error', 'qty', etc.), passed then to adding messages routine\n     * @param array $params\n     * @return Mage_Sales_Model_Quote\n     *\/",1549],["T_WHITESPACE","\n    ",1557],["T_PUBLIC","public",1558],["T_WHITESPACE"," ",1558],["T_FUNCTION","function",1558],["T_WHITESPACE"," ",1558],["T_STRING","removeErrorInfosByParams",1558],"(",["T_VARIABLE","$type",1558],["T_WHITESPACE"," ",1558],"=",["T_WHITESPACE"," ",1558],["T_CONSTANT_ENCAPSED_STRING","'error'",1558],",",["T_WHITESPACE"," ",1558],["T_VARIABLE","$params",1558],")",["T_WHITESPACE","\n    ",1558],"{",["T_WHITESPACE","\n        ",1559],["T_IF","if",1560],["T_WHITESPACE"," ",1560],"(",["T_VARIABLE","$type",1560],["T_WHITESPACE"," ",1560],["T_BOOLEAN_AND","&&",1560],["T_WHITESPACE"," ",1560],"!",["T_ISSET","isset",1560],"(",["T_VARIABLE","$this",1560],["T_OBJECT_OPERATOR","->",1560],["T_STRING","_errorInfoGroups",1560],"[",["T_VARIABLE","$type",1560],"]",")",")",["T_WHITESPACE"," ",1560],"{",["T_WHITESPACE","\n            ",1560],["T_RETURN","return",1561],["T_WHITESPACE"," ",1561],["T_VARIABLE","$this",1561],";",["T_WHITESPACE","\n        ",1561],"}",["T_WHITESPACE","\n\n        ",1562],["T_VARIABLE","$errorLists",1564],["T_WHITESPACE"," ",1564],"=",["T_WHITESPACE"," ",1564],["T_ARRAY","array",1564],"(",")",";",["T_WHITESPACE","\n        ",1564],["T_IF","if",1565],["T_WHITESPACE"," ",1565],"(",["T_VARIABLE","$type",1565],")",["T_WHITESPACE"," ",1565],"{",["T_WHITESPACE","\n            ",1565],["T_VARIABLE","$errorLists",1566],"[","]",["T_WHITESPACE"," ",1566],"=",["T_WHITESPACE"," ",1566],["T_VARIABLE","$this",1566],["T_OBJECT_OPERATOR","->",1566],["T_STRING","_errorInfoGroups",1566],"[",["T_VARIABLE","$type",1566],"]",";",["T_WHITESPACE","\n        ",1566],"}",["T_WHITESPACE"," ",1567],["T_ELSE","else",1567],["T_WHITESPACE"," ",1567],"{",["T_WHITESPACE","\n            ",1567],["T_VARIABLE","$errorLists",1568],["T_WHITESPACE"," ",1568],"=",["T_WHITESPACE"," ",1568],["T_VARIABLE","$this",1568],["T_OBJECT_OPERATOR","->",1568],["T_STRING","_errorInfoGroups",1568],";",["T_WHITESPACE","\n        ",1568],"}",["T_WHITESPACE","\n\n        ",1569],["T_FOREACH","foreach",1571],["T_WHITESPACE"," ",1571],"(",["T_VARIABLE","$errorLists",1571],["T_WHITESPACE"," ",1571],["T_AS","as",1571],["T_WHITESPACE"," ",1571],["T_VARIABLE","$type",1571],["T_WHITESPACE"," ",1571],["T_DOUBLE_ARROW","=>",1571],["T_WHITESPACE"," ",1571],["T_VARIABLE","$errorList",1571],")",["T_WHITESPACE"," ",1571],"{",["T_WHITESPACE","\n            ",1571],["T_VARIABLE","$removedItems",1572],["T_WHITESPACE"," ",1572],"=",["T_WHITESPACE"," ",1572],["T_VARIABLE","$errorList",1572],["T_OBJECT_OPERATOR","->",1572],["T_STRING","removeItemsByParams",1572],"(",["T_VARIABLE","$params",1572],")",";",["T_WHITESPACE","\n            ",1572],["T_FOREACH","foreach",1573],["T_WHITESPACE"," ",1573],"(",["T_VARIABLE","$removedItems",1573],["T_WHITESPACE"," ",1573],["T_AS","as",1573],["T_WHITESPACE"," ",1573],["T_VARIABLE","$item",1573],")",["T_WHITESPACE"," ",1573],"{",["T_WHITESPACE","\n                ",1573],["T_IF","if",1574],["T_WHITESPACE"," ",1574],"(",["T_VARIABLE","$item",1574],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",1574],"]",["T_WHITESPACE"," ",1574],["T_IS_NOT_IDENTICAL","!==",1574],["T_WHITESPACE"," ",1574],["T_STRING","null",1574],")",["T_WHITESPACE"," ",1574],"{",["T_WHITESPACE","\n                    ",1574],["T_VARIABLE","$this",1575],["T_OBJECT_OPERATOR","->",1575],["T_STRING","removeMessageByText",1575],"(",["T_VARIABLE","$type",1575],",",["T_WHITESPACE"," ",1575],["T_VARIABLE","$item",1575],"[",["T_CONSTANT_ENCAPSED_STRING","'message'",1575],"]",")",";",["T_WHITESPACE","\n                ",1575],"}",["T_WHITESPACE","\n            ",1576],"}",["T_WHITESPACE","\n        ",1577],"}",["T_WHITESPACE","\n\n        ",1578],["T_VARIABLE","$errorsExist",1580],["T_WHITESPACE"," ",1580],"=",["T_WHITESPACE"," ",1580],["T_STRING","false",1580],";",["T_WHITESPACE","\n        ",1580],["T_FOREACH","foreach",1581],["T_WHITESPACE"," ",1581],"(",["T_VARIABLE","$this",1581],["T_OBJECT_OPERATOR","->",1581],["T_STRING","_errorInfoGroups",1581],["T_WHITESPACE"," ",1581],["T_AS","as",1581],["T_WHITESPACE"," ",1581],["T_VARIABLE","$errorListCheck",1581],")",["T_WHITESPACE"," ",1581],"{",["T_WHITESPACE","\n            ",1581],["T_IF","if",1582],["T_WHITESPACE"," ",1582],"(",["T_VARIABLE","$errorListCheck",1582],["T_OBJECT_OPERATOR","->",1582],["T_STRING","getItems",1582],"(",")",")",["T_WHITESPACE"," ",1582],"{",["T_WHITESPACE","\n                ",1582],["T_VARIABLE","$errorsExist",1583],["T_WHITESPACE"," ",1583],"=",["T_WHITESPACE"," ",1583],["T_STRING","true",1583],";",["T_WHITESPACE","\n                ",1583],["T_BREAK","break",1584],";",["T_WHITESPACE","\n            ",1584],"}",["T_WHITESPACE","\n        ",1585],"}",["T_WHITESPACE","\n        ",1586],["T_IF","if",1587],["T_WHITESPACE"," ",1587],"(","!",["T_VARIABLE","$errorsExist",1587],")",["T_WHITESPACE"," ",1587],"{",["T_WHITESPACE","\n            ",1587],["T_VARIABLE","$this",1588],["T_OBJECT_OPERATOR","->",1588],["T_STRING","_setHasError",1588],"(",["T_STRING","false",1588],")",";",["T_WHITESPACE","\n        ",1588],"}",["T_WHITESPACE","\n\n        ",1589],["T_RETURN","return",1591],["T_WHITESPACE"," ",1591],["T_VARIABLE","$this",1591],";",["T_WHITESPACE","\n    ",1591],"}",["T_WHITESPACE","\n\n    ",1592],["T_DOC_COMMENT","\/**\n     * Removes message by text\n     *\n     * @param string $type\n     * @param string $text\n     * @return Mage_Sales_Model_Quote\n     *\/",1594],["T_WHITESPACE","\n    ",1600],["T_PUBLIC","public",1601],["T_WHITESPACE"," ",1601],["T_FUNCTION","function",1601],["T_WHITESPACE"," ",1601],["T_STRING","removeMessageByText",1601],"(",["T_VARIABLE","$type",1601],["T_WHITESPACE"," ",1601],"=",["T_WHITESPACE"," ",1601],["T_CONSTANT_ENCAPSED_STRING","'error'",1601],",",["T_WHITESPACE"," ",1601],["T_VARIABLE","$text",1601],")",["T_WHITESPACE","\n    ",1601],"{",["T_WHITESPACE","\n        ",1602],["T_VARIABLE","$messages",1603],["T_WHITESPACE"," ",1603],"=",["T_WHITESPACE"," ",1603],["T_VARIABLE","$this",1603],["T_OBJECT_OPERATOR","->",1603],["T_STRING","getData",1603],"(",["T_CONSTANT_ENCAPSED_STRING","'messages'",1603],")",";",["T_WHITESPACE","\n        ",1603],["T_IF","if",1604],["T_WHITESPACE"," ",1604],"(",["T_STRING","is_null",1604],"(",["T_VARIABLE","$messages",1604],")",")",["T_WHITESPACE"," ",1604],"{",["T_WHITESPACE","\n            ",1604],["T_VARIABLE","$messages",1605],["T_WHITESPACE"," ",1605],"=",["T_WHITESPACE"," ",1605],["T_ARRAY","array",1605],"(",")",";",["T_WHITESPACE","\n        ",1605],"}",["T_WHITESPACE","\n\n        ",1606],["T_IF","if",1608],["T_WHITESPACE"," ",1608],"(","!",["T_ISSET","isset",1608],"(",["T_VARIABLE","$messages",1608],"[",["T_VARIABLE","$type",1608],"]",")",")",["T_WHITESPACE"," ",1608],"{",["T_WHITESPACE","\n            ",1608],["T_RETURN","return",1609],["T_WHITESPACE"," ",1609],["T_VARIABLE","$this",1609],";",["T_WHITESPACE","\n        ",1609],"}",["T_WHITESPACE","\n\n        ",1610],["T_VARIABLE","$message",1612],["T_WHITESPACE"," ",1612],"=",["T_WHITESPACE"," ",1612],["T_VARIABLE","$messages",1612],"[",["T_VARIABLE","$type",1612],"]",";",["T_WHITESPACE","\n        ",1612],["T_IF","if",1613],["T_WHITESPACE"," ",1613],"(",["T_VARIABLE","$message",1613],["T_WHITESPACE"," ",1613],["T_INSTANCEOF","instanceof",1613],["T_WHITESPACE"," ",1613],["T_STRING","Mage_Core_Model_Message_Abstract",1613],")",["T_WHITESPACE"," ",1613],"{",["T_WHITESPACE","\n            ",1613],["T_VARIABLE","$message",1614],["T_WHITESPACE"," ",1614],"=",["T_WHITESPACE"," ",1614],["T_VARIABLE","$message",1614],["T_OBJECT_OPERATOR","->",1614],["T_STRING","getText",1614],"(",")",";",["T_WHITESPACE","\n        ",1614],"}",["T_WHITESPACE"," ",1615],["T_ELSE","else",1615],["T_WHITESPACE"," ",1615],["T_IF","if",1615],["T_WHITESPACE"," ",1615],"(","!",["T_STRING","is_string",1615],"(",["T_VARIABLE","$message",1615],")",")",["T_WHITESPACE"," ",1615],"{",["T_WHITESPACE","\n            ",1615],["T_RETURN","return",1616],["T_WHITESPACE"," ",1616],["T_VARIABLE","$this",1616],";",["T_WHITESPACE","\n        ",1616],"}",["T_WHITESPACE","\n        ",1617],["T_IF","if",1618],["T_WHITESPACE"," ",1618],"(",["T_VARIABLE","$message",1618],["T_WHITESPACE"," ",1618],["T_IS_EQUAL","==",1618],["T_WHITESPACE"," ",1618],["T_VARIABLE","$text",1618],")",["T_WHITESPACE"," ",1618],"{",["T_WHITESPACE","\n            ",1618],["T_UNSET","unset",1619],"(",["T_VARIABLE","$messages",1619],"[",["T_VARIABLE","$type",1619],"]",")",";",["T_WHITESPACE","\n            ",1619],["T_VARIABLE","$this",1620],["T_OBJECT_OPERATOR","->",1620],["T_STRING","setData",1620],"(",["T_CONSTANT_ENCAPSED_STRING","'messages'",1620],",",["T_WHITESPACE"," ",1620],["T_VARIABLE","$messages",1620],")",";",["T_WHITESPACE","\n        ",1620],"}",["T_WHITESPACE","\n        ",1621],["T_RETURN","return",1622],["T_WHITESPACE"," ",1622],["T_VARIABLE","$this",1622],";",["T_WHITESPACE","\n    ",1622],"}",["T_WHITESPACE","\n\n    ",1623],["T_DOC_COMMENT","\/**\n     * Generate new increment order id and associate it with current quote\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",1625],["T_WHITESPACE","\n    ",1629],["T_PUBLIC","public",1630],["T_WHITESPACE"," ",1630],["T_FUNCTION","function",1630],["T_WHITESPACE"," ",1630],["T_STRING","reserveOrderId",1630],"(",")",["T_WHITESPACE","\n    ",1630],"{",["T_WHITESPACE","\n        ",1631],["T_IF","if",1632],["T_WHITESPACE"," ",1632],"(","!",["T_VARIABLE","$this",1632],["T_OBJECT_OPERATOR","->",1632],["T_STRING","getReservedOrderId",1632],"(",")",")",["T_WHITESPACE"," ",1632],"{",["T_WHITESPACE","\n            ",1632],["T_VARIABLE","$this",1633],["T_OBJECT_OPERATOR","->",1633],["T_STRING","setReservedOrderId",1633],"(",["T_VARIABLE","$this",1633],["T_OBJECT_OPERATOR","->",1633],["T_STRING","_getResource",1633],"(",")",["T_OBJECT_OPERATOR","->",1633],["T_STRING","getReservedOrderId",1633],"(",["T_VARIABLE","$this",1633],")",")",";",["T_WHITESPACE","\n        ",1633],"}",["T_WHITESPACE"," ",1634],["T_ELSE","else",1634],["T_WHITESPACE"," ",1634],"{",["T_WHITESPACE","\n            ",1634],["T_COMMENT","\/\/checking if reserved order id was already used for some order\n",1635],["T_WHITESPACE","            ",1636],["T_COMMENT","\/\/if yes reserving new one if not using old one\n",1636],["T_WHITESPACE","            ",1637],["T_IF","if",1637],["T_WHITESPACE"," ",1637],"(",["T_VARIABLE","$this",1637],["T_OBJECT_OPERATOR","->",1637],["T_STRING","_getResource",1637],"(",")",["T_OBJECT_OPERATOR","->",1637],["T_STRING","isOrderIncrementIdUsed",1637],"(",["T_VARIABLE","$this",1637],["T_OBJECT_OPERATOR","->",1637],["T_STRING","getReservedOrderId",1637],"(",")",")",")",["T_WHITESPACE"," ",1637],"{",["T_WHITESPACE","\n                ",1637],["T_VARIABLE","$this",1638],["T_OBJECT_OPERATOR","->",1638],["T_STRING","setReservedOrderId",1638],"(",["T_VARIABLE","$this",1638],["T_OBJECT_OPERATOR","->",1638],["T_STRING","_getResource",1638],"(",")",["T_OBJECT_OPERATOR","->",1638],["T_STRING","getReservedOrderId",1638],"(",["T_VARIABLE","$this",1638],")",")",";",["T_WHITESPACE","\n            ",1638],"}",["T_WHITESPACE","\n        ",1639],"}",["T_WHITESPACE","\n        ",1640],["T_RETURN","return",1641],["T_WHITESPACE"," ",1641],["T_VARIABLE","$this",1641],";",["T_WHITESPACE","\n    ",1641],"}",["T_WHITESPACE","\n\n    ",1642],["T_PUBLIC","public",1644],["T_WHITESPACE"," ",1644],["T_FUNCTION","function",1644],["T_WHITESPACE"," ",1644],["T_STRING","validateMinimumAmount",1644],"(",["T_VARIABLE","$multishipping",1644],["T_WHITESPACE"," ",1644],"=",["T_WHITESPACE"," ",1644],["T_STRING","false",1644],")",["T_WHITESPACE","\n    ",1644],"{",["T_WHITESPACE","\n        ",1645],["T_VARIABLE","$storeId",1646],["T_WHITESPACE"," ",1646],"=",["T_WHITESPACE"," ",1646],["T_VARIABLE","$this",1646],["T_OBJECT_OPERATOR","->",1646],["T_STRING","getStoreId",1646],"(",")",";",["T_WHITESPACE","\n        ",1646],["T_VARIABLE","$minOrderActive",1647],["T_WHITESPACE"," ",1647],"=",["T_WHITESPACE"," ",1647],["T_STRING","Mage",1647],["T_DOUBLE_COLON","::",1647],["T_STRING","getStoreConfigFlag",1647],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/active'",1647],",",["T_WHITESPACE"," ",1647],["T_VARIABLE","$storeId",1647],")",";",["T_WHITESPACE","\n        ",1647],["T_VARIABLE","$minOrderMulti",1648],["T_WHITESPACE","  ",1648],"=",["T_WHITESPACE"," ",1648],["T_STRING","Mage",1648],["T_DOUBLE_COLON","::",1648],["T_STRING","getStoreConfigFlag",1648],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/multi_address'",1648],",",["T_WHITESPACE"," ",1648],["T_VARIABLE","$storeId",1648],")",";",["T_WHITESPACE","\n        ",1648],["T_VARIABLE","$minAmount",1649],["T_WHITESPACE","      ",1649],"=",["T_WHITESPACE"," ",1649],["T_STRING","Mage",1649],["T_DOUBLE_COLON","::",1649],["T_STRING","getStoreConfig",1649],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/minimum_order\/amount'",1649],",",["T_WHITESPACE"," ",1649],["T_VARIABLE","$storeId",1649],")",";",["T_WHITESPACE","\n\n        ",1649],["T_IF","if",1651],["T_WHITESPACE"," ",1651],"(","!",["T_VARIABLE","$minOrderActive",1651],")",["T_WHITESPACE"," ",1651],"{",["T_WHITESPACE","\n            ",1651],["T_RETURN","return",1652],["T_WHITESPACE"," ",1652],["T_STRING","true",1652],";",["T_WHITESPACE","\n        ",1652],"}",["T_WHITESPACE","\n\n        ",1653],["T_VARIABLE","$addresses",1655],["T_WHITESPACE"," ",1655],"=",["T_WHITESPACE"," ",1655],["T_VARIABLE","$this",1655],["T_OBJECT_OPERATOR","->",1655],["T_STRING","getAllAddresses",1655],"(",")",";",["T_WHITESPACE","\n\n        ",1655],["T_IF","if",1657],["T_WHITESPACE"," ",1657],"(",["T_VARIABLE","$multishipping",1657],")",["T_WHITESPACE"," ",1657],"{",["T_WHITESPACE","\n            ",1657],["T_IF","if",1658],["T_WHITESPACE"," ",1658],"(",["T_VARIABLE","$minOrderMulti",1658],")",["T_WHITESPACE"," ",1658],"{",["T_WHITESPACE","\n                ",1658],["T_FOREACH","foreach",1659],["T_WHITESPACE"," ",1659],"(",["T_VARIABLE","$addresses",1659],["T_WHITESPACE"," ",1659],["T_AS","as",1659],["T_WHITESPACE"," ",1659],["T_VARIABLE","$address",1659],")",["T_WHITESPACE"," ",1659],"{",["T_WHITESPACE","\n                    ",1659],["T_FOREACH","foreach",1660],["T_WHITESPACE"," ",1660],"(",["T_VARIABLE","$address",1660],["T_OBJECT_OPERATOR","->",1660],["T_STRING","getQuote",1660],"(",")",["T_OBJECT_OPERATOR","->",1660],["T_STRING","getItemsCollection",1660],"(",")",["T_WHITESPACE"," ",1660],["T_AS","as",1660],["T_WHITESPACE"," ",1660],["T_VARIABLE","$item",1660],")",["T_WHITESPACE"," ",1660],"{",["T_WHITESPACE","\n                        ",1660],["T_VARIABLE","$amount",1661],["T_WHITESPACE"," ",1661],"=",["T_WHITESPACE"," ",1661],["T_VARIABLE","$item",1661],["T_OBJECT_OPERATOR","->",1661],["T_STRING","getBaseRowTotal",1661],"(",")",["T_WHITESPACE"," ",1661],"-",["T_WHITESPACE"," ",1661],["T_VARIABLE","$item",1661],["T_OBJECT_OPERATOR","->",1661],["T_STRING","getBaseDiscountAmount",1661],"(",")",";",["T_WHITESPACE","\n                        ",1661],["T_IF","if",1662],["T_WHITESPACE"," ",1662],"(",["T_VARIABLE","$amount",1662],["T_WHITESPACE"," ",1662],"<",["T_WHITESPACE"," ",1662],["T_VARIABLE","$minAmount",1662],")",["T_WHITESPACE"," ",1662],"{",["T_WHITESPACE","\n                            ",1662],["T_RETURN","return",1663],["T_WHITESPACE"," ",1663],["T_STRING","false",1663],";",["T_WHITESPACE","\n                        ",1663],"}",["T_WHITESPACE","\n                    ",1664],"}",["T_WHITESPACE","\n                ",1665],"}",["T_WHITESPACE","\n            ",1666],"}",["T_WHITESPACE"," ",1667],["T_ELSE","else",1667],["T_WHITESPACE"," ",1667],"{",["T_WHITESPACE","\n                ",1667],["T_VARIABLE","$baseTotal",1668],["T_WHITESPACE"," ",1668],"=",["T_WHITESPACE"," ",1668],["T_LNUMBER","0",1668],";",["T_WHITESPACE","\n                ",1668],["T_FOREACH","foreach",1669],["T_WHITESPACE"," ",1669],"(",["T_VARIABLE","$addresses",1669],["T_WHITESPACE"," ",1669],["T_AS","as",1669],["T_WHITESPACE"," ",1669],["T_VARIABLE","$address",1669],")",["T_WHITESPACE"," ",1669],"{",["T_WHITESPACE","\n                    ",1669],["T_COMMENT","\/* @var $address Mage_Sales_Model_Quote_Address *\/",1670],["T_WHITESPACE","\n                    ",1670],["T_VARIABLE","$baseTotal",1671],["T_WHITESPACE"," ",1671],["T_PLUS_EQUAL","+=",1671],["T_WHITESPACE"," ",1671],["T_VARIABLE","$address",1671],["T_OBJECT_OPERATOR","->",1671],["T_STRING","getBaseSubtotalWithDiscount",1671],"(",")",";",["T_WHITESPACE","\n                ",1671],"}",["T_WHITESPACE","\n                ",1672],["T_IF","if",1673],["T_WHITESPACE"," ",1673],"(",["T_VARIABLE","$baseTotal",1673],["T_WHITESPACE"," ",1673],"<",["T_WHITESPACE"," ",1673],["T_VARIABLE","$minAmount",1673],")",["T_WHITESPACE"," ",1673],"{",["T_WHITESPACE","\n                    ",1673],["T_RETURN","return",1674],["T_WHITESPACE"," ",1674],["T_STRING","false",1674],";",["T_WHITESPACE","\n                ",1674],"}",["T_WHITESPACE","\n            ",1675],"}",["T_WHITESPACE","\n        ",1676],"}",["T_WHITESPACE"," ",1677],["T_ELSE","else",1677],["T_WHITESPACE"," ",1677],"{",["T_WHITESPACE","\n            ",1677],["T_FOREACH","foreach",1678],["T_WHITESPACE"," ",1678],"(",["T_VARIABLE","$addresses",1678],["T_WHITESPACE"," ",1678],["T_AS","as",1678],["T_WHITESPACE"," ",1678],["T_VARIABLE","$address",1678],")",["T_WHITESPACE"," ",1678],"{",["T_WHITESPACE","\n                ",1678],["T_COMMENT","\/* @var $address Mage_Sales_Model_Quote_Address *\/",1679],["T_WHITESPACE","\n                ",1679],["T_IF","if",1680],["T_WHITESPACE"," ",1680],"(","!",["T_VARIABLE","$address",1680],["T_OBJECT_OPERATOR","->",1680],["T_STRING","validateMinimumAmount",1680],"(",")",")",["T_WHITESPACE"," ",1680],"{",["T_WHITESPACE","\n                    ",1680],["T_RETURN","return",1681],["T_WHITESPACE"," ",1681],["T_STRING","false",1681],";",["T_WHITESPACE","\n                ",1681],"}",["T_WHITESPACE","\n            ",1682],"}",["T_WHITESPACE","\n        ",1683],"}",["T_WHITESPACE","\n        ",1684],["T_RETURN","return",1685],["T_WHITESPACE"," ",1685],["T_STRING","true",1685],";",["T_WHITESPACE","\n    ",1685],"}",["T_WHITESPACE","\n\n    ",1686],["T_DOC_COMMENT","\/**\n     * Check quote for virtual product only\n     *\n     * @return bool\n     *\/",1688],["T_WHITESPACE","\n    ",1692],["T_PUBLIC","public",1693],["T_WHITESPACE"," ",1693],["T_FUNCTION","function",1693],["T_WHITESPACE"," ",1693],["T_STRING","isVirtual",1693],"(",")",["T_WHITESPACE","\n    ",1693],"{",["T_WHITESPACE","\n        ",1694],["T_VARIABLE","$isVirtual",1695],["T_WHITESPACE"," ",1695],"=",["T_WHITESPACE"," ",1695],["T_STRING","true",1695],";",["T_WHITESPACE","\n        ",1695],["T_VARIABLE","$countItems",1696],["T_WHITESPACE"," ",1696],"=",["T_WHITESPACE"," ",1696],["T_LNUMBER","0",1696],";",["T_WHITESPACE","\n        ",1696],["T_FOREACH","foreach",1697],["T_WHITESPACE"," ",1697],"(",["T_VARIABLE","$this",1697],["T_OBJECT_OPERATOR","->",1697],["T_STRING","getItemsCollection",1697],"(",")",["T_WHITESPACE"," ",1697],["T_AS","as",1697],["T_WHITESPACE"," ",1697],["T_VARIABLE","$_item",1697],")",["T_WHITESPACE"," ",1697],"{",["T_WHITESPACE","\n            ",1697],["T_COMMENT","\/* @var $_item Mage_Sales_Model_Quote_Item *\/",1698],["T_WHITESPACE","\n            ",1698],["T_IF","if",1699],["T_WHITESPACE"," ",1699],"(",["T_VARIABLE","$_item",1699],["T_OBJECT_OPERATOR","->",1699],["T_STRING","isDeleted",1699],"(",")",["T_WHITESPACE"," ",1699],["T_BOOLEAN_OR","||",1699],["T_WHITESPACE"," ",1699],["T_VARIABLE","$_item",1699],["T_OBJECT_OPERATOR","->",1699],["T_STRING","getParentItemId",1699],"(",")",")",["T_WHITESPACE"," ",1699],"{",["T_WHITESPACE","\n                ",1699],["T_CONTINUE","continue",1700],";",["T_WHITESPACE","\n            ",1700],"}",["T_WHITESPACE","\n            ",1701],["T_VARIABLE","$countItems",1702],["T_WHITESPACE"," ",1702],["T_INC","++",1702],";",["T_WHITESPACE","\n            ",1702],["T_IF","if",1703],["T_WHITESPACE"," ",1703],"(","!",["T_VARIABLE","$_item",1703],["T_OBJECT_OPERATOR","->",1703],["T_STRING","getProduct",1703],"(",")",["T_OBJECT_OPERATOR","->",1703],["T_STRING","getIsVirtual",1703],"(",")",")",["T_WHITESPACE"," ",1703],"{",["T_WHITESPACE","\n                ",1703],["T_VARIABLE","$isVirtual",1704],["T_WHITESPACE"," ",1704],"=",["T_WHITESPACE"," ",1704],["T_STRING","false",1704],";",["T_WHITESPACE","\n                ",1704],["T_BREAK","break",1705],";",["T_WHITESPACE","\n            ",1705],"}",["T_WHITESPACE","\n        ",1706],"}",["T_WHITESPACE","\n        ",1707],["T_RETURN","return",1708],["T_WHITESPACE"," ",1708],["T_VARIABLE","$countItems",1708],["T_WHITESPACE"," ",1708],["T_IS_EQUAL","==",1708],["T_WHITESPACE"," ",1708],["T_LNUMBER","0",1708],["T_WHITESPACE"," ",1708],"?",["T_WHITESPACE"," ",1708],["T_STRING","false",1708],["T_WHITESPACE"," ",1708],":",["T_WHITESPACE"," ",1708],["T_VARIABLE","$isVirtual",1708],";",["T_WHITESPACE","\n    ",1708],"}",["T_WHITESPACE","\n\n    ",1709],["T_DOC_COMMENT","\/**\n     * Check quote for virtual product only\n     *\n     * @return bool\n     *\/",1711],["T_WHITESPACE","\n    ",1715],["T_PUBLIC","public",1716],["T_WHITESPACE"," ",1716],["T_FUNCTION","function",1716],["T_WHITESPACE"," ",1716],["T_STRING","getIsVirtual",1716],"(",")",["T_WHITESPACE","\n    ",1716],"{",["T_WHITESPACE","\n        ",1717],["T_RETURN","return",1718],["T_WHITESPACE"," ",1718],["T_STRING","intval",1718],"(",["T_VARIABLE","$this",1718],["T_OBJECT_OPERATOR","->",1718],["T_STRING","isVirtual",1718],"(",")",")",";",["T_WHITESPACE","\n    ",1718],"}",["T_WHITESPACE","\n\n    ",1719],["T_DOC_COMMENT","\/**\n     * Has a virtual products on quote\n     *\n     * @return bool\n     *\/",1721],["T_WHITESPACE","\n    ",1725],["T_PUBLIC","public",1726],["T_WHITESPACE"," ",1726],["T_FUNCTION","function",1726],["T_WHITESPACE"," ",1726],["T_STRING","hasVirtualItems",1726],"(",")",["T_WHITESPACE","\n    ",1726],"{",["T_WHITESPACE","\n        ",1727],["T_VARIABLE","$hasVirtual",1728],["T_WHITESPACE"," ",1728],"=",["T_WHITESPACE"," ",1728],["T_STRING","false",1728],";",["T_WHITESPACE","\n        ",1728],["T_FOREACH","foreach",1729],["T_WHITESPACE"," ",1729],"(",["T_VARIABLE","$this",1729],["T_OBJECT_OPERATOR","->",1729],["T_STRING","getItemsCollection",1729],"(",")",["T_WHITESPACE"," ",1729],["T_AS","as",1729],["T_WHITESPACE"," ",1729],["T_VARIABLE","$_item",1729],")",["T_WHITESPACE"," ",1729],"{",["T_WHITESPACE","\n            ",1729],["T_IF","if",1730],["T_WHITESPACE"," ",1730],"(",["T_VARIABLE","$_item",1730],["T_OBJECT_OPERATOR","->",1730],["T_STRING","getParentItemId",1730],"(",")",")",["T_WHITESPACE"," ",1730],"{",["T_WHITESPACE","\n                ",1730],["T_CONTINUE","continue",1731],";",["T_WHITESPACE","\n            ",1731],"}",["T_WHITESPACE","\n            ",1732],["T_IF","if",1733],["T_WHITESPACE"," ",1733],"(",["T_VARIABLE","$_item",1733],["T_OBJECT_OPERATOR","->",1733],["T_STRING","getProduct",1733],"(",")",["T_OBJECT_OPERATOR","->",1733],["T_STRING","isVirtual",1733],"(",")",")",["T_WHITESPACE"," ",1733],"{",["T_WHITESPACE","\n                ",1733],["T_VARIABLE","$hasVirtual",1734],["T_WHITESPACE"," ",1734],"=",["T_WHITESPACE"," ",1734],["T_STRING","true",1734],";",["T_WHITESPACE","\n            ",1734],"}",["T_WHITESPACE","\n        ",1735],"}",["T_WHITESPACE","\n        ",1736],["T_RETURN","return",1737],["T_WHITESPACE"," ",1737],["T_VARIABLE","$hasVirtual",1737],";",["T_WHITESPACE","\n    ",1737],"}",["T_WHITESPACE","\n\n    ",1738],["T_DOC_COMMENT","\/**\n     * Merge quotes\n     *\n     * @param   Mage_Sales_Model_Quote $quote\n     * @return  Mage_Sales_Model_Quote\n     *\/",1740],["T_WHITESPACE","\n    ",1745],["T_PUBLIC","public",1746],["T_WHITESPACE"," ",1746],["T_FUNCTION","function",1746],["T_WHITESPACE"," ",1746],["T_STRING","merge",1746],"(",["T_STRING","Mage_Sales_Model_Quote",1746],["T_WHITESPACE"," ",1746],["T_VARIABLE","$quote",1746],")",["T_WHITESPACE","\n    ",1746],"{",["T_WHITESPACE","\n        ",1747],["T_STRING","Mage",1748],["T_DOUBLE_COLON","::",1748],["T_STRING","dispatchEvent",1748],"(",["T_WHITESPACE","\n            ",1748],["T_VARIABLE","$this",1749],["T_OBJECT_OPERATOR","->",1749],["T_STRING","_eventPrefix",1749],["T_WHITESPACE"," ",1749],".",["T_WHITESPACE"," ",1749],["T_CONSTANT_ENCAPSED_STRING","'_merge_before'",1749],",",["T_WHITESPACE","\n            ",1749],["T_ARRAY","array",1750],"(",["T_WHITESPACE","\n                 ",1750],["T_VARIABLE","$this",1751],["T_OBJECT_OPERATOR","->",1751],["T_STRING","_eventObject",1751],["T_DOUBLE_ARROW","=>",1751],["T_VARIABLE","$this",1751],",",["T_WHITESPACE","\n                 ",1751],["T_CONSTANT_ENCAPSED_STRING","'source'",1752],["T_DOUBLE_ARROW","=>",1752],["T_VARIABLE","$quote",1752],["T_WHITESPACE","\n            ",1752],")",["T_WHITESPACE","\n        ",1753],")",";",["T_WHITESPACE","\n\n        ",1754],["T_FOREACH","foreach",1756],["T_WHITESPACE"," ",1756],"(",["T_VARIABLE","$quote",1756],["T_OBJECT_OPERATOR","->",1756],["T_STRING","getAllVisibleItems",1756],"(",")",["T_WHITESPACE"," ",1756],["T_AS","as",1756],["T_WHITESPACE"," ",1756],["T_VARIABLE","$item",1756],")",["T_WHITESPACE"," ",1756],"{",["T_WHITESPACE","\n            ",1756],["T_VARIABLE","$found",1757],["T_WHITESPACE"," ",1757],"=",["T_WHITESPACE"," ",1757],["T_STRING","false",1757],";",["T_WHITESPACE","\n            ",1757],["T_FOREACH","foreach",1758],["T_WHITESPACE"," ",1758],"(",["T_VARIABLE","$this",1758],["T_OBJECT_OPERATOR","->",1758],["T_STRING","getAllItems",1758],"(",")",["T_WHITESPACE"," ",1758],["T_AS","as",1758],["T_WHITESPACE"," ",1758],["T_VARIABLE","$quoteItem",1758],")",["T_WHITESPACE"," ",1758],"{",["T_WHITESPACE","\n                ",1758],["T_IF","if",1759],["T_WHITESPACE"," ",1759],"(",["T_VARIABLE","$quoteItem",1759],["T_OBJECT_OPERATOR","->",1759],["T_STRING","compare",1759],"(",["T_VARIABLE","$item",1759],")",")",["T_WHITESPACE"," ",1759],"{",["T_WHITESPACE","\n                    ",1759],["T_VARIABLE","$quoteItem",1760],["T_OBJECT_OPERATOR","->",1760],["T_STRING","setQty",1760],"(",["T_VARIABLE","$quoteItem",1760],["T_OBJECT_OPERATOR","->",1760],["T_STRING","getQty",1760],"(",")",["T_WHITESPACE"," ",1760],"+",["T_WHITESPACE"," ",1760],["T_VARIABLE","$item",1760],["T_OBJECT_OPERATOR","->",1760],["T_STRING","getQty",1760],"(",")",")",";",["T_WHITESPACE","\n                    ",1760],["T_VARIABLE","$found",1761],["T_WHITESPACE"," ",1761],"=",["T_WHITESPACE"," ",1761],["T_STRING","true",1761],";",["T_WHITESPACE","\n                    ",1761],["T_BREAK","break",1762],";",["T_WHITESPACE","\n                ",1762],"}",["T_WHITESPACE","\n            ",1763],"}",["T_WHITESPACE","\n\n            ",1764],["T_IF","if",1766],["T_WHITESPACE"," ",1766],"(","!",["T_VARIABLE","$found",1766],")",["T_WHITESPACE"," ",1766],"{",["T_WHITESPACE","\n                ",1766],["T_VARIABLE","$newItem",1767],["T_WHITESPACE"," ",1767],"=",["T_WHITESPACE"," ",1767],["T_CLONE","clone",1767],["T_WHITESPACE"," ",1767],["T_VARIABLE","$item",1767],";",["T_WHITESPACE","\n                ",1767],["T_VARIABLE","$this",1768],["T_OBJECT_OPERATOR","->",1768],["T_STRING","addItem",1768],"(",["T_VARIABLE","$newItem",1768],")",";",["T_WHITESPACE","\n                ",1768],["T_IF","if",1769],["T_WHITESPACE"," ",1769],"(",["T_VARIABLE","$item",1769],["T_OBJECT_OPERATOR","->",1769],["T_STRING","getHasChildren",1769],"(",")",")",["T_WHITESPACE"," ",1769],"{",["T_WHITESPACE","\n                    ",1769],["T_FOREACH","foreach",1770],["T_WHITESPACE"," ",1770],"(",["T_VARIABLE","$item",1770],["T_OBJECT_OPERATOR","->",1770],["T_STRING","getChildren",1770],"(",")",["T_WHITESPACE"," ",1770],["T_AS","as",1770],["T_WHITESPACE"," ",1770],["T_VARIABLE","$child",1770],")",["T_WHITESPACE"," ",1770],"{",["T_WHITESPACE","\n                        ",1770],["T_VARIABLE","$newChild",1771],["T_WHITESPACE"," ",1771],"=",["T_WHITESPACE"," ",1771],["T_CLONE","clone",1771],["T_WHITESPACE"," ",1771],["T_VARIABLE","$child",1771],";",["T_WHITESPACE","\n                        ",1771],["T_VARIABLE","$newChild",1772],["T_OBJECT_OPERATOR","->",1772],["T_STRING","setParentItem",1772],"(",["T_VARIABLE","$newItem",1772],")",";",["T_WHITESPACE","\n                        ",1772],["T_VARIABLE","$this",1773],["T_OBJECT_OPERATOR","->",1773],["T_STRING","addItem",1773],"(",["T_VARIABLE","$newChild",1773],")",";",["T_WHITESPACE","\n                    ",1773],"}",["T_WHITESPACE","\n                ",1774],"}",["T_WHITESPACE","\n            ",1775],"}",["T_WHITESPACE","\n        ",1776],"}",["T_WHITESPACE","\n\n        ",1777],["T_DOC_COMMENT","\/**\n         * Init shipping and billing address if quote is new\n         *\/",1779],["T_WHITESPACE","\n        ",1781],["T_IF","if",1782],["T_WHITESPACE"," ",1782],"(","!",["T_VARIABLE","$this",1782],["T_OBJECT_OPERATOR","->",1782],["T_STRING","getId",1782],"(",")",")",["T_WHITESPACE"," ",1782],"{",["T_WHITESPACE","\n            ",1782],["T_VARIABLE","$this",1783],["T_OBJECT_OPERATOR","->",1783],["T_STRING","getShippingAddress",1783],"(",")",";",["T_WHITESPACE","\n            ",1783],["T_VARIABLE","$this",1784],["T_OBJECT_OPERATOR","->",1784],["T_STRING","getBillingAddress",1784],"(",")",";",["T_WHITESPACE","\n        ",1784],"}",["T_WHITESPACE","\n\n        ",1785],["T_IF","if",1787],["T_WHITESPACE"," ",1787],"(",["T_VARIABLE","$quote",1787],["T_OBJECT_OPERATOR","->",1787],["T_STRING","getCouponCode",1787],"(",")",")",["T_WHITESPACE"," ",1787],"{",["T_WHITESPACE","\n            ",1787],["T_VARIABLE","$this",1788],["T_OBJECT_OPERATOR","->",1788],["T_STRING","setCouponCode",1788],"(",["T_VARIABLE","$quote",1788],["T_OBJECT_OPERATOR","->",1788],["T_STRING","getCouponCode",1788],"(",")",")",";",["T_WHITESPACE","\n        ",1788],"}",["T_WHITESPACE","\n\n        ",1789],["T_STRING","Mage",1791],["T_DOUBLE_COLON","::",1791],["T_STRING","dispatchEvent",1791],"(",["T_WHITESPACE","\n            ",1791],["T_VARIABLE","$this",1792],["T_OBJECT_OPERATOR","->",1792],["T_STRING","_eventPrefix",1792],["T_WHITESPACE"," ",1792],".",["T_WHITESPACE"," ",1792],["T_CONSTANT_ENCAPSED_STRING","'_merge_after'",1792],",",["T_WHITESPACE","\n            ",1792],["T_ARRAY","array",1793],"(",["T_WHITESPACE","\n                 ",1793],["T_VARIABLE","$this",1794],["T_OBJECT_OPERATOR","->",1794],["T_STRING","_eventObject",1794],["T_DOUBLE_ARROW","=>",1794],["T_VARIABLE","$this",1794],",",["T_WHITESPACE","\n                 ",1794],["T_CONSTANT_ENCAPSED_STRING","'source'",1795],["T_DOUBLE_ARROW","=>",1795],["T_VARIABLE","$quote",1795],["T_WHITESPACE","\n            ",1795],")",["T_WHITESPACE","\n        ",1796],")",";",["T_WHITESPACE","\n\n        ",1797],["T_RETURN","return",1799],["T_WHITESPACE"," ",1799],["T_VARIABLE","$this",1799],";",["T_WHITESPACE","\n    ",1799],"}",["T_WHITESPACE","\n\n    ",1800],["T_DOC_COMMENT","\/**\n     * Whether there are recurring items\n     *\n     * @return bool\n     *\/",1802],["T_WHITESPACE","\n    ",1806],["T_PUBLIC","public",1807],["T_WHITESPACE"," ",1807],["T_FUNCTION","function",1807],["T_WHITESPACE"," ",1807],["T_STRING","hasRecurringItems",1807],"(",")",["T_WHITESPACE","\n    ",1807],"{",["T_WHITESPACE","\n        ",1808],["T_FOREACH","foreach",1809],["T_WHITESPACE"," ",1809],"(",["T_VARIABLE","$this",1809],["T_OBJECT_OPERATOR","->",1809],["T_STRING","getAllVisibleItems",1809],"(",")",["T_WHITESPACE"," ",1809],["T_AS","as",1809],["T_WHITESPACE"," ",1809],["T_VARIABLE","$item",1809],")",["T_WHITESPACE"," ",1809],"{",["T_WHITESPACE","\n            ",1809],["T_IF","if",1810],["T_WHITESPACE"," ",1810],"(",["T_VARIABLE","$item",1810],["T_OBJECT_OPERATOR","->",1810],["T_STRING","getProduct",1810],"(",")",["T_WHITESPACE"," ",1810],["T_BOOLEAN_AND","&&",1810],["T_WHITESPACE"," ",1810],["T_VARIABLE","$item",1810],["T_OBJECT_OPERATOR","->",1810],["T_STRING","getProduct",1810],"(",")",["T_OBJECT_OPERATOR","->",1810],["T_STRING","isRecurring",1810],"(",")",")",["T_WHITESPACE"," ",1810],"{",["T_WHITESPACE","\n                ",1810],["T_RETURN","return",1811],["T_WHITESPACE"," ",1811],["T_STRING","true",1811],";",["T_WHITESPACE","\n            ",1811],"}",["T_WHITESPACE","\n        ",1812],"}",["T_WHITESPACE","\n        ",1813],["T_RETURN","return",1814],["T_WHITESPACE"," ",1814],["T_STRING","false",1814],";",["T_WHITESPACE","\n    ",1814],"}",["T_WHITESPACE","\n\n    ",1815],["T_DOC_COMMENT","\/**\n     * Getter whether quote has nominal items\n     * Can bypass treating virtual items as nominal\n     *\n     * @param bool $countVirtual\n     * @return bool\n     *\/",1817],["T_WHITESPACE","\n    ",1823],["T_PUBLIC","public",1824],["T_WHITESPACE"," ",1824],["T_FUNCTION","function",1824],["T_WHITESPACE"," ",1824],["T_STRING","hasNominalItems",1824],"(",["T_VARIABLE","$countVirtual",1824],["T_WHITESPACE"," ",1824],"=",["T_WHITESPACE"," ",1824],["T_STRING","true",1824],")",["T_WHITESPACE","\n    ",1824],"{",["T_WHITESPACE","\n        ",1825],["T_FOREACH","foreach",1826],["T_WHITESPACE"," ",1826],"(",["T_VARIABLE","$this",1826],["T_OBJECT_OPERATOR","->",1826],["T_STRING","getAllVisibleItems",1826],"(",")",["T_WHITESPACE"," ",1826],["T_AS","as",1826],["T_WHITESPACE"," ",1826],["T_VARIABLE","$item",1826],")",["T_WHITESPACE"," ",1826],"{",["T_WHITESPACE","\n            ",1826],["T_IF","if",1827],["T_WHITESPACE"," ",1827],"(",["T_VARIABLE","$item",1827],["T_OBJECT_OPERATOR","->",1827],["T_STRING","isNominal",1827],"(",")",")",["T_WHITESPACE"," ",1827],"{",["T_WHITESPACE","\n                ",1827],["T_IF","if",1828],["T_WHITESPACE"," ",1828],"(","(","!",["T_VARIABLE","$countVirtual",1828],")",["T_WHITESPACE"," ",1828],["T_BOOLEAN_AND","&&",1828],["T_WHITESPACE"," ",1828],["T_VARIABLE","$item",1828],["T_OBJECT_OPERATOR","->",1828],["T_STRING","getProduct",1828],"(",")",["T_OBJECT_OPERATOR","->",1828],["T_STRING","isVirtual",1828],"(",")",")",["T_WHITESPACE"," ",1828],"{",["T_WHITESPACE","\n                    ",1828],["T_CONTINUE","continue",1829],";",["T_WHITESPACE","\n                ",1829],"}",["T_WHITESPACE","\n                ",1830],["T_RETURN","return",1831],["T_WHITESPACE"," ",1831],["T_STRING","true",1831],";",["T_WHITESPACE","\n            ",1831],"}",["T_WHITESPACE","\n        ",1832],"}",["T_WHITESPACE","\n        ",1833],["T_RETURN","return",1834],["T_WHITESPACE"," ",1834],["T_STRING","false",1834],";",["T_WHITESPACE","\n    ",1834],"}",["T_WHITESPACE","\n\n    ",1835],["T_DOC_COMMENT","\/**\n     * Whether quote has nominal items only\n     *\n     * @return bool\n     *\/",1837],["T_WHITESPACE","\n    ",1841],["T_PUBLIC","public",1842],["T_WHITESPACE"," ",1842],["T_FUNCTION","function",1842],["T_WHITESPACE"," ",1842],["T_STRING","isNominal",1842],"(",")",["T_WHITESPACE","\n    ",1842],"{",["T_WHITESPACE","\n        ",1843],["T_FOREACH","foreach",1844],["T_WHITESPACE"," ",1844],"(",["T_VARIABLE","$this",1844],["T_OBJECT_OPERATOR","->",1844],["T_STRING","getAllVisibleItems",1844],"(",")",["T_WHITESPACE"," ",1844],["T_AS","as",1844],["T_WHITESPACE"," ",1844],["T_VARIABLE","$item",1844],")",["T_WHITESPACE"," ",1844],"{",["T_WHITESPACE","\n            ",1844],["T_IF","if",1845],["T_WHITESPACE"," ",1845],"(","!",["T_VARIABLE","$item",1845],["T_OBJECT_OPERATOR","->",1845],["T_STRING","isNominal",1845],"(",")",")",["T_WHITESPACE"," ",1845],"{",["T_WHITESPACE","\n                ",1845],["T_RETURN","return",1846],["T_WHITESPACE"," ",1846],["T_STRING","false",1846],";",["T_WHITESPACE","\n            ",1846],"}",["T_WHITESPACE","\n        ",1847],"}",["T_WHITESPACE","\n        ",1848],["T_RETURN","return",1849],["T_WHITESPACE"," ",1849],["T_STRING","true",1849],";",["T_WHITESPACE","\n    ",1849],"}",["T_WHITESPACE","\n\n    ",1850],["T_DOC_COMMENT","\/**\n     * Create recurring payment profiles basing on the current items\n     *\n     * @return array\n     *\/",1852],["T_WHITESPACE","\n    ",1856],["T_PUBLIC","public",1857],["T_WHITESPACE"," ",1857],["T_FUNCTION","function",1857],["T_WHITESPACE"," ",1857],["T_STRING","prepareRecurringPaymentProfiles",1857],"(",")",["T_WHITESPACE","\n    ",1857],"{",["T_WHITESPACE","\n        ",1858],["T_IF","if",1859],["T_WHITESPACE"," ",1859],"(","!",["T_VARIABLE","$this",1859],["T_OBJECT_OPERATOR","->",1859],["T_STRING","getTotalsCollectedFlag",1859],"(",")",")",["T_WHITESPACE"," ",1859],"{",["T_WHITESPACE","\n            ",1859],["T_COMMENT","\/\/ Whoops! Make sure nominal totals must be calculated here.\n",1860],["T_WHITESPACE","            ",1861],["T_THROW","throw",1861],["T_WHITESPACE"," ",1861],["T_NEW","new",1861],["T_WHITESPACE"," ",1861],["T_STRING","Exception",1861],"(",["T_CONSTANT_ENCAPSED_STRING","'Quote totals must be collected before this operation.'",1861],")",";",["T_WHITESPACE","\n        ",1861],"}",["T_WHITESPACE","\n\n        ",1862],["T_VARIABLE","$result",1864],["T_WHITESPACE"," ",1864],"=",["T_WHITESPACE"," ",1864],["T_ARRAY","array",1864],"(",")",";",["T_WHITESPACE","\n        ",1864],["T_FOREACH","foreach",1865],["T_WHITESPACE"," ",1865],"(",["T_VARIABLE","$this",1865],["T_OBJECT_OPERATOR","->",1865],["T_STRING","getAllVisibleItems",1865],"(",")",["T_WHITESPACE"," ",1865],["T_AS","as",1865],["T_WHITESPACE"," ",1865],["T_VARIABLE","$item",1865],")",["T_WHITESPACE"," ",1865],"{",["T_WHITESPACE","\n            ",1865],["T_VARIABLE","$product",1866],["T_WHITESPACE"," ",1866],"=",["T_WHITESPACE"," ",1866],["T_VARIABLE","$item",1866],["T_OBJECT_OPERATOR","->",1866],["T_STRING","getProduct",1866],"(",")",";",["T_WHITESPACE","\n            ",1866],["T_IF","if",1867],["T_WHITESPACE"," ",1867],"(",["T_STRING","is_object",1867],"(",["T_VARIABLE","$product",1867],")",["T_WHITESPACE"," ",1867],["T_BOOLEAN_AND","&&",1867],["T_WHITESPACE"," ",1867],"(",["T_VARIABLE","$product",1867],["T_OBJECT_OPERATOR","->",1867],["T_STRING","isRecurring",1867],"(",")",")",["T_WHITESPACE","\n                ",1867],["T_BOOLEAN_AND","&&",1868],["T_WHITESPACE"," ",1868],["T_VARIABLE","$profile",1868],["T_WHITESPACE"," ",1868],"=",["T_WHITESPACE"," ",1868],["T_STRING","Mage",1868],["T_DOUBLE_COLON","::",1868],["T_STRING","getModel",1868],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/recurring_profile'",1868],")",["T_OBJECT_OPERATOR","->",1868],["T_STRING","importProduct",1868],"(",["T_VARIABLE","$product",1868],")",["T_WHITESPACE","\n            ",1868],")",["T_WHITESPACE"," ",1869],"{",["T_WHITESPACE","\n                ",1869],["T_VARIABLE","$profile",1870],["T_OBJECT_OPERATOR","->",1870],["T_STRING","importQuote",1870],"(",["T_VARIABLE","$this",1870],")",";",["T_WHITESPACE","\n                ",1870],["T_VARIABLE","$profile",1871],["T_OBJECT_OPERATOR","->",1871],["T_STRING","importQuoteItem",1871],"(",["T_VARIABLE","$item",1871],")",";",["T_WHITESPACE","\n                ",1871],["T_VARIABLE","$result",1872],"[","]",["T_WHITESPACE"," ",1872],"=",["T_WHITESPACE"," ",1872],["T_VARIABLE","$profile",1872],";",["T_WHITESPACE","\n            ",1872],"}",["T_WHITESPACE","\n        ",1873],"}",["T_WHITESPACE","\n        ",1874],["T_RETURN","return",1875],["T_WHITESPACE"," ",1875],["T_VARIABLE","$result",1875],";",["T_WHITESPACE","\n    ",1875],"}",["T_WHITESPACE","\n\n    ",1876],["T_PROTECTED","protected",1878],["T_WHITESPACE"," ",1878],["T_FUNCTION","function",1878],["T_WHITESPACE"," ",1878],["T_STRING","_validateCouponCode",1878],"(",")",["T_WHITESPACE","\n    ",1878],"{",["T_WHITESPACE","\n        ",1879],["T_VARIABLE","$code",1880],["T_WHITESPACE"," ",1880],"=",["T_WHITESPACE"," ",1880],["T_VARIABLE","$this",1880],["T_OBJECT_OPERATOR","->",1880],["T_STRING","_getData",1880],"(",["T_CONSTANT_ENCAPSED_STRING","'coupon_code'",1880],")",";",["T_WHITESPACE","\n        ",1880],["T_IF","if",1881],["T_WHITESPACE"," ",1881],"(",["T_STRING","strlen",1881],"(",["T_VARIABLE","$code",1881],")",")",["T_WHITESPACE"," ",1881],"{",["T_WHITESPACE","\n            ",1881],["T_VARIABLE","$addressHasCoupon",1882],["T_WHITESPACE"," ",1882],"=",["T_WHITESPACE"," ",1882],["T_STRING","false",1882],";",["T_WHITESPACE","\n            ",1882],["T_VARIABLE","$addresses",1883],["T_WHITESPACE"," ",1883],"=",["T_WHITESPACE"," ",1883],["T_VARIABLE","$this",1883],["T_OBJECT_OPERATOR","->",1883],["T_STRING","getAllAddresses",1883],"(",")",";",["T_WHITESPACE","\n            ",1883],["T_IF","if",1884],["T_WHITESPACE"," ",1884],"(",["T_STRING","count",1884],"(",["T_VARIABLE","$addresses",1884],")",">",["T_LNUMBER","0",1884],")",["T_WHITESPACE"," ",1884],"{",["T_WHITESPACE","\n                ",1884],["T_FOREACH","foreach",1885],["T_WHITESPACE"," ",1885],"(",["T_VARIABLE","$addresses",1885],["T_WHITESPACE"," ",1885],["T_AS","as",1885],["T_WHITESPACE"," ",1885],["T_VARIABLE","$address",1885],")",["T_WHITESPACE"," ",1885],"{",["T_WHITESPACE","\n                    ",1885],["T_IF","if",1886],["T_WHITESPACE"," ",1886],"(",["T_VARIABLE","$address",1886],["T_OBJECT_OPERATOR","->",1886],["T_STRING","hasCouponCode",1886],"(",")",")",["T_WHITESPACE"," ",1886],"{",["T_WHITESPACE","\n                        ",1886],["T_VARIABLE","$addressHasCoupon",1887],["T_WHITESPACE"," ",1887],"=",["T_WHITESPACE"," ",1887],["T_STRING","true",1887],";",["T_WHITESPACE","\n                    ",1887],"}",["T_WHITESPACE","\n                ",1888],"}",["T_WHITESPACE","\n                ",1889],["T_IF","if",1890],["T_WHITESPACE"," ",1890],"(","!",["T_VARIABLE","$addressHasCoupon",1890],")",["T_WHITESPACE"," ",1890],"{",["T_WHITESPACE","\n                    ",1890],["T_VARIABLE","$this",1891],["T_OBJECT_OPERATOR","->",1891],["T_STRING","setCouponCode",1891],"(",["T_CONSTANT_ENCAPSED_STRING","''",1891],")",";",["T_WHITESPACE","\n                ",1891],"}",["T_WHITESPACE","\n            ",1892],"}",["T_WHITESPACE","\n        ",1893],"}",["T_WHITESPACE","\n        ",1894],["T_RETURN","return",1895],["T_WHITESPACE"," ",1895],["T_VARIABLE","$this",1895],";",["T_WHITESPACE","\n    ",1895],"}",["T_WHITESPACE","\n\n    ",1896],["T_DOC_COMMENT","\/**\n     * Trigger collect totals after loading, if required\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",1898],["T_WHITESPACE","\n    ",1902],["T_PROTECTED","protected",1903],["T_WHITESPACE"," ",1903],["T_FUNCTION","function",1903],["T_WHITESPACE"," ",1903],["T_STRING","_afterLoad",1903],"(",")",["T_WHITESPACE","\n    ",1903],"{",["T_WHITESPACE","\n        ",1904],["T_COMMENT","\/\/ collect totals and save me, if required\n",1905],["T_WHITESPACE","        ",1906],["T_IF","if",1906],["T_WHITESPACE"," ",1906],"(",["T_LNUMBER","1",1906],["T_WHITESPACE"," ",1906],["T_IS_EQUAL","==",1906],["T_WHITESPACE"," ",1906],["T_VARIABLE","$this",1906],["T_OBJECT_OPERATOR","->",1906],["T_STRING","getData",1906],"(",["T_CONSTANT_ENCAPSED_STRING","'trigger_recollect'",1906],")",")",["T_WHITESPACE"," ",1906],"{",["T_WHITESPACE","\n            ",1906],["T_VARIABLE","$this",1907],["T_OBJECT_OPERATOR","->",1907],["T_STRING","collectTotals",1907],"(",")",["T_OBJECT_OPERATOR","->",1907],["T_STRING","save",1907],"(",")",";",["T_WHITESPACE","\n        ",1907],"}",["T_WHITESPACE","\n        ",1908],["T_RETURN","return",1909],["T_WHITESPACE"," ",1909],["T_STRING","parent",1909],["T_DOUBLE_COLON","::",1909],["T_STRING","_afterLoad",1909],"(",")",";",["T_WHITESPACE","\n    ",1909],"}",["T_WHITESPACE","\n\n    ",1910],["T_DOC_COMMENT","\/**\n     * @deprecated after 1.4 beta1 - one page checkout responsibility\n     *\/",1912],["T_WHITESPACE","\n    ",1914],["T_CONST","const",1915],["T_WHITESPACE"," ",1915],["T_STRING","CHECKOUT_METHOD_REGISTER",1915],["T_WHITESPACE","  ",1915],"=",["T_WHITESPACE"," ",1915],["T_CONSTANT_ENCAPSED_STRING","'register'",1915],";",["T_WHITESPACE","\n    ",1915],["T_CONST","const",1916],["T_WHITESPACE"," ",1916],["T_STRING","CHECKOUT_METHOD_GUEST",1916],["T_WHITESPACE","     ",1916],"=",["T_WHITESPACE"," ",1916],["T_CONSTANT_ENCAPSED_STRING","'guest'",1916],";",["T_WHITESPACE","\n    ",1916],["T_CONST","const",1917],["T_WHITESPACE"," ",1917],["T_STRING","CHECKOUT_METHOD_LOGIN_IN",1917],["T_WHITESPACE","  ",1917],"=",["T_WHITESPACE"," ",1917],["T_CONSTANT_ENCAPSED_STRING","'login_in'",1917],";",["T_WHITESPACE","\n\n    ",1917],["T_DOC_COMMENT","\/**\n     * Return quote checkout method code\n     *\n     * @deprecated after 1.4 beta1 it is checkout module responsibility\n     * @param boolean $originalMethod if true return defined method from begining\n     * @return string\n     *\/",1919],["T_WHITESPACE","\n    ",1925],["T_PUBLIC","public",1926],["T_WHITESPACE"," ",1926],["T_FUNCTION","function",1926],["T_WHITESPACE"," ",1926],["T_STRING","getCheckoutMethod",1926],"(",["T_VARIABLE","$originalMethod",1926],["T_WHITESPACE"," ",1926],"=",["T_WHITESPACE"," ",1926],["T_STRING","false",1926],")",["T_WHITESPACE","\n    ",1926],"{",["T_WHITESPACE","\n        ",1927],["T_IF","if",1928],["T_WHITESPACE"," ",1928],"(",["T_VARIABLE","$this",1928],["T_OBJECT_OPERATOR","->",1928],["T_STRING","getCustomerId",1928],"(",")",["T_WHITESPACE"," ",1928],["T_BOOLEAN_AND","&&",1928],["T_WHITESPACE"," ",1928],"!",["T_VARIABLE","$originalMethod",1928],")",["T_WHITESPACE"," ",1928],"{",["T_WHITESPACE","\n            ",1928],["T_RETURN","return",1929],["T_WHITESPACE"," ",1929],["T_STRING","self",1929],["T_DOUBLE_COLON","::",1929],["T_STRING","CHECKOUT_METHOD_LOGIN_IN",1929],";",["T_WHITESPACE","\n        ",1929],"}",["T_WHITESPACE","\n        ",1930],["T_RETURN","return",1931],["T_WHITESPACE"," ",1931],["T_VARIABLE","$this",1931],["T_OBJECT_OPERATOR","->",1931],["T_STRING","_getData",1931],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout_method'",1931],")",";",["T_WHITESPACE","\n    ",1931],"}",["T_WHITESPACE","\n\n    ",1932],["T_DOC_COMMENT","\/**\n     * Check is allow Guest Checkout\n     *\n     * @deprecated after 1.4 beta1 it is checkout module responsibility\n     * @return bool\n     *\/",1934],["T_WHITESPACE","\n    ",1939],["T_PUBLIC","public",1940],["T_WHITESPACE"," ",1940],["T_FUNCTION","function",1940],["T_WHITESPACE"," ",1940],["T_STRING","isAllowedGuestCheckout",1940],"(",")",["T_WHITESPACE","\n    ",1940],"{",["T_WHITESPACE","\n        ",1941],["T_RETURN","return",1942],["T_WHITESPACE"," ",1942],["T_STRING","Mage",1942],["T_DOUBLE_COLON","::",1942],["T_STRING","helper",1942],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout'",1942],")",["T_OBJECT_OPERATOR","->",1942],["T_STRING","isAllowedGuestCheckout",1942],"(",["T_VARIABLE","$this",1942],",",["T_WHITESPACE"," ",1942],["T_VARIABLE","$this",1942],["T_OBJECT_OPERATOR","->",1942],["T_STRING","getStoreId",1942],"(",")",")",";",["T_WHITESPACE","\n    ",1942],"}",["T_WHITESPACE","\n\n    ",1943],["T_DOC_COMMENT","\/**\n     * Prevent quote from saving\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",1945],["T_WHITESPACE","\n    ",1949],["T_PUBLIC","public",1950],["T_WHITESPACE"," ",1950],["T_FUNCTION","function",1950],["T_WHITESPACE"," ",1950],["T_STRING","preventSaving",1950],"(",")",["T_WHITESPACE","\n    ",1950],"{",["T_WHITESPACE","\n        ",1951],["T_VARIABLE","$this",1952],["T_OBJECT_OPERATOR","->",1952],["T_STRING","_preventSaving",1952],["T_WHITESPACE"," ",1952],"=",["T_WHITESPACE"," ",1952],["T_STRING","true",1952],";",["T_WHITESPACE","\n        ",1952],["T_RETURN","return",1953],["T_WHITESPACE"," ",1953],["T_VARIABLE","$this",1953],";",["T_WHITESPACE","\n    ",1953],"}",["T_WHITESPACE","\n\n    ",1954],["T_DOC_COMMENT","\/**\n     * Save quote with prevention checking\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",1956],["T_WHITESPACE","\n    ",1960],["T_PUBLIC","public",1961],["T_WHITESPACE"," ",1961],["T_FUNCTION","function",1961],["T_WHITESPACE"," ",1961],["T_STRING","save",1961],"(",")",["T_WHITESPACE","\n    ",1961],"{",["T_WHITESPACE","\n        ",1962],["T_IF","if",1963],["T_WHITESPACE"," ",1963],"(",["T_VARIABLE","$this",1963],["T_OBJECT_OPERATOR","->",1963],["T_STRING","_preventSaving",1963],")",["T_WHITESPACE"," ",1963],"{",["T_WHITESPACE","\n            ",1963],["T_RETURN","return",1964],["T_WHITESPACE"," ",1964],["T_VARIABLE","$this",1964],";",["T_WHITESPACE","\n        ",1964],"}",["T_WHITESPACE","\n        ",1965],["T_RETURN","return",1966],["T_WHITESPACE"," ",1966],["T_STRING","parent",1966],["T_DOUBLE_COLON","::",1966],["T_STRING","save",1966],"(",")",";",["T_WHITESPACE","\n    ",1966],"}",["T_WHITESPACE","\n",1967],"}",["T_WHITESPACE","\n",1968]]