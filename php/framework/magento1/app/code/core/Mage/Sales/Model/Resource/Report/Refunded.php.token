[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Refund report resource model\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Report_Refunded",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Report_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Model initialization\n     *\n     *\/",37],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_setResource",43],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Aggregate Refunded data\n     *\n     * @param mixed $from\n     * @param mixed $to\n     * @return Mage_Sales_Model_Resource_Report_Refunded\n     *\/",46],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","aggregate",53],"(",["T_VARIABLE","$from",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","null",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$to",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","null",53],")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_COMMENT","\/\/ convert input dates to UTC to be comparable with DATETIME fields in DB\n",55],["T_WHITESPACE","        ",56],["T_VARIABLE","$from",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_dateToUtc",56],"(",["T_VARIABLE","$from",56],")",";",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$to",57],["T_WHITESPACE","   ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_dateToUtc",57],"(",["T_VARIABLE","$to",57],")",";",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","_checkDates",59],"(",["T_VARIABLE","$from",59],",",["T_WHITESPACE"," ",59],["T_VARIABLE","$to",59],")",";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_aggregateByOrderCreatedAt",60],"(",["T_VARIABLE","$from",60],",",["T_WHITESPACE"," ",60],["T_VARIABLE","$to",60],")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_aggregateByRefundCreatedAt",61],"(",["T_VARIABLE","$from",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$to",61],")",";",["T_WHITESPACE","\n\n        ",61],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","_setFlagData",63],"(",["T_STRING","Mage_Reports_Model_Flag",63],["T_DOUBLE_COLON","::",63],["T_STRING","REPORT_REFUNDED_FLAG_CODE",63],")",";",["T_WHITESPACE","\n        ",63],["T_RETURN","return",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Aggregate refunded data by order created at as period\n     *\n     * @param mixed $from\n     * @param mixed $to\n     * @return Mage_Sales_Model_Resource_Report_Refunded\n     *\/",67],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","_aggregateByOrderCreatedAt",74],"(",["T_VARIABLE","$from",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$to",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$table",76],["T_WHITESPACE","       ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getTable",76],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/refunded_aggregated_order'",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$sourceTable",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getTable",77],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",77],")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$adapter",78],["T_WHITESPACE","     ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getWriteAdapter",78],"(",")",";",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$adapter",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","beginTransaction",79],"(",")",";",["T_WHITESPACE","\n\n        ",79],["T_TRY","try",81],["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_IF","if",82],["T_WHITESPACE"," ",82],"(",["T_VARIABLE","$from",82],["T_WHITESPACE"," ",82],["T_IS_NOT_IDENTICAL","!==",82],["T_WHITESPACE"," ",82],["T_STRING","null",82],["T_WHITESPACE"," ",82],["T_BOOLEAN_OR","||",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$to",82],["T_WHITESPACE"," ",82],["T_IS_NOT_IDENTICAL","!==",82],["T_WHITESPACE"," ",82],["T_STRING","null",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n                ",82],["T_VARIABLE","$subSelect",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_getTableDateRangeSelect",83],"(",["T_VARIABLE","$sourceTable",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'created_at'",83],",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$from",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$to",83],")",";",["T_WHITESPACE","\n            ",83],"}",["T_WHITESPACE"," ",84],["T_ELSE","else",84],["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n                ",84],["T_VARIABLE","$subSelect",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","null",85],";",["T_WHITESPACE","\n            ",85],"}",["T_WHITESPACE","\n\n            ",86],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_clearTableByDateRange",88],"(",["T_VARIABLE","$table",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$from",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$to",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$subSelect",88],")",";",["T_WHITESPACE","\n            ",88],["T_COMMENT","\/\/ convert dates from UTC to current admin timezone\n",89],["T_WHITESPACE","            ",90],["T_VARIABLE","$periodExpr",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$adapter",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getDatePartSql",90],"(",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getStoreTZOffsetQuery",91],"(",["T_VARIABLE","$sourceTable",91],",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'created_at'",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$from",91],",",["T_WHITESPACE"," ",91],["T_VARIABLE","$to",91],")",["T_WHITESPACE","\n            ",91],")",";",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$columns",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_ARRAY","array",93],"(",["T_WHITESPACE","\n                ",93],["T_CONSTANT_ENCAPSED_STRING","'period'",94],["T_WHITESPACE","            ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$periodExpr",94],",",["T_WHITESPACE","\n                ",94],["T_CONSTANT_ENCAPSED_STRING","'store_id'",95],["T_WHITESPACE","          ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'store_id'",95],",",["T_WHITESPACE","\n                ",95],["T_CONSTANT_ENCAPSED_STRING","'order_status'",96],["T_WHITESPACE","      ",96],["T_DOUBLE_ARROW","=>",96],["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'status'",96],",",["T_WHITESPACE","\n                ",96],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",97],["T_WHITESPACE","      ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_NEW","new",97],["T_WHITESPACE"," ",97],["T_STRING","Zend_Db_Expr",97],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(total_refunded)'",97],")",",",["T_WHITESPACE","\n                ",97],["T_CONSTANT_ENCAPSED_STRING","'refunded'",98],["T_WHITESPACE","          ",98],["T_DOUBLE_ARROW","=>",98],["T_WHITESPACE"," ",98],["T_NEW","new",98],["T_WHITESPACE"," ",98],["T_STRING","Zend_Db_Expr",98],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(base_total_refunded * base_to_global_rate)'",98],")",",",["T_WHITESPACE","\n                ",98],["T_CONSTANT_ENCAPSED_STRING","'online_refunded'",99],["T_WHITESPACE","   ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_NEW","new",99],["T_WHITESPACE"," ",99],["T_STRING","Zend_Db_Expr",99],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(base_total_online_refunded * base_to_global_rate)'",99],")",",",["T_WHITESPACE","\n                ",99],["T_CONSTANT_ENCAPSED_STRING","'offline_refunded'",100],["T_WHITESPACE","  ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_NEW","new",100],["T_WHITESPACE"," ",100],["T_STRING","Zend_Db_Expr",100],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(base_total_offline_refunded * base_to_global_rate)'",100],")",["T_WHITESPACE","\n            ",100],")",";",["T_WHITESPACE","\n\n            ",101],["T_VARIABLE","$select",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$adapter",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","select",103],"(",")",";",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$select",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","from",104],"(",["T_VARIABLE","$sourceTable",104],",",["T_WHITESPACE"," ",104],["T_VARIABLE","$columns",104],")",["T_WHITESPACE","\n                ",104],["T_OBJECT_OPERATOR","->",105],["T_STRING","where",105],"(",["T_CONSTANT_ENCAPSED_STRING","'state != ?'",105],",",["T_WHITESPACE"," ",105],["T_STRING","Mage_Sales_Model_Order",105],["T_DOUBLE_COLON","::",105],["T_STRING","STATE_CANCELED",105],")",["T_WHITESPACE","\n                ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","where",106],"(",["T_CONSTANT_ENCAPSED_STRING","'base_total_refunded > ?'",106],",",["T_WHITESPACE"," ",106],["T_LNUMBER","0",106],")",";",["T_WHITESPACE","\n\n            ",106],["T_IF","if",108],["T_WHITESPACE"," ",108],"(",["T_VARIABLE","$subSelect",108],["T_WHITESPACE"," ",108],["T_IS_NOT_IDENTICAL","!==",108],["T_WHITESPACE"," ",108],["T_STRING","null",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n                ",108],["T_VARIABLE","$select",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","having",109],"(",["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_makeConditionFromDateRangeSelect",109],"(",["T_VARIABLE","$subSelect",109],",",["T_WHITESPACE"," ",109],["T_CONSTANT_ENCAPSED_STRING","'period'",109],")",")",";",["T_WHITESPACE","\n            ",109],"}",["T_WHITESPACE","\n\n            ",110],["T_VARIABLE","$select",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","group",112],"(",["T_ARRAY","array",112],"(",["T_WHITESPACE","\n                ",112],["T_VARIABLE","$periodExpr",113],",",["T_WHITESPACE","\n                ",113],["T_CONSTANT_ENCAPSED_STRING","'store_id'",114],",",["T_WHITESPACE","\n                ",114],["T_CONSTANT_ENCAPSED_STRING","'status'",115],["T_WHITESPACE","\n            ",115],")",")",";",["T_WHITESPACE","\n\n            ",116],["T_VARIABLE","$select",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","having",118],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_count > 0'",118],")",";",["T_WHITESPACE","\n\n            ",118],["T_VARIABLE","$helper",120],["T_WHITESPACE","      ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","Mage",120],["T_DOUBLE_COLON","::",120],["T_STRING","getResourceHelper",120],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",120],")",";",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$insertQuery",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$helper",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getInsertFromSelectUsingAnalytic",121],"(",["T_VARIABLE","$select",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$table",121],",",["T_WHITESPACE"," ",121],["T_STRING","array_keys",121],"(",["T_VARIABLE","$columns",121],")",")",";",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$adapter",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","query",122],"(",["T_VARIABLE","$insertQuery",122],")",";",["T_WHITESPACE","\n\n            ",122],["T_VARIABLE","$select",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","reset",124],"(",")",";",["T_WHITESPACE","\n\n            ",124],["T_VARIABLE","$columns",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_ARRAY","array",126],"(",["T_WHITESPACE","\n                ",126],["T_CONSTANT_ENCAPSED_STRING","'period'",127],["T_WHITESPACE","            ",127],["T_DOUBLE_ARROW","=>",127],["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","'period'",127],",",["T_WHITESPACE","\n                ",127],["T_CONSTANT_ENCAPSED_STRING","'store_id'",128],["T_WHITESPACE","          ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_NEW","new",128],["T_WHITESPACE"," ",128],["T_STRING","Zend_Db_Expr",128],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",128],")",",",["T_WHITESPACE","\n                ",128],["T_CONSTANT_ENCAPSED_STRING","'order_status'",129],["T_WHITESPACE","      ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'order_status'",129],",",["T_WHITESPACE","\n                ",129],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",130],["T_WHITESPACE","      ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_NEW","new",130],["T_WHITESPACE"," ",130],["T_STRING","Zend_Db_Expr",130],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(orders_count)'",130],")",",",["T_WHITESPACE","\n                ",130],["T_CONSTANT_ENCAPSED_STRING","'refunded'",131],["T_WHITESPACE","          ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_NEW","new",131],["T_WHITESPACE"," ",131],["T_STRING","Zend_Db_Expr",131],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(refunded)'",131],")",",",["T_WHITESPACE","\n                ",131],["T_CONSTANT_ENCAPSED_STRING","'online_refunded'",132],["T_WHITESPACE","   ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_NEW","new",132],["T_WHITESPACE"," ",132],["T_STRING","Zend_Db_Expr",132],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(online_refunded)'",132],")",",",["T_WHITESPACE","\n                ",132],["T_CONSTANT_ENCAPSED_STRING","'offline_refunded'",133],["T_WHITESPACE","  ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_NEW","new",133],["T_WHITESPACE"," ",133],["T_STRING","Zend_Db_Expr",133],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(offline_refunded)'",133],")",["T_WHITESPACE","\n            ",133],")",";",["T_WHITESPACE","\n\n            ",134],["T_VARIABLE","$select",136],["T_WHITESPACE","\n                ",136],["T_OBJECT_OPERATOR","->",137],["T_STRING","from",137],"(",["T_VARIABLE","$table",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$columns",137],")",["T_WHITESPACE","\n                ",137],["T_OBJECT_OPERATOR","->",138],["T_STRING","where",138],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id != ?'",138],",",["T_WHITESPACE"," ",138],["T_LNUMBER","0",138],")",";",["T_WHITESPACE","\n\n            ",138],["T_IF","if",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$subSelect",140],["T_WHITESPACE"," ",140],["T_IS_NOT_IDENTICAL","!==",140],["T_WHITESPACE"," ",140],["T_STRING","null",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$select",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","where",141],"(",["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_makeConditionFromDateRangeSelect",141],"(",["T_VARIABLE","$subSelect",141],",",["T_WHITESPACE"," ",141],["T_CONSTANT_ENCAPSED_STRING","'period'",141],")",")",";",["T_WHITESPACE","\n            ",141],"}",["T_WHITESPACE","\n\n            ",142],["T_VARIABLE","$select",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","group",144],"(",["T_ARRAY","array",144],"(",["T_WHITESPACE","\n                ",144],["T_CONSTANT_ENCAPSED_STRING","'period'",145],",",["T_WHITESPACE","\n                ",145],["T_CONSTANT_ENCAPSED_STRING","'order_status'",146],["T_WHITESPACE","\n            ",146],")",")",";",["T_WHITESPACE","\n\n            ",147],["T_VARIABLE","$insertQuery",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$helper",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getInsertFromSelectUsingAnalytic",149],"(",["T_VARIABLE","$select",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$table",149],",",["T_WHITESPACE"," ",149],["T_STRING","array_keys",149],"(",["T_VARIABLE","$columns",149],")",")",";",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$adapter",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","query",150],"(",["T_VARIABLE","$insertQuery",150],")",";",["T_WHITESPACE","\n            ",150],["T_VARIABLE","$adapter",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","commit",151],"(",")",";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE"," ",152],["T_CATCH","catch",152],["T_WHITESPACE"," ",152],"(",["T_STRING","Exception",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$e",152],")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$adapter",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","rollBack",153],"(",")",";",["T_WHITESPACE","\n            ",153],["T_THROW","throw",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$e",154],";",["T_WHITESPACE","\n        ",154],"}",["T_WHITESPACE","\n\n        ",155],["T_RETURN","return",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],";",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * Aggregate refunded data by creditmemo created at as period\n     *\n     * @param mixed $from\n     * @param mixed $to\n     * @return Mage_Sales_Model_Resource_Report_Refunded\n     *\/",160],["T_WHITESPACE","\n    ",166],["T_PROTECTED","protected",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","_aggregateByRefundCreatedAt",167],"(",["T_VARIABLE","$from",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$to",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$table",169],["T_WHITESPACE","       ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getTable",169],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/refunded_aggregated'",169],")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$sourceTable",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getTable",170],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/creditmemo'",170],")",";",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$orderTable",171],["T_WHITESPACE","  ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getTable",171],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",171],")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$adapter",172],["T_WHITESPACE","     ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_getWriteAdapter",172],"(",")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$adapter",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","beginTransaction",173],"(",")",";",["T_WHITESPACE","\n\n        ",173],["T_TRY","try",175],["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$from",176],["T_WHITESPACE"," ",176],["T_IS_NOT_IDENTICAL","!==",176],["T_WHITESPACE"," ",176],["T_STRING","null",176],["T_WHITESPACE"," ",176],["T_BOOLEAN_OR","||",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$to",176],["T_WHITESPACE"," ",176],["T_IS_NOT_IDENTICAL","!==",176],["T_WHITESPACE"," ",176],["T_STRING","null",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$subSelect",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_getTableDateRangeRelatedSelect",177],"(",["T_WHITESPACE","\n                    ",177],["T_VARIABLE","$sourceTable",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$orderTable",178],",",["T_WHITESPACE"," ",178],["T_ARRAY","array",178],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",178],["T_DOUBLE_ARROW","=>",178],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",178],")",",",["T_WHITESPACE","\n                    ",178],["T_CONSTANT_ENCAPSED_STRING","'created_at'",179],",",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$from",179],",",["T_WHITESPACE"," ",179],["T_VARIABLE","$to",179],["T_WHITESPACE","\n                ",179],")",";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE"," ",181],["T_ELSE","else",181],["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$subSelect",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","null",182],";",["T_WHITESPACE","\n            ",182],"}",["T_WHITESPACE","\n\n            ",183],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_clearTableByDateRange",185],"(",["T_VARIABLE","$table",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$from",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$to",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$subSelect",185],")",";",["T_WHITESPACE","\n            ",185],["T_COMMENT","\/\/ convert dates from UTC to current admin timezone\n",186],["T_WHITESPACE","            ",187],["T_VARIABLE","$periodExpr",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$adapter",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getDatePartSql",187],"(",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getStoreTZOffsetQuery",188],"(",["T_WHITESPACE","\n                    ",188],["T_ARRAY","array",189],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table'",189],["T_WHITESPACE"," ",189],["T_DOUBLE_ARROW","=>",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$sourceTable",189],")",",",["T_WHITESPACE","\n                    ",189],["T_CONSTANT_ENCAPSED_STRING","'source_table.created_at'",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$from",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$to",190],["T_WHITESPACE","\n                ",190],")",["T_WHITESPACE","\n            ",191],")",";",["T_WHITESPACE","\n\n            ",192],["T_VARIABLE","$columns",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_ARRAY","array",194],"(",["T_WHITESPACE","\n                ",194],["T_CONSTANT_ENCAPSED_STRING","'period'",195],["T_WHITESPACE","            ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$periodExpr",195],",",["T_WHITESPACE","\n                ",195],["T_CONSTANT_ENCAPSED_STRING","'store_id'",196],["T_WHITESPACE","          ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_CONSTANT_ENCAPSED_STRING","'order_table.store_id'",196],",",["T_WHITESPACE","\n                ",196],["T_CONSTANT_ENCAPSED_STRING","'order_status'",197],["T_WHITESPACE","      ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_CONSTANT_ENCAPSED_STRING","'order_table.status'",197],",",["T_WHITESPACE","\n                ",197],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",198],["T_WHITESPACE","      ",198],["T_DOUBLE_ARROW","=>",198],["T_WHITESPACE"," ",198],["T_NEW","new",198],["T_WHITESPACE"," ",198],["T_STRING","Zend_Db_Expr",198],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(order_table.entity_id)'",198],")",",",["T_WHITESPACE","\n                ",198],["T_CONSTANT_ENCAPSED_STRING","'refunded'",199],["T_WHITESPACE","          ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_NEW","new",199],["T_WHITESPACE"," ",199],["T_STRING","Zend_Db_Expr",199],"(",["T_WHITESPACE","\n                    ",199],["T_CONSTANT_ENCAPSED_STRING","'SUM(order_table.base_total_refunded * order_table.base_to_global_rate)'",200],")",",",["T_WHITESPACE","\n                ",200],["T_CONSTANT_ENCAPSED_STRING","'online_refunded'",201],["T_WHITESPACE","   ",201],["T_DOUBLE_ARROW","=>",201],["T_WHITESPACE"," ",201],["T_NEW","new",201],["T_WHITESPACE"," ",201],["T_STRING","Zend_Db_Expr",201],"(",["T_WHITESPACE","\n                    ",201],["T_CONSTANT_ENCAPSED_STRING","'SUM(order_table.base_total_online_refunded * order_table.base_to_global_rate)'",202],")",",",["T_WHITESPACE","\n                ",202],["T_CONSTANT_ENCAPSED_STRING","'offline_refunded'",203],["T_WHITESPACE","  ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_NEW","new",203],["T_WHITESPACE"," ",203],["T_STRING","Zend_Db_Expr",203],"(",["T_WHITESPACE","\n                    ",203],["T_CONSTANT_ENCAPSED_STRING","'SUM(order_table.base_total_offline_refunded * order_table.base_to_global_rate)'",204],")",["T_WHITESPACE","\n            ",204],")",";",["T_WHITESPACE","\n\n            ",205],["T_VARIABLE","$select",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$adapter",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","select",207],"(",")",";",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$select",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","from",208],"(",["T_ARRAY","array",208],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table'",208],["T_WHITESPACE"," ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$sourceTable",208],")",",",["T_WHITESPACE"," ",208],["T_VARIABLE","$columns",208],")",["T_WHITESPACE","\n                ",208],["T_OBJECT_OPERATOR","->",209],["T_STRING","joinInner",209],"(",["T_WHITESPACE","\n                    ",209],["T_ARRAY","array",210],"(",["T_CONSTANT_ENCAPSED_STRING","'order_table'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$orderTable",210],")",",",["T_WHITESPACE","\n                    ",210],["T_CONSTANT_ENCAPSED_STRING","'source_table.order_id = order_table.entity_id AND '",211],["T_WHITESPACE","\n                        ",211],".",["T_WHITESPACE"," ",212],["T_VARIABLE","$adapter",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","quoteInto",212],"(",["T_CONSTANT_ENCAPSED_STRING","'order_table.state != ?'",212],",",["T_WHITESPACE"," ",212],["T_STRING","Mage_Sales_Model_Order",212],["T_DOUBLE_COLON","::",212],["T_STRING","STATE_CANCELED",212],")",["T_WHITESPACE","\n                        ",212],".",["T_WHITESPACE"," ",213],["T_CONSTANT_ENCAPSED_STRING","' AND order_table.base_total_refunded > 0'",213],",",["T_WHITESPACE","\n                    ",213],["T_ARRAY","array",214],"(",")",["T_WHITESPACE","\n                ",214],")",";",["T_WHITESPACE","\n\n            ",215],["T_VARIABLE","$filterSubSelect",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$adapter",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","select",217],"(",")",";",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$filterSubSelect",218],["T_WHITESPACE","\n                ",218],["T_OBJECT_OPERATOR","->",219],["T_STRING","from",219],"(",["T_WHITESPACE","\n                    ",219],["T_ARRAY","array",220],"(",["T_CONSTANT_ENCAPSED_STRING","'filter_source_table'",220],["T_WHITESPACE"," ",220],["T_DOUBLE_ARROW","=>",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$sourceTable",220],")",",",["T_WHITESPACE","\n                    ",220],["T_NEW","new",221],["T_WHITESPACE"," ",221],["T_STRING","Zend_Db_Expr",221],"(",["T_CONSTANT_ENCAPSED_STRING","'MAX(filter_source_table.entity_id)'",221],")",")",["T_WHITESPACE","\n                ",221],["T_OBJECT_OPERATOR","->",222],["T_STRING","where",222],"(",["T_CONSTANT_ENCAPSED_STRING","'filter_source_table.order_id = source_table.order_id'",222],")",";",["T_WHITESPACE","\n\n            ",222],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_VARIABLE","$subSelect",224],["T_WHITESPACE"," ",224],["T_IS_NOT_IDENTICAL","!==",224],["T_WHITESPACE"," ",224],["T_STRING","null",224],")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                ",224],["T_VARIABLE","$select",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","having",225],"(",["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_makeConditionFromDateRangeSelect",225],"(",["T_VARIABLE","$subSelect",225],",",["T_WHITESPACE"," ",225],["T_CONSTANT_ENCAPSED_STRING","'period'",225],")",")",";",["T_WHITESPACE","\n            ",225],"}",["T_WHITESPACE","\n\n            ",226],["T_VARIABLE","$select",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","where",228],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table.entity_id = (?)'",228],",",["T_WHITESPACE"," ",228],["T_NEW","new",228],["T_WHITESPACE"," ",228],["T_STRING","Zend_Db_Expr",228],"(",["T_VARIABLE","$filterSubSelect",228],")",")",";",["T_WHITESPACE","\n            ",228],["T_UNSET","unset",229],"(",["T_VARIABLE","$filterSubSelect",229],")",";",["T_WHITESPACE","\n\n            ",229],["T_VARIABLE","$select",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","group",231],"(",["T_ARRAY","array",231],"(",["T_WHITESPACE","\n                ",231],["T_VARIABLE","$periodExpr",232],",",["T_WHITESPACE","\n                ",232],["T_CONSTANT_ENCAPSED_STRING","'order_table.store_id'",233],",",["T_WHITESPACE","\n                ",233],["T_CONSTANT_ENCAPSED_STRING","'order_table.status'",234],["T_WHITESPACE","\n            ",234],")",")",";",["T_WHITESPACE","\n\n            ",235],["T_VARIABLE","$select",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","having",237],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_count > 0'",237],")",";",["T_WHITESPACE","\n\n            ",237],["T_VARIABLE","$helper",239],["T_WHITESPACE","        ",239],"=",["T_WHITESPACE"," ",239],["T_STRING","Mage",239],["T_DOUBLE_COLON","::",239],["T_STRING","getResourceHelper",239],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",239],")",";",["T_WHITESPACE","\n            ",239],["T_VARIABLE","$insertQuery",240],["T_WHITESPACE","   ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$helper",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getInsertFromSelectUsingAnalytic",240],"(",["T_VARIABLE","$select",240],",",["T_WHITESPACE"," ",240],["T_VARIABLE","$table",240],",",["T_WHITESPACE"," ",240],["T_STRING","array_keys",240],"(",["T_VARIABLE","$columns",240],")",")",";",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$adapter",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","query",241],"(",["T_VARIABLE","$insertQuery",241],")",";",["T_WHITESPACE","\n\n            ",241],["T_VARIABLE","$select",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","reset",243],"(",")",";",["T_WHITESPACE","\n\n            ",243],["T_VARIABLE","$columns",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_ARRAY","array",245],"(",["T_WHITESPACE","\n                ",245],["T_CONSTANT_ENCAPSED_STRING","'period'",246],["T_WHITESPACE","            ",246],["T_DOUBLE_ARROW","=>",246],["T_WHITESPACE"," ",246],["T_CONSTANT_ENCAPSED_STRING","'period'",246],",",["T_WHITESPACE","\n                ",246],["T_CONSTANT_ENCAPSED_STRING","'store_id'",247],["T_WHITESPACE","          ",247],["T_DOUBLE_ARROW","=>",247],["T_WHITESPACE"," ",247],["T_NEW","new",247],["T_WHITESPACE"," ",247],["T_STRING","Zend_Db_Expr",247],"(",["T_CONSTANT_ENCAPSED_STRING","'0'",247],")",",",["T_WHITESPACE","\n                ",247],["T_CONSTANT_ENCAPSED_STRING","'order_status'",248],["T_WHITESPACE","      ",248],["T_DOUBLE_ARROW","=>",248],["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'order_status'",248],",",["T_WHITESPACE","\n                ",248],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",249],["T_WHITESPACE","      ",249],["T_DOUBLE_ARROW","=>",249],["T_WHITESPACE"," ",249],["T_NEW","new",249],["T_WHITESPACE"," ",249],["T_STRING","Zend_Db_Expr",249],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(orders_count)'",249],")",",",["T_WHITESPACE","\n                ",249],["T_CONSTANT_ENCAPSED_STRING","'refunded'",250],["T_WHITESPACE","          ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_NEW","new",250],["T_WHITESPACE"," ",250],["T_STRING","Zend_Db_Expr",250],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(refunded)'",250],")",",",["T_WHITESPACE","\n                ",250],["T_CONSTANT_ENCAPSED_STRING","'online_refunded'",251],["T_WHITESPACE","   ",251],["T_DOUBLE_ARROW","=>",251],["T_WHITESPACE"," ",251],["T_NEW","new",251],["T_WHITESPACE"," ",251],["T_STRING","Zend_Db_Expr",251],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(online_refunded)'",251],")",",",["T_WHITESPACE","\n                ",251],["T_CONSTANT_ENCAPSED_STRING","'offline_refunded'",252],["T_WHITESPACE","  ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_NEW","new",252],["T_WHITESPACE"," ",252],["T_STRING","Zend_Db_Expr",252],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(offline_refunded)'",252],")",["T_WHITESPACE","\n            ",252],")",";",["T_WHITESPACE","\n\n            ",253],["T_VARIABLE","$select",255],["T_WHITESPACE","\n                ",255],["T_OBJECT_OPERATOR","->",256],["T_STRING","from",256],"(",["T_VARIABLE","$table",256],",",["T_WHITESPACE"," ",256],["T_VARIABLE","$columns",256],")",["T_WHITESPACE","\n                ",256],["T_OBJECT_OPERATOR","->",257],["T_STRING","where",257],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id != ?'",257],",",["T_WHITESPACE"," ",257],["T_LNUMBER","0",257],")",";",["T_WHITESPACE","\n\n            ",257],["T_IF","if",259],["T_WHITESPACE"," ",259],"(",["T_VARIABLE","$subSelect",259],["T_WHITESPACE"," ",259],["T_IS_NOT_IDENTICAL","!==",259],["T_WHITESPACE"," ",259],["T_STRING","null",259],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n                ",259],["T_VARIABLE","$select",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","where",260],"(",["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","_makeConditionFromDateRangeSelect",260],"(",["T_VARIABLE","$subSelect",260],",",["T_WHITESPACE"," ",260],["T_CONSTANT_ENCAPSED_STRING","'period'",260],")",")",";",["T_WHITESPACE","\n            ",260],"}",["T_WHITESPACE","\n\n            ",261],["T_VARIABLE","$select",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","group",263],"(",["T_ARRAY","array",263],"(",["T_WHITESPACE","\n                ",263],["T_CONSTANT_ENCAPSED_STRING","'period'",264],",",["T_WHITESPACE","\n                ",264],["T_CONSTANT_ENCAPSED_STRING","'order_status'",265],["T_WHITESPACE","\n            ",265],")",")",";",["T_WHITESPACE","\n\n            ",266],["T_VARIABLE","$insertQuery",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$helper",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getInsertFromSelectUsingAnalytic",268],"(",["T_VARIABLE","$select",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$table",268],",",["T_WHITESPACE"," ",268],["T_STRING","array_keys",268],"(",["T_VARIABLE","$columns",268],")",")",";",["T_WHITESPACE","\n            ",268],["T_VARIABLE","$adapter",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","query",269],"(",["T_VARIABLE","$insertQuery",269],")",";",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE"," ",270],["T_CATCH","catch",270],["T_WHITESPACE"," ",270],"(",["T_STRING","Exception",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$e",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$adapter",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","rollBack",271],"(",")",";",["T_WHITESPACE","\n            ",271],["T_THROW","throw",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$e",272],";",["T_WHITESPACE","\n        ",272],"}",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$adapter",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","commit",274],"(",")",";",["T_WHITESPACE","\n        ",274],["T_RETURN","return",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],";",["T_WHITESPACE","\n    ",275],"}",["T_WHITESPACE","\n",276],"}",["T_WHITESPACE","\n",277]]