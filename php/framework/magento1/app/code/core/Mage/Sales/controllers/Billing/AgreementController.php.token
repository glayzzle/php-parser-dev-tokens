[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Billing agreements controller\n *\n * @author Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Sales_Billing_AgreementController",32],["T_WHITESPACE"," ",32],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Core_Controller_Front_Action",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_DOC_COMMENT","\/**\n     * View billing agreements\n     *\n     *\/",34],["T_WHITESPACE","\n    ",37],["T_PUBLIC","public",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","indexAction",38],"(",")",["T_WHITESPACE","\n    ",38],"{",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","_title",40],"(",["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","__",40],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Agreements'",40],")",")",";",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","loadLayout",41],"(",")",";",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","_initLayoutMessages",42],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",42],")",";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","renderLayout",43],"(",")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Action predispatch\n     *\n     * Check customer authentication\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","preDispatch",51],"(",")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_STRING","parent",53],["T_DOUBLE_COLON","::",53],["T_STRING","preDispatch",53],"(",")",";",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","!",["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getRequest",54],"(",")",["T_OBJECT_OPERATOR","->",54],["T_STRING","isDispatched",54],"(",")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_RETURN","return",55],";",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n        ",56],["T_IF","if",57],["T_WHITESPACE"," ",57],"(","!",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_getSession",57],"(",")",["T_OBJECT_OPERATOR","->",57],["T_STRING","authenticate",57],"(",["T_VARIABLE","$this",57],")",")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n            ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","setFlag",58],"(",["T_CONSTANT_ENCAPSED_STRING","''",58],",",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'no-dispatch'",58],",",["T_WHITESPACE"," ",58],["T_STRING","true",58],")",";",["T_WHITESPACE","\n        ",58],"}",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * View billing agreement\n     *\n     *\/",62],["T_WHITESPACE","\n    ",65],["T_PUBLIC","public",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","viewAction",66],"(",")",["T_WHITESPACE","\n    ",66],"{",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$agreement",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_initAgreement",68],"(",")",";",["T_WHITESPACE","\n        ",68],["T_IF","if",69],["T_WHITESPACE"," ",69],"(","!",["T_VARIABLE","$agreement",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_redirect",70],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",70],")",";",["T_WHITESPACE","\n            ",70],["T_RETURN","return",71],";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n\n        ",72],["T_VARIABLE","$customerIdSession",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_getSession",74],"(",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","getCustomer",74],"(",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","getId",74],"(",")",";",["T_WHITESPACE","\n        ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(","!",["T_VARIABLE","$agreement",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","canPerformAction",75],"(",["T_VARIABLE","$customerIdSession",75],")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_redirect",76],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",76],")",";",["T_WHITESPACE","\n            ",76],["T_RETURN","return",77],";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_title",80],"(",["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","__",80],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Agreements'",80],")",")",["T_WHITESPACE","\n            ",80],["T_OBJECT_OPERATOR","->",81],["T_STRING","_title",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","__",81],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Agreement # %s'",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$agreement",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getReferenceId",81],"(",")",")",")",";",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","loadLayout",82],"(",")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_initLayoutMessages",83],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",83],")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$navigationBlock",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getLayout",84],"(",")",["T_OBJECT_OPERATOR","->",84],["T_STRING","getBlock",84],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_account_navigation'",84],")",";",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$navigationBlock",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$navigationBlock",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","setActive",86],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement\/'",86],")",";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","renderLayout",88],"(",")",";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Wizard start action\n     *\n     *\/",91],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","startWizardAction",95],"(",")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$agreement",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","Mage",97],["T_DOUBLE_COLON","::",97],["T_STRING","getModel",97],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement'",97],")",";",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$paymentCode",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getRequest",98],"(",")",["T_OBJECT_OPERATOR","->",98],["T_STRING","getParam",98],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_method'",98],")",";",["T_WHITESPACE","\n        ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$paymentCode",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_TRY","try",100],["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$agreement",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","setStoreId",101],"(",["T_STRING","Mage",101],["T_DOUBLE_COLON","::",101],["T_STRING","app",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","getStore",101],"(",")",["T_OBJECT_OPERATOR","->",101],["T_STRING","getId",101],"(",")",")",["T_WHITESPACE","\n                    ",101],["T_OBJECT_OPERATOR","->",102],["T_STRING","setMethodCode",102],"(",["T_VARIABLE","$paymentCode",102],")",["T_WHITESPACE","\n                    ",102],["T_OBJECT_OPERATOR","->",103],["T_STRING","setReturnUrl",103],"(",["T_STRING","Mage",103],["T_DOUBLE_COLON","::",103],["T_STRING","getUrl",103],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/returnWizard'",103],",",["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_method'",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$paymentCode",103],")",")",")",["T_WHITESPACE","\n                    ",103],["T_OBJECT_OPERATOR","->",104],["T_STRING","setCancelUrl",104],"(",["T_STRING","Mage",104],["T_DOUBLE_COLON","::",104],["T_STRING","getUrl",104],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/cancelWizard'",104],",",["T_WHITESPACE"," ",104],["T_ARRAY","array",104],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_method'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$paymentCode",104],")",")",")",";",["T_WHITESPACE","\n\n                ",104],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_redirectUrl",106],"(",["T_VARIABLE","$agreement",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","initToken",106],"(",")",")",";",["T_WHITESPACE","\n                ",106],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],";",["T_WHITESPACE","\n            ",107],"}",["T_WHITESPACE"," ",108],["T_CATCH","catch",108],["T_WHITESPACE"," ",108],"(",["T_STRING","Mage_Core_Exception",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$e",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n                ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_getSession",109],"(",")",["T_OBJECT_OPERATOR","->",109],["T_STRING","addError",109],"(",["T_VARIABLE","$e",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getMessage",109],"(",")",")",";",["T_WHITESPACE","\n            ",109],"}",["T_WHITESPACE"," ",110],["T_CATCH","catch",110],["T_WHITESPACE"," ",110],"(",["T_STRING","Exception",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$e",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n                ",110],["T_STRING","Mage",111],["T_DOUBLE_COLON","::",111],["T_STRING","logException",111],"(",["T_VARIABLE","$e",111],")",";",["T_WHITESPACE","\n                ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_getSession",112],"(",")",["T_OBJECT_OPERATOR","->",112],["T_STRING","addError",112],"(",["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","__",112],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to start billing agreement wizard.'",112],")",")",";",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","_redirect",115],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",115],")",";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Wizard return action\n     *\n     *\/",118],["T_WHITESPACE","\n    ",121],["T_PUBLIC","public",122],["T_WHITESPACE"," ",122],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","returnWizardAction",122],"(",")",["T_WHITESPACE","\n    ",122],"{",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$agreement",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","Mage",124],["T_DOUBLE_COLON","::",124],["T_STRING","getModel",124],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement'",124],")",";",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$paymentCode",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getRequest",125],"(",")",["T_OBJECT_OPERATOR","->",125],["T_STRING","getParam",125],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_method'",125],")",";",["T_WHITESPACE","\n        ",125],["T_VARIABLE","$token",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getRequest",126],"(",")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getParam",126],"(",["T_CONSTANT_ENCAPSED_STRING","'token'",126],")",";",["T_WHITESPACE","\n        ",126],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$token",127],["T_WHITESPACE"," ",127],["T_BOOLEAN_AND","&&",127],["T_WHITESPACE"," ",127],["T_VARIABLE","$paymentCode",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_TRY","try",128],["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$agreement",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","setStoreId",129],"(",["T_STRING","Mage",129],["T_DOUBLE_COLON","::",129],["T_STRING","app",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","getStore",129],"(",")",["T_OBJECT_OPERATOR","->",129],["T_STRING","getId",129],"(",")",")",["T_WHITESPACE","\n                    ",129],["T_OBJECT_OPERATOR","->",130],["T_STRING","setToken",130],"(",["T_VARIABLE","$token",130],")",["T_WHITESPACE","\n                    ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","setMethodCode",131],"(",["T_VARIABLE","$paymentCode",131],")",["T_WHITESPACE","\n                    ",131],["T_OBJECT_OPERATOR","->",132],["T_STRING","setCustomer",132],"(",["T_STRING","Mage",132],["T_DOUBLE_COLON","::",132],["T_STRING","getSingleton",132],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",132],")",["T_OBJECT_OPERATOR","->",132],["T_STRING","getCustomer",132],"(",")",")",["T_WHITESPACE","\n                    ",132],["T_OBJECT_OPERATOR","->",133],["T_STRING","place",133],"(",")",";",["T_WHITESPACE","\n                ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_getSession",134],"(",")",["T_OBJECT_OPERATOR","->",134],["T_STRING","addSuccess",134],"(",["T_WHITESPACE","\n                    ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","__",135],"(",["T_CONSTANT_ENCAPSED_STRING","'The billing agreement \"%s\" has been created.'",135],",",["T_WHITESPACE"," ",135],["T_VARIABLE","$agreement",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getReferenceId",135],"(",")",")",["T_WHITESPACE","\n                ",135],")",";",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_redirect",137],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",137],",",["T_WHITESPACE"," ",137],["T_ARRAY","array",137],"(",["T_CONSTANT_ENCAPSED_STRING","'agreement'",137],["T_WHITESPACE"," ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$agreement",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getId",137],"(",")",")",")",";",["T_WHITESPACE","\n                ",137],["T_RETURN","return",138],";",["T_WHITESPACE","\n            ",138],"}",["T_WHITESPACE"," ",139],["T_CATCH","catch",139],["T_WHITESPACE"," ",139],"(",["T_STRING","Mage_Core_Exception",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$e",139],")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_getSession",140],"(",")",["T_OBJECT_OPERATOR","->",140],["T_STRING","addError",140],"(",["T_VARIABLE","$e",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getMessage",140],"(",")",")",";",["T_WHITESPACE","\n            ",140],"}",["T_WHITESPACE"," ",141],["T_CATCH","catch",141],["T_WHITESPACE"," ",141],"(",["T_STRING","Exception",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$e",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n                ",141],["T_STRING","Mage",142],["T_DOUBLE_COLON","::",142],["T_STRING","logException",142],"(",["T_VARIABLE","$e",142],")",";",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_getSession",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","addError",143],"(",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","__",143],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to finish billing agreement wizard.'",143],")",")",";",["T_WHITESPACE","\n            ",143],"}",["T_WHITESPACE","\n            ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_redirect",145],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",145],")",";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Wizard cancel action\n     *\n     *\/",149],["T_WHITESPACE","\n    ",152],["T_PUBLIC","public",153],["T_WHITESPACE"," ",153],["T_FUNCTION","function",153],["T_WHITESPACE"," ",153],["T_STRING","cancelWizardAction",153],"(",")",["T_WHITESPACE","\n    ",153],"{",["T_WHITESPACE","\n        ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_redirect",155],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",155],")",";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Cancel action\n     * Set billing agreement status to 'Canceled'\n     *\n     *\/",158],["T_WHITESPACE","\n    ",162],["T_PUBLIC","public",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","cancelAction",163],"(",")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$agreement",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_initAgreement",165],"(",")",";",["T_WHITESPACE","\n        ",165],["T_IF","if",166],"(","!",["T_VARIABLE","$agreement",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","_redirect",167],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",167],",",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",167],["T_WHITESPACE"," ",167],["T_DOUBLE_ARROW","=>",167],["T_WHITESPACE"," ",167],["T_STRING","true",167],")",")",";",["T_WHITESPACE","\n            ",167],["T_RETURN","return",168],";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$customerIdSession",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_getSession",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","getCustomer",171],"(",")",["T_OBJECT_OPERATOR","->",171],["T_STRING","getId",171],"(",")",";",["T_WHITESPACE","\n        ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(","!",["T_VARIABLE","$agreement",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","canPerformAction",172],"(",["T_VARIABLE","$customerIdSession",172],")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_redirect",173],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",173],",",["T_WHITESPACE"," ",173],["T_ARRAY","array",173],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_STRING","true",173],")",")",";",["T_WHITESPACE","\n            ",173],["T_RETURN","return",174],";",["T_WHITESPACE","\n        ",174],"}",["T_WHITESPACE","\n\n        ",175],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_VARIABLE","$agreement",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","canCancel",177],"(",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_TRY","try",178],["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n                ",178],["T_VARIABLE","$agreement",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","cancel",179],"(",")",";",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_getSession",180],"(",")",["T_OBJECT_OPERATOR","->",180],["T_STRING","addNotice",180],"(",["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","__",180],"(",["T_CONSTANT_ENCAPSED_STRING","'The billing agreement \"%s\" has been canceled.'",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$agreement",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getReferenceId",180],"(",")",")",")",";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE"," ",181],["T_CATCH","catch",181],["T_WHITESPACE"," ",181],"(",["T_STRING","Mage_Core_Exception",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$e",181],")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_getSession",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","addError",182],"(",["T_VARIABLE","$e",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getMessage",182],"(",")",")",";",["T_WHITESPACE","\n            ",182],"}",["T_WHITESPACE"," ",183],["T_CATCH","catch",183],["T_WHITESPACE"," ",183],"(",["T_STRING","Exception",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$e",183],")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n                ",183],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","logException",184],"(",["T_VARIABLE","$e",184],")",";",["T_WHITESPACE","\n                ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_getSession",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","addError",185],"(",["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","__",185],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to cancel the billing agreement.'",185],")",")",";",["T_WHITESPACE","\n            ",185],"}",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_redirect",188],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/view'",188],",",["T_WHITESPACE"," ",188],["T_ARRAY","array",188],"(",["T_CONSTANT_ENCAPSED_STRING","'_current'",188],["T_WHITESPACE"," ",188],["T_DOUBLE_ARROW","=>",188],["T_WHITESPACE"," ",188],["T_STRING","true",188],")",")",";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Init billing agreement model from request\n     *\n     * @return Mage_Sales_Model_Billing_Agreement\n     *\/",191],["T_WHITESPACE","\n    ",195],["T_PROTECTED","protected",196],["T_WHITESPACE"," ",196],["T_FUNCTION","function",196],["T_WHITESPACE"," ",196],["T_STRING","_initAgreement",196],"(",")",["T_WHITESPACE","\n    ",196],"{",["T_WHITESPACE","\n        ",197],["T_VARIABLE","$agreementId",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getRequest",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","getParam",198],"(",["T_CONSTANT_ENCAPSED_STRING","'agreement'",198],")",";",["T_WHITESPACE","\n        ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$agreementId",199],")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$billingAgreement",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_STRING","Mage",200],["T_DOUBLE_COLON","::",200],["T_STRING","getModel",200],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/billing_agreement'",200],")",["T_OBJECT_OPERATOR","->",200],["T_STRING","load",200],"(",["T_VARIABLE","$agreementId",200],")",";",["T_WHITESPACE","\n            ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(","!",["T_VARIABLE","$billingAgreement",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getAgreementId",201],"(",")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_getSession",202],"(",")",["T_OBJECT_OPERATOR","->",202],["T_STRING","addError",202],"(",["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","__",202],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong billing agreement ID specified.'",202],")",")",";",["T_WHITESPACE","\n                ",202],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_redirect",203],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",203],")",";",["T_WHITESPACE","\n                ",203],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_STRING","false",204],";",["T_WHITESPACE","\n            ",204],"}",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE","\n        ",206],["T_STRING","Mage",207],["T_DOUBLE_COLON","::",207],["T_STRING","register",207],"(",["T_CONSTANT_ENCAPSED_STRING","'current_billing_agreement'",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$billingAgreement",207],")",";",["T_WHITESPACE","\n        ",207],["T_RETURN","return",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$billingAgreement",208],";",["T_WHITESPACE","\n    ",208],"}",["T_WHITESPACE","\n\n    ",209],["T_DOC_COMMENT","\/**\n     * Retrieve customer session model\n     *\n     * @return Mage_Customer_Model_Session\n     *\/",211],["T_WHITESPACE","\n    ",215],["T_PROTECTED","protected",216],["T_WHITESPACE"," ",216],["T_FUNCTION","function",216],["T_WHITESPACE"," ",216],["T_STRING","_getSession",216],"(",")",["T_WHITESPACE","\n    ",216],"{",["T_WHITESPACE","\n        ",217],["T_RETURN","return",218],["T_WHITESPACE"," ",218],["T_STRING","Mage",218],["T_DOUBLE_COLON","::",218],["T_STRING","getSingleton",218],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",218],")",";",["T_WHITESPACE","\n    ",218],"}",["T_WHITESPACE","\n",219],"}",["T_WHITESPACE","\n",220]]