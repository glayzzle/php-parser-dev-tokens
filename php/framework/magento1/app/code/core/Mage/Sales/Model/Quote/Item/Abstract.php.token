[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Quote item abstract model\n *\n * Price attributes:\n *  - price - initial item price, declared during product association\n *  - original_price - product price before any calculations\n *  - calculation_price - prices for item totals calculation\n *  - custom_price - new price that can be declared by user and recalculated during calculation process\n *  - original_custom_price - original defined value of custom price without any convertion\n *\n * @category   Mage\n * @package    Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",40],["T_ABSTRACT","abstract",41],["T_WHITESPACE"," ",41],["T_CLASS","class",41],["T_WHITESPACE"," ",41],["T_STRING","Mage_Sales_Model_Quote_Item_Abstract",41],["T_WHITESPACE"," ",41],["T_EXTENDS","extends",41],["T_WHITESPACE"," ",41],["T_STRING","Mage_Core_Model_Abstract",41],["T_WHITESPACE","\n    ",41],["T_IMPLEMENTS","implements",42],["T_WHITESPACE"," ",42],["T_STRING","Mage_Catalog_Model_Product_Configuration_Item_Interface",42],["T_WHITESPACE","\n",42],"{",["T_WHITESPACE","\n    ",43],["T_DOC_COMMENT","\/**\n     * Parent item for sub items for bundle product, configurable product, etc.\n     *\n     * @var Mage_Sales_Model_Quote_Item_Abstract\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_parentItem",49],["T_WHITESPACE","  ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","null",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Children items in bundle product, configurable product, etc.\n     *\n     * @var array\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_children",56],["T_WHITESPACE","    ",56],"=",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",")",";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     *\n     * @var array\n     *\/",58],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_messages",62],["T_WHITESPACE","    ",62],"=",["T_WHITESPACE"," ",62],["T_ARRAY","array",62],"(",")",";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Retrieve Quote instance\n     *\n     * @return Mage_Sales_Model_Quote\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_ABSTRACT","abstract",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","getQuote",69],"(",")",";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Retrieve product model object associated with item\n     *\n     * @return Mage_Catalog_Model_Product\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","getProduct",76],"(",")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$product",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getData",78],"(",["T_CONSTANT_ENCAPSED_STRING","'product'",78],")",";",["T_WHITESPACE","\n        ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$product",79],["T_WHITESPACE"," ",79],["T_IS_IDENTICAL","===",79],["T_WHITESPACE"," ",79],["T_STRING","null",79],["T_WHITESPACE"," ",79],["T_BOOLEAN_AND","&&",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getProductId",79],"(",")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$product",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","Mage",80],["T_DOUBLE_COLON","::",80],["T_STRING","getModel",80],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",80],")",["T_WHITESPACE","\n                ",80],["T_OBJECT_OPERATOR","->",81],["T_STRING","setStoreId",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getQuote",81],"(",")",["T_OBJECT_OPERATOR","->",81],["T_STRING","getStoreId",81],"(",")",")",["T_WHITESPACE","\n                ",81],["T_OBJECT_OPERATOR","->",82],["T_STRING","load",82],"(",["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getProductId",82],"(",")",")",";",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","setProduct",83],"(",["T_VARIABLE","$product",83],")",";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n\n        ",84],["T_DOC_COMMENT","\/**\n         * Reset product final price because it related to custom options\n         *\/",86],["T_WHITESPACE","\n        ",88],["T_VARIABLE","$product",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","setFinalPrice",89],"(",["T_STRING","null",89],")",";",["T_WHITESPACE","\n        ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_STRING","is_array",90],"(",["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_optionsByCode",90],")",")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$product",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","setCustomOptions",91],"(",["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_optionsByCode",91],")",";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$product",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Returns special download params (if needed) for custom option with type = 'file'\n     * Needed to implement Mage_Catalog_Model_Product_Configuration_Item_Interface.\n     * Return null, as quote item needs no additional configuration.\n     *\n     * @return null|Varien_Object\n     *\/",96],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getFileDownloadParams",103],"(",")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_STRING","null",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Specify parent item id before saving data\n     *\n     * @return  Mage_Sales_Model_Quote_Item_Abstract\n     *\/",108],["T_WHITESPACE","\n    ",112],["T_PROTECTED","protected",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","_beforeSave",113],"(",")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_STRING","parent",115],["T_DOUBLE_COLON","::",115],["T_STRING","_beforeSave",115],"(",")",";",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getParentItem",116],"(",")",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","setParentItemId",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getParentItem",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","getId",117],"(",")",")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n        ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Set parent item\n     *\n     * @param  Mage_Sales_Model_Quote_Item $parentItem\n     * @return Mage_Sales_Model_Quote_Item\n     *\/",123],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","setParentItem",129],"(",["T_VARIABLE","$parentItem",129],")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_IF","if",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$parentItem",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_parentItem",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$parentItem",132],";",["T_WHITESPACE","\n            ",132],["T_COMMENT","\/\/ Prevent duplication of children in those are already set\n",133],["T_WHITESPACE","            ",134],["T_IF","if",134],["T_WHITESPACE"," ",134],"(","!",["T_STRING","in_array",134],"(",["T_VARIABLE","$this",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$parentItem",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getChildren",134],"(",")",")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$parentItem",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","addChild",135],"(",["T_VARIABLE","$this",135],")",";",["T_WHITESPACE","\n            ",135],"}",["T_WHITESPACE","\n        ",136],"}",["T_WHITESPACE","\n        ",137],["T_RETURN","return",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],";",["T_WHITESPACE","\n    ",138],"}",["T_WHITESPACE","\n\n    ",139],["T_DOC_COMMENT","\/**\n     * Get parent item\n     *\n     * @return Mage_Sales_Model_Quote_Item\n     *\/",141],["T_WHITESPACE","\n    ",145],["T_PUBLIC","public",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","getParentItem",146],"(",")",["T_WHITESPACE","\n    ",146],"{",["T_WHITESPACE","\n        ",147],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_parentItem",148],";",["T_WHITESPACE","\n    ",148],"}",["T_WHITESPACE","\n\n    ",149],["T_DOC_COMMENT","\/**\n     * Get chil items\n     *\n     * @return array\n     *\/",151],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","getChildren",156],"(",")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_children",158],";",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * Add child item\n     *\n     * @param  Mage_Sales_Model_Quote_Item_Abstract $child\n     * @return Mage_Sales_Model_Quote_Item_Abstract\n     *\/",161],["T_WHITESPACE","\n    ",166],["T_PUBLIC","public",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","addChild",167],"(",["T_VARIABLE","$child",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","setHasChildren",169],"(",["T_STRING","true",169],")",";",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_children",170],"[","]",["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$child",170],";",["T_WHITESPACE","\n        ",170],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],";",["T_WHITESPACE","\n    ",171],"}",["T_WHITESPACE","\n\n    ",172],["T_DOC_COMMENT","\/**\n     * Adds message(s) for quote item. Duplicated messages are not added.\n     *\n     * @param  mixed $messages\n     * @return Mage_Sales_Model_Quote_Item_Abstract\n     *\/",174],["T_WHITESPACE","\n    ",179],["T_PUBLIC","public",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","setMessage",180],"(",["T_VARIABLE","$messages",180],")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$messagesExists",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getMessage",182],"(",["T_STRING","false",182],")",";",["T_WHITESPACE","\n        ",182],["T_IF","if",183],["T_WHITESPACE"," ",183],"(","!",["T_STRING","is_array",183],"(",["T_VARIABLE","$messages",183],")",")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$messages",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_ARRAY","array",184],"(",["T_VARIABLE","$messages",184],")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n        ",185],["T_FOREACH","foreach",186],["T_WHITESPACE"," ",186],"(",["T_VARIABLE","$messages",186],["T_WHITESPACE"," ",186],["T_AS","as",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$message",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(","!",["T_STRING","in_array",187],"(",["T_VARIABLE","$message",187],",",["T_WHITESPACE"," ",187],["T_VARIABLE","$messagesExists",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","addMessage",188],"(",["T_VARIABLE","$message",188],")",";",["T_WHITESPACE","\n            ",188],"}",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n        ",190],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],";",["T_WHITESPACE","\n    ",191],"}",["T_WHITESPACE","\n\n    ",192],["T_DOC_COMMENT","\/**\n     * Add message of quote item to array of messages\n     *\n     * @param   string $message\n     * @return  Mage_Sales_Model_Quote_Item_Abstract\n     *\/",194],["T_WHITESPACE","\n    ",199],["T_PUBLIC","public",200],["T_WHITESPACE"," ",200],["T_FUNCTION","function",200],["T_WHITESPACE"," ",200],["T_STRING","addMessage",200],"(",["T_VARIABLE","$message",200],")",["T_WHITESPACE","\n    ",200],"{",["T_WHITESPACE","\n        ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_messages",202],"[","]",["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$message",202],";",["T_WHITESPACE","\n        ",202],["T_RETURN","return",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],";",["T_WHITESPACE","\n    ",203],"}",["T_WHITESPACE","\n\n    ",204],["T_DOC_COMMENT","\/**\n     * Get messages array of quote item\n     *\n     * @param   bool $string flag for converting messages to string\n     * @return  array|string\n     *\/",206],["T_WHITESPACE","\n    ",211],["T_PUBLIC","public",212],["T_WHITESPACE"," ",212],["T_FUNCTION","function",212],["T_WHITESPACE"," ",212],["T_STRING","getMessage",212],"(",["T_VARIABLE","$string",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_STRING","true",212],")",["T_WHITESPACE","\n    ",212],"{",["T_WHITESPACE","\n        ",213],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$string",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_STRING","join",215],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",215],",",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_messages",215],")",";",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n        ",216],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_messages",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n\n    ",218],["T_DOC_COMMENT","\/**\n     * Removes message by text\n     *\n     * @param string $text\n     * @return Mage_Sales_Model_Quote_Item_Abstract\n     *\/",220],["T_WHITESPACE","\n    ",225],["T_PUBLIC","public",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","removeMessageByText",226],"(",["T_VARIABLE","$text",226],")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_FOREACH","foreach",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_messages",228],["T_WHITESPACE"," ",228],["T_AS","as",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$key",228],["T_WHITESPACE"," ",228],["T_DOUBLE_ARROW","=>",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$message",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_VARIABLE","$message",229],["T_WHITESPACE"," ",229],["T_IS_EQUAL","==",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$text",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                ",229],["T_UNSET","unset",230],"(",["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_messages",230],"[",["T_VARIABLE","$key",230],"]",")",";",["T_WHITESPACE","\n            ",230],"}",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n        ",232],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],";",["T_WHITESPACE","\n    ",233],"}",["T_WHITESPACE","\n\n    ",234],["T_DOC_COMMENT","\/**\n     * Clears all messages\n     *\n     * @return Mage_Sales_Model_Quote_Item_Abstract\n     *\/",236],["T_WHITESPACE","\n    ",240],["T_PUBLIC","public",241],["T_WHITESPACE"," ",241],["T_FUNCTION","function",241],["T_WHITESPACE"," ",241],["T_STRING","clearMessage",241],"(",")",["T_WHITESPACE","\n    ",241],"{",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","unsMessage",243],"(",")",";",["T_WHITESPACE"," ",243],["T_COMMENT","\/\/ For older compatibility, when we kept message inside data array\n",243],["T_WHITESPACE","        ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_messages",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_ARRAY","array",244],"(",")",";",["T_WHITESPACE","\n        ",244],["T_RETURN","return",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$this",245],";",["T_WHITESPACE","\n    ",245],"}",["T_WHITESPACE","\n\n    ",246],["T_DOC_COMMENT","\/**\n     * Retrieve store model object\n     *\n     * @return Mage_Core_Model_Store\n     *\/",248],["T_WHITESPACE","\n    ",252],["T_PUBLIC","public",253],["T_WHITESPACE"," ",253],["T_FUNCTION","function",253],["T_WHITESPACE"," ",253],["T_STRING","getStore",253],"(",")",["T_WHITESPACE","\n    ",253],"{",["T_WHITESPACE","\n        ",254],["T_RETURN","return",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getQuote",255],"(",")",["T_OBJECT_OPERATOR","->",255],["T_STRING","getStore",255],"(",")",";",["T_WHITESPACE","\n    ",255],"}",["T_WHITESPACE","\n\n    ",256],["T_DOC_COMMENT","\/**\n     * Checking item data\n     *\n     * @return Mage_Sales_Model_Quote_Item_Abstract\n     *\/",258],["T_WHITESPACE","\n    ",262],["T_PUBLIC","public",263],["T_WHITESPACE"," ",263],["T_FUNCTION","function",263],["T_WHITESPACE"," ",263],["T_STRING","checkData",263],"(",")",["T_WHITESPACE","\n    ",263],"{",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","setHasError",265],"(",["T_STRING","false",265],")",";",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","clearMessage",266],"(",")",";",["T_WHITESPACE","\n\n        ",266],["T_VARIABLE","$qty",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_getData",268],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",268],")",";",["T_WHITESPACE","\n\n        ",268],["T_TRY","try",270],["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","setQty",271],"(",["T_VARIABLE","$qty",271],")",";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE"," ",272],["T_CATCH","catch",272],["T_WHITESPACE"," ",272],"(",["T_STRING","Mage_Core_Exception",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$e",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","setHasError",273],"(",["T_STRING","true",273],")",";",["T_WHITESPACE","\n            ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","setMessage",274],"(",["T_VARIABLE","$e",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getMessage",274],"(",")",")",";",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE"," ",275],["T_CATCH","catch",275],["T_WHITESPACE"," ",275],"(",["T_STRING","Exception",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$e",275],")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","setHasError",276],"(",["T_STRING","true",276],")",";",["T_WHITESPACE","\n            ",276],["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","setMessage",277],"(",["T_STRING","Mage",277],["T_DOUBLE_COLON","::",277],["T_STRING","helper",277],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",277],")",["T_OBJECT_OPERATOR","->",277],["T_STRING","__",277],"(",["T_CONSTANT_ENCAPSED_STRING","'Item qty declaration error.'",277],")",")",";",["T_WHITESPACE","\n        ",277],"}",["T_WHITESPACE","\n\n        ",278],["T_TRY","try",280],["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n            ",280],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getProduct",281],"(",")",["T_OBJECT_OPERATOR","->",281],["T_STRING","getTypeInstance",281],"(",["T_STRING","true",281],")",["T_OBJECT_OPERATOR","->",281],["T_STRING","checkProductBuyState",281],"(",["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getProduct",281],"(",")",")",";",["T_WHITESPACE","\n        ",281],"}",["T_WHITESPACE"," ",282],["T_CATCH","catch",282],["T_WHITESPACE"," ",282],"(",["T_STRING","Mage_Core_Exception",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$e",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","setHasError",283],"(",["T_STRING","true",283],")",["T_WHITESPACE","\n                ",283],["T_OBJECT_OPERATOR","->",284],["T_STRING","setMessage",284],"(",["T_VARIABLE","$e",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getMessage",284],"(",")",")",";",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getQuote",285],"(",")",["T_OBJECT_OPERATOR","->",285],["T_STRING","setHasError",285],"(",["T_STRING","true",285],")",["T_WHITESPACE","\n                ",285],["T_OBJECT_OPERATOR","->",286],["T_STRING","addMessage",286],"(",["T_STRING","Mage",286],["T_DOUBLE_COLON","::",286],["T_STRING","helper",286],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",286],")",["T_OBJECT_OPERATOR","->",286],["T_STRING","__",286],"(",["T_CONSTANT_ENCAPSED_STRING","'Some of the products below do not have all the required options.'",286],")",")",";",["T_WHITESPACE","\n        ",286],"}",["T_WHITESPACE"," ",287],["T_CATCH","catch",287],["T_WHITESPACE"," ",287],"(",["T_STRING","Exception",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$e",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","setHasError",288],"(",["T_STRING","true",288],")",["T_WHITESPACE","\n                ",288],["T_OBJECT_OPERATOR","->",289],["T_STRING","setMessage",289],"(",["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","helper",289],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",289],")",["T_OBJECT_OPERATOR","->",289],["T_STRING","__",289],"(",["T_CONSTANT_ENCAPSED_STRING","'Item options declaration error.'",289],")",")",";",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getQuote",290],"(",")",["T_OBJECT_OPERATOR","->",290],["T_STRING","setHasError",290],"(",["T_STRING","true",290],")",["T_WHITESPACE","\n                ",290],["T_OBJECT_OPERATOR","->",291],["T_STRING","addMessage",291],"(",["T_STRING","Mage",291],["T_DOUBLE_COLON","::",291],["T_STRING","helper",291],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",291],")",["T_OBJECT_OPERATOR","->",291],["T_STRING","__",291],"(",["T_CONSTANT_ENCAPSED_STRING","'Items options declaration error.'",291],")",")",";",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n\n        ",292],["T_IF","if",294],["T_WHITESPACE"," ",294],"(",["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getProduct",294],"(",")",["T_OBJECT_OPERATOR","->",294],["T_STRING","getHasError",294],"(",")",")",["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n            ",294],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","setHasError",295],"(",["T_STRING","true",295],")",["T_WHITESPACE","\n                ",295],["T_OBJECT_OPERATOR","->",296],["T_STRING","setMessage",296],"(",["T_STRING","Mage",296],["T_DOUBLE_COLON","::",296],["T_STRING","helper",296],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",296],")",["T_OBJECT_OPERATOR","->",296],["T_STRING","__",296],"(",["T_CONSTANT_ENCAPSED_STRING","'Some of the selected options are not currently available.'",296],")",")",";",["T_WHITESPACE","\n            ",296],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getQuote",297],"(",")",["T_OBJECT_OPERATOR","->",297],["T_STRING","setHasError",297],"(",["T_STRING","true",297],")",["T_WHITESPACE","\n                ",297],["T_OBJECT_OPERATOR","->",298],["T_STRING","addMessage",298],"(",["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getProduct",298],"(",")",["T_OBJECT_OPERATOR","->",298],["T_STRING","getMessage",298],"(",")",",",["T_WHITESPACE"," ",298],["T_CONSTANT_ENCAPSED_STRING","'options'",298],")",";",["T_WHITESPACE","\n        ",298],"}",["T_WHITESPACE","\n\n        ",299],["T_IF","if",301],["T_WHITESPACE"," ",301],"(",["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getHasConfigurationUnavailableError",301],"(",")",")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n            ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","setHasError",302],"(",["T_STRING","true",302],")",["T_WHITESPACE","\n                ",302],["T_OBJECT_OPERATOR","->",303],["T_STRING","setMessage",303],"(",["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","helper",303],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",303],")",["T_OBJECT_OPERATOR","->",303],["T_STRING","__",303],"(",["T_CONSTANT_ENCAPSED_STRING","'Selected option(s) or their combination is not currently available.'",303],")",")",";",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getQuote",304],"(",")",["T_OBJECT_OPERATOR","->",304],["T_STRING","setHasError",304],"(",["T_STRING","true",304],")",["T_WHITESPACE","\n                ",304],["T_OBJECT_OPERATOR","->",305],["T_STRING","addMessage",305],"(",["T_STRING","Mage",305],["T_DOUBLE_COLON","::",305],["T_STRING","helper",305],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",305],")",["T_OBJECT_OPERATOR","->",305],["T_STRING","__",305],"(",["T_CONSTANT_ENCAPSED_STRING","'Some item options or their combination are not currently available.'",305],")",",",["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","'unavailable-configuration'",305],")",";",["T_WHITESPACE","\n            ",305],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","unsHasConfigurationUnavailableError",306],"(",")",";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n\n        ",307],["T_RETURN","return",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],";",["T_WHITESPACE","\n    ",309],"}",["T_WHITESPACE","\n\n    ",310],["T_DOC_COMMENT","\/**\n     * Get original (not related with parent item) item quantity\n     *\n     * @return  int|float\n     *\/",312],["T_WHITESPACE","\n    ",316],["T_PUBLIC","public",317],["T_WHITESPACE"," ",317],["T_FUNCTION","function",317],["T_WHITESPACE"," ",317],["T_STRING","getQty",317],"(",")",["T_WHITESPACE","\n    ",317],"{",["T_WHITESPACE","\n        ",318],["T_RETURN","return",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","_getData",319],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",319],")",";",["T_WHITESPACE","\n    ",319],"}",["T_WHITESPACE","\n\n    ",320],["T_DOC_COMMENT","\/**\n     * Get total item quantity (include parent item relation)\n     *\n     * @return  int|float\n     *\/",322],["T_WHITESPACE","\n    ",326],["T_PUBLIC","public",327],["T_WHITESPACE"," ",327],["T_FUNCTION","function",327],["T_WHITESPACE"," ",327],["T_STRING","getTotalQty",327],"(",")",["T_WHITESPACE","\n    ",327],"{",["T_WHITESPACE","\n        ",328],["T_IF","if",329],["T_WHITESPACE"," ",329],"(",["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getParentItem",329],"(",")",")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getQty",330],"(",")","*",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getParentItem",330],"(",")",["T_OBJECT_OPERATOR","->",330],["T_STRING","getQty",330],"(",")",";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n        ",331],["T_RETURN","return",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getQty",332],"(",")",";",["T_WHITESPACE","\n    ",332],"}",["T_WHITESPACE","\n\n    ",333],["T_DOC_COMMENT","\/**\n     * Calculate item row total price\n     *\n     * @return Mage_Sales_Model_Quote_Item\n     *\/",335],["T_WHITESPACE","\n    ",339],["T_PUBLIC","public",340],["T_WHITESPACE"," ",340],["T_FUNCTION","function",340],["T_WHITESPACE"," ",340],["T_STRING","calcRowTotal",340],"(",")",["T_WHITESPACE","\n    ",340],"{",["T_WHITESPACE","\n        ",341],["T_VARIABLE","$qty",342],["T_WHITESPACE","        ",342],"=",["T_WHITESPACE"," ",342],["T_VARIABLE","$this",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","getTotalQty",342],"(",")",";",["T_WHITESPACE","\n        ",342],["T_COMMENT","\/\/ Round unit price before multiplying to prevent losing 1 cent on subtotal\n",343],["T_WHITESPACE","        ",344],["T_VARIABLE","$total",344],["T_WHITESPACE","      ",344],"=",["T_WHITESPACE"," ",344],["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getStore",344],"(",")",["T_OBJECT_OPERATOR","->",344],["T_STRING","roundPrice",344],"(",["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getCalculationPriceOriginal",344],"(",")",")",["T_WHITESPACE"," ",344],"*",["T_WHITESPACE"," ",344],["T_VARIABLE","$qty",344],";",["T_WHITESPACE","\n        ",344],["T_VARIABLE","$baseTotal",345],["T_WHITESPACE","  ",345],"=",["T_WHITESPACE"," ",345],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getStore",345],"(",")",["T_OBJECT_OPERATOR","->",345],["T_STRING","roundPrice",345],"(",["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getBaseCalculationPriceOriginal",345],"(",")",")",["T_WHITESPACE"," ",345],"*",["T_WHITESPACE"," ",345],["T_VARIABLE","$qty",345],";",["T_WHITESPACE","\n\n        ",345],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","setRowTotal",347],"(",["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getStore",347],"(",")",["T_OBJECT_OPERATOR","->",347],["T_STRING","roundPrice",347],"(",["T_VARIABLE","$total",347],")",")",";",["T_WHITESPACE","\n        ",347],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","setBaseRowTotal",348],"(",["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getStore",348],"(",")",["T_OBJECT_OPERATOR","->",348],["T_STRING","roundPrice",348],"(",["T_VARIABLE","$baseTotal",348],")",")",";",["T_WHITESPACE","\n        ",348],["T_RETURN","return",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$this",349],";",["T_WHITESPACE","\n    ",349],"}",["T_WHITESPACE","\n\n    ",350],["T_DOC_COMMENT","\/**\n     * Get item price used for quote calculation process.\n     * This method get custom price (if it is defined) or original product final price\n     *\n     * @return float\n     *\/",352],["T_WHITESPACE","\n    ",357],["T_PUBLIC","public",358],["T_WHITESPACE"," ",358],["T_FUNCTION","function",358],["T_WHITESPACE"," ",358],["T_STRING","getCalculationPrice",358],"(",")",["T_WHITESPACE","\n    ",358],"{",["T_WHITESPACE","\n        ",359],["T_VARIABLE","$price",360],["T_WHITESPACE"," ",360],"=",["T_WHITESPACE"," ",360],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","_getData",360],"(",["T_CONSTANT_ENCAPSED_STRING","'calculation_price'",360],")",";",["T_WHITESPACE","\n        ",360],["T_IF","if",361],["T_WHITESPACE"," ",361],"(",["T_STRING","is_null",361],"(",["T_VARIABLE","$price",361],")",")",["T_WHITESPACE"," ",361],"{",["T_WHITESPACE","\n            ",361],["T_IF","if",362],["T_WHITESPACE"," ",362],"(",["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","hasCustomPrice",362],"(",")",")",["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n                ",362],["T_VARIABLE","$price",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getCustomPrice",363],"(",")",";",["T_WHITESPACE","\n            ",363],"}",["T_WHITESPACE"," ",364],["T_ELSE","else",364],["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n                ",364],["T_VARIABLE","$price",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","getConvertedPrice",365],"(",")",";",["T_WHITESPACE","\n            ",365],"}",["T_WHITESPACE","\n            ",366],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","setData",367],"(",["T_CONSTANT_ENCAPSED_STRING","'calculation_price'",367],",",["T_WHITESPACE"," ",367],["T_VARIABLE","$price",367],")",";",["T_WHITESPACE","\n        ",367],"}",["T_WHITESPACE","\n        ",368],["T_RETURN","return",369],["T_WHITESPACE"," ",369],["T_VARIABLE","$price",369],";",["T_WHITESPACE","\n    ",369],"}",["T_WHITESPACE","\n\n    ",370],["T_DOC_COMMENT","\/**\n     * Get item price used for quote calculation process.\n     * This method get original custom price applied before tax calculation\n     *\n     * @return float\n     *\/",372],["T_WHITESPACE","\n    ",377],["T_PUBLIC","public",378],["T_WHITESPACE"," ",378],["T_FUNCTION","function",378],["T_WHITESPACE"," ",378],["T_STRING","getCalculationPriceOriginal",378],"(",")",["T_WHITESPACE","\n    ",378],"{",["T_WHITESPACE","\n        ",379],["T_VARIABLE","$price",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","_getData",380],"(",["T_CONSTANT_ENCAPSED_STRING","'calculation_price'",380],")",";",["T_WHITESPACE","\n        ",380],["T_IF","if",381],["T_WHITESPACE"," ",381],"(",["T_STRING","is_null",381],"(",["T_VARIABLE","$price",381],")",")",["T_WHITESPACE"," ",381],"{",["T_WHITESPACE","\n            ",381],["T_IF","if",382],["T_WHITESPACE"," ",382],"(",["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","hasOriginalCustomPrice",382],"(",")",")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n                ",382],["T_VARIABLE","$price",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","getOriginalCustomPrice",383],"(",")",";",["T_WHITESPACE","\n            ",383],"}",["T_WHITESPACE"," ",384],["T_ELSE","else",384],["T_WHITESPACE"," ",384],"{",["T_WHITESPACE","\n                ",384],["T_VARIABLE","$price",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","getConvertedPrice",385],"(",")",";",["T_WHITESPACE","\n            ",385],"}",["T_WHITESPACE","\n            ",386],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","setData",387],"(",["T_CONSTANT_ENCAPSED_STRING","'calculation_price'",387],",",["T_WHITESPACE"," ",387],["T_VARIABLE","$price",387],")",";",["T_WHITESPACE","\n        ",387],"}",["T_WHITESPACE","\n        ",388],["T_RETURN","return",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$price",389],";",["T_WHITESPACE","\n    ",389],"}",["T_WHITESPACE","\n\n    ",390],["T_DOC_COMMENT","\/**\n     * Get calculation price used for quote calculation in base currency.\n     *\n     * @return float\n     *\/",392],["T_WHITESPACE","\n    ",396],["T_PUBLIC","public",397],["T_WHITESPACE"," ",397],["T_FUNCTION","function",397],["T_WHITESPACE"," ",397],["T_STRING","getBaseCalculationPrice",397],"(",")",["T_WHITESPACE","\n    ",397],"{",["T_WHITESPACE","\n        ",398],["T_IF","if",399],["T_WHITESPACE"," ",399],"(","!",["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","hasBaseCalculationPrice",399],"(",")",")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n            ",399],["T_IF","if",400],["T_WHITESPACE"," ",400],"(",["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","hasCustomPrice",400],"(",")",")",["T_WHITESPACE"," ",400],"{",["T_WHITESPACE","\n                ",400],["T_VARIABLE","$price",401],["T_WHITESPACE"," ",401],"=",["T_WHITESPACE"," ",401],["T_DOUBLE_CAST","(float)",401],["T_WHITESPACE"," ",401],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","getCustomPrice",401],"(",")",";",["T_WHITESPACE","\n                ",401],["T_IF","if",402],["T_WHITESPACE"," ",402],"(",["T_VARIABLE","$price",402],")",["T_WHITESPACE"," ",402],"{",["T_WHITESPACE","\n                    ",402],["T_VARIABLE","$rate",403],["T_WHITESPACE"," ",403],"=",["T_WHITESPACE"," ",403],["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getStore",403],"(",")",["T_OBJECT_OPERATOR","->",403],["T_STRING","convertPrice",403],"(",["T_VARIABLE","$price",403],")",["T_WHITESPACE"," ",403],"\/",["T_WHITESPACE"," ",403],["T_VARIABLE","$price",403],";",["T_WHITESPACE","\n                    ",403],["T_VARIABLE","$price",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_VARIABLE","$price",404],["T_WHITESPACE"," ",404],"\/",["T_WHITESPACE"," ",404],["T_VARIABLE","$rate",404],";",["T_WHITESPACE","\n                ",404],"}",["T_WHITESPACE","\n            ",405],"}",["T_WHITESPACE"," ",406],["T_ELSE","else",406],["T_WHITESPACE"," ",406],"{",["T_WHITESPACE","\n                ",406],["T_VARIABLE","$price",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getPrice",407],"(",")",";",["T_WHITESPACE","\n            ",407],"}",["T_WHITESPACE","\n            ",408],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","setBaseCalculationPrice",409],"(",["T_VARIABLE","$price",409],")",";",["T_WHITESPACE","\n        ",409],"}",["T_WHITESPACE","\n        ",410],["T_RETURN","return",411],["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_getData",411],"(",["T_CONSTANT_ENCAPSED_STRING","'base_calculation_price'",411],")",";",["T_WHITESPACE","\n    ",411],"}",["T_WHITESPACE","\n\n    ",412],["T_DOC_COMMENT","\/**\n     * Get original calculation price used for quote calculation in base currency.\n     *\n     * @return float\n     *\/",414],["T_WHITESPACE","\n    ",418],["T_PUBLIC","public",419],["T_WHITESPACE"," ",419],["T_FUNCTION","function",419],["T_WHITESPACE"," ",419],["T_STRING","getBaseCalculationPriceOriginal",419],"(",")",["T_WHITESPACE","\n    ",419],"{",["T_WHITESPACE","\n        ",420],["T_IF","if",421],["T_WHITESPACE"," ",421],"(","!",["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","hasBaseCalculationPrice",421],"(",")",")",["T_WHITESPACE"," ",421],"{",["T_WHITESPACE","\n            ",421],["T_IF","if",422],["T_WHITESPACE"," ",422],"(",["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","hasOriginalCustomPrice",422],"(",")",")",["T_WHITESPACE"," ",422],"{",["T_WHITESPACE","\n                ",422],["T_VARIABLE","$price",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_DOUBLE_CAST","(float)",423],["T_WHITESPACE"," ",423],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getOriginalCustomPrice",423],"(",")",";",["T_WHITESPACE","\n                ",423],["T_IF","if",424],["T_WHITESPACE"," ",424],"(",["T_VARIABLE","$price",424],")",["T_WHITESPACE"," ",424],"{",["T_WHITESPACE","\n                    ",424],["T_VARIABLE","$rate",425],["T_WHITESPACE"," ",425],"=",["T_WHITESPACE"," ",425],["T_VARIABLE","$this",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getStore",425],"(",")",["T_OBJECT_OPERATOR","->",425],["T_STRING","convertPrice",425],"(",["T_VARIABLE","$price",425],")",["T_WHITESPACE"," ",425],"\/",["T_WHITESPACE"," ",425],["T_VARIABLE","$price",425],";",["T_WHITESPACE","\n                    ",425],["T_VARIABLE","$price",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_VARIABLE","$price",426],["T_WHITESPACE"," ",426],"\/",["T_WHITESPACE"," ",426],["T_VARIABLE","$rate",426],";",["T_WHITESPACE","\n                ",426],"}",["T_WHITESPACE","\n            ",427],"}",["T_WHITESPACE"," ",428],["T_ELSE","else",428],["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n                ",428],["T_VARIABLE","$price",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getPrice",429],"(",")",";",["T_WHITESPACE","\n            ",429],"}",["T_WHITESPACE","\n            ",430],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","setBaseCalculationPrice",431],"(",["T_VARIABLE","$price",431],")",";",["T_WHITESPACE","\n        ",431],"}",["T_WHITESPACE","\n        ",432],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","_getData",433],"(",["T_CONSTANT_ENCAPSED_STRING","'base_calculation_price'",433],")",";",["T_WHITESPACE","\n    ",433],"}",["T_WHITESPACE","\n\n    ",434],["T_DOC_COMMENT","\/**\n     * Get whether the item is nominal\n     * TODO: fix for multishipping checkout\n     *\n     * @return bool\n     *\/",436],["T_WHITESPACE","\n    ",441],["T_PUBLIC","public",442],["T_WHITESPACE"," ",442],["T_FUNCTION","function",442],["T_WHITESPACE"," ",442],["T_STRING","isNominal",442],"(",")",["T_WHITESPACE","\n    ",442],"{",["T_WHITESPACE","\n        ",443],["T_IF","if",444],["T_WHITESPACE"," ",444],"(","!",["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","hasData",444],"(",["T_CONSTANT_ENCAPSED_STRING","'is_nominal'",444],")",")",["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n            ",444],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","setData",445],"(",["T_CONSTANT_ENCAPSED_STRING","'is_nominal'",445],",",["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getProduct",445],"(",")",["T_WHITESPACE"," ",445],"?",["T_WHITESPACE"," ",445],["T_CONSTANT_ENCAPSED_STRING","'1'",445],["T_WHITESPACE"," ",445],["T_IS_EQUAL","==",445],["T_WHITESPACE"," ",445],["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getProduct",445],"(",")",["T_OBJECT_OPERATOR","->",445],["T_STRING","getIsRecurring",445],"(",")",["T_WHITESPACE"," ",445],":",["T_WHITESPACE"," ",445],["T_STRING","false",445],")",";",["T_WHITESPACE","\n        ",445],"}",["T_WHITESPACE","\n        ",446],["T_RETURN","return",447],["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","_getData",447],"(",["T_CONSTANT_ENCAPSED_STRING","'is_nominal'",447],")",";",["T_WHITESPACE","\n    ",447],"}",["T_WHITESPACE","\n\n    ",448],["T_DOC_COMMENT","\/**\n     * Data getter for 'is_nominal'\n     * Used for converting item to order item\n     *\n     * @return int\n     *\/",450],["T_WHITESPACE","\n    ",455],["T_PUBLIC","public",456],["T_WHITESPACE"," ",456],["T_FUNCTION","function",456],["T_WHITESPACE"," ",456],["T_STRING","getIsNominal",456],"(",")",["T_WHITESPACE","\n    ",456],"{",["T_WHITESPACE","\n        ",457],["T_RETURN","return",458],["T_WHITESPACE"," ",458],["T_INT_CAST","(int)",458],["T_VARIABLE","$this",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","isNominal",458],"(",")",";",["T_WHITESPACE","\n    ",458],"}",["T_WHITESPACE","\n\n    ",459],["T_DOC_COMMENT","\/**\n     * Get original price (retrieved from product) for item.\n     * Original price value is in quote selected currency\n     *\n     * @return float\n     *\/",461],["T_WHITESPACE","\n    ",466],["T_PUBLIC","public",467],["T_WHITESPACE"," ",467],["T_FUNCTION","function",467],["T_WHITESPACE"," ",467],["T_STRING","getOriginalPrice",467],"(",")",["T_WHITESPACE","\n    ",467],"{",["T_WHITESPACE","\n        ",468],["T_VARIABLE","$price",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$this",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","_getData",469],"(",["T_CONSTANT_ENCAPSED_STRING","'original_price'",469],")",";",["T_WHITESPACE","\n        ",469],["T_IF","if",470],["T_WHITESPACE"," ",470],"(",["T_STRING","is_null",470],"(",["T_VARIABLE","$price",470],")",")",["T_WHITESPACE"," ",470],"{",["T_WHITESPACE","\n            ",470],["T_VARIABLE","$price",471],["T_WHITESPACE"," ",471],"=",["T_WHITESPACE"," ",471],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getStore",471],"(",")",["T_OBJECT_OPERATOR","->",471],["T_STRING","convertPrice",471],"(",["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","getBaseOriginalPrice",471],"(",")",")",";",["T_WHITESPACE","\n            ",471],["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","setData",472],"(",["T_CONSTANT_ENCAPSED_STRING","'original_price'",472],",",["T_WHITESPACE"," ",472],["T_VARIABLE","$price",472],")",";",["T_WHITESPACE","\n        ",472],"}",["T_WHITESPACE","\n        ",473],["T_RETURN","return",474],["T_WHITESPACE"," ",474],["T_VARIABLE","$price",474],";",["T_WHITESPACE","\n    ",474],"}",["T_WHITESPACE","\n\n    ",475],["T_DOC_COMMENT","\/**\n     * Set original price to item (calculation price will be refreshed too)\n     *\n     * @param   float $price\n     * @return  Mage_Sales_Model_Quote_Item_Abstract\n     *\/",477],["T_WHITESPACE","\n    ",482],["T_PUBLIC","public",483],["T_WHITESPACE"," ",483],["T_FUNCTION","function",483],["T_WHITESPACE"," ",483],["T_STRING","setOriginalPrice",483],"(",["T_VARIABLE","$price",483],")",["T_WHITESPACE","\n    ",483],"{",["T_WHITESPACE","\n        ",484],["T_RETURN","return",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","setData",485],"(",["T_CONSTANT_ENCAPSED_STRING","'original_price'",485],",",["T_WHITESPACE"," ",485],["T_VARIABLE","$price",485],")",";",["T_WHITESPACE","\n    ",485],"}",["T_WHITESPACE","\n\n    ",486],["T_DOC_COMMENT","\/**\n     * Get Original item price (got from product) in base website currency\n     *\n     * @return float\n     *\/",488],["T_WHITESPACE","\n    ",492],["T_PUBLIC","public",493],["T_WHITESPACE"," ",493],["T_FUNCTION","function",493],["T_WHITESPACE"," ",493],["T_STRING","getBaseOriginalPrice",493],"(",")",["T_WHITESPACE","\n    ",493],"{",["T_WHITESPACE","\n        ",494],["T_RETURN","return",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","_getData",495],"(",["T_CONSTANT_ENCAPSED_STRING","'base_original_price'",495],")",";",["T_WHITESPACE","\n    ",495],"}",["T_WHITESPACE","\n\n    ",496],["T_DOC_COMMENT","\/**\n     * Specify custom item price (used in case whe we have apply not product price to item)\n     *\n     * @param   float $value\n     * @return  Mage_Sales_Model_Quote_Item_Abstract\n     *\/",498],["T_WHITESPACE","\n    ",503],["T_PUBLIC","public",504],["T_WHITESPACE"," ",504],["T_FUNCTION","function",504],["T_WHITESPACE"," ",504],["T_STRING","setCustomPrice",504],"(",["T_VARIABLE","$value",504],")",["T_WHITESPACE","\n    ",504],"{",["T_WHITESPACE","\n        ",505],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","setCalculationPrice",506],"(",["T_VARIABLE","$value",506],")",";",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","setBaseCalculationPrice",507],"(",["T_STRING","null",507],")",";",["T_WHITESPACE","\n        ",507],["T_RETURN","return",508],["T_WHITESPACE"," ",508],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","setData",508],"(",["T_CONSTANT_ENCAPSED_STRING","'custom_price'",508],",",["T_WHITESPACE"," ",508],["T_VARIABLE","$value",508],")",";",["T_WHITESPACE","\n    ",508],"}",["T_WHITESPACE","\n\n    ",509],["T_DOC_COMMENT","\/**\n     * Get item price. Item price currency is website base currency.\n     *\n     * @return decimal\n     *\/",511],["T_WHITESPACE","\n    ",515],["T_PUBLIC","public",516],["T_WHITESPACE"," ",516],["T_FUNCTION","function",516],["T_WHITESPACE"," ",516],["T_STRING","getPrice",516],"(",")",["T_WHITESPACE","\n    ",516],"{",["T_WHITESPACE","\n        ",517],["T_RETURN","return",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","_getData",518],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",518],")",";",["T_WHITESPACE","\n    ",518],"}",["T_WHITESPACE","\n\n    ",519],["T_DOC_COMMENT","\/**\n     * Specify item price (base calculation price and converted price will be refreshed too)\n     *\n     * @param   float $value\n     * @return  Mage_Sales_Model_Quote_Item_Abstract\n     *\/",521],["T_WHITESPACE","\n    ",526],["T_PUBLIC","public",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","setPrice",527],"(",["T_VARIABLE","$value",527],")",["T_WHITESPACE","\n    ",527],"{",["T_WHITESPACE","\n        ",528],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","setBaseCalculationPrice",529],"(",["T_STRING","null",529],")",";",["T_WHITESPACE","\n        ",529],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","setConvertedPrice",530],"(",["T_STRING","null",530],")",";",["T_WHITESPACE","\n        ",530],["T_RETURN","return",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","setData",531],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",531],",",["T_WHITESPACE"," ",531],["T_VARIABLE","$value",531],")",";",["T_WHITESPACE","\n    ",531],"}",["T_WHITESPACE","\n\n    ",532],["T_DOC_COMMENT","\/**\n     * Get item price converted to quote currency\n     * @return float\n     *\/",534],["T_WHITESPACE","\n    ",537],["T_PUBLIC","public",538],["T_WHITESPACE"," ",538],["T_FUNCTION","function",538],["T_WHITESPACE"," ",538],["T_STRING","getConvertedPrice",538],"(",")",["T_WHITESPACE","\n    ",538],"{",["T_WHITESPACE","\n        ",539],["T_VARIABLE","$price",540],["T_WHITESPACE"," ",540],"=",["T_WHITESPACE"," ",540],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","_getData",540],"(",["T_CONSTANT_ENCAPSED_STRING","'converted_price'",540],")",";",["T_WHITESPACE","\n        ",540],["T_IF","if",541],["T_WHITESPACE"," ",541],"(",["T_STRING","is_null",541],"(",["T_VARIABLE","$price",541],")",")",["T_WHITESPACE"," ",541],"{",["T_WHITESPACE","\n            ",541],["T_VARIABLE","$price",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getStore",542],"(",")",["T_OBJECT_OPERATOR","->",542],["T_STRING","convertPrice",542],"(",["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getPrice",542],"(",")",")",";",["T_WHITESPACE","\n            ",542],["T_VARIABLE","$this",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","setData",543],"(",["T_CONSTANT_ENCAPSED_STRING","'converted_price'",543],",",["T_WHITESPACE"," ",543],["T_VARIABLE","$price",543],")",";",["T_WHITESPACE","\n        ",543],"}",["T_WHITESPACE","\n        ",544],["T_RETURN","return",545],["T_WHITESPACE"," ",545],["T_VARIABLE","$price",545],";",["T_WHITESPACE","\n    ",545],"}",["T_WHITESPACE","\n\n    ",546],["T_DOC_COMMENT","\/**\n     * Set new value for converted price\n     * @param float $value\n     * @return Mage_Sales_Model_Quote_Item_Abstract\n     *\/",548],["T_WHITESPACE","\n    ",552],["T_PUBLIC","public",553],["T_WHITESPACE"," ",553],["T_FUNCTION","function",553],["T_WHITESPACE"," ",553],["T_STRING","setConvertedPrice",553],"(",["T_VARIABLE","$value",553],")",["T_WHITESPACE","\n    ",553],"{",["T_WHITESPACE","\n        ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","setCalculationPrice",555],"(",["T_STRING","null",555],")",";",["T_WHITESPACE","\n        ",555],["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","setData",556],"(",["T_CONSTANT_ENCAPSED_STRING","'converted_price'",556],",",["T_WHITESPACE"," ",556],["T_VARIABLE","$value",556],")",";",["T_WHITESPACE","\n        ",556],["T_RETURN","return",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],";",["T_WHITESPACE","\n    ",557],"}",["T_WHITESPACE","\n\n    ",558],["T_DOC_COMMENT","\/**\n     * Clone quote item\n     *\n     * @return Mage_Sales_Model_Quote_Item\n     *\/",560],["T_WHITESPACE","\n    ",564],["T_PUBLIC","public",565],["T_WHITESPACE"," ",565],["T_FUNCTION","function",565],["T_WHITESPACE"," ",565],["T_STRING","__clone",565],"(",")",["T_WHITESPACE","\n    ",565],"{",["T_WHITESPACE","\n        ",566],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","setId",567],"(",["T_STRING","null",567],")",";",["T_WHITESPACE","\n        ",567],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_parentItem",568],["T_WHITESPACE","  ",568],"=",["T_WHITESPACE"," ",568],["T_STRING","null",568],";",["T_WHITESPACE","\n        ",568],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_children",569],["T_WHITESPACE","    ",569],"=",["T_WHITESPACE"," ",569],["T_ARRAY","array",569],"(",")",";",["T_WHITESPACE","\n        ",569],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","_messages",570],["T_WHITESPACE","    ",570],"=",["T_WHITESPACE"," ",570],["T_ARRAY","array",570],"(",")",";",["T_WHITESPACE","\n        ",570],["T_RETURN","return",571],["T_WHITESPACE"," ",571],["T_VARIABLE","$this",571],";",["T_WHITESPACE","\n    ",571],"}",["T_WHITESPACE","\n\n    ",572],["T_DOC_COMMENT","\/**\n     * Checking if there children calculated or parent item\n     * when we have parent quote item and its children\n     *\n     * @return bool\n     *\/",574],["T_WHITESPACE","\n    ",579],["T_PUBLIC","public",580],["T_WHITESPACE"," ",580],["T_FUNCTION","function",580],["T_WHITESPACE"," ",580],["T_STRING","isChildrenCalculated",580],"(",")",["T_WHITESPACE","\n    ",580],"{",["T_WHITESPACE","\n        ",581],["T_IF","if",582],["T_WHITESPACE"," ",582],"(",["T_VARIABLE","$this",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","getParentItem",582],"(",")",")",["T_WHITESPACE"," ",582],"{",["T_WHITESPACE","\n            ",582],["T_VARIABLE","$calculate",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$this",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","getParentItem",583],"(",")",["T_OBJECT_OPERATOR","->",583],["T_STRING","getProduct",583],"(",")",["T_OBJECT_OPERATOR","->",583],["T_STRING","getPriceType",583],"(",")",";",["T_WHITESPACE","\n        ",583],"}",["T_WHITESPACE"," ",584],["T_ELSE","else",584],["T_WHITESPACE"," ",584],"{",["T_WHITESPACE","\n            ",584],["T_VARIABLE","$calculate",585],["T_WHITESPACE"," ",585],"=",["T_WHITESPACE"," ",585],["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","getProduct",585],"(",")",["T_OBJECT_OPERATOR","->",585],["T_STRING","getPriceType",585],"(",")",";",["T_WHITESPACE","\n        ",585],"}",["T_WHITESPACE","\n\n        ",586],["T_IF","if",588],["T_WHITESPACE"," ",588],"(","(",["T_STRING","null",588],["T_WHITESPACE"," ",588],["T_IS_NOT_IDENTICAL","!==",588],["T_WHITESPACE"," ",588],["T_VARIABLE","$calculate",588],")",["T_WHITESPACE"," ",588],["T_BOOLEAN_AND","&&",588],["T_WHITESPACE"," ",588],["T_INT_CAST","(int)",588],["T_VARIABLE","$calculate",588],["T_WHITESPACE"," ",588],["T_IS_IDENTICAL","===",588],["T_WHITESPACE"," ",588],["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",588],["T_DOUBLE_COLON","::",588],["T_STRING","CALCULATE_CHILD",588],")",["T_WHITESPACE"," ",588],"{",["T_WHITESPACE","\n            ",588],["T_RETURN","return",589],["T_WHITESPACE"," ",589],["T_STRING","true",589],";",["T_WHITESPACE","\n        ",589],"}",["T_WHITESPACE","\n        ",590],["T_RETURN","return",591],["T_WHITESPACE"," ",591],["T_STRING","false",591],";",["T_WHITESPACE","\n    ",591],"}",["T_WHITESPACE","\n\n    ",592],["T_DOC_COMMENT","\/**\n     * Checking can we ship product separatelly (each child separately)\n     * or each parent product item can be shipped only like one item\n     *\n     * @return bool\n     *\/",594],["T_WHITESPACE","\n    ",599],["T_PUBLIC","public",600],["T_WHITESPACE"," ",600],["T_FUNCTION","function",600],["T_WHITESPACE"," ",600],["T_STRING","isShipSeparately",600],"(",")",["T_WHITESPACE","\n    ",600],"{",["T_WHITESPACE","\n        ",601],["T_IF","if",602],["T_WHITESPACE"," ",602],"(",["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getParentItem",602],"(",")",")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n            ",602],["T_VARIABLE","$shipmentType",603],["T_WHITESPACE"," ",603],"=",["T_WHITESPACE"," ",603],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","getParentItem",603],"(",")",["T_OBJECT_OPERATOR","->",603],["T_STRING","getProduct",603],"(",")",["T_OBJECT_OPERATOR","->",603],["T_STRING","getShipmentType",603],"(",")",";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE"," ",604],["T_ELSE","else",604],["T_WHITESPACE"," ",604],"{",["T_WHITESPACE","\n            ",604],["T_VARIABLE","$shipmentType",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","getProduct",605],"(",")",["T_OBJECT_OPERATOR","->",605],["T_STRING","getShipmentType",605],"(",")",";",["T_WHITESPACE","\n        ",605],"}",["T_WHITESPACE","\n\n        ",606],["T_IF","if",608],["T_WHITESPACE"," ",608],"(","(",["T_STRING","null",608],["T_WHITESPACE"," ",608],["T_IS_NOT_IDENTICAL","!==",608],["T_WHITESPACE"," ",608],["T_VARIABLE","$shipmentType",608],")",["T_WHITESPACE"," ",608],["T_BOOLEAN_AND","&&",608],["T_WHITESPACE","\n            ",608],["T_INT_CAST","(int)",609],["T_VARIABLE","$shipmentType",609],["T_WHITESPACE"," ",609],["T_IS_IDENTICAL","===",609],["T_WHITESPACE"," ",609],["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",609],["T_DOUBLE_COLON","::",609],["T_STRING","SHIPMENT_SEPARATELY",609],")",["T_WHITESPACE"," ",609],"{",["T_WHITESPACE","\n            ",609],["T_RETURN","return",610],["T_WHITESPACE"," ",610],["T_STRING","true",610],";",["T_WHITESPACE","\n        ",610],"}",["T_WHITESPACE","\n        ",611],["T_RETURN","return",612],["T_WHITESPACE"," ",612],["T_STRING","false",612],";",["T_WHITESPACE","\n    ",612],"}",["T_WHITESPACE","\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    ",613],["T_DOC_COMMENT","\/**\n     * Calculate item tax amount\n     *\n     * @deprecated logic moved to tax totals calculation model\n     * @return  Mage_Sales_Model_Quote_Item\n     *\/",635],["T_WHITESPACE","\n    ",640],["T_PUBLIC","public",641],["T_WHITESPACE"," ",641],["T_FUNCTION","function",641],["T_WHITESPACE"," ",641],["T_STRING","calcTaxAmount",641],"(",")",["T_WHITESPACE","\n    ",641],"{",["T_WHITESPACE","\n        ",642],["T_VARIABLE","$store",643],["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","getStore",643],"(",")",";",["T_WHITESPACE","\n\n        ",643],["T_IF","if",645],["T_WHITESPACE"," ",645],"(","!",["T_STRING","Mage",645],["T_DOUBLE_COLON","::",645],["T_STRING","helper",645],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",645],")",["T_OBJECT_OPERATOR","->",645],["T_STRING","priceIncludesTax",645],"(",["T_VARIABLE","$store",645],")",")",["T_WHITESPACE"," ",645],"{",["T_WHITESPACE","\n            ",645],["T_IF","if",646],["T_WHITESPACE"," ",646],"(",["T_STRING","Mage",646],["T_DOUBLE_COLON","::",646],["T_STRING","helper",646],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",646],")",["T_OBJECT_OPERATOR","->",646],["T_STRING","applyTaxAfterDiscount",646],"(",["T_VARIABLE","$store",646],")",")",["T_WHITESPACE"," ",646],"{",["T_WHITESPACE","\n                ",646],["T_VARIABLE","$rowTotal",647],["T_WHITESPACE","       ",647],"=",["T_WHITESPACE"," ",647],["T_VARIABLE","$this",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","getRowTotalWithDiscount",647],"(",")",";",["T_WHITESPACE","\n                ",647],["T_VARIABLE","$rowBaseTotal",648],["T_WHITESPACE","   ",648],"=",["T_WHITESPACE"," ",648],["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getBaseRowTotalWithDiscount",648],"(",")",";",["T_WHITESPACE","\n            ",648],"}",["T_WHITESPACE"," ",649],["T_ELSE","else",649],["T_WHITESPACE"," ",649],"{",["T_WHITESPACE","\n                ",649],["T_VARIABLE","$rowTotal",650],["T_WHITESPACE","       ",650],"=",["T_WHITESPACE"," ",650],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","getRowTotal",650],"(",")",";",["T_WHITESPACE","\n                ",650],["T_VARIABLE","$rowBaseTotal",651],["T_WHITESPACE","   ",651],"=",["T_WHITESPACE"," ",651],["T_VARIABLE","$this",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","getBaseRowTotal",651],"(",")",";",["T_WHITESPACE","\n            ",651],"}",["T_WHITESPACE","\n\n            ",652],["T_VARIABLE","$taxPercent",654],["T_WHITESPACE"," ",654],"=",["T_WHITESPACE"," ",654],["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","getTaxPercent",654],"(",")","\/",["T_LNUMBER","100",654],";",["T_WHITESPACE","\n\n            ",654],["T_VARIABLE","$this",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","setTaxAmount",656],"(",["T_VARIABLE","$store",656],["T_OBJECT_OPERATOR","->",656],["T_STRING","roundPrice",656],"(",["T_VARIABLE","$rowTotal",656],["T_WHITESPACE"," ",656],"*",["T_WHITESPACE"," ",656],["T_VARIABLE","$taxPercent",656],")",")",";",["T_WHITESPACE","\n            ",656],["T_VARIABLE","$this",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","setBaseTaxAmount",657],"(",["T_VARIABLE","$store",657],["T_OBJECT_OPERATOR","->",657],["T_STRING","roundPrice",657],"(",["T_VARIABLE","$rowBaseTotal",657],["T_WHITESPACE"," ",657],"*",["T_WHITESPACE"," ",657],["T_VARIABLE","$taxPercent",657],")",")",";",["T_WHITESPACE","\n\n            ",657],["T_VARIABLE","$rowTotal",659],["T_WHITESPACE","       ",659],"=",["T_WHITESPACE"," ",659],["T_VARIABLE","$this",659],["T_OBJECT_OPERATOR","->",659],["T_STRING","getRowTotal",659],"(",")",";",["T_WHITESPACE","\n            ",659],["T_VARIABLE","$rowBaseTotal",660],["T_WHITESPACE","   ",660],"=",["T_WHITESPACE"," ",660],["T_VARIABLE","$this",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","getBaseRowTotal",660],"(",")",";",["T_WHITESPACE","\n            ",660],["T_VARIABLE","$this",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","setTaxBeforeDiscount",661],"(",["T_VARIABLE","$store",661],["T_OBJECT_OPERATOR","->",661],["T_STRING","roundPrice",661],"(",["T_VARIABLE","$rowTotal",661],["T_WHITESPACE"," ",661],"*",["T_WHITESPACE"," ",661],["T_VARIABLE","$taxPercent",661],")",")",";",["T_WHITESPACE","\n            ",661],["T_VARIABLE","$this",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","setBaseTaxBeforeDiscount",662],"(",["T_VARIABLE","$store",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","roundPrice",662],"(",["T_VARIABLE","$rowBaseTotal",662],["T_WHITESPACE"," ",662],"*",["T_WHITESPACE"," ",662],["T_VARIABLE","$taxPercent",662],")",")",";",["T_WHITESPACE","\n        ",662],"}",["T_WHITESPACE"," ",663],["T_ELSE","else",663],["T_WHITESPACE"," ",663],"{",["T_WHITESPACE","\n            ",663],["T_IF","if",664],["T_WHITESPACE"," ",664],"(",["T_STRING","Mage",664],["T_DOUBLE_COLON","::",664],["T_STRING","helper",664],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",664],")",["T_OBJECT_OPERATOR","->",664],["T_STRING","applyTaxAfterDiscount",664],"(",["T_VARIABLE","$store",664],")",")",["T_WHITESPACE"," ",664],"{",["T_WHITESPACE","\n                ",664],["T_VARIABLE","$totalBaseTax",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","getBaseTaxAmount",665],"(",")",";",["T_WHITESPACE","\n                ",665],["T_VARIABLE","$totalTax",666],["T_WHITESPACE"," ",666],"=",["T_WHITESPACE"," ",666],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getTaxAmount",666],"(",")",";",["T_WHITESPACE","\n\n                ",666],["T_IF","if",668],["T_WHITESPACE"," ",668],"(",["T_VARIABLE","$totalTax",668],["T_WHITESPACE"," ",668],["T_BOOLEAN_AND","&&",668],["T_WHITESPACE"," ",668],["T_VARIABLE","$totalBaseTax",668],")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n                    ",668],["T_VARIABLE","$totalTax",669],["T_WHITESPACE"," ",669],["T_MINUS_EQUAL","-=",669],["T_WHITESPACE"," ",669],["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getDiscountAmount",669],"(",")",["T_WHITESPACE"," ",669],"*",["T_WHITESPACE"," ",669],"(",["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getTaxPercent",669],"(",")",["T_WHITESPACE"," ",669],"\/",["T_WHITESPACE"," ",669],["T_LNUMBER","100",669],")",";",["T_WHITESPACE","\n                    ",669],["T_VARIABLE","$totalBaseTax",670],["T_WHITESPACE"," ",670],["T_MINUS_EQUAL","-=",670],["T_WHITESPACE"," ",670],["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getBaseDiscountAmount",670],"(",")",["T_WHITESPACE"," ",670],"*",["T_WHITESPACE"," ",670],"(",["T_VARIABLE","$this",670],["T_OBJECT_OPERATOR","->",670],["T_STRING","getTaxPercent",670],"(",")",["T_WHITESPACE"," ",670],"\/",["T_WHITESPACE"," ",670],["T_LNUMBER","100",670],")",";",["T_WHITESPACE","\n\n                    ",670],["T_VARIABLE","$this",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","setBaseTaxAmount",672],"(",["T_VARIABLE","$store",672],["T_OBJECT_OPERATOR","->",672],["T_STRING","roundPrice",672],"(",["T_VARIABLE","$totalBaseTax",672],")",")",";",["T_WHITESPACE","\n                    ",672],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","setTaxAmount",673],"(",["T_VARIABLE","$store",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","roundPrice",673],"(",["T_VARIABLE","$totalTax",673],")",")",";",["T_WHITESPACE","\n                ",673],"}",["T_WHITESPACE","\n            ",674],"}",["T_WHITESPACE","\n        ",675],"}",["T_WHITESPACE","\n\n        ",676],["T_IF","if",678],["T_WHITESPACE"," ",678],"(",["T_STRING","Mage",678],["T_DOUBLE_COLON","::",678],["T_STRING","helper",678],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",678],")",["T_OBJECT_OPERATOR","->",678],["T_STRING","discountTax",678],"(",["T_VARIABLE","$store",678],")",["T_WHITESPACE"," ",678],["T_BOOLEAN_AND","&&",678],["T_WHITESPACE"," ",678],"!",["T_STRING","Mage",678],["T_DOUBLE_COLON","::",678],["T_STRING","helper",678],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",678],")",["T_OBJECT_OPERATOR","->",678],["T_STRING","applyTaxAfterDiscount",678],"(",["T_VARIABLE","$store",678],")",")",["T_WHITESPACE"," ",678],"{",["T_WHITESPACE","\n            ",678],["T_IF","if",679],["T_WHITESPACE"," ",679],"(",["T_VARIABLE","$this",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getDiscountPercent",679],"(",")",")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n                ",679],["T_VARIABLE","$baseTaxAmount",680],["T_WHITESPACE"," ",680],"=",["T_WHITESPACE","  ",680],["T_VARIABLE","$this",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","getBaseTaxBeforeDiscount",680],"(",")",";",["T_WHITESPACE","\n                ",680],["T_VARIABLE","$taxAmount",681],["T_WHITESPACE"," ",681],"=",["T_WHITESPACE"," ",681],["T_VARIABLE","$this",681],["T_OBJECT_OPERATOR","->",681],["T_STRING","getTaxBeforeDiscount",681],"(",")",";",["T_WHITESPACE","\n\n                ",681],["T_VARIABLE","$baseDiscountDisposition",683],["T_WHITESPACE"," ",683],"=",["T_WHITESPACE"," ",683],["T_VARIABLE","$baseTaxAmount",683],"\/",["T_LNUMBER","100",683],"*",["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getDiscountPercent",683],"(",")",";",["T_WHITESPACE","\n                ",683],["T_VARIABLE","$discountDisposition",684],["T_WHITESPACE"," ",684],"=",["T_WHITESPACE"," ",684],["T_VARIABLE","$taxAmount",684],"\/",["T_LNUMBER","100",684],"*",["T_VARIABLE","$this",684],["T_OBJECT_OPERATOR","->",684],["T_STRING","getDiscountPercent",684],"(",")",";",["T_WHITESPACE","\n\n                ",684],["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","setDiscountAmount",686],"(",["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","getDiscountAmount",686],"(",")","+",["T_VARIABLE","$discountDisposition",686],")",";",["T_WHITESPACE","\n                ",686],["T_VARIABLE","$this",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","setBaseDiscountAmount",687],"(",["T_VARIABLE","$this",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","getBaseDiscountAmount",687],"(",")","+",["T_VARIABLE","$baseDiscountDisposition",687],")",";",["T_WHITESPACE","\n            ",687],"}",["T_WHITESPACE","\n        ",688],"}",["T_WHITESPACE","\n\n        ",689],["T_RETURN","return",691],["T_WHITESPACE"," ",691],["T_VARIABLE","$this",691],";",["T_WHITESPACE","\n    ",691],"}",["T_WHITESPACE","\n\n    ",692],["T_DOC_COMMENT","\/**\n     * Get item tax amount\n     *\n     * @deprecated\n     * @return  decimal\n     *\/",694],["T_WHITESPACE","\n    ",699],["T_PUBLIC","public",700],["T_WHITESPACE"," ",700],["T_FUNCTION","function",700],["T_WHITESPACE"," ",700],["T_STRING","getTaxAmount",700],"(",")",["T_WHITESPACE","\n    ",700],"{",["T_WHITESPACE","\n        ",701],["T_RETURN","return",702],["T_WHITESPACE"," ",702],["T_VARIABLE","$this",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","_getData",702],"(",["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",702],")",";",["T_WHITESPACE","\n    ",702],"}",["T_WHITESPACE","\n\n\n    ",703],["T_DOC_COMMENT","\/**\n     * Get item base tax amount\n     *\n     * @deprecated\n     * @return decimal\n     *\/",706],["T_WHITESPACE","\n    ",711],["T_PUBLIC","public",712],["T_WHITESPACE"," ",712],["T_FUNCTION","function",712],["T_WHITESPACE"," ",712],["T_STRING","getBaseTaxAmount",712],"(",")",["T_WHITESPACE","\n    ",712],"{",["T_WHITESPACE","\n        ",713],["T_RETURN","return",714],["T_WHITESPACE"," ",714],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","_getData",714],"(",["T_CONSTANT_ENCAPSED_STRING","'base_tax_amount'",714],")",";",["T_WHITESPACE","\n    ",714],"}",["T_WHITESPACE","\n\n    ",715],["T_DOC_COMMENT","\/**\n     * Get item price (item price always exclude price)\n     *\n     * @deprecated\n     * @return decimal\n     *\/",717],["T_WHITESPACE","\n    ",722],["T_PROTECTED","protected",723],["T_WHITESPACE"," ",723],["T_FUNCTION","function",723],["T_WHITESPACE"," ",723],["T_STRING","_calculatePrice",723],"(",["T_VARIABLE","$value",723],",",["T_WHITESPACE"," ",723],["T_VARIABLE","$saveTaxes",723],["T_WHITESPACE"," ",723],"=",["T_WHITESPACE"," ",723],["T_STRING","true",723],")",["T_WHITESPACE","\n    ",723],"{",["T_WHITESPACE","\n        ",724],["T_VARIABLE","$store",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_VARIABLE","$this",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","getQuote",725],"(",")",["T_OBJECT_OPERATOR","->",725],["T_STRING","getStore",725],"(",")",";",["T_WHITESPACE","\n\n        ",725],["T_IF","if",727],["T_WHITESPACE"," ",727],"(",["T_STRING","Mage",727],["T_DOUBLE_COLON","::",727],["T_STRING","helper",727],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",727],")",["T_OBJECT_OPERATOR","->",727],["T_STRING","priceIncludesTax",727],"(",["T_VARIABLE","$store",727],")",")",["T_WHITESPACE"," ",727],"{",["T_WHITESPACE","\n            ",727],["T_VARIABLE","$bAddress",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_VARIABLE","$this",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","getQuote",728],"(",")",["T_OBJECT_OPERATOR","->",728],["T_STRING","getBillingAddress",728],"(",")",";",["T_WHITESPACE","\n            ",728],["T_VARIABLE","$sAddress",729],["T_WHITESPACE"," ",729],"=",["T_WHITESPACE"," ",729],["T_VARIABLE","$this",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","getQuote",729],"(",")",["T_OBJECT_OPERATOR","->",729],["T_STRING","getShippingAddress",729],"(",")",";",["T_WHITESPACE","\n\n            ",729],["T_VARIABLE","$address",731],["T_WHITESPACE"," ",731],"=",["T_WHITESPACE"," ",731],["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getAddress",731],"(",")",";",["T_WHITESPACE","\n\n            ",731],["T_IF","if",733],["T_WHITESPACE"," ",733],"(",["T_VARIABLE","$address",733],")",["T_WHITESPACE"," ",733],"{",["T_WHITESPACE","\n                ",733],["T_SWITCH","switch",734],["T_WHITESPACE"," ",734],"(",["T_VARIABLE","$address",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","getAddressType",734],"(",")",")",["T_WHITESPACE"," ",734],"{",["T_WHITESPACE","\n                    ",734],["T_CASE","case",735],["T_WHITESPACE"," ",735],["T_STRING","Mage_Sales_Model_Quote_Address",735],["T_DOUBLE_COLON","::",735],["T_STRING","TYPE_BILLING",735],":",["T_WHITESPACE","\n                        ",735],["T_VARIABLE","$bAddress",736],["T_WHITESPACE"," ",736],"=",["T_WHITESPACE"," ",736],["T_VARIABLE","$address",736],";",["T_WHITESPACE","\n                        ",736],["T_BREAK","break",737],";",["T_WHITESPACE","\n                    ",737],["T_CASE","case",738],["T_WHITESPACE"," ",738],["T_STRING","Mage_Sales_Model_Quote_Address",738],["T_DOUBLE_COLON","::",738],["T_STRING","TYPE_SHIPPING",738],":",["T_WHITESPACE","\n                        ",738],["T_VARIABLE","$sAddress",739],["T_WHITESPACE"," ",739],"=",["T_WHITESPACE"," ",739],["T_VARIABLE","$address",739],";",["T_WHITESPACE","\n                        ",739],["T_BREAK","break",740],";",["T_WHITESPACE","\n                ",740],"}",["T_WHITESPACE","\n            ",741],"}",["T_WHITESPACE","\n\n            ",742],["T_IF","if",744],["T_WHITESPACE"," ",744],"(",["T_VARIABLE","$this",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","getProduct",744],"(",")",["T_OBJECT_OPERATOR","->",744],["T_STRING","getIsVirtual",744],"(",")",")",["T_WHITESPACE"," ",744],"{",["T_WHITESPACE","\n                ",744],["T_VARIABLE","$sAddress",745],["T_WHITESPACE"," ",745],"=",["T_WHITESPACE"," ",745],["T_VARIABLE","$bAddress",745],";",["T_WHITESPACE","\n            ",745],"}",["T_WHITESPACE","\n\n            ",746],["T_VARIABLE","$priceExcludingTax",748],["T_WHITESPACE"," ",748],"=",["T_WHITESPACE"," ",748],["T_STRING","Mage",748],["T_DOUBLE_COLON","::",748],["T_STRING","helper",748],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",748],")",["T_OBJECT_OPERATOR","->",748],["T_STRING","getPrice",748],"(",["T_WHITESPACE","\n                ",748],["T_VARIABLE","$this",749],["T_OBJECT_OPERATOR","->",749],["T_STRING","getProduct",749],"(",")",["T_OBJECT_OPERATOR","->",749],["T_STRING","setTaxPercent",749],"(",["T_STRING","null",749],")",",",["T_WHITESPACE","\n                ",749],["T_VARIABLE","$value",750],",",["T_WHITESPACE","\n                ",750],["T_STRING","false",751],",",["T_WHITESPACE","\n                ",751],["T_VARIABLE","$sAddress",752],",",["T_WHITESPACE","\n                ",752],["T_VARIABLE","$bAddress",753],",",["T_WHITESPACE","\n                ",753],["T_VARIABLE","$this",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","getQuote",754],"(",")",["T_OBJECT_OPERATOR","->",754],["T_STRING","getCustomerTaxClassId",754],"(",")",",",["T_WHITESPACE","\n                ",754],["T_VARIABLE","$store",755],["T_WHITESPACE","\n            ",755],")",";",["T_WHITESPACE","\n\n            ",756],["T_VARIABLE","$priceIncludingTax",758],["T_WHITESPACE"," ",758],"=",["T_WHITESPACE"," ",758],["T_STRING","Mage",758],["T_DOUBLE_COLON","::",758],["T_STRING","helper",758],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",758],")",["T_OBJECT_OPERATOR","->",758],["T_STRING","getPrice",758],"(",["T_WHITESPACE","\n                ",758],["T_VARIABLE","$this",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","getProduct",759],"(",")",["T_OBJECT_OPERATOR","->",759],["T_STRING","setTaxPercent",759],"(",["T_STRING","null",759],")",",",["T_WHITESPACE","\n                ",759],["T_VARIABLE","$value",760],",",["T_WHITESPACE","\n                ",760],["T_STRING","true",761],",",["T_WHITESPACE","\n                ",761],["T_VARIABLE","$sAddress",762],",",["T_WHITESPACE","\n                ",762],["T_VARIABLE","$bAddress",763],",",["T_WHITESPACE","\n                ",763],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","getQuote",764],"(",")",["T_OBJECT_OPERATOR","->",764],["T_STRING","getCustomerTaxClassId",764],"(",")",",",["T_WHITESPACE","\n                ",764],["T_VARIABLE","$store",765],["T_WHITESPACE","\n            ",765],")",";",["T_WHITESPACE","\n\n            ",766],["T_IF","if",768],["T_WHITESPACE"," ",768],"(",["T_VARIABLE","$saveTaxes",768],")",["T_WHITESPACE"," ",768],"{",["T_WHITESPACE","\n                ",768],["T_VARIABLE","$qty",769],["T_WHITESPACE"," ",769],"=",["T_WHITESPACE"," ",769],["T_VARIABLE","$this",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","getQty",769],"(",")",";",["T_WHITESPACE","\n                ",769],["T_IF","if",770],["T_WHITESPACE"," ",770],"(",["T_VARIABLE","$this",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","getParentItem",770],"(",")",")",["T_WHITESPACE"," ",770],"{",["T_WHITESPACE","\n                    ",770],["T_VARIABLE","$qty",771],["T_WHITESPACE"," ",771],"=",["T_WHITESPACE"," ",771],["T_VARIABLE","$qty",771],"*",["T_VARIABLE","$this",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getParentItem",771],"(",")",["T_OBJECT_OPERATOR","->",771],["T_STRING","getQty",771],"(",")",";",["T_WHITESPACE","\n                ",771],"}",["T_WHITESPACE","\n\n                ",772],["T_IF","if",774],["T_WHITESPACE"," ",774],"(",["T_STRING","Mage",774],["T_DOUBLE_COLON","::",774],["T_STRING","helper",774],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",774],")",["T_OBJECT_OPERATOR","->",774],["T_STRING","displayCartPriceInclTax",774],"(",["T_VARIABLE","$store",774],")",")",["T_WHITESPACE"," ",774],"{",["T_WHITESPACE","\n                    ",774],["T_VARIABLE","$rowTotal",775],["T_WHITESPACE"," ",775],"=",["T_WHITESPACE"," ",775],["T_VARIABLE","$value",775],"*",["T_VARIABLE","$qty",775],";",["T_WHITESPACE","\n                    ",775],["T_VARIABLE","$rowTotalExcTax",776],["T_WHITESPACE"," ",776],"=",["T_WHITESPACE"," ",776],["T_STRING","Mage",776],["T_DOUBLE_COLON","::",776],["T_STRING","helper",776],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",776],")",["T_OBJECT_OPERATOR","->",776],["T_STRING","getPrice",776],"(",["T_WHITESPACE","\n                        ",776],["T_VARIABLE","$this",777],["T_OBJECT_OPERATOR","->",777],["T_STRING","getProduct",777],"(",")",["T_OBJECT_OPERATOR","->",777],["T_STRING","setTaxPercent",777],"(",["T_STRING","null",777],")",",",["T_WHITESPACE","\n                        ",777],["T_VARIABLE","$rowTotal",778],",",["T_WHITESPACE","\n                        ",778],["T_STRING","false",779],",",["T_WHITESPACE","\n                        ",779],["T_VARIABLE","$sAddress",780],",",["T_WHITESPACE","\n                        ",780],["T_VARIABLE","$bAddress",781],",",["T_WHITESPACE","\n                        ",781],["T_VARIABLE","$this",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","getQuote",782],"(",")",["T_OBJECT_OPERATOR","->",782],["T_STRING","getCustomerTaxClassId",782],"(",")",",",["T_WHITESPACE","\n                        ",782],["T_VARIABLE","$store",783],["T_WHITESPACE","\n                    ",783],")",";",["T_WHITESPACE","\n                    ",784],["T_VARIABLE","$rowTotalIncTax",785],["T_WHITESPACE"," ",785],"=",["T_WHITESPACE"," ",785],["T_STRING","Mage",785],["T_DOUBLE_COLON","::",785],["T_STRING","helper",785],"(",["T_CONSTANT_ENCAPSED_STRING","'tax'",785],")",["T_OBJECT_OPERATOR","->",785],["T_STRING","getPrice",785],"(",["T_WHITESPACE","\n                        ",785],["T_VARIABLE","$this",786],["T_OBJECT_OPERATOR","->",786],["T_STRING","getProduct",786],"(",")",["T_OBJECT_OPERATOR","->",786],["T_STRING","setTaxPercent",786],"(",["T_STRING","null",786],")",",",["T_WHITESPACE","\n                        ",786],["T_VARIABLE","$rowTotal",787],",",["T_WHITESPACE","\n                        ",787],["T_STRING","true",788],",",["T_WHITESPACE","\n                        ",788],["T_VARIABLE","$sAddress",789],",",["T_WHITESPACE","\n                        ",789],["T_VARIABLE","$bAddress",790],",",["T_WHITESPACE","\n                        ",790],["T_VARIABLE","$this",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","getQuote",791],"(",")",["T_OBJECT_OPERATOR","->",791],["T_STRING","getCustomerTaxClassId",791],"(",")",",",["T_WHITESPACE","\n                        ",791],["T_VARIABLE","$store",792],["T_WHITESPACE","\n                    ",792],")",";",["T_WHITESPACE","\n                    ",793],["T_VARIABLE","$totalBaseTax",794],["T_WHITESPACE"," ",794],"=",["T_WHITESPACE"," ",794],["T_VARIABLE","$rowTotalIncTax",794],"-",["T_VARIABLE","$rowTotalExcTax",794],";",["T_WHITESPACE","\n                    ",794],["T_VARIABLE","$this",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","setRowTotalExcTax",795],"(",["T_VARIABLE","$rowTotalExcTax",795],")",";",["T_WHITESPACE","\n                ",795],"}",["T_WHITESPACE","\n                ",796],["T_ELSE","else",797],["T_WHITESPACE"," ",797],"{",["T_WHITESPACE","\n                    ",797],["T_VARIABLE","$taxAmount",798],["T_WHITESPACE"," ",798],"=",["T_WHITESPACE"," ",798],["T_VARIABLE","$priceIncludingTax",798],["T_WHITESPACE"," ",798],"-",["T_WHITESPACE"," ",798],["T_VARIABLE","$priceExcludingTax",798],";",["T_WHITESPACE","\n                    ",798],["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","setTaxPercent",799],"(",["T_VARIABLE","$this",799],["T_OBJECT_OPERATOR","->",799],["T_STRING","getProduct",799],"(",")",["T_OBJECT_OPERATOR","->",799],["T_STRING","getTaxPercent",799],"(",")",")",";",["T_WHITESPACE","\n                    ",799],["T_VARIABLE","$totalBaseTax",800],["T_WHITESPACE"," ",800],"=",["T_WHITESPACE"," ",800],["T_VARIABLE","$taxAmount",800],"*",["T_VARIABLE","$qty",800],";",["T_WHITESPACE","\n                ",800],"}",["T_WHITESPACE","\n\n                ",801],["T_VARIABLE","$totalTax",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_VARIABLE","$this",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","getStore",803],"(",")",["T_OBJECT_OPERATOR","->",803],["T_STRING","convertPrice",803],"(",["T_VARIABLE","$totalBaseTax",803],")",";",["T_WHITESPACE","\n                ",803],["T_VARIABLE","$this",804],["T_OBJECT_OPERATOR","->",804],["T_STRING","setTaxBeforeDiscount",804],"(",["T_VARIABLE","$totalTax",804],")",";",["T_WHITESPACE","\n                ",804],["T_VARIABLE","$this",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","setBaseTaxBeforeDiscount",805],"(",["T_VARIABLE","$totalBaseTax",805],")",";",["T_WHITESPACE","\n\n                ",805],["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","setTaxAmount",807],"(",["T_VARIABLE","$totalTax",807],")",";",["T_WHITESPACE","\n                ",807],["T_VARIABLE","$this",808],["T_OBJECT_OPERATOR","->",808],["T_STRING","setBaseTaxAmount",808],"(",["T_VARIABLE","$totalBaseTax",808],")",";",["T_WHITESPACE","\n            ",808],"}",["T_WHITESPACE","\n\n            ",809],["T_VARIABLE","$value",811],["T_WHITESPACE"," ",811],"=",["T_WHITESPACE"," ",811],["T_VARIABLE","$priceExcludingTax",811],";",["T_WHITESPACE","\n        ",811],"}",["T_WHITESPACE","\n\n        ",812],["T_RETURN","return",814],["T_WHITESPACE"," ",814],["T_VARIABLE","$value",814],";",["T_WHITESPACE","\n    ",814],"}",["T_WHITESPACE","\n",815],"}",["T_WHITESPACE","\n",816]]