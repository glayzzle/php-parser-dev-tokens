[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Payment transaction model\n * Tracks transaction history, allows to build transactions hierarchy\n * By default transactions are saved as closed.\n *\n * @method Mage_Sales_Model_Resource_Order_Payment_Transaction _getResource()\n * @method Mage_Sales_Model_Resource_Order_Payment_Transaction getResource()\n * @method int getParentId()\n * @method Mage_Sales_Model_Order_Payment_Transaction setParentId(int $value)\n * @method Mage_Sales_Model_Order_Payment_Transaction setOrderId(int $value)\n * @method int getPaymentId()\n * @method Mage_Sales_Model_Order_Payment_Transaction setPaymentId(int $value)\n * @method string getTxnId()\n * @method string getParentTxnId()\n * @method string getTxnType()\n * @method int getIsClosed()\n * @method Mage_Sales_Model_Order_Payment_Transaction setIsClosed(int $value)\n * @method string getCreatedAt()\n * @method Mage_Sales_Model_Order_Payment_Transaction setCreatedAt(string $value)\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",50],["T_CLASS","class",51],["T_WHITESPACE"," ",51],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",51],["T_WHITESPACE"," ",51],["T_EXTENDS","extends",51],["T_WHITESPACE"," ",51],["T_STRING","Mage_Core_Model_Abstract",51],["T_WHITESPACE","\n",51],"{",["T_WHITESPACE","\n    ",52],["T_DOC_COMMENT","\/**\n     * Supported transaction types\n     * @var string\n     *\/",53],["T_WHITESPACE","\n    ",56],["T_CONST","const",57],["T_WHITESPACE"," ",57],["T_STRING","TYPE_PAYMENT",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'payment'",57],";",["T_WHITESPACE","\n    ",57],["T_CONST","const",58],["T_WHITESPACE"," ",58],["T_STRING","TYPE_ORDER",58],["T_WHITESPACE","   ",58],"=",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'order'",58],";",["T_WHITESPACE","\n    ",58],["T_CONST","const",59],["T_WHITESPACE"," ",59],["T_STRING","TYPE_AUTH",59],["T_WHITESPACE","    ",59],"=",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'authorization'",59],";",["T_WHITESPACE","\n    ",59],["T_CONST","const",60],["T_WHITESPACE"," ",60],["T_STRING","TYPE_CAPTURE",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'capture'",60],";",["T_WHITESPACE","\n    ",60],["T_CONST","const",61],["T_WHITESPACE"," ",61],["T_STRING","TYPE_VOID",61],["T_WHITESPACE","    ",61],"=",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'void'",61],";",["T_WHITESPACE","\n    ",61],["T_CONST","const",62],["T_WHITESPACE"," ",62],["T_STRING","TYPE_REFUND",62],["T_WHITESPACE","  ",62],"=",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'refund'",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Raw details key in additional info\n     *\n     *\/",64],["T_WHITESPACE","\n    ",67],["T_CONST","const",68],["T_WHITESPACE"," ",68],["T_STRING","RAW_DETAILS",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'raw_details_info'",68],";",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Payment instance. Required for most transaction writing and search operations\n     * @var Mage_Sales_Model_Order_Payment\n     *\/",70],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$_paymentObject",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","null",74],";",["T_WHITESPACE","\n\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Order instance\n     *\n     * @var Mage_Sales_Model_Order_Payment\n     *\/",77],["T_WHITESPACE","\n    ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$_order",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","null",82],";",["T_WHITESPACE","\n\n    ",82],["T_DOC_COMMENT","\/**\n     * Parent transaction instance\n     * @var Mage_Sales_Model_Order_Payment_Transaction\n     *\/",84],["T_WHITESPACE","\n    ",87],["T_PROTECTED","protected",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$_parentTransaction",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_STRING","null",88],";",["T_WHITESPACE","\n\n    ",88],["T_DOC_COMMENT","\/**\n     * Child transactions, assoc array of transaction_id => instance\n     * @var array\n     *\/",90],["T_WHITESPACE","\n    ",93],["T_PROTECTED","protected",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$_children",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","null",94],";",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Child transactions, assoc array of txn_id => instance\n     * Filled only in case when all child transactions have txn_id\n     * Used for quicker search of child transactions using isset() as oposite to foreaching $_children\n     * @var array\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PROTECTED","protected",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$_identifiedChildren",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","null",102],";",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Whether to perform automatic actions on transactions, such as auto-closing and putting as a parent\n     * @var bool\n     *\/",104],["T_WHITESPACE","\n    ",107],["T_PROTECTED","protected",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$_transactionsAutoLinking",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","true",108],";",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Whether to throw exceptions on different operations\n     *\n     * @var bool\n     *\/",110],["T_WHITESPACE","\n    ",114],["T_PROTECTED","protected",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$_isFailsafe",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","false",115],";",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Whether transaction has children\n     * @var bool\n     *\/",117],["T_WHITESPACE","\n    ",120],["T_PROTECTED","protected",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$_hasChild",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_STRING","null",121],";",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Event object prefix\n     *\n     * @see Mage_Core_Model_Absctract::$_eventPrefix\n     * @var string\n     *\/",123],["T_WHITESPACE","\n    ",128],["T_PROTECTED","protected",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$_eventPrefix",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'sales_order_payment_transaction'",129],";",["T_WHITESPACE","\n\n    ",129],["T_DOC_COMMENT","\/**\n     * Event object prefix\n     *\n     * @see Mage_Core_Model_Absctract::$_eventObject\n     * @var string\n     *\/",131],["T_WHITESPACE","\n    ",136],["T_PROTECTED","protected",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$_eventObject",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'order_payment_transaction'",137],";",["T_WHITESPACE","\n\n    ",137],["T_DOC_COMMENT","\/**\n     * Order website id\n     *\n     * @var int\n     *\/",139],["T_WHITESPACE","\n    ",143],["T_PROTECTED","protected",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$_orderWebsiteId",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","null",144],";",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * Initialize resource model\n     *\/",146],["T_WHITESPACE","\n    ",148],["T_PROTECTED","protected",149],["T_WHITESPACE"," ",149],["T_FUNCTION","function",149],["T_WHITESPACE"," ",149],["T_STRING","_construct",149],"(",")",["T_WHITESPACE","\n    ",149],"{",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_init",151],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_payment_transaction'",151],")",";",["T_WHITESPACE","\n        ",151],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_STRING","parent",152],["T_DOUBLE_COLON","::",152],["T_STRING","_construct",152],"(",")",";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_DOC_COMMENT","\/**\n     * Payment instance setter\n     * @param Mage_Sales_Model_Order_Payment $payment\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",155],["T_WHITESPACE","\n    ",159],["T_PUBLIC","public",160],["T_WHITESPACE"," ",160],["T_FUNCTION","function",160],["T_WHITESPACE"," ",160],["T_STRING","setOrderPaymentObject",160],"(",["T_STRING","Mage_Sales_Model_Order_Payment",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$payment",160],")",["T_WHITESPACE","\n    ",160],"{",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_paymentObject",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$payment",162],";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","setOrder",163],"(",["T_VARIABLE","$payment",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getOrder",163],"(",")",")",";",["T_WHITESPACE","\n        ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],";",["T_WHITESPACE","\n    ",164],"}",["T_WHITESPACE","\n\n    ",165],["T_DOC_COMMENT","\/**\n     * Transaction ID setter\n     * @param string $txnId\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",167],["T_WHITESPACE","\n    ",171],["T_PUBLIC","public",172],["T_WHITESPACE"," ",172],["T_FUNCTION","function",172],["T_WHITESPACE"," ",172],["T_STRING","setTxnId",172],"(",["T_VARIABLE","$txnId",172],")",["T_WHITESPACE","\n    ",172],"{",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","_verifyTxnId",174],"(",["T_VARIABLE","$txnId",174],")",";",["T_WHITESPACE","\n        ",174],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","setData",175],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$txnId",175],")",";",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n\n    ",176],["T_DOC_COMMENT","\/**\n     * Parent transaction ID setter\n     * Can set the transaction id as well\n     * @param string $parentTxnId\n     * @param string $txnId\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     * @throws Mage_Core_Exception\n     *\/",178],["T_WHITESPACE","\n    ",185],["T_PUBLIC","public",186],["T_WHITESPACE"," ",186],["T_FUNCTION","function",186],["T_WHITESPACE"," ",186],["T_STRING","setParentTxnId",186],"(",["T_VARIABLE","$parentTxnId",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$txnId",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","null",186],")",["T_WHITESPACE","\n    ",186],"{",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_verifyTxnId",188],"(",["T_VARIABLE","$parentTxnId",188],")",";",["T_WHITESPACE","\n        ",188],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_EMPTY","empty",189],"(",["T_VARIABLE","$txnId",189],")",")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(",["T_CONSTANT_ENCAPSED_STRING","''",190],["T_WHITESPACE"," ",190],["T_IS_EQUAL","==",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getTxnId",190],"(",")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_STRING","Mage",191],["T_DOUBLE_COLON","::",191],["T_STRING","throwException",191],"(",["T_WHITESPACE","\n                    ",191],["T_STRING","Mage",192],["T_DOUBLE_COLON","::",192],["T_STRING","helper",192],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",192],")",["T_OBJECT_OPERATOR","->",192],["T_STRING","__",192],"(",["T_CONSTANT_ENCAPSED_STRING","'Parent transaction ID must have a transaction ID.'",192],")",["T_WHITESPACE","\n                ",192],")",";",["T_WHITESPACE","\n            ",193],"}",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE"," ",195],["T_ELSE","else",195],["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","setTxnId",196],"(",["T_VARIABLE","$txnId",196],")",";",["T_WHITESPACE","\n        ",196],"}",["T_WHITESPACE","\n        ",197],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","setData",198],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_txn_id'",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$parentTxnId",198],")",";",["T_WHITESPACE","\n    ",198],"}",["T_WHITESPACE","\n\n    ",199],["T_DOC_COMMENT","\/**\n     * Transaction type setter\n     *\n     * @param $txnType\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",201],["T_WHITESPACE","\n    ",206],["T_PUBLIC","public",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","setTxnType",207],"(",["T_VARIABLE","$txnType",207],")",["T_WHITESPACE","\n    ",207],"{",["T_WHITESPACE","\n        ",208],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_verifyTxnType",209],"(",["T_VARIABLE","$txnType",209],")",";",["T_WHITESPACE","\n        ",209],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","setData",210],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_type'",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$txnType",210],")",";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Parent transaction getter\n     * May attempt to load it.\n     *\n     * @param bool $shouldLoad\n     * @return Mage_Sales_Model_Order_Payment_Transaction|false\n     *\/",213],["T_WHITESPACE","\n    ",219],["T_PUBLIC","public",220],["T_WHITESPACE"," ",220],["T_FUNCTION","function",220],["T_WHITESPACE"," ",220],["T_STRING","getParentTransaction",220],"(",["T_VARIABLE","$shouldLoad",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_STRING","true",220],")",["T_WHITESPACE","\n    ",220],"{",["T_WHITESPACE","\n        ",221],["T_IF","if",222],["T_WHITESPACE"," ",222],"(",["T_STRING","null",222],["T_WHITESPACE"," ",222],["T_IS_IDENTICAL","===",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_parentTransaction",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_verifyThisTransactionExists",223],"(",")",";",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_parentTransaction",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","false",224],";",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$parentId",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getParentId",225],"(",")",";",["T_WHITESPACE","\n            ",225],["T_IF","if",226],["T_WHITESPACE"," ",226],"(",["T_VARIABLE","$parentId",226],")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n                ",226],["T_VARIABLE","$class",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_STRING","get_class",227],"(",["T_VARIABLE","$this",227],")",";",["T_WHITESPACE","\n                ",227],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_parentTransaction",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_NEW","new",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$class",228],";",["T_WHITESPACE","\n                ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_VARIABLE","$shouldLoad",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                    ",229],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_parentTransaction",230],["T_WHITESPACE","\n                        ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","setOrderPaymentObject",231],"(",["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","_paymentObject",231],")",["T_WHITESPACE","\n                        ",231],["T_OBJECT_OPERATOR","->",232],["T_STRING","load",232],"(",["T_VARIABLE","$parentId",232],")",";",["T_WHITESPACE","\n                    ",232],["T_IF","if",233],["T_WHITESPACE"," ",233],"(","!",["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_parentTransaction",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getId",233],"(",")",")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n                        ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_parentTransaction",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","false",234],";",["T_WHITESPACE","\n                    ",234],"}",["T_WHITESPACE"," ",235],["T_ELSE","else",235],["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n                        ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_parentTransaction",236],["T_WHITESPACE","\n                            ",236],["T_OBJECT_OPERATOR","->",237],["T_STRING","hasChildTransaction",237],"(",["T_STRING","true",237],")",";",["T_WHITESPACE","\n                    ",237],"}",["T_WHITESPACE","\n                ",238],"}",["T_WHITESPACE","\n            ",239],"}",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n        ",241],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","_parentTransaction",242],";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n\n    ",243],["T_DOC_COMMENT","\/**\n     * Child transaction(s) getter\n     * Will attempt to load them first\n     * Can be filtered by types and\/or transaction_id\n     * Returns transaction object if transaction_id is specified, otherwise - array\n     * TODO: $recursive is not implemented\n     *\n     * @param array|string $types\n     * @param string $txnId\n     * @param bool $recursive\n     * @return Mage_Sales_Model_Order_Payment_Transaction|array|null\n     *\/",245],["T_WHITESPACE","\n    ",256],["T_PUBLIC","public",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","getChildTransactions",257],"(",["T_VARIABLE","$types",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","null",257],",",["T_WHITESPACE"," ",257],["T_VARIABLE","$txnId",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","null",257],",",["T_WHITESPACE"," ",257],["T_VARIABLE","$recursive",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","false",257],")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_loadChildren",259],"(",")",";",["T_WHITESPACE","\n\n        ",259],["T_COMMENT","\/\/ grab all transactions\n",261],["T_WHITESPACE","        ",262],["T_IF","if",262],["T_WHITESPACE"," ",262],"(",["T_EMPTY","empty",262],"(",["T_VARIABLE","$types",262],")",["T_WHITESPACE"," ",262],["T_BOOLEAN_AND","&&",262],["T_WHITESPACE"," ",262],["T_STRING","null",262],["T_WHITESPACE"," ",262],["T_IS_IDENTICAL","===",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$txnId",262],")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n            ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_children",263],";",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE"," ",264],["T_ELSEIF","elseif",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$types",264],["T_WHITESPACE"," ",264],["T_BOOLEAN_AND","&&",264],["T_WHITESPACE"," ",264],"!",["T_STRING","is_array",264],"(",["T_VARIABLE","$types",264],")",")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$types",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",["T_VARIABLE","$types",265],")",";",["T_WHITESPACE","\n        ",265],"}",["T_WHITESPACE","\n\n        ",266],["T_COMMENT","\/\/ get a specific transaction\n",268],["T_WHITESPACE","        ",269],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_VARIABLE","$txnId",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(",["T_EMPTY","empty",270],"(",["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_children",270],")",")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n                ",270],["T_RETURN","return",271],";",["T_WHITESPACE","\n            ",271],"}",["T_WHITESPACE","\n            ",272],["T_VARIABLE","$transaction",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","null",273],";",["T_WHITESPACE","\n            ",273],["T_IF","if",274],["T_WHITESPACE"," ",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_identifiedChildren",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n                ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_ISSET","isset",275],"(",["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_identifiedChildren",275],"[",["T_VARIABLE","$txnId",275],"]",")",")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n                    ",275],["T_VARIABLE","$transaction",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_identifiedChildren",276],"[",["T_VARIABLE","$txnId",276],"]",";",["T_WHITESPACE","\n                ",276],"}",["T_WHITESPACE","\n            ",277],"}",["T_WHITESPACE"," ",278],["T_ELSE","else",278],["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n                ",278],["T_FOREACH","foreach",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_children",279],["T_WHITESPACE"," ",279],["T_AS","as",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$child",279],")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n                    ",279],["T_IF","if",280],["T_WHITESPACE"," ",280],"(",["T_VARIABLE","$child",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getTxnId",280],"(",")",["T_WHITESPACE"," ",280],["T_IS_IDENTICAL","===",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$tnxId",280],")",["T_WHITESPACE"," ",280],"{",["T_WHITESPACE","\n                        ",280],["T_VARIABLE","$transaction",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$child",281],";",["T_WHITESPACE","\n                        ",281],["T_BREAK","break",282],";",["T_WHITESPACE","\n                    ",282],"}",["T_WHITESPACE","\n                ",283],"}",["T_WHITESPACE","\n            ",284],"}",["T_WHITESPACE","\n            ",285],["T_COMMENT","\/\/ return transaction only if type matches\n",286],["T_WHITESPACE","            ",287],["T_IF","if",287],["T_WHITESPACE"," ",287],"(","!",["T_VARIABLE","$transaction",287],["T_WHITESPACE"," ",287],["T_BOOLEAN_OR","||",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$types",287],["T_WHITESPACE"," ",287],["T_BOOLEAN_AND","&&",287],["T_WHITESPACE"," ",287],"!",["T_STRING","in_array",287],"(",["T_VARIABLE","$transaction",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getType",287],"(",")",",",["T_WHITESPACE"," ",287],["T_VARIABLE","$types",287],",",["T_WHITESPACE"," ",287],["T_STRING","true",287],")",")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n                ",287],["T_RETURN","return",288],";",["T_WHITESPACE","\n            ",288],"}",["T_WHITESPACE","\n            ",289],["T_RETURN","return",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$transaction",290],";",["T_WHITESPACE","\n        ",290],"}",["T_WHITESPACE","\n\n        ",291],["T_COMMENT","\/\/ filter transactions by types\n",293],["T_WHITESPACE","        ",294],["T_VARIABLE","$result",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_ARRAY","array",294],"(",")",";",["T_WHITESPACE","\n        ",294],["T_FOREACH","foreach",295],["T_WHITESPACE"," ",295],"(",["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_children",295],["T_WHITESPACE"," ",295],["T_AS","as",295],["T_WHITESPACE"," ",295],["T_VARIABLE","$child",295],")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_IF","if",296],["T_WHITESPACE"," ",296],"(",["T_STRING","in_array",296],"(",["T_VARIABLE","$child",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getType",296],"(",")",",",["T_WHITESPACE"," ",296],["T_VARIABLE","$types",296],",",["T_WHITESPACE"," ",296],["T_STRING","true",296],")",")",["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n                ",296],["T_VARIABLE","$result",297],"[",["T_VARIABLE","$child",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getId",297],"(",")","]",["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$child",297],";",["T_WHITESPACE","\n            ",297],"}",["T_WHITESPACE","\n        ",298],"}",["T_WHITESPACE","\n        ",299],["T_RETURN","return",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$result",300],";",["T_WHITESPACE","\n    ",300],"}",["T_WHITESPACE","\n\n    ",301],["T_DOC_COMMENT","\/**\n     * Close an authorization transaction\n     * This method can be invoked from any child transaction of the transaction to be closed\n     * Returns the authorization transaction on success. Otherwise false.\n     * $dryRun = true prevents actual closing, it just allows to check whether this operation is possible\n     *\n     * @param bool $shouldSave\n     * @param bool $dryRun\n     * @return Mage_Sales_Model_Order_Payment_Transaction|false\n     * @throws Exception\n     *\/",303],["T_WHITESPACE","\n    ",313],["T_PUBLIC","public",314],["T_WHITESPACE"," ",314],["T_FUNCTION","function",314],["T_WHITESPACE"," ",314],["T_STRING","closeAuthorization",314],"(",["T_VARIABLE","$shouldSave",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_STRING","true",314],",",["T_WHITESPACE"," ",314],["T_VARIABLE","$dryRun",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_STRING","false",314],")",["T_WHITESPACE","\n    ",314],"{",["T_WHITESPACE","\n        ",315],["T_TRY","try",316],["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_verifyThisTransactionExists",317],"(",")",";",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE"," ",318],["T_CATCH","catch",318],["T_WHITESPACE"," ",318],"(",["T_STRING","Exception",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$e",318],")",["T_WHITESPACE"," ",318],"{",["T_WHITESPACE","\n            ",318],["T_IF","if",319],["T_WHITESPACE"," ",319],"(",["T_VARIABLE","$dryRun",319],")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n                ",319],["T_RETURN","return",320],["T_WHITESPACE"," ",320],["T_STRING","false",320],";",["T_WHITESPACE","\n            ",320],"}",["T_WHITESPACE","\n            ",321],["T_THROW","throw",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$e",322],";",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE","\n        ",323],["T_VARIABLE","$authTransaction",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_STRING","false",324],";",["T_WHITESPACE","\n        ",324],["T_SWITCH","switch",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$this",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getTxnType",325],"(",")",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_CASE","case",326],["T_WHITESPACE"," ",326],["T_STRING","self",326],["T_DOUBLE_COLON","::",326],["T_STRING","TYPE_VOID",326],":",["T_WHITESPACE","\n                ",326],["T_COMMENT","\/\/ break intentionally omitted\n",327],["T_WHITESPACE","            ",328],["T_CASE","case",328],["T_WHITESPACE"," ",328],["T_STRING","self",328],["T_DOUBLE_COLON","::",328],["T_STRING","TYPE_CAPTURE",328],":",["T_WHITESPACE","\n                ",328],["T_VARIABLE","$authTransaction",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getParentTransaction",329],"(",")",";",["T_WHITESPACE","\n                ",329],["T_BREAK","break",330],";",["T_WHITESPACE","\n            ",330],["T_CASE","case",331],["T_WHITESPACE"," ",331],["T_STRING","self",331],["T_DOUBLE_COLON","::",331],["T_STRING","TYPE_AUTH",331],":",["T_WHITESPACE","\n                ",331],["T_VARIABLE","$authTransaction",332],["T_WHITESPACE"," ",332],"=",["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],";",["T_WHITESPACE","\n                ",332],["T_BREAK","break",333],";",["T_WHITESPACE","\n            ",333],["T_COMMENT","\/\/ case self::TYPE_PAYMENT?\n",334],["T_WHITESPACE","        ",335],"}",["T_WHITESPACE","\n        ",335],["T_IF","if",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$authTransaction",336],")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_IF","if",337],["T_WHITESPACE"," ",337],"(","!",["T_VARIABLE","$dryRun",337],")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n                ",337],["T_VARIABLE","$authTransaction",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","close",338],"(",["T_VARIABLE","$shouldSave",338],")",";",["T_WHITESPACE","\n            ",338],"}",["T_WHITESPACE","\n        ",339],"}",["T_WHITESPACE","\n        ",340],["T_RETURN","return",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$authTransaction",341],";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_DOC_COMMENT","\/**\n     * Close a capture transaction\n     * Logic is similar to closeAuthorization(), but for a capture transaction\n     * @see self::closeAuthorization()\n     * @para, bool $shouldSave\n     * @param unknown_type $shouldSave\n     *\/",344],["T_WHITESPACE","\n    ",350],["T_PUBLIC","public",351],["T_WHITESPACE"," ",351],["T_FUNCTION","function",351],["T_WHITESPACE"," ",351],["T_STRING","closeCapture",351],"(",["T_VARIABLE","$shouldSave",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_STRING","true",351],")",["T_WHITESPACE","\n    ",351],"{",["T_WHITESPACE","\n        ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_verifyThisTransactionExists",353],"(",")",";",["T_WHITESPACE","\n        ",353],["T_VARIABLE","$captureTransaction",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_STRING","false",354],";",["T_WHITESPACE","\n        ",354],["T_SWITCH","switch",355],["T_WHITESPACE"," ",355],"(",["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getTxnType",355],"(",")",")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n            ",355],["T_CASE","case",356],["T_WHITESPACE"," ",356],["T_STRING","self",356],["T_DOUBLE_COLON","::",356],["T_STRING","TYPE_CAPTURE",356],":",["T_WHITESPACE","\n                ",356],["T_VARIABLE","$captureTransaction",357],["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],";",["T_WHITESPACE","\n                ",357],["T_BREAK","break",358],";",["T_WHITESPACE","\n            ",358],["T_CASE","case",359],["T_WHITESPACE"," ",359],["T_STRING","self",359],["T_DOUBLE_COLON","::",359],["T_STRING","TYPE_REFUND",359],":",["T_WHITESPACE","\n                ",359],["T_VARIABLE","$captureTransaction",360],["T_WHITESPACE"," ",360],"=",["T_WHITESPACE"," ",360],["T_VARIABLE","$this",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getParentTransaction",360],"(",")",";",["T_WHITESPACE","\n                ",360],["T_BREAK","break",361],";",["T_WHITESPACE","\n        ",361],"}",["T_WHITESPACE","\n        ",362],["T_IF","if",363],["T_WHITESPACE"," ",363],"(",["T_VARIABLE","$captureTransaction",363],")",["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n            ",363],["T_VARIABLE","$captureTransaction",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","close",364],"(",["T_VARIABLE","$shouldSave",364],")",";",["T_WHITESPACE","\n        ",364],"}",["T_WHITESPACE","\n        ",365],["T_RETURN","return",366],["T_WHITESPACE"," ",366],["T_VARIABLE","$captureTransaction",366],";",["T_WHITESPACE","\n    ",366],"}",["T_WHITESPACE","\n\n    ",367],["T_DOC_COMMENT","\/**\n     * Check whether authorization in current hierarchy can be voided completely\n     * Basically checks whether the authorization exists and it is not affected by a capture or void\n     * @return bool\n     *\/",369],["T_WHITESPACE","\n    ",373],["T_PUBLIC","public",374],["T_WHITESPACE"," ",374],["T_FUNCTION","function",374],["T_WHITESPACE"," ",374],["T_STRING","canVoidAuthorizationCompletely",374],"(",")",["T_WHITESPACE","\n    ",374],"{",["T_WHITESPACE","\n        ",375],["T_TRY","try",376],["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$authTransaction",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","closeAuthorization",377],"(",["T_CONSTANT_ENCAPSED_STRING","''",377],",",["T_WHITESPACE"," ",377],["T_STRING","true",377],")",";",["T_WHITESPACE","\n            ",377],["T_IF","if",378],["T_WHITESPACE"," ",378],"(",["T_VARIABLE","$authTransaction",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","hasChildTransaction",378],"(",")",["T_WHITESPACE"," ",378],["T_BOOLEAN_OR","||",378],["T_WHITESPACE"," ",378],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_children",378],")",["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n                ",378],["T_RETURN","return",379],["T_WHITESPACE"," ",379],["T_STRING","false",379],";",["T_WHITESPACE","\n            ",379],"}",["T_WHITESPACE","\n            ",380],["T_RETURN","return",381],["T_WHITESPACE"," ",381],["T_STRING","true",381],";",["T_WHITESPACE","\n        ",381],"}",["T_WHITESPACE"," ",382],["T_CATCH","catch",382],["T_WHITESPACE"," ",382],"(",["T_STRING","Mage_Core_Exception",382],["T_WHITESPACE"," ",382],["T_VARIABLE","$e",382],")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n            ",382],["T_COMMENT","\/\/ jam all logical exceptions, fallback to false\n",383],["T_WHITESPACE","        ",384],"}",["T_WHITESPACE","\n        ",384],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_STRING","false",385],";",["T_WHITESPACE","\n    ",385],"}",["T_WHITESPACE","\n\n    ",386],["T_DOC_COMMENT","\/**\n     * Getter\/Setter of whether current transaction has a child transaction\n     * @param bool $whetherHasChild\n     * @return bool|Mage_Sales_Model_Order_Payment_Transaction\n     *\/",388],["T_WHITESPACE","\n    ",392],["T_PUBLIC","public",393],["T_WHITESPACE"," ",393],["T_FUNCTION","function",393],["T_WHITESPACE"," ",393],["T_STRING","hasChildTransaction",393],"(",["T_VARIABLE","$whetherHasChild",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_STRING","null",393],")",["T_WHITESPACE","\n    ",393],"{",["T_WHITESPACE","\n        ",394],["T_IF","if",395],["T_WHITESPACE"," ",395],"(",["T_STRING","null",395],["T_WHITESPACE"," ",395],["T_IS_NOT_IDENTICAL","!==",395],["T_WHITESPACE"," ",395],["T_VARIABLE","$whetherHasChild",395],")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n            ",395],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","_hasChild",396],["T_WHITESPACE"," ",396],"=",["T_WHITESPACE"," ",396],["T_BOOL_CAST","(bool)",396],["T_VARIABLE","$whetherHasChild",396],";",["T_WHITESPACE","\n            ",396],["T_RETURN","return",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],";",["T_WHITESPACE","\n        ",397],"}",["T_WHITESPACE","\n        ",398],["T_ELSEIF","elseif",399],["T_WHITESPACE"," ",399],"(",["T_STRING","null",399],["T_WHITESPACE"," ",399],["T_IS_IDENTICAL","===",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","_hasChild",399],")",["T_WHITESPACE"," ",399],"{",["T_WHITESPACE","\n            ",399],["T_IF","if",400],["T_WHITESPACE"," ",400],"(",["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","getChildTransactions",400],"(",")",")",["T_WHITESPACE"," ",400],"{",["T_WHITESPACE","\n                ",400],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","_hasChild",401],["T_WHITESPACE"," ",401],"=",["T_WHITESPACE"," ",401],["T_STRING","true",401],";",["T_WHITESPACE","\n            ",401],"}",["T_WHITESPACE"," ",402],["T_ELSE","else",402],["T_WHITESPACE"," ",402],"{",["T_WHITESPACE","\n                ",402],["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_hasChild",403],["T_WHITESPACE"," ",403],"=",["T_WHITESPACE"," ",403],["T_STRING","false",403],";",["T_WHITESPACE","\n            ",403],"}",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE","\n        ",405],["T_RETURN","return",406],["T_WHITESPACE"," ",406],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","_hasChild",406],";",["T_WHITESPACE","\n    ",406],"}",["T_WHITESPACE","\n\n    ",407],["T_DOC_COMMENT","\/**\n     * Check object before loading by by specified transaction ID\n     * @param $txnId\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",409],["T_WHITESPACE","\n    ",413],["T_PROTECTED","protected",414],["T_WHITESPACE"," ",414],["T_FUNCTION","function",414],["T_WHITESPACE"," ",414],["T_STRING","_beforeLoadByTxnId",414],"(",["T_VARIABLE","$txnId",414],")",["T_WHITESPACE","\n    ",414],"{",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","_verifyPaymentObject",416],"(",")",";",["T_WHITESPACE","\n        ",416],["T_STRING","Mage",417],["T_DOUBLE_COLON","::",417],["T_STRING","dispatchEvent",417],"(",["T_WHITESPACE","\n            ",417],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","_eventPrefix",418],["T_WHITESPACE"," ",418],".",["T_WHITESPACE"," ",418],["T_CONSTANT_ENCAPSED_STRING","'_load_by_txn_id_before'",418],",",["T_WHITESPACE","\n            ",418],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","_getEventData",419],"(",")",["T_WHITESPACE"," ",419],"+",["T_WHITESPACE"," ",419],["T_ARRAY","array",419],"(",["T_CONSTANT_ENCAPSED_STRING","'txn_id'",419],["T_WHITESPACE"," ",419],["T_DOUBLE_ARROW","=>",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$txnId",419],")",["T_WHITESPACE","\n        ",419],")",";",["T_WHITESPACE","\n        ",420],["T_RETURN","return",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],";",["T_WHITESPACE","\n    ",421],"}",["T_WHITESPACE","\n\n    ",422],["T_DOC_COMMENT","\/**\n     * Load self by specified transaction ID. Requires the valid payment object to be set\n     * @param string $txnId\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",424],["T_WHITESPACE","\n    ",428],["T_PUBLIC","public",429],["T_WHITESPACE"," ",429],["T_FUNCTION","function",429],["T_WHITESPACE"," ",429],["T_STRING","loadByTxnId",429],"(",["T_VARIABLE","$txnId",429],")",["T_WHITESPACE","\n    ",429],"{",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_beforeLoadByTxnId",431],"(",["T_VARIABLE","$txnId",431],")",";",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getResource",432],"(",")",["T_OBJECT_OPERATOR","->",432],["T_STRING","loadObjectByTxnId",432],"(",["T_WHITESPACE","\n            ",432],["T_VARIABLE","$this",433],",",["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getOrderId",433],"(",")",",",["T_WHITESPACE"," ",433],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","_paymentObject",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getId",433],"(",")",",",["T_WHITESPACE"," ",433],["T_VARIABLE","$txnId",433],["T_WHITESPACE","\n        ",433],")",";",["T_WHITESPACE","\n        ",434],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","_afterLoadByTxnId",435],"(",")",";",["T_WHITESPACE","\n        ",435],["T_RETURN","return",436],["T_WHITESPACE"," ",436],["T_VARIABLE","$this",436],";",["T_WHITESPACE","\n    ",436],"}",["T_WHITESPACE","\n\n    ",437],["T_DOC_COMMENT","\/**\n     * Check object after loading by by specified transaction ID\n     * @param $txnId\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",439],["T_WHITESPACE","\n    ",443],["T_PROTECTED","protected",444],["T_WHITESPACE"," ",444],["T_FUNCTION","function",444],["T_WHITESPACE"," ",444],["T_STRING","_afterLoadByTxnId",444],"(",")",["T_WHITESPACE","\n    ",444],"{",["T_WHITESPACE","\n        ",445],["T_STRING","Mage",446],["T_DOUBLE_COLON","::",446],["T_STRING","dispatchEvent",446],"(",["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","_eventPrefix",446],["T_WHITESPACE"," ",446],".",["T_WHITESPACE"," ",446],["T_CONSTANT_ENCAPSED_STRING","'_load_by_txn_id_after'",446],",",["T_WHITESPACE"," ",446],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","_getEventData",446],"(",")",")",";",["T_WHITESPACE","\n        ",446],["T_RETURN","return",447],["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],";",["T_WHITESPACE","\n    ",447],"}",["T_WHITESPACE","\n\n\n    ",448],["T_DOC_COMMENT","\/**\n     * Additional information setter\n     * Updates data inside the 'additional_information' array\n     * Doesn't allow to set arrays\n     *\n     * @param string $key\n     * @param mixed $value\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     * @throws Mage_Core_Exception\n     *\/",451],["T_WHITESPACE","\n    ",460],["T_PUBLIC","public",461],["T_WHITESPACE"," ",461],["T_FUNCTION","function",461],["T_WHITESPACE"," ",461],["T_STRING","setAdditionalInformation",461],"(",["T_VARIABLE","$key",461],",",["T_WHITESPACE"," ",461],["T_VARIABLE","$value",461],")",["T_WHITESPACE","\n    ",461],"{",["T_WHITESPACE","\n        ",462],["T_IF","if",463],["T_WHITESPACE"," ",463],"(",["T_STRING","is_object",463],"(",["T_VARIABLE","$value",463],")",")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n            ",463],["T_STRING","Mage",464],["T_DOUBLE_COLON","::",464],["T_STRING","throwException",464],"(",["T_STRING","Mage",464],["T_DOUBLE_COLON","::",464],["T_STRING","helper",464],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",464],")",["T_OBJECT_OPERATOR","->",464],["T_STRING","__",464],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment transactions disallow storing objects.'",464],")",")",";",["T_WHITESPACE","\n        ",464],"}",["T_WHITESPACE","\n        ",465],["T_VARIABLE","$info",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","_getData",466],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_information'",466],")",";",["T_WHITESPACE","\n        ",466],["T_IF","if",467],["T_WHITESPACE"," ",467],"(","!",["T_VARIABLE","$info",467],")",["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n            ",467],["T_VARIABLE","$info",468],["T_WHITESPACE"," ",468],"=",["T_WHITESPACE"," ",468],["T_ARRAY","array",468],"(",")",";",["T_WHITESPACE","\n        ",468],"}",["T_WHITESPACE","\n        ",469],["T_VARIABLE","$info",470],"[",["T_VARIABLE","$key",470],"]",["T_WHITESPACE"," ",470],"=",["T_WHITESPACE"," ",470],["T_VARIABLE","$value",470],";",["T_WHITESPACE","\n        ",470],["T_RETURN","return",471],["T_WHITESPACE"," ",471],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","setData",471],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_information'",471],",",["T_WHITESPACE"," ",471],["T_VARIABLE","$info",471],")",";",["T_WHITESPACE","\n    ",471],"}",["T_WHITESPACE","\n\n    ",472],["T_DOC_COMMENT","\/**\n     * Getter for entire additional_information value or one of its element by key\n     * @param string $key\n     * @return array|null|mixed\n     *\/",474],["T_WHITESPACE","\n    ",478],["T_PUBLIC","public",479],["T_WHITESPACE"," ",479],["T_FUNCTION","function",479],["T_WHITESPACE"," ",479],["T_STRING","getAdditionalInformation",479],"(",["T_VARIABLE","$key",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_STRING","null",479],")",["T_WHITESPACE","\n    ",479],"{",["T_WHITESPACE","\n        ",480],["T_VARIABLE","$info",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","_getData",481],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_information'",481],")",";",["T_WHITESPACE","\n        ",481],["T_IF","if",482],["T_WHITESPACE"," ",482],"(","!",["T_VARIABLE","$info",482],")",["T_WHITESPACE"," ",482],"{",["T_WHITESPACE","\n            ",482],["T_VARIABLE","$info",483],["T_WHITESPACE"," ",483],"=",["T_WHITESPACE"," ",483],["T_ARRAY","array",483],"(",")",";",["T_WHITESPACE","\n        ",483],"}",["T_WHITESPACE","\n        ",484],["T_IF","if",485],["T_WHITESPACE"," ",485],"(",["T_VARIABLE","$key",485],")",["T_WHITESPACE"," ",485],"{",["T_WHITESPACE","\n            ",485],["T_RETURN","return",486],["T_WHITESPACE"," ",486],"(",["T_ISSET","isset",486],"(",["T_VARIABLE","$info",486],"[",["T_VARIABLE","$key",486],"]",")",["T_WHITESPACE"," ",486],"?",["T_WHITESPACE"," ",486],["T_VARIABLE","$info",486],"[",["T_VARIABLE","$key",486],"]",["T_WHITESPACE"," ",486],":",["T_WHITESPACE"," ",486],["T_STRING","null",486],")",";",["T_WHITESPACE","\n        ",486],"}",["T_WHITESPACE","\n        ",487],["T_RETURN","return",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$info",488],";",["T_WHITESPACE","\n    ",488],"}",["T_WHITESPACE","\n\n    ",489],["T_DOC_COMMENT","\/**\n     * Unsetter for entire additional_information value or one of its element by key\n     * @param string $key\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",491],["T_WHITESPACE","\n    ",495],["T_PUBLIC","public",496],["T_WHITESPACE"," ",496],["T_FUNCTION","function",496],["T_WHITESPACE"," ",496],["T_STRING","unsAdditionalInformation",496],"(",["T_VARIABLE","$key",496],["T_WHITESPACE"," ",496],"=",["T_WHITESPACE"," ",496],["T_STRING","null",496],")",["T_WHITESPACE","\n    ",496],"{",["T_WHITESPACE","\n        ",497],["T_IF","if",498],["T_WHITESPACE"," ",498],"(",["T_VARIABLE","$key",498],")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n            ",498],["T_VARIABLE","$info",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","_getData",499],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_information'",499],")",";",["T_WHITESPACE","\n            ",499],["T_IF","if",500],["T_WHITESPACE"," ",500],"(",["T_STRING","is_array",500],"(",["T_VARIABLE","$info",500],")",")",["T_WHITESPACE"," ",500],"{",["T_WHITESPACE","\n                ",500],["T_UNSET","unset",501],"(",["T_VARIABLE","$info",501],"[",["T_VARIABLE","$key",501],"]",")",";",["T_WHITESPACE","\n            ",501],"}",["T_WHITESPACE","\n        ",502],"}",["T_WHITESPACE"," ",503],["T_ELSE","else",503],["T_WHITESPACE"," ",503],"{",["T_WHITESPACE","\n            ",503],["T_VARIABLE","$info",504],["T_WHITESPACE"," ",504],"=",["T_WHITESPACE"," ",504],["T_ARRAY","array",504],"(",")",";",["T_WHITESPACE","\n        ",504],"}",["T_WHITESPACE","\n        ",505],["T_RETURN","return",506],["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","setData",506],"(",["T_CONSTANT_ENCAPSED_STRING","'additional_information'",506],",",["T_WHITESPACE"," ",506],["T_VARIABLE","$info",506],")",";",["T_WHITESPACE","\n    ",506],"}",["T_WHITESPACE","\n\n    ",507],["T_DOC_COMMENT","\/**\n     * Close this transaction\n     * @param bool $shouldSave\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     * @throws Mage_Core_Exception\n     *\/",509],["T_WHITESPACE","\n    ",514],["T_PUBLIC","public",515],["T_WHITESPACE"," ",515],["T_FUNCTION","function",515],["T_WHITESPACE"," ",515],["T_STRING","close",515],"(",["T_VARIABLE","$shouldSave",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_STRING","true",515],")",["T_WHITESPACE","\n    ",515],"{",["T_WHITESPACE","\n        ",516],["T_IF","if",517],["T_WHITESPACE"," ",517],"(","!",["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","_isFailsafe",517],")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n            ",517],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","_verifyThisTransactionExists",518],"(",")",";",["T_WHITESPACE","\n        ",518],"}",["T_WHITESPACE","\n        ",519],["T_IF","if",520],["T_WHITESPACE"," ",520],"(",["T_LNUMBER","1",520],["T_WHITESPACE"," ",520],["T_IS_EQUAL","==",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","getIsClosed",520],"(",")",["T_WHITESPACE"," ",520],["T_BOOLEAN_AND","&&",520],["T_WHITESPACE"," ",520],["T_VARIABLE","$this",520],["T_OBJECT_OPERATOR","->",520],["T_STRING","_isFailsafe",520],")",["T_WHITESPACE"," ",520],"{",["T_WHITESPACE","\n            ",520],["T_STRING","Mage",521],["T_DOUBLE_COLON","::",521],["T_STRING","throwException",521],"(",["T_STRING","Mage",521],["T_DOUBLE_COLON","::",521],["T_STRING","helper",521],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",521],")",["T_OBJECT_OPERATOR","->",521],["T_STRING","__",521],"(",["T_CONSTANT_ENCAPSED_STRING","'The transaction \"%s\" (%s) is already closed.'",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getTxnId",521],"(",")",",",["T_WHITESPACE"," ",521],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getTxnType",521],"(",")",")",")",";",["T_WHITESPACE","\n        ",521],"}",["T_WHITESPACE","\n        ",522],["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","setIsClosed",523],"(",["T_LNUMBER","1",523],")",";",["T_WHITESPACE","\n        ",523],["T_IF","if",524],["T_WHITESPACE"," ",524],"(",["T_VARIABLE","$shouldSave",524],")",["T_WHITESPACE"," ",524],"{",["T_WHITESPACE","\n            ",524],["T_VARIABLE","$this",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","save",525],"(",")",";",["T_WHITESPACE","\n        ",525],"}",["T_WHITESPACE","\n        ",526],["T_IF","if",527],["T_WHITESPACE"," ",527],"(",["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","_transactionsAutoLinking",527],["T_WHITESPACE"," ",527],["T_BOOLEAN_AND","&&",527],["T_WHITESPACE"," ",527],["T_STRING","self",527],["T_DOUBLE_COLON","::",527],["T_STRING","TYPE_AUTH",527],["T_WHITESPACE"," ",527],["T_IS_IDENTICAL","===",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getTxnType",527],"(",")",")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n            ",527],["T_TRY","try",528],["T_WHITESPACE"," ",528],"{",["T_WHITESPACE","\n                ",528],["T_VARIABLE","$paymentTransaction",529],["T_WHITESPACE"," ",529],"=",["T_WHITESPACE"," ",529],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getParentTransaction",529],"(",")",";",["T_WHITESPACE","\n                ",529],["T_IF","if",530],["T_WHITESPACE"," ",530],"(",["T_VARIABLE","$paymentTransaction",530],")",["T_WHITESPACE"," ",530],"{",["T_WHITESPACE","\n                    ",530],["T_VARIABLE","$paymentTransaction",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","close",531],"(",["T_VARIABLE","$shouldSave",531],")",";",["T_WHITESPACE","\n                ",531],"}",["T_WHITESPACE","\n            ",532],"}",["T_WHITESPACE"," ",533],["T_CATCH","catch",533],["T_WHITESPACE"," ",533],"(",["T_STRING","Exception",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$e",533],")",["T_WHITESPACE"," ",533],"{",["T_WHITESPACE","\n                ",533],["T_IF","if",534],["T_WHITESPACE"," ",534],"(","!",["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","_isFailsafe",534],")",["T_WHITESPACE"," ",534],"{",["T_WHITESPACE","\n                    ",534],["T_THROW","throw",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$e",535],";",["T_WHITESPACE","\n                ",535],"}",["T_WHITESPACE","\n            ",536],"}",["T_WHITESPACE","\n        ",537],"}",["T_WHITESPACE","\n        ",538],["T_RETURN","return",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$this",539],";",["T_WHITESPACE","\n    ",539],"}",["T_WHITESPACE","\n\n    ",540],["T_DOC_COMMENT","\/**\n     * Order Payment instance getter\n     * Will attempt to load by payment_id if it is set in data\n     * @param bool $shouldLoad\n     * @return Mage_Sales_Model_Order_Payment\n     *\/",542],["T_WHITESPACE","\n    ",547],["T_PUBLIC","public",548],["T_WHITESPACE"," ",548],["T_FUNCTION","function",548],["T_WHITESPACE"," ",548],["T_STRING","getOrderPaymentObject",548],"(",["T_VARIABLE","$shouldLoad",548],["T_WHITESPACE"," ",548],"=",["T_WHITESPACE"," ",548],["T_STRING","true",548],")",["T_WHITESPACE","\n    ",548],"{",["T_WHITESPACE","\n        ",549],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_verifyThisTransactionExists",550],"(",")",";",["T_WHITESPACE","\n        ",550],["T_IF","if",551],["T_WHITESPACE"," ",551],"(",["T_STRING","null",551],["T_WHITESPACE"," ",551],["T_IS_IDENTICAL","===",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_paymentObject",551],["T_WHITESPACE"," ",551],["T_BOOLEAN_AND","&&",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$shouldLoad",551],")",["T_WHITESPACE"," ",551],"{",["T_WHITESPACE","\n            ",551],["T_VARIABLE","$payment",552],["T_WHITESPACE"," ",552],"=",["T_WHITESPACE"," ",552],["T_STRING","Mage",552],["T_DOUBLE_COLON","::",552],["T_STRING","getModel",552],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_payment'",552],")",["T_OBJECT_OPERATOR","->",552],["T_STRING","load",552],"(",["T_VARIABLE","$this",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","getPaymentId",552],"(",")",")",";",["T_WHITESPACE","\n            ",552],["T_IF","if",553],["T_WHITESPACE"," ",553],"(",["T_VARIABLE","$payment",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","getId",553],"(",")",")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n                ",553],["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","setOrderPaymentObject",554],"(",["T_VARIABLE","$payment",554],")",";",["T_WHITESPACE","\n            ",554],"}",["T_WHITESPACE","\n        ",555],"}",["T_WHITESPACE","\n        ",556],["T_RETURN","return",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","_paymentObject",557],";",["T_WHITESPACE","\n    ",557],"}",["T_WHITESPACE","\n\n    ",558],["T_DOC_COMMENT","\/**\n     * Order ID getter\n     * Attempts to get ID from set order payment object, if any, or from data by key 'order_id'\n     * @return int|null\n     *\/",560],["T_WHITESPACE","\n    ",564],["T_PUBLIC","public",565],["T_WHITESPACE"," ",565],["T_FUNCTION","function",565],["T_WHITESPACE"," ",565],["T_STRING","getOrderId",565],"(",")",["T_WHITESPACE","\n    ",565],"{",["T_WHITESPACE","\n        ",566],["T_VARIABLE","$orderId",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","_getData",567],"(",["T_CONSTANT_ENCAPSED_STRING","'order_id'",567],")",";",["T_WHITESPACE","\n        ",567],["T_IF","if",568],["T_WHITESPACE"," ",568],"(",["T_VARIABLE","$orderId",568],")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n            ",568],["T_RETURN","return",569],["T_WHITESPACE"," ",569],["T_VARIABLE","$orderId",569],";",["T_WHITESPACE","\n        ",569],"}",["T_WHITESPACE","\n        ",570],["T_IF","if",571],["T_WHITESPACE"," ",571],"(",["T_VARIABLE","$this",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","_paymentObject",571],")",["T_WHITESPACE"," ",571],"{",["T_WHITESPACE","\n            ",571],["T_RETURN","return",572],["T_WHITESPACE"," ",572],["T_VARIABLE","$this",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","_paymentObject",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","getOrder",572],"(",")",["T_WHITESPACE","\n                ",572],"?",["T_WHITESPACE"," ",573],["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","_paymentObject",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","getOrder",573],"(",")",["T_OBJECT_OPERATOR","->",573],["T_STRING","getId",573],"(",")",["T_WHITESPACE","\n                ",573],":",["T_WHITESPACE"," ",574],["T_VARIABLE","$this",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","_paymentObject",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","getParentId",574],"(",")",";",["T_WHITESPACE","\n        ",574],"}",["T_WHITESPACE","\n    ",575],"}",["T_WHITESPACE","\n\n    ",576],["T_DOC_COMMENT","\/**\n     * Retrieve order instance\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",578],["T_WHITESPACE","\n    ",582],["T_PUBLIC","public",583],["T_WHITESPACE"," ",583],["T_FUNCTION","function",583],["T_WHITESPACE"," ",583],["T_STRING","getOrder",583],"(",")",["T_WHITESPACE","\n    ",583],"{",["T_WHITESPACE","\n        ",584],["T_IF","if",585],["T_WHITESPACE"," ",585],"(",["T_VARIABLE","$this",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","_order",585],["T_WHITESPACE"," ",585],["T_IS_IDENTICAL","===",585],["T_WHITESPACE"," ",585],["T_STRING","null",585],")",["T_WHITESPACE"," ",585],"{",["T_WHITESPACE","\n            ",585],["T_VARIABLE","$this",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","setOrder",586],"(",")",";",["T_WHITESPACE","\n        ",586],"}",["T_WHITESPACE","\n\n        ",587],["T_RETURN","return",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$this",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","_order",589],";",["T_WHITESPACE","\n    ",589],"}",["T_WHITESPACE","\n\n    ",590],["T_DOC_COMMENT","\/**\n     * Set order instance for transaction depends on transaction behavior\n     * If $order equals to true, method isn't loading new order instance.\n     *\n     * @param Mage_Sales_Model_Order|null|boolean $order\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     *\/",592],["T_WHITESPACE","\n    ",598],["T_PUBLIC","public",599],["T_WHITESPACE"," ",599],["T_FUNCTION","function",599],["T_WHITESPACE"," ",599],["T_STRING","setOrder",599],"(",["T_VARIABLE","$order",599],["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_STRING","null",599],")",["T_WHITESPACE","\n    ",599],"{",["T_WHITESPACE","\n        ",600],["T_IF","if",601],["T_WHITESPACE"," ",601],"(",["T_STRING","null",601],["T_WHITESPACE"," ",601],["T_IS_IDENTICAL","===",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$order",601],["T_WHITESPACE"," ",601],["T_BOOLEAN_OR","||",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$order",601],["T_WHITESPACE"," ",601],["T_IS_IDENTICAL","===",601],["T_WHITESPACE"," ",601],["T_STRING","true",601],")",["T_WHITESPACE"," ",601],"{",["T_WHITESPACE","\n            ",601],["T_IF","if",602],["T_WHITESPACE"," ",602],"(",["T_STRING","null",602],["T_WHITESPACE"," ",602],["T_IS_NOT_IDENTICAL","!==",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","_paymentObject",602],["T_WHITESPACE"," ",602],["T_BOOLEAN_AND","&&",602],["T_WHITESPACE"," ",602],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","_paymentObject",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getOrder",602],"(",")",")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n                ",602],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","_order",603],["T_WHITESPACE"," ",603],"=",["T_WHITESPACE"," ",603],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","_paymentObject",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","getOrder",603],"(",")",";",["T_WHITESPACE","\n            ",603],"}",["T_WHITESPACE"," ",604],["T_ELSEIF","elseif",604],["T_WHITESPACE"," ",604],"(",["T_VARIABLE","$this",604],["T_OBJECT_OPERATOR","->",604],["T_STRING","getOrderId",604],"(",")",["T_WHITESPACE"," ",604],["T_BOOLEAN_AND","&&",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$order",604],["T_WHITESPACE"," ",604],["T_IS_IDENTICAL","===",604],["T_WHITESPACE"," ",604],["T_STRING","null",604],")",["T_WHITESPACE"," ",604],"{",["T_WHITESPACE","\n                ",604],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","_order",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_STRING","Mage",605],["T_DOUBLE_COLON","::",605],["T_STRING","getModel",605],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",605],")",["T_OBJECT_OPERATOR","->",605],["T_STRING","load",605],"(",["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","getOrderId",605],"(",")",")",";",["T_WHITESPACE","\n            ",605],"}",["T_WHITESPACE"," ",606],["T_ELSE","else",606],["T_WHITESPACE"," ",606],"{",["T_WHITESPACE","\n                ",606],["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","_order",607],["T_WHITESPACE"," ",607],"=",["T_WHITESPACE"," ",607],["T_STRING","false",607],";",["T_WHITESPACE","\n            ",607],"}",["T_WHITESPACE","\n        ",608],"}",["T_WHITESPACE"," ",609],["T_ELSEIF","elseif",609],["T_WHITESPACE"," ",609],"(","!",["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","getId",609],"(",")",["T_WHITESPACE"," ",609],["T_BOOLEAN_OR","||",609],["T_WHITESPACE"," ",609],"(",["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","getOrderId",609],"(",")",["T_WHITESPACE"," ",609],["T_IS_EQUAL","==",609],["T_WHITESPACE"," ",609],["T_VARIABLE","$order",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","getId",609],"(",")",")",")",["T_WHITESPACE"," ",609],"{",["T_WHITESPACE","\n            ",609],["T_VARIABLE","$this",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","_order",610],["T_WHITESPACE"," ",610],"=",["T_WHITESPACE"," ",610],["T_VARIABLE","$order",610],";",["T_WHITESPACE","\n        ",610],"}",["T_WHITESPACE"," ",611],["T_ELSE","else",611],["T_WHITESPACE"," ",611],"{",["T_WHITESPACE","\n            ",611],["T_STRING","Mage",612],["T_DOUBLE_COLON","::",612],["T_STRING","throwException",612],"(",["T_STRING","Mage",612],["T_DOUBLE_COLON","::",612],["T_STRING","helper",612],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",612],")",["T_OBJECT_OPERATOR","->",612],["T_STRING","__",612],"(",["T_CONSTANT_ENCAPSED_STRING","'Set order for existing transactions not allowed'",612],")",")",";",["T_WHITESPACE","\n        ",612],"}",["T_WHITESPACE","\n\n        ",613],["T_RETURN","return",615],["T_WHITESPACE"," ",615],["T_VARIABLE","$this",615],";",["T_WHITESPACE","\n    ",615],"}",["T_WHITESPACE","\n\n    ",616],["T_DOC_COMMENT","\/**\n     * Setter\/Getter whether transaction is supposed to prevent exceptions on saving\n     *\n     * @param bool $failsafe\n     *\/",618],["T_WHITESPACE","\n    ",622],["T_PUBLIC","public",623],["T_WHITESPACE"," ",623],["T_FUNCTION","function",623],["T_WHITESPACE"," ",623],["T_STRING","isFailsafe",623],"(",["T_VARIABLE","$setFailsafe",623],["T_WHITESPACE"," ",623],"=",["T_WHITESPACE"," ",623],["T_STRING","null",623],")",["T_WHITESPACE","\n    ",623],"{",["T_WHITESPACE","\n        ",624],["T_IF","if",625],["T_WHITESPACE"," ",625],"(",["T_STRING","null",625],["T_WHITESPACE"," ",625],["T_IS_IDENTICAL","===",625],["T_WHITESPACE"," ",625],["T_VARIABLE","$setFailsafe",625],")",["T_WHITESPACE"," ",625],"{",["T_WHITESPACE","\n            ",625],["T_RETURN","return",626],["T_WHITESPACE"," ",626],["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","_isFailsafe",626],";",["T_WHITESPACE","\n        ",626],"}",["T_WHITESPACE","\n        ",627],["T_VARIABLE","$this",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","_isFailsafe",628],["T_WHITESPACE"," ",628],"=",["T_WHITESPACE"," ",628],["T_BOOL_CAST","(bool)",628],["T_VARIABLE","$setFailsafe",628],";",["T_WHITESPACE","\n        ",628],["T_RETURN","return",629],["T_WHITESPACE"," ",629],["T_VARIABLE","$this",629],";",["T_WHITESPACE","\n    ",629],"}",["T_WHITESPACE","\n\n    ",630],["T_DOC_COMMENT","\/**\n     * Verify data required for saving\n     * @return Mage_Sales_Model_Order_Payment_Transaction\n     * @throws Mage_Core_Exception\n     *\/",632],["T_WHITESPACE","\n    ",636],["T_PROTECTED","protected",637],["T_WHITESPACE"," ",637],["T_FUNCTION","function",637],["T_WHITESPACE"," ",637],["T_STRING","_beforeSave",637],"(",")",["T_WHITESPACE","\n    ",637],"{",["T_WHITESPACE","\n        ",638],["T_COMMENT","\/\/ set parent id\n",639],["T_WHITESPACE","        ",640],["T_VARIABLE","$this",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","_verifyPaymentObject",640],"(",")",";",["T_WHITESPACE","\n        ",640],["T_IF","if",641],["T_WHITESPACE"," ",641],"(","!",["T_VARIABLE","$this",641],["T_OBJECT_OPERATOR","->",641],["T_STRING","getId",641],"(",")",")",["T_WHITESPACE"," ",641],"{",["T_WHITESPACE","\n            ",641],["T_COMMENT","\/\/ We need to set order and payment ids only for new transactions\n",642],["T_WHITESPACE","            ",643],["T_IF","if",643],["T_WHITESPACE"," ",643],"(",["T_STRING","null",643],["T_WHITESPACE"," ",643],["T_IS_NOT_IDENTICAL","!==",643],["T_WHITESPACE"," ",643],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","_paymentObject",643],")",["T_WHITESPACE"," ",643],"{",["T_WHITESPACE","\n                ",643],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","setPaymentId",644],"(",["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","_paymentObject",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","getId",644],"(",")",")",";",["T_WHITESPACE","\n            ",644],"}",["T_WHITESPACE","\n\n            ",645],["T_IF","if",647],["T_WHITESPACE"," ",647],"(",["T_STRING","null",647],["T_WHITESPACE"," ",647],["T_IS_NOT_IDENTICAL","!==",647],["T_WHITESPACE"," ",647],["T_VARIABLE","$this",647],["T_OBJECT_OPERATOR","->",647],["T_STRING","_order",647],")",["T_WHITESPACE"," ",647],"{",["T_WHITESPACE","\n                ",647],["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","setOrderId",648],"(",["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","_order",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getId",648],"(",")",")",";",["T_WHITESPACE","\n            ",648],"}",["T_WHITESPACE","\n\n            ",649],["T_VARIABLE","$this",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","setCreatedAt",651],"(",["T_STRING","Mage",651],["T_DOUBLE_COLON","::",651],["T_STRING","getModel",651],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",651],")",["T_OBJECT_OPERATOR","->",651],["T_STRING","gmtDate",651],"(",")",")",";",["T_WHITESPACE","\n        ",651],"}",["T_WHITESPACE","\n        ",652],["T_RETURN","return",653],["T_WHITESPACE"," ",653],["T_STRING","parent",653],["T_DOUBLE_COLON","::",653],["T_STRING","_beforeSave",653],"(",")",";",["T_WHITESPACE","\n    ",653],"}",["T_WHITESPACE","\n\n    ",654],["T_DOC_COMMENT","\/**\n     * Load child transactions\n     * @throws Mage_Core_Exception\n     *\/",656],["T_WHITESPACE","\n    ",659],["T_PROTECTED","protected",660],["T_WHITESPACE"," ",660],["T_FUNCTION","function",660],["T_WHITESPACE"," ",660],["T_STRING","_loadChildren",660],"(",")",["T_WHITESPACE","\n    ",660],"{",["T_WHITESPACE","\n        ",661],["T_IF","if",662],["T_WHITESPACE"," ",662],"(",["T_STRING","null",662],["T_WHITESPACE"," ",662],["T_IS_NOT_IDENTICAL","!==",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$this",662],["T_OBJECT_OPERATOR","->",662],["T_STRING","_children",662],")",["T_WHITESPACE"," ",662],"{",["T_WHITESPACE","\n            ",662],["T_RETURN","return",663],";",["T_WHITESPACE","\n        ",663],"}",["T_WHITESPACE","\n\n        ",664],["T_COMMENT","\/\/ make sure minimum required data is set\n",666],["T_WHITESPACE","        ",667],["T_VARIABLE","$this",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","_verifyThisTransactionExists",667],"(",")",";",["T_WHITESPACE","\n        ",667],["T_VARIABLE","$payment",668],["T_WHITESPACE"," ",668],"=",["T_WHITESPACE"," ",668],["T_VARIABLE","$this",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","_verifyPaymentObject",668],"(",["T_STRING","true",668],")",";",["T_WHITESPACE","\n        ",668],["T_VARIABLE","$paymentId",669],["T_WHITESPACE"," ",669],"=",["T_WHITESPACE"," ",669],["T_VARIABLE","$payment",669],["T_WHITESPACE"," ",669],"?",["T_WHITESPACE"," ",669],["T_VARIABLE","$payment",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","getId",669],"(",")",["T_WHITESPACE"," ",669],":",["T_WHITESPACE"," ",669],["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","_getData",669],"(",["T_CONSTANT_ENCAPSED_STRING","'payment_id'",669],")",";",["T_WHITESPACE","\n        ",669],["T_IF","if",670],["T_WHITESPACE"," ",670],"(","!",["T_VARIABLE","$paymentId",670],")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n            ",670],["T_STRING","Mage",671],["T_DOUBLE_COLON","::",671],["T_STRING","throwException",671],"(",["T_STRING","Mage",671],["T_DOUBLE_COLON","::",671],["T_STRING","helper",671],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",671],")",["T_OBJECT_OPERATOR","->",671],["T_STRING","__",671],"(",["T_CONSTANT_ENCAPSED_STRING","'At least a payment ID must be set.'",671],")",")",";",["T_WHITESPACE","\n        ",671],"}",["T_WHITESPACE","\n\n        ",672],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","setOrder",674],"(",["T_STRING","true",674],")",";",["T_WHITESPACE","\n\n        ",674],["T_VARIABLE","$orderFilter",676],["T_WHITESPACE"," ",676],"=",["T_WHITESPACE"," ",676],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getOrder",676],"(",")",";",["T_WHITESPACE"," ",676],["T_COMMENT","\/\/ Try to get order instance for filter\n",676],["T_WHITESPACE","        ",677],["T_IF","if",677],["T_WHITESPACE"," ",677],"(","!",["T_VARIABLE","$orderFilter",677],")",["T_WHITESPACE"," ",677],"{",["T_WHITESPACE","\n            ",677],["T_VARIABLE","$orderFilter",678],["T_WHITESPACE"," ",678],"=",["T_WHITESPACE"," ",678],["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getOrderId",678],"(",")",";",["T_WHITESPACE","\n        ",678],"}",["T_WHITESPACE","\n\n        ",679],["T_COMMENT","\/\/ prepare children collection\n",681],["T_WHITESPACE","        ",682],["T_VARIABLE","$children",682],["T_WHITESPACE"," ",682],"=",["T_WHITESPACE"," ",682],["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","getResourceCollection",682],"(",")",["T_WHITESPACE","\n            ",682],["T_OBJECT_OPERATOR","->",683],["T_STRING","setOrderFilter",683],"(",["T_VARIABLE","$orderFilter",683],")",["T_WHITESPACE","\n            ",683],["T_OBJECT_OPERATOR","->",684],["T_STRING","addPaymentIdFilter",684],"(",["T_VARIABLE","$paymentId",684],")",["T_WHITESPACE","\n            ",684],["T_OBJECT_OPERATOR","->",685],["T_STRING","addParentIdFilter",685],"(",["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","getId",685],"(",")",")",";",["T_WHITESPACE","\n\n        ",685],["T_COMMENT","\/\/ set basic children array and attempt to map them per txn_id, if all of them have txn_id\n",687],["T_WHITESPACE","        ",688],["T_VARIABLE","$this",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","_children",688],["T_WHITESPACE"," ",688],"=",["T_WHITESPACE"," ",688],["T_ARRAY","array",688],"(",")",";",["T_WHITESPACE","\n        ",688],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","_identifiedChildren",689],["T_WHITESPACE"," ",689],"=",["T_WHITESPACE"," ",689],["T_ARRAY","array",689],"(",")",";",["T_WHITESPACE","\n        ",689],["T_FOREACH","foreach",690],["T_WHITESPACE"," ",690],"(",["T_VARIABLE","$children",690],["T_WHITESPACE"," ",690],["T_AS","as",690],["T_WHITESPACE"," ",690],["T_VARIABLE","$child",690],")",["T_WHITESPACE"," ",690],"{",["T_WHITESPACE","\n            ",690],["T_IF","if",691],["T_WHITESPACE"," ",691],"(",["T_VARIABLE","$payment",691],")",["T_WHITESPACE"," ",691],"{",["T_WHITESPACE","\n                ",691],["T_VARIABLE","$child",692],["T_OBJECT_OPERATOR","->",692],["T_STRING","setOrderPaymentObject",692],"(",["T_VARIABLE","$payment",692],")",";",["T_WHITESPACE","\n            ",692],"}",["T_WHITESPACE","\n            ",693],["T_VARIABLE","$this",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","_children",694],"[",["T_VARIABLE","$child",694],["T_OBJECT_OPERATOR","->",694],["T_STRING","getId",694],"(",")","]",["T_WHITESPACE"," ",694],"=",["T_WHITESPACE"," ",694],["T_VARIABLE","$child",694],";",["T_WHITESPACE","\n            ",694],["T_IF","if",695],["T_WHITESPACE"," ",695],"(",["T_STRING","false",695],["T_WHITESPACE"," ",695],["T_IS_NOT_IDENTICAL","!==",695],["T_WHITESPACE"," ",695],["T_VARIABLE","$this",695],["T_OBJECT_OPERATOR","->",695],["T_STRING","_identifiedChildren",695],")",["T_WHITESPACE"," ",695],"{",["T_WHITESPACE","\n                ",695],["T_VARIABLE","$childTxnId",696],["T_WHITESPACE"," ",696],"=",["T_WHITESPACE"," ",696],["T_VARIABLE","$child",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","getTxnId",696],"(",")",";",["T_WHITESPACE","\n                ",696],["T_IF","if",697],["T_WHITESPACE"," ",697],"(","!",["T_VARIABLE","$childTxnId",697],["T_WHITESPACE"," ",697],["T_BOOLEAN_OR","||",697],["T_WHITESPACE"," ",697],["T_CONSTANT_ENCAPSED_STRING","'0'",697],["T_WHITESPACE"," ",697],["T_IS_EQUAL","==",697],["T_WHITESPACE"," ",697],["T_VARIABLE","$childTxnId",697],")",["T_WHITESPACE"," ",697],"{",["T_WHITESPACE","\n                    ",697],["T_VARIABLE","$this",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","_identifiedChildren",698],["T_WHITESPACE"," ",698],"=",["T_WHITESPACE"," ",698],["T_STRING","false",698],";",["T_WHITESPACE","\n                ",698],"}",["T_WHITESPACE"," ",699],["T_ELSE","else",699],["T_WHITESPACE"," ",699],"{",["T_WHITESPACE","\n                    ",699],["T_VARIABLE","$this",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","_identifiedChildren",700],"[",["T_VARIABLE","$child",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","getTxnId",700],"(",")","]",["T_WHITESPACE"," ",700],"=",["T_WHITESPACE"," ",700],["T_VARIABLE","$child",700],";",["T_WHITESPACE","\n                ",700],"}",["T_WHITESPACE","\n            ",701],"}",["T_WHITESPACE","\n        ",702],"}",["T_WHITESPACE","\n        ",703],["T_IF","if",704],["T_WHITESPACE"," ",704],"(",["T_STRING","false",704],["T_WHITESPACE"," ",704],["T_IS_IDENTICAL","===",704],["T_WHITESPACE"," ",704],["T_VARIABLE","$this",704],["T_OBJECT_OPERATOR","->",704],["T_STRING","_identifiedChildren",704],")",["T_WHITESPACE"," ",704],"{",["T_WHITESPACE","\n            ",704],["T_VARIABLE","$this",705],["T_OBJECT_OPERATOR","->",705],["T_STRING","_identifiedChildren",705],["T_WHITESPACE"," ",705],"=",["T_WHITESPACE"," ",705],["T_ARRAY","array",705],"(",")",";",["T_WHITESPACE","\n        ",705],"}",["T_WHITESPACE","\n    ",706],"}",["T_WHITESPACE","\n\n    ",707],["T_DOC_COMMENT","\/**\n     * Check whether this transaction is voided\n     * TODO: implement that there should be only one void per authorization\n     * @return bool\n     *\/",709],["T_WHITESPACE","\n    ",713],["T_PROTECTED","protected",714],["T_WHITESPACE"," ",714],["T_FUNCTION","function",714],["T_WHITESPACE"," ",714],["T_STRING","_isVoided",714],"(",")",["T_WHITESPACE","\n    ",714],"{",["T_WHITESPACE","\n        ",715],["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","_verifyThisTransactionExists",716],"(",")",";",["T_WHITESPACE","\n        ",716],["T_RETURN","return",717],["T_WHITESPACE"," ",717],["T_STRING","self",717],["T_DOUBLE_COLON","::",717],["T_STRING","TYPE_AUTH",717],["T_WHITESPACE"," ",717],["T_IS_IDENTICAL","===",717],["T_WHITESPACE"," ",717],["T_VARIABLE","$this",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","getTxnType",717],"(",")",["T_WHITESPACE","\n            ",717],["T_BOOLEAN_AND","&&",718],["T_WHITESPACE"," ",718],["T_BOOL_CAST","(bool)",718],["T_STRING","count",718],"(",["T_VARIABLE","$this",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getChildTransactions",718],"(",["T_STRING","self",718],["T_DOUBLE_COLON","::",718],["T_STRING","TYPE_VOID",718],")",")",";",["T_WHITESPACE","\n    ",718],"}",["T_WHITESPACE","\n\n    ",719],["T_DOC_COMMENT","\/**\n     * Check whether this transaction is voided\n     * @return bool\n     *\/",721],["T_WHITESPACE","\n    ",724],["T_PUBLIC","public",725],["T_WHITESPACE"," ",725],["T_FUNCTION","function",725],["T_WHITESPACE"," ",725],["T_STRING","isVoided",725],"(",")",["T_WHITESPACE","\n    ",725],"{",["T_WHITESPACE","\n        ",726],["T_RETURN","return",727],["T_WHITESPACE"," ",727],["T_VARIABLE","$this",727],["T_OBJECT_OPERATOR","->",727],["T_STRING","_isVoided",727],"(",")",";",["T_WHITESPACE","\n    ",727],"}",["T_WHITESPACE","\n\n    ",728],["T_DOC_COMMENT","\/**\n     * Retrieve transaction types\n     *\n     * @return array\n     *\/",730],["T_WHITESPACE","\n    ",734],["T_PUBLIC","public",735],["T_WHITESPACE"," ",735],["T_FUNCTION","function",735],["T_WHITESPACE"," ",735],["T_STRING","getTransactionTypes",735],"(",")",["T_WHITESPACE","\n    ",735],"{",["T_WHITESPACE","\n        ",736],["T_RETURN","return",737],["T_WHITESPACE"," ",737],["T_ARRAY","array",737],"(",["T_WHITESPACE","\n            ",737],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",738],["T_DOUBLE_COLON","::",738],["T_STRING","TYPE_ORDER",738],["T_WHITESPACE","    ",738],["T_DOUBLE_ARROW","=>",738],["T_WHITESPACE"," ",738],["T_STRING","Mage",738],["T_DOUBLE_COLON","::",738],["T_STRING","helper",738],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",738],")",["T_OBJECT_OPERATOR","->",738],["T_STRING","__",738],"(",["T_CONSTANT_ENCAPSED_STRING","'Order'",738],")",",",["T_WHITESPACE","\n            ",738],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",739],["T_DOUBLE_COLON","::",739],["T_STRING","TYPE_AUTH",739],["T_WHITESPACE","    ",739],["T_DOUBLE_ARROW","=>",739],["T_WHITESPACE"," ",739],["T_STRING","Mage",739],["T_DOUBLE_COLON","::",739],["T_STRING","helper",739],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",739],")",["T_OBJECT_OPERATOR","->",739],["T_STRING","__",739],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorization'",739],")",",",["T_WHITESPACE","\n            ",739],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",740],["T_DOUBLE_COLON","::",740],["T_STRING","TYPE_CAPTURE",740],["T_WHITESPACE"," ",740],["T_DOUBLE_ARROW","=>",740],["T_WHITESPACE"," ",740],["T_STRING","Mage",740],["T_DOUBLE_COLON","::",740],["T_STRING","helper",740],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",740],")",["T_OBJECT_OPERATOR","->",740],["T_STRING","__",740],"(",["T_CONSTANT_ENCAPSED_STRING","'Capture'",740],")",",",["T_WHITESPACE","\n            ",740],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",741],["T_DOUBLE_COLON","::",741],["T_STRING","TYPE_VOID",741],["T_WHITESPACE","    ",741],["T_DOUBLE_ARROW","=>",741],["T_WHITESPACE"," ",741],["T_STRING","Mage",741],["T_DOUBLE_COLON","::",741],["T_STRING","helper",741],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",741],")",["T_OBJECT_OPERATOR","->",741],["T_STRING","__",741],"(",["T_CONSTANT_ENCAPSED_STRING","'Void'",741],")",",",["T_WHITESPACE","\n            ",741],["T_STRING","Mage_Sales_Model_Order_Payment_Transaction",742],["T_DOUBLE_COLON","::",742],["T_STRING","TYPE_REFUND",742],["T_WHITESPACE","  ",742],["T_DOUBLE_ARROW","=>",742],["T_WHITESPACE"," ",742],["T_STRING","Mage",742],["T_DOUBLE_COLON","::",742],["T_STRING","helper",742],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",742],")",["T_OBJECT_OPERATOR","->",742],["T_STRING","__",742],"(",["T_CONSTANT_ENCAPSED_STRING","'Refund'",742],")",["T_WHITESPACE","\n        ",742],")",";",["T_WHITESPACE","\n    ",743],"}",["T_WHITESPACE","\n\n    ",744],["T_DOC_COMMENT","\/**\n     * Retrieve order website id\n     *\n     * @return int\n     *\/",746],["T_WHITESPACE","\n    ",750],["T_PUBLIC","public",751],["T_WHITESPACE"," ",751],["T_FUNCTION","function",751],["T_WHITESPACE"," ",751],["T_STRING","getOrderWebsiteId",751],"(",")",["T_WHITESPACE","\n    ",751],"{",["T_WHITESPACE","\n        ",752],["T_IF","if",753],["T_WHITESPACE"," ",753],"(",["T_STRING","is_null",753],"(",["T_VARIABLE","$this",753],["T_OBJECT_OPERATOR","->",753],["T_STRING","_orderWebsiteId",753],")",")",["T_WHITESPACE"," ",753],"{",["T_WHITESPACE","\n            ",753],["T_VARIABLE","$this",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","_orderWebsiteId",754],["T_WHITESPACE"," ",754],"=",["T_WHITESPACE"," ",754],["T_INT_CAST","(int)",754],["T_VARIABLE","$this",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","getResource",754],"(",")",["T_OBJECT_OPERATOR","->",754],["T_STRING","getOrderWebsiteId",754],"(",["T_VARIABLE","$this",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","getOrderId",754],"(",")",")",";",["T_WHITESPACE","\n        ",754],"}",["T_WHITESPACE","\n        ",755],["T_RETURN","return",756],["T_WHITESPACE"," ",756],["T_VARIABLE","$this",756],["T_OBJECT_OPERATOR","->",756],["T_STRING","_orderWebsiteId",756],";",["T_WHITESPACE","\n    ",756],"}",["T_WHITESPACE","\n\n    ",757],["T_DOC_COMMENT","\/**\n     * Check whether specified or set transaction type is supported\n     * @param string $txnType\n     * @throws Mage_Core_Exception\n     *\/",759],["T_WHITESPACE","\n    ",763],["T_PROTECTED","protected",764],["T_WHITESPACE"," ",764],["T_FUNCTION","function",764],["T_WHITESPACE"," ",764],["T_STRING","_verifyTxnType",764],"(",["T_VARIABLE","$txnType",764],["T_WHITESPACE"," ",764],"=",["T_WHITESPACE"," ",764],["T_STRING","null",764],")",["T_WHITESPACE","\n    ",764],"{",["T_WHITESPACE","\n        ",765],["T_IF","if",766],["T_WHITESPACE"," ",766],"(",["T_STRING","null",766],["T_WHITESPACE"," ",766],["T_IS_IDENTICAL","===",766],["T_WHITESPACE"," ",766],["T_VARIABLE","$txnType",766],")",["T_WHITESPACE"," ",766],"{",["T_WHITESPACE","\n            ",766],["T_VARIABLE","$txnType",767],["T_WHITESPACE"," ",767],"=",["T_WHITESPACE"," ",767],["T_VARIABLE","$this",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","getTxnType",767],"(",")",";",["T_WHITESPACE","\n        ",767],"}",["T_WHITESPACE","\n        ",768],["T_SWITCH","switch",769],["T_WHITESPACE"," ",769],"(",["T_VARIABLE","$txnType",769],")",["T_WHITESPACE"," ",769],"{",["T_WHITESPACE","\n            ",769],["T_CASE","case",770],["T_WHITESPACE"," ",770],["T_STRING","self",770],["T_DOUBLE_COLON","::",770],["T_STRING","TYPE_PAYMENT",770],":",["T_WHITESPACE","\n            ",770],["T_CASE","case",771],["T_WHITESPACE"," ",771],["T_STRING","self",771],["T_DOUBLE_COLON","::",771],["T_STRING","TYPE_ORDER",771],":",["T_WHITESPACE","\n            ",771],["T_CASE","case",772],["T_WHITESPACE"," ",772],["T_STRING","self",772],["T_DOUBLE_COLON","::",772],["T_STRING","TYPE_AUTH",772],":",["T_WHITESPACE","\n            ",772],["T_CASE","case",773],["T_WHITESPACE"," ",773],["T_STRING","self",773],["T_DOUBLE_COLON","::",773],["T_STRING","TYPE_CAPTURE",773],":",["T_WHITESPACE","\n            ",773],["T_CASE","case",774],["T_WHITESPACE"," ",774],["T_STRING","self",774],["T_DOUBLE_COLON","::",774],["T_STRING","TYPE_VOID",774],":",["T_WHITESPACE","\n            ",774],["T_CASE","case",775],["T_WHITESPACE"," ",775],["T_STRING","self",775],["T_DOUBLE_COLON","::",775],["T_STRING","TYPE_REFUND",775],":",["T_WHITESPACE","\n                ",775],["T_BREAK","break",776],";",["T_WHITESPACE","\n            ",776],["T_DEFAULT","default",777],":",["T_WHITESPACE","\n                ",777],["T_STRING","Mage",778],["T_DOUBLE_COLON","::",778],["T_STRING","throwException",778],"(",["T_STRING","Mage",778],["T_DOUBLE_COLON","::",778],["T_STRING","helper",778],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",778],")",["T_OBJECT_OPERATOR","->",778],["T_STRING","__",778],"(",["T_CONSTANT_ENCAPSED_STRING","'Unsupported transaction type \"%s\".'",778],",",["T_WHITESPACE"," ",778],["T_VARIABLE","$txnType",778],")",")",";",["T_WHITESPACE","\n        ",778],"}",["T_WHITESPACE","\n    ",779],"}",["T_WHITESPACE","\n\n    ",780],["T_DOC_COMMENT","\/**\n     * Check whether the payment object is set and it has order object or there is an order_id is set\n     * $dryRun allows to not throw exception\n     * @param bool $dryRun\n     * @return Mage_Sales_Model_Order_Payment|null|false\n     * @throws Mage_Core_Exception\n     *\/",782],["T_WHITESPACE","\n    ",788],["T_PROTECTED","protected",789],["T_WHITESPACE"," ",789],["T_FUNCTION","function",789],["T_WHITESPACE"," ",789],["T_STRING","_verifyPaymentObject",789],"(",["T_VARIABLE","$dryRun",789],["T_WHITESPACE"," ",789],"=",["T_WHITESPACE"," ",789],["T_STRING","false",789],")",["T_WHITESPACE","\n    ",789],"{",["T_WHITESPACE","\n        ",790],["T_IF","if",791],["T_WHITESPACE"," ",791],"(","!",["T_VARIABLE","$this",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","_paymentObject",791],["T_WHITESPACE"," ",791],["T_BOOLEAN_OR","||",791],["T_WHITESPACE"," ",791],"!",["T_VARIABLE","$this",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","getOrderId",791],"(",")",")",["T_WHITESPACE"," ",791],"{",["T_WHITESPACE","\n            ",791],["T_IF","if",792],["T_WHITESPACE"," ",792],"(","!",["T_VARIABLE","$dryRun",792],")",["T_WHITESPACE"," ",792],"{",["T_WHITESPACE","\n                ",792],["T_STRING","Mage",793],["T_DOUBLE_COLON","::",793],["T_STRING","throwException",793],"(",["T_STRING","Mage",793],["T_DOUBLE_COLON","::",793],["T_STRING","helper",793],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",793],")",["T_OBJECT_OPERATOR","->",793],["T_STRING","__",793],"(",["T_CONSTANT_ENCAPSED_STRING","'Proper payment object must be set.'",793],")",")",";",["T_WHITESPACE","\n            ",793],"}",["T_WHITESPACE","\n        ",794],"}",["T_WHITESPACE","\n        ",795],["T_RETURN","return",796],["T_WHITESPACE"," ",796],["T_VARIABLE","$this",796],["T_OBJECT_OPERATOR","->",796],["T_STRING","_paymentObject",796],";",["T_WHITESPACE","\n    ",796],"}",["T_WHITESPACE","\n\n    ",797],["T_DOC_COMMENT","\/**\n     * Check whether specified transaction ID is valid\n     * @param string $txnId\n     * @throws Mage_Core_Exception\n     *\/",799],["T_WHITESPACE","\n    ",803],["T_PROTECTED","protected",804],["T_WHITESPACE"," ",804],["T_FUNCTION","function",804],["T_WHITESPACE"," ",804],["T_STRING","_verifyTxnId",804],"(",["T_VARIABLE","$txnId",804],")",["T_WHITESPACE","\n    ",804],"{",["T_WHITESPACE","\n        ",805],["T_IF","if",806],["T_WHITESPACE"," ",806],"(",["T_STRING","null",806],["T_WHITESPACE"," ",806],["T_IS_NOT_IDENTICAL","!==",806],["T_WHITESPACE"," ",806],["T_VARIABLE","$txnId",806],["T_WHITESPACE"," ",806],["T_BOOLEAN_AND","&&",806],["T_WHITESPACE"," ",806],["T_LNUMBER","0",806],["T_WHITESPACE"," ",806],["T_IS_EQUAL","==",806],["T_WHITESPACE"," ",806],["T_STRING","strlen",806],"(",["T_VARIABLE","$txnId",806],")",")",["T_WHITESPACE"," ",806],"{",["T_WHITESPACE","\n            ",806],["T_STRING","Mage",807],["T_DOUBLE_COLON","::",807],["T_STRING","throwException",807],"(",["T_STRING","Mage",807],["T_DOUBLE_COLON","::",807],["T_STRING","helper",807],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",807],")",["T_OBJECT_OPERATOR","->",807],["T_STRING","__",807],"(",["T_CONSTANT_ENCAPSED_STRING","'Transaction ID must not be empty.'",807],")",")",";",["T_WHITESPACE","\n        ",807],"}",["T_WHITESPACE","\n    ",808],"}",["T_WHITESPACE","\n\n    ",809],["T_DOC_COMMENT","\/**\n     * Make sure this object is a valid transaction\n     * TODO for more restriction we can check for data consistency\n     * @throws Mage_Core_Exception\n     *\/",811],["T_WHITESPACE","\n    ",815],["T_PROTECTED","protected",816],["T_WHITESPACE"," ",816],["T_FUNCTION","function",816],["T_WHITESPACE"," ",816],["T_STRING","_verifyThisTransactionExists",816],"(",")",["T_WHITESPACE","\n    ",816],"{",["T_WHITESPACE","\n        ",817],["T_IF","if",818],["T_WHITESPACE"," ",818],"(","!",["T_VARIABLE","$this",818],["T_OBJECT_OPERATOR","->",818],["T_STRING","getId",818],"(",")",")",["T_WHITESPACE"," ",818],"{",["T_WHITESPACE","\n            ",818],["T_STRING","Mage",819],["T_DOUBLE_COLON","::",819],["T_STRING","throwException",819],"(",["T_STRING","Mage",819],["T_DOUBLE_COLON","::",819],["T_STRING","helper",819],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",819],")",["T_OBJECT_OPERATOR","->",819],["T_STRING","__",819],"(",["T_CONSTANT_ENCAPSED_STRING","'This operation requires an existing transaction object.'",819],")",")",";",["T_WHITESPACE","\n        ",819],"}",["T_WHITESPACE","\n        ",820],["T_VARIABLE","$this",821],["T_OBJECT_OPERATOR","->",821],["T_STRING","_verifyTxnType",821],"(",")",";",["T_WHITESPACE","\n    ",821],"}",["T_WHITESPACE","\n\n    ",822],["T_DOC_COMMENT","\/**\n     * Get HTML format for transaction id\n     *\n     * @return string\n     *\/",824],["T_WHITESPACE","\n    ",828],["T_PUBLIC","public",829],["T_WHITESPACE"," ",829],["T_FUNCTION","function",829],["T_WHITESPACE"," ",829],["T_STRING","getHtmlTxnId",829],"(",")",["T_WHITESPACE","\n    ",829],"{",["T_WHITESPACE","\n        ",830],["T_STRING","Mage",831],["T_DOUBLE_COLON","::",831],["T_STRING","dispatchEvent",831],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_html_txn_id'",831],",",["T_WHITESPACE"," ",831],["T_ARRAY","array",831],"(",["T_CONSTANT_ENCAPSED_STRING","'transaction'",831],["T_WHITESPACE"," ",831],["T_DOUBLE_ARROW","=>",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$this",831],",",["T_WHITESPACE"," ",831],["T_CONSTANT_ENCAPSED_STRING","'payment'",831],["T_WHITESPACE"," ",831],["T_DOUBLE_ARROW","=>",831],["T_WHITESPACE"," ",831],["T_VARIABLE","$this",831],["T_OBJECT_OPERATOR","->",831],["T_STRING","_paymentObject",831],")",")",";",["T_WHITESPACE","\n        ",831],["T_RETURN","return",832],["T_WHITESPACE"," ",832],["T_ISSET","isset",832],"(",["T_VARIABLE","$this",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","_data",832],"[",["T_CONSTANT_ENCAPSED_STRING","'html_txn_id'",832],"]",")",["T_WHITESPACE"," ",832],"?",["T_WHITESPACE"," ",832],["T_VARIABLE","$this",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","_data",832],"[",["T_CONSTANT_ENCAPSED_STRING","'html_txn_id'",832],"]",["T_WHITESPACE"," ",832],":",["T_WHITESPACE"," ",832],["T_VARIABLE","$this",832],["T_OBJECT_OPERATOR","->",832],["T_STRING","getTxnId",832],"(",")",";",["T_WHITESPACE","\n    ",832],"}",["T_WHITESPACE","\n",833],"}",["T_WHITESPACE","\n",834]]