[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Quote submit service model\n *\/",27],["T_WHITESPACE","\n",29],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","Mage_Sales_Model_Service_Order",30],["T_WHITESPACE","\n",30],"{",["T_WHITESPACE","\n    ",31],["T_DOC_COMMENT","\/**\n     * Order object\n     *\n     * @var Mage_Sales_Model_Order\n     *\/",32],["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_order",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Quote convert object\n     *\n     * @var Mage_Sales_Model_Convert_Order\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_convertor",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Class constructor\n     *\n     * @param Mage_Sales_Model_Order $order\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","__construct",51],"(",["T_STRING","Mage_Sales_Model_Order",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$order",51],")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","_order",53],["T_WHITESPACE","       ",53],"=",["T_WHITESPACE"," ",53],["T_VARIABLE","$order",53],";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_convertor",54],["T_WHITESPACE","   ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","Mage",54],["T_DOUBLE_COLON","::",54],["T_STRING","getModel",54],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/convert_order'",54],")",";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Quote convertor declaration\n     *\n     * @param   Mage_Sales_Model_Convert_Order $convertor\n     * @return  Mage_Sales_Model_Service_Order\n     *\/",57],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","setConvertor",63],"(",["T_STRING","Mage_Sales_Model_Convert_Order",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$convertor",63],")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","_convertor",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$convertor",65],";",["T_WHITESPACE","\n        ",65],["T_RETURN","return",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$this",66],";",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Get assigned order object\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",69],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","getOrder",74],"(",")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_order",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Updates numeric data taking into account locale\n     *\n     * @param array $data\n     * @return Mage_Sales_Model_Service_Order\n     *\/",79],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","updateLocaleNumbers",85],"(","&",["T_VARIABLE","$data",85],")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(",["T_STRING","is_array",87],"(",["T_VARIABLE","$data",87],")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_FOREACH","foreach",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$data",88],["T_WHITESPACE"," ",88],["T_AS","as",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$key",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$value",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_STRING","is_string",89],"(",["T_VARIABLE","$value",89],")",["T_WHITESPACE"," ",89],["T_BOOLEAN_OR","||",89],["T_WHITESPACE"," ",89],["T_STRING","is_numeric",89],"(",["T_VARIABLE","$value",89],")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n                    ",89],["T_VARIABLE","$data",90],"[",["T_VARIABLE","$key",90],"]",["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_getLocaleNumber",90],"(",["T_VARIABLE","$value",90],")",";",["T_WHITESPACE","\n                ",90],"}",["T_WHITESPACE","\n            ",91],"}",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n        ",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],";",["T_WHITESPACE","\n    ",94],"}",["T_WHITESPACE","\n\n    ",95],["T_DOC_COMMENT","\/**\n     * Perform numbers conversion according to locale\n     *\n     * @param mixed $value\n     * @return float\n     *\/",97],["T_WHITESPACE","\n    ",102],["T_PROTECTED","protected",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","_getLocaleNumber",103],"(",["T_VARIABLE","$value",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","app",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getLocale",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","getNumber",105],"(",["T_VARIABLE","$value",105],")",";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Prepare order invoice based on order data and requested items qtys. If $qtys is not empty - the function will\n     * prepare only specified items, otherwise all containing in the order.\n     *\n     * @param array $qtys\n     * @return Mage_Sales_Model_Order_Invoice\n     *\/",108],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","prepareInvoice",115],"(",["T_VARIABLE","$qtys",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_ARRAY","array",115],"(",")",")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","updateLocaleNumbers",117],"(",["T_VARIABLE","$qtys",117],")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$invoice",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_convertor",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","toInvoice",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_order",118],")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$totalQty",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_LNUMBER","0",119],";",["T_WHITESPACE","\n        ",119],["T_FOREACH","foreach",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_order",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getAllItems",120],"(",")",["T_WHITESPACE"," ",120],["T_AS","as",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$orderItem",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_IF","if",121],["T_WHITESPACE"," ",121],"(","!",["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_canInvoiceItem",121],"(",["T_VARIABLE","$orderItem",121],",",["T_WHITESPACE"," ",121],["T_ARRAY","array",121],"(",")",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                ",121],["T_CONTINUE","continue",122],";",["T_WHITESPACE","\n            ",122],"}",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$item",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_convertor",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","itemToInvoiceItem",124],"(",["T_VARIABLE","$orderItem",124],")",";",["T_WHITESPACE","\n            ",124],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$orderItem",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","isDummy",125],"(",")",")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n                ",125],["T_VARIABLE","$qty",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$orderItem",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getQtyOrdered",126],"(",")",["T_WHITESPACE"," ",126],"?",["T_WHITESPACE"," ",126],["T_VARIABLE","$orderItem",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getQtyOrdered",126],"(",")",["T_WHITESPACE"," ",126],":",["T_WHITESPACE"," ",126],["T_LNUMBER","1",126],";",["T_WHITESPACE","\n            ",126],"}",["T_WHITESPACE"," ",127],["T_ELSE","else",127],["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n                ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_ISSET","isset",128],"(",["T_VARIABLE","$qtys",128],"[",["T_VARIABLE","$orderItem",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getId",128],"(",")","]",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                    ",128],["T_VARIABLE","$qty",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_DOUBLE_CAST","(float)",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$qtys",129],"[",["T_VARIABLE","$orderItem",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getId",129],"(",")","]",";",["T_WHITESPACE","\n                ",129],"}",["T_WHITESPACE"," ",130],["T_ELSEIF","elseif",130],["T_WHITESPACE"," ",130],"(","!",["T_STRING","count",130],"(",["T_VARIABLE","$qtys",130],")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                    ",130],["T_VARIABLE","$qty",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$orderItem",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getQtyToInvoice",131],"(",")",";",["T_WHITESPACE","\n                ",131],"}",["T_WHITESPACE"," ",132],["T_ELSE","else",132],["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                    ",132],["T_VARIABLE","$qty",133],["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_LNUMBER","0",133],";",["T_WHITESPACE","\n                ",133],"}",["T_WHITESPACE","\n            ",134],"}",["T_WHITESPACE","\n\n            ",135],["T_VARIABLE","$totalQty",137],["T_WHITESPACE"," ",137],["T_PLUS_EQUAL","+=",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$qty",137],";",["T_WHITESPACE","\n            ",137],["T_VARIABLE","$item",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","setQty",138],"(",["T_VARIABLE","$qty",138],")",";",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$invoice",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","addItem",139],"(",["T_VARIABLE","$item",139],")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE","\n\n        ",140],["T_VARIABLE","$invoice",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","setTotalQty",142],"(",["T_VARIABLE","$totalQty",142],")",";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$invoice",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","collectTotals",143],"(",")",";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_order",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getInvoiceCollection",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","addItem",144],"(",["T_VARIABLE","$invoice",144],")",";",["T_WHITESPACE","\n\n        ",144],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$invoice",146],";",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Prepare order shipment based on order items and requested items qty\n     *\n     * @param array $qtys\n     * @return Mage_Sales_Model_Order_Shipment\n     *\/",149],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","prepareShipment",155],"(",["T_VARIABLE","$qtys",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_ARRAY","array",155],"(",")",")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","updateLocaleNumbers",157],"(",["T_VARIABLE","$qtys",157],")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$totalQty",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_LNUMBER","0",158],";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$shipment",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_convertor",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","toShipment",159],"(",["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_order",159],")",";",["T_WHITESPACE","\n        ",159],["T_FOREACH","foreach",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_order",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getAllItems",160],"(",")",["T_WHITESPACE"," ",160],["T_AS","as",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$orderItem",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n            ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(","!",["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_canShipItem",161],"(",["T_VARIABLE","$orderItem",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$qtys",161],")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n                ",161],["T_CONTINUE","continue",162],";",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE","\n\n            ",163],["T_VARIABLE","$item",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_convertor",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","itemToShipmentItem",165],"(",["T_VARIABLE","$orderItem",165],")",";",["T_WHITESPACE","\n\n            ",165],["T_IF","if",167],["T_WHITESPACE"," ",167],"(",["T_VARIABLE","$orderItem",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","isDummy",167],"(",["T_STRING","true",167],")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$qty",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_LNUMBER","0",168],";",["T_WHITESPACE","\n                ",168],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_ISSET","isset",169],"(",["T_VARIABLE","$qtys",169],"[",["T_VARIABLE","$orderItem",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getParentItemId",169],"(",")","]",")",")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n                    ",169],["T_VARIABLE","$productOptions",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$orderItem",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getProductOptions",170],"(",")",";",["T_WHITESPACE","\n                    ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_ISSET","isset",171],"(",["T_VARIABLE","$productOptions",171],"[",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_attributes'",171],"]",")",")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n                        ",171],["T_VARIABLE","$bundleSelectionAttributes",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","unserialize",172],"(",["T_VARIABLE","$productOptions",172],"[",["T_CONSTANT_ENCAPSED_STRING","'bundle_selection_attributes'",172],"]",")",";",["T_WHITESPACE","\n\n                        ",172],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_VARIABLE","$bundleSelectionAttributes",174],")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n                            ",174],["T_VARIABLE","$qty",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$bundleSelectionAttributes",175],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",175],"]",["T_WHITESPACE"," ",175],"*",["T_WHITESPACE"," ",175],["T_VARIABLE","$qtys",175],"[",["T_VARIABLE","$orderItem",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getParentItemId",175],"(",")","]",";",["T_WHITESPACE","\n                            ",175],["T_VARIABLE","$qty",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_STRING","min",176],"(",["T_VARIABLE","$qty",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$orderItem",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getSimpleQtyToShip",176],"(",")",")",";",["T_WHITESPACE","\n\n                            ",176],["T_VARIABLE","$item",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","setQty",178],"(",["T_VARIABLE","$qty",178],")",";",["T_WHITESPACE","\n                            ",178],["T_VARIABLE","$shipment",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","addItem",179],"(",["T_VARIABLE","$item",179],")",";",["T_WHITESPACE","\n                            ",179],["T_CONTINUE","continue",180],";",["T_WHITESPACE","\n                        ",180],"}",["T_WHITESPACE"," ",181],["T_ELSE","else",181],["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                            ",181],["T_VARIABLE","$qty",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_LNUMBER","1",182],";",["T_WHITESPACE","\n                        ",182],"}",["T_WHITESPACE","\n                    ",183],"}",["T_WHITESPACE","\n                ",184],"}",["T_WHITESPACE"," ",185],["T_ELSE","else",185],["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                    ",185],["T_VARIABLE","$qty",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_LNUMBER","1",186],";",["T_WHITESPACE","\n                ",186],"}",["T_WHITESPACE","\n            ",187],"}",["T_WHITESPACE"," ",188],["T_ELSE","else",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n                ",188],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_ISSET","isset",189],"(",["T_VARIABLE","$qtys",189],"[",["T_VARIABLE","$orderItem",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getId",189],"(",")","]",")",")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n                    ",189],["T_VARIABLE","$qty",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_STRING","min",190],"(",["T_VARIABLE","$qtys",190],"[",["T_VARIABLE","$orderItem",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getId",190],"(",")","]",",",["T_WHITESPACE"," ",190],["T_VARIABLE","$orderItem",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getQtyToShip",190],"(",")",")",";",["T_WHITESPACE","\n                ",190],"}",["T_WHITESPACE"," ",191],["T_ELSEIF","elseif",191],["T_WHITESPACE"," ",191],"(","!",["T_STRING","count",191],"(",["T_VARIABLE","$qtys",191],")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n                    ",191],["T_VARIABLE","$qty",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$orderItem",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getQtyToShip",192],"(",")",";",["T_WHITESPACE","\n                ",192],"}",["T_WHITESPACE"," ",193],["T_ELSE","else",193],["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n                    ",193],["T_CONTINUE","continue",194],";",["T_WHITESPACE","\n                ",194],"}",["T_WHITESPACE","\n            ",195],"}",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$totalQty",197],["T_WHITESPACE"," ",197],["T_PLUS_EQUAL","+=",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$qty",197],";",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$item",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","setQty",198],"(",["T_VARIABLE","$qty",198],")",";",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$shipment",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","addItem",199],"(",["T_VARIABLE","$item",199],")",";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE","\n\n        ",200],["T_VARIABLE","$shipment",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","setTotalQty",202],"(",["T_VARIABLE","$totalQty",202],")",";",["T_WHITESPACE","\n        ",202],["T_RETURN","return",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$shipment",203],";",["T_WHITESPACE","\n    ",203],"}",["T_WHITESPACE","\n\n    ",204],["T_DOC_COMMENT","\/**\n     * Prepare order creditmemo based on order items and requested params\n     *\n     * @param array $data\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",206],["T_WHITESPACE","\n    ",211],["T_PUBLIC","public",212],["T_WHITESPACE"," ",212],["T_FUNCTION","function",212],["T_WHITESPACE"," ",212],["T_STRING","prepareCreditmemo",212],"(",["T_VARIABLE","$data",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_ARRAY","array",212],"(",")",")",["T_WHITESPACE","\n    ",212],"{",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$totalQty",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_LNUMBER","0",214],";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$creditmemo",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_convertor",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","toCreditmemo",215],"(",["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_order",215],")",";",["T_WHITESPACE","\n        ",215],["T_VARIABLE","$qtys",216],["T_WHITESPACE"," ",216],"=",["T_WHITESPACE"," ",216],["T_ISSET","isset",216],"(",["T_VARIABLE","$data",216],"[",["T_CONSTANT_ENCAPSED_STRING","'qtys'",216],"]",")",["T_WHITESPACE"," ",216],"?",["T_WHITESPACE"," ",216],["T_VARIABLE","$data",216],"[",["T_CONSTANT_ENCAPSED_STRING","'qtys'",216],"]",["T_WHITESPACE"," ",216],":",["T_WHITESPACE"," ",216],["T_ARRAY","array",216],"(",")",";",["T_WHITESPACE","\n        ",216],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","updateLocaleNumbers",217],"(",["T_VARIABLE","$qtys",217],")",";",["T_WHITESPACE","\n\n        ",217],["T_FOREACH","foreach",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_order",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getAllItems",219],"(",")",["T_WHITESPACE"," ",219],["T_AS","as",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$orderItem",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(","!",["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_canRefundItem",220],"(",["T_VARIABLE","$orderItem",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$qtys",220],")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n                ",220],["T_CONTINUE","continue",221],";",["T_WHITESPACE","\n            ",221],"}",["T_WHITESPACE","\n\n            ",222],["T_VARIABLE","$item",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_convertor",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","itemToCreditmemoItem",224],"(",["T_VARIABLE","$orderItem",224],")",";",["T_WHITESPACE","\n            ",224],["T_IF","if",225],["T_WHITESPACE"," ",225],"(",["T_VARIABLE","$orderItem",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","isDummy",225],"(",")",")",["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n                ",225],["T_VARIABLE","$qty",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_LNUMBER","1",226],";",["T_WHITESPACE","\n                ",226],["T_VARIABLE","$orderItem",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","setLockedDoShip",227],"(",["T_STRING","true",227],")",";",["T_WHITESPACE","\n            ",227],"}",["T_WHITESPACE"," ",228],["T_ELSE","else",228],["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n                ",228],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_ISSET","isset",229],"(",["T_VARIABLE","$qtys",229],"[",["T_VARIABLE","$orderItem",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","getId",229],"(",")","]",")",")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n                    ",229],["T_VARIABLE","$qty",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_DOUBLE_CAST","(float)",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$qtys",230],"[",["T_VARIABLE","$orderItem",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","getId",230],"(",")","]",";",["T_WHITESPACE","\n                ",230],"}",["T_WHITESPACE"," ",231],["T_ELSEIF","elseif",231],["T_WHITESPACE"," ",231],"(","!",["T_STRING","count",231],"(",["T_VARIABLE","$qtys",231],")",")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n                    ",231],["T_VARIABLE","$qty",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_VARIABLE","$orderItem",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getQtyToRefund",232],"(",")",";",["T_WHITESPACE","\n                ",232],"}",["T_WHITESPACE"," ",233],["T_ELSE","else",233],["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n                    ",233],["T_CONTINUE","continue",234],";",["T_WHITESPACE","\n                ",234],"}",["T_WHITESPACE","\n            ",235],"}",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$totalQty",237],["T_WHITESPACE"," ",237],["T_PLUS_EQUAL","+=",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$qty",237],";",["T_WHITESPACE","\n            ",237],["T_VARIABLE","$item",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","setQty",238],"(",["T_VARIABLE","$qty",238],")",";",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$creditmemo",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","addItem",239],"(",["T_VARIABLE","$item",239],")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$creditmemo",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setTotalQty",241],"(",["T_VARIABLE","$totalQty",241],")",";",["T_WHITESPACE","\n\n        ",241],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_initCreditmemoData",243],"(",["T_VARIABLE","$creditmemo",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$data",243],")",";",["T_WHITESPACE","\n\n        ",243],["T_VARIABLE","$creditmemo",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","collectTotals",245],"(",")",";",["T_WHITESPACE","\n        ",245],["T_RETURN","return",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$creditmemo",246],";",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * Prepare order creditmemo based on invoice items and requested requested params\n     *\n     * @param Mage_Sales_Model_Order_Invoice $invoice\n     * @param array $data\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",249],["T_WHITESPACE","\n    ",255],["T_PUBLIC","public",256],["T_WHITESPACE"," ",256],["T_FUNCTION","function",256],["T_WHITESPACE"," ",256],["T_STRING","prepareInvoiceCreditmemo",256],"(",["T_VARIABLE","$invoice",256],",",["T_WHITESPACE"," ",256],["T_VARIABLE","$data",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_ARRAY","array",256],"(",")",")",["T_WHITESPACE","\n    ",256],"{",["T_WHITESPACE","\n        ",257],["T_VARIABLE","$totalQty",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_LNUMBER","0",258],";",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$qtys",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_ISSET","isset",259],"(",["T_VARIABLE","$data",259],"[",["T_CONSTANT_ENCAPSED_STRING","'qtys'",259],"]",")",["T_WHITESPACE"," ",259],"?",["T_WHITESPACE"," ",259],["T_VARIABLE","$data",259],"[",["T_CONSTANT_ENCAPSED_STRING","'qtys'",259],"]",["T_WHITESPACE"," ",259],":",["T_WHITESPACE"," ",259],["T_ARRAY","array",259],"(",")",";",["T_WHITESPACE","\n        ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","updateLocaleNumbers",260],"(",["T_VARIABLE","$qtys",260],")",";",["T_WHITESPACE","\n\n        ",260],["T_VARIABLE","$creditmemo",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","_convertor",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","toCreditmemo",262],"(",["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","_order",262],")",";",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$creditmemo",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","setInvoice",263],"(",["T_VARIABLE","$invoice",263],")",";",["T_WHITESPACE","\n\n        ",263],["T_VARIABLE","$invoiceQtysRefunded",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",")",";",["T_WHITESPACE","\n        ",265],["T_FOREACH","foreach",266],"(",["T_VARIABLE","$invoice",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getOrder",266],"(",")",["T_OBJECT_OPERATOR","->",266],["T_STRING","getCreditmemosCollection",266],"(",")",["T_WHITESPACE"," ",266],["T_AS","as",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$createdCreditmemo",266],")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_IF","if",267],["T_WHITESPACE"," ",267],"(",["T_VARIABLE","$createdCreditmemo",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","getState",267],"(",")",["T_WHITESPACE"," ",267],["T_IS_NOT_EQUAL","!=",267],["T_WHITESPACE"," ",267],["T_STRING","Mage_Sales_Model_Order_Creditmemo",267],["T_DOUBLE_COLON","::",267],["T_STRING","STATE_CANCELED",267],["T_WHITESPACE","\n                ",267],["T_BOOLEAN_AND","&&",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$createdCreditmemo",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getInvoiceId",268],"(",")",["T_WHITESPACE"," ",268],["T_IS_EQUAL","==",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$invoice",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getId",268],"(",")",")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n                ",268],["T_FOREACH","foreach",269],"(",["T_VARIABLE","$createdCreditmemo",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getAllItems",269],"(",")",["T_WHITESPACE"," ",269],["T_AS","as",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$createdCreditmemoItem",269],")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n                    ",269],["T_VARIABLE","$orderItemId",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$createdCreditmemoItem",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getOrderItem",270],"(",")",["T_OBJECT_OPERATOR","->",270],["T_STRING","getId",270],"(",")",";",["T_WHITESPACE","\n                    ",270],["T_IF","if",271],["T_WHITESPACE"," ",271],"(",["T_ISSET","isset",271],"(",["T_VARIABLE","$invoiceQtysRefunded",271],"[",["T_VARIABLE","$orderItemId",271],"]",")",")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n                        ",271],["T_VARIABLE","$invoiceQtysRefunded",272],"[",["T_VARIABLE","$orderItemId",272],"]",["T_WHITESPACE"," ",272],["T_PLUS_EQUAL","+=",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$createdCreditmemoItem",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getQty",272],"(",")",";",["T_WHITESPACE","\n                    ",272],"}",["T_WHITESPACE"," ",273],["T_ELSE","else",273],["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n                        ",273],["T_VARIABLE","$invoiceQtysRefunded",274],"[",["T_VARIABLE","$orderItemId",274],"]",["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$createdCreditmemoItem",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getQty",274],"(",")",";",["T_WHITESPACE","\n                    ",274],"}",["T_WHITESPACE","\n                ",275],"}",["T_WHITESPACE","\n            ",276],"}",["T_WHITESPACE","\n        ",277],"}",["T_WHITESPACE","\n\n        ",278],["T_VARIABLE","$invoiceQtysRefundLimits",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_ARRAY","array",280],"(",")",";",["T_WHITESPACE","\n        ",280],["T_FOREACH","foreach",281],"(",["T_VARIABLE","$invoice",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getAllItems",281],"(",")",["T_WHITESPACE"," ",281],["T_AS","as",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$invoiceItem",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n            ",281],["T_VARIABLE","$invoiceQtyCanBeRefunded",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_VARIABLE","$invoiceItem",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getQty",282],"(",")",";",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$orderItemId",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$invoiceItem",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getOrderItem",283],"(",")",["T_OBJECT_OPERATOR","->",283],["T_STRING","getId",283],"(",")",";",["T_WHITESPACE","\n            ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_ISSET","isset",284],"(",["T_VARIABLE","$invoiceQtysRefunded",284],"[",["T_VARIABLE","$orderItemId",284],"]",")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                ",284],["T_VARIABLE","$invoiceQtyCanBeRefunded",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$invoiceQtyCanBeRefunded",285],["T_WHITESPACE"," ",285],"-",["T_WHITESPACE"," ",285],["T_VARIABLE","$invoiceQtysRefunded",285],"[",["T_VARIABLE","$orderItemId",285],"]",";",["T_WHITESPACE","\n            ",285],"}",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$invoiceQtysRefundLimits",287],"[",["T_VARIABLE","$orderItemId",287],"]",["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$invoiceQtyCanBeRefunded",287],";",["T_WHITESPACE","\n        ",287],"}",["T_WHITESPACE","\n\n\n        ",288],["T_FOREACH","foreach",291],["T_WHITESPACE"," ",291],"(",["T_VARIABLE","$invoice",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","getAllItems",291],"(",")",["T_WHITESPACE"," ",291],["T_AS","as",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$invoiceItem",291],")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n            ",291],["T_VARIABLE","$orderItem",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$invoiceItem",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getOrderItem",292],"(",")",";",["T_WHITESPACE","\n\n            ",292],["T_IF","if",294],["T_WHITESPACE"," ",294],"(","!",["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","_canRefundItem",294],"(",["T_VARIABLE","$orderItem",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$qtys",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$invoiceQtysRefundLimits",294],")",")",["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n                ",294],["T_CONTINUE","continue",295],";",["T_WHITESPACE","\n            ",295],"}",["T_WHITESPACE","\n\n            ",296],["T_VARIABLE","$item",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_convertor",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","itemToCreditmemoItem",298],"(",["T_VARIABLE","$orderItem",298],")",";",["T_WHITESPACE","\n            ",298],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$orderItem",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","isDummy",299],"(",")",")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                ",299],["T_VARIABLE","$qty",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_LNUMBER","1",300],";",["T_WHITESPACE","\n            ",300],"}",["T_WHITESPACE"," ",301],["T_ELSE","else",301],["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n                ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_ISSET","isset",302],"(",["T_VARIABLE","$qtys",302],"[",["T_VARIABLE","$orderItem",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getId",302],"(",")","]",")",")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n                    ",302],["T_VARIABLE","$qty",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_DOUBLE_CAST","(float)",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$qtys",303],"[",["T_VARIABLE","$orderItem",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getId",303],"(",")","]",";",["T_WHITESPACE","\n                ",303],"}",["T_WHITESPACE"," ",304],["T_ELSEIF","elseif",304],["T_WHITESPACE"," ",304],"(","!",["T_STRING","count",304],"(",["T_VARIABLE","$qtys",304],")",")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n                    ",304],["T_VARIABLE","$qty",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$orderItem",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getQtyToRefund",305],"(",")",";",["T_WHITESPACE","\n                ",305],"}",["T_WHITESPACE"," ",306],["T_ELSE","else",306],["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n                    ",306],["T_CONTINUE","continue",307],";",["T_WHITESPACE","\n                ",307],"}",["T_WHITESPACE","\n                ",308],["T_IF","if",309],["T_WHITESPACE"," ",309],"(",["T_ISSET","isset",309],"(",["T_VARIABLE","$invoiceQtysRefundLimits",309],"[",["T_VARIABLE","$orderItem",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getId",309],"(",")","]",")",")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n                    ",309],["T_VARIABLE","$qty",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_STRING","min",310],"(",["T_VARIABLE","$qty",310],",",["T_WHITESPACE"," ",310],["T_VARIABLE","$invoiceQtysRefundLimits",310],"[",["T_VARIABLE","$orderItem",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getId",310],"(",")","]",")",";",["T_WHITESPACE","\n                ",310],"}",["T_WHITESPACE","\n            ",311],"}",["T_WHITESPACE","\n            ",312],["T_VARIABLE","$qty",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_STRING","min",313],"(",["T_VARIABLE","$qty",313],",",["T_WHITESPACE"," ",313],["T_VARIABLE","$invoiceItem",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getQty",313],"(",")",")",";",["T_WHITESPACE","\n            ",313],["T_VARIABLE","$totalQty",314],["T_WHITESPACE"," ",314],["T_PLUS_EQUAL","+=",314],["T_WHITESPACE"," ",314],["T_VARIABLE","$qty",314],";",["T_WHITESPACE","\n            ",314],["T_VARIABLE","$item",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","setQty",315],"(",["T_VARIABLE","$qty",315],")",";",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$creditmemo",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","addItem",316],"(",["T_VARIABLE","$item",316],")",";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE","\n        ",317],["T_VARIABLE","$creditmemo",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","setTotalQty",318],"(",["T_VARIABLE","$totalQty",318],")",";",["T_WHITESPACE","\n\n        ",318],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","_initCreditmemoData",320],"(",["T_VARIABLE","$creditmemo",320],",",["T_WHITESPACE"," ",320],["T_VARIABLE","$data",320],")",";",["T_WHITESPACE","\n        ",320],["T_IF","if",321],["T_WHITESPACE"," ",321],"(","!",["T_ISSET","isset",321],"(",["T_VARIABLE","$data",321],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_amount'",321],"]",")",")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_VARIABLE","$order",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_VARIABLE","$invoice",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getOrder",322],"(",")",";",["T_WHITESPACE","\n            ",322],["T_VARIABLE","$isShippingInclTax",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_STRING","Mage",323],["T_DOUBLE_COLON","::",323],["T_STRING","getSingleton",323],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/config'",323],")",["T_OBJECT_OPERATOR","->",323],["T_STRING","displaySalesShippingInclTax",323],"(",["T_VARIABLE","$order",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","getStoreId",323],"(",")",")",";",["T_WHITESPACE","\n            ",323],["T_IF","if",324],["T_WHITESPACE"," ",324],"(",["T_VARIABLE","$isShippingInclTax",324],")",["T_WHITESPACE"," ",324],"{",["T_WHITESPACE","\n                ",324],["T_VARIABLE","$baseAllowedAmount",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_VARIABLE","$order",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","getBaseShippingInclTax",325],"(",")",["T_WHITESPACE","\n                        ",325],"-",["T_WHITESPACE"," ",326],["T_VARIABLE","$order",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getBaseShippingRefunded",326],"(",")",["T_WHITESPACE","\n                        ",326],"-",["T_WHITESPACE"," ",327],["T_VARIABLE","$order",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getBaseShippingTaxRefunded",327],"(",")",";",["T_WHITESPACE","\n            ",327],"}",["T_WHITESPACE"," ",328],["T_ELSE","else",328],["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n                ",328],["T_VARIABLE","$baseAllowedAmount",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$order",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getBaseShippingAmount",329],"(",")",["T_WHITESPACE"," ",329],"-",["T_WHITESPACE"," ",329],["T_VARIABLE","$order",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getBaseShippingRefunded",329],"(",")",";",["T_WHITESPACE","\n                ",329],["T_VARIABLE","$baseAllowedAmount",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_STRING","min",330],"(",["T_VARIABLE","$baseAllowedAmount",330],",",["T_WHITESPACE"," ",330],["T_VARIABLE","$invoice",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","getBaseShippingAmount",330],"(",")",")",";",["T_WHITESPACE","\n            ",330],"}",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$creditmemo",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","setBaseShippingAmount",332],"(",["T_VARIABLE","$baseAllowedAmount",332],")",";",["T_WHITESPACE","\n        ",332],"}",["T_WHITESPACE","\n\n        ",333],["T_VARIABLE","$creditmemo",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","collectTotals",335],"(",")",";",["T_WHITESPACE","\n        ",335],["T_RETURN","return",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$creditmemo",336],";",["T_WHITESPACE","\n    ",336],"}",["T_WHITESPACE","\n\n    ",337],["T_DOC_COMMENT","\/**\n     * Initialize creditmemo state based on requested parameters\n     *\n     * @param Mage_Sales_Model_Order_Creditmemo $creditmemo\n     * @param array $data\n     *\/",339],["T_WHITESPACE","\n    ",344],["T_PROTECTED","protected",345],["T_WHITESPACE"," ",345],["T_FUNCTION","function",345],["T_WHITESPACE"," ",345],["T_STRING","_initCreditmemoData",345],"(",["T_VARIABLE","$creditmemo",345],",",["T_WHITESPACE"," ",345],["T_VARIABLE","$data",345],")",["T_WHITESPACE","\n    ",345],"{",["T_WHITESPACE","\n        ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","updateLocaleNumbers",347],"(",["T_VARIABLE","$data",347],")",";",["T_WHITESPACE","\n        ",347],["T_IF","if",348],["T_WHITESPACE"," ",348],"(",["T_ISSET","isset",348],"(",["T_VARIABLE","$data",348],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_amount'",348],"]",")",")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n            ",348],["T_VARIABLE","$creditmemo",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","setBaseShippingAmount",349],"(",["T_DOUBLE_CAST","(float)",349],["T_VARIABLE","$data",349],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_amount'",349],"]",")",";",["T_WHITESPACE","\n        ",349],"}",["T_WHITESPACE","\n\n        ",350],["T_IF","if",352],["T_WHITESPACE"," ",352],"(",["T_ISSET","isset",352],"(",["T_VARIABLE","$data",352],"[",["T_CONSTANT_ENCAPSED_STRING","'adjustment_positive'",352],"]",")",")",["T_WHITESPACE"," ",352],"{",["T_WHITESPACE","\n            ",352],["T_VARIABLE","$creditmemo",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","setAdjustmentPositive",353],"(",["T_VARIABLE","$data",353],"[",["T_CONSTANT_ENCAPSED_STRING","'adjustment_positive'",353],"]",")",";",["T_WHITESPACE","\n        ",353],"}",["T_WHITESPACE","\n\n        ",354],["T_IF","if",356],["T_WHITESPACE"," ",356],"(",["T_ISSET","isset",356],"(",["T_VARIABLE","$data",356],"[",["T_CONSTANT_ENCAPSED_STRING","'adjustment_negative'",356],"]",")",")",["T_WHITESPACE"," ",356],"{",["T_WHITESPACE","\n            ",356],["T_VARIABLE","$creditmemo",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","setAdjustmentNegative",357],"(",["T_VARIABLE","$data",357],"[",["T_CONSTANT_ENCAPSED_STRING","'adjustment_negative'",357],"]",")",";",["T_WHITESPACE","\n        ",357],"}",["T_WHITESPACE","\n    ",358],"}",["T_WHITESPACE","\n\n    ",359],["T_DOC_COMMENT","\/**\n     * Check if order item can be invoiced. Dummy item can be invoiced or with his childrens or\n     * with parent item which is included to invoice\n     *\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $qtys\n     * @return bool\n     *\/",361],["T_WHITESPACE","\n    ",368],["T_PROTECTED","protected",369],["T_WHITESPACE"," ",369],["T_FUNCTION","function",369],["T_WHITESPACE"," ",369],["T_STRING","_canInvoiceItem",369],"(",["T_VARIABLE","$item",369],",",["T_WHITESPACE"," ",369],["T_VARIABLE","$qtys",369],"=",["T_ARRAY","array",369],"(",")",")",["T_WHITESPACE","\n    ",369],"{",["T_WHITESPACE","\n        ",370],["T_IF","if",371],["T_WHITESPACE"," ",371],"(",["T_VARIABLE","$item",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","getLockedDoInvoice",371],"(",")",")",["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n            ",371],["T_RETURN","return",372],["T_WHITESPACE"," ",372],["T_STRING","false",372],";",["T_WHITESPACE","\n        ",372],"}",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","updateLocaleNumbers",374],"(",["T_VARIABLE","$qtys",374],")",";",["T_WHITESPACE","\n\n        ",374],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_VARIABLE","$item",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","isDummy",376],"(",")",")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_IF","if",377],["T_WHITESPACE"," ",377],"(",["T_VARIABLE","$item",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getHasChildren",377],"(",")",")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n                ",377],["T_FOREACH","foreach",378],["T_WHITESPACE"," ",378],"(",["T_VARIABLE","$item",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getChildrenItems",378],"(",")",["T_WHITESPACE"," ",378],["T_AS","as",378],["T_WHITESPACE"," ",378],["T_VARIABLE","$child",378],")",["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n                    ",378],["T_IF","if",379],["T_WHITESPACE"," ",379],"(",["T_EMPTY","empty",379],"(",["T_VARIABLE","$qtys",379],")",")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n                        ",379],["T_IF","if",380],["T_WHITESPACE"," ",380],"(",["T_VARIABLE","$child",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getQtyToInvoice",380],"(",")",["T_WHITESPACE"," ",380],">",["T_WHITESPACE"," ",380],["T_LNUMBER","0",380],")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n                            ",380],["T_RETURN","return",381],["T_WHITESPACE"," ",381],["T_STRING","true",381],";",["T_WHITESPACE","\n                        ",381],"}",["T_WHITESPACE","\n                    ",382],"}",["T_WHITESPACE"," ",383],["T_ELSE","else",383],["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n                        ",383],["T_IF","if",384],["T_WHITESPACE"," ",384],"(",["T_ISSET","isset",384],"(",["T_VARIABLE","$qtys",384],"[",["T_VARIABLE","$child",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getId",384],"(",")","]",")",["T_WHITESPACE"," ",384],["T_BOOLEAN_AND","&&",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$qtys",384],"[",["T_VARIABLE","$child",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getId",384],"(",")","]",["T_WHITESPACE"," ",384],">",["T_WHITESPACE"," ",384],["T_LNUMBER","0",384],")",["T_WHITESPACE"," ",384],"{",["T_WHITESPACE","\n                            ",384],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_STRING","true",385],";",["T_WHITESPACE","\n                        ",385],"}",["T_WHITESPACE","\n                    ",386],"}",["T_WHITESPACE","\n                ",387],"}",["T_WHITESPACE","\n                ",388],["T_RETURN","return",389],["T_WHITESPACE"," ",389],["T_STRING","false",389],";",["T_WHITESPACE","\n            ",389],"}",["T_WHITESPACE"," ",390],["T_ELSE","else",390],["T_WHITESPACE"," ",390],["T_IF","if",390],"(",["T_VARIABLE","$item",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getParentItem",390],"(",")",")",["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n                ",390],["T_VARIABLE","$parent",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_VARIABLE","$item",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getParentItem",391],"(",")",";",["T_WHITESPACE","\n                ",391],["T_IF","if",392],["T_WHITESPACE"," ",392],"(",["T_EMPTY","empty",392],"(",["T_VARIABLE","$qtys",392],")",")",["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n                    ",392],["T_RETURN","return",393],["T_WHITESPACE"," ",393],["T_VARIABLE","$parent",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","getQtyToInvoice",393],"(",")",["T_WHITESPACE"," ",393],">",["T_WHITESPACE"," ",393],["T_LNUMBER","0",393],";",["T_WHITESPACE","\n                ",393],"}",["T_WHITESPACE"," ",394],["T_ELSE","else",394],["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n                    ",394],["T_RETURN","return",395],["T_WHITESPACE"," ",395],["T_ISSET","isset",395],"(",["T_VARIABLE","$qtys",395],"[",["T_VARIABLE","$parent",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getId",395],"(",")","]",")",["T_WHITESPACE"," ",395],["T_BOOLEAN_AND","&&",395],["T_WHITESPACE"," ",395],["T_VARIABLE","$qtys",395],"[",["T_VARIABLE","$parent",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","getId",395],"(",")","]",["T_WHITESPACE"," ",395],">",["T_WHITESPACE"," ",395],["T_LNUMBER","0",395],";",["T_WHITESPACE","\n                ",395],"}",["T_WHITESPACE","\n            ",396],"}",["T_WHITESPACE","\n        ",397],"}",["T_WHITESPACE"," ",398],["T_ELSE","else",398],["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n            ",398],["T_RETURN","return",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$item",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getQtyToInvoice",399],"(",")",["T_WHITESPACE"," ",399],">",["T_WHITESPACE"," ",399],["T_LNUMBER","0",399],";",["T_WHITESPACE","\n        ",399],"}",["T_WHITESPACE","\n    ",400],"}",["T_WHITESPACE","\n\n    ",401],["T_DOC_COMMENT","\/**\n     * Check if order item can be shiped. Dummy item can be shiped or with his childrens or\n     * with parent item which is included to shipment\n     *\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $qtys\n     * @return bool\n     *\/",403],["T_WHITESPACE","\n    ",410],["T_PROTECTED","protected",411],["T_WHITESPACE"," ",411],["T_FUNCTION","function",411],["T_WHITESPACE"," ",411],["T_STRING","_canShipItem",411],"(",["T_VARIABLE","$item",411],",",["T_WHITESPACE"," ",411],["T_VARIABLE","$qtys",411],"=",["T_ARRAY","array",411],"(",")",")",["T_WHITESPACE","\n    ",411],"{",["T_WHITESPACE","\n        ",412],["T_IF","if",413],["T_WHITESPACE"," ",413],"(",["T_VARIABLE","$item",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getIsVirtual",413],"(",")",["T_WHITESPACE"," ",413],["T_BOOLEAN_OR","||",413],["T_WHITESPACE"," ",413],["T_VARIABLE","$item",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getLockedDoShip",413],"(",")",")",["T_WHITESPACE"," ",413],"{",["T_WHITESPACE","\n            ",413],["T_RETURN","return",414],["T_WHITESPACE"," ",414],["T_STRING","false",414],";",["T_WHITESPACE","\n        ",414],"}",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","updateLocaleNumbers",416],"(",["T_VARIABLE","$qtys",416],")",";",["T_WHITESPACE","\n\n        ",416],["T_IF","if",418],["T_WHITESPACE"," ",418],"(",["T_VARIABLE","$item",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","isDummy",418],"(",["T_STRING","true",418],")",")",["T_WHITESPACE"," ",418],"{",["T_WHITESPACE","\n            ",418],["T_IF","if",419],["T_WHITESPACE"," ",419],"(",["T_VARIABLE","$item",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getHasChildren",419],"(",")",")",["T_WHITESPACE"," ",419],"{",["T_WHITESPACE","\n                ",419],["T_IF","if",420],["T_WHITESPACE"," ",420],"(",["T_VARIABLE","$item",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","isShipSeparately",420],"(",")",")",["T_WHITESPACE"," ",420],"{",["T_WHITESPACE","\n                    ",420],["T_RETURN","return",421],["T_WHITESPACE"," ",421],["T_STRING","true",421],";",["T_WHITESPACE","\n                ",421],"}",["T_WHITESPACE","\n                ",422],["T_FOREACH","foreach",423],["T_WHITESPACE"," ",423],"(",["T_VARIABLE","$item",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getChildrenItems",423],"(",")",["T_WHITESPACE"," ",423],["T_AS","as",423],["T_WHITESPACE"," ",423],["T_VARIABLE","$child",423],")",["T_WHITESPACE"," ",423],"{",["T_WHITESPACE","\n                    ",423],["T_IF","if",424],["T_WHITESPACE"," ",424],"(",["T_VARIABLE","$child",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getIsVirtual",424],"(",")",")",["T_WHITESPACE"," ",424],"{",["T_WHITESPACE","\n                        ",424],["T_CONTINUE","continue",425],";",["T_WHITESPACE","\n                    ",425],"}",["T_WHITESPACE","\n                    ",426],["T_IF","if",427],["T_WHITESPACE"," ",427],"(",["T_EMPTY","empty",427],"(",["T_VARIABLE","$qtys",427],")",")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n                        ",427],["T_IF","if",428],["T_WHITESPACE"," ",428],"(",["T_VARIABLE","$child",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getQtyToShip",428],"(",")",["T_WHITESPACE"," ",428],">",["T_WHITESPACE"," ",428],["T_LNUMBER","0",428],")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n                            ",428],["T_RETURN","return",429],["T_WHITESPACE"," ",429],["T_STRING","true",429],";",["T_WHITESPACE","\n                        ",429],"}",["T_WHITESPACE","\n                    ",430],"}",["T_WHITESPACE"," ",431],["T_ELSE","else",431],["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n                        ",431],["T_IF","if",432],["T_WHITESPACE"," ",432],"(",["T_ISSET","isset",432],"(",["T_VARIABLE","$qtys",432],"[",["T_VARIABLE","$child",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getId",432],"(",")","]",")",["T_WHITESPACE"," ",432],["T_BOOLEAN_AND","&&",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$qtys",432],"[",["T_VARIABLE","$child",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getId",432],"(",")","]",["T_WHITESPACE"," ",432],">",["T_WHITESPACE"," ",432],["T_LNUMBER","0",432],")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n                            ",432],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_STRING","true",433],";",["T_WHITESPACE","\n                        ",433],"}",["T_WHITESPACE","\n                    ",434],"}",["T_WHITESPACE","\n                ",435],"}",["T_WHITESPACE","\n                ",436],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_STRING","false",437],";",["T_WHITESPACE","\n            ",437],"}",["T_WHITESPACE"," ",438],["T_ELSE","else",438],["T_WHITESPACE"," ",438],["T_IF","if",438],"(",["T_VARIABLE","$item",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getParentItem",438],"(",")",")",["T_WHITESPACE"," ",438],"{",["T_WHITESPACE","\n                ",438],["T_VARIABLE","$parent",439],["T_WHITESPACE"," ",439],"=",["T_WHITESPACE"," ",439],["T_VARIABLE","$item",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getParentItem",439],"(",")",";",["T_WHITESPACE","\n                ",439],["T_IF","if",440],["T_WHITESPACE"," ",440],"(",["T_EMPTY","empty",440],"(",["T_VARIABLE","$qtys",440],")",")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n                    ",440],["T_RETURN","return",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$parent",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getQtyToShip",441],"(",")",["T_WHITESPACE"," ",441],">",["T_WHITESPACE"," ",441],["T_LNUMBER","0",441],";",["T_WHITESPACE","\n                ",441],"}",["T_WHITESPACE"," ",442],["T_ELSE","else",442],["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n                    ",442],["T_RETURN","return",443],["T_WHITESPACE"," ",443],["T_ISSET","isset",443],"(",["T_VARIABLE","$qtys",443],"[",["T_VARIABLE","$parent",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getId",443],"(",")","]",")",["T_WHITESPACE"," ",443],["T_BOOLEAN_AND","&&",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$qtys",443],"[",["T_VARIABLE","$parent",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getId",443],"(",")","]",["T_WHITESPACE"," ",443],">",["T_WHITESPACE"," ",443],["T_LNUMBER","0",443],";",["T_WHITESPACE","\n                ",443],"}",["T_WHITESPACE","\n            ",444],"}",["T_WHITESPACE","\n        ",445],"}",["T_WHITESPACE"," ",446],["T_ELSE","else",446],["T_WHITESPACE"," ",446],"{",["T_WHITESPACE","\n            ",446],["T_RETURN","return",447],["T_WHITESPACE"," ",447],["T_VARIABLE","$item",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getQtyToShip",447],"(",")",">",["T_LNUMBER","0",447],";",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE","\n    ",448],"}",["T_WHITESPACE","\n\n    ",449],["T_DOC_COMMENT","\/**\n     * Check if order item can be refunded\n     *\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $qtys\n     * @param array $invoiceQtysRefundLimits\n     * @return bool\n     *\/",451],["T_WHITESPACE","\n    ",458],["T_PROTECTED","protected",459],["T_WHITESPACE"," ",459],["T_FUNCTION","function",459],["T_WHITESPACE"," ",459],["T_STRING","_canRefundItem",459],"(",["T_VARIABLE","$item",459],",",["T_WHITESPACE"," ",459],["T_VARIABLE","$qtys",459],"=",["T_ARRAY","array",459],"(",")",",",["T_WHITESPACE"," ",459],["T_VARIABLE","$invoiceQtysRefundLimits",459],"=",["T_ARRAY","array",459],"(",")",")",["T_WHITESPACE","\n    ",459],"{",["T_WHITESPACE","\n        ",460],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","updateLocaleNumbers",461],"(",["T_VARIABLE","$qtys",461],")",";",["T_WHITESPACE","\n        ",461],["T_IF","if",462],["T_WHITESPACE"," ",462],"(",["T_VARIABLE","$item",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","isDummy",462],"(",")",")",["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n            ",462],["T_IF","if",463],["T_WHITESPACE"," ",463],"(",["T_VARIABLE","$item",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getHasChildren",463],"(",")",")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n                ",463],["T_FOREACH","foreach",464],["T_WHITESPACE"," ",464],"(",["T_VARIABLE","$item",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getChildrenItems",464],"(",")",["T_WHITESPACE"," ",464],["T_AS","as",464],["T_WHITESPACE"," ",464],["T_VARIABLE","$child",464],")",["T_WHITESPACE"," ",464],"{",["T_WHITESPACE","\n                    ",464],["T_IF","if",465],["T_WHITESPACE"," ",465],"(",["T_EMPTY","empty",465],"(",["T_VARIABLE","$qtys",465],")",")",["T_WHITESPACE"," ",465],"{",["T_WHITESPACE","\n                        ",465],["T_IF","if",466],["T_WHITESPACE"," ",466],"(",["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","_canRefundNoDummyItem",466],"(",["T_VARIABLE","$child",466],",",["T_WHITESPACE"," ",466],["T_VARIABLE","$invoiceQtysRefundLimits",466],")",")",["T_WHITESPACE"," ",466],"{",["T_WHITESPACE","\n                            ",466],["T_RETURN","return",467],["T_WHITESPACE"," ",467],["T_STRING","true",467],";",["T_WHITESPACE","\n                        ",467],"}",["T_WHITESPACE","\n                    ",468],"}",["T_WHITESPACE"," ",469],["T_ELSE","else",469],["T_WHITESPACE"," ",469],"{",["T_WHITESPACE","\n                        ",469],["T_IF","if",470],["T_WHITESPACE"," ",470],"(",["T_ISSET","isset",470],"(",["T_VARIABLE","$qtys",470],"[",["T_VARIABLE","$child",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","getId",470],"(",")","]",")",["T_WHITESPACE"," ",470],["T_BOOLEAN_AND","&&",470],["T_WHITESPACE"," ",470],["T_VARIABLE","$qtys",470],"[",["T_VARIABLE","$child",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","getId",470],"(",")","]",["T_WHITESPACE"," ",470],">",["T_WHITESPACE"," ",470],["T_LNUMBER","0",470],")",["T_WHITESPACE"," ",470],"{",["T_WHITESPACE","\n                            ",470],["T_RETURN","return",471],["T_WHITESPACE"," ",471],["T_STRING","true",471],";",["T_WHITESPACE","\n                        ",471],"}",["T_WHITESPACE","\n                    ",472],"}",["T_WHITESPACE","\n                ",473],"}",["T_WHITESPACE","\n                ",474],["T_RETURN","return",475],["T_WHITESPACE"," ",475],["T_STRING","false",475],";",["T_WHITESPACE","\n            ",475],"}",["T_WHITESPACE"," ",476],["T_ELSE","else",476],["T_WHITESPACE"," ",476],["T_IF","if",476],"(",["T_VARIABLE","$item",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getParentItem",476],"(",")",")",["T_WHITESPACE"," ",476],"{",["T_WHITESPACE","\n                ",476],["T_VARIABLE","$parent",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$item",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","getParentItem",477],"(",")",";",["T_WHITESPACE","\n                ",477],["T_IF","if",478],["T_WHITESPACE"," ",478],"(",["T_EMPTY","empty",478],"(",["T_VARIABLE","$qtys",478],")",")",["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n                    ",478],["T_RETURN","return",479],["T_WHITESPACE"," ",479],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","_canRefundNoDummyItem",479],"(",["T_VARIABLE","$parent",479],",",["T_WHITESPACE"," ",479],["T_VARIABLE","$invoiceQtysRefundLimits",479],")",";",["T_WHITESPACE","\n                ",479],"}",["T_WHITESPACE"," ",480],["T_ELSE","else",480],["T_WHITESPACE"," ",480],"{",["T_WHITESPACE","\n                    ",480],["T_RETURN","return",481],["T_WHITESPACE"," ",481],["T_ISSET","isset",481],"(",["T_VARIABLE","$qtys",481],"[",["T_VARIABLE","$parent",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getId",481],"(",")","]",")",["T_WHITESPACE"," ",481],["T_BOOLEAN_AND","&&",481],["T_WHITESPACE"," ",481],["T_VARIABLE","$qtys",481],"[",["T_VARIABLE","$parent",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getId",481],"(",")","]",["T_WHITESPACE"," ",481],">",["T_WHITESPACE"," ",481],["T_LNUMBER","0",481],";",["T_WHITESPACE","\n                ",481],"}",["T_WHITESPACE","\n            ",482],"}",["T_WHITESPACE","\n        ",483],"}",["T_WHITESPACE"," ",484],["T_ELSE","else",484],["T_WHITESPACE"," ",484],"{",["T_WHITESPACE","\n            ",484],["T_RETURN","return",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$this",485],["T_OBJECT_OPERATOR","->",485],["T_STRING","_canRefundNoDummyItem",485],"(",["T_VARIABLE","$item",485],",",["T_WHITESPACE"," ",485],["T_VARIABLE","$invoiceQtysRefundLimits",485],")",";",["T_WHITESPACE","\n        ",485],"}",["T_WHITESPACE","\n    ",486],"}",["T_WHITESPACE","\n\n    ",487],["T_DOC_COMMENT","\/**\n     * Check if no dummy order item can be refunded\n     *\n     * @param Mage_Sales_Model_Order_Item $item\n     * @param array $invoiceQtysRefundLimits\n     * @return bool\n     *\/",489],["T_WHITESPACE","\n    ",495],["T_PROTECTED","protected",496],["T_WHITESPACE"," ",496],["T_FUNCTION","function",496],["T_WHITESPACE"," ",496],["T_STRING","_canRefundNoDummyItem",496],"(",["T_VARIABLE","$item",496],",",["T_WHITESPACE"," ",496],["T_VARIABLE","$invoiceQtysRefundLimits",496],"=",["T_ARRAY","array",496],"(",")",")",["T_WHITESPACE","\n    ",496],"{",["T_WHITESPACE","\n        ",497],["T_IF","if",498],["T_WHITESPACE"," ",498],"(",["T_VARIABLE","$item",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getQtyToRefund",498],"(",")",["T_WHITESPACE"," ",498],"<",["T_WHITESPACE"," ",498],["T_LNUMBER","0",498],")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n            ",498],["T_RETURN","return",499],["T_WHITESPACE"," ",499],["T_STRING","false",499],";",["T_WHITESPACE","\n        ",499],"}",["T_WHITESPACE","\n\n        ",500],["T_IF","if",502],["T_WHITESPACE"," ",502],"(",["T_ISSET","isset",502],"(",["T_VARIABLE","$invoiceQtysRefundLimits",502],"[",["T_VARIABLE","$item",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getId",502],"(",")","]",")",")",["T_WHITESPACE"," ",502],"{",["T_WHITESPACE","\n            ",502],["T_RETURN","return",503],["T_WHITESPACE"," ",503],["T_VARIABLE","$invoiceQtysRefundLimits",503],"[",["T_VARIABLE","$item",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","getId",503],"(",")","]",["T_WHITESPACE"," ",503],">",["T_WHITESPACE"," ",503],["T_LNUMBER","0",503],";",["T_WHITESPACE","\n        ",503],"}",["T_WHITESPACE","\n\n        ",504],["T_RETURN","return",506],["T_WHITESPACE"," ",506],["T_STRING","true",506],";",["T_WHITESPACE","\n    ",506],"}",["T_WHITESPACE","\n\n",507],"}",["T_WHITESPACE","\n",509]]