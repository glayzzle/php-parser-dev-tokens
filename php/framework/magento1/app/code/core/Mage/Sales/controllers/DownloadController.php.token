[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Sales controller for download purposes\n *\n * @category   Mage\n * @package    Mage_Sales\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_DownloadController",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Controller_Front_Action",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Custom options downloader\n     *\n     * @param mixed $info\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","_downloadFileAction",43],"(",["T_VARIABLE","$info",43],")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$secretKey",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getRequest",45],"(",")",["T_OBJECT_OPERATOR","->",45],["T_STRING","getParam",45],"(",["T_CONSTANT_ENCAPSED_STRING","'key'",45],")",";",["T_WHITESPACE","\n        ",45],["T_TRY","try",46],["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n            ",46],["T_IF","if",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$secretKey",47],["T_WHITESPACE"," ",47],["T_IS_NOT_EQUAL","!=",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$info",47],"[",["T_CONSTANT_ENCAPSED_STRING","'secret_key'",47],"]",")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n                ",47],["T_THROW","throw",48],["T_WHITESPACE"," ",48],["T_NEW","new",48],["T_WHITESPACE"," ",48],["T_STRING","Exception",48],"(",")",";",["T_WHITESPACE","\n            ",48],"}",["T_WHITESPACE","\n\n            ",49],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","_validateFilePath",51],"(",["T_VARIABLE","$info",51],")",";",["T_WHITESPACE","\n\n            ",51],["T_VARIABLE","$filePath",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","Mage",53],["T_DOUBLE_COLON","::",53],["T_STRING","getBaseDir",53],"(",")",["T_WHITESPACE"," ",53],".",["T_WHITESPACE"," ",53],["T_VARIABLE","$info",53],"[",["T_CONSTANT_ENCAPSED_STRING","'order_path'",53],"]",";",["T_WHITESPACE","\n            ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","(","!",["T_STRING","is_file",54],"(",["T_VARIABLE","$filePath",54],")",["T_WHITESPACE"," ",54],["T_BOOLEAN_OR","||",54],["T_WHITESPACE"," ",54],"!",["T_STRING","is_readable",54],"(",["T_VARIABLE","$filePath",54],")",")",["T_WHITESPACE"," ",54],["T_BOOLEAN_AND","&&",54],["T_WHITESPACE"," ",54],"!",["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","_processDatabaseFile",54],"(",["T_VARIABLE","$filePath",54],")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n                ",54],["T_COMMENT","\/\/try get file from quote\n",55],["T_WHITESPACE","                ",56],["T_VARIABLE","$filePath",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","Mage",56],["T_DOUBLE_COLON","::",56],["T_STRING","getBaseDir",56],"(",")",["T_WHITESPACE"," ",56],".",["T_WHITESPACE"," ",56],["T_VARIABLE","$info",56],"[",["T_CONSTANT_ENCAPSED_STRING","'quote_path'",56],"]",";",["T_WHITESPACE","\n                ",56],["T_IF","if",57],["T_WHITESPACE"," ",57],"(","(","!",["T_STRING","is_file",57],"(",["T_VARIABLE","$filePath",57],")",["T_WHITESPACE"," ",57],["T_BOOLEAN_OR","||",57],["T_WHITESPACE"," ",57],"!",["T_STRING","is_readable",57],"(",["T_VARIABLE","$filePath",57],")",")",["T_WHITESPACE"," ",57],["T_BOOLEAN_AND","&&",57],["T_WHITESPACE"," ",57],"!",["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_processDatabaseFile",57],"(",["T_VARIABLE","$filePath",57],")",")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n                    ",57],["T_THROW","throw",58],["T_WHITESPACE"," ",58],["T_NEW","new",58],["T_WHITESPACE"," ",58],["T_STRING","Exception",58],"(",")",";",["T_WHITESPACE","\n                ",58],"}",["T_WHITESPACE","\n            ",59],"}",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_prepareDownloadResponse",61],"(",["T_VARIABLE","$info",61],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",61],"]",",",["T_WHITESPACE"," ",61],["T_ARRAY","array",61],"(",["T_WHITESPACE","\n               ",61],["T_CONSTANT_ENCAPSED_STRING","'value'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$filePath",62],",",["T_WHITESPACE","\n               ",62],["T_CONSTANT_ENCAPSED_STRING","'type'",63],["T_WHITESPACE","  ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'filename'",63],["T_WHITESPACE","\n            ",63],")",")",";",["T_WHITESPACE","\n        ",64],"}",["T_WHITESPACE"," ",65],["T_CATCH","catch",65],["T_WHITESPACE"," ",65],"(",["T_STRING","Exception",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$e",65],")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_forward",66],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",66],")",";",["T_WHITESPACE","\n        ",66],"}",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * @param array $info\n     * @throws Exception\n     *\/",70],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","_validateFilePath",74],"(",["T_VARIABLE","$info",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$optionFile",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","Mage",76],["T_DOUBLE_COLON","::",76],["T_STRING","getModel",76],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option_type_file'",76],")",";",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$optionStoragePath",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$optionFile",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getOrderTargetDir",77],"(",["T_STRING","true",77],")",";",["T_WHITESPACE","\n        ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(",["T_STRING","strpos",78],"(",["T_VARIABLE","$info",78],"[",["T_CONSTANT_ENCAPSED_STRING","'order_path'",78],"]",",",["T_WHITESPACE"," ",78],["T_VARIABLE","$optionStoragePath",78],")",["T_WHITESPACE"," ",78],["T_IS_NOT_IDENTICAL","!==",78],["T_WHITESPACE"," ",78],["T_LNUMBER","0",78],")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_THROW","throw",79],["T_WHITESPACE"," ",79],["T_NEW","new",79],["T_WHITESPACE"," ",79],["T_STRING","Exception",79],"(",["T_CONSTANT_ENCAPSED_STRING","'Unexpected file path'",79],")",";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n    ",80],"}",["T_WHITESPACE","\n\n    ",81],["T_DOC_COMMENT","\/**\n     * Check file in database storage if needed and place it on file system\n     *\n     * @param string $filePath\n     * @return bool\n     *\/",83],["T_WHITESPACE","\n    ",88],["T_PROTECTED","protected",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","_processDatabaseFile",89],"(",["T_VARIABLE","$filePath",89],")",["T_WHITESPACE","\n    ",89],"{",["T_WHITESPACE","\n        ",90],["T_IF","if",91],["T_WHITESPACE"," ",91],"(","!",["T_STRING","Mage",91],["T_DOUBLE_COLON","::",91],["T_STRING","helper",91],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",91],")",["T_OBJECT_OPERATOR","->",91],["T_STRING","checkDbUsage",91],"(",")",")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_RETURN","return",92],["T_WHITESPACE"," ",92],["T_STRING","false",92],";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n\n        ",93],["T_VARIABLE","$relativePath",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","Mage",95],["T_DOUBLE_COLON","::",95],["T_STRING","helper",95],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",95],")",["T_OBJECT_OPERATOR","->",95],["T_STRING","getMediaRelativePath",95],"(",["T_VARIABLE","$filePath",95],")",";",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$file",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","Mage",96],["T_DOUBLE_COLON","::",96],["T_STRING","getModel",96],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",96],")",["T_OBJECT_OPERATOR","->",96],["T_STRING","loadByFilename",96],"(",["T_VARIABLE","$relativePath",96],")",";",["T_WHITESPACE","\n\n        ",96],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_VARIABLE","$file",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getId",98],"(",")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_RETURN","return",99],["T_WHITESPACE"," ",99],["T_STRING","false",99],";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n\n        ",100],["T_VARIABLE","$directory",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","dirname",102],"(",["T_VARIABLE","$filePath",102],")",";",["T_WHITESPACE","\n        ",102],"@",["T_STRING","mkdir",103],"(",["T_VARIABLE","$directory",103],",",["T_WHITESPACE"," ",103],["T_LNUMBER","0777",103],",",["T_WHITESPACE"," ",103],["T_STRING","true",103],")",";",["T_WHITESPACE","\n\n        ",103],["T_VARIABLE","$io",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_NEW","new",105],["T_WHITESPACE"," ",105],["T_STRING","Varien_Io_File",105],"(",")",";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$io",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","cd",106],"(",["T_VARIABLE","$directory",106],")",";",["T_WHITESPACE","\n\n        ",106],["T_VARIABLE","$io",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","streamOpen",108],"(",["T_VARIABLE","$filePath",108],")",";",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$io",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","streamLock",109],"(",["T_STRING","true",109],")",";",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$io",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","streamWrite",110],"(",["T_VARIABLE","$file",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getContent",110],"(",")",")",";",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$io",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","streamUnlock",111],"(",")",";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$io",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","streamClose",112],"(",")",";",["T_WHITESPACE","\n\n        ",112],["T_RETURN","return",114],["T_WHITESPACE"," ",114],["T_STRING","true",114],";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Profile custom options download action\n     *\/",117],["T_WHITESPACE","\n    ",119],["T_PUBLIC","public",120],["T_WHITESPACE"," ",120],["T_FUNCTION","function",120],["T_WHITESPACE"," ",120],["T_STRING","downloadProfileCustomOptionAction",120],"(",")",["T_WHITESPACE","\n    ",120],"{",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$recurringProfile",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","Mage",122],["T_DOUBLE_COLON","::",122],["T_STRING","getModel",122],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/recurring_profile'",122],")",["T_OBJECT_OPERATOR","->",122],["T_STRING","load",122],"(",["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getRequest",122],"(",")",["T_OBJECT_OPERATOR","->",122],["T_STRING","getParam",122],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",122],")",")",";",["T_WHITESPACE","\n\n        ",122],["T_IF","if",124],["T_WHITESPACE"," ",124],"(","!",["T_VARIABLE","$recurringProfile",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getId",124],"(",")",")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_forward",125],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",125],")",";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n\n        ",126],["T_VARIABLE","$orderItemInfo",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$recurringProfile",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getData",128],"(",["T_CONSTANT_ENCAPSED_STRING","'order_item_info'",128],")",";",["T_WHITESPACE","\n        ",128],["T_TRY","try",129],["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$request",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","unserialize",130],"(",["T_VARIABLE","$orderItemInfo",130],"[",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",130],"]",")",";",["T_WHITESPACE","\n\n            ",130],["T_IF","if",132],["T_WHITESPACE"," ",132],"(",["T_VARIABLE","$request",132],"[",["T_CONSTANT_ENCAPSED_STRING","'product'",132],"]",["T_WHITESPACE"," ",132],["T_IS_NOT_EQUAL","!=",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$orderItemInfo",132],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",132],"]",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n                ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_forward",133],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",133],")",";",["T_WHITESPACE","\n                ",133],["T_RETURN","return",134],";",["T_WHITESPACE","\n            ",134],"}",["T_WHITESPACE","\n\n            ",135],["T_VARIABLE","$optionId",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getRequest",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","getParam",137],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",137],")",";",["T_WHITESPACE","\n            ",137],["T_IF","if",138],["T_WHITESPACE"," ",138],"(","!",["T_ISSET","isset",138],"(",["T_VARIABLE","$request",138],"[",["T_CONSTANT_ENCAPSED_STRING","'options'",138],"]","[",["T_VARIABLE","$optionId",138],"]",")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n                ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_forward",139],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",139],")",";",["T_WHITESPACE","\n                ",139],["T_RETURN","return",140],";",["T_WHITESPACE","\n            ",140],"}",["T_WHITESPACE","\n            ",141],["T_COMMENT","\/\/ Check if the product exists\n",142],["T_WHITESPACE","            ",143],["T_VARIABLE","$product",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_STRING","Mage",143],["T_DOUBLE_COLON","::",143],["T_STRING","getModel",143],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",143],")",["T_OBJECT_OPERATOR","->",143],["T_STRING","load",143],"(",["T_VARIABLE","$request",143],"[",["T_CONSTANT_ENCAPSED_STRING","'product'",143],"]",")",";",["T_WHITESPACE","\n            ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(","!",["T_VARIABLE","$product",144],["T_WHITESPACE"," ",144],["T_BOOLEAN_OR","||",144],["T_WHITESPACE"," ",144],"!",["T_VARIABLE","$product",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getId",144],"(",")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_forward",145],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",145],")",";",["T_WHITESPACE","\n                ",145],["T_RETURN","return",146],";",["T_WHITESPACE","\n            ",146],"}",["T_WHITESPACE","\n            ",147],["T_COMMENT","\/\/ Try to load the option\n",148],["T_WHITESPACE","            ",149],["T_VARIABLE","$option",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$product",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getOptionById",149],"(",["T_VARIABLE","$optionId",149],")",";",["T_WHITESPACE","\n            ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(","!",["T_VARIABLE","$option",150],["T_WHITESPACE"," ",150],["T_BOOLEAN_OR","||",150],["T_WHITESPACE"," ",150],"!",["T_VARIABLE","$option",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getId",150],"(",")",["T_WHITESPACE"," ",150],["T_BOOLEAN_OR","||",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$option",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getType",150],"(",")",["T_WHITESPACE"," ",150],["T_IS_NOT_EQUAL","!=",150],["T_WHITESPACE"," ",150],["T_CONSTANT_ENCAPSED_STRING","'file'",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_forward",151],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",151],")",";",["T_WHITESPACE","\n                ",151],["T_RETURN","return",152],";",["T_WHITESPACE","\n            ",152],"}",["T_WHITESPACE","\n            ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_downloadFileAction",154],"(",["T_VARIABLE","$request",154],"[",["T_CONSTANT_ENCAPSED_STRING","'options'",154],"]","[",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getRequest",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","getParam",154],"(",["T_CONSTANT_ENCAPSED_STRING","'option_id'",154],")","]",")",";",["T_WHITESPACE","\n        ",154],"}",["T_WHITESPACE"," ",155],["T_CATCH","catch",155],["T_WHITESPACE"," ",155],"(",["T_STRING","Exception",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$e",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_forward",156],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",156],")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE","\n    ",157],"}",["T_WHITESPACE","\n\n    ",158],["T_DOC_COMMENT","\/**\n     * Custom options download action\n     *\/",160],["T_WHITESPACE","\n    ",162],["T_PUBLIC","public",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","downloadCustomOptionAction",163],"(",")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$quoteItemOptionId",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getRequest",165],"(",")",["T_OBJECT_OPERATOR","->",165],["T_STRING","getParam",165],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",165],")",";",["T_WHITESPACE","\n        ",165],["T_DOC_COMMENT","\/** @var $option Mage_Sales_Model_Quote_Item_Option *\/",166],["T_WHITESPACE","\n        ",166],["T_VARIABLE","$option",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","Mage",167],["T_DOUBLE_COLON","::",167],["T_STRING","getModel",167],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_item_option'",167],")",["T_OBJECT_OPERATOR","->",167],["T_STRING","load",167],"(",["T_VARIABLE","$quoteItemOptionId",167],")",";",["T_WHITESPACE","\n\n        ",167],["T_IF","if",169],["T_WHITESPACE"," ",169],"(","!",["T_VARIABLE","$option",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getId",169],"(",")",")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_forward",170],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",170],")",";",["T_WHITESPACE","\n            ",170],["T_RETURN","return",171],";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n\n        ",172],["T_VARIABLE","$optionId",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_STRING","null",174],";",["T_WHITESPACE","\n        ",174],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_STRING","strpos",175],"(",["T_VARIABLE","$option",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getCode",175],"(",")",",",["T_WHITESPACE"," ",175],["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",175],["T_DOUBLE_COLON","::",175],["T_STRING","OPTION_PREFIX",175],")",["T_WHITESPACE"," ",175],["T_IS_IDENTICAL","===",175],["T_WHITESPACE"," ",175],["T_LNUMBER","0",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$optionId",176],["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_STRING","str_replace",176],"(",["T_STRING","Mage_Catalog_Model_Product_Type_Abstract",176],["T_DOUBLE_COLON","::",176],["T_STRING","OPTION_PREFIX",176],",",["T_WHITESPACE"," ",176],["T_CONSTANT_ENCAPSED_STRING","''",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$option",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getCode",176],"(",")",")",";",["T_WHITESPACE","\n            ",176],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_INT_CAST","(int)",177],["T_VARIABLE","$optionId",177],["T_WHITESPACE"," ",177],["T_IS_NOT_EQUAL","!=",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$optionId",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n                ",177],["T_VARIABLE","$optionId",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_STRING","null",178],";",["T_WHITESPACE","\n            ",178],"}",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$productOption",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_STRING","null",181],";",["T_WHITESPACE","\n        ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(",["T_VARIABLE","$optionId",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n            ",182],["T_DOC_COMMENT","\/** @var $productOption Mage_Catalog_Model_Product_Option *\/",183],["T_WHITESPACE","\n            ",183],["T_VARIABLE","$productOption",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","getModel",184],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_option'",184],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","load",184],"(",["T_VARIABLE","$optionId",184],")",";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n        ",185],["T_IF","if",186],["T_WHITESPACE"," ",186],"(","!",["T_VARIABLE","$productOption",186],["T_WHITESPACE"," ",186],["T_BOOLEAN_OR","||",186],["T_WHITESPACE"," ",186],"!",["T_VARIABLE","$productOption",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getId",186],"(",")",["T_WHITESPACE","\n            ",186],["T_BOOLEAN_OR","||",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$productOption",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getProductId",187],"(",")",["T_WHITESPACE"," ",187],["T_IS_NOT_EQUAL","!=",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$option",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getProductId",187],"(",")",["T_WHITESPACE"," ",187],["T_BOOLEAN_OR","||",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$productOption",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getType",187],"(",")",["T_WHITESPACE"," ",187],["T_IS_NOT_EQUAL","!=",187],["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'file'",187],["T_WHITESPACE","\n        ",187],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_forward",189],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",189],")",";",["T_WHITESPACE","\n            ",189],["T_RETURN","return",190],";",["T_WHITESPACE","\n        ",190],"}",["T_WHITESPACE","\n\n        ",191],["T_TRY","try",193],["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$info",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","helper",194],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/unserializeArray'",194],")",["T_OBJECT_OPERATOR","->",194],["T_STRING","unserialize",194],"(",["T_VARIABLE","$option",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getValue",194],"(",")",")",";",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","_downloadFileAction",195],"(",["T_VARIABLE","$info",195],")",";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE"," ",196],["T_CATCH","catch",196],["T_WHITESPACE"," ",196],"(",["T_STRING","Exception",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$e",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_forward",197],"(",["T_CONSTANT_ENCAPSED_STRING","'noRoute'",197],")",";",["T_WHITESPACE","\n        ",197],"}",["T_WHITESPACE","\n        ",198],["T_EXIT","exit",199],"(",["T_LNUMBER","0",199],")",";",["T_WHITESPACE","\n    ",199],"}",["T_WHITESPACE","\n",200],"}",["T_WHITESPACE","\n",201]]