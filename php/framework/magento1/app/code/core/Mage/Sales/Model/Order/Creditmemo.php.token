[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Sales\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Order creditmemo model\n *\n * @method Mage_Sales_Model_Resource_Order_Creditmemo _getResource()\n * @method Mage_Sales_Model_Resource_Order_Creditmemo getResource()\n * @method int getStoreId()\n * @method Mage_Sales_Model_Order_Creditmemo setStoreId(int $value)\n * @method float getAdjustmentPositive()\n * @method float getBaseShippingTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseShippingTaxAmount(float $value)\n * @method float getStoreToOrderRate()\n * @method Mage_Sales_Model_Order_Creditmemo setStoreToOrderRate(float $value)\n * @method float getBaseDiscountAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseDiscountAmount(float $value)\n * @method float getBaseToOrderRate()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseToOrderRate(float $value)\n * @method float getGrandTotal()\n * @method Mage_Sales_Model_Order_Creditmemo setGrandTotal(float $value)\n * @method float getBaseAdjustmentNegative()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseAdjustmentNegative(float $value)\n * @method float getBaseSubtotalInclTax()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseSubtotalInclTax(float $value)\n * @method float getShippingAmount()\n * @method float getSubtotalInclTax()\n * @method Mage_Sales_Model_Order_Creditmemo setSubtotalInclTax(float $value)\n * @method float getAdjustmentNegative()\n * @method float getBaseShippingAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseShippingAmount(float $value)\n * @method float getStoreToBaseRate()\n * @method Mage_Sales_Model_Order_Creditmemo setStoreToBaseRate(float $value)\n * @method float getBaseToGlobalRate()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseToGlobalRate(float $value)\n * @method float getBaseAdjustment()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseAdjustment(float $value)\n * @method float getBaseSubtotal()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseSubtotal(float $value)\n * @method float getDiscountAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setDiscountAmount(float $value)\n * @method float getSubtotal()\n * @method Mage_Sales_Model_Order_Creditmemo setSubtotal(float $value)\n * @method float getAdjustment()\n * @method Mage_Sales_Model_Order_Creditmemo setAdjustment(float $value)\n * @method float getBaseGrandTotal()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseGrandTotal(float $value)\n * @method float getBaseAdjustmentPositive()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseAdjustmentPositive(float $value)\n * @method float getBaseTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseTaxAmount(float $value)\n * @method float getShippingTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setShippingTaxAmount(float $value)\n * @method float getTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setTaxAmount(float $value)\n * @method int getOrderId()\n * @method Mage_Sales_Model_Order_Creditmemo setOrderId(int $value)\n * @method int getEmailSent()\n * @method Mage_Sales_Model_Order_Creditmemo setEmailSent(int $value)\n * @method int getCreditmemoStatus()\n * @method Mage_Sales_Model_Order_Creditmemo setCreditmemoStatus(int $value)\n * @method int getState()\n * @method Mage_Sales_Model_Order_Creditmemo setState(int $value)\n * @method int getShippingAddressId()\n * @method Mage_Sales_Model_Order_Creditmemo setShippingAddressId(int $value)\n * @method int getBillingAddressId()\n * @method Mage_Sales_Model_Order_Creditmemo setBillingAddressId(int $value)\n * @method int getInvoiceId()\n * @method Mage_Sales_Model_Order_Creditmemo setInvoiceId(int $value)\n * @method string getCybersourceToken()\n * @method Mage_Sales_Model_Order_Creditmemo setCybersourceToken(string $value)\n * @method string getStoreCurrencyCode()\n * @method Mage_Sales_Model_Order_Creditmemo setStoreCurrencyCode(string $value)\n * @method string getOrderCurrencyCode()\n * @method Mage_Sales_Model_Order_Creditmemo setOrderCurrencyCode(string $value)\n * @method string getBaseCurrencyCode()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseCurrencyCode(string $value)\n * @method string getGlobalCurrencyCode()\n * @method Mage_Sales_Model_Order_Creditmemo setGlobalCurrencyCode(string $value)\n * @method string getTransactionId()\n * @method Mage_Sales_Model_Order_Creditmemo setTransactionId(string $value)\n * @method string getIncrementId()\n * @method Mage_Sales_Model_Order_Creditmemo setIncrementId(string $value)\n * @method string getCreatedAt()\n * @method Mage_Sales_Model_Order_Creditmemo setCreatedAt(string $value)\n * @method string getUpdatedAt()\n * @method Mage_Sales_Model_Order_Creditmemo setUpdatedAt(string $value)\n * @method float getHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setHiddenTaxAmount(float $value)\n * @method float getBaseHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseHiddenTaxAmount(float $value)\n * @method float getShippingHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setShippingHiddenTaxAmount(float $value)\n * @method float getBaseShippingHiddenTaxAmount()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseShippingHiddenTaxAmount(float $value)\n * @method float getShippingInclTax()\n * @method Mage_Sales_Model_Order_Creditmemo setShippingInclTax(float $value)\n * @method float getBaseShippingInclTax()\n * @method Mage_Sales_Model_Order_Creditmemo setBaseShippingInclTax(float $value)\n *\n * @category    Mage\n * @package     Mage_Sales\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",128],["T_CLASS","class",129],["T_WHITESPACE"," ",129],["T_STRING","Mage_Sales_Model_Order_Creditmemo",129],["T_WHITESPACE"," ",129],["T_EXTENDS","extends",129],["T_WHITESPACE"," ",129],["T_STRING","Mage_Sales_Model_Abstract",129],["T_WHITESPACE","\n",129],"{",["T_WHITESPACE","\n    ",130],["T_CONST","const",131],["T_WHITESPACE"," ",131],["T_STRING","STATE_OPEN",131],["T_WHITESPACE","        ",131],"=",["T_WHITESPACE"," ",131],["T_LNUMBER","1",131],";",["T_WHITESPACE","\n    ",131],["T_CONST","const",132],["T_WHITESPACE"," ",132],["T_STRING","STATE_REFUNDED",132],["T_WHITESPACE","    ",132],"=",["T_WHITESPACE"," ",132],["T_LNUMBER","2",132],";",["T_WHITESPACE","\n    ",132],["T_CONST","const",133],["T_WHITESPACE"," ",133],["T_STRING","STATE_CANCELED",133],["T_WHITESPACE","    ",133],"=",["T_WHITESPACE"," ",133],["T_LNUMBER","3",133],";",["T_WHITESPACE","\n\n    ",133],["T_CONST","const",135],["T_WHITESPACE"," ",135],["T_STRING","XML_PATH_EMAIL_TEMPLATE",135],["T_WHITESPACE","               ",135],"=",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo\/template'",135],";",["T_WHITESPACE","\n    ",135],["T_CONST","const",136],["T_WHITESPACE"," ",136],["T_STRING","XML_PATH_EMAIL_GUEST_TEMPLATE",136],["T_WHITESPACE","         ",136],"=",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo\/guest_template'",136],";",["T_WHITESPACE","\n    ",136],["T_CONST","const",137],["T_WHITESPACE"," ",137],["T_STRING","XML_PATH_EMAIL_IDENTITY",137],["T_WHITESPACE","               ",137],"=",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo\/identity'",137],";",["T_WHITESPACE","\n    ",137],["T_CONST","const",138],["T_WHITESPACE"," ",138],["T_STRING","XML_PATH_EMAIL_COPY_TO",138],["T_WHITESPACE","                ",138],"=",["T_WHITESPACE"," ",138],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo\/copy_to'",138],";",["T_WHITESPACE","\n    ",138],["T_CONST","const",139],["T_WHITESPACE"," ",139],["T_STRING","XML_PATH_EMAIL_COPY_METHOD",139],["T_WHITESPACE","            ",139],"=",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo\/copy_method'",139],";",["T_WHITESPACE","\n    ",139],["T_CONST","const",140],["T_WHITESPACE"," ",140],["T_STRING","XML_PATH_EMAIL_ENABLED",140],["T_WHITESPACE","                ",140],"=",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo\/enabled'",140],";",["T_WHITESPACE","\n\n    ",140],["T_CONST","const",142],["T_WHITESPACE"," ",142],["T_STRING","XML_PATH_UPDATE_EMAIL_TEMPLATE",142],["T_WHITESPACE","        ",142],"=",["T_WHITESPACE"," ",142],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo_comment\/template'",142],";",["T_WHITESPACE","\n    ",142],["T_CONST","const",143],["T_WHITESPACE"," ",143],["T_STRING","XML_PATH_UPDATE_EMAIL_GUEST_TEMPLATE",143],["T_WHITESPACE","  ",143],"=",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo_comment\/guest_template'",143],";",["T_WHITESPACE","\n    ",143],["T_CONST","const",144],["T_WHITESPACE"," ",144],["T_STRING","XML_PATH_UPDATE_EMAIL_IDENTITY",144],["T_WHITESPACE","        ",144],"=",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo_comment\/identity'",144],";",["T_WHITESPACE","\n    ",144],["T_CONST","const",145],["T_WHITESPACE"," ",145],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_TO",145],["T_WHITESPACE","         ",145],"=",["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo_comment\/copy_to'",145],";",["T_WHITESPACE","\n    ",145],["T_CONST","const",146],["T_WHITESPACE"," ",146],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_METHOD",146],["T_WHITESPACE","     ",146],"=",["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo_comment\/copy_method'",146],";",["T_WHITESPACE","\n    ",146],["T_CONST","const",147],["T_WHITESPACE"," ",147],["T_STRING","XML_PATH_UPDATE_EMAIL_ENABLED",147],["T_WHITESPACE","         ",147],"=",["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","'sales_email\/creditmemo_comment\/enabled'",147],";",["T_WHITESPACE","\n\n    ",147],["T_CONST","const",149],["T_WHITESPACE"," ",149],["T_STRING","REPORT_DATE_TYPE_ORDER_CREATED",149],["T_WHITESPACE","        ",149],"=",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'order_created'",149],";",["T_WHITESPACE","\n    ",149],["T_CONST","const",150],["T_WHITESPACE"," ",150],["T_STRING","REPORT_DATE_TYPE_REFUND_CREATED",150],["T_WHITESPACE","       ",150],"=",["T_WHITESPACE"," ",150],["T_CONSTANT_ENCAPSED_STRING","'refund_created'",150],";",["T_WHITESPACE","\n\n    ",150],["T_COMMENT","\/*\n     * Identifier for order history item\n     *\/",152],["T_WHITESPACE","\n    ",154],["T_CONST","const",155],["T_WHITESPACE"," ",155],["T_STRING","HISTORY_ENTITY_NAME",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",155],";",["T_WHITESPACE","\n\n    ",155],["T_PROTECTED","protected",157],["T_WHITESPACE"," ",157],["T_STATIC","static",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$_states",157],";",["T_WHITESPACE","\n\n    ",157],["T_PROTECTED","protected",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$_items",159],";",["T_WHITESPACE","\n    ",159],["T_PROTECTED","protected",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$_order",160],";",["T_WHITESPACE","\n    ",160],["T_PROTECTED","protected",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$_comments",161],";",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Calculator instances for delta rounding of prices\n     *\n     * @var array\n     *\/",163],["T_WHITESPACE","\n    ",167],["T_PROTECTED","protected",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$_calculators",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_ARRAY","array",168],"(",")",";",["T_WHITESPACE","\n\n    ",168],["T_PROTECTED","protected",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$_eventPrefix",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'sales_order_creditmemo'",170],";",["T_WHITESPACE","\n    ",170],["T_PROTECTED","protected",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$_eventObject",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",171],";",["T_WHITESPACE","\n\n    ",171],["T_DOC_COMMENT","\/**\n     * Initialize creditmemo resource model\n     *\/",173],["T_WHITESPACE","\n    ",175],["T_PROTECTED","protected",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","_construct",176],"(",")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_init",178],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo'",178],")",";",["T_WHITESPACE","\n    ",178],"}",["T_WHITESPACE","\n\n    ",179],["T_DOC_COMMENT","\/**\n     * Init mapping array of short fields to its full names\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",181],["T_WHITESPACE","\n    ",185],["T_PROTECTED","protected",186],["T_WHITESPACE"," ",186],["T_FUNCTION","function",186],["T_WHITESPACE"," ",186],["T_STRING","_initOldFieldsMap",186],"(",")",["T_WHITESPACE","\n    ",186],"{",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","_oldFieldsMap",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","Mage",188],["T_DOUBLE_COLON","::",188],["T_STRING","helper",188],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",188],")",["T_OBJECT_OPERATOR","->",188],["T_STRING","getOldFieldMap",188],"(",["T_CONSTANT_ENCAPSED_STRING","'order_creditmemo'",188],")",";",["T_WHITESPACE","\n        ",188],["T_RETURN","return",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n\n    ",190],["T_DOC_COMMENT","\/**\n     * Retrieve Creditmemo configuration model\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo_Config\n     *\/",192],["T_WHITESPACE","\n    ",196],["T_PUBLIC","public",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","getConfig",197],"(",")",["T_WHITESPACE","\n    ",197],"{",["T_WHITESPACE","\n        ",198],["T_RETURN","return",199],["T_WHITESPACE"," ",199],["T_STRING","Mage",199],["T_DOUBLE_COLON","::",199],["T_STRING","getSingleton",199],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo_config'",199],")",";",["T_WHITESPACE","\n    ",199],"}",["T_WHITESPACE","\n\n    ",200],["T_DOC_COMMENT","\/**\n     * Retrieve creditmemo store instance\n     *\n     * @return Mage_Core_Model_Store\n     *\/",202],["T_WHITESPACE","\n    ",206],["T_PUBLIC","public",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","getStore",207],"(",")",["T_WHITESPACE","\n    ",207],"{",["T_WHITESPACE","\n        ",208],["T_RETURN","return",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getOrder",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","getStore",209],"(",")",";",["T_WHITESPACE","\n    ",209],"}",["T_WHITESPACE","\n\n    ",210],["T_DOC_COMMENT","\/**\n     * Declare order for creditmemo\n     *\n     * @param   Mage_Sales_Model_Order $order\n     * @return  Mage_Sales_Model_Order_Creditmemo\n     *\/",212],["T_WHITESPACE","\n    ",217],["T_PUBLIC","public",218],["T_WHITESPACE"," ",218],["T_FUNCTION","function",218],["T_WHITESPACE"," ",218],["T_STRING","setOrder",218],"(",["T_STRING","Mage_Sales_Model_Order",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$order",218],")",["T_WHITESPACE","\n    ",218],"{",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_order",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$order",220],";",["T_WHITESPACE","\n        ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setOrderId",221],"(",["T_VARIABLE","$order",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getId",221],"(",")",")",["T_WHITESPACE","\n            ",221],["T_OBJECT_OPERATOR","->",222],["T_STRING","setStoreId",222],"(",["T_VARIABLE","$order",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getStoreId",222],"(",")",")",";",["T_WHITESPACE","\n        ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Retrieve the order the creditmemo for created for\n     *\n     * @return Mage_Sales_Model_Order\n     *\/",226],["T_WHITESPACE","\n    ",230],["T_PUBLIC","public",231],["T_WHITESPACE"," ",231],["T_FUNCTION","function",231],["T_WHITESPACE"," ",231],["T_STRING","getOrder",231],"(",")",["T_WHITESPACE","\n    ",231],"{",["T_WHITESPACE","\n        ",232],["T_IF","if",233],["T_WHITESPACE"," ",233],"(","!",["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_order",233],["T_WHITESPACE"," ",233],["T_INSTANCEOF","instanceof",233],["T_WHITESPACE"," ",233],["T_STRING","Mage_Sales_Model_Order",233],")",["T_WHITESPACE"," ",233],"{",["T_WHITESPACE","\n            ",233],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_order",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","Mage",234],["T_DOUBLE_COLON","::",234],["T_STRING","getModel",234],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",234],")",["T_OBJECT_OPERATOR","->",234],["T_STRING","load",234],"(",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getOrderId",234],"(",")",")",";",["T_WHITESPACE","\n        ",234],"}",["T_WHITESPACE","\n        ",235],["T_RETURN","return",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_order",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","setHistoryEntityName",236],"(",["T_STRING","self",236],["T_DOUBLE_COLON","::",236],["T_STRING","HISTORY_ENTITY_NAME",236],")",";",["T_WHITESPACE","\n    ",236],"}",["T_WHITESPACE","\n\n    ",237],["T_DOC_COMMENT","\/**\n     * Retrieve billing address\n     *\n     * @return Mage_Sales_Model_Order_Address\n     *\/",239],["T_WHITESPACE","\n    ",243],["T_PUBLIC","public",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","getBillingAddress",244],"(",")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_RETURN","return",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getOrder",246],"(",")",["T_OBJECT_OPERATOR","->",246],["T_STRING","getBillingAddress",246],"(",")",";",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * Retrieve shipping address\n     *\n     * @return Mage_Sales_Model_Order_Address\n     *\/",249],["T_WHITESPACE","\n    ",253],["T_PUBLIC","public",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","getShippingAddress",254],"(",")",["T_WHITESPACE","\n    ",254],"{",["T_WHITESPACE","\n        ",255],["T_RETURN","return",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getOrder",256],"(",")",["T_OBJECT_OPERATOR","->",256],["T_STRING","getShippingAddress",256],"(",")",";",["T_WHITESPACE","\n    ",256],"}",["T_WHITESPACE","\n\n    ",257],["T_PUBLIC","public",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","getItemsCollection",259],"(",")",["T_WHITESPACE","\n    ",259],"{",["T_WHITESPACE","\n        ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(",["T_EMPTY","empty",261],"(",["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_items",261],")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","_items",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_STRING","Mage",262],["T_DOUBLE_COLON","::",262],["T_STRING","getResourceModel",262],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo_item_collection'",262],")",["T_WHITESPACE","\n                ",262],["T_OBJECT_OPERATOR","->",263],["T_STRING","setCreditmemoFilter",263],"(",["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getId",263],"(",")",")",";",["T_WHITESPACE","\n\n            ",263],["T_IF","if",265],["T_WHITESPACE"," ",265],"(",["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getId",265],"(",")",")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n                ",265],["T_FOREACH","foreach",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","_items",266],["T_WHITESPACE"," ",266],["T_AS","as",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$item",266],")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n                    ",266],["T_VARIABLE","$item",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","setCreditmemo",267],"(",["T_VARIABLE","$this",267],")",";",["T_WHITESPACE","\n                ",267],"}",["T_WHITESPACE","\n            ",268],"}",["T_WHITESPACE","\n        ",269],"}",["T_WHITESPACE","\n        ",270],["T_RETURN","return",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","_items",271],";",["T_WHITESPACE","\n    ",271],"}",["T_WHITESPACE","\n\n    ",272],["T_PUBLIC","public",274],["T_WHITESPACE"," ",274],["T_FUNCTION","function",274],["T_WHITESPACE"," ",274],["T_STRING","getAllItems",274],"(",")",["T_WHITESPACE","\n    ",274],"{",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$items",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_ARRAY","array",276],"(",")",";",["T_WHITESPACE","\n        ",276],["T_FOREACH","foreach",277],["T_WHITESPACE"," ",277],"(",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","getItemsCollection",277],"(",")",["T_WHITESPACE"," ",277],["T_AS","as",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$item",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_IF","if",278],["T_WHITESPACE"," ",278],"(","!",["T_VARIABLE","$item",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","isDeleted",278],"(",")",")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n                ",278],["T_VARIABLE","$items",279],"[","]",["T_WHITESPACE"," ",279],"=",["T_WHITESPACE","  ",279],["T_VARIABLE","$item",279],";",["T_WHITESPACE","\n            ",279],"}",["T_WHITESPACE","\n        ",280],"}",["T_WHITESPACE","\n        ",281],["T_RETURN","return",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$items",282],";",["T_WHITESPACE","\n    ",282],"}",["T_WHITESPACE","\n\n    ",283],["T_PUBLIC","public",285],["T_WHITESPACE"," ",285],["T_FUNCTION","function",285],["T_WHITESPACE"," ",285],["T_STRING","getItemById",285],"(",["T_VARIABLE","$itemId",285],")",["T_WHITESPACE","\n    ",285],"{",["T_WHITESPACE","\n        ",286],["T_FOREACH","foreach",287],["T_WHITESPACE"," ",287],"(",["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","getItemsCollection",287],"(",")",["T_WHITESPACE"," ",287],["T_AS","as",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$item",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n            ",287],["T_IF","if",288],["T_WHITESPACE"," ",288],"(",["T_VARIABLE","$item",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getId",288],"(",")",["T_IS_EQUAL","==",288],["T_VARIABLE","$itemId",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n                ",288],["T_RETURN","return",289],["T_WHITESPACE"," ",289],["T_VARIABLE","$item",289],";",["T_WHITESPACE","\n            ",289],"}",["T_WHITESPACE","\n        ",290],"}",["T_WHITESPACE","\n        ",291],["T_RETURN","return",292],["T_WHITESPACE"," ",292],["T_STRING","false",292],";",["T_WHITESPACE","\n    ",292],"}",["T_WHITESPACE","\n\n    ",293],["T_DOC_COMMENT","\/**\n     * Returns credit memo item by its order id\n     *\n     * @param $orderId\n     * @return Mage_Sales_Model_Order_Creditmemo_Item|bool\n     *\/",295],["T_WHITESPACE","\n    ",300],["T_PUBLIC","public",301],["T_WHITESPACE"," ",301],["T_FUNCTION","function",301],["T_WHITESPACE"," ",301],["T_STRING","getItemByOrderId",301],"(",["T_VARIABLE","$orderId",301],")",["T_WHITESPACE","\n    ",301],"{",["T_WHITESPACE","\n        ",302],["T_FOREACH","foreach",303],["T_WHITESPACE"," ",303],"(",["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getItemsCollection",303],"(",")",["T_WHITESPACE"," ",303],["T_AS","as",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$item",303],")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n            ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_VARIABLE","$item",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getOrderItemId",304],"(",")",["T_WHITESPACE"," ",304],["T_IS_EQUAL","==",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$orderId",304],")",["T_WHITESPACE"," ",304],"{",["T_WHITESPACE","\n                ",304],["T_RETURN","return",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$item",305],";",["T_WHITESPACE","\n            ",305],"}",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n        ",307],["T_RETURN","return",308],["T_WHITESPACE"," ",308],["T_STRING","false",308],";",["T_WHITESPACE","\n    ",308],"}",["T_WHITESPACE","\n\n    ",309],["T_PUBLIC","public",311],["T_WHITESPACE"," ",311],["T_FUNCTION","function",311],["T_WHITESPACE"," ",311],["T_STRING","addItem",311],"(",["T_STRING","Mage_Sales_Model_Order_Creditmemo_Item",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$item",311],")",["T_WHITESPACE","\n    ",311],"{",["T_WHITESPACE","\n        ",312],["T_VARIABLE","$item",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","setCreditmemo",313],"(",["T_VARIABLE","$this",313],")",["T_WHITESPACE","\n            ",313],["T_OBJECT_OPERATOR","->",314],["T_STRING","setParentId",314],"(",["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getId",314],"(",")",")",["T_WHITESPACE","\n            ",314],["T_OBJECT_OPERATOR","->",315],["T_STRING","setStoreId",315],"(",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getStoreId",315],"(",")",")",";",["T_WHITESPACE","\n        ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(","!",["T_VARIABLE","$item",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getId",316],"(",")",")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getItemsCollection",317],"(",")",["T_OBJECT_OPERATOR","->",317],["T_STRING","addItem",317],"(",["T_VARIABLE","$item",317],")",";",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE","\n        ",318],["T_RETURN","return",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$this",319],";",["T_WHITESPACE","\n    ",319],"}",["T_WHITESPACE","\n\n    ",320],["T_DOC_COMMENT","\/**\n     * Creditmemo totals collecting\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",322],["T_WHITESPACE","\n    ",326],["T_PUBLIC","public",327],["T_WHITESPACE"," ",327],["T_FUNCTION","function",327],["T_WHITESPACE"," ",327],["T_STRING","collectTotals",327],"(",")",["T_WHITESPACE","\n    ",327],"{",["T_WHITESPACE","\n        ",328],["T_FOREACH","foreach",329],["T_WHITESPACE"," ",329],"(",["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","getConfig",329],"(",")",["T_OBJECT_OPERATOR","->",329],["T_STRING","getTotalModels",329],"(",")",["T_WHITESPACE"," ",329],["T_AS","as",329],["T_WHITESPACE"," ",329],["T_VARIABLE","$model",329],")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_VARIABLE","$model",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","collect",330],"(",["T_VARIABLE","$this",330],")",";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n        ",331],["T_RETURN","return",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$this",332],";",["T_WHITESPACE","\n    ",332],"}",["T_WHITESPACE","\n\n    ",333],["T_DOC_COMMENT","\/**\n     * Round price considering delta\n     *\n     * @param float $price\n     * @param string $type\n     * @param bool $negative Indicates if we perform addition (true) or subtraction (false) of rounded value\n     * @return float\n     *\/",335],["T_WHITESPACE","\n    ",342],["T_PUBLIC","public",343],["T_WHITESPACE"," ",343],["T_FUNCTION","function",343],["T_WHITESPACE"," ",343],["T_STRING","roundPrice",343],"(",["T_VARIABLE","$price",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$type",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_CONSTANT_ENCAPSED_STRING","'regular'",343],",",["T_WHITESPACE"," ",343],["T_VARIABLE","$negative",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_STRING","false",343],")",["T_WHITESPACE","\n    ",343],"{",["T_WHITESPACE","\n        ",344],["T_IF","if",345],["T_WHITESPACE"," ",345],"(",["T_VARIABLE","$price",345],")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n            ",345],["T_IF","if",346],["T_WHITESPACE"," ",346],"(","!",["T_ISSET","isset",346],"(",["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_calculators",346],"[",["T_VARIABLE","$type",346],"]",")",")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n                ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_calculators",347],"[",["T_VARIABLE","$type",347],"]",["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_STRING","Mage",347],["T_DOUBLE_COLON","::",347],["T_STRING","getModel",347],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/calculator'",347],",",["T_WHITESPACE"," ",347],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getStore",347],"(",")",")",";",["T_WHITESPACE","\n            ",347],"}",["T_WHITESPACE","\n            ",348],["T_VARIABLE","$price",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_calculators",349],"[",["T_VARIABLE","$type",349],"]",["T_OBJECT_OPERATOR","->",349],["T_STRING","deltaRound",349],"(",["T_VARIABLE","$price",349],",",["T_WHITESPACE"," ",349],["T_VARIABLE","$negative",349],")",";",["T_WHITESPACE","\n        ",349],"}",["T_WHITESPACE","\n        ",350],["T_RETURN","return",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$price",351],";",["T_WHITESPACE","\n    ",351],"}",["T_WHITESPACE","\n\n    ",352],["T_PUBLIC","public",354],["T_WHITESPACE"," ",354],["T_FUNCTION","function",354],["T_WHITESPACE"," ",354],["T_STRING","canRefund",354],"(",")",["T_WHITESPACE","\n    ",354],"{",["T_WHITESPACE","\n        ",355],["T_IF","if",356],["T_WHITESPACE"," ",356],"(",["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","getState",356],"(",")",["T_WHITESPACE"," ",356],["T_IS_NOT_EQUAL","!=",356],["T_WHITESPACE"," ",356],["T_STRING","self",356],["T_DOUBLE_COLON","::",356],["T_STRING","STATE_CANCELED",356],["T_WHITESPACE","\n            ",356],["T_BOOLEAN_AND","&&",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getState",357],"(",")",["T_WHITESPACE"," ",357],["T_IS_NOT_EQUAL","!=",357],["T_WHITESPACE"," ",357],["T_STRING","self",357],["T_DOUBLE_COLON","::",357],["T_STRING","STATE_REFUNDED",357],["T_WHITESPACE","\n            ",357],["T_BOOLEAN_AND","&&",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getOrder",358],"(",")",["T_OBJECT_OPERATOR","->",358],["T_STRING","getPayment",358],"(",")",["T_OBJECT_OPERATOR","->",358],["T_STRING","canRefund",358],"(",")",["T_WHITESPACE","\n            ",358],")",["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n            ",359],["T_RETURN","return",360],["T_WHITESPACE"," ",360],["T_STRING","true",360],";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n        ",361],["T_RETURN","return",362],["T_WHITESPACE"," ",362],["T_STRING","false",362],";",["T_WHITESPACE","\n    ",362],"}",["T_WHITESPACE","\n\n    ",363],["T_DOC_COMMENT","\/**\n     * Check creditmemo cancel action availability\n     *\n     * @return bool\n     *\/",365],["T_WHITESPACE","\n    ",369],["T_PUBLIC","public",370],["T_WHITESPACE"," ",370],["T_FUNCTION","function",370],["T_WHITESPACE"," ",370],["T_STRING","canCancel",370],"(",")",["T_WHITESPACE","\n    ",370],"{",["T_WHITESPACE","\n        ",371],["T_RETURN","return",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$this",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","getState",372],"(",")",["T_WHITESPACE"," ",372],["T_IS_EQUAL","==",372],["T_WHITESPACE"," ",372],["T_STRING","self",372],["T_DOUBLE_COLON","::",372],["T_STRING","STATE_OPEN",372],";",["T_WHITESPACE","\n    ",372],"}",["T_WHITESPACE","\n\n    ",373],["T_DOC_COMMENT","\/**\n     * Check invice void action availability\n     *\n     * @return bool\n     *\/",375],["T_WHITESPACE","\n    ",379],["T_PUBLIC","public",380],["T_WHITESPACE"," ",380],["T_FUNCTION","function",380],["T_WHITESPACE"," ",380],["T_STRING","canVoid",380],"(",")",["T_WHITESPACE","\n    ",380],"{",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$canVoid",382],["T_WHITESPACE"," ",382],"=",["T_WHITESPACE"," ",382],["T_STRING","false",382],";",["T_WHITESPACE","\n        ",382],["T_RETURN","return",383],["T_WHITESPACE"," ",383],["T_STRING","false",383],";",["T_WHITESPACE","\n        ",383],["T_IF","if",384],["T_WHITESPACE"," ",384],"(",["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getState",384],"(",")",["T_WHITESPACE"," ",384],["T_IS_EQUAL","==",384],["T_WHITESPACE"," ",384],["T_STRING","self",384],["T_DOUBLE_COLON","::",384],["T_STRING","STATE_REFUNDED",384],")",["T_WHITESPACE"," ",384],"{",["T_WHITESPACE","\n            ",384],["T_VARIABLE","$canVoid",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_VARIABLE","$this",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","getCanVoidFlag",385],"(",")",";",["T_WHITESPACE","\n            ",385],["T_DOC_COMMENT","\/**\n             * If we not retrieve negative answer from payment yet\n             *\/",386],["T_WHITESPACE","\n            ",388],["T_IF","if",389],["T_WHITESPACE"," ",389],"(",["T_STRING","is_null",389],"(",["T_VARIABLE","$canVoid",389],")",")",["T_WHITESPACE"," ",389],"{",["T_WHITESPACE","\n                ",389],["T_VARIABLE","$canVoid",390],["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getOrder",390],"(",")",["T_OBJECT_OPERATOR","->",390],["T_STRING","getPayment",390],"(",")",["T_OBJECT_OPERATOR","->",390],["T_STRING","canVoid",390],"(",["T_VARIABLE","$this",390],")",";",["T_WHITESPACE","\n                ",390],["T_IF","if",391],["T_WHITESPACE"," ",391],"(",["T_VARIABLE","$canVoid",391],["T_WHITESPACE"," ",391],["T_IS_IDENTICAL","===",391],["T_WHITESPACE"," ",391],["T_STRING","false",391],")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n                    ",391],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","setCanVoidFlag",392],"(",["T_STRING","false",392],")",";",["T_WHITESPACE","\n                    ",392],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","_saveBeforeDestruct",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_STRING","true",393],";",["T_WHITESPACE","\n                ",393],"}",["T_WHITESPACE","\n            ",394],"}",["T_WHITESPACE","\n            ",395],["T_ELSE","else",396],["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n                ",396],["T_VARIABLE","$canVoid",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_BOOL_CAST","(bool)",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$canVoid",397],";",["T_WHITESPACE","\n            ",397],"}",["T_WHITESPACE","\n        ",398],"}",["T_WHITESPACE","\n        ",399],["T_RETURN","return",400],["T_WHITESPACE"," ",400],["T_VARIABLE","$canVoid",400],";",["T_WHITESPACE","\n    ",400],"}",["T_WHITESPACE","\n\n\n    ",401],["T_PUBLIC","public",404],["T_WHITESPACE"," ",404],["T_FUNCTION","function",404],["T_WHITESPACE"," ",404],["T_STRING","refund",404],"(",")",["T_WHITESPACE","\n    ",404],"{",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","setState",406],"(",["T_STRING","self",406],["T_DOUBLE_COLON","::",406],["T_STRING","STATE_REFUNDED",406],")",";",["T_WHITESPACE","\n        ",406],["T_VARIABLE","$orderRefund",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_STRING","Mage",407],["T_DOUBLE_COLON","::",407],["T_STRING","app",407],"(",")",["T_OBJECT_OPERATOR","->",407],["T_STRING","getStore",407],"(",")",["T_OBJECT_OPERATOR","->",407],["T_STRING","roundPrice",407],"(",["T_WHITESPACE","\n            ",407],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getOrder",408],"(",")",["T_OBJECT_OPERATOR","->",408],["T_STRING","getTotalRefunded",408],"(",")","+",["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getGrandTotal",408],"(",")",["T_WHITESPACE","\n        ",408],")",";",["T_WHITESPACE","\n        ",409],["T_VARIABLE","$baseOrderRefund",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_STRING","Mage",410],["T_DOUBLE_COLON","::",410],["T_STRING","app",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","getStore",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","roundPrice",410],"(",["T_WHITESPACE","\n            ",410],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getOrder",411],"(",")",["T_OBJECT_OPERATOR","->",411],["T_STRING","getBaseTotalRefunded",411],"(",")","+",["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getBaseGrandTotal",411],"(",")",["T_WHITESPACE","\n        ",411],")",";",["T_WHITESPACE","\n\n        ",412],["T_IF","if",414],["T_WHITESPACE"," ",414],"(",["T_VARIABLE","$baseOrderRefund",414],["T_WHITESPACE"," ",414],">",["T_WHITESPACE"," ",414],["T_STRING","Mage",414],["T_DOUBLE_COLON","::",414],["T_STRING","app",414],"(",")",["T_OBJECT_OPERATOR","->",414],["T_STRING","getStore",414],"(",")",["T_OBJECT_OPERATOR","->",414],["T_STRING","roundPrice",414],"(",["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getOrder",414],"(",")",["T_OBJECT_OPERATOR","->",414],["T_STRING","getBaseTotalPaid",414],"(",")",")",")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n\n            ",414],["T_VARIABLE","$baseAvailableRefund",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getOrder",416],"(",")",["T_OBJECT_OPERATOR","->",416],["T_STRING","getBaseTotalPaid",416],"(",")","-",["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getOrder",416],"(",")",["T_OBJECT_OPERATOR","->",416],["T_STRING","getBaseTotalRefunded",416],"(",")",";",["T_WHITESPACE","\n\n            ",416],["T_STRING","Mage",418],["T_DOUBLE_COLON","::",418],["T_STRING","throwException",418],"(",["T_WHITESPACE","\n                ",418],["T_STRING","Mage",419],["T_DOUBLE_COLON","::",419],["T_STRING","helper",419],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",419],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","__",419],"(",["T_CONSTANT_ENCAPSED_STRING","'Maximum amount available to refund is %s'",419],",",["T_WHITESPACE"," ",419],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getOrder",419],"(",")",["T_OBJECT_OPERATOR","->",419],["T_STRING","formatBasePrice",419],"(",["T_VARIABLE","$baseAvailableRefund",419],")",")",["T_WHITESPACE","\n            ",419],")",";",["T_WHITESPACE","\n        ",420],"}",["T_WHITESPACE","\n        ",421],["T_VARIABLE","$order",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getOrder",422],"(",")",";",["T_WHITESPACE","\n        ",422],["T_VARIABLE","$order",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","setBaseTotalRefunded",423],"(",["T_VARIABLE","$baseOrderRefund",423],")",";",["T_WHITESPACE","\n        ",423],["T_VARIABLE","$order",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","setTotalRefunded",424],"(",["T_VARIABLE","$orderRefund",424],")",";",["T_WHITESPACE","\n\n        ",424],["T_VARIABLE","$order",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","setBaseSubtotalRefunded",426],"(",["T_VARIABLE","$order",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getBaseSubtotalRefunded",426],"(",")","+",["T_VARIABLE","$this",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getBaseSubtotal",426],"(",")",")",";",["T_WHITESPACE","\n        ",426],["T_VARIABLE","$order",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","setSubtotalRefunded",427],"(",["T_VARIABLE","$order",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getSubtotalRefunded",427],"(",")","+",["T_VARIABLE","$this",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getSubtotal",427],"(",")",")",";",["T_WHITESPACE","\n\n        ",427],["T_VARIABLE","$order",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","setBaseTaxRefunded",429],"(",["T_VARIABLE","$order",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getBaseTaxRefunded",429],"(",")","+",["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getBaseTaxAmount",429],"(",")",")",";",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$order",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","setTaxRefunded",430],"(",["T_VARIABLE","$order",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getTaxRefunded",430],"(",")","+",["T_VARIABLE","$this",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getTaxAmount",430],"(",")",")",";",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$order",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","setBaseHiddenTaxRefunded",431],"(",["T_VARIABLE","$order",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getBaseHiddenTaxRefunded",431],"(",")","+",["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getBaseHiddenTaxAmount",431],"(",")",")",";",["T_WHITESPACE","\n        ",431],["T_VARIABLE","$order",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","setHiddenTaxRefunded",432],"(",["T_VARIABLE","$order",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getHiddenTaxRefunded",432],"(",")","+",["T_VARIABLE","$this",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getHiddenTaxAmount",432],"(",")",")",";",["T_WHITESPACE","\n\n        ",432],["T_VARIABLE","$order",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","setBaseShippingRefunded",434],"(",["T_VARIABLE","$order",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getBaseShippingRefunded",434],"(",")","+",["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getBaseShippingAmount",434],"(",")",")",";",["T_WHITESPACE","\n        ",434],["T_VARIABLE","$order",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","setShippingRefunded",435],"(",["T_VARIABLE","$order",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getShippingRefunded",435],"(",")","+",["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getShippingAmount",435],"(",")",")",";",["T_WHITESPACE","\n\n        ",435],["T_VARIABLE","$order",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","setBaseShippingTaxRefunded",437],"(",["T_VARIABLE","$order",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","getBaseShippingTaxRefunded",437],"(",")","+",["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","getBaseShippingTaxAmount",437],"(",")",")",";",["T_WHITESPACE","\n        ",437],["T_VARIABLE","$order",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","setShippingTaxRefunded",438],"(",["T_VARIABLE","$order",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getShippingTaxRefunded",438],"(",")","+",["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","getShippingTaxAmount",438],"(",")",")",";",["T_WHITESPACE","\n\n        ",438],["T_VARIABLE","$order",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","setAdjustmentPositive",440],"(",["T_VARIABLE","$order",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getAdjustmentPositive",440],"(",")","+",["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getAdjustmentPositive",440],"(",")",")",";",["T_WHITESPACE","\n        ",440],["T_VARIABLE","$order",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","setBaseAdjustmentPositive",441],"(",["T_VARIABLE","$order",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getBaseAdjustmentPositive",441],"(",")","+",["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","getBaseAdjustmentPositive",441],"(",")",")",";",["T_WHITESPACE","\n\n        ",441],["T_VARIABLE","$order",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","setAdjustmentNegative",443],"(",["T_VARIABLE","$order",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getAdjustmentNegative",443],"(",")","+",["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getAdjustmentNegative",443],"(",")",")",";",["T_WHITESPACE","\n        ",443],["T_VARIABLE","$order",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","setBaseAdjustmentNegative",444],"(",["T_VARIABLE","$order",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getBaseAdjustmentNegative",444],"(",")","+",["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getBaseAdjustmentNegative",444],"(",")",")",";",["T_WHITESPACE","\n\n        ",444],["T_VARIABLE","$order",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","setDiscountRefunded",446],"(",["T_VARIABLE","$order",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getDiscountRefunded",446],"(",")","+",["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getDiscountAmount",446],"(",")",")",";",["T_WHITESPACE","\n        ",446],["T_VARIABLE","$order",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","setBaseDiscountRefunded",447],"(",["T_VARIABLE","$order",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getBaseDiscountRefunded",447],"(",")","+",["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getBaseDiscountAmount",447],"(",")",")",";",["T_WHITESPACE","\n\n        ",447],["T_IF","if",449],["T_WHITESPACE"," ",449],"(",["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getInvoice",449],"(",")",")",["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getInvoice",450],"(",")",["T_OBJECT_OPERATOR","->",450],["T_STRING","setIsUsedForRefund",450],"(",["T_STRING","true",450],")",";",["T_WHITESPACE","\n            ",450],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getInvoice",451],"(",")",["T_OBJECT_OPERATOR","->",451],["T_STRING","setBaseTotalRefunded",451],"(",["T_WHITESPACE","\n                ",451],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getInvoice",452],"(",")",["T_OBJECT_OPERATOR","->",452],["T_STRING","getBaseTotalRefunded",452],"(",")",["T_WHITESPACE"," ",452],"+",["T_WHITESPACE"," ",452],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getBaseGrandTotal",452],"(",")",["T_WHITESPACE","\n            ",452],")",";",["T_WHITESPACE","\n            ",453],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","setInvoiceId",454],"(",["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","getInvoice",454],"(",")",["T_OBJECT_OPERATOR","->",454],["T_STRING","getId",454],"(",")",")",";",["T_WHITESPACE","\n        ",454],"}",["T_WHITESPACE","\n\n        ",455],["T_IF","if",457],["T_WHITESPACE"," ",457],"(","!",["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","getPaymentRefundDisallowed",457],"(",")",")",["T_WHITESPACE"," ",457],"{",["T_WHITESPACE","\n            ",457],["T_VARIABLE","$order",458],["T_OBJECT_OPERATOR","->",458],["T_STRING","getPayment",458],"(",")",["T_OBJECT_OPERATOR","->",458],["T_STRING","refund",458],"(",["T_VARIABLE","$this",458],")",";",["T_WHITESPACE","\n        ",458],"}",["T_WHITESPACE","\n\n        ",459],["T_STRING","Mage",461],["T_DOUBLE_COLON","::",461],["T_STRING","dispatchEvent",461],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_creditmemo_refund'",461],",",["T_WHITESPACE"," ",461],["T_ARRAY","array",461],"(",["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","_eventObject",461],["T_DOUBLE_ARROW","=>",461],["T_VARIABLE","$this",461],")",")",";",["T_WHITESPACE","\n        ",461],["T_RETURN","return",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$this",462],";",["T_WHITESPACE","\n    ",462],"}",["T_WHITESPACE","\n\n    ",463],["T_DOC_COMMENT","\/**\n     * Cancel Creditmemo action\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",465],["T_WHITESPACE","\n    ",469],["T_PUBLIC","public",470],["T_WHITESPACE"," ",470],["T_FUNCTION","function",470],["T_WHITESPACE"," ",470],["T_STRING","cancel",470],"(",")",["T_WHITESPACE","\n    ",470],"{",["T_WHITESPACE","\n        ",471],["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","setState",472],"(",["T_STRING","self",472],["T_DOUBLE_COLON","::",472],["T_STRING","STATE_CANCELED",472],")",";",["T_WHITESPACE","\n        ",472],["T_FOREACH","foreach",473],["T_WHITESPACE"," ",473],"(",["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getAllItems",473],"(",")",["T_WHITESPACE"," ",473],["T_AS","as",473],["T_WHITESPACE"," ",473],["T_VARIABLE","$item",473],")",["T_WHITESPACE"," ",473],"{",["T_WHITESPACE","\n            ",473],["T_VARIABLE","$item",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","cancel",474],"(",")",";",["T_WHITESPACE","\n        ",474],"}",["T_WHITESPACE","\n        ",475],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getOrder",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","getPayment",476],"(",")",["T_OBJECT_OPERATOR","->",476],["T_STRING","cancelCreditmemo",476],"(",["T_VARIABLE","$this",476],")",";",["T_WHITESPACE","\n\n        ",476],["T_IF","if",478],["T_WHITESPACE"," ",478],"(",["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getTransactionId",478],"(",")",")",["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n            ",478],["T_VARIABLE","$this",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getOrder",479],"(",")",["T_OBJECT_OPERATOR","->",479],["T_STRING","setTotalOnlineRefunded",479],"(",["T_WHITESPACE","\n                ",479],["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getOrder",480],"(",")",["T_OBJECT_OPERATOR","->",480],["T_STRING","getTotalOnlineRefunded",480],"(",")","-",["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getGrandTotal",480],"(",")",["T_WHITESPACE","\n            ",480],")",";",["T_WHITESPACE","\n            ",481],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getOrder",482],"(",")",["T_OBJECT_OPERATOR","->",482],["T_STRING","setBaseTotalOnlineRefunded",482],"(",["T_WHITESPACE","\n                ",482],["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getOrder",483],"(",")",["T_OBJECT_OPERATOR","->",483],["T_STRING","getBaseTotalOnlineRefunded",483],"(",")","-",["T_VARIABLE","$this",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getBaseGrandTotal",483],"(",")",["T_WHITESPACE","\n            ",483],")",";",["T_WHITESPACE","\n        ",484],"}",["T_WHITESPACE","\n        ",485],["T_ELSE","else",486],["T_WHITESPACE"," ",486],"{",["T_WHITESPACE","\n            ",486],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getOrder",487],"(",")",["T_OBJECT_OPERATOR","->",487],["T_STRING","setTotalOfflineRefunded",487],"(",["T_WHITESPACE","\n                ",487],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getOrder",488],"(",")",["T_OBJECT_OPERATOR","->",488],["T_STRING","getTotalOfflineRefunded",488],"(",")","-",["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getGrandTotal",488],"(",")",["T_WHITESPACE","\n            ",488],")",";",["T_WHITESPACE","\n            ",489],["T_VARIABLE","$this",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","getOrder",490],"(",")",["T_OBJECT_OPERATOR","->",490],["T_STRING","setBaseTotalOfflineRefunded",490],"(",["T_WHITESPACE","\n                ",490],["T_VARIABLE","$this",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getOrder",491],"(",")",["T_OBJECT_OPERATOR","->",491],["T_STRING","getBaseTotalOfflineRefunded",491],"(",")","-",["T_VARIABLE","$this",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getBaseGrandTotal",491],"(",")",["T_WHITESPACE","\n            ",491],")",";",["T_WHITESPACE","\n        ",492],"}",["T_WHITESPACE","\n\n        ",493],["T_VARIABLE","$this",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getOrder",495],"(",")",["T_OBJECT_OPERATOR","->",495],["T_STRING","setBaseSubtotalRefunded",495],"(",["T_WHITESPACE","\n            ",495],["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getOrder",496],"(",")",["T_OBJECT_OPERATOR","->",496],["T_STRING","getBaseSubtotalRefunded",496],"(",")","-",["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getBaseSubtotal",496],"(",")",["T_WHITESPACE","\n        ",496],")",";",["T_WHITESPACE","\n        ",497],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getOrder",498],"(",")",["T_OBJECT_OPERATOR","->",498],["T_STRING","setSubtotalRefunded",498],"(",["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getOrder",498],"(",")",["T_OBJECT_OPERATOR","->",498],["T_STRING","getSubtotalRefunded",498],"(",")","-",["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getSubtotal",498],"(",")",")",";",["T_WHITESPACE","\n\n        ",498],["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getOrder",500],"(",")",["T_OBJECT_OPERATOR","->",500],["T_STRING","setBaseTaxRefunded",500],"(",["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getOrder",500],"(",")",["T_OBJECT_OPERATOR","->",500],["T_STRING","getBaseTaxRefunded",500],"(",")","-",["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","getBaseTaxAmount",500],"(",")",")",";",["T_WHITESPACE","\n        ",500],["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getOrder",501],"(",")",["T_OBJECT_OPERATOR","->",501],["T_STRING","setTaxRefunded",501],"(",["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getOrder",501],"(",")",["T_OBJECT_OPERATOR","->",501],["T_STRING","getTaxRefunded",501],"(",")","-",["T_VARIABLE","$this",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","getTaxAmount",501],"(",")",")",";",["T_WHITESPACE","\n\n        ",501],["T_VARIABLE","$this",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","getOrder",503],"(",")",["T_OBJECT_OPERATOR","->",503],["T_STRING","setBaseShippingRefunded",503],"(",["T_WHITESPACE","\n            ",503],["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","getOrder",504],"(",")",["T_OBJECT_OPERATOR","->",504],["T_STRING","getBaseShippingRefunded",504],"(",")","-",["T_VARIABLE","$this",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","getBaseShippingAmount",504],"(",")",["T_WHITESPACE","\n        ",504],")",";",["T_WHITESPACE","\n        ",505],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getOrder",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","setShippingRefunded",506],"(",["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getOrder",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","getShippingRefunded",506],"(",")","-",["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getShippingAmount",506],"(",")",")",";",["T_WHITESPACE","\n\n        ",506],["T_STRING","Mage",508],["T_DOUBLE_COLON","::",508],["T_STRING","dispatchEvent",508],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_order_creditmemo_cancel'",508],",",["T_WHITESPACE"," ",508],["T_ARRAY","array",508],"(",["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","_eventObject",508],["T_DOUBLE_ARROW","=>",508],["T_VARIABLE","$this",508],")",")",";",["T_WHITESPACE","\n        ",508],["T_RETURN","return",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],";",["T_WHITESPACE","\n    ",509],"}",["T_WHITESPACE","\n\n    ",510],["T_DOC_COMMENT","\/**\n     * Register creditmemo\n     *\n     * Apply to order, order items etc.\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",512],["T_WHITESPACE","\n    ",518],["T_PUBLIC","public",519],["T_WHITESPACE"," ",519],["T_FUNCTION","function",519],["T_WHITESPACE"," ",519],["T_STRING","register",519],"(",")",["T_WHITESPACE","\n    ",519],"{",["T_WHITESPACE","\n        ",520],["T_IF","if",521],["T_WHITESPACE"," ",521],"(",["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getId",521],"(",")",")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n            ",521],["T_STRING","Mage",522],["T_DOUBLE_COLON","::",522],["T_STRING","throwException",522],"(",["T_WHITESPACE","\n                ",522],["T_STRING","Mage",523],["T_DOUBLE_COLON","::",523],["T_STRING","helper",523],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",523],")",["T_OBJECT_OPERATOR","->",523],["T_STRING","__",523],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot register an existing credit memo.'",523],")",["T_WHITESPACE","\n            ",523],")",";",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n\n        ",525],["T_FOREACH","foreach",527],["T_WHITESPACE"," ",527],"(",["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getAllItems",527],"(",")",["T_WHITESPACE"," ",527],["T_AS","as",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$item",527],")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n            ",527],["T_IF","if",528],["T_WHITESPACE"," ",528],"(",["T_VARIABLE","$item",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getQty",528],"(",")",">",["T_LNUMBER","0",528],")",["T_WHITESPACE"," ",528],"{",["T_WHITESPACE","\n                ",528],["T_VARIABLE","$item",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","register",529],"(",")",";",["T_WHITESPACE","\n            ",529],"}",["T_WHITESPACE","\n            ",530],["T_ELSE","else",531],["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n                ",531],["T_VARIABLE","$item",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","isDeleted",532],"(",["T_STRING","true",532],")",";",["T_WHITESPACE","\n            ",532],"}",["T_WHITESPACE","\n        ",533],"}",["T_WHITESPACE","\n\n        ",534],["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","setDoTransaction",536],"(",["T_STRING","true",536],")",";",["T_WHITESPACE","\n        ",536],["T_IF","if",537],["T_WHITESPACE"," ",537],"(",["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getOfflineRequested",537],"(",")",")",["T_WHITESPACE"," ",537],"{",["T_WHITESPACE","\n            ",537],["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","setDoTransaction",538],"(",["T_STRING","false",538],")",";",["T_WHITESPACE","\n        ",538],"}",["T_WHITESPACE","\n        ",539],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","refund",540],"(",")",";",["T_WHITESPACE","\n\n        ",540],["T_IF","if",542],["T_WHITESPACE"," ",542],"(",["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getDoTransaction",542],"(",")",")",["T_WHITESPACE"," ",542],"{",["T_WHITESPACE","\n            ",542],["T_VARIABLE","$this",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","getOrder",543],"(",")",["T_OBJECT_OPERATOR","->",543],["T_STRING","setTotalOnlineRefunded",543],"(",["T_WHITESPACE","\n                ",543],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getOrder",544],"(",")",["T_OBJECT_OPERATOR","->",544],["T_STRING","getTotalOnlineRefunded",544],"(",")","+",["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","getGrandTotal",544],"(",")",["T_WHITESPACE","\n            ",544],")",";",["T_WHITESPACE","\n            ",545],["T_VARIABLE","$this",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","getOrder",546],"(",")",["T_OBJECT_OPERATOR","->",546],["T_STRING","setBaseTotalOnlineRefunded",546],"(",["T_WHITESPACE","\n                ",546],["T_VARIABLE","$this",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","getOrder",547],"(",")",["T_OBJECT_OPERATOR","->",547],["T_STRING","getBaseTotalOnlineRefunded",547],"(",")","+",["T_VARIABLE","$this",547],["T_OBJECT_OPERATOR","->",547],["T_STRING","getBaseGrandTotal",547],"(",")",["T_WHITESPACE","\n            ",547],")",";",["T_WHITESPACE","\n        ",548],"}",["T_WHITESPACE","\n        ",549],["T_ELSE","else",550],["T_WHITESPACE"," ",550],"{",["T_WHITESPACE","\n            ",550],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","getOrder",551],"(",")",["T_OBJECT_OPERATOR","->",551],["T_STRING","setTotalOfflineRefunded",551],"(",["T_WHITESPACE","\n                ",551],["T_VARIABLE","$this",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","getOrder",552],"(",")",["T_OBJECT_OPERATOR","->",552],["T_STRING","getTotalOfflineRefunded",552],"(",")","+",["T_VARIABLE","$this",552],["T_OBJECT_OPERATOR","->",552],["T_STRING","getGrandTotal",552],"(",")",["T_WHITESPACE","\n            ",552],")",";",["T_WHITESPACE","\n            ",553],["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","getOrder",554],"(",")",["T_OBJECT_OPERATOR","->",554],["T_STRING","setBaseTotalOfflineRefunded",554],"(",["T_WHITESPACE","\n                ",554],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","getOrder",555],"(",")",["T_OBJECT_OPERATOR","->",555],["T_STRING","getBaseTotalOfflineRefunded",555],"(",")","+",["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","getBaseGrandTotal",555],"(",")",["T_WHITESPACE","\n            ",555],")",";",["T_WHITESPACE","\n        ",556],"}",["T_WHITESPACE","\n\n        ",557],["T_VARIABLE","$this",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","getOrder",559],"(",")",["T_OBJECT_OPERATOR","->",559],["T_STRING","setBaseTotalInvoicedCost",559],"(",["T_WHITESPACE","\n            ",559],["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getOrder",560],"(",")",["T_OBJECT_OPERATOR","->",560],["T_STRING","getBaseTotalInvoicedCost",560],"(",")","-",["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getBaseCost",560],"(",")",["T_WHITESPACE","\n        ",560],")",";",["T_WHITESPACE","\n\n        ",561],["T_VARIABLE","$state",563],["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","getState",563],"(",")",";",["T_WHITESPACE","\n        ",563],["T_IF","if",564],["T_WHITESPACE"," ",564],"(",["T_STRING","is_null",564],"(",["T_VARIABLE","$state",564],")",")",["T_WHITESPACE"," ",564],"{",["T_WHITESPACE","\n            ",564],["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","setState",565],"(",["T_STRING","self",565],["T_DOUBLE_COLON","::",565],["T_STRING","STATE_OPEN",565],")",";",["T_WHITESPACE","\n        ",565],"}",["T_WHITESPACE","\n        ",566],["T_RETURN","return",567],["T_WHITESPACE"," ",567],["T_VARIABLE","$this",567],";",["T_WHITESPACE","\n    ",567],"}",["T_WHITESPACE","\n\n    ",568],["T_DOC_COMMENT","\/**\n     * Retrieve Creditmemo states array\n     *\n     * @return array\n     *\/",570],["T_WHITESPACE","\n    ",574],["T_PUBLIC","public",575],["T_WHITESPACE"," ",575],["T_STATIC","static",575],["T_WHITESPACE"," ",575],["T_FUNCTION","function",575],["T_WHITESPACE"," ",575],["T_STRING","getStates",575],"(",")",["T_WHITESPACE","\n    ",575],"{",["T_WHITESPACE","\n        ",576],["T_IF","if",577],["T_WHITESPACE"," ",577],"(",["T_STRING","is_null",577],"(",["T_STRING","self",577],["T_DOUBLE_COLON","::",577],["T_VARIABLE","$_states",577],")",")",["T_WHITESPACE"," ",577],"{",["T_WHITESPACE","\n            ",577],["T_STRING","self",578],["T_DOUBLE_COLON","::",578],["T_VARIABLE","$_states",578],["T_WHITESPACE"," ",578],"=",["T_WHITESPACE"," ",578],["T_ARRAY","array",578],"(",["T_WHITESPACE","\n                ",578],["T_STRING","self",579],["T_DOUBLE_COLON","::",579],["T_STRING","STATE_OPEN",579],["T_WHITESPACE","       ",579],["T_DOUBLE_ARROW","=>",579],["T_WHITESPACE"," ",579],["T_STRING","Mage",579],["T_DOUBLE_COLON","::",579],["T_STRING","helper",579],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",579],")",["T_OBJECT_OPERATOR","->",579],["T_STRING","__",579],"(",["T_CONSTANT_ENCAPSED_STRING","'Pending'",579],")",",",["T_WHITESPACE","\n                ",579],["T_STRING","self",580],["T_DOUBLE_COLON","::",580],["T_STRING","STATE_REFUNDED",580],["T_WHITESPACE","   ",580],["T_DOUBLE_ARROW","=>",580],["T_WHITESPACE"," ",580],["T_STRING","Mage",580],["T_DOUBLE_COLON","::",580],["T_STRING","helper",580],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",580],")",["T_OBJECT_OPERATOR","->",580],["T_STRING","__",580],"(",["T_CONSTANT_ENCAPSED_STRING","'Refunded'",580],")",",",["T_WHITESPACE","\n                ",580],["T_STRING","self",581],["T_DOUBLE_COLON","::",581],["T_STRING","STATE_CANCELED",581],["T_WHITESPACE","   ",581],["T_DOUBLE_ARROW","=>",581],["T_WHITESPACE"," ",581],["T_STRING","Mage",581],["T_DOUBLE_COLON","::",581],["T_STRING","helper",581],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",581],")",["T_OBJECT_OPERATOR","->",581],["T_STRING","__",581],"(",["T_CONSTANT_ENCAPSED_STRING","'Canceled'",581],")",",",["T_WHITESPACE","\n            ",581],")",";",["T_WHITESPACE","\n        ",582],"}",["T_WHITESPACE","\n        ",583],["T_RETURN","return",584],["T_WHITESPACE"," ",584],["T_STRING","self",584],["T_DOUBLE_COLON","::",584],["T_VARIABLE","$_states",584],";",["T_WHITESPACE","\n    ",584],"}",["T_WHITESPACE","\n\n    ",585],["T_DOC_COMMENT","\/**\n     * Retrieve Creditmemo state name by state identifier\n     *\n     * @param   int $stateId\n     * @return  string\n     *\/",587],["T_WHITESPACE","\n    ",592],["T_PUBLIC","public",593],["T_WHITESPACE"," ",593],["T_FUNCTION","function",593],["T_WHITESPACE"," ",593],["T_STRING","getStateName",593],"(",["T_VARIABLE","$stateId",593],["T_WHITESPACE"," ",593],"=",["T_WHITESPACE"," ",593],["T_STRING","null",593],")",["T_WHITESPACE","\n    ",593],"{",["T_WHITESPACE","\n        ",594],["T_IF","if",595],["T_WHITESPACE"," ",595],"(",["T_STRING","is_null",595],"(",["T_VARIABLE","$stateId",595],")",")",["T_WHITESPACE"," ",595],"{",["T_WHITESPACE","\n            ",595],["T_VARIABLE","$stateId",596],["T_WHITESPACE"," ",596],"=",["T_WHITESPACE"," ",596],["T_VARIABLE","$this",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","getState",596],"(",")",";",["T_WHITESPACE","\n        ",596],"}",["T_WHITESPACE","\n\n        ",597],["T_IF","if",599],["T_WHITESPACE"," ",599],"(",["T_STRING","is_null",599],"(",["T_STRING","self",599],["T_DOUBLE_COLON","::",599],["T_VARIABLE","$_states",599],")",")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n            ",599],["T_STRING","self",600],["T_DOUBLE_COLON","::",600],["T_STRING","getStates",600],"(",")",";",["T_WHITESPACE","\n        ",600],"}",["T_WHITESPACE","\n        ",601],["T_IF","if",602],["T_WHITESPACE"," ",602],"(",["T_ISSET","isset",602],"(",["T_STRING","self",602],["T_DOUBLE_COLON","::",602],["T_VARIABLE","$_states",602],"[",["T_VARIABLE","$stateId",602],"]",")",")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n            ",602],["T_RETURN","return",603],["T_WHITESPACE"," ",603],["T_STRING","self",603],["T_DOUBLE_COLON","::",603],["T_VARIABLE","$_states",603],"[",["T_VARIABLE","$stateId",603],"]",";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE","\n        ",604],["T_RETURN","return",605],["T_WHITESPACE"," ",605],["T_STRING","Mage",605],["T_DOUBLE_COLON","::",605],["T_STRING","helper",605],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",605],")",["T_OBJECT_OPERATOR","->",605],["T_STRING","__",605],"(",["T_CONSTANT_ENCAPSED_STRING","'Unknown State'",605],")",";",["T_WHITESPACE","\n    ",605],"}",["T_WHITESPACE","\n\n    ",606],["T_PUBLIC","public",608],["T_WHITESPACE"," ",608],["T_FUNCTION","function",608],["T_WHITESPACE"," ",608],["T_STRING","setShippingAmount",608],"(",["T_VARIABLE","$amount",608],")",["T_WHITESPACE","\n    ",608],"{",["T_WHITESPACE","\n        ",609],["T_COMMENT","\/\/ base shipping amount calculated in total model\n",610],["T_COMMENT","\/\/        $amount = $this->getStore()->roundPrice($amount);\n",611],["T_COMMENT","\/\/        $this->setData('base_shipping_amount', $amount);\n",612],["T_COMMENT","\/\/\n",613],["T_COMMENT","\/\/        $amount = $this->getStore()->roundPrice(\n",614],["T_COMMENT","\/\/            $amount*$this->getOrder()->getStoreToOrderRate()\n",615],["T_COMMENT","\/\/        );\n",616],["T_WHITESPACE","        ",617],["T_VARIABLE","$this",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","setData",617],"(",["T_CONSTANT_ENCAPSED_STRING","'shipping_amount'",617],",",["T_WHITESPACE"," ",617],["T_VARIABLE","$amount",617],")",";",["T_WHITESPACE","\n        ",617],["T_RETURN","return",618],["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],";",["T_WHITESPACE","\n    ",618],"}",["T_WHITESPACE","\n\n\n    ",619],["T_PUBLIC","public",622],["T_WHITESPACE"," ",622],["T_FUNCTION","function",622],["T_WHITESPACE"," ",622],["T_STRING","setAdjustmentPositive",622],"(",["T_VARIABLE","$amount",622],")",["T_WHITESPACE","\n    ",622],"{",["T_WHITESPACE","\n        ",623],["T_VARIABLE","$amount",624],["T_WHITESPACE"," ",624],"=",["T_WHITESPACE"," ",624],["T_STRING","trim",624],"(",["T_VARIABLE","$amount",624],")",";",["T_WHITESPACE","\n        ",624],["T_IF","if",625],["T_WHITESPACE"," ",625],"(",["T_STRING","substr",625],"(",["T_VARIABLE","$amount",625],",",["T_WHITESPACE"," ",625],"-",["T_LNUMBER","1",625],")",["T_WHITESPACE"," ",625],["T_IS_EQUAL","==",625],["T_WHITESPACE"," ",625],["T_CONSTANT_ENCAPSED_STRING","'%'",625],")",["T_WHITESPACE"," ",625],"{",["T_WHITESPACE","\n            ",625],["T_VARIABLE","$amount",626],["T_WHITESPACE"," ",626],"=",["T_WHITESPACE"," ",626],["T_DOUBLE_CAST","(float)",626],["T_WHITESPACE"," ",626],["T_STRING","substr",626],"(",["T_VARIABLE","$amount",626],",",["T_WHITESPACE"," ",626],["T_LNUMBER","0",626],",",["T_WHITESPACE"," ",626],"-",["T_LNUMBER","1",626],")",";",["T_WHITESPACE","\n            ",626],["T_VARIABLE","$amount",627],["T_WHITESPACE"," ",627],"=",["T_WHITESPACE"," ",627],["T_VARIABLE","$this",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","getOrder",627],"(",")",["T_OBJECT_OPERATOR","->",627],["T_STRING","getGrandTotal",627],"(",")",["T_WHITESPACE"," ",627],"*",["T_WHITESPACE"," ",627],["T_VARIABLE","$amount",627],["T_WHITESPACE"," ",627],"\/",["T_WHITESPACE"," ",627],["T_LNUMBER","100",627],";",["T_WHITESPACE","\n        ",627],"}",["T_WHITESPACE","\n\n        ",628],["T_VARIABLE","$amount",630],["T_WHITESPACE"," ",630],"=",["T_WHITESPACE"," ",630],["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","getStore",630],"(",")",["T_OBJECT_OPERATOR","->",630],["T_STRING","roundPrice",630],"(",["T_VARIABLE","$amount",630],")",";",["T_WHITESPACE","\n        ",630],["T_VARIABLE","$this",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","setData",631],"(",["T_CONSTANT_ENCAPSED_STRING","'base_adjustment_positive'",631],",",["T_WHITESPACE"," ",631],["T_VARIABLE","$amount",631],")",";",["T_WHITESPACE","\n\n        ",631],["T_VARIABLE","$amount",633],["T_WHITESPACE"," ",633],"=",["T_WHITESPACE"," ",633],["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","getStore",633],"(",")",["T_OBJECT_OPERATOR","->",633],["T_STRING","roundPrice",633],"(",["T_WHITESPACE","\n            ",633],["T_VARIABLE","$amount",634],"*",["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","getOrder",634],"(",")",["T_OBJECT_OPERATOR","->",634],["T_STRING","getStoreToOrderRate",634],"(",")",["T_WHITESPACE","\n        ",634],")",";",["T_WHITESPACE","\n        ",635],["T_VARIABLE","$this",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","setData",636],"(",["T_CONSTANT_ENCAPSED_STRING","'adjustment_positive'",636],",",["T_WHITESPACE"," ",636],["T_VARIABLE","$amount",636],")",";",["T_WHITESPACE","\n        ",636],["T_RETURN","return",637],["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],";",["T_WHITESPACE","\n    ",637],"}",["T_WHITESPACE","\n\n    ",638],["T_PUBLIC","public",640],["T_WHITESPACE"," ",640],["T_FUNCTION","function",640],["T_WHITESPACE"," ",640],["T_STRING","setAdjustmentNegative",640],"(",["T_VARIABLE","$amount",640],")",["T_WHITESPACE","\n    ",640],"{",["T_WHITESPACE","\n        ",641],["T_VARIABLE","$amount",642],["T_WHITESPACE"," ",642],"=",["T_WHITESPACE"," ",642],["T_STRING","trim",642],"(",["T_VARIABLE","$amount",642],")",";",["T_WHITESPACE","\n        ",642],["T_IF","if",643],["T_WHITESPACE"," ",643],"(",["T_STRING","substr",643],"(",["T_VARIABLE","$amount",643],",",["T_WHITESPACE"," ",643],"-",["T_LNUMBER","1",643],")",["T_WHITESPACE"," ",643],["T_IS_EQUAL","==",643],["T_WHITESPACE"," ",643],["T_CONSTANT_ENCAPSED_STRING","'%'",643],")",["T_WHITESPACE"," ",643],"{",["T_WHITESPACE","\n            ",643],["T_VARIABLE","$amount",644],["T_WHITESPACE"," ",644],"=",["T_WHITESPACE"," ",644],["T_DOUBLE_CAST","(float)",644],["T_WHITESPACE"," ",644],["T_STRING","substr",644],"(",["T_VARIABLE","$amount",644],",",["T_WHITESPACE"," ",644],["T_LNUMBER","0",644],",",["T_WHITESPACE"," ",644],"-",["T_LNUMBER","1",644],")",";",["T_WHITESPACE","\n            ",644],["T_VARIABLE","$amount",645],["T_WHITESPACE"," ",645],"=",["T_WHITESPACE"," ",645],["T_VARIABLE","$this",645],["T_OBJECT_OPERATOR","->",645],["T_STRING","getOrder",645],"(",")",["T_OBJECT_OPERATOR","->",645],["T_STRING","getGrandTotal",645],"(",")",["T_WHITESPACE"," ",645],"*",["T_WHITESPACE"," ",645],["T_VARIABLE","$amount",645],["T_WHITESPACE"," ",645],"\/",["T_WHITESPACE"," ",645],["T_LNUMBER","100",645],";",["T_WHITESPACE","\n        ",645],"}",["T_WHITESPACE","\n\n        ",646],["T_VARIABLE","$amount",648],["T_WHITESPACE"," ",648],"=",["T_WHITESPACE"," ",648],["T_VARIABLE","$this",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getStore",648],"(",")",["T_OBJECT_OPERATOR","->",648],["T_STRING","roundPrice",648],"(",["T_VARIABLE","$amount",648],")",";",["T_WHITESPACE","\n        ",648],["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","setData",649],"(",["T_CONSTANT_ENCAPSED_STRING","'base_adjustment_negative'",649],",",["T_WHITESPACE"," ",649],["T_VARIABLE","$amount",649],")",";",["T_WHITESPACE","\n\n        ",649],["T_VARIABLE","$amount",651],["T_WHITESPACE"," ",651],"=",["T_WHITESPACE"," ",651],["T_VARIABLE","$this",651],["T_OBJECT_OPERATOR","->",651],["T_STRING","getStore",651],"(",")",["T_OBJECT_OPERATOR","->",651],["T_STRING","roundPrice",651],"(",["T_WHITESPACE","\n            ",651],["T_VARIABLE","$amount",652],"*",["T_VARIABLE","$this",652],["T_OBJECT_OPERATOR","->",652],["T_STRING","getOrder",652],"(",")",["T_OBJECT_OPERATOR","->",652],["T_STRING","getStoreToOrderRate",652],"(",")",["T_WHITESPACE","\n        ",652],")",";",["T_WHITESPACE","\n        ",653],["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","setData",654],"(",["T_CONSTANT_ENCAPSED_STRING","'adjustment_negative'",654],",",["T_WHITESPACE"," ",654],["T_VARIABLE","$amount",654],")",";",["T_WHITESPACE","\n        ",654],["T_RETURN","return",655],["T_WHITESPACE"," ",655],["T_VARIABLE","$this",655],";",["T_WHITESPACE","\n    ",655],"}",["T_WHITESPACE","\n\n    ",656],["T_DOC_COMMENT","\/**\n     * Adds comment to credit memo with additional possibility to send it to customer via email\n     * and show it in customer account\n     *\n     * @param string $comment\n     * @param bool $notify\n     * @param bool $visibleOnFront\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",658],["T_WHITESPACE","\n    ",667],["T_PUBLIC","public",668],["T_WHITESPACE"," ",668],["T_FUNCTION","function",668],["T_WHITESPACE"," ",668],["T_STRING","addComment",668],"(",["T_VARIABLE","$comment",668],",",["T_WHITESPACE"," ",668],["T_VARIABLE","$notify",668],"=",["T_STRING","false",668],",",["T_WHITESPACE"," ",668],["T_VARIABLE","$visibleOnFront",668],"=",["T_STRING","false",668],")",["T_WHITESPACE","\n    ",668],"{",["T_WHITESPACE","\n        ",669],["T_IF","if",670],["T_WHITESPACE"," ",670],"(","!","(",["T_VARIABLE","$comment",670],["T_WHITESPACE"," ",670],["T_INSTANCEOF","instanceof",670],["T_WHITESPACE"," ",670],["T_STRING","Mage_Sales_Model_Order_Creditmemo_Comment",670],")",")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n            ",670],["T_VARIABLE","$comment",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_STRING","Mage",671],["T_DOUBLE_COLON","::",671],["T_STRING","getModel",671],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo_comment'",671],")",["T_WHITESPACE","\n                ",671],["T_OBJECT_OPERATOR","->",672],["T_STRING","setComment",672],"(",["T_VARIABLE","$comment",672],")",["T_WHITESPACE","\n                ",672],["T_OBJECT_OPERATOR","->",673],["T_STRING","setIsCustomerNotified",673],"(",["T_VARIABLE","$notify",673],")",["T_WHITESPACE","\n                ",673],["T_OBJECT_OPERATOR","->",674],["T_STRING","setIsVisibleOnFront",674],"(",["T_VARIABLE","$visibleOnFront",674],")",";",["T_WHITESPACE","\n        ",674],"}",["T_WHITESPACE","\n        ",675],["T_VARIABLE","$comment",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","setCreditmemo",676],"(",["T_VARIABLE","$this",676],")",["T_WHITESPACE","\n            ",676],["T_OBJECT_OPERATOR","->",677],["T_STRING","setParentId",677],"(",["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","getId",677],"(",")",")",["T_WHITESPACE","\n            ",677],["T_OBJECT_OPERATOR","->",678],["T_STRING","setStoreId",678],"(",["T_VARIABLE","$this",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getStoreId",678],"(",")",")",";",["T_WHITESPACE","\n        ",678],["T_IF","if",679],["T_WHITESPACE"," ",679],"(","!",["T_VARIABLE","$comment",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getId",679],"(",")",")",["T_WHITESPACE"," ",679],"{",["T_WHITESPACE","\n            ",679],["T_VARIABLE","$this",680],["T_OBJECT_OPERATOR","->",680],["T_STRING","getCommentsCollection",680],"(",")",["T_OBJECT_OPERATOR","->",680],["T_STRING","addItem",680],"(",["T_VARIABLE","$comment",680],")",";",["T_WHITESPACE","\n        ",680],"}",["T_WHITESPACE","\n        ",681],["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","_hasDataChanges",682],["T_WHITESPACE"," ",682],"=",["T_WHITESPACE"," ",682],["T_STRING","true",682],";",["T_WHITESPACE","\n        ",682],["T_RETURN","return",683],["T_WHITESPACE"," ",683],["T_VARIABLE","$this",683],";",["T_WHITESPACE","\n    ",683],"}",["T_WHITESPACE","\n\n    ",684],["T_PUBLIC","public",686],["T_WHITESPACE"," ",686],["T_FUNCTION","function",686],["T_WHITESPACE"," ",686],["T_STRING","getCommentsCollection",686],"(",["T_VARIABLE","$reload",686],"=",["T_STRING","false",686],")",["T_WHITESPACE","\n    ",686],"{",["T_WHITESPACE","\n        ",687],["T_IF","if",688],["T_WHITESPACE"," ",688],"(",["T_STRING","is_null",688],"(",["T_VARIABLE","$this",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","_comments",688],")",["T_WHITESPACE"," ",688],["T_BOOLEAN_OR","||",688],["T_WHITESPACE"," ",688],["T_VARIABLE","$reload",688],")",["T_WHITESPACE"," ",688],"{",["T_WHITESPACE","\n            ",688],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","_comments",689],["T_WHITESPACE"," ",689],"=",["T_WHITESPACE"," ",689],["T_STRING","Mage",689],["T_DOUBLE_COLON","::",689],["T_STRING","getResourceModel",689],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_creditmemo_comment_collection'",689],")",["T_WHITESPACE","\n                ",689],["T_OBJECT_OPERATOR","->",690],["T_STRING","setCreditmemoFilter",690],"(",["T_VARIABLE","$this",690],["T_OBJECT_OPERATOR","->",690],["T_STRING","getId",690],"(",")",")",["T_WHITESPACE","\n                ",690],["T_OBJECT_OPERATOR","->",691],["T_STRING","setCreatedAtOrder",691],"(",")",";",["T_WHITESPACE","\n            ",691],["T_DOC_COMMENT","\/**\n             * When credit memo created with adding comment,\n             * comments collection must be loaded before we added this comment.\n             *\/",692],["T_WHITESPACE","\n            ",695],["T_VARIABLE","$this",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","_comments",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","load",696],"(",")",";",["T_WHITESPACE","\n\n            ",696],["T_IF","if",698],["T_WHITESPACE"," ",698],"(",["T_VARIABLE","$this",698],["T_OBJECT_OPERATOR","->",698],["T_STRING","getId",698],"(",")",")",["T_WHITESPACE"," ",698],"{",["T_WHITESPACE","\n                ",698],["T_FOREACH","foreach",699],["T_WHITESPACE"," ",699],"(",["T_VARIABLE","$this",699],["T_OBJECT_OPERATOR","->",699],["T_STRING","_comments",699],["T_WHITESPACE"," ",699],["T_AS","as",699],["T_WHITESPACE"," ",699],["T_VARIABLE","$comment",699],")",["T_WHITESPACE"," ",699],"{",["T_WHITESPACE","\n                    ",699],["T_VARIABLE","$comment",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","setCreditmemo",700],"(",["T_VARIABLE","$this",700],")",";",["T_WHITESPACE","\n                ",700],"}",["T_WHITESPACE","\n            ",701],"}",["T_WHITESPACE","\n        ",702],"}",["T_WHITESPACE","\n        ",703],["T_RETURN","return",704],["T_WHITESPACE"," ",704],["T_VARIABLE","$this",704],["T_OBJECT_OPERATOR","->",704],["T_STRING","_comments",704],";",["T_WHITESPACE","\n    ",704],"}",["T_WHITESPACE","\n\n\n    ",705],["T_DOC_COMMENT","\/**\n     * Send email with creditmemo data\n     *\n     * @param boolean $notifyCustomer\n     * @param string $comment\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",708],["T_WHITESPACE","\n    ",714],["T_PUBLIC","public",715],["T_WHITESPACE"," ",715],["T_FUNCTION","function",715],["T_WHITESPACE"," ",715],["T_STRING","sendEmail",715],"(",["T_VARIABLE","$notifyCustomer",715],["T_WHITESPACE"," ",715],"=",["T_WHITESPACE"," ",715],["T_STRING","true",715],",",["T_WHITESPACE"," ",715],["T_VARIABLE","$comment",715],["T_WHITESPACE"," ",715],"=",["T_WHITESPACE"," ",715],["T_CONSTANT_ENCAPSED_STRING","''",715],")",["T_WHITESPACE","\n    ",715],"{",["T_WHITESPACE","\n        ",716],["T_VARIABLE","$order",717],["T_WHITESPACE"," ",717],"=",["T_WHITESPACE"," ",717],["T_VARIABLE","$this",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","getOrder",717],"(",")",";",["T_WHITESPACE","\n        ",717],["T_VARIABLE","$storeId",718],["T_WHITESPACE"," ",718],"=",["T_WHITESPACE"," ",718],["T_VARIABLE","$order",718],["T_OBJECT_OPERATOR","->",718],["T_STRING","getStore",718],"(",")",["T_OBJECT_OPERATOR","->",718],["T_STRING","getId",718],"(",")",";",["T_WHITESPACE","\n\n        ",718],["T_IF","if",720],["T_WHITESPACE"," ",720],"(","!",["T_STRING","Mage",720],["T_DOUBLE_COLON","::",720],["T_STRING","helper",720],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",720],")",["T_OBJECT_OPERATOR","->",720],["T_STRING","canSendNewCreditmemoEmail",720],"(",["T_VARIABLE","$storeId",720],")",")",["T_WHITESPACE"," ",720],"{",["T_WHITESPACE","\n            ",720],["T_RETURN","return",721],["T_WHITESPACE"," ",721],["T_VARIABLE","$this",721],";",["T_WHITESPACE","\n        ",721],"}",["T_WHITESPACE","\n        ",722],["T_COMMENT","\/\/ Get the destination email addresses to send copies to\n",723],["T_WHITESPACE","        ",724],["T_VARIABLE","$copyTo",724],["T_WHITESPACE"," ",724],"=",["T_WHITESPACE"," ",724],["T_VARIABLE","$this",724],["T_OBJECT_OPERATOR","->",724],["T_STRING","_getEmails",724],"(",["T_STRING","self",724],["T_DOUBLE_COLON","::",724],["T_STRING","XML_PATH_EMAIL_COPY_TO",724],")",";",["T_WHITESPACE","\n        ",724],["T_VARIABLE","$copyMethod",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING","Mage",725],["T_DOUBLE_COLON","::",725],["T_STRING","getStoreConfig",725],"(",["T_STRING","self",725],["T_DOUBLE_COLON","::",725],["T_STRING","XML_PATH_EMAIL_COPY_METHOD",725],",",["T_WHITESPACE"," ",725],["T_VARIABLE","$storeId",725],")",";",["T_WHITESPACE","\n        ",725],["T_COMMENT","\/\/ Check if at least one recepient is found\n",726],["T_WHITESPACE","        ",727],["T_IF","if",727],["T_WHITESPACE"," ",727],"(","!",["T_VARIABLE","$notifyCustomer",727],["T_WHITESPACE"," ",727],["T_BOOLEAN_AND","&&",727],["T_WHITESPACE"," ",727],"!",["T_VARIABLE","$copyTo",727],")",["T_WHITESPACE"," ",727],"{",["T_WHITESPACE","\n            ",727],["T_RETURN","return",728],["T_WHITESPACE"," ",728],["T_VARIABLE","$this",728],";",["T_WHITESPACE","\n        ",728],"}",["T_WHITESPACE","\n\n        ",729],["T_COMMENT","\/\/ Start store emulation process\n",731],["T_WHITESPACE","        ",732],["T_VARIABLE","$appEmulation",732],["T_WHITESPACE"," ",732],"=",["T_WHITESPACE"," ",732],["T_STRING","Mage",732],["T_DOUBLE_COLON","::",732],["T_STRING","getSingleton",732],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/app_emulation'",732],")",";",["T_WHITESPACE","\n        ",732],["T_VARIABLE","$initialEnvironmentInfo",733],["T_WHITESPACE"," ",733],"=",["T_WHITESPACE"," ",733],["T_VARIABLE","$appEmulation",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","startEnvironmentEmulation",733],"(",["T_VARIABLE","$storeId",733],")",";",["T_WHITESPACE","\n\n        ",733],["T_TRY","try",735],["T_WHITESPACE"," ",735],"{",["T_WHITESPACE","\n            ",735],["T_COMMENT","\/\/ Retrieve specified view block from appropriate design package (depends on emulated store)\n",736],["T_WHITESPACE","            ",737],["T_VARIABLE","$paymentBlock",737],["T_WHITESPACE"," ",737],"=",["T_WHITESPACE"," ",737],["T_STRING","Mage",737],["T_DOUBLE_COLON","::",737],["T_STRING","helper",737],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",737],")",["T_OBJECT_OPERATOR","->",737],["T_STRING","getInfoBlock",737],"(",["T_VARIABLE","$order",737],["T_OBJECT_OPERATOR","->",737],["T_STRING","getPayment",737],"(",")",")",["T_WHITESPACE","\n                ",737],["T_OBJECT_OPERATOR","->",738],["T_STRING","setIsSecureMode",738],"(",["T_STRING","true",738],")",";",["T_WHITESPACE","\n            ",738],["T_VARIABLE","$paymentBlock",739],["T_OBJECT_OPERATOR","->",739],["T_STRING","getMethod",739],"(",")",["T_OBJECT_OPERATOR","->",739],["T_STRING","setStore",739],"(",["T_VARIABLE","$storeId",739],")",";",["T_WHITESPACE","\n            ",739],["T_VARIABLE","$paymentBlockHtml",740],["T_WHITESPACE"," ",740],"=",["T_WHITESPACE"," ",740],["T_VARIABLE","$paymentBlock",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","toHtml",740],"(",")",";",["T_WHITESPACE","\n        ",740],"}",["T_WHITESPACE"," ",741],["T_CATCH","catch",741],["T_WHITESPACE"," ",741],"(",["T_STRING","Exception",741],["T_WHITESPACE"," ",741],["T_VARIABLE","$exception",741],")",["T_WHITESPACE"," ",741],"{",["T_WHITESPACE","\n            ",741],["T_COMMENT","\/\/ Stop store emulation process\n",742],["T_WHITESPACE","            ",743],["T_VARIABLE","$appEmulation",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","stopEnvironmentEmulation",743],"(",["T_VARIABLE","$initialEnvironmentInfo",743],")",";",["T_WHITESPACE","\n            ",743],["T_THROW","throw",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$exception",744],";",["T_WHITESPACE","\n        ",744],"}",["T_WHITESPACE","\n\n        ",745],["T_COMMENT","\/\/ Stop store emulation process\n",747],["T_WHITESPACE","        ",748],["T_VARIABLE","$appEmulation",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","stopEnvironmentEmulation",748],"(",["T_VARIABLE","$initialEnvironmentInfo",748],")",";",["T_WHITESPACE","\n\n        ",748],["T_COMMENT","\/\/ Retrieve corresponding email template id and customer name\n",750],["T_WHITESPACE","        ",751],["T_IF","if",751],["T_WHITESPACE"," ",751],"(",["T_VARIABLE","$order",751],["T_OBJECT_OPERATOR","->",751],["T_STRING","getCustomerIsGuest",751],"(",")",")",["T_WHITESPACE"," ",751],"{",["T_WHITESPACE","\n            ",751],["T_VARIABLE","$templateId",752],["T_WHITESPACE"," ",752],"=",["T_WHITESPACE"," ",752],["T_STRING","Mage",752],["T_DOUBLE_COLON","::",752],["T_STRING","getStoreConfig",752],"(",["T_STRING","self",752],["T_DOUBLE_COLON","::",752],["T_STRING","XML_PATH_EMAIL_GUEST_TEMPLATE",752],",",["T_WHITESPACE"," ",752],["T_VARIABLE","$storeId",752],")",";",["T_WHITESPACE","\n            ",752],["T_VARIABLE","$customerName",753],["T_WHITESPACE"," ",753],"=",["T_WHITESPACE"," ",753],["T_VARIABLE","$order",753],["T_OBJECT_OPERATOR","->",753],["T_STRING","getBillingAddress",753],"(",")",["T_OBJECT_OPERATOR","->",753],["T_STRING","getName",753],"(",")",";",["T_WHITESPACE","\n        ",753],"}",["T_WHITESPACE"," ",754],["T_ELSE","else",754],["T_WHITESPACE"," ",754],"{",["T_WHITESPACE","\n            ",754],["T_VARIABLE","$templateId",755],["T_WHITESPACE"," ",755],"=",["T_WHITESPACE"," ",755],["T_STRING","Mage",755],["T_DOUBLE_COLON","::",755],["T_STRING","getStoreConfig",755],"(",["T_STRING","self",755],["T_DOUBLE_COLON","::",755],["T_STRING","XML_PATH_EMAIL_TEMPLATE",755],",",["T_WHITESPACE"," ",755],["T_VARIABLE","$storeId",755],")",";",["T_WHITESPACE","\n            ",755],["T_VARIABLE","$customerName",756],["T_WHITESPACE"," ",756],"=",["T_WHITESPACE"," ",756],["T_VARIABLE","$order",756],["T_OBJECT_OPERATOR","->",756],["T_STRING","getCustomerName",756],"(",")",";",["T_WHITESPACE","\n        ",756],"}",["T_WHITESPACE","\n\n        ",757],["T_VARIABLE","$mailer",759],["T_WHITESPACE"," ",759],"=",["T_WHITESPACE"," ",759],["T_STRING","Mage",759],["T_DOUBLE_COLON","::",759],["T_STRING","getModel",759],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template_mailer'",759],")",";",["T_WHITESPACE","\n        ",759],["T_IF","if",760],["T_WHITESPACE"," ",760],"(",["T_VARIABLE","$notifyCustomer",760],")",["T_WHITESPACE"," ",760],"{",["T_WHITESPACE","\n            ",760],["T_VARIABLE","$emailInfo",761],["T_WHITESPACE"," ",761],"=",["T_WHITESPACE"," ",761],["T_STRING","Mage",761],["T_DOUBLE_COLON","::",761],["T_STRING","getModel",761],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",761],")",";",["T_WHITESPACE","\n            ",761],["T_VARIABLE","$emailInfo",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","addTo",762],"(",["T_VARIABLE","$order",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","getCustomerEmail",762],"(",")",",",["T_WHITESPACE"," ",762],["T_VARIABLE","$customerName",762],")",";",["T_WHITESPACE","\n            ",762],["T_IF","if",763],["T_WHITESPACE"," ",763],"(",["T_VARIABLE","$copyTo",763],["T_WHITESPACE"," ",763],["T_BOOLEAN_AND","&&",763],["T_WHITESPACE"," ",763],["T_VARIABLE","$copyMethod",763],["T_WHITESPACE"," ",763],["T_IS_EQUAL","==",763],["T_WHITESPACE"," ",763],["T_CONSTANT_ENCAPSED_STRING","'bcc'",763],")",["T_WHITESPACE"," ",763],"{",["T_WHITESPACE","\n                ",763],["T_COMMENT","\/\/ Add bcc to customer email\n",764],["T_WHITESPACE","                ",765],["T_FOREACH","foreach",765],["T_WHITESPACE"," ",765],"(",["T_VARIABLE","$copyTo",765],["T_WHITESPACE"," ",765],["T_AS","as",765],["T_WHITESPACE"," ",765],["T_VARIABLE","$email",765],")",["T_WHITESPACE"," ",765],"{",["T_WHITESPACE","\n                    ",765],["T_VARIABLE","$emailInfo",766],["T_OBJECT_OPERATOR","->",766],["T_STRING","addBcc",766],"(",["T_VARIABLE","$email",766],")",";",["T_WHITESPACE","\n                ",766],"}",["T_WHITESPACE","\n            ",767],"}",["T_WHITESPACE","\n            ",768],["T_VARIABLE","$mailer",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","addEmailInfo",769],"(",["T_VARIABLE","$emailInfo",769],")",";",["T_WHITESPACE","\n        ",769],"}",["T_WHITESPACE","\n\n        ",770],["T_COMMENT","\/\/ Email copies are sent as separated emails if their copy method is 'copy' or a customer should not be notified\n",772],["T_WHITESPACE","        ",773],["T_IF","if",773],["T_WHITESPACE"," ",773],"(",["T_VARIABLE","$copyTo",773],["T_WHITESPACE"," ",773],["T_BOOLEAN_AND","&&",773],["T_WHITESPACE"," ",773],"(",["T_VARIABLE","$copyMethod",773],["T_WHITESPACE"," ",773],["T_IS_EQUAL","==",773],["T_WHITESPACE"," ",773],["T_CONSTANT_ENCAPSED_STRING","'copy'",773],["T_WHITESPACE"," ",773],["T_BOOLEAN_OR","||",773],["T_WHITESPACE"," ",773],"!",["T_VARIABLE","$notifyCustomer",773],")",")",["T_WHITESPACE"," ",773],"{",["T_WHITESPACE","\n            ",773],["T_FOREACH","foreach",774],["T_WHITESPACE"," ",774],"(",["T_VARIABLE","$copyTo",774],["T_WHITESPACE"," ",774],["T_AS","as",774],["T_WHITESPACE"," ",774],["T_VARIABLE","$email",774],")",["T_WHITESPACE"," ",774],"{",["T_WHITESPACE","\n                ",774],["T_VARIABLE","$emailInfo",775],["T_WHITESPACE"," ",775],"=",["T_WHITESPACE"," ",775],["T_STRING","Mage",775],["T_DOUBLE_COLON","::",775],["T_STRING","getModel",775],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",775],")",";",["T_WHITESPACE","\n                ",775],["T_VARIABLE","$emailInfo",776],["T_OBJECT_OPERATOR","->",776],["T_STRING","addTo",776],"(",["T_VARIABLE","$email",776],")",";",["T_WHITESPACE","\n                ",776],["T_VARIABLE","$mailer",777],["T_OBJECT_OPERATOR","->",777],["T_STRING","addEmailInfo",777],"(",["T_VARIABLE","$emailInfo",777],")",";",["T_WHITESPACE","\n            ",777],"}",["T_WHITESPACE","\n        ",778],"}",["T_WHITESPACE","\n\n        ",779],["T_COMMENT","\/\/ Set all required params and send emails\n",781],["T_WHITESPACE","        ",782],["T_VARIABLE","$mailer",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","setSender",782],"(",["T_STRING","Mage",782],["T_DOUBLE_COLON","::",782],["T_STRING","getStoreConfig",782],"(",["T_STRING","self",782],["T_DOUBLE_COLON","::",782],["T_STRING","XML_PATH_EMAIL_IDENTITY",782],",",["T_WHITESPACE"," ",782],["T_VARIABLE","$storeId",782],")",")",";",["T_WHITESPACE","\n        ",782],["T_VARIABLE","$mailer",783],["T_OBJECT_OPERATOR","->",783],["T_STRING","setStoreId",783],"(",["T_VARIABLE","$storeId",783],")",";",["T_WHITESPACE","\n        ",783],["T_VARIABLE","$mailer",784],["T_OBJECT_OPERATOR","->",784],["T_STRING","setTemplateId",784],"(",["T_VARIABLE","$templateId",784],")",";",["T_WHITESPACE","\n        ",784],["T_VARIABLE","$mailer",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","setTemplateParams",785],"(",["T_ARRAY","array",785],"(",["T_WHITESPACE","\n                ",785],["T_CONSTANT_ENCAPSED_STRING","'order'",786],["T_WHITESPACE","        ",786],["T_DOUBLE_ARROW","=>",786],["T_WHITESPACE"," ",786],["T_VARIABLE","$order",786],",",["T_WHITESPACE","\n                ",786],["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",787],["T_WHITESPACE","   ",787],["T_DOUBLE_ARROW","=>",787],["T_WHITESPACE"," ",787],["T_VARIABLE","$this",787],",",["T_WHITESPACE","\n                ",787],["T_CONSTANT_ENCAPSED_STRING","'comment'",788],["T_WHITESPACE","      ",788],["T_DOUBLE_ARROW","=>",788],["T_WHITESPACE"," ",788],["T_VARIABLE","$comment",788],",",["T_WHITESPACE","\n                ",788],["T_CONSTANT_ENCAPSED_STRING","'billing'",789],["T_WHITESPACE","      ",789],["T_DOUBLE_ARROW","=>",789],["T_WHITESPACE"," ",789],["T_VARIABLE","$order",789],["T_OBJECT_OPERATOR","->",789],["T_STRING","getBillingAddress",789],"(",")",",",["T_WHITESPACE","\n                ",789],["T_CONSTANT_ENCAPSED_STRING","'payment_html'",790],["T_WHITESPACE"," ",790],["T_DOUBLE_ARROW","=>",790],["T_WHITESPACE"," ",790],["T_VARIABLE","$paymentBlockHtml",790],["T_WHITESPACE","\n            ",790],")",["T_WHITESPACE","\n        ",791],")",";",["T_WHITESPACE","\n        ",792],["T_VARIABLE","$mailer",793],["T_OBJECT_OPERATOR","->",793],["T_STRING","send",793],"(",")",";",["T_WHITESPACE","\n        ",793],["T_VARIABLE","$this",794],["T_OBJECT_OPERATOR","->",794],["T_STRING","setEmailSent",794],"(",["T_STRING","true",794],")",";",["T_WHITESPACE","\n        ",794],["T_VARIABLE","$this",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","_getResource",795],"(",")",["T_OBJECT_OPERATOR","->",795],["T_STRING","saveAttribute",795],"(",["T_VARIABLE","$this",795],",",["T_WHITESPACE"," ",795],["T_CONSTANT_ENCAPSED_STRING","'email_sent'",795],")",";",["T_WHITESPACE","\n\n        ",795],["T_RETURN","return",797],["T_WHITESPACE"," ",797],["T_VARIABLE","$this",797],";",["T_WHITESPACE","\n    ",797],"}",["T_WHITESPACE","\n\n    ",798],["T_DOC_COMMENT","\/**\n     * Send email with creditmemo update information\n     *\n     * @param boolean $notifyCustomer\n     * @param string $comment\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",800],["T_WHITESPACE","\n    ",806],["T_PUBLIC","public",807],["T_WHITESPACE"," ",807],["T_FUNCTION","function",807],["T_WHITESPACE"," ",807],["T_STRING","sendUpdateEmail",807],"(",["T_VARIABLE","$notifyCustomer",807],["T_WHITESPACE"," ",807],"=",["T_WHITESPACE"," ",807],["T_STRING","true",807],",",["T_WHITESPACE"," ",807],["T_VARIABLE","$comment",807],["T_WHITESPACE"," ",807],"=",["T_WHITESPACE"," ",807],["T_CONSTANT_ENCAPSED_STRING","''",807],")",["T_WHITESPACE","\n    ",807],"{",["T_WHITESPACE","\n        ",808],["T_VARIABLE","$order",809],["T_WHITESPACE"," ",809],"=",["T_WHITESPACE"," ",809],["T_VARIABLE","$this",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getOrder",809],"(",")",";",["T_WHITESPACE","\n        ",809],["T_VARIABLE","$storeId",810],["T_WHITESPACE"," ",810],"=",["T_WHITESPACE"," ",810],["T_VARIABLE","$order",810],["T_OBJECT_OPERATOR","->",810],["T_STRING","getStore",810],"(",")",["T_OBJECT_OPERATOR","->",810],["T_STRING","getId",810],"(",")",";",["T_WHITESPACE","\n\n        ",810],["T_IF","if",812],["T_WHITESPACE"," ",812],"(","!",["T_STRING","Mage",812],["T_DOUBLE_COLON","::",812],["T_STRING","helper",812],"(",["T_CONSTANT_ENCAPSED_STRING","'sales'",812],")",["T_OBJECT_OPERATOR","->",812],["T_STRING","canSendCreditmemoCommentEmail",812],"(",["T_VARIABLE","$storeId",812],")",")",["T_WHITESPACE"," ",812],"{",["T_WHITESPACE","\n            ",812],["T_RETURN","return",813],["T_WHITESPACE"," ",813],["T_VARIABLE","$this",813],";",["T_WHITESPACE","\n        ",813],"}",["T_WHITESPACE","\n        ",814],["T_COMMENT","\/\/ Get the destination email addresses to send copies to\n",815],["T_WHITESPACE","        ",816],["T_VARIABLE","$copyTo",816],["T_WHITESPACE"," ",816],"=",["T_WHITESPACE"," ",816],["T_VARIABLE","$this",816],["T_OBJECT_OPERATOR","->",816],["T_STRING","_getEmails",816],"(",["T_STRING","self",816],["T_DOUBLE_COLON","::",816],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_TO",816],")",";",["T_WHITESPACE","\n        ",816],["T_VARIABLE","$copyMethod",817],["T_WHITESPACE"," ",817],"=",["T_WHITESPACE"," ",817],["T_STRING","Mage",817],["T_DOUBLE_COLON","::",817],["T_STRING","getStoreConfig",817],"(",["T_STRING","self",817],["T_DOUBLE_COLON","::",817],["T_STRING","XML_PATH_UPDATE_EMAIL_COPY_METHOD",817],",",["T_WHITESPACE"," ",817],["T_VARIABLE","$storeId",817],")",";",["T_WHITESPACE","\n        ",817],["T_COMMENT","\/\/ Check if at least one recepient is found\n",818],["T_WHITESPACE","        ",819],["T_IF","if",819],["T_WHITESPACE"," ",819],"(","!",["T_VARIABLE","$notifyCustomer",819],["T_WHITESPACE"," ",819],["T_BOOLEAN_AND","&&",819],["T_WHITESPACE"," ",819],"!",["T_VARIABLE","$copyTo",819],")",["T_WHITESPACE"," ",819],"{",["T_WHITESPACE","\n            ",819],["T_RETURN","return",820],["T_WHITESPACE"," ",820],["T_VARIABLE","$this",820],";",["T_WHITESPACE","\n        ",820],"}",["T_WHITESPACE","\n\n        ",821],["T_COMMENT","\/\/ Retrieve corresponding email template id and customer name\n",823],["T_WHITESPACE","        ",824],["T_IF","if",824],["T_WHITESPACE"," ",824],"(",["T_VARIABLE","$order",824],["T_OBJECT_OPERATOR","->",824],["T_STRING","getCustomerIsGuest",824],"(",")",")",["T_WHITESPACE"," ",824],"{",["T_WHITESPACE","\n            ",824],["T_VARIABLE","$templateId",825],["T_WHITESPACE"," ",825],"=",["T_WHITESPACE"," ",825],["T_STRING","Mage",825],["T_DOUBLE_COLON","::",825],["T_STRING","getStoreConfig",825],"(",["T_STRING","self",825],["T_DOUBLE_COLON","::",825],["T_STRING","XML_PATH_UPDATE_EMAIL_GUEST_TEMPLATE",825],",",["T_WHITESPACE"," ",825],["T_VARIABLE","$storeId",825],")",";",["T_WHITESPACE","\n            ",825],["T_VARIABLE","$customerName",826],["T_WHITESPACE"," ",826],"=",["T_WHITESPACE"," ",826],["T_VARIABLE","$order",826],["T_OBJECT_OPERATOR","->",826],["T_STRING","getBillingAddress",826],"(",")",["T_OBJECT_OPERATOR","->",826],["T_STRING","getName",826],"(",")",";",["T_WHITESPACE","\n        ",826],"}",["T_WHITESPACE"," ",827],["T_ELSE","else",827],["T_WHITESPACE"," ",827],"{",["T_WHITESPACE","\n            ",827],["T_VARIABLE","$templateId",828],["T_WHITESPACE"," ",828],"=",["T_WHITESPACE"," ",828],["T_STRING","Mage",828],["T_DOUBLE_COLON","::",828],["T_STRING","getStoreConfig",828],"(",["T_STRING","self",828],["T_DOUBLE_COLON","::",828],["T_STRING","XML_PATH_UPDATE_EMAIL_TEMPLATE",828],",",["T_WHITESPACE"," ",828],["T_VARIABLE","$storeId",828],")",";",["T_WHITESPACE","\n            ",828],["T_VARIABLE","$customerName",829],["T_WHITESPACE"," ",829],"=",["T_WHITESPACE"," ",829],["T_VARIABLE","$order",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","getCustomerName",829],"(",")",";",["T_WHITESPACE","\n        ",829],"}",["T_WHITESPACE","\n\n        ",830],["T_VARIABLE","$mailer",832],["T_WHITESPACE"," ",832],"=",["T_WHITESPACE"," ",832],["T_STRING","Mage",832],["T_DOUBLE_COLON","::",832],["T_STRING","getModel",832],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template_mailer'",832],")",";",["T_WHITESPACE","\n        ",832],["T_IF","if",833],["T_WHITESPACE"," ",833],"(",["T_VARIABLE","$notifyCustomer",833],")",["T_WHITESPACE"," ",833],"{",["T_WHITESPACE","\n            ",833],["T_VARIABLE","$emailInfo",834],["T_WHITESPACE"," ",834],"=",["T_WHITESPACE"," ",834],["T_STRING","Mage",834],["T_DOUBLE_COLON","::",834],["T_STRING","getModel",834],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",834],")",";",["T_WHITESPACE","\n            ",834],["T_VARIABLE","$emailInfo",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","addTo",835],"(",["T_VARIABLE","$order",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","getCustomerEmail",835],"(",")",",",["T_WHITESPACE"," ",835],["T_VARIABLE","$customerName",835],")",";",["T_WHITESPACE","\n            ",835],["T_IF","if",836],["T_WHITESPACE"," ",836],"(",["T_VARIABLE","$copyTo",836],["T_WHITESPACE"," ",836],["T_BOOLEAN_AND","&&",836],["T_WHITESPACE"," ",836],["T_VARIABLE","$copyMethod",836],["T_WHITESPACE"," ",836],["T_IS_EQUAL","==",836],["T_WHITESPACE"," ",836],["T_CONSTANT_ENCAPSED_STRING","'bcc'",836],")",["T_WHITESPACE"," ",836],"{",["T_WHITESPACE","\n                ",836],["T_COMMENT","\/\/ Add bcc to customer email\n",837],["T_WHITESPACE","                ",838],["T_FOREACH","foreach",838],["T_WHITESPACE"," ",838],"(",["T_VARIABLE","$copyTo",838],["T_WHITESPACE"," ",838],["T_AS","as",838],["T_WHITESPACE"," ",838],["T_VARIABLE","$email",838],")",["T_WHITESPACE"," ",838],"{",["T_WHITESPACE","\n                    ",838],["T_VARIABLE","$emailInfo",839],["T_OBJECT_OPERATOR","->",839],["T_STRING","addBcc",839],"(",["T_VARIABLE","$email",839],")",";",["T_WHITESPACE","\n                ",839],"}",["T_WHITESPACE","\n            ",840],"}",["T_WHITESPACE","\n            ",841],["T_VARIABLE","$mailer",842],["T_OBJECT_OPERATOR","->",842],["T_STRING","addEmailInfo",842],"(",["T_VARIABLE","$emailInfo",842],")",";",["T_WHITESPACE","\n        ",842],"}",["T_WHITESPACE","\n\n        ",843],["T_COMMENT","\/\/ Email copies are sent as separated emails if their copy method is 'copy' or a customer should not be notified\n",845],["T_WHITESPACE","        ",846],["T_IF","if",846],["T_WHITESPACE"," ",846],"(",["T_VARIABLE","$copyTo",846],["T_WHITESPACE"," ",846],["T_BOOLEAN_AND","&&",846],["T_WHITESPACE"," ",846],"(",["T_VARIABLE","$copyMethod",846],["T_WHITESPACE"," ",846],["T_IS_EQUAL","==",846],["T_WHITESPACE"," ",846],["T_CONSTANT_ENCAPSED_STRING","'copy'",846],["T_WHITESPACE"," ",846],["T_BOOLEAN_OR","||",846],["T_WHITESPACE"," ",846],"!",["T_VARIABLE","$notifyCustomer",846],")",")",["T_WHITESPACE"," ",846],"{",["T_WHITESPACE","\n            ",846],["T_FOREACH","foreach",847],["T_WHITESPACE"," ",847],"(",["T_VARIABLE","$copyTo",847],["T_WHITESPACE"," ",847],["T_AS","as",847],["T_WHITESPACE"," ",847],["T_VARIABLE","$email",847],")",["T_WHITESPACE"," ",847],"{",["T_WHITESPACE","\n                ",847],["T_VARIABLE","$emailInfo",848],["T_WHITESPACE"," ",848],"=",["T_WHITESPACE"," ",848],["T_STRING","Mage",848],["T_DOUBLE_COLON","::",848],["T_STRING","getModel",848],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_info'",848],")",";",["T_WHITESPACE","\n                ",848],["T_VARIABLE","$emailInfo",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","addTo",849],"(",["T_VARIABLE","$email",849],")",";",["T_WHITESPACE","\n                ",849],["T_VARIABLE","$mailer",850],["T_OBJECT_OPERATOR","->",850],["T_STRING","addEmailInfo",850],"(",["T_VARIABLE","$emailInfo",850],")",";",["T_WHITESPACE","\n            ",850],"}",["T_WHITESPACE","\n        ",851],"}",["T_WHITESPACE","\n\n        ",852],["T_COMMENT","\/\/ Set all required params and send emails\n",854],["T_WHITESPACE","        ",855],["T_VARIABLE","$mailer",855],["T_OBJECT_OPERATOR","->",855],["T_STRING","setSender",855],"(",["T_STRING","Mage",855],["T_DOUBLE_COLON","::",855],["T_STRING","getStoreConfig",855],"(",["T_STRING","self",855],["T_DOUBLE_COLON","::",855],["T_STRING","XML_PATH_UPDATE_EMAIL_IDENTITY",855],",",["T_WHITESPACE"," ",855],["T_VARIABLE","$storeId",855],")",")",";",["T_WHITESPACE","\n        ",855],["T_VARIABLE","$mailer",856],["T_OBJECT_OPERATOR","->",856],["T_STRING","setStoreId",856],"(",["T_VARIABLE","$storeId",856],")",";",["T_WHITESPACE","\n        ",856],["T_VARIABLE","$mailer",857],["T_OBJECT_OPERATOR","->",857],["T_STRING","setTemplateId",857],"(",["T_VARIABLE","$templateId",857],")",";",["T_WHITESPACE","\n        ",857],["T_VARIABLE","$mailer",858],["T_OBJECT_OPERATOR","->",858],["T_STRING","setTemplateParams",858],"(",["T_ARRAY","array",858],"(",["T_WHITESPACE","\n                ",858],["T_CONSTANT_ENCAPSED_STRING","'order'",859],["T_WHITESPACE","      ",859],["T_DOUBLE_ARROW","=>",859],["T_WHITESPACE"," ",859],["T_VARIABLE","$order",859],",",["T_WHITESPACE","\n                ",859],["T_CONSTANT_ENCAPSED_STRING","'creditmemo'",860],["T_WHITESPACE"," ",860],["T_DOUBLE_ARROW","=>",860],["T_WHITESPACE"," ",860],["T_VARIABLE","$this",860],",",["T_WHITESPACE","\n                ",860],["T_CONSTANT_ENCAPSED_STRING","'comment'",861],["T_WHITESPACE","    ",861],["T_DOUBLE_ARROW","=>",861],["T_WHITESPACE"," ",861],["T_VARIABLE","$comment",861],",",["T_WHITESPACE","\n                ",861],["T_CONSTANT_ENCAPSED_STRING","'billing'",862],["T_WHITESPACE","    ",862],["T_DOUBLE_ARROW","=>",862],["T_WHITESPACE"," ",862],["T_VARIABLE","$order",862],["T_OBJECT_OPERATOR","->",862],["T_STRING","getBillingAddress",862],"(",")",["T_WHITESPACE","\n            ",862],")",["T_WHITESPACE","\n        ",863],")",";",["T_WHITESPACE","\n        ",864],["T_VARIABLE","$mailer",865],["T_OBJECT_OPERATOR","->",865],["T_STRING","send",865],"(",")",";",["T_WHITESPACE","\n\n        ",865],["T_RETURN","return",867],["T_WHITESPACE"," ",867],["T_VARIABLE","$this",867],";",["T_WHITESPACE","\n    ",867],"}",["T_WHITESPACE","\n\n    ",868],["T_PROTECTED","protected",870],["T_WHITESPACE"," ",870],["T_FUNCTION","function",870],["T_WHITESPACE"," ",870],["T_STRING","_getEmails",870],"(",["T_VARIABLE","$configPath",870],")",["T_WHITESPACE","\n    ",870],"{",["T_WHITESPACE","\n        ",871],["T_VARIABLE","$data",872],["T_WHITESPACE"," ",872],"=",["T_WHITESPACE"," ",872],["T_STRING","Mage",872],["T_DOUBLE_COLON","::",872],["T_STRING","getStoreConfig",872],"(",["T_VARIABLE","$configPath",872],",",["T_WHITESPACE"," ",872],["T_VARIABLE","$this",872],["T_OBJECT_OPERATOR","->",872],["T_STRING","getStoreId",872],"(",")",")",";",["T_WHITESPACE","\n        ",872],["T_IF","if",873],["T_WHITESPACE"," ",873],"(","!",["T_EMPTY","empty",873],"(",["T_VARIABLE","$data",873],")",")",["T_WHITESPACE"," ",873],"{",["T_WHITESPACE","\n            ",873],["T_RETURN","return",874],["T_WHITESPACE"," ",874],["T_STRING","explode",874],"(",["T_CONSTANT_ENCAPSED_STRING","','",874],",",["T_WHITESPACE"," ",874],["T_VARIABLE","$data",874],")",";",["T_WHITESPACE","\n        ",874],"}",["T_WHITESPACE","\n        ",875],["T_RETURN","return",876],["T_WHITESPACE"," ",876],["T_STRING","false",876],";",["T_WHITESPACE","\n    ",876],"}",["T_WHITESPACE","\n\n    ",877],["T_PROTECTED","protected",879],["T_WHITESPACE"," ",879],["T_FUNCTION","function",879],["T_WHITESPACE"," ",879],["T_STRING","_beforeDelete",879],"(",")",["T_WHITESPACE","\n    ",879],"{",["T_WHITESPACE","\n        ",880],["T_VARIABLE","$this",881],["T_OBJECT_OPERATOR","->",881],["T_STRING","_protectFromNonAdmin",881],"(",")",";",["T_WHITESPACE","\n        ",881],["T_RETURN","return",882],["T_WHITESPACE"," ",882],["T_STRING","parent",882],["T_DOUBLE_COLON","::",882],["T_STRING","_beforeDelete",882],"(",")",";",["T_WHITESPACE","\n    ",882],"}",["T_WHITESPACE","\n\n    ",883],["T_DOC_COMMENT","\/**\n     * After save object manipulations\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",885],["T_WHITESPACE","\n    ",889],["T_PROTECTED","protected",890],["T_WHITESPACE"," ",890],["T_FUNCTION","function",890],["T_WHITESPACE"," ",890],["T_STRING","_afterSave",890],"(",")",["T_WHITESPACE","\n    ",890],"{",["T_WHITESPACE","\n        ",891],["T_IF","if",892],["T_WHITESPACE"," ",892],"(",["T_STRING","null",892],["T_WHITESPACE"," ",892],["T_IS_NOT_EQUAL","!=",892],["T_WHITESPACE"," ",892],["T_VARIABLE","$this",892],["T_OBJECT_OPERATOR","->",892],["T_STRING","_items",892],")",["T_WHITESPACE"," ",892],"{",["T_WHITESPACE","\n            ",892],["T_FOREACH","foreach",893],["T_WHITESPACE"," ",893],"(",["T_VARIABLE","$this",893],["T_OBJECT_OPERATOR","->",893],["T_STRING","_items",893],["T_WHITESPACE"," ",893],["T_AS","as",893],["T_WHITESPACE"," ",893],["T_VARIABLE","$item",893],")",["T_WHITESPACE"," ",893],"{",["T_WHITESPACE","\n                ",893],["T_VARIABLE","$item",894],["T_OBJECT_OPERATOR","->",894],["T_STRING","save",894],"(",")",";",["T_WHITESPACE","\n            ",894],"}",["T_WHITESPACE","\n        ",895],"}",["T_WHITESPACE","\n\n        ",896],["T_IF","if",898],["T_WHITESPACE"," ",898],"(",["T_STRING","null",898],["T_WHITESPACE"," ",898],["T_IS_NOT_EQUAL","!=",898],["T_WHITESPACE"," ",898],["T_VARIABLE","$this",898],["T_OBJECT_OPERATOR","->",898],["T_STRING","_comments",898],")",["T_WHITESPACE"," ",898],"{",["T_WHITESPACE","\n            ",898],["T_FOREACH","foreach",899],"(",["T_VARIABLE","$this",899],["T_OBJECT_OPERATOR","->",899],["T_STRING","_comments",899],["T_WHITESPACE"," ",899],["T_AS","as",899],["T_WHITESPACE"," ",899],["T_VARIABLE","$comment",899],")",["T_WHITESPACE"," ",899],"{",["T_WHITESPACE","\n                ",899],["T_VARIABLE","$comment",900],["T_OBJECT_OPERATOR","->",900],["T_STRING","save",900],"(",")",";",["T_WHITESPACE","\n            ",900],"}",["T_WHITESPACE","\n        ",901],"}",["T_WHITESPACE","\n\n\n        ",902],["T_RETURN","return",905],["T_WHITESPACE"," ",905],["T_STRING","parent",905],["T_DOUBLE_COLON","::",905],["T_STRING","_afterSave",905],"(",")",";",["T_WHITESPACE","\n    ",905],"}",["T_WHITESPACE","\n\n    ",906],["T_DOC_COMMENT","\/**\n     * Before object save manipulations\n     *\n     * @return Mage_Sales_Model_Order_Creditmemo\n     *\/",908],["T_WHITESPACE","\n    ",912],["T_PROTECTED","protected",913],["T_WHITESPACE"," ",913],["T_FUNCTION","function",913],["T_WHITESPACE"," ",913],["T_STRING","_beforeSave",913],"(",")",["T_WHITESPACE","\n    ",913],"{",["T_WHITESPACE","\n        ",914],["T_STRING","parent",915],["T_DOUBLE_COLON","::",915],["T_STRING","_beforeSave",915],"(",")",";",["T_WHITESPACE","\n\n        ",915],["T_IF","if",917],["T_WHITESPACE"," ",917],"(","!",["T_VARIABLE","$this",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","getOrderId",917],"(",")",["T_WHITESPACE"," ",917],["T_BOOLEAN_AND","&&",917],["T_WHITESPACE"," ",917],["T_VARIABLE","$this",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","getOrder",917],"(",")",")",["T_WHITESPACE"," ",917],"{",["T_WHITESPACE","\n            ",917],["T_VARIABLE","$this",918],["T_OBJECT_OPERATOR","->",918],["T_STRING","setOrderId",918],"(",["T_VARIABLE","$this",918],["T_OBJECT_OPERATOR","->",918],["T_STRING","getOrder",918],"(",")",["T_OBJECT_OPERATOR","->",918],["T_STRING","getId",918],"(",")",")",";",["T_WHITESPACE","\n            ",918],["T_VARIABLE","$this",919],["T_OBJECT_OPERATOR","->",919],["T_STRING","setBillingAddressId",919],"(",["T_VARIABLE","$this",919],["T_OBJECT_OPERATOR","->",919],["T_STRING","getOrder",919],"(",")",["T_OBJECT_OPERATOR","->",919],["T_STRING","getBillingAddress",919],"(",")",["T_OBJECT_OPERATOR","->",919],["T_STRING","getId",919],"(",")",")",";",["T_WHITESPACE","\n        ",919],"}",["T_WHITESPACE","\n\n        ",920],["T_RETURN","return",922],["T_WHITESPACE"," ",922],["T_VARIABLE","$this",922],";",["T_WHITESPACE","\n    ",922],"}",["T_WHITESPACE","\n\n    ",923],["T_DOC_COMMENT","\/**\n     * Get creditmemos collection filtered by $filter\n     *\n     * @param array|null $filter\n     * @return Mage_Sales_Model_Resource_Order_Creditmemo_Collection\n     *\/",925],["T_WHITESPACE","\n    ",930],["T_PUBLIC","public",931],["T_WHITESPACE"," ",931],["T_FUNCTION","function",931],["T_WHITESPACE"," ",931],["T_STRING","getFilteredCollectionItems",931],"(",["T_VARIABLE","$filter",931],["T_WHITESPACE"," ",931],"=",["T_WHITESPACE"," ",931],["T_STRING","null",931],")",["T_WHITESPACE","\n    ",931],"{",["T_WHITESPACE","\n        ",932],["T_RETURN","return",933],["T_WHITESPACE"," ",933],["T_VARIABLE","$this",933],["T_OBJECT_OPERATOR","->",933],["T_STRING","getResourceCollection",933],"(",")",["T_OBJECT_OPERATOR","->",933],["T_STRING","getFiltered",933],"(",["T_VARIABLE","$filter",933],")",";",["T_WHITESPACE","\n    ",933],"}",["T_WHITESPACE","\n\n    ",934],["T_DOC_COMMENT","\/**\n     * Checking if the credit memo is last\n     *\n     * @return bool\n     *\/",936],["T_WHITESPACE","\n    ",940],["T_PUBLIC","public",941],["T_WHITESPACE"," ",941],["T_FUNCTION","function",941],["T_WHITESPACE"," ",941],["T_STRING","isLast",941],"(",")",["T_WHITESPACE","\n    ",941],"{",["T_WHITESPACE","\n        ",942],["T_FOREACH","foreach",943],["T_WHITESPACE"," ",943],"(",["T_VARIABLE","$this",943],["T_OBJECT_OPERATOR","->",943],["T_STRING","getAllItems",943],"(",")",["T_WHITESPACE"," ",943],["T_AS","as",943],["T_WHITESPACE"," ",943],["T_VARIABLE","$item",943],")",["T_WHITESPACE"," ",943],"{",["T_WHITESPACE","\n            ",943],["T_IF","if",944],["T_WHITESPACE"," ",944],"(","!",["T_VARIABLE","$item",944],["T_OBJECT_OPERATOR","->",944],["T_STRING","isLast",944],"(",")",")",["T_WHITESPACE"," ",944],"{",["T_WHITESPACE","\n                ",944],["T_RETURN","return",945],["T_WHITESPACE"," ",945],["T_STRING","false",945],";",["T_WHITESPACE","\n            ",945],"}",["T_WHITESPACE","\n        ",946],"}",["T_WHITESPACE","\n        ",947],["T_RETURN","return",948],["T_WHITESPACE"," ",948],["T_STRING","true",948],";",["T_WHITESPACE","\n    ",948],"}",["T_WHITESPACE","\n",949],"}",["T_WHITESPACE","\n",950]]