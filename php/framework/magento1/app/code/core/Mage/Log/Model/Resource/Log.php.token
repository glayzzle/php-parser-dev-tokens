[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Log\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Log Resource Model\n *\n * @category    Mage\n * @package     Mage_Log\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Log_Model_Resource_Log",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Init Resource model and connection\n     *\n     *\/",37],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_init",43],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Clean logs\n     *\n     * @param Mage_Log_Model_Log $object\n     * @return Mage_Log_Model_Resource_Log\n     *\/",46],["T_WHITESPACE","\n    ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","clean",52],"(",["T_STRING","Mage_Log_Model_Log",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$object",52],")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$cleanTime",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$object",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getLogCleanTime",54],"(",")",";",["T_WHITESPACE","\n\n        ",54],["T_STRING","Mage",56],["T_DOUBLE_COLON","::",56],["T_STRING","dispatchEvent",56],"(",["T_CONSTANT_ENCAPSED_STRING","'log_log_clean_before'",56],",",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",["T_WHITESPACE","\n            ",56],["T_CONSTANT_ENCAPSED_STRING","'log'",57],["T_WHITESPACE","   ",57],["T_DOUBLE_ARROW","=>",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$object",57],["T_WHITESPACE","\n        ",57],")",")",";",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_cleanVisitors",60],"(",["T_VARIABLE","$cleanTime",60],")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_cleanCustomers",61],"(",["T_VARIABLE","$cleanTime",61],")",";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","_cleanUrls",62],"(",")",";",["T_WHITESPACE","\n\n        ",62],["T_STRING","Mage",64],["T_DOUBLE_COLON","::",64],["T_STRING","dispatchEvent",64],"(",["T_CONSTANT_ENCAPSED_STRING","'log_log_clean_after'",64],",",["T_WHITESPACE"," ",64],["T_ARRAY","array",64],"(",["T_WHITESPACE","\n            ",64],["T_CONSTANT_ENCAPSED_STRING","'log'",65],["T_WHITESPACE","   ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$object",65],["T_WHITESPACE","\n        ",65],")",")",";",["T_WHITESPACE","\n\n        ",66],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Clean visitors table\n     *\n     * @param int $time\n     * @return Mage_Log_Model_Resource_Log\n     *\/",71],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","_cleanVisitors",77],"(",["T_VARIABLE","$time",77],")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$readAdapter",79],["T_WHITESPACE","    ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_getReadAdapter",79],"(",")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$writeAdapter",80],["T_WHITESPACE","   ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_getWriteAdapter",80],"(",")",";",["T_WHITESPACE","\n\n        ",80],["T_VARIABLE","$timeLimit",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","formatDate",82],"(",["T_STRING","Mage",82],["T_DOUBLE_COLON","::",82],["T_STRING","getModel",82],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","gmtTimestamp",82],"(",")",["T_WHITESPACE"," ",82],"-",["T_WHITESPACE"," ",82],["T_VARIABLE","$time",82],")",";",["T_WHITESPACE","\n\n        ",82],["T_WHILE","while",84],["T_WHITESPACE"," ",84],"(",["T_STRING","true",84],")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n            ",84],["T_VARIABLE","$select",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$readAdapter",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","select",85],"(",")",["T_WHITESPACE","\n                ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","from",86],"(",["T_WHITESPACE","\n                    ",86],["T_ARRAY","array",87],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_table'",87],["T_WHITESPACE"," ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getTable",87],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor'",87],")",")",",",["T_WHITESPACE","\n                    ",87],["T_ARRAY","array",88],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'visitor_table.visitor_id'",88],")",")",["T_WHITESPACE","\n                ",88],["T_OBJECT_OPERATOR","->",89],["T_STRING","joinLeft",89],"(",["T_WHITESPACE","\n                    ",89],["T_ARRAY","array",90],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_table'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getTable",90],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",90],")",")",",",["T_WHITESPACE","\n                    ",90],["T_CONSTANT_ENCAPSED_STRING","'visitor_table.visitor_id = customer_table.visitor_id AND customer_table.log_id IS NULL'",91],",",["T_WHITESPACE","\n                    ",91],["T_ARRAY","array",92],"(",")",")",["T_WHITESPACE","\n                ",92],["T_OBJECT_OPERATOR","->",93],["T_STRING","where",93],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_table.last_visit_at < ?'",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$timeLimit",93],")",["T_WHITESPACE","\n                ",93],["T_OBJECT_OPERATOR","->",94],["T_STRING","limit",94],"(",["T_LNUMBER","100",94],")",";",["T_WHITESPACE","\n\n            ",94],["T_VARIABLE","$visitorIds",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$readAdapter",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","fetchCol",96],"(",["T_VARIABLE","$select",96],")",";",["T_WHITESPACE","\n\n            ",96],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_VARIABLE","$visitorIds",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                ",98],["T_BREAK","break",99],";",["T_WHITESPACE","\n            ",99],"}",["T_WHITESPACE","\n\n            ",100],["T_VARIABLE","$condition",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_ARRAY","array",102],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_id IN (?)'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$visitorIds",102],")",";",["T_WHITESPACE","\n            \n            ",102],["T_COMMENT","\/\/ remove visitors from log\/quote\n",104],["T_WHITESPACE","            ",105],["T_VARIABLE","$writeAdapter",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","delete",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getTable",105],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/quote_table'",105],")",",",["T_WHITESPACE"," ",105],["T_VARIABLE","$condition",105],")",";",["T_WHITESPACE","\n\n            ",105],["T_COMMENT","\/\/ remove visitors from log\/url\n",107],["T_WHITESPACE","            ",108],["T_VARIABLE","$writeAdapter",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","delete",108],"(",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getTable",108],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_table'",108],")",",",["T_WHITESPACE"," ",108],["T_VARIABLE","$condition",108],")",";",["T_WHITESPACE","\n\n            ",108],["T_COMMENT","\/\/ remove visitors from log\/visitor_info\n",110],["T_WHITESPACE","            ",111],["T_VARIABLE","$writeAdapter",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","delete",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getTable",111],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor_info'",111],")",",",["T_WHITESPACE"," ",111],["T_VARIABLE","$condition",111],")",";",["T_WHITESPACE","\n\n            ",111],["T_COMMENT","\/\/ remove visitors from log\/visitor\n",113],["T_WHITESPACE","            ",114],["T_VARIABLE","$writeAdapter",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","delete",114],"(",["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getTable",114],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor'",114],")",",",["T_WHITESPACE"," ",114],["T_VARIABLE","$condition",114],")",";",["T_WHITESPACE","\n        ",114],"}",["T_WHITESPACE","\n\n        ",115],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],";",["T_WHITESPACE","\n    ",117],"}",["T_WHITESPACE","\n\n    ",118],["T_DOC_COMMENT","\/**\n     * Clean customer table\n     *\n     * @param int $time\n     * @return Mage_Log_Model_Resource_Log\n     *\/",120],["T_WHITESPACE","\n    ",125],["T_PROTECTED","protected",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","_cleanCustomers",126],"(",["T_VARIABLE","$time",126],")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$readAdapter",128],["T_WHITESPACE","    ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_getReadAdapter",128],"(",")",";",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$writeAdapter",129],["T_WHITESPACE","   ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_getWriteAdapter",129],"(",")",";",["T_WHITESPACE","\n\n        ",129],["T_VARIABLE","$timeLimit",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","formatDate",131],"(",["T_STRING","Mage",131],["T_DOUBLE_COLON","::",131],["T_STRING","getModel",131],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",131],")",["T_OBJECT_OPERATOR","->",131],["T_STRING","gmtTimestamp",131],"(",")",["T_WHITESPACE"," ",131],"-",["T_WHITESPACE"," ",131],["T_VARIABLE","$time",131],")",";",["T_WHITESPACE","\n\n        ",131],["T_COMMENT","\/\/ retrieve last active customer log id\n",133],["T_WHITESPACE","        ",134],["T_VARIABLE","$lastLogId",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_VARIABLE","$readAdapter",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","fetchOne",134],"(",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$readAdapter",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","select",135],"(",")",["T_WHITESPACE","\n                ",135],["T_OBJECT_OPERATOR","->",136],["T_STRING","from",136],"(",["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getTable",136],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",136],")",",",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'log_id'",136],")",["T_WHITESPACE","\n                ",136],["T_OBJECT_OPERATOR","->",137],["T_STRING","where",137],"(",["T_CONSTANT_ENCAPSED_STRING","'login_at < ?'",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$timeLimit",137],")",["T_WHITESPACE","\n                ",137],["T_OBJECT_OPERATOR","->",138],["T_STRING","order",138],"(",["T_CONSTANT_ENCAPSED_STRING","'log_id DESC'",138],")",["T_WHITESPACE","\n                ",138],["T_OBJECT_OPERATOR","->",139],["T_STRING","limit",139],"(",["T_LNUMBER","1",139],")",["T_WHITESPACE","\n        ",139],")",";",["T_WHITESPACE","\n\n        ",140],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","!",["T_VARIABLE","$lastLogId",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_RETURN","return",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n\n        ",144],["T_COMMENT","\/\/ Order by desc log_id before grouping (within-group aggregates query pattern)\n",146],["T_WHITESPACE","        ",147],["T_VARIABLE","$select",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$readAdapter",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","select",147],"(",")",["T_WHITESPACE","\n            ",147],["T_OBJECT_OPERATOR","->",148],["T_STRING","from",148],"(",["T_WHITESPACE","\n                ",148],["T_ARRAY","array",149],"(",["T_CONSTANT_ENCAPSED_STRING","'log_customer_main'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getTable",149],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",149],")",")",",",["T_WHITESPACE","\n                ",149],["T_ARRAY","array",150],"(",["T_CONSTANT_ENCAPSED_STRING","'log_id'",150],")",")",["T_WHITESPACE","\n            ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","joinLeft",151],"(",["T_WHITESPACE","\n                ",151],["T_ARRAY","array",152],"(",["T_CONSTANT_ENCAPSED_STRING","'log_customer'",152],["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getTable",152],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",152],")",")",",",["T_WHITESPACE","\n                ",152],["T_CONSTANT_ENCAPSED_STRING","'log_customer_main.customer_id = log_customer.customer_id '",153],["T_WHITESPACE","\n                    ",153],".",["T_WHITESPACE"," ",154],["T_CONSTANT_ENCAPSED_STRING","'AND log_customer_main.log_id < log_customer.log_id'",154],",",["T_WHITESPACE","\n                ",154],["T_ARRAY","array",155],"(",")",")",["T_WHITESPACE","\n            ",155],["T_OBJECT_OPERATOR","->",156],["T_STRING","where",156],"(",["T_CONSTANT_ENCAPSED_STRING","'log_customer.customer_id IS NULL'",156],")",["T_WHITESPACE","\n            ",156],["T_OBJECT_OPERATOR","->",157],["T_STRING","where",157],"(",["T_CONSTANT_ENCAPSED_STRING","'log_customer_main.log_id < ?'",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$lastLogId",157],["T_WHITESPACE"," ",157],"+",["T_WHITESPACE"," ",157],["T_LNUMBER","1",157],")",";",["T_WHITESPACE","\n\n        ",157],["T_VARIABLE","$needLogIds",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_ARRAY","array",159],"(",")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$query",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$readAdapter",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","query",160],"(",["T_VARIABLE","$select",160],")",";",["T_WHITESPACE","\n        ",160],["T_WHILE","while",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$row",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$query",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","fetch",161],"(",")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$needLogIds",162],"[",["T_VARIABLE","$row",162],"[",["T_CONSTANT_ENCAPSED_STRING","'log_id'",162],"]","]",["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_LNUMBER","1",162],";",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n\n        ",163],["T_VARIABLE","$customerLogId",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_LNUMBER","0",165],";",["T_WHITESPACE","\n        ",165],["T_WHILE","while",166],["T_WHITESPACE"," ",166],"(",["T_STRING","true",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$visitorIds",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_ARRAY","array",167],"(",")",";",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$select",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$readAdapter",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","select",168],"(",")",["T_WHITESPACE","\n                ",168],["T_OBJECT_OPERATOR","->",169],["T_STRING","from",169],"(",["T_WHITESPACE","\n                    ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getTable",170],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",170],")",",",["T_WHITESPACE","\n                    ",170],["T_ARRAY","array",171],"(",["T_CONSTANT_ENCAPSED_STRING","'log_id'",171],",",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",171],")",")",["T_WHITESPACE","\n                ",171],["T_OBJECT_OPERATOR","->",172],["T_STRING","where",172],"(",["T_CONSTANT_ENCAPSED_STRING","'log_id > ?'",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$customerLogId",172],")",["T_WHITESPACE","\n                ",172],["T_OBJECT_OPERATOR","->",173],["T_STRING","where",173],"(",["T_CONSTANT_ENCAPSED_STRING","'log_id < ?'",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$lastLogId",173],["T_WHITESPACE"," ",173],"+",["T_WHITESPACE"," ",173],["T_LNUMBER","1",173],")",["T_WHITESPACE","\n                ",173],["T_OBJECT_OPERATOR","->",174],["T_STRING","order",174],"(",["T_CONSTANT_ENCAPSED_STRING","'log_id'",174],")",["T_WHITESPACE","\n                ",174],["T_OBJECT_OPERATOR","->",175],["T_STRING","limit",175],"(",["T_LNUMBER","100",175],")",";",["T_WHITESPACE","\n\n            ",175],["T_VARIABLE","$query",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$readAdapter",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","query",177],"(",["T_VARIABLE","$select",177],")",";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$count",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_LNUMBER","0",178],";",["T_WHITESPACE","\n            ",178],["T_WHILE","while",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$row",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$query",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","fetch",179],"(",")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$count",180],["T_INC","++",180],";",["T_WHITESPACE","\n                ",180],["T_VARIABLE","$customerLogId",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$row",181],"[",["T_CONSTANT_ENCAPSED_STRING","'log_id'",181],"]",";",["T_WHITESPACE","\n                ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(","!",["T_ISSET","isset",182],"(",["T_VARIABLE","$needLogIds",182],"[",["T_VARIABLE","$row",182],"[",["T_CONSTANT_ENCAPSED_STRING","'log_id'",182],"]","]",")",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n                    ",182],["T_VARIABLE","$visitorIds",183],"[","]",["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$row",183],"[",["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",183],"]",";",["T_WHITESPACE","\n                ",183],"}",["T_WHITESPACE","\n            ",184],"}",["T_WHITESPACE","\n\n            ",185],["T_IF","if",187],["T_WHITESPACE"," ",187],"(","!",["T_VARIABLE","$count",187],")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                ",187],["T_BREAK","break",188],";",["T_WHITESPACE","\n            ",188],"}",["T_WHITESPACE","\n\n            ",189],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$visitorIds",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n                ",191],["T_VARIABLE","$condition",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_ARRAY","array",192],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_id IN (?)'",192],["T_WHITESPACE"," ",192],["T_DOUBLE_ARROW","=>",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$visitorIds",192],")",";",["T_WHITESPACE","\n\n                ",192],["T_COMMENT","\/\/ remove visitors from log\/quote\n",194],["T_WHITESPACE","                ",195],["T_VARIABLE","$writeAdapter",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","delete",195],"(",["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","getTable",195],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/quote_table'",195],")",",",["T_WHITESPACE"," ",195],["T_VARIABLE","$condition",195],")",";",["T_WHITESPACE","\n\n                ",195],["T_COMMENT","\/\/ remove visitors from log\/url\n",197],["T_WHITESPACE","                ",198],["T_VARIABLE","$writeAdapter",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","delete",198],"(",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getTable",198],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_table'",198],")",",",["T_WHITESPACE"," ",198],["T_VARIABLE","$condition",198],")",";",["T_WHITESPACE","\n\n                ",198],["T_COMMENT","\/\/ remove visitors from log\/visitor_info\n",200],["T_WHITESPACE","                ",201],["T_VARIABLE","$writeAdapter",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","delete",201],"(",["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getTable",201],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor_info'",201],")",",",["T_WHITESPACE"," ",201],["T_VARIABLE","$condition",201],")",";",["T_WHITESPACE","\n\n                ",201],["T_COMMENT","\/\/ remove visitors from log\/visitor\n",203],["T_WHITESPACE","                ",204],["T_VARIABLE","$writeAdapter",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","delete",204],"(",["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getTable",204],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor'",204],")",",",["T_WHITESPACE"," ",204],["T_VARIABLE","$condition",204],")",";",["T_WHITESPACE","\n\n                ",204],["T_COMMENT","\/\/ remove customers from log\/customer\n",206],["T_WHITESPACE","                ",207],["T_VARIABLE","$writeAdapter",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","delete",207],"(",["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getTable",207],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",207],")",",",["T_WHITESPACE"," ",207],["T_VARIABLE","$condition",207],")",";",["T_WHITESPACE","\n            ",207],"}",["T_WHITESPACE","\n\n            ",208],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$customerLogId",210],["T_WHITESPACE"," ",210],["T_IS_EQUAL","==",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$lastLogId",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n                ",210],["T_BREAK","break",211],";",["T_WHITESPACE","\n            ",211],"}",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE","\n\n        ",213],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Clean url table\n     *\n     * @return Mage_Log_Model_Resource_Log\n     *\/",218],["T_WHITESPACE","\n    ",222],["T_PROTECTED","protected",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","_cleanUrls",223],"(",")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$readAdapter",225],["T_WHITESPACE","    ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_getReadAdapter",225],"(",")",";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$writeAdapter",226],["T_WHITESPACE","   ",226],"=",["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_getWriteAdapter",226],"(",")",";",["T_WHITESPACE","\n\n        ",226],["T_WHILE","while",228],["T_WHITESPACE"," ",228],"(",["T_STRING","true",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$select",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$readAdapter",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","select",229],"(",")",["T_WHITESPACE","\n                ",229],["T_OBJECT_OPERATOR","->",230],["T_STRING","from",230],"(",["T_WHITESPACE","\n                    ",230],["T_ARRAY","array",231],"(",["T_CONSTANT_ENCAPSED_STRING","'url_info_table'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getTable",231],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_info_table'",231],")",")",",",["T_WHITESPACE","\n                    ",231],["T_ARRAY","array",232],"(",["T_CONSTANT_ENCAPSED_STRING","'url_id'",232],")",")",["T_WHITESPACE","\n                ",232],["T_OBJECT_OPERATOR","->",233],["T_STRING","joinLeft",233],"(",["T_WHITESPACE","\n                    ",233],["T_ARRAY","array",234],"(",["T_CONSTANT_ENCAPSED_STRING","'url_table'",234],["T_WHITESPACE"," ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getTable",234],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_table'",234],")",")",",",["T_WHITESPACE","\n                    ",234],["T_CONSTANT_ENCAPSED_STRING","'url_info_table.url_id = url_table.url_id'",235],",",["T_WHITESPACE","\n                    ",235],["T_ARRAY","array",236],"(",")",")",["T_WHITESPACE","\n                ",236],["T_OBJECT_OPERATOR","->",237],["T_STRING","where",237],"(",["T_CONSTANT_ENCAPSED_STRING","'url_table.url_id IS NULL'",237],")",["T_WHITESPACE","\n                ",237],["T_OBJECT_OPERATOR","->",238],["T_STRING","limit",238],"(",["T_LNUMBER","100",238],")",";",["T_WHITESPACE","\n\n            ",238],["T_VARIABLE","$urlIds",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$readAdapter",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","fetchCol",240],"(",["T_VARIABLE","$select",240],")",";",["T_WHITESPACE","\n\n            ",240],["T_IF","if",242],["T_WHITESPACE"," ",242],"(","!",["T_VARIABLE","$urlIds",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n                ",242],["T_BREAK","break",243],";",["T_WHITESPACE","\n            ",243],"}",["T_WHITESPACE","\n\n            ",244],["T_VARIABLE","$writeAdapter",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","delete",246],"(",["T_WHITESPACE","\n                ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getTable",247],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_info_table'",247],")",",",["T_WHITESPACE","\n                ",247],["T_ARRAY","array",248],"(",["T_CONSTANT_ENCAPSED_STRING","'url_id IN (?)'",248],["T_WHITESPACE"," ",248],["T_DOUBLE_ARROW","=>",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$urlIds",248],")",["T_WHITESPACE","\n            ",248],")",";",["T_WHITESPACE","\n        ",249],"}",["T_WHITESPACE","\n\n        ",250],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n",253],"}",["T_WHITESPACE","\n",254]]