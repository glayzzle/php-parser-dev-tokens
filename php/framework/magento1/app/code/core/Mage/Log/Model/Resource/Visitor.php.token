[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Log\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Visitor log resource\n *\n * @category    Mage\n * @package     Mage_Log\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Log_Model_Resource_Visitor",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Store condition object that know should we log something or not\n     *\n     * @var Mage_Log_Helper_Data\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_urlLoggingCondition",42],";",["T_WHITESPACE","\n\n    ",42],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","__construct",44],"(",["T_ARRAY","array",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$data",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_ARRAY","array",44],"(",")",")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_STRING","parent",46],["T_DOUBLE_COLON","::",46],["T_STRING","__construct",46],"(",")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_urlLoggingCondition",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_ISSET","isset",47],"(",["T_VARIABLE","$data",47],"[",["T_CONSTANT_ENCAPSED_STRING","'log_condition'",47],"]",")",["T_WHITESPACE","\n            ",47],"?",["T_WHITESPACE"," ",48],["T_VARIABLE","$data",48],"[",["T_CONSTANT_ENCAPSED_STRING","'log_condition'",48],"]",["T_WHITESPACE"," ",48],":",["T_WHITESPACE"," ",48],["T_STRING","Mage",48],["T_DOUBLE_COLON","::",48],["T_STRING","helper",48],"(",["T_CONSTANT_ENCAPSED_STRING","'log'",48],")",";",["T_WHITESPACE","\n    ",48],"}",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Define main table\n     *\n     *\/",51],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","_construct",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_init",57],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor'",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",57],")",";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Prepare data for save\n     *\n     * @param Mage_Core_Model_Abstract $visitor\n     * @return array\n     *\/",60],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_FUNCTION","function",66],["T_WHITESPACE"," ",66],["T_STRING","_prepareDataForSave",66],"(",["T_STRING","Mage_Core_Model_Abstract",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$visitor",66],")",["T_WHITESPACE","\n    ",66],"{",["T_WHITESPACE","\n        ",67],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_ARRAY","array",68],"(",["T_WHITESPACE","\n            ",68],["T_CONSTANT_ENCAPSED_STRING","'session_id'",69],["T_WHITESPACE","        ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$visitor",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getSessionId",69],"(",")",",",["T_WHITESPACE","\n            ",69],["T_CONSTANT_ENCAPSED_STRING","'first_visit_at'",70],["T_WHITESPACE","    ",70],["T_DOUBLE_ARROW","=>",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$visitor",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getFirstVisitAt",70],"(",")",",",["T_WHITESPACE","\n            ",70],["T_CONSTANT_ENCAPSED_STRING","'last_visit_at'",71],["T_WHITESPACE","     ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$visitor",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getLastVisitAt",71],"(",")",",",["T_WHITESPACE","\n            ",71],["T_CONSTANT_ENCAPSED_STRING","'last_url_id'",72],["T_WHITESPACE","       ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$visitor",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getLastUrlId",72],"(",")",["T_WHITESPACE"," ",72],"?",["T_WHITESPACE"," ",72],["T_VARIABLE","$visitor",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getLastUrlId",72],"(",")",["T_WHITESPACE"," ",72],":",["T_WHITESPACE"," ",72],["T_LNUMBER","0",72],",",["T_WHITESPACE","\n            ",72],["T_CONSTANT_ENCAPSED_STRING","'store_id'",73],["T_WHITESPACE","          ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_STRING","Mage",73],["T_DOUBLE_COLON","::",73],["T_STRING","app",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getStore",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getId",73],"(",")",",",["T_WHITESPACE","\n        ",73],")",";",["T_WHITESPACE","\n    ",74],"}",["T_WHITESPACE","\n\n    ",75],["T_DOC_COMMENT","\/**\n     * Saving information about url\n     *\n     * @param   Mage_Log_Model_Visitor $visitor\n     * @return  Mage_Log_Model_Resource_Visitor\n     *\/",77],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","_saveUrlInfo",83],"(",["T_VARIABLE","$visitor",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$adapter",85],["T_WHITESPACE","    ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_getWriteAdapter",85],"(",")",";",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$data",86],["T_WHITESPACE","       ",86],"=",["T_WHITESPACE"," ",86],["T_NEW","new",86],["T_WHITESPACE"," ",86],["T_STRING","Varien_Object",86],"(",["T_ARRAY","array",86],"(",["T_WHITESPACE","\n            ",86],["T_CONSTANT_ENCAPSED_STRING","'url'",87],["T_WHITESPACE","    ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","helper",87],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/string'",87],")",["T_OBJECT_OPERATOR","->",87],["T_STRING","substr",87],"(",["T_VARIABLE","$visitor",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getUrl",87],"(",")",",",["T_WHITESPACE"," ",87],["T_LNUMBER","0",87],",",["T_WHITESPACE"," ",87],["T_LNUMBER","250",87],")",",",["T_WHITESPACE","\n            ",87],["T_CONSTANT_ENCAPSED_STRING","'referer'",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_STRING","Mage",88],["T_DOUBLE_COLON","::",88],["T_STRING","helper",88],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/string'",88],")",["T_OBJECT_OPERATOR","->",88],["T_STRING","substr",88],"(",["T_VARIABLE","$visitor",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getHttpReferer",88],"(",")",",",["T_WHITESPACE"," ",88],["T_LNUMBER","0",88],",",["T_WHITESPACE"," ",88],["T_LNUMBER","250",88],")",["T_WHITESPACE","\n        ",88],")",")",";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$bind",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_prepareDataForTable",90],"(",["T_VARIABLE","$data",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getTable",90],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_info_table'",90],")",")",";",["T_WHITESPACE","\n\n        ",90],["T_VARIABLE","$adapter",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","insert",92],"(",["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTable",92],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_info_table'",92],")",",",["T_WHITESPACE"," ",92],["T_VARIABLE","$bind",92],")",";",["T_WHITESPACE","\n\n        ",92],["T_VARIABLE","$visitor",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","setLastUrlId",94],"(",["T_VARIABLE","$adapter",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","lastInsertId",94],"(",["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getTable",94],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_info_table'",94],")",")",")",";",["T_WHITESPACE","\n\n        ",94],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Save url info before save\n     *\n     * @param Mage_Core_Model_Abstract $visitor\n     * @return Mage_Log_Model_Resource_Visitor\n     *\/",99],["T_WHITESPACE","\n    ",104],["T_PROTECTED","protected",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","_beforeSave",105],"(",["T_STRING","Mage_Core_Model_Abstract",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$visitor",105],")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_IF","if",107],["T_WHITESPACE"," ",107],"(","!",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_urlLoggingCondition",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","isLogEnabled",107],"(",")",")",["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n            ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(","!",["T_VARIABLE","$visitor",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getIsNewVisitor",110],"(",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_saveUrlInfo",111],"(",["T_VARIABLE","$visitor",111],")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n        ",112],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Actions after save\n     *\n     * @param Mage_Core_Model_Abstract $visitor\n     * @return Mage_Log_Model_Resource_Visitor\n     *\/",116],["T_WHITESPACE","\n    ",121],["T_PROTECTED","protected",122],["T_WHITESPACE"," ",122],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","_afterSave",122],"(",["T_STRING","Mage_Core_Model_Abstract",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$visitor",122],")",["T_WHITESPACE","\n    ",122],"{",["T_WHITESPACE","\n        ",123],["T_IF","if",124],["T_WHITESPACE"," ",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_urlLoggingCondition",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","isLogDisabled",124],"(",")",")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n        ",126],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$visitor",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getIsNewVisitor",127],"(",")",")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_urlLoggingCondition",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","isVisitorLogEnabled",128],"(",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_saveVisitorInfo",129],"(",["T_VARIABLE","$visitor",129],")",";",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$visitor",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","setIsNewVisitor",130],"(",["T_STRING","false",130],")",";",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE"," ",132],["T_ELSE","else",132],["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_urlLoggingCondition",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","isLogEnabled",133],"(",")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n                ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_saveVisitorUrl",134],"(",["T_VARIABLE","$visitor",134],")",";",["T_WHITESPACE","\n                ",134],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$visitor",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getDoCustomerLogin",135],"(",")",["T_WHITESPACE"," ",135],["T_BOOLEAN_OR","||",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$visitor",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getDoCustomerLogout",135],"(",")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                    ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_saveCustomerInfo",136],"(",["T_VARIABLE","$visitor",136],")",";",["T_WHITESPACE","\n                ",136],"}",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n            ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_urlLoggingCondition",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","isVisitorLogEnabled",139],"(",")",")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_IF","if",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$visitor",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getDoQuoteCreate",140],"(",")",["T_WHITESPACE"," ",140],["T_BOOLEAN_OR","||",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$visitor",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getDoQuoteDestroy",140],"(",")",")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                    ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_saveQuoteInfo",141],"(",["T_VARIABLE","$visitor",141],")",";",["T_WHITESPACE","\n                ",141],"}",["T_WHITESPACE","\n            ",142],"}",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Perform actions after object load\n     *\n     * @param Mage_Core_Model_Abstract $object\n     * @return Mage_Core_Model_Resource_Db_Abstract\n     *\/",148],["T_WHITESPACE","\n    ",153],["T_PROTECTED","protected",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","_afterLoad",154],"(",["T_STRING","Mage_Core_Model_Abstract",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$object",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_STRING","parent",156],["T_DOUBLE_COLON","::",156],["T_STRING","_afterLoad",156],"(",["T_VARIABLE","$object",156],")",";",["T_WHITESPACE","\n        ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_urlLoggingCondition",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","isLogDisabled",157],"(",")",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n        ",159],["T_COMMENT","\/\/ Add information about quote to visitor\n",160],["T_WHITESPACE","        ",161],["T_VARIABLE","$adapter",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_getReadAdapter",161],"(",")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$select",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$adapter",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","select",162],"(",")",["T_OBJECT_OPERATOR","->",162],["T_STRING","from",162],"(",["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getTable",162],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/quote_table'",162],")",",",["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","'quote_id'",162],")",["T_WHITESPACE","\n            ",162],["T_OBJECT_OPERATOR","->",163],["T_STRING","where",163],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_id = ?'",163],",",["T_WHITESPACE"," ",163],["T_VARIABLE","$object",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getId",163],"(",")",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","order",163],"(",["T_CONSTANT_ENCAPSED_STRING","'quote_id DESC'",163],")",["T_OBJECT_OPERATOR","->",163],["T_STRING","limit",163],"(",["T_LNUMBER","1",163],")",";",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$result",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$adapter",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","query",164],"(",["T_VARIABLE","$select",164],")",["T_OBJECT_OPERATOR","->",164],["T_STRING","fetch",164],"(",")",";",["T_WHITESPACE","\n        ",164],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_ISSET","isset",165],"(",["T_VARIABLE","$result",165],"[",["T_CONSTANT_ENCAPSED_STRING","'quote_id'",165],"]",")",")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$object",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","setQuoteId",166],"(",["T_INT_CAST","(int)",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$result",166],"[",["T_CONSTANT_ENCAPSED_STRING","'quote_id'",166],"]",")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Saving visitor information\n     *\n     * @param   Mage_Log_Model_Visitor $visitor\n     * @return  Mage_Log_Model_Resource_Visitor\n     *\/",171],["T_WHITESPACE","\n    ",176],["T_PROTECTED","protected",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","_saveVisitorInfo",177],"(",["T_VARIABLE","$visitor",177],")",["T_WHITESPACE","\n    ",177],"{",["T_WHITESPACE","\n        ",178],["T_COMMENT","\/* @var $stringHelper Mage_Core_Helper_String *\/",179],["T_WHITESPACE","\n        ",179],["T_VARIABLE","$stringHelper",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","Mage",180],["T_DOUBLE_COLON","::",180],["T_STRING","helper",180],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/string'",180],")",";",["T_WHITESPACE","\n\n        ",180],["T_VARIABLE","$referer",182],["T_WHITESPACE","    ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$stringHelper",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","cleanString",182],"(",["T_VARIABLE","$visitor",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getHttpReferer",182],"(",")",")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$referer",183],["T_WHITESPACE","    ",183],"=",["T_WHITESPACE"," ",183],["T_VARIABLE","$stringHelper",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","substr",183],"(",["T_VARIABLE","$referer",183],",",["T_WHITESPACE"," ",183],["T_LNUMBER","0",183],",",["T_WHITESPACE"," ",183],["T_LNUMBER","255",183],")",";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$userAgent",184],["T_WHITESPACE","  ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$stringHelper",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","cleanString",184],"(",["T_VARIABLE","$visitor",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getHttpUserAgent",184],"(",")",")",";",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$userAgent",185],["T_WHITESPACE","  ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$stringHelper",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","substr",185],"(",["T_VARIABLE","$userAgent",185],",",["T_WHITESPACE"," ",185],["T_LNUMBER","0",185],",",["T_WHITESPACE"," ",185],["T_LNUMBER","255",185],")",";",["T_WHITESPACE","\n        ",185],["T_VARIABLE","$charset",186],["T_WHITESPACE","    ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$stringHelper",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","cleanString",186],"(",["T_VARIABLE","$visitor",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getHttpAcceptCharset",186],"(",")",")",";",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$charset",187],["T_WHITESPACE","    ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$stringHelper",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","substr",187],"(",["T_VARIABLE","$charset",187],",",["T_WHITESPACE"," ",187],["T_LNUMBER","0",187],",",["T_WHITESPACE"," ",187],["T_LNUMBER","255",187],")",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$language",188],["T_WHITESPACE","   ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$stringHelper",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","cleanString",188],"(",["T_VARIABLE","$visitor",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getHttpAcceptLanguage",188],"(",")",")",";",["T_WHITESPACE","\n        ",188],["T_VARIABLE","$language",189],["T_WHITESPACE","   ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$stringHelper",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","substr",189],"(",["T_VARIABLE","$language",189],",",["T_WHITESPACE"," ",189],["T_LNUMBER","0",189],",",["T_WHITESPACE"," ",189],["T_LNUMBER","255",189],")",";",["T_WHITESPACE","\n\n        ",189],["T_VARIABLE","$adapter",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_getWriteAdapter",191],"(",")",";",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$data",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_NEW","new",192],["T_WHITESPACE"," ",192],["T_STRING","Varien_Object",192],"(",["T_ARRAY","array",192],"(",["T_WHITESPACE","\n            ",192],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",193],["T_WHITESPACE","            ",193],["T_DOUBLE_ARROW","=>",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$visitor",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getId",193],"(",")",",",["T_WHITESPACE","\n            ",193],["T_CONSTANT_ENCAPSED_STRING","'http_referer'",194],["T_WHITESPACE","          ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$referer",194],",",["T_WHITESPACE","\n            ",194],["T_CONSTANT_ENCAPSED_STRING","'http_user_agent'",195],["T_WHITESPACE","       ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$userAgent",195],",",["T_WHITESPACE","\n            ",195],["T_CONSTANT_ENCAPSED_STRING","'http_accept_charset'",196],["T_WHITESPACE","   ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$charset",196],",",["T_WHITESPACE","\n            ",196],["T_CONSTANT_ENCAPSED_STRING","'http_accept_language'",197],["T_WHITESPACE","  ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$language",197],",",["T_WHITESPACE","\n            ",197],["T_CONSTANT_ENCAPSED_STRING","'server_addr'",198],["T_WHITESPACE","           ",198],["T_DOUBLE_ARROW","=>",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$visitor",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getServerAddr",198],"(",")",",",["T_WHITESPACE","\n            ",198],["T_CONSTANT_ENCAPSED_STRING","'remote_addr'",199],["T_WHITESPACE","           ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$visitor",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getRemoteAddr",199],"(",")",",",["T_WHITESPACE","\n        ",199],")",")",";",["T_WHITESPACE","\n        ",200],["T_VARIABLE","$bind",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_prepareDataForTable",201],"(",["T_VARIABLE","$data",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getTable",201],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor_info'",201],")",")",";",["T_WHITESPACE","\n\n        ",201],["T_VARIABLE","$adapter",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","insert",203],"(",["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getTable",203],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor_info'",203],")",",",["T_WHITESPACE"," ",203],["T_VARIABLE","$bind",203],")",";",["T_WHITESPACE","\n        ",203],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Saving visitor and url relation\n     *\n     * @param   Mage_Log_Model_Visitor $visitor\n     * @return  Mage_Log_Model_Resource_Visitor\n     *\/",207],["T_WHITESPACE","\n    ",212],["T_PROTECTED","protected",213],["T_WHITESPACE"," ",213],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","_saveVisitorUrl",213],"(",["T_VARIABLE","$visitor",213],")",["T_WHITESPACE","\n    ",213],"{",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$data",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_NEW","new",215],["T_WHITESPACE"," ",215],["T_STRING","Varien_Object",215],"(",["T_ARRAY","array",215],"(",["T_WHITESPACE","\n            ",215],["T_CONSTANT_ENCAPSED_STRING","'url_id'",216],["T_WHITESPACE","        ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$visitor",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getLastUrlId",216],"(",")",",",["T_WHITESPACE","\n            ",216],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",217],["T_WHITESPACE","    ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$visitor",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getId",217],"(",")",",",["T_WHITESPACE","\n            ",217],["T_CONSTANT_ENCAPSED_STRING","'visit_time'",218],["T_WHITESPACE","    ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_STRING","Mage",218],["T_DOUBLE_COLON","::",218],["T_STRING","getSingleton",218],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",218],")",["T_OBJECT_OPERATOR","->",218],["T_STRING","gmtDate",218],"(",")",["T_WHITESPACE","\n        ",218],")",")",";",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$bind",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_prepareDataForTable",220],"(",["T_VARIABLE","$data",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getTable",220],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_table'",220],")",")",";",["T_WHITESPACE","\n\n        ",220],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","_getWriteAdapter",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","insert",222],"(",["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getTable",222],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/url_table'",222],")",",",["T_WHITESPACE"," ",222],["T_VARIABLE","$bind",222],")",";",["T_WHITESPACE","\n        ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Saving information about customer\n     *\n     * @param   Mage_Log_Model_Visitor $visitor\n     * @return  Mage_Log_Model_Resource_Visitor\n     *\/",226],["T_WHITESPACE","\n    ",231],["T_PROTECTED","protected",232],["T_WHITESPACE"," ",232],["T_FUNCTION","function",232],["T_WHITESPACE"," ",232],["T_STRING","_saveCustomerInfo",232],"(",["T_VARIABLE","$visitor",232],")",["T_WHITESPACE","\n    ",232],"{",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$adapter",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_getWriteAdapter",234],"(",")",";",["T_WHITESPACE","\n\n        ",234],["T_IF","if",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$visitor",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getDoCustomerLogin",236],"(",")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$data",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_NEW","new",237],["T_WHITESPACE"," ",237],["T_STRING","Varien_Object",237],"(",["T_ARRAY","array",237],"(",["T_WHITESPACE","\n                ",237],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",238],["T_WHITESPACE","    ",238],["T_DOUBLE_ARROW","=>",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$visitor",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getVisitorId",238],"(",")",",",["T_WHITESPACE","\n                ",238],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",239],["T_WHITESPACE","   ",239],["T_DOUBLE_ARROW","=>",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$visitor",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getCustomerId",239],"(",")",",",["T_WHITESPACE","\n                ",239],["T_CONSTANT_ENCAPSED_STRING","'login_at'",240],["T_WHITESPACE","      ",240],["T_DOUBLE_ARROW","=>",240],["T_WHITESPACE"," ",240],["T_STRING","Mage",240],["T_DOUBLE_COLON","::",240],["T_STRING","getSingleton",240],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",240],")",["T_OBJECT_OPERATOR","->",240],["T_STRING","gmtDate",240],"(",")",",",["T_WHITESPACE","\n                ",240],["T_CONSTANT_ENCAPSED_STRING","'store_id'",241],["T_WHITESPACE","      ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_STRING","Mage",241],["T_DOUBLE_COLON","::",241],["T_STRING","app",241],"(",")",["T_OBJECT_OPERATOR","->",241],["T_STRING","getStore",241],"(",")",["T_OBJECT_OPERATOR","->",241],["T_STRING","getId",241],"(",")",["T_WHITESPACE","\n            ",241],")",")",";",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$bind",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_prepareDataForTable",243],"(",["T_VARIABLE","$data",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","getTable",243],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",243],")",")",";",["T_WHITESPACE","\n\n            ",243],["T_VARIABLE","$adapter",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","insert",245],"(",["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getTable",245],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",245],")",",",["T_WHITESPACE"," ",245],["T_VARIABLE","$bind",245],")",";",["T_WHITESPACE","\n            ",245],["T_VARIABLE","$visitor",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","setCustomerLogId",246],"(",["T_VARIABLE","$adapter",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","lastInsertId",246],"(",["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getTable",246],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",246],")",")",")",";",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$visitor",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","setDoCustomerLogin",247],"(",["T_STRING","false",247],")",";",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE","\n\n        ",248],["T_IF","if",250],["T_WHITESPACE"," ",250],"(",["T_VARIABLE","$visitor",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getDoCustomerLogout",250],"(",")",["T_WHITESPACE"," ",250],["T_BOOLEAN_AND","&&",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$logId",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$visitor",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getCustomerLogId",250],"(",")",")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n            ",250],["T_VARIABLE","$data",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_NEW","new",251],["T_WHITESPACE"," ",251],["T_STRING","Varien_Object",251],"(",["T_ARRAY","array",251],"(",["T_WHITESPACE","\n                ",251],["T_CONSTANT_ENCAPSED_STRING","'logout_at'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_STRING","Mage",252],["T_DOUBLE_COLON","::",252],["T_STRING","getSingleton",252],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",252],")",["T_OBJECT_OPERATOR","->",252],["T_STRING","gmtDate",252],"(",")",",",["T_WHITESPACE","\n                ",252],["T_CONSTANT_ENCAPSED_STRING","'store_id'",253],["T_WHITESPACE","  ",253],["T_DOUBLE_ARROW","=>",253],["T_WHITESPACE"," ",253],["T_INT_CAST","(int)",253],["T_STRING","Mage",253],["T_DOUBLE_COLON","::",253],["T_STRING","app",253],"(",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","getStore",253],"(",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","getId",253],"(",")",",",["T_WHITESPACE","\n            ",253],")",")",";",["T_WHITESPACE","\n\n            ",254],["T_VARIABLE","$bind",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_prepareDataForTable",256],"(",["T_VARIABLE","$data",256],",",["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getTable",256],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",256],")",")",";",["T_WHITESPACE","\n\n            ",256],["T_VARIABLE","$condition",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_ARRAY","array",258],"(",["T_WHITESPACE","\n                ",258],["T_CONSTANT_ENCAPSED_STRING","'log_id = ?'",259],["T_WHITESPACE"," ",259],["T_DOUBLE_ARROW","=>",259],["T_WHITESPACE"," ",259],["T_INT_CAST","(int)",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$logId",259],",",["T_WHITESPACE","\n            ",259],")",";",["T_WHITESPACE","\n\n            ",260],["T_VARIABLE","$adapter",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","update",262],"(",["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getTable",262],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/customer'",262],")",",",["T_WHITESPACE"," ",262],["T_VARIABLE","$bind",262],",",["T_WHITESPACE"," ",262],["T_VARIABLE","$condition",262],")",";",["T_WHITESPACE","\n\n            ",262],["T_VARIABLE","$visitor",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","setDoCustomerLogout",264],"(",["T_STRING","false",264],")",";",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$visitor",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","setCustomerId",265],"(",["T_STRING","null",265],")",";",["T_WHITESPACE","\n            ",265],["T_VARIABLE","$visitor",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","setCustomerLogId",266],"(",["T_STRING","null",266],")",";",["T_WHITESPACE","\n        ",266],"}",["T_WHITESPACE","\n\n        ",267],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],";",["T_WHITESPACE","\n    ",269],"}",["T_WHITESPACE","\n\n    ",270],["T_DOC_COMMENT","\/**\n     * Saving information about quote\n     *\n     * @param   Mage_Log_Model_Visitor $visitor\n     * @return  Mage_Log_Model_Resource_Visitor\n     *\/",272],["T_WHITESPACE","\n    ",277],["T_PROTECTED","protected",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","_saveQuoteInfo",278],"(",["T_VARIABLE","$visitor",278],")",["T_WHITESPACE","\n    ",278],"{",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$adapter",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","_getWriteAdapter",280],"(",")",";",["T_WHITESPACE","\n        ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$visitor",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getDoQuoteCreate",281],"(",")",")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n            ",281],["T_VARIABLE","$data",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_NEW","new",282],["T_WHITESPACE"," ",282],["T_STRING","Varien_Object",282],"(",["T_ARRAY","array",282],"(",["T_WHITESPACE","\n                ",282],["T_CONSTANT_ENCAPSED_STRING","'quote_id'",283],["T_WHITESPACE","      ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_INT_CAST","(int)",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$visitor",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","getQuoteId",283],"(",")",",",["T_WHITESPACE","\n                ",283],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",284],["T_WHITESPACE","    ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_INT_CAST","(int)",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$visitor",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","getId",284],"(",")",",",["T_WHITESPACE","\n                ",284],["T_CONSTANT_ENCAPSED_STRING","'created_at'",285],["T_WHITESPACE","    ",285],["T_DOUBLE_ARROW","=>",285],["T_WHITESPACE"," ",285],["T_STRING","Mage",285],["T_DOUBLE_COLON","::",285],["T_STRING","getSingleton",285],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",285],")",["T_OBJECT_OPERATOR","->",285],["T_STRING","gmtDate",285],"(",")",["T_WHITESPACE","\n            ",285],")",")",";",["T_WHITESPACE","\n\n            ",286],["T_VARIABLE","$bind",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_prepareDataForTable",288],"(",["T_VARIABLE","$data",288],",",["T_WHITESPACE"," ",288],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","getTable",288],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/quote_table'",288],")",")",";",["T_WHITESPACE","\n\n            ",288],["T_VARIABLE","$adapter",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","insert",290],"(",["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getTable",290],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/quote_table'",290],")",",",["T_WHITESPACE"," ",290],["T_VARIABLE","$bind",290],")",";",["T_WHITESPACE","\n\n            ",290],["T_VARIABLE","$visitor",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","setDoQuoteCreate",292],"(",["T_STRING","false",292],")",";",["T_WHITESPACE","\n        ",292],"}",["T_WHITESPACE","\n\n        ",293],["T_IF","if",295],["T_WHITESPACE"," ",295],"(",["T_VARIABLE","$visitor",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getDoQuoteDestroy",295],"(",")",")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_DOC_COMMENT","\/**\n             * We have delete quote from log because if original quote was\n             * deleted and Mysql restarted we will get key duplication error\n             *\/",296],["T_WHITESPACE","\n            ",299],["T_VARIABLE","$condition",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_ARRAY","array",300],"(",["T_WHITESPACE","\n                ",300],["T_CONSTANT_ENCAPSED_STRING","'quote_id = ?'",301],["T_WHITESPACE"," ",301],["T_DOUBLE_ARROW","=>",301],["T_WHITESPACE"," ",301],["T_INT_CAST","(int)",301],["T_WHITESPACE"," ",301],["T_VARIABLE","$visitor",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getQuoteId",301],"(",")",",",["T_WHITESPACE","\n            ",301],")",";",["T_WHITESPACE","\n\n            ",302],["T_VARIABLE","$adapter",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","delete",304],"(",["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getTable",304],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/quote_table'",304],")",",",["T_WHITESPACE"," ",304],["T_VARIABLE","$condition",304],")",";",["T_WHITESPACE","\n\n            ",304],["T_VARIABLE","$visitor",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","setDoQuoteDestroy",306],"(",["T_STRING","false",306],")",";",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$visitor",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","setQuoteId",307],"(",["T_STRING","null",307],")",";",["T_WHITESPACE","\n        ",307],"}",["T_WHITESPACE","\n        ",308],["T_RETURN","return",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],";",["T_WHITESPACE","\n    ",309],"}",["T_WHITESPACE","\n",310],"}",["T_WHITESPACE","\n",311]]