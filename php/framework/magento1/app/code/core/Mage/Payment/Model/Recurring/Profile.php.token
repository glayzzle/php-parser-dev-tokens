[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Payment\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Recurring payment profile\n * Extends from Mage_Core_Abstract for a reason: to make descendants have its own resource\n *\/",27],["T_WHITESPACE","\n",30],["T_CLASS","class",31],["T_WHITESPACE"," ",31],["T_STRING","Mage_Payment_Model_Recurring_Profile",31],["T_WHITESPACE"," ",31],["T_EXTENDS","extends",31],["T_WHITESPACE"," ",31],["T_STRING","Mage_Core_Model_Abstract",31],["T_WHITESPACE","\n",31],"{",["T_WHITESPACE","\n    ",32],["T_DOC_COMMENT","\/**\n     * Constants for passing data through catalog\n     *\n     * @var string\n     *\/",33],["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","BUY_REQUEST_START_DATETIME",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'recurring_profile_start_datetime'",38],";",["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","PRODUCT_OPTIONS_KEY",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'recurring_profile_options'",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Period units\n     *\n     * @var string\n     *\/",41],["T_WHITESPACE","\n    ",45],["T_CONST","const",46],["T_WHITESPACE"," ",46],["T_STRING","PERIOD_UNIT_DAY",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'day'",46],";",["T_WHITESPACE","\n    ",46],["T_CONST","const",47],["T_WHITESPACE"," ",47],["T_STRING","PERIOD_UNIT_WEEK",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'week'",47],";",["T_WHITESPACE","\n    ",47],["T_CONST","const",48],["T_WHITESPACE"," ",48],["T_STRING","PERIOD_UNIT_SEMI_MONTH",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'semi_month'",48],";",["T_WHITESPACE","\n    ",48],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","PERIOD_UNIT_MONTH",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'month'",49],";",["T_WHITESPACE","\n    ",49],["T_CONST","const",50],["T_WHITESPACE"," ",50],["T_STRING","PERIOD_UNIT_YEAR",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'year'",50],";",["T_WHITESPACE","\n\n    ",50],["T_DOC_COMMENT","\/**\n     * Errors collected during validation\n     *\n     * @var array\n     *\/",52],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$_errors",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_ARRAY","array",57],"(",")",";",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     *\n     * @var Mage_Payment_Model_Method_Abstract\n     *\/",59],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_methodInstance",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","null",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Locale instance used for importing\/exporting data\n     *\n     * @var Mage_Core_Model_Locale\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_locale",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_STRING","null",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Store instance used by locale or method instance\n     *\n     * @var Mage_Core_Model_Store\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_store",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","null",77],";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Payment methods reference\n     *\n     * @var array\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$_paymentMethods",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_ARRAY","array",84],"(",")",";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Check whether the object data is valid\n     * Returns true if valid.\n     *\n     * @return bool\n     *\/",86],["T_WHITESPACE","\n    ",91],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","isValid",92],"(",")",["T_WHITESPACE","\n    ",92],"{",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_filterValues",94],"(",")",";",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_errors",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_ARRAY","array",95],"(",")",";",["T_WHITESPACE","\n\n        ",95],["T_COMMENT","\/\/ start date, order ref ID, schedule description\n",97],["T_WHITESPACE","        ",98],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getStartDatetime",98],"(",")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_errors",99],"[",["T_CONSTANT_ENCAPSED_STRING","'start_datetime'",99],"]","[","]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","helper",99],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",99],")",["T_OBJECT_OPERATOR","->",99],["T_STRING","__",99],"(",["T_CONSTANT_ENCAPSED_STRING","'Start date is undefined.'",99],")",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE"," ",100],["T_ELSEIF","elseif",100],["T_WHITESPACE"," ",100],"(","!",["T_STRING","Zend_Date",100],["T_DOUBLE_COLON","::",100],["T_STRING","isDate",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getStartDatetime",100],"(",")",",",["T_WHITESPACE"," ",100],["T_STRING","Varien_Date",100],["T_DOUBLE_COLON","::",100],["T_STRING","DATETIME_INTERNAL_FORMAT",100],")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_errors",101],"[",["T_CONSTANT_ENCAPSED_STRING","'start_datetime'",101],"]","[","]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","Mage",101],["T_DOUBLE_COLON","::",101],["T_STRING","helper",101],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",101],")",["T_OBJECT_OPERATOR","->",101],["T_STRING","__",101],"(",["T_CONSTANT_ENCAPSED_STRING","'Start date has invalid format.'",101],")",";",["T_WHITESPACE","\n        ",101],"}",["T_WHITESPACE","\n        ",102],["T_IF","if",103],["T_WHITESPACE"," ",103],"(","!",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getScheduleDescription",103],"(",")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","_errors",104],"[",["T_CONSTANT_ENCAPSED_STRING","'schedule_description'",104],"]","[","]",["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_STRING","Mage",104],["T_DOUBLE_COLON","::",104],["T_STRING","helper",104],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",104],")",["T_OBJECT_OPERATOR","->",104],["T_STRING","__",104],"(",["T_CONSTANT_ENCAPSED_STRING","'Schedule description must be not empty.'",104],")",";",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n\n        ",105],["T_COMMENT","\/\/ period unit and frequency\n",107],["T_WHITESPACE","        ",108],["T_IF","if",108],["T_WHITESPACE"," ",108],"(","!",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getPeriodUnit",108],"(",")",["T_WHITESPACE"," ",108],["T_BOOLEAN_OR","||",108],["T_WHITESPACE"," ",108],"!",["T_STRING","in_array",108],"(",["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getPeriodUnit",108],"(",")",",",["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getAllPeriodUnits",108],"(",["T_STRING","false",108],")",",",["T_WHITESPACE"," ",108],["T_STRING","true",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_errors",109],"[",["T_CONSTANT_ENCAPSED_STRING","'period_unit'",109],"]","[","]",["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_STRING","Mage",109],["T_DOUBLE_COLON","::",109],["T_STRING","helper",109],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",109],")",["T_OBJECT_OPERATOR","->",109],["T_STRING","__",109],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing period unit is not defined or wrong.'",109],")",";",["T_WHITESPACE","\n        ",109],"}",["T_WHITESPACE","\n        ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getPeriodFrequency",111],"(",")",["T_WHITESPACE"," ",111],["T_BOOLEAN_AND","&&",111],["T_WHITESPACE"," ",111],"!",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_validatePeriodFrequency",111],"(",["T_CONSTANT_ENCAPSED_STRING","'period_unit'",111],",",["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'period_frequency'",111],")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_errors",112],"[",["T_CONSTANT_ENCAPSED_STRING","'period_frequency'",112],"]","[","]",["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","Mage",112],["T_DOUBLE_COLON","::",112],["T_STRING","helper",112],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",112],")",["T_OBJECT_OPERATOR","->",112],["T_STRING","__",112],"(",["T_CONSTANT_ENCAPSED_STRING","'Period frequency is wrong.'",112],")",";",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n        ",113],["T_COMMENT","\/\/ trial period unit, trial frequency, trial period max cycles, trial billing amount\n",115],["T_WHITESPACE","        ",116],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getTrialPeriodUnit",116],"(",")",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(","!",["T_STRING","in_array",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getTrialPeriodUnit",117],"(",")",",",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getAllPeriodUnits",117],"(",["T_STRING","false",117],")",",",["T_WHITESPACE"," ",117],["T_STRING","true",117],")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n                ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_errors",118],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_period_unit'",118],"]","[","]",["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","helper",118],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",118],")",["T_OBJECT_OPERATOR","->",118],["T_STRING","__",118],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial billing period unit is wrong.'",118],")",";",["T_WHITESPACE","\n            ",118],"}",["T_WHITESPACE","\n            ",119],["T_IF","if",120],["T_WHITESPACE"," ",120],"(","!",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getTrialPeriodFrequency",120],"(",")",["T_WHITESPACE"," ",120],["T_BOOLEAN_OR","||",120],["T_WHITESPACE"," ",120],"!",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_validatePeriodFrequency",120],"(",["T_CONSTANT_ENCAPSED_STRING","'trial_period_unit'",120],",",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'trial_period_frequency'",120],")",")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n                ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_errors",121],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_period_frequency'",121],"]","[","]",["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_STRING","Mage",121],["T_DOUBLE_COLON","::",121],["T_STRING","helper",121],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",121],")",["T_OBJECT_OPERATOR","->",121],["T_STRING","__",121],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial period frequency is wrong.'",121],")",";",["T_WHITESPACE","\n            ",121],"}",["T_WHITESPACE","\n            ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(","!",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getTrialPeriodMaxCycles",123],"(",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_errors",124],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_period_max_cycles'",124],"]","[","]",["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","Mage",124],["T_DOUBLE_COLON","::",124],["T_STRING","helper",124],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",124],")",["T_OBJECT_OPERATOR","->",124],["T_STRING","__",124],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial period max cycles is wrong.'",124],")",";",["T_WHITESPACE","\n            ",124],"}",["T_WHITESPACE","\n            ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(","!",["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getTrialBillingAmount",126],"(",")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                ",126],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_errors",127],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_billing_amount'",127],"]","[","]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","helper",127],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",127],")",["T_OBJECT_OPERATOR","->",127],["T_STRING","__",127],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial billing amount is wrong.'",127],")",";",["T_WHITESPACE","\n            ",127],"}",["T_WHITESPACE","\n        ",128],"}",["T_WHITESPACE","\n\n        ",129],["T_COMMENT","\/\/ billing and other amounts\n",131],["T_WHITESPACE","        ",132],["T_IF","if",132],["T_WHITESPACE"," ",132],"(","!",["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getBillingAmount",132],"(",")",["T_WHITESPACE"," ",132],["T_BOOLEAN_OR","||",132],["T_WHITESPACE"," ",132],["T_LNUMBER","0",132],["T_WHITESPACE"," ",132],["T_IS_GREATER_OR_EQUAL",">=",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getBillingAmount",132],"(",")",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_errors",133],"[",["T_CONSTANT_ENCAPSED_STRING","'billing_amount'",133],"]","[","]",["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_STRING","Mage",133],["T_DOUBLE_COLON","::",133],["T_STRING","helper",133],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",133],")",["T_OBJECT_OPERATOR","->",133],["T_STRING","__",133],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong or empty billing amount specified.'",133],")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n        ",134],["T_FOREACH","foreach",135],["T_WHITESPACE"," ",135],"(",["T_ARRAY","array",135],"(",["T_CONSTANT_ENCAPSED_STRING","'trial_billing_abount'",135],",",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'shipping_amount'",135],",",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",135],",",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'init_amount'",135],")",["T_WHITESPACE"," ",135],["T_AS","as",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$key",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n            ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","hasData",136],"(",["T_VARIABLE","$key",136],")",["T_WHITESPACE"," ",136],["T_BOOLEAN_AND","&&",136],["T_WHITESPACE"," ",136],["T_LNUMBER","0",136],["T_WHITESPACE"," ",136],["T_IS_GREATER_OR_EQUAL",">=",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getData",136],"(",["T_VARIABLE","$key",136],")",")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_errors",137],"[",["T_VARIABLE","$key",137],"]","[","]",["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_STRING","Mage",137],["T_DOUBLE_COLON","::",137],["T_STRING","helper",137],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",137],")",["T_OBJECT_OPERATOR","->",137],["T_STRING","__",137],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong %s specified.'",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getFieldLabel",137],"(",["T_VARIABLE","$key",137],")",")",";",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n\n        ",139],["T_COMMENT","\/\/ currency code\n",141],["T_WHITESPACE","        ",142],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","!",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getCurrencyCode",142],"(",")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_errors",143],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",143],"]","[","]",["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_STRING","Mage",143],["T_DOUBLE_COLON","::",143],["T_STRING","helper",143],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",143],")",["T_OBJECT_OPERATOR","->",143],["T_STRING","__",143],"(",["T_CONSTANT_ENCAPSED_STRING","'Currency code is undefined.'",143],")",";",["T_WHITESPACE","\n        ",143],"}",["T_WHITESPACE","\n\n        ",144],["T_COMMENT","\/\/ payment method\n",146],["T_WHITESPACE","        ",147],["T_IF","if",147],["T_WHITESPACE"," ",147],"(","!",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_methodInstance",147],["T_WHITESPACE"," ",147],["T_BOOLEAN_OR","||",147],["T_WHITESPACE"," ",147],"!",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getMethodCode",147],"(",")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_errors",148],"[",["T_CONSTANT_ENCAPSED_STRING","'method_code'",148],"]","[","]",["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_STRING","Mage",148],["T_DOUBLE_COLON","::",148],["T_STRING","helper",148],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",148],")",["T_OBJECT_OPERATOR","->",148],["T_STRING","__",148],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment method code is undefined.'",148],")",";",["T_WHITESPACE","\n        ",148],"}",["T_WHITESPACE","\n        ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_methodInstance",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_TRY","try",151],["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_methodInstance",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","validateRecurringProfile",152],"(",["T_VARIABLE","$this",152],")",";",["T_WHITESPACE","\n            ",152],"}",["T_WHITESPACE"," ",153],["T_CATCH","catch",153],["T_WHITESPACE"," ",153],"(",["T_STRING","Mage_Core_Exception",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$e",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_errors",154],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_method'",154],"]","[","]",["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$e",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getMessage",154],"(",")",";",["T_WHITESPACE","\n            ",154],"}",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n\n        ",156],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_EMPTY","empty",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_errors",158],")",";",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * Getter for errors that may appear after validation\n     *\n     * @param bool $isGrouped\n     * @return array\n     *\/",161],["T_WHITESPACE","\n    ",166],["T_PUBLIC","public",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","getValidationErrors",167],"(",["T_VARIABLE","$isGrouped",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","true",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$asMessage",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","false",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_VARIABLE","$isGrouped",169],["T_WHITESPACE"," ",169],["T_BOOLEAN_AND","&&",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_errors",169],")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$result",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_ARRAY","array",170],"(",")",";",["T_WHITESPACE","\n            ",170],["T_FOREACH","foreach",171],["T_WHITESPACE"," ",171],"(",["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_errors",171],["T_WHITESPACE"," ",171],["T_AS","as",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$row",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n                ",171],["T_VARIABLE","$result",172],"[","]",["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","implode",172],"(",["T_CONSTANT_ENCAPSED_STRING","' '",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$row",172],")",";",["T_WHITESPACE","\n            ",172],"}",["T_WHITESPACE","\n            ",173],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_VARIABLE","$asMessage",174],")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n                ",174],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_STRING","Mage",175],["T_DOUBLE_COLON","::",175],["T_STRING","throwException",175],"(",["T_WHITESPACE","\n                    ",175],["T_STRING","Mage",176],["T_DOUBLE_COLON","::",176],["T_STRING","helper",176],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",176],")",["T_OBJECT_OPERATOR","->",176],["T_STRING","__",176],"(",["T_CONSTANT_ENCAPSED_STRING","\"Payment profile is invalid:\\n%s\"",176],",",["T_WHITESPACE"," ",176],["T_STRING","implode",176],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$result",176],")",")",["T_WHITESPACE","\n                ",176],")",";",["T_WHITESPACE","\n            ",177],"}",["T_WHITESPACE","\n            ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$result",179],";",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE","\n        ",180],["T_RETURN","return",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_errors",181],";",["T_WHITESPACE","\n    ",181],"}",["T_WHITESPACE","\n\n    ",182],["T_DOC_COMMENT","\/**\n     * Setter for payment method instance\n     *\n     * @param Mage_Payment_Model_Method_Abstract $object\n     * @return Mage_Payment_Model_Recurring_Profile\n     * @throws Exception\n     *\/",184],["T_WHITESPACE","\n    ",190],["T_PUBLIC","public",191],["T_WHITESPACE"," ",191],["T_FUNCTION","function",191],["T_WHITESPACE"," ",191],["T_STRING","setMethodInstance",191],"(",["T_STRING","Mage_Payment_Model_Method_Abstract",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$object",191],")",["T_WHITESPACE","\n    ",191],"{",["T_WHITESPACE","\n        ",192],["T_IF","if",193],["T_WHITESPACE"," ",193],"(",["T_VARIABLE","$object",193],["T_WHITESPACE"," ",193],["T_INSTANCEOF","instanceof",193],["T_WHITESPACE"," ",193],["T_STRING","Mage_Payment_Model_Recurring_Profile_MethodInterface",193],")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","_methodInstance",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$object",194],";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE"," ",195],["T_ELSE","else",195],["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_THROW","throw",196],["T_WHITESPACE"," ",196],["T_NEW","new",196],["T_WHITESPACE"," ",196],["T_STRING","Exception",196],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid payment method instance for use in recurring profile.'",196],")",";",["T_WHITESPACE","\n        ",196],"}",["T_WHITESPACE","\n        ",197],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],";",["T_WHITESPACE","\n    ",198],"}",["T_WHITESPACE","\n\n    ",199],["T_DOC_COMMENT","\/**\n     * Collect needed information from buy request\n     * Then filter data\n     *\n     * @param Varien_Object $buyRequest\n     * @return Mage_Payment_Model_Recurring_Profile\n     * @throws Mage_Core_Exception\n     *\/",201],["T_WHITESPACE","\n    ",208],["T_PUBLIC","public",209],["T_WHITESPACE"," ",209],["T_FUNCTION","function",209],["T_WHITESPACE"," ",209],["T_STRING","importBuyRequest",209],"(",["T_STRING","Varien_Object",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$buyRequest",209],")",["T_WHITESPACE","\n    ",209],"{",["T_WHITESPACE","\n        ",210],["T_VARIABLE","$startDate",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$buyRequest",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getData",211],"(",["T_STRING","self",211],["T_DOUBLE_COLON","::",211],["T_STRING","BUY_REQUEST_START_DATETIME",211],")",";",["T_WHITESPACE","\n        ",211],["T_IF","if",212],["T_WHITESPACE"," ",212],"(",["T_VARIABLE","$startDate",212],")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_ensureLocaleAndStore",213],"(",")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$dateFormat",214],["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_locale",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getDateTimeFormat",214],"(",["T_STRING","Mage_Core_Model_Locale",214],["T_DOUBLE_COLON","::",214],["T_STRING","FORMAT_TYPE_SHORT",214],")",";",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$localeCode",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_locale",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getLocaleCode",215],"(",")",";",["T_WHITESPACE","\n            ",215],["T_IF","if",216],["T_WHITESPACE"," ",216],"(","!",["T_STRING","Zend_Date",216],["T_DOUBLE_COLON","::",216],["T_STRING","isDate",216],"(",["T_VARIABLE","$startDate",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$dateFormat",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$localeCode",216],")",")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n                ",216],["T_STRING","Mage",217],["T_DOUBLE_COLON","::",217],["T_STRING","throwException",217],"(",["T_STRING","Mage",217],["T_DOUBLE_COLON","::",217],["T_STRING","helper",217],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",217],")",["T_OBJECT_OPERATOR","->",217],["T_STRING","__",217],"(",["T_CONSTANT_ENCAPSED_STRING","'Recurring profile start date has invalid format.'",217],")",")",";",["T_WHITESPACE","\n            ",217],"}",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$utcTime",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_locale",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","utcDate",219],"(",["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_store",219],",",["T_WHITESPACE"," ",219],["T_VARIABLE","$startDate",219],",",["T_WHITESPACE"," ",219],["T_STRING","true",219],",",["T_WHITESPACE"," ",219],["T_VARIABLE","$dateFormat",219],")",["T_WHITESPACE","\n                ",219],["T_OBJECT_OPERATOR","->",220],["T_STRING","toString",220],"(",["T_STRING","Varien_Date",220],["T_DOUBLE_COLON","::",220],["T_STRING","DATETIME_INTERNAL_FORMAT",220],")",";",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setStartDatetime",221],"(",["T_VARIABLE","$utcTime",221],")",["T_OBJECT_OPERATOR","->",221],["T_STRING","setImportedStartDatetime",221],"(",["T_VARIABLE","$startDate",221],")",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE","\n        ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_filterValues",223],"(",")",";",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Import product recurring profile information\n     * Returns false if it cannot be imported\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Payment_Model_Recurring_Profile|false\n     *\/",226],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","importProduct",233],"(",["T_STRING","Mage_Catalog_Model_Product",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$product",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$product",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","isRecurring",235],"(",")",["T_WHITESPACE"," ",235],["T_BOOLEAN_AND","&&",235],["T_WHITESPACE"," ",235],["T_STRING","is_array",235],"(",["T_VARIABLE","$product",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getRecurringProfile",235],"(",")",")",")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n            ",235],["T_COMMENT","\/\/ import recurring profile data\n",236],["T_WHITESPACE","            ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","addData",237],"(",["T_VARIABLE","$product",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getRecurringProfile",237],"(",")",")",";",["T_WHITESPACE","\n\n            ",237],["T_COMMENT","\/\/ automatically set product name if there is no schedule description\n",239],["T_WHITESPACE","            ",240],["T_IF","if",240],["T_WHITESPACE"," ",240],"(","!",["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","hasScheduleDescription",240],"(",")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n                ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setScheduleDescription",241],"(",["T_VARIABLE","$product",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getName",241],"(",")",")",";",["T_WHITESPACE","\n            ",241],"}",["T_WHITESPACE","\n\n            ",242],["T_COMMENT","\/\/ collect start datetime from the product options\n",244],["T_WHITESPACE","            ",245],["T_VARIABLE","$options",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_VARIABLE","$product",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getCustomOption",245],"(",["T_STRING","self",245],["T_DOUBLE_COLON","::",245],["T_STRING","PRODUCT_OPTIONS_KEY",245],")",";",["T_WHITESPACE","\n            ",245],["T_IF","if",246],["T_WHITESPACE"," ",246],"(",["T_VARIABLE","$options",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n                ",246],["T_VARIABLE","$options",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_STRING","unserialize",247],"(",["T_VARIABLE","$options",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getValue",247],"(",")",")",";",["T_WHITESPACE","\n                ",247],["T_IF","if",248],["T_WHITESPACE"," ",248],"(",["T_STRING","is_array",248],"(",["T_VARIABLE","$options",248],")",")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n                    ",248],["T_IF","if",249],["T_WHITESPACE"," ",249],"(",["T_ISSET","isset",249],"(",["T_VARIABLE","$options",249],"[",["T_CONSTANT_ENCAPSED_STRING","'start_datetime'",249],"]",")",")",["T_WHITESPACE"," ",249],"{",["T_WHITESPACE","\n                        ",249],["T_VARIABLE","$startDatetime",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_NEW","new",250],["T_WHITESPACE"," ",250],["T_STRING","Zend_Date",250],"(",["T_VARIABLE","$options",250],"[",["T_CONSTANT_ENCAPSED_STRING","'start_datetime'",250],"]",",",["T_WHITESPACE"," ",250],["T_STRING","Varien_Date",250],["T_DOUBLE_COLON","::",250],["T_STRING","DATETIME_INTERNAL_FORMAT",250],")",";",["T_WHITESPACE","\n                        ",250],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","setNearestStartDatetime",251],"(",["T_VARIABLE","$startDatetime",251],")",";",["T_WHITESPACE","\n                    ",251],"}",["T_WHITESPACE","\n                ",252],"}",["T_WHITESPACE","\n            ",253],"}",["T_WHITESPACE","\n\n            ",254],["T_RETURN","return",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_filterValues",256],"(",")",";",["T_WHITESPACE","\n        ",256],"}",["T_WHITESPACE","\n        ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_STRING","false",258],";",["T_WHITESPACE","\n    ",258],"}",["T_WHITESPACE","\n\n    ",259],["T_DOC_COMMENT","\/**\n     * Render available schedule information\n     *\n     * @return array\n     *\/",261],["T_WHITESPACE","\n    ",265],["T_PUBLIC","public",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","exportScheduleInfo",266],"(",")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$result",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_ARRAY","array",268],"(",["T_WHITESPACE","\n            ",268],["T_NEW","new",269],["T_WHITESPACE"," ",269],["T_STRING","Varien_Object",269],"(",["T_ARRAY","array",269],"(",["T_WHITESPACE","\n                ",269],["T_CONSTANT_ENCAPSED_STRING","'title'",270],["T_WHITESPACE","    ",270],["T_DOUBLE_ARROW","=>",270],["T_WHITESPACE"," ",270],["T_STRING","Mage",270],["T_DOUBLE_COLON","::",270],["T_STRING","helper",270],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",270],")",["T_OBJECT_OPERATOR","->",270],["T_STRING","__",270],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Period'",270],")",",",["T_WHITESPACE","\n                ",270],["T_CONSTANT_ENCAPSED_STRING","'schedule'",271],["T_WHITESPACE"," ",271],["T_DOUBLE_ARROW","=>",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","_renderSchedule",271],"(",["T_CONSTANT_ENCAPSED_STRING","'period_unit'",271],",",["T_WHITESPACE"," ",271],["T_CONSTANT_ENCAPSED_STRING","'period_frequency'",271],",",["T_WHITESPACE"," ",271],["T_CONSTANT_ENCAPSED_STRING","'period_max_cycles'",271],")",",",["T_WHITESPACE","\n            ",271],")",")",["T_WHITESPACE","\n        ",272],")",";",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$trial",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","_renderSchedule",274],"(",["T_CONSTANT_ENCAPSED_STRING","'trial_period_unit'",274],",",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'trial_period_frequency'",274],",",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'trial_period_max_cycles'",274],")",";",["T_WHITESPACE","\n        ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$trial",275],")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n            ",275],["T_VARIABLE","$result",276],"[","]",["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_NEW","new",276],["T_WHITESPACE"," ",276],["T_STRING","Varien_Object",276],"(",["T_ARRAY","array",276],"(",["T_WHITESPACE","\n                ",276],["T_CONSTANT_ENCAPSED_STRING","'title'",277],["T_WHITESPACE","    ",277],["T_DOUBLE_ARROW","=>",277],["T_WHITESPACE"," ",277],["T_STRING","Mage",277],["T_DOUBLE_COLON","::",277],["T_STRING","helper",277],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",277],")",["T_OBJECT_OPERATOR","->",277],["T_STRING","__",277],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial Period'",277],")",",",["T_WHITESPACE","\n                ",277],["T_CONSTANT_ENCAPSED_STRING","'schedule'",278],["T_WHITESPACE"," ",278],["T_DOUBLE_ARROW","=>",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$trial",278],",",["T_WHITESPACE","\n            ",278],")",")",";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n        ",280],["T_RETURN","return",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$result",281],";",["T_WHITESPACE","\n    ",281],"}",["T_WHITESPACE","\n\n    ",282],["T_DOC_COMMENT","\/**\n     * Determine nearest possible profile start date\n     *\n     * @param Zend_Date $minAllowed\n     * @return Mage_Payment_Model_Recurring_Profile\n     *\/",284],["T_WHITESPACE","\n    ",289],["T_PUBLIC","public",290],["T_WHITESPACE"," ",290],["T_FUNCTION","function",290],["T_WHITESPACE"," ",290],["T_STRING","setNearestStartDatetime",290],"(",["T_STRING","Zend_Date",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$minAllowed",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_STRING","null",290],")",["T_WHITESPACE","\n    ",290],"{",["T_WHITESPACE","\n        ",291],["T_COMMENT","\/\/ TODO: implement proper logic with invoking payment method instance\n",292],["T_WHITESPACE","        ",293],["T_VARIABLE","$date",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$minAllowed",293],";",["T_WHITESPACE","\n        ",293],["T_IF","if",294],["T_WHITESPACE"," ",294],"(","!",["T_VARIABLE","$date",294],["T_WHITESPACE"," ",294],["T_BOOLEAN_OR","||",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$date",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getTimestamp",294],"(",")",["T_WHITESPACE"," ",294],"<",["T_WHITESPACE"," ",294],["T_STRING","time",294],"(",")",")",["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n            ",294],["T_VARIABLE","$date",295],["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_NEW","new",295],["T_WHITESPACE"," ",295],["T_STRING","Zend_Date",295],"(",["T_STRING","time",295],"(",")",")",";",["T_WHITESPACE","\n        ",295],"}",["T_WHITESPACE","\n        ",296],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","setStartDatetime",297],"(",["T_VARIABLE","$date",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","toString",297],"(",["T_STRING","Varien_Date",297],["T_DOUBLE_COLON","::",297],["T_STRING","DATETIME_INTERNAL_FORMAT",297],")",")",";",["T_WHITESPACE","\n        ",297],["T_RETURN","return",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],";",["T_WHITESPACE","\n    ",298],"}",["T_WHITESPACE","\n\n    ",299],["T_DOC_COMMENT","\/**\n     * Convert the start datetime (if set) to proper locale\/timezone and return\n     *\n     * @param bool $asString\n     * @return Zend_Date|string\n     *\/",301],["T_WHITESPACE","\n    ",306],["T_PUBLIC","public",307],["T_WHITESPACE"," ",307],["T_FUNCTION","function",307],["T_WHITESPACE"," ",307],["T_STRING","exportStartDatetime",307],"(",["T_VARIABLE","$asString",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_STRING","true",307],")",["T_WHITESPACE","\n    ",307],"{",["T_WHITESPACE","\n        ",308],["T_VARIABLE","$datetime",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getStartDatetime",309],"(",")",";",["T_WHITESPACE","\n        ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(","!",["T_VARIABLE","$datetime",310],["T_WHITESPACE"," ",310],["T_BOOLEAN_OR","||",310],["T_WHITESPACE"," ",310],"!",["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_locale",310],["T_WHITESPACE"," ",310],["T_BOOLEAN_OR","||",310],["T_WHITESPACE"," ",310],"!",["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_store",310],")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_RETURN","return",311],";",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n        ",312],["T_VARIABLE","$date",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_locale",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","storeDate",313],"(",["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","_store",313],",",["T_WHITESPACE"," ",313],["T_STRING","strtotime",313],"(",["T_VARIABLE","$datetime",313],")",",",["T_WHITESPACE"," ",313],["T_STRING","true",313],")",";",["T_WHITESPACE","\n        ",313],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$asString",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_RETURN","return",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$date",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","toString",315],"(",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","_locale",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getDateTimeFormat",315],"(",["T_STRING","Mage_Core_Model_Locale",315],["T_DOUBLE_COLON","::",315],["T_STRING","FORMAT_TYPE_SHORT",315],")",")",";",["T_WHITESPACE","\n        ",315],"}",["T_WHITESPACE","\n        ",316],["T_RETURN","return",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$date",317],";",["T_WHITESPACE","\n    ",317],"}",["T_WHITESPACE","\n\n    ",318],["T_DOC_COMMENT","\/**\n     * Locale instance setter\n     *\n     * @param Mage_Core_Model_Locale $locale\n     * @return Mage_Payment_Model_Recurring_Profile\n     *\/",320],["T_WHITESPACE","\n    ",325],["T_PUBLIC","public",326],["T_WHITESPACE"," ",326],["T_FUNCTION","function",326],["T_WHITESPACE"," ",326],["T_STRING","setLocale",326],"(",["T_STRING","Mage_Core_Model_Locale",326],["T_WHITESPACE"," ",326],["T_VARIABLE","$locale",326],")",["T_WHITESPACE","\n    ",326],"{",["T_WHITESPACE","\n        ",327],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_locale",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_VARIABLE","$locale",328],";",["T_WHITESPACE","\n        ",328],["T_RETURN","return",329],["T_WHITESPACE"," ",329],["T_VARIABLE","$this",329],";",["T_WHITESPACE","\n    ",329],"}",["T_WHITESPACE","\n\n    ",330],["T_DOC_COMMENT","\/**\n     * Store instance setter\n     *\n     * @param Mage_Core_Model_Store $store\n     * @return Mage_Payment_Model_Recurring_Profile\n     *\/",332],["T_WHITESPACE","\n    ",337],["T_PUBLIC","public",338],["T_WHITESPACE"," ",338],["T_FUNCTION","function",338],["T_WHITESPACE"," ",338],["T_STRING","setStore",338],"(",["T_STRING","Mage_Core_Model_Store",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$store",338],")",["T_WHITESPACE","\n    ",338],"{",["T_WHITESPACE","\n        ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","_store",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_VARIABLE","$store",340],";",["T_WHITESPACE","\n        ",340],["T_RETURN","return",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$this",341],";",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n\n    ",342],["T_DOC_COMMENT","\/**\n     * Getter for available period units\n     *\n     * @param bool $withLabels\n     * @return array\n     *\/",344],["T_WHITESPACE","\n    ",349],["T_PUBLIC","public",350],["T_WHITESPACE"," ",350],["T_FUNCTION","function",350],["T_WHITESPACE"," ",350],["T_STRING","getAllPeriodUnits",350],"(",["T_VARIABLE","$withLabels",350],["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_STRING","true",350],")",["T_WHITESPACE","\n    ",350],"{",["T_WHITESPACE","\n        ",351],["T_VARIABLE","$units",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_ARRAY","array",352],"(",["T_WHITESPACE","\n            ",352],["T_STRING","self",353],["T_DOUBLE_COLON","::",353],["T_STRING","PERIOD_UNIT_DAY",353],",",["T_WHITESPACE","\n            ",353],["T_STRING","self",354],["T_DOUBLE_COLON","::",354],["T_STRING","PERIOD_UNIT_WEEK",354],",",["T_WHITESPACE","\n            ",354],["T_STRING","self",355],["T_DOUBLE_COLON","::",355],["T_STRING","PERIOD_UNIT_SEMI_MONTH",355],",",["T_WHITESPACE","\n            ",355],["T_STRING","self",356],["T_DOUBLE_COLON","::",356],["T_STRING","PERIOD_UNIT_MONTH",356],",",["T_WHITESPACE","\n            ",356],["T_STRING","self",357],["T_DOUBLE_COLON","::",357],["T_STRING","PERIOD_UNIT_YEAR",357],["T_WHITESPACE","\n        ",357],")",";",["T_WHITESPACE","\n\n        ",358],["T_IF","if",360],["T_WHITESPACE"," ",360],"(",["T_VARIABLE","$withLabels",360],")",["T_WHITESPACE"," ",360],"{",["T_WHITESPACE","\n            ",360],["T_VARIABLE","$result",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_ARRAY","array",361],"(",")",";",["T_WHITESPACE","\n            ",361],["T_FOREACH","foreach",362],["T_WHITESPACE"," ",362],"(",["T_VARIABLE","$units",362],["T_WHITESPACE"," ",362],["T_AS","as",362],["T_WHITESPACE"," ",362],["T_VARIABLE","$unit",362],")",["T_WHITESPACE"," ",362],"{",["T_WHITESPACE","\n                ",362],["T_VARIABLE","$result",363],"[",["T_VARIABLE","$unit",363],"]",["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getPeriodUnitLabel",363],"(",["T_VARIABLE","$unit",363],")",";",["T_WHITESPACE","\n            ",363],"}",["T_WHITESPACE","\n            ",364],["T_RETURN","return",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$result",365],";",["T_WHITESPACE","\n        ",365],"}",["T_WHITESPACE","\n        ",366],["T_RETURN","return",367],["T_WHITESPACE"," ",367],["T_VARIABLE","$units",367],";",["T_WHITESPACE","\n    ",367],"}",["T_WHITESPACE","\n\n    ",368],["T_DOC_COMMENT","\/**\n     * Render label for specified period unit\n     *\n     * @param string $unit\n     *\/",370],["T_WHITESPACE","\n    ",374],["T_PUBLIC","public",375],["T_WHITESPACE"," ",375],["T_FUNCTION","function",375],["T_WHITESPACE"," ",375],["T_STRING","getPeriodUnitLabel",375],"(",["T_VARIABLE","$unit",375],")",["T_WHITESPACE","\n    ",375],"{",["T_WHITESPACE","\n        ",376],["T_SWITCH","switch",377],["T_WHITESPACE"," ",377],"(",["T_VARIABLE","$unit",377],")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n            ",377],["T_CASE","case",378],["T_WHITESPACE"," ",378],["T_STRING","self",378],["T_DOUBLE_COLON","::",378],["T_STRING","PERIOD_UNIT_DAY",378],":",["T_WHITESPACE","  ",378],["T_RETURN","return",378],["T_WHITESPACE"," ",378],["T_STRING","Mage",378],["T_DOUBLE_COLON","::",378],["T_STRING","helper",378],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",378],")",["T_OBJECT_OPERATOR","->",378],["T_STRING","__",378],"(",["T_CONSTANT_ENCAPSED_STRING","'Day'",378],")",";",["T_WHITESPACE","\n            ",378],["T_CASE","case",379],["T_WHITESPACE"," ",379],["T_STRING","self",379],["T_DOUBLE_COLON","::",379],["T_STRING","PERIOD_UNIT_WEEK",379],":",["T_WHITESPACE"," ",379],["T_RETURN","return",379],["T_WHITESPACE"," ",379],["T_STRING","Mage",379],["T_DOUBLE_COLON","::",379],["T_STRING","helper",379],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",379],")",["T_OBJECT_OPERATOR","->",379],["T_STRING","__",379],"(",["T_CONSTANT_ENCAPSED_STRING","'Week'",379],")",";",["T_WHITESPACE","\n            ",379],["T_CASE","case",380],["T_WHITESPACE"," ",380],["T_STRING","self",380],["T_DOUBLE_COLON","::",380],["T_STRING","PERIOD_UNIT_SEMI_MONTH",380],":",["T_WHITESPACE"," ",380],["T_RETURN","return",380],["T_WHITESPACE"," ",380],["T_STRING","Mage",380],["T_DOUBLE_COLON","::",380],["T_STRING","helper",380],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",380],")",["T_OBJECT_OPERATOR","->",380],["T_STRING","__",380],"(",["T_CONSTANT_ENCAPSED_STRING","'Two Weeks'",380],")",";",["T_WHITESPACE","\n            ",380],["T_CASE","case",381],["T_WHITESPACE"," ",381],["T_STRING","self",381],["T_DOUBLE_COLON","::",381],["T_STRING","PERIOD_UNIT_MONTH",381],":",["T_WHITESPACE"," ",381],["T_RETURN","return",381],["T_WHITESPACE"," ",381],["T_STRING","Mage",381],["T_DOUBLE_COLON","::",381],["T_STRING","helper",381],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",381],")",["T_OBJECT_OPERATOR","->",381],["T_STRING","__",381],"(",["T_CONSTANT_ENCAPSED_STRING","'Month'",381],")",";",["T_WHITESPACE","\n            ",381],["T_CASE","case",382],["T_WHITESPACE"," ",382],["T_STRING","self",382],["T_DOUBLE_COLON","::",382],["T_STRING","PERIOD_UNIT_YEAR",382],":",["T_WHITESPACE","  ",382],["T_RETURN","return",382],["T_WHITESPACE"," ",382],["T_STRING","Mage",382],["T_DOUBLE_COLON","::",382],["T_STRING","helper",382],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",382],")",["T_OBJECT_OPERATOR","->",382],["T_STRING","__",382],"(",["T_CONSTANT_ENCAPSED_STRING","'Year'",382],")",";",["T_WHITESPACE","\n        ",382],"}",["T_WHITESPACE","\n        ",383],["T_RETURN","return",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$unit",384],";",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n\n    ",385],["T_DOC_COMMENT","\/**\n     * Getter for field label\n     *\n     * @param string $field\n     * @return string|null\n     *\/",387],["T_WHITESPACE","\n    ",392],["T_PUBLIC","public",393],["T_WHITESPACE"," ",393],["T_FUNCTION","function",393],["T_WHITESPACE"," ",393],["T_STRING","getFieldLabel",393],"(",["T_VARIABLE","$field",393],")",["T_WHITESPACE","\n    ",393],"{",["T_WHITESPACE","\n        ",394],["T_SWITCH","switch",395],["T_WHITESPACE"," ",395],"(",["T_VARIABLE","$field",395],")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n            ",395],["T_CASE","case",396],["T_WHITESPACE"," ",396],["T_CONSTANT_ENCAPSED_STRING","'subscriber_name'",396],":",["T_WHITESPACE","\n                ",396],["T_RETURN","return",397],["T_WHITESPACE"," ",397],["T_STRING","Mage",397],["T_DOUBLE_COLON","::",397],["T_STRING","helper",397],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",397],")",["T_OBJECT_OPERATOR","->",397],["T_STRING","__",397],"(",["T_CONSTANT_ENCAPSED_STRING","'Subscriber Name'",397],")",";",["T_WHITESPACE","\n            ",397],["T_CASE","case",398],["T_WHITESPACE"," ",398],["T_CONSTANT_ENCAPSED_STRING","'start_datetime'",398],":",["T_WHITESPACE","\n                ",398],["T_RETURN","return",399],["T_WHITESPACE"," ",399],["T_STRING","Mage",399],["T_DOUBLE_COLON","::",399],["T_STRING","helper",399],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",399],")",["T_OBJECT_OPERATOR","->",399],["T_STRING","__",399],"(",["T_CONSTANT_ENCAPSED_STRING","'Start Date'",399],")",";",["T_WHITESPACE","\n            ",399],["T_CASE","case",400],["T_WHITESPACE"," ",400],["T_CONSTANT_ENCAPSED_STRING","'internal_reference_id'",400],":",["T_WHITESPACE","\n                ",400],["T_RETURN","return",401],["T_WHITESPACE"," ",401],["T_STRING","Mage",401],["T_DOUBLE_COLON","::",401],["T_STRING","helper",401],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",401],")",["T_OBJECT_OPERATOR","->",401],["T_STRING","__",401],"(",["T_CONSTANT_ENCAPSED_STRING","'Internal Reference ID'",401],")",";",["T_WHITESPACE","\n            ",401],["T_CASE","case",402],["T_WHITESPACE"," ",402],["T_CONSTANT_ENCAPSED_STRING","'schedule_description'",402],":",["T_WHITESPACE","\n                ",402],["T_RETURN","return",403],["T_WHITESPACE"," ",403],["T_STRING","Mage",403],["T_DOUBLE_COLON","::",403],["T_STRING","helper",403],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",403],")",["T_OBJECT_OPERATOR","->",403],["T_STRING","__",403],"(",["T_CONSTANT_ENCAPSED_STRING","'Schedule Description'",403],")",";",["T_WHITESPACE","\n            ",403],["T_CASE","case",404],["T_WHITESPACE"," ",404],["T_CONSTANT_ENCAPSED_STRING","'suspension_threshold'",404],":",["T_WHITESPACE","\n                ",404],["T_RETURN","return",405],["T_WHITESPACE"," ",405],["T_STRING","Mage",405],["T_DOUBLE_COLON","::",405],["T_STRING","helper",405],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",405],")",["T_OBJECT_OPERATOR","->",405],["T_STRING","__",405],"(",["T_CONSTANT_ENCAPSED_STRING","'Maximum Payment Failures'",405],")",";",["T_WHITESPACE","\n            ",405],["T_CASE","case",406],["T_WHITESPACE"," ",406],["T_CONSTANT_ENCAPSED_STRING","'bill_failed_later'",406],":",["T_WHITESPACE","\n                ",406],["T_RETURN","return",407],["T_WHITESPACE"," ",407],["T_STRING","Mage",407],["T_DOUBLE_COLON","::",407],["T_STRING","helper",407],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",407],")",["T_OBJECT_OPERATOR","->",407],["T_STRING","__",407],"(",["T_CONSTANT_ENCAPSED_STRING","'Auto Bill on Next Cycle'",407],")",";",["T_WHITESPACE","\n            ",407],["T_CASE","case",408],["T_WHITESPACE"," ",408],["T_CONSTANT_ENCAPSED_STRING","'period_unit'",408],":",["T_WHITESPACE","\n                ",408],["T_RETURN","return",409],["T_WHITESPACE"," ",409],["T_STRING","Mage",409],["T_DOUBLE_COLON","::",409],["T_STRING","helper",409],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",409],")",["T_OBJECT_OPERATOR","->",409],["T_STRING","__",409],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Period Unit'",409],")",";",["T_WHITESPACE","\n            ",409],["T_CASE","case",410],["T_WHITESPACE"," ",410],["T_CONSTANT_ENCAPSED_STRING","'period_frequency'",410],":",["T_WHITESPACE","\n                ",410],["T_RETURN","return",411],["T_WHITESPACE"," ",411],["T_STRING","Mage",411],["T_DOUBLE_COLON","::",411],["T_STRING","helper",411],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",411],")",["T_OBJECT_OPERATOR","->",411],["T_STRING","__",411],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Frequency'",411],")",";",["T_WHITESPACE","\n            ",411],["T_CASE","case",412],["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","'period_max_cycles'",412],":",["T_WHITESPACE","\n                ",412],["T_RETURN","return",413],["T_WHITESPACE"," ",413],["T_STRING","Mage",413],["T_DOUBLE_COLON","::",413],["T_STRING","helper",413],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",413],")",["T_OBJECT_OPERATOR","->",413],["T_STRING","__",413],"(",["T_CONSTANT_ENCAPSED_STRING","'Maximum Billing Cycles'",413],")",";",["T_WHITESPACE","\n            ",413],["T_CASE","case",414],["T_WHITESPACE"," ",414],["T_CONSTANT_ENCAPSED_STRING","'billing_amount'",414],":",["T_WHITESPACE","\n                ",414],["T_RETURN","return",415],["T_WHITESPACE"," ",415],["T_STRING","Mage",415],["T_DOUBLE_COLON","::",415],["T_STRING","helper",415],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",415],")",["T_OBJECT_OPERATOR","->",415],["T_STRING","__",415],"(",["T_CONSTANT_ENCAPSED_STRING","'Billing Amount'",415],")",";",["T_WHITESPACE","\n            ",415],["T_CASE","case",416],["T_WHITESPACE"," ",416],["T_CONSTANT_ENCAPSED_STRING","'trial_period_unit'",416],":",["T_WHITESPACE","\n                ",416],["T_RETURN","return",417],["T_WHITESPACE"," ",417],["T_STRING","Mage",417],["T_DOUBLE_COLON","::",417],["T_STRING","helper",417],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",417],")",["T_OBJECT_OPERATOR","->",417],["T_STRING","__",417],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial Billing Period Unit'",417],")",";",["T_WHITESPACE","\n            ",417],["T_CASE","case",418],["T_WHITESPACE"," ",418],["T_CONSTANT_ENCAPSED_STRING","'trial_period_frequency'",418],":",["T_WHITESPACE","\n                ",418],["T_RETURN","return",419],["T_WHITESPACE"," ",419],["T_STRING","Mage",419],["T_DOUBLE_COLON","::",419],["T_STRING","helper",419],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",419],")",["T_OBJECT_OPERATOR","->",419],["T_STRING","__",419],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial Billing Frequency'",419],")",";",["T_WHITESPACE","\n            ",419],["T_CASE","case",420],["T_WHITESPACE"," ",420],["T_CONSTANT_ENCAPSED_STRING","'trial_period_max_cycles'",420],":",["T_WHITESPACE","\n                ",420],["T_RETURN","return",421],["T_WHITESPACE"," ",421],["T_STRING","Mage",421],["T_DOUBLE_COLON","::",421],["T_STRING","helper",421],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",421],")",["T_OBJECT_OPERATOR","->",421],["T_STRING","__",421],"(",["T_CONSTANT_ENCAPSED_STRING","'Maximum Trial Billing Cycles'",421],")",";",["T_WHITESPACE","\n            ",421],["T_CASE","case",422],["T_WHITESPACE"," ",422],["T_CONSTANT_ENCAPSED_STRING","'trial_billing_amount'",422],":",["T_WHITESPACE","\n                ",422],["T_RETURN","return",423],["T_WHITESPACE"," ",423],["T_STRING","Mage",423],["T_DOUBLE_COLON","::",423],["T_STRING","helper",423],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",423],")",["T_OBJECT_OPERATOR","->",423],["T_STRING","__",423],"(",["T_CONSTANT_ENCAPSED_STRING","'Trial Billing Amount'",423],")",";",["T_WHITESPACE","\n            ",423],["T_CASE","case",424],["T_WHITESPACE"," ",424],["T_CONSTANT_ENCAPSED_STRING","'currency_code'",424],":",["T_WHITESPACE","\n                ",424],["T_RETURN","return",425],["T_WHITESPACE"," ",425],["T_STRING","Mage",425],["T_DOUBLE_COLON","::",425],["T_STRING","helper",425],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",425],")",["T_OBJECT_OPERATOR","->",425],["T_STRING","__",425],"(",["T_CONSTANT_ENCAPSED_STRING","'Currency'",425],")",";",["T_WHITESPACE","\n            ",425],["T_CASE","case",426],["T_WHITESPACE"," ",426],["T_CONSTANT_ENCAPSED_STRING","'shipping_amount'",426],":",["T_WHITESPACE","\n                ",426],["T_RETURN","return",427],["T_WHITESPACE"," ",427],["T_STRING","Mage",427],["T_DOUBLE_COLON","::",427],["T_STRING","helper",427],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",427],")",["T_OBJECT_OPERATOR","->",427],["T_STRING","__",427],"(",["T_CONSTANT_ENCAPSED_STRING","'Shipping Amount'",427],")",";",["T_WHITESPACE","\n            ",427],["T_CASE","case",428],["T_WHITESPACE"," ",428],["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",428],":",["T_WHITESPACE","\n                ",428],["T_RETURN","return",429],["T_WHITESPACE"," ",429],["T_STRING","Mage",429],["T_DOUBLE_COLON","::",429],["T_STRING","helper",429],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",429],")",["T_OBJECT_OPERATOR","->",429],["T_STRING","__",429],"(",["T_CONSTANT_ENCAPSED_STRING","'Tax Amount'",429],")",";",["T_WHITESPACE","\n            ",429],["T_CASE","case",430],["T_WHITESPACE"," ",430],["T_CONSTANT_ENCAPSED_STRING","'init_amount'",430],":",["T_WHITESPACE","\n                ",430],["T_RETURN","return",431],["T_WHITESPACE"," ",431],["T_STRING","Mage",431],["T_DOUBLE_COLON","::",431],["T_STRING","helper",431],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",431],")",["T_OBJECT_OPERATOR","->",431],["T_STRING","__",431],"(",["T_CONSTANT_ENCAPSED_STRING","'Initial Fee'",431],")",";",["T_WHITESPACE","\n            ",431],["T_CASE","case",432],["T_WHITESPACE"," ",432],["T_CONSTANT_ENCAPSED_STRING","'init_may_fail'",432],":",["T_WHITESPACE","\n                ",432],["T_RETURN","return",433],["T_WHITESPACE"," ",433],["T_STRING","Mage",433],["T_DOUBLE_COLON","::",433],["T_STRING","helper",433],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",433],")",["T_OBJECT_OPERATOR","->",433],["T_STRING","__",433],"(",["T_CONSTANT_ENCAPSED_STRING","'Allow Initial Fee Failure'",433],")",";",["T_WHITESPACE","\n            ",433],["T_CASE","case",434],["T_WHITESPACE"," ",434],["T_CONSTANT_ENCAPSED_STRING","'method_code'",434],":",["T_WHITESPACE","\n                ",434],["T_RETURN","return",435],["T_WHITESPACE"," ",435],["T_STRING","Mage",435],["T_DOUBLE_COLON","::",435],["T_STRING","helper",435],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",435],")",["T_OBJECT_OPERATOR","->",435],["T_STRING","__",435],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment Method'",435],")",";",["T_WHITESPACE","\n            ",435],["T_CASE","case",436],["T_WHITESPACE"," ",436],["T_CONSTANT_ENCAPSED_STRING","'reference_id'",436],":",["T_WHITESPACE","\n                ",436],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_STRING","Mage",437],["T_DOUBLE_COLON","::",437],["T_STRING","helper",437],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",437],")",["T_OBJECT_OPERATOR","->",437],["T_STRING","__",437],"(",["T_CONSTANT_ENCAPSED_STRING","'Payment Reference ID'",437],")",";",["T_WHITESPACE","\n        ",437],"}",["T_WHITESPACE","\n    ",438],"}",["T_WHITESPACE","\n\n    ",439],["T_DOC_COMMENT","\/**\n     * Getter for field comments\n     *\n     * @param string $field\n     * @return string|null\n     *\/",441],["T_WHITESPACE","\n    ",446],["T_PUBLIC","public",447],["T_WHITESPACE"," ",447],["T_FUNCTION","function",447],["T_WHITESPACE"," ",447],["T_STRING","getFieldComment",447],"(",["T_VARIABLE","$field",447],")",["T_WHITESPACE","\n    ",447],"{",["T_WHITESPACE","\n        ",448],["T_SWITCH","switch",449],["T_WHITESPACE"," ",449],"(",["T_VARIABLE","$field",449],")",["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_CASE","case",450],["T_WHITESPACE"," ",450],["T_CONSTANT_ENCAPSED_STRING","'subscriber_name'",450],":",["T_WHITESPACE","\n                ",450],["T_RETURN","return",451],["T_WHITESPACE"," ",451],["T_STRING","Mage",451],["T_DOUBLE_COLON","::",451],["T_STRING","helper",451],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",451],")",["T_OBJECT_OPERATOR","->",451],["T_STRING","__",451],"(",["T_CONSTANT_ENCAPSED_STRING","'Full name of the person receiving the product or service paid for by the recurring payment.'",451],")",";",["T_WHITESPACE","\n            ",451],["T_CASE","case",452],["T_WHITESPACE"," ",452],["T_CONSTANT_ENCAPSED_STRING","'start_datetime'",452],":",["T_WHITESPACE","\n                ",452],["T_RETURN","return",453],["T_WHITESPACE"," ",453],["T_STRING","Mage",453],["T_DOUBLE_COLON","::",453],["T_STRING","helper",453],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",453],")",["T_OBJECT_OPERATOR","->",453],["T_STRING","__",453],"(",["T_CONSTANT_ENCAPSED_STRING","'The date when billing for the profile begins.'",453],")",";",["T_WHITESPACE","\n            ",453],["T_CASE","case",454],["T_WHITESPACE"," ",454],["T_CONSTANT_ENCAPSED_STRING","'schedule_description'",454],":",["T_WHITESPACE","\n                ",454],["T_RETURN","return",455],["T_WHITESPACE"," ",455],["T_STRING","Mage",455],["T_DOUBLE_COLON","::",455],["T_STRING","helper",455],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",455],")",["T_OBJECT_OPERATOR","->",455],["T_STRING","__",455],"(",["T_CONSTANT_ENCAPSED_STRING","'Short description of the recurring payment. By default equals to the product name.'",455],")",";",["T_WHITESPACE","\n            ",455],["T_CASE","case",456],["T_WHITESPACE"," ",456],["T_CONSTANT_ENCAPSED_STRING","'suspension_threshold'",456],":",["T_WHITESPACE","\n                ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_STRING","Mage",457],["T_DOUBLE_COLON","::",457],["T_STRING","helper",457],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",457],")",["T_OBJECT_OPERATOR","->",457],["T_STRING","__",457],"(",["T_CONSTANT_ENCAPSED_STRING","'The number of scheduled payments that can fail before the profile is automatically suspended.'",457],")",";",["T_WHITESPACE","\n            ",457],["T_CASE","case",458],["T_WHITESPACE"," ",458],["T_CONSTANT_ENCAPSED_STRING","'bill_failed_later'",458],":",["T_WHITESPACE","\n                ",458],["T_RETURN","return",459],["T_WHITESPACE"," ",459],["T_STRING","Mage",459],["T_DOUBLE_COLON","::",459],["T_STRING","helper",459],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",459],")",["T_OBJECT_OPERATOR","->",459],["T_STRING","__",459],"(",["T_CONSTANT_ENCAPSED_STRING","'Automatically bill the outstanding balance amount in the next billing cycle (if there were failed payments).'",459],")",";",["T_WHITESPACE","\n            ",459],["T_CASE","case",460],["T_WHITESPACE"," ",460],["T_CONSTANT_ENCAPSED_STRING","'period_unit'",460],":",["T_WHITESPACE","\n                ",460],["T_RETURN","return",461],["T_WHITESPACE"," ",461],["T_STRING","Mage",461],["T_DOUBLE_COLON","::",461],["T_STRING","helper",461],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",461],")",["T_OBJECT_OPERATOR","->",461],["T_STRING","__",461],"(",["T_CONSTANT_ENCAPSED_STRING","'Unit for billing during the subscription period.'",461],")",";",["T_WHITESPACE","\n            ",461],["T_CASE","case",462],["T_WHITESPACE"," ",462],["T_CONSTANT_ENCAPSED_STRING","'period_frequency'",462],":",["T_WHITESPACE","\n                ",462],["T_RETURN","return",463],["T_WHITESPACE"," ",463],["T_STRING","Mage",463],["T_DOUBLE_COLON","::",463],["T_STRING","helper",463],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",463],")",["T_OBJECT_OPERATOR","->",463],["T_STRING","__",463],"(",["T_CONSTANT_ENCAPSED_STRING","'Number of billing periods that make up one billing cycle.'",463],")",";",["T_WHITESPACE","\n            ",463],["T_CASE","case",464],["T_WHITESPACE"," ",464],["T_CONSTANT_ENCAPSED_STRING","'period_max_cycles'",464],":",["T_WHITESPACE","\n                ",464],["T_RETURN","return",465],["T_WHITESPACE"," ",465],["T_STRING","Mage",465],["T_DOUBLE_COLON","::",465],["T_STRING","helper",465],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",465],")",["T_OBJECT_OPERATOR","->",465],["T_STRING","__",465],"(",["T_CONSTANT_ENCAPSED_STRING","'The number of billing cycles for payment period.'",465],")",";",["T_WHITESPACE","\n            ",465],["T_CASE","case",466],["T_WHITESPACE"," ",466],["T_CONSTANT_ENCAPSED_STRING","'init_amount'",466],":",["T_WHITESPACE","\n                ",466],["T_RETURN","return",467],["T_WHITESPACE"," ",467],["T_STRING","Mage",467],["T_DOUBLE_COLON","::",467],["T_STRING","helper",467],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",467],")",["T_OBJECT_OPERATOR","->",467],["T_STRING","__",467],"(",["T_CONSTANT_ENCAPSED_STRING","'Initial non-recurring payment amount due immediately upon profile creation.'",467],")",";",["T_WHITESPACE","\n            ",467],["T_CASE","case",468],["T_WHITESPACE"," ",468],["T_CONSTANT_ENCAPSED_STRING","'init_may_fail'",468],":",["T_WHITESPACE","\n                ",468],["T_RETURN","return",469],["T_WHITESPACE"," ",469],["T_STRING","Mage",469],["T_DOUBLE_COLON","::",469],["T_STRING","helper",469],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",469],")",["T_OBJECT_OPERATOR","->",469],["T_STRING","__",469],"(",["T_CONSTANT_ENCAPSED_STRING","'Whether to suspend the payment profile if the initial fee fails or add it to the outstanding balance.'",469],")",";",["T_WHITESPACE","\n        ",469],"}",["T_WHITESPACE","\n    ",470],"}",["T_WHITESPACE","\n\n    ",471],["T_DOC_COMMENT","\/**\n     * Transform some specific data for output\n     *\n     * @param string $key\n     * @return mixed\n     *\/",473],["T_WHITESPACE","\n    ",478],["T_PUBLIC","public",479],["T_WHITESPACE"," ",479],["T_FUNCTION","function",479],["T_WHITESPACE"," ",479],["T_STRING","renderData",479],"(",["T_VARIABLE","$key",479],")",["T_WHITESPACE","\n    ",479],"{",["T_WHITESPACE","\n        ",480],["T_VARIABLE","$value",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","_getData",481],"(",["T_VARIABLE","$key",481],")",";",["T_WHITESPACE","\n        ",481],["T_SWITCH","switch",482],["T_WHITESPACE"," ",482],"(",["T_VARIABLE","$key",482],")",["T_WHITESPACE"," ",482],"{",["T_WHITESPACE","\n            ",482],["T_CASE","case",483],["T_WHITESPACE"," ",483],["T_CONSTANT_ENCAPSED_STRING","'period_unit'",483],":",["T_WHITESPACE","\n                ",483],["T_RETURN","return",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","getPeriodUnitLabel",484],"(",["T_VARIABLE","$value",484],")",";",["T_WHITESPACE","\n            ",484],["T_CASE","case",485],["T_WHITESPACE"," ",485],["T_CONSTANT_ENCAPSED_STRING","'method_code'",485],":",["T_WHITESPACE","\n                ",485],["T_IF","if",486],["T_WHITESPACE"," ",486],"(","!",["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","_paymentMethods",486],")",["T_WHITESPACE"," ",486],"{",["T_WHITESPACE","\n                    ",486],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","_paymentMethods",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_STRING","Mage",487],["T_DOUBLE_COLON","::",487],["T_STRING","helper",487],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",487],")",["T_OBJECT_OPERATOR","->",487],["T_STRING","getPaymentMethodList",487],"(",["T_STRING","false",487],")",";",["T_WHITESPACE","\n                ",487],"}",["T_WHITESPACE","\n                ",488],["T_IF","if",489],["T_WHITESPACE"," ",489],"(",["T_ISSET","isset",489],"(",["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","_paymentMethods",489],"[",["T_VARIABLE","$value",489],"]",")",")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n                    ",489],["T_RETURN","return",490],["T_WHITESPACE"," ",490],["T_VARIABLE","$this",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","_paymentMethods",490],"[",["T_VARIABLE","$value",490],"]",";",["T_WHITESPACE","\n                ",490],"}",["T_WHITESPACE","\n                ",491],["T_BREAK","break",492],";",["T_WHITESPACE","\n            ",492],["T_CASE","case",493],["T_WHITESPACE"," ",493],["T_CONSTANT_ENCAPSED_STRING","'start_datetime'",493],":",["T_WHITESPACE","\n                ",493],["T_RETURN","return",494],["T_WHITESPACE"," ",494],["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","exportStartDatetime",494],"(",["T_STRING","true",494],")",";",["T_WHITESPACE","\n        ",494],"}",["T_WHITESPACE","\n        ",495],["T_RETURN","return",496],["T_WHITESPACE"," ",496],["T_VARIABLE","$value",496],";",["T_WHITESPACE","\n    ",496],"}",["T_WHITESPACE","\n\n    ",497],["T_DOC_COMMENT","\/**\n     * Filter self data to make sure it can be validated properly\n     *\n     * @return Mage_Payment_Model_Recurring_Profile\n     *\/",499],["T_WHITESPACE","\n    ",503],["T_PROTECTED","protected",504],["T_WHITESPACE"," ",504],["T_FUNCTION","function",504],["T_WHITESPACE"," ",504],["T_STRING","_filterValues",504],"(",")",["T_WHITESPACE","\n    ",504],"{",["T_WHITESPACE","\n        ",505],["T_COMMENT","\/\/ determine payment method\/code\n",506],["T_WHITESPACE","        ",507],["T_IF","if",507],["T_WHITESPACE"," ",507],"(",["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","_methodInstance",507],")",["T_WHITESPACE"," ",507],"{",["T_WHITESPACE","\n            ",507],["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","setMethodCode",508],"(",["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","_methodInstance",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","getCode",508],"(",")",")",";",["T_WHITESPACE","\n        ",508],"}",["T_WHITESPACE","\n        ",509],["T_ELSEIF","elseif",510],["T_WHITESPACE"," ",510],"(",["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","getMethodCode",510],"(",")",")",["T_WHITESPACE"," ",510],"{",["T_WHITESPACE","\n            ",510],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","getMethodInstance",511],"(",")",";",["T_WHITESPACE","\n        ",511],"}",["T_WHITESPACE","\n\n        ",512],["T_COMMENT","\/\/ unset redundant values, if empty\n",514],["T_WHITESPACE","        ",515],["T_FOREACH","foreach",515],["T_WHITESPACE"," ",515],"(",["T_ARRAY","array",515],"(",["T_CONSTANT_ENCAPSED_STRING","'schedule_description'",515],",",["T_WHITESPACE","\n            ",515],["T_CONSTANT_ENCAPSED_STRING","'suspension_threshold'",516],",",["T_WHITESPACE"," ",516],["T_CONSTANT_ENCAPSED_STRING","'bill_failed_later'",516],",",["T_WHITESPACE"," ",516],["T_CONSTANT_ENCAPSED_STRING","'period_frequency'",516],",",["T_WHITESPACE"," ",516],["T_CONSTANT_ENCAPSED_STRING","'period_max_cycles'",516],",",["T_WHITESPACE"," ",516],["T_CONSTANT_ENCAPSED_STRING","'reference_id'",516],",",["T_WHITESPACE","\n            ",516],["T_CONSTANT_ENCAPSED_STRING","'trial_period_unit'",517],",",["T_WHITESPACE"," ",517],["T_CONSTANT_ENCAPSED_STRING","'trial_period_frequency'",517],",",["T_WHITESPACE"," ",517],["T_CONSTANT_ENCAPSED_STRING","'trial_period_max_cycles'",517],",",["T_WHITESPACE"," ",517],["T_CONSTANT_ENCAPSED_STRING","'init_may_fail'",517],")",["T_WHITESPACE"," ",517],["T_AS","as",517],["T_WHITESPACE"," ",517],["T_VARIABLE","$key",517],")",["T_WHITESPACE"," ",517],"{",["T_WHITESPACE","\n            ",517],["T_IF","if",518],["T_WHITESPACE"," ",518],"(",["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","hasData",518],"(",["T_VARIABLE","$key",518],")",["T_WHITESPACE"," ",518],["T_BOOLEAN_AND","&&",518],["T_WHITESPACE"," ",518],"(","!",["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getData",518],"(",["T_VARIABLE","$key",518],")",["T_WHITESPACE"," ",518],["T_BOOLEAN_OR","||",518],["T_WHITESPACE"," ",518],["T_CONSTANT_ENCAPSED_STRING","'0'",518],["T_WHITESPACE"," ",518],["T_IS_EQUAL","==",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$this",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getData",518],"(",["T_VARIABLE","$key",518],")",")",")",["T_WHITESPACE"," ",518],"{",["T_WHITESPACE","\n                ",518],["T_VARIABLE","$this",519],["T_OBJECT_OPERATOR","->",519],["T_STRING","unsetData",519],"(",["T_VARIABLE","$key",519],")",";",["T_WHITESPACE","\n            ",519],"}",["T_WHITESPACE","\n        ",520],"}",["T_WHITESPACE","\n\n        ",521],["T_COMMENT","\/\/ cast amounts\n",523],["T_WHITESPACE","        ",524],["T_FOREACH","foreach",524],["T_WHITESPACE"," ",524],"(",["T_ARRAY","array",524],"(",["T_WHITESPACE","\n            ",524],["T_CONSTANT_ENCAPSED_STRING","'billing_amount'",525],",",["T_WHITESPACE"," ",525],["T_CONSTANT_ENCAPSED_STRING","'trial_billing_amount'",525],",",["T_WHITESPACE"," ",525],["T_CONSTANT_ENCAPSED_STRING","'shipping_amount'",525],",",["T_WHITESPACE"," ",525],["T_CONSTANT_ENCAPSED_STRING","'tax_amount'",525],",",["T_WHITESPACE"," ",525],["T_CONSTANT_ENCAPSED_STRING","'init_amount'",525],")",["T_WHITESPACE"," ",525],["T_AS","as",525],["T_WHITESPACE"," ",525],["T_VARIABLE","$key",525],")",["T_WHITESPACE"," ",525],"{",["T_WHITESPACE","\n            ",525],["T_IF","if",526],["T_WHITESPACE"," ",526],"(",["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","hasData",526],"(",["T_VARIABLE","$key",526],")",")",["T_WHITESPACE"," ",526],"{",["T_WHITESPACE","\n                ",526],["T_IF","if",527],["T_WHITESPACE"," ",527],"(","!",["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getData",527],"(",["T_VARIABLE","$key",527],")",["T_WHITESPACE"," ",527],["T_BOOLEAN_OR","||",527],["T_WHITESPACE"," ",527],["T_LNUMBER","0",527],["T_WHITESPACE"," ",527],["T_IS_EQUAL","==",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$this",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getData",527],"(",["T_VARIABLE","$key",527],")",")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n                    ",527],["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","unsetData",528],"(",["T_VARIABLE","$key",528],")",";",["T_WHITESPACE","\n                ",528],"}",["T_WHITESPACE"," ",529],["T_ELSE","else",529],["T_WHITESPACE"," ",529],"{",["T_WHITESPACE","\n                    ",529],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","setData",530],"(",["T_VARIABLE","$key",530],",",["T_WHITESPACE"," ",530],["T_STRING","sprintf",530],"(",["T_CONSTANT_ENCAPSED_STRING","'%.4F'",530],",",["T_WHITESPACE"," ",530],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","getData",530],"(",["T_VARIABLE","$key",530],")",")",")",";",["T_WHITESPACE","\n                ",530],"}",["T_WHITESPACE","\n            ",531],"}",["T_WHITESPACE","\n        ",532],"}",["T_WHITESPACE","\n\n        ",533],["T_COMMENT","\/\/ automatically determine start date, if not set\n",535],["T_WHITESPACE","        ",536],["T_IF","if",536],["T_WHITESPACE"," ",536],"(",["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","getStartDatetime",536],"(",")",")",["T_WHITESPACE"," ",536],"{",["T_WHITESPACE","\n            ",536],["T_VARIABLE","$date",537],["T_WHITESPACE"," ",537],"=",["T_WHITESPACE"," ",537],["T_NEW","new",537],["T_WHITESPACE"," ",537],["T_STRING","Zend_Date",537],"(",["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getStartDatetime",537],"(",")",",",["T_WHITESPACE"," ",537],["T_STRING","Varien_Date",537],["T_DOUBLE_COLON","::",537],["T_STRING","DATETIME_INTERNAL_FORMAT",537],")",";",["T_WHITESPACE","\n            ",537],["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","setNearestStartDatetime",538],"(",["T_VARIABLE","$date",538],")",";",["T_WHITESPACE","\n        ",538],"}",["T_WHITESPACE"," ",539],["T_ELSE","else",539],["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n            ",539],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","setNearestStartDatetime",540],"(",")",";",["T_WHITESPACE","\n        ",540],"}",["T_WHITESPACE","\n\n        ",541],["T_RETURN","return",543],["T_WHITESPACE"," ",543],["T_VARIABLE","$this",543],";",["T_WHITESPACE","\n    ",543],"}",["T_WHITESPACE","\n\n    ",544],["T_DOC_COMMENT","\/**\n     * Check that locale and store instances are set\n     *\n     * @throws Exception\n     *\/",546],["T_WHITESPACE","\n    ",550],["T_PROTECTED","protected",551],["T_WHITESPACE"," ",551],["T_FUNCTION","function",551],["T_WHITESPACE"," ",551],["T_STRING","_ensureLocaleAndStore",551],"(",")",["T_WHITESPACE","\n    ",551],"{",["T_WHITESPACE","\n        ",552],["T_IF","if",553],["T_WHITESPACE"," ",553],"(","!",["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","_locale",553],["T_WHITESPACE"," ",553],["T_BOOLEAN_OR","||",553],["T_WHITESPACE"," ",553],"!",["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","_store",553],")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n            ",553],["T_THROW","throw",554],["T_WHITESPACE"," ",554],["T_NEW","new",554],["T_WHITESPACE"," ",554],["T_STRING","Exception",554],"(",["T_CONSTANT_ENCAPSED_STRING","'Locale and store instances must be set for this operation.'",554],")",";",["T_WHITESPACE","\n        ",554],"}",["T_WHITESPACE","\n    ",555],"}",["T_WHITESPACE","\n\n    ",556],["T_DOC_COMMENT","\/**\n     * Return payment method instance\n     *\n     * @return Mage_Payment_Model_Method_Abstract\n     *\/",558],["T_WHITESPACE","\n    ",562],["T_PROTECTED","protected",563],["T_WHITESPACE"," ",563],["T_FUNCTION","function",563],["T_WHITESPACE"," ",563],["T_STRING","getMethodInstance",563],"(",")",["T_WHITESPACE","\n    ",563],"{",["T_WHITESPACE","\n        ",564],["T_IF","if",565],["T_WHITESPACE"," ",565],"(","!",["T_VARIABLE","$this",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","_methodInstance",565],")",["T_WHITESPACE"," ",565],"{",["T_WHITESPACE","\n            ",565],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","setMethodInstance",566],"(",["T_STRING","Mage",566],["T_DOUBLE_COLON","::",566],["T_STRING","helper",566],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",566],")",["T_OBJECT_OPERATOR","->",566],["T_STRING","getMethodInstance",566],"(",["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","getMethodCode",566],"(",")",")",")",";",["T_WHITESPACE","\n        ",566],"}",["T_WHITESPACE","\n        ",567],["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_methodInstance",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","setStore",568],"(",["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getStoreId",568],"(",")",")",";",["T_WHITESPACE","\n        ",568],["T_RETURN","return",569],["T_WHITESPACE"," ",569],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_methodInstance",569],";",["T_WHITESPACE","\n    ",569],"}",["T_WHITESPACE","\n\n    ",570],["T_DOC_COMMENT","\/**\n     * Check accordance of the unit and frequency\n     *\n     * @param string $unitKey\n     * @param string $frequencyKey\n     * @return bool\n     *\/",572],["T_WHITESPACE","\n    ",578],["T_PROTECTED","protected",579],["T_WHITESPACE"," ",579],["T_FUNCTION","function",579],["T_WHITESPACE"," ",579],["T_STRING","_validatePeriodFrequency",579],"(",["T_VARIABLE","$unitKey",579],",",["T_WHITESPACE"," ",579],["T_VARIABLE","$frequencyKey",579],")",["T_WHITESPACE","\n    ",579],"{",["T_WHITESPACE","\n        ",580],["T_IF","if",581],["T_WHITESPACE"," ",581],"(",["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","getData",581],"(",["T_VARIABLE","$unitKey",581],")",["T_WHITESPACE"," ",581],["T_IS_EQUAL","==",581],["T_WHITESPACE"," ",581],["T_STRING","self",581],["T_DOUBLE_COLON","::",581],["T_STRING","PERIOD_UNIT_SEMI_MONTH",581],["T_WHITESPACE"," ",581],["T_BOOLEAN_AND","&&",581],["T_WHITESPACE"," ",581],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","getData",581],"(",["T_VARIABLE","$frequencyKey",581],")",["T_WHITESPACE"," ",581],["T_IS_NOT_EQUAL","!=",581],["T_WHITESPACE"," ",581],["T_LNUMBER","1",581],")",["T_WHITESPACE"," ",581],"{",["T_WHITESPACE","\n            ",581],["T_RETURN","return",582],["T_WHITESPACE"," ",582],["T_STRING","false",582],";",["T_WHITESPACE","\n        ",582],"}",["T_WHITESPACE","\n        ",583],["T_RETURN","return",584],["T_WHITESPACE"," ",584],["T_STRING","true",584],";",["T_WHITESPACE","\n    ",584],"}",["T_WHITESPACE","\n\n    ",585],["T_DOC_COMMENT","\/**\n     * Perform full validation before saving\n     *\n     * @throws Mage_Core_Exception\n     *\/",587],["T_WHITESPACE","\n    ",591],["T_PROTECTED","protected",592],["T_WHITESPACE"," ",592],["T_FUNCTION","function",592],["T_WHITESPACE"," ",592],["T_STRING","_validateBeforeSave",592],"(",")",["T_WHITESPACE","\n    ",592],"{",["T_WHITESPACE","\n        ",593],["T_IF","if",594],["T_WHITESPACE"," ",594],"(","!",["T_VARIABLE","$this",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","isValid",594],"(",")",")",["T_WHITESPACE"," ",594],"{",["T_WHITESPACE","\n            ",594],["T_STRING","Mage",595],["T_DOUBLE_COLON","::",595],["T_STRING","throwException",595],"(",["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","getValidationErrors",595],"(",["T_STRING","true",595],",",["T_WHITESPACE"," ",595],["T_STRING","true",595],")",")",";",["T_WHITESPACE","\n        ",595],"}",["T_WHITESPACE","\n        ",596],["T_IF","if",597],["T_WHITESPACE"," ",597],"(","!",["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","getInternalReferenceId",597],"(",")",")",["T_WHITESPACE"," ",597],"{",["T_WHITESPACE","\n            ",597],["T_STRING","Mage",598],["T_DOUBLE_COLON","::",598],["T_STRING","throwException",598],"(",["T_WHITESPACE","\n                ",598],["T_STRING","Mage",599],["T_DOUBLE_COLON","::",599],["T_STRING","helper",599],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",599],")",["T_OBJECT_OPERATOR","->",599],["T_STRING","__",599],"(",["T_CONSTANT_ENCAPSED_STRING","'An internal reference ID is required to save the payment profile.'",599],")",["T_WHITESPACE","\n            ",599],")",";",["T_WHITESPACE","\n        ",600],"}",["T_WHITESPACE","\n    ",601],"}",["T_WHITESPACE","\n\n    ",602],["T_DOC_COMMENT","\/**\n     * Validate before saving\n     *\n     * @return Mage_Payment_Model_Recurring_Profile\n     *\/",604],["T_WHITESPACE","\n    ",608],["T_PROTECTED","protected",609],["T_WHITESPACE"," ",609],["T_FUNCTION","function",609],["T_WHITESPACE"," ",609],["T_STRING","_beforeSave",609],"(",")",["T_WHITESPACE","\n    ",609],"{",["T_WHITESPACE","\n        ",610],["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","_validateBeforeSave",611],"(",")",";",["T_WHITESPACE","\n        ",611],["T_RETURN","return",612],["T_WHITESPACE"," ",612],["T_STRING","parent",612],["T_DOUBLE_COLON","::",612],["T_STRING","_beforeSave",612],"(",")",";",["T_WHITESPACE","\n    ",612],"}",["T_WHITESPACE","\n\n    ",613],["T_DOC_COMMENT","\/**\n     * Generate explanations for specified schedule parameters\n     *\n     * TODO: utilize Zend_Translate_Plural or similar stuff to render proper declensions with numerals.\n     *\n     * @param string $periodKey\n     * @param string $frequencyKey\n     * @param string $cyclesKey\n     * @return array\n     *\/",615],["T_WHITESPACE","\n    ",624],["T_PROTECTED","protected",625],["T_WHITESPACE"," ",625],["T_FUNCTION","function",625],["T_WHITESPACE"," ",625],["T_STRING","_renderSchedule",625],"(",["T_VARIABLE","$periodKey",625],",",["T_WHITESPACE"," ",625],["T_VARIABLE","$frequencyKey",625],",",["T_WHITESPACE"," ",625],["T_VARIABLE","$cyclesKey",625],")",["T_WHITESPACE","\n    ",625],"{",["T_WHITESPACE","\n        ",626],["T_VARIABLE","$result",627],["T_WHITESPACE"," ",627],"=",["T_WHITESPACE"," ",627],["T_ARRAY","array",627],"(",")",";",["T_WHITESPACE","\n\n        ",627],["T_VARIABLE","$period",629],["T_WHITESPACE"," ",629],"=",["T_WHITESPACE"," ",629],["T_VARIABLE","$this",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","_getData",629],"(",["T_VARIABLE","$periodKey",629],")",";",["T_WHITESPACE","\n        ",629],["T_VARIABLE","$frequency",630],["T_WHITESPACE"," ",630],"=",["T_WHITESPACE"," ",630],["T_INT_CAST","(int)",630],["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","_getData",630],"(",["T_VARIABLE","$frequencyKey",630],")",";",["T_WHITESPACE","\n        ",630],["T_IF","if",631],["T_WHITESPACE"," ",631],"(","!",["T_VARIABLE","$period",631],["T_WHITESPACE"," ",631],["T_BOOLEAN_OR","||",631],["T_WHITESPACE"," ",631],"!",["T_VARIABLE","$frequency",631],")",["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n            ",631],["T_RETURN","return",632],["T_WHITESPACE"," ",632],["T_VARIABLE","$result",632],";",["T_WHITESPACE","\n        ",632],"}",["T_WHITESPACE","\n        ",633],["T_IF","if",634],["T_WHITESPACE"," ",634],"(",["T_STRING","self",634],["T_DOUBLE_COLON","::",634],["T_STRING","PERIOD_UNIT_SEMI_MONTH",634],["T_WHITESPACE"," ",634],["T_IS_EQUAL","==",634],["T_WHITESPACE"," ",634],["T_VARIABLE","$period",634],")",["T_WHITESPACE"," ",634],"{",["T_WHITESPACE","\n            ",634],["T_VARIABLE","$frequency",635],["T_WHITESPACE"," ",635],"=",["T_WHITESPACE"," ",635],["T_CONSTANT_ENCAPSED_STRING","''",635],";",["T_WHITESPACE","\n        ",635],"}",["T_WHITESPACE","\n        ",636],["T_VARIABLE","$result",637],"[","]",["T_WHITESPACE"," ",637],"=",["T_WHITESPACE"," ",637],["T_STRING","Mage",637],["T_DOUBLE_COLON","::",637],["T_STRING","helper",637],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",637],")",["T_OBJECT_OPERATOR","->",637],["T_STRING","__",637],"(",["T_CONSTANT_ENCAPSED_STRING","'%s %s cycle.'",637],",",["T_WHITESPACE"," ",637],["T_VARIABLE","$frequency",637],",",["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","getPeriodUnitLabel",637],"(",["T_VARIABLE","$period",637],")",")",";",["T_WHITESPACE","\n\n        ",637],["T_VARIABLE","$cycles",639],["T_WHITESPACE"," ",639],"=",["T_WHITESPACE"," ",639],["T_INT_CAST","(int)",639],["T_VARIABLE","$this",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","_getData",639],"(",["T_VARIABLE","$cyclesKey",639],")",";",["T_WHITESPACE","\n        ",639],["T_IF","if",640],["T_WHITESPACE"," ",640],"(",["T_VARIABLE","$cycles",640],")",["T_WHITESPACE"," ",640],"{",["T_WHITESPACE","\n            ",640],["T_VARIABLE","$result",641],"[","]",["T_WHITESPACE"," ",641],"=",["T_WHITESPACE"," ",641],["T_STRING","Mage",641],["T_DOUBLE_COLON","::",641],["T_STRING","helper",641],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",641],")",["T_OBJECT_OPERATOR","->",641],["T_STRING","__",641],"(",["T_CONSTANT_ENCAPSED_STRING","'Repeats %s time(s).'",641],",",["T_WHITESPACE"," ",641],["T_VARIABLE","$cycles",641],")",";",["T_WHITESPACE","\n        ",641],"}",["T_WHITESPACE"," ",642],["T_ELSE","else",642],["T_WHITESPACE"," ",642],"{",["T_WHITESPACE","\n            ",642],["T_VARIABLE","$result",643],"[","]",["T_WHITESPACE"," ",643],"=",["T_WHITESPACE"," ",643],["T_STRING","Mage",643],["T_DOUBLE_COLON","::",643],["T_STRING","helper",643],"(",["T_CONSTANT_ENCAPSED_STRING","'payment'",643],")",["T_OBJECT_OPERATOR","->",643],["T_STRING","__",643],"(",["T_CONSTANT_ENCAPSED_STRING","'Repeats until suspended or canceled.'",643],")",";",["T_WHITESPACE","\n        ",643],"}",["T_WHITESPACE","\n        ",644],["T_RETURN","return",645],["T_WHITESPACE"," ",645],["T_VARIABLE","$result",645],";",["T_WHITESPACE","\n    ",645],"}",["T_WHITESPACE","\n",646],"}",["T_WHITESPACE","\n",647]]