[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Admin\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * ACL user resource\n *\n * @category    Mage\n * @package     Mage_Admin\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Admin_Model_Resource_User",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Define main table\n     *\n     *\/",36],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","_construct",40],"(",")",["T_WHITESPACE","\n    ",40],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","_init",42],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/user'",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'user_id'",42],")",";",["T_WHITESPACE","\n    ",42],"}",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Initialize unique fields\n     *\n     * @return Mage_Admin_Model_Resource_User\n     *\/",45],["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","_initUniqueFields",50],"(",")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_uniqueFields",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_ARRAY","array",52],"(",["T_WHITESPACE","\n            ",52],["T_ARRAY","array",53],"(",["T_WHITESPACE","\n                ",53],["T_CONSTANT_ENCAPSED_STRING","'field'",54],["T_WHITESPACE"," ",54],["T_DOUBLE_ARROW","=>",54],["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'email'",54],",",["T_WHITESPACE","\n                ",54],["T_CONSTANT_ENCAPSED_STRING","'title'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_STRING","Mage",55],["T_DOUBLE_COLON","::",55],["T_STRING","helper",55],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",55],")",["T_OBJECT_OPERATOR","->",55],["T_STRING","__",55],"(",["T_CONSTANT_ENCAPSED_STRING","'Email'",55],")",["T_WHITESPACE","\n            ",55],")",",",["T_WHITESPACE","\n            ",56],["T_ARRAY","array",57],"(",["T_WHITESPACE","\n                ",57],["T_CONSTANT_ENCAPSED_STRING","'field'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'username'",58],",",["T_WHITESPACE","\n                ",58],["T_CONSTANT_ENCAPSED_STRING","'title'",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_STRING","Mage",59],["T_DOUBLE_COLON","::",59],["T_STRING","helper",59],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",59],")",["T_OBJECT_OPERATOR","->",59],["T_STRING","__",59],"(",["T_CONSTANT_ENCAPSED_STRING","'User Name'",59],")",["T_WHITESPACE","\n            ",59],")",",",["T_WHITESPACE","\n        ",60],")",";",["T_WHITESPACE","\n        ",61],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],";",["T_WHITESPACE","\n    ",62],"}",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Authenticate user by $username and $password\n     *\n     * @param Mage_Admin_Model_User $user\n     * @return Mage_Admin_Model_Resource_User\n     *\/",65],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","recordLogin",71],"(",["T_STRING","Mage_Admin_Model_User",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$user",71],")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$adapter",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_getWriteAdapter",73],"(",")",";",["T_WHITESPACE","\n\n        ",73],["T_VARIABLE","$data",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_ARRAY","array",75],"(",["T_WHITESPACE","\n            ",75],["T_CONSTANT_ENCAPSED_STRING","'logdate'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_STRING","now",76],"(",")",",",["T_WHITESPACE","\n            ",76],["T_CONSTANT_ENCAPSED_STRING","'lognum'",77],["T_WHITESPACE","  ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$user",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getLognum",77],"(",")",["T_WHITESPACE"," ",77],"+",["T_WHITESPACE"," ",77],["T_LNUMBER","1",77],["T_WHITESPACE","\n        ",77],")",";",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$condition",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_ARRAY","array",80],"(",["T_WHITESPACE","\n            ",80],["T_CONSTANT_ENCAPSED_STRING","'user_id = ?'",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_INT_CAST","(int)",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$user",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getUserId",81],"(",")",",",["T_WHITESPACE","\n        ",81],")",";",["T_WHITESPACE","\n\n        ",82],["T_VARIABLE","$adapter",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","update",84],"(",["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getMainTable",84],"(",")",",",["T_WHITESPACE"," ",84],["T_VARIABLE","$data",84],",",["T_WHITESPACE"," ",84],["T_VARIABLE","$condition",84],")",";",["T_WHITESPACE","\n\n        ",84],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],";",["T_WHITESPACE","\n    ",86],"}",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Load data by specified username\n     *\n     * @param string $username\n     * @return false|array\n     *\/",89],["T_WHITESPACE","\n    ",94],["T_PUBLIC","public",95],["T_WHITESPACE"," ",95],["T_FUNCTION","function",95],["T_WHITESPACE"," ",95],["T_STRING","loadByUsername",95],"(",["T_VARIABLE","$username",95],")",["T_WHITESPACE","\n    ",95],"{",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$adapter",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_getReadAdapter",97],"(",")",";",["T_WHITESPACE","\n\n        ",97],["T_VARIABLE","$select",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$adapter",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","select",99],"(",")",["T_WHITESPACE","\n                    ",99],["T_OBJECT_OPERATOR","->",100],["T_STRING","from",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getMainTable",100],"(",")",")",["T_WHITESPACE","\n                    ",100],["T_OBJECT_OPERATOR","->",101],["T_STRING","where",101],"(",["T_CONSTANT_ENCAPSED_STRING","'username=:username'",101],")",";",["T_WHITESPACE","\n\n        ",101],["T_VARIABLE","$binds",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_ARRAY","array",103],"(",["T_WHITESPACE","\n            ",103],["T_CONSTANT_ENCAPSED_STRING","'username'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$username",104],["T_WHITESPACE","\n        ",104],")",";",["T_WHITESPACE","\n\n        ",105],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$adapter",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","fetchRow",107],"(",["T_VARIABLE","$select",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$binds",107],")",";",["T_WHITESPACE","\n    ",107],"}",["T_WHITESPACE","\n\n    ",108],["T_DOC_COMMENT","\/**\n     * Check if user is assigned to any role\n     *\n     * @param int|Mage_Core_Admin_Model_User $user\n     * @return null|false|array\n     *\/",110],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","hasAssigned2Role",116],"(",["T_VARIABLE","$user",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_STRING","is_numeric",118],"(",["T_VARIABLE","$user",118],")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$userId",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$user",119],";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE"," ",120],["T_ELSE","else",120],["T_WHITESPACE"," ",120],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$user",120],["T_WHITESPACE"," ",120],["T_INSTANCEOF","instanceof",120],["T_WHITESPACE"," ",120],["T_STRING","Mage_Core_Model_Abstract",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_VARIABLE","$userId",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$user",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getUserId",121],"(",")",";",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE"," ",122],["T_ELSE","else",122],["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_STRING","null",123],";",["T_WHITESPACE","\n        ",123],"}",["T_WHITESPACE","\n\n        ",124],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_WHITESPACE"," ",126],["T_VARIABLE","$userId",126],["T_WHITESPACE"," ",126],">",["T_WHITESPACE"," ",126],["T_LNUMBER","0",126],["T_WHITESPACE"," ",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$adapter",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_getReadAdapter",127],"(",")",";",["T_WHITESPACE","\n\n            ",127],["T_VARIABLE","$select",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$adapter",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","select",129],"(",")",";",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$select",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","from",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getTable",130],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",130],")",")",["T_WHITESPACE","\n                ",130],["T_OBJECT_OPERATOR","->",131],["T_STRING","where",131],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id > :parent_id'",131],")",["T_WHITESPACE","\n                ",131],["T_OBJECT_OPERATOR","->",132],["T_STRING","where",132],"(",["T_CONSTANT_ENCAPSED_STRING","'user_id = :user_id'",132],")",";",["T_WHITESPACE","\n\n            ",132],["T_VARIABLE","$binds",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_ARRAY","array",134],"(",["T_WHITESPACE","\n                ",134],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_LNUMBER","0",135],",",["T_WHITESPACE","\n                ",135],["T_CONSTANT_ENCAPSED_STRING","'user_id'",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$userId",136],",",["T_WHITESPACE","\n            ",136],")",";",["T_WHITESPACE","\n\n            ",137],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$adapter",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","fetchAll",139],"(",["T_VARIABLE","$select",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$binds",139],")",";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE"," ",140],["T_ELSE","else",140],["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_STRING","null",141],";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_DOC_COMMENT","\/**\n     * Encrypt password\n     *\n     * @param string $pwStr\n     * @return string\n     *\/",145],["T_WHITESPACE","\n    ",150],["T_PRIVATE","private",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","_encryptPassword",151],"(",["T_VARIABLE","$pwStr",151],")",["T_WHITESPACE","\n    ",151],"{",["T_WHITESPACE","\n        ",152],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_STRING","Mage",153],["T_DOUBLE_COLON","::",153],["T_STRING","helper",153],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",153],")",["T_OBJECT_OPERATOR","->",153],["T_STRING","getHash",153],"(",["T_VARIABLE","$pwStr",153],",",["T_WHITESPACE"," ",153],["T_STRING","Mage_Admin_Model_User",153],["T_DOUBLE_COLON","::",153],["T_STRING","HASH_SALT_LENGTH",153],")",";",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * Set created\/modified values before user save\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return Mage_Admin_Model_Resource_User\n     *\/",156],["T_WHITESPACE","\n    ",161],["T_PROTECTED","protected",162],["T_WHITESPACE"," ",162],["T_FUNCTION","function",162],["T_WHITESPACE"," ",162],["T_STRING","_beforeSave",162],"(",["T_STRING","Mage_Core_Model_Abstract",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$user",162],")",["T_WHITESPACE","\n    ",162],"{",["T_WHITESPACE","\n        ",163],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$user",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","isObjectNew",164],"(",")",")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$user",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","setCreated",165],"(",["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","formatDate",165],"(",["T_STRING","true",165],")",")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$user",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","setModified",167],"(",["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","formatDate",167],"(",["T_STRING","true",167],")",")",";",["T_WHITESPACE","\n\n        ",167],["T_RETURN","return",169],["T_WHITESPACE"," ",169],["T_STRING","parent",169],["T_DOUBLE_COLON","::",169],["T_STRING","_beforeSave",169],"(",["T_VARIABLE","$user",169],")",";",["T_WHITESPACE","\n    ",169],"}",["T_WHITESPACE","\n\n    ",170],["T_DOC_COMMENT","\/**\n     * Unserialize user extra data after user save\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return Mage_Admin_Model_Resource_User\n     *\/",172],["T_WHITESPACE","\n    ",177],["T_PROTECTED","protected",178],["T_WHITESPACE"," ",178],["T_FUNCTION","function",178],["T_WHITESPACE"," ",178],["T_STRING","_afterSave",178],"(",["T_STRING","Mage_Core_Model_Abstract",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$user",178],")",["T_WHITESPACE","\n    ",178],"{",["T_WHITESPACE","\n        ",179],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_unserializeExtraData",180],"(",["T_VARIABLE","$user",180],")",";",["T_WHITESPACE","\n        ",180],["T_RETURN","return",181],["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],";",["T_WHITESPACE","\n    ",181],"}",["T_WHITESPACE","\n\n    ",182],["T_DOC_COMMENT","\/**\n     * Unserialize user extra data after user load\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return Mage_Admin_Model_Resource_User\n     *\/",184],["T_WHITESPACE","\n    ",189],["T_PROTECTED","protected",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","_afterLoad",190],"(",["T_STRING","Mage_Core_Model_Abstract",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$user",190],")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_RETURN","return",192],["T_WHITESPACE"," ",192],["T_STRING","parent",192],["T_DOUBLE_COLON","::",192],["T_STRING","_afterLoad",192],"(",["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_unserializeExtraData",192],"(",["T_VARIABLE","$user",192],")",")",";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n\n    ",193],["T_DOC_COMMENT","\/**\n     * Delete user role record with user\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return bool\n     *\/",195],["T_WHITESPACE","\n    ",200],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","delete",201],"(",["T_STRING","Mage_Core_Model_Abstract",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$user",201],")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_beforeDelete",203],"(",["T_VARIABLE","$user",203],")",";",["T_WHITESPACE","\n        ",203],["T_VARIABLE","$adapter",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_getWriteAdapter",204],"(",")",";",["T_WHITESPACE","\n\n        ",204],["T_VARIABLE","$uid",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$user",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getId",206],"(",")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$adapter",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","beginTransaction",207],"(",")",";",["T_WHITESPACE","\n        ",207],["T_TRY","try",208],["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$conditions",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_ARRAY","array",209],"(",["T_WHITESPACE","\n                ",209],["T_CONSTANT_ENCAPSED_STRING","'user_id = ?'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$uid",210],["T_WHITESPACE","\n            ",210],")",";",["T_WHITESPACE","\n\n            ",211],["T_VARIABLE","$adapter",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","delete",213],"(",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getMainTable",213],"(",")",",",["T_WHITESPACE"," ",213],["T_VARIABLE","$conditions",213],")",";",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$adapter",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","delete",214],"(",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getTable",214],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",214],")",",",["T_WHITESPACE"," ",214],["T_VARIABLE","$conditions",214],")",";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE"," ",215],["T_CATCH","catch",215],["T_WHITESPACE"," ",215],"(",["T_STRING","Mage_Core_Exception",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$e",215],")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n            ",215],["T_THROW","throw",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$e",216],";",["T_WHITESPACE","\n            ",216],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_STRING","false",217],";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE"," ",218],["T_CATCH","catch",218],["T_WHITESPACE"," ",218],"(",["T_STRING","Exception",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$e",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$adapter",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","rollBack",219],"(",")",";",["T_WHITESPACE","\n            ",219],["T_RETURN","return",220],["T_WHITESPACE"," ",220],["T_STRING","false",220],";",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n        ",221],["T_VARIABLE","$adapter",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","commit",222],"(",")",";",["T_WHITESPACE","\n        ",222],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_afterDelete",223],"(",["T_VARIABLE","$user",223],")",";",["T_WHITESPACE","\n        ",223],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_STRING","true",224],";",["T_WHITESPACE","\n    ",224],"}",["T_WHITESPACE","\n\n    ",225],["T_DOC_COMMENT","\/**\n     * TODO: unify _saveRelations() and add() methods, they make same things\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return Mage_Admin_Model_Resource_User\n     *\/",227],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","_saveRelations",233],"(",["T_STRING","Mage_Core_Model_Abstract",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$user",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$rolesIds",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$user",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getRoleIds",235],"(",")",";",["T_WHITESPACE","\n\n        ",235],["T_IF","if",237],["T_WHITESPACE"," ",237],"(","!",["T_STRING","is_array",237],"(",["T_VARIABLE","$rolesIds",237],")",["T_WHITESPACE"," ",237],["T_BOOLEAN_OR","||",237],["T_WHITESPACE"," ",237],["T_STRING","count",237],"(",["T_VARIABLE","$rolesIds",237],")",["T_WHITESPACE"," ",237],["T_IS_EQUAL","==",237],["T_WHITESPACE"," ",237],["T_LNUMBER","0",237],")",["T_WHITESPACE"," ",237],"{",["T_WHITESPACE","\n            ",237],["T_RETURN","return",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$user",238],";",["T_WHITESPACE","\n        ",238],"}",["T_WHITESPACE","\n\n        ",239],["T_VARIABLE","$adapter",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_getWriteAdapter",241],"(",")",";",["T_WHITESPACE","\n\n        ",241],["T_VARIABLE","$adapter",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","beginTransaction",243],"(",")",";",["T_WHITESPACE","\n\n        ",243],["T_TRY","try",245],["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n            ",245],["T_VARIABLE","$conditions",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_ARRAY","array",246],"(",["T_WHITESPACE","\n                ",246],["T_CONSTANT_ENCAPSED_STRING","'user_id = ?'",247],["T_WHITESPACE"," ",247],["T_DOUBLE_ARROW","=>",247],["T_WHITESPACE"," ",247],["T_INT_CAST","(int)",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$user",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getId",247],"(",")",",",["T_WHITESPACE","\n            ",247],")",";",["T_WHITESPACE","\n\n            ",248],["T_VARIABLE","$adapter",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","delete",250],"(",["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","getTable",250],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",250],")",",",["T_WHITESPACE"," ",250],["T_VARIABLE","$conditions",250],")",";",["T_WHITESPACE","\n            ",250],["T_FOREACH","foreach",251],["T_WHITESPACE"," ",251],"(",["T_VARIABLE","$rolesIds",251],["T_WHITESPACE"," ",251],["T_AS","as",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$rid",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n                ",251],["T_VARIABLE","$rid",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_STRING","intval",252],"(",["T_VARIABLE","$rid",252],")",";",["T_WHITESPACE","\n                ",252],["T_IF","if",253],["T_WHITESPACE"," ",253],"(",["T_VARIABLE","$rid",253],["T_WHITESPACE"," ",253],">",["T_WHITESPACE"," ",253],["T_LNUMBER","0",253],")",["T_WHITESPACE"," ",253],"{",["T_WHITESPACE","\n                    ",253],["T_VARIABLE","$row",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_STRING","Mage",254],["T_DOUBLE_COLON","::",254],["T_STRING","getModel",254],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",254],")",["T_OBJECT_OPERATOR","->",254],["T_STRING","load",254],"(",["T_VARIABLE","$rid",254],")",["T_OBJECT_OPERATOR","->",254],["T_STRING","getData",254],"(",")",";",["T_WHITESPACE","\n                ",254],"}",["T_WHITESPACE"," ",255],["T_ELSE","else",255],["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n                    ",255],["T_VARIABLE","$row",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_ARRAY","array",256],"(",["T_CONSTANT_ENCAPSED_STRING","'tree_level'",256],["T_WHITESPACE"," ",256],["T_DOUBLE_ARROW","=>",256],["T_WHITESPACE"," ",256],["T_LNUMBER","0",256],")",";",["T_WHITESPACE","\n                ",256],"}",["T_WHITESPACE","\n\n                ",257],["T_VARIABLE","$data",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_NEW","new",259],["T_WHITESPACE"," ",259],["T_STRING","Varien_Object",259],"(",["T_ARRAY","array",259],"(",["T_WHITESPACE","\n                    ",259],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",260],["T_WHITESPACE","     ",260],["T_DOUBLE_ARROW","=>",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$rid",260],",",["T_WHITESPACE","\n                    ",260],["T_CONSTANT_ENCAPSED_STRING","'tree_level'",261],["T_WHITESPACE","    ",261],["T_DOUBLE_ARROW","=>",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$row",261],"[",["T_CONSTANT_ENCAPSED_STRING","'tree_level'",261],"]",["T_WHITESPACE"," ",261],"+",["T_WHITESPACE"," ",261],["T_LNUMBER","1",261],",",["T_WHITESPACE","\n                    ",261],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",262],["T_WHITESPACE","    ",262],["T_DOUBLE_ARROW","=>",262],["T_WHITESPACE"," ",262],["T_LNUMBER","0",262],",",["T_WHITESPACE","\n                    ",262],["T_CONSTANT_ENCAPSED_STRING","'role_type'",263],["T_WHITESPACE","     ",263],["T_DOUBLE_ARROW","=>",263],["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","'U'",263],",",["T_WHITESPACE","\n                    ",263],["T_CONSTANT_ENCAPSED_STRING","'user_id'",264],["T_WHITESPACE","       ",264],["T_DOUBLE_ARROW","=>",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$user",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getId",264],"(",")",",",["T_WHITESPACE","\n                    ",264],["T_CONSTANT_ENCAPSED_STRING","'role_name'",265],["T_WHITESPACE","     ",265],["T_DOUBLE_ARROW","=>",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$user",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getFirstname",265],"(",")",["T_WHITESPACE","\n                ",265],")",")",";",["T_WHITESPACE","\n\n                ",266],["T_VARIABLE","$insertData",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_prepareDataForTable",268],"(",["T_VARIABLE","$data",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getTable",268],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",268],")",")",";",["T_WHITESPACE","\n                ",268],["T_VARIABLE","$adapter",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","insert",269],"(",["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getTable",269],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",269],")",",",["T_WHITESPACE"," ",269],["T_VARIABLE","$insertData",269],")",";",["T_WHITESPACE","\n            ",269],"}",["T_WHITESPACE","\n            ",270],["T_VARIABLE","$adapter",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","commit",271],"(",")",";",["T_WHITESPACE","\n        ",271],"}",["T_WHITESPACE"," ",272],["T_CATCH","catch",272],["T_WHITESPACE"," ",272],"(",["T_STRING","Mage_Core_Exception",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$e",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_THROW","throw",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$e",273],";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE"," ",274],["T_CATCH","catch",274],["T_WHITESPACE"," ",274],"(",["T_STRING","Exception",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$e",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n            ",274],["T_VARIABLE","$adapter",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","rollBack",275],"(",")",";",["T_WHITESPACE","\n            ",275],["T_THROW","throw",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$e",276],";",["T_WHITESPACE","\n        ",276],"}",["T_WHITESPACE","\n\n        ",277],["T_RETURN","return",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],";",["T_WHITESPACE","\n    ",279],"}",["T_WHITESPACE","\n\n    ",280],["T_DOC_COMMENT","\/**\n     * Get user roles\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return array\n     *\/",282],["T_WHITESPACE","\n    ",287],["T_PUBLIC","public",288],["T_WHITESPACE"," ",288],["T_FUNCTION","function",288],["T_WHITESPACE"," ",288],["T_STRING","getRoles",288],"(",["T_STRING","Mage_Core_Model_Abstract",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$user",288],")",["T_WHITESPACE","\n    ",288],"{",["T_WHITESPACE","\n        ",289],["T_IF","if",290],["T_WHITESPACE"," ",290],"(",["T_WHITESPACE"," ",290],"!",["T_VARIABLE","$user",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getId",290],"(",")",["T_WHITESPACE"," ",290],")",["T_WHITESPACE"," ",290],"{",["T_WHITESPACE","\n            ",290],["T_RETURN","return",291],["T_WHITESPACE"," ",291],["T_ARRAY","array",291],"(",")",";",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n\n        ",292],["T_VARIABLE","$table",294],["T_WHITESPACE","  ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","getTable",294],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",294],")",";",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$adapter",295],["T_WHITESPACE","   ",295],"=",["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","_getReadAdapter",295],"(",")",";",["T_WHITESPACE","\n\n        ",295],["T_VARIABLE","$select",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$adapter",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","select",297],"(",")",["T_WHITESPACE","\n                    ",297],["T_OBJECT_OPERATOR","->",298],["T_STRING","from",298],"(",["T_VARIABLE","$table",298],",",["T_WHITESPACE"," ",298],["T_ARRAY","array",298],"(",")",")",["T_WHITESPACE","\n                    ",298],["T_OBJECT_OPERATOR","->",299],["T_STRING","joinLeft",299],"(",["T_WHITESPACE","\n                        ",299],["T_ARRAY","array",300],"(",["T_CONSTANT_ENCAPSED_STRING","'ar'",300],["T_WHITESPACE"," ",300],["T_DOUBLE_ARROW","=>",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$table",300],")",",",["T_WHITESPACE","\n                        ",300],"\"",["T_ENCAPSED_AND_WHITESPACE","(ar.role_id = ",301],["T_CURLY_OPEN","{",301],["T_VARIABLE","$table",301],"}",["T_ENCAPSED_AND_WHITESPACE",".parent_id and ar.role_type = 'G')",301],"\"",",",["T_WHITESPACE","\n                        ",301],["T_ARRAY","array",302],"(",["T_CONSTANT_ENCAPSED_STRING","'role_id'",302],")",")",["T_WHITESPACE","\n                    ",302],["T_OBJECT_OPERATOR","->",303],["T_STRING","where",303],"(","\"",["T_CURLY_OPEN","{",303],["T_VARIABLE","$table",303],"}",["T_ENCAPSED_AND_WHITESPACE",".user_id = :user_id",303],"\"",")",";",["T_WHITESPACE","\n\n        ",303],["T_VARIABLE","$binds",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_ARRAY","array",305],"(",["T_WHITESPACE","\n            ",305],["T_CONSTANT_ENCAPSED_STRING","'user_id'",306],["T_WHITESPACE"," ",306],["T_DOUBLE_ARROW","=>",306],["T_WHITESPACE"," ",306],["T_INT_CAST","(int)",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$user",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getId",306],"(",")",",",["T_WHITESPACE","\n        ",306],")",";",["T_WHITESPACE","\n\n        ",307],["T_VARIABLE","$roles",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$adapter",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","fetchCol",309],"(",["T_VARIABLE","$select",309],",",["T_WHITESPACE"," ",309],["T_VARIABLE","$binds",309],")",";",["T_WHITESPACE","\n\n        ",309],["T_IF","if",311],["T_WHITESPACE"," ",311],"(",["T_VARIABLE","$roles",311],")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n            ",311],["T_RETURN","return",312],["T_WHITESPACE"," ",312],["T_VARIABLE","$roles",312],";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n\n        ",313],["T_RETURN","return",315],["T_WHITESPACE"," ",315],["T_ARRAY","array",315],"(",")",";",["T_WHITESPACE","\n    ",315],"}",["T_WHITESPACE","\n\n    ",316],["T_DOC_COMMENT","\/**\n     * Save user roles\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return Mage_Admin_Model_Resource_User\n     *\/",318],["T_WHITESPACE","\n    ",323],["T_PUBLIC","public",324],["T_WHITESPACE"," ",324],["T_FUNCTION","function",324],["T_WHITESPACE"," ",324],["T_STRING","add",324],"(",["T_STRING","Mage_Core_Model_Abstract",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$user",324],")",["T_WHITESPACE","\n    ",324],"{",["T_WHITESPACE","\n        ",325],["T_VARIABLE","$dbh",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_getWriteAdapter",326],"(",")",";",["T_WHITESPACE","\n\n        ",326],["T_VARIABLE","$aRoles",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","hasAssigned2Role",328],"(",["T_VARIABLE","$user",328],")",";",["T_WHITESPACE","\n        ",328],["T_IF","if",329],["T_WHITESPACE"," ",329],"(",["T_WHITESPACE"," ",329],["T_STRING","sizeof",329],"(",["T_VARIABLE","$aRoles",329],")",["T_WHITESPACE"," ",329],">",["T_WHITESPACE"," ",329],["T_LNUMBER","0",329],["T_WHITESPACE"," ",329],")",["T_WHITESPACE"," ",329],"{",["T_WHITESPACE","\n            ",329],["T_FOREACH","foreach",330],["T_WHITESPACE"," ",330],"(",["T_VARIABLE","$aRoles",330],["T_WHITESPACE"," ",330],["T_AS","as",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$idx",330],["T_WHITESPACE"," ",330],["T_DOUBLE_ARROW","=>",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$data",330],")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n                ",330],["T_VARIABLE","$conditions",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_ARRAY","array",331],"(",["T_WHITESPACE","\n                    ",331],["T_CONSTANT_ENCAPSED_STRING","'role_id = ?'",332],["T_WHITESPACE"," ",332],["T_DOUBLE_ARROW","=>",332],["T_WHITESPACE"," ",332],["T_VARIABLE","$data",332],"[",["T_CONSTANT_ENCAPSED_STRING","'role_id'",332],"]",",",["T_WHITESPACE","\n                ",332],")",";",["T_WHITESPACE","\n\n                ",333],["T_VARIABLE","$dbh",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","delete",335],"(",["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getTable",335],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",335],")",",",["T_WHITESPACE"," ",335],["T_VARIABLE","$conditions",335],")",";",["T_WHITESPACE","\n            ",335],"}",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE","\n\n        ",337],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$user",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","getId",339],"(",")",["T_WHITESPACE"," ",339],">",["T_WHITESPACE"," ",339],["T_LNUMBER","0",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$role",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_STRING","Mage",340],["T_DOUBLE_COLON","::",340],["T_STRING","getModel",340],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",340],")",["T_OBJECT_OPERATOR","->",340],["T_STRING","load",340],"(",["T_VARIABLE","$user",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getRoleId",340],"(",")",")",";",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE"," ",341],["T_ELSE","else",341],["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n            ",341],["T_VARIABLE","$role",342],["T_WHITESPACE"," ",342],"=",["T_WHITESPACE"," ",342],["T_NEW","new",342],["T_WHITESPACE"," ",342],["T_STRING","Varien_Object",342],"(",")",";",["T_WHITESPACE","\n            ",342],["T_VARIABLE","$role",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","setTreeLevel",343],"(",["T_LNUMBER","0",343],")",";",["T_WHITESPACE","\n        ",343],"}",["T_WHITESPACE","\n\n        ",344],["T_VARIABLE","$data",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_NEW","new",346],["T_WHITESPACE"," ",346],["T_STRING","Varien_Object",346],"(",["T_ARRAY","array",346],"(",["T_WHITESPACE","\n            ",346],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",347],["T_WHITESPACE","  ",347],["T_DOUBLE_ARROW","=>",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$user",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getRoleId",347],"(",")",",",["T_WHITESPACE","\n            ",347],["T_CONSTANT_ENCAPSED_STRING","'tree_level'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$role",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getTreeLevel",348],"(",")",["T_WHITESPACE"," ",348],"+",["T_WHITESPACE"," ",348],["T_LNUMBER","1",348],")",",",["T_WHITESPACE","\n            ",348],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",349],["T_WHITESPACE"," ",349],["T_DOUBLE_ARROW","=>",349],["T_WHITESPACE"," ",349],["T_LNUMBER","0",349],",",["T_WHITESPACE","\n            ",349],["T_CONSTANT_ENCAPSED_STRING","'role_type'",350],["T_WHITESPACE","  ",350],["T_DOUBLE_ARROW","=>",350],["T_WHITESPACE"," ",350],["T_CONSTANT_ENCAPSED_STRING","'U'",350],",",["T_WHITESPACE","\n            ",350],["T_CONSTANT_ENCAPSED_STRING","'user_id'",351],["T_WHITESPACE","    ",351],["T_DOUBLE_ARROW","=>",351],["T_WHITESPACE"," ",351],["T_VARIABLE","$user",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getUserId",351],"(",")",",",["T_WHITESPACE","\n            ",351],["T_CONSTANT_ENCAPSED_STRING","'role_name'",352],["T_WHITESPACE","  ",352],["T_DOUBLE_ARROW","=>",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$user",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getFirstname",352],"(",")",["T_WHITESPACE","\n        ",352],")",")",";",["T_WHITESPACE","\n\n        ",353],["T_VARIABLE","$insertData",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","_prepareDataForTable",355],"(",["T_VARIABLE","$data",355],",",["T_WHITESPACE"," ",355],["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getTable",355],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",355],")",")",";",["T_WHITESPACE","\n\n        ",355],["T_VARIABLE","$dbh",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","insert",357],"(",["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getTable",357],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",357],")",",",["T_WHITESPACE"," ",357],["T_VARIABLE","$insertData",357],")",";",["T_WHITESPACE","\n\n        ",357],["T_RETURN","return",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$this",359],";",["T_WHITESPACE","\n    ",359],"}",["T_WHITESPACE","\n\n    ",360],["T_DOC_COMMENT","\/**\n     * Delete user role\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return Mage_Admin_Model_Resource_User\n     *\/",362],["T_WHITESPACE","\n    ",367],["T_PUBLIC","public",368],["T_WHITESPACE"," ",368],["T_FUNCTION","function",368],["T_WHITESPACE"," ",368],["T_STRING","deleteFromRole",368],"(",["T_STRING","Mage_Core_Model_Abstract",368],["T_WHITESPACE"," ",368],["T_VARIABLE","$user",368],")",["T_WHITESPACE","\n    ",368],"{",["T_WHITESPACE","\n        ",369],["T_IF","if",370],["T_WHITESPACE"," ",370],"(",["T_WHITESPACE"," ",370],["T_VARIABLE","$user",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","getUserId",370],"(",")",["T_WHITESPACE"," ",370],["T_IS_SMALLER_OR_EQUAL","<=",370],["T_WHITESPACE"," ",370],["T_LNUMBER","0",370],["T_WHITESPACE"," ",370],")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n            ",370],["T_RETURN","return",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$this",371],";",["T_WHITESPACE","\n        ",371],"}",["T_WHITESPACE","\n        ",372],["T_IF","if",373],["T_WHITESPACE"," ",373],"(",["T_WHITESPACE"," ",373],["T_VARIABLE","$user",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getRoleId",373],"(",")",["T_WHITESPACE"," ",373],["T_IS_SMALLER_OR_EQUAL","<=",373],["T_WHITESPACE"," ",373],["T_LNUMBER","0",373],["T_WHITESPACE"," ",373],")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n            ",373],["T_RETURN","return",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$this",374],";",["T_WHITESPACE","\n        ",374],"}",["T_WHITESPACE","\n\n        ",375],["T_VARIABLE","$dbh",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","_getWriteAdapter",377],"(",")",";",["T_WHITESPACE","\n\n        ",377],["T_VARIABLE","$condition",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_ARRAY","array",379],"(",["T_WHITESPACE","\n            ",379],["T_CONSTANT_ENCAPSED_STRING","'user_id = ?'",380],["T_WHITESPACE","   ",380],["T_DOUBLE_ARROW","=>",380],["T_WHITESPACE"," ",380],["T_INT_CAST","(int)",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$user",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getId",380],"(",")",",",["T_WHITESPACE","\n            ",380],["T_CONSTANT_ENCAPSED_STRING","'parent_id = ?'",381],["T_WHITESPACE"," ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_INT_CAST","(int)",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$user",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","getRoleId",381],"(",")",",",["T_WHITESPACE","\n        ",381],")",";",["T_WHITESPACE","\n\n        ",382],["T_VARIABLE","$dbh",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","delete",384],"(",["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getTable",384],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",384],")",",",["T_WHITESPACE"," ",384],["T_VARIABLE","$condition",384],")",";",["T_WHITESPACE","\n        ",384],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$this",385],";",["T_WHITESPACE","\n    ",385],"}",["T_WHITESPACE","\n\n    ",386],["T_DOC_COMMENT","\/**\n     * Check if role user exists\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return array|false\n     *\/",388],["T_WHITESPACE","\n    ",393],["T_PUBLIC","public",394],["T_WHITESPACE"," ",394],["T_FUNCTION","function",394],["T_WHITESPACE"," ",394],["T_STRING","roleUserExists",394],"(",["T_STRING","Mage_Core_Model_Abstract",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$user",394],")",["T_WHITESPACE","\n    ",394],"{",["T_WHITESPACE","\n        ",395],["T_IF","if",396],["T_WHITESPACE"," ",396],"(",["T_WHITESPACE"," ",396],["T_VARIABLE","$user",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","getUserId",396],"(",")",["T_WHITESPACE"," ",396],">",["T_WHITESPACE"," ",396],["T_LNUMBER","0",396],["T_WHITESPACE"," ",396],")",["T_WHITESPACE"," ",396],"{",["T_WHITESPACE","\n            ",396],["T_VARIABLE","$roleTable",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getTable",397],"(",["T_CONSTANT_ENCAPSED_STRING","'admin\/role'",397],")",";",["T_WHITESPACE","\n\n            ",397],["T_VARIABLE","$dbh",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","_getReadAdapter",399],"(",")",";",["T_WHITESPACE","\n\n            ",399],["T_VARIABLE","$binds",401],["T_WHITESPACE"," ",401],"=",["T_WHITESPACE"," ",401],["T_ARRAY","array",401],"(",["T_WHITESPACE","\n                ",401],["T_CONSTANT_ENCAPSED_STRING","'parent_id'",402],["T_WHITESPACE"," ",402],["T_DOUBLE_ARROW","=>",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$user",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","getRoleId",402],"(",")",",",["T_WHITESPACE","\n                ",402],["T_CONSTANT_ENCAPSED_STRING","'user_id'",403],["T_WHITESPACE","   ",403],["T_DOUBLE_ARROW","=>",403],["T_WHITESPACE"," ",403],["T_VARIABLE","$user",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getUserId",403],"(",")",",",["T_WHITESPACE","\n            ",403],")",";",["T_WHITESPACE","\n\n            ",404],["T_VARIABLE","$select",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_VARIABLE","$dbh",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","select",406],"(",")",["T_OBJECT_OPERATOR","->",406],["T_STRING","from",406],"(",["T_VARIABLE","$roleTable",406],")",["T_WHITESPACE","\n                ",406],["T_OBJECT_OPERATOR","->",407],["T_STRING","where",407],"(",["T_CONSTANT_ENCAPSED_STRING","'parent_id = :parent_id'",407],")",["T_WHITESPACE","\n                ",407],["T_OBJECT_OPERATOR","->",408],["T_STRING","where",408],"(",["T_CONSTANT_ENCAPSED_STRING","'user_id = :user_id'",408],")",";",["T_WHITESPACE","\n\n            ",408],["T_RETURN","return",410],["T_WHITESPACE"," ",410],["T_VARIABLE","$dbh",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","fetchCol",410],"(",["T_VARIABLE","$select",410],",",["T_WHITESPACE"," ",410],["T_VARIABLE","$binds",410],")",";",["T_WHITESPACE","\n        ",410],"}",["T_WHITESPACE"," ",411],["T_ELSE","else",411],["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n            ",411],["T_RETURN","return",412],["T_WHITESPACE"," ",412],["T_ARRAY","array",412],"(",")",";",["T_WHITESPACE","\n        ",412],"}",["T_WHITESPACE","\n    ",413],"}",["T_WHITESPACE","\n\n    ",414],["T_DOC_COMMENT","\/**\n     * Check if user exists\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return array|false\n     *\/",416],["T_WHITESPACE","\n    ",421],["T_PUBLIC","public",422],["T_WHITESPACE"," ",422],["T_FUNCTION","function",422],["T_WHITESPACE"," ",422],["T_STRING","userExists",422],"(",["T_STRING","Mage_Core_Model_Abstract",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$user",422],")",["T_WHITESPACE","\n    ",422],"{",["T_WHITESPACE","\n        ",423],["T_VARIABLE","$adapter",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_VARIABLE","$this",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","_getReadAdapter",424],"(",")",";",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$select",425],["T_WHITESPACE"," ",425],"=",["T_WHITESPACE"," ",425],["T_VARIABLE","$adapter",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","select",425],"(",")",";",["T_WHITESPACE","\n\n        ",425],["T_VARIABLE","$binds",427],["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_ARRAY","array",427],"(",["T_WHITESPACE","\n            ",427],["T_CONSTANT_ENCAPSED_STRING","'username'",428],["T_WHITESPACE"," ",428],["T_DOUBLE_ARROW","=>",428],["T_WHITESPACE"," ",428],["T_VARIABLE","$user",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getUsername",428],"(",")",",",["T_WHITESPACE","\n            ",428],["T_CONSTANT_ENCAPSED_STRING","'email'",429],["T_WHITESPACE","    ",429],["T_DOUBLE_ARROW","=>",429],["T_WHITESPACE"," ",429],["T_VARIABLE","$user",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getEmail",429],"(",")",",",["T_WHITESPACE","\n            ",429],["T_CONSTANT_ENCAPSED_STRING","'user_id'",430],["T_WHITESPACE","  ",430],["T_DOUBLE_ARROW","=>",430],["T_WHITESPACE"," ",430],["T_INT_CAST","(int)",430],["T_WHITESPACE"," ",430],["T_VARIABLE","$user",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getId",430],"(",")",",",["T_WHITESPACE","\n        ",430],")",";",["T_WHITESPACE","\n\n        ",431],["T_VARIABLE","$select",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","from",433],"(",["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getMainTable",433],"(",")",")",["T_WHITESPACE","\n            ",433],["T_OBJECT_OPERATOR","->",434],["T_STRING","where",434],"(",["T_CONSTANT_ENCAPSED_STRING","'(username = :username OR email = :email)'",434],")",["T_WHITESPACE","\n            ",434],["T_OBJECT_OPERATOR","->",435],["T_STRING","where",435],"(",["T_CONSTANT_ENCAPSED_STRING","'user_id <> :user_id'",435],")",";",["T_WHITESPACE","\n\n        ",435],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$adapter",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","fetchRow",437],"(",["T_VARIABLE","$select",437],",",["T_WHITESPACE"," ",437],["T_VARIABLE","$binds",437],")",";",["T_WHITESPACE","\n    ",437],"}",["T_WHITESPACE","\n\n    ",438],["T_DOC_COMMENT","\/**\n     * Save user extra data\n     *\n     * @param Mage_Core_Model_Abstract $object\n     * @param string $data\n     * @return Mage_Admin_Model_Resource_User\n     *\/",440],["T_WHITESPACE","\n    ",446],["T_PUBLIC","public",447],["T_WHITESPACE"," ",447],["T_FUNCTION","function",447],["T_WHITESPACE"," ",447],["T_STRING","saveExtra",447],"(",["T_VARIABLE","$object",447],",",["T_WHITESPACE"," ",447],["T_VARIABLE","$data",447],")",["T_WHITESPACE","\n    ",447],"{",["T_WHITESPACE","\n        ",448],["T_IF","if",449],["T_WHITESPACE"," ",449],"(",["T_VARIABLE","$object",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getId",449],"(",")",")",["T_WHITESPACE"," ",449],"{",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","_getWriteAdapter",450],"(",")",["T_OBJECT_OPERATOR","->",450],["T_STRING","update",450],"(",["T_WHITESPACE","\n                ",450],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getMainTable",451],"(",")",",",["T_WHITESPACE","\n                ",451],["T_ARRAY","array",452],"(",["T_CONSTANT_ENCAPSED_STRING","'extra'",452],["T_WHITESPACE"," ",452],["T_DOUBLE_ARROW","=>",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$data",452],")",",",["T_WHITESPACE","\n                ",452],["T_ARRAY","array",453],"(",["T_CONSTANT_ENCAPSED_STRING","'user_id = ?'",453],["T_WHITESPACE"," ",453],["T_DOUBLE_ARROW","=>",453],["T_WHITESPACE"," ",453],["T_INT_CAST","(int)",453],["T_WHITESPACE"," ",453],["T_VARIABLE","$object",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","getId",453],"(",")",")",["T_WHITESPACE","\n            ",453],")",";",["T_WHITESPACE","\n        ",454],"}",["T_WHITESPACE","\n\n        ",455],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],";",["T_WHITESPACE","\n    ",457],"}",["T_WHITESPACE","\n\n    ",458],["T_DOC_COMMENT","\/**\n     * Unserializes user extra data\n     *\n     * @param Mage_Core_Model_Abstract $user\n     * @return Mage_Core_Model_Abstract\n     *\/",460],["T_WHITESPACE","\n    ",465],["T_PROTECTED","protected",466],["T_WHITESPACE"," ",466],["T_FUNCTION","function",466],["T_WHITESPACE"," ",466],["T_STRING","_unserializeExtraData",466],"(",["T_STRING","Mage_Core_Model_Abstract",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$user",466],")",["T_WHITESPACE","\n    ",466],"{",["T_WHITESPACE","\n        ",467],["T_TRY","try",468],["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n            ",468],["T_VARIABLE","$unsterilizedData",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_STRING","Mage",469],["T_DOUBLE_COLON","::",469],["T_STRING","helper",469],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/unserializeArray'",469],")",["T_OBJECT_OPERATOR","->",469],["T_STRING","unserialize",469],"(",["T_VARIABLE","$user",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getExtra",469],"(",")",")",";",["T_WHITESPACE","\n            ",469],["T_VARIABLE","$user",470],["T_OBJECT_OPERATOR","->",470],["T_STRING","setExtra",470],"(",["T_VARIABLE","$unsterilizedData",470],")",";",["T_WHITESPACE","\n        ",470],"}",["T_WHITESPACE"," ",471],["T_CATCH","catch",471],["T_WHITESPACE"," ",471],"(",["T_STRING","Exception",471],["T_WHITESPACE"," ",471],["T_VARIABLE","$e",471],")",["T_WHITESPACE"," ",471],"{",["T_WHITESPACE","\n            ",471],["T_VARIABLE","$user",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","setExtra",472],"(",["T_STRING","false",472],")",";",["T_WHITESPACE","\n        ",472],"}",["T_WHITESPACE","\n        ",473],["T_RETURN","return",474],["T_WHITESPACE"," ",474],["T_VARIABLE","$user",474],";",["T_WHITESPACE","\n    ",474],"}",["T_WHITESPACE","\n",475],"}",["T_WHITESPACE","\n",476]]