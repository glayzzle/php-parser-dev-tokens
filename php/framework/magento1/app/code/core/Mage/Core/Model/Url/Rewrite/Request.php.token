[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Url rewrite request model\n *\n * @category Mage\n * @package Mage_Core\n * @author Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Url_Rewrite_Request",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Instance of request\n     *\n     * @var Zend_Controller_Request_Http\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_request",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Instance of core config model\n     *\n     * @var Mage_Core_Model_Config\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_config",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Collection of front controller's routers\n     *\n     * @var array\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_routers",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_ARRAY","array",55],"(",")",";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Instance of url rewrite model\n     *\n     * @var Mage_Core_Model_Url_Rewrite\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_rewrite",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Application\n     *\n     * @var Mage_Core_Model_App\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PROTECTED","protected",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$_app",69],";",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Mage Factory model\n     *\n     * @var Mage_Core_Model_Factory\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$_factory",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Constructor\n     * Arguments:\n     *   request  - Zend_Controller_Request_Http\n     *   config   - Mage_Core_Model_Config\n     *   factory  - Mage_Core_Model_Factory\n     *   routers  - array\n     *\n     * @param array $args\n     *\/",78],["T_WHITESPACE","\n    ",87],["T_PUBLIC","public",88],["T_WHITESPACE"," ",88],["T_FUNCTION","function",88],["T_WHITESPACE"," ",88],["T_STRING","__construct",88],"(",["T_ARRAY","array",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$args",88],")",["T_WHITESPACE","\n    ",88],"{",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_factory",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],"!",["T_EMPTY","empty",90],"(",["T_VARIABLE","$args",90],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",90],"]",")",["T_WHITESPACE"," ",90],"?",["T_WHITESPACE"," ",90],["T_VARIABLE","$args",90],"[",["T_CONSTANT_ENCAPSED_STRING","'factory'",90],"]",["T_WHITESPACE"," ",90],":",["T_WHITESPACE"," ",90],["T_STRING","Mage",90],["T_DOUBLE_COLON","::",90],["T_STRING","getModel",90],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/factory'",90],")",";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_app",91],["T_WHITESPACE","     ",91],"=",["T_WHITESPACE"," ",91],"!",["T_EMPTY","empty",91],"(",["T_VARIABLE","$args",91],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",91],"]",")",["T_WHITESPACE"," ",91],"?",["T_WHITESPACE"," ",91],["T_VARIABLE","$args",91],"[",["T_CONSTANT_ENCAPSED_STRING","'app'",91],"]",["T_WHITESPACE"," ",91],":",["T_WHITESPACE"," ",91],["T_STRING","Mage",91],["T_DOUBLE_COLON","::",91],["T_STRING","app",91],"(",")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_config",92],["T_WHITESPACE","  ",92],"=",["T_WHITESPACE"," ",92],"!",["T_EMPTY","empty",92],"(",["T_VARIABLE","$args",92],"[",["T_CONSTANT_ENCAPSED_STRING","'config'",92],"]",")",["T_WHITESPACE"," ",92],"?",["T_WHITESPACE"," ",92],["T_VARIABLE","$args",92],"[",["T_CONSTANT_ENCAPSED_STRING","'config'",92],"]",["T_WHITESPACE"," ",92],":",["T_WHITESPACE"," ",92],["T_STRING","Mage",92],["T_DOUBLE_COLON","::",92],["T_STRING","getConfig",92],"(",")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_request",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],"!",["T_EMPTY","empty",93],"(",["T_VARIABLE","$args",93],"[",["T_CONSTANT_ENCAPSED_STRING","'request'",93],"]",")",["T_WHITESPACE","\n            ",93],"?",["T_WHITESPACE"," ",94],["T_VARIABLE","$args",94],"[",["T_CONSTANT_ENCAPSED_STRING","'request'",94],"]",["T_WHITESPACE"," ",94],":",["T_WHITESPACE"," ",94],["T_STRING","Mage",94],["T_DOUBLE_COLON","::",94],["T_STRING","app",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","getFrontController",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","getRequest",94],"(",")",";",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_rewrite",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],"!",["T_EMPTY","empty",95],"(",["T_VARIABLE","$args",95],"[",["T_CONSTANT_ENCAPSED_STRING","'rewrite'",95],"]",")",["T_WHITESPACE","\n            ",95],"?",["T_WHITESPACE"," ",96],["T_VARIABLE","$args",96],"[",["T_CONSTANT_ENCAPSED_STRING","'rewrite'",96],"]",["T_WHITESPACE"," ",96],":",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_factory",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getModel",96],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/url_rewrite'",96],")",";",["T_WHITESPACE","\n\n        ",96],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_EMPTY","empty",98],"(",["T_VARIABLE","$args",98],"[",["T_CONSTANT_ENCAPSED_STRING","'routers'",98],"]",")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_routers",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$args",99],"[",["T_CONSTANT_ENCAPSED_STRING","'routers'",99],"]",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Implement logic of custom rewrites\n     *\n     * @return bool\n     *\/",103],["T_WHITESPACE","\n    ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","rewrite",108],"(",")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(","!",["T_STRING","Mage",110],["T_DOUBLE_COLON","::",110],["T_STRING","isInstalled",110],"(",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_RETURN","return",111],["T_WHITESPACE"," ",111],["T_STRING","false",111],";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n\n        ",112],["T_IF","if",114],["T_WHITESPACE"," ",114],"(","!",["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_request",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","isStraight",114],"(",")",")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_STRING","Varien_Profiler",115],["T_DOUBLE_COLON","::",115],["T_STRING","start",115],"(",["T_CONSTANT_ENCAPSED_STRING","'mage::dispatch::db_url_rewrite'",115],")",";",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","_rewriteDb",116],"(",")",";",["T_WHITESPACE","\n            ",116],["T_STRING","Varien_Profiler",117],["T_DOUBLE_COLON","::",117],["T_STRING","stop",117],"(",["T_CONSTANT_ENCAPSED_STRING","'mage::dispatch::db_url_rewrite'",117],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n\n        ",118],["T_STRING","Varien_Profiler",120],["T_DOUBLE_COLON","::",120],["T_STRING","start",120],"(",["T_CONSTANT_ENCAPSED_STRING","'mage::dispatch::config_url_rewrite'",120],")",";",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_rewriteConfig",121],"(",")",";",["T_WHITESPACE","\n        ",121],["T_STRING","Varien_Profiler",122],["T_DOUBLE_COLON","::",122],["T_STRING","stop",122],"(",["T_CONSTANT_ENCAPSED_STRING","'mage::dispatch::config_url_rewrite'",122],")",";",["T_WHITESPACE","\n\n        ",122],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_STRING","true",124],";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * Implement logic of custom rewrites\n     *\n     * @return bool\n     *\/",127],["T_WHITESPACE","\n    ",131],["T_PROTECTED","protected",132],["T_WHITESPACE"," ",132],["T_FUNCTION","function",132],["T_WHITESPACE"," ",132],["T_STRING","_rewriteDb",132],"(",")",["T_WHITESPACE","\n    ",132],"{",["T_WHITESPACE","\n        ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_STRING","null",134],["T_WHITESPACE"," ",134],["T_IS_IDENTICAL","===",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_rewrite",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getStoreId",134],"(",")",["T_WHITESPACE"," ",134],["T_BOOLEAN_OR","||",134],["T_WHITESPACE"," ",134],["T_STRING","false",134],["T_WHITESPACE"," ",134],["T_IS_IDENTICAL","===",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_rewrite",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getStoreId",134],"(",")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_rewrite",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","setStoreId",135],"(",["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_app",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getStore",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getId",135],"(",")",")",";",["T_WHITESPACE","\n        ",135],"}",["T_WHITESPACE","\n\n        ",136],["T_VARIABLE","$requestCases",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_getRequestCases",138],"(",")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_rewrite",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","loadByRequestPath",139],"(",["T_VARIABLE","$requestCases",139],")",";",["T_WHITESPACE","\n\n        ",139],["T_VARIABLE","$fromStore",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_request",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getQuery",141],"(",["T_CONSTANT_ENCAPSED_STRING","'___from_store'",141],")",";",["T_WHITESPACE","\n        ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","!",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","_rewrite",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getId",142],"(",")",["T_WHITESPACE"," ",142],["T_BOOLEAN_AND","&&",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$fromStore",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n            ",142],["T_VARIABLE","$stores",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_app",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getStores",143],"(",["T_STRING","false",143],",",["T_WHITESPACE"," ",143],["T_STRING","true",143],")",";",["T_WHITESPACE","\n            ",143],["T_IF","if",144],["T_WHITESPACE"," ",144],"(","!",["T_EMPTY","empty",144],"(",["T_VARIABLE","$stores",144],"[",["T_VARIABLE","$fromStore",144],"]",")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n                ",144],["T_DOC_COMMENT","\/** @var $store Mage_Core_Model_Store *\/",145],["T_WHITESPACE","\n                ",145],["T_VARIABLE","$store",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$stores",146],"[",["T_VARIABLE","$fromStore",146],"]",";",["T_WHITESPACE","\n                ",146],["T_VARIABLE","$fromStoreId",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$store",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getId",147],"(",")",";",["T_WHITESPACE","\n            ",147],"}",["T_WHITESPACE"," ",148],["T_ELSE","else",148],["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n                ",148],["T_RETURN","return",149],["T_WHITESPACE"," ",149],["T_STRING","false",149],";",["T_WHITESPACE","\n            ",149],"}",["T_WHITESPACE","\n\n            ",150],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_rewrite",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","setStoreId",152],"(",["T_VARIABLE","$fromStoreId",152],")",["T_OBJECT_OPERATOR","->",152],["T_STRING","loadByRequestPath",152],"(",["T_VARIABLE","$requestCases",152],")",";",["T_WHITESPACE","\n            ",152],["T_IF","if",153],["T_WHITESPACE"," ",153],"(","!",["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_rewrite",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getId",153],"(",")",")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n                ",153],["T_RETURN","return",154],["T_WHITESPACE"," ",154],["T_STRING","false",154],";",["T_WHITESPACE","\n            ",154],"}",["T_WHITESPACE","\n\n            ",155],["T_COMMENT","\/\/ Load rewrite by id_path\n",157],["T_WHITESPACE","            ",158],["T_VARIABLE","$currentStore",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_app",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getStore",158],"(",")",";",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_rewrite",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","setStoreId",159],"(",["T_VARIABLE","$currentStore",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getId",159],"(",")",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","loadByIdPath",159],"(",["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_rewrite",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getIdPath",159],"(",")",")",";",["T_WHITESPACE","\n\n            ",159],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_setStoreCodeCookie",161],"(",["T_VARIABLE","$currentStore",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getCode",161],"(",")",")",";",["T_WHITESPACE","\n\n            ",161],["T_VARIABLE","$targetUrl",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$currentStore",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getBaseUrl",163],"(",")",["T_WHITESPACE"," ",163],".",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_rewrite",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getRequestPath",163],"(",")",";",["T_WHITESPACE","\n            ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_sendRedirectHeaders",164],"(",["T_VARIABLE","$targetUrl",164],",",["T_WHITESPACE"," ",164],["T_STRING","true",164],")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_IF","if",167],["T_WHITESPACE"," ",167],"(","!",["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","_rewrite",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getId",167],"(",")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_STRING","false",168],";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n\n        ",169],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_request",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setAlias",171],"(",["T_STRING","Mage_Core_Model_Url_Rewrite",171],["T_DOUBLE_COLON","::",171],["T_STRING","REWRITE_REQUEST_PATH_ALIAS",171],",",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_rewrite",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getRequestPath",172],"(",")",")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_processRedirectOptions",173],"(",")",";",["T_WHITESPACE","\n\n        ",173],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_STRING","true",175],";",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n\n    ",176],["T_DOC_COMMENT","\/**\n     * Set store code to a cookie\n     *\n     * @param string $storeCode\n     *\/",178],["T_WHITESPACE","\n    ",182],["T_PROTECTED","protected",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","_setStoreCodeCookie",183],"(",["T_VARIABLE","$storeCode",183],")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$store",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_app",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getStore",185],"(",["T_VARIABLE","$storeCode",185],")",";",["T_WHITESPACE","\n        ",185],["T_IF","if",186],["T_WHITESPACE"," ",186],"(",["T_VARIABLE","$store",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getWebsite",186],"(",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","getDefaultStore",186],"(",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","getId",186],"(",")",["T_WHITESPACE"," ",186],["T_IS_EQUAL","==",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$store",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getId",186],"(",")",")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_app",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getCookie",187],"(",")",["T_OBJECT_OPERATOR","->",187],["T_STRING","delete",187],"(",["T_STRING","Mage_Core_Model_Store",187],["T_DOUBLE_COLON","::",187],["T_STRING","COOKIE_NAME",187],")",";",["T_WHITESPACE","\n        ",187],"}",["T_WHITESPACE"," ",188],["T_ELSE","else",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_app",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getCookie",189],"(",")",["T_OBJECT_OPERATOR","->",189],["T_STRING","set",189],"(",["T_STRING","Mage_Core_Model_Store",189],["T_DOUBLE_COLON","::",189],["T_STRING","COOKIE_NAME",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$storeCode",189],",",["T_WHITESPACE"," ",189],["T_STRING","true",189],")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n    ",190],"}",["T_WHITESPACE","\n\n    ",191],["T_DOC_COMMENT","\/**\n     * Process redirect (R) and permanent redirect (RP)\n     *\n     * @return Mage_Core_Model_Url_Rewrite_Request\n     *\/",193],["T_WHITESPACE","\n    ",197],["T_PROTECTED","protected",198],["T_WHITESPACE"," ",198],["T_FUNCTION","function",198],["T_WHITESPACE"," ",198],["T_STRING","_processRedirectOptions",198],"(",")",["T_WHITESPACE","\n    ",198],"{",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$isPermanentRedirectOption",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_rewrite",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","hasOption",200],"(",["T_CONSTANT_ENCAPSED_STRING","'RP'",200],")",";",["T_WHITESPACE","\n\n        ",200],["T_VARIABLE","$external",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","substr",202],"(",["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_rewrite",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getTargetPath",202],"(",")",",",["T_WHITESPACE"," ",202],["T_LNUMBER","0",202],",",["T_WHITESPACE"," ",202],["T_LNUMBER","6",202],")",";",["T_WHITESPACE","\n        ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(",["T_VARIABLE","$external",203],["T_WHITESPACE"," ",203],["T_IS_IDENTICAL","===",203],["T_WHITESPACE"," ",203],["T_CONSTANT_ENCAPSED_STRING","'http:\/'",203],["T_WHITESPACE"," ",203],["T_BOOLEAN_OR","||",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$external",203],["T_WHITESPACE"," ",203],["T_IS_IDENTICAL","===",203],["T_WHITESPACE"," ",203],["T_CONSTANT_ENCAPSED_STRING","'https:'",203],")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_VARIABLE","$destinationStoreCode",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_app",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getStore",204],"(",["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_rewrite",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getStoreId",204],"(",")",")",["T_OBJECT_OPERATOR","->",204],["T_STRING","getCode",204],"(",")",";",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_setStoreCodeCookie",205],"(",["T_VARIABLE","$destinationStoreCode",205],")",";",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_sendRedirectHeaders",206],"(",["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_rewrite",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getTargetPath",206],"(",")",",",["T_WHITESPACE"," ",206],["T_VARIABLE","$isPermanentRedirectOption",206],")",";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$targetUrl",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_request",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getBaseUrl",209],"(",")",["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'\/'",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","_rewrite",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getTargetPath",209],"(",")",";",["T_WHITESPACE","\n\n        ",209],["T_VARIABLE","$storeCode",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_app",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getStore",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","getCode",211],"(",")",";",["T_WHITESPACE","\n        ",211],["T_IF","if",212],["T_WHITESPACE"," ",212],"(",["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","getStoreConfig",212],"(",["T_CONSTANT_ENCAPSED_STRING","'web\/url\/use_store'",212],")",["T_WHITESPACE"," ",212],["T_BOOLEAN_AND","&&",212],["T_WHITESPACE"," ",212],"!",["T_EMPTY","empty",212],"(",["T_VARIABLE","$storeCode",212],")",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$targetUrl",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_request",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getBaseUrl",213],"(",")",["T_WHITESPACE"," ",213],".",["T_WHITESPACE"," ",213],["T_CONSTANT_ENCAPSED_STRING","'\/'",213],["T_WHITESPACE"," ",213],".",["T_WHITESPACE"," ",213],["T_VARIABLE","$storeCode",213],["T_WHITESPACE"," ",213],".",["T_WHITESPACE"," ",213],["T_CONSTANT_ENCAPSED_STRING","'\/'",213],["T_WHITESPACE"," ",213],".",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_rewrite",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getTargetPath",213],"(",")",";",["T_WHITESPACE","\n        ",213],"}",["T_WHITESPACE","\n\n        ",214],["T_IF","if",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","_rewrite",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","hasOption",216],"(",["T_CONSTANT_ENCAPSED_STRING","'R'",216],")",["T_WHITESPACE"," ",216],["T_BOOLEAN_OR","||",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$isPermanentRedirectOption",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_sendRedirectHeaders",217],"(",["T_VARIABLE","$targetUrl",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$isPermanentRedirectOption",217],")",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n\n        ",218],["T_VARIABLE","$queryString",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","_getQueryString",220],"(",")",";",["T_WHITESPACE","\n        ",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(",["T_VARIABLE","$queryString",221],")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n            ",221],["T_VARIABLE","$targetUrl",222],["T_WHITESPACE"," ",222],["T_CONCAT_EQUAL",".=",222],["T_WHITESPACE"," ",222],["T_CONSTANT_ENCAPSED_STRING","'?'",222],["T_WHITESPACE"," ",222],".",["T_WHITESPACE"," ",222],["T_VARIABLE","$queryString",222],";",["T_WHITESPACE","\n        ",222],"}",["T_WHITESPACE","\n\n        ",223],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_request",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","setRequestUri",225],"(",["T_VARIABLE","$targetUrl",225],")",";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_request",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","setPathInfo",226],"(",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_rewrite",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","getTargetPath",226],"(",")",")",";",["T_WHITESPACE","\n\n        ",226],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_DOC_COMMENT","\/**\n     * Apply configuration rewrites to current url\n     *\n     * @return bool\n     *\/",231],["T_WHITESPACE","\n    ",235],["T_PROTECTED","protected",236],["T_WHITESPACE"," ",236],["T_FUNCTION","function",236],["T_WHITESPACE"," ",236],["T_STRING","_rewriteConfig",236],"(",")",["T_WHITESPACE","\n    ",236],"{",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$config",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_config",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getNode",238],"(",["T_CONSTANT_ENCAPSED_STRING","'global\/rewrite'",238],")",";",["T_WHITESPACE","\n        ",238],["T_IF","if",239],["T_WHITESPACE"," ",239],"(","!",["T_VARIABLE","$config",239],")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_STRING","false",240],";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n        ",241],["T_FOREACH","foreach",242],["T_WHITESPACE"," ",242],"(",["T_VARIABLE","$config",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","children",242],"(",")",["T_WHITESPACE"," ",242],["T_AS","as",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$rewrite",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n            ",242],["T_VARIABLE","$from",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_STRING_CAST","(string)",243],["T_VARIABLE","$rewrite",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","from",243],";",["T_WHITESPACE","\n            ",243],["T_VARIABLE","$to",244],["T_WHITESPACE"," ",244],"=",["T_WHITESPACE"," ",244],["T_STRING_CAST","(string)",244],["T_VARIABLE","$rewrite",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","to",244],";",["T_WHITESPACE","\n            ",244],["T_IF","if",245],["T_WHITESPACE"," ",245],"(",["T_EMPTY","empty",245],"(",["T_VARIABLE","$from",245],")",["T_WHITESPACE"," ",245],["T_BOOLEAN_OR","||",245],["T_WHITESPACE"," ",245],["T_EMPTY","empty",245],"(",["T_VARIABLE","$to",245],")",")",["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n                ",245],["T_CONTINUE","continue",246],";",["T_WHITESPACE","\n            ",246],"}",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$from",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","_processRewriteUrl",248],"(",["T_VARIABLE","$from",248],")",";",["T_WHITESPACE","\n            ",248],["T_VARIABLE","$to",249],["T_WHITESPACE","   ",249],"=",["T_WHITESPACE"," ",249],["T_VARIABLE","$this",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","_processRewriteUrl",249],"(",["T_VARIABLE","$to",249],")",";",["T_WHITESPACE","\n\n            ",249],["T_VARIABLE","$pathInfo",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_STRING","preg_replace",251],"(",["T_VARIABLE","$from",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$to",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","_request",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getPathInfo",251],"(",")",")",";",["T_WHITESPACE","\n            ",251],["T_IF","if",252],["T_WHITESPACE"," ",252],"(",["T_ISSET","isset",252],"(",["T_VARIABLE","$rewrite",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","complete",252],")",")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n                ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_request",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","setPathInfo",253],"(",["T_VARIABLE","$pathInfo",253],")",";",["T_WHITESPACE","\n            ",253],"}",["T_WHITESPACE"," ",254],["T_ELSE","else",254],["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n                ",254],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","_request",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","rewritePathInfo",255],"(",["T_VARIABLE","$pathInfo",255],")",";",["T_WHITESPACE","\n            ",255],"}",["T_WHITESPACE","\n        ",256],"}",["T_WHITESPACE","\n        ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_STRING","true",258],";",["T_WHITESPACE","\n    ",258],"}",["T_WHITESPACE","\n\n    ",259],["T_DOC_COMMENT","\/**\n     * Prepare request cases.\n     *\n     * We have two cases of incoming paths - with and without slashes at the end (\"\/somepath\/\" and \"\/somepath\").\n     * Each of them matches two url rewrite request paths\n     * - with and without slashes at the end (\"\/somepath\/\" and \"\/somepath\").\n     * Choose any matched rewrite, but in priority order that depends on same presence of slash and query params.\n     *\n     * @return array\n     *\/",261],["T_WHITESPACE","\n    ",270],["T_PROTECTED","protected",271],["T_WHITESPACE"," ",271],["T_FUNCTION","function",271],["T_WHITESPACE"," ",271],["T_STRING","_getRequestCases",271],"(",")",["T_WHITESPACE","\n    ",271],"{",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$pathInfo",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","_request",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getPathInfo",273],"(",")",";",["T_WHITESPACE","\n        ",273],["T_VARIABLE","$requestPath",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_STRING","trim",274],"(",["T_VARIABLE","$pathInfo",274],",",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'\/'",274],")",";",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$origSlash",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],"(",["T_STRING","substr",275],"(",["T_VARIABLE","$pathInfo",275],",",["T_WHITESPACE"," ",275],"-",["T_LNUMBER","1",275],")",["T_WHITESPACE"," ",275],["T_IS_EQUAL","==",275],["T_WHITESPACE"," ",275],["T_CONSTANT_ENCAPSED_STRING","'\/'",275],")",["T_WHITESPACE"," ",275],"?",["T_WHITESPACE"," ",275],["T_CONSTANT_ENCAPSED_STRING","'\/'",275],["T_WHITESPACE"," ",275],":",["T_WHITESPACE"," ",275],["T_CONSTANT_ENCAPSED_STRING","''",275],";",["T_WHITESPACE","\n        ",275],["T_COMMENT","\/\/ If there were final slash - add nothing to less priority paths. And vice versa.\n",276],["T_WHITESPACE","        ",277],["T_VARIABLE","$altSlash",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_VARIABLE","$origSlash",277],["T_WHITESPACE"," ",277],"?",["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","''",277],["T_WHITESPACE"," ",277],":",["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","'\/'",277],";",["T_WHITESPACE","\n\n        ",277],["T_VARIABLE","$requestCases",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_ARRAY","array",279],"(",")",";",["T_WHITESPACE","\n        ",279],["T_COMMENT","\/\/ Query params in request, matching \"path + query\" has more priority\n",280],["T_WHITESPACE","        ",281],["T_VARIABLE","$queryString",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","_getQueryString",281],"(",")",";",["T_WHITESPACE","\n        ",281],["T_IF","if",282],["T_WHITESPACE"," ",282],"(",["T_VARIABLE","$queryString",282],")",["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n            ",282],["T_VARIABLE","$requestCases",283],"[","]",["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$requestPath",283],["T_WHITESPACE"," ",283],".",["T_WHITESPACE"," ",283],["T_VARIABLE","$origSlash",283],["T_WHITESPACE"," ",283],".",["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'?'",283],["T_WHITESPACE"," ",283],".",["T_WHITESPACE"," ",283],["T_VARIABLE","$queryString",283],";",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$requestCases",284],"[","]",["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$requestPath",284],["T_WHITESPACE"," ",284],".",["T_WHITESPACE"," ",284],["T_VARIABLE","$altSlash",284],["T_WHITESPACE"," ",284],".",["T_WHITESPACE"," ",284],["T_CONSTANT_ENCAPSED_STRING","'?'",284],["T_WHITESPACE"," ",284],".",["T_WHITESPACE"," ",284],["T_VARIABLE","$queryString",284],";",["T_WHITESPACE","\n        ",284],"}",["T_WHITESPACE","\n        ",285],["T_VARIABLE","$requestCases",286],"[","]",["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$requestPath",286],["T_WHITESPACE"," ",286],".",["T_WHITESPACE"," ",286],["T_VARIABLE","$origSlash",286],";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$requestCases",287],"[","]",["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_VARIABLE","$requestPath",287],["T_WHITESPACE"," ",287],".",["T_WHITESPACE"," ",287],["T_VARIABLE","$altSlash",287],";",["T_WHITESPACE","\n        ",287],["T_RETURN","return",288],["T_WHITESPACE"," ",288],["T_VARIABLE","$requestCases",288],";",["T_WHITESPACE","\n    ",288],"}",["T_WHITESPACE","\n\n    ",289],["T_DOC_COMMENT","\/**\n     * Add location header and disable browser page caching\n     *\n     * @param string $url\n     * @param bool $isPermanent\n     *\/",291],["T_WHITESPACE","\n    ",296],["T_PROTECTED","protected",297],["T_WHITESPACE"," ",297],["T_FUNCTION","function",297],["T_WHITESPACE"," ",297],["T_STRING","_sendRedirectHeaders",297],"(",["T_VARIABLE","$url",297],",",["T_WHITESPACE"," ",297],["T_VARIABLE","$isPermanent",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_STRING","false",297],")",["T_WHITESPACE","\n    ",297],"{",["T_WHITESPACE","\n        ",298],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_VARIABLE","$isPermanent",299],")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n            ",299],["T_STRING","header",300],"(",["T_CONSTANT_ENCAPSED_STRING","'HTTP\/1.1 301 Moved Permanently'",300],")",";",["T_WHITESPACE","\n        ",300],"}",["T_WHITESPACE","\n\n        ",301],["T_STRING","header",303],"(",["T_CONSTANT_ENCAPSED_STRING","'Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0'",303],")",";",["T_WHITESPACE","\n        ",303],["T_STRING","header",304],"(",["T_CONSTANT_ENCAPSED_STRING","'Pragma: no-cache'",304],")",";",["T_WHITESPACE","\n        ",304],["T_STRING","header",305],"(",["T_CONSTANT_ENCAPSED_STRING","'Location: '",305],["T_WHITESPACE"," ",305],".",["T_WHITESPACE"," ",305],["T_VARIABLE","$url",305],")",";",["T_WHITESPACE","\n        ",305],["T_EXIT","exit",306],";",["T_WHITESPACE","\n    ",306],"}",["T_WHITESPACE","\n\n    ",307],["T_DOC_COMMENT","\/**\n     * Prepare and return QUERY_STRING\n     *\n     * @return bool|string\n     *\/",309],["T_WHITESPACE","\n    ",313],["T_PROTECTED","protected",314],["T_WHITESPACE"," ",314],["T_FUNCTION","function",314],["T_WHITESPACE"," ",314],["T_STRING","_getQueryString",314],"(",")",["T_WHITESPACE","\n    ",314],"{",["T_WHITESPACE","\n        ",315],["T_IF","if",316],["T_WHITESPACE"," ",316],"(","!",["T_EMPTY","empty",316],"(",["T_VARIABLE","$_SERVER",316],"[",["T_CONSTANT_ENCAPSED_STRING","'QUERY_STRING'",316],"]",")",")",["T_WHITESPACE"," ",316],"{",["T_WHITESPACE","\n            ",316],["T_VARIABLE","$queryParams",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_ARRAY","array",317],"(",")",";",["T_WHITESPACE","\n            ",317],["T_STRING","parse_str",318],"(",["T_VARIABLE","$_SERVER",318],"[",["T_CONSTANT_ENCAPSED_STRING","'QUERY_STRING'",318],"]",",",["T_WHITESPACE"," ",318],["T_VARIABLE","$queryParams",318],")",";",["T_WHITESPACE","\n            ",318],["T_VARIABLE","$hasChanges",319],["T_WHITESPACE"," ",319],"=",["T_WHITESPACE"," ",319],["T_STRING","false",319],";",["T_WHITESPACE","\n            ",319],["T_FOREACH","foreach",320],["T_WHITESPACE"," ",320],"(",["T_VARIABLE","$queryParams",320],["T_WHITESPACE"," ",320],["T_AS","as",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$key",320],["T_WHITESPACE"," ",320],["T_DOUBLE_ARROW","=>",320],["T_WHITESPACE"," ",320],["T_VARIABLE","$value",320],")",["T_WHITESPACE"," ",320],"{",["T_WHITESPACE","\n                ",320],["T_IF","if",321],["T_WHITESPACE"," ",321],"(",["T_STRING","substr",321],"(",["T_VARIABLE","$key",321],",",["T_WHITESPACE"," ",321],["T_LNUMBER","0",321],",",["T_WHITESPACE"," ",321],["T_LNUMBER","3",321],")",["T_WHITESPACE"," ",321],["T_IS_IDENTICAL","===",321],["T_WHITESPACE"," ",321],["T_CONSTANT_ENCAPSED_STRING","'___'",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n                    ",321],["T_UNSET","unset",322],"(",["T_VARIABLE","$queryParams",322],"[",["T_VARIABLE","$key",322],"]",")",";",["T_WHITESPACE","\n                    ",322],["T_VARIABLE","$hasChanges",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_STRING","true",323],";",["T_WHITESPACE","\n                ",323],"}",["T_WHITESPACE","\n            ",324],"}",["T_WHITESPACE","\n            ",325],["T_IF","if",326],["T_WHITESPACE"," ",326],"(",["T_VARIABLE","$hasChanges",326],")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n                ",326],["T_RETURN","return",327],["T_WHITESPACE"," ",327],["T_STRING","http_build_query",327],"(",["T_VARIABLE","$queryParams",327],")",";",["T_WHITESPACE","\n            ",327],"}",["T_WHITESPACE"," ",328],["T_ELSE","else",328],["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n                ",328],["T_RETURN","return",329],["T_WHITESPACE"," ",329],["T_VARIABLE","$_SERVER",329],"[",["T_CONSTANT_ENCAPSED_STRING","'QUERY_STRING'",329],"]",";",["T_WHITESPACE","\n            ",329],"}",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n        ",331],["T_RETURN","return",332],["T_WHITESPACE"," ",332],["T_STRING","false",332],";",["T_WHITESPACE","\n    ",332],"}",["T_WHITESPACE","\n\n    ",333],["T_DOC_COMMENT","\/**\n     * Replace route name placeholders in url to front name\n     *\n     * @param string $url\n     * @return string\n     *\/",335],["T_WHITESPACE","\n    ",340],["T_PROTECTED","protected",341],["T_WHITESPACE"," ",341],["T_FUNCTION","function",341],["T_WHITESPACE"," ",341],["T_STRING","_processRewriteUrl",341],"(",["T_VARIABLE","$url",341],")",["T_WHITESPACE","\n    ",341],"{",["T_WHITESPACE","\n        ",342],["T_VARIABLE","$startPos",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_STRING","strpos",343],"(",["T_VARIABLE","$url",343],",",["T_WHITESPACE"," ",343],["T_CONSTANT_ENCAPSED_STRING","'{'",343],")",";",["T_WHITESPACE","\n        ",343],["T_IF","if",344],["T_WHITESPACE"," ",344],"(",["T_VARIABLE","$startPos",344],["T_WHITESPACE"," ",344],["T_IS_NOT_IDENTICAL","!==",344],["T_WHITESPACE"," ",344],["T_STRING","false",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n            ",344],["T_VARIABLE","$endPos",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_STRING","strpos",345],"(",["T_VARIABLE","$url",345],",",["T_WHITESPACE"," ",345],["T_CONSTANT_ENCAPSED_STRING","'}'",345],")",";",["T_WHITESPACE","\n            ",345],["T_VARIABLE","$routeName",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_STRING","substr",346],"(",["T_VARIABLE","$url",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$startPos",346],["T_WHITESPACE"," ",346],"+",["T_WHITESPACE"," ",346],["T_LNUMBER","1",346],",",["T_WHITESPACE"," ",346],["T_VARIABLE","$endPos",346],["T_WHITESPACE"," ",346],"-",["T_WHITESPACE"," ",346],["T_VARIABLE","$startPos",346],["T_WHITESPACE"," ",346],"-",["T_WHITESPACE"," ",346],["T_LNUMBER","1",346],")",";",["T_WHITESPACE","\n            ",346],["T_VARIABLE","$router",347],["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","_getRouterByRoute",347],"(",["T_VARIABLE","$routeName",347],")",";",["T_WHITESPACE","\n            ",347],["T_IF","if",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$router",348],")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n                ",348],["T_VARIABLE","$frontName",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$router",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getFrontNameByRoute",349],"(",["T_VARIABLE","$routeName",349],")",";",["T_WHITESPACE","\n                ",349],["T_VARIABLE","$url",350],["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_STRING","str_replace",350],"(",["T_CONSTANT_ENCAPSED_STRING","'{'",350],["T_WHITESPACE"," ",350],".",["T_WHITESPACE"," ",350],["T_VARIABLE","$routeName",350],["T_WHITESPACE"," ",350],".",["T_WHITESPACE"," ",350],["T_CONSTANT_ENCAPSED_STRING","'}'",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$frontName",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$url",350],")",";",["T_WHITESPACE","\n            ",350],"}",["T_WHITESPACE","\n        ",351],"}",["T_WHITESPACE","\n        ",352],["T_RETURN","return",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$url",353],";",["T_WHITESPACE","\n    ",353],"}",["T_WHITESPACE","\n\n    ",354],["T_DOC_COMMENT","\/**\n     * Retrieve router by name\n     *\n     * @param string $name\n     * @return Mage_Core_Controller_Varien_Router_Abstract|bool\n     *\/",356],["T_WHITESPACE","\n    ",361],["T_PROTECTED","protected",362],["T_WHITESPACE"," ",362],["T_FUNCTION","function",362],["T_WHITESPACE"," ",362],["T_STRING","_getRouter",362],"(",["T_VARIABLE","$name",362],")",["T_WHITESPACE","\n    ",362],"{",["T_WHITESPACE","\n        ",363],["T_IF","if",364],["T_WHITESPACE"," ",364],"(",["T_ISSET","isset",364],"(",["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_routers",364],"[",["T_VARIABLE","$name",364],"]",")",")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n            ",364],["T_RETURN","return",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$this",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","_routers",365],"[",["T_VARIABLE","$name",365],"]",";",["T_WHITESPACE","\n        ",365],"}",["T_WHITESPACE","\n        ",366],["T_RETURN","return",367],["T_WHITESPACE"," ",367],["T_STRING","false",367],";",["T_WHITESPACE","\n    ",367],"}",["T_WHITESPACE","\n\n    ",368],["T_DOC_COMMENT","\/**\n     * Retrieve router by name\n     *\n     * @param string $routeName\n     * @return Mage_Core_Controller_Varien_Router_Abstract\n     *\/",370],["T_WHITESPACE","\n    ",375],["T_PROTECTED","protected",376],["T_WHITESPACE"," ",376],["T_FUNCTION","function",376],["T_WHITESPACE"," ",376],["T_STRING","_getRouterByRoute",376],"(",["T_VARIABLE","$routeName",376],")",["T_WHITESPACE","\n    ",376],"{",["T_WHITESPACE","\n        ",377],["T_COMMENT","\/\/ empty route supplied - return base url\n",378],["T_WHITESPACE","        ",379],["T_IF","if",379],["T_WHITESPACE"," ",379],"(",["T_EMPTY","empty",379],"(",["T_VARIABLE","$routeName",379],")",")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n            ",379],["T_VARIABLE","$router",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","_getRouter",380],"(",["T_CONSTANT_ENCAPSED_STRING","'standard'",380],")",";",["T_WHITESPACE","\n        ",380],"}",["T_WHITESPACE"," ",381],["T_ELSEIF","elseif",381],["T_WHITESPACE"," ",381],"(",["T_VARIABLE","$this",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","_getRouter",381],"(",["T_CONSTANT_ENCAPSED_STRING","'admin'",381],")",["T_OBJECT_OPERATOR","->",381],["T_STRING","getFrontNameByRoute",381],"(",["T_VARIABLE","$routeName",381],")",")",["T_WHITESPACE"," ",381],"{",["T_WHITESPACE","\n            ",381],["T_COMMENT","\/\/ try standard router url assembly\n",382],["T_WHITESPACE","            ",383],["T_VARIABLE","$router",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_VARIABLE","$this",383],["T_OBJECT_OPERATOR","->",383],["T_STRING","_getRouter",383],"(",["T_CONSTANT_ENCAPSED_STRING","'admin'",383],")",";",["T_WHITESPACE","\n        ",383],"}",["T_WHITESPACE"," ",384],["T_ELSEIF","elseif",384],["T_WHITESPACE"," ",384],"(",["T_VARIABLE","$this",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","_getRouter",384],"(",["T_CONSTANT_ENCAPSED_STRING","'standard'",384],")",["T_OBJECT_OPERATOR","->",384],["T_STRING","getFrontNameByRoute",384],"(",["T_VARIABLE","$routeName",384],")",")",["T_WHITESPACE"," ",384],"{",["T_WHITESPACE","\n            ",384],["T_COMMENT","\/\/ try standard router url assembly\n",385],["T_WHITESPACE","            ",386],["T_VARIABLE","$router",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_getRouter",386],"(",["T_CONSTANT_ENCAPSED_STRING","'standard'",386],")",";",["T_WHITESPACE","\n        ",386],"}",["T_WHITESPACE"," ",387],["T_ELSE","else",387],["T_WHITESPACE"," ",387],"{",["T_WHITESPACE","\n            ",387],["T_COMMENT","\/\/ try custom router url assembly\n",388],["T_WHITESPACE","            ",389],["T_VARIABLE","$router",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_VARIABLE","$this",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","_getRouter",389],"(",["T_VARIABLE","$routeName",389],")",";",["T_WHITESPACE","\n            ",389],["T_IF","if",390],["T_WHITESPACE"," ",390],"(","!",["T_VARIABLE","$router",390],")",["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n                ",390],["T_COMMENT","\/\/ get default router url\n",391],["T_WHITESPACE","                ",392],["T_VARIABLE","$router",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","_getRouter",392],"(",["T_CONSTANT_ENCAPSED_STRING","'default'",392],")",";",["T_WHITESPACE","\n            ",392],"}",["T_WHITESPACE","\n        ",393],"}",["T_WHITESPACE","\n        ",394],["T_RETURN","return",395],["T_WHITESPACE"," ",395],["T_VARIABLE","$router",395],";",["T_WHITESPACE","\n    ",395],"}",["T_WHITESPACE","\n",396],"}",["T_WHITESPACE","\n",397]]