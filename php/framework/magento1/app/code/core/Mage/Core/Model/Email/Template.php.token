[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Template model\n *\n * Example:\n *\n * \/\/ Loading of template\n * $emailTemplate  = Mage::getModel('core\/email_template')\n *    ->load(Mage::getStoreConfig('path_to_email_template_id_config'));\n * $variables = array(\n *    'someObject' => Mage::getSingleton('some_model')\n *    'someString' => 'Some string value'\n * );\n * $emailTemplate->send('some@domain.com', 'Name Of User', $variables);\n *\n * @method Mage_Core_Model_Resource_Email_Template _getResource()\n * @method Mage_Core_Model_Resource_Email_Template getResource()\n * @method string getTemplateCode()\n * @method Mage_Core_Model_Email_Template setTemplateCode(string $value)\n * @method string getTemplateText()\n * @method Mage_Core_Model_Email_Template setTemplateText(string $value)\n * @method string getTemplateStyles()\n * @method Mage_Core_Model_Email_Template setTemplateStyles(string $value)\n * @method int getTemplateType()\n * @method Mage_Core_Model_Email_Template setTemplateType(int $value)\n * @method string getTemplateSubject()\n * @method Mage_Core_Model_Email_Template setTemplateSubject(string $value)\n * @method string getTemplateSenderName()\n * @method Mage_Core_Model_Email_Template setTemplateSenderName(string $value)\n * @method string getTemplateSenderEmail()\n * @method Mage_Core_Model_Email_Template setTemplateSenderEmail(string $value)\n * @method string getAddedAt()\n * @method Mage_Core_Model_Email_Template setAddedAt(string $value)\n * @method string getModifiedAt()\n * @method Mage_Core_Model_Email_Template setModifiedAt(string $value)\n * @method string getOrigTemplateCode()\n * @method Mage_Core_Model_Email_Template setOrigTemplateCode(string $value)\n * @method string getOrigTemplateVariables()\n * @method Mage_Core_Model_Email_Template setOrigTemplateVariables(string $value)\n * @method Mage_Core_Model_Email_Template setQueue(Mage_Core_Model_Abstract $value)\n * @method Mage_Core_Model_Email_Queue getQueue()\n * @method int hasQueue()\n *\n * @category    Mage\n * @package     Mage_Core\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",72],["T_CLASS","class",73],["T_WHITESPACE"," ",73],["T_STRING","Mage_Core_Model_Email_Template",73],["T_WHITESPACE"," ",73],["T_EXTENDS","extends",73],["T_WHITESPACE"," ",73],["T_STRING","Mage_Core_Model_Email_Template_Abstract",73],["T_WHITESPACE","\n",73],"{",["T_WHITESPACE","\n    ",74],["T_DOC_COMMENT","\/**\n     * Configuration path for default email templates\n     *\/",75],["T_WHITESPACE","\n    ",77],["T_CONST","const",78],["T_WHITESPACE"," ",78],["T_STRING","XML_PATH_TEMPLATE_EMAIL",78],["T_WHITESPACE","               ",78],"=",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'global\/template\/email'",78],";",["T_WHITESPACE","\n    ",78],["T_CONST","const",79],["T_WHITESPACE"," ",79],["T_STRING","XML_PATH_SENDING_SET_RETURN_PATH",79],["T_WHITESPACE","      ",79],"=",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'system\/smtp\/set_return_path'",79],";",["T_WHITESPACE","\n    ",79],["T_CONST","const",80],["T_WHITESPACE"," ",80],["T_STRING","XML_PATH_SENDING_RETURN_PATH_EMAIL",80],["T_WHITESPACE","    ",80],"=",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'system\/smtp\/return_path_email'",80],";",["T_WHITESPACE","\n\n    ",80],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$_templateFilter",82],";",["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$_preprocessFlag",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","false",83],";",["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$_mail",84],";",["T_WHITESPACE","\n    ",84],["T_PROTECTED","protected",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$_bccEmails",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_ARRAY","array",85],"(",")",";",["T_WHITESPACE","\n\n    ",85],["T_STATIC","static",87],["T_WHITESPACE"," ",87],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$_defaultTemplates",87],";",["T_WHITESPACE","\n\n    ",87],["T_DOC_COMMENT","\/**\n     * Initialize email template model\n     *\n     *\/",89],["T_WHITESPACE","\n    ",92],["T_PROTECTED","protected",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","_construct",93],"(",")",["T_WHITESPACE","\n    ",93],"{",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_init",95],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template'",95],")",";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Retrieve mail object instance\n     *\n     * @return Zend_Mail\n     *\/",98],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getMail",103],"(",")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(",["T_STRING","is_null",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_mail",105],")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_mail",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_NEW","new",106],["T_WHITESPACE"," ",106],["T_STRING","Zend_Mail",106],"(",["T_CONSTANT_ENCAPSED_STRING","'utf-8'",106],")",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_mail",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Declare template processing filter\n     *\n     * @param   Varien_Filter_Template $filter\n     * @return  Mage_Core_Model_Email_Template\n     *\/",111],["T_WHITESPACE","\n    ",116],["T_PUBLIC","public",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","setTemplateFilter",117],"(",["T_STRING","Varien_Filter_Template",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$filter",117],")",["T_WHITESPACE","\n    ",117],"{",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_templateFilter",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$filter",119],";",["T_WHITESPACE","\n        ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Get filter object for template processing logi\n     *\n     * @return Mage_Core_Model_Email_Template_Filter\n     *\/",123],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","getTemplateFilter",128],"(",")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_EMPTY","empty",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_templateFilter",130],")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_templateFilter",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","Mage",131],["T_DOUBLE_COLON","::",131],["T_STRING","getModel",131],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template_filter'",131],")",";",["T_WHITESPACE","\n            ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_templateFilter",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","setUseAbsoluteLinks",132],"(",["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getUseAbsoluteLinks",132],"(",")",")",["T_WHITESPACE","\n                ",132],["T_OBJECT_OPERATOR","->",133],["T_STRING","setStoreId",133],"(",["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getDesignConfig",133],"(",")",["T_OBJECT_OPERATOR","->",133],["T_STRING","getStore",133],"(",")",")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n        ",134],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_templateFilter",135],";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Load template by code\n     *\n     * @param   string $templateCode\n     * @return   Mage_Core_Model_Email_Template\n     *\/",138],["T_WHITESPACE","\n    ",143],["T_PUBLIC","public",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","loadByCode",144],"(",["T_VARIABLE","$templateCode",144],")",["T_WHITESPACE","\n    ",144],"{",["T_WHITESPACE","\n        ",145],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","addData",146],"(",["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getResource",146],"(",")",["T_OBJECT_OPERATOR","->",146],["T_STRING","loadByCode",146],"(",["T_VARIABLE","$templateCode",146],")",")",";",["T_WHITESPACE","\n        ",146],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Load default email template from locale translate\n     *\n     * @param string $templateId\n     * @param string $locale\n     *\/",150],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","loadDefault",156],"(",["T_VARIABLE","$templateId",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$locale",156],"=",["T_STRING","null",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$defaultTemplates",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","self",158],["T_DOUBLE_COLON","::",158],["T_STRING","getDefaultTemplates",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(","!",["T_ISSET","isset",159],"(",["T_VARIABLE","$defaultTemplates",159],"[",["T_VARIABLE","$templateId",159],"]",")",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_RETURN","return",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],";",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n\n        ",161],["T_VARIABLE","$data",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],"&",["T_VARIABLE","$defaultTemplates",163],"[",["T_VARIABLE","$templateId",163],"]",";",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setTemplateType",164],"(",["T_VARIABLE","$data",164],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",164],"]",["T_IS_EQUAL","==",164],["T_CONSTANT_ENCAPSED_STRING","'html'",164],["T_WHITESPACE"," ",164],"?",["T_WHITESPACE"," ",164],["T_STRING","self",164],["T_DOUBLE_COLON","::",164],["T_STRING","TYPE_HTML",164],["T_WHITESPACE"," ",164],":",["T_WHITESPACE"," ",164],["T_STRING","self",164],["T_DOUBLE_COLON","::",164],["T_STRING","TYPE_TEXT",164],")",";",["T_WHITESPACE","\n\n        ",164],["T_VARIABLE","$templateText",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_STRING","Mage",166],["T_DOUBLE_COLON","::",166],["T_STRING","app",166],"(",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","getTranslator",166],"(",")",["T_OBJECT_OPERATOR","->",166],["T_STRING","getTemplateFile",166],"(",["T_WHITESPACE","\n            ",166],["T_VARIABLE","$data",167],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",167],"]",",",["T_WHITESPACE"," ",167],["T_CONSTANT_ENCAPSED_STRING","'email'",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$locale",167],["T_WHITESPACE","\n        ",167],")",";",["T_WHITESPACE","\n\n        ",168],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_STRING","preg_match",170],"(",["T_CONSTANT_ENCAPSED_STRING","'\/<!--@subject\\s*(.*?)\\s*@-->\/u'",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$templateText",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$matches",170],")",")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setTemplateSubject",171],"(",["T_VARIABLE","$matches",171],"[",["T_LNUMBER","1",171],"]",")",";",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$templateText",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","str_replace",172],"(",["T_VARIABLE","$matches",172],"[",["T_LNUMBER","0",172],"]",",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","''",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$templateText",172],")",";",["T_WHITESPACE","\n        ",172],"}",["T_WHITESPACE","\n\n        ",173],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_STRING","preg_match",175],"(",["T_CONSTANT_ENCAPSED_STRING","'\/<!--@vars\\s*((?:.)*?)\\s*@-->\/us'",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$templateText",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$matches",175],")",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","setData",176],"(",["T_CONSTANT_ENCAPSED_STRING","'orig_template_variables'",176],",",["T_WHITESPACE"," ",176],["T_STRING","str_replace",176],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",176],",",["T_WHITESPACE"," ",176],["T_CONSTANT_ENCAPSED_STRING","''",176],",",["T_WHITESPACE"," ",176],["T_VARIABLE","$matches",176],"[",["T_LNUMBER","1",176],"]",")",")",";",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$templateText",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","str_replace",177],"(",["T_VARIABLE","$matches",177],"[",["T_LNUMBER","0",177],"]",",",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","''",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$templateText",177],")",";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n\n        ",178],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_STRING","preg_match",180],"(",["T_CONSTANT_ENCAPSED_STRING","'\/<!--@styles\\s*(.*?)\\s*@-->\/s'",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$templateText",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$matches",180],")",")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n           ",180],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","setTemplateStyles",181],"(",["T_VARIABLE","$matches",181],"[",["T_LNUMBER","1",181],"]",")",";",["T_WHITESPACE","\n           ",181],["T_VARIABLE","$templateText",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","str_replace",182],"(",["T_VARIABLE","$matches",182],"[",["T_LNUMBER","0",182],"]",",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","''",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$templateText",182],")",";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n\n        ",183],["T_DOC_COMMENT","\/**\n         * Remove comment lines\n         *\/",185],["T_WHITESPACE","\n        ",187],["T_VARIABLE","$templateText",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","preg_replace",188],"(",["T_CONSTANT_ENCAPSED_STRING","'#\\{\\*.*\\*\\}#suU'",188],",",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","''",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$templateText",188],")",";",["T_WHITESPACE","\n\n        ",188],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","setTemplateText",190],"(",["T_VARIABLE","$templateText",190],")",";",["T_WHITESPACE","\n        ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","setId",191],"(",["T_VARIABLE","$templateId",191],")",";",["T_WHITESPACE","\n\n        ",191],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],";",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n\n    ",194],["T_DOC_COMMENT","\/**\n     * Retrive default templates from config\n     *\n     * @return array\n     *\/",196],["T_WHITESPACE","\n    ",200],["T_STATIC","static",201],["T_WHITESPACE"," ",201],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","getDefaultTemplates",201],"(",")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_IF","if",203],"(",["T_STRING","is_null",203],"(",["T_STRING","self",203],["T_DOUBLE_COLON","::",203],["T_VARIABLE","$_defaultTemplates",203],")",")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n            ",203],["T_STRING","self",204],["T_DOUBLE_COLON","::",204],["T_VARIABLE","$_defaultTemplates",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_STRING","Mage",204],["T_DOUBLE_COLON","::",204],["T_STRING","getConfig",204],"(",")",["T_OBJECT_OPERATOR","->",204],["T_STRING","getNode",204],"(",["T_STRING","self",204],["T_DOUBLE_COLON","::",204],["T_STRING","XML_PATH_TEMPLATE_EMAIL",204],")",["T_OBJECT_OPERATOR","->",204],["T_STRING","asArray",204],"(",")",";",["T_WHITESPACE","\n        ",204],"}",["T_WHITESPACE","\n\n        ",205],["T_RETURN","return",207],["T_WHITESPACE"," ",207],["T_STRING","self",207],["T_DOUBLE_COLON","::",207],["T_VARIABLE","$_defaultTemplates",207],";",["T_WHITESPACE","\n    ",207],"}",["T_WHITESPACE","\n\n    ",208],["T_DOC_COMMENT","\/**\n     * Retrive default templates as options array\n     *\n     * @return array\n     *\/",210],["T_WHITESPACE","\n    ",214],["T_STATIC","static",215],["T_WHITESPACE"," ",215],["T_PUBLIC","public",215],["T_WHITESPACE"," ",215],["T_FUNCTION","function",215],["T_WHITESPACE"," ",215],["T_STRING","getDefaultTemplatesAsOptionsArray",215],"(",")",["T_WHITESPACE","\n    ",215],"{",["T_WHITESPACE","\n        ",216],["T_VARIABLE","$options",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_ARRAY","array",217],"(",["T_WHITESPACE","\n            ",217],["T_ARRAY","array",218],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",218],["T_DOUBLE_ARROW","=>",218],["T_CONSTANT_ENCAPSED_STRING","''",218],",",["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","'label'",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","''",218],")",["T_WHITESPACE","\n        ",218],")",";",["T_WHITESPACE","\n\n        ",219],["T_VARIABLE","$idLabel",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_ARRAY","array",221],"(",")",";",["T_WHITESPACE","\n        ",221],["T_FOREACH","foreach",222],["T_WHITESPACE"," ",222],"(",["T_STRING","self",222],["T_DOUBLE_COLON","::",222],["T_STRING","getDefaultTemplates",222],"(",")",["T_WHITESPACE"," ",222],["T_AS","as",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$templateId",222],["T_WHITESPACE"," ",222],["T_DOUBLE_ARROW","=>",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$row",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_ISSET","isset",223],"(",["T_VARIABLE","$row",223],"[",["T_CONSTANT_ENCAPSED_STRING","'@'",223],"]",")",["T_WHITESPACE"," ",223],["T_BOOLEAN_AND","&&",223],["T_WHITESPACE"," ",223],["T_ISSET","isset",223],"(",["T_VARIABLE","$row",223],"[",["T_CONSTANT_ENCAPSED_STRING","'@'",223],"]","[",["T_CONSTANT_ENCAPSED_STRING","'module'",223],"]",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$module",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$row",224],"[",["T_CONSTANT_ENCAPSED_STRING","'@'",224],"]","[",["T_CONSTANT_ENCAPSED_STRING","'module'",224],"]",";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE"," ",225],["T_ELSE","else",225],["T_WHITESPACE"," ",225],"{",["T_WHITESPACE","\n                ",225],["T_VARIABLE","$module",226],["T_WHITESPACE"," ",226],"=",["T_WHITESPACE"," ",226],["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",226],";",["T_WHITESPACE","\n            ",226],"}",["T_WHITESPACE","\n            ",227],["T_VARIABLE","$idLabel",228],"[",["T_VARIABLE","$templateId",228],"]",["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_STRING","Mage",228],["T_DOUBLE_COLON","::",228],["T_STRING","helper",228],"(",["T_VARIABLE","$module",228],")",["T_OBJECT_OPERATOR","->",228],["T_STRING","__",228],"(",["T_VARIABLE","$row",228],"[",["T_CONSTANT_ENCAPSED_STRING","'label'",228],"]",")",";",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n        ",229],["T_STRING","asort",230],"(",["T_VARIABLE","$idLabel",230],")",";",["T_WHITESPACE","\n        ",230],["T_FOREACH","foreach",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$idLabel",231],["T_WHITESPACE"," ",231],["T_AS","as",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$templateId",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$label",231],")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n            ",231],["T_VARIABLE","$options",232],"[","]",["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_ARRAY","array",232],"(",["T_CONSTANT_ENCAPSED_STRING","'value'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$templateId",232],",",["T_WHITESPACE"," ",232],["T_CONSTANT_ENCAPSED_STRING","'label'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$label",232],")",";",["T_WHITESPACE","\n        ",232],"}",["T_WHITESPACE","\n\n        ",233],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$options",235],";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_DOC_COMMENT","\/**\n     * Return template id\n     * return int|null\n     *\/",238],["T_WHITESPACE","\n    ",241],["T_PUBLIC","public",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","getId",242],"(",")",["T_WHITESPACE","\n    ",242],"{",["T_WHITESPACE","\n        ",243],["T_RETURN","return",244],["T_WHITESPACE"," ",244],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getTemplateId",244],"(",")",";",["T_WHITESPACE","\n    ",244],"}",["T_WHITESPACE","\n\n    ",245],["T_DOC_COMMENT","\/**\n     * Set id of template\n     * @param int $value\n     *\/",247],["T_WHITESPACE","\n    ",250],["T_PUBLIC","public",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","setId",251],"(",["T_VARIABLE","$value",251],")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_RETURN","return",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","setTemplateId",253],"(",["T_VARIABLE","$value",253],")",";",["T_WHITESPACE","\n    ",253],"}",["T_WHITESPACE","\n\n    ",254],["T_DOC_COMMENT","\/**\n     * Return true if this template can be used for sending queue as main template\n     *\n     * @return boolean\n     *\/",256],["T_WHITESPACE","\n    ",260],["T_PUBLIC","public",261],["T_WHITESPACE"," ",261],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","isValidForSend",261],"(",")",["T_WHITESPACE","\n    ",261],"{",["T_WHITESPACE","\n        ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],"!",["T_STRING","Mage",263],["T_DOUBLE_COLON","::",263],["T_STRING","getStoreConfigFlag",263],"(",["T_CONSTANT_ENCAPSED_STRING","'system\/smtp\/disable'",263],")",["T_WHITESPACE","\n            ",263],["T_BOOLEAN_AND","&&",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getSenderName",264],"(",")",["T_WHITESPACE","\n            ",264],["T_BOOLEAN_AND","&&",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getSenderEmail",265],"(",")",["T_WHITESPACE","\n            ",265],["T_BOOLEAN_AND","&&",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getTemplateSubject",266],"(",")",";",["T_WHITESPACE","\n    ",266],"}",["T_WHITESPACE","\n\n    ",267],["T_DOC_COMMENT","\/**\n     * Getter for template type\n     *\n     * @return int|string\n     *\/",269],["T_WHITESPACE","\n    ",273],["T_PUBLIC","public",274],["T_WHITESPACE"," ",274],["T_FUNCTION","function",274],["T_WHITESPACE"," ",274],["T_STRING","getType",274],"(",")","{",["T_WHITESPACE","\n        ",274],["T_RETURN","return",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getTemplateType",275],"(",")",";",["T_WHITESPACE","\n    ",275],"}",["T_WHITESPACE","\n\n    ",276],["T_DOC_COMMENT","\/**\n     * Process email template code\n     *\n     * @param   array $variables\n     * @return  string\n     *\/",278],["T_WHITESPACE","\n    ",283],["T_PUBLIC","public",284],["T_WHITESPACE"," ",284],["T_FUNCTION","function",284],["T_WHITESPACE"," ",284],["T_STRING","getProcessedTemplate",284],"(",["T_ARRAY","array",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$variables",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_ARRAY","array",284],"(",")",")",["T_WHITESPACE","\n    ",284],"{",["T_WHITESPACE","\n        ",285],["T_VARIABLE","$processor",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getTemplateFilter",286],"(",")",";",["T_WHITESPACE","\n        ",286],["T_VARIABLE","$processor",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","setUseSessionInUrl",287],"(",["T_STRING","false",287],")",["T_WHITESPACE","\n            ",287],["T_OBJECT_OPERATOR","->",288],["T_STRING","setPlainTemplateMode",288],"(",["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","isPlain",288],"(",")",")",";",["T_WHITESPACE","\n\n        ",288],["T_IF","if",290],["T_WHITESPACE"," ",290],"(","!",["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_preprocessFlag",290],")",["T_WHITESPACE"," ",290],"{",["T_WHITESPACE","\n            ",290],["T_VARIABLE","$variables",291],"[",["T_CONSTANT_ENCAPSED_STRING","'this'",291],"]",["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$this",291],";",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n\n        ",292],["T_IF","if",294],["T_WHITESPACE"," ",294],"(",["T_ISSET","isset",294],"(",["T_VARIABLE","$variables",294],"[",["T_CONSTANT_ENCAPSED_STRING","'subscriber'",294],"]",")",["T_WHITESPACE"," ",294],["T_BOOLEAN_AND","&&",294],["T_WHITESPACE"," ",294],"(",["T_VARIABLE","$variables",294],"[",["T_CONSTANT_ENCAPSED_STRING","'subscriber'",294],"]",["T_WHITESPACE"," ",294],["T_INSTANCEOF","instanceof",294],["T_WHITESPACE"," ",294],["T_STRING","Mage_Newsletter_Model_Subscriber",294],")",")",["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n            ",294],["T_VARIABLE","$processor",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","setStoreId",295],"(",["T_VARIABLE","$variables",295],"[",["T_CONSTANT_ENCAPSED_STRING","'subscriber'",295],"]",["T_OBJECT_OPERATOR","->",295],["T_STRING","getStoreId",295],"(",")",")",";",["T_WHITESPACE","\n        ",295],"}",["T_WHITESPACE","\n\n        ",296],["T_COMMENT","\/\/ Apply design config so that all subsequent code will run within the context of the correct store\n",298],["T_WHITESPACE","        ",299],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","_applyDesignConfig",299],"(",")",";",["T_WHITESPACE","\n\n        ",299],["T_COMMENT","\/\/ Populate the variables array with store, store info, logo, etc. variables\n",301],["T_WHITESPACE","        ",302],["T_VARIABLE","$variables",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_addEmailVariables",302],"(",["T_VARIABLE","$variables",302],",",["T_WHITESPACE"," ",302],["T_VARIABLE","$processor",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","getStoreId",302],"(",")",")",";",["T_WHITESPACE","\n\n        ",302],["T_VARIABLE","$processor",304],["T_WHITESPACE","\n            ",304],["T_OBJECT_OPERATOR","->",305],["T_STRING","setTemplateProcessor",305],"(",["T_ARRAY","array",305],"(",["T_VARIABLE","$this",305],",",["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","'getTemplateByConfigPath'",305],")",")",["T_WHITESPACE","\n            ",305],["T_OBJECT_OPERATOR","->",306],["T_STRING","setIncludeProcessor",306],"(",["T_ARRAY","array",306],"(",["T_VARIABLE","$this",306],",",["T_WHITESPACE"," ",306],["T_CONSTANT_ENCAPSED_STRING","'getInclude'",306],")",")",["T_WHITESPACE","\n            ",306],["T_OBJECT_OPERATOR","->",307],["T_STRING","setVariables",307],"(",["T_VARIABLE","$variables",307],")",";",["T_WHITESPACE","\n\n        ",307],["T_TRY","try",309],["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n            ",309],["T_COMMENT","\/\/ Filter the template text so that all HTML content will be present\n",310],["T_WHITESPACE","            ",311],["T_VARIABLE","$result",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$processor",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","filter",311],"(",["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getTemplateText",311],"(",")",")",";",["T_WHITESPACE","\n            ",311],["T_COMMENT","\/\/ If the {{inlinecss file=\"\"}} directive was included in the template, grab filename to use for inlining\n",312],["T_WHITESPACE","            ",313],["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","setInlineCssFile",313],"(",["T_VARIABLE","$processor",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getInlineCssFile",313],"(",")",")",";",["T_WHITESPACE","\n            ",313],["T_COMMENT","\/\/ Now that all HTML has been assembled, run email through CSS inlining process\n",314],["T_WHITESPACE","            ",315],["T_VARIABLE","$processedResult",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getPreparedTemplateText",315],"(",["T_VARIABLE","$result",315],")",";",["T_WHITESPACE","\n        ",315],"}",["T_WHITESPACE","\n        ",316],["T_CATCH","catch",317],["T_WHITESPACE"," ",317],"(",["T_STRING","Exception",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$e",317],")",["T_WHITESPACE","   ",317],"{",["T_WHITESPACE","\n            ",317],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","_cancelDesignConfig",318],"(",")",";",["T_WHITESPACE","\n            ",318],["T_THROW","throw",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$e",319],";",["T_WHITESPACE","\n        ",319],"}",["T_WHITESPACE","\n        ",320],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","_cancelDesignConfig",321],"(",")",";",["T_WHITESPACE","\n        ",321],["T_RETURN","return",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$processedResult",322],";",["T_WHITESPACE","\n    ",322],"}",["T_WHITESPACE","\n\n    ",323],["T_DOC_COMMENT","\/**\n     * Makes additional text preparations for HTML templates\n     *\n     * @return string\n     *\/",325],["T_WHITESPACE","\n    ",329],["T_DOC_COMMENT","\/**\n     * @param null $html\n     * @return null|string\n     *\/",330],["T_WHITESPACE","\n    ",333],["T_PUBLIC","public",334],["T_WHITESPACE"," ",334],["T_FUNCTION","function",334],["T_WHITESPACE"," ",334],["T_STRING","getPreparedTemplateText",334],"(",["T_VARIABLE","$html",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_STRING","null",334],")",["T_WHITESPACE","\n    ",334],"{",["T_WHITESPACE","\n\n        ",335],["T_IF","if",337],["T_WHITESPACE"," ",337],"(",["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","isPlain",337],"(",")",["T_WHITESPACE"," ",337],["T_BOOLEAN_AND","&&",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$html",337],")",["T_WHITESPACE"," ",337],"{",["T_WHITESPACE","\n            ",337],["T_RETURN","return",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$html",338],";",["T_WHITESPACE","\n        ",338],"}",["T_WHITESPACE"," ",339],["T_ELSEIF","elseif",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","isPlain",339],"(",")",")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_RETURN","return",340],["T_WHITESPACE"," ",340],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","getTemplateText",340],"(",")",";",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n\n        ",341],["T_RETURN","return",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","_applyInlineCss",343],"(",["T_VARIABLE","$html",343],")",";",["T_WHITESPACE","\n    ",343],"}",["T_WHITESPACE","\n\n    ",344],["T_DOC_COMMENT","\/**\n     * Get template code for include directive\n     *\n     * @param   string $template\n     * @param   array $variables\n     * @return  string\n     *\/",346],["T_WHITESPACE","\n    ",352],["T_PUBLIC","public",353],["T_WHITESPACE"," ",353],["T_FUNCTION","function",353],["T_WHITESPACE"," ",353],["T_STRING","getInclude",353],"(",["T_VARIABLE","$template",353],",",["T_WHITESPACE"," ",353],["T_ARRAY","array",353],["T_WHITESPACE"," ",353],["T_VARIABLE","$variables",353],")",["T_WHITESPACE","\n    ",353],"{",["T_WHITESPACE","\n        ",354],["T_VARIABLE","$thisClass",355],["T_WHITESPACE"," ",355],"=",["T_WHITESPACE"," ",355],["T_CLASS_C","__CLASS__",355],";",["T_WHITESPACE","\n        ",355],["T_VARIABLE","$includeTemplate",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_NEW","new",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$thisClass",356],"(",")",";",["T_WHITESPACE","\n\n        ",356],["T_VARIABLE","$includeTemplate",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","loadByCode",358],"(",["T_VARIABLE","$template",358],")",";",["T_WHITESPACE","\n\n        ",358],["T_RETURN","return",360],["T_WHITESPACE"," ",360],["T_VARIABLE","$includeTemplate",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","getProcessedTemplate",360],"(",["T_VARIABLE","$variables",360],")",";",["T_WHITESPACE","\n    ",360],"}",["T_WHITESPACE","\n\n    ",361],["T_DOC_COMMENT","\/**\n     * Send mail to recipient\n     *\n     * @param   array|string       $email        E-mail(s)\n     * @param   array|string|null  $name         receiver name(s)\n     * @param   array              $variables    template variables\n     * @return  boolean\n     **\/",363],["T_WHITESPACE","\n    ",370],["T_PUBLIC","public",371],["T_WHITESPACE"," ",371],["T_FUNCTION","function",371],["T_WHITESPACE"," ",371],["T_STRING","send",371],"(",["T_VARIABLE","$email",371],",",["T_WHITESPACE"," ",371],["T_VARIABLE","$name",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_STRING","null",371],",",["T_WHITESPACE"," ",371],["T_ARRAY","array",371],["T_WHITESPACE"," ",371],["T_VARIABLE","$variables",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_ARRAY","array",371],"(",")",")",["T_WHITESPACE","\n    ",371],"{",["T_WHITESPACE","\n        ",372],["T_IF","if",373],["T_WHITESPACE"," ",373],"(","!",["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","isValidForSend",373],"(",")",")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n            ",373],["T_STRING","Mage",374],["T_DOUBLE_COLON","::",374],["T_STRING","logException",374],"(",["T_NEW","new",374],["T_WHITESPACE"," ",374],["T_STRING","Exception",374],"(",["T_CONSTANT_ENCAPSED_STRING","'This letter cannot be sent.'",374],")",")",";",["T_WHITESPACE"," ",374],["T_COMMENT","\/\/ translation is intentionally omitted\n",374],["T_WHITESPACE","            ",375],["T_RETURN","return",375],["T_WHITESPACE"," ",375],["T_STRING","false",375],";",["T_WHITESPACE","\n        ",375],"}",["T_WHITESPACE","\n\n        ",376],["T_VARIABLE","$emails",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_STRING","array_values",378],"(",["T_ARRAY_CAST","(array)",378],["T_VARIABLE","$email",378],")",";",["T_WHITESPACE","\n        ",378],["T_VARIABLE","$names",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_STRING","is_array",379],"(",["T_VARIABLE","$name",379],")",["T_WHITESPACE"," ",379],"?",["T_WHITESPACE"," ",379],["T_VARIABLE","$name",379],["T_WHITESPACE"," ",379],":",["T_WHITESPACE"," ",379],["T_ARRAY_CAST","(array)",379],["T_VARIABLE","$name",379],";",["T_WHITESPACE","\n        ",379],["T_VARIABLE","$names",380],["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_STRING","array_values",380],"(",["T_VARIABLE","$names",380],")",";",["T_WHITESPACE","\n        ",380],["T_FOREACH","foreach",381],["T_WHITESPACE"," ",381],"(",["T_VARIABLE","$emails",381],["T_WHITESPACE"," ",381],["T_AS","as",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$key",381],["T_WHITESPACE"," ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$email",381],")",["T_WHITESPACE"," ",381],"{",["T_WHITESPACE","\n            ",381],["T_IF","if",382],["T_WHITESPACE"," ",382],"(","!",["T_ISSET","isset",382],"(",["T_VARIABLE","$names",382],"[",["T_VARIABLE","$key",382],"]",")",")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n                ",382],["T_VARIABLE","$names",383],"[",["T_VARIABLE","$key",383],"]",["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_STRING","substr",383],"(",["T_VARIABLE","$email",383],",",["T_WHITESPACE"," ",383],["T_LNUMBER","0",383],",",["T_WHITESPACE"," ",383],["T_STRING","strpos",383],"(",["T_VARIABLE","$email",383],",",["T_WHITESPACE"," ",383],["T_CONSTANT_ENCAPSED_STRING","'@'",383],")",")",";",["T_WHITESPACE","\n            ",383],"}",["T_WHITESPACE","\n        ",384],"}",["T_WHITESPACE","\n\n        ",385],["T_VARIABLE","$variables",387],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",387],"]",["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],["T_STRING","reset",387],"(",["T_VARIABLE","$emails",387],")",";",["T_WHITESPACE","\n        ",387],["T_VARIABLE","$variables",388],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",388],"]",["T_WHITESPACE"," ",388],"=",["T_WHITESPACE"," ",388],["T_STRING","reset",388],"(",["T_VARIABLE","$names",388],")",";",["T_WHITESPACE","\n\n        ",388],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","setUseAbsoluteLinks",390],"(",["T_STRING","true",390],")",";",["T_WHITESPACE","\n        ",390],["T_VARIABLE","$text",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getProcessedTemplate",391],"(",["T_VARIABLE","$variables",391],",",["T_WHITESPACE"," ",391],["T_STRING","true",391],")",";",["T_WHITESPACE","\n        ",391],["T_VARIABLE","$subject",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","getProcessedTemplateSubject",392],"(",["T_VARIABLE","$variables",392],")",";",["T_WHITESPACE","\n\n        ",392],["T_VARIABLE","$setReturnPath",394],["T_WHITESPACE"," ",394],"=",["T_WHITESPACE"," ",394],["T_STRING","Mage",394],["T_DOUBLE_COLON","::",394],["T_STRING","getStoreConfig",394],"(",["T_STRING","self",394],["T_DOUBLE_COLON","::",394],["T_STRING","XML_PATH_SENDING_SET_RETURN_PATH",394],")",";",["T_WHITESPACE","\n        ",394],["T_SWITCH","switch",395],["T_WHITESPACE"," ",395],"(",["T_VARIABLE","$setReturnPath",395],")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n            ",395],["T_CASE","case",396],["T_WHITESPACE"," ",396],["T_LNUMBER","1",396],":",["T_WHITESPACE","\n                ",396],["T_VARIABLE","$returnPathEmail",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getSenderEmail",397],"(",")",";",["T_WHITESPACE","\n                ",397],["T_BREAK","break",398],";",["T_WHITESPACE","\n            ",398],["T_CASE","case",399],["T_WHITESPACE"," ",399],["T_LNUMBER","2",399],":",["T_WHITESPACE","\n                ",399],["T_VARIABLE","$returnPathEmail",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_STRING","Mage",400],["T_DOUBLE_COLON","::",400],["T_STRING","getStoreConfig",400],"(",["T_STRING","self",400],["T_DOUBLE_COLON","::",400],["T_STRING","XML_PATH_SENDING_RETURN_PATH_EMAIL",400],")",";",["T_WHITESPACE","\n                ",400],["T_BREAK","break",401],";",["T_WHITESPACE","\n            ",401],["T_DEFAULT","default",402],":",["T_WHITESPACE","\n                ",402],["T_VARIABLE","$returnPathEmail",403],["T_WHITESPACE"," ",403],"=",["T_WHITESPACE"," ",403],["T_STRING","null",403],";",["T_WHITESPACE","\n                ",403],["T_BREAK","break",404],";",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE","\n\n        ",405],["T_IF","if",407],["T_WHITESPACE"," ",407],"(",["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","hasQueue",407],"(",")",["T_WHITESPACE"," ",407],["T_BOOLEAN_AND","&&",407],["T_WHITESPACE"," ",407],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","getQueue",407],"(",")",["T_WHITESPACE"," ",407],["T_INSTANCEOF","instanceof",407],["T_WHITESPACE"," ",407],["T_STRING","Mage_Core_Model_Email_Queue",407],")",["T_WHITESPACE"," ",407],"{",["T_WHITESPACE","\n            ",407],["T_DOC_COMMENT","\/** @var $emailQueue Mage_Core_Model_Email_Queue *\/",408],["T_WHITESPACE","\n            ",408],["T_VARIABLE","$emailQueue",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getQueue",409],"(",")",";",["T_WHITESPACE","\n            ",409],["T_VARIABLE","$emailQueue",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","clearRecipients",410],"(",")",";",["T_WHITESPACE","\n            ",410],["T_VARIABLE","$emailQueue",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","setMessageBody",411],"(",["T_VARIABLE","$text",411],")",";",["T_WHITESPACE","\n            ",411],["T_VARIABLE","$emailQueue",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","setMessageParameters",412],"(",["T_ARRAY","array",412],"(",["T_WHITESPACE","\n                    ",412],["T_CONSTANT_ENCAPSED_STRING","'subject'",413],["T_WHITESPACE","           ",413],["T_DOUBLE_ARROW","=>",413],["T_WHITESPACE"," ",413],["T_VARIABLE","$subject",413],",",["T_WHITESPACE","\n                    ",413],["T_CONSTANT_ENCAPSED_STRING","'return_path_email'",414],["T_WHITESPACE"," ",414],["T_DOUBLE_ARROW","=>",414],["T_WHITESPACE"," ",414],["T_VARIABLE","$returnPathEmail",414],",",["T_WHITESPACE","\n                    ",414],["T_CONSTANT_ENCAPSED_STRING","'is_plain'",415],["T_WHITESPACE","          ",415],["T_DOUBLE_ARROW","=>",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","isPlain",415],"(",")",",",["T_WHITESPACE","\n                    ",415],["T_CONSTANT_ENCAPSED_STRING","'from_email'",416],["T_WHITESPACE","        ",416],["T_DOUBLE_ARROW","=>",416],["T_WHITESPACE"," ",416],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getSenderEmail",416],"(",")",",",["T_WHITESPACE","\n                    ",416],["T_CONSTANT_ENCAPSED_STRING","'from_name'",417],["T_WHITESPACE","         ",417],["T_DOUBLE_ARROW","=>",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getSenderName",417],"(",")",",",["T_WHITESPACE","\n                    ",417],["T_CONSTANT_ENCAPSED_STRING","'reply_to'",418],["T_WHITESPACE","          ",418],["T_DOUBLE_ARROW","=>",418],["T_WHITESPACE"," ",418],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getMail",418],"(",")",["T_OBJECT_OPERATOR","->",418],["T_STRING","getReplyTo",418],"(",")",",",["T_WHITESPACE","\n                    ",418],["T_CONSTANT_ENCAPSED_STRING","'return_to'",419],["T_WHITESPACE","         ",419],["T_DOUBLE_ARROW","=>",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getMail",419],"(",")",["T_OBJECT_OPERATOR","->",419],["T_STRING","getReturnPath",419],"(",")",",",["T_WHITESPACE","\n                ",419],")",")",["T_WHITESPACE","\n                ",420],["T_OBJECT_OPERATOR","->",421],["T_STRING","addRecipients",421],"(",["T_VARIABLE","$emails",421],",",["T_WHITESPACE"," ",421],["T_VARIABLE","$names",421],",",["T_WHITESPACE"," ",421],["T_STRING","Mage_Core_Model_Email_Queue",421],["T_DOUBLE_COLON","::",421],["T_STRING","EMAIL_TYPE_TO",421],")",["T_WHITESPACE","\n                ",421],["T_OBJECT_OPERATOR","->",422],["T_STRING","addRecipients",422],"(",["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_bccEmails",422],",",["T_WHITESPACE"," ",422],["T_ARRAY","array",422],"(",")",",",["T_WHITESPACE"," ",422],["T_STRING","Mage_Core_Model_Email_Queue",422],["T_DOUBLE_COLON","::",422],["T_STRING","EMAIL_TYPE_BCC",422],")",";",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$emailQueue",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","addMessageToQueue",423],"(",")",";",["T_WHITESPACE","\n\n            ",423],["T_RETURN","return",425],["T_WHITESPACE"," ",425],["T_STRING","true",425],";",["T_WHITESPACE","\n        ",425],"}",["T_WHITESPACE","\n\n        ",426],["T_STRING","ini_set",428],"(",["T_CONSTANT_ENCAPSED_STRING","'SMTP'",428],",",["T_WHITESPACE"," ",428],["T_STRING","Mage",428],["T_DOUBLE_COLON","::",428],["T_STRING","getStoreConfig",428],"(",["T_CONSTANT_ENCAPSED_STRING","'system\/smtp\/host'",428],")",")",";",["T_WHITESPACE","\n        ",428],["T_STRING","ini_set",429],"(",["T_CONSTANT_ENCAPSED_STRING","'smtp_port'",429],",",["T_WHITESPACE"," ",429],["T_STRING","Mage",429],["T_DOUBLE_COLON","::",429],["T_STRING","getStoreConfig",429],"(",["T_CONSTANT_ENCAPSED_STRING","'system\/smtp\/port'",429],")",")",";",["T_WHITESPACE","\n\n        ",429],["T_VARIABLE","$mail",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getMail",431],"(",")",";",["T_WHITESPACE","\n\n        ",431],["T_IF","if",433],["T_WHITESPACE"," ",433],"(",["T_VARIABLE","$returnPathEmail",433],["T_WHITESPACE"," ",433],["T_IS_NOT_IDENTICAL","!==",433],["T_WHITESPACE"," ",433],["T_STRING","null",433],")",["T_WHITESPACE"," ",433],"{",["T_WHITESPACE","\n            ",433],["T_VARIABLE","$mailTransport",434],["T_WHITESPACE"," ",434],"=",["T_WHITESPACE"," ",434],["T_NEW","new",434],["T_WHITESPACE"," ",434],["T_STRING","Zend_Mail_Transport_Sendmail",434],"(",["T_CONSTANT_ENCAPSED_STRING","\"-f\"",434],".",["T_VARIABLE","$returnPathEmail",434],")",";",["T_WHITESPACE","\n            ",434],["T_STRING","Zend_Mail",435],["T_DOUBLE_COLON","::",435],["T_STRING","setDefaultTransport",435],"(",["T_VARIABLE","$mailTransport",435],")",";",["T_WHITESPACE","\n        ",435],"}",["T_WHITESPACE","\n\n        ",436],["T_FOREACH","foreach",438],["T_WHITESPACE"," ",438],"(",["T_VARIABLE","$emails",438],["T_WHITESPACE"," ",438],["T_AS","as",438],["T_WHITESPACE"," ",438],["T_VARIABLE","$key",438],["T_WHITESPACE"," ",438],["T_DOUBLE_ARROW","=>",438],["T_WHITESPACE"," ",438],["T_VARIABLE","$email",438],")",["T_WHITESPACE"," ",438],"{",["T_WHITESPACE","\n            ",438],["T_VARIABLE","$mail",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","addTo",439],"(",["T_VARIABLE","$email",439],",",["T_WHITESPACE"," ",439],["T_CONSTANT_ENCAPSED_STRING","'=?utf-8?B?'",439],["T_WHITESPACE"," ",439],".",["T_WHITESPACE"," ",439],["T_STRING","base64_encode",439],"(",["T_VARIABLE","$names",439],"[",["T_VARIABLE","$key",439],"]",")",["T_WHITESPACE"," ",439],".",["T_WHITESPACE"," ",439],["T_CONSTANT_ENCAPSED_STRING","'?='",439],")",";",["T_WHITESPACE","\n        ",439],"}",["T_WHITESPACE","\n\n        ",440],["T_IF","if",442],["T_WHITESPACE"," ",442],"(",["T_VARIABLE","$this",442],["T_OBJECT_OPERATOR","->",442],["T_STRING","isPlain",442],"(",")",")",["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n            ",442],["T_VARIABLE","$mail",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","setBodyText",443],"(",["T_VARIABLE","$text",443],")",";",["T_WHITESPACE","\n        ",443],"}",["T_WHITESPACE"," ",444],["T_ELSE","else",444],["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n            ",444],["T_VARIABLE","$mail",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","setBodyHTML",445],"(",["T_VARIABLE","$text",445],")",";",["T_WHITESPACE","\n        ",445],"}",["T_WHITESPACE","\n\n        ",446],["T_VARIABLE","$mail",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","setSubject",448],"(",["T_CONSTANT_ENCAPSED_STRING","'=?utf-8?B?'",448],["T_WHITESPACE"," ",448],".",["T_WHITESPACE"," ",448],["T_STRING","base64_encode",448],"(",["T_VARIABLE","$subject",448],")",["T_WHITESPACE"," ",448],".",["T_WHITESPACE"," ",448],["T_CONSTANT_ENCAPSED_STRING","'?='",448],")",";",["T_WHITESPACE","\n        ",448],["T_VARIABLE","$mail",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","setFrom",449],"(",["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getSenderEmail",449],"(",")",",",["T_WHITESPACE"," ",449],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getSenderName",449],"(",")",")",";",["T_WHITESPACE","\n\n        ",449],["T_TRY","try",451],["T_WHITESPACE"," ",451],"{",["T_WHITESPACE","\n            ",451],["T_VARIABLE","$mail",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","send",452],"(",")",";",["T_WHITESPACE","\n            ",452],["T_VARIABLE","$this",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","_mail",453],["T_WHITESPACE"," ",453],"=",["T_WHITESPACE"," ",453],["T_STRING","null",453],";",["T_WHITESPACE","\n        ",453],"}",["T_WHITESPACE","\n        ",454],["T_CATCH","catch",455],["T_WHITESPACE"," ",455],"(",["T_STRING","Exception",455],["T_WHITESPACE"," ",455],["T_VARIABLE","$e",455],")",["T_WHITESPACE"," ",455],"{",["T_WHITESPACE","\n            ",455],["T_VARIABLE","$this",456],["T_OBJECT_OPERATOR","->",456],["T_STRING","_mail",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_STRING","null",456],";",["T_WHITESPACE","\n            ",456],["T_STRING","Mage",457],["T_DOUBLE_COLON","::",457],["T_STRING","logException",457],"(",["T_VARIABLE","$e",457],")",";",["T_WHITESPACE","\n            ",457],["T_RETURN","return",458],["T_WHITESPACE"," ",458],["T_STRING","false",458],";",["T_WHITESPACE","\n        ",458],"}",["T_WHITESPACE","\n\n        ",459],["T_RETURN","return",461],["T_WHITESPACE"," ",461],["T_STRING","true",461],";",["T_WHITESPACE","\n    ",461],"}",["T_WHITESPACE","\n\n    ",462],["T_DOC_COMMENT","\/**\n     * Send transactional email to recipient\n     *\n     * @param   int $templateId\n     * @param   string|array $sender sender information, can be declared as part of config path\n     * @param   string $email recipient email\n     * @param   string $name recipient name\n     * @param   array $vars variables which can be used in template\n     * @param   int|null $storeId\n     *\n     * @throws Mage_Core_Exception\n     *\n     * @return  Mage_Core_Model_Email_Template\n     *\/",464],["T_WHITESPACE","\n    ",477],["T_PUBLIC","public",478],["T_WHITESPACE"," ",478],["T_FUNCTION","function",478],["T_WHITESPACE"," ",478],["T_STRING","sendTransactional",478],"(",["T_VARIABLE","$templateId",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$sender",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$email",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$name",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$vars",478],"=",["T_ARRAY","array",478],"(",")",",",["T_WHITESPACE"," ",478],["T_VARIABLE","$storeId",478],"=",["T_STRING","null",478],")",["T_WHITESPACE","\n    ",478],"{",["T_WHITESPACE","\n        ",479],["T_VARIABLE","$this",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","setSentSuccess",480],"(",["T_STRING","false",480],")",";",["T_WHITESPACE","\n        ",480],["T_IF","if",481],["T_WHITESPACE"," ",481],"(","(",["T_VARIABLE","$storeId",481],["T_WHITESPACE"," ",481],["T_IS_IDENTICAL","===",481],["T_WHITESPACE"," ",481],["T_STRING","null",481],")",["T_WHITESPACE"," ",481],["T_BOOLEAN_AND","&&",481],["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","getDesignConfig",481],"(",")",["T_OBJECT_OPERATOR","->",481],["T_STRING","getStore",481],"(",")",")",["T_WHITESPACE"," ",481],"{",["T_WHITESPACE","\n            ",481],["T_VARIABLE","$storeId",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_VARIABLE","$this",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getDesignConfig",482],"(",")",["T_OBJECT_OPERATOR","->",482],["T_STRING","getStore",482],"(",")",";",["T_WHITESPACE","\n        ",482],"}",["T_WHITESPACE","\n\n        ",483],["T_IF","if",485],["T_WHITESPACE"," ",485],"(",["T_STRING","is_numeric",485],"(",["T_VARIABLE","$templateId",485],")",")",["T_WHITESPACE"," ",485],"{",["T_WHITESPACE","\n            ",485],["T_VARIABLE","$queue",486],["T_WHITESPACE"," ",486],"=",["T_WHITESPACE"," ",486],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","getQueue",486],"(",")",";",["T_WHITESPACE","\n            ",486],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","load",487],"(",["T_VARIABLE","$templateId",487],")",";",["T_WHITESPACE","\n            ",487],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","setQueue",488],"(",["T_VARIABLE","$queue",488],")",";",["T_WHITESPACE","\n        ",488],"}",["T_WHITESPACE"," ",489],["T_ELSE","else",489],["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n            ",489],["T_VARIABLE","$localeCode",490],["T_WHITESPACE"," ",490],"=",["T_WHITESPACE"," ",490],["T_STRING","Mage",490],["T_DOUBLE_COLON","::",490],["T_STRING","getStoreConfig",490],"(",["T_CONSTANT_ENCAPSED_STRING","'general\/locale\/code'",490],",",["T_WHITESPACE"," ",490],["T_VARIABLE","$storeId",490],")",";",["T_WHITESPACE","\n            ",490],["T_VARIABLE","$this",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","loadDefault",491],"(",["T_VARIABLE","$templateId",491],",",["T_WHITESPACE"," ",491],["T_VARIABLE","$localeCode",491],")",";",["T_WHITESPACE","\n        ",491],"}",["T_WHITESPACE","\n\n        ",492],["T_IF","if",494],["T_WHITESPACE"," ",494],"(","!",["T_VARIABLE","$this",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","getId",494],"(",")",")",["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n            ",494],["T_THROW","throw",495],["T_WHITESPACE"," ",495],["T_STRING","Mage",495],["T_DOUBLE_COLON","::",495],["T_STRING","exception",495],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Core'",495],",",["T_WHITESPACE"," ",495],["T_STRING","Mage",495],["T_DOUBLE_COLON","::",495],["T_STRING","helper",495],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",495],")",["T_OBJECT_OPERATOR","->",495],["T_STRING","__",495],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid transactional email code: %s'",495],",",["T_WHITESPACE"," ",495],["T_VARIABLE","$templateId",495],")",")",";",["T_WHITESPACE","\n        ",495],"}",["T_WHITESPACE","\n\n        ",496],["T_IF","if",498],["T_WHITESPACE"," ",498],"(","!",["T_STRING","is_array",498],"(",["T_VARIABLE","$sender",498],")",")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n            ",498],["T_VARIABLE","$this",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","setSenderName",499],"(",["T_STRING","Mage",499],["T_DOUBLE_COLON","::",499],["T_STRING","getStoreConfig",499],"(",["T_CONSTANT_ENCAPSED_STRING","'trans_email\/ident_'",499],["T_WHITESPACE"," ",499],".",["T_WHITESPACE"," ",499],["T_VARIABLE","$sender",499],["T_WHITESPACE"," ",499],".",["T_WHITESPACE"," ",499],["T_CONSTANT_ENCAPSED_STRING","'\/name'",499],",",["T_WHITESPACE"," ",499],["T_VARIABLE","$storeId",499],")",")",";",["T_WHITESPACE","\n            ",499],["T_VARIABLE","$this",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","setSenderEmail",500],"(",["T_STRING","Mage",500],["T_DOUBLE_COLON","::",500],["T_STRING","getStoreConfig",500],"(",["T_CONSTANT_ENCAPSED_STRING","'trans_email\/ident_'",500],["T_WHITESPACE"," ",500],".",["T_WHITESPACE"," ",500],["T_VARIABLE","$sender",500],["T_WHITESPACE"," ",500],".",["T_WHITESPACE"," ",500],["T_CONSTANT_ENCAPSED_STRING","'\/email'",500],",",["T_WHITESPACE"," ",500],["T_VARIABLE","$storeId",500],")",")",";",["T_WHITESPACE","\n        ",500],"}",["T_WHITESPACE"," ",501],["T_ELSE","else",501],["T_WHITESPACE"," ",501],"{",["T_WHITESPACE","\n            ",501],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","setSenderName",502],"(",["T_VARIABLE","$sender",502],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",502],"]",")",";",["T_WHITESPACE","\n            ",502],["T_VARIABLE","$this",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","setSenderEmail",503],"(",["T_VARIABLE","$sender",503],"[",["T_CONSTANT_ENCAPSED_STRING","'email'",503],"]",")",";",["T_WHITESPACE","\n        ",503],"}",["T_WHITESPACE","\n\n        ",504],["T_IF","if",506],["T_WHITESPACE"," ",506],"(","!",["T_ISSET","isset",506],"(",["T_VARIABLE","$vars",506],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",506],"]",")",")",["T_WHITESPACE"," ",506],"{",["T_WHITESPACE","\n            ",506],["T_VARIABLE","$vars",507],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",507],"]",["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_STRING","Mage",507],["T_DOUBLE_COLON","::",507],["T_STRING","app",507],"(",")",["T_OBJECT_OPERATOR","->",507],["T_STRING","getStore",507],"(",["T_VARIABLE","$storeId",507],")",";",["T_WHITESPACE","\n        ",507],"}",["T_WHITESPACE","\n        ",508],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","setSentSuccess",509],"(",["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","send",509],"(",["T_VARIABLE","$email",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$name",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$vars",509],")",")",";",["T_WHITESPACE","\n        ",509],["T_RETURN","return",510],["T_WHITESPACE"," ",510],["T_VARIABLE","$this",510],";",["T_WHITESPACE","\n    ",510],"}",["T_WHITESPACE","\n\n    ",511],["T_DOC_COMMENT","\/**\n     * Process email subject\n     *\n     * @param   array $variables\n     * @return  string\n     *\/",513],["T_WHITESPACE","\n    ",518],["T_PUBLIC","public",519],["T_WHITESPACE"," ",519],["T_FUNCTION","function",519],["T_WHITESPACE"," ",519],["T_STRING","getProcessedTemplateSubject",519],"(",["T_ARRAY","array",519],["T_WHITESPACE"," ",519],["T_VARIABLE","$variables",519],")",["T_WHITESPACE","\n    ",519],"{",["T_WHITESPACE","\n        ",520],["T_VARIABLE","$processor",521],["T_WHITESPACE"," ",521],"=",["T_WHITESPACE"," ",521],["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getTemplateFilter",521],"(",")",";",["T_WHITESPACE","\n\n        ",521],["T_IF","if",523],"(","!",["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_preprocessFlag",523],")",["T_WHITESPACE"," ",523],"{",["T_WHITESPACE","\n            ",523],["T_VARIABLE","$variables",524],"[",["T_CONSTANT_ENCAPSED_STRING","'this'",524],"]",["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_VARIABLE","$this",524],";",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n\n        ",525],["T_VARIABLE","$processor",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","setVariables",527],"(",["T_VARIABLE","$variables",527],")",";",["T_WHITESPACE","\n\n        ",527],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","_applyDesignConfig",529],"(",")",";",["T_WHITESPACE","\n        ",529],["T_TRY","try",530],"{",["T_WHITESPACE","\n            ",530],["T_VARIABLE","$processedResult",531],["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_VARIABLE","$processor",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","filter",531],"(",["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","getTemplateSubject",531],"(",")",")",";",["T_WHITESPACE","\n        ",531],"}",["T_WHITESPACE","\n        ",532],["T_CATCH","catch",533],["T_WHITESPACE"," ",533],"(",["T_STRING","Exception",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$e",533],")",["T_WHITESPACE"," ",533],"{",["T_WHITESPACE","\n            ",533],["T_VARIABLE","$this",534],["T_OBJECT_OPERATOR","->",534],["T_STRING","_cancelDesignConfig",534],"(",")",";",["T_WHITESPACE","\n            ",534],["T_THROW","throw",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$e",535],";",["T_WHITESPACE","\n        ",535],"}",["T_WHITESPACE","\n        ",536],["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","_cancelDesignConfig",537],"(",")",";",["T_WHITESPACE","\n        ",537],["T_RETURN","return",538],["T_WHITESPACE"," ",538],["T_VARIABLE","$processedResult",538],";",["T_WHITESPACE","\n    ",538],"}",["T_WHITESPACE","\n\n    ",539],["T_PUBLIC","public",541],["T_WHITESPACE"," ",541],["T_FUNCTION","function",541],["T_WHITESPACE"," ",541],["T_STRING","addBcc",541],"(",["T_VARIABLE","$bcc",541],")",["T_WHITESPACE","\n    ",541],"{",["T_WHITESPACE","\n        ",542],["T_IF","if",543],["T_WHITESPACE"," ",543],"(",["T_STRING","is_array",543],"(",["T_VARIABLE","$bcc",543],")",")",["T_WHITESPACE"," ",543],"{",["T_WHITESPACE","\n            ",543],["T_FOREACH","foreach",544],["T_WHITESPACE"," ",544],"(",["T_VARIABLE","$bcc",544],["T_WHITESPACE"," ",544],["T_AS","as",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$email",544],")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n                ",544],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","_bccEmails",545],"[","]",["T_WHITESPACE"," ",545],"=",["T_WHITESPACE"," ",545],["T_VARIABLE","$email",545],";",["T_WHITESPACE","\n                ",545],["T_VARIABLE","$this",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","getMail",546],"(",")",["T_OBJECT_OPERATOR","->",546],["T_STRING","addBcc",546],"(",["T_VARIABLE","$email",546],")",";",["T_WHITESPACE","\n            ",546],"}",["T_WHITESPACE","\n        ",547],"}",["T_WHITESPACE","\n        ",548],["T_ELSEIF","elseif",549],["T_WHITESPACE"," ",549],"(",["T_VARIABLE","$bcc",549],")",["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n            ",549],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_bccEmails",550],"[","]",["T_WHITESPACE"," ",550],"=",["T_WHITESPACE"," ",550],["T_VARIABLE","$bcc",550],";",["T_WHITESPACE","\n            ",550],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","getMail",551],"(",")",["T_OBJECT_OPERATOR","->",551],["T_STRING","addBcc",551],"(",["T_VARIABLE","$bcc",551],")",";",["T_WHITESPACE","\n        ",551],"}",["T_WHITESPACE","\n        ",552],["T_RETURN","return",553],["T_WHITESPACE"," ",553],["T_VARIABLE","$this",553],";",["T_WHITESPACE","\n    ",553],"}",["T_WHITESPACE","\n\n    ",554],["T_DOC_COMMENT","\/**\n     * Set Return Path\n     *\n     * @param string $email\n     * @return Mage_Core_Model_Email_Template\n     *\/",556],["T_WHITESPACE","\n    ",561],["T_PUBLIC","public",562],["T_WHITESPACE","  ",562],["T_FUNCTION","function",562],["T_WHITESPACE"," ",562],["T_STRING","setReturnPath",562],"(",["T_VARIABLE","$email",562],")",["T_WHITESPACE","\n    ",562],"{",["T_WHITESPACE","\n        ",563],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","getMail",564],"(",")",["T_OBJECT_OPERATOR","->",564],["T_STRING","setReturnPath",564],"(",["T_VARIABLE","$email",564],")",";",["T_WHITESPACE","\n        ",564],["T_RETURN","return",565],["T_WHITESPACE"," ",565],["T_VARIABLE","$this",565],";",["T_WHITESPACE","\n    ",565],"}",["T_WHITESPACE","\n\n    ",566],["T_DOC_COMMENT","\/**\n     * Add Reply-To header\n     *\n     * @param string $email\n     * @return Mage_Core_Model_Email_Template\n     *\/",568],["T_WHITESPACE","\n    ",573],["T_PUBLIC","public",574],["T_WHITESPACE"," ",574],["T_FUNCTION","function",574],["T_WHITESPACE"," ",574],["T_STRING","setReplyTo",574],"(",["T_VARIABLE","$email",574],")",["T_WHITESPACE","\n    ",574],"{",["T_WHITESPACE","\n        ",575],["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","getMail",576],"(",")",["T_OBJECT_OPERATOR","->",576],["T_STRING","setReplyTo",576],"(",["T_VARIABLE","$email",576],")",";",["T_WHITESPACE","\n        ",576],["T_RETURN","return",577],["T_WHITESPACE"," ",577],["T_VARIABLE","$this",577],";",["T_WHITESPACE","\n    ",577],"}",["T_WHITESPACE","\n\n    ",578],["T_DOC_COMMENT","\/**\n     * Parse variables string into array of variables\n     *\n     * @param string $variablesString\n     * @return array\n     *\/",580],["T_WHITESPACE","\n    ",585],["T_PROTECTED","protected",586],["T_WHITESPACE"," ",586],["T_FUNCTION","function",586],["T_WHITESPACE"," ",586],["T_STRING","_parseVariablesString",586],"(",["T_VARIABLE","$variablesString",586],")",["T_WHITESPACE","\n    ",586],"{",["T_WHITESPACE","\n        ",587],["T_VARIABLE","$variables",588],["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_ARRAY","array",588],"(",")",";",["T_WHITESPACE","\n        ",588],["T_IF","if",589],["T_WHITESPACE"," ",589],"(",["T_VARIABLE","$variablesString",589],["T_WHITESPACE"," ",589],["T_BOOLEAN_AND","&&",589],["T_WHITESPACE"," ",589],["T_STRING","is_string",589],"(",["T_VARIABLE","$variablesString",589],")",")",["T_WHITESPACE"," ",589],"{",["T_WHITESPACE","\n            ",589],["T_VARIABLE","$variablesString",590],["T_WHITESPACE"," ",590],"=",["T_WHITESPACE"," ",590],["T_STRING","str_replace",590],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",590],",",["T_WHITESPACE"," ",590],["T_CONSTANT_ENCAPSED_STRING","''",590],",",["T_WHITESPACE"," ",590],["T_VARIABLE","$variablesString",590],")",";",["T_WHITESPACE","\n            ",590],["T_VARIABLE","$variables",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_STRING","Zend_Json",591],["T_DOUBLE_COLON","::",591],["T_STRING","decode",591],"(",["T_VARIABLE","$variablesString",591],")",";",["T_WHITESPACE","\n        ",591],"}",["T_WHITESPACE","\n        ",592],["T_RETURN","return",593],["T_WHITESPACE"," ",593],["T_VARIABLE","$variables",593],";",["T_WHITESPACE","\n    ",593],"}",["T_WHITESPACE","\n\n    ",594],["T_DOC_COMMENT","\/**\n     * Retrieve option array of variables\n     *\n     * @param boolean $withGroup if true wrap variable options in group\n     * @return array\n     *\/",596],["T_WHITESPACE","\n    ",601],["T_PUBLIC","public",602],["T_WHITESPACE"," ",602],["T_FUNCTION","function",602],["T_WHITESPACE"," ",602],["T_STRING","getVariablesOptionArray",602],"(",["T_VARIABLE","$withGroup",602],["T_WHITESPACE"," ",602],"=",["T_WHITESPACE"," ",602],["T_STRING","false",602],")",["T_WHITESPACE","\n    ",602],"{",["T_WHITESPACE","\n        ",603],["T_VARIABLE","$optionArray",604],["T_WHITESPACE"," ",604],"=",["T_WHITESPACE"," ",604],["T_ARRAY","array",604],"(",")",";",["T_WHITESPACE","\n        ",604],["T_VARIABLE","$variables",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","_parseVariablesString",605],"(",["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","getData",605],"(",["T_CONSTANT_ENCAPSED_STRING","'orig_template_variables'",605],")",")",";",["T_WHITESPACE","\n        ",605],["T_IF","if",606],["T_WHITESPACE"," ",606],"(",["T_VARIABLE","$variables",606],")",["T_WHITESPACE"," ",606],"{",["T_WHITESPACE","\n            ",606],["T_FOREACH","foreach",607],["T_WHITESPACE"," ",607],"(",["T_VARIABLE","$variables",607],["T_WHITESPACE"," ",607],["T_AS","as",607],["T_WHITESPACE"," ",607],["T_VARIABLE","$value",607],["T_WHITESPACE"," ",607],["T_DOUBLE_ARROW","=>",607],["T_WHITESPACE"," ",607],["T_VARIABLE","$label",607],")",["T_WHITESPACE"," ",607],"{",["T_WHITESPACE","\n                ",607],["T_VARIABLE","$optionArray",608],"[","]",["T_WHITESPACE"," ",608],"=",["T_WHITESPACE"," ",608],["T_ARRAY","array",608],"(",["T_WHITESPACE","\n                    ",608],["T_CONSTANT_ENCAPSED_STRING","'value'",609],["T_WHITESPACE"," ",609],["T_DOUBLE_ARROW","=>",609],["T_WHITESPACE"," ",609],["T_CONSTANT_ENCAPSED_STRING","'{{'",609],["T_WHITESPACE"," ",609],".",["T_WHITESPACE"," ",609],["T_VARIABLE","$value",609],["T_WHITESPACE"," ",609],".",["T_WHITESPACE"," ",609],["T_CONSTANT_ENCAPSED_STRING","'}}'",609],",",["T_WHITESPACE","\n                    ",609],["T_CONSTANT_ENCAPSED_STRING","'label'",610],["T_WHITESPACE"," ",610],["T_DOUBLE_ARROW","=>",610],["T_WHITESPACE"," ",610],["T_STRING","Mage",610],["T_DOUBLE_COLON","::",610],["T_STRING","helper",610],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",610],")",["T_OBJECT_OPERATOR","->",610],["T_STRING","__",610],"(",["T_CONSTANT_ENCAPSED_STRING","'%s'",610],",",["T_WHITESPACE"," ",610],["T_VARIABLE","$label",610],")",["T_WHITESPACE","\n                ",610],")",";",["T_WHITESPACE","\n            ",611],"}",["T_WHITESPACE","\n            ",612],["T_IF","if",613],["T_WHITESPACE"," ",613],"(",["T_VARIABLE","$withGroup",613],")",["T_WHITESPACE"," ",613],"{",["T_WHITESPACE","\n                ",613],["T_VARIABLE","$optionArray",614],["T_WHITESPACE"," ",614],"=",["T_WHITESPACE"," ",614],["T_ARRAY","array",614],"(",["T_WHITESPACE","\n                    ",614],["T_CONSTANT_ENCAPSED_STRING","'label'",615],["T_WHITESPACE"," ",615],["T_DOUBLE_ARROW","=>",615],["T_WHITESPACE"," ",615],["T_STRING","Mage",615],["T_DOUBLE_COLON","::",615],["T_STRING","helper",615],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",615],")",["T_OBJECT_OPERATOR","->",615],["T_STRING","__",615],"(",["T_CONSTANT_ENCAPSED_STRING","'Template Variables'",615],")",",",["T_WHITESPACE","\n                    ",615],["T_CONSTANT_ENCAPSED_STRING","'value'",616],["T_WHITESPACE"," ",616],["T_DOUBLE_ARROW","=>",616],["T_WHITESPACE"," ",616],["T_VARIABLE","$optionArray",616],["T_WHITESPACE","\n                ",616],")",";",["T_WHITESPACE","\n            ",617],"}",["T_WHITESPACE","\n        ",618],"}",["T_WHITESPACE","\n        ",619],["T_RETURN","return",620],["T_WHITESPACE"," ",620],["T_VARIABLE","$optionArray",620],";",["T_WHITESPACE","\n    ",620],"}",["T_WHITESPACE","\n\n    ",621],["T_DOC_COMMENT","\/**\n     * Validate email template code\n     *\n     * @return Mage_Core_Model_Email_Template\n     *\/",623],["T_WHITESPACE","\n    ",627],["T_PROTECTED","protected",628],["T_WHITESPACE"," ",628],["T_FUNCTION","function",628],["T_WHITESPACE"," ",628],["T_STRING","_beforeSave",628],"(",")",["T_WHITESPACE","\n    ",628],"{",["T_WHITESPACE","\n        ",629],["T_VARIABLE","$code",630],["T_WHITESPACE"," ",630],"=",["T_WHITESPACE"," ",630],["T_VARIABLE","$this",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","getTemplateCode",630],"(",")",";",["T_WHITESPACE","\n        ",630],["T_IF","if",631],["T_WHITESPACE"," ",631],"(",["T_EMPTY","empty",631],"(",["T_VARIABLE","$code",631],")",")",["T_WHITESPACE"," ",631],"{",["T_WHITESPACE","\n            ",631],["T_STRING","Mage",632],["T_DOUBLE_COLON","::",632],["T_STRING","throwException",632],"(",["T_STRING","Mage",632],["T_DOUBLE_COLON","::",632],["T_STRING","helper",632],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",632],")",["T_OBJECT_OPERATOR","->",632],["T_STRING","__",632],"(",["T_CONSTANT_ENCAPSED_STRING","'The template Name must not be empty.'",632],")",")",";",["T_WHITESPACE","\n        ",632],"}",["T_WHITESPACE","\n        ",633],["T_IF","if",634],"(",["T_VARIABLE","$this",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","_getResource",634],"(",")",["T_OBJECT_OPERATOR","->",634],["T_STRING","checkCodeUsage",634],"(",["T_VARIABLE","$this",634],")",")",["T_WHITESPACE"," ",634],"{",["T_WHITESPACE","\n            ",634],["T_STRING","Mage",635],["T_DOUBLE_COLON","::",635],["T_STRING","throwException",635],"(",["T_STRING","Mage",635],["T_DOUBLE_COLON","::",635],["T_STRING","helper",635],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",635],")",["T_OBJECT_OPERATOR","->",635],["T_STRING","__",635],"(",["T_CONSTANT_ENCAPSED_STRING","'Duplicate Of Template Name'",635],")",")",";",["T_WHITESPACE","\n        ",635],"}",["T_WHITESPACE","\n        ",636],["T_RETURN","return",637],["T_WHITESPACE"," ",637],["T_STRING","parent",637],["T_DOUBLE_COLON","::",637],["T_STRING","_beforeSave",637],"(",")",";",["T_WHITESPACE","\n    ",637],"}",["T_WHITESPACE","\n",638],"}",["T_WHITESPACE","\n",639]]