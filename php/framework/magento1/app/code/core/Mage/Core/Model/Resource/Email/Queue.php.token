[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n",25],["T_CLASS","class",26],["T_WHITESPACE"," ",26],["T_STRING","Mage_Core_Model_Resource_Email_Queue",26],["T_WHITESPACE"," ",26],["T_EXTENDS","extends",26],["T_WHITESPACE"," ",26],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",26],["T_WHITESPACE","\n",26],"{",["T_WHITESPACE","\n    ",27],["T_DOC_COMMENT","\/**\n     * Initialize email queue resource model\n     *\n     *\/",28],["T_WHITESPACE","\n    ",31],["T_PROTECTED","protected",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","_construct",32],"(",")",["T_WHITESPACE","\n    ",32],"{",["T_WHITESPACE","\n        ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","_init",34],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_queue'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'message_id'",34],")",";",["T_WHITESPACE","\n    ",34],"}",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * Load recipients, unserialize message parameters\n     *\n     * @param Mage_Core_Model_Abstract $object\n     *\n     * @return Mage_Core_Model_Resource_Email_Queue\n     *\/",37],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","_afterLoad",44],"(",["T_STRING","Mage_Core_Model_Abstract",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$object",44],")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$object",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","setRecipients",46],"(",["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getRecipients",46],"(",["T_VARIABLE","$object",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getId",46],"(",")",")",")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$object",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","setMessageParameters",47],"(",["T_STRING","unserialize",47],"(",["T_VARIABLE","$object",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getMessageParameters",47],"(",")",")",")",";",["T_WHITESPACE","\n        ",47],["T_RETURN","return",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],";",["T_WHITESPACE","\n    ",48],"}",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Prepare object data for saving\n     *\n     * @param Mage_Core_Model_Email_Queue|Mage_Core_Model_Abstract $object\n     * @return Mage_Core_Model_Resource_Email_Queue\n     *\/",51],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","_beforeSave",57],"(",["T_STRING","Mage_Core_Model_Abstract",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$object",57],")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_IF","if",59],["T_WHITESPACE"," ",59],"(",["T_VARIABLE","$object",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","isObjectNew",59],"(",")",")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n            ",59],["T_VARIABLE","$object",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","setCreatedAt",60],"(",["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","formatDate",60],"(",["T_STRING","true",60],")",")",";",["T_WHITESPACE","\n        ",60],"}",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$object",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","setMessageBodyHash",62],"(",["T_STRING","md5",62],"(",["T_VARIABLE","$object",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getMessageBody",62],"(",")",")",")",";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$object",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","setMessageParameters",63],"(",["T_STRING","serialize",63],"(",["T_VARIABLE","$object",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getMessageParameters",63],"(",")",")",")",";",["T_WHITESPACE","\n\n        ",63],["T_RETURN","return",65],["T_WHITESPACE"," ",65],["T_STRING","parent",65],["T_DOUBLE_COLON","::",65],["T_STRING","_beforeSave",65],"(",["T_VARIABLE","$object",65],")",";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Check if email was added to queue for requested recipients\n     *\n     * @param Mage_Core_Model_Email_Queue $queue\n     *\n     * @return bool\n     *\/",68],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","wasEmailQueued",75],"(",["T_STRING","Mage_Core_Model_Email_Queue",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$queue",75],")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$readAdapter",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_getReadAdapter",77],"(",")",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$select",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$readAdapter",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","select",78],"(",")",["T_WHITESPACE","\n            ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","from",79],"(",["T_WHITESPACE","\n                ",79],["T_ARRAY","array",80],"(",["T_CONSTANT_ENCAPSED_STRING","'recips'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getTable",80],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_recipients'",80],")",")",",",["T_WHITESPACE","\n                ",80],["T_ARRAY","array",81],"(",["T_CONSTANT_ENCAPSED_STRING","'recipient_email'",81],",",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'recipient_name'",81],",",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'email_type'",81],")",["T_WHITESPACE","\n            ",81],")",["T_WHITESPACE","\n            ",82],["T_OBJECT_OPERATOR","->",83],["T_STRING","join",83],"(",["T_ARRAY","array",83],"(",["T_CONSTANT_ENCAPSED_STRING","'queue'",83],["T_WHITESPACE"," ",83],["T_DOUBLE_ARROW","=>",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getMainTable",83],"(",")",")",",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'queue.message_id = recips.message_id'",83],",",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",")",")",["T_WHITESPACE","\n            ",83],["T_OBJECT_OPERATOR","->",84],["T_STRING","where",84],"(",["T_CONSTANT_ENCAPSED_STRING","'queue.entity_id =? '",84],",",["T_WHITESPACE"," ",84],["T_VARIABLE","$queue",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getEntityId",84],"(",")",")",["T_WHITESPACE","\n            ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","where",85],"(",["T_CONSTANT_ENCAPSED_STRING","'queue.entity_type =? '",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$queue",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getEntityType",85],"(",")",")",["T_WHITESPACE","\n            ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","where",86],"(",["T_CONSTANT_ENCAPSED_STRING","'queue.event_type =? '",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$queue",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getEventType",86],"(",")",")",["T_WHITESPACE","\n            ",86],["T_OBJECT_OPERATOR","->",87],["T_STRING","where",87],"(",["T_CONSTANT_ENCAPSED_STRING","'queue.message_body_hash =? '",87],",",["T_WHITESPACE"," ",87],["T_STRING","md5",87],"(",["T_VARIABLE","$queue",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getMessageBody",87],"(",")",")",")",";",["T_WHITESPACE","\n\n        ",87],["T_VARIABLE","$existingRecipients",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$readAdapter",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","fetchAll",89],"(",["T_VARIABLE","$select",89],")",";",["T_WHITESPACE","\n        ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$existingRecipients",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$newRecipients",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$queue",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getRecipients",91],"(",")",";",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$oldEmails",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$newEmails",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_ARRAY","array",92],"(",")",";",["T_WHITESPACE","\n            ",92],["T_FOREACH","foreach",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$existingRecipients",93],["T_WHITESPACE"," ",93],["T_AS","as",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$recipient",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$oldEmails",94],"[",["T_VARIABLE","$recipient",94],"[",["T_CONSTANT_ENCAPSED_STRING","'recipient_email'",94],"]","]",["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_ARRAY","array",94],"(",["T_WHITESPACE","\n                    ",94],["T_VARIABLE","$recipient",95],"[",["T_CONSTANT_ENCAPSED_STRING","'recipient_email'",95],"]",",",["T_WHITESPACE"," ",95],["T_VARIABLE","$recipient",95],"[",["T_CONSTANT_ENCAPSED_STRING","'recipient_name'",95],"]",",",["T_WHITESPACE"," ",95],["T_VARIABLE","$recipient",95],"[",["T_CONSTANT_ENCAPSED_STRING","'email_type'",95],"]",["T_WHITESPACE","\n                ",95],")",";",["T_WHITESPACE","\n            ",96],"}",["T_WHITESPACE","\n            ",97],["T_UNSET","unset",98],"(",["T_VARIABLE","$recipient",98],")",";",["T_WHITESPACE","\n            ",98],["T_FOREACH","foreach",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$newRecipients",99],["T_WHITESPACE"," ",99],["T_AS","as",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$recipient",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n                ",99],["T_LIST","list",100],"(",["T_VARIABLE","$email",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$name",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$type",100],")",["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$recipient",100],";",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$newEmails",101],"[",["T_VARIABLE","$email",101],"]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_ARRAY","array",101],"(",["T_VARIABLE","$email",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$name",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$type",101],")",";",["T_WHITESPACE","\n            ",101],"}",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$diff",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_STRING","array_diff_key",103],"(",["T_VARIABLE","$newEmails",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$oldEmails",103],")",";",["T_WHITESPACE","\n            ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_STRING","sizeof",104],"(",["T_VARIABLE","$diff",104],")",["T_WHITESPACE"," ",104],">",["T_WHITESPACE"," ",104],["T_LNUMBER","0",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n                ",104],["T_VARIABLE","$queue",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","clearRecipients",105],"(",")",";",["T_WHITESPACE","\n                ",105],["T_FOREACH","foreach",106],["T_WHITESPACE"," ",106],"(",["T_VARIABLE","$diff",106],["T_WHITESPACE"," ",106],["T_AS","as",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$recipient",106],")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n                    ",106],["T_LIST","list",107],"(",["T_VARIABLE","$email",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$name",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$type",107],")",["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$recipient",107],";",["T_WHITESPACE","\n                    ",107],["T_VARIABLE","$queue",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","addRecipients",108],"(",["T_VARIABLE","$email",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$name",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$type",108],")",";",["T_WHITESPACE","\n                ",108],"}",["T_WHITESPACE","\n                ",109],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_STRING","false",110],";",["T_WHITESPACE","\n            ",110],"}",["T_WHITESPACE","\n            ",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_STRING","true",112],";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n        ",113],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_STRING","false",115],";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Retrieve recipients data for specified message\n     *\n     * @param int $messageId\n     *\n     * @return array\n     *\/",118],["T_WHITESPACE","\n    ",124],["T_PUBLIC","public",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","getRecipients",125],"(",["T_VARIABLE","$messageId",125],")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$readAdapter",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_getReadAdapter",127],"(",")",";",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$select",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$readAdapter",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","select",128],"(",")",["T_WHITESPACE","\n            ",128],["T_OBJECT_OPERATOR","->",129],["T_STRING","from",129],"(",["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getTable",129],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_recipients'",129],")",",",["T_WHITESPACE"," ",129],["T_ARRAY","array",129],"(",["T_CONSTANT_ENCAPSED_STRING","'recipient_email'",129],",",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'recipient_name'",129],",",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'email_type'",129],")",")",["T_WHITESPACE","\n            ",129],["T_OBJECT_OPERATOR","->",130],["T_STRING","where",130],"(",["T_CONSTANT_ENCAPSED_STRING","'message_id =? '",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$messageId",130],")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$recipients",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$readAdapter",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","fetchAll",131],"(",["T_VARIABLE","$select",131],")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$existingRecipients",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_ARRAY","array",132],"(",")",";",["T_WHITESPACE","\n        ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$recipients",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_FOREACH","foreach",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$recipients",134],["T_WHITESPACE"," ",134],["T_AS","as",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$recipient",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$existingRecipients",135],"[","]",["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_ARRAY","array",135],"(",["T_WHITESPACE","\n                    ",135],["T_VARIABLE","$recipient",136],"[",["T_CONSTANT_ENCAPSED_STRING","'recipient_email'",136],"]",",",["T_WHITESPACE","\n                    ",136],["T_VARIABLE","$recipient",137],"[",["T_CONSTANT_ENCAPSED_STRING","'recipient_name'",137],"]",",",["T_WHITESPACE","\n                    ",137],["T_VARIABLE","$recipient",138],"[",["T_CONSTANT_ENCAPSED_STRING","'email_type'",138],"]",["T_WHITESPACE","\n                ",138],")",";",["T_WHITESPACE","\n            ",139],"}",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE","\n\n        ",141],["T_RETURN","return",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$existingRecipients",143],";",["T_WHITESPACE","\n    ",143],"}",["T_WHITESPACE","\n\n    ",144],["T_DOC_COMMENT","\/**\n     * Save message recipients\n     *\n     * @param int $messageId\n     * @param array $recipients\n     *\n     * @throws Exception\n     *\n     * @return Mage_Core_Model_Resource_Email_Queue\n     *\/",146],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","saveRecipients",156],"(",["T_VARIABLE","$messageId",156],",",["T_WHITESPACE"," ",156],["T_ARRAY","array",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$recipients",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$writeAdapter",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getWriteAdapter",158],"(",")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$recipientsTable",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getTable",159],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_recipients'",159],")",";",["T_WHITESPACE","\n        ",159],["T_VARIABLE","$writeAdapter",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","beginTransaction",160],"(",")",";",["T_WHITESPACE","\n\n        ",160],["T_TRY","try",162],["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_FOREACH","foreach",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$recipients",163],["T_WHITESPACE"," ",163],["T_AS","as",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$recipient",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_LIST","list",164],"(",["T_VARIABLE","$email",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$name",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$type",164],")",["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$recipient",164],";",["T_WHITESPACE","\n                ",164],["T_VARIABLE","$writeAdapter",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","insertOnDuplicate",165],"(",["T_WHITESPACE","\n                    ",165],["T_VARIABLE","$recipientsTable",166],",",["T_WHITESPACE","\n                    ",166],["T_ARRAY","array",167],"(",["T_WHITESPACE","\n                         ",167],["T_CONSTANT_ENCAPSED_STRING","'message_id'",168],["T_WHITESPACE","      ",168],["T_DOUBLE_ARROW","=>",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$messageId",168],",",["T_WHITESPACE","\n                         ",168],["T_CONSTANT_ENCAPSED_STRING","'recipient_email'",169],["T_WHITESPACE"," ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$email",169],",",["T_WHITESPACE","\n                         ",169],["T_CONSTANT_ENCAPSED_STRING","'recipient_name'",170],["T_WHITESPACE","  ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$name",170],",",["T_WHITESPACE","\n                         ",170],["T_CONSTANT_ENCAPSED_STRING","'email_type'",171],["T_WHITESPACE","      ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$type",171],["T_WHITESPACE","\n                    ",171],")",",",["T_WHITESPACE","\n                    ",172],["T_ARRAY","array",173],"(",["T_CONSTANT_ENCAPSED_STRING","'recipient_name'",173],")",["T_WHITESPACE","\n                ",173],")",";",["T_WHITESPACE","\n            ",174],"}",["T_WHITESPACE","\n            ",175],["T_VARIABLE","$writeAdapter",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","commit",176],"(",")",";",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE"," ",177],["T_CATCH","catch",177],["T_WHITESPACE"," ",177],"(",["T_STRING","Exception",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$e",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$writeAdapter",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","rollback",178],"(",")",";",["T_WHITESPACE","\n            ",178],["T_THROW","throw",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$e",179],";",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE","\n\n        ",180],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Remove already sent messages\n     *\n     * @return Mage_Core_Model_Resource_Email_Queue\n     *\/",185],["T_WHITESPACE","\n    ",189],["T_PUBLIC","public",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","removeSentMessages",190],"(",")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_getWriteAdapter",192],"(",")",["T_OBJECT_OPERATOR","->",192],["T_STRING","delete",192],"(",["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getMainTable",192],"(",")",",",["T_WHITESPACE"," ",192],["T_CONSTANT_ENCAPSED_STRING","'processed_at IS NOT NULL'",192],")",";",["T_WHITESPACE","\n        ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],";",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n",194],"}",["T_WHITESPACE","\n",195]]