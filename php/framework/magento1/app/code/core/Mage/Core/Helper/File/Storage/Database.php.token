[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Database saving file helper\n *\n * @category    Mage\n * @package     Mage_Core\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Helper_File_Storage_Database",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Helper_Abstract",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Database storage model\n     * @var null|Mage_Core_Model_File_Storage_Database\n     *\/",36],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_databaseModel",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_STRING","null",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * Storage resource model\n     * @var null|Mage_Core_Model_Mysql4_File_Storage_Database\n     *\/",42],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$_resourceModel",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","null",46],";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Db usage flag\n     *\n     * @var bool\n     *\/",48],["T_WHITESPACE","\n    ",52],["T_PROTECTED","protected",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$_useDb",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","null",53],";",["T_WHITESPACE","\n\n    ",53],["T_DOC_COMMENT","\/**\n     * Media dir\n     *\n     * @var string\n     *\/",55],["T_WHITESPACE","\n    ",59],["T_PROTECTED","protected",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$_mediaBaseDirectory",60],";",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Check if we use DB storage\n     * Note: Disabled as not completed feature\n     *\n     * @return bool\n     *\/",62],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","checkDbUsage",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_STRING","null",70],["T_WHITESPACE"," ",70],["T_IS_IDENTICAL","===",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_useDb",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_VARIABLE","$currentStorage",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_INT_CAST","(int)",71],["T_WHITESPACE"," ",71],["T_STRING","Mage",71],["T_DOUBLE_COLON","::",71],["T_STRING","app",71],"(",")",["T_OBJECT_OPERATOR","->",71],["T_STRING","getConfig",71],"(",")",["T_WHITESPACE","\n                ",71],["T_OBJECT_OPERATOR","->",72],["T_STRING","getNode",72],"(",["T_STRING","Mage_Core_Model_File_Storage",72],["T_DOUBLE_COLON","::",72],["T_STRING","XML_PATH_STORAGE_MEDIA",72],")",";",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_useDb",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$currentStorage",73],["T_WHITESPACE"," ",73],["T_IS_EQUAL","==",73],["T_WHITESPACE"," ",73],["T_STRING","Mage_Core_Model_File_Storage",73],["T_DOUBLE_COLON","::",73],["T_STRING","STORAGE_MEDIA_DATABASE",73],")",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE","\n\n        ",74],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_useDb",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Get database storage model\n     *\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PUBLIC","public",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","getStorageDatabaseModel",84],"(",")",["T_WHITESPACE","\n    ",84],"{",["T_WHITESPACE","\n        ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_STRING","is_null",86],"(",["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_databaseModel",86],")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_databaseModel",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","getModel",87],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",87],")",";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n\n        ",88],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_databaseModel",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Get file storage model\n     *\n     * @return Mage_Core_Model_File_Storage_File\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","getStorageFileModel",98],"(",")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_STRING","Mage",100],["T_DOUBLE_COLON","::",100],["T_STRING","getSingleton",100],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_file'",100],")",";",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Get storage model\n     *\n     * @return Mage_Core_Model_Mysql4_File_Storage_Database\n     *\/",103],["T_WHITESPACE","\n    ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","getResourceStorageModel",108],"(",")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_STRING","is_null",110],"(",["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","_resourceModel",110],")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_resourceModel",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getStorageDatabaseModel",111],"(",")",["T_OBJECT_OPERATOR","->",111],["T_STRING","getResource",111],"(",")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n        ",112],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_resourceModel",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Save file in DB storage\n     *\n     * @param string $filename\n     *\/",116],["T_WHITESPACE","\n    ",120],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","saveFile",121],"(",["T_VARIABLE","$filename",121],")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","checkDbUsage",123],"(",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getStorageDatabaseModel",124],"(",")",["T_OBJECT_OPERATOR","->",124],["T_STRING","saveFile",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_removeAbsPathFromFileName",124],"(",["T_VARIABLE","$filename",124],")",")",";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Rename file in DB storage\n     *\n     * @param string $oldName\n     * @param string $newName\n     *\/",128],["T_WHITESPACE","\n    ",133],["T_PUBLIC","public",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","renameFile",134],"(",["T_VARIABLE","$oldName",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$newName",134],")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","checkDbUsage",136],"(",")",")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getStorageDatabaseModel",137],"(",")",["T_WHITESPACE","\n                ",137],["T_OBJECT_OPERATOR","->",138],["T_STRING","renameFile",138],"(",["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_removeAbsPathFromFileName",138],"(",["T_VARIABLE","$oldName",138],")",",",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_removeAbsPathFromFileName",138],"(",["T_VARIABLE","$newName",138],")",")",";",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n\n    ",140],["T_DOC_COMMENT","\/**\n     * Copy file in DB storage\n     *\n     * @param string $oldName\n     * @param string $newName\n     *\/",142],["T_WHITESPACE","\n    ",147],["T_PUBLIC","public",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","copyFile",148],"(",["T_VARIABLE","$oldName",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$newName",148],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n        ",148],["T_IF","if",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","checkDbUsage",149],"(",")",")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getStorageDatabaseModel",150],"(",")",["T_WHITESPACE","\n                ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","copyFile",151],"(",["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_removeAbsPathFromFileName",151],"(",["T_VARIABLE","$oldName",151],")",",",["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_removeAbsPathFromFileName",151],"(",["T_VARIABLE","$newName",151],")",")",";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n\n    ",153],["T_DOC_COMMENT","\/**\n     * Check whether file exists in DB\n     *\n     * @param string $filename can be both full path or partial (like in DB)\n     * @return bool|null\n     *\/",155],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","fileExists",161],"(",["T_VARIABLE","$filename",161],")",["T_WHITESPACE","\n    ",161],"{",["T_WHITESPACE","\n        ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","checkDbUsage",163],"(",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getStorageDatabaseModel",164],"(",")",["T_OBJECT_OPERATOR","->",164],["T_STRING","fileExists",164],"(",["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_removeAbsPathFromFileName",164],"(",["T_VARIABLE","$filename",164],")",")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE"," ",165],["T_ELSE","else",165],["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n            ",165],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_STRING","null",166],";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n    ",167],"}",["T_WHITESPACE","\n\n    ",168],["T_DOC_COMMENT","\/**\n     * Get unique name for passed file in case this file already exists\n     *\n     * @param string $directory - can be both full path or partial (like in DB)\n     * @param string $filename - not just a filename. Can have directory chunks. return will have this form\n     * @return string\n     *\/",170],["T_WHITESPACE","\n    ",176],["T_PUBLIC","public",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","getUniqueFilename",177],"(",["T_VARIABLE","$directory",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$filename",177],")",["T_WHITESPACE","\n    ",177],"{",["T_WHITESPACE","\n        ",178],["T_IF","if",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","checkDbUsage",179],"(",")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n           ",179],["T_VARIABLE","$directory",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_removeAbsPathFromFileName",180],"(",["T_VARIABLE","$directory",180],")",";",["T_WHITESPACE","\n            ",180],["T_IF","if",181],"(",["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","fileExists",181],"(",["T_VARIABLE","$directory",181],["T_WHITESPACE"," ",181],".",["T_WHITESPACE"," ",181],["T_VARIABLE","$filename",181],")",")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                ",181],["T_VARIABLE","$index",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_LNUMBER","1",182],";",["T_WHITESPACE","\n                ",182],["T_VARIABLE","$extension",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_STRING","strrchr",183],"(",["T_VARIABLE","$filename",183],",",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","'.'",183],")",";",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$filenameWoExtension",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","substr",184],"(",["T_VARIABLE","$filename",184],",",["T_WHITESPACE"," ",184],["T_LNUMBER","0",184],",",["T_WHITESPACE"," ",184],"-",["T_LNUMBER","1",184],["T_WHITESPACE"," ",184],"*",["T_WHITESPACE"," ",184],["T_STRING","strlen",184],"(",["T_VARIABLE","$extension",184],")",")",";",["T_WHITESPACE","\n                ",184],["T_WHILE","while",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","fileExists",185],"(",["T_VARIABLE","$directory",185],["T_WHITESPACE"," ",185],".",["T_WHITESPACE"," ",185],["T_VARIABLE","$filenameWoExtension",185],["T_WHITESPACE"," ",185],".",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","'_'",185],["T_WHITESPACE"," ",185],".",["T_WHITESPACE"," ",185],["T_VARIABLE","$index",185],["T_WHITESPACE"," ",185],".",["T_WHITESPACE"," ",185],["T_VARIABLE","$extension",185],")",")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                    ",185],["T_VARIABLE","$index",186],["T_WHITESPACE"," ",186],["T_INC","++",186],";",["T_WHITESPACE","\n                ",186],"}",["T_WHITESPACE","\n                ",187],["T_VARIABLE","$filename",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$filenameWoExtension",188],["T_WHITESPACE"," ",188],".",["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'_'",188],["T_WHITESPACE"," ",188],".",["T_WHITESPACE"," ",188],["T_VARIABLE","$index",188],["T_WHITESPACE"," ",188],".",["T_WHITESPACE"," ",188],["T_VARIABLE","$extension",188],";",["T_WHITESPACE","\n            ",188],"}",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n        ",190],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$filename",191],";",["T_WHITESPACE","\n    ",191],"}",["T_WHITESPACE","\n\n    ",192],["T_DOC_COMMENT","\/**\n     * Save database file to file system\n     *\n     * @param string $filename\n     * @return bool|int\n     *\/",194],["T_WHITESPACE","\n    ",199],["T_PUBLIC","public",200],["T_WHITESPACE"," ",200],["T_FUNCTION","function",200],["T_WHITESPACE"," ",200],["T_STRING","saveFileToFilesystem",200],"(",["T_VARIABLE","$filename",200],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n        ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","checkDbUsage",201],"(",")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_DOC_COMMENT","\/** @var $file Mage_Core_Model_File_Storage_Database *\/",202],["T_WHITESPACE","\n            ",202],["T_VARIABLE","$file",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_STRING","Mage",203],["T_DOUBLE_COLON","::",203],["T_STRING","getModel",203],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",203],")",["T_WHITESPACE","\n                ",203],["T_OBJECT_OPERATOR","->",204],["T_STRING","loadByFilename",204],"(",["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","_removeAbsPathFromFileName",204],"(",["T_VARIABLE","$filename",204],")",")",";",["T_WHITESPACE","\n            ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(","!",["T_VARIABLE","$file",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getId",205],"(",")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n                ",205],["T_RETURN","return",206],["T_WHITESPACE"," ",206],["T_STRING","false",206],";",["T_WHITESPACE","\n            ",206],"}",["T_WHITESPACE","\n\n            ",207],["T_RETURN","return",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getStorageFileModel",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","saveFile",209],"(",["T_VARIABLE","$file",209],",",["T_WHITESPACE"," ",209],["T_STRING","true",209],")",";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Return relative uri for media content by full path\n     *\n     * @param string $fullPath\n     * @return string\n     *\/",213],["T_WHITESPACE","\n    ",218],["T_PUBLIC","public",219],["T_WHITESPACE"," ",219],["T_FUNCTION","function",219],["T_WHITESPACE"," ",219],["T_STRING","getMediaRelativePath",219],"(",["T_VARIABLE","$fullPath",219],")",["T_WHITESPACE","\n    ",219],"{",["T_WHITESPACE","\n        ",220],["T_VARIABLE","$relativePath",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_STRING","ltrim",221],"(",["T_STRING","str_replace",221],"(",["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getMediaBaseDir",221],"(",")",",",["T_WHITESPACE"," ",221],["T_CONSTANT_ENCAPSED_STRING","''",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$fullPath",221],")",",",["T_WHITESPACE"," ",221],["T_CONSTANT_ENCAPSED_STRING","'\\\\\/'",221],")",";",["T_WHITESPACE","\n        ",221],["T_RETURN","return",222],["T_WHITESPACE"," ",222],["T_STRING","str_replace",222],"(",["T_STRING","DS",222],",",["T_WHITESPACE"," ",222],["T_CONSTANT_ENCAPSED_STRING","'\/'",222],",",["T_WHITESPACE"," ",222],["T_VARIABLE","$relativePath",222],")",";",["T_WHITESPACE","\n    ",222],"}",["T_WHITESPACE","\n\n    ",223],["T_DOC_COMMENT","\/**\n     * Deletes from DB files, which belong to one folder\n     *\n     * @param string $folderName\n     *\/",225],["T_WHITESPACE","\n    ",229],["T_PUBLIC","public",230],["T_WHITESPACE"," ",230],["T_FUNCTION","function",230],["T_WHITESPACE"," ",230],["T_STRING","deleteFolder",230],"(",["T_VARIABLE","$folderName",230],")",["T_WHITESPACE","\n    ",230],"{",["T_WHITESPACE","\n        ",231],["T_IF","if",232],["T_WHITESPACE"," ",232],"(",["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","checkDbUsage",232],"(",")",")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n            ",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getResourceStorageModel",233],"(",")",["T_OBJECT_OPERATOR","->",233],["T_STRING","deleteFolder",233],"(",["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","_removeAbsPathFromFileName",233],"(",["T_VARIABLE","$folderName",233],")",")",";",["T_WHITESPACE","\n        ",233],"}",["T_WHITESPACE","\n    ",234],"}",["T_WHITESPACE","\n\n    ",235],["T_DOC_COMMENT","\/**\n     * Deletes from DB files, which belong to one folder\n     *\n     * @param string $filename\n     *\/",237],["T_WHITESPACE","\n    ",241],["T_PUBLIC","public",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","deleteFile",242],"(",["T_VARIABLE","$filename",242],")",["T_WHITESPACE","\n    ",242],"{",["T_WHITESPACE","\n        ",243],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","checkDbUsage",244],"(",")",")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n            ",244],["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getStorageDatabaseModel",245],"(",")",["T_OBJECT_OPERATOR","->",245],["T_STRING","deleteFile",245],"(",["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","_removeAbsPathFromFileName",245],"(",["T_VARIABLE","$filename",245],")",")",";",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * Saves uploaded by Mage_Core_Model_File_Uploader file to DB with existence tests\n     *\n     * param $result should be result from Mage_Core_Model_File_Uploader::save() method\n     * Checks in DB, whether uploaded file exists ($result['file'])\n     * If yes, renames file on FS (!!!!!)\n     * Saves file with unique name into DB\n     * If passed file exists returns new name, file was renamed to (in the same context)\n     * Otherwise returns $result['file']\n     *\n     * @param array $result\n     * @return string\n     *\/",249],["T_WHITESPACE","\n    ",261],["T_PUBLIC","public",262],["T_WHITESPACE"," ",262],["T_FUNCTION","function",262],["T_WHITESPACE"," ",262],["T_STRING","saveUploadedFile",262],"(",["T_VARIABLE","$result",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_ARRAY","array",262],"(",")",")",["T_WHITESPACE","\n    ",262],"{",["T_WHITESPACE","\n        ",263],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","checkDbUsage",264],"(",")",")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$path",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","rtrim",265],"(",["T_STRING","str_replace",265],"(",["T_ARRAY","array",265],"(",["T_CONSTANT_ENCAPSED_STRING","'\\\\'",265],",",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","'\/'",265],")",",",["T_WHITESPACE"," ",265],["T_STRING","DS",265],",",["T_WHITESPACE"," ",265],["T_VARIABLE","$result",265],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",265],"]",")",",",["T_WHITESPACE"," ",265],["T_STRING","DS",265],")",";",["T_WHITESPACE","\n            ",265],["T_VARIABLE","$file",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_CONSTANT_ENCAPSED_STRING","'\/'",266],["T_WHITESPACE"," ",266],".",["T_WHITESPACE"," ",266],["T_STRING","ltrim",266],"(",["T_VARIABLE","$result",266],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",266],"]",",",["T_WHITESPACE"," ",266],["T_CONSTANT_ENCAPSED_STRING","'\\\\\/'",266],")",";",["T_WHITESPACE","\n\n            ",266],["T_VARIABLE","$uniqueResultFile",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","getUniqueFilename",268],"(",["T_VARIABLE","$path",268],",",["T_WHITESPACE"," ",268],["T_VARIABLE","$file",268],")",";",["T_WHITESPACE","\n\n            ",268],["T_IF","if",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$uniqueResultFile",270],["T_WHITESPACE"," ",270],["T_IS_NOT_IDENTICAL","!==",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$file",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n                ",270],["T_VARIABLE","$ioFile",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_NEW","new",271],["T_WHITESPACE"," ",271],["T_STRING","Varien_Io_File",271],"(",")",";",["T_WHITESPACE","\n                ",271],["T_VARIABLE","$ioFile",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","open",272],"(",["T_ARRAY","array",272],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",272],["T_WHITESPACE"," ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$path",272],")",")",";",["T_WHITESPACE","\n                ",272],["T_VARIABLE","$ioFile",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","mv",273],"(",["T_VARIABLE","$path",273],["T_WHITESPACE"," ",273],".",["T_WHITESPACE"," ",273],["T_VARIABLE","$file",273],",",["T_WHITESPACE"," ",273],["T_VARIABLE","$path",273],["T_WHITESPACE"," ",273],".",["T_WHITESPACE"," ",273],["T_VARIABLE","$uniqueResultFile",273],")",";",["T_WHITESPACE","\n            ",273],"}",["T_WHITESPACE","\n            ",274],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","saveFile",275],"(",["T_VARIABLE","$path",275],["T_WHITESPACE"," ",275],".",["T_WHITESPACE"," ",275],["T_VARIABLE","$uniqueResultFile",275],")",";",["T_WHITESPACE","\n\n            ",275],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_VARIABLE","$uniqueResultFile",277],";",["T_WHITESPACE","\n        ",277],"}",["T_WHITESPACE"," ",278],["T_ELSE","else",278],["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n            ",278],["T_RETURN","return",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$result",279],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",279],"]",";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n    ",280],"}",["T_WHITESPACE","\n\n    ",281],["T_DOC_COMMENT","\/**\n     * Convert full file path to local (as used by model)\n     * If not - returns just a filename\n     *\n     * @param string $filename\n     * @return string\n     *\/",283],["T_WHITESPACE","\n    ",289],["T_PROTECTED","protected",290],["T_WHITESPACE"," ",290],["T_FUNCTION","function",290],["T_WHITESPACE"," ",290],["T_STRING","_removeAbsPathFromFileName",290],"(",["T_VARIABLE","$filename",290],")",["T_WHITESPACE","\n    ",290],"{",["T_WHITESPACE","\n        ",291],["T_RETURN","return",292],["T_WHITESPACE"," ",292],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getMediaRelativePath",292],"(",["T_VARIABLE","$filename",292],")",";",["T_WHITESPACE","\n    ",292],"}",["T_WHITESPACE","\n\n    ",293],["T_DOC_COMMENT","\/**\n     * Return Media base dir\n     *\n     * @return string\n     *\/",295],["T_WHITESPACE","\n    ",299],["T_PUBLIC","public",300],["T_WHITESPACE"," ",300],["T_FUNCTION","function",300],["T_WHITESPACE"," ",300],["T_STRING","getMediaBaseDir",300],"(",")",["T_WHITESPACE","\n    ",300],"{",["T_WHITESPACE","\n        ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_STRING","null",302],["T_WHITESPACE"," ",302],["T_IS_IDENTICAL","===",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_mediaBaseDirectory",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_mediaBaseDirectory",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_STRING","rtrim",303],"(",["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","getBaseDir",303],"(",["T_CONSTANT_ENCAPSED_STRING","'media'",303],")",",",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'\\\\\/'",303],")",";",["T_WHITESPACE","\n        ",303],"}",["T_WHITESPACE","\n        ",304],["T_RETURN","return",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_mediaBaseDirectory",305],";",["T_WHITESPACE","\n    ",305],"}",["T_WHITESPACE","\n",306],"}",["T_WHITESPACE","\n",307]]