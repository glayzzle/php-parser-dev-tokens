[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Core Resource Resource Model\n *\n * @category    Mage\n * @package     Mage_Core\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Resource",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Database versions\n     *\n     * @var array\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_STATIC","static",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_versions",42],["T_WHITESPACE","        ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","null",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Resource data versions cache array\n     *\n     * @var array\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_STATIC","static",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_dataVersions",49],["T_WHITESPACE","    ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","null",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Define main table\n     *\n     *\/",51],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","_construct",55],"(",")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_init",57],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource'",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'store_id'",57],")",";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Fill static versions arrays.\n     * This routine fetches Db and Data versions of at once to optimize sql requests. However, when upgrading, it's\n     * possible that 'data' column will be created only after all Db installs are passed. So $neededType contains\n     * information on main purpose of calling this routine, and even when 'data' column is absent - it won't require\n     * reissuing new sql just to get 'db' version of module.\n     *\n     * @param string $needType Can be 'db' or 'data'\n     * @return Mage_Core_Model_Resource_Resource\n     *\/",60],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","_loadVersionData",70],"(",["T_VARIABLE","$needType",70],")",["T_WHITESPACE","\n    ",70],"{",["T_WHITESPACE","\n        ",71],["T_IF","if",72],["T_WHITESPACE"," ",72],"(","(","(",["T_VARIABLE","$needType",72],["T_WHITESPACE"," ",72],["T_IS_EQUAL","==",72],["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'db'",72],")",["T_WHITESPACE"," ",72],["T_BOOLEAN_AND","&&",72],["T_WHITESPACE"," ",72],["T_STRING","is_null",72],"(",["T_STRING","self",72],["T_DOUBLE_COLON","::",72],["T_VARIABLE","$_versions",72],")",")",["T_WHITESPACE","\n            ",72],["T_BOOLEAN_OR","||",73],["T_WHITESPACE"," ",73],"(","(",["T_VARIABLE","$needType",73],["T_WHITESPACE"," ",73],["T_IS_EQUAL","==",73],["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'data'",73],")",["T_WHITESPACE"," ",73],["T_BOOLEAN_AND","&&",73],["T_WHITESPACE"," ",73],["T_STRING","is_null",73],"(",["T_STRING","self",73],["T_DOUBLE_COLON","::",73],["T_VARIABLE","$_dataVersions",73],")",")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_STRING","self",74],["T_DOUBLE_COLON","::",74],["T_VARIABLE","$_versions",74],["T_WHITESPACE","     ",74],"=",["T_WHITESPACE"," ",74],["T_ARRAY","array",74],"(",")",";",["T_WHITESPACE"," ",74],["T_COMMENT","\/\/ Db version column always exists\n",74],["T_WHITESPACE","            ",75],["T_STRING","self",75],["T_DOUBLE_COLON","::",75],["T_VARIABLE","$_dataVersions",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","null",75],";",["T_WHITESPACE"," ",75],["T_COMMENT","\/\/ Data version array will be filled only if Data column exist\n",75],["T_WHITESPACE","\n            ",76],["T_IF","if",77],["T_WHITESPACE"," ",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_getReadAdapter",77],"(",")",["T_OBJECT_OPERATOR","->",77],["T_STRING","isTableExists",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getMainTable",77],"(",")",")",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n                ",77],["T_VARIABLE","$select",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_getReadAdapter",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","select",78],"(",")",["T_WHITESPACE","\n                    ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","from",79],"(",["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getMainTable",79],"(",")",",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'*'",79],")",";",["T_WHITESPACE","\n                ",79],["T_VARIABLE","$rowset",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_getReadAdapter",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","fetchAll",80],"(",["T_VARIABLE","$select",80],")",";",["T_WHITESPACE","\n                ",80],["T_FOREACH","foreach",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$rowset",81],["T_WHITESPACE"," ",81],["T_AS","as",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$row",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n                    ",81],["T_STRING","self",82],["T_DOUBLE_COLON","::",82],["T_VARIABLE","$_versions",82],"[",["T_VARIABLE","$row",82],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",82],"]","]",["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$row",82],"[",["T_CONSTANT_ENCAPSED_STRING","'version'",82],"]",";",["T_WHITESPACE","\n                    ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_STRING","array_key_exists",83],"(",["T_CONSTANT_ENCAPSED_STRING","'data_version'",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$row",83],")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                        ",83],["T_IF","if",84],["T_WHITESPACE"," ",84],"(",["T_STRING","is_null",84],"(",["T_STRING","self",84],["T_DOUBLE_COLON","::",84],["T_VARIABLE","$_dataVersions",84],")",")",["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n                            ",84],["T_STRING","self",85],["T_DOUBLE_COLON","::",85],["T_VARIABLE","$_dataVersions",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_ARRAY","array",85],"(",")",";",["T_WHITESPACE","\n                        ",85],"}",["T_WHITESPACE","\n                        ",86],["T_STRING","self",87],["T_DOUBLE_COLON","::",87],["T_VARIABLE","$_dataVersions",87],"[",["T_VARIABLE","$row",87],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",87],"]","]",["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$row",87],"[",["T_CONSTANT_ENCAPSED_STRING","'data_version'",87],"]",";",["T_WHITESPACE","\n                    ",87],"}",["T_WHITESPACE","\n                ",88],"}",["T_WHITESPACE","\n            ",89],"}",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n\n        ",91],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Get Module version from DB\n     *\n     * @param string $resName\n     * @return bool|string\n     *\/",97],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getDbVersion",103],"(",["T_VARIABLE","$resName",103],")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(","!",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_getReadAdapter",105],"(",")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_STRING","false",106],";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_loadVersionData",108],"(",["T_CONSTANT_ENCAPSED_STRING","'db'",108],")",";",["T_WHITESPACE","\n        ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_ISSET","isset",109],"(",["T_STRING","self",109],["T_DOUBLE_COLON","::",109],["T_VARIABLE","$_versions",109],"[",["T_VARIABLE","$resName",109],"]",")",["T_WHITESPACE"," ",109],"?",["T_WHITESPACE"," ",109],["T_STRING","self",109],["T_DOUBLE_COLON","::",109],["T_VARIABLE","$_versions",109],"[",["T_VARIABLE","$resName",109],"]",["T_WHITESPACE"," ",109],":",["T_WHITESPACE"," ",109],["T_STRING","false",109],";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Set module version into DB\n     *\n     * @param string $resName\n     * @param string $version\n     * @return int\n     *\/",112],["T_WHITESPACE","\n    ",118],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","setDbVersion",119],"(",["T_VARIABLE","$resName",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$version",119],")",["T_WHITESPACE","\n    ",119],"{",["T_WHITESPACE","\n        ",120],["T_VARIABLE","$dbModuleInfo",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_ARRAY","array",121],"(",["T_WHITESPACE","\n            ",121],["T_CONSTANT_ENCAPSED_STRING","'code'",122],["T_WHITESPACE","    ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$resName",122],",",["T_WHITESPACE","\n            ",122],["T_CONSTANT_ENCAPSED_STRING","'version'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$version",123],",",["T_WHITESPACE","\n        ",123],")",";",["T_WHITESPACE","\n\n        ",124],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getDbVersion",126],"(",["T_VARIABLE","$resName",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_STRING","self",127],["T_DOUBLE_COLON","::",127],["T_VARIABLE","$_versions",127],"[",["T_VARIABLE","$resName",127],"]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$version",127],";",["T_WHITESPACE","\n            ",127],["T_RETURN","return",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_getWriteAdapter",128],"(",")",["T_OBJECT_OPERATOR","->",128],["T_STRING","update",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","getMainTable",128],"(",")",",",["T_WHITESPACE","\n                    ",128],["T_VARIABLE","$dbModuleInfo",129],",",["T_WHITESPACE","\n                    ",129],["T_ARRAY","array",130],"(",["T_CONSTANT_ENCAPSED_STRING","'code = ?'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$resName",130],")",")",";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE"," ",131],["T_ELSE","else",131],["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n            ",131],["T_STRING","self",132],["T_DOUBLE_COLON","::",132],["T_VARIABLE","$_versions",132],"[",["T_VARIABLE","$resName",132],"]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$version",132],";",["T_WHITESPACE","\n            ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_getWriteAdapter",133],"(",")",["T_OBJECT_OPERATOR","->",133],["T_STRING","insert",133],"(",["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getMainTable",133],"(",")",",",["T_WHITESPACE"," ",133],["T_VARIABLE","$dbModuleInfo",133],")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Get resource data version\n     *\n     * @param string $resName\n     * @return string|false\n     *\/",137],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","getDataVersion",143],"(",["T_VARIABLE","$resName",143],")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(","!",["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_getReadAdapter",145],"(",")",")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_STRING","false",146],";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE","\n\n        ",147],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_loadVersionData",149],"(",["T_CONSTANT_ENCAPSED_STRING","'data'",149],")",";",["T_WHITESPACE","\n\n        ",149],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_ISSET","isset",151],"(",["T_STRING","self",151],["T_DOUBLE_COLON","::",151],["T_VARIABLE","$_dataVersions",151],"[",["T_VARIABLE","$resName",151],"]",")",["T_WHITESPACE"," ",151],"?",["T_WHITESPACE"," ",151],["T_STRING","self",151],["T_DOUBLE_COLON","::",151],["T_VARIABLE","$_dataVersions",151],"[",["T_VARIABLE","$resName",151],"]",["T_WHITESPACE"," ",151],":",["T_WHITESPACE"," ",151],["T_STRING","false",151],";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Specify resource data version\n     *\n     * @param string $resName\n     * @param string $version\n     * @return Mage_Core_Model_Resource_Resource\n     *\/",154],["T_WHITESPACE","\n    ",160],["T_PUBLIC","public",161],["T_WHITESPACE"," ",161],["T_FUNCTION","function",161],["T_WHITESPACE"," ",161],["T_STRING","setDataVersion",161],"(",["T_VARIABLE","$resName",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$version",161],")",["T_WHITESPACE","\n    ",161],"{",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$data",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_ARRAY","array",163],"(",["T_WHITESPACE","\n            ",163],["T_CONSTANT_ENCAPSED_STRING","'code'",164],["T_WHITESPACE","          ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$resName",164],",",["T_WHITESPACE","\n            ",164],["T_CONSTANT_ENCAPSED_STRING","'data_version'",165],["T_WHITESPACE","  ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$version",165],["T_WHITESPACE","\n        ",165],")",";",["T_WHITESPACE","\n\n        ",166],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getDbVersion",168],"(",["T_VARIABLE","$resName",168],")",["T_WHITESPACE"," ",168],["T_BOOLEAN_OR","||",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getDataVersion",168],"(",["T_VARIABLE","$resName",168],")",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_STRING","self",169],["T_DOUBLE_COLON","::",169],["T_VARIABLE","$_dataVersions",169],"[",["T_VARIABLE","$resName",169],"]",["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$version",169],";",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","_getWriteAdapter",170],"(",")",["T_OBJECT_OPERATOR","->",170],["T_STRING","update",170],"(",["T_VARIABLE","$this",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getMainTable",170],"(",")",",",["T_WHITESPACE"," ",170],["T_VARIABLE","$data",170],",",["T_WHITESPACE"," ",170],["T_ARRAY","array",170],"(",["T_CONSTANT_ENCAPSED_STRING","'code = ?'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$resName",170],")",")",";",["T_WHITESPACE","\n        ",170],"}",["T_WHITESPACE"," ",171],["T_ELSE","else",171],["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_STRING","self",172],["T_DOUBLE_COLON","::",172],["T_VARIABLE","$_dataVersions",172],"[",["T_VARIABLE","$resName",172],"]",["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$version",172],";",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_getWriteAdapter",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","insert",173],"(",["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getMainTable",173],"(",")",",",["T_WHITESPACE"," ",173],["T_VARIABLE","$data",173],")",";",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE","\n        ",174],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],";",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n",176],"}",["T_WHITESPACE","\n",177]]