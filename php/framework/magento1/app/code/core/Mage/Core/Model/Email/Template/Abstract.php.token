[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Template model\n *\n * @category    Mage\n * @package     Mage_Core\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_ABSTRACT","abstract",34],["T_WHITESPACE"," ",34],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Email_Template_Abstract",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Model_Template",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO",36],["T_WHITESPACE","            ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'design\/email\/logo'",36],";",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO_ALT",37],["T_WHITESPACE","        ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'design\/email\/logo_alt'",37],";",["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO_WIDTH",38],["T_WHITESPACE","      ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'design\/email\/logo_width'",38],";",["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO_HEIGHT",39],["T_WHITESPACE","     ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'design\/email\/logo_height'",39],";",["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","XML_PATH_CSS_NON_INLINE_FILES",40],["T_WHITESPACE","         ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'design\/email\/css_non_inline'",40],";",["T_WHITESPACE","\n\n    ",40],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_cssFileCache",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_ARRAY","array",42],"(",")",";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Get template code for template directive\n     *\n     * @param   string $configPath\n     * @param   array $variables\n     * @return  string\n     *\/",44],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","getTemplateByConfigPath",51],"(",["T_VARIABLE","$configPath",51],",",["T_WHITESPACE"," ",51],["T_ARRAY","array",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$variables",51],")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$template",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","Mage",53],["T_DOUBLE_COLON","::",53],["T_STRING","getModel",53],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/email_template'",53],")",";",["T_WHITESPACE","\n        ",53],["T_VARIABLE","$template",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","loadByConfigPath",54],"(",["T_VARIABLE","$configPath",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$variables",54],")",";",["T_WHITESPACE","\n\n        ",54],["T_RETURN","return",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$template",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getProcessedTemplate",56],"(",["T_VARIABLE","$variables",56],")",";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Load template by configuration path. This enables html templates to include other html templates by their\n     * system configuration XPATH value\n     *\n     * @param   string $configPath The path to the config setting that defines which global\/template\/email\/* node\n     * should be used to load the email template\n     * @return   Mage_Core_Model_Email_Template\n     *\/",59],["T_WHITESPACE","\n    ",66],["T_PUBLIC","public",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","loadByConfigPath",67],"(",["T_VARIABLE","$configPath",67],")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$templateId",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","Mage",69],["T_DOUBLE_COLON","::",69],["T_STRING","getStoreConfig",69],"(",["T_VARIABLE","$configPath",69],")",";",["T_WHITESPACE","\n\n        ",69],["T_IF","if",71],["T_WHITESPACE"," ",71],"(",["T_STRING","is_numeric",71],"(",["T_VARIABLE","$templateId",71],")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_COMMENT","\/\/ Template was overridden in admin, so load template from database\n",72],["T_WHITESPACE","            ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","load",73],"(",["T_VARIABLE","$templateId",73],")",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE"," ",74],["T_ELSE","else",74],["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$defaultTemplates",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","Mage_Core_Model_Email_Template",75],["T_DOUBLE_COLON","::",75],["T_STRING","getDefaultTemplates",75],"(",")",";",["T_WHITESPACE","\n            ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(","!",["T_ISSET","isset",76],"(",["T_VARIABLE","$defaultTemplates",76],"[",["T_VARIABLE","$templateId",76],"]",")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n                ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","null",77],";",["T_WHITESPACE","\n            ",77],"}",["T_WHITESPACE","\n\n            ",78],["T_VARIABLE","$storeId",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getDesignConfig",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","getStore",80],"(",")",";",["T_WHITESPACE","\n\n            ",80],["T_VARIABLE","$data",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],"&",["T_VARIABLE","$defaultTemplates",82],"[",["T_VARIABLE","$templateId",82],"]",";",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","setTemplateType",83],"(",["T_VARIABLE","$data",83],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",83],"]",["T_IS_EQUAL","==",83],["T_CONSTANT_ENCAPSED_STRING","'html'",83],["T_WHITESPACE"," ",83],"?",["T_WHITESPACE"," ",83],["T_STRING","self",83],["T_DOUBLE_COLON","::",83],["T_STRING","TYPE_HTML",83],["T_WHITESPACE"," ",83],":",["T_WHITESPACE"," ",83],["T_STRING","self",83],["T_DOUBLE_COLON","::",83],["T_STRING","TYPE_TEXT",83],")",";",["T_WHITESPACE","\n\n            ",83],["T_VARIABLE","$localeCode",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","getStoreConfig",85],"(",["T_CONSTANT_ENCAPSED_STRING","'general\/locale\/code'",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$storeId",85],")",";",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$templateText",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_STRING","Mage",86],["T_DOUBLE_COLON","::",86],["T_STRING","app",86],"(",")",["T_OBJECT_OPERATOR","->",86],["T_STRING","getTranslator",86],"(",")",["T_OBJECT_OPERATOR","->",86],["T_STRING","getTemplateFile",86],"(",["T_WHITESPACE","\n                ",86],["T_VARIABLE","$data",87],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",87],"]",",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'email'",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$localeCode",87],["T_WHITESPACE","\n            ",87],")",";",["T_WHITESPACE","\n\n            ",88],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setTemplateText",90],"(",["T_VARIABLE","$templateText",90],")",";",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","setId",91],"(",["T_VARIABLE","$templateId",91],")",";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_COMMENT","\/\/ Templates loaded via the {{template config_path=\"\"}} syntax don't support the subject\/vars\/styles\n",94],["T_WHITESPACE","        ",95],["T_COMMENT","\/\/ comment blocks, so strip them out\n",95],["T_WHITESPACE","        ",96],["T_VARIABLE","$templateText",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","preg_replace",96],"(",["T_CONSTANT_ENCAPSED_STRING","'\/<!--@(\\w+)\\s*(.*?)\\s*@-->\/us'",96],",",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","''",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getTemplateText",96],"(",")",")",";",["T_WHITESPACE","\n        ",96],["T_COMMENT","\/\/ Remove comment lines\n",97],["T_WHITESPACE","        ",98],["T_VARIABLE","$templateText",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","preg_replace",98],"(",["T_CONSTANT_ENCAPSED_STRING","'#\\{\\*.*\\*\\}#suU'",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","''",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$templateText",98],")",";",["T_WHITESPACE","\n\n        ",98],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","setTemplateText",100],"(",["T_VARIABLE","$templateText",100],")",";",["T_WHITESPACE","\n\n        ",100],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Return logo URL for emails\n     * Take logo from skin if custom logo is undefined\n     *\n     * @param  Mage_Core_Model_Store|int|string $store\n     * @return string\n     *\/",105],["T_WHITESPACE","\n    ",111],["T_PROTECTED","protected",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","_getLogoUrl",112],"(",["T_VARIABLE","$store",112],")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$store",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","Mage",114],["T_DOUBLE_COLON","::",114],["T_STRING","app",114],"(",")",["T_OBJECT_OPERATOR","->",114],["T_STRING","getStore",114],"(",["T_VARIABLE","$store",114],")",";",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$fileName",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$store",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getConfig",115],"(",["T_STRING","self",115],["T_DOUBLE_COLON","::",115],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO",115],")",";",["T_WHITESPACE","\n        ",115],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_VARIABLE","$fileName",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$uploadDir",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","Mage_Adminhtml_Model_System_Config_Backend_Email_Logo",117],["T_DOUBLE_COLON","::",117],["T_STRING","UPLOAD_DIR",117],";",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$fullFileName",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","getBaseDir",118],"(",["T_CONSTANT_ENCAPSED_STRING","'media'",118],")",["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_STRING","DS",118],["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_VARIABLE","$uploadDir",118],["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_STRING","DS",118],["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_VARIABLE","$fileName",118],";",["T_WHITESPACE","\n            ",118],["T_IF","if",119],["T_WHITESPACE"," ",119],"(",["T_STRING","file_exists",119],"(",["T_VARIABLE","$fullFileName",119],")",")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n                ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_STRING","Mage",120],["T_DOUBLE_COLON","::",120],["T_STRING","getBaseUrl",120],"(",["T_CONSTANT_ENCAPSED_STRING","'media'",120],")",["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_VARIABLE","$uploadDir",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","'\/'",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_VARIABLE","$fileName",120],";",["T_WHITESPACE","\n            ",120],"}",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n        ",122],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_STRING","Mage",123],["T_DOUBLE_COLON","::",123],["T_STRING","getDesign",123],"(",")",["T_OBJECT_OPERATOR","->",123],["T_STRING","getSkinUrl",123],"(",["T_CONSTANT_ENCAPSED_STRING","'images\/logo_email.gif'",123],")",";",["T_WHITESPACE","\n    ",123],"}",["T_WHITESPACE","\n\n    ",124],["T_DOC_COMMENT","\/**\n     * Return logo alt for emails\n     *\n     * @param  Mage_Core_Model_Store|int|string $store\n     * @return string\n     *\/",126],["T_WHITESPACE","\n    ",131],["T_PROTECTED","protected",132],["T_WHITESPACE"," ",132],["T_FUNCTION","function",132],["T_WHITESPACE"," ",132],["T_STRING","_getLogoAlt",132],"(",["T_VARIABLE","$store",132],")",["T_WHITESPACE","\n    ",132],"{",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$store",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_STRING","Mage",134],["T_DOUBLE_COLON","::",134],["T_STRING","app",134],"(",")",["T_OBJECT_OPERATOR","->",134],["T_STRING","getStore",134],"(",["T_VARIABLE","$store",134],")",";",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$alt",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$store",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getConfig",135],"(",["T_STRING","self",135],["T_DOUBLE_COLON","::",135],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO_ALT",135],")",";",["T_WHITESPACE","\n        ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$alt",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n            ",136],["T_RETURN","return",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$alt",137],";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE","\n        ",138],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$store",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getFrontendName",139],"(",")",";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n\n    ",140],["T_DOC_COMMENT","\/**\n     * Add variables that are used by transactional emails and newsletter emails\n     *\n     * @param $variables\n     * @param $storeId\n     * @return mixed\n     *\/",142],["T_WHITESPACE","\n    ",148],["T_PROTECTED","protected",149],["T_WHITESPACE"," ",149],["T_FUNCTION","function",149],["T_WHITESPACE"," ",149],["T_STRING","_addEmailVariables",149],"(",["T_VARIABLE","$variables",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$storeId",149],")",["T_WHITESPACE","\n    ",149],"{",["T_WHITESPACE","\n        ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(","!",["T_ISSET","isset",151],"(",["T_VARIABLE","$variables",151],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",151],"]",")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$variables",152],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",152],"]",["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_STRING","Mage",152],["T_DOUBLE_COLON","::",152],["T_STRING","app",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","getStore",152],"(",["T_VARIABLE","$storeId",152],")",";",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE","\n        ",153],["T_IF","if",154],["T_WHITESPACE"," ",154],"(","!",["T_ISSET","isset",154],"(",["T_VARIABLE","$variables",154],"[",["T_CONSTANT_ENCAPSED_STRING","'logo_url'",154],"]",")",")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$variables",155],"[",["T_CONSTANT_ENCAPSED_STRING","'logo_url'",155],"]",["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_getLogoUrl",155],"(",["T_VARIABLE","$storeId",155],")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n        ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(","!",["T_ISSET","isset",157],"(",["T_VARIABLE","$variables",157],"[",["T_CONSTANT_ENCAPSED_STRING","'logo_alt'",157],"]",")",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$variables",158],"[",["T_CONSTANT_ENCAPSED_STRING","'logo_alt'",158],"]",["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getLogoAlt",158],"(",["T_VARIABLE","$storeId",158],")",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n\n        ",159],["T_VARIABLE","$defaultValuesMap",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_ARRAY","array",161],"(",["T_WHITESPACE","\n            ",161],["T_CONSTANT_ENCAPSED_STRING","\"logo_width\"",162],["T_WHITESPACE"," ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_STRING","self",162],["T_DOUBLE_COLON","::",162],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO_WIDTH",162],",",["T_WHITESPACE","\n            ",162],["T_CONSTANT_ENCAPSED_STRING","\"logo_height\"",163],["T_WHITESPACE"," ",163],["T_DOUBLE_ARROW","=>",163],["T_WHITESPACE"," ",163],["T_STRING","self",163],["T_DOUBLE_COLON","::",163],["T_STRING","XML_PATH_DESIGN_EMAIL_LOGO_HEIGHT",163],",",["T_WHITESPACE","\n            ",163],["T_CONSTANT_ENCAPSED_STRING","\"phone\"",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_STRING","Mage_Core_Model_Store",164],["T_DOUBLE_COLON","::",164],["T_STRING","XML_PATH_STORE_STORE_PHONE",164],",",["T_WHITESPACE","\n            ",164],["T_CONSTANT_ENCAPSED_STRING","\"store_phone\"",165],["T_WHITESPACE"," ",165],["T_DOUBLE_ARROW","=>",165],["T_WHITESPACE"," ",165],["T_STRING","Mage_Core_Model_Store",165],["T_DOUBLE_COLON","::",165],["T_STRING","XML_PATH_STORE_STORE_PHONE",165],",",["T_WHITESPACE","\n            ",165],["T_CONSTANT_ENCAPSED_STRING","\"store_hours\"",166],["T_WHITESPACE"," ",166],["T_DOUBLE_ARROW","=>",166],["T_WHITESPACE"," ",166],["T_STRING","Mage_Core_Model_Store",166],["T_DOUBLE_COLON","::",166],["T_STRING","XML_PATH_STORE_STORE_HOURS",166],",",["T_WHITESPACE","\n            ",166],["T_CONSTANT_ENCAPSED_STRING","\"store_email\"",167],["T_WHITESPACE"," ",167],["T_DOUBLE_ARROW","=>",167],["T_WHITESPACE"," ",167],["T_STRING","Mage_Customer_Helper_Data",167],["T_DOUBLE_COLON","::",167],["T_STRING","XML_PATH_SUPPORT_EMAIL",167],",",["T_WHITESPACE","\n        ",167],")",";",["T_WHITESPACE","\n\n        ",168],["T_FOREACH","foreach",170],["T_WHITESPACE"," ",170],"(",["T_VARIABLE","$defaultValuesMap",170],["T_WHITESPACE"," ",170],["T_AS","as",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$variableName",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$configValue",170],")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(","!",["T_ISSET","isset",171],"(",["T_VARIABLE","$variables",171],"[",["T_VARIABLE","$variableName",171],"]",")",")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n                ",171],["T_VARIABLE","$variables",172],"[",["T_VARIABLE","$variableName",172],"]",["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_STRING","Mage",172],["T_DOUBLE_COLON","::",172],["T_STRING","getStoreConfig",172],"(",["T_VARIABLE","$configValue",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$storeId",172],")",";",["T_WHITESPACE","\n            ",172],"}",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE","\n        ",174],["T_COMMENT","\/\/ If template is text mode, don't include styles\n",175],["T_WHITESPACE","        ",176],["T_IF","if",176],["T_WHITESPACE"," ",176],"(","!",["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","isPlain",176],"(",")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$variables",177],"[",["T_CONSTANT_ENCAPSED_STRING","'non_inline_styles'",177],"]",["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_getNonInlineCssTag",177],"(",")",";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n        ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$variables",179],";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n\n    ",180],["T_DOC_COMMENT","\/**\n     * Merge HTML and CSS and returns HTML that has CSS styles applied \"inline\" to the HTML tags. This is necessary\n     * in order to support all email clients.\n     *\n     * @param $html\n     * @return string\n     *\/",182],["T_WHITESPACE","\n    ",188],["T_PROTECTED","protected",189],["T_WHITESPACE"," ",189],["T_FUNCTION","function",189],["T_WHITESPACE"," ",189],["T_STRING","_applyInlineCss",189],"(",["T_VARIABLE","$html",189],")",["T_WHITESPACE","\n    ",189],"{",["T_WHITESPACE","\n        ",190],["T_TRY","try",191],["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_COMMENT","\/\/ Check to see if the {{inlinecss file=\"\"}} directive set a CSS file to inline\n",192],["T_WHITESPACE","            ",193],["T_VARIABLE","$inlineCssFile",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getInlineCssFile",193],"(",")",";",["T_WHITESPACE","\n            ",193],["T_COMMENT","\/\/ Only run Emogrify if HTML exists\n",194],["T_WHITESPACE","            ",195],["T_IF","if",195],["T_WHITESPACE"," ",195],"(",["T_STRING","strlen",195],"(",["T_VARIABLE","$html",195],")",["T_WHITESPACE"," ",195],["T_BOOLEAN_AND","&&",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$inlineCssFile",195],")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n                ",195],["T_VARIABLE","$cssToInline",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_getCssFileContent",196],"(",["T_VARIABLE","$inlineCssFile",196],")",";",["T_WHITESPACE","\n                ",196],["T_VARIABLE","$emogrifier",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_NEW","new",197],["T_WHITESPACE"," ",197],["T_STRING","Pelago_Emogrifier",197],"(",")",";",["T_WHITESPACE","\n                ",197],["T_VARIABLE","$emogrifier",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","setHtml",198],"(",["T_VARIABLE","$html",198],")",";",["T_WHITESPACE","\n                ",198],["T_VARIABLE","$emogrifier",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","setCss",199],"(",["T_VARIABLE","$cssToInline",199],")",";",["T_WHITESPACE","\n                ",199],["T_COMMENT","\/\/ Don't parse inline <style> tags, since existing tag is intentionally for no-inline styles\n",200],["T_WHITESPACE","                ",201],["T_VARIABLE","$emogrifier",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","setParseInlineStyleTags",201],"(",["T_STRING","false",201],")",";",["T_WHITESPACE","\n\n                ",201],["T_VARIABLE","$processedHtml",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$emogrifier",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","emogrify",203],"(",")",";",["T_WHITESPACE","\n            ",203],"}",["T_WHITESPACE"," ",204],["T_ELSE","else",204],["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n                ",204],["T_VARIABLE","$processedHtml",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$html",205],";",["T_WHITESPACE","\n            ",205],"}",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE"," ",207],["T_CATCH","catch",207],["T_WHITESPACE"," ",207],"(",["T_STRING","Exception",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$e",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$processedHtml",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_CONSTANT_ENCAPSED_STRING","'{CSS inlining error: '",208],["T_WHITESPACE"," ",208],".",["T_WHITESPACE"," ",208],["T_VARIABLE","$e",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getMessage",208],"(",")",["T_WHITESPACE"," ",208],".",["T_WHITESPACE"," ",208],["T_CONSTANT_ENCAPSED_STRING","'}'",208],["T_WHITESPACE"," ",208],".",["T_WHITESPACE"," ",208],["T_STRING","PHP_EOL",208],["T_WHITESPACE"," ",208],".",["T_WHITESPACE"," ",208],["T_VARIABLE","$html",208],";",["T_WHITESPACE","\n        ",208],"}",["T_WHITESPACE","\n        ",209],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$processedHtml",210],";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Load CSS content from filesystem\n     *\n     * @param string $filename\n     * @return string\n     *\/",213],["T_WHITESPACE","\n    ",218],["T_PROTECTED","protected",219],["T_WHITESPACE"," ",219],["T_FUNCTION","function",219],["T_WHITESPACE"," ",219],["T_STRING","_getCssFileContent",219],"(",["T_VARIABLE","$filename",219],")",["T_WHITESPACE","\n    ",219],"{",["T_WHITESPACE","\n        ",220],["T_VARIABLE","$storeId",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getDesignConfig",221],"(",")",["T_OBJECT_OPERATOR","->",221],["T_STRING","getStore",221],"(",")",";",["T_WHITESPACE","\n        ",221],["T_VARIABLE","$area",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getDesignConfig",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","getArea",222],"(",")",";",["T_WHITESPACE","\n        ",222],["T_COMMENT","\/\/ This method should always be called within the context of the email's store, so these values will be correct\n",223],["T_WHITESPACE","        ",224],["T_VARIABLE","$package",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_STRING","Mage",224],["T_DOUBLE_COLON","::",224],["T_STRING","getDesign",224],"(",")",["T_OBJECT_OPERATOR","->",224],["T_STRING","getPackageName",224],"(",")",";",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$theme",225],["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_STRING","Mage",225],["T_DOUBLE_COLON","::",225],["T_STRING","getDesign",225],"(",")",["T_OBJECT_OPERATOR","->",225],["T_STRING","getTheme",225],"(",["T_CONSTANT_ENCAPSED_STRING","'skin'",225],")",";",["T_WHITESPACE","\n\n        ",225],["T_VARIABLE","$filePath",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_STRING","Mage",227],["T_DOUBLE_COLON","::",227],["T_STRING","getDesign",227],"(",")",["T_OBJECT_OPERATOR","->",227],["T_STRING","getFilename",227],"(",["T_WHITESPACE","\n            ",227],["T_CONSTANT_ENCAPSED_STRING","'css'",228],["T_WHITESPACE"," ",228],".",["T_WHITESPACE"," ",228],["T_STRING","DS",228],["T_WHITESPACE"," ",228],".",["T_WHITESPACE"," ",228],["T_VARIABLE","$filename",228],",",["T_WHITESPACE","\n            ",228],["T_ARRAY","array",229],"(",["T_WHITESPACE","\n                ",229],["T_CONSTANT_ENCAPSED_STRING","'_type'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_CONSTANT_ENCAPSED_STRING","'skin'",230],",",["T_WHITESPACE","\n                ",230],["T_CONSTANT_ENCAPSED_STRING","'_default'",231],["T_WHITESPACE"," ",231],["T_DOUBLE_ARROW","=>",231],["T_WHITESPACE"," ",231],["T_STRING","false",231],",",["T_WHITESPACE","\n                ",231],["T_CONSTANT_ENCAPSED_STRING","'_store'",232],["T_WHITESPACE"," ",232],["T_DOUBLE_ARROW","=>",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$storeId",232],",",["T_WHITESPACE","\n                ",232],["T_CONSTANT_ENCAPSED_STRING","'_area'",233],["T_WHITESPACE"," ",233],["T_DOUBLE_ARROW","=>",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$area",233],",",["T_WHITESPACE","\n                ",233],["T_CONSTANT_ENCAPSED_STRING","'_package'",234],["T_WHITESPACE"," ",234],["T_DOUBLE_ARROW","=>",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$package",234],",",["T_WHITESPACE","\n                ",234],["T_CONSTANT_ENCAPSED_STRING","'_theme'",235],["T_WHITESPACE"," ",235],["T_DOUBLE_ARROW","=>",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$theme",235],",",["T_WHITESPACE","\n            ",235],")",["T_WHITESPACE","\n        ",236],")",";",["T_WHITESPACE","\n\n        ",237],["T_IF","if",239],["T_WHITESPACE"," ",239],"(",["T_STRING","is_readable",239],"(",["T_VARIABLE","$filePath",239],")",")",["T_WHITESPACE"," ",239],"{",["T_WHITESPACE","\n            ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_STRING_CAST","(string)",240],["T_WHITESPACE"," ",240],["T_STRING","file_get_contents",240],"(",["T_VARIABLE","$filePath",240],")",";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n\n        ",241],["T_COMMENT","\/\/ If file can't be found, return empty string\n",243],["T_WHITESPACE","        ",244],["T_RETURN","return",244],["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","''",244],";",["T_WHITESPACE","\n    ",244],"}",["T_WHITESPACE","\n\n    ",245],["T_DOC_COMMENT","\/**\n     * Accepts a path to a System Config setting that contains a comma-delimited list of files to load. Loads those\n     * files and then returns the concatenated content.\n     *\n     * @param $configPath\n     * @return string\n     *\/",247],["T_WHITESPACE","\n    ",253],["T_PROTECTED","protected",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","_getCssByConfig",254],"(",["T_VARIABLE","$configPath",254],")",["T_WHITESPACE","\n    ",254],"{",["T_WHITESPACE","\n        ",255],["T_IF","if",256],["T_WHITESPACE"," ",256],"(","!",["T_ISSET","isset",256],"(",["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_cssFileCache",256],"[",["T_VARIABLE","$configPath",256],"]",")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$filesToLoad",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_STRING","Mage",257],["T_DOUBLE_COLON","::",257],["T_STRING","getStoreConfig",257],"(",["T_VARIABLE","$configPath",257],")",";",["T_WHITESPACE","\n            ",257],["T_IF","if",258],["T_WHITESPACE"," ",258],"(","!",["T_VARIABLE","$filesToLoad",258],")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n                ",258],["T_RETURN","return",259],["T_WHITESPACE"," ",259],["T_CONSTANT_ENCAPSED_STRING","''",259],";",["T_WHITESPACE","\n            ",259],"}",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$files",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_STRING","array_map",261],"(",["T_CONSTANT_ENCAPSED_STRING","'trim'",261],",",["T_WHITESPACE"," ",261],["T_STRING","explode",261],"(",["T_CONSTANT_ENCAPSED_STRING","\",\"",261],",",["T_WHITESPACE"," ",261],["T_VARIABLE","$filesToLoad",261],")",")",";",["T_WHITESPACE","\n\n            ",261],["T_VARIABLE","$css",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","''",263],";",["T_WHITESPACE","\n            ",263],["T_FOREACH","foreach",264],"(",["T_VARIABLE","$files",264],["T_WHITESPACE"," ",264],["T_AS","as",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$fileName",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n                ",264],["T_VARIABLE","$css",265],["T_WHITESPACE"," ",265],["T_CONCAT_EQUAL",".=",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_getCssFileContent",265],"(",["T_VARIABLE","$fileName",265],")",["T_WHITESPACE"," ",265],".",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",265],";",["T_WHITESPACE","\n            ",265],"}",["T_WHITESPACE","\n            ",266],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","_cssFileCache",267],"[",["T_VARIABLE","$configPath",267],"]",["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_VARIABLE","$css",267],";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE","\n\n        ",268],["T_RETURN","return",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_cssFileCache",270],"[",["T_VARIABLE","$configPath",270],"]",";",["T_WHITESPACE","\n    ",270],"}",["T_WHITESPACE","\n\n    ",271],["T_DOC_COMMENT","\/**\n     * Loads content of files with non-inline CSS styles and merges them with any CSS styles that are specified\n     * within the <!--@styles @--> comments or in the Transactional Emails\n     *\n     * @return string\n     *\/",273],["T_WHITESPACE","\n    ",278],["T_PROTECTED","protected",279],["T_WHITESPACE"," ",279],["T_FUNCTION","function",279],["T_WHITESPACE"," ",279],["T_STRING","_getNonInlineCssTag",279],"(",")",["T_WHITESPACE","\n    ",279],"{",["T_WHITESPACE","\n        ",280],["T_VARIABLE","$styleTagWrapper",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_CONSTANT_ENCAPSED_STRING","\"<style type=\\\"text\/css\\\">\\n%s\\n<\/style>\\n\"",281],";",["T_WHITESPACE","\n        ",281],["T_COMMENT","\/\/ Load the no-inline CSS styles from theme so they can be included in the style tag\n",282],["T_WHITESPACE","        ",283],["T_VARIABLE","$styleTagContent",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_getCssByConfig",283],"(",["T_STRING","self",283],["T_DOUBLE_COLON","::",283],["T_STRING","XML_PATH_CSS_NON_INLINE_FILES",283],")",";",["T_WHITESPACE","\n        ",283],["T_COMMENT","\/\/ Load the CSS that is included in the <!--@styles @--> comment or is added via Transactional Emails in admin\n",284],["T_WHITESPACE","        ",285],["T_VARIABLE","$styleTagContent",285],["T_WHITESPACE"," ",285],["T_CONCAT_EQUAL",".=",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","getTemplateStyles",285],"(",")",";",["T_WHITESPACE","\n        ",285],["T_RETURN","return",286],["T_WHITESPACE"," ",286],["T_STRING","sprintf",286],"(",["T_VARIABLE","$styleTagWrapper",286],",",["T_WHITESPACE"," ",286],["T_VARIABLE","$styleTagContent",286],")",";",["T_WHITESPACE","\n    ",286],"}",["T_WHITESPACE","\n",287],"}",["T_WHITESPACE","\n",288]]