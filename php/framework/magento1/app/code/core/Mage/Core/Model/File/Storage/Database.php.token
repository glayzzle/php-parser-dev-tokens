[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * File storage database model class\n *\n * @category    Mage\n * @package     Mage_Core\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_File_Storage_Database",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_File_Storage_Database_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Prefix of model events names\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_eventPrefix",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'core_file_storage_database'",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Directory singleton\n     *\n     * @var Mage_Core_Model_File_Storage_Directory_Database\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_directoryModel",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","null",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Collect errors during sync process\n     *\n     * @var array\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_errors",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",")",";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Class construct\n     *\n     * @param string $connectionName\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PUBLIC","public",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","__construct",63],"(",["T_VARIABLE","$connectionName",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","null",63],")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","_init",65],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",65],")",";",["T_WHITESPACE","\n\n        ",65],["T_STRING","parent",67],["T_DOUBLE_COLON","::",67],["T_STRING","__construct",67],"(",["T_VARIABLE","$connectionName",67],")",";",["T_WHITESPACE","\n    ",67],"}",["T_WHITESPACE","\n\n    ",68],["T_DOC_COMMENT","\/**\n     * Retrieve directory model\n     *\n     * @return Mage_Core_Model_File_Storage_Directory_Database\n     *\/",70],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","getDirectoryModel",75],"(",")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_IF","if",77],["T_WHITESPACE"," ",77],"(",["T_STRING","is_null",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_directoryModel",77],")",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_directoryModel",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","Mage",78],["T_DOUBLE_COLON","::",78],["T_STRING","getModel",78],"(",["T_WHITESPACE","\n                ",78],["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_directory_database'",79],",",["T_WHITESPACE","\n                ",79],["T_ARRAY","array",80],"(",["T_CONSTANT_ENCAPSED_STRING","'connection'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getConnectionName",80],"(",")",")",")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n\n        ",81],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_directoryModel",83],";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Create tables for file and directory storages\n     *\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PUBLIC","public",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","init",91],"(",")",["T_WHITESPACE","\n    ",91],"{",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getDirectoryModel",93],"(",")",["T_OBJECT_OPERATOR","->",93],["T_STRING","prepareStorage",93],"(",")",";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","prepareStorage",94],"(",")",";",["T_WHITESPACE","\n\n        ",94],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_DOC_COMMENT","\/**\n     * Return storage name\n     *\n     * @return string\n     *\/",99],["T_WHITESPACE","\n    ",103],["T_PUBLIC","public",104],["T_WHITESPACE"," ",104],["T_FUNCTION","function",104],["T_WHITESPACE"," ",104],["T_STRING","getStorageName",104],"(",")",["T_WHITESPACE","\n    ",104],"{",["T_WHITESPACE","\n        ",105],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_STRING","Mage",106],["T_DOUBLE_COLON","::",106],["T_STRING","helper",106],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",106],")",["T_OBJECT_OPERATOR","->",106],["T_STRING","__",106],"(",["T_CONSTANT_ENCAPSED_STRING","'database \"%s\"'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getConnectionName",106],"(",")",")",";",["T_WHITESPACE","\n    ",106],"}",["T_WHITESPACE","\n\n    ",107],["T_DOC_COMMENT","\/**\n     * Load object data by filename\n     *\n     * @param  string $filePath\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",109],["T_WHITESPACE","\n    ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","loadByFilename",115],"(",["T_VARIABLE","$filePath",115],")",["T_WHITESPACE","\n    ",115],"{",["T_WHITESPACE","\n        ",116],["T_VARIABLE","$filename",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","basename",117],"(",["T_VARIABLE","$filePath",117],")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$path",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_STRING","dirname",118],"(",["T_VARIABLE","$filePath",118],")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_getResource",119],"(",")",["T_OBJECT_OPERATOR","->",119],["T_STRING","loadByFilename",119],"(",["T_VARIABLE","$this",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$filename",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$path",119],")",";",["T_WHITESPACE","\n        ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Check if there was errors during sync process\n     *\n     * @return bool\n     *\/",123],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","hasErrors",128],"(",")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],"(","!",["T_EMPTY","empty",130],"(",["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","_errors",130],")",["T_WHITESPACE"," ",130],["T_BOOLEAN_OR","||",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getDirectoryModel",130],"(",")",["T_OBJECT_OPERATOR","->",130],["T_STRING","hasErrors",130],"(",")",")",";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Clear files and directories in storage\n     *\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",133],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","clear",138],"(",")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getDirectoryModel",140],"(",")",["T_OBJECT_OPERATOR","->",140],["T_STRING","clearDirectories",140],"(",")",";",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_getResource",141],"(",")",["T_OBJECT_OPERATOR","->",141],["T_STRING","clearFiles",141],"(",")",";",["T_WHITESPACE","\n        ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_DOC_COMMENT","\/**\n     * Export directories from storage\n     *\n     * @param  int $offset\n     * @param  int $count\n     * @return bool|array\n     *\/",145],["T_WHITESPACE","\n    ",151],["T_PUBLIC","public",152],["T_WHITESPACE"," ",152],["T_FUNCTION","function",152],["T_WHITESPACE"," ",152],["T_STRING","exportDirectories",152],"(",["T_VARIABLE","$offset",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_LNUMBER","0",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$count",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_LNUMBER","100",152],")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n        ",152],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getDirectoryModel",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","exportDirectories",153],"(",["T_VARIABLE","$offset",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$count",153],")",";",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     * Import directories to storage\n     *\n     * @param  array $dirs\n     * @return Mage_Core_Model_File_Storage_Directory_Database\n     *\/",156],["T_WHITESPACE","\n    ",161],["T_PUBLIC","public",162],["T_WHITESPACE"," ",162],["T_FUNCTION","function",162],["T_WHITESPACE"," ",162],["T_STRING","importDirectories",162],"(",["T_VARIABLE","$dirs",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n        ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getDirectoryModel",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","importDirectories",163],"(",["T_VARIABLE","$dirs",163],")",";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Export files list in defined range\n     *\n     * @param  int $offset\n     * @param  int $count\n     * @return array|bool\n     *\/",166],["T_WHITESPACE","\n    ",172],["T_PUBLIC","public",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","exportFiles",173],"(",["T_VARIABLE","$offset",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_LNUMBER","0",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$count",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_LNUMBER","100",173],")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$offset",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],"(",["T_INT_CAST","(int)",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$offset",175],["T_WHITESPACE"," ",175],["T_IS_GREATER_OR_EQUAL",">=",175],["T_WHITESPACE"," ",175],["T_LNUMBER","0",175],")",["T_WHITESPACE"," ",175],"?",["T_WHITESPACE"," ",175],["T_INT_CAST","(int)",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$offset",175],["T_WHITESPACE"," ",175],":",["T_WHITESPACE"," ",175],["T_LNUMBER","0",175],";",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$count",176],["T_WHITESPACE","  ",176],"=",["T_WHITESPACE"," ",176],"(",["T_INT_CAST","(int)",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$count",176],["T_WHITESPACE"," ",176],["T_IS_GREATER_OR_EQUAL",">=",176],["T_WHITESPACE"," ",176],["T_LNUMBER","1",176],")",["T_WHITESPACE"," ",176],"?",["T_WHITESPACE"," ",176],["T_INT_CAST","(int)",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$count",176],["T_WHITESPACE"," ",176],":",["T_WHITESPACE"," ",176],["T_LNUMBER","1",176],";",["T_WHITESPACE","\n\n        ",176],["T_VARIABLE","$result",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","_getResource",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","getFiles",178],"(",["T_VARIABLE","$offset",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$count",178],")",";",["T_WHITESPACE","\n        ",178],["T_IF","if",179],["T_WHITESPACE"," ",179],"(",["T_EMPTY","empty",179],"(",["T_VARIABLE","$result",179],")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n            ",179],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_STRING","false",180],";",["T_WHITESPACE","\n        ",180],"}",["T_WHITESPACE","\n\n        ",181],["T_RETURN","return",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$result",183],";",["T_WHITESPACE","\n    ",183],"}",["T_WHITESPACE","\n\n    ",184],["T_DOC_COMMENT","\/**\n     * Import files list\n     *\n     * @param  array $files\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",186],["T_WHITESPACE","\n    ",191],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","importFiles",192],"(",["T_VARIABLE","$files",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_IF","if",194],["T_WHITESPACE"," ",194],"(","!",["T_STRING","is_array",194],"(",["T_VARIABLE","$files",194],")",")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n\n        ",196],["T_VARIABLE","$dateSingleton",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_STRING","Mage",198],["T_DOUBLE_COLON","::",198],["T_STRING","getSingleton",198],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",198],")",";",["T_WHITESPACE","\n        ",198],["T_FOREACH","foreach",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$files",199],["T_WHITESPACE"," ",199],["T_AS","as",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$file",199],")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n            ",199],["T_IF","if",200],["T_WHITESPACE"," ",200],"(","!",["T_ISSET","isset",200],"(",["T_VARIABLE","$file",200],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",200],"]",")",["T_WHITESPACE"," ",200],["T_BOOLEAN_OR","||",200],["T_WHITESPACE"," ",200],"!",["T_STRING","strlen",200],"(",["T_VARIABLE","$file",200],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",200],"]",")",["T_WHITESPACE"," ",200],["T_BOOLEAN_OR","||",200],["T_WHITESPACE"," ",200],"!",["T_ISSET","isset",200],"(",["T_VARIABLE","$file",200],"[",["T_CONSTANT_ENCAPSED_STRING","'content'",200],"]",")",")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n                ",200],["T_CONTINUE","continue",201],";",["T_WHITESPACE","\n            ",201],"}",["T_WHITESPACE","\n\n            ",202],["T_TRY","try",204],["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n                ",204],["T_VARIABLE","$file",205],"[",["T_CONSTANT_ENCAPSED_STRING","'update_time'",205],"]",["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$dateSingleton",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","date",205],"(",")",";",["T_WHITESPACE","\n                ",205],["T_VARIABLE","$file",206],"[",["T_CONSTANT_ENCAPSED_STRING","'directory_id'",206],"]",["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],"(",["T_ISSET","isset",206],"(",["T_VARIABLE","$file",206],"[",["T_CONSTANT_ENCAPSED_STRING","'directory'",206],"]",")",["T_WHITESPACE"," ",206],["T_BOOLEAN_AND","&&",206],["T_WHITESPACE"," ",206],["T_STRING","strlen",206],"(",["T_VARIABLE","$file",206],"[",["T_CONSTANT_ENCAPSED_STRING","'directory'",206],"]",")",")",["T_WHITESPACE","\n                    ",206],"?",["T_WHITESPACE"," ",207],["T_STRING","Mage",207],["T_DOUBLE_COLON","::",207],["T_STRING","getModel",207],"(",["T_WHITESPACE","\n                        ",207],["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_directory_database'",208],",",["T_WHITESPACE","\n                        ",208],["T_ARRAY","array",209],"(",["T_CONSTANT_ENCAPSED_STRING","'connection'",209],["T_WHITESPACE"," ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getConnectionName",209],"(",")",")",")",["T_WHITESPACE","\n                            ",209],["T_OBJECT_OPERATOR","->",210],["T_STRING","loadByPath",210],"(",["T_VARIABLE","$file",210],"[",["T_CONSTANT_ENCAPSED_STRING","'directory'",210],"]",")",["T_OBJECT_OPERATOR","->",210],["T_STRING","getId",210],"(",")",["T_WHITESPACE","\n                    ",210],":",["T_WHITESPACE"," ",211],["T_STRING","null",211],";",["T_WHITESPACE","\n\n                ",211],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_getResource",213],"(",")",["T_OBJECT_OPERATOR","->",213],["T_STRING","saveFile",213],"(",["T_VARIABLE","$file",213],")",";",["T_WHITESPACE","\n            ",213],"}",["T_WHITESPACE"," ",214],["T_CATCH","catch",214],["T_WHITESPACE"," ",214],"(",["T_STRING","Exception",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$e",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n                ",214],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_errors",215],"[","]",["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$e",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getMessage",215],"(",")",";",["T_WHITESPACE","\n                ",215],["T_STRING","Mage",216],["T_DOUBLE_COLON","::",216],["T_STRING","logException",216],"(",["T_VARIABLE","$e",216],")",";",["T_WHITESPACE","\n            ",216],"}",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n\n        ",218],["T_RETURN","return",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],";",["T_WHITESPACE","\n    ",220],"}",["T_WHITESPACE","\n\n    ",221],["T_DOC_COMMENT","\/**\n     * Store file into database\n     *\n     * @param  string $filename\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",223],["T_WHITESPACE","\n    ",228],["T_PUBLIC","public",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","saveFile",229],"(",["T_VARIABLE","$filename",229],")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$fileInfo",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","collectFileInfo",231],"(",["T_VARIABLE","$filename",231],")",";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$filePath",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_VARIABLE","$fileInfo",232],"[",["T_CONSTANT_ENCAPSED_STRING","'directory'",232],"]",";",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$directory",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","Mage",234],["T_DOUBLE_COLON","::",234],["T_STRING","getModel",234],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_directory_database'",234],")",["T_OBJECT_OPERATOR","->",234],["T_STRING","loadByPath",234],"(",["T_VARIABLE","$filePath",234],")",";",["T_WHITESPACE","\n\n        ",234],["T_IF","if",236],["T_WHITESPACE"," ",236],"(","!",["T_VARIABLE","$directory",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getId",236],"(",")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$directory",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getDirectoryModel",237],"(",")",["T_OBJECT_OPERATOR","->",237],["T_STRING","createRecursive",237],"(",["T_VARIABLE","$filePath",237],")",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n\n        ",238],["T_VARIABLE","$fileInfo",240],"[",["T_CONSTANT_ENCAPSED_STRING","'directory_id'",240],"]",["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_VARIABLE","$directory",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getId",240],"(",")",";",["T_WHITESPACE","\n        ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_getResource",241],"(",")",["T_OBJECT_OPERATOR","->",241],["T_STRING","saveFile",241],"(",["T_VARIABLE","$fileInfo",241],")",";",["T_WHITESPACE","\n\n        ",241],["T_RETURN","return",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],";",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n\n    ",244],["T_DOC_COMMENT","\/**\n     * Check whether file exists in DB\n     *\n     * @param  string $filePath\n     * @return bool\n     *\/",246],["T_WHITESPACE","\n    ",251],["T_PUBLIC","public",252],["T_WHITESPACE"," ",252],["T_FUNCTION","function",252],["T_WHITESPACE"," ",252],["T_STRING","fileExists",252],"(",["T_VARIABLE","$filePath",252],")",["T_WHITESPACE","\n    ",252],"{",["T_WHITESPACE","\n        ",253],["T_RETURN","return",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","_getResource",254],"(",")",["T_OBJECT_OPERATOR","->",254],["T_STRING","fileExists",254],"(",["T_STRING","basename",254],"(",["T_VARIABLE","$filePath",254],")",",",["T_WHITESPACE"," ",254],["T_STRING","dirname",254],"(",["T_VARIABLE","$filePath",254],")",")",";",["T_WHITESPACE","\n    ",254],"}",["T_WHITESPACE","\n\n    ",255],["T_DOC_COMMENT","\/**\n     * Copy files\n     *\n     * @param  string $oldFilePath\n     * @param  string $newFilePath\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",257],["T_WHITESPACE","\n    ",263],["T_PUBLIC","public",264],["T_WHITESPACE"," ",264],["T_FUNCTION","function",264],["T_WHITESPACE"," ",264],["T_STRING","copyFile",264],"(",["T_VARIABLE","$oldFilePath",264],",",["T_WHITESPACE"," ",264],["T_VARIABLE","$newFilePath",264],")",["T_WHITESPACE","\n    ",264],"{",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","_getResource",266],"(",")",["T_OBJECT_OPERATOR","->",266],["T_STRING","copyFile",266],"(",["T_WHITESPACE","\n            ",266],["T_STRING","basename",267],"(",["T_VARIABLE","$oldFilePath",267],")",",",["T_WHITESPACE","\n            ",267],["T_STRING","dirname",268],"(",["T_VARIABLE","$oldFilePath",268],")",",",["T_WHITESPACE","\n            ",268],["T_STRING","basename",269],"(",["T_VARIABLE","$newFilePath",269],")",",",["T_WHITESPACE","\n            ",269],["T_STRING","dirname",270],"(",["T_VARIABLE","$newFilePath",270],")",["T_WHITESPACE","\n        ",270],")",";",["T_WHITESPACE","\n\n        ",271],["T_RETURN","return",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],";",["T_WHITESPACE","\n    ",273],"}",["T_WHITESPACE","\n\n    ",274],["T_DOC_COMMENT","\/**\n     * Rename files in database\n     *\n     * @param  string $oldFilePath\n     * @param  string $newFilePath\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",276],["T_WHITESPACE","\n    ",282],["T_PUBLIC","public",283],["T_WHITESPACE"," ",283],["T_FUNCTION","function",283],["T_WHITESPACE"," ",283],["T_STRING","renameFile",283],"(",["T_VARIABLE","$oldFilePath",283],",",["T_WHITESPACE"," ",283],["T_VARIABLE","$newFilePath",283],")",["T_WHITESPACE","\n    ",283],"{",["T_WHITESPACE","\n        ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","_getResource",285],"(",")",["T_OBJECT_OPERATOR","->",285],["T_STRING","renameFile",285],"(",["T_WHITESPACE","\n            ",285],["T_STRING","basename",286],"(",["T_VARIABLE","$oldFilePath",286],")",",",["T_WHITESPACE","\n            ",286],["T_STRING","dirname",287],"(",["T_VARIABLE","$oldFilePath",287],")",",",["T_WHITESPACE","\n            ",287],["T_STRING","basename",288],"(",["T_VARIABLE","$newFilePath",288],")",",",["T_WHITESPACE","\n            ",288],["T_STRING","dirname",289],"(",["T_VARIABLE","$newFilePath",289],")",["T_WHITESPACE","\n        ",289],")",";",["T_WHITESPACE","\n\n        ",290],["T_VARIABLE","$newPath",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_STRING","dirname",292],"(",["T_VARIABLE","$newFilePath",292],")",";",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$directory",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_STRING","Mage",293],["T_DOUBLE_COLON","::",293],["T_STRING","getModel",293],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_directory_database'",293],")",["T_OBJECT_OPERATOR","->",293],["T_STRING","loadByPath",293],"(",["T_VARIABLE","$newPath",293],")",";",["T_WHITESPACE","\n\n        ",293],["T_IF","if",295],["T_WHITESPACE"," ",295],"(","!",["T_VARIABLE","$directory",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","getId",295],"(",")",")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_VARIABLE","$directory",296],["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getDirectoryModel",296],"(",")",["T_OBJECT_OPERATOR","->",296],["T_STRING","createRecursive",296],"(",["T_VARIABLE","$newPath",296],")",";",["T_WHITESPACE","\n        ",296],"}",["T_WHITESPACE","\n\n        ",297],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","loadByFilename",299],"(",["T_VARIABLE","$newFilePath",299],")",";",["T_WHITESPACE","\n        ",299],["T_IF","if",300],["T_WHITESPACE"," ",300],"(",["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getId",300],"(",")",")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","setDirectoryId",301],"(",["T_VARIABLE","$directory",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getId",301],"(",")",")",["T_OBJECT_OPERATOR","->",301],["T_STRING","save",301],"(",")",";",["T_WHITESPACE","\n        ",301],"}",["T_WHITESPACE","\n\n        ",302],["T_RETURN","return",304],["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],";",["T_WHITESPACE","\n    ",304],"}",["T_WHITESPACE","\n\n    ",305],["T_DOC_COMMENT","\/**\n     * Return directory listing\n     *\n     * @param string $directory\n     * @return mixed\n     *\/",307],["T_WHITESPACE","\n    ",312],["T_PUBLIC","public",313],["T_WHITESPACE"," ",313],["T_FUNCTION","function",313],["T_WHITESPACE"," ",313],["T_STRING","getDirectoryFiles",313],"(",["T_VARIABLE","$directory",313],")",["T_WHITESPACE","\n    ",313],"{",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$directory",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_STRING","Mage",315],["T_DOUBLE_COLON","::",315],["T_STRING","helper",315],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",315],")",["T_OBJECT_OPERATOR","->",315],["T_STRING","getMediaRelativePath",315],"(",["T_VARIABLE","$directory",315],")",";",["T_WHITESPACE","\n        ",315],["T_RETURN","return",316],["T_WHITESPACE"," ",316],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","_getResource",316],"(",")",["T_OBJECT_OPERATOR","->",316],["T_STRING","getDirectoryFiles",316],"(",["T_VARIABLE","$directory",316],")",";",["T_WHITESPACE","\n    ",316],"}",["T_WHITESPACE","\n\n    ",317],["T_DOC_COMMENT","\/**\n     * Delete file from database\n     *\n     * @param string $path\n     * @return Mage_Core_Model_File_Storage_Database\n     *\/",319],["T_WHITESPACE","\n    ",324],["T_PUBLIC","public",325],["T_WHITESPACE"," ",325],["T_FUNCTION","function",325],["T_WHITESPACE"," ",325],["T_STRING","deleteFile",325],"(",["T_VARIABLE","$path",325],")",["T_WHITESPACE","\n    ",325],"{",["T_WHITESPACE","\n        ",326],["T_VARIABLE","$filename",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_STRING","basename",327],"(",["T_VARIABLE","$path",327],")",";",["T_WHITESPACE","\n        ",327],["T_VARIABLE","$directory",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_STRING","dirname",328],"(",["T_VARIABLE","$path",328],")",";",["T_WHITESPACE","\n        ",328],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_getResource",329],"(",")",["T_OBJECT_OPERATOR","->",329],["T_STRING","deleteFile",329],"(",["T_VARIABLE","$filename",329],",",["T_WHITESPACE"," ",329],["T_VARIABLE","$directory",329],")",";",["T_WHITESPACE","\n\n        ",329],["T_RETURN","return",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$this",331],";",["T_WHITESPACE","\n    ",331],"}",["T_WHITESPACE","\n",332],"}",["T_WHITESPACE","\n",333]]