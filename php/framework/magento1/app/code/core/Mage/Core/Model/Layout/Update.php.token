[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Core\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_CLASS","class",28],["T_WHITESPACE"," ",28],["T_STRING","Mage_Core_Model_Layout_Update",28],["T_WHITESPACE","\n",28],"{",["T_WHITESPACE","\n    ",29],["T_DOC_COMMENT","\/**\n     * Additional tag for cleaning layout cache convenience\n     *\/",30],["T_WHITESPACE","\n    ",32],["T_CONST","const",33],["T_WHITESPACE"," ",33],["T_STRING","LAYOUT_GENERAL_CACHE_TAG",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'LAYOUT_GENERAL_CACHE_TAG'",33],";",["T_WHITESPACE","\n\n    ",33],["T_DOC_COMMENT","\/**\n     * Layout Update Simplexml Element Class Name\n     *\n     * @var string\n     *\/",35],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_elementClass",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * @var Simplexml_Element\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_packageLayout",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Cache key\n     *\n     * @var string\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_cacheId",52],";",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Cache prefix\n     *\n     * @var string\n     *\/",54],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$_cachePrefix",59],";",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * Cumulative array of update XML strings\n     *\n     * @var array\n     *\/",61],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$_updates",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_ARRAY","array",66],"(",")",";",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Handles used in this update\n     *\n     * @var array\n     *\/",68],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$_handles",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",")",";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * Substitution values in structure array('from'=>array(), 'to'=>array())\n     *\n     * @var array\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PROTECTED","protected",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$_subst",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_ARRAY","array",80],"(",")",";",["T_WHITESPACE","\n\n    ",80],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","__construct",82],"(",")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$subst",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","getConfig",84],"(",")",["T_OBJECT_OPERATOR","->",84],["T_STRING","getPathVars",84],"(",")",";",["T_WHITESPACE","\n        ",84],["T_FOREACH","foreach",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$subst",85],["T_WHITESPACE"," ",85],["T_AS","as",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$k",85],["T_DOUBLE_ARROW","=>",85],["T_VARIABLE","$v",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_subst",86],"[",["T_CONSTANT_ENCAPSED_STRING","'from'",86],"]","[","]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'{{'",86],".",["T_VARIABLE","$k",86],".",["T_CONSTANT_ENCAPSED_STRING","'}}'",86],";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_subst",87],"[",["T_CONSTANT_ENCAPSED_STRING","'to'",87],"]","[","]",["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$v",87],";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_PUBLIC","public",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","getElementClass",91],"(",")",["T_WHITESPACE","\n    ",91],"{",["T_WHITESPACE","\n        ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(","!",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_elementClass",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_elementClass",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_STRING","Mage",94],["T_DOUBLE_COLON","::",94],["T_STRING","getConfig",94],"(",")",["T_OBJECT_OPERATOR","->",94],["T_STRING","getModelClassName",94],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/layout_element'",94],")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n        ",95],["T_RETURN","return",96],["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","_elementClass",96],";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n\n    ",97],["T_PUBLIC","public",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","resetUpdates",99],"(",")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_updates",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_ARRAY","array",101],"(",")",";",["T_WHITESPACE","\n        ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","addUpdate",105],"(",["T_VARIABLE","$update",105],")",["T_WHITESPACE","\n    ",105],"{",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_updates",107],"[","]",["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$update",107],";",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","asArray",111],"(",")",["T_WHITESPACE","\n    ",111],"{",["T_WHITESPACE","\n        ",112],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_updates",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","asString",116],"(",")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_STRING","implode",118],"(",["T_CONSTANT_ENCAPSED_STRING","''",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_updates",118],")",";",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","resetHandles",121],"(",")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_handles",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_ARRAY","array",123],"(",")",";",["T_WHITESPACE","\n        ",123],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_PUBLIC","public",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","addHandle",127],"(",["T_VARIABLE","$handle",127],")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_STRING","is_array",129],"(",["T_VARIABLE","$handle",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_FOREACH","foreach",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$handle",130],["T_WHITESPACE"," ",130],["T_AS","as",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$h",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_handles",131],"[",["T_VARIABLE","$h",131],"]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_LNUMBER","1",131],";",["T_WHITESPACE","\n            ",131],"}",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE"," ",133],["T_ELSE","else",133],["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_handles",134],"[",["T_VARIABLE","$handle",134],"]",["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_LNUMBER","1",134],";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n        ",135],["T_RETURN","return",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],";",["T_WHITESPACE","\n    ",136],"}",["T_WHITESPACE","\n\n    ",137],["T_PUBLIC","public",139],["T_WHITESPACE"," ",139],["T_FUNCTION","function",139],["T_WHITESPACE"," ",139],["T_STRING","removeHandle",139],"(",["T_VARIABLE","$handle",139],")",["T_WHITESPACE","\n    ",139],"{",["T_WHITESPACE","\n        ",140],["T_UNSET","unset",141],"(",["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_handles",141],"[",["T_VARIABLE","$handle",141],"]",")",";",["T_WHITESPACE","\n        ",141],["T_RETURN","return",142],["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],";",["T_WHITESPACE","\n    ",142],"}",["T_WHITESPACE","\n\n    ",143],["T_PUBLIC","public",145],["T_WHITESPACE"," ",145],["T_FUNCTION","function",145],["T_WHITESPACE"," ",145],["T_STRING","getHandles",145],"(",")",["T_WHITESPACE","\n    ",145],"{",["T_WHITESPACE","\n        ",146],["T_RETURN","return",147],["T_WHITESPACE"," ",147],["T_STRING","array_keys",147],"(",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_handles",147],")",";",["T_WHITESPACE","\n    ",147],"}",["T_WHITESPACE","\n\n    ",148],["T_DOC_COMMENT","\/**\n     * Get cache id\n     *\n     * @return string\n     *\/",150],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","getCacheId",155],"(",")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(","!",["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_cacheId",157],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_cacheId",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","'LAYOUT_'",158],".",["T_STRING","Mage",158],["T_DOUBLE_COLON","::",158],["T_STRING","app",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getStore",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getId",158],"(",")",".",["T_STRING","md5",158],"(",["T_STRING","join",158],"(",["T_CONSTANT_ENCAPSED_STRING","'__'",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getHandles",158],"(",")",")",")",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n        ",159],["T_RETURN","return",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_cacheId",160],";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Set cache id\n     *\n     * @param string $cacheId\n     * @return Mage_Core_Model_Layout_Update\n     *\/",163],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","setCacheId",169],"(",["T_VARIABLE","$cacheId",169],")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","_cacheId",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$cacheId",171],";",["T_WHITESPACE","\n        ",171],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],";",["T_WHITESPACE","\n    ",172],"}",["T_WHITESPACE","\n\n    ",173],["T_PUBLIC","public",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","loadCache",175],"(",")",["T_WHITESPACE","\n    ",175],"{",["T_WHITESPACE","\n        ",176],["T_IF","if",177],["T_WHITESPACE"," ",177],"(","!",["T_STRING","Mage",177],["T_DOUBLE_COLON","::",177],["T_STRING","app",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","useCache",177],"(",["T_CONSTANT_ENCAPSED_STRING","'layout'",177],")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_STRING","false",178],";",["T_WHITESPACE","\n        ",178],"}",["T_WHITESPACE","\n\n        ",179],["T_IF","if",181],["T_WHITESPACE"," ",181],"(","!",["T_VARIABLE","$result",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_STRING","Mage",181],["T_DOUBLE_COLON","::",181],["T_STRING","app",181],"(",")",["T_OBJECT_OPERATOR","->",181],["T_STRING","loadCache",181],"(",["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","getCacheId",181],"(",")",")",")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n            ",181],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_STRING","false",182],";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n\n        ",183],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","addUpdate",185],"(",["T_VARIABLE","$result",185],")",";",["T_WHITESPACE","\n\n        ",185],["T_RETURN","return",187],["T_WHITESPACE"," ",187],["T_STRING","true",187],";",["T_WHITESPACE","\n    ",187],"}",["T_WHITESPACE","\n\n    ",188],["T_PUBLIC","public",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","saveCache",190],"(",")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_IF","if",192],["T_WHITESPACE"," ",192],"(","!",["T_STRING","Mage",192],["T_DOUBLE_COLON","::",192],["T_STRING","app",192],"(",")",["T_OBJECT_OPERATOR","->",192],["T_STRING","useCache",192],"(",["T_CONSTANT_ENCAPSED_STRING","'layout'",192],")",")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_STRING","false",193],";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$str",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","asString",195],"(",")",";",["T_WHITESPACE","\n        ",195],["T_VARIABLE","$tags",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","getHandles",196],"(",")",";",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$tags",197],"[","]",["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","self",197],["T_DOUBLE_COLON","::",197],["T_STRING","LAYOUT_GENERAL_CACHE_TAG",197],";",["T_WHITESPACE","\n        ",197],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_STRING","Mage",198],["T_DOUBLE_COLON","::",198],["T_STRING","app",198],"(",")",["T_OBJECT_OPERATOR","->",198],["T_STRING","saveCache",198],"(",["T_VARIABLE","$str",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getCacheId",198],"(",")",",",["T_WHITESPACE"," ",198],["T_VARIABLE","$tags",198],",",["T_WHITESPACE"," ",198],["T_STRING","null",198],")",";",["T_WHITESPACE","\n    ",198],"}",["T_WHITESPACE","\n\n    ",199],["T_DOC_COMMENT","\/**\n     * Load layout updates by handles\n     *\n     * @param array|string $handles\n     * @return Mage_Core_Model_Layout_Update\n     *\/",201],["T_WHITESPACE","\n    ",206],["T_PUBLIC","public",207],["T_WHITESPACE"," ",207],["T_FUNCTION","function",207],["T_WHITESPACE"," ",207],["T_STRING","load",207],"(",["T_VARIABLE","$handles",207],"=",["T_ARRAY","array",207],"(",")",")",["T_WHITESPACE","\n    ",207],"{",["T_WHITESPACE","\n        ",208],["T_IF","if",209],["T_WHITESPACE"," ",209],"(",["T_STRING","is_string",209],"(",["T_VARIABLE","$handles",209],")",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n            ",209],["T_VARIABLE","$handles",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],"(",["T_VARIABLE","$handles",210],")",";",["T_WHITESPACE","\n        ",210],"}",["T_WHITESPACE"," ",211],["T_ELSEIF","elseif",211],["T_WHITESPACE"," ",211],"(","!",["T_STRING","is_array",211],"(",["T_VARIABLE","$handles",211],")",")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n            ",211],["T_THROW","throw",212],["T_WHITESPACE"," ",212],["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","exception",212],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Core'",212],",",["T_WHITESPACE"," ",212],["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","helper",212],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",212],")",["T_OBJECT_OPERATOR","->",212],["T_STRING","__",212],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid layout update handle'",212],")",")",";",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE","\n\n        ",213],["T_FOREACH","foreach",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$handles",215],["T_WHITESPACE"," ",215],["T_AS","as",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$handle",215],")",["T_WHITESPACE"," ",215],"{",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$this",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","addHandle",216],"(",["T_VARIABLE","$handle",216],")",";",["T_WHITESPACE","\n        ",216],"}",["T_WHITESPACE","\n\n        ",217],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","loadCache",219],"(",")",")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_RETURN","return",220],["T_WHITESPACE"," ",220],["T_VARIABLE","$this",220],";",["T_WHITESPACE","\n        ",220],"}",["T_WHITESPACE","\n\n        ",221],["T_FOREACH","foreach",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getHandles",223],"(",")",["T_WHITESPACE"," ",223],["T_AS","as",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$handle",223],")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","merge",224],"(",["T_VARIABLE","$handle",224],")",";",["T_WHITESPACE","\n        ",224],"}",["T_WHITESPACE","\n\n        ",225],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","saveCache",227],"(",")",";",["T_WHITESPACE","\n        ",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_PUBLIC","public",231],["T_WHITESPACE"," ",231],["T_FUNCTION","function",231],["T_WHITESPACE"," ",231],["T_STRING","asSimplexml",231],"(",")",["T_WHITESPACE","\n    ",231],"{",["T_WHITESPACE","\n        ",232],["T_VARIABLE","$updates",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_STRING","trim",233],"(",["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","asString",233],"(",")",")",";",["T_WHITESPACE","\n        ",233],["T_VARIABLE","$updates",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_CONSTANT_ENCAPSED_STRING","'<'",234],".",["T_CONSTANT_ENCAPSED_STRING","'?xml version=\"1.0\"?'",234],".",["T_CONSTANT_ENCAPSED_STRING","'><layout>'",234],".",["T_VARIABLE","$updates",234],".",["T_CONSTANT_ENCAPSED_STRING","'<\/layout>'",234],";",["T_WHITESPACE","\n        ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_STRING","simplexml_load_string",235],"(",["T_VARIABLE","$updates",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getElementClass",235],"(",")",")",";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_DOC_COMMENT","\/**\n     * Merge layout update by handle\n     *\n     * @param string $handle\n     * @return Mage_Core_Model_Layout_Update\n     *\/",238],["T_WHITESPACE","\n    ",243],["T_PUBLIC","public",244],["T_WHITESPACE"," ",244],["T_FUNCTION","function",244],["T_WHITESPACE"," ",244],["T_STRING","merge",244],"(",["T_VARIABLE","$handle",244],")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$packageUpdatesStatus",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","fetchPackageLayoutUpdates",246],"(",["T_VARIABLE","$handle",246],")",";",["T_WHITESPACE","\n        ",246],["T_IF","if",247],["T_WHITESPACE"," ",247],"(",["T_STRING","Mage",247],["T_DOUBLE_COLON","::",247],["T_STRING","app",247],"(",")",["T_OBJECT_OPERATOR","->",247],["T_STRING","isInstalled",247],"(",")",")",["T_WHITESPACE"," ",247],"{",["T_WHITESPACE","\n            ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","fetchDbLayoutUpdates",248],"(",["T_VARIABLE","$handle",248],")",";",["T_WHITESPACE","\n        ",248],"}",["T_WHITESPACE","\n",249],["T_COMMENT","\/\/        if (!$this->fetchPackageLayoutUpdates($handle)\n",250],["T_COMMENT","\/\/            && !$this->fetchDbLayoutUpdates($handle)) {\n",251],["T_COMMENT","\/\/            #$this->removeHandle($handle);\n",252],["T_COMMENT","\/\/        }\n",253],["T_WHITESPACE","        ",254],["T_RETURN","return",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],";",["T_WHITESPACE","\n    ",254],"}",["T_WHITESPACE","\n\n    ",255],["T_PUBLIC","public",257],["T_WHITESPACE"," ",257],["T_FUNCTION","function",257],["T_WHITESPACE"," ",257],["T_STRING","fetchFileLayoutUpdates",257],"(",")",["T_WHITESPACE","\n    ",257],"{",["T_WHITESPACE","\n        ",258],["T_VARIABLE","$storeId",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_STRING","Mage",259],["T_DOUBLE_COLON","::",259],["T_STRING","app",259],"(",")",["T_OBJECT_OPERATOR","->",259],["T_STRING","getStore",259],"(",")",["T_OBJECT_OPERATOR","->",259],["T_STRING","getId",259],"(",")",";",["T_WHITESPACE","\n        ",259],["T_VARIABLE","$elementClass",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","getElementClass",260],"(",")",";",["T_WHITESPACE","\n        ",260],["T_VARIABLE","$design",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_STRING","Mage",261],["T_DOUBLE_COLON","::",261],["T_STRING","getSingleton",261],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/design_package'",261],")",";",["T_WHITESPACE","\n        ",261],["T_VARIABLE","$cacheKey",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_CONSTANT_ENCAPSED_STRING","'LAYOUT_'",262],["T_WHITESPACE"," ",262],".",["T_WHITESPACE"," ",262],["T_VARIABLE","$design",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getArea",262],"(",")",["T_WHITESPACE"," ",262],".",["T_WHITESPACE"," ",262],["T_CONSTANT_ENCAPSED_STRING","'_STORE'",262],["T_WHITESPACE"," ",262],".",["T_WHITESPACE"," ",262],["T_VARIABLE","$storeId",262],["T_WHITESPACE"," ",262],".",["T_WHITESPACE"," ",262],["T_CONSTANT_ENCAPSED_STRING","'_'",262],["T_WHITESPACE"," ",262],".",["T_WHITESPACE"," ",262],["T_VARIABLE","$design",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getPackageName",262],"(",")",["T_WHITESPACE"," ",262],".",["T_WHITESPACE"," ",262],["T_CONSTANT_ENCAPSED_STRING","'_'",262],["T_WHITESPACE","\n            ",262],".",["T_WHITESPACE"," ",263],["T_VARIABLE","$design",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getTheme",263],"(",["T_CONSTANT_ENCAPSED_STRING","'layout'",263],")",";",["T_WHITESPACE","\n\n        ",263],["T_VARIABLE","$cacheTags",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",["T_STRING","self",265],["T_DOUBLE_COLON","::",265],["T_STRING","LAYOUT_GENERAL_CACHE_TAG",265],")",";",["T_WHITESPACE","\n        ",265],["T_IF","if",266],["T_WHITESPACE"," ",266],"(",["T_STRING","Mage",266],["T_DOUBLE_COLON","::",266],["T_STRING","app",266],"(",")",["T_OBJECT_OPERATOR","->",266],["T_STRING","useCache",266],"(",["T_CONSTANT_ENCAPSED_STRING","'layout'",266],")",["T_WHITESPACE"," ",266],["T_BOOLEAN_AND","&&",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$layoutStr",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_STRING","Mage",266],["T_DOUBLE_COLON","::",266],["T_STRING","app",266],"(",")",["T_OBJECT_OPERATOR","->",266],["T_STRING","loadCache",266],"(",["T_VARIABLE","$cacheKey",266],")",")",")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","_packageLayout",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_STRING","simplexml_load_string",267],"(",["T_VARIABLE","$layoutStr",267],",",["T_WHITESPACE"," ",267],["T_VARIABLE","$elementClass",267],")",";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE","\n        ",268],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_EMPTY","empty",269],"(",["T_VARIABLE","$layoutStr",269],")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","_packageLayout",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getFileLayoutUpdatesXml",270],"(",["T_WHITESPACE","\n                ",270],["T_VARIABLE","$design",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getArea",271],"(",")",",",["T_WHITESPACE","\n                ",271],["T_VARIABLE","$design",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getPackageName",272],"(",")",",",["T_WHITESPACE","\n                ",272],["T_VARIABLE","$design",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getTheme",273],"(",["T_CONSTANT_ENCAPSED_STRING","'layout'",273],")",",",["T_WHITESPACE","\n                ",273],["T_VARIABLE","$storeId",274],["T_WHITESPACE","\n            ",274],")",";",["T_WHITESPACE","\n            ",275],["T_IF","if",276],["T_WHITESPACE"," ",276],"(",["T_STRING","Mage",276],["T_DOUBLE_COLON","::",276],["T_STRING","app",276],"(",")",["T_OBJECT_OPERATOR","->",276],["T_STRING","useCache",276],"(",["T_CONSTANT_ENCAPSED_STRING","'layout'",276],")",")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n                ",276],["T_STRING","Mage",277],["T_DOUBLE_COLON","::",277],["T_STRING","app",277],"(",")",["T_OBJECT_OPERATOR","->",277],["T_STRING","saveCache",277],"(",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_packageLayout",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","asXml",277],"(",")",",",["T_WHITESPACE"," ",277],["T_VARIABLE","$cacheKey",277],",",["T_WHITESPACE"," ",277],["T_VARIABLE","$cacheTags",277],",",["T_WHITESPACE"," ",277],["T_STRING","null",277],")",";",["T_WHITESPACE","\n            ",277],"}",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n\n\n\n",279],["T_COMMENT","\/\/        $elementClass = $this->getElementClass();\n",283],["T_COMMENT","\/\/\n",284],["T_COMMENT","\/\/        $design = Mage::getSingleton('core\/design_package');\n",285],["T_COMMENT","\/\/        $area = $design->getArea();\n",286],["T_COMMENT","\/\/        $storeId = Mage::app()->getStore()->getId();\n",287],["T_COMMENT","\/\/        $cacheKey = 'LAYOUT_'.$area.'_STORE'.$storeId.'_'.$design->getPackageName().'_'.$design->getTheme('layout');\n",288],["T_COMMENT","\/\/#echo \"TEST:\".$cacheKey;\n",289],["T_COMMENT","\/\/        $cacheTags = array('layout');\n",290],["T_COMMENT","\/\/\n",291],["T_COMMENT","\/\/        if (Mage::app()->useCache('layout') && ($layoutStr = Mage::app()->loadCache($cacheKey))) {\n",292],["T_COMMENT","\/\/            $this->_packageLayout = simplexml_load_string($layoutStr, $elementClass);\n",293],["T_COMMENT","\/\/        }\n",294],["T_COMMENT","\/\/\n",295],["T_COMMENT","\/\/        if (empty($layoutStr)) {\n",296],["T_COMMENT","\/\/            $updatesRoot = Mage::app()->getConfig()->getNode($area.'\/layout\/updates');\n",297],["T_COMMENT","\/\/            Mage::dispatchEvent('core_layout_update_updates_get_after', array('updates' => $updatesRoot));\n",298],["T_COMMENT","\/\/            $updateFiles = array();\n",299],["T_COMMENT","\/\/            foreach ($updatesRoot->children() as $updateNode) {\n",300],["T_COMMENT","\/\/                if ($updateNode->file) {\n",301],["T_COMMENT","\/\/                    $module = $updateNode->getAttribute('module');\n",302],["T_COMMENT","\/\/                    if ($module && Mage::getStoreConfigFlag('advanced\/modules_disable_output\/' . $module)) {\n",303],["T_COMMENT","\/\/                        continue;\n",304],["T_COMMENT","\/\/                    }\n",305],["T_COMMENT","\/\/                    $updateFiles[] = (string)$updateNode->file;\n",306],["T_COMMENT","\/\/                }\n",307],["T_COMMENT","\/\/            }\n",308],["T_COMMENT","\/\/\n",309],["T_COMMENT","\/\/            \/\/ custom local layout updates file - load always last\n",310],["T_COMMENT","\/\/            $updateFiles[] = 'local.xml';\n",311],["T_COMMENT","\/\/\n",312],["T_COMMENT","\/\/            $layoutStr = '';\n",313],["T_COMMENT","\/\/            #$layoutXml = new $elementClass('<layouts\/>');\n",314],["T_COMMENT","\/\/            foreach ($updateFiles as $file) {\n",315],["T_COMMENT","\/\/                $filename = $design->getLayoutFilename($file);\n",316],["T_COMMENT","\/\/                if (!is_readable($filename)) {\n",317],["T_COMMENT","\/\/                    continue;\n",318],["T_COMMENT","\/\/                }\n",319],["T_COMMENT","\/\/                $fileStr = file_get_contents($filename);\n",320],["T_COMMENT","\/\/                $fileStr = str_replace($this->_subst['from'], $this->_subst['to'], $fileStr);\n",321],["T_COMMENT","\/\/                $fileXml = simplexml_load_string($fileStr, $elementClass);\n",322],["T_COMMENT","\/\/                if (!$fileXml instanceof SimpleXMLElement) {\n",323],["T_COMMENT","\/\/                    continue;\n",324],["T_COMMENT","\/\/                }\n",325],["T_COMMENT","\/\/                $layoutStr .= $fileXml->innerXml();\n",326],["T_COMMENT","\/\/\n",327],["T_COMMENT","\/\/                #$layoutXml->appendChild($fileXml);\n",328],["T_COMMENT","\/\/            }\n",329],["T_COMMENT","\/\/            $layoutXml = simplexml_load_string('<layouts>'.$layoutStr.'<\/layouts>', $elementClass);\n",330],["T_COMMENT","\/\/\n",331],["T_COMMENT","\/\/            $this->_packageLayout = $layoutXml;\n",332],["T_COMMENT","\/\/\n",333],["T_COMMENT","\/\/            if (Mage::app()->useCache('layout')) {\n",334],["T_COMMENT","\/\/                Mage::app()->saveCache($this->_packageLayout->asXml(), $cacheKey, $cacheTags, null);\n",335],["T_COMMENT","\/\/            }\n",336],["T_COMMENT","\/\/        }\n",337],["T_WHITESPACE","\n        ",338],["T_RETURN","return",339],["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],";",["T_WHITESPACE","\n    ",339],"}",["T_WHITESPACE","\n\n    ",340],["T_PUBLIC","public",342],["T_WHITESPACE"," ",342],["T_FUNCTION","function",342],["T_WHITESPACE"," ",342],["T_STRING","fetchPackageLayoutUpdates",342],"(",["T_VARIABLE","$handle",342],")",["T_WHITESPACE","\n    ",342],"{",["T_WHITESPACE","\n        ",343],["T_VARIABLE","$_profilerKey",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","'layout\/package_update: '",344],".",["T_VARIABLE","$handle",344],";",["T_WHITESPACE","\n        ",344],["T_STRING","Varien_Profiler",345],["T_DOUBLE_COLON","::",345],["T_STRING","start",345],"(",["T_VARIABLE","$_profilerKey",345],")",";",["T_WHITESPACE","\n        ",345],["T_IF","if",346],["T_WHITESPACE"," ",346],"(",["T_EMPTY","empty",346],"(",["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","_packageLayout",346],")",")",["T_WHITESPACE"," ",346],"{",["T_WHITESPACE","\n            ",346],["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","fetchFileLayoutUpdates",347],"(",")",";",["T_WHITESPACE","\n        ",347],"}",["T_WHITESPACE","\n        ",348],["T_FOREACH","foreach",349],["T_WHITESPACE"," ",349],"(",["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_packageLayout",349],["T_OBJECT_OPERATOR","->",349],["T_VARIABLE","$handle",349],["T_WHITESPACE"," ",349],["T_AS","as",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$updateXml",349],")",["T_WHITESPACE"," ",349],"{",["T_WHITESPACE","\n",349],["T_COMMENT","#echo '<textarea style=\"width:600px; height:400px;\">'.$handle.':'.print_r($updateXml,1).'<\/textarea>';\n",350],["T_WHITESPACE","            ",351],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","fetchRecursiveUpdates",351],"(",["T_VARIABLE","$updateXml",351],")",";",["T_WHITESPACE","\n            ",351],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","addUpdate",352],"(",["T_VARIABLE","$updateXml",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","innerXml",352],"(",")",")",";",["T_WHITESPACE","\n        ",352],"}",["T_WHITESPACE","\n        ",353],["T_STRING","Varien_Profiler",354],["T_DOUBLE_COLON","::",354],["T_STRING","stop",354],"(",["T_VARIABLE","$_profilerKey",354],")",";",["T_WHITESPACE","\n\n        ",354],["T_RETURN","return",356],["T_WHITESPACE"," ",356],["T_STRING","true",356],";",["T_WHITESPACE","\n    ",356],"}",["T_WHITESPACE","\n\n    ",357],["T_PUBLIC","public",359],["T_WHITESPACE"," ",359],["T_FUNCTION","function",359],["T_WHITESPACE"," ",359],["T_STRING","fetchDbLayoutUpdates",359],"(",["T_VARIABLE","$handle",359],")",["T_WHITESPACE","\n    ",359],"{",["T_WHITESPACE","\n        ",360],["T_VARIABLE","$_profilerKey",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","'layout\/db_update: '",361],".",["T_VARIABLE","$handle",361],";",["T_WHITESPACE","\n        ",361],["T_STRING","Varien_Profiler",362],["T_DOUBLE_COLON","::",362],["T_STRING","start",362],"(",["T_VARIABLE","$_profilerKey",362],")",";",["T_WHITESPACE","\n        ",362],["T_VARIABLE","$updateStr",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","_getUpdateString",363],"(",["T_VARIABLE","$handle",363],")",";",["T_WHITESPACE","\n        ",363],["T_IF","if",364],["T_WHITESPACE"," ",364],"(","!",["T_VARIABLE","$updateStr",364],")",["T_WHITESPACE"," ",364],"{",["T_WHITESPACE","\n            ",364],["T_RETURN","return",365],["T_WHITESPACE"," ",365],["T_STRING","false",365],";",["T_WHITESPACE","\n        ",365],"}",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$updateStr",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_CONSTANT_ENCAPSED_STRING","'<update_xml>'",367],["T_WHITESPACE"," ",367],".",["T_WHITESPACE"," ",367],["T_VARIABLE","$updateStr",367],["T_WHITESPACE"," ",367],".",["T_WHITESPACE"," ",367],["T_CONSTANT_ENCAPSED_STRING","'<\/update_xml>'",367],";",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$updateStr",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_STRING","str_replace",368],"(",["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_subst",368],"[",["T_CONSTANT_ENCAPSED_STRING","'from'",368],"]",",",["T_WHITESPACE"," ",368],["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","_subst",368],"[",["T_CONSTANT_ENCAPSED_STRING","'to'",368],"]",",",["T_WHITESPACE"," ",368],["T_VARIABLE","$updateStr",368],")",";",["T_WHITESPACE","\n        ",368],["T_VARIABLE","$updateXml",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_STRING","simplexml_load_string",369],"(",["T_VARIABLE","$updateStr",369],",",["T_WHITESPACE"," ",369],["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","getElementClass",369],"(",")",")",";",["T_WHITESPACE","\n        ",369],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","fetchRecursiveUpdates",370],"(",["T_VARIABLE","$updateXml",370],")",";",["T_WHITESPACE","\n        ",370],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","addUpdate",371],"(",["T_VARIABLE","$updateXml",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","innerXml",371],"(",")",")",";",["T_WHITESPACE","\n\n        ",371],["T_STRING","Varien_Profiler",373],["T_DOUBLE_COLON","::",373],["T_STRING","stop",373],"(",["T_VARIABLE","$_profilerKey",373],")",";",["T_WHITESPACE","\n        ",373],["T_RETURN","return",374],["T_WHITESPACE"," ",374],["T_STRING","true",374],";",["T_WHITESPACE","\n    ",374],"}",["T_WHITESPACE","\n\n    ",375],["T_DOC_COMMENT","\/**\n     * Get update string\n     *\n     * @param string $handle\n     * @return mixed\n     *\/",377],["T_WHITESPACE","\n    ",382],["T_PROTECTED","protected",383],["T_WHITESPACE"," ",383],["T_FUNCTION","function",383],["T_WHITESPACE"," ",383],["T_STRING","_getUpdateString",383],"(",["T_VARIABLE","$handle",383],")",["T_WHITESPACE","\n    ",383],"{",["T_WHITESPACE","\n        ",384],["T_RETURN","return",385],["T_WHITESPACE"," ",385],["T_STRING","Mage",385],["T_DOUBLE_COLON","::",385],["T_STRING","getResourceModel",385],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/layout'",385],")",["T_OBJECT_OPERATOR","->",385],["T_STRING","fetchUpdatesByHandle",385],"(",["T_VARIABLE","$handle",385],")",";",["T_WHITESPACE","\n    ",385],"}",["T_WHITESPACE","\n\n    ",386],["T_PUBLIC","public",388],["T_WHITESPACE"," ",388],["T_FUNCTION","function",388],["T_WHITESPACE"," ",388],["T_STRING","fetchRecursiveUpdates",388],"(",["T_VARIABLE","$updateXml",388],")",["T_WHITESPACE","\n    ",388],"{",["T_WHITESPACE","\n        ",389],["T_FOREACH","foreach",390],["T_WHITESPACE"," ",390],"(",["T_VARIABLE","$updateXml",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","children",390],"(",")",["T_WHITESPACE"," ",390],["T_AS","as",390],["T_WHITESPACE"," ",390],["T_VARIABLE","$child",390],")",["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n            ",390],["T_IF","if",391],["T_WHITESPACE"," ",391],"(",["T_STRING","strtolower",391],"(",["T_VARIABLE","$child",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getName",391],"(",")",")",["T_IS_EQUAL","==",391],["T_CONSTANT_ENCAPSED_STRING","'update'",391],["T_WHITESPACE"," ",391],["T_BOOLEAN_AND","&&",391],["T_WHITESPACE"," ",391],["T_ISSET","isset",391],"(",["T_VARIABLE","$child",391],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",391],"]",")",")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n                ",391],["T_VARIABLE","$this",392],["T_OBJECT_OPERATOR","->",392],["T_STRING","merge",392],"(",["T_STRING_CAST","(string)",392],["T_VARIABLE","$child",392],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",392],"]",")",";",["T_WHITESPACE","\n                ",392],["T_COMMENT","\/\/ Adding merged layout handle to the list of applied hanles\n",393],["T_WHITESPACE","                ",394],["T_VARIABLE","$this",394],["T_OBJECT_OPERATOR","->",394],["T_STRING","addHandle",394],"(",["T_STRING_CAST","(string)",394],["T_VARIABLE","$child",394],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",394],"]",")",";",["T_WHITESPACE","\n            ",394],"}",["T_WHITESPACE","\n        ",395],"}",["T_WHITESPACE","\n        ",396],["T_RETURN","return",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],";",["T_WHITESPACE","\n    ",397],"}",["T_WHITESPACE","\n\n    ",398],["T_DOC_COMMENT","\/**\n     * Collect and merge layout updates from file\n     *\n     * @param string $area\n     * @param string $package\n     * @param string $theme\n     * @param integer|null $storeId\n     * @return Mage_Core_Model_Layout_Element\n     *\/",400],["T_WHITESPACE","\n    ",408],["T_PUBLIC","public",409],["T_WHITESPACE"," ",409],["T_FUNCTION","function",409],["T_WHITESPACE"," ",409],["T_STRING","getFileLayoutUpdatesXml",409],"(",["T_VARIABLE","$area",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$package",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$theme",409],",",["T_WHITESPACE"," ",409],["T_VARIABLE","$storeId",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_STRING","null",409],")",["T_WHITESPACE","\n    ",409],"{",["T_WHITESPACE","\n        ",410],["T_IF","if",411],["T_WHITESPACE"," ",411],"(",["T_STRING","null",411],["T_WHITESPACE"," ",411],["T_IS_IDENTICAL","===",411],["T_WHITESPACE"," ",411],["T_VARIABLE","$storeId",411],")",["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n            ",411],["T_VARIABLE","$storeId",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_STRING","Mage",412],["T_DOUBLE_COLON","::",412],["T_STRING","app",412],"(",")",["T_OBJECT_OPERATOR","->",412],["T_STRING","getStore",412],"(",")",["T_OBJECT_OPERATOR","->",412],["T_STRING","getId",412],"(",")",";",["T_WHITESPACE","\n        ",412],"}",["T_WHITESPACE","\n        ",413],["T_COMMENT","\/* @var $design Mage_Core_Model_Design_Package *\/",414],["T_WHITESPACE","\n        ",414],["T_VARIABLE","$design",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_STRING","Mage",415],["T_DOUBLE_COLON","::",415],["T_STRING","getSingleton",415],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/design_package'",415],")",";",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$layoutXml",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_STRING","null",416],";",["T_WHITESPACE","\n        ",416],["T_VARIABLE","$elementClass",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getElementClass",417],"(",")",";",["T_WHITESPACE","\n        ",417],["T_VARIABLE","$updatesRoot",418],["T_WHITESPACE"," ",418],"=",["T_WHITESPACE"," ",418],["T_STRING","Mage",418],["T_DOUBLE_COLON","::",418],["T_STRING","app",418],"(",")",["T_OBJECT_OPERATOR","->",418],["T_STRING","getConfig",418],"(",")",["T_OBJECT_OPERATOR","->",418],["T_STRING","getNode",418],"(",["T_VARIABLE","$area",418],".",["T_CONSTANT_ENCAPSED_STRING","'\/layout\/updates'",418],")",";",["T_WHITESPACE","\n        ",418],["T_STRING","Mage",419],["T_DOUBLE_COLON","::",419],["T_STRING","dispatchEvent",419],"(",["T_CONSTANT_ENCAPSED_STRING","'core_layout_update_updates_get_after'",419],",",["T_WHITESPACE"," ",419],["T_ARRAY","array",419],"(",["T_CONSTANT_ENCAPSED_STRING","'updates'",419],["T_WHITESPACE"," ",419],["T_DOUBLE_ARROW","=>",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$updatesRoot",419],")",")",";",["T_WHITESPACE","\n        ",419],["T_VARIABLE","$updates",420],["T_WHITESPACE"," ",420],"=",["T_WHITESPACE"," ",420],["T_VARIABLE","$updatesRoot",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","asArray",420],"(",")",";",["T_WHITESPACE","\n        ",420],["T_VARIABLE","$themeUpdates",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_STRING","Mage",421],["T_DOUBLE_COLON","::",421],["T_STRING","getSingleton",421],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/design_config'",421],")",["T_OBJECT_OPERATOR","->",421],["T_STRING","getNode",421],"(","\"",["T_VARIABLE","$area",421],["T_ENCAPSED_AND_WHITESPACE","\/",421],["T_VARIABLE","$package",421],["T_ENCAPSED_AND_WHITESPACE","\/",421],["T_VARIABLE","$theme",421],["T_ENCAPSED_AND_WHITESPACE","\/layout\/updates",421],"\"",")",";",["T_WHITESPACE","\n        ",421],["T_IF","if",422],["T_WHITESPACE"," ",422],"(",["T_VARIABLE","$themeUpdates",422],["T_WHITESPACE"," ",422],["T_BOOLEAN_AND","&&",422],["T_WHITESPACE"," ",422],["T_STRING","is_array",422],"(",["T_VARIABLE","$themeUpdates",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","asArray",422],"(",")",")",")",["T_WHITESPACE"," ",422],"{",["T_WHITESPACE","\n            ",422],["T_COMMENT","\/\/array_values() to ensure that theme-specific layouts don't override, but add to module layouts\n",423],["T_WHITESPACE","            ",424],["T_VARIABLE","$updates",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_STRING","array_merge",424],"(",["T_VARIABLE","$updates",424],",",["T_WHITESPACE"," ",424],["T_STRING","array_values",424],"(",["T_VARIABLE","$themeUpdates",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","asArray",424],"(",")",")",")",";",["T_WHITESPACE","\n        ",424],"}",["T_WHITESPACE","\n        ",425],["T_VARIABLE","$updateFiles",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_ARRAY","array",426],"(",")",";",["T_WHITESPACE","\n        ",426],["T_FOREACH","foreach",427],["T_WHITESPACE"," ",427],"(",["T_VARIABLE","$updates",427],["T_WHITESPACE"," ",427],["T_AS","as",427],["T_WHITESPACE"," ",427],["T_VARIABLE","$updateNode",427],")",["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n            ",427],["T_IF","if",428],["T_WHITESPACE"," ",428],"(","!",["T_EMPTY","empty",428],"(",["T_VARIABLE","$updateNode",428],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",428],"]",")",")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n                ",428],["T_VARIABLE","$module",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_ISSET","isset",429],"(",["T_VARIABLE","$updateNode",429],"[",["T_CONSTANT_ENCAPSED_STRING","'@'",429],"]","[",["T_CONSTANT_ENCAPSED_STRING","'module'",429],"]",")",["T_WHITESPACE"," ",429],"?",["T_WHITESPACE"," ",429],["T_VARIABLE","$updateNode",429],"[",["T_CONSTANT_ENCAPSED_STRING","'@'",429],"]","[",["T_CONSTANT_ENCAPSED_STRING","'module'",429],"]",["T_WHITESPACE"," ",429],":",["T_WHITESPACE"," ",429],["T_STRING","false",429],";",["T_WHITESPACE","\n                ",429],["T_IF","if",430],["T_WHITESPACE"," ",430],"(",["T_VARIABLE","$module",430],["T_WHITESPACE"," ",430],["T_BOOLEAN_AND","&&",430],["T_WHITESPACE"," ",430],["T_STRING","Mage",430],["T_DOUBLE_COLON","::",430],["T_STRING","getStoreConfigFlag",430],"(",["T_CONSTANT_ENCAPSED_STRING","'advanced\/modules_disable_output\/'",430],["T_WHITESPACE"," ",430],".",["T_WHITESPACE"," ",430],["T_VARIABLE","$module",430],",",["T_WHITESPACE"," ",430],["T_VARIABLE","$storeId",430],")",")",["T_WHITESPACE"," ",430],"{",["T_WHITESPACE","\n                    ",430],["T_CONTINUE","continue",431],";",["T_WHITESPACE","\n                ",431],"}",["T_WHITESPACE","\n                ",432],["T_VARIABLE","$updateFiles",433],"[","]",["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_VARIABLE","$updateNode",433],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",433],"]",";",["T_WHITESPACE","\n            ",433],"}",["T_WHITESPACE","\n        ",434],"}",["T_WHITESPACE","\n        ",435],["T_COMMENT","\/\/ custom local layout updates file - load always last\n",436],["T_WHITESPACE","        ",437],["T_VARIABLE","$updateFiles",437],"[","]",["T_WHITESPACE"," ",437],"=",["T_WHITESPACE"," ",437],["T_CONSTANT_ENCAPSED_STRING","'local.xml'",437],";",["T_WHITESPACE","\n        ",437],["T_VARIABLE","$layoutStr",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_CONSTANT_ENCAPSED_STRING","''",438],";",["T_WHITESPACE","\n        ",438],["T_FOREACH","foreach",439],["T_WHITESPACE"," ",439],"(",["T_VARIABLE","$updateFiles",439],["T_WHITESPACE"," ",439],["T_AS","as",439],["T_WHITESPACE"," ",439],["T_VARIABLE","$file",439],")",["T_WHITESPACE"," ",439],"{",["T_WHITESPACE","\n            ",439],["T_VARIABLE","$filename",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_VARIABLE","$design",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","getLayoutFilename",440],"(",["T_VARIABLE","$file",440],",",["T_WHITESPACE"," ",440],["T_ARRAY","array",440],"(",["T_WHITESPACE","\n                ",440],["T_CONSTANT_ENCAPSED_STRING","'_area'",441],["T_WHITESPACE","    ",441],["T_DOUBLE_ARROW","=>",441],["T_WHITESPACE"," ",441],["T_VARIABLE","$area",441],",",["T_WHITESPACE","\n                ",441],["T_CONSTANT_ENCAPSED_STRING","'_package'",442],["T_WHITESPACE"," ",442],["T_DOUBLE_ARROW","=>",442],["T_WHITESPACE"," ",442],["T_VARIABLE","$package",442],",",["T_WHITESPACE","\n                ",442],["T_CONSTANT_ENCAPSED_STRING","'_theme'",443],["T_WHITESPACE","   ",443],["T_DOUBLE_ARROW","=>",443],["T_WHITESPACE"," ",443],["T_VARIABLE","$theme",443],["T_WHITESPACE","\n            ",443],")",")",";",["T_WHITESPACE","\n            ",444],["T_IF","if",445],["T_WHITESPACE"," ",445],"(","!",["T_STRING","is_readable",445],"(",["T_VARIABLE","$filename",445],")",")",["T_WHITESPACE"," ",445],"{",["T_WHITESPACE","\n                ",445],["T_CONTINUE","continue",446],";",["T_WHITESPACE","\n            ",446],"}",["T_WHITESPACE","\n            ",447],["T_VARIABLE","$fileStr",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_STRING","file_get_contents",448],"(",["T_VARIABLE","$filename",448],")",";",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$fileStr",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_STRING","str_replace",449],"(",["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_subst",449],"[",["T_CONSTANT_ENCAPSED_STRING","'from'",449],"]",",",["T_WHITESPACE"," ",449],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_subst",449],"[",["T_CONSTANT_ENCAPSED_STRING","'to'",449],"]",",",["T_WHITESPACE"," ",449],["T_VARIABLE","$fileStr",449],")",";",["T_WHITESPACE","\n            ",449],["T_VARIABLE","$fileXml",450],["T_WHITESPACE"," ",450],"=",["T_WHITESPACE"," ",450],["T_STRING","simplexml_load_string",450],"(",["T_VARIABLE","$fileStr",450],",",["T_WHITESPACE"," ",450],["T_VARIABLE","$elementClass",450],")",";",["T_WHITESPACE","\n            ",450],["T_IF","if",451],["T_WHITESPACE"," ",451],"(","!",["T_VARIABLE","$fileXml",451],["T_WHITESPACE"," ",451],["T_INSTANCEOF","instanceof",451],["T_WHITESPACE"," ",451],["T_STRING","SimpleXMLElement",451],")",["T_WHITESPACE"," ",451],"{",["T_WHITESPACE","\n                ",451],["T_CONTINUE","continue",452],";",["T_WHITESPACE","\n            ",452],"}",["T_WHITESPACE","\n            ",453],["T_VARIABLE","$layoutStr",454],["T_WHITESPACE"," ",454],["T_CONCAT_EQUAL",".=",454],["T_WHITESPACE"," ",454],["T_VARIABLE","$fileXml",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","innerXml",454],"(",")",";",["T_WHITESPACE","\n        ",454],"}",["T_WHITESPACE","\n        ",455],["T_VARIABLE","$layoutXml",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_STRING","simplexml_load_string",456],"(",["T_CONSTANT_ENCAPSED_STRING","'<layouts>'",456],".",["T_VARIABLE","$layoutStr",456],".",["T_CONSTANT_ENCAPSED_STRING","'<\/layouts>'",456],",",["T_WHITESPACE"," ",456],["T_VARIABLE","$elementClass",456],")",";",["T_WHITESPACE","\n        ",456],["T_RETURN","return",457],["T_WHITESPACE"," ",457],["T_VARIABLE","$layoutXml",457],";",["T_WHITESPACE","\n    ",457],"}",["T_WHITESPACE","\n",458],"}",["T_WHITESPACE","\n",459]]