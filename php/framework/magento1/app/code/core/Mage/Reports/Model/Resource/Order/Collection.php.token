[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Reports\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Reports orders collection\n *\n * @category    Mage\n * @package     Mage_Reports\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Reports_Model_Resource_Order_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Order_Collection",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Is live\n     *\n     * @var boolean\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_isLive",42],["T_WHITESPACE","   ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","false",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Sales amount expression\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_salesAmountExpression",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Check range for live mode\n     *\n     * @param unknown_type $range\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",51],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","checkIsLive",57],"(",["T_VARIABLE","$range",57],")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","_isLive",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_BOOL_CAST","(bool)",59],"!",["T_STRING","Mage",59],["T_DOUBLE_COLON","::",59],["T_STRING","getStoreConfig",59],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/dashboard\/use_aggregated_data'",59],")",";",["T_WHITESPACE","\n        ",59],["T_RETURN","return",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Retrieve is live flag for rep\n     *\n     * @return boolean\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","isLive",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_RETURN","return",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_isLive",70],";",["T_WHITESPACE","\n    ",70],"}",["T_WHITESPACE","\n\n    ",71],["T_DOC_COMMENT","\/**\n     * Prepare report summary\n     *\n     * @param string $range\n     * @param mixed $customStart\n     * @param mixed $customEnd\n     * @param int $isFilter\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",73],["T_WHITESPACE","\n    ",81],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","prepareSummary",82],"(",["T_VARIABLE","$range",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$customStart",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$customEnd",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$isFilter",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_LNUMBER","0",82],")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","checkIsLive",84],"(",["T_VARIABLE","$range",84],")",";",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_isLive",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_prepareSummaryLive",86],"(",["T_VARIABLE","$range",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$customStart",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$customEnd",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$isFilter",86],")",";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE"," ",87],["T_ELSE","else",87],["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n            ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_prepareSummaryAggregated",88],"(",["T_VARIABLE","$range",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$customStart",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$customEnd",88],",",["T_WHITESPACE"," ",88],["T_VARIABLE","$isFilter",88],")",";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n\n        ",89],["T_RETURN","return",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],";",["T_WHITESPACE","\n    ",91],"}",["T_WHITESPACE","\n\n    ",92],["T_DOC_COMMENT","\/**\n     * Get sales amount expression\n     *\n     * @return string\n     *\/",94],["T_WHITESPACE","\n    ",98],["T_PROTECTED","protected",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","_getSalesAmountExpression",99],"(",")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_IF","if",101],["T_WHITESPACE"," ",101],"(",["T_STRING","is_null",101],"(",["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_salesAmountExpression",101],")",")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$adapter",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getConnection",102],"(",")",";",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$expressionTransferObject",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_NEW","new",103],["T_WHITESPACE"," ",103],["T_STRING","Varien_Object",103],"(",["T_ARRAY","array",103],"(",["T_WHITESPACE","\n                ",103],["T_CONSTANT_ENCAPSED_STRING","'expression'",104],["T_WHITESPACE"," ",104],["T_DOUBLE_ARROW","=>",104],["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'%s - %s - %s - (%s - %s - %s)'",104],",",["T_WHITESPACE","\n                ",104],["T_CONSTANT_ENCAPSED_STRING","'arguments'",105],["T_WHITESPACE"," ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_ARRAY","array",105],"(",["T_WHITESPACE","\n                    ",105],["T_VARIABLE","$adapter",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getIfNullSql",106],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_total_invoiced'",106],",",["T_WHITESPACE"," ",106],["T_LNUMBER","0",106],")",",",["T_WHITESPACE","\n                    ",106],["T_VARIABLE","$adapter",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getIfNullSql",107],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_tax_invoiced'",107],",",["T_WHITESPACE"," ",107],["T_LNUMBER","0",107],")",",",["T_WHITESPACE","\n                    ",107],["T_VARIABLE","$adapter",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getIfNullSql",108],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_shipping_invoiced'",108],",",["T_WHITESPACE"," ",108],["T_LNUMBER","0",108],")",",",["T_WHITESPACE","\n                    ",108],["T_VARIABLE","$adapter",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getIfNullSql",109],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_total_refunded'",109],",",["T_WHITESPACE"," ",109],["T_LNUMBER","0",109],")",",",["T_WHITESPACE","\n                    ",109],["T_VARIABLE","$adapter",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getIfNullSql",110],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_tax_refunded'",110],",",["T_WHITESPACE"," ",110],["T_LNUMBER","0",110],")",",",["T_WHITESPACE","\n                    ",110],["T_VARIABLE","$adapter",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getIfNullSql",111],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_shipping_refunded'",111],",",["T_WHITESPACE"," ",111],["T_LNUMBER","0",111],")",",",["T_WHITESPACE","\n                ",111],")",["T_WHITESPACE","\n            ",112],")",")",";",["T_WHITESPACE","\n\n            ",113],["T_STRING","Mage",115],["T_DOUBLE_COLON","::",115],["T_STRING","dispatchEvent",115],"(",["T_CONSTANT_ENCAPSED_STRING","'sales_prepare_amount_expression'",115],",",["T_WHITESPACE"," ",115],["T_ARRAY","array",115],"(",["T_WHITESPACE","\n                ",115],["T_CONSTANT_ENCAPSED_STRING","'collection'",116],["T_WHITESPACE"," ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],",",["T_WHITESPACE","\n                ",116],["T_CONSTANT_ENCAPSED_STRING","'expression_object'",117],["T_WHITESPACE"," ",117],["T_DOUBLE_ARROW","=>",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$expressionTransferObject",117],",",["T_WHITESPACE","\n            ",117],")",")",";",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","_salesAmountExpression",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_STRING","vsprintf",119],"(",["T_WHITESPACE","\n                ",119],["T_VARIABLE","$expressionTransferObject",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getExpression",120],"(",")",",",["T_WHITESPACE","\n                ",120],["T_VARIABLE","$expressionTransferObject",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getArguments",121],"(",")",["T_WHITESPACE","\n            ",121],")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE","\n\n        ",123],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_salesAmountExpression",125],";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Prepare report summary from live data\n     *\n     * @param string $range\n     * @param mixed $customStart\n     * @param mixed $customEnd\n     * @param int $isFilter\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",128],["T_WHITESPACE","\n    ",136],["T_PROTECTED","protected",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","_prepareSummaryLive",137],"(",["T_VARIABLE","$range",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$customStart",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$customEnd",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$isFilter",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_LNUMBER","0",137],")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","setMainTable",139],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$adapter",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getConnection",140],"(",")",";",["T_WHITESPACE","\n\n        ",140],["T_DOC_COMMENT","\/**\n         * Reset all columns, because result will group only by 'created_at' field\n         *\/",142],["T_WHITESPACE","\n        ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getSelect",145],"(",")",["T_OBJECT_OPERATOR","->",145],["T_STRING","reset",145],"(",["T_STRING","Zend_Db_Select",145],["T_DOUBLE_COLON","::",145],["T_STRING","COLUMNS",145],")",";",["T_WHITESPACE","\n\n        ",145],["T_VARIABLE","$expression",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_getSalesAmountExpression",147],"(",")",";",["T_WHITESPACE","\n        ",147],["T_IF","if",148],["T_WHITESPACE"," ",148],"(",["T_VARIABLE","$isFilter",148],["T_WHITESPACE"," ",148],["T_IS_EQUAL","==",148],["T_WHITESPACE"," ",148],["T_LNUMBER","0",148],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getSelect",149],"(",")",["T_OBJECT_OPERATOR","->",149],["T_STRING","columns",149],"(",["T_ARRAY","array",149],"(",["T_WHITESPACE","\n                ",149],["T_CONSTANT_ENCAPSED_STRING","'revenue'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_NEW","new",150],["T_WHITESPACE"," ",150],["T_STRING","Zend_Db_Expr",150],"(",["T_WHITESPACE","\n                    ",150],["T_STRING","sprintf",151],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM((%s) * %s)'",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$expression",151],",",["T_WHITESPACE","\n                        ",151],["T_VARIABLE","$adapter",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getIfNullSql",152],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_to_global_rate'",152],",",["T_WHITESPACE"," ",152],["T_LNUMBER","0",152],")",["T_WHITESPACE","\n                    ",152],")",["T_WHITESPACE","\n                 ",153],")",["T_WHITESPACE","\n            ",154],")",")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE"," ",156],["T_ELSE","else",156],["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getSelect",157],"(",")",["T_OBJECT_OPERATOR","->",157],["T_STRING","columns",157],"(",["T_ARRAY","array",157],"(",["T_WHITESPACE","\n                ",157],["T_CONSTANT_ENCAPSED_STRING","'revenue'",158],["T_WHITESPACE"," ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_NEW","new",158],["T_WHITESPACE"," ",158],["T_STRING","Zend_Db_Expr",158],"(",["T_STRING","sprintf",158],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(%s)'",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$expression",158],")",")",["T_WHITESPACE","\n            ",158],")",")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n\n        ",160],["T_VARIABLE","$dateRange",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getDateRange",162],"(",["T_VARIABLE","$range",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$customStart",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$customEnd",162],")",";",["T_WHITESPACE","\n\n        ",162],["T_VARIABLE","$tzRangeOffsetExpression",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_getTZRangeOffsetExpression",164],"(",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$range",165],",",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'created_at'",165],",",["T_WHITESPACE"," ",165],["T_VARIABLE","$dateRange",165],"[",["T_CONSTANT_ENCAPSED_STRING","'from'",165],"]",",",["T_WHITESPACE"," ",165],["T_VARIABLE","$dateRange",165],"[",["T_CONSTANT_ENCAPSED_STRING","'to'",165],"]",["T_WHITESPACE","\n        ",165],")",";",["T_WHITESPACE","\n\n        ",166],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getSelect",168],"(",")",["T_WHITESPACE","\n            ",168],["T_OBJECT_OPERATOR","->",169],["T_STRING","columns",169],"(",["T_ARRAY","array",169],"(",["T_WHITESPACE","\n                ",169],["T_CONSTANT_ENCAPSED_STRING","'quantity'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'COUNT(main_table.entity_id)'",170],",",["T_WHITESPACE","\n                ",170],["T_CONSTANT_ENCAPSED_STRING","'range'",171],["T_WHITESPACE"," ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$tzRangeOffsetExpression",171],",",["T_WHITESPACE","\n            ",171],")",")",["T_WHITESPACE","\n            ",172],["T_OBJECT_OPERATOR","->",173],["T_STRING","where",173],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.state NOT IN (?)'",173],",",["T_WHITESPACE"," ",173],["T_ARRAY","array",173],"(",["T_WHITESPACE","\n                ",173],["T_STRING","Mage_Sales_Model_Order",174],["T_DOUBLE_COLON","::",174],["T_STRING","STATE_PENDING_PAYMENT",174],",",["T_WHITESPACE","\n                ",174],["T_STRING","Mage_Sales_Model_Order",175],["T_DOUBLE_COLON","::",175],["T_STRING","STATE_NEW",175],")",["T_WHITESPACE","\n            ",175],")",["T_WHITESPACE","\n            ",176],["T_OBJECT_OPERATOR","->",177],["T_STRING","order",177],"(",["T_CONSTANT_ENCAPSED_STRING","'range'",177],",",["T_WHITESPACE"," ",177],["T_STRING","Zend_Db_Select",177],["T_DOUBLE_COLON","::",177],["T_STRING","SQL_ASC",177],")",["T_WHITESPACE","\n            ",177],["T_OBJECT_OPERATOR","->",178],["T_STRING","group",178],"(",["T_VARIABLE","$tzRangeOffsetExpression",178],")",";",["T_WHITESPACE","\n\n        ",178],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","addFieldToFilter",180],"(",["T_CONSTANT_ENCAPSED_STRING","'created_at'",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$dateRange",180],")",";",["T_WHITESPACE","\n\n        ",180],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Prepare report summary from aggregated data\n     *\n     * @param string $range\n     * @param mixed $customStart\n     * @param mixed $customEnd\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",185],["T_WHITESPACE","\n    ",192],["T_PROTECTED","protected",193],["T_WHITESPACE"," ",193],["T_FUNCTION","function",193],["T_WHITESPACE"," ",193],["T_STRING","_prepareSummaryAggregated",193],"(",["T_VARIABLE","$range",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$customStart",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$customEnd",193],")",["T_WHITESPACE","\n    ",193],"{",["T_WHITESPACE","\n        ",194],["T_VARIABLE","$this",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","setMainTable",195],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_aggregated_created'",195],")",";",["T_WHITESPACE","\n        ",195],["T_DOC_COMMENT","\/**\n         * Reset all columns, because result will group only by 'created_at' field\n         *\/",196],["T_WHITESPACE","\n        ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getSelect",199],"(",")",["T_OBJECT_OPERATOR","->",199],["T_STRING","reset",199],"(",["T_STRING","Zend_Db_Select",199],["T_DOUBLE_COLON","::",199],["T_STRING","COLUMNS",199],")",";",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$rangePeriod",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_getRangeExpressionForAttribute",200],"(",["T_VARIABLE","$range",200],",",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'main_table.period'",200],")",";",["T_WHITESPACE","\n\n        ",200],["T_VARIABLE","$tableName",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getConnection",202],"(",")",["T_OBJECT_OPERATOR","->",202],["T_STRING","quoteIdentifier",202],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.period'",202],")",";",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$rangePeriod2",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_STRING","str_replace",203],"(",["T_VARIABLE","$tableName",203],",",["T_WHITESPACE"," ",203],"\"",["T_ENCAPSED_AND_WHITESPACE","MIN(",203],["T_VARIABLE","$tableName",203],["T_ENCAPSED_AND_WHITESPACE",")",203],"\"",",",["T_WHITESPACE"," ",203],["T_VARIABLE","$rangePeriod",203],")",";",["T_WHITESPACE","\n\n        ",203],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","getSelect",205],"(",")",["T_OBJECT_OPERATOR","->",205],["T_STRING","columns",205],"(",["T_ARRAY","array",205],"(",["T_WHITESPACE","\n            ",205],["T_CONSTANT_ENCAPSED_STRING","'revenue'",206],["T_WHITESPACE","  ",206],["T_DOUBLE_ARROW","=>",206],["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.total_revenue_amount)'",206],",",["T_WHITESPACE","\n            ",206],["T_CONSTANT_ENCAPSED_STRING","'quantity'",207],["T_WHITESPACE"," ",207],["T_DOUBLE_ARROW","=>",207],["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.orders_count)'",207],",",["T_WHITESPACE","\n            ",207],["T_CONSTANT_ENCAPSED_STRING","'range'",208],["T_WHITESPACE"," ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$rangePeriod2",208],",",["T_WHITESPACE","\n        ",208],")",")",["T_WHITESPACE","\n        ",209],["T_OBJECT_OPERATOR","->",210],["T_STRING","order",210],"(",["T_CONSTANT_ENCAPSED_STRING","'range'",210],")",["T_WHITESPACE","\n        ",210],["T_OBJECT_OPERATOR","->",211],["T_STRING","group",211],"(",["T_VARIABLE","$rangePeriod",211],")",";",["T_WHITESPACE","\n\n        ",211],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getSelect",213],"(",")",["T_OBJECT_OPERATOR","->",213],["T_STRING","where",213],"(",["T_WHITESPACE","\n            ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_getConditionSql",214],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.period'",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getDateRange",214],"(",["T_VARIABLE","$range",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$customStart",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$customEnd",214],")",")",["T_WHITESPACE","\n        ",214],")",";",["T_WHITESPACE","\n\n        ",215],["T_VARIABLE","$statuses",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_STRING","Mage",217],["T_DOUBLE_COLON","::",217],["T_STRING","getSingleton",217],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/config'",217],")",["T_WHITESPACE","\n            ",217],["T_OBJECT_OPERATOR","->",218],["T_STRING","getOrderStatusesForState",218],"(",["T_STRING","Mage_Sales_Model_Order",218],["T_DOUBLE_COLON","::",218],["T_STRING","STATE_CANCELED",218],")",";",["T_WHITESPACE","\n\n        ",218],["T_IF","if",220],["T_WHITESPACE"," ",220],"(",["T_EMPTY","empty",220],"(",["T_VARIABLE","$statuses",220],")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$statuses",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_ARRAY","array",221],"(",["T_LNUMBER","0",221],")",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE","\n        ",222],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","addFieldToFilter",223],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.order_status'",223],",",["T_WHITESPACE"," ",223],["T_ARRAY","array",223],"(",["T_CONSTANT_ENCAPSED_STRING","'nin'",223],["T_WHITESPACE"," ",223],["T_DOUBLE_ARROW","=>",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$statuses",223],")",")",";",["T_WHITESPACE","\n\n        ",223],["T_RETURN","return",225],["T_WHITESPACE"," ",225],["T_VARIABLE","$this",225],";",["T_WHITESPACE","\n    ",225],"}",["T_WHITESPACE","\n\n    ",226],["T_DOC_COMMENT","\/**\n     * Get range expression\n     *\n     * @param string $range\n     * @return Zend_Db_Expr\n     *\/",228],["T_WHITESPACE","\n    ",233],["T_PROTECTED","protected",234],["T_WHITESPACE"," ",234],["T_FUNCTION","function",234],["T_WHITESPACE"," ",234],["T_STRING","_getRangeExpression",234],"(",["T_VARIABLE","$range",234],")",["T_WHITESPACE","\n    ",234],"{",["T_WHITESPACE","\n        ",235],["T_SWITCH","switch",236],["T_WHITESPACE"," ",236],"(",["T_VARIABLE","$range",236],")",["T_WHITESPACE","\n        ",236],"{",["T_WHITESPACE","\n            ",237],["T_CASE","case",238],["T_WHITESPACE"," ",238],["T_CONSTANT_ENCAPSED_STRING","'24h'",238],":",["T_WHITESPACE","\n                ",238],["T_VARIABLE","$expression",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getConnection",239],"(",")",["T_OBJECT_OPERATOR","->",239],["T_STRING","getConcatSql",239],"(",["T_ARRAY","array",239],"(",["T_WHITESPACE","\n                    ",239],["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getConnection",240],"(",")",["T_OBJECT_OPERATOR","->",240],["T_STRING","getDateFormatSql",240],"(",["T_CONSTANT_ENCAPSED_STRING","'{{attribute}}'",240],",",["T_WHITESPACE"," ",240],["T_CONSTANT_ENCAPSED_STRING","'%Y-%m-%d %H:'",240],")",",",["T_WHITESPACE","\n                    ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getConnection",241],"(",")",["T_OBJECT_OPERATOR","->",241],["T_STRING","quote",241],"(",["T_CONSTANT_ENCAPSED_STRING","'00'",241],")",["T_WHITESPACE","\n                ",241],")",")",";",["T_WHITESPACE","\n                ",242],["T_BREAK","break",243],";",["T_WHITESPACE","\n            ",243],["T_CASE","case",244],["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'7d'",244],":",["T_WHITESPACE","\n            ",244],["T_CASE","case",245],["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'1m'",245],":",["T_WHITESPACE","\n                ",245],["T_VARIABLE","$expression",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","getConnection",246],"(",")",["T_OBJECT_OPERATOR","->",246],["T_STRING","getDateFormatSql",246],"(",["T_CONSTANT_ENCAPSED_STRING","'{{attribute}}'",246],",",["T_WHITESPACE"," ",246],["T_CONSTANT_ENCAPSED_STRING","'%Y-%m-%d'",246],")",";",["T_WHITESPACE","\n                ",246],["T_BREAK","break",247],";",["T_WHITESPACE","\n            ",247],["T_CASE","case",248],["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'1y'",248],":",["T_WHITESPACE","\n            ",248],["T_CASE","case",249],["T_WHITESPACE"," ",249],["T_CONSTANT_ENCAPSED_STRING","'2y'",249],":",["T_WHITESPACE","\n            ",249],["T_CASE","case",250],["T_WHITESPACE"," ",250],["T_CONSTANT_ENCAPSED_STRING","'custom'",250],":",["T_WHITESPACE","\n            ",250],["T_DEFAULT","default",251],":",["T_WHITESPACE","\n                ",251],["T_VARIABLE","$expression",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getConnection",252],"(",")",["T_OBJECT_OPERATOR","->",252],["T_STRING","getDateFormatSql",252],"(",["T_CONSTANT_ENCAPSED_STRING","'{{attribute}}'",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'%Y-%m'",252],")",";",["T_WHITESPACE","\n                ",252],["T_BREAK","break",253],";",["T_WHITESPACE","\n        ",253],"}",["T_WHITESPACE","\n\n        ",254],["T_RETURN","return",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$expression",256],";",["T_WHITESPACE","\n    ",256],"}",["T_WHITESPACE","\n\n    ",257],["T_DOC_COMMENT","\/**\n     * Retrieve range expression adapted for attribute\n     *\n     * @param string $range\n     * @param string $attribute\n     * @return string\n     *\/",259],["T_WHITESPACE","\n    ",265],["T_PROTECTED","protected",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","_getRangeExpressionForAttribute",266],"(",["T_VARIABLE","$range",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$attribute",266],")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$expression",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_getRangeExpression",268],"(",["T_VARIABLE","$range",268],")",";",["T_WHITESPACE","\n        ",268],["T_RETURN","return",269],["T_WHITESPACE"," ",269],["T_STRING","str_replace",269],"(",["T_CONSTANT_ENCAPSED_STRING","'{{attribute}}'",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getConnection",269],"(",")",["T_OBJECT_OPERATOR","->",269],["T_STRING","quoteIdentifier",269],"(",["T_VARIABLE","$attribute",269],")",",",["T_WHITESPACE"," ",269],["T_VARIABLE","$expression",269],")",";",["T_WHITESPACE","\n    ",269],"}",["T_WHITESPACE","\n\n    ",270],["T_DOC_COMMENT","\/**\n     * Retrieve query for attribute with timezone conversion\n     *\n     * @param string $range\n     * @param string $attribute\n     * @param mixed $from\n     * @param mixed $to\n     * @return string\n     *\/",272],["T_WHITESPACE","\n    ",280],["T_PROTECTED","protected",281],["T_WHITESPACE"," ",281],["T_FUNCTION","function",281],["T_WHITESPACE"," ",281],["T_STRING","_getTZRangeOffsetExpression",281],"(",["T_VARIABLE","$range",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$attribute",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$from",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","null",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$to",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_STRING","null",281],")",["T_WHITESPACE","\n    ",281],"{",["T_WHITESPACE","\n        ",282],["T_RETURN","return",283],["T_WHITESPACE"," ",283],["T_STRING","str_replace",283],"(",["T_WHITESPACE","\n            ",283],["T_CONSTANT_ENCAPSED_STRING","'{{attribute}}'",284],",",["T_WHITESPACE","\n            ",284],["T_STRING","Mage",285],["T_DOUBLE_COLON","::",285],["T_STRING","getResourceModel",285],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/report_order'",285],")",["T_WHITESPACE","\n                    ",285],["T_OBJECT_OPERATOR","->",286],["T_STRING","getStoreTZOffsetQuery",286],"(",["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getMainTable",286],"(",")",",",["T_WHITESPACE"," ",286],["T_VARIABLE","$attribute",286],",",["T_WHITESPACE"," ",286],["T_VARIABLE","$from",286],",",["T_WHITESPACE"," ",286],["T_VARIABLE","$to",286],")",",",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$this",287],["T_OBJECT_OPERATOR","->",287],["T_STRING","_getRangeExpression",287],"(",["T_VARIABLE","$range",287],")",["T_WHITESPACE","\n        ",287],")",";",["T_WHITESPACE","\n    ",288],"}",["T_WHITESPACE","\n\n    ",289],["T_DOC_COMMENT","\/**\n     * Retrieve range expression with timezone conversion adapted for attribute\n     *\n     * @param string $range\n     * @param string $attribute\n     * @param string $tzFrom\n     * @param string $tzTo\n     * @return string\n     *\/",291],["T_WHITESPACE","\n    ",299],["T_PROTECTED","protected",300],["T_WHITESPACE"," ",300],["T_FUNCTION","function",300],["T_WHITESPACE"," ",300],["T_STRING","_getTZRangeExpressionForAttribute",300],"(",["T_VARIABLE","$range",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$attribute",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$tzFrom",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_CONSTANT_ENCAPSED_STRING","'+00:00'",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$tzTo",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_STRING","null",300],")",["T_WHITESPACE","\n    ",300],"{",["T_WHITESPACE","\n        ",301],["T_IF","if",302],["T_WHITESPACE"," ",302],"(",["T_STRING","null",302],["T_WHITESPACE"," ",302],["T_IS_EQUAL","==",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$tzTo",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$tzTo",303],["T_WHITESPACE"," ",303],"=",["T_WHITESPACE"," ",303],["T_STRING","Mage",303],["T_DOUBLE_COLON","::",303],["T_STRING","app",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","getLocale",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","storeDate",303],"(",")",["T_OBJECT_OPERATOR","->",303],["T_STRING","toString",303],"(",["T_STRING","Zend_Date",303],["T_DOUBLE_COLON","::",303],["T_STRING","GMT_DIFF_SEP",303],")",";",["T_WHITESPACE","\n        ",303],"}",["T_WHITESPACE","\n        ",304],["T_VARIABLE","$adapter",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getConnection",305],"(",")",";",["T_WHITESPACE","\n        ",305],["T_VARIABLE","$expression",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_getRangeExpression",306],"(",["T_VARIABLE","$range",306],")",";",["T_WHITESPACE","\n        ",306],["T_VARIABLE","$attribute",307],["T_WHITESPACE","  ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$adapter",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","quoteIdentifier",307],"(",["T_VARIABLE","$attribute",307],")",";",["T_WHITESPACE","\n        ",307],["T_VARIABLE","$periodExpr",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$adapter",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getDateAddSql",308],"(",["T_VARIABLE","$attribute",308],",",["T_WHITESPACE"," ",308],["T_VARIABLE","$tzTo",308],",",["T_WHITESPACE"," ",308],["T_STRING","Varien_Db_Adapter_Interface",308],["T_DOUBLE_COLON","::",308],["T_STRING","INTERVAL_HOUR",308],")",";",["T_WHITESPACE","\n\n        ",308],["T_RETURN","return",310],["T_WHITESPACE"," ",310],["T_STRING","str_replace",310],"(",["T_CONSTANT_ENCAPSED_STRING","'{{attribute}}'",310],",",["T_WHITESPACE"," ",310],["T_VARIABLE","$periodExpr",310],",",["T_WHITESPACE"," ",310],["T_VARIABLE","$expression",310],")",";",["T_WHITESPACE","\n    ",310],"}",["T_WHITESPACE","\n\n    ",311],["T_DOC_COMMENT","\/**\n     * Calculate From and To dates (or times) by given period\n     *\n     * @param string $range\n     * @param string $customStart\n     * @param string $customEnd\n     * @param boolean $returnObjects\n     * @return array\n     *\/",313],["T_WHITESPACE","\n    ",321],["T_PUBLIC","public",322],["T_WHITESPACE"," ",322],["T_FUNCTION","function",322],["T_WHITESPACE"," ",322],["T_STRING","getDateRange",322],"(",["T_VARIABLE","$range",322],",",["T_WHITESPACE"," ",322],["T_VARIABLE","$customStart",322],",",["T_WHITESPACE"," ",322],["T_VARIABLE","$customEnd",322],",",["T_WHITESPACE"," ",322],["T_VARIABLE","$returnObjects",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_STRING","false",322],")",["T_WHITESPACE","\n    ",322],"{",["T_WHITESPACE","\n        ",323],["T_VARIABLE","$dateEnd",324],["T_WHITESPACE","   ",324],"=",["T_WHITESPACE"," ",324],["T_STRING","Mage",324],["T_DOUBLE_COLON","::",324],["T_STRING","app",324],"(",")",["T_OBJECT_OPERATOR","->",324],["T_STRING","getLocale",324],"(",")",["T_OBJECT_OPERATOR","->",324],["T_STRING","date",324],"(",")",";",["T_WHITESPACE","\n        ",324],["T_VARIABLE","$dateStart",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_CLONE","clone",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$dateEnd",325],";",["T_WHITESPACE","\n\n        ",325],["T_COMMENT","\/\/ go to the end of a day\n",327],["T_WHITESPACE","        ",328],["T_VARIABLE","$dateEnd",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","setHour",328],"(",["T_LNUMBER","23",328],")",";",["T_WHITESPACE","\n        ",328],["T_VARIABLE","$dateEnd",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","setMinute",329],"(",["T_LNUMBER","59",329],")",";",["T_WHITESPACE","\n        ",329],["T_VARIABLE","$dateEnd",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","setSecond",330],"(",["T_LNUMBER","59",330],")",";",["T_WHITESPACE","\n\n        ",330],["T_VARIABLE","$dateStart",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","setHour",332],"(",["T_LNUMBER","0",332],")",";",["T_WHITESPACE","\n        ",332],["T_VARIABLE","$dateStart",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","setMinute",333],"(",["T_LNUMBER","0",333],")",";",["T_WHITESPACE","\n        ",333],["T_VARIABLE","$dateStart",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","setSecond",334],"(",["T_LNUMBER","0",334],")",";",["T_WHITESPACE","\n\n        ",334],["T_SWITCH","switch",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$range",336],")",["T_WHITESPACE","\n        ",336],"{",["T_WHITESPACE","\n            ",337],["T_CASE","case",338],["T_WHITESPACE"," ",338],["T_CONSTANT_ENCAPSED_STRING","'24h'",338],":",["T_WHITESPACE","\n                ",338],["T_VARIABLE","$dateEnd",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_STRING","Mage",339],["T_DOUBLE_COLON","::",339],["T_STRING","app",339],"(",")",["T_OBJECT_OPERATOR","->",339],["T_STRING","getLocale",339],"(",")",["T_OBJECT_OPERATOR","->",339],["T_STRING","date",339],"(",")",";",["T_WHITESPACE","\n                ",339],["T_VARIABLE","$dateEnd",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","addHour",340],"(",["T_LNUMBER","1",340],")",";",["T_WHITESPACE","\n                ",340],["T_VARIABLE","$dateStart",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_CLONE","clone",341],["T_WHITESPACE"," ",341],["T_VARIABLE","$dateEnd",341],";",["T_WHITESPACE","\n                ",341],["T_VARIABLE","$dateStart",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","subDay",342],"(",["T_LNUMBER","1",342],")",";",["T_WHITESPACE","\n                ",342],["T_BREAK","break",343],";",["T_WHITESPACE","\n\n            ",343],["T_CASE","case",345],["T_WHITESPACE"," ",345],["T_CONSTANT_ENCAPSED_STRING","'7d'",345],":",["T_WHITESPACE","\n                ",345],["T_COMMENT","\/\/ substract 6 days we need to include\n",346],["T_WHITESPACE","                ",347],["T_COMMENT","\/\/ only today and not hte last one from range\n",347],["T_WHITESPACE","                ",348],["T_VARIABLE","$dateStart",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","subDay",348],"(",["T_LNUMBER","6",348],")",";",["T_WHITESPACE","\n                ",348],["T_BREAK","break",349],";",["T_WHITESPACE","\n\n            ",349],["T_CASE","case",351],["T_WHITESPACE"," ",351],["T_CONSTANT_ENCAPSED_STRING","'1m'",351],":",["T_WHITESPACE","\n                ",351],["T_VARIABLE","$dateStart",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","setDay",352],"(",["T_STRING","Mage",352],["T_DOUBLE_COLON","::",352],["T_STRING","getStoreConfig",352],"(",["T_CONSTANT_ENCAPSED_STRING","'reports\/dashboard\/mtd_start'",352],")",")",";",["T_WHITESPACE","\n                ",352],["T_BREAK","break",353],";",["T_WHITESPACE","\n\n            ",353],["T_CASE","case",355],["T_WHITESPACE"," ",355],["T_CONSTANT_ENCAPSED_STRING","'custom'",355],":",["T_WHITESPACE","\n                ",355],["T_VARIABLE","$dateStart",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_VARIABLE","$customStart",356],["T_WHITESPACE"," ",356],"?",["T_WHITESPACE"," ",356],["T_VARIABLE","$customStart",356],["T_WHITESPACE"," ",356],":",["T_WHITESPACE"," ",356],["T_VARIABLE","$dateEnd",356],";",["T_WHITESPACE","\n                ",356],["T_VARIABLE","$dateEnd",357],["T_WHITESPACE","   ",357],"=",["T_WHITESPACE"," ",357],["T_VARIABLE","$customEnd",357],["T_WHITESPACE"," ",357],"?",["T_WHITESPACE"," ",357],["T_VARIABLE","$customEnd",357],["T_WHITESPACE"," ",357],":",["T_WHITESPACE"," ",357],["T_VARIABLE","$dateEnd",357],";",["T_WHITESPACE","\n                ",357],["T_BREAK","break",358],";",["T_WHITESPACE","\n\n            ",358],["T_CASE","case",360],["T_WHITESPACE"," ",360],["T_CONSTANT_ENCAPSED_STRING","'1y'",360],":",["T_WHITESPACE","\n            ",360],["T_CASE","case",361],["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","'2y'",361],":",["T_WHITESPACE","\n                ",361],["T_VARIABLE","$startMonthDay",362],["T_WHITESPACE"," ",362],"=",["T_WHITESPACE"," ",362],["T_STRING","explode",362],"(",["T_CONSTANT_ENCAPSED_STRING","','",362],",",["T_WHITESPACE"," ",362],["T_STRING","Mage",362],["T_DOUBLE_COLON","::",362],["T_STRING","getStoreConfig",362],"(",["T_CONSTANT_ENCAPSED_STRING","'reports\/dashboard\/ytd_start'",362],")",")",";",["T_WHITESPACE","\n                ",362],["T_VARIABLE","$startMonth",363],["T_WHITESPACE"," ",363],"=",["T_WHITESPACE"," ",363],["T_ISSET","isset",363],"(",["T_VARIABLE","$startMonthDay",363],"[",["T_LNUMBER","0",363],"]",")",["T_WHITESPACE"," ",363],"?",["T_WHITESPACE"," ",363],["T_INT_CAST","(int)",363],["T_VARIABLE","$startMonthDay",363],"[",["T_LNUMBER","0",363],"]",["T_WHITESPACE"," ",363],":",["T_WHITESPACE"," ",363],["T_LNUMBER","1",363],";",["T_WHITESPACE","\n                ",363],["T_VARIABLE","$startDay",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_ISSET","isset",364],"(",["T_VARIABLE","$startMonthDay",364],"[",["T_LNUMBER","1",364],"]",")",["T_WHITESPACE"," ",364],"?",["T_WHITESPACE"," ",364],["T_INT_CAST","(int)",364],["T_VARIABLE","$startMonthDay",364],"[",["T_LNUMBER","1",364],"]",["T_WHITESPACE"," ",364],":",["T_WHITESPACE"," ",364],["T_LNUMBER","1",364],";",["T_WHITESPACE","\n                ",364],["T_VARIABLE","$dateStart",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","setMonth",365],"(",["T_VARIABLE","$startMonth",365],")",";",["T_WHITESPACE","\n                ",365],["T_VARIABLE","$dateStart",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","setDay",366],"(",["T_VARIABLE","$startDay",366],")",";",["T_WHITESPACE","\n                ",366],["T_IF","if",367],["T_WHITESPACE"," ",367],"(",["T_VARIABLE","$range",367],["T_WHITESPACE"," ",367],["T_IS_EQUAL","==",367],["T_WHITESPACE"," ",367],["T_CONSTANT_ENCAPSED_STRING","'2y'",367],")",["T_WHITESPACE"," ",367],"{",["T_WHITESPACE","\n                    ",367],["T_VARIABLE","$dateStart",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","subYear",368],"(",["T_LNUMBER","1",368],")",";",["T_WHITESPACE","\n                ",368],"}",["T_WHITESPACE","\n                ",369],["T_BREAK","break",370],";",["T_WHITESPACE","\n        ",370],"}",["T_WHITESPACE","\n\n        ",371],["T_VARIABLE","$dateStart",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","setTimezone",373],"(",["T_CONSTANT_ENCAPSED_STRING","'Etc\/UTC'",373],")",";",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$dateEnd",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","setTimezone",374],"(",["T_CONSTANT_ENCAPSED_STRING","'Etc\/UTC'",374],")",";",["T_WHITESPACE","\n\n        ",374],["T_IF","if",376],["T_WHITESPACE"," ",376],"(",["T_VARIABLE","$returnObjects",376],")",["T_WHITESPACE"," ",376],"{",["T_WHITESPACE","\n            ",376],["T_RETURN","return",377],["T_WHITESPACE"," ",377],["T_ARRAY","array",377],"(",["T_VARIABLE","$dateStart",377],",",["T_WHITESPACE"," ",377],["T_VARIABLE","$dateEnd",377],")",";",["T_WHITESPACE","\n        ",377],"}",["T_WHITESPACE"," ",378],["T_ELSE","else",378],["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n            ",378],["T_RETURN","return",379],["T_WHITESPACE"," ",379],["T_ARRAY","array",379],"(",["T_CONSTANT_ENCAPSED_STRING","'from'",379],["T_WHITESPACE"," ",379],["T_DOUBLE_ARROW","=>",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$dateStart",379],",",["T_WHITESPACE"," ",379],["T_CONSTANT_ENCAPSED_STRING","'to'",379],["T_WHITESPACE"," ",379],["T_DOUBLE_ARROW","=>",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$dateEnd",379],",",["T_WHITESPACE"," ",379],["T_CONSTANT_ENCAPSED_STRING","'datetime'",379],["T_WHITESPACE"," ",379],["T_DOUBLE_ARROW","=>",379],["T_WHITESPACE"," ",379],["T_STRING","true",379],")",";",["T_WHITESPACE","\n        ",379],"}",["T_WHITESPACE","\n    ",380],"}",["T_WHITESPACE","\n\n    ",381],["T_DOC_COMMENT","\/**\n     * Add item count expression\n     *\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",383],["T_WHITESPACE","\n    ",387],["T_PUBLIC","public",388],["T_WHITESPACE"," ",388],["T_FUNCTION","function",388],["T_WHITESPACE"," ",388],["T_STRING","addItemCountExpr",388],"(",")",["T_WHITESPACE","\n    ",388],"{",["T_WHITESPACE","\n        ",389],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","getSelect",390],"(",")",["T_OBJECT_OPERATOR","->",390],["T_STRING","columns",390],"(",["T_ARRAY","array",390],"(",["T_CONSTANT_ENCAPSED_STRING","'items_count'",390],["T_WHITESPACE"," ",390],["T_DOUBLE_ARROW","=>",390],["T_WHITESPACE"," ",390],["T_CONSTANT_ENCAPSED_STRING","'total_item_count'",390],")",",",["T_WHITESPACE"," ",390],["T_CONSTANT_ENCAPSED_STRING","'main_table'",390],")",";",["T_WHITESPACE","\n        ",390],["T_RETURN","return",391],["T_WHITESPACE"," ",391],["T_VARIABLE","$this",391],";",["T_WHITESPACE","\n    ",391],"}",["T_WHITESPACE","\n\n    ",392],["T_DOC_COMMENT","\/**\n     * Calculate totals report\n     *\n     * @param int $isFilter\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",394],["T_WHITESPACE","\n    ",399],["T_PUBLIC","public",400],["T_WHITESPACE"," ",400],["T_FUNCTION","function",400],["T_WHITESPACE"," ",400],["T_STRING","calculateTotals",400],"(",["T_VARIABLE","$isFilter",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_LNUMBER","0",400],")",["T_WHITESPACE","\n    ",400],"{",["T_WHITESPACE","\n        ",401],["T_IF","if",402],["T_WHITESPACE"," ",402],"(",["T_VARIABLE","$this",402],["T_OBJECT_OPERATOR","->",402],["T_STRING","isLive",402],"(",")",")",["T_WHITESPACE"," ",402],"{",["T_WHITESPACE","\n            ",402],["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","_calculateTotalsLive",403],"(",["T_VARIABLE","$isFilter",403],")",";",["T_WHITESPACE","\n        ",403],"}",["T_WHITESPACE"," ",404],["T_ELSE","else",404],["T_WHITESPACE"," ",404],"{",["T_WHITESPACE","\n            ",404],["T_VARIABLE","$this",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","_calculateTotalsAggregated",405],"(",["T_VARIABLE","$isFilter",405],")",";",["T_WHITESPACE","\n        ",405],"}",["T_WHITESPACE","\n\n        ",406],["T_RETURN","return",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],";",["T_WHITESPACE","\n    ",408],"}",["T_WHITESPACE","\n\n    ",409],["T_DOC_COMMENT","\/**\n     * Calculate totals live report\n     *\n     * @param int $isFilter\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",411],["T_WHITESPACE","\n    ",416],["T_PROTECTED","protected",417],["T_WHITESPACE"," ",417],["T_FUNCTION","function",417],["T_WHITESPACE"," ",417],["T_STRING","_calculateTotalsLive",417],"(",["T_VARIABLE","$isFilter",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_LNUMBER","0",417],")",["T_WHITESPACE","\n    ",417],"{",["T_WHITESPACE","\n        ",418],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","setMainTable",419],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",419],")",";",["T_WHITESPACE","\n        ",419],["T_VARIABLE","$this",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","removeAllFieldsFromSelect",420],"(",")",";",["T_WHITESPACE","\n\n        ",420],["T_VARIABLE","$adapter",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getConnection",422],"(",")",";",["T_WHITESPACE","\n\n        ",422],["T_VARIABLE","$baseTaxInvoiced",424],["T_WHITESPACE","      ",424],"=",["T_WHITESPACE"," ",424],["T_VARIABLE","$adapter",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getIfNullSql",424],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_tax_invoiced'",424],",",["T_WHITESPACE"," ",424],["T_LNUMBER","0",424],")",";",["T_WHITESPACE","\n        ",424],["T_VARIABLE","$baseTaxRefunded",425],["T_WHITESPACE","      ",425],"=",["T_WHITESPACE"," ",425],["T_VARIABLE","$adapter",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getIfNullSql",425],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_tax_refunded'",425],",",["T_WHITESPACE"," ",425],["T_LNUMBER","0",425],")",";",["T_WHITESPACE","\n        ",425],["T_VARIABLE","$baseShippingInvoiced",426],["T_WHITESPACE"," ",426],"=",["T_WHITESPACE"," ",426],["T_VARIABLE","$adapter",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getIfNullSql",426],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_shipping_invoiced'",426],",",["T_WHITESPACE"," ",426],["T_LNUMBER","0",426],")",";",["T_WHITESPACE","\n        ",426],["T_VARIABLE","$baseShippingRefunded",427],["T_WHITESPACE"," ",427],"=",["T_WHITESPACE"," ",427],["T_VARIABLE","$adapter",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","getIfNullSql",427],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_shipping_refunded'",427],",",["T_WHITESPACE"," ",427],["T_LNUMBER","0",427],")",";",["T_WHITESPACE","\n\n        ",427],["T_VARIABLE","$revenueExp",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","_getSalesAmountExpression",429],"(",")",";",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$taxExp",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_STRING","sprintf",430],"(",["T_CONSTANT_ENCAPSED_STRING","'%s - %s'",430],",",["T_WHITESPACE"," ",430],["T_VARIABLE","$baseTaxInvoiced",430],",",["T_WHITESPACE"," ",430],["T_VARIABLE","$baseTaxRefunded",430],")",";",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$shippingExp",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_STRING","sprintf",431],"(",["T_CONSTANT_ENCAPSED_STRING","'%s - %s'",431],",",["T_WHITESPACE"," ",431],["T_VARIABLE","$baseShippingInvoiced",431],",",["T_WHITESPACE"," ",431],["T_VARIABLE","$baseShippingRefunded",431],")",";",["T_WHITESPACE","\n\n        ",431],["T_IF","if",433],["T_WHITESPACE"," ",433],"(",["T_VARIABLE","$isFilter",433],["T_WHITESPACE"," ",433],["T_IS_EQUAL","==",433],["T_WHITESPACE"," ",433],["T_LNUMBER","0",433],")",["T_WHITESPACE"," ",433],"{",["T_WHITESPACE","\n            ",433],["T_VARIABLE","$rateExp",434],["T_WHITESPACE"," ",434],"=",["T_WHITESPACE"," ",434],["T_VARIABLE","$adapter",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","getIfNullSql",434],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_to_global_rate'",434],",",["T_WHITESPACE"," ",434],["T_LNUMBER","0",434],")",";",["T_WHITESPACE","\n            ",434],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","getSelect",435],"(",")",["T_OBJECT_OPERATOR","->",435],["T_STRING","columns",435],"(",["T_WHITESPACE","\n                ",435],["T_ARRAY","array",436],"(",["T_WHITESPACE","\n                    ",436],["T_CONSTANT_ENCAPSED_STRING","'revenue'",437],["T_WHITESPACE","  ",437],["T_DOUBLE_ARROW","=>",437],["T_WHITESPACE"," ",437],["T_NEW","new",437],["T_WHITESPACE"," ",437],["T_STRING","Zend_Db_Expr",437],"(",["T_STRING","sprintf",437],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM((%s) * %s)'",437],",",["T_WHITESPACE"," ",437],["T_VARIABLE","$revenueExp",437],",",["T_WHITESPACE"," ",437],["T_VARIABLE","$rateExp",437],")",")",",",["T_WHITESPACE","\n                    ",437],["T_CONSTANT_ENCAPSED_STRING","'tax'",438],["T_WHITESPACE","      ",438],["T_DOUBLE_ARROW","=>",438],["T_WHITESPACE"," ",438],["T_NEW","new",438],["T_WHITESPACE"," ",438],["T_STRING","Zend_Db_Expr",438],"(",["T_STRING","sprintf",438],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM((%s) * %s)'",438],",",["T_WHITESPACE"," ",438],["T_VARIABLE","$taxExp",438],",",["T_WHITESPACE"," ",438],["T_VARIABLE","$rateExp",438],")",")",",",["T_WHITESPACE","\n                    ",438],["T_CONSTANT_ENCAPSED_STRING","'shipping'",439],["T_WHITESPACE"," ",439],["T_DOUBLE_ARROW","=>",439],["T_WHITESPACE"," ",439],["T_NEW","new",439],["T_WHITESPACE"," ",439],["T_STRING","Zend_Db_Expr",439],"(",["T_STRING","sprintf",439],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM((%s) * %s)'",439],",",["T_WHITESPACE"," ",439],["T_VARIABLE","$shippingExp",439],",",["T_WHITESPACE"," ",439],["T_VARIABLE","$rateExp",439],")",")",["T_WHITESPACE","\n                ",439],")",["T_WHITESPACE","\n            ",440],")",";",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE"," ",442],["T_ELSE","else",442],["T_WHITESPACE"," ",442],"{",["T_WHITESPACE","\n            ",442],["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getSelect",443],"(",")",["T_OBJECT_OPERATOR","->",443],["T_STRING","columns",443],"(",["T_WHITESPACE","\n                ",443],["T_ARRAY","array",444],"(",["T_WHITESPACE","\n                    ",444],["T_CONSTANT_ENCAPSED_STRING","'revenue'",445],["T_WHITESPACE","  ",445],["T_DOUBLE_ARROW","=>",445],["T_WHITESPACE"," ",445],["T_NEW","new",445],["T_WHITESPACE"," ",445],["T_STRING","Zend_Db_Expr",445],"(",["T_STRING","sprintf",445],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(%s)'",445],",",["T_WHITESPACE"," ",445],["T_VARIABLE","$revenueExp",445],")",")",",",["T_WHITESPACE","\n                    ",445],["T_CONSTANT_ENCAPSED_STRING","'tax'",446],["T_WHITESPACE","      ",446],["T_DOUBLE_ARROW","=>",446],["T_WHITESPACE"," ",446],["T_NEW","new",446],["T_WHITESPACE"," ",446],["T_STRING","Zend_Db_Expr",446],"(",["T_STRING","sprintf",446],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(%s)'",446],",",["T_WHITESPACE"," ",446],["T_VARIABLE","$taxExp",446],")",")",",",["T_WHITESPACE","\n                    ",446],["T_CONSTANT_ENCAPSED_STRING","'shipping'",447],["T_WHITESPACE"," ",447],["T_DOUBLE_ARROW","=>",447],["T_WHITESPACE"," ",447],["T_NEW","new",447],["T_WHITESPACE"," ",447],["T_STRING","Zend_Db_Expr",447],"(",["T_STRING","sprintf",447],"(",["T_CONSTANT_ENCAPSED_STRING","'SUM(%s)'",447],",",["T_WHITESPACE"," ",447],["T_VARIABLE","$shippingExp",447],")",")",["T_WHITESPACE","\n                ",447],")",["T_WHITESPACE","\n            ",448],")",";",["T_WHITESPACE","\n        ",449],"}",["T_WHITESPACE","\n\n        ",450],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getSelect",452],"(",")",["T_OBJECT_OPERATOR","->",452],["T_STRING","columns",452],"(",["T_ARRAY","array",452],"(",["T_WHITESPACE","\n            ",452],["T_CONSTANT_ENCAPSED_STRING","'quantity'",453],["T_WHITESPACE"," ",453],["T_DOUBLE_ARROW","=>",453],["T_WHITESPACE"," ",453],["T_CONSTANT_ENCAPSED_STRING","'COUNT(main_table.entity_id)'",453],["T_WHITESPACE","\n        ",453],")",")",["T_WHITESPACE","\n        ",454],["T_OBJECT_OPERATOR","->",455],["T_STRING","where",455],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.state NOT IN (?)'",455],",",["T_WHITESPACE"," ",455],["T_ARRAY","array",455],"(",["T_WHITESPACE","\n            ",455],["T_STRING","Mage_Sales_Model_Order",456],["T_DOUBLE_COLON","::",456],["T_STRING","STATE_PENDING_PAYMENT",456],",",["T_WHITESPACE","\n            ",456],["T_STRING","Mage_Sales_Model_Order",457],["T_DOUBLE_COLON","::",457],["T_STRING","STATE_NEW",457],")",["T_WHITESPACE","\n         ",457],")",";",["T_WHITESPACE","\n\n        ",458],["T_RETURN","return",460],["T_WHITESPACE"," ",460],["T_VARIABLE","$this",460],";",["T_WHITESPACE","\n    ",460],"}",["T_WHITESPACE","\n\n    ",461],["T_DOC_COMMENT","\/**\n     * Calculate totals aggregated report\n     *\n     * @param int $isFilter\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",463],["T_WHITESPACE","\n    ",468],["T_PROTECTED","protected",469],["T_WHITESPACE"," ",469],["T_FUNCTION","function",469],["T_WHITESPACE"," ",469],["T_STRING","_calculateTotalsAggregated",469],"(",["T_VARIABLE","$isFilter",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_LNUMBER","0",469],")",["T_WHITESPACE","\n    ",469],"{",["T_WHITESPACE","\n        ",470],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","setMainTable",471],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_aggregated_created'",471],")",";",["T_WHITESPACE","\n        ",471],["T_VARIABLE","$this",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","removeAllFieldsFromSelect",472],"(",")",";",["T_WHITESPACE","\n\n        ",472],["T_VARIABLE","$this",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getSelect",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","columns",474],"(",["T_ARRAY","array",474],"(",["T_WHITESPACE","\n            ",474],["T_CONSTANT_ENCAPSED_STRING","'revenue'",475],["T_WHITESPACE","  ",475],["T_DOUBLE_ARROW","=>",475],["T_WHITESPACE"," ",475],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.total_revenue_amount)'",475],",",["T_WHITESPACE","\n            ",475],["T_CONSTANT_ENCAPSED_STRING","'tax'",476],["T_WHITESPACE","      ",476],["T_DOUBLE_ARROW","=>",476],["T_WHITESPACE"," ",476],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.total_tax_amount_actual)'",476],",",["T_WHITESPACE","\n            ",476],["T_CONSTANT_ENCAPSED_STRING","'shipping'",477],["T_WHITESPACE"," ",477],["T_DOUBLE_ARROW","=>",477],["T_WHITESPACE"," ",477],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.total_shipping_amount_actual)'",477],",",["T_WHITESPACE","\n            ",477],["T_CONSTANT_ENCAPSED_STRING","'quantity'",478],["T_WHITESPACE"," ",478],["T_DOUBLE_ARROW","=>",478],["T_WHITESPACE"," ",478],["T_CONSTANT_ENCAPSED_STRING","'SUM(orders_count)'",478],",",["T_WHITESPACE","\n        ",478],")",")",";",["T_WHITESPACE","\n\n        ",479],["T_VARIABLE","$statuses",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_STRING","Mage",481],["T_DOUBLE_COLON","::",481],["T_STRING","getSingleton",481],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/config'",481],")",["T_WHITESPACE","\n            ",481],["T_OBJECT_OPERATOR","->",482],["T_STRING","getOrderStatusesForState",482],"(",["T_STRING","Mage_Sales_Model_Order",482],["T_DOUBLE_COLON","::",482],["T_STRING","STATE_CANCELED",482],")",";",["T_WHITESPACE","\n\n        ",482],["T_IF","if",484],["T_WHITESPACE"," ",484],"(",["T_EMPTY","empty",484],"(",["T_VARIABLE","$statuses",484],")",")",["T_WHITESPACE"," ",484],"{",["T_WHITESPACE","\n            ",484],["T_VARIABLE","$statuses",485],["T_WHITESPACE"," ",485],"=",["T_WHITESPACE"," ",485],["T_ARRAY","array",485],"(",["T_LNUMBER","0",485],")",";",["T_WHITESPACE","\n        ",485],"}",["T_WHITESPACE","\n\n        ",486],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getSelect",488],"(",")",["T_OBJECT_OPERATOR","->",488],["T_STRING","where",488],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.order_status NOT IN(?)'",488],",",["T_WHITESPACE"," ",488],["T_VARIABLE","$statuses",488],")",";",["T_WHITESPACE","\n\n        ",488],["T_RETURN","return",490],["T_WHITESPACE"," ",490],["T_VARIABLE","$this",490],";",["T_WHITESPACE","\n    ",490],"}",["T_WHITESPACE","\n\n    ",491],["T_DOC_COMMENT","\/**\n     * Calculate lifitime sales\n     *\n     * @param int $isFilter\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",493],["T_WHITESPACE","\n    ",498],["T_PUBLIC","public",499],["T_WHITESPACE"," ",499],["T_FUNCTION","function",499],["T_WHITESPACE"," ",499],["T_STRING","calculateSales",499],"(",["T_VARIABLE","$isFilter",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_LNUMBER","0",499],")",["T_WHITESPACE","\n    ",499],"{",["T_WHITESPACE","\n        ",500],["T_VARIABLE","$statuses",501],["T_WHITESPACE"," ",501],"=",["T_WHITESPACE"," ",501],["T_STRING","Mage",501],["T_DOUBLE_COLON","::",501],["T_STRING","getSingleton",501],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/config'",501],")",["T_WHITESPACE","\n            ",501],["T_OBJECT_OPERATOR","->",502],["T_STRING","getOrderStatusesForState",502],"(",["T_STRING","Mage_Sales_Model_Order",502],["T_DOUBLE_COLON","::",502],["T_STRING","STATE_CANCELED",502],")",";",["T_WHITESPACE","\n\n        ",502],["T_IF","if",504],["T_WHITESPACE"," ",504],"(",["T_EMPTY","empty",504],"(",["T_VARIABLE","$statuses",504],")",")",["T_WHITESPACE"," ",504],"{",["T_WHITESPACE","\n            ",504],["T_VARIABLE","$statuses",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_ARRAY","array",505],"(",["T_LNUMBER","0",505],")",";",["T_WHITESPACE","\n        ",505],"}",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$adapter",507],["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_VARIABLE","$this",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","getConnection",507],"(",")",";",["T_WHITESPACE","\n\n        ",507],["T_IF","if",509],["T_WHITESPACE"," ",509],"(",["T_STRING","Mage",509],["T_DOUBLE_COLON","::",509],["T_STRING","getStoreConfig",509],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/dashboard\/use_aggregated_data'",509],")",")",["T_WHITESPACE"," ",509],"{",["T_WHITESPACE","\n            ",509],["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","setMainTable",510],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order_aggregated_created'",510],")",";",["T_WHITESPACE","\n            ",510],["T_VARIABLE","$this",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","removeAllFieldsFromSelect",511],"(",")",";",["T_WHITESPACE","\n            ",511],["T_VARIABLE","$averageExpr",512],["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],["T_VARIABLE","$adapter",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getCheckSql",512],"(",["T_WHITESPACE","\n                ",512],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.orders_count) > 0'",513],",",["T_WHITESPACE","\n                ",513],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.total_revenue_amount)\/SUM(main_table.orders_count)'",514],",",["T_WHITESPACE","\n                ",514],["T_LNUMBER","0",515],")",";",["T_WHITESPACE","\n            ",515],["T_VARIABLE","$this",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","getSelect",516],"(",")",["T_OBJECT_OPERATOR","->",516],["T_STRING","columns",516],"(",["T_ARRAY","array",516],"(",["T_WHITESPACE","\n                ",516],["T_CONSTANT_ENCAPSED_STRING","'lifetime'",517],["T_WHITESPACE"," ",517],["T_DOUBLE_ARROW","=>",517],["T_WHITESPACE"," ",517],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.total_revenue_amount)'",517],",",["T_WHITESPACE","\n                ",517],["T_CONSTANT_ENCAPSED_STRING","'average'",518],["T_WHITESPACE","  ",518],["T_DOUBLE_ARROW","=>",518],["T_WHITESPACE"," ",518],["T_VARIABLE","$averageExpr",518],["T_WHITESPACE","\n            ",518],")",")",";",["T_WHITESPACE","\n\n            ",519],["T_IF","if",521],["T_WHITESPACE"," ",521],"(","!",["T_VARIABLE","$isFilter",521],")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n                ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","addFieldToFilter",522],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",522],",",["T_WHITESPACE","\n                    ",522],["T_ARRAY","array",523],"(",["T_CONSTANT_ENCAPSED_STRING","'eq'",523],["T_WHITESPACE"," ",523],["T_DOUBLE_ARROW","=>",523],["T_WHITESPACE"," ",523],["T_STRING","Mage",523],["T_DOUBLE_COLON","::",523],["T_STRING","app",523],"(",")",["T_OBJECT_OPERATOR","->",523],["T_STRING","getStore",523],"(",["T_STRING","Mage_Core_Model_Store",523],["T_DOUBLE_COLON","::",523],["T_STRING","ADMIN_CODE",523],")",["T_OBJECT_OPERATOR","->",523],["T_STRING","getId",523],"(",")",")",["T_WHITESPACE","\n                ",523],")",";",["T_WHITESPACE","\n            ",524],"}",["T_WHITESPACE","\n            ",525],["T_VARIABLE","$this",526],["T_OBJECT_OPERATOR","->",526],["T_STRING","getSelect",526],"(",")",["T_OBJECT_OPERATOR","->",526],["T_STRING","where",526],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.order_status NOT IN(?)'",526],",",["T_WHITESPACE"," ",526],["T_VARIABLE","$statuses",526],")",";",["T_WHITESPACE","\n        ",526],"}",["T_WHITESPACE"," ",527],["T_ELSE","else",527],["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n            ",527],["T_VARIABLE","$this",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","setMainTable",528],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",528],")",";",["T_WHITESPACE","\n            ",528],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","removeAllFieldsFromSelect",529],"(",")",";",["T_WHITESPACE","\n\n            ",529],["T_VARIABLE","$expr",531],["T_WHITESPACE"," ",531],"=",["T_WHITESPACE"," ",531],["T_VARIABLE","$this",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","_getSalesAmountExpression",531],"(",")",";",["T_WHITESPACE","\n\n            ",531],["T_IF","if",533],["T_WHITESPACE"," ",533],"(",["T_VARIABLE","$isFilter",533],["T_WHITESPACE"," ",533],["T_IS_EQUAL","==",533],["T_WHITESPACE"," ",533],["T_LNUMBER","0",533],")",["T_WHITESPACE"," ",533],"{",["T_WHITESPACE","\n                ",533],["T_VARIABLE","$expr",534],["T_WHITESPACE"," ",534],"=",["T_WHITESPACE"," ",534],["T_CONSTANT_ENCAPSED_STRING","'('",534],["T_WHITESPACE"," ",534],".",["T_WHITESPACE"," ",534],["T_VARIABLE","$expr",534],["T_WHITESPACE"," ",534],".",["T_WHITESPACE"," ",534],["T_CONSTANT_ENCAPSED_STRING","') * main_table.base_to_global_rate'",534],";",["T_WHITESPACE","\n            ",534],"}",["T_WHITESPACE","\n\n            ",535],["T_VARIABLE","$this",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","getSelect",537],"(",")",["T_WHITESPACE","\n                ",537],["T_OBJECT_OPERATOR","->",538],["T_STRING","columns",538],"(",["T_ARRAY","array",538],"(",["T_WHITESPACE","\n                    ",538],["T_CONSTANT_ENCAPSED_STRING","'lifetime'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",539],["T_CURLY_OPEN","{",539],["T_VARIABLE","$expr",539],"}",["T_ENCAPSED_AND_WHITESPACE",")",539],"\"",",",["T_WHITESPACE","\n                    ",539],["T_CONSTANT_ENCAPSED_STRING","'average'",540],["T_WHITESPACE","  ",540],["T_DOUBLE_ARROW","=>",540],["T_WHITESPACE"," ",540],"\"",["T_ENCAPSED_AND_WHITESPACE","AVG(",540],["T_CURLY_OPEN","{",540],["T_VARIABLE","$expr",540],"}",["T_ENCAPSED_AND_WHITESPACE",")",540],"\"",["T_WHITESPACE","\n                ",540],")",")",["T_WHITESPACE","\n                ",541],["T_OBJECT_OPERATOR","->",542],["T_STRING","where",542],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.status NOT IN(?)'",542],",",["T_WHITESPACE"," ",542],["T_VARIABLE","$statuses",542],")",["T_WHITESPACE","\n                ",542],["T_OBJECT_OPERATOR","->",543],["T_STRING","where",543],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.state NOT IN(?)'",543],",",["T_WHITESPACE"," ",543],["T_ARRAY","array",543],"(",["T_WHITESPACE","\n                    ",543],["T_STRING","Mage_Sales_Model_Order",544],["T_DOUBLE_COLON","::",544],["T_STRING","STATE_NEW",544],",",["T_WHITESPACE","\n                    ",544],["T_STRING","Mage_Sales_Model_Order",545],["T_DOUBLE_COLON","::",545],["T_STRING","STATE_PENDING_PAYMENT",545],")",["T_WHITESPACE","\n                ",545],")",";",["T_WHITESPACE","\n        ",546],"}",["T_WHITESPACE","\n        ",547],["T_RETURN","return",548],["T_WHITESPACE"," ",548],["T_VARIABLE","$this",548],";",["T_WHITESPACE","\n    ",548],"}",["T_WHITESPACE","\n\n    ",549],["T_DOC_COMMENT","\/**\n     * Set date range\n     *\n     * @param string $from\n     * @param string $to\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",551],["T_WHITESPACE","\n    ",557],["T_PUBLIC","public",558],["T_WHITESPACE"," ",558],["T_FUNCTION","function",558],["T_WHITESPACE"," ",558],["T_STRING","setDateRange",558],"(",["T_VARIABLE","$from",558],",",["T_WHITESPACE"," ",558],["T_VARIABLE","$to",558],")",["T_WHITESPACE","\n    ",558],"{",["T_WHITESPACE","\n        ",559],["T_VARIABLE","$this",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","_reset",560],"(",")",["T_WHITESPACE","\n            ",560],["T_OBJECT_OPERATOR","->",561],["T_STRING","addFieldToFilter",561],"(",["T_CONSTANT_ENCAPSED_STRING","'created_at'",561],",",["T_WHITESPACE"," ",561],["T_ARRAY","array",561],"(",["T_CONSTANT_ENCAPSED_STRING","'from'",561],["T_WHITESPACE"," ",561],["T_DOUBLE_ARROW","=>",561],["T_WHITESPACE"," ",561],["T_VARIABLE","$from",561],",",["T_WHITESPACE"," ",561],["T_CONSTANT_ENCAPSED_STRING","'to'",561],["T_WHITESPACE"," ",561],["T_DOUBLE_ARROW","=>",561],["T_WHITESPACE"," ",561],["T_VARIABLE","$to",561],")",")",["T_WHITESPACE","\n            ",561],["T_OBJECT_OPERATOR","->",562],["T_STRING","addFieldToFilter",562],"(",["T_CONSTANT_ENCAPSED_STRING","'state'",562],",",["T_WHITESPACE"," ",562],["T_ARRAY","array",562],"(",["T_CONSTANT_ENCAPSED_STRING","'neq'",562],["T_WHITESPACE"," ",562],["T_DOUBLE_ARROW","=>",562],["T_WHITESPACE"," ",562],["T_STRING","Mage_Sales_Model_Order",562],["T_DOUBLE_COLON","::",562],["T_STRING","STATE_CANCELED",562],")",")",["T_WHITESPACE","\n            ",562],["T_OBJECT_OPERATOR","->",563],["T_STRING","getSelect",563],"(",")",["T_WHITESPACE","\n                ",563],["T_OBJECT_OPERATOR","->",564],["T_STRING","columns",564],"(",["T_ARRAY","array",564],"(",["T_CONSTANT_ENCAPSED_STRING","'orders'",564],["T_WHITESPACE"," ",564],["T_DOUBLE_ARROW","=>",564],["T_WHITESPACE"," ",564],["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT(main_table.entity_id))'",564],")",")",["T_WHITESPACE","\n                ",564],["T_OBJECT_OPERATOR","->",565],["T_STRING","group",565],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",565],")",";",["T_WHITESPACE","\n\n        ",565],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getSelect",567],"(",")",["T_OBJECT_OPERATOR","->",567],["T_STRING","columns",567],"(",["T_ARRAY","array",567],"(",["T_WHITESPACE","\n            ",567],["T_CONSTANT_ENCAPSED_STRING","'items'",568],["T_WHITESPACE"," ",568],["T_DOUBLE_ARROW","=>",568],["T_WHITESPACE"," ",568],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.total_qty_ordered)'",568],")",["T_WHITESPACE","\n        ",568],")",";",["T_WHITESPACE","\n\n        ",569],["T_RETURN","return",571],["T_WHITESPACE"," ",571],["T_VARIABLE","$this",571],";",["T_WHITESPACE","\n    ",571],"}",["T_WHITESPACE","\n\n    ",572],["T_DOC_COMMENT","\/**\n     * Set store filter collection\n     *\n     * @param array $storeIds\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",574],["T_WHITESPACE","\n    ",579],["T_PUBLIC","public",580],["T_WHITESPACE"," ",580],["T_FUNCTION","function",580],["T_WHITESPACE"," ",580],["T_STRING","setStoreIds",580],"(",["T_VARIABLE","$storeIds",580],")",["T_WHITESPACE","\n    ",580],"{",["T_WHITESPACE","\n        ",581],["T_VARIABLE","$adapter",582],["T_WHITESPACE"," ",582],"=",["T_WHITESPACE"," ",582],["T_VARIABLE","$this",582],["T_OBJECT_OPERATOR","->",582],["T_STRING","getConnection",582],"(",")",";",["T_WHITESPACE","\n        ",582],["T_VARIABLE","$baseSubtotalInvoiced",583],["T_WHITESPACE"," ",583],"=",["T_WHITESPACE"," ",583],["T_VARIABLE","$adapter",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","getIfNullSql",583],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_subtotal_invoiced'",583],",",["T_WHITESPACE"," ",583],["T_LNUMBER","0",583],")",";",["T_WHITESPACE","\n        ",583],["T_VARIABLE","$baseDiscountRefunded",584],["T_WHITESPACE"," ",584],"=",["T_WHITESPACE"," ",584],["T_VARIABLE","$adapter",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","getIfNullSql",584],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_discount_refunded'",584],",",["T_WHITESPACE"," ",584],["T_LNUMBER","0",584],")",";",["T_WHITESPACE","\n        ",584],["T_VARIABLE","$baseSubtotalRefunded",585],["T_WHITESPACE"," ",585],"=",["T_WHITESPACE"," ",585],["T_VARIABLE","$adapter",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","getIfNullSql",585],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_subtotal_refunded'",585],",",["T_WHITESPACE"," ",585],["T_LNUMBER","0",585],")",";",["T_WHITESPACE","\n        ",585],["T_VARIABLE","$baseDiscountInvoiced",586],["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_VARIABLE","$adapter",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","getIfNullSql",586],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_discount_invoiced'",586],",",["T_WHITESPACE"," ",586],["T_LNUMBER","0",586],")",";",["T_WHITESPACE","\n        ",586],["T_VARIABLE","$baseTotalInvocedCost",587],["T_WHITESPACE"," ",587],"=",["T_WHITESPACE"," ",587],["T_VARIABLE","$adapter",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getIfNullSql",587],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_total_invoiced_cost'",587],",",["T_WHITESPACE"," ",587],["T_LNUMBER","0",587],")",";",["T_WHITESPACE","\n        ",587],["T_IF","if",588],["T_WHITESPACE"," ",588],"(",["T_VARIABLE","$storeIds",588],")",["T_WHITESPACE"," ",588],"{",["T_WHITESPACE","\n            ",588],["T_VARIABLE","$this",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","getSelect",589],"(",")",["T_OBJECT_OPERATOR","->",589],["T_STRING","columns",589],"(",["T_ARRAY","array",589],"(",["T_WHITESPACE","\n                ",589],["T_CONSTANT_ENCAPSED_STRING","'subtotal'",590],["T_WHITESPACE","  ",590],["T_DOUBLE_ARROW","=>",590],["T_WHITESPACE"," ",590],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_subtotal)'",590],",",["T_WHITESPACE","\n                ",590],["T_CONSTANT_ENCAPSED_STRING","'tax'",591],["T_WHITESPACE","       ",591],["T_DOUBLE_ARROW","=>",591],["T_WHITESPACE"," ",591],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_tax_amount)'",591],",",["T_WHITESPACE","\n                ",591],["T_CONSTANT_ENCAPSED_STRING","'shipping'",592],["T_WHITESPACE","  ",592],["T_DOUBLE_ARROW","=>",592],["T_WHITESPACE"," ",592],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_shipping_amount)'",592],",",["T_WHITESPACE","\n                ",592],["T_CONSTANT_ENCAPSED_STRING","'discount'",593],["T_WHITESPACE","  ",593],["T_DOUBLE_ARROW","=>",593],["T_WHITESPACE"," ",593],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_discount_amount)'",593],",",["T_WHITESPACE","\n                ",593],["T_CONSTANT_ENCAPSED_STRING","'total'",594],["T_WHITESPACE","     ",594],["T_DOUBLE_ARROW","=>",594],["T_WHITESPACE"," ",594],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_grand_total)'",594],",",["T_WHITESPACE","\n                ",594],["T_CONSTANT_ENCAPSED_STRING","'invoiced'",595],["T_WHITESPACE","  ",595],["T_DOUBLE_ARROW","=>",595],["T_WHITESPACE"," ",595],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_total_paid)'",595],",",["T_WHITESPACE","\n                ",595],["T_CONSTANT_ENCAPSED_STRING","'refunded'",596],["T_WHITESPACE","  ",596],["T_DOUBLE_ARROW","=>",596],["T_WHITESPACE"," ",596],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_total_refunded)'",596],",",["T_WHITESPACE","\n                ",596],["T_CONSTANT_ENCAPSED_STRING","'profit'",597],["T_WHITESPACE","    ",597],["T_DOUBLE_ARROW","=>",597],["T_WHITESPACE"," ",597],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",597],["T_VARIABLE","$baseSubtotalInvoiced",597],["T_ENCAPSED_AND_WHITESPACE",") ",597],"\"",["T_WHITESPACE","\n                                ",597],".",["T_WHITESPACE"," ",598],"\"",["T_ENCAPSED_AND_WHITESPACE","+ SUM(",598],["T_CURLY_OPEN","{",598],["T_VARIABLE","$baseDiscountRefunded",598],"}",["T_ENCAPSED_AND_WHITESPACE",") - SUM(",598],["T_CURLY_OPEN","{",598],["T_VARIABLE","$baseSubtotalRefunded",598],"}",["T_ENCAPSED_AND_WHITESPACE",") ",598],"\"",["T_WHITESPACE","\n                                ",598],".",["T_WHITESPACE"," ",599],"\"",["T_ENCAPSED_AND_WHITESPACE","- SUM(",599],["T_CURLY_OPEN","{",599],["T_VARIABLE","$baseDiscountInvoiced",599],"}",["T_ENCAPSED_AND_WHITESPACE",") - SUM(",599],["T_CURLY_OPEN","{",599],["T_VARIABLE","$baseTotalInvocedCost",599],"}",["T_ENCAPSED_AND_WHITESPACE",")",599],"\"",["T_WHITESPACE","\n            ",599],")",")",";",["T_WHITESPACE","\n        ",600],"}",["T_WHITESPACE"," ",601],["T_ELSE","else",601],["T_WHITESPACE"," ",601],"{",["T_WHITESPACE","\n            ",601],["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","getSelect",602],"(",")",["T_OBJECT_OPERATOR","->",602],["T_STRING","columns",602],"(",["T_ARRAY","array",602],"(",["T_WHITESPACE","\n                ",602],["T_CONSTANT_ENCAPSED_STRING","'subtotal'",603],["T_WHITESPACE","  ",603],["T_DOUBLE_ARROW","=>",603],["T_WHITESPACE"," ",603],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_subtotal * main_table.base_to_global_rate)'",603],",",["T_WHITESPACE","\n                ",603],["T_CONSTANT_ENCAPSED_STRING","'tax'",604],["T_WHITESPACE","       ",604],["T_DOUBLE_ARROW","=>",604],["T_WHITESPACE"," ",604],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_tax_amount * main_table.base_to_global_rate)'",604],",",["T_WHITESPACE","\n                ",604],["T_CONSTANT_ENCAPSED_STRING","'shipping'",605],["T_WHITESPACE","  ",605],["T_DOUBLE_ARROW","=>",605],["T_WHITESPACE"," ",605],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_shipping_amount * main_table.base_to_global_rate)'",605],",",["T_WHITESPACE","\n                ",605],["T_CONSTANT_ENCAPSED_STRING","'discount'",606],["T_WHITESPACE","  ",606],["T_DOUBLE_ARROW","=>",606],["T_WHITESPACE"," ",606],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_discount_amount * main_table.base_to_global_rate)'",606],",",["T_WHITESPACE","\n                ",606],["T_CONSTANT_ENCAPSED_STRING","'total'",607],["T_WHITESPACE","     ",607],["T_DOUBLE_ARROW","=>",607],["T_WHITESPACE"," ",607],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_grand_total * main_table.base_to_global_rate)'",607],",",["T_WHITESPACE","\n                ",607],["T_CONSTANT_ENCAPSED_STRING","'invoiced'",608],["T_WHITESPACE","  ",608],["T_DOUBLE_ARROW","=>",608],["T_WHITESPACE"," ",608],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_total_paid * main_table.base_to_global_rate)'",608],",",["T_WHITESPACE","\n                ",608],["T_CONSTANT_ENCAPSED_STRING","'refunded'",609],["T_WHITESPACE","  ",609],["T_DOUBLE_ARROW","=>",609],["T_WHITESPACE"," ",609],["T_CONSTANT_ENCAPSED_STRING","'SUM(main_table.base_total_refunded * main_table.base_to_global_rate)'",609],",",["T_WHITESPACE","\n                ",609],["T_CONSTANT_ENCAPSED_STRING","'profit'",610],["T_WHITESPACE","    ",610],["T_DOUBLE_ARROW","=>",610],["T_WHITESPACE"," ",610],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",610],["T_CURLY_OPEN","{",610],["T_VARIABLE","$baseSubtotalInvoiced",610],"}",["T_ENCAPSED_AND_WHITESPACE"," *  main_table.base_to_global_rate) ",610],"\"",["T_WHITESPACE","\n                                ",610],".",["T_WHITESPACE"," ",611],"\"",["T_ENCAPSED_AND_WHITESPACE","+ SUM(",611],["T_CURLY_OPEN","{",611],["T_VARIABLE","$baseDiscountRefunded",611],"}",["T_ENCAPSED_AND_WHITESPACE"," * main_table.base_to_global_rate) ",611],"\"",["T_WHITESPACE","\n                                ",611],".",["T_WHITESPACE"," ",612],"\"",["T_ENCAPSED_AND_WHITESPACE","- SUM(",612],["T_CURLY_OPEN","{",612],["T_VARIABLE","$baseSubtotalRefunded",612],"}",["T_ENCAPSED_AND_WHITESPACE"," * main_table.base_to_global_rate) ",612],"\"",["T_WHITESPACE","\n                                ",612],".",["T_WHITESPACE"," ",613],"\"",["T_ENCAPSED_AND_WHITESPACE","- SUM(",613],["T_CURLY_OPEN","{",613],["T_VARIABLE","$baseDiscountInvoiced",613],"}",["T_ENCAPSED_AND_WHITESPACE"," * main_table.base_to_global_rate) ",613],"\"",["T_WHITESPACE","\n                                ",613],".",["T_WHITESPACE"," ",614],"\"",["T_ENCAPSED_AND_WHITESPACE","- SUM(",614],["T_CURLY_OPEN","{",614],["T_VARIABLE","$baseTotalInvocedCost",614],"}",["T_ENCAPSED_AND_WHITESPACE"," * main_table.base_to_global_rate)",614],"\"",["T_WHITESPACE","\n            ",614],")",")",";",["T_WHITESPACE","\n        ",615],"}",["T_WHITESPACE","\n\n        ",616],["T_RETURN","return",618],["T_WHITESPACE"," ",618],["T_VARIABLE","$this",618],";",["T_WHITESPACE","\n    ",618],"}",["T_WHITESPACE","\n\n    ",619],["T_DOC_COMMENT","\/**\n     * Add group By customer attribute\n     *\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",621],["T_WHITESPACE","\n    ",625],["T_PUBLIC","public",626],["T_WHITESPACE"," ",626],["T_FUNCTION","function",626],["T_WHITESPACE"," ",626],["T_STRING","groupByCustomer",626],"(",")",["T_WHITESPACE","\n    ",626],"{",["T_WHITESPACE","\n        ",627],["T_VARIABLE","$this",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","getSelect",628],"(",")",["T_WHITESPACE","\n            ",628],["T_OBJECT_OPERATOR","->",629],["T_STRING","where",629],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.customer_id IS NOT NULL'",629],")",["T_WHITESPACE","\n            ",629],["T_OBJECT_OPERATOR","->",630],["T_STRING","group",630],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.customer_id'",630],")",";",["T_WHITESPACE","\n\n        ",630],["T_COMMENT","\/*\n         * Allow Analytic functions usage\n         *\/",632],["T_WHITESPACE","\n        ",634],["T_VARIABLE","$this",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","_useAnalyticFunction",635],["T_WHITESPACE"," ",635],"=",["T_WHITESPACE"," ",635],["T_STRING","true",635],";",["T_WHITESPACE","\n\n        ",635],["T_RETURN","return",637],["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],";",["T_WHITESPACE","\n    ",637],"}",["T_WHITESPACE","\n\n    ",638],["T_DOC_COMMENT","\/**\n     * Join Customer Name (concat)\n     *\n     * @param string $alias\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",640],["T_WHITESPACE","\n    ",645],["T_PUBLIC","public",646],["T_WHITESPACE"," ",646],["T_FUNCTION","function",646],["T_WHITESPACE"," ",646],["T_STRING","joinCustomerName",646],"(",["T_VARIABLE","$alias",646],["T_WHITESPACE"," ",646],"=",["T_WHITESPACE"," ",646],["T_CONSTANT_ENCAPSED_STRING","'name'",646],")",["T_WHITESPACE","\n    ",646],"{",["T_WHITESPACE","\n        ",647],["T_VARIABLE","$fields",648],["T_WHITESPACE","  ",648],"=",["T_WHITESPACE"," ",648],["T_ARRAY","array",648],"(",["T_WHITESPACE","\n            ",648],["T_CONSTANT_ENCAPSED_STRING","'main_table.customer_firstname'",649],",",["T_WHITESPACE","\n            ",649],["T_CONSTANT_ENCAPSED_STRING","'main_table.customer_middlename'",650],",",["T_WHITESPACE","\n            ",650],["T_CONSTANT_ENCAPSED_STRING","'main_table.customer_lastname'",651],["T_WHITESPACE","\n        ",651],")",";",["T_WHITESPACE","\n        ",652],["T_VARIABLE","$fieldConcat",653],["T_WHITESPACE"," ",653],"=",["T_WHITESPACE"," ",653],["T_VARIABLE","$this",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","getConnection",653],"(",")",["T_OBJECT_OPERATOR","->",653],["T_STRING","getConcatSql",653],"(",["T_VARIABLE","$fields",653],",",["T_WHITESPACE"," ",653],["T_CONSTANT_ENCAPSED_STRING","' '",653],")",";",["T_WHITESPACE","\n        ",653],["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","getSelect",654],"(",")",["T_OBJECT_OPERATOR","->",654],["T_STRING","columns",654],"(",["T_ARRAY","array",654],"(",["T_VARIABLE","$alias",654],["T_WHITESPACE"," ",654],["T_DOUBLE_ARROW","=>",654],["T_WHITESPACE"," ",654],["T_VARIABLE","$fieldConcat",654],")",")",";",["T_WHITESPACE","\n        ",654],["T_RETURN","return",655],["T_WHITESPACE"," ",655],["T_VARIABLE","$this",655],";",["T_WHITESPACE","\n    ",655],"}",["T_WHITESPACE","\n\n    ",656],["T_DOC_COMMENT","\/**\n     * Add Order count field to select\n     *\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",658],["T_WHITESPACE","\n    ",662],["T_PUBLIC","public",663],["T_WHITESPACE"," ",663],["T_FUNCTION","function",663],["T_WHITESPACE"," ",663],["T_STRING","addOrdersCount",663],"(",")",["T_WHITESPACE","\n    ",663],"{",["T_WHITESPACE","\n        ",664],["T_VARIABLE","$this",665],["T_OBJECT_OPERATOR","->",665],["T_STRING","addFieldToFilter",665],"(",["T_CONSTANT_ENCAPSED_STRING","'state'",665],",",["T_WHITESPACE"," ",665],["T_ARRAY","array",665],"(",["T_CONSTANT_ENCAPSED_STRING","'neq'",665],["T_WHITESPACE"," ",665],["T_DOUBLE_ARROW","=>",665],["T_WHITESPACE"," ",665],["T_STRING","Mage_Sales_Model_Order",665],["T_DOUBLE_COLON","::",665],["T_STRING","STATE_CANCELED",665],")",")",";",["T_WHITESPACE","\n        ",665],["T_VARIABLE","$this",666],["T_OBJECT_OPERATOR","->",666],["T_STRING","getSelect",666],"(",")",["T_WHITESPACE","\n            ",666],["T_OBJECT_OPERATOR","->",667],["T_STRING","columns",667],"(",["T_ARRAY","array",667],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_count'",667],["T_WHITESPACE"," ",667],["T_DOUBLE_ARROW","=>",667],["T_WHITESPACE"," ",667],["T_CONSTANT_ENCAPSED_STRING","'COUNT(main_table.entity_id)'",667],")",")",";",["T_WHITESPACE","\n\n        ",667],["T_RETURN","return",669],["T_WHITESPACE"," ",669],["T_VARIABLE","$this",669],";",["T_WHITESPACE","\n    ",669],"}",["T_WHITESPACE","\n\n    ",670],["T_DOC_COMMENT","\/**\n     * Add revenue\n     *\n     * @param boolean $convertCurrency\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",672],["T_WHITESPACE","\n    ",677],["T_PUBLIC","public",678],["T_WHITESPACE"," ",678],["T_FUNCTION","function",678],["T_WHITESPACE"," ",678],["T_STRING","addRevenueToSelect",678],"(",["T_VARIABLE","$convertCurrency",678],["T_WHITESPACE"," ",678],"=",["T_WHITESPACE"," ",678],["T_STRING","false",678],")",["T_WHITESPACE","\n    ",678],"{",["T_WHITESPACE","\n        ",679],["T_IF","if",680],["T_WHITESPACE"," ",680],"(",["T_VARIABLE","$convertCurrency",680],")",["T_WHITESPACE"," ",680],"{",["T_WHITESPACE","\n            ",680],["T_VARIABLE","$this",681],["T_OBJECT_OPERATOR","->",681],["T_STRING","getSelect",681],"(",")",["T_OBJECT_OPERATOR","->",681],["T_STRING","columns",681],"(",["T_ARRAY","array",681],"(",["T_WHITESPACE","\n                ",681],["T_CONSTANT_ENCAPSED_STRING","'revenue'",682],["T_WHITESPACE"," ",682],["T_DOUBLE_ARROW","=>",682],["T_WHITESPACE"," ",682],["T_CONSTANT_ENCAPSED_STRING","'(main_table.base_grand_total * main_table.base_to_global_rate)'",682],["T_WHITESPACE","\n            ",682],")",")",";",["T_WHITESPACE","\n        ",683],"}",["T_WHITESPACE"," ",684],["T_ELSE","else",684],["T_WHITESPACE"," ",684],"{",["T_WHITESPACE","\n            ",684],["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","getSelect",685],"(",")",["T_OBJECT_OPERATOR","->",685],["T_STRING","columns",685],"(",["T_ARRAY","array",685],"(",["T_WHITESPACE","\n                ",685],["T_CONSTANT_ENCAPSED_STRING","'revenue'",686],["T_WHITESPACE"," ",686],["T_DOUBLE_ARROW","=>",686],["T_WHITESPACE"," ",686],["T_CONSTANT_ENCAPSED_STRING","'base_grand_total'",686],["T_WHITESPACE","\n            ",686],")",")",";",["T_WHITESPACE","\n        ",687],"}",["T_WHITESPACE","\n\n        ",688],["T_RETURN","return",690],["T_WHITESPACE"," ",690],["T_VARIABLE","$this",690],";",["T_WHITESPACE","\n    ",690],"}",["T_WHITESPACE","\n\n    ",691],["T_DOC_COMMENT","\/**\n     * Add summary average totals\n     *\n     * @param int $storeId\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",693],["T_WHITESPACE","\n    ",698],["T_PUBLIC","public",699],["T_WHITESPACE"," ",699],["T_FUNCTION","function",699],["T_WHITESPACE"," ",699],["T_STRING","addSumAvgTotals",699],"(",["T_VARIABLE","$storeId",699],["T_WHITESPACE"," ",699],"=",["T_WHITESPACE"," ",699],["T_LNUMBER","0",699],")",["T_WHITESPACE","\n    ",699],"{",["T_WHITESPACE","\n        ",700],["T_VARIABLE","$adapter",701],["T_WHITESPACE"," ",701],"=",["T_WHITESPACE"," ",701],["T_VARIABLE","$this",701],["T_OBJECT_OPERATOR","->",701],["T_STRING","getConnection",701],"(",")",";",["T_WHITESPACE","\n        ",701],["T_VARIABLE","$baseSubtotalRefunded",702],["T_WHITESPACE"," ",702],"=",["T_WHITESPACE"," ",702],["T_VARIABLE","$adapter",702],["T_OBJECT_OPERATOR","->",702],["T_STRING","getIfNullSql",702],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_subtotal_refunded'",702],",",["T_WHITESPACE"," ",702],["T_LNUMBER","0",702],")",";",["T_WHITESPACE","\n        ",702],["T_VARIABLE","$baseSubtotalCanceled",703],["T_WHITESPACE"," ",703],"=",["T_WHITESPACE"," ",703],["T_VARIABLE","$adapter",703],["T_OBJECT_OPERATOR","->",703],["T_STRING","getIfNullSql",703],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_subtotal_canceled'",703],",",["T_WHITESPACE"," ",703],["T_LNUMBER","0",703],")",";",["T_WHITESPACE","\n        ",703],["T_VARIABLE","$baseDiscountCanceled",704],["T_WHITESPACE"," ",704],"=",["T_WHITESPACE"," ",704],["T_VARIABLE","$adapter",704],["T_OBJECT_OPERATOR","->",704],["T_STRING","getIfNullSql",704],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.base_discount_canceled'",704],",",["T_WHITESPACE"," ",704],["T_LNUMBER","0",704],")",";",["T_WHITESPACE","\n\n        ",704],["T_DOC_COMMENT","\/**\n         * calculate average and total amount\n         *\/",706],["T_WHITESPACE","\n        ",708],["T_VARIABLE","$expr",709],["T_WHITESPACE"," ",709],"=",["T_WHITESPACE"," ",709],"(",["T_VARIABLE","$storeId",709],["T_WHITESPACE"," ",709],["T_IS_EQUAL","==",709],["T_WHITESPACE"," ",709],["T_LNUMBER","0",709],")",["T_WHITESPACE","\n            ",709],"?",["T_WHITESPACE"," ",710],"\"",["T_ENCAPSED_AND_WHITESPACE","(main_table.base_subtotal -\n            ",710],["T_CURLY_OPEN","{",711],["T_VARIABLE","$baseSubtotalRefunded",711],"}",["T_ENCAPSED_AND_WHITESPACE"," - ",711],["T_CURLY_OPEN","{",711],["T_VARIABLE","$baseSubtotalCanceled",711],"}",["T_ENCAPSED_AND_WHITESPACE"," - ABS(main_table.base_discount_amount) -\n            ",711],["T_CURLY_OPEN","{",712],["T_VARIABLE","$baseDiscountCanceled",712],"}",["T_ENCAPSED_AND_WHITESPACE",") * main_table.base_to_global_rate",712],"\"",["T_WHITESPACE","\n            ",712],":",["T_WHITESPACE"," ",713],"\"",["T_ENCAPSED_AND_WHITESPACE","main_table.base_subtotal - ",713],["T_CURLY_OPEN","{",713],["T_VARIABLE","$baseSubtotalCanceled",713],"}",["T_ENCAPSED_AND_WHITESPACE"," - ",713],["T_CURLY_OPEN","{",713],["T_VARIABLE","$baseSubtotalRefunded",713],"}",["T_ENCAPSED_AND_WHITESPACE"," -\n            ABS(main_table.base_discount_amount) - ",713],["T_CURLY_OPEN","{",714],["T_VARIABLE","$baseDiscountCanceled",714],"}","\"",";",["T_WHITESPACE","\n\n        ",714],["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","getSelect",716],"(",")",["T_WHITESPACE","\n            ",716],["T_OBJECT_OPERATOR","->",717],["T_STRING","columns",717],"(",["T_ARRAY","array",717],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_avg_amount'",717],["T_WHITESPACE"," ",717],["T_DOUBLE_ARROW","=>",717],["T_WHITESPACE"," ",717],"\"",["T_ENCAPSED_AND_WHITESPACE","AVG(",717],["T_CURLY_OPEN","{",717],["T_VARIABLE","$expr",717],"}",["T_ENCAPSED_AND_WHITESPACE",")",717],"\"",")",")",["T_WHITESPACE","\n            ",717],["T_OBJECT_OPERATOR","->",718],["T_STRING","columns",718],"(",["T_ARRAY","array",718],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_sum_amount'",718],["T_WHITESPACE"," ",718],["T_DOUBLE_ARROW","=>",718],["T_WHITESPACE"," ",718],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",718],["T_CURLY_OPEN","{",718],["T_VARIABLE","$expr",718],"}",["T_ENCAPSED_AND_WHITESPACE",")",718],"\"",")",")",";",["T_WHITESPACE","\n\n        ",718],["T_RETURN","return",720],["T_WHITESPACE"," ",720],["T_VARIABLE","$this",720],";",["T_WHITESPACE","\n    ",720],"}",["T_WHITESPACE","\n\n    ",721],["T_DOC_COMMENT","\/**\n     * Sort order by total amount\n     *\n     * @param string $dir\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",723],["T_WHITESPACE","\n    ",728],["T_PUBLIC","public",729],["T_WHITESPACE"," ",729],["T_FUNCTION","function",729],["T_WHITESPACE"," ",729],["T_STRING","orderByTotalAmount",729],"(",["T_VARIABLE","$dir",729],["T_WHITESPACE"," ",729],"=",["T_WHITESPACE"," ",729],["T_STRING","self",729],["T_DOUBLE_COLON","::",729],["T_STRING","SORT_ORDER_DESC",729],")",["T_WHITESPACE","\n    ",729],"{",["T_WHITESPACE","\n        ",730],["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getSelect",731],"(",")",["T_OBJECT_OPERATOR","->",731],["T_STRING","order",731],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_sum_amount '",731],["T_WHITESPACE"," ",731],".",["T_WHITESPACE"," ",731],["T_VARIABLE","$dir",731],")",";",["T_WHITESPACE","\n        ",731],["T_RETURN","return",732],["T_WHITESPACE"," ",732],["T_VARIABLE","$this",732],";",["T_WHITESPACE","\n    ",732],"}",["T_WHITESPACE","\n\n    ",733],["T_DOC_COMMENT","\/**\n     * Order by orders count\n     *\n     * @param unknown_type $dir\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",735],["T_WHITESPACE","\n    ",740],["T_PUBLIC","public",741],["T_WHITESPACE"," ",741],["T_FUNCTION","function",741],["T_WHITESPACE"," ",741],["T_STRING","orderByOrdersCount",741],"(",["T_VARIABLE","$dir",741],["T_WHITESPACE"," ",741],"=",["T_WHITESPACE"," ",741],["T_STRING","self",741],["T_DOUBLE_COLON","::",741],["T_STRING","SORT_ORDER_DESC",741],")",["T_WHITESPACE","\n    ",741],"{",["T_WHITESPACE","\n        ",742],["T_VARIABLE","$this",743],["T_OBJECT_OPERATOR","->",743],["T_STRING","getSelect",743],"(",")",["T_OBJECT_OPERATOR","->",743],["T_STRING","order",743],"(",["T_CONSTANT_ENCAPSED_STRING","'orders_count '",743],["T_WHITESPACE"," ",743],".",["T_WHITESPACE"," ",743],["T_VARIABLE","$dir",743],")",";",["T_WHITESPACE","\n        ",743],["T_RETURN","return",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$this",744],";",["T_WHITESPACE","\n    ",744],"}",["T_WHITESPACE","\n\n    ",745],["T_DOC_COMMENT","\/**\n     * Order by customer registration\n     *\n     * @param unknown_type $dir\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",747],["T_WHITESPACE","\n    ",752],["T_PUBLIC","public",753],["T_WHITESPACE"," ",753],["T_FUNCTION","function",753],["T_WHITESPACE"," ",753],["T_STRING","orderByCustomerRegistration",753],"(",["T_VARIABLE","$dir",753],["T_WHITESPACE"," ",753],"=",["T_WHITESPACE"," ",753],["T_STRING","self",753],["T_DOUBLE_COLON","::",753],["T_STRING","SORT_ORDER_DESC",753],")",["T_WHITESPACE","\n    ",753],"{",["T_WHITESPACE","\n        ",754],["T_VARIABLE","$this",755],["T_OBJECT_OPERATOR","->",755],["T_STRING","setOrder",755],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",755],",",["T_WHITESPACE"," ",755],["T_VARIABLE","$dir",755],")",";",["T_WHITESPACE","\n        ",755],["T_RETURN","return",756],["T_WHITESPACE"," ",756],["T_VARIABLE","$this",756],";",["T_WHITESPACE","\n    ",756],"}",["T_WHITESPACE","\n\n    ",757],["T_DOC_COMMENT","\/**\n     * Sort order by order created_at date\n     *\n     * @param string $dir\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",759],["T_WHITESPACE","\n    ",764],["T_PUBLIC","public",765],["T_WHITESPACE"," ",765],["T_FUNCTION","function",765],["T_WHITESPACE"," ",765],["T_STRING","orderByCreatedAt",765],"(",["T_VARIABLE","$dir",765],["T_WHITESPACE"," ",765],"=",["T_WHITESPACE"," ",765],["T_STRING","self",765],["T_DOUBLE_COLON","::",765],["T_STRING","SORT_ORDER_DESC",765],")",["T_WHITESPACE","\n    ",765],"{",["T_WHITESPACE","\n        ",766],["T_VARIABLE","$this",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","setOrder",767],"(",["T_CONSTANT_ENCAPSED_STRING","'created_at'",767],",",["T_WHITESPACE"," ",767],["T_VARIABLE","$dir",767],")",";",["T_WHITESPACE","\n        ",767],["T_RETURN","return",768],["T_WHITESPACE"," ",768],["T_VARIABLE","$this",768],";",["T_WHITESPACE","\n    ",768],"}",["T_WHITESPACE","\n\n    ",769],["T_DOC_COMMENT","\/**\n     * Get select count sql\n     *\n     * @return unknown\n     *\/",771],["T_WHITESPACE","\n    ",775],["T_PUBLIC","public",776],["T_WHITESPACE"," ",776],["T_FUNCTION","function",776],["T_WHITESPACE"," ",776],["T_STRING","getSelectCountSql",776],"(",")",["T_WHITESPACE","\n    ",776],"{",["T_WHITESPACE","\n        ",777],["T_VARIABLE","$countSelect",778],["T_WHITESPACE"," ",778],"=",["T_WHITESPACE"," ",778],["T_CLONE","clone",778],["T_WHITESPACE"," ",778],["T_VARIABLE","$this",778],["T_OBJECT_OPERATOR","->",778],["T_STRING","getSelect",778],"(",")",";",["T_WHITESPACE","\n        ",778],["T_VARIABLE","$countSelect",779],["T_OBJECT_OPERATOR","->",779],["T_STRING","reset",779],"(",["T_STRING","Zend_Db_Select",779],["T_DOUBLE_COLON","::",779],["T_STRING","ORDER",779],")",";",["T_WHITESPACE","\n        ",779],["T_VARIABLE","$countSelect",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","reset",780],"(",["T_STRING","Zend_Db_Select",780],["T_DOUBLE_COLON","::",780],["T_STRING","LIMIT_COUNT",780],")",";",["T_WHITESPACE","\n        ",780],["T_VARIABLE","$countSelect",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","reset",781],"(",["T_STRING","Zend_Db_Select",781],["T_DOUBLE_COLON","::",781],["T_STRING","LIMIT_OFFSET",781],")",";",["T_WHITESPACE","\n        ",781],["T_VARIABLE","$countSelect",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","reset",782],"(",["T_STRING","Zend_Db_Select",782],["T_DOUBLE_COLON","::",782],["T_STRING","COLUMNS",782],")",";",["T_WHITESPACE","\n        ",782],["T_VARIABLE","$countSelect",783],["T_OBJECT_OPERATOR","->",783],["T_STRING","reset",783],"(",["T_STRING","Zend_Db_Select",783],["T_DOUBLE_COLON","::",783],["T_STRING","GROUP",783],")",";",["T_WHITESPACE","\n        ",783],["T_VARIABLE","$countSelect",784],["T_OBJECT_OPERATOR","->",784],["T_STRING","reset",784],"(",["T_STRING","Zend_Db_Select",784],["T_DOUBLE_COLON","::",784],["T_STRING","HAVING",784],")",";",["T_WHITESPACE","\n        ",784],["T_VARIABLE","$countSelect",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","columns",785],"(",["T_CONSTANT_ENCAPSED_STRING","\"COUNT(DISTINCT main_table.entity_id)\"",785],")",";",["T_WHITESPACE","\n\n        ",785],["T_RETURN","return",787],["T_WHITESPACE"," ",787],["T_VARIABLE","$countSelect",787],";",["T_WHITESPACE","\n    ",787],"}",["T_WHITESPACE","\n\n    ",788],["T_DOC_COMMENT","\/**\n     * Initialize initial fields to select\n     *\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",790],["T_WHITESPACE","\n    ",794],["T_PROTECTED","protected",795],["T_WHITESPACE"," ",795],["T_FUNCTION","function",795],["T_WHITESPACE"," ",795],["T_STRING","_initInitialFieldsToSelect",795],"(",")",["T_WHITESPACE","\n    ",795],"{",["T_WHITESPACE","\n        ",796],["T_COMMENT","\/\/ No fields should be initialized\n",797],["T_WHITESPACE","        ",798],["T_RETURN","return",798],["T_WHITESPACE"," ",798],["T_VARIABLE","$this",798],";",["T_WHITESPACE","\n    ",798],"}",["T_WHITESPACE","\n\n    ",799],["T_DOC_COMMENT","\/**\n     * Add period filter by created_at attribute\n     *\n     * @param string $period\n     * @return Mage_Reports_Model_Resource_Order_Collection\n     *\/",801],["T_WHITESPACE","\n    ",806],["T_PUBLIC","public",807],["T_WHITESPACE"," ",807],["T_FUNCTION","function",807],["T_WHITESPACE"," ",807],["T_STRING","addCreateAtPeriodFilter",807],"(",["T_VARIABLE","$period",807],")",["T_WHITESPACE","\n    ",807],"{",["T_WHITESPACE","\n        ",808],["T_LIST","list",809],"(",["T_VARIABLE","$from",809],",",["T_WHITESPACE"," ",809],["T_VARIABLE","$to",809],")",["T_WHITESPACE"," ",809],"=",["T_WHITESPACE"," ",809],["T_VARIABLE","$this",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getDateRange",809],"(",["T_VARIABLE","$period",809],",",["T_WHITESPACE"," ",809],["T_LNUMBER","0",809],",",["T_WHITESPACE"," ",809],["T_LNUMBER","0",809],",",["T_WHITESPACE"," ",809],["T_STRING","true",809],")",";",["T_WHITESPACE","\n\n        ",809],["T_VARIABLE","$this",811],["T_OBJECT_OPERATOR","->",811],["T_STRING","checkIsLive",811],"(",["T_VARIABLE","$period",811],")",";",["T_WHITESPACE","\n\n        ",811],["T_IF","if",813],["T_WHITESPACE"," ",813],"(",["T_VARIABLE","$this",813],["T_OBJECT_OPERATOR","->",813],["T_STRING","isLive",813],"(",")",")",["T_WHITESPACE"," ",813],"{",["T_WHITESPACE","\n            ",813],["T_VARIABLE","$fieldToFilter",814],["T_WHITESPACE"," ",814],"=",["T_WHITESPACE"," ",814],["T_CONSTANT_ENCAPSED_STRING","'created_at'",814],";",["T_WHITESPACE","\n        ",814],"}",["T_WHITESPACE"," ",815],["T_ELSE","else",815],["T_WHITESPACE"," ",815],"{",["T_WHITESPACE","\n            ",815],["T_VARIABLE","$fieldToFilter",816],["T_WHITESPACE"," ",816],"=",["T_WHITESPACE"," ",816],["T_CONSTANT_ENCAPSED_STRING","'period'",816],";",["T_WHITESPACE","\n        ",816],"}",["T_WHITESPACE","\n\n        ",817],["T_VARIABLE","$this",819],["T_OBJECT_OPERATOR","->",819],["T_STRING","addFieldToFilter",819],"(",["T_VARIABLE","$fieldToFilter",819],",",["T_WHITESPACE"," ",819],["T_ARRAY","array",819],"(",["T_WHITESPACE","\n            ",819],["T_CONSTANT_ENCAPSED_STRING","'from'",820],["T_WHITESPACE","  ",820],["T_DOUBLE_ARROW","=>",820],["T_WHITESPACE"," ",820],["T_VARIABLE","$from",820],["T_OBJECT_OPERATOR","->",820],["T_STRING","toString",820],"(",["T_STRING","Varien_Date",820],["T_DOUBLE_COLON","::",820],["T_STRING","DATETIME_INTERNAL_FORMAT",820],")",",",["T_WHITESPACE","\n            ",820],["T_CONSTANT_ENCAPSED_STRING","'to'",821],["T_WHITESPACE","    ",821],["T_DOUBLE_ARROW","=>",821],["T_WHITESPACE"," ",821],["T_VARIABLE","$to",821],["T_OBJECT_OPERATOR","->",821],["T_STRING","toString",821],"(",["T_STRING","Varien_Date",821],["T_DOUBLE_COLON","::",821],["T_STRING","DATETIME_INTERNAL_FORMAT",821],")",["T_WHITESPACE","\n        ",821],")",")",";",["T_WHITESPACE","\n\n        ",822],["T_RETURN","return",824],["T_WHITESPACE"," ",824],["T_VARIABLE","$this",824],";",["T_WHITESPACE","\n    ",824],"}",["T_WHITESPACE","\n",825],"}",["T_WHITESPACE","\n",826]]