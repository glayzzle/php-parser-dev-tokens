[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Reports\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Customers Report collection\n *\n * @category    Mage\n * @package     Mage_Reports\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Reports_Model_Resource_Customer_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Customer_Model_Resource_Customer_Collection",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Add order statistics flag\n     *\n     * @var boolean\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_addOrderStatistics",42],["T_WHITESPACE","           ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","false",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Add order statistics is filter flag\n     *\n     * @var boolean\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_addOrderStatisticsIsFilter",49],["T_WHITESPACE","   ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","false",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Customer id table name\n     *\n     * @var string\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_customerIdTableName",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Customer id field name\n     *\n     * @var string\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_customerIdFieldName",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Order entity table name\n     *\n     * @var string\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_orderEntityTableName",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Order entity field name\n     *\n     * @var string\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$_orderEntityFieldName",77],";",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Add cart info to collection\n     *\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PUBLIC","public",84],["T_WHITESPACE"," ",84],["T_FUNCTION","function",84],["T_WHITESPACE"," ",84],["T_STRING","addCartInfo",84],"(",")",["T_WHITESPACE","\n    ",84],"{",["T_WHITESPACE","\n        ",85],["T_FOREACH","foreach",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getItems",86],"(",")",["T_WHITESPACE"," ",86],["T_AS","as",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$item",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$quote",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","Mage",87],["T_DOUBLE_COLON","::",87],["T_STRING","getModel",87],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote'",87],")",["T_OBJECT_OPERATOR","->",87],["T_STRING","loadByCustomer",87],"(",["T_VARIABLE","$item",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getId",87],"(",")",")",";",["T_WHITESPACE","\n\n            ",87],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$quote",89],["T_WHITESPACE"," ",89],["T_INSTANCEOF","instanceof",89],["T_WHITESPACE"," ",89],["T_STRING","Mage_Sales_Model_Quote",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n                ",89],["T_VARIABLE","$totals",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$quote",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getTotals",90],"(",")",";",["T_WHITESPACE","\n                ",90],["T_VARIABLE","$item",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","setTotal",91],"(",["T_VARIABLE","$totals",91],"[",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",91],"]",["T_OBJECT_OPERATOR","->",91],["T_STRING","getValue",91],"(",")",")",";",["T_WHITESPACE","\n                ",91],["T_VARIABLE","$quoteItems",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","Mage",92],["T_DOUBLE_COLON","::",92],["T_STRING","getResourceModel",92],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/quote_item_collection'",92],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","setQuoteFilter",92],"(",["T_VARIABLE","$quote",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getId",92],"(",")",")",";",["T_WHITESPACE","\n                ",92],["T_VARIABLE","$quoteItems",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","load",93],"(",")",";",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$item",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","setItems",94],"(",["T_VARIABLE","$quoteItems",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","count",94],"(",")",")",";",["T_WHITESPACE","\n            ",94],"}",["T_WHITESPACE"," ",95],["T_ELSE","else",95],["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n                ",95],["T_VARIABLE","$item",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","remove",96],"(",")",";",["T_WHITESPACE","\n            ",96],"}",["T_WHITESPACE","\n\n        ",97],"}",["T_WHITESPACE","\n        ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],";",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Add customer name to results\n     *\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",103],["T_WHITESPACE","\n    ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","addCustomerName",108],"(",")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","addNameToSelect",110],"(",")",";",["T_WHITESPACE","\n        ",110],["T_RETURN","return",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$this",111],";",["T_WHITESPACE","\n    ",111],"}",["T_WHITESPACE","\n\n    ",112],["T_DOC_COMMENT","\/**\n     * Order for each customer\n     *\n     * @param string $from\n     * @param string $to\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",114],["T_WHITESPACE","\n    ",120],["T_PUBLIC","public",121],["T_WHITESPACE"," ",121],["T_FUNCTION","function",121],["T_WHITESPACE"," ",121],["T_STRING","joinOrders",121],"(",["T_VARIABLE","$from",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","''",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$to",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","''",121],")",["T_WHITESPACE","\n    ",121],"{",["T_WHITESPACE","\n        ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$from",123],["T_WHITESPACE"," ",123],["T_IS_NOT_EQUAL","!=",123],["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","''",123],["T_WHITESPACE"," ",123],["T_BOOLEAN_AND","&&",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$to",123],["T_WHITESPACE"," ",123],["T_IS_NOT_EQUAL","!=",123],["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","''",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$dateFilter",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],"\"",["T_ENCAPSED_AND_WHITESPACE"," AND orders.created_at BETWEEN '",124],["T_CURLY_OPEN","{",124],["T_VARIABLE","$from",124],"}",["T_ENCAPSED_AND_WHITESPACE","' AND '",124],["T_CURLY_OPEN","{",124],["T_VARIABLE","$to",124],"}",["T_ENCAPSED_AND_WHITESPACE","'",124],"\"",";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE"," ",125],["T_ELSE","else",125],["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$dateFilter",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","''",126],";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getSelect",129],"(",")",["T_WHITESPACE","\n            ",129],["T_OBJECT_OPERATOR","->",130],["T_STRING","joinLeft",130],"(",["T_ARRAY","array",130],"(",["T_CONSTANT_ENCAPSED_STRING","'orders'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getTable",130],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",130],")",")",",",["T_WHITESPACE","\n                ",130],["T_CONSTANT_ENCAPSED_STRING","\"orders.customer_id = e.entity_id\"",131],".",["T_VARIABLE","$dateFilter",131],",",["T_WHITESPACE","\n            ",131],["T_ARRAY","array",132],"(",")",")",";",["T_WHITESPACE","\n\n        ",132],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Add orders count\n     *\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",137],["T_WHITESPACE","\n    ",141],["T_PUBLIC","public",142],["T_WHITESPACE"," ",142],["T_FUNCTION","function",142],["T_WHITESPACE"," ",142],["T_STRING","addOrdersCount",142],"(",")",["T_WHITESPACE","\n    ",142],"{",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getSelect",144],"(",")",["T_WHITESPACE","\n            ",144],["T_OBJECT_OPERATOR","->",145],["T_STRING","columns",145],"(",["T_ARRAY","array",145],"(",["T_CONSTANT_ENCAPSED_STRING","\"orders_count\"",145],["T_WHITESPACE"," ",145],["T_DOUBLE_ARROW","=>",145],["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","\"COUNT(orders.entity_id)\"",145],")",")",["T_WHITESPACE","\n            ",145],["T_OBJECT_OPERATOR","->",146],["T_STRING","where",146],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.state <> ?'",146],",",["T_WHITESPACE"," ",146],["T_STRING","Mage_Sales_Model_Order",146],["T_DOUBLE_COLON","::",146],["T_STRING","STATE_CANCELED",146],")",["T_WHITESPACE","\n            ",146],["T_OBJECT_OPERATOR","->",147],["T_STRING","group",147],"(",["T_CONSTANT_ENCAPSED_STRING","\"e.entity_id\"",147],")",";",["T_WHITESPACE","\n\n        ",147],["T_RETURN","return",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],";",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n\n    ",150],["T_DOC_COMMENT","\/**\n     * Order summary info for each customer\n     * such as orders_count, orders_avg_amount, orders_total_amount\n     *\n     * @param int $storeId\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",152],["T_WHITESPACE","\n    ",158],["T_PUBLIC","public",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","addSumAvgTotals",159],"(",["T_VARIABLE","$storeId",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_LNUMBER","0",159],")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$adapter",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getConnection",161],"(",")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$baseSubtotalRefunded",162],["T_WHITESPACE","   ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$adapter",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getIfNullSql",162],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.base_subtotal_refunded'",162],",",["T_WHITESPACE"," ",162],["T_LNUMBER","0",162],")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$baseSubtotalCanceled",163],["T_WHITESPACE","   ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$adapter",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getIfNullSql",163],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.base_subtotal_canceled'",163],",",["T_WHITESPACE"," ",163],["T_LNUMBER","0",163],")",";",["T_WHITESPACE","\n\n        ",163],["T_DOC_COMMENT","\/**\n         * calculate average and total amount\n         *\/",165],["T_WHITESPACE","\n        ",167],["T_VARIABLE","$expr",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],"(",["T_VARIABLE","$storeId",168],["T_WHITESPACE"," ",168],["T_IS_EQUAL","==",168],["T_WHITESPACE"," ",168],["T_LNUMBER","0",168],")",["T_WHITESPACE","\n            ",168],"?",["T_WHITESPACE"," ",169],"\"",["T_ENCAPSED_AND_WHITESPACE","(orders.base_subtotal - ",169],["T_CURLY_OPEN","{",169],["T_VARIABLE","$baseSubtotalCanceled",169],"}",["T_ENCAPSED_AND_WHITESPACE"," - ",169],["T_CURLY_OPEN","{",169],["T_VARIABLE","$baseSubtotalRefunded",169],"}",["T_ENCAPSED_AND_WHITESPACE",") * orders.base_to_global_rate",169],"\"",["T_WHITESPACE","\n            ",169],":",["T_WHITESPACE"," ",170],"\"",["T_ENCAPSED_AND_WHITESPACE","orders.base_subtotal - ",170],["T_CURLY_OPEN","{",170],["T_VARIABLE","$baseSubtotalCanceled",170],"}",["T_ENCAPSED_AND_WHITESPACE"," - ",170],["T_CURLY_OPEN","{",170],["T_VARIABLE","$baseSubtotalRefunded",170],"}","\"",";",["T_WHITESPACE","\n\n        ",170],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getSelect",172],"(",")",["T_WHITESPACE","\n            ",172],["T_OBJECT_OPERATOR","->",173],["T_STRING","columns",173],"(",["T_ARRAY","array",173],"(",["T_CONSTANT_ENCAPSED_STRING","\"orders_avg_amount\"",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],"\"",["T_ENCAPSED_AND_WHITESPACE","AVG(",173],["T_CURLY_OPEN","{",173],["T_VARIABLE","$expr",173],"}",["T_ENCAPSED_AND_WHITESPACE",")",173],"\"",")",")",["T_WHITESPACE","\n            ",173],["T_OBJECT_OPERATOR","->",174],["T_STRING","columns",174],"(",["T_ARRAY","array",174],"(",["T_CONSTANT_ENCAPSED_STRING","\"orders_sum_amount\"",174],["T_WHITESPACE"," ",174],["T_DOUBLE_ARROW","=>",174],["T_WHITESPACE"," ",174],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",174],["T_CURLY_OPEN","{",174],["T_VARIABLE","$expr",174],"}",["T_ENCAPSED_AND_WHITESPACE",")",174],"\"",")",")",";",["T_WHITESPACE","\n\n        ",174],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n\n    ",177],["T_DOC_COMMENT","\/**\n     * Order by total amount\n     *\n     * @param string $dir\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",179],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","orderByTotalAmount",185],"(",["T_VARIABLE","$dir",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_STRING","self",185],["T_DOUBLE_COLON","::",185],["T_STRING","SORT_ORDER_DESC",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getSelect",187],"(",")",["T_WHITESPACE","\n            ",187],["T_OBJECT_OPERATOR","->",188],["T_STRING","order",188],"(","\"",["T_ENCAPSED_AND_WHITESPACE","orders_sum_amount ",188],["T_CURLY_OPEN","{",188],["T_VARIABLE","$dir",188],"}","\"",")",";",["T_WHITESPACE","\n        ",188],["T_RETURN","return",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n\n    ",190],["T_DOC_COMMENT","\/**\n     * Add order statistics\n     *\n     * @param boolean $isFilter\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",192],["T_WHITESPACE","\n    ",197],["T_PUBLIC","public",198],["T_WHITESPACE"," ",198],["T_FUNCTION","function",198],["T_WHITESPACE"," ",198],["T_STRING","addOrdersStatistics",198],"(",["T_VARIABLE","$isFilter",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_STRING","false",198],")",["T_WHITESPACE","\n    ",198],"{",["T_WHITESPACE","\n        ",199],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","_addOrderStatistics",200],["T_WHITESPACE","          ",200],"=",["T_WHITESPACE"," ",200],["T_STRING","true",200],";",["T_WHITESPACE","\n        ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_addOrderStatisticsIsFilter",201],["T_WHITESPACE","  ",201],"=",["T_WHITESPACE"," ",201],["T_BOOL_CAST","(bool)",201],["T_VARIABLE","$isFilter",201],";",["T_WHITESPACE","\n        ",201],["T_RETURN","return",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],";",["T_WHITESPACE","\n    ",202],"}",["T_WHITESPACE","\n\n    ",203],["T_DOC_COMMENT","\/**\n     * Add orders statistics to collection items\n     *\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",205],["T_WHITESPACE","\n    ",209],["T_PROTECTED","protected",210],["T_WHITESPACE"," ",210],["T_FUNCTION","function",210],["T_WHITESPACE"," ",210],["T_STRING","_addOrdersStatistics",210],"(",")",["T_WHITESPACE","\n    ",210],"{",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$customerIds",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getColumnValues",212],"(",["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getResource",212],"(",")",["T_OBJECT_OPERATOR","->",212],["T_STRING","getIdFieldName",212],"(",")",")",";",["T_WHITESPACE","\n\n        ",212],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","_addOrderStatistics",214],["T_WHITESPACE"," ",214],["T_BOOLEAN_AND","&&",214],["T_WHITESPACE"," ",214],"!",["T_EMPTY","empty",214],"(",["T_VARIABLE","$customerIds",214],")",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$adapter",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getConnection",215],"(",")",";",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$baseSubtotalRefunded",216],["T_WHITESPACE","   ",216],"=",["T_WHITESPACE"," ",216],["T_VARIABLE","$adapter",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getIfNullSql",216],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.base_subtotal_refunded'",216],",",["T_WHITESPACE"," ",216],["T_LNUMBER","0",216],")",";",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$baseSubtotalCanceled",217],["T_WHITESPACE","   ",217],"=",["T_WHITESPACE"," ",217],["T_VARIABLE","$adapter",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getIfNullSql",217],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.base_subtotal_canceled'",217],",",["T_WHITESPACE"," ",217],["T_LNUMBER","0",217],")",";",["T_WHITESPACE","\n\n            ",217],["T_VARIABLE","$totalExpr",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],"(","!",["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_addOrderStatisticsIsFilter",219],")",["T_WHITESPACE","\n                ",219],"?",["T_WHITESPACE"," ",220],"\"",["T_ENCAPSED_AND_WHITESPACE","(orders.base_subtotal - ",220],["T_CURLY_OPEN","{",220],["T_VARIABLE","$baseSubtotalCanceled",220],"}",["T_ENCAPSED_AND_WHITESPACE"," - ",220],["T_CURLY_OPEN","{",220],["T_VARIABLE","$baseSubtotalRefunded",220],"}",["T_ENCAPSED_AND_WHITESPACE",") * orders.base_to_global_rate",220],"\"",["T_WHITESPACE","\n                ",220],":",["T_WHITESPACE"," ",221],"\"",["T_ENCAPSED_AND_WHITESPACE","orders.base_subtotal - ",221],["T_CURLY_OPEN","{",221],["T_VARIABLE","$baseSubtotalCanceled",221],"}",["T_ENCAPSED_AND_WHITESPACE"," - ",221],["T_CURLY_OPEN","{",221],["T_VARIABLE","$baseSubtotalRefunded",221],"}","\"",";",["T_WHITESPACE","\n\n            ",221],["T_VARIABLE","$select",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getConnection",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","select",223],"(",")",";",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$select",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","from",224],"(",["T_ARRAY","array",224],"(",["T_CONSTANT_ENCAPSED_STRING","'orders'",224],["T_WHITESPACE"," ",224],["T_DOUBLE_ARROW","=>",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getTable",224],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/order'",224],")",")",",",["T_WHITESPACE"," ",224],["T_ARRAY","array",224],"(",["T_WHITESPACE","\n                ",224],["T_CONSTANT_ENCAPSED_STRING","'orders_avg_amount'",225],["T_WHITESPACE"," ",225],["T_DOUBLE_ARROW","=>",225],["T_WHITESPACE"," ",225],"\"",["T_ENCAPSED_AND_WHITESPACE","AVG(",225],["T_CURLY_OPEN","{",225],["T_VARIABLE","$totalExpr",225],"}",["T_ENCAPSED_AND_WHITESPACE",")",225],"\"",",",["T_WHITESPACE","\n                ",225],["T_CONSTANT_ENCAPSED_STRING","'orders_sum_amount'",226],["T_WHITESPACE"," ",226],["T_DOUBLE_ARROW","=>",226],["T_WHITESPACE"," ",226],"\"",["T_ENCAPSED_AND_WHITESPACE","SUM(",226],["T_CURLY_OPEN","{",226],["T_VARIABLE","$totalExpr",226],"}",["T_ENCAPSED_AND_WHITESPACE",")",226],"\"",",",["T_WHITESPACE","\n                ",226],["T_CONSTANT_ENCAPSED_STRING","'orders_count'",227],["T_WHITESPACE"," ",227],["T_DOUBLE_ARROW","=>",227],["T_WHITESPACE"," ",227],["T_CONSTANT_ENCAPSED_STRING","'COUNT(orders.entity_id)'",227],",",["T_WHITESPACE","\n                ",227],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",228],["T_WHITESPACE","\n            ",228],")",")",["T_OBJECT_OPERATOR","->",229],["T_STRING","where",229],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.state <> ?'",229],",",["T_WHITESPACE"," ",229],["T_STRING","Mage_Sales_Model_Order",229],["T_DOUBLE_COLON","::",229],["T_STRING","STATE_CANCELED",229],")",["T_WHITESPACE","\n              ",229],["T_OBJECT_OPERATOR","->",230],["T_STRING","where",230],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.customer_id IN(?)'",230],",",["T_WHITESPACE"," ",230],["T_VARIABLE","$customerIds",230],")",["T_WHITESPACE","\n              ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","group",231],"(",["T_CONSTANT_ENCAPSED_STRING","'orders.customer_id'",231],")",";",["T_WHITESPACE","\n\n            ",231],["T_COMMENT","\/*\n             * Analytic functions usage\n             *\/",233],["T_WHITESPACE","\n            ",235],["T_VARIABLE","$select",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_STRING","Mage",236],["T_DOUBLE_COLON","::",236],["T_STRING","getResourceHelper",236],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",236],")",["T_OBJECT_OPERATOR","->",236],["T_STRING","getQueryUsingAnalyticFunction",236],"(",["T_VARIABLE","$select",236],")",";",["T_WHITESPACE","\n\n            ",236],["T_FOREACH","foreach",238],["T_WHITESPACE"," ",238],"(",["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getConnection",238],"(",")",["T_OBJECT_OPERATOR","->",238],["T_STRING","fetchAll",238],"(",["T_VARIABLE","$select",238],")",["T_WHITESPACE"," ",238],["T_AS","as",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$ordersInfo",238],")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n                ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getItemById",239],"(",["T_VARIABLE","$ordersInfo",239],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",239],"]",")",["T_OBJECT_OPERATOR","->",239],["T_STRING","addData",239],"(",["T_VARIABLE","$ordersInfo",239],")",";",["T_WHITESPACE","\n            ",239],"}",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n\n        ",241],["T_RETURN","return",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],";",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n\n    ",244],["T_DOC_COMMENT","\/**\n     * Collection after load operations like adding orders statistics\n     *\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",246],["T_WHITESPACE","\n    ",250],["T_PROTECTED","protected",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","_afterLoad",251],"(",")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","_addOrdersStatistics",253],"(",")",";",["T_WHITESPACE","\n        ",253],["T_RETURN","return",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],";",["T_WHITESPACE","\n    ",254],"}",["T_WHITESPACE","\n\n    ",255],["T_DOC_COMMENT","\/**\n     * Order by customer registration\n     *\n     * @param string $dir\n     * @return Mage_Reports_Model_Resource_Customer_Collection\n     *\/",257],["T_WHITESPACE","\n    ",262],["T_PUBLIC","public",263],["T_WHITESPACE"," ",263],["T_FUNCTION","function",263],["T_WHITESPACE"," ",263],["T_STRING","orderByCustomerRegistration",263],"(",["T_VARIABLE","$dir",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_STRING","self",263],["T_DOUBLE_COLON","::",263],["T_STRING","SORT_ORDER_DESC",263],")",["T_WHITESPACE","\n    ",263],"{",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","addAttributeToSort",265],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",265],",",["T_WHITESPACE"," ",265],["T_VARIABLE","$dir",265],")",";",["T_WHITESPACE","\n        ",265],["T_RETURN","return",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$this",266],";",["T_WHITESPACE","\n    ",266],"}",["T_WHITESPACE","\n\n    ",267],["T_DOC_COMMENT","\/**\n     * Get select count sql\n     *\n     * @return string\n     *\/",269],["T_WHITESPACE","\n    ",273],["T_PUBLIC","public",274],["T_WHITESPACE"," ",274],["T_FUNCTION","function",274],["T_WHITESPACE"," ",274],["T_STRING","getSelectCountSql",274],"(",")",["T_WHITESPACE","\n    ",274],"{",["T_WHITESPACE","\n        ",275],["T_VARIABLE","$countSelect",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_CLONE","clone",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","getSelect",276],"(",")",";",["T_WHITESPACE","\n        ",276],["T_VARIABLE","$countSelect",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","reset",277],"(",["T_STRING","Zend_Db_Select",277],["T_DOUBLE_COLON","::",277],["T_STRING","ORDER",277],")",";",["T_WHITESPACE","\n        ",277],["T_VARIABLE","$countSelect",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","reset",278],"(",["T_STRING","Zend_Db_Select",278],["T_DOUBLE_COLON","::",278],["T_STRING","LIMIT_COUNT",278],")",";",["T_WHITESPACE","\n        ",278],["T_VARIABLE","$countSelect",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","reset",279],"(",["T_STRING","Zend_Db_Select",279],["T_DOUBLE_COLON","::",279],["T_STRING","LIMIT_OFFSET",279],")",";",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$countSelect",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","reset",280],"(",["T_STRING","Zend_Db_Select",280],["T_DOUBLE_COLON","::",280],["T_STRING","COLUMNS",280],")",";",["T_WHITESPACE","\n        ",280],["T_VARIABLE","$countSelect",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","reset",281],"(",["T_STRING","Zend_Db_Select",281],["T_DOUBLE_COLON","::",281],["T_STRING","GROUP",281],")",";",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$countSelect",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","reset",282],"(",["T_STRING","Zend_Db_Select",282],["T_DOUBLE_COLON","::",282],["T_STRING","HAVING",282],")",";",["T_WHITESPACE","\n        ",282],["T_VARIABLE","$countSelect",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","columns",283],"(",["T_CONSTANT_ENCAPSED_STRING","\"count(DISTINCT e.entity_id)\"",283],")",";",["T_WHITESPACE","\n\n        ",283],["T_RETURN","return",285],["T_WHITESPACE"," ",285],["T_VARIABLE","$countSelect",285],";",["T_WHITESPACE","\n    ",285],"}",["T_WHITESPACE","\n",286],"}",["T_WHITESPACE","\n",287]]