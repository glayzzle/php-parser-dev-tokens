[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Reports\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Reports Product Index Abstract Resource Model\n *\n * @category    Mage\n * @package     Mage_Reports\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_ABSTRACT","abstract",35],["T_WHITESPACE"," ",35],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Reports_Model_Resource_Product_Index_Abstract",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Fields List for update in forsedSave\n     *\n     * @var array\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_fieldsForUpdate",42],["T_WHITESPACE","    ",42],"=",["T_WHITESPACE"," ",42],["T_ARRAY","array",42],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'added_at'",42],")",";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Update Customer from visitor (Customer logged in)\n     *\n     * @param Mage_Reports_Model_Product_Index_Abstract $object\n     * @return Mage_Reports_Model_Resource_Product_Index_Abstract\n     *\/",44],["T_WHITESPACE","\n    ",49],["T_PUBLIC","public",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","updateCustomerFromVisitor",50],"(",["T_STRING","Mage_Reports_Model_Product_Index_Abstract",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$object",50],")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_DOC_COMMENT","\/**\n         * Do nothing if customer not logged in\n         *\/",52],["T_WHITESPACE","\n        ",54],["T_IF","if",55],["T_WHITESPACE"," ",55],"(","!",["T_VARIABLE","$object",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getCustomerId",55],"(",")",["T_WHITESPACE"," ",55],["T_BOOLEAN_OR","||",55],["T_WHITESPACE"," ",55],"!",["T_VARIABLE","$object",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","getVisitorId",55],"(",")",")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n            ",55],["T_RETURN","return",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],";",["T_WHITESPACE","\n        ",56],"}",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$adapter",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","_getWriteAdapter",58],"(",")",";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$select",59],["T_WHITESPACE","  ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$adapter",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","select",59],"(",")",["T_WHITESPACE","\n            ",59],["T_OBJECT_OPERATOR","->",60],["T_STRING","from",60],"(",["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","getMainTable",60],"(",")",")",["T_WHITESPACE","\n            ",60],["T_OBJECT_OPERATOR","->",61],["T_STRING","where",61],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_id = ?'",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$object",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getVisitorId",61],"(",")",")",";",["T_WHITESPACE","\n\n        ",61],["T_VARIABLE","$rowSet",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$select",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","query",63],"(",")",["T_OBJECT_OPERATOR","->",63],["T_STRING","fetchAll",63],"(",")",";",["T_WHITESPACE","\n        ",63],["T_FOREACH","foreach",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$rowSet",64],["T_WHITESPACE"," ",64],["T_AS","as",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$row",64],")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n\n            ",64],["T_COMMENT","\/* We need to determine if there are rows with known\n               customer for current product.\n             *\/",66],["T_WHITESPACE","\n\n            ",68],["T_VARIABLE","$select",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$adapter",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","select",70],"(",")",["T_WHITESPACE","\n                ",70],["T_OBJECT_OPERATOR","->",71],["T_STRING","from",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getMainTable",71],"(",")",")",["T_WHITESPACE","\n                ",71],["T_OBJECT_OPERATOR","->",72],["T_STRING","where",72],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id = ?'",72],",",["T_WHITESPACE"," ",72],["T_VARIABLE","$object",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getCustomerId",72],"(",")",")",["T_WHITESPACE","\n                ",72],["T_OBJECT_OPERATOR","->",73],["T_STRING","where",73],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id = ?'",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$row",73],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",73],"]",")",";",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$idx",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$adapter",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","fetchRow",74],"(",["T_VARIABLE","$select",74],")",";",["T_WHITESPACE","\n\n            ",74],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_VARIABLE","$idx",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_COMMENT","\/* If we are here it means that we have two rows: one with known customer, but second just visitor is set\n             * One row should be updated with customer_id, second should be deleted\n             *\n             *\/",77],["T_WHITESPACE","\n                ",80],["T_VARIABLE","$adapter",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","delete",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getMainTable",81],"(",")",",",["T_WHITESPACE"," ",81],["T_ARRAY","array",81],"(",["T_CONSTANT_ENCAPSED_STRING","'index_id = ?'",81],["T_WHITESPACE"," ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$row",81],"[",["T_CONSTANT_ENCAPSED_STRING","'index_id'",81],"]",")",")",";",["T_WHITESPACE","\n                ",81],["T_VARIABLE","$where",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_ARRAY","array",82],"(",["T_CONSTANT_ENCAPSED_STRING","'index_id = ?'",82],["T_WHITESPACE"," ",82],["T_DOUBLE_ARROW","=>",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$idx",82],"[",["T_CONSTANT_ENCAPSED_STRING","'index_id'",82],"]",")",";",["T_WHITESPACE","\n                ",82],["T_VARIABLE","$data",83],["T_WHITESPACE","  ",83],"=",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",["T_WHITESPACE","\n                    ",83],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",84],["T_WHITESPACE","    ",84],["T_DOUBLE_ARROW","=>",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$object",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getVisitorId",84],"(",")",",",["T_WHITESPACE","\n                    ",84],["T_CONSTANT_ENCAPSED_STRING","'store_id'",85],["T_WHITESPACE","      ",85],["T_DOUBLE_ARROW","=>",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$object",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getStoreId",85],"(",")",",",["T_WHITESPACE","\n                    ",85],["T_CONSTANT_ENCAPSED_STRING","'added_at'",86],["T_WHITESPACE","      ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],["T_STRING","Varien_Date",86],["T_DOUBLE_COLON","::",86],["T_STRING","now",86],"(",")",",",["T_WHITESPACE","\n                ",86],")",";",["T_WHITESPACE","\n            ",87],"}",["T_WHITESPACE"," ",88],["T_ELSE","else",88],["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                ",88],["T_VARIABLE","$where",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_ARRAY","array",89],"(",["T_CONSTANT_ENCAPSED_STRING","'index_id = ?'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$row",89],"[",["T_CONSTANT_ENCAPSED_STRING","'index_id'",89],"]",")",";",["T_WHITESPACE","\n                ",89],["T_VARIABLE","$data",90],["T_WHITESPACE","  ",90],"=",["T_WHITESPACE"," ",90],["T_ARRAY","array",90],"(",["T_WHITESPACE","\n                    ",90],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",91],["T_WHITESPACE","   ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$object",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getCustomerId",91],"(",")",",",["T_WHITESPACE","\n                    ",91],["T_CONSTANT_ENCAPSED_STRING","'store_id'",92],["T_WHITESPACE","      ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$object",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getStoreId",92],"(",")",",",["T_WHITESPACE","\n                    ",92],["T_CONSTANT_ENCAPSED_STRING","'added_at'",93],["T_WHITESPACE","      ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_STRING","Varien_Date",93],["T_DOUBLE_COLON","::",93],["T_STRING","now",93],"(",")",["T_WHITESPACE","\n                ",93],")",";",["T_WHITESPACE","\n            ",94],"}",["T_WHITESPACE","\n\n            ",95],["T_VARIABLE","$adapter",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","update",97],"(",["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getMainTable",97],"(",")",",",["T_WHITESPACE"," ",97],["T_VARIABLE","$data",97],",",["T_WHITESPACE"," ",97],["T_VARIABLE","$where",97],")",";",["T_WHITESPACE","\n\n        ",97],"}",["T_WHITESPACE","\n        ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],";",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Purge visitor data by customer (logout)\n     *\n     * @param Mage_Reports_Model_Product_Index_Abstract $object\n     * @return Mage_Reports_Model_Resource_Product_Index_Abstract\n     *\/",103],["T_WHITESPACE","\n    ",108],["T_PUBLIC","public",109],["T_WHITESPACE"," ",109],["T_FUNCTION","function",109],["T_WHITESPACE"," ",109],["T_STRING","purgeVisitorByCustomer",109],"(",["T_STRING","Mage_Reports_Model_Product_Index_Abstract",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$object",109],")",["T_WHITESPACE","\n    ",109],"{",["T_WHITESPACE","\n        ",110],["T_DOC_COMMENT","\/**\n         * Do nothing if customer not logged in\n         *\/",111],["T_WHITESPACE","\n        ",113],["T_IF","if",114],["T_WHITESPACE"," ",114],"(","!",["T_VARIABLE","$object",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getCustomerId",114],"(",")",")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],";",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE","\n\n        ",116],["T_VARIABLE","$bind",118],["T_WHITESPACE","   ",118],"=",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",118],["T_WHITESPACE","      ",118],["T_DOUBLE_ARROW","=>",118],["T_WHITESPACE"," ",118],["T_STRING","null",118],")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$where",119],["T_WHITESPACE","  ",119],"=",["T_WHITESPACE"," ",119],["T_ARRAY","array",119],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id = ?'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_INT_CAST","(int)",119],["T_VARIABLE","$object",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getCustomerId",119],"(",")",")",";",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_getWriteAdapter",120],"(",")",["T_OBJECT_OPERATOR","->",120],["T_STRING","update",120],"(",["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getMainTable",120],"(",")",",",["T_WHITESPACE"," ",120],["T_VARIABLE","$bind",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$where",120],")",";",["T_WHITESPACE","\n\n        ",120],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],";",["T_WHITESPACE","\n    ",122],"}",["T_WHITESPACE","\n\n    ",123],["T_DOC_COMMENT","\/**\n     * Save Product Index data (forced save)\n     *\n     * @param Mage_Reports_Model_Product_Index_Abstract $object\n     * @return Mage_Reports_Model_Resource_Product_Index_Abstract\n     *\/",125],["T_WHITESPACE","\n    ",130],["T_PUBLIC","public",131],["T_WHITESPACE"," ",131],["T_FUNCTION","function",131],["T_WHITESPACE"," ",131],["T_STRING","save",131],"(",["T_STRING","Mage_Core_Model_Abstract",131],["T_WHITESPACE","  ",131],["T_VARIABLE","$object",131],")",["T_WHITESPACE","\n    ",131],"{",["T_WHITESPACE","\n        ",132],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$object",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","isDeleted",133],"(",")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","delete",134],"(",["T_VARIABLE","$object",134],")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n\n        ",135],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_serializeFields",137],"(",["T_VARIABLE","$object",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_beforeSave",138],"(",["T_VARIABLE","$object",138],")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_checkUnique",139],"(",["T_VARIABLE","$object",139],")",";",["T_WHITESPACE","\n\n        ",139],["T_VARIABLE","$data",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_prepareDataForSave",141],"(",["T_VARIABLE","$object",141],")",";",["T_WHITESPACE","\n        ",141],["T_UNSET","unset",142],"(",["T_VARIABLE","$data",142],"[",["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getIdFieldName",142],"(",")","]",")",";",["T_WHITESPACE","\n\n        ",142],["T_VARIABLE","$matchFields",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_ARRAY","array",144],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",144],",",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'store_id'",144],")",";",["T_WHITESPACE","\n\n        ",144],["T_STRING","Mage",146],["T_DOUBLE_COLON","::",146],["T_STRING","getResourceHelper",146],"(",["T_CONSTANT_ENCAPSED_STRING","'reports'",146],")",["T_OBJECT_OPERATOR","->",146],["T_STRING","mergeVisitorProductIndex",146],"(",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getMainTable",147],"(",")",",",["T_WHITESPACE","\n            ",147],["T_VARIABLE","$data",148],",",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$matchFields",149],["T_WHITESPACE","\n        ",149],")",";",["T_WHITESPACE","\n\n\n        ",150],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","unserializeFields",153],"(",["T_VARIABLE","$object",153],")",";",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_afterSave",154],"(",["T_VARIABLE","$object",154],")",";",["T_WHITESPACE","\n\n        ",154],["T_RETURN","return",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],";",["T_WHITESPACE","\n    ",156],"}",["T_WHITESPACE","\n\n\n    ",157],["T_DOC_COMMENT","\/**\n     * Clean index (visitor)\n     *\n     * @return Mage_Reports_Model_Resource_Product_Index_Abstract\n     *\/",160],["T_WHITESPACE","\n    ",164],["T_PUBLIC","public",165],["T_WHITESPACE"," ",165],["T_FUNCTION","function",165],["T_WHITESPACE"," ",165],["T_STRING","clean",165],"(",")",["T_WHITESPACE","\n    ",165],"{",["T_WHITESPACE","\n        ",166],["T_WHILE","while",167],["T_WHITESPACE"," ",167],"(",["T_STRING","true",167],")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$select",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_getReadAdapter",168],"(",")",["T_OBJECT_OPERATOR","->",168],["T_STRING","select",168],"(",")",["T_WHITESPACE","\n                ",168],["T_OBJECT_OPERATOR","->",169],["T_STRING","from",169],"(",["T_ARRAY","array",169],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table'",169],["T_WHITESPACE"," ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getMainTable",169],"(",")",")",",",["T_WHITESPACE"," ",169],["T_ARRAY","array",169],"(",["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getIdFieldName",169],"(",")",")",")",["T_WHITESPACE","\n                ",169],["T_OBJECT_OPERATOR","->",170],["T_STRING","joinLeft",170],"(",["T_WHITESPACE","\n                    ",170],["T_ARRAY","array",171],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_table'",171],["T_WHITESPACE"," ",171],["T_DOUBLE_ARROW","=>",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getTable",171],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor'",171],")",")",",",["T_WHITESPACE","\n                    ",171],["T_CONSTANT_ENCAPSED_STRING","'main_table.visitor_id = visitor_table.visitor_id'",172],",",["T_WHITESPACE","\n                    ",172],["T_ARRAY","array",173],"(",")",")",["T_WHITESPACE","\n                ",173],["T_OBJECT_OPERATOR","->",174],["T_STRING","where",174],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.visitor_id > ?'",174],",",["T_WHITESPACE"," ",174],["T_LNUMBER","0",174],")",["T_WHITESPACE","\n                ",174],["T_OBJECT_OPERATOR","->",175],["T_STRING","where",175],"(",["T_CONSTANT_ENCAPSED_STRING","'visitor_table.visitor_id IS NULL'",175],")",["T_WHITESPACE","\n                ",175],["T_OBJECT_OPERATOR","->",176],["T_STRING","limit",176],"(",["T_LNUMBER","100",176],")",";",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$indexIds",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_getReadAdapter",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","fetchCol",177],"(",["T_VARIABLE","$select",177],")",";",["T_WHITESPACE","\n\n            ",177],["T_IF","if",179],["T_WHITESPACE"," ",179],"(","!",["T_VARIABLE","$indexIds",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_BREAK","break",180],";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE","\n\n            ",181],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","_getWriteAdapter",183],"(",")",["T_OBJECT_OPERATOR","->",183],["T_STRING","delete",183],"(",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getMainTable",184],"(",")",",",["T_WHITESPACE","\n                ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_getWriteAdapter",185],"(",")",["T_OBJECT_OPERATOR","->",185],["T_STRING","quoteInto",185],"(",["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getIdFieldName",185],"(",")",["T_WHITESPACE"," ",185],".",["T_WHITESPACE"," ",185],["T_CONSTANT_ENCAPSED_STRING","' IN(?)'",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$indexIds",185],")",["T_WHITESPACE","\n            ",185],")",";",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n        ",187],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Add information about product ids to visitor\/customer\n     *\n     *\n     * @param Mage_Reports_Model_Product_Index_Abstract $object\n     * @param array $productIds\n     * @return Mage_Reports_Model_Resource_Product_Index_Abstract\n     *\/",191],["T_WHITESPACE","\n    ",198],["T_PUBLIC","public",199],["T_WHITESPACE"," ",199],["T_FUNCTION","function",199],["T_WHITESPACE"," ",199],["T_STRING","registerIds",199],"(",["T_STRING","Varien_Object",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$object",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$productIds",199],")",["T_WHITESPACE","\n    ",199],"{",["T_WHITESPACE","\n        ",200],["T_VARIABLE","$row",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_ARRAY","array",201],"(",["T_WHITESPACE","\n            ",201],["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",202],["T_WHITESPACE","    ",202],["T_DOUBLE_ARROW","=>",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$object",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getVisitorId",202],"(",")",",",["T_WHITESPACE","\n            ",202],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",203],["T_WHITESPACE","   ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$object",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","getCustomerId",203],"(",")",",",["T_WHITESPACE","\n            ",203],["T_CONSTANT_ENCAPSED_STRING","'store_id'",204],["T_WHITESPACE","      ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$object",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getStoreId",204],"(",")",",",["T_WHITESPACE","\n        ",204],")",";",["T_WHITESPACE","\n        ",205],["T_VARIABLE","$addedAt",206],["T_WHITESPACE","    ",206],"=",["T_WHITESPACE"," ",206],["T_STRING","Varien_Date",206],["T_DOUBLE_COLON","::",206],["T_STRING","toTimestamp",206],"(",["T_STRING","true",206],")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$data",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_ARRAY","array",207],"(",")",";",["T_WHITESPACE","\n        ",207],["T_FOREACH","foreach",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$productIds",208],["T_WHITESPACE"," ",208],["T_AS","as",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$productId",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$productId",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_INT_CAST","(int)",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$productId",209],";",["T_WHITESPACE","\n            ",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$productId",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n                ",210],["T_VARIABLE","$row",211],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",211],"]",["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$productId",211],";",["T_WHITESPACE","\n                ",211],["T_VARIABLE","$row",212],"[",["T_CONSTANT_ENCAPSED_STRING","'added_at'",212],"]",["T_WHITESPACE","   ",212],"=",["T_WHITESPACE"," ",212],["T_STRING","Varien_Date",212],["T_DOUBLE_COLON","::",212],["T_STRING","formatDate",212],"(",["T_VARIABLE","$addedAt",212],")",";",["T_WHITESPACE","\n                ",212],["T_VARIABLE","$data",213],"[","]",["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$row",213],";",["T_WHITESPACE","\n            ",213],"}",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$addedAt",215],["T_WHITESPACE"," ",215],["T_MINUS_EQUAL","-=",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$addedAt",215],["T_WHITESPACE"," ",215],">",["T_WHITESPACE"," ",215],["T_LNUMBER","0",215],")",["T_WHITESPACE"," ",215],"?",["T_WHITESPACE"," ",215],["T_LNUMBER","1",215],["T_WHITESPACE"," ",215],":",["T_WHITESPACE"," ",215],["T_LNUMBER","0",215],";",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n\n        ",216],["T_VARIABLE","$matchFields",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_ARRAY","array",218],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",218],",",["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","'store_id'",218],")",";",["T_WHITESPACE","\n        ",218],["T_FOREACH","foreach",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$data",219],["T_WHITESPACE"," ",219],["T_AS","as",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$row",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_STRING","Mage",220],["T_DOUBLE_COLON","::",220],["T_STRING","getResourceHelper",220],"(",["T_CONSTANT_ENCAPSED_STRING","'reports'",220],")",["T_OBJECT_OPERATOR","->",220],["T_STRING","mergeVisitorProductIndex",220],"(",["T_WHITESPACE","\n                ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getMainTable",221],"(",")",",",["T_WHITESPACE","\n                ",221],["T_VARIABLE","$row",222],",",["T_WHITESPACE","\n                ",222],["T_VARIABLE","$matchFields",223],["T_WHITESPACE","\n            ",223],")",";",["T_WHITESPACE","\n        ",224],"}",["T_WHITESPACE","\n        ",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n",227],"}",["T_WHITESPACE","\n",228]]