[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Reports\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Reports Product Index Abstract Product Resource Collection\n *\n * @category    Mage\n * @package     Mage_Reports\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_ABSTRACT","abstract",35],["T_WHITESPACE"," ",35],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Reports_Model_Resource_Product_Index_Collection_Abstract",35],["T_WHITESPACE","\n    ",35],["T_EXTENDS","extends",36],["T_WHITESPACE"," ",36],["T_STRING","Mage_Catalog_Model_Resource_Product_Collection",36],["T_WHITESPACE","\n",36],"{",["T_WHITESPACE","\n    ",37],["T_DOC_COMMENT","\/**\n     * Customer id\n     *\n     * @var null|int\n     *\/",38],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_customerId",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","null",43],";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * List of ids\n     * After collection will be loaded Items will be sorted as this list\n     *\n     * @var array\n     *\/",45],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_sortIds",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_ARRAY","array",51],"(",")",";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Retrieve Product Index table name\n     *\n     *\/",53],["T_WHITESPACE","\n    ",56],["T_ABSTRACT","abstract",57],["T_WHITESPACE"," ",57],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","_getTableName",57],"(",")",";",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Join index table\n     *\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",59],["T_WHITESPACE","\n    ",63],["T_PROTECTED","protected",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","_joinIdxTable",64],"(",")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_IF","if",66],["T_WHITESPACE"," ",66],"(","!",["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getFlag",66],"(",["T_CONSTANT_ENCAPSED_STRING","'is_idx_table_joined'",66],")",")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","joinTable",67],"(",["T_WHITESPACE","\n                ",67],["T_ARRAY","array",68],"(",["T_CONSTANT_ENCAPSED_STRING","'idx_table'",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_getTableName",68],"(",")",")",",",["T_WHITESPACE","\n                ",68],["T_CONSTANT_ENCAPSED_STRING","'product_id=entity_id'",69],",",["T_WHITESPACE","\n                ",69],["T_ARRAY","array",70],"(",["T_WHITESPACE","\n                    ",70],["T_CONSTANT_ENCAPSED_STRING","'product_id'",71],["T_WHITESPACE","    ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'product_id'",71],",",["T_WHITESPACE","\n                    ",71],["T_CONSTANT_ENCAPSED_STRING","'item_store_id'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'store_id'",72],",",["T_WHITESPACE","\n                    ",72],["T_CONSTANT_ENCAPSED_STRING","'added_at'",73],["T_WHITESPACE","      ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'added_at'",73],["T_WHITESPACE","\n                ",73],")",",",["T_WHITESPACE","\n                ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_getWhereCondition",75],"(",")",["T_WHITESPACE","\n            ",75],")",";",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","setFlag",77],"(",["T_CONSTANT_ENCAPSED_STRING","'is_idx_table_joined'",77],",",["T_WHITESPACE"," ",77],["T_STRING","true",77],")",";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n        ",78],["T_RETURN","return",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n\n    ",80],["T_DOC_COMMENT","\/**\n     * Add Viewed Products Index to Collection\n     *\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",82],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","addIndexFilter",87],"(",")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_joinIdxTable",89],"(",")",";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_productLimitationFilters",90],"[",["T_CONSTANT_ENCAPSED_STRING","'store_table'",90],"]",["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'idx_table'",90],";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","setFlag",91],"(",["T_CONSTANT_ENCAPSED_STRING","'url_data_object'",91],",",["T_WHITESPACE"," ",91],["T_STRING","true",91],")",";",["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","setFlag",92],"(",["T_CONSTANT_ENCAPSED_STRING","'do_not_use_category_id'",92],",",["T_WHITESPACE"," ",92],["T_STRING","true",92],")",";",["T_WHITESPACE","\n        ",92],["T_RETURN","return",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$this",93],";",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n\n    ",94],["T_DOC_COMMENT","\/**\n     * Add filter by product ids\n     *\n     * @param array $ids\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",96],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","addFilterByIds",102],"(",["T_VARIABLE","$ids",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_EMPTY","empty",104],"(",["T_VARIABLE","$ids",104],")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getSelect",105],"(",")",["T_OBJECT_OPERATOR","->",105],["T_STRING","where",105],"(",["T_CONSTANT_ENCAPSED_STRING","'1=0'",105],")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE"," ",106],["T_ELSE","else",106],["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getSelect",107],"(",")",["T_OBJECT_OPERATOR","->",107],["T_STRING","where",107],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$ids",107],")",";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n        ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Retrieve Where Condition to Index table\n     *\n     * @return array\n     *\/",112],["T_WHITESPACE","\n    ",116],["T_PROTECTED","protected",117],["T_WHITESPACE"," ",117],["T_FUNCTION","function",117],["T_WHITESPACE"," ",117],["T_STRING","_getWhereCondition",117],"(",")",["T_WHITESPACE","\n    ",117],"{",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$condition",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_ARRAY","array",119],"(",")",";",["T_WHITESPACE","\n\n        ",119],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_STRING","Mage",121],["T_DOUBLE_COLON","::",121],["T_STRING","getSingleton",121],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",121],")",["T_OBJECT_OPERATOR","->",121],["T_STRING","isLoggedIn",121],"(",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$condition",122],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",122],"]",["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_STRING","Mage",122],["T_DOUBLE_COLON","::",122],["T_STRING","getSingleton",122],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",122],")",["T_OBJECT_OPERATOR","->",122],["T_STRING","getCustomerId",122],"(",")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE"," ",123],["T_ELSEIF","elseif",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_customerId",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$condition",124],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",124],"]",["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_customerId",124],";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE"," ",125],["T_ELSE","else",125],["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$condition",126],"[",["T_CONSTANT_ENCAPSED_STRING","'visitor_id'",126],"]",["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","Mage",126],["T_DOUBLE_COLON","::",126],["T_STRING","getSingleton",126],"(",["T_CONSTANT_ENCAPSED_STRING","'log\/visitor'",126],")",["T_OBJECT_OPERATOR","->",126],["T_STRING","getId",126],"(",")",";",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$condition",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Set customer id, that will be used in 'whereCondition'\n     *\n     * @param int $id\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",132],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","setCustomerId",138],"(",["T_VARIABLE","$id",138],")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","_customerId",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_INT_CAST","(int)",140],["T_VARIABLE","$id",140],";",["T_WHITESPACE","\n        ",140],["T_RETURN","return",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],";",["T_WHITESPACE","\n    ",141],"}",["T_WHITESPACE","\n\n    ",142],["T_DOC_COMMENT","\/**\n     * Add order by \"added at\"\n     *\n     * @param string $dir\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",144],["T_WHITESPACE","\n    ",149],["T_PUBLIC","public",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","setAddedAtOrder",150],"(",["T_VARIABLE","$dir",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_STRING","self",150],["T_DOUBLE_COLON","::",150],["T_STRING","SORT_ORDER_DESC",150],")",["T_WHITESPACE","\n    ",150],"{",["T_WHITESPACE","\n        ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(",["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getFlag",152],"(",["T_CONSTANT_ENCAPSED_STRING","'is_idx_table_joined'",152],")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getSelect",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","order",153],"(",["T_CONSTANT_ENCAPSED_STRING","'added_at '",153],["T_WHITESPACE"," ",153],".",["T_WHITESPACE"," ",153],["T_VARIABLE","$dir",153],")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Set list of ids with expected order\n     *\n     * @param array $ids\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",158],["T_WHITESPACE","\n    ",163],["T_PUBLIC","public",164],["T_WHITESPACE"," ",164],["T_FUNCTION","function",164],["T_WHITESPACE"," ",164],["T_STRING","setSortIds",164],"(",["T_ARRAY","array",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$ids",164],")",["T_WHITESPACE","\n    ",164],"{",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_sortIds",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$ids",166],";",["T_WHITESPACE","\n        ",166],["T_RETURN","return",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$this",167],";",["T_WHITESPACE","\n    ",167],"}",["T_WHITESPACE","\n\n    ",168],["T_DOC_COMMENT","\/**\n     * Sort loaded collection by predefined items ids\n     *\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",170],["T_WHITESPACE","\n    ",174],["T_PROTECTED","protected",175],["T_WHITESPACE"," ",175],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","_sort",175],"(",")",["T_WHITESPACE","\n    ",175],"{",["T_WHITESPACE","\n        ",176],["T_IF","if",177],["T_WHITESPACE"," ",177],"(","!",["T_EMPTY","empty",177],"(",["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_sortIds",177],")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$orderedItems",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_ARRAY","array",178],"(",")",";",["T_WHITESPACE","\n            ",178],["T_FOREACH","foreach",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","_sortIds",179],["T_WHITESPACE"," ",179],["T_AS","as",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$id",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_ISSET","isset",180],"(",["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_items",180],"[",["T_VARIABLE","$id",180],"]",")",")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n                    ",180],["T_VARIABLE","$orderedItems",181],"[",["T_VARIABLE","$id",181],"]",["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_items",181],"[",["T_VARIABLE","$id",181],"]",";",["T_WHITESPACE","\n                ",181],"}",["T_WHITESPACE","\n            ",182],"}",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","_items",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$orderedItems",184],";",["T_WHITESPACE","\n        ",184],"}",["T_WHITESPACE","\n        ",185],["T_RETURN","return",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],";",["T_WHITESPACE","\n    ",186],"}",["T_WHITESPACE","\n\n    ",187],["T_DOC_COMMENT","\/**\n     * Sort items\n     *\n     * @return Mage_Catalog_Model_Resource_Product_Collection\n     *\/",189],["T_WHITESPACE","\n    ",193],["T_PROTECTED","protected",194],["T_WHITESPACE"," ",194],["T_FUNCTION","function",194],["T_WHITESPACE"," ",194],["T_STRING","_afterLoad",194],"(",")",["T_WHITESPACE","\n    ",194],"{",["T_WHITESPACE","\n        ",195],["T_VARIABLE","$result",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_STRING","parent",196],["T_DOUBLE_COLON","::",196],["T_STRING","_afterLoad",196],"(",")",";",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","_sort",197],"(",")",";",["T_WHITESPACE","\n        ",197],["T_RETURN","return",198],["T_WHITESPACE"," ",198],["T_VARIABLE","$result",198],";",["T_WHITESPACE","\n    ",198],"}",["T_WHITESPACE","\n\n\n    ",199],["T_DOC_COMMENT","\/**\n     * Add exclude Product Ids\n     *\n     * @param int|array $productIds\n     * @return Mage_Reports_Model_Resource_Product_Index_Collection_Abstract\n     *\/",202],["T_WHITESPACE","\n    ",207],["T_PUBLIC","public",208],["T_WHITESPACE"," ",208],["T_FUNCTION","function",208],["T_WHITESPACE"," ",208],["T_STRING","excludeProductIds",208],"(",["T_VARIABLE","$productIds",208],")",["T_WHITESPACE","\n    ",208],"{",["T_WHITESPACE","\n        ",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_EMPTY","empty",210],"(",["T_VARIABLE","$productIds",210],")",")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_RETURN","return",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_joinIdxTable",213],"(",")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getSelect",214],"(",")",["T_OBJECT_OPERATOR","->",214],["T_STRING","where",214],"(",["T_CONSTANT_ENCAPSED_STRING","'idx_table.product_id NOT IN(?)'",214],",",["T_WHITESPACE"," ",214],["T_VARIABLE","$productIds",214],")",";",["T_WHITESPACE","\n        ",214],["T_RETURN","return",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n",216],"}",["T_WHITESPACE","\n",217]]