[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Reports\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Report most viewed collection\n *\/",28],["T_WHITESPACE","\n",30],["T_CLASS","class",31],["T_WHITESPACE"," ",31],["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed_Collection",31],["T_WHITESPACE","\n    ",31],["T_EXTENDS","extends",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Reports_Model_Resource_Report_Collection_Abstract",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_DOC_COMMENT","\/**\n     * Rating limit\n     *\n     * @var int\n     *\/",34],["T_WHITESPACE","\n    ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$_ratingLimit",39],["T_WHITESPACE","        ",39],"=",["T_WHITESPACE"," ",39],["T_LNUMBER","5",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Selected columns\n     *\n     * @var array\n     *\/",41],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$_selectedColumns",46],["T_WHITESPACE","    ",46],"=",["T_WHITESPACE"," ",46],["T_ARRAY","array",46],"(",")",";",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Initialize custom resource model\n     *\n     *\/",48],["T_WHITESPACE","\n    ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","__construct",52],"(",")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_STRING","parent",54],["T_DOUBLE_COLON","::",54],["T_STRING","_construct",54],"(",")",";",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","setModel",55],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/report_item'",55],")",";",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_resource",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","Mage",56],["T_DOUBLE_COLON","::",56],["T_STRING","getResourceModel",56],"(",["T_CONSTANT_ENCAPSED_STRING","'sales\/report'",56],")",["T_WHITESPACE","\n            ",56],["T_OBJECT_OPERATOR","->",57],["T_STRING","init",57],"(",["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed",57],["T_DOUBLE_COLON","::",57],["T_STRING","AGGREGATION_DAILY",57],")",";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","setConnection",58],"(",["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getResource",58],"(",")",["T_OBJECT_OPERATOR","->",58],["T_STRING","getReadConnection",58],"(",")",")",";",["T_WHITESPACE","\n        ",58],["T_COMMENT","\/\/ overwrite default behaviour\n",59],["T_WHITESPACE","        ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_applyFilters",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","false",60],";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Retrieve selected columns\n     *\n     * @return array\n     *\/",63],["T_WHITESPACE","\n    ",67],["T_PROTECTED","protected",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","_getSelectedColumns",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$adapter",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getConnection",70],"(",")",";",["T_WHITESPACE","\n\n        ",70],["T_IF","if",72],["T_WHITESPACE"," ",72],"(","!",["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_selectedColumns",72],")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","isTotals",73],"(",")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n                ",73],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","_selectedColumns",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getAggregatedColumns",74],"(",")",";",["T_WHITESPACE","\n            ",74],"}",["T_WHITESPACE"," ",75],["T_ELSE","else",75],["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_selectedColumns",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_ARRAY","array",76],"(",["T_WHITESPACE","\n                    ",76],["T_CONSTANT_ENCAPSED_STRING","'period'",77],["T_WHITESPACE","         ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE","  ",77],["T_STRING","sprintf",77],"(",["T_CONSTANT_ENCAPSED_STRING","'MAX(%s)'",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$adapter",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getDateFormatSql",77],"(",["T_CONSTANT_ENCAPSED_STRING","'period'",77],",",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","'%Y-%m-%d'",77],")",")",",",["T_WHITESPACE","\n                    ",77],["T_CONSTANT_ENCAPSED_STRING","'views_num'",78],["T_WHITESPACE","      ",78],["T_DOUBLE_ARROW","=>",78],["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'SUM(views_num)'",78],",",["T_WHITESPACE","\n                    ",78],["T_CONSTANT_ENCAPSED_STRING","'product_id'",79],["T_WHITESPACE","     ",79],["T_DOUBLE_ARROW","=>",79],["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'product_id'",79],",",["T_WHITESPACE","\n                    ",79],["T_CONSTANT_ENCAPSED_STRING","'product_name'",80],["T_WHITESPACE","   ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'MAX(product_name)'",80],",",["T_WHITESPACE","\n                    ",80],["T_CONSTANT_ENCAPSED_STRING","'product_price'",81],["T_WHITESPACE","  ",81],["T_DOUBLE_ARROW","=>",81],["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'MAX(product_price)'",81],",",["T_WHITESPACE","\n                ",81],")",";",["T_WHITESPACE","\n                ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_CONSTANT_ENCAPSED_STRING","'year'",83],["T_WHITESPACE"," ",83],["T_IS_EQUAL","==",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_period",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                    ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_selectedColumns",84],"[",["T_CONSTANT_ENCAPSED_STRING","'period'",84],"]",["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$adapter",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getDateFormatSql",84],"(",["T_CONSTANT_ENCAPSED_STRING","'period'",84],",",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'%Y'",84],")",";",["T_WHITESPACE","\n                ",84],"}",["T_WHITESPACE"," ",85],["T_ELSEIF","elseif",85],["T_WHITESPACE"," ",85],"(",["T_CONSTANT_ENCAPSED_STRING","'month'",85],["T_WHITESPACE"," ",85],["T_IS_EQUAL","==",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_period",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n                    ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_selectedColumns",86],"[",["T_CONSTANT_ENCAPSED_STRING","'period'",86],"]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$adapter",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getDateFormatSql",86],"(",["T_CONSTANT_ENCAPSED_STRING","'period'",86],",",["T_WHITESPACE"," ",86],["T_CONSTANT_ENCAPSED_STRING","'%Y-%m'",86],")",";",["T_WHITESPACE","\n                ",86],"}",["T_WHITESPACE","\n            ",87],"}",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_selectedColumns",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Make select object for date boundary\n     *\n     * @param mixed $from\n     * @param mixed $to\n     * @return Zend_Db_Select\n     *\/",93],["T_WHITESPACE","\n    ",99],["T_PROTECTED","protected",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","_makeBoundarySelect",100],"(",["T_VARIABLE","$from",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$to",100],")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_VARIABLE","$adapter",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getConnection",102],"(",")",";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$cols",103],["T_WHITESPACE","    ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_getSelectedColumns",103],"(",")",";",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$cols",104],"[",["T_CONSTANT_ENCAPSED_STRING","'views_num'",104],"]",["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'SUM(views_num)'",104],";",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$select",105],["T_WHITESPACE","  ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$adapter",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","select",105],"(",")",["T_WHITESPACE","\n            ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","from",106],"(",["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getResource",106],"(",")",["T_OBJECT_OPERATOR","->",106],["T_STRING","getMainTable",106],"(",")",",",["T_WHITESPACE"," ",106],["T_VARIABLE","$cols",106],")",["T_WHITESPACE","\n            ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","where",107],"(",["T_CONSTANT_ENCAPSED_STRING","'period >= ?'",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$from",107],")",["T_WHITESPACE","\n            ",107],["T_OBJECT_OPERATOR","->",108],["T_STRING","where",108],"(",["T_CONSTANT_ENCAPSED_STRING","'period <= ?'",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$to",108],")",["T_WHITESPACE","\n            ",108],["T_OBJECT_OPERATOR","->",109],["T_STRING","group",109],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",109],")",["T_WHITESPACE","\n            ",109],["T_OBJECT_OPERATOR","->",110],["T_STRING","order",110],"(",["T_CONSTANT_ENCAPSED_STRING","'views_num DESC'",110],")",["T_WHITESPACE","\n            ",110],["T_OBJECT_OPERATOR","->",111],["T_STRING","limit",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_ratingLimit",111],")",";",["T_WHITESPACE","\n\n        ",111],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_applyStoresFilterToSelect",113],"(",["T_VARIABLE","$select",113],")",";",["T_WHITESPACE","\n\n        ",113],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$select",115],";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Init collection select\n     *\n     * @return Mage_Reports_Model_Resource_Report_Product_Viewed_Collection\n     *\/",118],["T_WHITESPACE","\n    ",122],["T_PROTECTED","protected",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","_initSelect",123],"(",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$select",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getSelect",125],"(",")",";",["T_WHITESPACE","\n\n        ",125],["T_COMMENT","\/\/ if grouping by product, not by period\n",127],["T_WHITESPACE","        ",128],["T_IF","if",128],["T_WHITESPACE"," ",128],"(","!",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_period",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$cols",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","_getSelectedColumns",129],"(",")",";",["T_WHITESPACE","\n            ",129],["T_VARIABLE","$cols",130],"[",["T_CONSTANT_ENCAPSED_STRING","'views_num'",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","'SUM(views_num)'",130],";",["T_WHITESPACE","\n            ",130],["T_IF","if",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_from",131],["T_WHITESPACE"," ",131],["T_BOOLEAN_OR","||",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_to",131],")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n                ",131],["T_VARIABLE","$mainTable",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getTable",132],"(",["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed",132],["T_DOUBLE_COLON","::",132],["T_STRING","AGGREGATION_DAILY",132],")",";",["T_WHITESPACE","\n                ",132],["T_VARIABLE","$select",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","from",133],"(",["T_VARIABLE","$mainTable",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$cols",133],")",";",["T_WHITESPACE","\n            ",133],"}",["T_WHITESPACE"," ",134],["T_ELSE","else",134],["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                ",134],["T_VARIABLE","$mainTable",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getTable",135],"(",["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed",135],["T_DOUBLE_COLON","::",135],["T_STRING","AGGREGATION_YEARLY",135],")",";",["T_WHITESPACE","\n                ",135],["T_VARIABLE","$select",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","from",136],"(",["T_VARIABLE","$mainTable",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$cols",136],")",";",["T_WHITESPACE","\n            ",136],"}",["T_WHITESPACE","\n\n            ",137],["T_COMMENT","\/\/exclude removed products\n",139],["T_WHITESPACE","            ",140],["T_VARIABLE","$subSelect",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getConnection",140],"(",")",["T_OBJECT_OPERATOR","->",140],["T_STRING","select",140],"(",")",";",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$subSelect",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","from",141],"(",["T_ARRAY","array",141],"(",["T_CONSTANT_ENCAPSED_STRING","'existed_products'",141],["T_WHITESPACE"," ",141],["T_DOUBLE_ARROW","=>",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getTable",141],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",141],")",")",",",["T_WHITESPACE"," ",141],["T_NEW","new",141],["T_WHITESPACE"," ",141],["T_STRING","Zend_Db_Expr",141],"(",["T_CONSTANT_ENCAPSED_STRING","'1)'",141],")",")",";",["T_WHITESPACE","\n\n            ",141],["T_VARIABLE","$select",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","exists",143],"(",["T_VARIABLE","$subSelect",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$mainTable",143],["T_WHITESPACE"," ",143],".",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'.product_id = existed_products.entity_id'",143],")",["T_WHITESPACE","\n                ",143],["T_OBJECT_OPERATOR","->",144],["T_STRING","group",144],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",144],")",["T_WHITESPACE","\n                ",144],["T_OBJECT_OPERATOR","->",145],["T_STRING","order",145],"(",["T_CONSTANT_ENCAPSED_STRING","'views_num '",145],["T_WHITESPACE"," ",145],".",["T_WHITESPACE"," ",145],["T_STRING","Varien_Db_Select",145],["T_DOUBLE_COLON","::",145],["T_STRING","SQL_DESC",145],")",["T_WHITESPACE","\n                ",145],["T_OBJECT_OPERATOR","->",146],["T_STRING","limit",146],"(",["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_ratingLimit",146],")",";",["T_WHITESPACE","\n\n            ",146],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],";",["T_WHITESPACE","\n        ",148],"}",["T_WHITESPACE","\n\n        ",149],["T_IF","if",151],["T_WHITESPACE"," ",151],"(",["T_CONSTANT_ENCAPSED_STRING","'year'",151],["T_WHITESPACE"," ",151],["T_IS_EQUAL","==",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_period",151],")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n            ",151],["T_VARIABLE","$mainTable",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getTable",152],"(",["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed",152],["T_DOUBLE_COLON","::",152],["T_STRING","AGGREGATION_YEARLY",152],")",";",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$select",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","from",153],"(",["T_VARIABLE","$mainTable",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_getSelectedColumns",153],"(",")",")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE"," ",154],["T_ELSEIF","elseif",154],["T_WHITESPACE"," ",154],"(",["T_CONSTANT_ENCAPSED_STRING","'month'",154],["T_WHITESPACE"," ",154],["T_IS_EQUAL","==",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_period",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$mainTable",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getTable",155],"(",["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed",155],["T_DOUBLE_COLON","::",155],["T_STRING","AGGREGATION_MONTHLY",155],")",";",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$select",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","from",156],"(",["T_VARIABLE","$mainTable",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","_getSelectedColumns",156],"(",")",")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE"," ",157],["T_ELSE","else",157],["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$mainTable",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getTable",158],"(",["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed",158],["T_DOUBLE_COLON","::",158],["T_STRING","AGGREGATION_DAILY",158],")",";",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$select",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","from",159],"(",["T_VARIABLE","$mainTable",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_getSelectedColumns",159],"(",")",")",";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n        ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(","!",["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","isTotals",161],"(",")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$select",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","group",162],"(",["T_ARRAY","array",162],"(",["T_CONSTANT_ENCAPSED_STRING","'period'",162],",",["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","'product_id'",162],")",")",";",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n        ",163],["T_VARIABLE","$select",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","where",164],"(",["T_CONSTANT_ENCAPSED_STRING","'rating_pos <= ?'",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_ratingLimit",164],")",";",["T_WHITESPACE","\n\n        ",164],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n\n    ",167],["T_DOC_COMMENT","\/**\n     * Get SQL for get record count\n     *\n     * @return Varien_Db_Select\n     *\/",169],["T_WHITESPACE","\n    ",173],["T_PUBLIC","public",174],["T_WHITESPACE"," ",174],["T_FUNCTION","function",174],["T_WHITESPACE"," ",174],["T_STRING","getSelectCountSql",174],"(",")",["T_WHITESPACE","\n    ",174],"{",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","_renderFilters",176],"(",")",";",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$select",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_CLONE","clone",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getSelect",177],"(",")",";",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$select",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","reset",178],"(",["T_STRING","Zend_Db_Select",178],["T_DOUBLE_COLON","::",178],["T_STRING","ORDER",178],")",";",["T_WHITESPACE","\n        ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getConnection",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","select",179],"(",")",["T_OBJECT_OPERATOR","->",179],["T_STRING","from",179],"(",["T_VARIABLE","$select",179],",",["T_WHITESPACE"," ",179],["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",179],")",";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n\n    ",180],["T_DOC_COMMENT","\/**\n     * Set ids for store restrictions\n     *\n     * @param  array $storeIds\n     * @return Mage_Reports_Model_Resource_Report_Product_Viewed_Collection\n     *\/",182],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","addStoreRestrictions",188],"(",["T_VARIABLE","$storeIds",188],")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_STRING","is_array",190],"(",["T_VARIABLE","$storeIds",190],")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$storeIds",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_ARRAY","array",191],"(",["T_VARIABLE","$storeIds",191],")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$currentStoreIds",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","_storesIds",193],";",["T_WHITESPACE","\n        ",193],["T_IF","if",194],["T_WHITESPACE"," ",194],"(",["T_ISSET","isset",194],"(",["T_VARIABLE","$currentStoreIds",194],")",["T_WHITESPACE"," ",194],["T_BOOLEAN_AND","&&",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$currentStoreIds",194],["T_WHITESPACE"," ",194],["T_IS_NOT_EQUAL","!=",194],["T_WHITESPACE"," ",194],["T_STRING","Mage_Core_Model_App",194],["T_DOUBLE_COLON","::",194],["T_STRING","ADMIN_STORE_ID",194],["T_WHITESPACE","\n            ",194],["T_BOOLEAN_AND","&&",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$currentStoreIds",195],["T_WHITESPACE"," ",195],["T_IS_NOT_EQUAL","!=",195],["T_WHITESPACE"," ",195],["T_ARRAY","array",195],"(",["T_STRING","Mage_Core_Model_App",195],["T_DOUBLE_COLON","::",195],["T_STRING","ADMIN_STORE_ID",195],")",")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_IF","if",196],["T_WHITESPACE"," ",196],"(","!",["T_STRING","is_array",196],"(",["T_VARIABLE","$currentStoreIds",196],")",")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n                ",196],["T_VARIABLE","$currentStoreIds",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_ARRAY","array",197],"(",["T_VARIABLE","$currentStoreIds",197],")",";",["T_WHITESPACE","\n            ",197],"}",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","_storesIds",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_STRING","array_intersect",199],"(",["T_VARIABLE","$currentStoreIds",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$storeIds",199],")",";",["T_WHITESPACE","\n        ",199],"}",["T_WHITESPACE"," ",200],["T_ELSE","else",200],["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","_storesIds",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_VARIABLE","$storeIds",201],";",["T_WHITESPACE","\n        ",201],"}",["T_WHITESPACE","\n\n        ",202],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Redeclare parent method for applying filters after parent method\n     * but before adding unions and calculating totals\n     *\n     * @return Mage_Reports_Model_Resource_Report_Product_Viewed_Collection\n     *\/",207],["T_WHITESPACE","\n    ",212],["T_PROTECTED","protected",213],["T_WHITESPACE"," ",213],["T_FUNCTION","function",213],["T_WHITESPACE"," ",213],["T_STRING","_beforeLoad",213],"(",")",["T_WHITESPACE","\n    ",213],"{",["T_WHITESPACE","\n        ",214],["T_STRING","parent",215],["T_DOUBLE_COLON","::",215],["T_STRING","_beforeLoad",215],"(",")",";",["T_WHITESPACE","\n\n        ",215],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_applyStoresFilter",217],"(",")",";",["T_WHITESPACE","\n\n        ",217],["T_IF","if",219],["T_WHITESPACE"," ",219],"(",["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","_period",219],")",["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_VARIABLE","$selectUnions",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_ARRAY","array",220],"(",")",";",["T_WHITESPACE","\n\n            ",220],["T_COMMENT","\/\/ apply date boundaries (before calling $this->_applyDateRangeFilter())\n",222],["T_WHITESPACE","            ",223],["T_VARIABLE","$dtFormat",223],["T_WHITESPACE","   ",223],"=",["T_WHITESPACE"," ",223],["T_STRING","Varien_Date",223],["T_DOUBLE_COLON","::",223],["T_STRING","DATE_INTERNAL_FORMAT",223],";",["T_WHITESPACE","\n            ",223],["T_VARIABLE","$periodFrom",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],"(","!",["T_STRING","is_null",224],"(",["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_from",224],")",["T_WHITESPACE"," ",224],"?",["T_WHITESPACE"," ",224],["T_NEW","new",224],["T_WHITESPACE"," ",224],["T_STRING","Zend_Date",224],"(",["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","_from",224],",",["T_WHITESPACE"," ",224],["T_VARIABLE","$dtFormat",224],")",["T_WHITESPACE"," ",224],":",["T_WHITESPACE"," ",224],["T_STRING","null",224],")",";",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$periodTo",225],["T_WHITESPACE","   ",225],"=",["T_WHITESPACE"," ",225],"(","!",["T_STRING","is_null",225],"(",["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_to",225],")",["T_WHITESPACE","   ",225],"?",["T_WHITESPACE"," ",225],["T_NEW","new",225],["T_WHITESPACE"," ",225],["T_STRING","Zend_Date",225],"(",["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_to",225],",",["T_WHITESPACE","   ",225],["T_VARIABLE","$dtFormat",225],")",["T_WHITESPACE"," ",225],":",["T_WHITESPACE"," ",225],["T_STRING","null",225],")",";",["T_WHITESPACE","\n            ",225],["T_IF","if",226],["T_WHITESPACE"," ",226],"(",["T_CONSTANT_ENCAPSED_STRING","'year'",226],["T_WHITESPACE"," ",226],["T_IS_EQUAL","==",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_period",226],")",["T_WHITESPACE"," ",226],"{",["T_WHITESPACE","\n\n                ",226],["T_IF","if",228],["T_WHITESPACE"," ",228],"(",["T_VARIABLE","$periodFrom",228],")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n                    ",228],["T_COMMENT","\/\/ not the first day of the year\n",229],["T_WHITESPACE","                    ",230],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$periodFrom",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","toValue",230],"(",["T_STRING","Zend_Date",230],["T_DOUBLE_COLON","::",230],["T_STRING","MONTH",230],")",["T_WHITESPACE"," ",230],["T_IS_NOT_EQUAL","!=",230],["T_WHITESPACE"," ",230],["T_LNUMBER","1",230],["T_WHITESPACE"," ",230],["T_BOOLEAN_OR","||",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$periodFrom",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","toValue",230],"(",["T_STRING","Zend_Date",230],["T_DOUBLE_COLON","::",230],["T_STRING","DAY",230],")",["T_WHITESPACE"," ",230],["T_IS_NOT_EQUAL","!=",230],["T_WHITESPACE"," ",230],["T_LNUMBER","1",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n                        ",230],["T_VARIABLE","$dtFrom",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$periodFrom",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getDate",231],"(",")",";",["T_WHITESPACE","\n                        ",231],["T_COMMENT","\/\/ last day of the year\n",232],["T_WHITESPACE","                        ",233],["T_VARIABLE","$dtTo",233],["T_WHITESPACE"," ",233],"=",["T_WHITESPACE"," ",233],["T_VARIABLE","$periodFrom",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getDate",233],"(",")",["T_OBJECT_OPERATOR","->",233],["T_STRING","setMonth",233],"(",["T_LNUMBER","12",233],")",["T_OBJECT_OPERATOR","->",233],["T_STRING","setDay",233],"(",["T_LNUMBER","31",233],")",";",["T_WHITESPACE","\n                        ",233],["T_IF","if",234],["T_WHITESPACE"," ",234],"(","!",["T_VARIABLE","$periodTo",234],["T_WHITESPACE"," ",234],["T_BOOLEAN_OR","||",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$dtTo",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","isEarlier",234],"(",["T_VARIABLE","$periodTo",234],")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n                            ",234],["T_VARIABLE","$selectUnions",235],"[","]",["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_makeBoundarySelect",235],"(",["T_WHITESPACE","\n                                ",235],["T_VARIABLE","$dtFrom",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","toString",236],"(",["T_VARIABLE","$dtFormat",236],")",",",["T_WHITESPACE","\n                                ",236],["T_VARIABLE","$dtTo",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","toString",237],"(",["T_VARIABLE","$dtFormat",237],")",["T_WHITESPACE","\n                            ",237],")",";",["T_WHITESPACE","\n\n                            ",238],["T_COMMENT","\/\/ first day of the next year\n",240],["T_WHITESPACE","                            ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_from",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_VARIABLE","$periodFrom",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getDate",241],"(",")",["T_WHITESPACE","\n                                ",241],["T_OBJECT_OPERATOR","->",242],["T_STRING","addYear",242],"(",["T_LNUMBER","1",242],")",["T_WHITESPACE","\n                                ",242],["T_OBJECT_OPERATOR","->",243],["T_STRING","setMonth",243],"(",["T_LNUMBER","1",243],")",["T_WHITESPACE","\n                                ",243],["T_OBJECT_OPERATOR","->",244],["T_STRING","setDay",244],"(",["T_LNUMBER","1",244],")",["T_WHITESPACE","\n                                ",244],["T_OBJECT_OPERATOR","->",245],["T_STRING","toString",245],"(",["T_VARIABLE","$dtFormat",245],")",";",["T_WHITESPACE","\n                        ",245],"}",["T_WHITESPACE","\n                    ",246],"}",["T_WHITESPACE","\n                ",247],"}",["T_WHITESPACE","\n\n                ",248],["T_IF","if",250],["T_WHITESPACE"," ",250],"(",["T_VARIABLE","$periodTo",250],")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n                    ",250],["T_COMMENT","\/\/ not the last day of the year\n",251],["T_WHITESPACE","                    ",252],["T_IF","if",252],["T_WHITESPACE"," ",252],"(",["T_VARIABLE","$periodTo",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","toValue",252],"(",["T_STRING","Zend_Date",252],["T_DOUBLE_COLON","::",252],["T_STRING","MONTH",252],")",["T_WHITESPACE"," ",252],["T_IS_NOT_EQUAL","!=",252],["T_WHITESPACE"," ",252],["T_LNUMBER","12",252],["T_WHITESPACE"," ",252],["T_BOOLEAN_OR","||",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$periodTo",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","toValue",252],"(",["T_STRING","Zend_Date",252],["T_DOUBLE_COLON","::",252],["T_STRING","DAY",252],")",["T_WHITESPACE"," ",252],["T_IS_NOT_EQUAL","!=",252],["T_WHITESPACE"," ",252],["T_LNUMBER","31",252],")",["T_WHITESPACE"," ",252],"{",["T_WHITESPACE","\n                        ",252],["T_VARIABLE","$dtFrom",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$periodTo",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","getDate",253],"(",")",["T_OBJECT_OPERATOR","->",253],["T_STRING","setMonth",253],"(",["T_LNUMBER","1",253],")",["T_OBJECT_OPERATOR","->",253],["T_STRING","setDay",253],"(",["T_LNUMBER","1",253],")",";",["T_WHITESPACE","  ",253],["T_COMMENT","\/\/ first day of the year\n",253],["T_WHITESPACE","                        ",254],["T_VARIABLE","$dtTo",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$periodTo",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","getDate",254],"(",")",";",["T_WHITESPACE","\n                        ",254],["T_IF","if",255],["T_WHITESPACE"," ",255],"(","!",["T_VARIABLE","$periodFrom",255],["T_WHITESPACE"," ",255],["T_BOOLEAN_OR","||",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$dtFrom",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","isLater",255],"(",["T_VARIABLE","$periodFrom",255],")",")",["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n                            ",255],["T_VARIABLE","$selectUnions",256],"[","]",["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","_makeBoundarySelect",256],"(",["T_WHITESPACE","\n                                ",256],["T_VARIABLE","$dtFrom",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","toString",257],"(",["T_VARIABLE","$dtFormat",257],")",",",["T_WHITESPACE","\n                                ",257],["T_VARIABLE","$dtTo",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","toString",258],"(",["T_VARIABLE","$dtFormat",258],")",["T_WHITESPACE","\n                            ",258],")",";",["T_WHITESPACE","\n\n                            ",259],["T_COMMENT","\/\/ last day of the previous year\n",261],["T_WHITESPACE","                            ",262],["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","_to",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$periodTo",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getDate",262],"(",")",["T_WHITESPACE","\n                                ",262],["T_OBJECT_OPERATOR","->",263],["T_STRING","subYear",263],"(",["T_LNUMBER","1",263],")",["T_WHITESPACE","\n                                ",263],["T_OBJECT_OPERATOR","->",264],["T_STRING","setMonth",264],"(",["T_LNUMBER","12",264],")",["T_WHITESPACE","\n                                ",264],["T_OBJECT_OPERATOR","->",265],["T_STRING","setDay",265],"(",["T_LNUMBER","31",265],")",["T_WHITESPACE","\n                                ",265],["T_OBJECT_OPERATOR","->",266],["T_STRING","toString",266],"(",["T_VARIABLE","$dtFormat",266],")",";",["T_WHITESPACE","\n                        ",266],"}",["T_WHITESPACE","\n                    ",267],"}",["T_WHITESPACE","\n                ",268],"}",["T_WHITESPACE","\n\n                ",269],["T_IF","if",271],["T_WHITESPACE"," ",271],"(",["T_VARIABLE","$periodFrom",271],["T_WHITESPACE"," ",271],["T_BOOLEAN_AND","&&",271],["T_WHITESPACE"," ",271],["T_VARIABLE","$periodTo",271],")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n                    ",271],["T_COMMENT","\/\/ the same year\n",272],["T_WHITESPACE","                    ",273],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_VARIABLE","$periodFrom",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","toValue",273],"(",["T_STRING","Zend_Date",273],["T_DOUBLE_COLON","::",273],["T_STRING","YEAR",273],")",["T_WHITESPACE"," ",273],["T_IS_EQUAL","==",273],["T_WHITESPACE"," ",273],["T_VARIABLE","$periodTo",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","toValue",273],"(",["T_STRING","Zend_Date",273],["T_DOUBLE_COLON","::",273],["T_STRING","YEAR",273],")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n                        ",273],["T_VARIABLE","$dtFrom",274],["T_WHITESPACE"," ",274],"=",["T_WHITESPACE"," ",274],["T_VARIABLE","$periodFrom",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getDate",274],"(",")",";",["T_WHITESPACE","\n                        ",274],["T_VARIABLE","$dtTo",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$periodTo",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","getDate",275],"(",")",";",["T_WHITESPACE","\n                        ",275],["T_VARIABLE","$selectUnions",276],"[","]",["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_VARIABLE","$this",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","_makeBoundarySelect",276],"(",["T_WHITESPACE","\n                            ",276],["T_VARIABLE","$dtFrom",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","toString",277],"(",["T_VARIABLE","$dtFormat",277],")",",",["T_WHITESPACE","\n                            ",277],["T_VARIABLE","$dtTo",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","toString",278],"(",["T_VARIABLE","$dtFormat",278],")",["T_WHITESPACE","\n                        ",278],")",";",["T_WHITESPACE","\n\n                        ",279],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getSelect",281],"(",")",["T_OBJECT_OPERATOR","->",281],["T_STRING","where",281],"(",["T_CONSTANT_ENCAPSED_STRING","'1<>1'",281],")",";",["T_WHITESPACE","\n                    ",281],"}",["T_WHITESPACE","\n                ",282],"}",["T_WHITESPACE","\n\n            ",283],"}",["T_WHITESPACE","\n            ",285],["T_ELSE","else",286],["T_WHITESPACE"," ",286],["T_IF","if",286],["T_WHITESPACE"," ",286],"(",["T_CONSTANT_ENCAPSED_STRING","'month'",286],["T_WHITESPACE"," ",286],["T_IS_EQUAL","==",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_period",286],")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n                ",286],["T_IF","if",287],["T_WHITESPACE"," ",287],"(",["T_VARIABLE","$periodFrom",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n                    ",287],["T_COMMENT","\/\/ not the first day of the month\n",288],["T_WHITESPACE","                    ",289],["T_IF","if",289],["T_WHITESPACE"," ",289],"(",["T_VARIABLE","$periodFrom",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","toValue",289],"(",["T_STRING","Zend_Date",289],["T_DOUBLE_COLON","::",289],["T_STRING","DAY",289],")",["T_WHITESPACE"," ",289],["T_IS_NOT_EQUAL","!=",289],["T_WHITESPACE"," ",289],["T_LNUMBER","1",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n                        ",289],["T_VARIABLE","$dtFrom",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$periodFrom",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","getDate",290],"(",")",";",["T_WHITESPACE","\n                        ",290],["T_COMMENT","\/\/ last day of the month\n",291],["T_WHITESPACE","                        ",292],["T_VARIABLE","$dtTo",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$periodFrom",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getDate",292],"(",")",["T_OBJECT_OPERATOR","->",292],["T_STRING","addMonth",292],"(",["T_LNUMBER","1",292],")",["T_OBJECT_OPERATOR","->",292],["T_STRING","setDay",292],"(",["T_LNUMBER","1",292],")",["T_OBJECT_OPERATOR","->",292],["T_STRING","subDay",292],"(",["T_LNUMBER","1",292],")",";",["T_WHITESPACE","\n                        ",292],["T_IF","if",293],["T_WHITESPACE"," ",293],"(","!",["T_VARIABLE","$periodTo",293],["T_WHITESPACE"," ",293],["T_BOOLEAN_OR","||",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$dtTo",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","isEarlier",293],"(",["T_VARIABLE","$periodTo",293],")",")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n                            ",293],["T_VARIABLE","$selectUnions",294],"[","]",["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","_makeBoundarySelect",294],"(",["T_WHITESPACE","\n                                ",294],["T_VARIABLE","$dtFrom",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","toString",295],"(",["T_VARIABLE","$dtFormat",295],")",",",["T_WHITESPACE","\n                                ",295],["T_VARIABLE","$dtTo",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","toString",296],"(",["T_VARIABLE","$dtFormat",296],")",["T_WHITESPACE","\n                            ",296],")",";",["T_WHITESPACE","\n\n                            ",297],["T_COMMENT","\/\/ first day of the next month\n",299],["T_WHITESPACE","                            ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","_from",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_VARIABLE","$periodFrom",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getDate",300],"(",")",["T_OBJECT_OPERATOR","->",300],["T_STRING","addMonth",300],"(",["T_LNUMBER","1",300],")",["T_OBJECT_OPERATOR","->",300],["T_STRING","setDay",300],"(",["T_LNUMBER","1",300],")",["T_OBJECT_OPERATOR","->",300],["T_STRING","toString",300],"(",["T_VARIABLE","$dtFormat",300],")",";",["T_WHITESPACE","\n                        ",300],"}",["T_WHITESPACE","\n                    ",301],"}",["T_WHITESPACE","\n                ",302],"}",["T_WHITESPACE","\n\n                ",303],["T_IF","if",305],["T_WHITESPACE"," ",305],"(",["T_VARIABLE","$periodTo",305],")",["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n                    ",305],["T_COMMENT","\/\/ not the last day of the month\n",306],["T_WHITESPACE","                    ",307],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_VARIABLE","$periodTo",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","toValue",307],"(",["T_STRING","Zend_Date",307],["T_DOUBLE_COLON","::",307],["T_STRING","DAY",307],")",["T_WHITESPACE"," ",307],["T_IS_NOT_EQUAL","!=",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$periodTo",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","toValue",307],"(",["T_STRING","Zend_Date",307],["T_DOUBLE_COLON","::",307],["T_STRING","MONTH_DAYS",307],")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n                        ",307],["T_VARIABLE","$dtFrom",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_VARIABLE","$periodTo",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getDate",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","setDay",308],"(",["T_LNUMBER","1",308],")",";",["T_WHITESPACE","  ",308],["T_COMMENT","\/\/ first day of the month\n",308],["T_WHITESPACE","                        ",309],["T_VARIABLE","$dtTo",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$periodTo",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getDate",309],"(",")",";",["T_WHITESPACE","\n                        ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(","!",["T_VARIABLE","$periodFrom",310],["T_WHITESPACE"," ",310],["T_BOOLEAN_OR","||",310],["T_WHITESPACE"," ",310],["T_VARIABLE","$dtFrom",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","isLater",310],"(",["T_VARIABLE","$periodFrom",310],")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                            ",310],["T_VARIABLE","$selectUnions",311],"[","]",["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_makeBoundarySelect",311],"(",["T_WHITESPACE","\n                                ",311],["T_VARIABLE","$dtFrom",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","toString",312],"(",["T_VARIABLE","$dtFormat",312],")",",",["T_WHITESPACE","\n                                ",312],["T_VARIABLE","$dtTo",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","toString",313],"(",["T_VARIABLE","$dtFormat",313],")",["T_WHITESPACE","\n                            ",313],")",";",["T_WHITESPACE","\n\n                            ",314],["T_COMMENT","\/\/ last day of the previous month\n",316],["T_WHITESPACE","                            ",317],["T_VARIABLE","$this",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","_to",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_VARIABLE","$periodTo",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","getDate",317],"(",")",["T_OBJECT_OPERATOR","->",317],["T_STRING","setDay",317],"(",["T_LNUMBER","1",317],")",["T_OBJECT_OPERATOR","->",317],["T_STRING","subDay",317],"(",["T_LNUMBER","1",317],")",["T_OBJECT_OPERATOR","->",317],["T_STRING","toString",317],"(",["T_VARIABLE","$dtFormat",317],")",";",["T_WHITESPACE","\n                        ",317],"}",["T_WHITESPACE","\n                    ",318],"}",["T_WHITESPACE","\n                ",319],"}",["T_WHITESPACE","\n\n                ",320],["T_IF","if",322],["T_WHITESPACE"," ",322],"(",["T_VARIABLE","$periodFrom",322],["T_WHITESPACE"," ",322],["T_BOOLEAN_AND","&&",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$periodTo",322],")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n                    ",322],["T_COMMENT","\/\/ the same month\n",323],["T_WHITESPACE","                    ",324],["T_IF","if",324],["T_WHITESPACE"," ",324],"(",["T_VARIABLE","$periodFrom",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","toValue",324],"(",["T_STRING","Zend_Date",324],["T_DOUBLE_COLON","::",324],["T_STRING","YEAR",324],")",["T_WHITESPACE"," ",324],["T_IS_EQUAL","==",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$periodTo",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","toValue",324],"(",["T_STRING","Zend_Date",324],["T_DOUBLE_COLON","::",324],["T_STRING","YEAR",324],")",["T_WHITESPACE","\n                        ",324],["T_BOOLEAN_AND","&&",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$periodFrom",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","toValue",325],"(",["T_STRING","Zend_Date",325],["T_DOUBLE_COLON","::",325],["T_STRING","MONTH",325],")",["T_WHITESPACE"," ",325],["T_IS_EQUAL","==",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$periodTo",325],["T_OBJECT_OPERATOR","->",325],["T_STRING","toValue",325],"(",["T_STRING","Zend_Date",325],["T_DOUBLE_COLON","::",325],["T_STRING","MONTH",325],")",["T_WHITESPACE","\n                    ",325],")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n                        ",326],["T_VARIABLE","$dtFrom",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_VARIABLE","$periodFrom",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getDate",327],"(",")",";",["T_WHITESPACE","\n                        ",327],["T_VARIABLE","$dtTo",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_VARIABLE","$periodTo",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","getDate",328],"(",")",";",["T_WHITESPACE","\n                        ",328],["T_VARIABLE","$selectUnions",329],"[","]",["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_makeBoundarySelect",329],"(",["T_WHITESPACE","\n                            ",329],["T_VARIABLE","$dtFrom",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","toString",330],"(",["T_VARIABLE","$dtFormat",330],")",",",["T_WHITESPACE","\n                            ",330],["T_VARIABLE","$dtTo",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","toString",331],"(",["T_VARIABLE","$dtFormat",331],")",["T_WHITESPACE","\n                        ",331],")",";",["T_WHITESPACE","\n\n                        ",332],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getSelect",334],"(",")",["T_OBJECT_OPERATOR","->",334],["T_STRING","where",334],"(",["T_CONSTANT_ENCAPSED_STRING","'1<>1'",334],")",";",["T_WHITESPACE","\n                    ",334],"}",["T_WHITESPACE","\n                ",335],"}",["T_WHITESPACE","\n\n            ",336],"}",["T_WHITESPACE","\n\n            ",338],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","_applyDateRangeFilter",340],"(",")",";",["T_WHITESPACE","\n\n            ",340],["T_COMMENT","\/\/ add unions to select\n",342],["T_WHITESPACE","            ",343],["T_IF","if",343],["T_WHITESPACE"," ",343],"(",["T_VARIABLE","$selectUnions",343],")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n                ",343],["T_VARIABLE","$unionParts",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_ARRAY","array",344],"(",")",";",["T_WHITESPACE","\n                ",344],["T_VARIABLE","$cloneSelect",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_CLONE","clone",345],["T_WHITESPACE"," ",345],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getSelect",345],"(",")",";",["T_WHITESPACE","\n                ",345],["T_VARIABLE","$helper",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_STRING","Mage",346],["T_DOUBLE_COLON","::",346],["T_STRING","getResourceHelper",346],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",346],")",";",["T_WHITESPACE","\n                ",346],["T_VARIABLE","$unionParts",347],"[","]",["T_WHITESPACE"," ",347],"=",["T_WHITESPACE"," ",347],["T_CONSTANT_ENCAPSED_STRING","'('",347],["T_WHITESPACE"," ",347],".",["T_WHITESPACE"," ",347],["T_VARIABLE","$cloneSelect",347],["T_WHITESPACE"," ",347],".",["T_WHITESPACE"," ",347],["T_CONSTANT_ENCAPSED_STRING","')'",347],";",["T_WHITESPACE","\n                ",347],["T_FOREACH","foreach",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$selectUnions",348],["T_WHITESPACE"," ",348],["T_AS","as",348],["T_WHITESPACE"," ",348],["T_VARIABLE","$union",348],")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n                    ",348],["T_VARIABLE","$query",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_VARIABLE","$helper",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","getQueryUsingAnalyticFunction",349],"(",["T_VARIABLE","$union",349],")",";",["T_WHITESPACE","\n                    ",349],["T_VARIABLE","$unionParts",350],"[","]",["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_CONSTANT_ENCAPSED_STRING","'('",350],["T_WHITESPACE"," ",350],".",["T_WHITESPACE"," ",350],["T_VARIABLE","$query",350],["T_WHITESPACE"," ",350],".",["T_WHITESPACE"," ",350],["T_CONSTANT_ENCAPSED_STRING","')'",350],";",["T_WHITESPACE","\n                ",350],"}",["T_WHITESPACE","\n                ",351],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getSelect",352],"(",")",["T_OBJECT_OPERATOR","->",352],["T_STRING","reset",352],"(",")",["T_OBJECT_OPERATOR","->",352],["T_STRING","union",352],"(",["T_VARIABLE","$unionParts",352],",",["T_WHITESPACE"," ",352],["T_STRING","Zend_Db_Select",352],["T_DOUBLE_COLON","::",352],["T_STRING","SQL_UNION_ALL",352],")",";",["T_WHITESPACE","\n            ",352],"}",["T_WHITESPACE","\n\n            ",353],["T_IF","if",355],["T_WHITESPACE"," ",355],"(",["T_VARIABLE","$this",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","isTotals",355],"(",")",")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n                ",355],["T_COMMENT","\/\/ calculate total\n",356],["T_WHITESPACE","                ",357],["T_VARIABLE","$cloneSelect",357],["T_WHITESPACE"," ",357],"=",["T_WHITESPACE"," ",357],["T_CLONE","clone",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$this",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getSelect",357],"(",")",";",["T_WHITESPACE","\n                ",357],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getSelect",358],"(",")",["T_OBJECT_OPERATOR","->",358],["T_STRING","reset",358],"(",")",["T_OBJECT_OPERATOR","->",358],["T_STRING","from",358],"(",["T_VARIABLE","$cloneSelect",358],",",["T_WHITESPACE"," ",358],["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","getAggregatedColumns",358],"(",")",")",";",["T_WHITESPACE","\n            ",358],"}",["T_WHITESPACE"," ",359],["T_ELSE","else",359],["T_WHITESPACE"," ",359],"{",["T_WHITESPACE","\n                ",359],["T_COMMENT","\/\/ add sorting\n",360],["T_WHITESPACE","                ",361],["T_VARIABLE","$this",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","getSelect",361],"(",")",["T_OBJECT_OPERATOR","->",361],["T_STRING","order",361],"(",["T_ARRAY","array",361],"(",["T_CONSTANT_ENCAPSED_STRING","'period ASC'",361],",",["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","'views_num DESC'",361],")",")",";",["T_WHITESPACE","\n            ",361],"}",["T_WHITESPACE","\n        ",362],"}",["T_WHITESPACE","\n\n        ",363],["T_RETURN","return",365],["T_WHITESPACE"," ",365],["T_VARIABLE","$this",365],";",["T_WHITESPACE","\n    ",365],"}",["T_WHITESPACE","\n",366],"}",["T_WHITESPACE","\n",367]]