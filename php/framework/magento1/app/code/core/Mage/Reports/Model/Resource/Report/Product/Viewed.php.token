[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Reports\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Most viewed product report aggregate resource model\n *\n * @category    Mage\n * @package     Mage_Reports\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Reports_Model_Resource_Report_Product_Viewed",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Sales_Model_Resource_Report_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","AGGREGATION_DAILY",37],["T_WHITESPACE","   ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'reports\/viewed_aggregated_daily'",37],";",["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","AGGREGATION_MONTHLY",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'reports\/viewed_aggregated_monthly'",38],";",["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","AGGREGATION_YEARLY",39],["T_WHITESPACE","  ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'reports\/viewed_aggregated_yearly'",39],";",["T_WHITESPACE","\n\n    ",39],["T_DOC_COMMENT","\/**\n     * Model initialization\n     *\n     *\/",41],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","_construct",45],"(",")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_init",47],"(",["T_STRING","self",47],["T_DOUBLE_COLON","::",47],["T_STRING","AGGREGATION_DAILY",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'id'",47],")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Aggregate products view data\n     *\n     * @param mixed $from\n     * @param mixed $to\n     * @return Mage_Sales_Model_Resource_Report_Bestsellers\n     *\/",50],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","aggregate",57],"(",["T_VARIABLE","$from",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","null",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$to",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","null",57],")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$mainTable",59],["T_WHITESPACE","   ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","getMainTable",59],"(",")",";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$adapter",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_getWriteAdapter",60],"(",")",";",["T_WHITESPACE","\n\n        ",60],["T_COMMENT","\/\/ convert input dates to UTC to be comparable with DATETIME fields in DB\n",62],["T_WHITESPACE","        ",63],["T_VARIABLE","$from",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","_dateToUtc",63],"(",["T_VARIABLE","$from",63],")",";",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$to",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_dateToUtc",64],"(",["T_VARIABLE","$to",64],")",";",["T_WHITESPACE","\n\n        ",64],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","_checkDates",66],"(",["T_VARIABLE","$from",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$to",66],")",";",["T_WHITESPACE","\n\n        ",66],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$from",68],["T_WHITESPACE"," ",68],["T_IS_NOT_IDENTICAL","!==",68],["T_WHITESPACE"," ",68],["T_STRING","null",68],["T_WHITESPACE"," ",68],["T_BOOLEAN_OR","||",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$to",68],["T_WHITESPACE"," ",68],["T_IS_NOT_IDENTICAL","!==",68],["T_WHITESPACE"," ",68],["T_STRING","null",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n            ",68],["T_VARIABLE","$subSelect",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","_getTableDateRangeSelect",69],"(",["T_WHITESPACE","\n                ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getTable",70],"(",["T_CONSTANT_ENCAPSED_STRING","'reports\/event'",70],")",",",["T_WHITESPACE","\n                ",70],["T_CONSTANT_ENCAPSED_STRING","'logged_at'",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'logged_at'",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$from",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$to",71],["T_WHITESPACE","\n            ",71],")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE"," ",73],["T_ELSE","else",73],["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$subSelect",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","null",74],";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","_clearTableByDateRange",76],"(",["T_VARIABLE","$mainTable",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$from",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$to",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$subSelect",76],")",";",["T_WHITESPACE","\n        ",76],["T_COMMENT","\/\/ convert dates from UTC to current admin timezone\n",77],["T_WHITESPACE","        ",78],["T_VARIABLE","$periodExpr",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$adapter",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getDatePartSql",78],"(",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getStoreTZOffsetQuery",79],"(",["T_WHITESPACE","\n                ",79],["T_ARRAY","array",80],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getTable",80],"(",["T_CONSTANT_ENCAPSED_STRING","'reports\/event'",80],")",")",",",["T_WHITESPACE","\n                ",80],["T_CONSTANT_ENCAPSED_STRING","'source_table.logged_at'",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$from",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$to",81],["T_WHITESPACE","\n            ",81],")",["T_WHITESPACE","\n        ",82],")",";",["T_WHITESPACE","\n\n        ",83],["T_VARIABLE","$helper",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","getResourceHelper",85],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",85],")",";",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$select",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$adapter",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","select",86],"(",")",";",["T_WHITESPACE","\n\n        ",86],["T_VARIABLE","$select",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","group",88],"(",["T_ARRAY","array",88],"(",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$periodExpr",89],",",["T_WHITESPACE","\n            ",89],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",90],",",["T_WHITESPACE","\n            ",90],["T_CONSTANT_ENCAPSED_STRING","'source_table.object_id'",91],["T_WHITESPACE","\n        ",91],")",")",";",["T_WHITESPACE","\n\n        ",92],["T_VARIABLE","$viewsNumExpr",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_NEW","new",94],["T_WHITESPACE"," ",94],["T_STRING","Zend_Db_Expr",94],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(source_table.event_id)'",94],")",";",["T_WHITESPACE","\n\n        ",94],["T_VARIABLE","$columns",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_ARRAY","array",96],"(",["T_WHITESPACE","\n            ",96],["T_CONSTANT_ENCAPSED_STRING","'period'",97],["T_WHITESPACE","                 ",97],["T_DOUBLE_ARROW","=>",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$periodExpr",97],",",["T_WHITESPACE","\n            ",97],["T_CONSTANT_ENCAPSED_STRING","'store_id'",98],["T_WHITESPACE","               ",98],["T_DOUBLE_ARROW","=>",98],["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'source_table.store_id'",98],",",["T_WHITESPACE","\n            ",98],["T_CONSTANT_ENCAPSED_STRING","'product_id'",99],["T_WHITESPACE","             ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'source_table.object_id'",99],",",["T_WHITESPACE","\n            ",99],["T_CONSTANT_ENCAPSED_STRING","'product_name'",100],["T_WHITESPACE","           ",100],["T_DOUBLE_ARROW","=>",100],["T_WHITESPACE"," ",100],["T_NEW","new",100],["T_WHITESPACE"," ",100],["T_STRING","Zend_Db_Expr",100],"(",["T_WHITESPACE","\n                ",100],["T_STRING","sprintf",101],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(%s)'",101],",",["T_WHITESPACE","\n                    ",101],["T_VARIABLE","$adapter",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getIfNullSql",102],"(",["T_CONSTANT_ENCAPSED_STRING","'product_name.value'",102],",",["T_CONSTANT_ENCAPSED_STRING","'product_default_name.value'",102],")",["T_WHITESPACE","\n                ",102],")",["T_WHITESPACE","\n            ",103],")",",",["T_WHITESPACE","\n            ",104],["T_CONSTANT_ENCAPSED_STRING","'product_price'",105],["T_WHITESPACE","          ",105],["T_DOUBLE_ARROW","=>",105],["T_WHITESPACE"," ",105],["T_NEW","new",105],["T_WHITESPACE"," ",105],["T_STRING","Zend_Db_Expr",105],"(",["T_WHITESPACE","\n                ",105],["T_STRING","sprintf",106],"(",["T_CONSTANT_ENCAPSED_STRING","'%s'",106],",",["T_WHITESPACE","\n                    ",106],["T_VARIABLE","$helper",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","prepareColumn",107],"(",["T_WHITESPACE","\n                        ",107],["T_STRING","sprintf",108],"(",["T_CONSTANT_ENCAPSED_STRING","'MIN(%s)'",108],",",["T_WHITESPACE","\n                            ",108],["T_VARIABLE","$adapter",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getIfNullSql",109],"(",["T_WHITESPACE","\n                                ",109],["T_VARIABLE","$adapter",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","getIfNullSql",110],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price.value'",110],",",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.value'",110],")",",",["T_WHITESPACE"," ",110],["T_LNUMBER","0",110],")",["T_WHITESPACE","\n                        ",110],")",",",["T_WHITESPACE","\n                        ",111],["T_VARIABLE","$select",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getPart",112],"(",["T_STRING","Zend_Db_Select",112],["T_DOUBLE_COLON","::",112],["T_STRING","GROUP",112],")",["T_WHITESPACE","\n                    ",112],")",["T_WHITESPACE","\n                ",113],")",["T_WHITESPACE","\n            ",114],")",",",["T_WHITESPACE","\n            ",115],["T_CONSTANT_ENCAPSED_STRING","'views_num'",116],["T_WHITESPACE","            ",116],["T_DOUBLE_ARROW","=>",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$viewsNumExpr",116],["T_WHITESPACE","\n        ",116],")",";",["T_WHITESPACE","\n\n        ",117],["T_VARIABLE","$select",119],["T_WHITESPACE","\n            ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","from",120],"(",["T_WHITESPACE","\n                ",120],["T_ARRAY","array",121],"(",["T_WHITESPACE","\n                    ",121],["T_CONSTANT_ENCAPSED_STRING","'source_table'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getTable",122],"(",["T_CONSTANT_ENCAPSED_STRING","'reports\/event'",122],")",")",",",["T_WHITESPACE","\n                ",122],["T_VARIABLE","$columns",123],")",["T_WHITESPACE","\n            ",123],["T_OBJECT_OPERATOR","->",124],["T_STRING","where",124],"(",["T_CONSTANT_ENCAPSED_STRING","'source_table.event_type_id = ?'",124],",",["T_WHITESPACE"," ",124],["T_STRING","Mage_Reports_Model_Event",124],["T_DOUBLE_COLON","::",124],["T_STRING","EVENT_PRODUCT_VIEW",124],")",";",["T_WHITESPACE","\n\n        ",124],["T_DOC_COMMENT","\/** @var Mage_Catalog_Model_Resource_Product $product *\/",126],["T_WHITESPACE","\n        ",126],["T_VARIABLE","$product",127],["T_WHITESPACE","  ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","Mage",127],["T_DOUBLE_COLON","::",127],["T_STRING","getResourceSingleton",127],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",127],")",";",["T_WHITESPACE","\n\n        ",127],["T_VARIABLE","$select",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","joinInner",129],"(",["T_WHITESPACE","\n            ",129],["T_ARRAY","array",130],"(",["T_WHITESPACE","\n                ",130],["T_CONSTANT_ENCAPSED_STRING","'product'",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getTable",131],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",131],")",")",",",["T_WHITESPACE","\n            ",131],["T_CONSTANT_ENCAPSED_STRING","'product.entity_id = source_table.object_id'",132],",",["T_WHITESPACE","\n            ",132],["T_ARRAY","array",133],"(",")",["T_WHITESPACE","\n        ",133],")",";",["T_WHITESPACE","\n\n        ",134],["T_COMMENT","\/\/ join product attributes Name & Price\n",136],["T_WHITESPACE","        ",137],["T_VARIABLE","$nameAttribute",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$product",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getAttribute",137],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$joinExprProductName",138],["T_WHITESPACE","       ",138],"=",["T_WHITESPACE"," ",138],["T_ARRAY","array",138],"(",["T_WHITESPACE","\n            ",138],["T_CONSTANT_ENCAPSED_STRING","'product_name.entity_id = product.entity_id'",139],",",["T_WHITESPACE","\n            ",139],["T_CONSTANT_ENCAPSED_STRING","'product_name.store_id = source_table.store_id'",140],",",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$adapter",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","quoteInto",141],"(",["T_CONSTANT_ENCAPSED_STRING","'product_name.attribute_id = ?'",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$nameAttribute",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getAttributeId",141],"(",")",")",["T_WHITESPACE","\n        ",141],")",";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$joinExprProductName",143],["T_WHITESPACE","        ",143],"=",["T_WHITESPACE"," ",143],["T_STRING","implode",143],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$joinExprProductName",143],")",";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$joinExprProductDefaultName",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_ARRAY","array",144],"(",["T_WHITESPACE","\n            ",144],["T_CONSTANT_ENCAPSED_STRING","'product_default_name.entity_id = product.entity_id'",145],",",["T_WHITESPACE","\n            ",145],["T_CONSTANT_ENCAPSED_STRING","'product_default_name.store_id = 0'",146],",",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$adapter",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","quoteInto",147],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_name.attribute_id = ?'",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$nameAttribute",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getAttributeId",147],"(",")",")",["T_WHITESPACE","\n        ",147],")",";",["T_WHITESPACE","\n        ",148],["T_VARIABLE","$joinExprProductDefaultName",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_STRING","implode",149],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$joinExprProductDefaultName",149],")",";",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$select",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","joinLeft",150],"(",["T_WHITESPACE","\n            ",150],["T_ARRAY","array",151],"(",["T_WHITESPACE","\n                ",151],["T_CONSTANT_ENCAPSED_STRING","'product_name'",152],["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$nameAttribute",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getBackend",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","getTable",152],"(",")",")",",",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$joinExprProductName",153],",",["T_WHITESPACE","\n            ",153],["T_ARRAY","array",154],"(",")",["T_WHITESPACE","\n        ",154],")",["T_WHITESPACE","\n        ",155],["T_OBJECT_OPERATOR","->",156],["T_STRING","joinLeft",156],"(",["T_WHITESPACE","\n            ",156],["T_ARRAY","array",157],"(",["T_WHITESPACE","\n                ",157],["T_CONSTANT_ENCAPSED_STRING","'product_default_name'",158],["T_WHITESPACE"," ",158],["T_DOUBLE_ARROW","=>",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$nameAttribute",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getBackend",158],"(",")",["T_OBJECT_OPERATOR","->",158],["T_STRING","getTable",158],"(",")",")",",",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$joinExprProductDefaultName",159],",",["T_WHITESPACE","\n            ",159],["T_ARRAY","array",160],"(",")",["T_WHITESPACE","\n        ",160],")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$priceAttribute",162],["T_WHITESPACE","                    ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$product",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getAttribute",162],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",162],")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$joinExprProductPrice",163],["T_WHITESPACE","    ",163],"=",["T_WHITESPACE"," ",163],["T_ARRAY","array",163],"(",["T_WHITESPACE","\n            ",163],["T_CONSTANT_ENCAPSED_STRING","'product_price.entity_id = product.entity_id'",164],",",["T_WHITESPACE","\n            ",164],["T_CONSTANT_ENCAPSED_STRING","'product_price.store_id = source_table.store_id'",165],",",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$adapter",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","quoteInto",166],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price.attribute_id = ?'",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$priceAttribute",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getAttributeId",166],"(",")",")",["T_WHITESPACE","\n        ",166],")",";",["T_WHITESPACE","\n        ",167],["T_VARIABLE","$joinExprProductPrice",168],["T_WHITESPACE","    ",168],"=",["T_WHITESPACE"," ",168],["T_STRING","implode",168],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$joinExprProductPrice",168],")",";",["T_WHITESPACE","\n\n        ",168],["T_VARIABLE","$joinExprProductDefPrice",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_ARRAY","array",170],"(",["T_WHITESPACE","\n            ",170],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.entity_id = product.entity_id'",171],",",["T_WHITESPACE","\n            ",171],["T_CONSTANT_ENCAPSED_STRING","'product_default_price.store_id = 0'",172],",",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$adapter",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","quoteInto",173],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price.attribute_id = ?'",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$priceAttribute",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getAttributeId",173],"(",")",")",["T_WHITESPACE","\n        ",173],")",";",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$joinExprProductDefPrice",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_STRING","implode",175],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$joinExprProductDefPrice",175],")",";",["T_WHITESPACE","\n        ",175],["T_VARIABLE","$select",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","joinLeft",176],"(",["T_WHITESPACE","\n            ",176],["T_ARRAY","array",177],"(",["T_CONSTANT_ENCAPSED_STRING","'product_price'",177],["T_WHITESPACE"," ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$priceAttribute",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","getBackend",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","getTable",177],"(",")",")",",",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$joinExprProductPrice",178],",",["T_WHITESPACE","\n            ",178],["T_ARRAY","array",179],"(",")",["T_WHITESPACE","\n        ",179],")",["T_WHITESPACE","\n        ",180],["T_OBJECT_OPERATOR","->",181],["T_STRING","joinLeft",181],"(",["T_WHITESPACE","\n            ",181],["T_ARRAY","array",182],"(",["T_CONSTANT_ENCAPSED_STRING","'product_default_price'",182],["T_WHITESPACE"," ",182],["T_DOUBLE_ARROW","=>",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$priceAttribute",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getBackend",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","getTable",182],"(",")",")",",",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$joinExprProductDefPrice",183],",",["T_WHITESPACE","\n            ",183],["T_ARRAY","array",184],"(",")",["T_WHITESPACE","\n        ",184],")",";",["T_WHITESPACE","\n\n        ",185],["T_VARIABLE","$havingPart",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_ARRAY","array",187],"(",["T_VARIABLE","$adapter",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","prepareSqlCondition",187],"(",["T_VARIABLE","$viewsNumExpr",187],",",["T_WHITESPACE"," ",187],["T_ARRAY","array",187],"(",["T_CONSTANT_ENCAPSED_STRING","'gt'",187],["T_WHITESPACE"," ",187],["T_DOUBLE_ARROW","=>",187],["T_WHITESPACE"," ",187],["T_LNUMBER","0",187],")",")",")",";",["T_WHITESPACE","\n        ",187],["T_IF","if",188],["T_WHITESPACE"," ",188],"(","!",["T_STRING","is_null",188],"(",["T_VARIABLE","$subSelect",188],")",")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$subSelectHavingPart",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_makeConditionFromDateRangeSelect",189],"(",["T_VARIABLE","$subSelect",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'period'",189],")",";",["T_WHITESPACE","\n            ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(",["T_VARIABLE","$subSelectHavingPart",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$havingPart",191],"[","]",["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","'('",191],["T_WHITESPACE"," ",191],".",["T_WHITESPACE"," ",191],["T_VARIABLE","$subSelectHavingPart",191],["T_WHITESPACE"," ",191],".",["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","')'",191],";",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE","\n        ",192],"}",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$select",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","having",194],"(",["T_STRING","implode",194],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",194],",",["T_WHITESPACE"," ",194],["T_VARIABLE","$havingPart",194],")",")",";",["T_WHITESPACE","\n\n        ",194],["T_VARIABLE","$select",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","useStraightJoin",196],"(",")",";",["T_WHITESPACE","\n        ",196],["T_VARIABLE","$insertQuery",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$helper",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getInsertFromSelectUsingAnalytic",197],"(",["T_VARIABLE","$select",197],",",["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getMainTable",197],"(",")",",",["T_WHITESPACE","\n            ",197],["T_STRING","array_keys",198],"(",["T_VARIABLE","$columns",198],")",")",";",["T_WHITESPACE","\n        ",198],["T_VARIABLE","$adapter",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","query",199],"(",["T_VARIABLE","$insertQuery",199],")",";",["T_WHITESPACE","\n\n        ",199],["T_STRING","Mage",201],["T_DOUBLE_COLON","::",201],["T_STRING","getResourceHelper",201],"(",["T_CONSTANT_ENCAPSED_STRING","'reports'",201],")",["T_WHITESPACE","\n            ",201],["T_OBJECT_OPERATOR","->",202],["T_STRING","updateReportRatingPos",202],"(",["T_CONSTANT_ENCAPSED_STRING","'day'",202],",",["T_WHITESPACE"," ",202],["T_CONSTANT_ENCAPSED_STRING","'views_num'",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$mainTable",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getTable",202],"(",["T_STRING","self",202],["T_DOUBLE_COLON","::",202],["T_STRING","AGGREGATION_DAILY",202],")",")",";",["T_WHITESPACE","\n        ",202],["T_STRING","Mage",203],["T_DOUBLE_COLON","::",203],["T_STRING","getResourceHelper",203],"(",["T_CONSTANT_ENCAPSED_STRING","'reports'",203],")",["T_WHITESPACE","\n            ",203],["T_OBJECT_OPERATOR","->",204],["T_STRING","updateReportRatingPos",204],"(",["T_CONSTANT_ENCAPSED_STRING","'month'",204],",",["T_WHITESPACE"," ",204],["T_CONSTANT_ENCAPSED_STRING","'views_num'",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$mainTable",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getTable",204],"(",["T_STRING","self",204],["T_DOUBLE_COLON","::",204],["T_STRING","AGGREGATION_MONTHLY",204],")",")",";",["T_WHITESPACE","\n        ",204],["T_STRING","Mage",205],["T_DOUBLE_COLON","::",205],["T_STRING","getResourceHelper",205],"(",["T_CONSTANT_ENCAPSED_STRING","'reports'",205],")",["T_WHITESPACE","\n            ",205],["T_OBJECT_OPERATOR","->",206],["T_STRING","updateReportRatingPos",206],"(",["T_CONSTANT_ENCAPSED_STRING","'year'",206],",",["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'views_num'",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$mainTable",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getTable",206],"(",["T_STRING","self",206],["T_DOUBLE_COLON","::",206],["T_STRING","AGGREGATION_YEARLY",206],")",")",";",["T_WHITESPACE","\n\n        ",206],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_setFlagData",208],"(",["T_STRING","Mage_Reports_Model_Flag",208],["T_DOUBLE_COLON","::",208],["T_STRING","REPORT_PRODUCT_VIEWED_FLAG_CODE",208],")",";",["T_WHITESPACE","\n\n        ",208],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n",211],"}",["T_WHITESPACE","\n",212]]