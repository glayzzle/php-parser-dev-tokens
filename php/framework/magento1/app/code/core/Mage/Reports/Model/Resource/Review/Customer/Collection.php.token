[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Reports\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Report Customers Review collection\n *\n * @category    Mage\n * @package     Mage_Reports\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Reports_Model_Resource_Review_Customer_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Review_Model_Resource_Review_Collection",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Join customers\n     *\n     * @return Mage_Reports_Model_Resource_Review_Customer_Collection\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","joinCustomers",42],"(",")",["T_WHITESPACE","\n    ",42],"{",["T_WHITESPACE","\n        ",43],["T_DOC_COMMENT","\/**\n         * Allow to use analytic function to result select\n         *\/",44],["T_WHITESPACE","\n        ",46],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","_useAnalyticFunction",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","true",47],";",["T_WHITESPACE","\n\n        ",47],["T_DOC_COMMENT","\/** @var $adapter Varien_Db_Adapter_Interface *\/",49],["T_WHITESPACE","\n        ",49],["T_VARIABLE","$adapter",50],["T_WHITESPACE","            ",50],"=",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getConnection",50],"(",")",";",["T_WHITESPACE","\n        ",50],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Resource_Customer *\/",51],["T_WHITESPACE","\n        ",51],["T_VARIABLE","$customer",52],["T_WHITESPACE","           ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","Mage",52],["T_DOUBLE_COLON","::",52],["T_STRING","getResourceSingleton",52],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",52],")",";",["T_WHITESPACE","\n        ",52],["T_DOC_COMMENT","\/** @var $firstnameAttr Mage_Eav_Model_Entity_Attribute *\/",53],["T_WHITESPACE","\n        ",53],["T_VARIABLE","$firstnameAttr",54],["T_WHITESPACE","      ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$customer",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getAttribute",54],"(",["T_CONSTANT_ENCAPSED_STRING","'firstname'",54],")",";",["T_WHITESPACE","\n        ",54],["T_DOC_COMMENT","\/** @var $firstnameAttr Mage_Eav_Model_Entity_Attribute *\/",55],["T_WHITESPACE","\n        ",55],["T_VARIABLE","$middlenameAttr",56],["T_WHITESPACE","      ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$customer",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getAttribute",56],"(",["T_CONSTANT_ENCAPSED_STRING","'middlename'",56],")",";",["T_WHITESPACE","\n        ",56],["T_DOC_COMMENT","\/** @var $lastnameAttr Mage_Eav_Model_Entity_Attribute *\/",57],["T_WHITESPACE","\n        ",57],["T_VARIABLE","$lastnameAttr",58],["T_WHITESPACE","       ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$customer",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getAttribute",58],"(",["T_CONSTANT_ENCAPSED_STRING","'lastname'",58],")",";",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$firstnameCondition",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_ARRAY","array",60],"(",["T_CONSTANT_ENCAPSED_STRING","'table_customer_firstname.entity_id = detail.customer_id'",60],")",";",["T_WHITESPACE","\n\n        ",60],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$firstnameAttr",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getBackend",62],"(",")",["T_OBJECT_OPERATOR","->",62],["T_STRING","isStatic",62],"(",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$firstnameField",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'firstname'",63],";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE"," ",64],["T_ELSE","else",64],["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$firstnameField",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'value'",65],";",["T_WHITESPACE","\n            ",65],["T_VARIABLE","$firstnameCondition",66],"[","]",["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$adapter",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","quoteInto",66],"(",["T_WHITESPACE","\n                ",66],["T_CONSTANT_ENCAPSED_STRING","'table_customer_firstname.attribute_id = ?'",67],",",["T_WHITESPACE","\n                ",67],["T_INT_CAST","(int)",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$firstnameAttr",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getAttributeId",68],"(",")",["T_WHITESPACE","\n            ",68],")",";",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n\n        ",70],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getSelect",72],"(",")",["T_OBJECT_OPERATOR","->",72],["T_STRING","joinInner",72],"(",["T_WHITESPACE","\n            ",72],["T_ARRAY","array",73],"(",["T_CONSTANT_ENCAPSED_STRING","'table_customer_firstname'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$firstnameAttr",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getBackend",73],"(",")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getTable",73],"(",")",")",",",["T_WHITESPACE","\n            ",73],["T_STRING","implode",74],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$firstnameCondition",74],")",",",["T_WHITESPACE","\n            ",74],["T_ARRAY","array",75],"(",")",["T_WHITESPACE","\n        ",75],")",";",["T_WHITESPACE","\n\n        ",76],["T_VARIABLE","$middlenameCondition",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_ARRAY","array",78],"(",["T_CONSTANT_ENCAPSED_STRING","'table_customer_middlename.entity_id = detail.customer_id'",78],")",";",["T_WHITESPACE","\n\n        ",78],["T_IF","if",80],["T_WHITESPACE"," ",80],"(",["T_VARIABLE","$middlenameAttr",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getBackend",80],"(",")",["T_OBJECT_OPERATOR","->",80],["T_STRING","isStatic",80],"(",")",")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n            ",80],["T_VARIABLE","$middlenameField",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'middlename'",81],";",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE"," ",82],["T_ELSE","else",82],["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$middlenameField",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'value'",83],";",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$middlenameCondition",84],"[","]",["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$adapter",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","quoteInto",84],"(",["T_WHITESPACE","\n                ",84],["T_CONSTANT_ENCAPSED_STRING","'table_customer_middlename.attribute_id = ?'",85],",",["T_WHITESPACE","\n                ",85],["T_INT_CAST","(int)",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$middlenameAttr",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getAttributeId",86],"(",")",["T_WHITESPACE","\n            ",86],")",";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n\n        ",88],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getSelect",90],"(",")",["T_OBJECT_OPERATOR","->",90],["T_STRING","joinInner",90],"(",["T_WHITESPACE","\n            ",90],["T_ARRAY","array",91],"(",["T_CONSTANT_ENCAPSED_STRING","'table_customer_middlename'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$middlenameAttr",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getBackend",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","getTable",91],"(",")",")",",",["T_WHITESPACE","\n            ",91],["T_STRING","implode",92],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$middlenameCondition",92],")",",",["T_WHITESPACE","\n            ",92],["T_ARRAY","array",93],"(",")",["T_WHITESPACE","\n        ",93],")",";",["T_WHITESPACE","\n\n        ",94],["T_VARIABLE","$lastnameCondition",96],["T_WHITESPACE","  ",96],"=",["T_WHITESPACE"," ",96],["T_ARRAY","array",96],"(",["T_CONSTANT_ENCAPSED_STRING","'table_customer_lastname.entity_id = detail.customer_id'",96],")",";",["T_WHITESPACE","\n        ",96],["T_IF","if",97],["T_WHITESPACE"," ",97],"(",["T_VARIABLE","$lastnameAttr",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getBackend",97],"(",")",["T_OBJECT_OPERATOR","->",97],["T_STRING","isStatic",97],"(",")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$lastnameField",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'lastname'",98],";",["T_WHITESPACE","\n        ",98],"}",["T_WHITESPACE"," ",99],["T_ELSE","else",99],["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_VARIABLE","$lastnameField",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'value'",100],";",["T_WHITESPACE","\n            ",100],["T_VARIABLE","$lastnameCondition",101],"[","]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$adapter",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","quoteInto",101],"(",["T_WHITESPACE","\n                ",101],["T_CONSTANT_ENCAPSED_STRING","'table_customer_lastname.attribute_id = ?'",102],",",["T_WHITESPACE","\n                ",102],["T_INT_CAST","(int)",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$lastnameAttr",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getAttributeId",103],"(",")",["T_WHITESPACE","\n            ",103],")",";",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n\n        ",105],["T_COMMENT","\/\/Prepare fullname field result\n",107],["T_WHITESPACE","        ",108],["T_VARIABLE","$customerFullname",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$adapter",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getConcatSql",108],"(",["T_ARRAY","array",108],"(",["T_WHITESPACE","\n            ",108],"\"",["T_ENCAPSED_AND_WHITESPACE","table_customer_firstname.",109],["T_CURLY_OPEN","{",109],["T_VARIABLE","$firstnameField",109],"}","\"",",",["T_WHITESPACE","\n            ",109],"\"",["T_ENCAPSED_AND_WHITESPACE","table_customer_middlename.",110],["T_CURLY_OPEN","{",110],["T_VARIABLE","$middlenameField",110],"}","\"",",",["T_WHITESPACE","\n            ",110],"\"",["T_ENCAPSED_AND_WHITESPACE","table_customer_lastname.",111],["T_CURLY_OPEN","{",111],["T_VARIABLE","$lastnameField",111],"}","\"",["T_WHITESPACE","\n        ",111],")",",",["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","' '",112],")",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getSelect",113],"(",")",["T_OBJECT_OPERATOR","->",113],["T_STRING","reset",113],"(",["T_STRING","Zend_Db_Select",113],["T_DOUBLE_COLON","::",113],["T_STRING","COLUMNS",113],")",["T_WHITESPACE","\n            ",113],["T_OBJECT_OPERATOR","->",114],["T_STRING","joinInner",114],"(",["T_WHITESPACE","\n                ",114],["T_ARRAY","array",115],"(",["T_CONSTANT_ENCAPSED_STRING","'table_customer_lastname'",115],["T_WHITESPACE"," ",115],["T_DOUBLE_ARROW","=>",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$lastnameAttr",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getBackend",115],"(",")",["T_OBJECT_OPERATOR","->",115],["T_STRING","getTable",115],"(",")",")",",",["T_WHITESPACE","\n                ",115],["T_STRING","implode",116],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",116],",",["T_WHITESPACE"," ",116],["T_VARIABLE","$lastnameCondition",116],")",",",["T_WHITESPACE","\n                ",116],["T_ARRAY","array",117],"(",")",")",["T_WHITESPACE","\n            ",117],["T_OBJECT_OPERATOR","->",118],["T_STRING","columns",118],"(",["T_ARRAY","array",118],"(",["T_WHITESPACE","\n                ",118],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",119],["T_WHITESPACE"," ",119],["T_DOUBLE_ARROW","=>",119],["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","'detail.customer_id'",119],",",["T_WHITESPACE","\n                ",119],["T_CONSTANT_ENCAPSED_STRING","'customer_name'",120],["T_WHITESPACE"," ",120],["T_DOUBLE_ARROW","=>",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$customerFullname",120],",",["T_WHITESPACE","\n                ",120],["T_CONSTANT_ENCAPSED_STRING","'review_cnt'",121],["T_WHITESPACE","    ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_CONSTANT_ENCAPSED_STRING","'COUNT(main_table.review_id)'",121],")",")",["T_WHITESPACE","\n            ",121],["T_OBJECT_OPERATOR","->",122],["T_STRING","group",122],"(",["T_CONSTANT_ENCAPSED_STRING","'detail.customer_id'",122],")",";",["T_WHITESPACE","\n\n        ",122],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],";",["T_WHITESPACE","\n    ",124],"}",["T_WHITESPACE","\n\n    ",125],["T_DOC_COMMENT","\/**\n     * Get select count sql\n     *\n     * @return string\n     *\/",127],["T_WHITESPACE","\n    ",131],["T_PUBLIC","public",132],["T_WHITESPACE"," ",132],["T_FUNCTION","function",132],["T_WHITESPACE"," ",132],["T_STRING","getSelectCountSql",132],"(",")",["T_WHITESPACE","\n    ",132],"{",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$countSelect",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_CLONE","clone",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_select",134],";",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$countSelect",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","reset",135],"(",["T_STRING","Zend_Db_Select",135],["T_DOUBLE_COLON","::",135],["T_STRING","ORDER",135],")",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$countSelect",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","reset",136],"(",["T_STRING","Zend_Db_Select",136],["T_DOUBLE_COLON","::",136],["T_STRING","GROUP",136],")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$countSelect",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","reset",137],"(",["T_STRING","Zend_Db_Select",137],["T_DOUBLE_COLON","::",137],["T_STRING","HAVING",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$countSelect",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","reset",138],"(",["T_STRING","Zend_Db_Select",138],["T_DOUBLE_COLON","::",138],["T_STRING","LIMIT_COUNT",138],")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$countSelect",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","reset",139],"(",["T_STRING","Zend_Db_Select",139],["T_DOUBLE_COLON","::",139],["T_STRING","LIMIT_OFFSET",139],")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$countSelect",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","reset",140],"(",["T_STRING","Zend_Db_Select",140],["T_DOUBLE_COLON","::",140],["T_STRING","COLUMNS",140],")",";",["T_WHITESPACE","\n\n        ",140],["T_VARIABLE","$countSelect",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","columns",142],"(",["T_NEW","new",142],["T_WHITESPACE"," ",142],["T_STRING","Zend_Db_Expr",142],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT detail.customer_id)'",142],")",")",";",["T_WHITESPACE","\n\n        ",142],["T_RETURN","return",144],["T_WHITESPACE","  ",144],["T_VARIABLE","$countSelect",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n",145],"}",["T_WHITESPACE","\n",146]]