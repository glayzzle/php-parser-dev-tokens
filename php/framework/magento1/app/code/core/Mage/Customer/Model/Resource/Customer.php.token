[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Customer\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Customer entity resource model\n *\n * @category    Mage\n * @package     Mage_Customer\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Customer_Model_Resource_Customer",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Eav_Model_Entity_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Resource initialization\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_PUBLIC","public",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","__construct",40],"(",")",["T_WHITESPACE","\n    ",40],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","setType",42],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",42],")",";",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","setConnection",43],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_read'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'customer_write'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Retrieve customer entity default attributes\n     *\n     * @return array\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","_getDefaultAttributes",51],"(",")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_RETURN","return",53],["T_WHITESPACE"," ",53],["T_ARRAY","array",53],"(",["T_WHITESPACE","\n            ",53],["T_CONSTANT_ENCAPSED_STRING","'entity_type_id'",54],",",["T_WHITESPACE","\n            ",54],["T_CONSTANT_ENCAPSED_STRING","'attribute_set_id'",55],",",["T_WHITESPACE","\n            ",55],["T_CONSTANT_ENCAPSED_STRING","'created_at'",56],",",["T_WHITESPACE","\n            ",56],["T_CONSTANT_ENCAPSED_STRING","'updated_at'",57],",",["T_WHITESPACE","\n            ",57],["T_CONSTANT_ENCAPSED_STRING","'increment_id'",58],",",["T_WHITESPACE","\n            ",58],["T_CONSTANT_ENCAPSED_STRING","'store_id'",59],",",["T_WHITESPACE","\n            ",59],["T_CONSTANT_ENCAPSED_STRING","'website_id'",60],["T_WHITESPACE","\n        ",60],")",";",["T_WHITESPACE","\n    ",61],"}",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Check customer scope, email and confirmation key before saving\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @throws Mage_Customer_Exception\n     * @return Mage_Customer_Model_Resource_Customer\n     *\/",64],["T_WHITESPACE","\n    ",70],["T_PROTECTED","protected",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","_beforeSave",71],"(",["T_STRING","Varien_Object",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$customer",71],")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_STRING","parent",73],["T_DOUBLE_COLON","::",73],["T_STRING","_beforeSave",73],"(",["T_VARIABLE","$customer",73],")",";",["T_WHITESPACE","\n\n        ",73],["T_IF","if",75],["T_WHITESPACE"," ",75],"(","!",["T_VARIABLE","$customer",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getEmail",75],"(",")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_THROW","throw",76],["T_WHITESPACE"," ",76],["T_STRING","Mage",76],["T_DOUBLE_COLON","::",76],["T_STRING","exception",76],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Customer'",76],",",["T_WHITESPACE"," ",76],["T_STRING","Mage",76],["T_DOUBLE_COLON","::",76],["T_STRING","helper",76],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",76],")",["T_OBJECT_OPERATOR","->",76],["T_STRING","__",76],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer email is required'",76],")",")",";",["T_WHITESPACE","\n        ",76],"}",["T_WHITESPACE","\n\n        ",77],["T_VARIABLE","$adapter",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_getWriteAdapter",79],"(",")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$bind",80],["T_WHITESPACE","    ",80],"=",["T_WHITESPACE"," ",80],["T_ARRAY","array",80],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",80],["T_WHITESPACE"," ",80],["T_DOUBLE_ARROW","=>",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$customer",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getEmail",80],"(",")",")",";",["T_WHITESPACE","\n\n        ",80],["T_VARIABLE","$select",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$adapter",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","select",82],"(",")",["T_WHITESPACE","\n            ",82],["T_OBJECT_OPERATOR","->",83],["T_STRING","from",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getEntityTable",83],"(",")",",",["T_WHITESPACE"," ",83],["T_ARRAY","array",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getEntityIdField",83],"(",")",")",")",["T_WHITESPACE","\n            ",83],["T_OBJECT_OPERATOR","->",84],["T_STRING","where",84],"(",["T_CONSTANT_ENCAPSED_STRING","'email = :email'",84],")",";",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$customer",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getSharingConfig",85],"(",")",["T_OBJECT_OPERATOR","->",85],["T_STRING","isWebsiteScope",85],"(",")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$bind",86],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",86],"]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_INT_CAST","(int)",86],["T_VARIABLE","$customer",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getWebsiteId",86],"(",")",";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$select",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","where",87],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id = :website_id'",87],")",";",["T_WHITESPACE","\n        ",87],"}",["T_WHITESPACE","\n        ",88],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$customer",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getId",89],"(",")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$bind",90],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",90],"]",["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_INT_CAST","(int)",90],["T_VARIABLE","$customer",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getId",90],"(",")",";",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$select",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","where",91],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id != :entity_id'",91],")",";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_VARIABLE","$result",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$adapter",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","fetchOne",94],"(",["T_VARIABLE","$select",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$bind",94],")",";",["T_WHITESPACE","\n        ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$result",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_THROW","throw",96],["T_WHITESPACE"," ",96],["T_STRING","Mage",96],["T_DOUBLE_COLON","::",96],["T_STRING","exception",96],"(",["T_WHITESPACE","\n                ",96],["T_CONSTANT_ENCAPSED_STRING","'Mage_Customer'",97],",",["T_WHITESPACE"," ",97],["T_STRING","Mage",97],["T_DOUBLE_COLON","::",97],["T_STRING","helper",97],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",97],")",["T_OBJECT_OPERATOR","->",97],["T_STRING","__",97],"(",["T_CONSTANT_ENCAPSED_STRING","'This customer email already exists'",97],")",",",["T_WHITESPACE","\n                ",97],["T_STRING","Mage_Customer_Model_Customer",98],["T_DOUBLE_COLON","::",98],["T_STRING","EXCEPTION_EMAIL_EXISTS",98],["T_WHITESPACE","\n            ",98],")",";",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n\n        ",100],["T_COMMENT","\/\/ set confirmation key logic\n",102],["T_WHITESPACE","        ",103],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_VARIABLE","$customer",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getForceConfirmed",103],"(",")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_VARIABLE","$customer",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","setConfirmation",104],"(",["T_STRING","null",104],")",";",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE"," ",105],["T_ELSEIF","elseif",105],["T_WHITESPACE"," ",105],"(","!",["T_VARIABLE","$customer",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getId",105],"(",")",["T_WHITESPACE"," ",105],["T_BOOLEAN_AND","&&",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$customer",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","isConfirmationRequired",105],"(",")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$customer",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","setConfirmation",106],"(",["T_VARIABLE","$customer",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getRandomConfirmationKey",106],"(",")",")",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_COMMENT","\/\/ remove customer confirmation key from database, if empty\n",108],["T_WHITESPACE","        ",109],["T_IF","if",109],["T_WHITESPACE"," ",109],"(","!",["T_VARIABLE","$customer",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","getConfirmation",109],"(",")",")",["T_WHITESPACE"," ",109],"{",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$customer",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","setConfirmation",110],"(",["T_STRING","null",110],")",";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Save customer addresses and set default addresses in attributes backend\n     *\n     * @param Varien_Object $customer\n     * @return Mage_Eav_Model_Entity_Abstract\n     *\/",116],["T_WHITESPACE","\n    ",121],["T_PROTECTED","protected",122],["T_WHITESPACE"," ",122],["T_FUNCTION","function",122],["T_WHITESPACE"," ",122],["T_STRING","_afterSave",122],"(",["T_STRING","Varien_Object",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$customer",122],")",["T_WHITESPACE","\n    ",122],"{",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","_saveAddresses",124],"(",["T_VARIABLE","$customer",124],")",";",["T_WHITESPACE","\n        ",124],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_STRING","parent",125],["T_DOUBLE_COLON","::",125],["T_STRING","_afterSave",125],"(",["T_VARIABLE","$customer",125],")",";",["T_WHITESPACE","\n    ",125],"}",["T_WHITESPACE","\n\n    ",126],["T_DOC_COMMENT","\/**\n     * Save\/delete customer address\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @return Mage_Customer_Model_Resource_Customer\n     *\/",128],["T_WHITESPACE","\n    ",133],["T_PROTECTED","protected",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","_saveAddresses",134],"(",["T_STRING","Mage_Customer_Model_Customer",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$customer",134],")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$defaultBillingId",136],["T_WHITESPACE","   ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$customer",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getData",136],"(",["T_CONSTANT_ENCAPSED_STRING","'default_billing'",136],")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$defaultShippingId",137],["T_WHITESPACE","  ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$customer",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getData",137],"(",["T_CONSTANT_ENCAPSED_STRING","'default_shipping'",137],")",";",["T_WHITESPACE","\n        ",137],["T_FOREACH","foreach",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$customer",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getAddresses",138],"(",")",["T_WHITESPACE"," ",138],["T_AS","as",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$address",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_IF","if",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$address",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getData",139],"(",["T_CONSTANT_ENCAPSED_STRING","'_deleted'",139],")",")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_IF","if",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$address",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getId",140],"(",")",["T_WHITESPACE"," ",140],["T_IS_EQUAL","==",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$defaultBillingId",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                    ",140],["T_VARIABLE","$customer",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","setData",141],"(",["T_CONSTANT_ENCAPSED_STRING","'default_billing'",141],",",["T_WHITESPACE"," ",141],["T_STRING","null",141],")",";",["T_WHITESPACE","\n                ",141],"}",["T_WHITESPACE","\n                ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$address",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getId",143],"(",")",["T_WHITESPACE"," ",143],["T_IS_EQUAL","==",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$defaultShippingId",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n                    ",143],["T_VARIABLE","$customer",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","setData",144],"(",["T_CONSTANT_ENCAPSED_STRING","'default_shipping'",144],",",["T_WHITESPACE"," ",144],["T_STRING","null",144],")",";",["T_WHITESPACE","\n                ",144],"}",["T_WHITESPACE","\n                ",145],["T_VARIABLE","$address",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","delete",146],"(",")",";",["T_WHITESPACE","\n            ",146],"}",["T_WHITESPACE"," ",147],["T_ELSE","else",147],["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                ",147],["T_VARIABLE","$address",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","setParentId",148],"(",["T_VARIABLE","$customer",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getId",148],"(",")",")",["T_WHITESPACE","\n                    ",148],["T_OBJECT_OPERATOR","->",149],["T_STRING","setStoreId",149],"(",["T_VARIABLE","$customer",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getStoreId",149],"(",")",")",["T_WHITESPACE","\n                    ",149],["T_OBJECT_OPERATOR","->",150],["T_STRING","setIsCustomerSaveTransaction",150],"(",["T_STRING","true",150],")",["T_WHITESPACE","\n                    ",150],["T_OBJECT_OPERATOR","->",151],["T_STRING","save",151],"(",")",";",["T_WHITESPACE","\n                ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(","(",["T_VARIABLE","$address",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getIsPrimaryBilling",152],"(",")",["T_WHITESPACE"," ",152],["T_BOOLEAN_OR","||",152],["T_WHITESPACE"," ",152],["T_VARIABLE","$address",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","getIsDefaultBilling",152],"(",")",")",["T_WHITESPACE","\n                    ",152],["T_BOOLEAN_AND","&&",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$address",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getId",153],"(",")",["T_WHITESPACE"," ",153],["T_IS_NOT_EQUAL","!=",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$defaultBillingId",153],["T_WHITESPACE","\n                ",153],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n                    ",154],["T_VARIABLE","$customer",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","setData",155],"(",["T_CONSTANT_ENCAPSED_STRING","'default_billing'",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$address",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getId",155],"(",")",")",";",["T_WHITESPACE","\n                ",155],"}",["T_WHITESPACE","\n                ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(","(",["T_VARIABLE","$address",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getIsPrimaryShipping",157],"(",")",["T_WHITESPACE"," ",157],["T_BOOLEAN_OR","||",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$address",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","getIsDefaultShipping",157],"(",")",")",["T_WHITESPACE","\n                    ",157],["T_BOOLEAN_AND","&&",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$address",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getId",158],"(",")",["T_WHITESPACE"," ",158],["T_IS_NOT_EQUAL","!=",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$defaultShippingId",158],["T_WHITESPACE","\n                ",158],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                    ",159],["T_VARIABLE","$customer",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","setData",160],"(",["T_CONSTANT_ENCAPSED_STRING","'default_shipping'",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$address",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getId",160],"(",")",")",";",["T_WHITESPACE","\n                ",160],"}",["T_WHITESPACE","\n            ",161],"}",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n        ",163],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$customer",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","dataHasChangedFor",164],"(",["T_CONSTANT_ENCAPSED_STRING","'default_billing'",164],")",")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","saveAttribute",165],"(",["T_VARIABLE","$customer",165],",",["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'default_billing'",165],")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n        ",166],["T_IF","if",167],["T_WHITESPACE"," ",167],"(",["T_VARIABLE","$customer",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","dataHasChangedFor",167],"(",["T_CONSTANT_ENCAPSED_STRING","'default_shipping'",167],")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","saveAttribute",168],"(",["T_VARIABLE","$customer",168],",",["T_WHITESPACE"," ",168],["T_CONSTANT_ENCAPSED_STRING","'default_shipping'",168],")",";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n\n        ",169],["T_RETURN","return",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],";",["T_WHITESPACE","\n    ",171],"}",["T_WHITESPACE","\n\n    ",172],["T_DOC_COMMENT","\/**\n     * Retrieve select object for loading base entity row\n     *\n     * @param Varien_Object $object\n     * @param mixed $rowId\n     * @return Varien_Db_Select\n     *\/",174],["T_WHITESPACE","\n    ",180],["T_PROTECTED","protected",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","_getLoadRowSelect",181],"(",["T_VARIABLE","$object",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$rowId",181],")",["T_WHITESPACE","\n    ",181],"{",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$select",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_STRING","parent",183],["T_DOUBLE_COLON","::",183],["T_STRING","_getLoadRowSelect",183],"(",["T_VARIABLE","$object",183],",",["T_WHITESPACE"," ",183],["T_VARIABLE","$rowId",183],")",";",["T_WHITESPACE","\n        ",183],["T_IF","if",184],["T_WHITESPACE"," ",184],"(",["T_VARIABLE","$object",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getWebsiteId",184],"(",")",["T_WHITESPACE"," ",184],["T_BOOLEAN_AND","&&",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$object",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getSharingConfig",184],"(",")",["T_OBJECT_OPERATOR","->",184],["T_STRING","isWebsiteScope",184],"(",")",")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$select",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","where",185],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id =?'",185],",",["T_WHITESPACE"," ",185],["T_INT_CAST","(int)",185],["T_VARIABLE","$object",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getWebsiteId",185],"(",")",")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n\n        ",186],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$select",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Load customer by email\n     *\n     * @throws Mage_Core_Exception\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @param string $email\n     * @param bool $testOnly\n     * @return Mage_Customer_Model_Resource_Customer\n     *\/",191],["T_WHITESPACE","\n    ",200],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","loadByEmail",201],"(",["T_STRING","Mage_Customer_Model_Customer",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$customer",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$email",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$testOnly",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","false",201],")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$adapter",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","_getReadAdapter",203],"(",")",";",["T_WHITESPACE","\n        ",203],["T_VARIABLE","$bind",204],["T_WHITESPACE","    ",204],"=",["T_WHITESPACE"," ",204],["T_ARRAY","array",204],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_email'",204],["T_WHITESPACE"," ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$email",204],")",";",["T_WHITESPACE","\n        ",204],["T_VARIABLE","$select",205],["T_WHITESPACE","  ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$adapter",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","select",205],"(",")",["T_WHITESPACE","\n            ",205],["T_OBJECT_OPERATOR","->",206],["T_STRING","from",206],"(",["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getEntityTable",206],"(",")",",",["T_WHITESPACE"," ",206],["T_ARRAY","array",206],"(",["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getEntityIdField",206],"(",")",")",")",["T_WHITESPACE","\n            ",206],["T_OBJECT_OPERATOR","->",207],["T_STRING","where",207],"(",["T_CONSTANT_ENCAPSED_STRING","'email = :customer_email'",207],")",";",["T_WHITESPACE","\n\n        ",207],["T_IF","if",209],["T_WHITESPACE"," ",209],"(",["T_VARIABLE","$customer",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getSharingConfig",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","isWebsiteScope",209],"(",")",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n            ",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(","!",["T_VARIABLE","$customer",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","hasData",210],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id'",210],")",")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n                ",210],["T_STRING","Mage",211],["T_DOUBLE_COLON","::",211],["T_STRING","throwException",211],"(",["T_WHITESPACE","\n                    ",211],["T_STRING","Mage",212],["T_DOUBLE_COLON","::",212],["T_STRING","helper",212],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",212],")",["T_OBJECT_OPERATOR","->",212],["T_STRING","__",212],"(",["T_CONSTANT_ENCAPSED_STRING","'Customer website ID must be specified when using the website scope'",212],")",["T_WHITESPACE","\n                ",212],")",";",["T_WHITESPACE","\n            ",213],"}",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$bind",215],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",215],"]",["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_INT_CAST","(int)",215],["T_VARIABLE","$customer",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getWebsiteId",215],"(",")",";",["T_WHITESPACE","\n            ",215],["T_VARIABLE","$select",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","where",216],"(",["T_CONSTANT_ENCAPSED_STRING","'website_id = :website_id'",216],")",";",["T_WHITESPACE","\n        ",216],"}",["T_WHITESPACE","\n\n        ",217],["T_VARIABLE","$customerId",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$adapter",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","fetchOne",219],"(",["T_VARIABLE","$select",219],",",["T_WHITESPACE"," ",219],["T_VARIABLE","$bind",219],")",";",["T_WHITESPACE","\n        ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(",["T_VARIABLE","$customerId",220],")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","load",221],"(",["T_VARIABLE","$customer",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$customerId",221],")",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE"," ",222],["T_ELSE","else",222],["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_VARIABLE","$customer",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","setData",223],"(",["T_ARRAY","array",223],"(",")",")",";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE","\n\n        ",224],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$this",226],";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_DOC_COMMENT","\/**\n     * Change customer password\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @param string $newPassword\n     * @return Mage_Customer_Model_Resource_Customer\n     *\/",229],["T_WHITESPACE","\n    ",235],["T_PUBLIC","public",236],["T_WHITESPACE"," ",236],["T_FUNCTION","function",236],["T_WHITESPACE"," ",236],["T_STRING","changePassword",236],"(",["T_STRING","Mage_Customer_Model_Customer",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$customer",236],",",["T_WHITESPACE"," ",236],["T_VARIABLE","$newPassword",236],")",["T_WHITESPACE","\n    ",236],"{",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$customer",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","setPassword",238],"(",["T_VARIABLE","$newPassword",238],")",";",["T_WHITESPACE","\n        ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","saveAttribute",239],"(",["T_VARIABLE","$customer",239],",",["T_WHITESPACE"," ",239],["T_CONSTANT_ENCAPSED_STRING","'password_hash'",239],")",";",["T_WHITESPACE","\n        ",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$this",240],";",["T_WHITESPACE","\n    ",240],"}",["T_WHITESPACE","\n\n    ",241],["T_DOC_COMMENT","\/**\n     * Check whether there are email duplicates of customers in global scope\n     *\n     * @return bool\n     *\/",243],["T_WHITESPACE","\n    ",247],["T_PUBLIC","public",248],["T_WHITESPACE"," ",248],["T_FUNCTION","function",248],["T_WHITESPACE"," ",248],["T_STRING","findEmailDuplicates",248],"(",")",["T_WHITESPACE","\n    ",248],"{",["T_WHITESPACE","\n        ",249],["T_VARIABLE","$adapter",250],["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","_getReadAdapter",250],"(",")",";",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$select",251],["T_WHITESPACE","  ",251],"=",["T_WHITESPACE"," ",251],["T_VARIABLE","$adapter",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","select",251],"(",")",["T_WHITESPACE","\n            ",251],["T_OBJECT_OPERATOR","->",252],["T_STRING","from",252],"(",["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getTable",252],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/entity'",252],")",",",["T_WHITESPACE"," ",252],["T_ARRAY","array",252],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",252],",",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'cnt'",252],["T_WHITESPACE"," ",252],["T_DOUBLE_ARROW","=>",252],["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'COUNT(*)'",252],")",")",["T_WHITESPACE","\n            ",252],["T_OBJECT_OPERATOR","->",253],["T_STRING","group",253],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",253],")",["T_WHITESPACE","\n            ",253],["T_OBJECT_OPERATOR","->",254],["T_STRING","order",254],"(",["T_CONSTANT_ENCAPSED_STRING","'cnt DESC'",254],")",["T_WHITESPACE","\n            ",254],["T_OBJECT_OPERATOR","->",255],["T_STRING","limit",255],"(",["T_LNUMBER","1",255],")",";",["T_WHITESPACE","\n        ",255],["T_VARIABLE","$lookup",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$adapter",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","fetchRow",256],"(",["T_VARIABLE","$select",256],")",";",["T_WHITESPACE","\n        ",256],["T_IF","if",257],["T_WHITESPACE"," ",257],"(",["T_EMPTY","empty",257],"(",["T_VARIABLE","$lookup",257],")",")",["T_WHITESPACE"," ",257],"{",["T_WHITESPACE","\n            ",257],["T_RETURN","return",258],["T_WHITESPACE"," ",258],["T_STRING","false",258],";",["T_WHITESPACE","\n        ",258],"}",["T_WHITESPACE","\n        ",259],["T_RETURN","return",260],["T_WHITESPACE"," ",260],["T_VARIABLE","$lookup",260],"[",["T_CONSTANT_ENCAPSED_STRING","'cnt'",260],"]",["T_WHITESPACE"," ",260],">",["T_WHITESPACE"," ",260],["T_LNUMBER","1",260],";",["T_WHITESPACE","\n    ",260],"}",["T_WHITESPACE","\n\n    ",261],["T_DOC_COMMENT","\/**\n     * Check customer by id\n     *\n     * @param int $customerId\n     * @return bool\n     *\/",263],["T_WHITESPACE","\n    ",268],["T_PUBLIC","public",269],["T_WHITESPACE"," ",269],["T_FUNCTION","function",269],["T_WHITESPACE"," ",269],["T_STRING","checkCustomerId",269],"(",["T_VARIABLE","$customerId",269],")",["T_WHITESPACE","\n    ",269],"{",["T_WHITESPACE","\n        ",270],["T_VARIABLE","$adapter",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","_getReadAdapter",271],"(",")",";",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$bind",272],["T_WHITESPACE","    ",272],"=",["T_WHITESPACE"," ",272],["T_ARRAY","array",272],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",272],["T_WHITESPACE"," ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_INT_CAST","(int)",272],["T_VARIABLE","$customerId",272],")",";",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$select",273],["T_WHITESPACE","  ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$adapter",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","select",273],"(",")",["T_WHITESPACE","\n            ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","from",274],"(",["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getTable",274],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/entity'",274],")",",",["T_WHITESPACE"," ",274],["T_CONSTANT_ENCAPSED_STRING","'entity_id'",274],")",["T_WHITESPACE","\n            ",274],["T_OBJECT_OPERATOR","->",275],["T_STRING","where",275],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",275],")",["T_WHITESPACE","\n            ",275],["T_OBJECT_OPERATOR","->",276],["T_STRING","limit",276],"(",["T_LNUMBER","1",276],")",";",["T_WHITESPACE","\n\n        ",276],["T_VARIABLE","$result",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_VARIABLE","$adapter",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","fetchOne",278],"(",["T_VARIABLE","$select",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$bind",278],")",";",["T_WHITESPACE","\n        ",278],["T_IF","if",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$result",279],")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n            ",279],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_STRING","true",280],";",["T_WHITESPACE","\n        ",280],"}",["T_WHITESPACE","\n        ",281],["T_RETURN","return",282],["T_WHITESPACE"," ",282],["T_STRING","false",282],";",["T_WHITESPACE","\n    ",282],"}",["T_WHITESPACE","\n\n    ",283],["T_DOC_COMMENT","\/**\n     * Get customer website id\n     *\n     * @param int $customerId\n     * @return int\n     *\/",285],["T_WHITESPACE","\n    ",290],["T_PUBLIC","public",291],["T_WHITESPACE"," ",291],["T_FUNCTION","function",291],["T_WHITESPACE"," ",291],["T_STRING","getWebsiteId",291],"(",["T_VARIABLE","$customerId",291],")",["T_WHITESPACE","\n    ",291],"{",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$adapter",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","_getReadAdapter",293],"(",")",";",["T_WHITESPACE","\n        ",293],["T_VARIABLE","$bind",294],["T_WHITESPACE","    ",294],"=",["T_WHITESPACE"," ",294],["T_ARRAY","array",294],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",294],["T_WHITESPACE"," ",294],["T_DOUBLE_ARROW","=>",294],["T_WHITESPACE"," ",294],["T_INT_CAST","(int)",294],["T_VARIABLE","$customerId",294],")",";",["T_WHITESPACE","\n        ",294],["T_VARIABLE","$select",295],["T_WHITESPACE","  ",295],"=",["T_WHITESPACE"," ",295],["T_VARIABLE","$adapter",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","select",295],"(",")",["T_WHITESPACE","\n            ",295],["T_OBJECT_OPERATOR","->",296],["T_STRING","from",296],"(",["T_VARIABLE","$this",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","getTable",296],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/entity'",296],")",",",["T_WHITESPACE"," ",296],["T_CONSTANT_ENCAPSED_STRING","'website_id'",296],")",["T_WHITESPACE","\n            ",296],["T_OBJECT_OPERATOR","->",297],["T_STRING","where",297],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id = :entity_id'",297],")",";",["T_WHITESPACE","\n\n        ",297],["T_RETURN","return",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$adapter",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","fetchOne",299],"(",["T_VARIABLE","$select",299],",",["T_WHITESPACE"," ",299],["T_VARIABLE","$bind",299],")",";",["T_WHITESPACE","\n    ",299],"}",["T_WHITESPACE","\n\n    ",300],["T_DOC_COMMENT","\/**\n     * Custom setter of increment ID if its needed\n     *\n     * @param Varien_Object $object\n     * @return Mage_Customer_Model_Resource_Customer\n     *\/",302],["T_WHITESPACE","\n    ",307],["T_PUBLIC","public",308],["T_WHITESPACE"," ",308],["T_FUNCTION","function",308],["T_WHITESPACE"," ",308],["T_STRING","setNewIncrementId",308],"(",["T_STRING","Varien_Object",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$object",308],")",["T_WHITESPACE","\n    ",308],"{",["T_WHITESPACE","\n        ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(",["T_STRING","Mage",310],["T_DOUBLE_COLON","::",310],["T_STRING","getStoreConfig",310],"(",["T_STRING","Mage_Customer_Model_Customer",310],["T_DOUBLE_COLON","::",310],["T_STRING","XML_PATH_GENERATE_HUMAN_FRIENDLY_ID",310],")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_STRING","parent",311],["T_DOUBLE_COLON","::",311],["T_STRING","setNewIncrementId",311],"(",["T_VARIABLE","$object",311],")",";",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n        ",312],["T_RETURN","return",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],";",["T_WHITESPACE","\n    ",313],"}",["T_WHITESPACE","\n\n    ",314],["T_DOC_COMMENT","\/**\n     * Change reset password link token\n     *\n     * Stores new reset password link token and its creation time\n     *\n     * @param Mage_Customer_Model_Customer $newResetPasswordLinkToken\n     * @param string $newResetPasswordLinkToken\n     * @return Mage_Customer_Model_Resource_Customer\n     *\/",316],["T_WHITESPACE","\n    ",324],["T_PUBLIC","public",325],["T_WHITESPACE"," ",325],["T_FUNCTION","function",325],["T_WHITESPACE"," ",325],["T_STRING","changeResetPasswordLinkToken",325],"(",["T_STRING","Mage_Customer_Model_Customer",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$customer",325],",",["T_WHITESPACE"," ",325],["T_VARIABLE","$newResetPasswordLinkToken",325],")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n        ",325],["T_IF","if",326],["T_WHITESPACE"," ",326],"(",["T_STRING","is_string",326],"(",["T_VARIABLE","$newResetPasswordLinkToken",326],")",["T_WHITESPACE"," ",326],["T_BOOLEAN_AND","&&",326],["T_WHITESPACE"," ",326],"!",["T_EMPTY","empty",326],"(",["T_VARIABLE","$newResetPasswordLinkToken",326],")",")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n            ",326],["T_VARIABLE","$customer",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","setRpToken",327],"(",["T_VARIABLE","$newResetPasswordLinkToken",327],")",";",["T_WHITESPACE","\n            ",327],["T_VARIABLE","$currentDate",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_STRING","Varien_Date",328],["T_DOUBLE_COLON","::",328],["T_STRING","now",328],"(",")",";",["T_WHITESPACE","\n            ",328],["T_VARIABLE","$customer",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","setRpTokenCreatedAt",329],"(",["T_VARIABLE","$currentDate",329],")",";",["T_WHITESPACE","\n            ",329],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","saveAttribute",330],"(",["T_VARIABLE","$customer",330],",",["T_WHITESPACE"," ",330],["T_CONSTANT_ENCAPSED_STRING","'rp_token'",330],")",";",["T_WHITESPACE","\n            ",330],["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","saveAttribute",331],"(",["T_VARIABLE","$customer",331],",",["T_WHITESPACE"," ",331],["T_CONSTANT_ENCAPSED_STRING","'rp_token_created_at'",331],")",";",["T_WHITESPACE","\n        ",331],"}",["T_WHITESPACE","\n        ",332],["T_RETURN","return",333],["T_WHITESPACE"," ",333],["T_VARIABLE","$this",333],";",["T_WHITESPACE","\n    ",333],"}",["T_WHITESPACE","\n",334],"}",["T_WHITESPACE","\n",335]]