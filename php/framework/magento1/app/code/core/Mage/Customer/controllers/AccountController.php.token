[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Customer\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Customer account controller\n *\n * @category   Mage\n * @package    Mage_Customer\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Customer_AccountController",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Core_Controller_Front_Action",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","CUSTOMER_ID_SESSION_NAME",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","\"customerId\"",36],";",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","TOKEN_SESSION_NAME",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","\"token\"",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * Action list where need check enabled cookie\n     *\n     * @var array\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_cookieCheckActions",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_ARRAY","array",44],"(",["T_CONSTANT_ENCAPSED_STRING","'loginPost'",44],",",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'createpost'",44],")",";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Retrieve customer session model object\n     *\n     * @return Mage_Customer_Model_Session\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","_getSession",51],"(",")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_RETURN","return",53],["T_WHITESPACE"," ",53],["T_STRING","Mage",53],["T_DOUBLE_COLON","::",53],["T_STRING","getSingleton",53],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",53],")",";",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Action predispatch\n     *\n     * Check customer authentication for some actions\n     *\/",56],["T_WHITESPACE","\n    ",60],["T_PUBLIC","public",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","preDispatch",61],"(",")",["T_WHITESPACE","\n    ",61],"{",["T_WHITESPACE","\n        ",62],["T_COMMENT","\/\/ a brute-force protection here would be nice\n",63],["T_WHITESPACE","\n        ",64],["T_STRING","parent",65],["T_DOUBLE_COLON","::",65],["T_STRING","preDispatch",65],"(",")",";",["T_WHITESPACE","\n\n        ",65],["T_IF","if",67],["T_WHITESPACE"," ",67],"(","!",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getRequest",67],"(",")",["T_OBJECT_OPERATOR","->",67],["T_STRING","isDispatched",67],"(",")",")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n            ",67],["T_RETURN","return",68],";",["T_WHITESPACE","\n        ",68],"}",["T_WHITESPACE","\n\n        ",69],["T_VARIABLE","$action",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","strtolower",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getRequest",71],"(",")",["T_OBJECT_OPERATOR","->",71],["T_STRING","getActionName",71],"(",")",")",";",["T_WHITESPACE","\n        ",71],["T_VARIABLE","$openActions",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_ARRAY","array",72],"(",["T_WHITESPACE","\n            ",72],["T_CONSTANT_ENCAPSED_STRING","'create'",73],",",["T_WHITESPACE","\n            ",73],["T_CONSTANT_ENCAPSED_STRING","'login'",74],",",["T_WHITESPACE","\n            ",74],["T_CONSTANT_ENCAPSED_STRING","'logoutsuccess'",75],",",["T_WHITESPACE","\n            ",75],["T_CONSTANT_ENCAPSED_STRING","'forgotpassword'",76],",",["T_WHITESPACE","\n            ",76],["T_CONSTANT_ENCAPSED_STRING","'forgotpasswordpost'",77],",",["T_WHITESPACE","\n            ",77],["T_CONSTANT_ENCAPSED_STRING","'changeforgotten'",78],",",["T_WHITESPACE","\n            ",78],["T_CONSTANT_ENCAPSED_STRING","'resetpassword'",79],",",["T_WHITESPACE","\n            ",79],["T_CONSTANT_ENCAPSED_STRING","'resetpasswordpost'",80],",",["T_WHITESPACE","\n            ",80],["T_CONSTANT_ENCAPSED_STRING","'confirm'",81],",",["T_WHITESPACE","\n            ",81],["T_CONSTANT_ENCAPSED_STRING","'confirmation'",82],["T_WHITESPACE","\n        ",82],")",";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$pattern",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'\/^('",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_STRING","implode",84],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",84],",",["T_WHITESPACE"," ",84],["T_VARIABLE","$openActions",84],")",["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","')\/i'",84],";",["T_WHITESPACE","\n\n        ",84],["T_IF","if",86],["T_WHITESPACE"," ",86],"(","!",["T_STRING","preg_match",86],"(",["T_VARIABLE","$pattern",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$action",86],")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_IF","if",87],["T_WHITESPACE"," ",87],"(","!",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_getSession",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","authenticate",87],"(",["T_VARIABLE","$this",87],")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n                ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","setFlag",88],"(",["T_CONSTANT_ENCAPSED_STRING","''",88],",",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'no-dispatch'",88],",",["T_WHITESPACE"," ",88],["T_STRING","true",88],")",";",["T_WHITESPACE","\n            ",88],"}",["T_WHITESPACE","\n        ",89],"}",["T_WHITESPACE"," ",90],["T_ELSE","else",90],["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","_getSession",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","setNoReferer",91],"(",["T_STRING","true",91],")",";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n    ",92],"}",["T_WHITESPACE","\n\n    ",93],["T_DOC_COMMENT","\/**\n     * Action postdispatch\n     *\n     * Remove No-referer flag from customer session after each action\n     *\/",95],["T_WHITESPACE","\n    ",99],["T_PUBLIC","public",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","postDispatch",100],"(",")",["T_WHITESPACE","\n    ",100],"{",["T_WHITESPACE","\n        ",101],["T_STRING","parent",102],["T_DOUBLE_COLON","::",102],["T_STRING","postDispatch",102],"(",")",";",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_getSession",103],"(",")",["T_OBJECT_OPERATOR","->",103],["T_STRING","unsNoReferer",103],"(",["T_STRING","false",103],")",";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Default customer account page\n     *\/",106],["T_WHITESPACE","\n    ",108],["T_PUBLIC","public",109],["T_WHITESPACE"," ",109],["T_FUNCTION","function",109],["T_WHITESPACE"," ",109],["T_STRING","indexAction",109],"(",")",["T_WHITESPACE","\n    ",109],"{",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","loadLayout",111],"(",")",";",["T_WHITESPACE","\n        ",111],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_initLayoutMessages",112],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",112],")",";",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_initLayoutMessages",113],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",113],")",";",["T_WHITESPACE","\n\n        ",113],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getLayout",115],"(",")",["T_OBJECT_OPERATOR","->",115],["T_STRING","getBlock",115],"(",["T_CONSTANT_ENCAPSED_STRING","'content'",115],")",["T_OBJECT_OPERATOR","->",115],["T_STRING","append",115],"(",["T_WHITESPACE","\n            ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getLayout",116],"(",")",["T_OBJECT_OPERATOR","->",116],["T_STRING","createBlock",116],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/account_dashboard'",116],")",["T_WHITESPACE","\n        ",116],")",";",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getLayout",118],"(",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","getBlock",118],"(",["T_CONSTANT_ENCAPSED_STRING","'head'",118],")",["T_OBJECT_OPERATOR","->",118],["T_STRING","setTitle",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","__",118],"(",["T_CONSTANT_ENCAPSED_STRING","'My Account'",118],")",")",";",["T_WHITESPACE","\n        ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","renderLayout",119],"(",")",";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Customer login form page\n     *\/",122],["T_WHITESPACE","\n    ",124],["T_PUBLIC","public",125],["T_WHITESPACE"," ",125],["T_FUNCTION","function",125],["T_WHITESPACE"," ",125],["T_STRING","loginAction",125],"(",")",["T_WHITESPACE","\n    ",125],"{",["T_WHITESPACE","\n        ",126],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","_getSession",127],"(",")",["T_OBJECT_OPERATOR","->",127],["T_STRING","isLoggedIn",127],"(",")",")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_redirect",128],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",128],")",";",["T_WHITESPACE","\n            ",128],["T_RETURN","return",129],";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getResponse",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","setHeader",131],"(",["T_CONSTANT_ENCAPSED_STRING","'Login-Required'",131],",",["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'true'",131],")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","loadLayout",132],"(",")",";",["T_WHITESPACE","\n        ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","_initLayoutMessages",133],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",133],")",";",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","_initLayoutMessages",134],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",134],")",";",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","renderLayout",135],"(",")",";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Login post action\n     *\/",138],["T_WHITESPACE","\n    ",140],["T_PUBLIC","public",141],["T_WHITESPACE"," ",141],["T_FUNCTION","function",141],["T_WHITESPACE"," ",141],["T_STRING","loginPostAction",141],"(",")",["T_WHITESPACE","\n    ",141],"{",["T_WHITESPACE","\n        ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(","!",["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_validateFormKey",143],"(",")",")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_redirect",144],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",144],")",";",["T_WHITESPACE","\n            ",144],["T_RETURN","return",145],";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n\n        ",146],["T_IF","if",148],["T_WHITESPACE"," ",148],"(",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","_getSession",148],"(",")",["T_OBJECT_OPERATOR","->",148],["T_STRING","isLoggedIn",148],"(",")",")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","_redirect",149],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",149],")",";",["T_WHITESPACE","\n            ",149],["T_RETURN","return",150],";",["T_WHITESPACE","\n        ",150],"}",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$session",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_getSession",152],"(",")",";",["T_WHITESPACE","\n\n        ",152],["T_IF","if",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getRequest",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","isPost",154],"(",")",")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$login",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getRequest",155],"(",")",["T_OBJECT_OPERATOR","->",155],["T_STRING","getPost",155],"(",["T_CONSTANT_ENCAPSED_STRING","'login'",155],")",";",["T_WHITESPACE","\n            ",155],["T_IF","if",156],["T_WHITESPACE"," ",156],"(","!",["T_EMPTY","empty",156],"(",["T_VARIABLE","$login",156],"[",["T_CONSTANT_ENCAPSED_STRING","'username'",156],"]",")",["T_WHITESPACE"," ",156],["T_BOOLEAN_AND","&&",156],["T_WHITESPACE"," ",156],"!",["T_EMPTY","empty",156],"(",["T_VARIABLE","$login",156],"[",["T_CONSTANT_ENCAPSED_STRING","'password'",156],"]",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n                ",156],["T_TRY","try",157],["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n                    ",157],["T_VARIABLE","$session",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","login",158],"(",["T_VARIABLE","$login",158],"[",["T_CONSTANT_ENCAPSED_STRING","'username'",158],"]",",",["T_WHITESPACE"," ",158],["T_VARIABLE","$login",158],"[",["T_CONSTANT_ENCAPSED_STRING","'password'",158],"]",")",";",["T_WHITESPACE","\n                    ",158],["T_IF","if",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$session",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getCustomer",159],"(",")",["T_OBJECT_OPERATOR","->",159],["T_STRING","getIsJustConfirmed",159],"(",")",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                        ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","_welcomeCustomer",160],"(",["T_VARIABLE","$session",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getCustomer",160],"(",")",",",["T_WHITESPACE"," ",160],["T_STRING","true",160],")",";",["T_WHITESPACE","\n                    ",160],"}",["T_WHITESPACE","\n                ",161],"}",["T_WHITESPACE"," ",162],["T_CATCH","catch",162],["T_WHITESPACE"," ",162],"(",["T_STRING","Mage_Core_Exception",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$e",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n                    ",162],["T_SWITCH","switch",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$e",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getCode",163],"(",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                        ",163],["T_CASE","case",164],["T_WHITESPACE"," ",164],["T_STRING","Mage_Customer_Model_Customer",164],["T_DOUBLE_COLON","::",164],["T_STRING","EXCEPTION_EMAIL_NOT_CONFIRMED",164],":",["T_WHITESPACE","\n                            ",164],["T_VARIABLE","$value",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_getHelper",165],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",165],")",["T_OBJECT_OPERATOR","->",165],["T_STRING","getEmailConfirmationUrl",165],"(",["T_VARIABLE","$login",165],"[",["T_CONSTANT_ENCAPSED_STRING","'username'",165],"]",")",";",["T_WHITESPACE","\n                            ",165],["T_VARIABLE","$message",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_getHelper",166],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",166],")",["T_OBJECT_OPERATOR","->",166],["T_STRING","__",166],"(",["T_CONSTANT_ENCAPSED_STRING","'This account is not confirmed. <a href=\"%s\">Click here<\/a> to resend confirmation email.'",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$value",166],")",";",["T_WHITESPACE","\n                            ",166],["T_BREAK","break",167],";",["T_WHITESPACE","\n                        ",167],["T_CASE","case",168],["T_WHITESPACE"," ",168],["T_STRING","Mage_Customer_Model_Customer",168],["T_DOUBLE_COLON","::",168],["T_STRING","EXCEPTION_INVALID_EMAIL_OR_PASSWORD",168],":",["T_WHITESPACE","\n                            ",168],["T_VARIABLE","$message",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$e",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getMessage",169],"(",")",";",["T_WHITESPACE","\n                            ",169],["T_BREAK","break",170],";",["T_WHITESPACE","\n                        ",170],["T_DEFAULT","default",171],":",["T_WHITESPACE","\n                            ",171],["T_VARIABLE","$message",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$e",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getMessage",172],"(",")",";",["T_WHITESPACE","\n                    ",172],"}",["T_WHITESPACE","\n                    ",173],["T_VARIABLE","$session",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","addError",174],"(",["T_VARIABLE","$message",174],")",";",["T_WHITESPACE","\n                    ",174],["T_VARIABLE","$session",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","setUsername",175],"(",["T_VARIABLE","$login",175],"[",["T_CONSTANT_ENCAPSED_STRING","'username'",175],"]",")",";",["T_WHITESPACE","\n                ",175],"}",["T_WHITESPACE"," ",176],["T_CATCH","catch",176],["T_WHITESPACE"," ",176],"(",["T_STRING","Exception",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$e",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                    ",176],["T_COMMENT","\/\/ Mage::logException($e); \/\/ PA DSS violation: this exception log can disclose customer password\n",177],["T_WHITESPACE","                ",178],"}",["T_WHITESPACE","\n            ",178],"}",["T_WHITESPACE"," ",179],["T_ELSE","else",179],["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$session",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","addError",180],"(",["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","__",180],"(",["T_CONSTANT_ENCAPSED_STRING","'Login and password are required.'",180],")",")",";",["T_WHITESPACE","\n            ",180],"}",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n\n        ",182],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","_loginPostRedirect",184],"(",")",";",["T_WHITESPACE","\n    ",184],"}",["T_WHITESPACE","\n\n    ",185],["T_DOC_COMMENT","\/**\n     * Define target URL and redirect customer after logging in\n     *\/",187],["T_WHITESPACE","\n    ",189],["T_PROTECTED","protected",190],["T_WHITESPACE"," ",190],["T_FUNCTION","function",190],["T_WHITESPACE"," ",190],["T_STRING","_loginPostRedirect",190],"(",")",["T_WHITESPACE","\n    ",190],"{",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$session",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","_getSession",192],"(",")",";",["T_WHITESPACE","\n\n        ",192],["T_IF","if",194],["T_WHITESPACE"," ",194],"(","!",["T_VARIABLE","$session",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getBeforeAuthUrl",194],"(",")",["T_WHITESPACE"," ",194],["T_BOOLEAN_OR","||",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$session",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getBeforeAuthUrl",194],"(",")",["T_WHITESPACE"," ",194],["T_IS_EQUAL","==",194],["T_WHITESPACE"," ",194],["T_STRING","Mage",194],["T_DOUBLE_COLON","::",194],["T_STRING","getBaseUrl",194],"(",")",")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_COMMENT","\/\/ Set default URL to redirect customer to\n",195],["T_WHITESPACE","            ",196],["T_VARIABLE","$session",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","setBeforeAuthUrl",196],"(",["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_getHelper",196],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",196],")",["T_OBJECT_OPERATOR","->",196],["T_STRING","getAccountUrl",196],"(",")",")",";",["T_WHITESPACE","\n            ",196],["T_COMMENT","\/\/ Redirect customer to the last page visited after logging in\n",197],["T_WHITESPACE","            ",198],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$session",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","isLoggedIn",198],"(",")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n                ",198],["T_IF","if",199],["T_WHITESPACE"," ",199],"(","!",["T_STRING","Mage",199],["T_DOUBLE_COLON","::",199],["T_STRING","getStoreConfigFlag",199],"(",["T_WHITESPACE","\n                    ",199],["T_STRING","Mage_Customer_Helper_Data",200],["T_DOUBLE_COLON","::",200],["T_STRING","XML_PATH_CUSTOMER_STARTUP_REDIRECT_TO_DASHBOARD",200],["T_WHITESPACE","\n                ",200],")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                    ",201],["T_VARIABLE","$referer",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getRequest",202],"(",")",["T_OBJECT_OPERATOR","->",202],["T_STRING","getParam",202],"(",["T_STRING","Mage_Customer_Helper_Data",202],["T_DOUBLE_COLON","::",202],["T_STRING","REFERER_QUERY_PARAM_NAME",202],")",";",["T_WHITESPACE","\n                    ",202],["T_IF","if",203],["T_WHITESPACE"," ",203],"(",["T_VARIABLE","$referer",203],")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n                        ",203],["T_COMMENT","\/\/ Rebuild referer URL to handle the case when SID was changed\n",204],["T_WHITESPACE","                        ",205],["T_VARIABLE","$referer",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","_getModel",205],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/url'",205],")",["T_WHITESPACE","\n                            ",205],["T_OBJECT_OPERATOR","->",206],["T_STRING","getRebuiltUrl",206],"(",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_getHelper",206],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",206],")",["T_OBJECT_OPERATOR","->",206],["T_STRING","urlDecodeAndEscape",206],"(",["T_VARIABLE","$referer",206],")",")",";",["T_WHITESPACE","\n                        ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_isUrlInternal",207],"(",["T_VARIABLE","$referer",207],")",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                            ",207],["T_VARIABLE","$session",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","setBeforeAuthUrl",208],"(",["T_VARIABLE","$referer",208],")",";",["T_WHITESPACE","\n                        ",208],"}",["T_WHITESPACE","\n                    ",209],"}",["T_WHITESPACE","\n                ",210],"}",["T_WHITESPACE"," ",211],["T_ELSE","else",211],["T_WHITESPACE"," ",211],["T_IF","if",211],["T_WHITESPACE"," ",211],"(",["T_VARIABLE","$session",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getAfterAuthUrl",211],"(",")",")",["T_WHITESPACE"," ",211],"{",["T_WHITESPACE","\n                    ",211],["T_VARIABLE","$session",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","setBeforeAuthUrl",212],"(",["T_VARIABLE","$session",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getAfterAuthUrl",212],"(",["T_STRING","true",212],")",")",";",["T_WHITESPACE","\n                ",212],"}",["T_WHITESPACE","\n            ",213],"}",["T_WHITESPACE"," ",214],["T_ELSE","else",214],["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n                ",214],["T_VARIABLE","$session",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","setBeforeAuthUrl",215],"(",["T_WHITESPACE"," ",215],["T_VARIABLE","$this",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","_getHelper",215],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",215],")",["T_OBJECT_OPERATOR","->",215],["T_STRING","getLoginUrl",215],"(",")",")",";",["T_WHITESPACE","\n            ",215],"}",["T_WHITESPACE","\n        ",216],"}",["T_WHITESPACE"," ",217],["T_ELSE","else",217],["T_WHITESPACE"," ",217],["T_IF","if",217],["T_WHITESPACE"," ",217],"(",["T_VARIABLE","$session",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","getBeforeAuthUrl",217],"(",")",["T_WHITESPACE"," ",217],["T_IS_EQUAL","==",217],["T_WHITESPACE","  ",217],["T_VARIABLE","$this",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","_getHelper",217],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",217],")",["T_OBJECT_OPERATOR","->",217],["T_STRING","getLogoutUrl",217],"(",")",")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$session",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","setBeforeAuthUrl",218],"(",["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","_getHelper",218],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",218],")",["T_OBJECT_OPERATOR","->",218],["T_STRING","getDashboardUrl",218],"(",")",")",";",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE"," ",219],["T_ELSE","else",219],["T_WHITESPACE"," ",219],"{",["T_WHITESPACE","\n            ",219],["T_IF","if",220],["T_WHITESPACE"," ",220],"(","!",["T_VARIABLE","$session",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getAfterAuthUrl",220],"(",")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n                ",220],["T_VARIABLE","$session",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setAfterAuthUrl",221],"(",["T_VARIABLE","$session",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getBeforeAuthUrl",221],"(",")",")",";",["T_WHITESPACE","\n            ",221],"}",["T_WHITESPACE","\n            ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$session",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","isLoggedIn",223],"(",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                ",223],["T_VARIABLE","$session",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","setBeforeAuthUrl",224],"(",["T_VARIABLE","$session",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getAfterAuthUrl",224],"(",["T_STRING","true",224],")",")",";",["T_WHITESPACE","\n            ",224],"}",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_redirectUrl",227],"(",["T_VARIABLE","$session",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getBeforeAuthUrl",227],"(",["T_STRING","true",227],")",")",";",["T_WHITESPACE","\n    ",227],"}",["T_WHITESPACE","\n\n    ",228],["T_DOC_COMMENT","\/**\n     * Customer logout action\n     *\/",230],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","logoutAction",233],"(",")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$session",235],["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_getSession",235],"(",")",";",["T_WHITESPACE","\n        ",235],["T_VARIABLE","$session",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","logout",236],"(",")",["T_OBJECT_OPERATOR","->",236],["T_STRING","renewSession",236],"(",")",";",["T_WHITESPACE","\n\n        ",236],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_STRING","Mage",238],["T_DOUBLE_COLON","::",238],["T_STRING","getStoreConfigFlag",238],"(",["T_STRING","Mage_Customer_Helper_Data",238],["T_DOUBLE_COLON","::",238],["T_STRING","XML_PATH_CUSTOMER_STARTUP_REDIRECT_TO_DASHBOARD",238],")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$session",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","setBeforeAuthUrl",239],"(",["T_STRING","Mage",239],["T_DOUBLE_COLON","::",239],["T_STRING","getBaseUrl",239],"(",")",")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE"," ",240],["T_ELSE","else",240],["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$session",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setBeforeAuthUrl",241],"(",["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_getRefererUrl",241],"(",")",")",";",["T_WHITESPACE","\n        ",241],"}",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","_redirect",243],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/logoutSuccess'",243],")",";",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n\n    ",244],["T_DOC_COMMENT","\/**\n     * Logout success page\n     *\/",246],["T_WHITESPACE","\n    ",248],["T_PUBLIC","public",249],["T_WHITESPACE"," ",249],["T_FUNCTION","function",249],["T_WHITESPACE"," ",249],["T_STRING","logoutSuccessAction",249],"(",")",["T_WHITESPACE","\n    ",249],"{",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$this",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","loadLayout",251],"(",")",";",["T_WHITESPACE","\n        ",251],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","renderLayout",252],"(",")",";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Customer register form page\n     *\/",255],["T_WHITESPACE","\n    ",257],["T_PUBLIC","public",258],["T_WHITESPACE"," ",258],["T_FUNCTION","function",258],["T_WHITESPACE"," ",258],["T_STRING","createAction",258],"(",")",["T_WHITESPACE","\n    ",258],"{",["T_WHITESPACE","\n        ",259],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","_getSession",260],"(",")",["T_OBJECT_OPERATOR","->",260],["T_STRING","isLoggedIn",260],"(",")",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","_redirect",261],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*'",261],")",";",["T_WHITESPACE","\n            ",261],["T_RETURN","return",262],";",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n\n        ",263],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","loadLayout",265],"(",")",";",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","_initLayoutMessages",266],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",266],")",";",["T_WHITESPACE","\n        ",266],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","renderLayout",267],"(",")",";",["T_WHITESPACE","\n    ",267],"}",["T_WHITESPACE","\n\n    ",268],["T_DOC_COMMENT","\/**\n     * Create customer account action\n     *\/",270],["T_WHITESPACE","\n    ",272],["T_PUBLIC","public",273],["T_WHITESPACE"," ",273],["T_FUNCTION","function",273],["T_WHITESPACE"," ",273],["T_STRING","createPostAction",273],"(",")",["T_WHITESPACE","\n    ",273],"{",["T_WHITESPACE","\n        ",274],["T_VARIABLE","$errUrl",275],["T_WHITESPACE"," ",275],"=",["T_WHITESPACE"," ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","_getUrl",275],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/create'",275],",",["T_WHITESPACE"," ",275],["T_ARRAY","array",275],"(",["T_CONSTANT_ENCAPSED_STRING","'_secure'",275],["T_WHITESPACE"," ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_STRING","true",275],")",")",";",["T_WHITESPACE","\n\n        ",275],["T_IF","if",277],["T_WHITESPACE"," ",277],"(","!",["T_VARIABLE","$this",277],["T_OBJECT_OPERATOR","->",277],["T_STRING","_validateFormKey",277],"(",")",")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","_redirectError",278],"(",["T_VARIABLE","$errUrl",278],")",";",["T_WHITESPACE","\n            ",278],["T_RETURN","return",279],";",["T_WHITESPACE","\n        ",279],"}",["T_WHITESPACE","\n\n        ",280],["T_DOC_COMMENT","\/** @var $session Mage_Customer_Model_Session *\/",282],["T_WHITESPACE","\n        ",282],["T_VARIABLE","$session",283],["T_WHITESPACE"," ",283],"=",["T_WHITESPACE"," ",283],["T_VARIABLE","$this",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","_getSession",283],"(",")",";",["T_WHITESPACE","\n        ",283],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$session",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","isLoggedIn",284],"(",")",")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","_redirect",285],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",285],")",";",["T_WHITESPACE","\n            ",285],["T_RETURN","return",286],";",["T_WHITESPACE","\n        ",286],"}",["T_WHITESPACE","\n\n        ",287],["T_IF","if",289],["T_WHITESPACE"," ",289],"(","!",["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","getRequest",289],"(",")",["T_OBJECT_OPERATOR","->",289],["T_STRING","isPost",289],"(",")",")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","_redirectError",290],"(",["T_VARIABLE","$errUrl",290],")",";",["T_WHITESPACE","\n            ",290],["T_RETURN","return",291],";",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n\n        ",292],["T_VARIABLE","$customer",294],["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],["T_OBJECT_OPERATOR","->",294],["T_STRING","_getCustomer",294],"(",")",";",["T_WHITESPACE","\n\n        ",294],["T_TRY","try",296],["T_WHITESPACE"," ",296],"{",["T_WHITESPACE","\n            ",296],["T_VARIABLE","$errors",297],["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","_getCustomerErrors",297],"(",["T_VARIABLE","$customer",297],")",";",["T_WHITESPACE","\n\n            ",297],["T_IF","if",299],["T_WHITESPACE"," ",299],"(",["T_EMPTY","empty",299],"(",["T_VARIABLE","$errors",299],")",")",["T_WHITESPACE"," ",299],"{",["T_WHITESPACE","\n                ",299],["T_VARIABLE","$customer",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","cleanPasswordsValidationData",300],"(",")",";",["T_WHITESPACE","\n                ",300],["T_VARIABLE","$customer",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","save",301],"(",")",";",["T_WHITESPACE","\n                ",301],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","_dispatchRegisterSuccess",302],"(",["T_VARIABLE","$customer",302],")",";",["T_WHITESPACE","\n                ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_successProcessRegistration",303],"(",["T_VARIABLE","$customer",303],")",";",["T_WHITESPACE","\n                ",303],["T_RETURN","return",304],";",["T_WHITESPACE","\n            ",304],"}",["T_WHITESPACE"," ",305],["T_ELSE","else",305],["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n                ",305],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_addSessionError",306],"(",["T_VARIABLE","$errors",306],")",";",["T_WHITESPACE","\n            ",306],"}",["T_WHITESPACE","\n        ",307],"}",["T_WHITESPACE"," ",308],["T_CATCH","catch",308],["T_WHITESPACE"," ",308],"(",["T_STRING","Mage_Core_Exception",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$e",308],")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$session",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","setCustomerFormData",309],"(",["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getRequest",309],"(",")",["T_OBJECT_OPERATOR","->",309],["T_STRING","getPost",309],"(",")",")",";",["T_WHITESPACE","\n            ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(",["T_VARIABLE","$e",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getCode",310],"(",")",["T_WHITESPACE"," ",310],["T_IS_IDENTICAL","===",310],["T_WHITESPACE"," ",310],["T_STRING","Mage_Customer_Model_Customer",310],["T_DOUBLE_COLON","::",310],["T_STRING","EXCEPTION_EMAIL_EXISTS",310],")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n                ",310],["T_VARIABLE","$url",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_getUrl",311],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/account\/forgotpassword'",311],")",";",["T_WHITESPACE","\n                ",311],["T_VARIABLE","$message",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","__",312],"(",["T_CONSTANT_ENCAPSED_STRING","'There is already an account with this email address. If you are sure that it is your email address, <a href=\"%s\">click here<\/a> to get your password and access your account.'",312],",",["T_WHITESPACE"," ",312],["T_VARIABLE","$url",312],")",";",["T_WHITESPACE","\n            ",312],"}",["T_WHITESPACE"," ",313],["T_ELSE","else",313],["T_WHITESPACE"," ",313],"{",["T_WHITESPACE","\n                ",313],["T_VARIABLE","$message",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","_escapeHtml",314],"(",["T_VARIABLE","$e",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","getMessage",314],"(",")",")",";",["T_WHITESPACE","\n            ",314],"}",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$session",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","addError",316],"(",["T_VARIABLE","$message",316],")",";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE"," ",317],["T_CATCH","catch",317],["T_WHITESPACE"," ",317],"(",["T_STRING","Exception",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$e",317],")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n            ",317],["T_VARIABLE","$session",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","setCustomerFormData",318],"(",["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getRequest",318],"(",")",["T_OBJECT_OPERATOR","->",318],["T_STRING","getPost",318],"(",")",")",";",["T_WHITESPACE","\n            ",318],["T_VARIABLE","$session",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","addException",319],"(",["T_VARIABLE","$e",319],",",["T_WHITESPACE"," ",319],["T_VARIABLE","$this",319],["T_OBJECT_OPERATOR","->",319],["T_STRING","__",319],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot save the customer.'",319],")",")",";",["T_WHITESPACE","\n        ",319],"}",["T_WHITESPACE","\n\n        ",320],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","_redirectError",322],"(",["T_VARIABLE","$errUrl",322],")",";",["T_WHITESPACE","\n    ",322],"}",["T_WHITESPACE","\n\n    ",323],["T_DOC_COMMENT","\/**\n     * Success Registration\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @return Mage_Customer_AccountController\n     *\/",325],["T_WHITESPACE","\n    ",330],["T_PROTECTED","protected",331],["T_WHITESPACE"," ",331],["T_FUNCTION","function",331],["T_WHITESPACE"," ",331],["T_STRING","_successProcessRegistration",331],"(",["T_STRING","Mage_Customer_Model_Customer",331],["T_WHITESPACE"," ",331],["T_VARIABLE","$customer",331],")",["T_WHITESPACE","\n    ",331],"{",["T_WHITESPACE","\n        ",332],["T_VARIABLE","$session",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","_getSession",333],"(",")",";",["T_WHITESPACE","\n        ",333],["T_IF","if",334],["T_WHITESPACE"," ",334],"(",["T_VARIABLE","$customer",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","isConfirmationRequired",334],"(",")",")",["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n            ",334],["T_DOC_COMMENT","\/** @var $app Mage_Core_Model_App *\/",335],["T_WHITESPACE","\n            ",335],["T_VARIABLE","$app",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],["T_OBJECT_OPERATOR","->",336],["T_STRING","_getApp",336],"(",")",";",["T_WHITESPACE","\n            ",336],["T_DOC_COMMENT","\/** @var $store  Mage_Core_Model_Store*\/",337],["T_WHITESPACE","\n            ",337],["T_VARIABLE","$store",338],["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_VARIABLE","$app",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","getStore",338],"(",")",";",["T_WHITESPACE","\n            ",338],["T_VARIABLE","$customer",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","sendNewAccountEmail",339],"(",["T_WHITESPACE","\n                ",339],["T_CONSTANT_ENCAPSED_STRING","'confirmation'",340],",",["T_WHITESPACE","\n                ",340],["T_VARIABLE","$session",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","getBeforeAuthUrl",341],"(",")",",",["T_WHITESPACE","\n                ",341],["T_VARIABLE","$store",342],["T_OBJECT_OPERATOR","->",342],["T_STRING","getId",342],"(",")",",",["T_WHITESPACE","\n                ",342],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getRequest",343],"(",")",["T_OBJECT_OPERATOR","->",343],["T_STRING","getPost",343],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",343],")",["T_WHITESPACE","\n            ",343],")",";",["T_WHITESPACE","\n            ",344],["T_VARIABLE","$customerHelper",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","_getHelper",345],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",345],")",";",["T_WHITESPACE","\n            ",345],["T_VARIABLE","$session",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","addSuccess",346],"(",["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","__",346],"(",["T_CONSTANT_ENCAPSED_STRING","'Account confirmation is required. Please, check your email for the confirmation link. To resend the confirmation email please <a href=\"%s\">click here<\/a>.'",346],",",["T_WHITESPACE","\n                ",346],["T_VARIABLE","$customerHelper",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getEmailConfirmationUrl",347],"(",["T_VARIABLE","$customer",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getEmail",347],"(",")",")",")",")",";",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$url",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","_getUrl",348],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",348],",",["T_WHITESPACE"," ",348],["T_ARRAY","array",348],"(",["T_CONSTANT_ENCAPSED_STRING","'_secure'",348],["T_WHITESPACE"," ",348],["T_DOUBLE_ARROW","=>",348],["T_WHITESPACE"," ",348],["T_STRING","true",348],")",")",";",["T_WHITESPACE","\n        ",348],"}",["T_WHITESPACE"," ",349],["T_ELSE","else",349],["T_WHITESPACE"," ",349],"{",["T_WHITESPACE","\n            ",349],["T_VARIABLE","$session",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","setCustomerAsLoggedIn",350],"(",["T_VARIABLE","$customer",350],")",";",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$url",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","_welcomeCustomer",351],"(",["T_VARIABLE","$customer",351],")",";",["T_WHITESPACE","\n        ",351],"}",["T_WHITESPACE","\n        ",352],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","_redirectSuccess",353],"(",["T_VARIABLE","$url",353],")",";",["T_WHITESPACE","\n        ",353],["T_RETURN","return",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$this",354],";",["T_WHITESPACE","\n    ",354],"}",["T_WHITESPACE","\n\n    ",355],["T_DOC_COMMENT","\/**\n     * Get Customer Model\n     *\n     * @return Mage_Customer_Model_Customer\n     *\/",357],["T_WHITESPACE","\n    ",361],["T_PROTECTED","protected",362],["T_WHITESPACE"," ",362],["T_FUNCTION","function",362],["T_WHITESPACE"," ",362],["T_STRING","_getCustomer",362],"(",")",["T_WHITESPACE","\n    ",362],"{",["T_WHITESPACE","\n        ",363],["T_VARIABLE","$customer",364],["T_WHITESPACE"," ",364],"=",["T_WHITESPACE"," ",364],["T_VARIABLE","$this",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","_getFromRegistry",364],"(",["T_CONSTANT_ENCAPSED_STRING","'current_customer'",364],")",";",["T_WHITESPACE","\n        ",364],["T_IF","if",365],["T_WHITESPACE"," ",365],"(","!",["T_VARIABLE","$customer",365],")",["T_WHITESPACE"," ",365],"{",["T_WHITESPACE","\n            ",365],["T_VARIABLE","$customer",366],["T_WHITESPACE"," ",366],"=",["T_WHITESPACE"," ",366],["T_VARIABLE","$this",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","_getModel",366],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",366],")",["T_OBJECT_OPERATOR","->",366],["T_STRING","setId",366],"(",["T_STRING","null",366],")",";",["T_WHITESPACE","\n        ",366],"}",["T_WHITESPACE","\n        ",367],["T_IF","if",368],["T_WHITESPACE"," ",368],"(",["T_VARIABLE","$this",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getRequest",368],"(",")",["T_OBJECT_OPERATOR","->",368],["T_STRING","getParam",368],"(",["T_CONSTANT_ENCAPSED_STRING","'is_subscribed'",368],",",["T_WHITESPACE"," ",368],["T_STRING","false",368],")",")",["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n            ",368],["T_VARIABLE","$customer",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","setIsSubscribed",369],"(",["T_LNUMBER","1",369],")",";",["T_WHITESPACE","\n        ",369],"}",["T_WHITESPACE","\n        ",370],["T_DOC_COMMENT","\/**\n         * Initialize customer group id\n         *\/",371],["T_WHITESPACE","\n        ",373],["T_VARIABLE","$customer",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getGroupId",374],"(",")",";",["T_WHITESPACE","\n\n        ",374],["T_RETURN","return",376],["T_WHITESPACE"," ",376],["T_VARIABLE","$customer",376],";",["T_WHITESPACE","\n    ",376],"}",["T_WHITESPACE","\n\n    ",377],["T_DOC_COMMENT","\/**\n     * Add session error method\n     *\n     * @param string|array $errors\n     *\/",379],["T_WHITESPACE","\n    ",383],["T_PROTECTED","protected",384],["T_WHITESPACE"," ",384],["T_FUNCTION","function",384],["T_WHITESPACE"," ",384],["T_STRING","_addSessionError",384],"(",["T_VARIABLE","$errors",384],")",["T_WHITESPACE","\n    ",384],"{",["T_WHITESPACE","\n        ",385],["T_VARIABLE","$session",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_VARIABLE","$this",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","_getSession",386],"(",")",";",["T_WHITESPACE","\n        ",386],["T_VARIABLE","$session",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","setCustomerFormData",387],"(",["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getRequest",387],"(",")",["T_OBJECT_OPERATOR","->",387],["T_STRING","getPost",387],"(",")",")",";",["T_WHITESPACE","\n        ",387],["T_IF","if",388],["T_WHITESPACE"," ",388],"(",["T_STRING","is_array",388],"(",["T_VARIABLE","$errors",388],")",")",["T_WHITESPACE"," ",388],"{",["T_WHITESPACE","\n            ",388],["T_FOREACH","foreach",389],["T_WHITESPACE"," ",389],"(",["T_VARIABLE","$errors",389],["T_WHITESPACE"," ",389],["T_AS","as",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$errorMessage",389],")",["T_WHITESPACE"," ",389],"{",["T_WHITESPACE","\n                ",389],["T_VARIABLE","$session",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","addError",390],"(",["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","_escapeHtml",390],"(",["T_VARIABLE","$errorMessage",390],")",")",";",["T_WHITESPACE","\n            ",390],"}",["T_WHITESPACE","\n        ",391],"}",["T_WHITESPACE"," ",392],["T_ELSE","else",392],["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n            ",392],["T_VARIABLE","$session",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","addError",393],"(",["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","__",393],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid customer data'",393],")",")",";",["T_WHITESPACE","\n        ",393],"}",["T_WHITESPACE","\n    ",394],"}",["T_WHITESPACE","\n\n    ",395],["T_DOC_COMMENT","\/**\n     * Escape message text HTML.\n     *\n     * @param string $text\n     * @return string\n     *\/",397],["T_WHITESPACE","\n    ",402],["T_PROTECTED","protected",403],["T_WHITESPACE"," ",403],["T_FUNCTION","function",403],["T_WHITESPACE"," ",403],["T_STRING","_escapeHtml",403],"(",["T_VARIABLE","$text",403],")",["T_WHITESPACE","\n    ",403],"{",["T_WHITESPACE","\n        ",404],["T_RETURN","return",405],["T_WHITESPACE"," ",405],["T_STRING","Mage",405],["T_DOUBLE_COLON","::",405],["T_STRING","helper",405],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",405],")",["T_OBJECT_OPERATOR","->",405],["T_STRING","escapeHtml",405],"(",["T_VARIABLE","$text",405],")",";",["T_WHITESPACE","\n    ",405],"}",["T_WHITESPACE","\n\n    ",406],["T_DOC_COMMENT","\/**\n     * Validate customer data and return errors if they are\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @return array|string\n     *\/",408],["T_WHITESPACE","\n    ",413],["T_PROTECTED","protected",414],["T_WHITESPACE"," ",414],["T_FUNCTION","function",414],["T_WHITESPACE"," ",414],["T_STRING","_getCustomerErrors",414],"(",["T_VARIABLE","$customer",414],")",["T_WHITESPACE","\n    ",414],"{",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$errors",416],["T_WHITESPACE"," ",416],"=",["T_WHITESPACE"," ",416],["T_ARRAY","array",416],"(",")",";",["T_WHITESPACE","\n        ",416],["T_VARIABLE","$request",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","getRequest",417],"(",")",";",["T_WHITESPACE","\n        ",417],["T_IF","if",418],["T_WHITESPACE"," ",418],"(",["T_VARIABLE","$request",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","getPost",418],"(",["T_CONSTANT_ENCAPSED_STRING","'create_address'",418],")",")",["T_WHITESPACE"," ",418],"{",["T_WHITESPACE","\n            ",418],["T_VARIABLE","$errors",419],["T_WHITESPACE"," ",419],"=",["T_WHITESPACE"," ",419],["T_VARIABLE","$this",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","_getErrorsOnCustomerAddress",419],"(",["T_VARIABLE","$customer",419],")",";",["T_WHITESPACE","\n        ",419],"}",["T_WHITESPACE","\n        ",420],["T_VARIABLE","$customerForm",421],["T_WHITESPACE"," ",421],"=",["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","_getCustomerForm",421],"(",["T_VARIABLE","$customer",421],")",";",["T_WHITESPACE","\n        ",421],["T_VARIABLE","$customerData",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$customerForm",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","extractData",422],"(",["T_VARIABLE","$request",422],")",";",["T_WHITESPACE","\n        ",422],["T_VARIABLE","$customerErrors",423],["T_WHITESPACE"," ",423],"=",["T_WHITESPACE"," ",423],["T_VARIABLE","$customerForm",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","validateData",423],"(",["T_VARIABLE","$customerData",423],")",";",["T_WHITESPACE","\n        ",423],["T_IF","if",424],["T_WHITESPACE"," ",424],"(",["T_VARIABLE","$customerErrors",424],["T_WHITESPACE"," ",424],["T_IS_NOT_IDENTICAL","!==",424],["T_WHITESPACE"," ",424],["T_STRING","true",424],")",["T_WHITESPACE"," ",424],"{",["T_WHITESPACE","\n            ",424],["T_VARIABLE","$errors",425],["T_WHITESPACE"," ",425],"=",["T_WHITESPACE"," ",425],["T_STRING","array_merge",425],"(",["T_VARIABLE","$customerErrors",425],",",["T_WHITESPACE"," ",425],["T_VARIABLE","$errors",425],")",";",["T_WHITESPACE","\n        ",425],"}",["T_WHITESPACE"," ",426],["T_ELSE","else",426],["T_WHITESPACE"," ",426],"{",["T_WHITESPACE","\n            ",426],["T_VARIABLE","$customerForm",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","compactData",427],"(",["T_VARIABLE","$customerData",427],")",";",["T_WHITESPACE","\n            ",427],["T_VARIABLE","$customer",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","setPassword",428],"(",["T_VARIABLE","$request",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getPost",428],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",428],")",")",";",["T_WHITESPACE","\n            ",428],["T_VARIABLE","$customer",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","setPasswordConfirmation",429],"(",["T_VARIABLE","$request",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getPost",429],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",429],")",")",";",["T_WHITESPACE","\n            ",429],["T_VARIABLE","$customerErrors",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_VARIABLE","$customer",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","validate",430],"(",")",";",["T_WHITESPACE","\n            ",430],["T_IF","if",431],["T_WHITESPACE"," ",431],"(",["T_STRING","is_array",431],"(",["T_VARIABLE","$customerErrors",431],")",")",["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n                ",431],["T_VARIABLE","$errors",432],["T_WHITESPACE"," ",432],"=",["T_WHITESPACE"," ",432],["T_STRING","array_merge",432],"(",["T_VARIABLE","$customerErrors",432],",",["T_WHITESPACE"," ",432],["T_VARIABLE","$errors",432],")",";",["T_WHITESPACE","\n            ",432],"}",["T_WHITESPACE","\n        ",433],"}",["T_WHITESPACE","\n        ",434],["T_RETURN","return",435],["T_WHITESPACE"," ",435],["T_VARIABLE","$errors",435],";",["T_WHITESPACE","\n    ",435],"}",["T_WHITESPACE","\n\n    ",436],["T_DOC_COMMENT","\/**\n     * Get Customer Form Initalized Model\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @return Mage_Customer_Model_Form\n     *\/",438],["T_WHITESPACE","\n    ",443],["T_PROTECTED","protected",444],["T_WHITESPACE"," ",444],["T_FUNCTION","function",444],["T_WHITESPACE"," ",444],["T_STRING","_getCustomerForm",444],"(",["T_VARIABLE","$customer",444],")",["T_WHITESPACE","\n    ",444],"{",["T_WHITESPACE","\n        ",445],["T_COMMENT","\/* @var $customerForm Mage_Customer_Model_Form *\/",446],["T_WHITESPACE","\n        ",446],["T_VARIABLE","$customerForm",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","_getModel",447],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",447],")",";",["T_WHITESPACE","\n        ",447],["T_VARIABLE","$customerForm",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","setFormCode",448],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_account_create'",448],")",";",["T_WHITESPACE","\n        ",448],["T_VARIABLE","$customerForm",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","setEntity",449],"(",["T_VARIABLE","$customer",449],")",";",["T_WHITESPACE","\n        ",449],["T_RETURN","return",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$customerForm",450],";",["T_WHITESPACE","\n    ",450],"}",["T_WHITESPACE","\n\n    ",451],["T_DOC_COMMENT","\/**\n     * Get Helper\n     *\n     * @param string $path\n     * @return Mage_Core_Helper_Abstract\n     *\/",453],["T_WHITESPACE","\n    ",458],["T_PROTECTED","protected",459],["T_WHITESPACE"," ",459],["T_FUNCTION","function",459],["T_WHITESPACE"," ",459],["T_STRING","_getHelper",459],"(",["T_VARIABLE","$path",459],")",["T_WHITESPACE","\n    ",459],"{",["T_WHITESPACE","\n        ",460],["T_RETURN","return",461],["T_WHITESPACE"," ",461],["T_STRING","Mage",461],["T_DOUBLE_COLON","::",461],["T_STRING","helper",461],"(",["T_VARIABLE","$path",461],")",";",["T_WHITESPACE","\n    ",461],"}",["T_WHITESPACE","\n\n    ",462],["T_DOC_COMMENT","\/**\n     * Get App\n     *\n     * @return Mage_Core_Model_App\n     *\/",464],["T_WHITESPACE","\n    ",468],["T_PROTECTED","protected",469],["T_WHITESPACE"," ",469],["T_FUNCTION","function",469],["T_WHITESPACE"," ",469],["T_STRING","_getApp",469],"(",")",["T_WHITESPACE","\n    ",469],"{",["T_WHITESPACE","\n        ",470],["T_RETURN","return",471],["T_WHITESPACE"," ",471],["T_STRING","Mage",471],["T_DOUBLE_COLON","::",471],["T_STRING","app",471],"(",")",";",["T_WHITESPACE","\n    ",471],"}",["T_WHITESPACE","\n\n    ",472],["T_DOC_COMMENT","\/**\n     * Dispatch Event\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     *\/",474],["T_WHITESPACE","\n    ",478],["T_PROTECTED","protected",479],["T_WHITESPACE"," ",479],["T_FUNCTION","function",479],["T_WHITESPACE"," ",479],["T_STRING","_dispatchRegisterSuccess",479],"(",["T_VARIABLE","$customer",479],")",["T_WHITESPACE","\n    ",479],"{",["T_WHITESPACE","\n        ",480],["T_STRING","Mage",481],["T_DOUBLE_COLON","::",481],["T_STRING","dispatchEvent",481],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_register_success'",481],",",["T_WHITESPACE","\n            ",481],["T_ARRAY","array",482],"(",["T_CONSTANT_ENCAPSED_STRING","'account_controller'",482],["T_WHITESPACE"," ",482],["T_DOUBLE_ARROW","=>",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$this",482],",",["T_WHITESPACE"," ",482],["T_CONSTANT_ENCAPSED_STRING","'customer'",482],["T_WHITESPACE"," ",482],["T_DOUBLE_ARROW","=>",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$customer",482],")",["T_WHITESPACE","\n        ",482],")",";",["T_WHITESPACE","\n    ",483],"}",["T_WHITESPACE","\n\n    ",484],["T_DOC_COMMENT","\/**\n     * Gets customer address\n     *\n     * @param $customer\n     * @return array $errors\n     *\/",486],["T_WHITESPACE","\n    ",491],["T_PROTECTED","protected",492],["T_WHITESPACE"," ",492],["T_FUNCTION","function",492],["T_WHITESPACE"," ",492],["T_STRING","_getErrorsOnCustomerAddress",492],"(",["T_VARIABLE","$customer",492],")",["T_WHITESPACE","\n    ",492],"{",["T_WHITESPACE","\n        ",493],["T_VARIABLE","$errors",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],["T_ARRAY","array",494],"(",")",";",["T_WHITESPACE","\n        ",494],["T_COMMENT","\/* @var $address Mage_Customer_Model_Address *\/",495],["T_WHITESPACE","\n        ",495],["T_VARIABLE","$address",496],["T_WHITESPACE"," ",496],"=",["T_WHITESPACE"," ",496],["T_VARIABLE","$this",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","_getModel",496],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",496],")",";",["T_WHITESPACE","\n        ",496],["T_COMMENT","\/* @var $addressForm Mage_Customer_Model_Form *\/",497],["T_WHITESPACE","\n        ",497],["T_VARIABLE","$addressForm",498],["T_WHITESPACE"," ",498],"=",["T_WHITESPACE"," ",498],["T_VARIABLE","$this",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","_getModel",498],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",498],")",";",["T_WHITESPACE","\n        ",498],["T_VARIABLE","$addressForm",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","setFormCode",499],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_register_address'",499],")",["T_WHITESPACE","\n            ",499],["T_OBJECT_OPERATOR","->",500],["T_STRING","setEntity",500],"(",["T_VARIABLE","$address",500],")",";",["T_WHITESPACE","\n\n        ",500],["T_VARIABLE","$addressData",502],["T_WHITESPACE"," ",502],"=",["T_WHITESPACE"," ",502],["T_VARIABLE","$addressForm",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","extractData",502],"(",["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","getRequest",502],"(",")",",",["T_WHITESPACE"," ",502],["T_CONSTANT_ENCAPSED_STRING","'address'",502],",",["T_WHITESPACE"," ",502],["T_STRING","false",502],")",";",["T_WHITESPACE","\n        ",502],["T_VARIABLE","$addressErrors",503],["T_WHITESPACE"," ",503],"=",["T_WHITESPACE"," ",503],["T_VARIABLE","$addressForm",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","validateData",503],"(",["T_VARIABLE","$addressData",503],")",";",["T_WHITESPACE","\n        ",503],["T_IF","if",504],["T_WHITESPACE"," ",504],"(",["T_STRING","is_array",504],"(",["T_VARIABLE","$addressErrors",504],")",")",["T_WHITESPACE"," ",504],"{",["T_WHITESPACE","\n            ",504],["T_VARIABLE","$errors",505],["T_WHITESPACE"," ",505],"=",["T_WHITESPACE"," ",505],["T_STRING","array_merge",505],"(",["T_VARIABLE","$errors",505],",",["T_WHITESPACE"," ",505],["T_VARIABLE","$addressErrors",505],")",";",["T_WHITESPACE","\n        ",505],"}",["T_WHITESPACE","\n        ",506],["T_VARIABLE","$address",507],["T_OBJECT_OPERATOR","->",507],["T_STRING","setId",507],"(",["T_STRING","null",507],")",["T_WHITESPACE","\n            ",507],["T_OBJECT_OPERATOR","->",508],["T_STRING","setIsDefaultBilling",508],"(",["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","getRequest",508],"(",")",["T_OBJECT_OPERATOR","->",508],["T_STRING","getParam",508],"(",["T_CONSTANT_ENCAPSED_STRING","'default_billing'",508],",",["T_WHITESPACE"," ",508],["T_STRING","false",508],")",")",["T_WHITESPACE","\n            ",508],["T_OBJECT_OPERATOR","->",509],["T_STRING","setIsDefaultShipping",509],"(",["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","getRequest",509],"(",")",["T_OBJECT_OPERATOR","->",509],["T_STRING","getParam",509],"(",["T_CONSTANT_ENCAPSED_STRING","'default_shipping'",509],",",["T_WHITESPACE"," ",509],["T_STRING","false",509],")",")",";",["T_WHITESPACE","\n        ",509],["T_VARIABLE","$addressForm",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","compactData",510],"(",["T_VARIABLE","$addressData",510],")",";",["T_WHITESPACE","\n        ",510],["T_VARIABLE","$customer",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","addAddress",511],"(",["T_VARIABLE","$address",511],")",";",["T_WHITESPACE","\n\n        ",511],["T_VARIABLE","$addressErrors",513],["T_WHITESPACE"," ",513],"=",["T_WHITESPACE"," ",513],["T_VARIABLE","$address",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","validate",513],"(",")",";",["T_WHITESPACE","\n        ",513],["T_IF","if",514],["T_WHITESPACE"," ",514],"(",["T_STRING","is_array",514],"(",["T_VARIABLE","$addressErrors",514],")",")",["T_WHITESPACE"," ",514],"{",["T_WHITESPACE","\n            ",514],["T_VARIABLE","$errors",515],["T_WHITESPACE"," ",515],"=",["T_WHITESPACE"," ",515],["T_STRING","array_merge",515],"(",["T_VARIABLE","$errors",515],",",["T_WHITESPACE"," ",515],["T_VARIABLE","$addressErrors",515],")",";",["T_WHITESPACE","\n        ",515],"}",["T_WHITESPACE","\n        ",516],["T_RETURN","return",517],["T_WHITESPACE"," ",517],["T_VARIABLE","$errors",517],";",["T_WHITESPACE","\n    ",517],"}",["T_WHITESPACE","\n\n    ",518],["T_DOC_COMMENT","\/**\n     * Get model by path\n     *\n     * @param string $path\n     * @param array|null $arguments\n     * @return false|Mage_Core_Model_Abstract\n     *\/",520],["T_WHITESPACE","\n    ",526],["T_PUBLIC","public",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","_getModel",527],"(",["T_VARIABLE","$path",527],",",["T_WHITESPACE"," ",527],["T_VARIABLE","$arguments",527],["T_WHITESPACE"," ",527],"=",["T_WHITESPACE"," ",527],["T_ARRAY","array",527],"(",")",")",["T_WHITESPACE","\n    ",527],"{",["T_WHITESPACE","\n        ",528],["T_RETURN","return",529],["T_WHITESPACE"," ",529],["T_STRING","Mage",529],["T_DOUBLE_COLON","::",529],["T_STRING","getModel",529],"(",["T_VARIABLE","$path",529],",",["T_WHITESPACE"," ",529],["T_VARIABLE","$arguments",529],")",";",["T_WHITESPACE","\n    ",529],"}",["T_WHITESPACE","\n\n    ",530],["T_DOC_COMMENT","\/**\n     * Get model from registry by path\n     *\n     * @param string $path\n     * @return mixed\n     *\/",532],["T_WHITESPACE","\n    ",537],["T_PROTECTED","protected",538],["T_WHITESPACE"," ",538],["T_FUNCTION","function",538],["T_WHITESPACE"," ",538],["T_STRING","_getFromRegistry",538],"(",["T_VARIABLE","$path",538],")",["T_WHITESPACE","\n    ",538],"{",["T_WHITESPACE","\n        ",539],["T_RETURN","return",540],["T_WHITESPACE"," ",540],["T_STRING","Mage",540],["T_DOUBLE_COLON","::",540],["T_STRING","registry",540],"(",["T_VARIABLE","$path",540],")",";",["T_WHITESPACE","\n    ",540],"}",["T_WHITESPACE","\n\n    ",541],["T_DOC_COMMENT","\/**\n     * Add welcome message and send new account email.\n     * Returns success URL\n     *\n     * @param Mage_Customer_Model_Customer $customer\n     * @param bool $isJustConfirmed\n     * @return string\n     *\/",543],["T_WHITESPACE","\n    ",550],["T_PROTECTED","protected",551],["T_WHITESPACE"," ",551],["T_FUNCTION","function",551],["T_WHITESPACE"," ",551],["T_STRING","_welcomeCustomer",551],"(",["T_STRING","Mage_Customer_Model_Customer",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$customer",551],",",["T_WHITESPACE"," ",551],["T_VARIABLE","$isJustConfirmed",551],["T_WHITESPACE"," ",551],"=",["T_WHITESPACE"," ",551],["T_STRING","false",551],")",["T_WHITESPACE","\n    ",551],"{",["T_WHITESPACE","\n        ",552],["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","_getSession",553],"(",")",["T_OBJECT_OPERATOR","->",553],["T_STRING","addSuccess",553],"(",["T_WHITESPACE","\n            ",553],["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","__",554],"(",["T_CONSTANT_ENCAPSED_STRING","'Thank you for registering with %s.'",554],",",["T_WHITESPACE"," ",554],["T_STRING","Mage",554],["T_DOUBLE_COLON","::",554],["T_STRING","app",554],"(",")",["T_OBJECT_OPERATOR","->",554],["T_STRING","getStore",554],"(",")",["T_OBJECT_OPERATOR","->",554],["T_STRING","getFrontendName",554],"(",")",")",["T_WHITESPACE","\n        ",554],")",";",["T_WHITESPACE","\n        ",555],["T_IF","if",556],["T_WHITESPACE"," ",556],"(",["T_VARIABLE","$this",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","_isVatValidationEnabled",556],"(",")",")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n            ",556],["T_COMMENT","\/\/ Show corresponding VAT message to customer\n",557],["T_WHITESPACE","            ",558],["T_VARIABLE","$configAddressType",558],["T_WHITESPACE"," ",558],"=",["T_WHITESPACE","  ",558],["T_VARIABLE","$this",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","_getHelper",558],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",558],")",["T_OBJECT_OPERATOR","->",558],["T_STRING","getTaxCalculationAddressType",558],"(",")",";",["T_WHITESPACE","\n            ",558],["T_VARIABLE","$userPrompt",559],["T_WHITESPACE"," ",559],"=",["T_WHITESPACE"," ",559],["T_CONSTANT_ENCAPSED_STRING","''",559],";",["T_WHITESPACE","\n            ",559],["T_SWITCH","switch",560],["T_WHITESPACE"," ",560],"(",["T_VARIABLE","$configAddressType",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n                ",560],["T_CASE","case",561],["T_WHITESPACE"," ",561],["T_STRING","Mage_Customer_Model_Address_Abstract",561],["T_DOUBLE_COLON","::",561],["T_STRING","TYPE_SHIPPING",561],":",["T_WHITESPACE","\n                    ",561],["T_VARIABLE","$userPrompt",562],["T_WHITESPACE"," ",562],"=",["T_WHITESPACE"," ",562],["T_VARIABLE","$this",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","__",562],"(",["T_CONSTANT_ENCAPSED_STRING","'If you are a registered VAT customer, please click <a href=\"%s\">here<\/a> to enter you shipping address for proper VAT calculation'",562],",",["T_WHITESPACE","\n                        ",562],["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","_getUrl",563],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address\/edit'",563],")",")",";",["T_WHITESPACE","\n                    ",563],["T_BREAK","break",564],";",["T_WHITESPACE","\n                ",564],["T_DEFAULT","default",565],":",["T_WHITESPACE","\n                    ",565],["T_VARIABLE","$userPrompt",566],["T_WHITESPACE"," ",566],"=",["T_WHITESPACE"," ",566],["T_VARIABLE","$this",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","__",566],"(",["T_CONSTANT_ENCAPSED_STRING","'If you are a registered VAT customer, please click <a href=\"%s\">here<\/a> to enter you billing address for proper VAT calculation'",566],",",["T_WHITESPACE","\n                        ",566],["T_VARIABLE","$this",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","_getUrl",567],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address\/edit'",567],")",")",";",["T_WHITESPACE","\n            ",567],"}",["T_WHITESPACE","\n            ",568],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_getSession",569],"(",")",["T_OBJECT_OPERATOR","->",569],["T_STRING","addSuccess",569],"(",["T_VARIABLE","$userPrompt",569],")",";",["T_WHITESPACE","\n        ",569],"}",["T_WHITESPACE","\n\n        ",570],["T_VARIABLE","$customer",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","sendNewAccountEmail",572],"(",["T_WHITESPACE","\n            ",572],["T_VARIABLE","$isJustConfirmed",573],["T_WHITESPACE"," ",573],"?",["T_WHITESPACE"," ",573],["T_CONSTANT_ENCAPSED_STRING","'confirmed'",573],["T_WHITESPACE"," ",573],":",["T_WHITESPACE"," ",573],["T_CONSTANT_ENCAPSED_STRING","'registered'",573],",",["T_WHITESPACE","\n            ",573],["T_CONSTANT_ENCAPSED_STRING","''",574],",",["T_WHITESPACE","\n            ",574],["T_STRING","Mage",575],["T_DOUBLE_COLON","::",575],["T_STRING","app",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","getStore",575],"(",")",["T_OBJECT_OPERATOR","->",575],["T_STRING","getId",575],"(",")",",",["T_WHITESPACE","\n            ",575],["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","getRequest",576],"(",")",["T_OBJECT_OPERATOR","->",576],["T_STRING","getPost",576],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",576],")",["T_WHITESPACE","\n        ",576],")",";",["T_WHITESPACE","\n\n        ",577],["T_VARIABLE","$successUrl",579],["T_WHITESPACE"," ",579],"=",["T_WHITESPACE"," ",579],["T_VARIABLE","$this",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","_getUrl",579],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",579],",",["T_WHITESPACE"," ",579],["T_ARRAY","array",579],"(",["T_CONSTANT_ENCAPSED_STRING","'_secure'",579],["T_WHITESPACE"," ",579],["T_DOUBLE_ARROW","=>",579],["T_WHITESPACE"," ",579],["T_STRING","true",579],")",")",";",["T_WHITESPACE","\n        ",579],["T_IF","if",580],["T_WHITESPACE"," ",580],"(",["T_VARIABLE","$this",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","_getSession",580],"(",")",["T_OBJECT_OPERATOR","->",580],["T_STRING","getBeforeAuthUrl",580],"(",")",")",["T_WHITESPACE"," ",580],"{",["T_WHITESPACE","\n            ",580],["T_VARIABLE","$successUrl",581],["T_WHITESPACE"," ",581],"=",["T_WHITESPACE"," ",581],["T_VARIABLE","$this",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","_getSession",581],"(",")",["T_OBJECT_OPERATOR","->",581],["T_STRING","getBeforeAuthUrl",581],"(",["T_STRING","true",581],")",";",["T_WHITESPACE","\n        ",581],"}",["T_WHITESPACE","\n        ",582],["T_RETURN","return",583],["T_WHITESPACE"," ",583],["T_VARIABLE","$successUrl",583],";",["T_WHITESPACE","\n    ",583],"}",["T_WHITESPACE","\n\n    ",584],["T_DOC_COMMENT","\/**\n     * Confirm customer account by id and confirmation key\n     *\/",586],["T_WHITESPACE","\n    ",588],["T_PUBLIC","public",589],["T_WHITESPACE"," ",589],["T_FUNCTION","function",589],["T_WHITESPACE"," ",589],["T_STRING","confirmAction",589],"(",")",["T_WHITESPACE","\n    ",589],"{",["T_WHITESPACE","\n        ",590],["T_VARIABLE","$session",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","_getSession",591],"(",")",";",["T_WHITESPACE","\n        ",591],["T_IF","if",592],["T_WHITESPACE"," ",592],"(",["T_VARIABLE","$session",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","isLoggedIn",592],"(",")",")",["T_WHITESPACE"," ",592],"{",["T_WHITESPACE","\n            ",592],["T_VARIABLE","$this",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","_getSession",593],"(",")",["T_OBJECT_OPERATOR","->",593],["T_STRING","logout",593],"(",")",["T_OBJECT_OPERATOR","->",593],["T_STRING","regenerateSessionId",593],"(",")",";",["T_WHITESPACE","\n        ",593],"}",["T_WHITESPACE","\n        ",594],["T_TRY","try",595],["T_WHITESPACE"," ",595],"{",["T_WHITESPACE","\n            ",595],["T_VARIABLE","$id",596],["T_WHITESPACE","      ",596],"=",["T_WHITESPACE"," ",596],["T_VARIABLE","$this",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","getRequest",596],"(",")",["T_OBJECT_OPERATOR","->",596],["T_STRING","getParam",596],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",596],",",["T_WHITESPACE"," ",596],["T_STRING","false",596],")",";",["T_WHITESPACE","\n            ",596],["T_VARIABLE","$key",597],["T_WHITESPACE","     ",597],"=",["T_WHITESPACE"," ",597],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","getRequest",597],"(",")",["T_OBJECT_OPERATOR","->",597],["T_STRING","getParam",597],"(",["T_CONSTANT_ENCAPSED_STRING","'key'",597],",",["T_WHITESPACE"," ",597],["T_STRING","false",597],")",";",["T_WHITESPACE","\n            ",597],["T_VARIABLE","$backUrl",598],["T_WHITESPACE"," ",598],"=",["T_WHITESPACE"," ",598],["T_VARIABLE","$this",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getRequest",598],"(",")",["T_OBJECT_OPERATOR","->",598],["T_STRING","getParam",598],"(",["T_CONSTANT_ENCAPSED_STRING","'back_url'",598],",",["T_WHITESPACE"," ",598],["T_STRING","false",598],")",";",["T_WHITESPACE","\n            ",598],["T_IF","if",599],["T_WHITESPACE"," ",599],"(",["T_EMPTY","empty",599],"(",["T_VARIABLE","$id",599],")",["T_WHITESPACE"," ",599],["T_BOOLEAN_OR","||",599],["T_WHITESPACE"," ",599],["T_EMPTY","empty",599],"(",["T_VARIABLE","$key",599],")",")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n                ",599],["T_THROW","throw",600],["T_WHITESPACE"," ",600],["T_NEW","new",600],["T_WHITESPACE"," ",600],["T_STRING","Exception",600],"(",["T_VARIABLE","$this",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","__",600],"(",["T_CONSTANT_ENCAPSED_STRING","'Bad request.'",600],")",")",";",["T_WHITESPACE","\n            ",600],"}",["T_WHITESPACE","\n\n            ",601],["T_COMMENT","\/\/ load customer by id (try\/catch in case if it throws exceptions)\n",603],["T_WHITESPACE","            ",604],["T_TRY","try",604],["T_WHITESPACE"," ",604],"{",["T_WHITESPACE","\n                ",604],["T_VARIABLE","$customer",605],["T_WHITESPACE"," ",605],"=",["T_WHITESPACE"," ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","_getModel",605],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",605],")",["T_OBJECT_OPERATOR","->",605],["T_STRING","load",605],"(",["T_VARIABLE","$id",605],")",";",["T_WHITESPACE","\n                ",605],["T_IF","if",606],["T_WHITESPACE"," ",606],"(","(","!",["T_VARIABLE","$customer",606],")",["T_WHITESPACE"," ",606],["T_BOOLEAN_OR","||",606],["T_WHITESPACE"," ",606],"(","!",["T_VARIABLE","$customer",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","getId",606],"(",")",")",")",["T_WHITESPACE"," ",606],"{",["T_WHITESPACE","\n                    ",606],["T_THROW","throw",607],["T_WHITESPACE"," ",607],["T_NEW","new",607],["T_WHITESPACE"," ",607],["T_STRING","Exception",607],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to load customer by id.'",607],")",";",["T_WHITESPACE","\n                ",607],"}",["T_WHITESPACE","\n            ",608],"}",["T_WHITESPACE","\n            ",609],["T_CATCH","catch",610],["T_WHITESPACE"," ",610],"(",["T_STRING","Exception",610],["T_WHITESPACE"," ",610],["T_VARIABLE","$e",610],")",["T_WHITESPACE"," ",610],"{",["T_WHITESPACE","\n                ",610],["T_THROW","throw",611],["T_WHITESPACE"," ",611],["T_NEW","new",611],["T_WHITESPACE"," ",611],["T_STRING","Exception",611],"(",["T_VARIABLE","$this",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","__",611],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong customer account specified.'",611],")",")",";",["T_WHITESPACE","\n            ",611],"}",["T_WHITESPACE","\n\n            ",612],["T_COMMENT","\/\/ check if it is inactive\n",614],["T_WHITESPACE","            ",615],["T_IF","if",615],["T_WHITESPACE"," ",615],"(",["T_VARIABLE","$customer",615],["T_OBJECT_OPERATOR","->",615],["T_STRING","getConfirmation",615],"(",")",")",["T_WHITESPACE"," ",615],"{",["T_WHITESPACE","\n                ",615],["T_IF","if",616],["T_WHITESPACE"," ",616],"(",["T_VARIABLE","$customer",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","getConfirmation",616],"(",")",["T_WHITESPACE"," ",616],["T_IS_NOT_IDENTICAL","!==",616],["T_WHITESPACE"," ",616],["T_VARIABLE","$key",616],")",["T_WHITESPACE"," ",616],"{",["T_WHITESPACE","\n                    ",616],["T_THROW","throw",617],["T_WHITESPACE"," ",617],["T_NEW","new",617],["T_WHITESPACE"," ",617],["T_STRING","Exception",617],"(",["T_VARIABLE","$this",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","__",617],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong confirmation key.'",617],")",")",";",["T_WHITESPACE","\n                ",617],"}",["T_WHITESPACE","\n\n                ",618],["T_COMMENT","\/\/ activate customer\n",620],["T_WHITESPACE","                ",621],["T_TRY","try",621],["T_WHITESPACE"," ",621],"{",["T_WHITESPACE","\n                    ",621],["T_VARIABLE","$customer",622],["T_OBJECT_OPERATOR","->",622],["T_STRING","setConfirmation",622],"(",["T_STRING","null",622],")",";",["T_WHITESPACE","\n                    ",622],["T_VARIABLE","$customer",623],["T_OBJECT_OPERATOR","->",623],["T_STRING","save",623],"(",")",";",["T_WHITESPACE","\n                ",623],"}",["T_WHITESPACE","\n                ",624],["T_CATCH","catch",625],["T_WHITESPACE"," ",625],"(",["T_STRING","Exception",625],["T_WHITESPACE"," ",625],["T_VARIABLE","$e",625],")",["T_WHITESPACE"," ",625],"{",["T_WHITESPACE","\n                    ",625],["T_THROW","throw",626],["T_WHITESPACE"," ",626],["T_NEW","new",626],["T_WHITESPACE"," ",626],["T_STRING","Exception",626],"(",["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","__",626],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to confirm customer account.'",626],")",")",";",["T_WHITESPACE","\n                ",626],"}",["T_WHITESPACE","\n\n                ",627],["T_COMMENT","\/\/ log in and send greeting email, then die happy\n",629],["T_WHITESPACE","                ",630],["T_VARIABLE","$session",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","setCustomerAsLoggedIn",630],"(",["T_VARIABLE","$customer",630],")",";",["T_WHITESPACE","\n                ",630],["T_VARIABLE","$successUrl",631],["T_WHITESPACE"," ",631],"=",["T_WHITESPACE"," ",631],["T_VARIABLE","$this",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","_welcomeCustomer",631],"(",["T_VARIABLE","$customer",631],",",["T_WHITESPACE"," ",631],["T_STRING","true",631],")",";",["T_WHITESPACE","\n                ",631],["T_VARIABLE","$this",632],["T_OBJECT_OPERATOR","->",632],["T_STRING","_redirectSuccess",632],"(",["T_VARIABLE","$backUrl",632],["T_WHITESPACE"," ",632],"?",["T_WHITESPACE"," ",632],["T_VARIABLE","$backUrl",632],["T_WHITESPACE"," ",632],":",["T_WHITESPACE"," ",632],["T_VARIABLE","$successUrl",632],")",";",["T_WHITESPACE","\n                ",632],["T_RETURN","return",633],";",["T_WHITESPACE","\n            ",633],"}",["T_WHITESPACE","\n\n            ",634],["T_COMMENT","\/\/ die happy\n",636],["T_WHITESPACE","            ",637],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_redirectSuccess",637],"(",["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_getUrl",637],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",637],",",["T_WHITESPACE"," ",637],["T_ARRAY","array",637],"(",["T_CONSTANT_ENCAPSED_STRING","'_secure'",637],["T_WHITESPACE"," ",637],["T_DOUBLE_ARROW","=>",637],["T_WHITESPACE"," ",637],["T_STRING","true",637],")",")",")",";",["T_WHITESPACE","\n            ",637],["T_RETURN","return",638],";",["T_WHITESPACE","\n        ",638],"}",["T_WHITESPACE","\n        ",639],["T_CATCH","catch",640],["T_WHITESPACE"," ",640],"(",["T_STRING","Exception",640],["T_WHITESPACE"," ",640],["T_VARIABLE","$e",640],")",["T_WHITESPACE"," ",640],"{",["T_WHITESPACE","\n            ",640],["T_COMMENT","\/\/ die unhappy\n",641],["T_WHITESPACE","            ",642],["T_VARIABLE","$this",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","_getSession",642],"(",")",["T_OBJECT_OPERATOR","->",642],["T_STRING","addError",642],"(",["T_VARIABLE","$e",642],["T_OBJECT_OPERATOR","->",642],["T_STRING","getMessage",642],"(",")",")",";",["T_WHITESPACE","\n            ",642],["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","_redirectError",643],"(",["T_VARIABLE","$this",643],["T_OBJECT_OPERATOR","->",643],["T_STRING","_getUrl",643],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",643],",",["T_WHITESPACE"," ",643],["T_ARRAY","array",643],"(",["T_CONSTANT_ENCAPSED_STRING","'_secure'",643],["T_WHITESPACE"," ",643],["T_DOUBLE_ARROW","=>",643],["T_WHITESPACE"," ",643],["T_STRING","true",643],")",")",")",";",["T_WHITESPACE","\n            ",643],["T_RETURN","return",644],";",["T_WHITESPACE","\n        ",644],"}",["T_WHITESPACE","\n    ",645],"}",["T_WHITESPACE","\n\n    ",646],["T_DOC_COMMENT","\/**\n     * Send confirmation link to specified email\n     *\/",648],["T_WHITESPACE","\n    ",650],["T_PUBLIC","public",651],["T_WHITESPACE"," ",651],["T_FUNCTION","function",651],["T_WHITESPACE"," ",651],["T_STRING","confirmationAction",651],"(",")",["T_WHITESPACE","\n    ",651],"{",["T_WHITESPACE","\n        ",652],["T_VARIABLE","$customer",653],["T_WHITESPACE"," ",653],"=",["T_WHITESPACE"," ",653],["T_VARIABLE","$this",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","_getModel",653],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",653],")",";",["T_WHITESPACE","\n        ",653],["T_IF","if",654],["T_WHITESPACE"," ",654],"(",["T_VARIABLE","$this",654],["T_OBJECT_OPERATOR","->",654],["T_STRING","_getSession",654],"(",")",["T_OBJECT_OPERATOR","->",654],["T_STRING","isLoggedIn",654],"(",")",")",["T_WHITESPACE"," ",654],"{",["T_WHITESPACE","\n            ",654],["T_VARIABLE","$this",655],["T_OBJECT_OPERATOR","->",655],["T_STRING","_redirect",655],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",655],")",";",["T_WHITESPACE","\n            ",655],["T_RETURN","return",656],";",["T_WHITESPACE","\n        ",656],"}",["T_WHITESPACE","\n\n        ",657],["T_COMMENT","\/\/ try to confirm by email\n",659],["T_WHITESPACE","        ",660],["T_VARIABLE","$email",660],["T_WHITESPACE"," ",660],"=",["T_WHITESPACE"," ",660],["T_VARIABLE","$this",660],["T_OBJECT_OPERATOR","->",660],["T_STRING","getRequest",660],"(",")",["T_OBJECT_OPERATOR","->",660],["T_STRING","getPost",660],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",660],")",";",["T_WHITESPACE","\n        ",660],["T_IF","if",661],["T_WHITESPACE"," ",661],"(",["T_VARIABLE","$email",661],")",["T_WHITESPACE"," ",661],"{",["T_WHITESPACE","\n            ",661],["T_TRY","try",662],["T_WHITESPACE"," ",662],"{",["T_WHITESPACE","\n                ",662],["T_VARIABLE","$customer",663],["T_OBJECT_OPERATOR","->",663],["T_STRING","setWebsiteId",663],"(",["T_STRING","Mage",663],["T_DOUBLE_COLON","::",663],["T_STRING","app",663],"(",")",["T_OBJECT_OPERATOR","->",663],["T_STRING","getStore",663],"(",")",["T_OBJECT_OPERATOR","->",663],["T_STRING","getWebsiteId",663],"(",")",")",["T_OBJECT_OPERATOR","->",663],["T_STRING","loadByEmail",663],"(",["T_VARIABLE","$email",663],")",";",["T_WHITESPACE","\n                ",663],["T_IF","if",664],["T_WHITESPACE"," ",664],"(","!",["T_VARIABLE","$customer",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","getId",664],"(",")",")",["T_WHITESPACE"," ",664],"{",["T_WHITESPACE","\n                    ",664],["T_THROW","throw",665],["T_WHITESPACE"," ",665],["T_NEW","new",665],["T_WHITESPACE"," ",665],["T_STRING","Exception",665],"(",["T_CONSTANT_ENCAPSED_STRING","''",665],")",";",["T_WHITESPACE","\n                ",665],"}",["T_WHITESPACE","\n                ",666],["T_IF","if",667],["T_WHITESPACE"," ",667],"(",["T_VARIABLE","$customer",667],["T_OBJECT_OPERATOR","->",667],["T_STRING","getConfirmation",667],"(",")",")",["T_WHITESPACE"," ",667],"{",["T_WHITESPACE","\n                    ",667],["T_VARIABLE","$customer",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","sendNewAccountEmail",668],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",668],",",["T_WHITESPACE"," ",668],["T_CONSTANT_ENCAPSED_STRING","''",668],",",["T_WHITESPACE"," ",668],["T_STRING","Mage",668],["T_DOUBLE_COLON","::",668],["T_STRING","app",668],"(",")",["T_OBJECT_OPERATOR","->",668],["T_STRING","getStore",668],"(",")",["T_OBJECT_OPERATOR","->",668],["T_STRING","getId",668],"(",")",")",";",["T_WHITESPACE","\n                    ",668],["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","_getSession",669],"(",")",["T_OBJECT_OPERATOR","->",669],["T_STRING","addSuccess",669],"(",["T_VARIABLE","$this",669],["T_OBJECT_OPERATOR","->",669],["T_STRING","__",669],"(",["T_CONSTANT_ENCAPSED_STRING","'Please, check your email for confirmation key.'",669],")",")",";",["T_WHITESPACE","\n                ",669],"}",["T_WHITESPACE"," ",670],["T_ELSE","else",670],["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n                    ",670],["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","_getSession",671],"(",")",["T_OBJECT_OPERATOR","->",671],["T_STRING","addSuccess",671],"(",["T_VARIABLE","$this",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","__",671],"(",["T_CONSTANT_ENCAPSED_STRING","'This email does not require confirmation.'",671],")",")",";",["T_WHITESPACE","\n                ",671],"}",["T_WHITESPACE","\n                ",672],["T_VARIABLE","$this",673],["T_OBJECT_OPERATOR","->",673],["T_STRING","_getSession",673],"(",")",["T_OBJECT_OPERATOR","->",673],["T_STRING","setUsername",673],"(",["T_VARIABLE","$email",673],")",";",["T_WHITESPACE","\n                ",673],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","_redirectSuccess",674],"(",["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","_getUrl",674],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/index'",674],",",["T_WHITESPACE"," ",674],["T_ARRAY","array",674],"(",["T_CONSTANT_ENCAPSED_STRING","'_secure'",674],["T_WHITESPACE"," ",674],["T_DOUBLE_ARROW","=>",674],["T_WHITESPACE"," ",674],["T_STRING","true",674],")",")",")",";",["T_WHITESPACE","\n            ",674],"}",["T_WHITESPACE"," ",675],["T_CATCH","catch",675],["T_WHITESPACE"," ",675],"(",["T_STRING","Exception",675],["T_WHITESPACE"," ",675],["T_VARIABLE","$e",675],")",["T_WHITESPACE"," ",675],"{",["T_WHITESPACE","\n                ",675],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","_getSession",676],"(",")",["T_OBJECT_OPERATOR","->",676],["T_STRING","addException",676],"(",["T_VARIABLE","$e",676],",",["T_WHITESPACE"," ",676],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","__",676],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong email.'",676],")",")",";",["T_WHITESPACE","\n                ",676],["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","_redirectError",677],"(",["T_VARIABLE","$this",677],["T_OBJECT_OPERATOR","->",677],["T_STRING","_getUrl",677],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/*'",677],",",["T_WHITESPACE"," ",677],["T_ARRAY","array",677],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",677],["T_WHITESPACE"," ",677],["T_DOUBLE_ARROW","=>",677],["T_WHITESPACE"," ",677],["T_VARIABLE","$email",677],",",["T_WHITESPACE"," ",677],["T_CONSTANT_ENCAPSED_STRING","'_secure'",677],["T_WHITESPACE"," ",677],["T_DOUBLE_ARROW","=>",677],["T_WHITESPACE"," ",677],["T_STRING","true",677],")",")",")",";",["T_WHITESPACE","\n            ",677],"}",["T_WHITESPACE","\n            ",678],["T_RETURN","return",679],";",["T_WHITESPACE","\n        ",679],"}",["T_WHITESPACE","\n\n        ",680],["T_COMMENT","\/\/ output form\n",682],["T_WHITESPACE","        ",683],["T_VARIABLE","$this",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","loadLayout",683],"(",")",";",["T_WHITESPACE","\n\n        ",683],["T_VARIABLE","$this",685],["T_OBJECT_OPERATOR","->",685],["T_STRING","getLayout",685],"(",")",["T_OBJECT_OPERATOR","->",685],["T_STRING","getBlock",685],"(",["T_CONSTANT_ENCAPSED_STRING","'accountConfirmation'",685],")",["T_WHITESPACE","\n            ",685],["T_OBJECT_OPERATOR","->",686],["T_STRING","setEmail",686],"(",["T_VARIABLE","$this",686],["T_OBJECT_OPERATOR","->",686],["T_STRING","getRequest",686],"(",")",["T_OBJECT_OPERATOR","->",686],["T_STRING","getParam",686],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",686],",",["T_WHITESPACE"," ",686],["T_VARIABLE","$email",686],")",")",";",["T_WHITESPACE","\n\n        ",686],["T_VARIABLE","$this",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","_initLayoutMessages",688],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",688],")",";",["T_WHITESPACE","\n        ",688],["T_VARIABLE","$this",689],["T_OBJECT_OPERATOR","->",689],["T_STRING","renderLayout",689],"(",")",";",["T_WHITESPACE","\n    ",689],"}",["T_WHITESPACE","\n\n    ",690],["T_DOC_COMMENT","\/**\n     * Get Url method\n     *\n     * @param string $url\n     * @param array $params\n     * @return string\n     *\/",692],["T_WHITESPACE","\n    ",698],["T_PROTECTED","protected",699],["T_WHITESPACE"," ",699],["T_FUNCTION","function",699],["T_WHITESPACE"," ",699],["T_STRING","_getUrl",699],"(",["T_VARIABLE","$url",699],",",["T_WHITESPACE"," ",699],["T_VARIABLE","$params",699],["T_WHITESPACE"," ",699],"=",["T_WHITESPACE"," ",699],["T_ARRAY","array",699],"(",")",")",["T_WHITESPACE","\n    ",699],"{",["T_WHITESPACE","\n        ",700],["T_RETURN","return",701],["T_WHITESPACE"," ",701],["T_STRING","Mage",701],["T_DOUBLE_COLON","::",701],["T_STRING","getUrl",701],"(",["T_VARIABLE","$url",701],",",["T_WHITESPACE"," ",701],["T_VARIABLE","$params",701],")",";",["T_WHITESPACE","\n    ",701],"}",["T_WHITESPACE","\n\n    ",702],["T_DOC_COMMENT","\/**\n     * Forgot customer password page\n     *\/",704],["T_WHITESPACE","\n    ",706],["T_PUBLIC","public",707],["T_WHITESPACE"," ",707],["T_FUNCTION","function",707],["T_WHITESPACE"," ",707],["T_STRING","forgotPasswordAction",707],"(",")",["T_WHITESPACE","\n    ",707],"{",["T_WHITESPACE","\n        ",708],["T_VARIABLE","$this",709],["T_OBJECT_OPERATOR","->",709],["T_STRING","loadLayout",709],"(",")",";",["T_WHITESPACE","\n\n        ",709],["T_VARIABLE","$this",711],["T_OBJECT_OPERATOR","->",711],["T_STRING","getLayout",711],"(",")",["T_OBJECT_OPERATOR","->",711],["T_STRING","getBlock",711],"(",["T_CONSTANT_ENCAPSED_STRING","'forgotPassword'",711],")",["T_OBJECT_OPERATOR","->",711],["T_STRING","setEmailValue",711],"(",["T_WHITESPACE","\n            ",711],["T_VARIABLE","$this",712],["T_OBJECT_OPERATOR","->",712],["T_STRING","_getSession",712],"(",")",["T_OBJECT_OPERATOR","->",712],["T_STRING","getForgottenEmail",712],"(",")",["T_WHITESPACE","\n        ",712],")",";",["T_WHITESPACE","\n        ",713],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","_getSession",714],"(",")",["T_OBJECT_OPERATOR","->",714],["T_STRING","unsForgottenEmail",714],"(",")",";",["T_WHITESPACE","\n\n        ",714],["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","_initLayoutMessages",716],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",716],")",";",["T_WHITESPACE","\n        ",716],["T_VARIABLE","$this",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","renderLayout",717],"(",")",";",["T_WHITESPACE","\n    ",717],"}",["T_WHITESPACE","\n\n    ",718],["T_DOC_COMMENT","\/**\n     * Forgot customer password action\n     *\/",720],["T_WHITESPACE","\n    ",722],["T_PUBLIC","public",723],["T_WHITESPACE"," ",723],["T_FUNCTION","function",723],["T_WHITESPACE"," ",723],["T_STRING","forgotPasswordPostAction",723],"(",")",["T_WHITESPACE","\n    ",723],"{",["T_WHITESPACE","\n        ",724],["T_VARIABLE","$email",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_STRING_CAST","(string)",725],["T_WHITESPACE"," ",725],["T_VARIABLE","$this",725],["T_OBJECT_OPERATOR","->",725],["T_STRING","getRequest",725],"(",")",["T_OBJECT_OPERATOR","->",725],["T_STRING","getPost",725],"(",["T_CONSTANT_ENCAPSED_STRING","'email'",725],")",";",["T_WHITESPACE","\n        ",725],["T_IF","if",726],["T_WHITESPACE"," ",726],"(",["T_VARIABLE","$email",726],")",["T_WHITESPACE"," ",726],"{",["T_WHITESPACE","\n            ",726],["T_DOC_COMMENT","\/**\n             * @var $flowPassword Mage_Customer_Model_Flowpassword\n             *\/",727],["T_WHITESPACE","\n            ",729],["T_VARIABLE","$flowPassword",730],["T_WHITESPACE"," ",730],"=",["T_WHITESPACE"," ",730],["T_VARIABLE","$this",730],["T_OBJECT_OPERATOR","->",730],["T_STRING","_getModel",730],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/flowpassword'",730],")",";",["T_WHITESPACE","\n            ",730],["T_VARIABLE","$flowPassword",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","setEmail",731],"(",["T_VARIABLE","$email",731],")",["T_OBJECT_OPERATOR","->",731],["T_STRING","save",731],"(",")",";",["T_WHITESPACE","\n\n            ",731],["T_IF","if",733],["T_WHITESPACE"," ",733],"(","!",["T_VARIABLE","$flowPassword",733],["T_OBJECT_OPERATOR","->",733],["T_STRING","checkCustomerForgotPasswordFlowEmail",733],"(",["T_VARIABLE","$email",733],")",")",["T_WHITESPACE"," ",733],"{",["T_WHITESPACE","\n                ",733],["T_VARIABLE","$this",734],["T_OBJECT_OPERATOR","->",734],["T_STRING","_getSession",734],"(",")",["T_WHITESPACE","\n                    ",734],["T_OBJECT_OPERATOR","->",735],["T_STRING","addError",735],"(",["T_VARIABLE","$this",735],["T_OBJECT_OPERATOR","->",735],["T_STRING","__",735],"(",["T_CONSTANT_ENCAPSED_STRING","'You have exceeded requests to times per 24 hours from 1 e-mail.'",735],")",")",";",["T_WHITESPACE","\n                ",735],["T_VARIABLE","$this",736],["T_OBJECT_OPERATOR","->",736],["T_STRING","_redirect",736],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/forgotpassword'",736],")",";",["T_WHITESPACE","\n                ",736],["T_RETURN","return",737],";",["T_WHITESPACE","\n            ",737],"}",["T_WHITESPACE","\n\n            ",738],["T_IF","if",740],["T_WHITESPACE"," ",740],"(","!",["T_VARIABLE","$flowPassword",740],["T_OBJECT_OPERATOR","->",740],["T_STRING","checkCustomerForgotPasswordFlowIp",740],"(",")",")",["T_WHITESPACE"," ",740],"{",["T_WHITESPACE","\n                ",740],["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","_getSession",741],"(",")",["T_OBJECT_OPERATOR","->",741],["T_STRING","addError",741],"(",["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","__",741],"(",["T_CONSTANT_ENCAPSED_STRING","'You have exceeded requests to times per hour from 1 IP.'",741],")",")",";",["T_WHITESPACE","\n                ",741],["T_VARIABLE","$this",742],["T_OBJECT_OPERATOR","->",742],["T_STRING","_redirect",742],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/forgotpassword'",742],")",";",["T_WHITESPACE","\n                ",742],["T_RETURN","return",743],";",["T_WHITESPACE","\n            ",743],"}",["T_WHITESPACE","\n\n            ",744],["T_IF","if",746],["T_WHITESPACE"," ",746],"(","!",["T_STRING","Zend_Validate",746],["T_DOUBLE_COLON","::",746],["T_STRING","is",746],"(",["T_VARIABLE","$email",746],",",["T_WHITESPACE"," ",746],["T_CONSTANT_ENCAPSED_STRING","'EmailAddress'",746],")",")",["T_WHITESPACE"," ",746],"{",["T_WHITESPACE","\n                ",746],["T_VARIABLE","$this",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","_getSession",747],"(",")",["T_OBJECT_OPERATOR","->",747],["T_STRING","setForgottenEmail",747],"(",["T_VARIABLE","$email",747],")",";",["T_WHITESPACE","\n                ",747],["T_VARIABLE","$this",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","_getSession",748],"(",")",["T_OBJECT_OPERATOR","->",748],["T_STRING","addError",748],"(",["T_VARIABLE","$this",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","__",748],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid email address.'",748],")",")",";",["T_WHITESPACE","\n                ",748],["T_VARIABLE","$this",749],["T_OBJECT_OPERATOR","->",749],["T_STRING","_redirect",749],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/forgotpassword'",749],")",";",["T_WHITESPACE","\n                ",749],["T_RETURN","return",750],";",["T_WHITESPACE","\n            ",750],"}",["T_WHITESPACE","\n\n            ",751],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",753],["T_WHITESPACE","\n            ",753],["T_VARIABLE","$customer",754],["T_WHITESPACE"," ",754],"=",["T_WHITESPACE"," ",754],["T_VARIABLE","$this",754],["T_OBJECT_OPERATOR","->",754],["T_STRING","_getModel",754],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",754],")",["T_WHITESPACE","\n                ",754],["T_OBJECT_OPERATOR","->",755],["T_STRING","setWebsiteId",755],"(",["T_STRING","Mage",755],["T_DOUBLE_COLON","::",755],["T_STRING","app",755],"(",")",["T_OBJECT_OPERATOR","->",755],["T_STRING","getStore",755],"(",")",["T_OBJECT_OPERATOR","->",755],["T_STRING","getWebsiteId",755],"(",")",")",["T_WHITESPACE","\n                ",755],["T_OBJECT_OPERATOR","->",756],["T_STRING","loadByEmail",756],"(",["T_VARIABLE","$email",756],")",";",["T_WHITESPACE","\n\n            ",756],["T_IF","if",758],["T_WHITESPACE"," ",758],"(",["T_VARIABLE","$customer",758],["T_OBJECT_OPERATOR","->",758],["T_STRING","getId",758],"(",")",")",["T_WHITESPACE"," ",758],"{",["T_WHITESPACE","\n                ",758],["T_TRY","try",759],["T_WHITESPACE"," ",759],"{",["T_WHITESPACE","\n                    ",759],["T_VARIABLE","$newResetPasswordLinkToken",760],["T_WHITESPACE"," ",760],"=",["T_WHITESPACE","  ",760],["T_VARIABLE","$this",760],["T_OBJECT_OPERATOR","->",760],["T_STRING","_getHelper",760],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",760],")",["T_OBJECT_OPERATOR","->",760],["T_STRING","generateResetPasswordLinkToken",760],"(",")",";",["T_WHITESPACE","\n                    ",760],["T_VARIABLE","$customer",761],["T_OBJECT_OPERATOR","->",761],["T_STRING","changeResetPasswordLinkToken",761],"(",["T_VARIABLE","$newResetPasswordLinkToken",761],")",";",["T_WHITESPACE","\n                    ",761],["T_VARIABLE","$customer",762],["T_OBJECT_OPERATOR","->",762],["T_STRING","sendPasswordResetConfirmationEmail",762],"(",")",";",["T_WHITESPACE","\n                ",762],"}",["T_WHITESPACE"," ",763],["T_CATCH","catch",763],["T_WHITESPACE"," ",763],"(",["T_STRING","Exception",763],["T_WHITESPACE"," ",763],["T_VARIABLE","$exception",763],")",["T_WHITESPACE"," ",763],"{",["T_WHITESPACE","\n                    ",763],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","_getSession",764],"(",")",["T_OBJECT_OPERATOR","->",764],["T_STRING","addError",764],"(",["T_VARIABLE","$exception",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","getMessage",764],"(",")",")",";",["T_WHITESPACE","\n                    ",764],["T_VARIABLE","$this",765],["T_OBJECT_OPERATOR","->",765],["T_STRING","_redirect",765],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/forgotpassword'",765],")",";",["T_WHITESPACE","\n                    ",765],["T_RETURN","return",766],";",["T_WHITESPACE","\n                ",766],"}",["T_WHITESPACE","\n            ",767],"}",["T_WHITESPACE","\n            ",768],["T_VARIABLE","$this",769],["T_OBJECT_OPERATOR","->",769],["T_STRING","_getSession",769],"(",")",["T_WHITESPACE","\n                ",769],["T_OBJECT_OPERATOR","->",770],["T_STRING","addSuccess",770],"(",["T_WHITESPACE"," ",770],["T_VARIABLE","$this",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","_getHelper",770],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",770],")",["T_WHITESPACE","\n                ",770],["T_OBJECT_OPERATOR","->",771],["T_STRING","__",771],"(",["T_CONSTANT_ENCAPSED_STRING","'If there is an account associated with %s you will receive an email with a link to reset your password.'",771],",",["T_WHITESPACE","\n                    ",771],["T_VARIABLE","$this",772],["T_OBJECT_OPERATOR","->",772],["T_STRING","_getHelper",772],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",772],")",["T_OBJECT_OPERATOR","->",772],["T_STRING","escapeHtml",772],"(",["T_VARIABLE","$email",772],")",")",")",";",["T_WHITESPACE","\n            ",772],["T_VARIABLE","$this",773],["T_OBJECT_OPERATOR","->",773],["T_STRING","_redirect",773],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",773],")",";",["T_WHITESPACE","\n            ",773],["T_RETURN","return",774],";",["T_WHITESPACE","\n        ",774],"}",["T_WHITESPACE"," ",775],["T_ELSE","else",775],["T_WHITESPACE"," ",775],"{",["T_WHITESPACE","\n            ",775],["T_VARIABLE","$this",776],["T_OBJECT_OPERATOR","->",776],["T_STRING","_getSession",776],"(",")",["T_OBJECT_OPERATOR","->",776],["T_STRING","addError",776],"(",["T_VARIABLE","$this",776],["T_OBJECT_OPERATOR","->",776],["T_STRING","__",776],"(",["T_CONSTANT_ENCAPSED_STRING","'Please enter your email.'",776],")",")",";",["T_WHITESPACE","\n            ",776],["T_VARIABLE","$this",777],["T_OBJECT_OPERATOR","->",777],["T_STRING","_redirect",777],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/forgotpassword'",777],")",";",["T_WHITESPACE","\n            ",777],["T_RETURN","return",778],";",["T_WHITESPACE","\n        ",778],"}",["T_WHITESPACE","\n    ",779],"}",["T_WHITESPACE","\n\n    ",780],["T_DOC_COMMENT","\/**\n     * Display reset forgotten password form\n     *\n     *\/",782],["T_WHITESPACE","\n    ",785],["T_PUBLIC","public",786],["T_WHITESPACE"," ",786],["T_FUNCTION","function",786],["T_WHITESPACE"," ",786],["T_STRING","changeForgottenAction",786],"(",")",["T_WHITESPACE","\n    ",786],"{",["T_WHITESPACE","\n        ",787],["T_TRY","try",788],["T_WHITESPACE"," ",788],"{",["T_WHITESPACE","\n            ",788],["T_LIST","list",789],"(",["T_VARIABLE","$customerId",789],",",["T_WHITESPACE"," ",789],["T_VARIABLE","$resetPasswordLinkToken",789],")",["T_WHITESPACE"," ",789],"=",["T_WHITESPACE"," ",789],["T_VARIABLE","$this",789],["T_OBJECT_OPERATOR","->",789],["T_STRING","_getRestorePasswordParameters",789],"(",["T_VARIABLE","$this",789],["T_OBJECT_OPERATOR","->",789],["T_STRING","_getSession",789],"(",")",")",";",["T_WHITESPACE","\n            ",789],["T_VARIABLE","$this",790],["T_OBJECT_OPERATOR","->",790],["T_STRING","_validateResetPasswordLinkToken",790],"(",["T_VARIABLE","$customerId",790],",",["T_WHITESPACE"," ",790],["T_VARIABLE","$resetPasswordLinkToken",790],")",";",["T_WHITESPACE","\n            ",790],["T_VARIABLE","$this",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","loadLayout",791],"(",")",";",["T_WHITESPACE","\n            ",791],["T_VARIABLE","$this",792],["T_OBJECT_OPERATOR","->",792],["T_STRING","renderLayout",792],"(",")",";",["T_WHITESPACE","\n\n        ",792],"}",["T_WHITESPACE"," ",794],["T_CATCH","catch",794],["T_WHITESPACE"," ",794],"(",["T_STRING","Exception",794],["T_WHITESPACE"," ",794],["T_VARIABLE","$exception",794],")",["T_WHITESPACE"," ",794],"{",["T_WHITESPACE","\n            ",794],["T_VARIABLE","$this",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","_getSession",795],"(",")",["T_OBJECT_OPERATOR","->",795],["T_STRING","addError",795],"(",["T_VARIABLE","$this",795],["T_OBJECT_OPERATOR","->",795],["T_STRING","_getHelper",795],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",795],")",["T_OBJECT_OPERATOR","->",795],["T_STRING","__",795],"(",["T_CONSTANT_ENCAPSED_STRING","'Your password reset link has expired.'",795],")",")",";",["T_WHITESPACE","\n            ",795],["T_VARIABLE","$this",796],["T_OBJECT_OPERATOR","->",796],["T_STRING","_redirect",796],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/forgotpassword'",796],")",";",["T_WHITESPACE","\n        ",796],"}",["T_WHITESPACE","\n    ",797],"}",["T_WHITESPACE","\n\n    ",798],["T_DOC_COMMENT","\/**\n     * Checks reset forgotten password token\n     *\n     * User is redirected on this action when he clicks on the corresponding link in password reset confirmation email.\n     *\n     *\/",800],["T_WHITESPACE","\n    ",805],["T_PUBLIC","public",806],["T_WHITESPACE"," ",806],["T_FUNCTION","function",806],["T_WHITESPACE"," ",806],["T_STRING","resetPasswordAction",806],"(",")",["T_WHITESPACE","\n    ",806],"{",["T_WHITESPACE","\n        ",807],["T_TRY","try",808],["T_WHITESPACE"," ",808],"{",["T_WHITESPACE","\n            ",808],["T_VARIABLE","$customerId",809],["T_WHITESPACE"," ",809],"=",["T_WHITESPACE"," ",809],["T_INT_CAST","(int)",809],["T_VARIABLE","$this",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getRequest",809],"(",")",["T_OBJECT_OPERATOR","->",809],["T_STRING","getQuery",809],"(",["T_CONSTANT_ENCAPSED_STRING","\"id\"",809],")",";",["T_WHITESPACE","\n            ",809],["T_VARIABLE","$resetPasswordLinkToken",810],["T_WHITESPACE"," ",810],"=",["T_WHITESPACE"," ",810],["T_STRING_CAST","(string)",810],["T_VARIABLE","$this",810],["T_OBJECT_OPERATOR","->",810],["T_STRING","getRequest",810],"(",")",["T_OBJECT_OPERATOR","->",810],["T_STRING","getQuery",810],"(",["T_CONSTANT_ENCAPSED_STRING","'token'",810],")",";",["T_WHITESPACE","\n\n            ",810],["T_VARIABLE","$this",812],["T_OBJECT_OPERATOR","->",812],["T_STRING","_validateResetPasswordLinkToken",812],"(",["T_VARIABLE","$customerId",812],",",["T_WHITESPACE"," ",812],["T_VARIABLE","$resetPasswordLinkToken",812],")",";",["T_WHITESPACE","\n            ",812],["T_VARIABLE","$this",813],["T_OBJECT_OPERATOR","->",813],["T_STRING","_saveRestorePasswordParameters",813],"(",["T_VARIABLE","$customerId",813],",",["T_WHITESPACE"," ",813],["T_VARIABLE","$resetPasswordLinkToken",813],")",["T_WHITESPACE","\n                ",813],["T_OBJECT_OPERATOR","->",814],["T_STRING","_redirect",814],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/changeforgotten'",814],")",";",["T_WHITESPACE","\n\n        ",814],"}",["T_WHITESPACE"," ",816],["T_CATCH","catch",816],["T_WHITESPACE"," ",816],"(",["T_STRING","Exception",816],["T_WHITESPACE"," ",816],["T_VARIABLE","$exception",816],")",["T_WHITESPACE"," ",816],"{",["T_WHITESPACE","\n            ",816],["T_VARIABLE","$this",817],["T_OBJECT_OPERATOR","->",817],["T_STRING","_getSession",817],"(",")",["T_OBJECT_OPERATOR","->",817],["T_STRING","addError",817],"(",["T_VARIABLE","$this",817],["T_OBJECT_OPERATOR","->",817],["T_STRING","_getHelper",817],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",817],")",["T_OBJECT_OPERATOR","->",817],["T_STRING","__",817],"(",["T_CONSTANT_ENCAPSED_STRING","'Your password reset link has expired.'",817],")",")",";",["T_WHITESPACE","\n            ",817],["T_VARIABLE","$this",818],["T_OBJECT_OPERATOR","->",818],["T_STRING","_redirect",818],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/forgotpassword'",818],")",";",["T_WHITESPACE","\n        ",818],"}",["T_WHITESPACE","\n    ",819],"}",["T_WHITESPACE","\n\n    ",820],["T_DOC_COMMENT","\/**\n     * Reset forgotten password\n     * Used to handle data recieved from reset forgotten password form\n     *\/",822],["T_WHITESPACE","\n    ",825],["T_PUBLIC","public",826],["T_WHITESPACE"," ",826],["T_FUNCTION","function",826],["T_WHITESPACE"," ",826],["T_STRING","resetPasswordPostAction",826],"(",")",["T_WHITESPACE","\n    ",826],"{",["T_WHITESPACE","\n        ",827],["T_LIST","list",828],"(",["T_VARIABLE","$customerId",828],",",["T_WHITESPACE"," ",828],["T_VARIABLE","$resetPasswordLinkToken",828],")",["T_WHITESPACE"," ",828],"=",["T_WHITESPACE"," ",828],["T_VARIABLE","$this",828],["T_OBJECT_OPERATOR","->",828],["T_STRING","_getRestorePasswordParameters",828],"(",["T_VARIABLE","$this",828],["T_OBJECT_OPERATOR","->",828],["T_STRING","_getSession",828],"(",")",")",";",["T_WHITESPACE","\n        ",828],["T_VARIABLE","$password",829],["T_WHITESPACE"," ",829],"=",["T_WHITESPACE"," ",829],["T_STRING_CAST","(string)",829],["T_VARIABLE","$this",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","getRequest",829],"(",")",["T_OBJECT_OPERATOR","->",829],["T_STRING","getPost",829],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",829],")",";",["T_WHITESPACE","\n        ",829],["T_VARIABLE","$passwordConfirmation",830],["T_WHITESPACE"," ",830],"=",["T_WHITESPACE"," ",830],["T_STRING_CAST","(string)",830],["T_VARIABLE","$this",830],["T_OBJECT_OPERATOR","->",830],["T_STRING","getRequest",830],"(",")",["T_OBJECT_OPERATOR","->",830],["T_STRING","getPost",830],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",830],")",";",["T_WHITESPACE","\n\n        ",830],["T_TRY","try",832],["T_WHITESPACE"," ",832],"{",["T_WHITESPACE","\n            ",832],["T_VARIABLE","$this",833],["T_OBJECT_OPERATOR","->",833],["T_STRING","_validateResetPasswordLinkToken",833],"(",["T_VARIABLE","$customerId",833],",",["T_WHITESPACE"," ",833],["T_VARIABLE","$resetPasswordLinkToken",833],")",";",["T_WHITESPACE","\n        ",833],"}",["T_WHITESPACE"," ",834],["T_CATCH","catch",834],["T_WHITESPACE"," ",834],"(",["T_STRING","Exception",834],["T_WHITESPACE"," ",834],["T_VARIABLE","$exception",834],")",["T_WHITESPACE"," ",834],"{",["T_WHITESPACE","\n            ",834],["T_VARIABLE","$this",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","_getSession",835],"(",")",["T_OBJECT_OPERATOR","->",835],["T_STRING","addError",835],"(",["T_VARIABLE","$this",835],["T_OBJECT_OPERATOR","->",835],["T_STRING","_getHelper",835],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",835],")",["T_OBJECT_OPERATOR","->",835],["T_STRING","__",835],"(",["T_CONSTANT_ENCAPSED_STRING","'Your password reset link has expired.'",835],")",")",";",["T_WHITESPACE","\n            ",835],["T_VARIABLE","$this",836],["T_OBJECT_OPERATOR","->",836],["T_STRING","_redirect",836],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/'",836],")",";",["T_WHITESPACE","\n            ",836],["T_RETURN","return",837],";",["T_WHITESPACE","\n        ",837],"}",["T_WHITESPACE","\n\n        ",838],["T_VARIABLE","$errorMessages",840],["T_WHITESPACE"," ",840],"=",["T_WHITESPACE"," ",840],["T_ARRAY","array",840],"(",")",";",["T_WHITESPACE","\n        ",840],["T_IF","if",841],["T_WHITESPACE"," ",841],"(",["T_STRING","iconv_strlen",841],"(",["T_VARIABLE","$password",841],")",["T_WHITESPACE"," ",841],["T_IS_SMALLER_OR_EQUAL","<=",841],["T_WHITESPACE"," ",841],["T_LNUMBER","0",841],")",["T_WHITESPACE"," ",841],"{",["T_WHITESPACE","\n            ",841],["T_STRING","array_push",842],"(",["T_VARIABLE","$errorMessages",842],",",["T_WHITESPACE"," ",842],["T_VARIABLE","$this",842],["T_OBJECT_OPERATOR","->",842],["T_STRING","_getHelper",842],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",842],")",["T_OBJECT_OPERATOR","->",842],["T_STRING","__",842],"(",["T_CONSTANT_ENCAPSED_STRING","'New password field cannot be empty.'",842],")",")",";",["T_WHITESPACE","\n        ",842],"}",["T_WHITESPACE","\n        ",843],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",844],["T_WHITESPACE","\n        ",844],["T_VARIABLE","$customer",845],["T_WHITESPACE"," ",845],"=",["T_WHITESPACE"," ",845],["T_VARIABLE","$this",845],["T_OBJECT_OPERATOR","->",845],["T_STRING","_getModel",845],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",845],")",["T_OBJECT_OPERATOR","->",845],["T_STRING","load",845],"(",["T_VARIABLE","$customerId",845],")",";",["T_WHITESPACE","\n\n        ",845],["T_VARIABLE","$customer",847],["T_OBJECT_OPERATOR","->",847],["T_STRING","setPassword",847],"(",["T_VARIABLE","$password",847],")",";",["T_WHITESPACE","\n        ",847],["T_VARIABLE","$customer",848],["T_OBJECT_OPERATOR","->",848],["T_STRING","setPasswordConfirmation",848],"(",["T_VARIABLE","$passwordConfirmation",848],")",";",["T_WHITESPACE","\n        ",848],["T_VARIABLE","$validationErrorMessages",849],["T_WHITESPACE"," ",849],"=",["T_WHITESPACE"," ",849],["T_VARIABLE","$customer",849],["T_OBJECT_OPERATOR","->",849],["T_STRING","validateResetPassword",849],"(",")",";",["T_WHITESPACE","\n        ",849],["T_IF","if",850],["T_WHITESPACE"," ",850],"(",["T_STRING","is_array",850],"(",["T_VARIABLE","$validationErrorMessages",850],")",")",["T_WHITESPACE"," ",850],"{",["T_WHITESPACE","\n            ",850],["T_VARIABLE","$errorMessages",851],["T_WHITESPACE"," ",851],"=",["T_WHITESPACE"," ",851],["T_STRING","array_merge",851],"(",["T_VARIABLE","$errorMessages",851],",",["T_WHITESPACE"," ",851],["T_VARIABLE","$validationErrorMessages",851],")",";",["T_WHITESPACE","\n        ",851],"}",["T_WHITESPACE","\n\n        ",852],["T_IF","if",854],["T_WHITESPACE"," ",854],"(","!",["T_EMPTY","empty",854],"(",["T_VARIABLE","$errorMessages",854],")",")",["T_WHITESPACE"," ",854],"{",["T_WHITESPACE","\n            ",854],["T_VARIABLE","$this",855],["T_OBJECT_OPERATOR","->",855],["T_STRING","_getSession",855],"(",")",["T_OBJECT_OPERATOR","->",855],["T_STRING","setCustomerFormData",855],"(",["T_VARIABLE","$this",855],["T_OBJECT_OPERATOR","->",855],["T_STRING","getRequest",855],"(",")",["T_OBJECT_OPERATOR","->",855],["T_STRING","getPost",855],"(",")",")",";",["T_WHITESPACE","\n            ",855],["T_FOREACH","foreach",856],["T_WHITESPACE"," ",856],"(",["T_VARIABLE","$errorMessages",856],["T_WHITESPACE"," ",856],["T_AS","as",856],["T_WHITESPACE"," ",856],["T_VARIABLE","$errorMessage",856],")",["T_WHITESPACE"," ",856],"{",["T_WHITESPACE","\n                ",856],["T_VARIABLE","$this",857],["T_OBJECT_OPERATOR","->",857],["T_STRING","_getSession",857],"(",")",["T_OBJECT_OPERATOR","->",857],["T_STRING","addError",857],"(",["T_VARIABLE","$errorMessage",857],")",";",["T_WHITESPACE","\n            ",857],"}",["T_WHITESPACE","\n            ",858],["T_VARIABLE","$this",859],["T_OBJECT_OPERATOR","->",859],["T_STRING","_redirect",859],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/changeforgotten'",859],")",";",["T_WHITESPACE","\n            ",859],["T_RETURN","return",860],";",["T_WHITESPACE","\n        ",860],"}",["T_WHITESPACE","\n\n        ",861],["T_TRY","try",863],["T_WHITESPACE"," ",863],"{",["T_WHITESPACE","\n            ",863],["T_COMMENT","\/\/ Empty current reset password token i.e. invalidate it\n",864],["T_WHITESPACE","            ",865],["T_VARIABLE","$customer",865],["T_OBJECT_OPERATOR","->",865],["T_STRING","setRpToken",865],"(",["T_STRING","null",865],")",";",["T_WHITESPACE","\n            ",865],["T_VARIABLE","$customer",866],["T_OBJECT_OPERATOR","->",866],["T_STRING","setRpTokenCreatedAt",866],"(",["T_STRING","null",866],")",";",["T_WHITESPACE","\n            ",866],["T_VARIABLE","$customer",867],["T_OBJECT_OPERATOR","->",867],["T_STRING","cleanPasswordsValidationData",867],"(",")",";",["T_WHITESPACE","\n            ",867],["T_VARIABLE","$customer",868],["T_OBJECT_OPERATOR","->",868],["T_STRING","save",868],"(",")",";",["T_WHITESPACE","\n\n            ",868],["T_VARIABLE","$this",870],["T_OBJECT_OPERATOR","->",870],["T_STRING","_getSession",870],"(",")",["T_OBJECT_OPERATOR","->",870],["T_STRING","unsetData",870],"(",["T_STRING","self",870],["T_DOUBLE_COLON","::",870],["T_STRING","TOKEN_SESSION_NAME",870],")",";",["T_WHITESPACE","\n            ",870],["T_VARIABLE","$this",871],["T_OBJECT_OPERATOR","->",871],["T_STRING","_getSession",871],"(",")",["T_OBJECT_OPERATOR","->",871],["T_STRING","unsetData",871],"(",["T_STRING","self",871],["T_DOUBLE_COLON","::",871],["T_STRING","CUSTOMER_ID_SESSION_NAME",871],")",";",["T_WHITESPACE","\n\n            ",871],["T_VARIABLE","$this",873],["T_OBJECT_OPERATOR","->",873],["T_STRING","_getSession",873],"(",")",["T_OBJECT_OPERATOR","->",873],["T_STRING","addSuccess",873],"(",["T_VARIABLE","$this",873],["T_OBJECT_OPERATOR","->",873],["T_STRING","_getHelper",873],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",873],")",["T_OBJECT_OPERATOR","->",873],["T_STRING","__",873],"(",["T_CONSTANT_ENCAPSED_STRING","'Your password has been updated.'",873],")",")",";",["T_WHITESPACE","\n            ",873],["T_VARIABLE","$this",874],["T_OBJECT_OPERATOR","->",874],["T_STRING","_redirect",874],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/login'",874],")",";",["T_WHITESPACE","\n        ",874],"}",["T_WHITESPACE"," ",875],["T_CATCH","catch",875],["T_WHITESPACE"," ",875],"(",["T_STRING","Exception",875],["T_WHITESPACE"," ",875],["T_VARIABLE","$exception",875],")",["T_WHITESPACE"," ",875],"{",["T_WHITESPACE","\n            ",875],["T_VARIABLE","$this",876],["T_OBJECT_OPERATOR","->",876],["T_STRING","_getSession",876],"(",")",["T_OBJECT_OPERATOR","->",876],["T_STRING","addException",876],"(",["T_VARIABLE","$exception",876],",",["T_WHITESPACE"," ",876],["T_VARIABLE","$this",876],["T_OBJECT_OPERATOR","->",876],["T_STRING","__",876],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot save a new password.'",876],")",")",";",["T_WHITESPACE","\n            ",876],["T_VARIABLE","$this",877],["T_OBJECT_OPERATOR","->",877],["T_STRING","_redirect",877],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/changeforgotten'",877],")",";",["T_WHITESPACE","\n            ",877],["T_RETURN","return",878],";",["T_WHITESPACE","\n        ",878],"}",["T_WHITESPACE","\n    ",879],"}",["T_WHITESPACE","\n\n    ",880],["T_DOC_COMMENT","\/**\n     * Check if password reset token is valid\n     *\n     * @param int $customerId\n     * @param string $resetPasswordLinkToken\n     * @throws Mage_Core_Exception\n     *\/",882],["T_WHITESPACE","\n    ",888],["T_PROTECTED","protected",889],["T_WHITESPACE"," ",889],["T_FUNCTION","function",889],["T_WHITESPACE"," ",889],["T_STRING","_validateResetPasswordLinkToken",889],"(",["T_VARIABLE","$customerId",889],",",["T_WHITESPACE"," ",889],["T_VARIABLE","$resetPasswordLinkToken",889],")",["T_WHITESPACE","\n    ",889],"{",["T_WHITESPACE","\n        ",890],["T_IF","if",891],["T_WHITESPACE"," ",891],"(","!",["T_STRING","is_int",891],"(",["T_VARIABLE","$customerId",891],")",["T_WHITESPACE","\n            ",891],["T_BOOLEAN_OR","||",892],["T_WHITESPACE"," ",892],"!",["T_STRING","is_string",892],"(",["T_VARIABLE","$resetPasswordLinkToken",892],")",["T_WHITESPACE","\n            ",892],["T_BOOLEAN_OR","||",893],["T_WHITESPACE"," ",893],["T_EMPTY","empty",893],"(",["T_VARIABLE","$resetPasswordLinkToken",893],")",["T_WHITESPACE","\n            ",893],["T_BOOLEAN_OR","||",894],["T_WHITESPACE"," ",894],["T_EMPTY","empty",894],"(",["T_VARIABLE","$customerId",894],")",["T_WHITESPACE","\n            ",894],["T_BOOLEAN_OR","||",895],["T_WHITESPACE"," ",895],["T_VARIABLE","$customerId",895],["T_WHITESPACE"," ",895],"<",["T_WHITESPACE"," ",895],["T_LNUMBER","0",895],["T_WHITESPACE","\n        ",895],")",["T_WHITESPACE"," ",896],"{",["T_WHITESPACE","\n            ",896],["T_THROW","throw",897],["T_WHITESPACE"," ",897],["T_STRING","Mage",897],["T_DOUBLE_COLON","::",897],["T_STRING","exception",897],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Core'",897],",",["T_WHITESPACE"," ",897],["T_VARIABLE","$this",897],["T_OBJECT_OPERATOR","->",897],["T_STRING","_getHelper",897],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",897],")",["T_OBJECT_OPERATOR","->",897],["T_STRING","__",897],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid password reset token.'",897],")",")",";",["T_WHITESPACE","\n        ",897],"}",["T_WHITESPACE","\n\n        ",898],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",900],["T_WHITESPACE","\n        ",900],["T_VARIABLE","$customer",901],["T_WHITESPACE"," ",901],"=",["T_WHITESPACE"," ",901],["T_VARIABLE","$this",901],["T_OBJECT_OPERATOR","->",901],["T_STRING","_getModel",901],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",901],")",["T_OBJECT_OPERATOR","->",901],["T_STRING","load",901],"(",["T_VARIABLE","$customerId",901],")",";",["T_WHITESPACE","\n        ",901],["T_IF","if",902],["T_WHITESPACE"," ",902],"(","!",["T_VARIABLE","$customer",902],["T_WHITESPACE"," ",902],["T_BOOLEAN_OR","||",902],["T_WHITESPACE"," ",902],"!",["T_VARIABLE","$customer",902],["T_OBJECT_OPERATOR","->",902],["T_STRING","getId",902],"(",")",")",["T_WHITESPACE"," ",902],"{",["T_WHITESPACE","\n            ",902],["T_THROW","throw",903],["T_WHITESPACE"," ",903],["T_STRING","Mage",903],["T_DOUBLE_COLON","::",903],["T_STRING","exception",903],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Core'",903],",",["T_WHITESPACE"," ",903],["T_VARIABLE","$this",903],["T_OBJECT_OPERATOR","->",903],["T_STRING","_getHelper",903],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",903],")",["T_OBJECT_OPERATOR","->",903],["T_STRING","__",903],"(",["T_CONSTANT_ENCAPSED_STRING","'Wrong customer account specified.'",903],")",")",";",["T_WHITESPACE","\n        ",903],"}",["T_WHITESPACE","\n\n        ",904],["T_VARIABLE","$customerToken",906],["T_WHITESPACE"," ",906],"=",["T_WHITESPACE"," ",906],["T_VARIABLE","$customer",906],["T_OBJECT_OPERATOR","->",906],["T_STRING","getRpToken",906],"(",")",";",["T_WHITESPACE","\n        ",906],["T_IF","if",907],["T_WHITESPACE"," ",907],"(",["T_STRING","strcmp",907],"(",["T_VARIABLE","$customerToken",907],",",["T_WHITESPACE"," ",907],["T_VARIABLE","$resetPasswordLinkToken",907],")",["T_WHITESPACE"," ",907],["T_IS_NOT_EQUAL","!=",907],["T_WHITESPACE"," ",907],["T_LNUMBER","0",907],["T_WHITESPACE"," ",907],["T_BOOLEAN_OR","||",907],["T_WHITESPACE"," ",907],["T_VARIABLE","$customer",907],["T_OBJECT_OPERATOR","->",907],["T_STRING","isResetPasswordLinkTokenExpired",907],"(",")",")",["T_WHITESPACE"," ",907],"{",["T_WHITESPACE","\n            ",907],["T_THROW","throw",908],["T_WHITESPACE"," ",908],["T_STRING","Mage",908],["T_DOUBLE_COLON","::",908],["T_STRING","exception",908],"(",["T_CONSTANT_ENCAPSED_STRING","'Mage_Core'",908],",",["T_WHITESPACE"," ",908],["T_VARIABLE","$this",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","_getHelper",908],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",908],")",["T_OBJECT_OPERATOR","->",908],["T_STRING","__",908],"(",["T_CONSTANT_ENCAPSED_STRING","'Your password reset link has expired.'",908],")",")",";",["T_WHITESPACE","\n        ",908],"}",["T_WHITESPACE","\n    ",909],"}",["T_WHITESPACE","\n\n    ",910],["T_DOC_COMMENT","\/**\n     * Forgot customer account information page\n     *\/",912],["T_WHITESPACE","\n    ",914],["T_PUBLIC","public",915],["T_WHITESPACE"," ",915],["T_FUNCTION","function",915],["T_WHITESPACE"," ",915],["T_STRING","editAction",915],"(",")",["T_WHITESPACE","\n    ",915],"{",["T_WHITESPACE","\n        ",916],["T_VARIABLE","$this",917],["T_OBJECT_OPERATOR","->",917],["T_STRING","loadLayout",917],"(",")",";",["T_WHITESPACE","\n        ",917],["T_VARIABLE","$this",918],["T_OBJECT_OPERATOR","->",918],["T_STRING","_initLayoutMessages",918],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",918],")",";",["T_WHITESPACE","\n        ",918],["T_VARIABLE","$this",919],["T_OBJECT_OPERATOR","->",919],["T_STRING","_initLayoutMessages",919],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/session'",919],")",";",["T_WHITESPACE","\n\n        ",919],["T_VARIABLE","$block",921],["T_WHITESPACE"," ",921],"=",["T_WHITESPACE"," ",921],["T_VARIABLE","$this",921],["T_OBJECT_OPERATOR","->",921],["T_STRING","getLayout",921],"(",")",["T_OBJECT_OPERATOR","->",921],["T_STRING","getBlock",921],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_edit'",921],")",";",["T_WHITESPACE","\n        ",921],["T_IF","if",922],["T_WHITESPACE"," ",922],"(",["T_VARIABLE","$block",922],")",["T_WHITESPACE"," ",922],"{",["T_WHITESPACE","\n            ",922],["T_VARIABLE","$block",923],["T_OBJECT_OPERATOR","->",923],["T_STRING","setRefererUrl",923],"(",["T_VARIABLE","$this",923],["T_OBJECT_OPERATOR","->",923],["T_STRING","_getRefererUrl",923],"(",")",")",";",["T_WHITESPACE","\n        ",923],"}",["T_WHITESPACE","\n        ",924],["T_VARIABLE","$data",925],["T_WHITESPACE"," ",925],"=",["T_WHITESPACE"," ",925],["T_VARIABLE","$this",925],["T_OBJECT_OPERATOR","->",925],["T_STRING","_getSession",925],"(",")",["T_OBJECT_OPERATOR","->",925],["T_STRING","getCustomerFormData",925],"(",["T_STRING","true",925],")",";",["T_WHITESPACE","\n        ",925],["T_VARIABLE","$customer",926],["T_WHITESPACE"," ",926],"=",["T_WHITESPACE"," ",926],["T_VARIABLE","$this",926],["T_OBJECT_OPERATOR","->",926],["T_STRING","_getSession",926],"(",")",["T_OBJECT_OPERATOR","->",926],["T_STRING","getCustomer",926],"(",")",";",["T_WHITESPACE","\n        ",926],["T_IF","if",927],["T_WHITESPACE"," ",927],"(","!",["T_EMPTY","empty",927],"(",["T_VARIABLE","$data",927],")",")",["T_WHITESPACE"," ",927],"{",["T_WHITESPACE","\n            ",927],["T_VARIABLE","$customer",928],["T_OBJECT_OPERATOR","->",928],["T_STRING","addData",928],"(",["T_VARIABLE","$data",928],")",";",["T_WHITESPACE","\n        ",928],"}",["T_WHITESPACE","\n        ",929],["T_IF","if",930],["T_WHITESPACE"," ",930],"(",["T_VARIABLE","$this",930],["T_OBJECT_OPERATOR","->",930],["T_STRING","getRequest",930],"(",")",["T_OBJECT_OPERATOR","->",930],["T_STRING","getParam",930],"(",["T_CONSTANT_ENCAPSED_STRING","'changepass'",930],")",["T_WHITESPACE"," ",930],["T_IS_EQUAL","==",930],["T_WHITESPACE"," ",930],["T_LNUMBER","1",930],")",["T_WHITESPACE"," ",930],"{",["T_WHITESPACE","\n            ",930],["T_VARIABLE","$customer",931],["T_OBJECT_OPERATOR","->",931],["T_STRING","setChangePassword",931],"(",["T_LNUMBER","1",931],")",";",["T_WHITESPACE","\n        ",931],"}",["T_WHITESPACE","\n\n        ",932],["T_VARIABLE","$this",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","getLayout",934],"(",")",["T_OBJECT_OPERATOR","->",934],["T_STRING","getBlock",934],"(",["T_CONSTANT_ENCAPSED_STRING","'head'",934],")",["T_OBJECT_OPERATOR","->",934],["T_STRING","setTitle",934],"(",["T_VARIABLE","$this",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","__",934],"(",["T_CONSTANT_ENCAPSED_STRING","'Account Information'",934],")",")",";",["T_WHITESPACE","\n        ",934],["T_VARIABLE","$this",935],["T_OBJECT_OPERATOR","->",935],["T_STRING","getLayout",935],"(",")",["T_OBJECT_OPERATOR","->",935],["T_STRING","getBlock",935],"(",["T_CONSTANT_ENCAPSED_STRING","'messages'",935],")",["T_OBJECT_OPERATOR","->",935],["T_STRING","setEscapeMessageFlag",935],"(",["T_STRING","true",935],")",";",["T_WHITESPACE","\n        ",935],["T_VARIABLE","$this",936],["T_OBJECT_OPERATOR","->",936],["T_STRING","renderLayout",936],"(",")",";",["T_WHITESPACE","\n    ",936],"}",["T_WHITESPACE","\n\n    ",937],["T_DOC_COMMENT","\/**\n     * Change customer password action\n     *\/",939],["T_WHITESPACE","\n    ",941],["T_PUBLIC","public",942],["T_WHITESPACE"," ",942],["T_FUNCTION","function",942],["T_WHITESPACE"," ",942],["T_STRING","editPostAction",942],"(",")",["T_WHITESPACE","\n    ",942],"{",["T_WHITESPACE","\n        ",943],["T_IF","if",944],["T_WHITESPACE"," ",944],"(","!",["T_VARIABLE","$this",944],["T_OBJECT_OPERATOR","->",944],["T_STRING","_validateFormKey",944],"(",")",")",["T_WHITESPACE"," ",944],"{",["T_WHITESPACE","\n            ",944],["T_RETURN","return",945],["T_WHITESPACE"," ",945],["T_VARIABLE","$this",945],["T_OBJECT_OPERATOR","->",945],["T_STRING","_redirect",945],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/edit'",945],")",";",["T_WHITESPACE","\n        ",945],"}",["T_WHITESPACE","\n\n        ",946],["T_IF","if",948],["T_WHITESPACE"," ",948],"(",["T_VARIABLE","$this",948],["T_OBJECT_OPERATOR","->",948],["T_STRING","getRequest",948],"(",")",["T_OBJECT_OPERATOR","->",948],["T_STRING","isPost",948],"(",")",")",["T_WHITESPACE"," ",948],"{",["T_WHITESPACE","\n            ",948],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",949],["T_WHITESPACE","\n            ",949],["T_VARIABLE","$customer",950],["T_WHITESPACE"," ",950],"=",["T_WHITESPACE"," ",950],["T_VARIABLE","$this",950],["T_OBJECT_OPERATOR","->",950],["T_STRING","_getSession",950],"(",")",["T_OBJECT_OPERATOR","->",950],["T_STRING","getCustomer",950],"(",")",";",["T_WHITESPACE","\n            ",950],["T_VARIABLE","$customer",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","setOldEmail",951],"(",["T_VARIABLE","$customer",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","getEmail",951],"(",")",")",";",["T_WHITESPACE","\n            ",951],["T_DOC_COMMENT","\/** @var $customerForm Mage_Customer_Model_Form *\/",952],["T_WHITESPACE","\n            ",952],["T_VARIABLE","$customerForm",953],["T_WHITESPACE"," ",953],"=",["T_WHITESPACE"," ",953],["T_VARIABLE","$this",953],["T_OBJECT_OPERATOR","->",953],["T_STRING","_getModel",953],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/form'",953],")",";",["T_WHITESPACE","\n            ",953],["T_VARIABLE","$customerForm",954],["T_OBJECT_OPERATOR","->",954],["T_STRING","setFormCode",954],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_account_edit'",954],")",["T_WHITESPACE","\n                ",954],["T_OBJECT_OPERATOR","->",955],["T_STRING","setEntity",955],"(",["T_VARIABLE","$customer",955],")",";",["T_WHITESPACE","\n\n            ",955],["T_VARIABLE","$customerData",957],["T_WHITESPACE"," ",957],"=",["T_WHITESPACE"," ",957],["T_VARIABLE","$customerForm",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","extractData",957],"(",["T_VARIABLE","$this",957],["T_OBJECT_OPERATOR","->",957],["T_STRING","getRequest",957],"(",")",")",";",["T_WHITESPACE","\n\n            ",957],["T_VARIABLE","$errors",959],["T_WHITESPACE"," ",959],"=",["T_WHITESPACE"," ",959],["T_ARRAY","array",959],"(",")",";",["T_WHITESPACE","\n            ",959],["T_VARIABLE","$customerErrors",960],["T_WHITESPACE"," ",960],"=",["T_WHITESPACE"," ",960],["T_VARIABLE","$customerForm",960],["T_OBJECT_OPERATOR","->",960],["T_STRING","validateData",960],"(",["T_VARIABLE","$customerData",960],")",";",["T_WHITESPACE","\n            ",960],["T_IF","if",961],["T_WHITESPACE"," ",961],"(",["T_VARIABLE","$customerErrors",961],["T_WHITESPACE"," ",961],["T_IS_NOT_IDENTICAL","!==",961],["T_WHITESPACE"," ",961],["T_STRING","true",961],")",["T_WHITESPACE"," ",961],"{",["T_WHITESPACE","\n                ",961],["T_VARIABLE","$errors",962],["T_WHITESPACE"," ",962],"=",["T_WHITESPACE"," ",962],["T_STRING","array_merge",962],"(",["T_VARIABLE","$customerErrors",962],",",["T_WHITESPACE"," ",962],["T_VARIABLE","$errors",962],")",";",["T_WHITESPACE","\n            ",962],"}",["T_WHITESPACE"," ",963],["T_ELSE","else",963],["T_WHITESPACE"," ",963],"{",["T_WHITESPACE","\n                ",963],["T_VARIABLE","$customerForm",964],["T_OBJECT_OPERATOR","->",964],["T_STRING","compactData",964],"(",["T_VARIABLE","$customerData",964],")",";",["T_WHITESPACE","\n                ",964],["T_VARIABLE","$errors",965],["T_WHITESPACE"," ",965],"=",["T_WHITESPACE"," ",965],["T_ARRAY","array",965],"(",")",";",["T_WHITESPACE","\n\n                ",965],["T_IF","if",967],["T_WHITESPACE"," ",967],"(","!",["T_VARIABLE","$customer",967],["T_OBJECT_OPERATOR","->",967],["T_STRING","validatePassword",967],"(",["T_VARIABLE","$this",967],["T_OBJECT_OPERATOR","->",967],["T_STRING","getRequest",967],"(",")",["T_OBJECT_OPERATOR","->",967],["T_STRING","getPost",967],"(",["T_CONSTANT_ENCAPSED_STRING","'current_password'",967],")",")",")",["T_WHITESPACE"," ",967],"{",["T_WHITESPACE","\n                    ",967],["T_VARIABLE","$errors",968],"[","]",["T_WHITESPACE"," ",968],"=",["T_WHITESPACE"," ",968],["T_VARIABLE","$this",968],["T_OBJECT_OPERATOR","->",968],["T_STRING","__",968],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid current password'",968],")",";",["T_WHITESPACE","\n                ",968],"}",["T_WHITESPACE","\n\n                ",969],["T_COMMENT","\/\/ If email change was requested then set flag\n",971],["T_WHITESPACE","                ",972],["T_VARIABLE","$isChangeEmail",972],["T_WHITESPACE"," ",972],"=",["T_WHITESPACE"," ",972],"(",["T_VARIABLE","$customer",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","getOldEmail",972],"(",")",["T_WHITESPACE"," ",972],["T_IS_NOT_EQUAL","!=",972],["T_WHITESPACE"," ",972],["T_VARIABLE","$customer",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","getEmail",972],"(",")",")",["T_WHITESPACE"," ",972],"?",["T_WHITESPACE"," ",972],["T_STRING","true",972],["T_WHITESPACE"," ",972],":",["T_WHITESPACE"," ",972],["T_STRING","false",972],";",["T_WHITESPACE","\n                ",972],["T_VARIABLE","$customer",973],["T_OBJECT_OPERATOR","->",973],["T_STRING","setIsChangeEmail",973],"(",["T_VARIABLE","$isChangeEmail",973],")",";",["T_WHITESPACE","\n\n                ",973],["T_COMMENT","\/\/ If password change was requested then add it to common validation scheme\n",975],["T_WHITESPACE","                ",976],["T_VARIABLE","$customer",976],["T_OBJECT_OPERATOR","->",976],["T_STRING","setIsChangePassword",976],"(",["T_VARIABLE","$this",976],["T_OBJECT_OPERATOR","->",976],["T_STRING","getRequest",976],"(",")",["T_OBJECT_OPERATOR","->",976],["T_STRING","getParam",976],"(",["T_CONSTANT_ENCAPSED_STRING","'change_password'",976],")",")",";",["T_WHITESPACE","\n\n                ",976],["T_IF","if",978],["T_WHITESPACE"," ",978],"(",["T_VARIABLE","$customer",978],["T_OBJECT_OPERATOR","->",978],["T_STRING","getIsChangePassword",978],"(",")",")",["T_WHITESPACE"," ",978],"{",["T_WHITESPACE","\n                    ",978],["T_VARIABLE","$newPass",979],["T_WHITESPACE","    ",979],"=",["T_WHITESPACE"," ",979],["T_VARIABLE","$this",979],["T_OBJECT_OPERATOR","->",979],["T_STRING","getRequest",979],"(",")",["T_OBJECT_OPERATOR","->",979],["T_STRING","getPost",979],"(",["T_CONSTANT_ENCAPSED_STRING","'password'",979],")",";",["T_WHITESPACE","\n                    ",979],["T_VARIABLE","$confPass",980],["T_WHITESPACE","   ",980],"=",["T_WHITESPACE"," ",980],["T_VARIABLE","$this",980],["T_OBJECT_OPERATOR","->",980],["T_STRING","getRequest",980],"(",")",["T_OBJECT_OPERATOR","->",980],["T_STRING","getPost",980],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmation'",980],")",";",["T_WHITESPACE","\n\n                    ",980],["T_IF","if",982],["T_WHITESPACE"," ",982],"(",["T_STRING","strlen",982],"(",["T_VARIABLE","$newPass",982],")",")",["T_WHITESPACE"," ",982],"{",["T_WHITESPACE","\n                        ",982],["T_DOC_COMMENT","\/**\n                         * Set entered password and its confirmation - they\n                         * will be validated later to match each other and be of right length\n                         *\/",983],["T_WHITESPACE","\n                        ",986],["T_VARIABLE","$customer",987],["T_OBJECT_OPERATOR","->",987],["T_STRING","setPassword",987],"(",["T_VARIABLE","$newPass",987],")",";",["T_WHITESPACE","\n                        ",987],["T_VARIABLE","$customer",988],["T_OBJECT_OPERATOR","->",988],["T_STRING","setPasswordConfirmation",988],"(",["T_VARIABLE","$confPass",988],")",";",["T_WHITESPACE","\n                    ",988],"}",["T_WHITESPACE"," ",989],["T_ELSE","else",989],["T_WHITESPACE"," ",989],"{",["T_WHITESPACE","\n                        ",989],["T_VARIABLE","$errors",990],"[","]",["T_WHITESPACE"," ",990],"=",["T_WHITESPACE"," ",990],["T_VARIABLE","$this",990],["T_OBJECT_OPERATOR","->",990],["T_STRING","__",990],"(",["T_CONSTANT_ENCAPSED_STRING","'New password field cannot be empty.'",990],")",";",["T_WHITESPACE","\n                    ",990],"}",["T_WHITESPACE","\n                ",991],"}",["T_WHITESPACE","\n\n                ",992],["T_COMMENT","\/\/ Validate account and compose list of errors if any\n",994],["T_WHITESPACE","                ",995],["T_VARIABLE","$customerErrors",995],["T_WHITESPACE"," ",995],"=",["T_WHITESPACE"," ",995],["T_VARIABLE","$customer",995],["T_OBJECT_OPERATOR","->",995],["T_STRING","validate",995],"(",")",";",["T_WHITESPACE","\n                ",995],["T_IF","if",996],["T_WHITESPACE"," ",996],"(",["T_STRING","is_array",996],"(",["T_VARIABLE","$customerErrors",996],")",")",["T_WHITESPACE"," ",996],"{",["T_WHITESPACE","\n                    ",996],["T_VARIABLE","$errors",997],["T_WHITESPACE"," ",997],"=",["T_WHITESPACE"," ",997],["T_STRING","array_merge",997],"(",["T_VARIABLE","$errors",997],",",["T_WHITESPACE"," ",997],["T_VARIABLE","$customerErrors",997],")",";",["T_WHITESPACE","\n                ",997],"}",["T_WHITESPACE","\n            ",998],"}",["T_WHITESPACE","\n\n            ",999],["T_IF","if",1001],["T_WHITESPACE"," ",1001],"(","!",["T_EMPTY","empty",1001],"(",["T_VARIABLE","$errors",1001],")",")",["T_WHITESPACE"," ",1001],"{",["T_WHITESPACE","\n                ",1001],["T_VARIABLE","$this",1002],["T_OBJECT_OPERATOR","->",1002],["T_STRING","_getSession",1002],"(",")",["T_OBJECT_OPERATOR","->",1002],["T_STRING","setCustomerFormData",1002],"(",["T_VARIABLE","$this",1002],["T_OBJECT_OPERATOR","->",1002],["T_STRING","getRequest",1002],"(",")",["T_OBJECT_OPERATOR","->",1002],["T_STRING","getPost",1002],"(",")",")",";",["T_WHITESPACE","\n                ",1002],["T_FOREACH","foreach",1003],["T_WHITESPACE"," ",1003],"(",["T_VARIABLE","$errors",1003],["T_WHITESPACE"," ",1003],["T_AS","as",1003],["T_WHITESPACE"," ",1003],["T_VARIABLE","$message",1003],")",["T_WHITESPACE"," ",1003],"{",["T_WHITESPACE","\n                    ",1003],["T_VARIABLE","$this",1004],["T_OBJECT_OPERATOR","->",1004],["T_STRING","_getSession",1004],"(",")",["T_OBJECT_OPERATOR","->",1004],["T_STRING","addError",1004],"(",["T_VARIABLE","$message",1004],")",";",["T_WHITESPACE","\n                ",1004],"}",["T_WHITESPACE","\n                ",1005],["T_VARIABLE","$this",1006],["T_OBJECT_OPERATOR","->",1006],["T_STRING","_redirect",1006],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/edit'",1006],")",";",["T_WHITESPACE","\n                ",1006],["T_RETURN","return",1007],["T_WHITESPACE"," ",1007],["T_VARIABLE","$this",1007],";",["T_WHITESPACE","\n            ",1007],"}",["T_WHITESPACE","\n\n            ",1008],["T_TRY","try",1010],["T_WHITESPACE"," ",1010],"{",["T_WHITESPACE","\n                ",1010],["T_VARIABLE","$customer",1011],["T_OBJECT_OPERATOR","->",1011],["T_STRING","cleanPasswordsValidationData",1011],"(",")",";",["T_WHITESPACE","\n\n                ",1011],["T_COMMENT","\/\/ Reset all password reset tokens if all data was sufficient and correct on email change\n",1013],["T_WHITESPACE","                ",1014],["T_IF","if",1014],["T_WHITESPACE"," ",1014],"(",["T_VARIABLE","$customer",1014],["T_OBJECT_OPERATOR","->",1014],["T_STRING","getIsChangeEmail",1014],"(",")",")",["T_WHITESPACE"," ",1014],"{",["T_WHITESPACE","\n                    ",1014],["T_VARIABLE","$customer",1015],["T_OBJECT_OPERATOR","->",1015],["T_STRING","setRpToken",1015],"(",["T_STRING","null",1015],")",";",["T_WHITESPACE","\n                    ",1015],["T_VARIABLE","$customer",1016],["T_OBJECT_OPERATOR","->",1016],["T_STRING","setRpTokenCreatedAt",1016],"(",["T_STRING","null",1016],")",";",["T_WHITESPACE","\n                ",1016],"}",["T_WHITESPACE","\n\n                ",1017],["T_VARIABLE","$customer",1019],["T_OBJECT_OPERATOR","->",1019],["T_STRING","save",1019],"(",")",";",["T_WHITESPACE","\n                ",1019],["T_VARIABLE","$this",1020],["T_OBJECT_OPERATOR","->",1020],["T_STRING","_getSession",1020],"(",")",["T_OBJECT_OPERATOR","->",1020],["T_STRING","setCustomer",1020],"(",["T_VARIABLE","$customer",1020],")",["T_WHITESPACE","\n                    ",1020],["T_OBJECT_OPERATOR","->",1021],["T_STRING","addSuccess",1021],"(",["T_VARIABLE","$this",1021],["T_OBJECT_OPERATOR","->",1021],["T_STRING","__",1021],"(",["T_CONSTANT_ENCAPSED_STRING","'The account information has been saved.'",1021],")",")",";",["T_WHITESPACE","\n\n                ",1021],["T_IF","if",1023],["T_WHITESPACE"," ",1023],"(",["T_VARIABLE","$customer",1023],["T_OBJECT_OPERATOR","->",1023],["T_STRING","getIsChangeEmail",1023],"(",")",["T_WHITESPACE"," ",1023],["T_BOOLEAN_OR","||",1023],["T_WHITESPACE"," ",1023],["T_VARIABLE","$customer",1023],["T_OBJECT_OPERATOR","->",1023],["T_STRING","getIsChangePassword",1023],"(",")",")",["T_WHITESPACE"," ",1023],"{",["T_WHITESPACE","\n                    ",1023],["T_VARIABLE","$customer",1024],["T_OBJECT_OPERATOR","->",1024],["T_STRING","sendChangedPasswordOrEmail",1024],"(",")",";",["T_WHITESPACE","\n                ",1024],"}",["T_WHITESPACE","\n\n                ",1025],["T_VARIABLE","$this",1027],["T_OBJECT_OPERATOR","->",1027],["T_STRING","_redirect",1027],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/account'",1027],")",";",["T_WHITESPACE","\n                ",1027],["T_RETURN","return",1028],";",["T_WHITESPACE","\n            ",1028],"}",["T_WHITESPACE"," ",1029],["T_CATCH","catch",1029],["T_WHITESPACE"," ",1029],"(",["T_STRING","Mage_Core_Exception",1029],["T_WHITESPACE"," ",1029],["T_VARIABLE","$e",1029],")",["T_WHITESPACE"," ",1029],"{",["T_WHITESPACE","\n                ",1029],["T_VARIABLE","$this",1030],["T_OBJECT_OPERATOR","->",1030],["T_STRING","_getSession",1030],"(",")",["T_OBJECT_OPERATOR","->",1030],["T_STRING","setCustomerFormData",1030],"(",["T_VARIABLE","$this",1030],["T_OBJECT_OPERATOR","->",1030],["T_STRING","getRequest",1030],"(",")",["T_OBJECT_OPERATOR","->",1030],["T_STRING","getPost",1030],"(",")",")",["T_WHITESPACE","\n                    ",1030],["T_OBJECT_OPERATOR","->",1031],["T_STRING","addError",1031],"(",["T_VARIABLE","$e",1031],["T_OBJECT_OPERATOR","->",1031],["T_STRING","getMessage",1031],"(",")",")",";",["T_WHITESPACE","\n            ",1031],"}",["T_WHITESPACE"," ",1032],["T_CATCH","catch",1032],["T_WHITESPACE"," ",1032],"(",["T_STRING","Exception",1032],["T_WHITESPACE"," ",1032],["T_VARIABLE","$e",1032],")",["T_WHITESPACE"," ",1032],"{",["T_WHITESPACE","\n                ",1032],["T_VARIABLE","$this",1033],["T_OBJECT_OPERATOR","->",1033],["T_STRING","_getSession",1033],"(",")",["T_OBJECT_OPERATOR","->",1033],["T_STRING","setCustomerFormData",1033],"(",["T_VARIABLE","$this",1033],["T_OBJECT_OPERATOR","->",1033],["T_STRING","getRequest",1033],"(",")",["T_OBJECT_OPERATOR","->",1033],["T_STRING","getPost",1033],"(",")",")",["T_WHITESPACE","\n                    ",1033],["T_OBJECT_OPERATOR","->",1034],["T_STRING","addException",1034],"(",["T_VARIABLE","$e",1034],",",["T_WHITESPACE"," ",1034],["T_VARIABLE","$this",1034],["T_OBJECT_OPERATOR","->",1034],["T_STRING","__",1034],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot save the customer.'",1034],")",")",";",["T_WHITESPACE","\n            ",1034],"}",["T_WHITESPACE","\n        ",1035],"}",["T_WHITESPACE","\n\n        ",1036],["T_VARIABLE","$this",1038],["T_OBJECT_OPERATOR","->",1038],["T_STRING","_redirect",1038],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/edit'",1038],")",";",["T_WHITESPACE","\n    ",1038],"}",["T_WHITESPACE","\n\n    ",1039],["T_DOC_COMMENT","\/**\n     * Filtering posted data. Converting localized data if needed\n     *\n     * @param array\n     * @return array\n     *\/",1041],["T_WHITESPACE","\n    ",1046],["T_PROTECTED","protected",1047],["T_WHITESPACE"," ",1047],["T_FUNCTION","function",1047],["T_WHITESPACE"," ",1047],["T_STRING","_filterPostData",1047],"(",["T_VARIABLE","$data",1047],")",["T_WHITESPACE","\n    ",1047],"{",["T_WHITESPACE","\n        ",1048],["T_VARIABLE","$data",1049],["T_WHITESPACE"," ",1049],"=",["T_WHITESPACE"," ",1049],["T_VARIABLE","$this",1049],["T_OBJECT_OPERATOR","->",1049],["T_STRING","_filterDates",1049],"(",["T_VARIABLE","$data",1049],",",["T_WHITESPACE"," ",1049],["T_ARRAY","array",1049],"(",["T_CONSTANT_ENCAPSED_STRING","'dob'",1049],")",")",";",["T_WHITESPACE","\n        ",1049],["T_RETURN","return",1050],["T_WHITESPACE"," ",1050],["T_VARIABLE","$data",1050],";",["T_WHITESPACE","\n    ",1050],"}",["T_WHITESPACE","\n\n    ",1051],["T_DOC_COMMENT","\/**\n     * Check whether VAT ID validation is enabled\n     *\n     * @param Mage_Core_Model_Store|string|int $store\n     * @return bool\n     *\/",1053],["T_WHITESPACE","\n    ",1058],["T_PROTECTED","protected",1059],["T_WHITESPACE"," ",1059],["T_FUNCTION","function",1059],["T_WHITESPACE"," ",1059],["T_STRING","_isVatValidationEnabled",1059],"(",["T_VARIABLE","$store",1059],["T_WHITESPACE"," ",1059],"=",["T_WHITESPACE"," ",1059],["T_STRING","null",1059],")",["T_WHITESPACE","\n    ",1059],"{",["T_WHITESPACE","\n        ",1060],["T_RETURN","return",1061],["T_WHITESPACE","  ",1061],["T_VARIABLE","$this",1061],["T_OBJECT_OPERATOR","->",1061],["T_STRING","_getHelper",1061],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",1061],")",["T_OBJECT_OPERATOR","->",1061],["T_STRING","isVatValidationEnabled",1061],"(",["T_VARIABLE","$store",1061],")",";",["T_WHITESPACE","\n    ",1061],"}",["T_WHITESPACE","\n\n    ",1062],["T_DOC_COMMENT","\/**\n     * Get restore password params.\n     *\n     * @param Mage_Customer_Model_Session $session\n     * @return array array ($customerId, $resetPasswordToken)\n     *\/",1064],["T_WHITESPACE","\n    ",1069],["T_PROTECTED","protected",1070],["T_WHITESPACE"," ",1070],["T_FUNCTION","function",1070],["T_WHITESPACE"," ",1070],["T_STRING","_getRestorePasswordParameters",1070],"(",["T_STRING","Mage_Customer_Model_Session",1070],["T_WHITESPACE"," ",1070],["T_VARIABLE","$session",1070],")",["T_WHITESPACE","\n    ",1070],"{",["T_WHITESPACE","\n        ",1071],["T_RETURN","return",1072],["T_WHITESPACE"," ",1072],["T_ARRAY","array",1072],"(",["T_WHITESPACE","\n            ",1072],["T_INT_CAST","(int)",1073],["T_WHITESPACE"," ",1073],["T_VARIABLE","$session",1073],["T_OBJECT_OPERATOR","->",1073],["T_STRING","getData",1073],"(",["T_STRING","self",1073],["T_DOUBLE_COLON","::",1073],["T_STRING","CUSTOMER_ID_SESSION_NAME",1073],")",",",["T_WHITESPACE","\n            ",1073],["T_STRING_CAST","(string)",1074],["T_WHITESPACE"," ",1074],["T_VARIABLE","$session",1074],["T_OBJECT_OPERATOR","->",1074],["T_STRING","getData",1074],"(",["T_STRING","self",1074],["T_DOUBLE_COLON","::",1074],["T_STRING","TOKEN_SESSION_NAME",1074],")",["T_WHITESPACE","\n        ",1074],")",";",["T_WHITESPACE","\n    ",1075],"}",["T_WHITESPACE","\n\n    ",1076],["T_DOC_COMMENT","\/**\n     * Save restore password params to session.\n     *\n     * @param int $customerId\n     * @param  string $resetPasswordLinkToken\n     * @return $this\n     *\/",1078],["T_WHITESPACE","\n    ",1084],["T_PROTECTED","protected",1085],["T_WHITESPACE"," ",1085],["T_FUNCTION","function",1085],["T_WHITESPACE"," ",1085],["T_STRING","_saveRestorePasswordParameters",1085],"(",["T_VARIABLE","$customerId",1085],",",["T_WHITESPACE"," ",1085],["T_VARIABLE","$resetPasswordLinkToken",1085],")",["T_WHITESPACE","\n    ",1085],"{",["T_WHITESPACE","\n        ",1086],["T_VARIABLE","$this",1087],["T_OBJECT_OPERATOR","->",1087],["T_STRING","_getSession",1087],"(",")",["T_WHITESPACE","\n            ",1087],["T_OBJECT_OPERATOR","->",1088],["T_STRING","setData",1088],"(",["T_STRING","self",1088],["T_DOUBLE_COLON","::",1088],["T_STRING","CUSTOMER_ID_SESSION_NAME",1088],",",["T_WHITESPACE"," ",1088],["T_VARIABLE","$customerId",1088],")",["T_WHITESPACE","\n            ",1088],["T_OBJECT_OPERATOR","->",1089],["T_STRING","setData",1089],"(",["T_STRING","self",1089],["T_DOUBLE_COLON","::",1089],["T_STRING","TOKEN_SESSION_NAME",1089],",",["T_WHITESPACE"," ",1089],["T_VARIABLE","$resetPasswordLinkToken",1089],")",";",["T_WHITESPACE","\n\n        ",1089],["T_RETURN","return",1091],["T_WHITESPACE"," ",1091],["T_VARIABLE","$this",1091],";",["T_WHITESPACE","\n    ",1091],"}",["T_WHITESPACE","\n",1092],"}",["T_WHITESPACE","\n",1093]]