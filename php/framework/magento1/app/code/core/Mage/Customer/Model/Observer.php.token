[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Customer\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Customer module observer\n *\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",31],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Mage_Customer_Model_Observer",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_DOC_COMMENT","\/**\n     * VAT ID validation processed flag code\n     *\/",34],["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","VIV_PROCESSED_FLAG",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'viv_after_address_save_processed'",37],";",["T_WHITESPACE","\n\n    ",37],["T_DOC_COMMENT","\/**\n     * VAT ID validation currently saved address flag\n     *\/",39],["T_WHITESPACE","\n    ",41],["T_CONST","const",42],["T_WHITESPACE"," ",42],["T_STRING","VIV_CURRENTLY_SAVED_ADDRESS",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'currently_saved_address'",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Check whether specified billing address is default for its customer\n     *\n     * @param Mage_Customer_Model_Address $address\n     * @return bool\n     *\/",44],["T_WHITESPACE","\n    ",49],["T_PROTECTED","protected",50],["T_WHITESPACE"," ",50],["T_FUNCTION","function",50],["T_WHITESPACE"," ",50],["T_STRING","_isDefaultBilling",50],"(",["T_VARIABLE","$address",50],")",["T_WHITESPACE","\n    ",50],"{",["T_WHITESPACE","\n        ",51],["T_RETURN","return",52],["T_WHITESPACE"," ",52],"(",["T_VARIABLE","$address",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getId",52],"(",")",["T_WHITESPACE"," ",52],["T_BOOLEAN_AND","&&",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$address",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getId",52],"(",")",["T_WHITESPACE"," ",52],["T_IS_EQUAL","==",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$address",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getCustomer",52],"(",")",["T_OBJECT_OPERATOR","->",52],["T_STRING","getDefaultBilling",52],"(",")",")",["T_WHITESPACE","\n            ",52],["T_BOOLEAN_OR","||",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$address",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getIsPrimaryBilling",53],"(",")",["T_WHITESPACE"," ",53],["T_BOOLEAN_OR","||",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$address",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","getIsDefaultBilling",53],"(",")",";",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Check whether specified shipping address is default for its customer\n     *\n     * @param Mage_Customer_Model_Address $address\n     * @return bool\n     *\/",56],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","_isDefaultShipping",62],"(",["T_VARIABLE","$address",62],")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_RETURN","return",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$address",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getId",64],"(",")",["T_WHITESPACE"," ",64],["T_BOOLEAN_AND","&&",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$address",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getId",64],"(",")",["T_WHITESPACE"," ",64],["T_IS_EQUAL","==",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$address",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getCustomer",64],"(",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","getDefaultShipping",64],"(",")",")",["T_WHITESPACE","\n            ",64],["T_BOOLEAN_OR","||",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$address",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getIsPrimaryShipping",65],"(",")",["T_WHITESPACE"," ",65],["T_BOOLEAN_OR","||",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$address",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getIsDefaultShipping",65],"(",")",";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Check whether specified address should be processed in after_save event handler\n     *\n     * @param Mage_Customer_Model_Address $address\n     * @return bool\n     *\/",68],["T_WHITESPACE","\n    ",73],["T_PROTECTED","protected",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","_canProcessAddress",74],"(",["T_VARIABLE","$address",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_VARIABLE","$address",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getForceProcess",76],"(",")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","true",77],";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_IF","if",80],["T_WHITESPACE"," ",80],"(",["T_STRING","Mage",80],["T_DOUBLE_COLON","::",80],["T_STRING","registry",80],"(",["T_STRING","self",80],["T_DOUBLE_COLON","::",80],["T_STRING","VIV_CURRENTLY_SAVED_ADDRESS",80],")",["T_WHITESPACE"," ",80],["T_IS_NOT_EQUAL","!=",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$address",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getId",80],"(",")",")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n            ",80],["T_RETURN","return",81],["T_WHITESPACE"," ",81],["T_STRING","false",81],";",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE","\n\n        ",82],["T_VARIABLE","$configAddressType",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","helper",84],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",84],")",["T_OBJECT_OPERATOR","->",84],["T_STRING","getTaxCalculationAddressType",84],"(",")",";",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$configAddressType",85],["T_WHITESPACE"," ",85],["T_IS_EQUAL","==",85],["T_WHITESPACE"," ",85],["T_STRING","Mage_Customer_Model_Address_Abstract",85],["T_DOUBLE_COLON","::",85],["T_STRING","TYPE_SHIPPING",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_isDefaultShipping",86],"(",["T_VARIABLE","$address",86],")",";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n        ",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_isDefaultBilling",88],"(",["T_VARIABLE","$address",88],")",";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Before load layout event handler\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",91],["T_WHITESPACE","\n    ",95],["T_PUBLIC","public",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","beforeLoadLayout",96],"(",["T_VARIABLE","$observer",96],")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$loggedIn",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","Mage",98],["T_DOUBLE_COLON","::",98],["T_STRING","getSingleton",98],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",98],")",["T_OBJECT_OPERATOR","->",98],["T_STRING","isLoggedIn",98],"(",")",";",["T_WHITESPACE","\n\n        ",98],["T_VARIABLE","$observer",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getEvent",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getLayout",100],"(",")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getUpdate",100],"(",")",["T_WHITESPACE","\n           ",100],["T_OBJECT_OPERATOR","->",101],["T_STRING","addHandle",101],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_logged_'",101],["T_WHITESPACE"," ",101],".",["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$loggedIn",101],["T_WHITESPACE"," ",101],"?",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'in'",101],["T_WHITESPACE"," ",101],":",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'out'",101],")",")",";",["T_WHITESPACE","\n    ",101],"}",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Address before save event handler\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",104],["T_WHITESPACE","\n    ",108],["T_PUBLIC","public",109],["T_WHITESPACE"," ",109],["T_FUNCTION","function",109],["T_WHITESPACE"," ",109],["T_STRING","beforeAddressSave",109],"(",["T_VARIABLE","$observer",109],")",["T_WHITESPACE","\n    ",109],"{",["T_WHITESPACE","\n        ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_STRING","Mage",111],["T_DOUBLE_COLON","::",111],["T_STRING","registry",111],"(",["T_STRING","self",111],["T_DOUBLE_COLON","::",111],["T_STRING","VIV_CURRENTLY_SAVED_ADDRESS",111],")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_STRING","Mage",112],["T_DOUBLE_COLON","::",112],["T_STRING","unregister",112],"(",["T_STRING","self",112],["T_DOUBLE_COLON","::",112],["T_STRING","VIV_CURRENTLY_SAVED_ADDRESS",112],")",";",["T_WHITESPACE","\n        ",112],"}",["T_WHITESPACE","\n\n        ",113],["T_DOC_COMMENT","\/** @var $customerAddress Mage_Customer_Model_Address *\/",115],["T_WHITESPACE","\n        ",115],["T_VARIABLE","$customerAddress",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$observer",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getCustomerAddress",116],"(",")",";",["T_WHITESPACE","\n        ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$customerAddress",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getId",117],"(",")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","register",118],"(",["T_STRING","self",118],["T_DOUBLE_COLON","::",118],["T_STRING","VIV_CURRENTLY_SAVED_ADDRESS",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$customerAddress",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getId",118],"(",")",")",";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE"," ",119],["T_ELSE","else",119],["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$configAddressType",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","Mage",120],["T_DOUBLE_COLON","::",120],["T_STRING","helper",120],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",120],")",["T_OBJECT_OPERATOR","->",120],["T_STRING","getTaxCalculationAddressType",120],"(",")",";",["T_WHITESPACE","\n\n            ",120],["T_VARIABLE","$forceProcess",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],"(",["T_VARIABLE","$configAddressType",122],["T_WHITESPACE"," ",122],["T_IS_EQUAL","==",122],["T_WHITESPACE"," ",122],["T_STRING","Mage_Customer_Model_Address_Abstract",122],["T_DOUBLE_COLON","::",122],["T_STRING","TYPE_SHIPPING",122],")",["T_WHITESPACE","\n                ",122],"?",["T_WHITESPACE"," ",123],["T_VARIABLE","$customerAddress",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getIsDefaultShipping",123],"(",")",["T_WHITESPACE"," ",123],":",["T_WHITESPACE"," ",123],["T_VARIABLE","$customerAddress",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getIsDefaultBilling",123],"(",")",";",["T_WHITESPACE","\n\n            ",123],["T_IF","if",125],["T_WHITESPACE"," ",125],"(",["T_VARIABLE","$forceProcess",125],")",["T_WHITESPACE"," ",125],"{",["T_WHITESPACE","\n                ",125],["T_VARIABLE","$customerAddress",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","setForceProcess",126],"(",["T_STRING","true",126],")",";",["T_WHITESPACE","\n            ",126],"}",["T_WHITESPACE"," ",127],["T_ELSE","else",127],["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n                ",127],["T_STRING","Mage",128],["T_DOUBLE_COLON","::",128],["T_STRING","register",128],"(",["T_STRING","self",128],["T_DOUBLE_COLON","::",128],["T_STRING","VIV_CURRENTLY_SAVED_ADDRESS",128],",",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'new_address'",128],")",";",["T_WHITESPACE","\n            ",128],"}",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Address after save event handler\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",133],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","afterAddressSave",138],"(",["T_VARIABLE","$observer",138],")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_DOC_COMMENT","\/** @var $customerAddress Mage_Customer_Model_Address *\/",140],["T_WHITESPACE","\n        ",140],["T_VARIABLE","$customerAddress",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$observer",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getCustomerAddress",141],"(",")",";",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$customer",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$customerAddress",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getCustomer",142],"(",")",";",["T_WHITESPACE","\n\n        ",142],["T_VARIABLE","$store",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","Mage",144],["T_DOUBLE_COLON","::",144],["T_STRING","app",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","getStore",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","isAdmin",144],"(",")",["T_WHITESPACE"," ",144],"?",["T_WHITESPACE"," ",144],["T_VARIABLE","$customer",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getStore",144],"(",")",["T_WHITESPACE"," ",144],":",["T_WHITESPACE"," ",144],["T_STRING","null",144],";",["T_WHITESPACE","\n        ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(","!",["T_STRING","Mage",145],["T_DOUBLE_COLON","::",145],["T_STRING","helper",145],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",145],")",["T_OBJECT_OPERATOR","->",145],["T_STRING","isVatValidationEnabled",145],"(",["T_VARIABLE","$store",145],")",["T_WHITESPACE","\n            ",145],["T_BOOLEAN_OR","||",146],["T_WHITESPACE"," ",146],["T_STRING","Mage",146],["T_DOUBLE_COLON","::",146],["T_STRING","registry",146],"(",["T_STRING","self",146],["T_DOUBLE_COLON","::",146],["T_STRING","VIV_PROCESSED_FLAG",146],")",["T_WHITESPACE","\n            ",146],["T_BOOLEAN_OR","||",147],["T_WHITESPACE"," ",147],"!",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","_canProcessAddress",147],"(",["T_VARIABLE","$customerAddress",147],")",["T_WHITESPACE","\n        ",147],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_RETURN","return",149],";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n\n        ",150],["T_TRY","try",152],["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_STRING","Mage",153],["T_DOUBLE_COLON","::",153],["T_STRING","register",153],"(",["T_STRING","self",153],["T_DOUBLE_COLON","::",153],["T_STRING","VIV_PROCESSED_FLAG",153],",",["T_WHITESPACE"," ",153],["T_STRING","true",153],")",";",["T_WHITESPACE","\n\n            ",153],["T_DOC_COMMENT","\/** @var $customerHelper Mage_Customer_Helper_Data *\/",155],["T_WHITESPACE","\n            ",155],["T_VARIABLE","$customerHelper",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_STRING","Mage",156],["T_DOUBLE_COLON","::",156],["T_STRING","helper",156],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",156],")",";",["T_WHITESPACE","\n\n            ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$customerAddress",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getVatId",158],"(",")",["T_WHITESPACE"," ",158],["T_IS_EQUAL","==",158],["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","''",158],["T_WHITESPACE","\n                ",158],["T_BOOLEAN_OR","||",159],["T_WHITESPACE"," ",159],"!",["T_STRING","Mage",159],["T_DOUBLE_COLON","::",159],["T_STRING","helper",159],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",159],")",["T_OBJECT_OPERATOR","->",159],["T_STRING","isCountryInEU",159],"(",["T_VARIABLE","$customerAddress",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","getCountry",159],"(",")",")",")",["T_WHITESPACE","\n            ",159],"{",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$defaultGroupId",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$customerHelper",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getDefaultCustomerGroupId",161],"(",["T_VARIABLE","$customer",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getStore",161],"(",")",")",";",["T_WHITESPACE","\n\n                ",161],["T_IF","if",163],["T_WHITESPACE"," ",163],"(","!",["T_VARIABLE","$customer",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getDisableAutoGroupChange",163],"(",")",["T_WHITESPACE"," ",163],["T_BOOLEAN_AND","&&",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$customer",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getGroupId",163],"(",")",["T_WHITESPACE"," ",163],["T_IS_NOT_EQUAL","!=",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$defaultGroupId",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                    ",163],["T_VARIABLE","$customer",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setGroupId",164],"(",["T_VARIABLE","$defaultGroupId",164],")",";",["T_WHITESPACE","\n                    ",164],["T_VARIABLE","$customer",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","save",165],"(",")",";",["T_WHITESPACE","\n                ",165],"}",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE"," ",167],["T_ELSE","else",167],["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n\n                ",167],["T_VARIABLE","$result",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$customerHelper",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","checkVatNumber",169],"(",["T_WHITESPACE","\n                    ",169],["T_VARIABLE","$customerAddress",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getCountryId",170],"(",")",",",["T_WHITESPACE","\n                    ",170],["T_VARIABLE","$customerAddress",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getVatId",171],"(",")",["T_WHITESPACE","\n                ",171],")",";",["T_WHITESPACE","\n\n                ",172],["T_VARIABLE","$newGroupId",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$customerHelper",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getCustomerGroupIdBasedOnVatNumber",174],"(",["T_WHITESPACE","\n                    ",174],["T_VARIABLE","$customerAddress",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getCountryId",175],"(",")",",",["T_WHITESPACE"," ",175],["T_VARIABLE","$result",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$customer",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getStore",175],"(",")",["T_WHITESPACE","\n                ",175],")",";",["T_WHITESPACE","\n\n                ",176],["T_IF","if",178],["T_WHITESPACE"," ",178],"(","!",["T_VARIABLE","$customer",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getDisableAutoGroupChange",178],"(",")",["T_WHITESPACE"," ",178],["T_BOOLEAN_AND","&&",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$customer",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getGroupId",178],"(",")",["T_WHITESPACE"," ",178],["T_IS_NOT_EQUAL","!=",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$newGroupId",178],")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n                    ",178],["T_VARIABLE","$customer",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","setGroupId",179],"(",["T_VARIABLE","$newGroupId",179],")",";",["T_WHITESPACE","\n                    ",179],["T_VARIABLE","$customer",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","save",180],"(",")",";",["T_WHITESPACE","\n                ",180],"}",["T_WHITESPACE","\n\n                ",181],["T_IF","if",183],["T_WHITESPACE"," ",183],"(","!",["T_STRING","Mage",183],["T_DOUBLE_COLON","::",183],["T_STRING","app",183],"(",")",["T_OBJECT_OPERATOR","->",183],["T_STRING","getStore",183],"(",")",["T_OBJECT_OPERATOR","->",183],["T_STRING","isAdmin",183],"(",")",")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n                    ",183],["T_VARIABLE","$validationMessage",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_STRING","Mage",184],["T_DOUBLE_COLON","::",184],["T_STRING","helper",184],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",184],")",["T_OBJECT_OPERATOR","->",184],["T_STRING","getVatValidationUserMessage",184],"(",["T_VARIABLE","$customerAddress",184],",",["T_WHITESPACE","\n                        ",184],["T_VARIABLE","$customer",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getDisableAutoGroupChange",185],"(",")",",",["T_WHITESPACE"," ",185],["T_VARIABLE","$result",185],")",";",["T_WHITESPACE","\n\n                    ",185],["T_IF","if",187],["T_WHITESPACE"," ",187],"(","!",["T_VARIABLE","$validationMessage",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getIsError",187],"(",")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                        ",187],["T_STRING","Mage",188],["T_DOUBLE_COLON","::",188],["T_STRING","getSingleton",188],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",188],")",["T_OBJECT_OPERATOR","->",188],["T_STRING","addSuccess",188],"(",["T_VARIABLE","$validationMessage",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getMessage",188],"(",")",")",";",["T_WHITESPACE","\n                    ",188],"}",["T_WHITESPACE"," ",189],["T_ELSE","else",189],["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n                        ",189],["T_STRING","Mage",190],["T_DOUBLE_COLON","::",190],["T_STRING","getSingleton",190],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/session'",190],")",["T_OBJECT_OPERATOR","->",190],["T_STRING","addError",190],"(",["T_VARIABLE","$validationMessage",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getMessage",190],"(",")",")",";",["T_WHITESPACE","\n                    ",190],"}",["T_WHITESPACE","\n                ",191],"}",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE"," ",194],["T_CATCH","catch",194],["T_WHITESPACE"," ",194],"(",["T_STRING","Exception",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$e",194],")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_STRING","Mage",195],["T_DOUBLE_COLON","::",195],["T_STRING","register",195],"(",["T_STRING","self",195],["T_DOUBLE_COLON","::",195],["T_STRING","VIV_PROCESSED_FLAG",195],",",["T_WHITESPACE"," ",195],["T_STRING","false",195],",",["T_WHITESPACE"," ",195],["T_STRING","true",195],")",";",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n\n    ",197],["T_DOC_COMMENT","\/**\n     * Revert emulated customer group_id\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",199],["T_WHITESPACE","\n    ",203],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","quoteSubmitAfter",204],"(",["T_VARIABLE","$observer",204],")",["T_WHITESPACE","\n    ",204],"{",["T_WHITESPACE","\n        ",205],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",206],["T_WHITESPACE","\n        ",206],["T_VARIABLE","$customer",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$observer",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getQuote",207],"(",")",["T_OBJECT_OPERATOR","->",207],["T_STRING","getCustomer",207],"(",")",";",["T_WHITESPACE","\n\n        ",207],["T_IF","if",209],["T_WHITESPACE"," ",209],"(","!",["T_STRING","Mage",209],["T_DOUBLE_COLON","::",209],["T_STRING","helper",209],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/address'",209],")",["T_OBJECT_OPERATOR","->",209],["T_STRING","isVatValidationEnabled",209],"(",["T_VARIABLE","$customer",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getStore",209],"(",")",")",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n            ",209],["T_RETURN","return",210],";",["T_WHITESPACE","\n        ",210],"}",["T_WHITESPACE","\n\n        ",211],["T_IF","if",213],["T_WHITESPACE"," ",213],"(","!",["T_VARIABLE","$customer",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","getId",213],"(",")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_RETURN","return",214],";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n\n        ",215],["T_VARIABLE","$customer",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","setGroupId",217],"(",["T_WHITESPACE","\n            ",217],["T_VARIABLE","$customer",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getOrigData",218],"(",["T_CONSTANT_ENCAPSED_STRING","'group_id'",218],")",["T_WHITESPACE","\n        ",218],")",";",["T_WHITESPACE","\n        ",219],["T_VARIABLE","$customer",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","save",220],"(",")",";",["T_WHITESPACE","\n    ",220],"}",["T_WHITESPACE","\n\n    ",221],["T_DOC_COMMENT","\/**\n     * Clear customer flow password table\n     *\n     *\/",223],["T_WHITESPACE","\n    ",226],["T_PUBLIC","public",227],["T_WHITESPACE"," ",227],["T_FUNCTION","function",227],["T_WHITESPACE"," ",227],["T_STRING","deleteCustomerFlowPassword",227],"(",")",["T_WHITESPACE","\n    ",227],"{",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$connection",229],["T_WHITESPACE"," ",229],"=",["T_WHITESPACE"," ",229],["T_STRING","Mage",229],["T_DOUBLE_COLON","::",229],["T_STRING","getSingleton",229],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource'",229],")",["T_OBJECT_OPERATOR","->",229],["T_STRING","getConnection",229],"(",["T_CONSTANT_ENCAPSED_STRING","'write'",229],")",";",["T_WHITESPACE","\n        ",229],["T_VARIABLE","$condition",230],["T_WHITESPACE","  ",230],"=",["T_WHITESPACE"," ",230],["T_ARRAY","array",230],"(",["T_CONSTANT_ENCAPSED_STRING","'requested_date < ?'",230],["T_WHITESPACE"," ",230],["T_DOUBLE_ARROW","=>",230],["T_WHITESPACE"," ",230],["T_STRING","Mage",230],["T_DOUBLE_COLON","::",230],["T_STRING","getModel",230],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/date'",230],")",["T_OBJECT_OPERATOR","->",230],["T_STRING","date",230],"(",["T_STRING","null",230],",",["T_WHITESPACE"," ",230],["T_CONSTANT_ENCAPSED_STRING","'-1 day'",230],")",")",";",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$connection",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","delete",231],"(",["T_VARIABLE","$connection",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getTableName",231],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_flowpassword'",231],")",",",["T_WHITESPACE"," ",231],["T_VARIABLE","$condition",231],")",";",["T_WHITESPACE","\n    ",231],"}",["T_WHITESPACE","\n",232],"}",["T_WHITESPACE","\n",233]]