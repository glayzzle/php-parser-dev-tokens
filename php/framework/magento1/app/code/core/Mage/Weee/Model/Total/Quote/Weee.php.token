[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Weee\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Weee calculation model\n *\n * @category    Mage\n * @package     Mage_Weee\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Weee_Model_Total_Quote_Weee",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Tax_Model_Sales_Total_Quote_Tax",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Weee module helper object\n     *\n     * @var Mage_Weee_Helper_Data\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_helper",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * Store model\n     *\n     * @var Mage_Core_Model_Store\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_store",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Tax configuration object\n     *\n     * @var Mage_Tax_Model_Config\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_config",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Flag which notify what tax amount can be affected by fixed porduct tax\n     *\n     * @var bool\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_isTaxAffected",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Initialize Weee totals collector\n     *\/",64],["T_WHITESPACE","\n    ",66],["T_PUBLIC","public",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","__construct",67],"(",")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","setCode",69],"(",["T_CONSTANT_ENCAPSED_STRING","'weee'",69],")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","_helper",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_STRING","Mage",70],["T_DOUBLE_COLON","::",70],["T_STRING","helper",70],"(",["T_CONSTANT_ENCAPSED_STRING","'weee'",70],")",";",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","_config",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","Mage",71],["T_DOUBLE_COLON","::",71],["T_STRING","getSingleton",71],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/config'",71],")",";",["T_WHITESPACE","\n    ",71],"}",["T_WHITESPACE","\n\n    ",72],["T_DOC_COMMENT","\/**\n     * Collect Weee taxes amount and prepare items prices for taxation and discount\n     *\n     * @param   Mage_Sales_Model_Quote_Address $address\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",74],["T_WHITESPACE","\n    ",79],["T_PUBLIC","public",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","collect",80],"(",["T_STRING","Mage_Sales_Model_Quote_Address",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$address",80],")",["T_WHITESPACE","\n    ",80],"{",["T_WHITESPACE","\n        ",81],["T_STRING","Mage_Sales_Model_Quote_Address_Total_Abstract",82],["T_DOUBLE_COLON","::",82],["T_STRING","collect",82],"(",["T_VARIABLE","$address",82],")",";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","_isTaxAffected",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","false",83],";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$items",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_getAddressItems",84],"(",["T_VARIABLE","$address",84],")",";",["T_WHITESPACE","\n        ",84],["T_IF","if",85],["T_WHITESPACE"," ",85],"(","!",["T_STRING","count",85],"(",["T_VARIABLE","$items",85],")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n\n        ",87],["T_VARIABLE","$address",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","setAppliedTaxesReset",89],"(",["T_STRING","true",89],")",";",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$address",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","setAppliedTaxes",90],"(",["T_ARRAY","array",90],"(",")",")",";",["T_WHITESPACE","\n\n        ",90],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_store",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$address",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getQuote",92],"(",")",["T_OBJECT_OPERATOR","->",92],["T_STRING","getStore",92],"(",")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_helper",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","setStore",93],"(",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_store",93],")",";",["T_WHITESPACE","\n\n        ",93],["T_FOREACH","foreach",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$items",95],["T_WHITESPACE"," ",95],["T_AS","as",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$item",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_IF","if",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$item",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getParentItemId",96],"(",")",")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n                ",96],["T_CONTINUE","continue",97],";",["T_WHITESPACE","\n            ",97],"}",["T_WHITESPACE","\n            ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_resetItemData",99],"(",["T_VARIABLE","$item",99],")",";",["T_WHITESPACE","\n            ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(",["T_VARIABLE","$item",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getHasChildren",100],"(",")",["T_WHITESPACE"," ",100],["T_BOOLEAN_AND","&&",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$item",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","isChildrenCalculated",100],"(",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n                ",100],["T_FOREACH","foreach",101],["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$item",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getChildren",101],"(",")",["T_WHITESPACE"," ",101],["T_AS","as",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$child",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n                    ",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_resetItemData",102],"(",["T_VARIABLE","$child",102],")",";",["T_WHITESPACE","\n                    ",102],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","_process",103],"(",["T_VARIABLE","$address",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$child",103],")",";",["T_WHITESPACE","\n                ",103],"}",["T_WHITESPACE","\n                ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_recalculateParent",105],"(",["T_VARIABLE","$item",105],")",";",["T_WHITESPACE","\n            ",105],"}",["T_WHITESPACE"," ",106],["T_ELSE","else",106],["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n                ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","_process",107],"(",["T_VARIABLE","$address",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$item",107],")",";",["T_WHITESPACE","\n            ",107],"}",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n\n        ",109],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","_isTaxAffected",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$address",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","unsSubtotalInclTax",112],"(",")",";",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$address",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","unsBaseSubtotalInclTax",113],"(",")",";",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n\n        ",114],["T_RETURN","return",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$this",116],";",["T_WHITESPACE","\n    ",116],"}",["T_WHITESPACE","\n\n    ",117],["T_DOC_COMMENT","\/**\n     * Calculate item fixed tax and prepare information for discount and recular taxation\n     *\n     * @param   Mage_Sales_Model_Quote_Address $address\n     * @param   Mage_Sales_Model_Quote_Item_Abstract $item\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",119],["T_WHITESPACE","\n    ",125],["T_PROTECTED","protected",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","_process",126],"(",["T_STRING","Mage_Sales_Model_Quote_Address",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$address",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$item",126],")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(","!",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_helper",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","isEnabled",128],"(",["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_store",128],")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n\n        ",130],["T_VARIABLE","$attributes",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_helper",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getProductWeeeAttributes",132],"(",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$item",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getProduct",133],"(",")",",",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$address",134],",",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$address",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getQuote",135],"(",")",["T_OBJECT_OPERATOR","->",135],["T_STRING","getBillingAddress",135],"(",")",",",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_store",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getWebsiteId",136],"(",")",["T_WHITESPACE","\n        ",136],")",";",["T_WHITESPACE","\n\n        ",137],["T_VARIABLE","$applied",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_ARRAY","array",139],"(",")",";",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$productTaxes",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_ARRAY","array",140],"(",")",";",["T_WHITESPACE","\n\n        ",140],["T_VARIABLE","$totalValue",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_LNUMBER","0",142],";",["T_WHITESPACE","\n        ",142],["T_VARIABLE","$baseTotalValue",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_LNUMBER","0",143],";",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$totalRowValue",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_LNUMBER","0",144],";",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$baseTotalRowValue",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_LNUMBER","0",145],";",["T_WHITESPACE","\n\n        ",145],["T_VARIABLE","$totalExclTaxValue",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_LNUMBER","0",147],";",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$baseTotalExclTaxValue",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_LNUMBER","0",148],";",["T_WHITESPACE","\n        ",148],["T_VARIABLE","$totalExclTaxRowValue",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_LNUMBER","0",149],";",["T_WHITESPACE","\n        ",149],["T_VARIABLE","$baseTotalExclTaxRowValue",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_LNUMBER","0",150],";",["T_WHITESPACE","\n\n        ",150],["T_VARIABLE","$customerRatePercentage",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_customerRatePercent",152],"(",["T_VARIABLE","$address",152],",",["T_VARIABLE","$item",152],")",";",["T_WHITESPACE","\n\n        ",152],["T_FOREACH","foreach",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$attributes",154],["T_WHITESPACE"," ",154],["T_AS","as",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$k",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$attribute",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$baseValue",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_VARIABLE","$attribute",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","getAmount",155],"(",")",";",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$baseValueExclTax",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$baseValue",156],";",["T_WHITESPACE","\n\n            ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$customerRatePercentage",158],["T_WHITESPACE"," ",158],["T_BOOLEAN_AND","&&",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_helper",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","isTaxIncluded",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_store",158],")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n                ",158],["T_COMMENT","\/\/Remove the customer tax. This in general applies to EU scenario\n",159],["T_WHITESPACE","                ",160],["T_VARIABLE","$baseValueExclTax",160],["T_WHITESPACE","\n                        ",160],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_getCalculator",161],"(",")",["T_OBJECT_OPERATOR","->",161],["T_STRING","round",161],"(","(",["T_VARIABLE","$baseValue",161],["T_WHITESPACE"," ",161],"*",["T_WHITESPACE"," ",161],["T_LNUMBER","100",161],")",["T_WHITESPACE"," ",161],"\/",["T_WHITESPACE"," ",161],"(",["T_LNUMBER","100",161],["T_WHITESPACE"," ",161],"+",["T_WHITESPACE"," ",161],["T_VARIABLE","$customerRatePercentage",161],")",")",";",["T_WHITESPACE","\n            ",161],"}",["T_WHITESPACE","\n\n            ",162],["T_VARIABLE","$value",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_store",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","convertPrice",164],"(",["T_VARIABLE","$baseValue",164],")",";",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$rowValue",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$value",165],["T_WHITESPACE"," ",165],"*",["T_WHITESPACE"," ",165],["T_VARIABLE","$item",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getTotalQty",165],"(",")",";",["T_WHITESPACE","\n            ",165],["T_VARIABLE","$baseRowValue",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$baseValue",166],["T_WHITESPACE"," ",166],"*",["T_WHITESPACE"," ",166],["T_VARIABLE","$item",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getTotalQty",166],"(",")",";",["T_WHITESPACE","\n\n            ",166],["T_COMMENT","\/\/Get the values excluding tax\n",168],["T_WHITESPACE","            ",169],["T_VARIABLE","$valueExclTax",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_store",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","convertPrice",169],"(",["T_VARIABLE","$baseValueExclTax",169],")",";",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$rowValueExclTax",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$valueExclTax",170],["T_WHITESPACE"," ",170],"*",["T_WHITESPACE"," ",170],["T_VARIABLE","$item",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getTotalQty",170],"(",")",";",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$baseRowValueExclTax",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_VARIABLE","$baseValueExclTax",171],["T_WHITESPACE"," ",171],"*",["T_WHITESPACE"," ",171],["T_VARIABLE","$item",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","getTotalQty",171],"(",")",";",["T_WHITESPACE","\n\n            ",171],["T_VARIABLE","$title",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$attribute",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getName",173],"(",")",";",["T_WHITESPACE","\n\n            ",173],["T_COMMENT","\/\/Calculate the Wee value\n",175],["T_WHITESPACE","            ",176],["T_VARIABLE","$totalValue",176],["T_WHITESPACE"," ",176],["T_PLUS_EQUAL","+=",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$value",176],";",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$baseTotalValue",177],["T_WHITESPACE"," ",177],["T_PLUS_EQUAL","+=",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$baseValue",177],";",["T_WHITESPACE","\n            ",177],["T_VARIABLE","$totalRowValue",178],["T_WHITESPACE"," ",178],["T_PLUS_EQUAL","+=",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$rowValue",178],";",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$baseTotalRowValue",179],["T_WHITESPACE"," ",179],["T_PLUS_EQUAL","+=",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$baseRowValue",179],";",["T_WHITESPACE","\n\n            ",179],["T_COMMENT","\/\/Calculate the Wee without tax\n",181],["T_WHITESPACE","            ",182],["T_VARIABLE","$totalExclTaxValue",182],["T_WHITESPACE"," ",182],["T_PLUS_EQUAL","+=",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$valueExclTax",182],";",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$baseTotalExclTaxValue",183],["T_WHITESPACE"," ",183],["T_PLUS_EQUAL","+=",183],["T_WHITESPACE"," ",183],["T_VARIABLE","$baseValueExclTax",183],";",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$totalExclTaxRowValue",184],["T_WHITESPACE"," ",184],["T_PLUS_EQUAL","+=",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$rowValueExclTax",184],";",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$baseTotalExclTaxRowValue",185],["T_WHITESPACE"," ",185],["T_PLUS_EQUAL","+=",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$baseRowValueExclTax",185],";",["T_WHITESPACE","\n\n            ",185],["T_COMMENT","\/*\n             * Note: including Tax does not necessarily mean it includes all the tax\n             * *_incl_tax only holds the tax associated with Tax included products\n             *\/",187],["T_WHITESPACE","\n\n            ",190],["T_VARIABLE","$productTaxes",192],"[","]",["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_ARRAY","array",192],"(",["T_WHITESPACE","\n                ",192],["T_CONSTANT_ENCAPSED_STRING","'title'",193],["T_WHITESPACE"," ",193],["T_DOUBLE_ARROW","=>",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$title",193],",",["T_WHITESPACE","\n                ",193],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",194],["T_WHITESPACE"," ",194],["T_DOUBLE_ARROW","=>",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$baseValueExclTax",194],",",["T_WHITESPACE","\n                ",194],["T_CONSTANT_ENCAPSED_STRING","'amount'",195],["T_WHITESPACE"," ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$valueExclTax",195],",",["T_WHITESPACE","\n                ",195],["T_CONSTANT_ENCAPSED_STRING","'row_amount'",196],["T_WHITESPACE"," ",196],["T_DOUBLE_ARROW","=>",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$rowValueExclTax",196],",",["T_WHITESPACE","\n                ",196],["T_CONSTANT_ENCAPSED_STRING","'base_row_amount'",197],["T_WHITESPACE"," ",197],["T_DOUBLE_ARROW","=>",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$baseRowValueExclTax",197],",",["T_WHITESPACE","\n                ",197],["T_DOC_COMMENT","\/**\n                 * Tax value can't be presented as include\/exclude tax\n                 *\/",198],["T_WHITESPACE","\n                ",200],["T_CONSTANT_ENCAPSED_STRING","'base_amount_incl_tax'",201],["T_WHITESPACE"," ",201],["T_DOUBLE_ARROW","=>",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$baseValue",201],",",["T_WHITESPACE","\n                ",201],["T_CONSTANT_ENCAPSED_STRING","'amount_incl_tax'",202],["T_WHITESPACE"," ",202],["T_DOUBLE_ARROW","=>",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$value",202],",",["T_WHITESPACE","\n                ",202],["T_CONSTANT_ENCAPSED_STRING","'row_amount_incl_tax'",203],["T_WHITESPACE"," ",203],["T_DOUBLE_ARROW","=>",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$rowValue",203],",",["T_WHITESPACE","\n                ",203],["T_CONSTANT_ENCAPSED_STRING","'base_row_amount_incl_tax'",204],["T_WHITESPACE"," ",204],["T_DOUBLE_ARROW","=>",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$baseRowValue",204],",",["T_WHITESPACE","\n            ",204],")",";",["T_WHITESPACE","\n\n            ",205],["T_VARIABLE","$applied",207],"[","]",["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_ARRAY","array",207],"(",["T_WHITESPACE","\n                ",207],["T_CONSTANT_ENCAPSED_STRING","'id'",208],["T_WHITESPACE"," ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$attribute",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getCode",208],"(",")",",",["T_WHITESPACE","\n                ",208],["T_CONSTANT_ENCAPSED_STRING","'percent'",209],["T_WHITESPACE"," ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_STRING","null",209],",",["T_WHITESPACE","\n                ",209],["T_CONSTANT_ENCAPSED_STRING","'hidden'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","_helper",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","includeInSubtotal",210],"(",["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","_store",210],")",",",["T_WHITESPACE","\n                ",210],["T_CONSTANT_ENCAPSED_STRING","'rates'",211],["T_WHITESPACE"," ",211],["T_DOUBLE_ARROW","=>",211],["T_WHITESPACE"," ",211],["T_ARRAY","array",211],"(",["T_ARRAY","array",211],"(",["T_WHITESPACE","\n                    ",211],["T_CONSTANT_ENCAPSED_STRING","'base_real_amount'",212],["T_WHITESPACE"," ",212],["T_DOUBLE_ARROW","=>",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$baseRowValue",212],",",["T_WHITESPACE","\n                    ",212],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",213],["T_WHITESPACE"," ",213],["T_DOUBLE_ARROW","=>",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$baseRowValue",213],",",["T_WHITESPACE","\n                    ",213],["T_CONSTANT_ENCAPSED_STRING","'amount'",214],["T_WHITESPACE"," ",214],["T_DOUBLE_ARROW","=>",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$rowValue",214],",",["T_WHITESPACE","\n                    ",214],["T_CONSTANT_ENCAPSED_STRING","'code'",215],["T_WHITESPACE"," ",215],["T_DOUBLE_ARROW","=>",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$attribute",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getCode",215],"(",")",",",["T_WHITESPACE","\n                    ",215],["T_CONSTANT_ENCAPSED_STRING","'title'",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$title",216],",",["T_WHITESPACE","\n                    ",216],["T_CONSTANT_ENCAPSED_STRING","'percent'",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_STRING","null",217],",",["T_WHITESPACE","\n                    ",217],["T_CONSTANT_ENCAPSED_STRING","'position'",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_LNUMBER","1",218],",",["T_WHITESPACE","\n                    ",218],["T_CONSTANT_ENCAPSED_STRING","'priority'",219],["T_WHITESPACE"," ",219],["T_DOUBLE_ARROW","=>",219],["T_WHITESPACE"," ",219],"-",["T_LNUMBER","1000",219],["T_WHITESPACE"," ",219],"+",["T_WHITESPACE"," ",219],["T_VARIABLE","$k",219],",",["T_WHITESPACE","\n                ",219],")",")",["T_WHITESPACE","\n            ",220],")",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE","\n\n        ",222],["T_COMMENT","\/\/We set the TAX exclusive value\n",224],["T_WHITESPACE","        ",225],["T_VARIABLE","$item",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","setWeeeTaxAppliedAmount",225],"(",["T_VARIABLE","$totalExclTaxValue",225],")",";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$item",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","setBaseWeeeTaxAppliedAmount",226],"(",["T_VARIABLE","$baseTotalExclTaxValue",226],")",";",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$item",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","setWeeeTaxAppliedRowAmount",227],"(",["T_VARIABLE","$totalExclTaxRowValue",227],")",";",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$item",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","setBaseWeeeTaxAppliedRowAmount",228],"(",["T_VARIABLE","$baseTotalExclTaxRowValue",228],")",";",["T_WHITESPACE","\n\n        ",228],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","_processTaxSettings",230],"(",["T_VARIABLE","$item",230],",",["T_WHITESPACE"," ",230],["T_VARIABLE","$totalExclTaxValue",230],",",["T_WHITESPACE"," ",230],["T_VARIABLE","$baseTotalExclTaxValue",230],",",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$totalExclTaxRowValue",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$baseTotalExclTaxRowValue",231],")",["T_WHITESPACE","\n            ",231],["T_OBJECT_OPERATOR","->",232],["T_STRING","_processTotalAmount",232],"(",["T_VARIABLE","$address",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$totalExclTaxRowValue",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$baseTotalExclTaxRowValue",232],")",";",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_helper",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","setApplied",234],"(",["T_VARIABLE","$item",234],",",["T_WHITESPACE"," ",234],["T_STRING","array_merge",234],"(",["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_helper",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getApplied",234],"(",["T_VARIABLE","$item",234],")",",",["T_WHITESPACE"," ",234],["T_VARIABLE","$productTaxes",234],")",")",";",["T_WHITESPACE","\n        ",234],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_VARIABLE","$applied",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","_saveAppliedTaxes",236],"(",["T_VARIABLE","$address",236],",",["T_WHITESPACE"," ",236],["T_VARIABLE","$applied",236],",",["T_WHITESPACE","\n                ",236],["T_VARIABLE","$item",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getWeeeTaxAppliedAmount",237],"(",")",",",["T_WHITESPACE","\n                ",237],["T_VARIABLE","$item",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getBaseWeeeTaxAppliedAmount",238],"(",")",",",["T_WHITESPACE","\n                ",238],["T_STRING","null",239],["T_WHITESPACE","\n            ",239],")",";",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n\n    ",242],["T_DOC_COMMENT","\/**\n     * Get the default store rate\n     *\n     * @param Mage_Sales_Model_Quote_Address $address\n     * @param Mage_Sales_Model_Quote_Item_Abstract $item\n     * @return mixed\n     *\/",244],["T_WHITESPACE","\n    ",250],["T_PROTECTED","protected",251],["T_WHITESPACE"," ",251],["T_FUNCTION","function",251],["T_WHITESPACE"," ",251],["T_STRING","_customerRatePercent",251],"(",["T_VARIABLE","$address",251],",",["T_WHITESPACE"," ",251],["T_VARIABLE","$item",251],")",["T_WHITESPACE","\n    ",251],"{",["T_WHITESPACE","\n        ",252],["T_VARIABLE","$taxCalculationModel",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_STRING","Mage",253],["T_DOUBLE_COLON","::",253],["T_STRING","getSingleton",253],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",253],")",";",["T_WHITESPACE","\n\n        ",253],["T_VARIABLE","$request",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$taxCalculationModel",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getRateRequest",255],"(",["T_WHITESPACE","\n            ",255],["T_VARIABLE","$address",256],",",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$address",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","getQuote",257],"(",")",["T_OBJECT_OPERATOR","->",257],["T_STRING","getBillingAddress",257],"(",")",",",["T_WHITESPACE","\n            ",257],["T_VARIABLE","$address",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","getQuote",258],"(",")",["T_OBJECT_OPERATOR","->",258],["T_STRING","getCustomerTaxClassId",258],"(",")",",",["T_WHITESPACE","\n            ",258],["T_VARIABLE","$this",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","_store",259],["T_WHITESPACE","\n        ",259],")",";",["T_WHITESPACE","\n\n        ",260],["T_VARIABLE","$customerRatePercentage",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$taxCalculationModel",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","getRate",262],"(",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$request",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","setProductClassId",263],"(",["T_VARIABLE","$item",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getProduct",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","getTaxClassId",263],"(",")",")",["T_WHITESPACE","\n        ",263],")",";",["T_WHITESPACE","\n        ",264],["T_RETURN","return",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$customerRatePercentage",265],";",["T_WHITESPACE","\n    ",265],"}",["T_WHITESPACE","\n\n    ",266],["T_DOC_COMMENT","\/**\n     * Check if discount should be applied to weee and add weee to discounted price\n     *\n     * @deprecated since 1.8\n     * @param   Mage_Sales_Model_Quote_Item_Abstract $item\n     * @param   float $value\n     * @param   float $baseValue\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",268],["T_WHITESPACE","\n    ",276],["T_PROTECTED","protected",277],["T_WHITESPACE"," ",277],["T_FUNCTION","function",277],["T_WHITESPACE"," ",277],["T_STRING","_processDiscountSettings",277],"(",["T_VARIABLE","$item",277],",",["T_WHITESPACE"," ",277],["T_VARIABLE","$value",277],",",["T_WHITESPACE"," ",277],["T_VARIABLE","$baseValue",277],")",["T_WHITESPACE","\n    ",277],"{",["T_WHITESPACE","\n        ",278],["T_IF","if",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_helper",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","isDiscounted",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","_store",279],")",")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n            ",279],["T_STRING","Mage",280],["T_DOUBLE_COLON","::",280],["T_STRING","helper",280],"(",["T_CONSTANT_ENCAPSED_STRING","'salesrule'",280],")",["T_OBJECT_OPERATOR","->",280],["T_STRING","addItemDiscountPrices",280],"(",["T_VARIABLE","$item",280],",",["T_WHITESPACE"," ",280],["T_VARIABLE","$baseValue",280],",",["T_WHITESPACE"," ",280],["T_VARIABLE","$value",280],")",";",["T_WHITESPACE","\n        ",280],"}",["T_WHITESPACE","\n        ",281],["T_RETURN","return",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],";",["T_WHITESPACE","\n    ",282],"}",["T_WHITESPACE","\n\n    ",283],["T_DOC_COMMENT","\/**\n     * Add extra amount which should be taxable by regular tax\n     *\n     * @param   Mage_Sales_Model_Quote_Item_Abstract $item\n     * @param   float $value\n     * @param   float $baseValue\n     * @param   float $rowValue\n     * @param   float $baseRowValue\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",285],["T_WHITESPACE","\n    ",294],["T_PROTECTED","protected",295],["T_WHITESPACE"," ",295],["T_FUNCTION","function",295],["T_WHITESPACE"," ",295],["T_STRING","_processTaxSettings",295],"(",["T_VARIABLE","$item",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$value",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$baseValue",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$rowValue",295],",",["T_WHITESPACE"," ",295],["T_VARIABLE","$baseRowValue",295],")",["T_WHITESPACE","\n    ",295],"{",["T_WHITESPACE","\n        ",296],["T_IF","if",297],["T_WHITESPACE"," ",297],"(",["T_VARIABLE","$rowValue",297],")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n            ",297],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","_isTaxAffected",298],["T_WHITESPACE"," ",298],"=",["T_WHITESPACE"," ",298],["T_STRING","true",298],";",["T_WHITESPACE","\n            ",298],["T_VARIABLE","$item",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","unsRowTotalInclTax",299],"(",")",["T_WHITESPACE","\n                ",299],["T_OBJECT_OPERATOR","->",300],["T_STRING","unsBaseRowTotalInclTax",300],"(",")",["T_WHITESPACE","\n                ",300],["T_OBJECT_OPERATOR","->",301],["T_STRING","unsPriceInclTax",301],"(",")",["T_WHITESPACE","\n                ",301],["T_OBJECT_OPERATOR","->",302],["T_STRING","unsBasePriceInclTax",302],"(",")",";",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE","\n        ",303],["T_IF","if",304],["T_WHITESPACE"," ",304],"(",["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_helper",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","isTaxable",304],"(",["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","_store",304],")",["T_WHITESPACE","\n            ",304],["T_BOOLEAN_AND","&&",305],["T_WHITESPACE"," ",305],"!",["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_helper",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","isTaxIncluded",305],"(",["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_store",305],")",["T_WHITESPACE"," ",305],["T_BOOLEAN_AND","&&",305],["T_WHITESPACE"," ",305],["T_VARIABLE","$rowValue",305],")",["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n            ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(","!",["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_helper",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","includeInSubtotal",306],"(",["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","_store",306],")",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n                ",306],["T_VARIABLE","$item",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","setExtraTaxableAmount",307],"(",["T_VARIABLE","$value",307],")",["T_WHITESPACE","\n                    ",307],["T_OBJECT_OPERATOR","->",308],["T_STRING","setBaseExtraTaxableAmount",308],"(",["T_VARIABLE","$baseValue",308],")",["T_WHITESPACE","\n                    ",308],["T_OBJECT_OPERATOR","->",309],["T_STRING","setExtraRowTaxableAmount",309],"(",["T_VARIABLE","$rowValue",309],")",["T_WHITESPACE","\n                    ",309],["T_OBJECT_OPERATOR","->",310],["T_STRING","setBaseExtraRowTaxableAmount",310],"(",["T_VARIABLE","$baseRowValue",310],")",";",["T_WHITESPACE","\n            ",310],"}",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n        ",312],["T_RETURN","return",313],["T_WHITESPACE"," ",313],["T_VARIABLE","$this",313],";",["T_WHITESPACE","\n    ",313],"}",["T_WHITESPACE","\n\n    ",314],["T_DOC_COMMENT","\/**\n     * Proces row amount based on FPT total amount configuration setting\n     *\n     * @param   Mage_Sales_Model_Quote_Address $address\n     * @param   float $rowValue\n     * @param   float $baseRowValue\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",316],["T_WHITESPACE","\n    ",323],["T_PROTECTED","protected",324],["T_WHITESPACE"," ",324],["T_FUNCTION","function",324],["T_WHITESPACE"," ",324],["T_STRING","_processTotalAmount",324],"(",["T_VARIABLE","$address",324],",",["T_WHITESPACE"," ",324],["T_VARIABLE","$rowValue",324],",",["T_WHITESPACE"," ",324],["T_VARIABLE","$baseRowValue",324],")",["T_WHITESPACE","\n    ",324],"{",["T_WHITESPACE","\n        ",325],["T_IF","if",326],["T_WHITESPACE"," ",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_helper",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","includeInSubtotal",326],"(",["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","_store",326],")",")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n            ",326],["T_VARIABLE","$address",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","addTotalAmount",327],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",327],",",["T_WHITESPACE"," ",327],["T_VARIABLE","$rowValue",327],")",";",["T_WHITESPACE","\n            ",327],["T_VARIABLE","$address",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","addBaseTotalAmount",328],"(",["T_CONSTANT_ENCAPSED_STRING","'subtotal'",328],",",["T_WHITESPACE"," ",328],["T_VARIABLE","$baseRowValue",328],")",";",["T_WHITESPACE","\n            ",328],["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","_isTaxAffected",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_STRING","true",329],";",["T_WHITESPACE","\n        ",329],"}",["T_WHITESPACE"," ",330],["T_ELSE","else",330],["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n            ",330],["T_VARIABLE","$address",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","setExtraTaxAmount",331],"(",["T_VARIABLE","$address",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getExtraTaxAmount",331],"(",")",["T_WHITESPACE"," ",331],"+",["T_WHITESPACE"," ",331],["T_VARIABLE","$rowValue",331],")",";",["T_WHITESPACE","\n            ",331],["T_VARIABLE","$address",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","setBaseExtraTaxAmount",332],"(",["T_VARIABLE","$address",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getBaseExtraTaxAmount",332],"(",")",["T_WHITESPACE"," ",332],"+",["T_WHITESPACE"," ",332],["T_VARIABLE","$baseRowValue",332],")",";",["T_WHITESPACE","\n        ",332],"}",["T_WHITESPACE","\n        ",333],["T_RETURN","return",334],["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],";",["T_WHITESPACE","\n    ",334],"}",["T_WHITESPACE","\n\n    ",335],["T_DOC_COMMENT","\/**\n     * Recalculate parent item amounts based on children results\n     *\n     * @param   Mage_Sales_Model_Quote_Item_Abstract $item\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",337],["T_WHITESPACE","\n    ",342],["T_PROTECTED","protected",343],["T_WHITESPACE"," ",343],["T_FUNCTION","function",343],["T_WHITESPACE"," ",343],["T_STRING","_recalculateParent",343],"(",["T_STRING","Mage_Sales_Model_Quote_Item_Abstract",343],["T_WHITESPACE"," ",343],["T_VARIABLE","$item",343],")",["T_WHITESPACE","\n    ",343],"{",["T_WHITESPACE","\n\n    ",344],"}",["T_WHITESPACE","\n\n    ",346],["T_DOC_COMMENT","\/**\n     * Reset information about FPT for shopping cart item\n     *\n     * @param   Mage_Sales_Model_Quote_Item_Abstract $item\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",348],["T_WHITESPACE","\n    ",353],["T_PROTECTED","protected",354],["T_WHITESPACE"," ",354],["T_FUNCTION","function",354],["T_WHITESPACE"," ",354],["T_STRING","_resetItemData",354],"(",["T_VARIABLE","$item",354],")",["T_WHITESPACE","\n    ",354],"{",["T_WHITESPACE","\n        ",355],["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","_helper",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","setApplied",356],"(",["T_VARIABLE","$item",356],",",["T_WHITESPACE"," ",356],["T_ARRAY","array",356],"(",")",")",";",["T_WHITESPACE","\n\n        ",356],["T_VARIABLE","$item",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","setBaseWeeeTaxDisposition",358],"(",["T_LNUMBER","0",358],")",";",["T_WHITESPACE","\n        ",358],["T_VARIABLE","$item",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","setWeeeTaxDisposition",359],"(",["T_LNUMBER","0",359],")",";",["T_WHITESPACE","\n\n        ",359],["T_VARIABLE","$item",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","setBaseWeeeTaxRowDisposition",361],"(",["T_LNUMBER","0",361],")",";",["T_WHITESPACE","\n        ",361],["T_VARIABLE","$item",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","setWeeeTaxRowDisposition",362],"(",["T_LNUMBER","0",362],")",";",["T_WHITESPACE","\n\n        ",362],["T_VARIABLE","$item",364],["T_OBJECT_OPERATOR","->",364],["T_STRING","setBaseWeeeTaxAppliedAmount",364],"(",["T_LNUMBER","0",364],")",";",["T_WHITESPACE","\n        ",364],["T_VARIABLE","$item",365],["T_OBJECT_OPERATOR","->",365],["T_STRING","setBaseWeeeTaxAppliedRowAmount",365],"(",["T_LNUMBER","0",365],")",";",["T_WHITESPACE","\n\n        ",365],["T_VARIABLE","$item",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","setWeeeTaxAppliedAmount",367],"(",["T_LNUMBER","0",367],")",";",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$item",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","setWeeeTaxAppliedRowAmount",368],"(",["T_LNUMBER","0",368],")",";",["T_WHITESPACE","\n    ",368],"}",["T_WHITESPACE","\n\n    ",369],["T_DOC_COMMENT","\/**\n     * Fetch FPT data to address object for display in totals block\n     *\n     * @param   Mage_Sales_Model_Quote_Address $address\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",371],["T_WHITESPACE","\n    ",376],["T_PUBLIC","public",377],["T_WHITESPACE"," ",377],["T_FUNCTION","function",377],["T_WHITESPACE"," ",377],["T_STRING","fetch",377],"(",["T_STRING","Mage_Sales_Model_Quote_Address",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$address",377],")",["T_WHITESPACE","\n    ",377],"{",["T_WHITESPACE","\n        ",378],["T_RETURN","return",379],["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],";",["T_WHITESPACE","\n    ",379],"}",["T_WHITESPACE","\n\n    ",380],["T_DOC_COMMENT","\/**\n     * Process model configuration array.\n     * This method can be used for changing totals collect sort order\n     *\n     * @param   array $config\n     * @param   store $store\n     * @return  array\n     *\/",382],["T_WHITESPACE","\n    ",389],["T_PUBLIC","public",390],["T_WHITESPACE"," ",390],["T_FUNCTION","function",390],["T_WHITESPACE"," ",390],["T_STRING","processConfigArray",390],"(",["T_VARIABLE","$config",390],",",["T_WHITESPACE"," ",390],["T_VARIABLE","$store",390],")",["T_WHITESPACE","\n    ",390],"{",["T_WHITESPACE","\n        ",391],["T_RETURN","return",392],["T_WHITESPACE"," ",392],["T_VARIABLE","$config",392],";",["T_WHITESPACE","\n    ",392],"}",["T_WHITESPACE","\n\n    ",393],["T_DOC_COMMENT","\/**\n     * Process item fixed taxes\n     *\n     * @deprecated since 1.3.2.3\n     * @param   Mage_Sales_Model_Quote_Address $address\n     * @param   Mage_Sales_Model_Quote_Item_Abstract $item\n     * @param   bool $updateParent\n     * @return  Mage_Weee_Model_Total_Quote_Weee\n     *\/",395],["T_WHITESPACE","\n    ",403],["T_PROTECTED","protected",404],["T_WHITESPACE"," ",404],["T_FUNCTION","function",404],["T_WHITESPACE"," ",404],["T_STRING","_processItem",404],"(",["T_STRING","Mage_Sales_Model_Quote_Address",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$address",404],",",["T_WHITESPACE"," ",404],["T_VARIABLE","$item",404],",",["T_WHITESPACE"," ",404],["T_VARIABLE","$updateParent",404],["T_WHITESPACE"," ",404],"=",["T_WHITESPACE"," ",404],["T_STRING","false",404],")",["T_WHITESPACE","\n    ",404],"{",["T_WHITESPACE","\n        ",405],["T_VARIABLE","$store",406],["T_WHITESPACE"," ",406],"=",["T_WHITESPACE"," ",406],["T_VARIABLE","$address",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","getQuote",406],"(",")",["T_OBJECT_OPERATOR","->",406],["T_STRING","getStore",406],"(",")",";",["T_WHITESPACE","\n        ",406],["T_IF","if",407],["T_WHITESPACE"," ",407],"(","!",["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","_helper",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","isEnabled",407],"(",["T_VARIABLE","$store",407],")",")",["T_WHITESPACE"," ",407],"{",["T_WHITESPACE","\n            ",407],["T_RETURN","return",408],["T_WHITESPACE"," ",408],["T_VARIABLE","$this",408],";",["T_WHITESPACE","\n        ",408],"}",["T_WHITESPACE","\n        ",409],["T_VARIABLE","$custTaxClassId",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$address",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getQuote",410],"(",")",["T_OBJECT_OPERATOR","->",410],["T_STRING","getCustomerTaxClassId",410],"(",")",";",["T_WHITESPACE","\n\n        ",410],["T_VARIABLE","$taxCalculationModel",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_STRING","Mage",412],["T_DOUBLE_COLON","::",412],["T_STRING","getSingleton",412],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",412],")",";",["T_WHITESPACE","\n        ",412],["T_COMMENT","\/* @var $taxCalculationModel Mage_Tax_Model_Calculation *\/",413],["T_WHITESPACE","\n        ",413],["T_VARIABLE","$request",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_VARIABLE","$taxCalculationModel",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getRateRequest",414],"(",["T_WHITESPACE","\n            ",414],["T_VARIABLE","$address",415],",",["T_WHITESPACE","\n            ",415],["T_VARIABLE","$address",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getQuote",416],"(",")",["T_OBJECT_OPERATOR","->",416],["T_STRING","getBillingAddress",416],"(",")",",",["T_WHITESPACE","\n            ",416],["T_VARIABLE","$custTaxClassId",417],",",["T_WHITESPACE","\n            ",417],["T_VARIABLE","$store",418],["T_WHITESPACE","\n        ",418],")",";",["T_WHITESPACE","\n        ",419],["T_VARIABLE","$defaultRateRequest",420],["T_WHITESPACE"," ",420],"=",["T_WHITESPACE"," ",420],["T_VARIABLE","$taxCalculationModel",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getDefaultRateRequest",420],"(",["T_VARIABLE","$store",420],")",";",["T_WHITESPACE","\n\n        ",420],["T_VARIABLE","$attributes",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","_helper",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getProductWeeeAttributes",422],"(",["T_WHITESPACE","\n            ",422],["T_VARIABLE","$item",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getProduct",423],"(",")",",",["T_WHITESPACE","\n            ",423],["T_VARIABLE","$address",424],",",["T_WHITESPACE","\n            ",424],["T_VARIABLE","$address",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","getQuote",425],"(",")",["T_OBJECT_OPERATOR","->",425],["T_STRING","getBillingAddress",425],"(",")",",",["T_WHITESPACE","\n            ",425],["T_VARIABLE","$store",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","getWebsiteId",426],"(",")",["T_WHITESPACE","\n        ",426],")",";",["T_WHITESPACE","\n\n        ",427],["T_VARIABLE","$applied",429],["T_WHITESPACE"," ",429],"=",["T_WHITESPACE"," ",429],["T_ARRAY","array",429],"(",")",";",["T_WHITESPACE","\n        ",429],["T_VARIABLE","$productTaxes",430],["T_WHITESPACE"," ",430],"=",["T_WHITESPACE"," ",430],["T_ARRAY","array",430],"(",")",";",["T_WHITESPACE","\n\n        ",430],["T_FOREACH","foreach",432],["T_WHITESPACE"," ",432],"(",["T_VARIABLE","$attributes",432],["T_WHITESPACE"," ",432],["T_AS","as",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$k",432],["T_WHITESPACE"," ",432],["T_DOUBLE_ARROW","=>",432],["T_WHITESPACE"," ",432],["T_VARIABLE","$attribute",432],")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n            ",432],["T_VARIABLE","$baseValue",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_VARIABLE","$attribute",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getAmount",433],"(",")",";",["T_WHITESPACE","\n            ",433],["T_VARIABLE","$value",434],["T_WHITESPACE"," ",434],"=",["T_WHITESPACE"," ",434],["T_VARIABLE","$store",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","convertPrice",434],"(",["T_VARIABLE","$baseValue",434],")",";",["T_WHITESPACE","\n\n            ",434],["T_VARIABLE","$rowValue",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$value",436],"*",["T_VARIABLE","$item",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getQty",436],"(",")",";",["T_WHITESPACE","\n            ",436],["T_VARIABLE","$baseRowValue",437],["T_WHITESPACE"," ",437],"=",["T_WHITESPACE"," ",437],["T_VARIABLE","$baseValue",437],"*",["T_VARIABLE","$item",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","getQty",437],"(",")",";",["T_WHITESPACE","\n\n            ",437],["T_VARIABLE","$title",439],["T_WHITESPACE"," ",439],"=",["T_WHITESPACE"," ",439],["T_VARIABLE","$attribute",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getName",439],"(",")",";",["T_WHITESPACE","\n\n            ",439],["T_DOC_COMMENT","\/**\n             * Apply discount to fixed tax\n             *\/",441],["T_WHITESPACE","\n            ",443],["T_IF","if",444],["T_WHITESPACE"," ",444],"(",["T_VARIABLE","$item",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","getDiscountPercent",444],"(",")",["T_WHITESPACE"," ",444],["T_BOOLEAN_AND","&&",444],["T_WHITESPACE"," ",444],["T_VARIABLE","$this",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","_helper",444],["T_OBJECT_OPERATOR","->",444],["T_STRING","isDiscounted",444],"(",["T_VARIABLE","$store",444],")",")",["T_WHITESPACE"," ",444],"{",["T_WHITESPACE","\n                ",444],["T_VARIABLE","$valueDiscount",445],["T_WHITESPACE"," ",445],"=",["T_WHITESPACE"," ",445],["T_VARIABLE","$value",445],"\/",["T_LNUMBER","100",445],"*",["T_VARIABLE","$item",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getDiscountPercent",445],"(",")",";",["T_WHITESPACE","\n                ",445],["T_VARIABLE","$baseValueDiscount",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_VARIABLE","$baseValue",446],"\/",["T_LNUMBER","100",446],"*",["T_VARIABLE","$item",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getDiscountPercent",446],"(",")",";",["T_WHITESPACE","\n\n                ",446],["T_VARIABLE","$rowValueDiscount",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_VARIABLE","$rowValue",448],"\/",["T_LNUMBER","100",448],"*",["T_VARIABLE","$item",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","getDiscountPercent",448],"(",")",";",["T_WHITESPACE","\n                ",448],["T_VARIABLE","$baseRowValueDiscount",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_VARIABLE","$baseRowValue",449],"\/",["T_LNUMBER","100",449],"*",["T_VARIABLE","$item",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","getDiscountPercent",449],"(",")",";",["T_WHITESPACE","\n\n                ",449],["T_VARIABLE","$address",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","setDiscountAmount",451],"(",["T_VARIABLE","$address",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","getDiscountAmount",451],"(",")","+",["T_VARIABLE","$rowValueDiscount",451],")",";",["T_WHITESPACE","\n                ",451],["T_VARIABLE","$address",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","setBaseDiscountAmount",452],"(",["T_VARIABLE","$address",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","getBaseDiscountAmount",452],"(",")","+",["T_VARIABLE","$baseRowValueDiscount",452],")",";",["T_WHITESPACE","\n\n                ",452],["T_VARIABLE","$address",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","setGrandTotal",454],"(",["T_VARIABLE","$address",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","getGrandTotal",454],"(",")",["T_WHITESPACE"," ",454],"-",["T_WHITESPACE"," ",454],["T_VARIABLE","$rowValueDiscount",454],")",";",["T_WHITESPACE","\n                ",454],["T_VARIABLE","$address",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","setBaseGrandTotal",455],"(",["T_VARIABLE","$address",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","getBaseGrandTotal",455],"(",")",["T_WHITESPACE"," ",455],"-",["T_WHITESPACE"," ",455],["T_VARIABLE","$baseRowValueDiscount",455],")",";",["T_WHITESPACE","\n            ",455],"}",["T_WHITESPACE","\n\n            ",456],["T_VARIABLE","$oneDisposition",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_VARIABLE","$baseOneDisposition",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_VARIABLE","$disposition",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_VARIABLE","$baseDisposition",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_LNUMBER","0",458],";",["T_WHITESPACE","\n\n            ",458],["T_DOC_COMMENT","\/**\n             * Apply tax percent to fixed tax\n             *\/",460],["T_WHITESPACE","\n            ",462],["T_IF","if",463],["T_WHITESPACE"," ",463],"(",["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","_helper",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","isTaxable",463],"(",["T_VARIABLE","$store",463],")",")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n                ",463],["T_VARIABLE","$currentPercent",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$item",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","getTaxPercent",464],"(",")",";",["T_WHITESPACE","\n                ",464],["T_VARIABLE","$defaultPercent",465],["T_WHITESPACE"," ",465],"=",["T_WHITESPACE"," ",465],["T_VARIABLE","$taxCalculationModel",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","getRate",465],"(",["T_WHITESPACE","\n                    ",465],["T_VARIABLE","$defaultRateRequest",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","setProductClassId",466],"(",["T_VARIABLE","$item",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","getProduct",466],"(",")",["T_OBJECT_OPERATOR","->",466],["T_STRING","getTaxClassId",466],"(",")",")",["T_WHITESPACE","\n                ",466],")",";",["T_WHITESPACE","\n\n                ",467],["T_VARIABLE","$valueBeforeVAT",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$rowValue",469],";",["T_WHITESPACE","\n                ",469],["T_VARIABLE","$baseValueBeforeVAT",470],["T_WHITESPACE"," ",470],"=",["T_WHITESPACE"," ",470],["T_VARIABLE","$baseRowValue",470],";",["T_WHITESPACE","\n\n                ",470],["T_VARIABLE","$oneDisposition",472],["T_WHITESPACE"," ",472],"=",["T_WHITESPACE"," ",472],["T_VARIABLE","$store",472],["T_OBJECT_OPERATOR","->",472],["T_STRING","roundPrice",472],"(",["T_VARIABLE","$value",472],"\/","(",["T_LNUMBER","100",472],"+",["T_VARIABLE","$defaultPercent",472],")","*",["T_VARIABLE","$currentPercent",472],")",";",["T_WHITESPACE","\n                ",472],["T_VARIABLE","$baseOneDisposition",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_VARIABLE","$store",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","roundPrice",473],"(",["T_VARIABLE","$baseValue",473],"\/","(",["T_LNUMBER","100",473],"+",["T_VARIABLE","$defaultPercent",473],")","*",["T_VARIABLE","$currentPercent",473],")",";",["T_WHITESPACE","\n\n                ",473],["T_VARIABLE","$disposition",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_VARIABLE","$store",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","roundPrice",475],"(",["T_VARIABLE","$rowValue",475],"\/","(",["T_LNUMBER","100",475],"+",["T_VARIABLE","$defaultPercent",475],")","*",["T_VARIABLE","$currentPercent",475],")",";",["T_WHITESPACE","\n                ",475],["T_VARIABLE","$baseDisposition",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_VARIABLE","$store",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","roundPrice",476],"(",["T_VARIABLE","$baseRowValue",476],"\/","(",["T_LNUMBER","100",476],"+",["T_VARIABLE","$defaultPercent",476],")","*",["T_VARIABLE","$currentPercent",476],")",";",["T_WHITESPACE","\n\n                ",476],["T_VARIABLE","$item",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","setBaseTaxAmount",478],"(",["T_VARIABLE","$item",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getBaseTaxAmount",478],"(",")","+",["T_VARIABLE","$baseDisposition",478],")",";",["T_WHITESPACE","\n                ",478],["T_VARIABLE","$item",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","setTaxAmount",479],"(",["T_VARIABLE","$item",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getTaxAmount",479],"(",")","+",["T_VARIABLE","$disposition",479],")",";",["T_WHITESPACE","\n\n                ",479],["T_VARIABLE","$value",481],["T_WHITESPACE"," ",481],["T_MINUS_EQUAL","-=",481],["T_WHITESPACE"," ",481],["T_VARIABLE","$oneDisposition",481],";",["T_WHITESPACE","\n                ",481],["T_VARIABLE","$baseValue",482],["T_WHITESPACE"," ",482],["T_MINUS_EQUAL","-=",482],["T_WHITESPACE"," ",482],["T_VARIABLE","$baseOneDisposition",482],";",["T_WHITESPACE","\n\n                ",482],["T_VARIABLE","$rowValue",484],["T_WHITESPACE"," ",484],["T_MINUS_EQUAL","-=",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$baseDisposition",484],";",["T_WHITESPACE","\n                ",484],["T_VARIABLE","$baseRowValue",485],["T_WHITESPACE"," ",485],["T_MINUS_EQUAL","-=",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$disposition",485],";",["T_WHITESPACE","\n\n                ",485],["T_VARIABLE","$item",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","setWeeeTaxDisposition",487],"(",["T_VARIABLE","$item",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","getWeeeTaxDisposition",487],"(",")",["T_WHITESPACE"," ",487],"+",["T_WHITESPACE"," ",487],["T_VARIABLE","$oneDisposition",487],")",";",["T_WHITESPACE","\n                ",487],["T_VARIABLE","$item",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","setBaseWeeeTaxDisposition",488],"(",["T_VARIABLE","$item",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getBaseWeeeTaxDisposition",488],"(",")",["T_WHITESPACE"," ",488],"+",["T_WHITESPACE"," ",488],["T_VARIABLE","$baseOneDisposition",488],")",";",["T_WHITESPACE","\n                ",488],["T_VARIABLE","$item",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","setWeeeTaxRowDisposition",489],"(",["T_VARIABLE","$item",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getWeeeTaxRowDisposition",489],"(",")",["T_WHITESPACE"," ",489],"+",["T_WHITESPACE"," ",489],["T_VARIABLE","$disposition",489],")",";",["T_WHITESPACE","\n                ",489],["T_VARIABLE","$item",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","setBaseWeeeTaxRowDisposition",490],"(",["T_VARIABLE","$item",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","getBaseWeeeTaxRowDisposition",490],"(",")",["T_WHITESPACE"," ",490],"+",["T_WHITESPACE"," ",490],["T_VARIABLE","$baseDisposition",490],")",";",["T_WHITESPACE","\n\n",490],["T_COMMENT","\/\/                $item->setTaxBeforeDiscount($item->getTaxBeforeDiscount() + $disposition);\n",492],["T_COMMENT","\/\/                $item->setBaseTaxBeforeDiscount($item->getBaseTaxBeforeDiscount() + $baseDisposition);\n",493],["T_WHITESPACE","\n                ",494],["T_VARIABLE","$address",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","setTaxAmount",495],"(",["T_VARIABLE","$address",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","getTaxAmount",495],"(",")",["T_WHITESPACE"," ",495],"+",["T_WHITESPACE"," ",495],["T_VARIABLE","$disposition",495],")",";",["T_WHITESPACE","\n                ",495],["T_VARIABLE","$address",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","setBaseTaxAmount",496],"(",["T_VARIABLE","$address",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","getBaseTaxAmount",496],"(",")",["T_WHITESPACE"," ",496],"+",["T_WHITESPACE"," ",496],["T_VARIABLE","$baseDisposition",496],")",";",["T_WHITESPACE","\n\n                ",496],["T_VARIABLE","$rate",498],["T_WHITESPACE"," ",498],"=",["T_WHITESPACE"," ",498],["T_VARIABLE","$taxCalculationModel",498],["T_OBJECT_OPERATOR","->",498],["T_STRING","getRate",498],"(",["T_WHITESPACE","\n                    ",498],["T_VARIABLE","$request",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","setProductClassId",499],"(",["T_VARIABLE","$item",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","getProduct",499],"(",")",["T_OBJECT_OPERATOR","->",499],["T_STRING","getTaxClassId",499],"(",")",")",["T_WHITESPACE","\n                ",499],")",";",["T_WHITESPACE","\n\n                ",500],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","_saveAppliedTaxes",502],"(",["T_WHITESPACE","\n                   ",502],["T_VARIABLE","$address",503],",",["T_WHITESPACE","\n                   ",503],["T_VARIABLE","$taxCalculationModel",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","getAppliedRates",504],"(",["T_VARIABLE","$request",504],")",",",["T_WHITESPACE","\n                   ",504],["T_VARIABLE","$store",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","roundPrice",505],"(",["T_VARIABLE","$valueBeforeVAT",505],"-",["T_VARIABLE","$rowValue",505],")",",",["T_WHITESPACE","\n                   ",505],["T_VARIABLE","$store",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","roundPrice",506],"(",["T_VARIABLE","$baseValueBeforeVAT",506],"-",["T_VARIABLE","$baseRowValue",506],")",",",["T_WHITESPACE","\n                   ",506],["T_VARIABLE","$rate",507],["T_WHITESPACE","\n                ",507],")",";",["T_WHITESPACE","\n\n                ",508],["T_VARIABLE","$address",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","setGrandTotal",510],"(",["T_WHITESPACE","\n                    ",510],["T_VARIABLE","$address",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","getGrandTotal",511],"(",")",["T_WHITESPACE"," ",511],"+",["T_WHITESPACE"," ",511],["T_VARIABLE","$store",511],["T_OBJECT_OPERATOR","->",511],["T_STRING","roundPrice",511],"(",["T_VARIABLE","$valueBeforeVAT",511],["T_WHITESPACE"," ",511],"-",["T_WHITESPACE"," ",511],["T_VARIABLE","$rowValue",511],")",["T_WHITESPACE","\n                ",511],")",";",["T_WHITESPACE","\n                ",512],["T_VARIABLE","$address",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","setBaseGrandTotal",513],"(",["T_WHITESPACE","\n                    ",513],["T_VARIABLE","$address",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","getBaseGrandTotal",514],"(",")",["T_WHITESPACE"," ",514],"+",["T_WHITESPACE"," ",514],["T_VARIABLE","$store",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","roundPrice",514],"(",["T_VARIABLE","$baseValueBeforeVAT",514],["T_WHITESPACE"," ",514],"-",["T_WHITESPACE"," ",514],["T_VARIABLE","$baseRowValue",514],")",["T_WHITESPACE","\n                ",514],")",";",["T_WHITESPACE","\n            ",515],"}",["T_WHITESPACE","\n\n            ",516],["T_DOC_COMMENT","\/**\n             * Check if need include fixed tax amount to subtotal\n             *\/",518],["T_WHITESPACE","\n            ",520],["T_IF","if",521],["T_WHITESPACE"," ",521],"(",["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","_helper",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","includeInSubtotal",521],"(",["T_VARIABLE","$store",521],")",")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n                ",521],["T_VARIABLE","$address",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","setSubtotal",522],"(",["T_VARIABLE","$address",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getSubtotal",522],"(",")",["T_WHITESPACE"," ",522],"+",["T_WHITESPACE"," ",522],["T_VARIABLE","$rowValue",522],")",";",["T_WHITESPACE","\n                ",522],["T_VARIABLE","$address",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","setBaseSubtotal",523],"(",["T_VARIABLE","$address",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","getBaseSubtotal",523],"(",")",["T_WHITESPACE"," ",523],"+",["T_WHITESPACE"," ",523],["T_VARIABLE","$baseRowValue",523],")",";",["T_WHITESPACE","\n\n",523],["T_COMMENT","\/\/                $address->setSubtotalWithDiscount($address->getSubtotalWithDiscount() + $rowValue);\n",525],["T_COMMENT","\/\/                $address->setBaseSubtotalWithDiscount($address->getBaseSubtotalWithDiscount() + $baseRowValue);\n",526],["T_WHITESPACE","            ",527],"}",["T_WHITESPACE"," ",527],["T_ELSE","else",527],["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n                ",527],["T_VARIABLE","$address",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","setTaxAmount",528],"(",["T_VARIABLE","$address",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getTaxAmount",528],"(",")",["T_WHITESPACE"," ",528],"+",["T_WHITESPACE"," ",528],["T_VARIABLE","$rowValue",528],")",";",["T_WHITESPACE","\n                ",528],["T_VARIABLE","$address",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","setBaseTaxAmount",529],"(",["T_VARIABLE","$address",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","getBaseTaxAmount",529],"(",")",["T_WHITESPACE"," ",529],"+",["T_WHITESPACE"," ",529],["T_VARIABLE","$baseRowValue",529],")",";",["T_WHITESPACE","\n            ",529],"}",["T_WHITESPACE","\n\n\n            ",530],["T_VARIABLE","$productTaxes",533],"[","]",["T_WHITESPACE"," ",533],"=",["T_WHITESPACE"," ",533],["T_ARRAY","array",533],"(",["T_WHITESPACE","\n                ",533],["T_CONSTANT_ENCAPSED_STRING","'title'",534],["T_WHITESPACE"," ",534],["T_DOUBLE_ARROW","=>",534],["T_WHITESPACE"," ",534],["T_VARIABLE","$title",534],",",["T_WHITESPACE","\n                ",534],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",535],["T_WHITESPACE"," ",535],["T_DOUBLE_ARROW","=>",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$baseValue",535],",",["T_WHITESPACE","\n                ",535],["T_CONSTANT_ENCAPSED_STRING","'amount'",536],["T_WHITESPACE"," ",536],["T_DOUBLE_ARROW","=>",536],["T_WHITESPACE"," ",536],["T_VARIABLE","$value",536],",",["T_WHITESPACE","\n\n                ",536],["T_CONSTANT_ENCAPSED_STRING","'row_amount'",538],["T_WHITESPACE"," ",538],["T_DOUBLE_ARROW","=>",538],["T_WHITESPACE"," ",538],["T_VARIABLE","$rowValue",538],",",["T_WHITESPACE","\n                ",538],["T_CONSTANT_ENCAPSED_STRING","'base_row_amount'",539],["T_WHITESPACE"," ",539],["T_DOUBLE_ARROW","=>",539],["T_WHITESPACE"," ",539],["T_VARIABLE","$baseRowValue",539],",",["T_WHITESPACE","\n\n                ",539],["T_CONSTANT_ENCAPSED_STRING","'base_amount_incl_tax'",541],["T_WHITESPACE"," ",541],["T_DOUBLE_ARROW","=>",541],["T_WHITESPACE"," ",541],["T_VARIABLE","$baseValue",541],"+",["T_VARIABLE","$baseOneDisposition",541],",",["T_WHITESPACE","\n                ",541],["T_CONSTANT_ENCAPSED_STRING","'amount_incl_tax'",542],["T_WHITESPACE"," ",542],["T_DOUBLE_ARROW","=>",542],["T_WHITESPACE"," ",542],["T_VARIABLE","$value",542],"+",["T_VARIABLE","$oneDisposition",542],",",["T_WHITESPACE","\n\n                ",542],["T_CONSTANT_ENCAPSED_STRING","'row_amount_incl_tax'",544],["T_WHITESPACE"," ",544],["T_DOUBLE_ARROW","=>",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$rowValue",544],"+",["T_VARIABLE","$disposition",544],",",["T_WHITESPACE","\n                ",544],["T_CONSTANT_ENCAPSED_STRING","'base_row_amount_incl_tax'",545],["T_WHITESPACE"," ",545],["T_DOUBLE_ARROW","=>",545],["T_WHITESPACE"," ",545],["T_VARIABLE","$baseRowValue",545],"+",["T_VARIABLE","$baseDisposition",545],",",["T_WHITESPACE","\n            ",545],")",";",["T_WHITESPACE","\n\n            ",546],["T_VARIABLE","$applied",548],"[","]",["T_WHITESPACE"," ",548],"=",["T_WHITESPACE"," ",548],["T_ARRAY","array",548],"(",["T_WHITESPACE","\n                ",548],["T_CONSTANT_ENCAPSED_STRING","'id'",549],["T_WHITESPACE"," ",549],["T_DOUBLE_ARROW","=>",549],["T_WHITESPACE"," ",549],["T_VARIABLE","$attribute",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","getCode",549],"(",")",",",["T_WHITESPACE","\n                ",549],["T_CONSTANT_ENCAPSED_STRING","'percent'",550],["T_WHITESPACE"," ",550],["T_DOUBLE_ARROW","=>",550],["T_WHITESPACE"," ",550],["T_STRING","null",550],",",["T_WHITESPACE","\n                ",550],["T_CONSTANT_ENCAPSED_STRING","'hidden'",551],["T_WHITESPACE"," ",551],["T_DOUBLE_ARROW","=>",551],["T_WHITESPACE"," ",551],["T_VARIABLE","$this",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","_helper",551],["T_OBJECT_OPERATOR","->",551],["T_STRING","includeInSubtotal",551],"(",["T_VARIABLE","$store",551],")",",",["T_WHITESPACE","\n                ",551],["T_CONSTANT_ENCAPSED_STRING","'rates'",552],["T_WHITESPACE"," ",552],["T_DOUBLE_ARROW","=>",552],["T_WHITESPACE"," ",552],["T_ARRAY","array",552],"(",["T_ARRAY","array",552],"(",["T_WHITESPACE","\n                    ",552],["T_CONSTANT_ENCAPSED_STRING","'amount'",553],["T_WHITESPACE"," ",553],["T_DOUBLE_ARROW","=>",553],["T_WHITESPACE"," ",553],["T_VARIABLE","$rowValue",553],",",["T_WHITESPACE","\n                    ",553],["T_CONSTANT_ENCAPSED_STRING","'base_amount'",554],["T_WHITESPACE"," ",554],["T_DOUBLE_ARROW","=>",554],["T_WHITESPACE"," ",554],["T_VARIABLE","$baseRowValue",554],",",["T_WHITESPACE","\n                    ",554],["T_CONSTANT_ENCAPSED_STRING","'base_real_amount'",555],["T_WHITESPACE"," ",555],["T_DOUBLE_ARROW","=>",555],["T_WHITESPACE"," ",555],["T_VARIABLE","$baseRowValue",555],",",["T_WHITESPACE","\n                    ",555],["T_CONSTANT_ENCAPSED_STRING","'code'",556],["T_WHITESPACE"," ",556],["T_DOUBLE_ARROW","=>",556],["T_WHITESPACE"," ",556],["T_VARIABLE","$attribute",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","getCode",556],"(",")",",",["T_WHITESPACE","\n                    ",556],["T_CONSTANT_ENCAPSED_STRING","'title'",557],["T_WHITESPACE"," ",557],["T_DOUBLE_ARROW","=>",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$title",557],",",["T_WHITESPACE","\n                    ",557],["T_CONSTANT_ENCAPSED_STRING","'percent'",558],["T_WHITESPACE"," ",558],["T_DOUBLE_ARROW","=>",558],["T_WHITESPACE"," ",558],["T_STRING","null",558],",",["T_WHITESPACE","\n                    ",558],["T_CONSTANT_ENCAPSED_STRING","'position'",559],["T_WHITESPACE"," ",559],["T_DOUBLE_ARROW","=>",559],["T_WHITESPACE"," ",559],["T_LNUMBER","1",559],",",["T_WHITESPACE","\n                    ",559],["T_CONSTANT_ENCAPSED_STRING","'priority'",560],["T_WHITESPACE"," ",560],["T_DOUBLE_ARROW","=>",560],["T_WHITESPACE"," ",560],"-",["T_LNUMBER","1000",560],["T_WHITESPACE"," ",560],"+",["T_WHITESPACE"," ",560],["T_VARIABLE","$k",560],",",["T_WHITESPACE","\n                ",560],")",")",["T_WHITESPACE","\n            ",561],")",";",["T_WHITESPACE","\n\n            ",562],["T_VARIABLE","$item",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","setBaseWeeeTaxAppliedAmount",564],"(",["T_VARIABLE","$item",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","getBaseWeeeTaxAppliedAmount",564],"(",")",["T_WHITESPACE"," ",564],"+",["T_WHITESPACE"," ",564],["T_VARIABLE","$baseValue",564],")",";",["T_WHITESPACE","\n            ",564],["T_VARIABLE","$item",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","setBaseWeeeTaxAppliedRowAmount",565],"(",["T_VARIABLE","$item",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","getBaseWeeeTaxAppliedRowAmount",565],"(",")",["T_WHITESPACE"," ",565],"+",["T_WHITESPACE"," ",565],["T_VARIABLE","$baseRowValue",565],")",";",["T_WHITESPACE","\n\n            ",565],["T_VARIABLE","$item",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","setWeeeTaxAppliedAmount",567],"(",["T_VARIABLE","$item",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","getWeeeTaxAppliedAmount",567],"(",")",["T_WHITESPACE"," ",567],"+",["T_WHITESPACE"," ",567],["T_VARIABLE","$value",567],")",";",["T_WHITESPACE","\n            ",567],["T_VARIABLE","$item",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","setWeeeTaxAppliedRowAmount",568],"(",["T_VARIABLE","$item",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","getWeeeTaxAppliedRowAmount",568],"(",")",["T_WHITESPACE"," ",568],"+",["T_WHITESPACE"," ",568],["T_VARIABLE","$rowValue",568],")",";",["T_WHITESPACE","\n        ",568],"}",["T_WHITESPACE","\n\n        ",569],["T_VARIABLE","$this",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","_helper",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","setApplied",571],"(",["T_VARIABLE","$item",571],",",["T_WHITESPACE"," ",571],["T_STRING","array_merge",571],"(",["T_VARIABLE","$this",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","_helper",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","getApplied",571],"(",["T_VARIABLE","$item",571],")",",",["T_WHITESPACE"," ",571],["T_VARIABLE","$productTaxes",571],")",")",";",["T_WHITESPACE","\n\n        ",571],["T_IF","if",573],["T_WHITESPACE"," ",573],"(",["T_VARIABLE","$updateParent",573],")",["T_WHITESPACE"," ",573],"{",["T_WHITESPACE","\n            ",573],["T_VARIABLE","$parent",574],["T_WHITESPACE"," ",574],"=",["T_WHITESPACE"," ",574],["T_VARIABLE","$item",574],["T_OBJECT_OPERATOR","->",574],["T_STRING","getParentItem",574],"(",")",";",["T_WHITESPACE","\n\n            ",574],["T_VARIABLE","$parent",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","setBaseWeeeTaxDisposition",576],"(",["T_WHITESPACE","\n                ",576],["T_VARIABLE","$parent",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","getBaseWeeeTaxDisposition",577],"(",")",["T_WHITESPACE"," ",577],"+",["T_WHITESPACE"," ",577],["T_VARIABLE","$item",577],["T_OBJECT_OPERATOR","->",577],["T_STRING","getBaseWeeeTaxDisposition",577],"(",")",["T_WHITESPACE","\n            ",577],")",";",["T_WHITESPACE","\n            ",578],["T_VARIABLE","$parent",579],["T_OBJECT_OPERATOR","->",579],["T_STRING","setWeeeTaxDisposition",579],"(",["T_WHITESPACE","\n                ",579],["T_VARIABLE","$parent",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getWeeeTaxDisposition",580],"(",")",["T_WHITESPACE"," ",580],"+",["T_WHITESPACE"," ",580],["T_VARIABLE","$item",580],["T_OBJECT_OPERATOR","->",580],["T_STRING","getWeeeTaxDisposition",580],"(",")",["T_WHITESPACE","\n            ",580],")",";",["T_WHITESPACE","\n\n            ",581],["T_VARIABLE","$parent",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","setBaseWeeeTaxRowDisposition",583],"(",["T_WHITESPACE","\n                ",583],["T_VARIABLE","$parent",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","getBaseWeeeTaxRowDisposition",584],"(",")",["T_WHITESPACE"," ",584],"+",["T_WHITESPACE"," ",584],["T_VARIABLE","$item",584],["T_OBJECT_OPERATOR","->",584],["T_STRING","getBaseWeeeTaxRowDisposition",584],"(",")",["T_WHITESPACE","\n            ",584],")",";",["T_WHITESPACE","\n            ",585],["T_VARIABLE","$parent",586],["T_OBJECT_OPERATOR","->",586],["T_STRING","setWeeeTaxRowDisposition",586],"(",["T_WHITESPACE","\n                ",586],["T_VARIABLE","$parent",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getWeeeTaxRowDisposition",587],"(",")",["T_WHITESPACE"," ",587],"+",["T_WHITESPACE"," ",587],["T_VARIABLE","$item",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getWeeeTaxRowDisposition",587],"(",")",["T_WHITESPACE","\n            ",587],")",";",["T_WHITESPACE","\n\n            ",588],["T_VARIABLE","$parent",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","setBaseWeeeTaxAppliedAmount",590],"(",["T_WHITESPACE","\n                ",590],["T_VARIABLE","$parent",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","getBaseWeeeTaxAppliedAmount",591],"(",")",["T_WHITESPACE"," ",591],"+",["T_WHITESPACE"," ",591],["T_VARIABLE","$item",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","getBaseWeeeTaxAppliedAmount",591],"(",")",["T_WHITESPACE","\n            ",591],")",";",["T_WHITESPACE","\n            ",592],["T_VARIABLE","$parent",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","setBaseWeeeTaxAppliedRowAmount",593],"(",["T_WHITESPACE","\n                ",593],["T_VARIABLE","$parent",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","getBaseWeeeTaxAppliedRowAmount",594],"(",")",["T_WHITESPACE"," ",594],"+",["T_WHITESPACE"," ",594],["T_VARIABLE","$item",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","getBaseWeeeTaxAppliedRowAmount",594],"(",")",["T_WHITESPACE","\n            ",594],")",";",["T_WHITESPACE","\n\n            ",595],["T_VARIABLE","$parent",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","setWeeeTaxAppliedAmount",597],"(",["T_WHITESPACE","\n                ",597],["T_VARIABLE","$parent",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getWeeeTaxAppliedAmount",598],"(",")",["T_WHITESPACE"," ",598],"+",["T_WHITESPACE"," ",598],["T_VARIABLE","$item",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","getWeeeTaxAppliedAmount",598],"(",")",["T_WHITESPACE","\n            ",598],")",";",["T_WHITESPACE","\n            ",599],["T_VARIABLE","$parent",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","setWeeeTaxAppliedRowAmount",600],"(",["T_WHITESPACE","\n                ",600],["T_VARIABLE","$parent",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","getWeeeTaxAppliedRowAmount",601],"(",")",["T_WHITESPACE"," ",601],"+",["T_WHITESPACE"," ",601],["T_VARIABLE","$item",601],["T_OBJECT_OPERATOR","->",601],["T_STRING","getWeeeTaxAppliedRowAmount",601],"(",")",["T_WHITESPACE","\n            ",601],")",";",["T_WHITESPACE","\n        ",602],"}",["T_WHITESPACE","\n\n        ",603],["T_IF","if",605],["T_WHITESPACE"," ",605],"(",["T_VARIABLE","$applied",605],")",["T_WHITESPACE"," ",605],"{",["T_WHITESPACE","\n            ",605],["T_VARIABLE","$this",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","_saveAppliedTaxes",606],"(",["T_WHITESPACE","\n               ",606],["T_VARIABLE","$address",607],",",["T_WHITESPACE","\n               ",607],["T_VARIABLE","$applied",608],",",["T_WHITESPACE","\n               ",608],["T_VARIABLE","$item",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","getWeeeTaxAppliedAmount",609],"(",")",",",["T_WHITESPACE","\n               ",609],["T_VARIABLE","$item",610],["T_OBJECT_OPERATOR","->",610],["T_STRING","getBaseWeeeTaxAppliedAmount",610],"(",")",",",["T_WHITESPACE","\n               ",610],["T_STRING","null",611],["T_WHITESPACE","\n            ",611],")",";",["T_WHITESPACE","\n        ",612],"}",["T_WHITESPACE","\n    ",613],"}",["T_WHITESPACE","\n\n    ",614],["T_DOC_COMMENT","\/**\n     * Returns the model for calculation\n     *\n     * @return Mage_Tax_Model_Calculation\n     *\/",616],["T_WHITESPACE","\n    ",620],["T_PROTECTED","protected",621],["T_WHITESPACE"," ",621],["T_FUNCTION","function",621],["T_WHITESPACE"," ",621],["T_STRING","_getCalculator",621],"(",")",["T_WHITESPACE","\n    ",621],"{",["T_WHITESPACE","\n        ",622],["T_RETURN","return",623],["T_WHITESPACE"," ",623],["T_STRING","Mage",623],["T_DOUBLE_COLON","::",623],["T_STRING","getSingleton",623],"(",["T_CONSTANT_ENCAPSED_STRING","'tax\/calculation'",623],")",";",["T_WHITESPACE","\n    ",623],"}",["T_WHITESPACE","\n\n    ",624],["T_DOC_COMMENT","\/**\n     * Set the helper object.\n     *\n     * @param Mage_Weee_Helper_Data $helper\n     *\/",626],["T_WHITESPACE","\n    ",630],["T_PUBLIC","public",631],["T_WHITESPACE"," ",631],["T_FUNCTION","function",631],["T_WHITESPACE"," ",631],["T_STRING","setHelper",631],"(",["T_VARIABLE","$helper",631],")",["T_WHITESPACE","\n    ",631],"{",["T_WHITESPACE","\n        ",632],["T_VARIABLE","$this",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","_helper",633],["T_WHITESPACE"," ",633],"=",["T_WHITESPACE"," ",633],["T_VARIABLE","$helper",633],";",["T_WHITESPACE","\n    ",633],"}",["T_WHITESPACE","\n\n\n    ",634],["T_DOC_COMMENT","\/**\n     * Set the store Object\n     *\n     * @param  Mage_Core_Model_Store $store\n     *\/",637],["T_WHITESPACE","\n    ",641],["T_PUBLIC","public",642],["T_WHITESPACE"," ",642],["T_FUNCTION","function",642],["T_WHITESPACE"," ",642],["T_STRING","setStore",642],"(",["T_VARIABLE","$store",642],")",["T_WHITESPACE","\n    ",642],"{",["T_WHITESPACE","\n        ",643],["T_VARIABLE","$this",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","_store",644],["T_WHITESPACE"," ",644],"=",["T_WHITESPACE"," ",644],["T_VARIABLE","$store",644],";",["T_WHITESPACE","\n    ",644],"}",["T_WHITESPACE","\n\n    ",645],["T_DOC_COMMENT","\/**\n     * No aggregated label for fixed product tax\n     *\n     * TODO: fix\n     *\/",647],["T_WHITESPACE","\n    ",651],["T_PUBLIC","public",652],["T_WHITESPACE"," ",652],["T_FUNCTION","function",652],["T_WHITESPACE"," ",652],["T_STRING","getLabel",652],"(",")",["T_WHITESPACE","\n    ",652],"{",["T_WHITESPACE","\n        ",653],["T_RETURN","return",654],["T_WHITESPACE"," ",654],["T_CONSTANT_ENCAPSED_STRING","''",654],";",["T_WHITESPACE","\n    ",654],"}",["T_WHITESPACE","\n",655],"}",["T_WHITESPACE","\n",656]]