[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogInventory\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Stock model\n *\n * @method Mage_CatalogInventory_Model_Resource_Stock _getResource()\n * @method Mage_CatalogInventory_Model_Resource_Stock getResource()\n * @method string getStockName()\n * @method Mage_CatalogInventory_Model_Stock setStockName(string $value)\n *\n * @category    Mage\n * @package     Mage_CatalogInventory\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",38],["T_CLASS","class",39],["T_WHITESPACE"," ",39],["T_STRING","Mage_CatalogInventory_Model_Stock",39],["T_WHITESPACE"," ",39],["T_EXTENDS","extends",39],["T_WHITESPACE"," ",39],["T_STRING","Mage_Core_Model_Abstract",39],["T_WHITESPACE","\n",39],"{",["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","BACKORDERS_NO",41],["T_WHITESPACE","             ",41],"=",["T_WHITESPACE"," ",41],["T_LNUMBER","0",41],";",["T_WHITESPACE","\n    ",41],["T_CONST","const",42],["T_WHITESPACE"," ",42],["T_STRING","BACKORDERS_YES_NONOTIFY",42],["T_WHITESPACE","   ",42],"=",["T_WHITESPACE"," ",42],["T_LNUMBER","1",42],";",["T_WHITESPACE","\n    ",42],["T_CONST","const",43],["T_WHITESPACE"," ",43],["T_STRING","BACKORDERS_YES_NOTIFY",43],["T_WHITESPACE","     ",43],"=",["T_WHITESPACE"," ",43],["T_LNUMBER","2",43],";",["T_WHITESPACE","\n\n    ",43],["T_COMMENT","\/* deprecated *\/",45],["T_WHITESPACE","\n    ",45],["T_CONST","const",46],["T_WHITESPACE"," ",46],["T_STRING","BACKORDERS_BELOW",46],["T_WHITESPACE","          ",46],"=",["T_WHITESPACE"," ",46],["T_LNUMBER","1",46],";",["T_WHITESPACE","\n    ",46],["T_CONST","const",47],["T_WHITESPACE"," ",47],["T_STRING","BACKORDERS_YES",47],["T_WHITESPACE","            ",47],"=",["T_WHITESPACE"," ",47],["T_LNUMBER","2",47],";",["T_WHITESPACE","\n\n    ",47],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","STOCK_OUT_OF_STOCK",49],["T_WHITESPACE","        ",49],"=",["T_WHITESPACE"," ",49],["T_LNUMBER","0",49],";",["T_WHITESPACE","\n    ",49],["T_CONST","const",50],["T_WHITESPACE"," ",50],["T_STRING","STOCK_IN_STOCK",50],["T_WHITESPACE","            ",50],"=",["T_WHITESPACE"," ",50],["T_LNUMBER","1",50],";",["T_WHITESPACE","\n\n    ",50],["T_CONST","const",52],["T_WHITESPACE"," ",52],["T_STRING","DEFAULT_STOCK_ID",52],["T_WHITESPACE","          ",52],"=",["T_WHITESPACE"," ",52],["T_LNUMBER","1",52],";",["T_WHITESPACE","\n\n    ",52],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","_construct",54],"(",")",["T_WHITESPACE","\n    ",54],"{",["T_WHITESPACE","\n        ",55],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","_init",56],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",56],")",";",["T_WHITESPACE","\n    ",56],"}",["T_WHITESPACE","\n\n    ",57],["T_DOC_COMMENT","\/**\n     * Retrieve stock identifier\n     *\n     * @return int\n     *\/",59],["T_WHITESPACE","\n    ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","getId",64],"(",")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_RETURN","return",66],["T_WHITESPACE"," ",66],["T_STRING","self",66],["T_DOUBLE_COLON","::",66],["T_STRING","DEFAULT_STOCK_ID",66],";",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Add stock item objects to products\n     *\n     * @param   collection $products\n     * @return  Mage_CatalogInventory_Model_Stock\n     *\/",69],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","addItemsToProducts",75],"(",["T_VARIABLE","$productCollection",75],")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$items",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getItemCollection",77],"(",")",["T_WHITESPACE","\n            ",77],["T_OBJECT_OPERATOR","->",78],["T_STRING","addProductsFilter",78],"(",["T_VARIABLE","$productCollection",78],")",["T_WHITESPACE","\n            ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","joinStockStatus",79],"(",["T_VARIABLE","$productCollection",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getStoreId",79],"(",")",")",["T_WHITESPACE","\n            ",79],["T_OBJECT_OPERATOR","->",80],["T_STRING","load",80],"(",")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$stockItems",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_ARRAY","array",81],"(",")",";",["T_WHITESPACE","\n        ",81],["T_FOREACH","foreach",82],["T_WHITESPACE"," ",82],"(",["T_VARIABLE","$items",82],["T_WHITESPACE"," ",82],["T_AS","as",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$item",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$stockItems",83],"[",["T_VARIABLE","$item",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getProductId",83],"(",")","]",["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$item",83],";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n        ",84],["T_FOREACH","foreach",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$productCollection",85],["T_WHITESPACE"," ",85],["T_AS","as",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$product",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_IF","if",86],["T_WHITESPACE"," ",86],"(",["T_ISSET","isset",86],"(",["T_VARIABLE","$stockItems",86],"[",["T_VARIABLE","$product",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getId",86],"(",")","]",")",")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n                ",86],["T_VARIABLE","$stockItems",87],"[",["T_VARIABLE","$product",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getId",87],"(",")","]",["T_OBJECT_OPERATOR","->",87],["T_STRING","assignProduct",87],"(",["T_VARIABLE","$product",87],")",";",["T_WHITESPACE","\n            ",87],"}",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Retrieve items collection object with stock filter\n     *\n     * @return unknown\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","getItemCollection",98],"(",")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_STRING","Mage",100],["T_DOUBLE_COLON","::",100],["T_STRING","getResourceModel",100],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item_collection'",100],")",["T_WHITESPACE","\n            ",100],["T_OBJECT_OPERATOR","->",101],["T_STRING","addStockFilter",101],"(",["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getId",101],"(",")",")",";",["T_WHITESPACE","\n    ",101],"}",["T_WHITESPACE","\n\n    ",102],["T_DOC_COMMENT","\/**\n     * Prepare array($productId=>$qty) based on array($productId => array('qty'=>$qty, 'item'=>$stockItem))\n     *\n     * @param array $items\n     *\/",104],["T_WHITESPACE","\n    ",108],["T_PROTECTED","protected",109],["T_WHITESPACE"," ",109],["T_FUNCTION","function",109],["T_WHITESPACE"," ",109],["T_STRING","_prepareProductQtys",109],"(",["T_VARIABLE","$items",109],")",["T_WHITESPACE","\n    ",109],"{",["T_WHITESPACE","\n        ",110],["T_VARIABLE","$qtys",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_ARRAY","array",111],"(",")",";",["T_WHITESPACE","\n        ",111],["T_FOREACH","foreach",112],["T_WHITESPACE"," ",112],"(",["T_VARIABLE","$items",112],["T_WHITESPACE"," ",112],["T_AS","as",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$productId",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$item",112],")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_EMPTY","empty",113],"(",["T_VARIABLE","$item",113],"[",["T_CONSTANT_ENCAPSED_STRING","'item'",113],"]",")",")",["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$stockItem",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING","Mage",114],["T_DOUBLE_COLON","::",114],["T_STRING","getModel",114],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",114],")",["T_OBJECT_OPERATOR","->",114],["T_STRING","loadByProduct",114],"(",["T_VARIABLE","$productId",114],")",";",["T_WHITESPACE","\n            ",114],"}",["T_WHITESPACE"," ",115],["T_ELSE","else",115],["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n                ",115],["T_VARIABLE","$stockItem",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_VARIABLE","$item",116],"[",["T_CONSTANT_ENCAPSED_STRING","'item'",116],"]",";",["T_WHITESPACE","\n            ",116],"}",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$canSubtractQty",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$stockItem",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","getId",118],"(",")",["T_WHITESPACE"," ",118],["T_BOOLEAN_AND","&&",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$stockItem",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","canSubtractQty",118],"(",")",";",["T_WHITESPACE","\n            ",118],["T_IF","if",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$canSubtractQty",119],["T_WHITESPACE"," ",119],["T_BOOLEAN_AND","&&",119],["T_WHITESPACE"," ",119],["T_STRING","Mage",119],["T_DOUBLE_COLON","::",119],["T_STRING","helper",119],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogInventory'",119],")",["T_OBJECT_OPERATOR","->",119],["T_STRING","isQty",119],"(",["T_VARIABLE","$stockItem",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getTypeId",119],"(",")",")",")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n                ",119],["T_VARIABLE","$qtys",120],"[",["T_VARIABLE","$productId",120],"]",["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$item",120],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",120],"]",";",["T_WHITESPACE","\n            ",120],"}",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n        ",122],["T_RETURN","return",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$qtys",123],";",["T_WHITESPACE","\n    ",123],"}",["T_WHITESPACE","\n\n    ",124],["T_DOC_COMMENT","\/**\n     * Subtract product qtys from stock.\n     * Return array of items that require full save\n     *\n     * @param array $items\n     * @return array\n     *\/",126],["T_WHITESPACE","\n    ",132],["T_PUBLIC","public",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","registerProductsSale",133],"(",["T_VARIABLE","$items",133],")",["T_WHITESPACE","\n    ",133],"{",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$qtys",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","_prepareProductQtys",135],"(",["T_VARIABLE","$items",135],")",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$item",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","Mage",136],["T_DOUBLE_COLON","::",136],["T_STRING","getModel",136],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",136],")",";",["T_WHITESPACE","\n        ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_getResource",137],"(",")",["T_OBJECT_OPERATOR","->",137],["T_STRING","beginTransaction",137],"(",")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$stockInfo",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_getResource",138],"(",")",["T_OBJECT_OPERATOR","->",138],["T_STRING","getProductsStock",138],"(",["T_VARIABLE","$this",138],",",["T_WHITESPACE"," ",138],["T_STRING","array_keys",138],"(",["T_VARIABLE","$qtys",138],")",",",["T_WHITESPACE"," ",138],["T_STRING","true",138],")",";",["T_WHITESPACE","\n        ",138],["T_VARIABLE","$fullSaveItems",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_ARRAY","array",139],"(",")",";",["T_WHITESPACE","\n        ",139],["T_FOREACH","foreach",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$stockInfo",140],["T_WHITESPACE"," ",140],["T_AS","as",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$itemInfo",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$item",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","setData",141],"(",["T_VARIABLE","$itemInfo",141],")",";",["T_WHITESPACE","\n            ",141],["T_IF","if",142],["T_WHITESPACE"," ",142],"(","!",["T_VARIABLE","$item",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","checkQty",142],"(",["T_VARIABLE","$qtys",142],"[",["T_VARIABLE","$item",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getProductId",142],"(",")","]",")",")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n                ",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","_getResource",143],"(",")",["T_OBJECT_OPERATOR","->",143],["T_STRING","commit",143],"(",")",";",["T_WHITESPACE","\n                ",143],["T_STRING","Mage",144],["T_DOUBLE_COLON","::",144],["T_STRING","throwException",144],"(",["T_STRING","Mage",144],["T_DOUBLE_COLON","::",144],["T_STRING","helper",144],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",144],")",["T_OBJECT_OPERATOR","->",144],["T_STRING","__",144],"(",["T_CONSTANT_ENCAPSED_STRING","'Not all products are available in the requested quantity'",144],")",")",";",["T_WHITESPACE","\n            ",144],"}",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$item",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","subtractQty",146],"(",["T_VARIABLE","$qtys",146],"[",["T_VARIABLE","$item",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getProductId",146],"(",")","]",")",";",["T_WHITESPACE","\n            ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(","!",["T_VARIABLE","$item",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","verifyStock",147],"(",")",["T_WHITESPACE"," ",147],["T_BOOLEAN_OR","||",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$item",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","verifyNotification",147],"(",")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                ",147],["T_VARIABLE","$fullSaveItems",148],"[","]",["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_CLONE","clone",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$item",148],";",["T_WHITESPACE","\n            ",148],"}",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","_getResource",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","correctItemsQty",151],"(",["T_VARIABLE","$this",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$qtys",151],",",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'-'",151],")",";",["T_WHITESPACE","\n        ",151],["T_VARIABLE","$this",152],["T_OBJECT_OPERATOR","->",152],["T_STRING","_getResource",152],"(",")",["T_OBJECT_OPERATOR","->",152],["T_STRING","commit",152],"(",")",";",["T_WHITESPACE","\n        ",152],["T_RETURN","return",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$fullSaveItems",153],";",["T_WHITESPACE","\n    ",153],"}",["T_WHITESPACE","\n\n    ",154],["T_DOC_COMMENT","\/**\n     *\n     * @param unknown_type $items\n     *\/",156],["T_WHITESPACE","\n    ",159],["T_PUBLIC","public",160],["T_WHITESPACE"," ",160],["T_FUNCTION","function",160],["T_WHITESPACE"," ",160],["T_STRING","revertProductsSale",160],"(",["T_VARIABLE","$items",160],")",["T_WHITESPACE","\n    ",160],"{",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$qtys",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_prepareProductQtys",162],"(",["T_VARIABLE","$items",162],")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_getResource",163],"(",")",["T_OBJECT_OPERATOR","->",163],["T_STRING","correctItemsQty",163],"(",["T_VARIABLE","$this",163],",",["T_WHITESPACE"," ",163],["T_VARIABLE","$qtys",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'+'",163],")",";",["T_WHITESPACE","\n        ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],";",["T_WHITESPACE","\n    ",164],"}",["T_WHITESPACE","\n\n    ",165],["T_DOC_COMMENT","\/**\n     * Subtract ordered qty for product\n     *\n     * @param   Varien_Object $item\n     * @return  Mage_CatalogInventory_Model_Stock\n     *\/",167],["T_WHITESPACE","\n    ",172],["T_PUBLIC","public",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","registerItemSale",173],"(",["T_STRING","Varien_Object",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$item",173],")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$productId",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$item",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getProductId",175],"(",")",";",["T_WHITESPACE","\n        ",175],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_VARIABLE","$productId",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$stockItem",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","Mage",177],["T_DOUBLE_COLON","::",177],["T_STRING","getModel",177],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",177],")",["T_OBJECT_OPERATOR","->",177],["T_STRING","loadByProduct",177],"(",["T_VARIABLE","$productId",177],")",";",["T_WHITESPACE","\n            ",177],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_STRING","Mage",178],["T_DOUBLE_COLON","::",178],["T_STRING","helper",178],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogInventory'",178],")",["T_OBJECT_OPERATOR","->",178],["T_STRING","isQty",178],"(",["T_VARIABLE","$stockItem",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getTypeId",178],"(",")",")",")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n                ",178],["T_IF","if",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$item",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getStoreId",179],"(",")",")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n                    ",179],["T_VARIABLE","$stockItem",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","setStoreId",180],"(",["T_VARIABLE","$item",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getStoreId",180],"(",")",")",";",["T_WHITESPACE","\n                ",180],"}",["T_WHITESPACE","\n                ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(",["T_VARIABLE","$stockItem",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","checkQty",182],"(",["T_VARIABLE","$item",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","getQtyOrdered",182],"(",")",")",["T_WHITESPACE"," ",182],["T_BOOLEAN_OR","||",182],["T_WHITESPACE"," ",182],["T_STRING","Mage",182],["T_DOUBLE_COLON","::",182],["T_STRING","app",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","getStore",182],"(",")",["T_OBJECT_OPERATOR","->",182],["T_STRING","isAdmin",182],"(",")",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n                    ",182],["T_VARIABLE","$stockItem",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","subtractQty",183],"(",["T_VARIABLE","$item",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getQtyOrdered",183],"(",")",")",";",["T_WHITESPACE","\n                    ",183],["T_VARIABLE","$stockItem",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","save",184],"(",")",";",["T_WHITESPACE","\n                ",184],"}",["T_WHITESPACE","\n            ",185],"}",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE","\n        ",187],["T_ELSE","else",188],["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_STRING","Mage",189],["T_DOUBLE_COLON","::",189],["T_STRING","throwException",189],"(",["T_STRING","Mage",189],["T_DOUBLE_COLON","::",189],["T_STRING","helper",189],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",189],")",["T_OBJECT_OPERATOR","->",189],["T_STRING","__",189],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot specify product identifier for the order item.'",189],")",")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n        ",190],["T_RETURN","return",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],";",["T_WHITESPACE","\n    ",191],"}",["T_WHITESPACE","\n\n    ",192],["T_DOC_COMMENT","\/**\n     * Get back to stock (when order is canceled or whatever else)\n     *\n     * @param int $productId\n     * @param numeric $qty\n     * @return Mage_CatalogInventory_Model_Stock\n     *\/",194],["T_WHITESPACE","\n    ",200],["T_PUBLIC","public",201],["T_WHITESPACE"," ",201],["T_FUNCTION","function",201],["T_WHITESPACE"," ",201],["T_STRING","backItemQty",201],"(",["T_VARIABLE","$productId",201],",",["T_WHITESPACE"," ",201],["T_VARIABLE","$qty",201],")",["T_WHITESPACE","\n    ",201],"{",["T_WHITESPACE","\n        ",202],["T_VARIABLE","$stockItem",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_STRING","Mage",203],["T_DOUBLE_COLON","::",203],["T_STRING","getModel",203],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",203],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","loadByProduct",203],"(",["T_VARIABLE","$productId",203],")",";",["T_WHITESPACE","\n        ",203],["T_IF","if",204],["T_WHITESPACE"," ",204],"(",["T_VARIABLE","$stockItem",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getId",204],"(",")",["T_WHITESPACE"," ",204],["T_BOOLEAN_AND","&&",204],["T_WHITESPACE"," ",204],["T_STRING","Mage",204],["T_DOUBLE_COLON","::",204],["T_STRING","helper",204],"(",["T_CONSTANT_ENCAPSED_STRING","'catalogInventory'",204],")",["T_OBJECT_OPERATOR","->",204],["T_STRING","isQty",204],"(",["T_VARIABLE","$stockItem",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getTypeId",204],"(",")",")",")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$stockItem",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","addQty",205],"(",["T_VARIABLE","$qty",205],")",";",["T_WHITESPACE","\n            ",205],["T_IF","if",206],["T_WHITESPACE"," ",206],"(",["T_VARIABLE","$stockItem",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getCanBackInStock",206],"(",")",["T_WHITESPACE"," ",206],["T_BOOLEAN_AND","&&",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$stockItem",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getQty",206],"(",")",["T_WHITESPACE"," ",206],">",["T_WHITESPACE"," ",206],["T_VARIABLE","$stockItem",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","getMinQty",206],"(",")",")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n                ",206],["T_VARIABLE","$stockItem",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","setIsInStock",207],"(",["T_STRING","true",207],")",["T_WHITESPACE","\n                    ",207],["T_OBJECT_OPERATOR","->",208],["T_STRING","setStockStatusChangedAutomaticallyFlag",208],"(",["T_STRING","true",208],")",";",["T_WHITESPACE","\n            ",208],"}",["T_WHITESPACE","\n            ",209],["T_VARIABLE","$stockItem",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","save",210],"(",")",";",["T_WHITESPACE","\n        ",210],"}",["T_WHITESPACE","\n        ",211],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * Lock stock items for product ids array\n     *\n     * @param   array $productIds\n     * @return  Mage_CatalogInventory_Model_Stock\n     *\/",215],["T_WHITESPACE","\n    ",220],["T_PUBLIC","public",221],["T_WHITESPACE"," ",221],["T_FUNCTION","function",221],["T_WHITESPACE"," ",221],["T_STRING","lockProductItems",221],"(",["T_VARIABLE","$productIds",221],")",["T_WHITESPACE","\n    ",221],"{",["T_WHITESPACE","\n        ",222],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_getResource",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","lockProductItems",223],"(",["T_VARIABLE","$this",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$productIds",223],")",";",["T_WHITESPACE","\n        ",223],["T_RETURN","return",224],["T_WHITESPACE"," ",224],["T_VARIABLE","$this",224],";",["T_WHITESPACE","\n    ",224],"}",["T_WHITESPACE","\n\n    ",225],["T_DOC_COMMENT","\/**\n     * Adds filtering for collection to return only in stock products\n     *\n     * @param Mage_Catalog_Model_Resource_Eav_Mysql4_Product_Link_Product_Collection $collection\n     * @return Mage_CatalogInventory_Model_Stock $this\n     *\/",227],["T_WHITESPACE","\n    ",232],["T_PUBLIC","public",233],["T_WHITESPACE"," ",233],["T_FUNCTION","function",233],["T_WHITESPACE"," ",233],["T_STRING","addInStockFilterToCollection",233],"(",["T_VARIABLE","$collection",233],")",["T_WHITESPACE","\n    ",233],"{",["T_WHITESPACE","\n        ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getResource",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","setInStockFilterToCollection",235],"(",["T_VARIABLE","$collection",235],")",";",["T_WHITESPACE","\n        ",235],["T_RETURN","return",236],["T_WHITESPACE"," ",236],["T_VARIABLE","$this",236],";",["T_WHITESPACE","\n    ",236],"}",["T_WHITESPACE","\n",237],"}",["T_WHITESPACE","\n",238]]