[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogInventory\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * CatalogInventory Default Stock Status Indexer Resource Model\n *\n * @category    Mage\n * @package     Mage_CatalogInventory\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default",35],["T_WHITESPACE","\n    ",35],["T_EXTENDS","extends",36],["T_WHITESPACE"," ",36],["T_STRING","Mage_Catalog_Model_Resource_Product_Indexer_Abstract",36],["T_WHITESPACE","\n    ",36],["T_IMPLEMENTS","implements",37],["T_WHITESPACE"," ",37],["T_STRING","Mage_CatalogInventory_Model_Resource_Indexer_Stock_Interface",37],["T_WHITESPACE","\n",37],"{",["T_WHITESPACE","\n    ",38],["T_DOC_COMMENT","\/**\n     * Current Product Type Id\n     *\n     * @var string\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_PROTECTED","protected",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$_typeId",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Product Type is composite flag\n     *\n     * @var bool\n     *\/",46],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_isComposite",51],["T_WHITESPACE","    ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","false",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Initialize connection and define main table name\n     *\n     *\/",53],["T_WHITESPACE","\n    ",56],["T_PROTECTED","protected",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","_construct",57],"(",")",["T_WHITESPACE","\n    ",57],"{",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","_init",59],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",59],",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'product_id'",59],")",";",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Reindex all stock status data for default logic product type\n     *\n     * @return Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default\n     *\/",62],["T_WHITESPACE","\n    ",66],["T_PUBLIC","public",67],["T_WHITESPACE"," ",67],["T_FUNCTION","function",67],["T_WHITESPACE"," ",67],["T_STRING","reindexAll",67],"(",")",["T_WHITESPACE","\n    ",67],"{",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","useIdxTable",69],"(",["T_STRING","true",69],")",";",["T_WHITESPACE","\n        ",69],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","beginTransaction",70],"(",")",";",["T_WHITESPACE","\n        ",70],["T_TRY","try",71],["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","_prepareIndexTable",72],"(",")",";",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","commit",73],"(",")",";",["T_WHITESPACE","\n        ",73],"}",["T_WHITESPACE"," ",74],["T_CATCH","catch",74],["T_WHITESPACE"," ",74],"(",["T_STRING","Exception",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$e",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","rollBack",75],"(",")",";",["T_WHITESPACE","\n            ",75],["T_THROW","throw",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$e",76],";",["T_WHITESPACE","\n        ",76],"}",["T_WHITESPACE","\n        ",77],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Reindex stock data for defined product ids\n     *\n     * @param int|array $entityIds\n     * @return Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default\n     *\/",81],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","reindexEntity",87],"(",["T_VARIABLE","$entityIds",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_updateIndex",89],"(",["T_VARIABLE","$entityIds",89],")",";",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Set active Product Type Id\n     *\n     * @param string $typeId\n     * @return Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default\n     *\/",93],["T_WHITESPACE","\n    ",98],["T_PUBLIC","public",99],["T_WHITESPACE"," ",99],["T_FUNCTION","function",99],["T_WHITESPACE"," ",99],["T_STRING","setTypeId",99],"(",["T_VARIABLE","$typeId",99],")",["T_WHITESPACE","\n    ",99],"{",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","_typeId",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$typeId",101],";",["T_WHITESPACE","\n        ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Retrieve active Product Type Id\n     *\n     * @throws Mage_Core_Exception\n     *\n     * @return string\n     *\/",105],["T_WHITESPACE","\n    ",111],["T_PUBLIC","public",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","getTypeId",112],"(",")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_IF","if",114],["T_WHITESPACE"," ",114],"(",["T_STRING","is_null",114],"(",["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_typeId",114],")",")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n            ",114],["T_STRING","Mage",115],["T_DOUBLE_COLON","::",115],["T_STRING","throwException",115],"(",["T_STRING","Mage",115],["T_DOUBLE_COLON","::",115],["T_STRING","helper",115],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",115],")",["T_OBJECT_OPERATOR","->",115],["T_STRING","__",115],"(",["T_CONSTANT_ENCAPSED_STRING","'Undefined product type.'",115],")",")",";",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE","\n        ",116],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","_typeId",117],";",["T_WHITESPACE","\n    ",117],"}",["T_WHITESPACE","\n\n    ",118],["T_DOC_COMMENT","\/**\n     * Set Product Type Composite flag\n     *\n     * @param bool $flag\n     * @return Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default\n     *\/",120],["T_WHITESPACE","\n    ",125],["T_PUBLIC","public",126],["T_WHITESPACE"," ",126],["T_FUNCTION","function",126],["T_WHITESPACE"," ",126],["T_STRING","setIsComposite",126],"(",["T_VARIABLE","$flag",126],")",["T_WHITESPACE","\n    ",126],"{",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$this",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","_isComposite",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_BOOL_CAST","(bool)",128],["T_VARIABLE","$flag",128],";",["T_WHITESPACE","\n        ",128],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Check product type is composite\n     *\n     * @return bool\n     *\/",132],["T_WHITESPACE","\n    ",136],["T_PUBLIC","public",137],["T_WHITESPACE"," ",137],["T_FUNCTION","function",137],["T_WHITESPACE"," ",137],["T_STRING","getIsComposite",137],"(",")",["T_WHITESPACE","\n    ",137],"{",["T_WHITESPACE","\n        ",138],["T_RETURN","return",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_isComposite",139],";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n\n    ",140],["T_DOC_COMMENT","\/**\n     * Retrieve is Global Manage Stock enabled\n     *\n     * @return bool\n     *\/",142],["T_WHITESPACE","\n    ",146],["T_PROTECTED","protected",147],["T_WHITESPACE"," ",147],["T_FUNCTION","function",147],["T_WHITESPACE"," ",147],["T_STRING","_isManageStock",147],"(",")",["T_WHITESPACE","\n    ",147],"{",["T_WHITESPACE","\n        ",148],["T_RETURN","return",149],["T_WHITESPACE"," ",149],["T_STRING","Mage",149],["T_DOUBLE_COLON","::",149],["T_STRING","getStoreConfigFlag",149],"(",["T_STRING","Mage_CatalogInventory_Model_Stock_Item",149],["T_DOUBLE_COLON","::",149],["T_STRING","XML_PATH_MANAGE_STOCK",149],")",";",["T_WHITESPACE","\n    ",149],"}",["T_WHITESPACE","\n\n    ",150],["T_DOC_COMMENT","\/**\n     * Get the select object for get stock status by product ids\n     *\n     * @param int|array $entityIds\n     * @param bool $usePrimaryTable use primary or temporary index table\n     * @return Varien_Db_Select\n     *\/",152],["T_WHITESPACE","\n    ",158],["T_PROTECTED","protected",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","_getStockStatusSelect",159],"(",["T_VARIABLE","$entityIds",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","null",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$usePrimaryTable",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","false",159],")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$adapter",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_getWriteAdapter",161],"(",")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$qtyExpr",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$adapter",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getCheckSql",162],"(",["T_CONSTANT_ENCAPSED_STRING","'cisi.qty > 0'",162],",",["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","'cisi.qty'",162],",",["T_WHITESPACE"," ",162],["T_LNUMBER","0",162],")",";",["T_WHITESPACE","\n        ",162],["T_VARIABLE","$select",163],["T_WHITESPACE","  ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$adapter",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","select",163],"(",")",["T_WHITESPACE","\n            ",163],["T_OBJECT_OPERATOR","->",164],["T_STRING","from",164],"(",["T_ARRAY","array",164],"(",["T_CONSTANT_ENCAPSED_STRING","'e'",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getTable",164],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",164],")",")",",",["T_WHITESPACE"," ",164],["T_ARRAY","array",164],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",164],")",")",";",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","_addWebsiteJoinToSelect",165],"(",["T_VARIABLE","$select",165],",",["T_WHITESPACE"," ",165],["T_STRING","true",165],")",";",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","_addProductWebsiteJoinToSelect",166],"(",["T_VARIABLE","$select",166],",",["T_WHITESPACE"," ",166],["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",166],",",["T_WHITESPACE"," ",166],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",166],")",";",["T_WHITESPACE","\n        ",166],["T_VARIABLE","$select",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","columns",167],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id'",167],")",["T_WHITESPACE","\n            ",167],["T_OBJECT_OPERATOR","->",168],["T_STRING","join",168],"(",["T_WHITESPACE","\n                ",168],["T_ARRAY","array",169],"(",["T_CONSTANT_ENCAPSED_STRING","'cis'",169],["T_WHITESPACE"," ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getTable",169],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",169],")",")",",",["T_WHITESPACE","\n                ",169],["T_CONSTANT_ENCAPSED_STRING","''",170],",",["T_WHITESPACE","\n                ",170],["T_ARRAY","array",171],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_id'",171],")",")",["T_WHITESPACE","\n            ",171],["T_OBJECT_OPERATOR","->",172],["T_STRING","joinLeft",172],"(",["T_WHITESPACE","\n                ",172],["T_ARRAY","array",173],"(",["T_CONSTANT_ENCAPSED_STRING","'cisi'",173],["T_WHITESPACE"," ",173],["T_DOUBLE_ARROW","=>",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getTable",173],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",173],")",")",",",["T_WHITESPACE","\n                ",173],["T_CONSTANT_ENCAPSED_STRING","'cisi.stock_id = cis.stock_id AND cisi.product_id = e.entity_id'",174],",",["T_WHITESPACE","\n                ",174],["T_ARRAY","array",175],"(",")",")",["T_WHITESPACE","\n            ",175],["T_OBJECT_OPERATOR","->",176],["T_STRING","columns",176],"(",["T_ARRAY","array",176],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",176],["T_WHITESPACE"," ",176],["T_DOUBLE_ARROW","=>",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$qtyExpr",176],")",")",["T_WHITESPACE","\n            ",176],["T_OBJECT_OPERATOR","->",177],["T_STRING","where",177],"(",["T_CONSTANT_ENCAPSED_STRING","'cw.website_id != 0'",177],")",["T_WHITESPACE","\n            ",177],["T_OBJECT_OPERATOR","->",178],["T_STRING","where",178],"(",["T_CONSTANT_ENCAPSED_STRING","'e.type_id = ?'",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getTypeId",178],"(",")",")",";",["T_WHITESPACE","\n\n        ",178],["T_COMMENT","\/\/ add limitation of status\n",180],["T_WHITESPACE","        ",181],["T_VARIABLE","$psExpr",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_addAttributeToSelect",181],"(",["T_VARIABLE","$select",181],",",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'status'",181],",",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",181],",",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'cs.store_id'",181],")",";",["T_WHITESPACE","\n        ",181],["T_VARIABLE","$psCondition",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_VARIABLE","$adapter",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","quoteInto",182],"(",["T_VARIABLE","$psExpr",182],["T_WHITESPACE"," ",182],".",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","'=?'",182],",",["T_WHITESPACE"," ",182],["T_STRING","Mage_Catalog_Model_Product_Status",182],["T_DOUBLE_COLON","::",182],["T_STRING","STATUS_ENABLED",182],")",";",["T_WHITESPACE","\n\n        ",182],["T_IF","if",184],["T_WHITESPACE"," ",184],"(",["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","_isManageStock",184],"(",")",")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$statusExpr",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$adapter",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getCheckSql",185],"(",["T_CONSTANT_ENCAPSED_STRING","'cisi.use_config_manage_stock = 0 AND cisi.manage_stock = 0'",185],",",["T_WHITESPACE","\n                ",185],["T_LNUMBER","1",186],",",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'cisi.is_in_stock'",186],")",";",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE"," ",187],["T_ELSE","else",187],["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$statusExpr",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$adapter",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getCheckSql",188],"(",["T_CONSTANT_ENCAPSED_STRING","'cisi.use_config_manage_stock = 0 AND cisi.manage_stock = 1'",188],",",["T_WHITESPACE","\n                ",188],["T_CONSTANT_ENCAPSED_STRING","'cisi.is_in_stock'",189],",",["T_WHITESPACE"," ",189],["T_LNUMBER","1",189],")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n\n        ",190],["T_VARIABLE","$optExpr",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$adapter",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getCheckSql",192],"(",["T_VARIABLE","$psCondition",192],",",["T_WHITESPACE"," ",192],["T_LNUMBER","1",192],",",["T_WHITESPACE"," ",192],["T_LNUMBER","0",192],")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$stockStatusExpr",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$adapter",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getLeastSql",193],"(",["T_ARRAY","array",193],"(",["T_VARIABLE","$optExpr",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$statusExpr",193],")",")",";",["T_WHITESPACE","\n\n        ",193],["T_VARIABLE","$select",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","columns",195],"(",["T_ARRAY","array",195],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",195],["T_WHITESPACE"," ",195],["T_DOUBLE_ARROW","=>",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$stockStatusExpr",195],")",")",";",["T_WHITESPACE","\n\n        ",195],["T_IF","if",197],["T_WHITESPACE"," ",197],"(","!",["T_STRING","is_null",197],"(",["T_VARIABLE","$entityIds",197],")",")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$select",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","where",198],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$entityIds",198],")",";",["T_WHITESPACE","\n        ",198],"}",["T_WHITESPACE","\n\n        ",199],["T_RETURN","return",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$select",201],";",["T_WHITESPACE","\n    ",201],"}",["T_WHITESPACE","\n\n    ",202],["T_DOC_COMMENT","\/**\n     * Prepare stock status data in temporary index table\n     *\n     * @param int|array $entityIds  the product limitation\n     * @return Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default\n     *\/",204],["T_WHITESPACE","\n    ",209],["T_PROTECTED","protected",210],["T_WHITESPACE"," ",210],["T_FUNCTION","function",210],["T_WHITESPACE"," ",210],["T_STRING","_prepareIndexTable",210],"(",["T_VARIABLE","$entityIds",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_STRING","null",210],")",["T_WHITESPACE","\n    ",210],"{",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$adapter",212],["T_WHITESPACE"," ",212],"=",["T_WHITESPACE"," ",212],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","_getWriteAdapter",212],"(",")",";",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$select",213],["T_WHITESPACE","  ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_getStockStatusSelect",213],"(",["T_VARIABLE","$entityIds",213],")",";",["T_WHITESPACE","\n        ",213],["T_VARIABLE","$query",214],["T_WHITESPACE","   ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$select",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","insertFromSelect",214],"(",["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getIdxTable",214],"(",")",")",";",["T_WHITESPACE","\n        ",214],["T_VARIABLE","$adapter",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","query",215],"(",["T_VARIABLE","$query",215],")",";",["T_WHITESPACE","\n\n        ",215],["T_RETURN","return",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$this",217],";",["T_WHITESPACE","\n    ",217],"}",["T_WHITESPACE","\n\n    ",218],["T_DOC_COMMENT","\/**\n     * Update Stock status index by product ids\n     *\n     * @param array|int $entityIds\n     * @return Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default\n     *\/",220],["T_WHITESPACE","\n    ",225],["T_PROTECTED","protected",226],["T_WHITESPACE"," ",226],["T_FUNCTION","function",226],["T_WHITESPACE"," ",226],["T_STRING","_updateIndex",226],"(",["T_VARIABLE","$entityIds",226],")",["T_WHITESPACE","\n    ",226],"{",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$adapter",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","_getWriteAdapter",228],"(",")",";",["T_WHITESPACE","\n        ",228],["T_VARIABLE","$select",229],["T_WHITESPACE","  ",229],"=",["T_WHITESPACE"," ",229],["T_VARIABLE","$this",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","_getStockStatusSelect",229],"(",["T_VARIABLE","$entityIds",229],",",["T_WHITESPACE"," ",229],["T_STRING","true",229],")",";",["T_WHITESPACE","\n        ",229],["T_VARIABLE","$query",230],["T_WHITESPACE","   ",230],"=",["T_WHITESPACE"," ",230],["T_VARIABLE","$adapter",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","query",230],"(",["T_VARIABLE","$select",230],")",";",["T_WHITESPACE","\n\n        ",230],["T_VARIABLE","$i",232],["T_WHITESPACE","      ",232],"=",["T_WHITESPACE"," ",232],["T_LNUMBER","0",232],";",["T_WHITESPACE","\n        ",232],["T_VARIABLE","$data",233],["T_WHITESPACE","   ",233],"=",["T_WHITESPACE"," ",233],["T_ARRAY","array",233],"(",")",";",["T_WHITESPACE","\n        ",233],["T_WHILE","while",234],["T_WHITESPACE"," ",234],"(",["T_VARIABLE","$row",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_VARIABLE","$query",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","fetch",234],"(",["T_STRING","PDO",234],["T_DOUBLE_COLON","::",234],["T_STRING","FETCH_ASSOC",234],")",")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n            ",234],["T_VARIABLE","$i",235],["T_WHITESPACE"," ",235],["T_INC","++",235],";",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$data",236],"[","]",["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_ARRAY","array",236],"(",["T_WHITESPACE","\n                ",236],["T_CONSTANT_ENCAPSED_STRING","'product_id'",237],["T_WHITESPACE","    ",237],["T_DOUBLE_ARROW","=>",237],["T_WHITESPACE"," ",237],["T_INT_CAST","(int)",237],["T_VARIABLE","$row",237],"[",["T_CONSTANT_ENCAPSED_STRING","'entity_id'",237],"]",",",["T_WHITESPACE","\n                ",237],["T_CONSTANT_ENCAPSED_STRING","'website_id'",238],["T_WHITESPACE","    ",238],["T_DOUBLE_ARROW","=>",238],["T_WHITESPACE"," ",238],["T_INT_CAST","(int)",238],["T_VARIABLE","$row",238],"[",["T_CONSTANT_ENCAPSED_STRING","'website_id'",238],"]",",",["T_WHITESPACE","\n                ",238],["T_CONSTANT_ENCAPSED_STRING","'stock_id'",239],["T_WHITESPACE","      ",239],["T_DOUBLE_ARROW","=>",239],["T_WHITESPACE"," ",239],["T_INT_CAST","(int)",239],["T_VARIABLE","$row",239],"[",["T_CONSTANT_ENCAPSED_STRING","'stock_id'",239],"]",",",["T_WHITESPACE","\n                ",239],["T_CONSTANT_ENCAPSED_STRING","'qty'",240],["T_WHITESPACE","           ",240],["T_DOUBLE_ARROW","=>",240],["T_WHITESPACE"," ",240],["T_DOUBLE_CAST","(float)",240],["T_VARIABLE","$row",240],"[",["T_CONSTANT_ENCAPSED_STRING","'qty'",240],"]",",",["T_WHITESPACE","\n                ",240],["T_CONSTANT_ENCAPSED_STRING","'stock_status'",241],["T_WHITESPACE","  ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_INT_CAST","(int)",241],["T_VARIABLE","$row",241],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",241],"]",",",["T_WHITESPACE","\n            ",241],")",";",["T_WHITESPACE","\n            ",242],["T_IF","if",243],["T_WHITESPACE"," ",243],"(","(",["T_VARIABLE","$i",243],["T_WHITESPACE"," ",243],"%",["T_WHITESPACE"," ",243],["T_LNUMBER","1000",243],")",["T_WHITESPACE"," ",243],["T_IS_EQUAL","==",243],["T_WHITESPACE"," ",243],["T_LNUMBER","0",243],")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n                ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_updateIndexTable",244],"(",["T_VARIABLE","$data",244],")",";",["T_WHITESPACE","\n                ",244],["T_VARIABLE","$data",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_ARRAY","array",245],"(",")",";",["T_WHITESPACE","\n            ",245],"}",["T_WHITESPACE","\n        ",246],"}",["T_WHITESPACE","\n        ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","_updateIndexTable",248],"(",["T_VARIABLE","$data",248],")",";",["T_WHITESPACE","\n\n        ",248],["T_RETURN","return",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$this",250],";",["T_WHITESPACE","\n    ",250],"}",["T_WHITESPACE","\n\n    ",251],["T_DOC_COMMENT","\/**\n     * Update stock status index table (INSERT ... ON DUPLICATE KEY UPDATE ...)\n     *\n     * @param array $data\n     * @return Mage_CatalogInventory_Model_Resource_Indexer_Stock_Default\n     *\/",253],["T_WHITESPACE","\n    ",258],["T_PROTECTED","protected",259],["T_WHITESPACE"," ",259],["T_FUNCTION","function",259],["T_WHITESPACE"," ",259],["T_STRING","_updateIndexTable",259],"(",["T_VARIABLE","$data",259],")",["T_WHITESPACE","\n    ",259],"{",["T_WHITESPACE","\n        ",260],["T_IF","if",261],["T_WHITESPACE"," ",261],"(",["T_EMPTY","empty",261],"(",["T_VARIABLE","$data",261],")",")",["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n            ",261],["T_RETURN","return",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$this",262],";",["T_WHITESPACE","\n        ",262],"}",["T_WHITESPACE","\n\n        ",263],["T_VARIABLE","$adapter",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_getWriteAdapter",265],"(",")",";",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$adapter",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","insertOnDuplicate",266],"(",["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getMainTable",266],"(",")",",",["T_WHITESPACE"," ",266],["T_VARIABLE","$data",266],",",["T_WHITESPACE"," ",266],["T_ARRAY","array",266],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",266],",",["T_WHITESPACE"," ",266],["T_CONSTANT_ENCAPSED_STRING","'stock_status'",266],")",")",";",["T_WHITESPACE","\n\n        ",266],["T_RETURN","return",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],";",["T_WHITESPACE","\n    ",268],"}",["T_WHITESPACE","\n\n    ",269],["T_DOC_COMMENT","\/**\n     * Retrieve temporary index table name\n     *\n     * @param string $table\n     * @return string\n     *\/",271],["T_WHITESPACE","\n    ",276],["T_PUBLIC","public",277],["T_WHITESPACE"," ",277],["T_FUNCTION","function",277],["T_WHITESPACE"," ",277],["T_STRING","getIdxTable",277],"(",["T_VARIABLE","$table",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_STRING","null",277],")",["T_WHITESPACE","\n    ",277],"{",["T_WHITESPACE","\n        ",278],["T_IF","if",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","useIdxTable",279],"(",")",")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n            ",279],["T_RETURN","return",280],["T_WHITESPACE"," ",280],["T_VARIABLE","$this",280],["T_OBJECT_OPERATOR","->",280],["T_STRING","getTable",280],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status_indexer_idx'",280],")",";",["T_WHITESPACE","\n        ",280],"}",["T_WHITESPACE","\n        ",281],["T_RETURN","return",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","getTable",282],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status_indexer_tmp'",282],")",";",["T_WHITESPACE","\n    ",282],"}",["T_WHITESPACE","\n",283],"}",["T_WHITESPACE","\n",284]]