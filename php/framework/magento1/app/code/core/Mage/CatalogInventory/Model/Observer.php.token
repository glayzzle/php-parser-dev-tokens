[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_CatalogInventory\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Catalog inventory module observer\n *\n * @category   Mage\n * @package    Mage_CatalogInventory\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_CatalogInventory_Model_Observer",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Product qty's checked\n     * data is valid if you check quote item qty and use singleton instance\n     *\n     * @deprecated after 1.4.2.0-rc1\n     * @var array\n     *\/",36],["T_WHITESPACE","\n    ",42],["T_PROTECTED","protected",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$_checkedProductsQty",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_ARRAY","array",43],"(",")",";",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Product qty's checked\n     * data is valid if you check quote item qty and use singleton instance\n     *\n     * @var array\n     *\/",45],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_checkedQuoteItems",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_ARRAY","array",51],"(",")",";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * Array of items that need to be reindexed\n     *\n     * @var array\n     *\/",53],["T_WHITESPACE","\n    ",57],["T_PROTECTED","protected",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$_itemsForReindex",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_ARRAY","array",58],"(",")",";",["T_WHITESPACE","\n\n    ",58],["T_DOC_COMMENT","\/**\n     * Array, indexed by product's id to contain stockItems of already loaded products\n     * Some kind of singleton for product's stock item\n     *\n     * @var array\n     *\/",60],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$_stockItemsArray",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_ARRAY","array",66],"(",")",";",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Add stock information to product\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",68],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","addInventoryData",74],"(",["T_VARIABLE","$observer",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_VARIABLE","$product",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$observer",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getEvent",76],"(",")",["T_OBJECT_OPERATOR","->",76],["T_STRING","getProduct",76],"(",")",";",["T_WHITESPACE","\n        ",76],["T_IF","if",77],["T_WHITESPACE"," ",77],"(",["T_VARIABLE","$product",77],["T_WHITESPACE"," ",77],["T_INSTANCEOF","instanceof",77],["T_WHITESPACE"," ",77],["T_STRING","Mage_Catalog_Model_Product",77],")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$productId",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","intval",78],"(",["T_VARIABLE","$product",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getId",78],"(",")",")",";",["T_WHITESPACE","\n            ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(","!",["T_ISSET","isset",79],"(",["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_stockItemsArray",79],"[",["T_VARIABLE","$productId",79],"]",")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n                ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_stockItemsArray",80],"[",["T_VARIABLE","$productId",80],"]",["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_STRING","Mage",80],["T_DOUBLE_COLON","::",80],["T_STRING","getModel",80],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",80],")",";",["T_WHITESPACE","\n            ",80],"}",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$productStockItem",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_stockItemsArray",82],"[",["T_VARIABLE","$productId",82],"]",";",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$productStockItem",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assignProduct",83],"(",["T_VARIABLE","$product",83],")",";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n        ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Remove stock information from static variable\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",88],["T_WHITESPACE","\n    ",93],["T_PUBLIC","public",94],["T_WHITESPACE"," ",94],["T_FUNCTION","function",94],["T_WHITESPACE"," ",94],["T_STRING","removeInventoryData",94],"(",["T_VARIABLE","$observer",94],")",["T_WHITESPACE","\n    ",94],"{",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$product",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$observer",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getEvent",96],"(",")",["T_OBJECT_OPERATOR","->",96],["T_STRING","getProduct",96],"(",")",";",["T_WHITESPACE","\n        ",96],["T_IF","if",97],["T_WHITESPACE"," ",97],"(","(",["T_VARIABLE","$product",97],["T_WHITESPACE"," ",97],["T_INSTANCEOF","instanceof",97],["T_WHITESPACE"," ",97],["T_STRING","Mage_Catalog_Model_Product",97],")",["T_WHITESPACE","\n            ",97],["T_BOOLEAN_AND","&&",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$product",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getId",98],"(",")",["T_WHITESPACE","\n            ",98],["T_BOOLEAN_AND","&&",99],["T_WHITESPACE"," ",99],["T_ISSET","isset",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","_stockItemsArray",99],"[",["T_VARIABLE","$product",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getId",99],"(",")","]",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_UNSET","unset",100],"(",["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","_stockItemsArray",100],"[",["T_VARIABLE","$product",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getId",100],"(",")","]",")",";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE","\n        ",101],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],";",["T_WHITESPACE","\n    ",102],"}",["T_WHITESPACE","\n\n    ",103],["T_DOC_COMMENT","\/**\n     * Add information about producs stock status to collection\n     * Used in for product collection after load\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",105],["T_WHITESPACE","\n    ",111],["T_PUBLIC","public",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","addStockStatusToCollection",112],"(",["T_VARIABLE","$observer",112],")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$productCollection",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$observer",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getEvent",114],"(",")",["T_OBJECT_OPERATOR","->",114],["T_STRING","getCollection",114],"(",")",";",["T_WHITESPACE","\n        ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(",["T_VARIABLE","$productCollection",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","hasFlag",115],"(",["T_CONSTANT_ENCAPSED_STRING","'require_stock_items'",115],")",")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_STRING","Mage",116],["T_DOUBLE_COLON","::",116],["T_STRING","getModel",116],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",116],")",["T_OBJECT_OPERATOR","->",116],["T_STRING","addItemsToProducts",116],"(",["T_VARIABLE","$productCollection",116],")",";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE"," ",117],["T_ELSE","else",117],["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_STRING","Mage",118],["T_DOUBLE_COLON","::",118],["T_STRING","getModel",118],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",118],")",["T_OBJECT_OPERATOR","->",118],["T_STRING","addStockStatusToProducts",118],"(",["T_VARIABLE","$productCollection",118],")",";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE","\n        ",119],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Add Stock items to product collection\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",123],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","addInventoryDataToCollection",129],"(",["T_VARIABLE","$observer",129],")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$productCollection",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$observer",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getEvent",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","getProductCollection",131],"(",")",";",["T_WHITESPACE","\n        ",131],["T_STRING","Mage",132],["T_DOUBLE_COLON","::",132],["T_STRING","getModel",132],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",132],")",["T_OBJECT_OPERATOR","->",132],["T_STRING","addItemsToProducts",132],"(",["T_VARIABLE","$productCollection",132],")",";",["T_WHITESPACE","\n        ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],";",["T_WHITESPACE","\n    ",133],"}",["T_WHITESPACE","\n\n    ",134],["T_DOC_COMMENT","\/**\n     * Saving product inventory data. Product qty calculated dynamically.\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",136],["T_WHITESPACE","\n    ",141],["T_PUBLIC","public",142],["T_WHITESPACE"," ",142],["T_FUNCTION","function",142],["T_WHITESPACE"," ",142],["T_STRING","saveInventoryData",142],"(",["T_VARIABLE","$observer",142],")",["T_WHITESPACE","\n    ",142],"{",["T_WHITESPACE","\n        ",143],["T_VARIABLE","$product",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$observer",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getEvent",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","getProduct",144],"(",")",";",["T_WHITESPACE","\n\n        ",144],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_STRING","is_null",146],"(",["T_VARIABLE","$product",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getStockData",146],"(",")",")",")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_VARIABLE","$product",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getIsChangedWebsites",147],"(",")",["T_WHITESPACE"," ",147],["T_BOOLEAN_OR","||",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$product",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","dataHasChangedFor",147],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",147],")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n                ",147],["T_STRING","Mage",148],["T_DOUBLE_COLON","::",148],["T_STRING","getSingleton",148],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",148],")",["T_WHITESPACE","\n                    ",148],["T_OBJECT_OPERATOR","->",149],["T_STRING","updateStatus",149],"(",["T_VARIABLE","$product",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getId",149],"(",")",")",";",["T_WHITESPACE","\n            ",149],"}",["T_WHITESPACE","\n            ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE","\n\n        ",152],["T_VARIABLE","$item",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$product",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getStockItem",154],"(",")",";",["T_WHITESPACE","\n        ",154],["T_IF","if",155],["T_WHITESPACE"," ",155],"(","!",["T_VARIABLE","$item",155],")",["T_WHITESPACE"," ",155],"{",["T_WHITESPACE","\n            ",155],["T_VARIABLE","$item",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_STRING","Mage",156],["T_DOUBLE_COLON","::",156],["T_STRING","getModel",156],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_item'",156],")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_prepareItemForSave",158],"(",["T_VARIABLE","$item",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$product",158],")",";",["T_WHITESPACE","\n        ",158],["T_VARIABLE","$item",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","save",159],"(",")",";",["T_WHITESPACE","\n        ",159],["T_RETURN","return",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],";",["T_WHITESPACE","\n    ",160],"}",["T_WHITESPACE","\n\n    ",161],["T_DOC_COMMENT","\/**\n     * Copy product inventory data (used for product duplicate functionality)\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",163],["T_WHITESPACE","\n    ",168],["T_PUBLIC","public",169],["T_WHITESPACE"," ",169],["T_FUNCTION","function",169],["T_WHITESPACE"," ",169],["T_STRING","copyInventoryData",169],"(",["T_VARIABLE","$observer",169],")",["T_WHITESPACE","\n    ",169],"{",["T_WHITESPACE","\n        ",170],["T_DOC_COMMENT","\/** @var Mage_Catalog_Model_Product $currentProduct *\/",171],["T_WHITESPACE","\n        ",171],["T_VARIABLE","$currentProduct",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$observer",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getEvent",172],"(",")",["T_OBJECT_OPERATOR","->",172],["T_STRING","getCurrentProduct",172],"(",")",";",["T_WHITESPACE","\n        ",172],["T_DOC_COMMENT","\/** @var Mage_Catalog_Model_Product $newProduct *\/",173],["T_WHITESPACE","\n        ",173],["T_VARIABLE","$newProduct",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$observer",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","getEvent",174],"(",")",["T_OBJECT_OPERATOR","->",174],["T_STRING","getNewProduct",174],"(",")",";",["T_WHITESPACE","\n\n        ",174],["T_VARIABLE","$newProduct",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","unsStockItem",176],"(",")",";",["T_WHITESPACE","\n        ",176],["T_VARIABLE","$stockData",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_ARRAY","array",177],"(",["T_WHITESPACE","\n            ",177],["T_CONSTANT_ENCAPSED_STRING","'use_config_min_qty'",178],["T_WHITESPACE","        ",178],["T_DOUBLE_ARROW","=>",178],["T_WHITESPACE"," ",178],["T_LNUMBER","1",178],",",["T_WHITESPACE","\n            ",178],["T_CONSTANT_ENCAPSED_STRING","'use_config_min_sale_qty'",179],["T_WHITESPACE","   ",179],["T_DOUBLE_ARROW","=>",179],["T_WHITESPACE"," ",179],["T_LNUMBER","1",179],",",["T_WHITESPACE","\n            ",179],["T_CONSTANT_ENCAPSED_STRING","'use_config_max_sale_qty'",180],["T_WHITESPACE","   ",180],["T_DOUBLE_ARROW","=>",180],["T_WHITESPACE"," ",180],["T_LNUMBER","1",180],",",["T_WHITESPACE","\n            ",180],["T_CONSTANT_ENCAPSED_STRING","'use_config_backorders'",181],["T_WHITESPACE","     ",181],["T_DOUBLE_ARROW","=>",181],["T_WHITESPACE"," ",181],["T_LNUMBER","1",181],",",["T_WHITESPACE","\n            ",181],["T_CONSTANT_ENCAPSED_STRING","'use_config_notify_stock_qty'",182],["T_WHITESPACE"," ",182],["T_DOUBLE_ARROW","=>",182],["T_WHITESPACE"," ",182],["T_LNUMBER","1",182],["T_WHITESPACE","\n        ",182],")",";",["T_WHITESPACE","\n        ",183],["T_VARIABLE","$currentStockItem",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_VARIABLE","$currentProduct",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getStockItem",184],"(",")",";",["T_WHITESPACE","\n        ",184],["T_IF","if",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$currentStockItem",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$stockData",186],["T_WHITESPACE"," ",186],["T_PLUS_EQUAL","+=",186],["T_WHITESPACE"," ",186],["T_ARRAY","array",186],"(",["T_WHITESPACE","\n                ",186],["T_CONSTANT_ENCAPSED_STRING","'use_config_enable_qty_inc'",187],["T_WHITESPACE","  ",187],["T_DOUBLE_ARROW","=>",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$currentStockItem",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getData",187],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_enable_qty_inc'",187],")",",",["T_WHITESPACE","\n                ",187],["T_CONSTANT_ENCAPSED_STRING","'enable_qty_increments'",188],["T_WHITESPACE","             ",188],["T_DOUBLE_ARROW","=>",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$currentStockItem",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getData",188],"(",["T_CONSTANT_ENCAPSED_STRING","'enable_qty_increments'",188],")",",",["T_WHITESPACE","\n                ",188],["T_CONSTANT_ENCAPSED_STRING","'use_config_qty_increments'",189],["T_WHITESPACE","         ",189],["T_DOUBLE_ARROW","=>",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$currentStockItem",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getData",189],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_qty_increments'",189],")",",",["T_WHITESPACE","\n                ",189],["T_CONSTANT_ENCAPSED_STRING","'qty_increments'",190],["T_WHITESPACE","                    ",190],["T_DOUBLE_ARROW","=>",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$currentStockItem",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getData",190],"(",["T_CONSTANT_ENCAPSED_STRING","'qty_increments'",190],")",",",["T_WHITESPACE","\n            ",190],")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$newProduct",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","setStockData",193],"(",["T_VARIABLE","$stockData",193],")",";",["T_WHITESPACE","\n\n        ",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$this",195],";",["T_WHITESPACE","\n    ",195],"}",["T_WHITESPACE","\n\n    ",196],["T_DOC_COMMENT","\/**\n     * Prepare stock item data for save\n     *\n     * @param Mage_CatalogInventory_Model_Stock_Item $item\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",198],["T_WHITESPACE","\n    ",204],["T_PROTECTED","protected",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","_prepareItemForSave",205],"(",["T_VARIABLE","$item",205],",",["T_WHITESPACE"," ",205],["T_VARIABLE","$product",205],")",["T_WHITESPACE","\n    ",205],"{",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$item",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","addData",207],"(",["T_VARIABLE","$product",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getStockData",207],"(",")",")",["T_WHITESPACE","\n            ",207],["T_OBJECT_OPERATOR","->",208],["T_STRING","setProduct",208],"(",["T_VARIABLE","$product",208],")",["T_WHITESPACE","\n            ",208],["T_OBJECT_OPERATOR","->",209],["T_STRING","setProductId",209],"(",["T_VARIABLE","$product",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getId",209],"(",")",")",["T_WHITESPACE","\n            ",209],["T_OBJECT_OPERATOR","->",210],["T_STRING","setStockId",210],"(",["T_VARIABLE","$item",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getStockId",210],"(",")",")",";",["T_WHITESPACE","\n        ",210],["T_IF","if",211],["T_WHITESPACE"," ",211],"(","!",["T_STRING","is_null",211],"(",["T_VARIABLE","$product",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getData",211],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/min_qty'",211],")",")",["T_WHITESPACE","\n            ",211],["T_BOOLEAN_AND","&&",212],["T_WHITESPACE"," ",212],["T_STRING","is_null",212],"(",["T_VARIABLE","$product",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getData",212],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/use_config_min_qty'",212],")",")",")",["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$item",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","setData",213],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_min_qty'",213],",",["T_WHITESPACE"," ",213],["T_STRING","false",213],")",";",["T_WHITESPACE","\n        ",213],"}",["T_WHITESPACE","\n        ",214],["T_IF","if",215],["T_WHITESPACE"," ",215],"(","!",["T_STRING","is_null",215],"(",["T_VARIABLE","$product",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getData",215],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/min_sale_qty'",215],")",")",["T_WHITESPACE","\n            ",215],["T_BOOLEAN_AND","&&",216],["T_WHITESPACE"," ",216],["T_STRING","is_null",216],"(",["T_VARIABLE","$product",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getData",216],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/use_config_min_sale_qty'",216],")",")",")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n            ",216],["T_VARIABLE","$item",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","setData",217],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_min_sale_qty'",217],",",["T_WHITESPACE"," ",217],["T_STRING","false",217],")",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n        ",218],["T_IF","if",219],["T_WHITESPACE"," ",219],"(","!",["T_STRING","is_null",219],"(",["T_VARIABLE","$product",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","getData",219],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/max_sale_qty'",219],")",")",["T_WHITESPACE","\n            ",219],["T_BOOLEAN_AND","&&",220],["T_WHITESPACE"," ",220],["T_STRING","is_null",220],"(",["T_VARIABLE","$product",220],["T_OBJECT_OPERATOR","->",220],["T_STRING","getData",220],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/use_config_max_sale_qty'",220],")",")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$item",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","setData",221],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_max_sale_qty'",221],",",["T_WHITESPACE"," ",221],["T_STRING","false",221],")",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE","\n        ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(","!",["T_STRING","is_null",223],"(",["T_VARIABLE","$product",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","getData",223],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/backorders'",223],")",")",["T_WHITESPACE","\n            ",223],["T_BOOLEAN_AND","&&",224],["T_WHITESPACE"," ",224],["T_STRING","is_null",224],"(",["T_VARIABLE","$product",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getData",224],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/use_config_backorders'",224],")",")",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$item",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","setData",225],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_backorders'",225],",",["T_WHITESPACE"," ",225],["T_STRING","false",225],")",";",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE","\n        ",226],["T_IF","if",227],["T_WHITESPACE"," ",227],"(","!",["T_STRING","is_null",227],"(",["T_VARIABLE","$product",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getData",227],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/notify_stock_qty'",227],")",")",["T_WHITESPACE","\n            ",227],["T_BOOLEAN_AND","&&",228],["T_WHITESPACE"," ",228],["T_STRING","is_null",228],"(",["T_VARIABLE","$product",228],["T_OBJECT_OPERATOR","->",228],["T_STRING","getData",228],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/use_config_notify_stock_qty'",228],")",")",")",["T_WHITESPACE"," ",228],"{",["T_WHITESPACE","\n            ",228],["T_VARIABLE","$item",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","setData",229],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_notify_stock_qty'",229],",",["T_WHITESPACE"," ",229],["T_STRING","false",229],")",";",["T_WHITESPACE","\n        ",229],"}",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$originalQty",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$product",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getData",231],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/original_inventory_qty'",231],")",";",["T_WHITESPACE","\n        ",231],["T_IF","if",232],["T_WHITESPACE"," ",232],"(",["T_STRING","strlen",232],"(",["T_VARIABLE","$originalQty",232],")",">",["T_LNUMBER","0",232],")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n            ",232],["T_VARIABLE","$item",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","setQtyCorrection",233],"(",["T_VARIABLE","$item",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getQty",233],"(",")","-",["T_VARIABLE","$originalQty",233],")",";",["T_WHITESPACE","\n        ",233],"}",["T_WHITESPACE","\n        ",234],["T_IF","if",235],["T_WHITESPACE"," ",235],"(","!",["T_STRING","is_null",235],"(",["T_VARIABLE","$product",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getData",235],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/enable_qty_increments'",235],")",")",["T_WHITESPACE","\n            ",235],["T_BOOLEAN_AND","&&",236],["T_WHITESPACE"," ",236],["T_STRING","is_null",236],"(",["T_VARIABLE","$product",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getData",236],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/use_config_enable_qty_inc'",236],")",")",")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n            ",236],["T_VARIABLE","$item",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","setData",237],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_enable_qty_inc'",237],",",["T_WHITESPACE"," ",237],["T_STRING","false",237],")",";",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n        ",238],["T_IF","if",239],["T_WHITESPACE"," ",239],"(","!",["T_STRING","is_null",239],"(",["T_VARIABLE","$product",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getData",239],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/qty_increments'",239],")",")",["T_WHITESPACE","\n            ",239],["T_BOOLEAN_AND","&&",240],["T_WHITESPACE"," ",240],["T_STRING","is_null",240],"(",["T_VARIABLE","$product",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getData",240],"(",["T_CONSTANT_ENCAPSED_STRING","'stock_data\/use_config_qty_increments'",240],")",")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$item",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setData",241],"(",["T_CONSTANT_ENCAPSED_STRING","'use_config_qty_increments'",241],",",["T_WHITESPACE"," ",241],["T_STRING","false",241],")",";",["T_WHITESPACE","\n        ",241],"}",["T_WHITESPACE","\n        ",242],["T_RETURN","return",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],";",["T_WHITESPACE","\n\n    ",243],"}",["T_WHITESPACE","\n\n    ",245],["T_DOC_COMMENT","\/**\n     * Removes error statuses from quote and item, set by this observer\n     *\n     * @param Mage_Sales_Model_Quote_Item $item\n     * @param int $code\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",247],["T_WHITESPACE","\n    ",253],["T_PROTECTED","protected",254],["T_WHITESPACE"," ",254],["T_FUNCTION","function",254],["T_WHITESPACE"," ",254],["T_STRING","_removeErrorsFromQuoteAndItem",254],"(",["T_VARIABLE","$item",254],",",["T_WHITESPACE"," ",254],["T_VARIABLE","$code",254],")",["T_WHITESPACE","\n    ",254],"{",["T_WHITESPACE","\n        ",255],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_VARIABLE","$item",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getHasError",256],"(",")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$params",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_ARRAY","array",257],"(",["T_WHITESPACE","\n                ",257],["T_CONSTANT_ENCAPSED_STRING","'origin'",258],["T_WHITESPACE"," ",258],["T_DOUBLE_ARROW","=>",258],["T_WHITESPACE"," ",258],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",258],",",["T_WHITESPACE","\n                ",258],["T_CONSTANT_ENCAPSED_STRING","'code'",259],["T_WHITESPACE"," ",259],["T_DOUBLE_ARROW","=>",259],["T_WHITESPACE"," ",259],["T_VARIABLE","$code",259],["T_WHITESPACE","\n            ",259],")",";",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$item",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","removeErrorInfosByParams",261],"(",["T_VARIABLE","$params",261],")",";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n\n        ",262],["T_VARIABLE","$quote",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$item",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","getQuote",264],"(",")",";",["T_WHITESPACE","\n        ",264],["T_VARIABLE","$quoteItems",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$quote",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getItemsCollection",265],"(",")",";",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$canRemoveErrorFromQuote",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_STRING","true",266],";",["T_WHITESPACE","\n\n        ",266],["T_FOREACH","foreach",268],["T_WHITESPACE"," ",268],"(",["T_VARIABLE","$quoteItems",268],["T_WHITESPACE"," ",268],["T_AS","as",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$quoteItem",268],")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n            ",268],["T_IF","if",269],["T_WHITESPACE"," ",269],"(",["T_VARIABLE","$quoteItem",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getItemId",269],"(",")",["T_WHITESPACE"," ",269],["T_IS_EQUAL","==",269],["T_WHITESPACE"," ",269],["T_VARIABLE","$item",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getItemId",269],"(",")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n                ",269],["T_CONTINUE","continue",270],";",["T_WHITESPACE","\n            ",270],"}",["T_WHITESPACE","\n\n            ",271],["T_VARIABLE","$errorInfos",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$quoteItem",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getErrorInfos",273],"(",")",";",["T_WHITESPACE","\n            ",273],["T_FOREACH","foreach",274],["T_WHITESPACE"," ",274],"(",["T_VARIABLE","$errorInfos",274],["T_WHITESPACE"," ",274],["T_AS","as",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$errorInfo",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n                ",274],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$errorInfo",275],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",275],"]",["T_WHITESPACE"," ",275],["T_IS_EQUAL","==",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$code",275],")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n                    ",275],["T_VARIABLE","$canRemoveErrorFromQuote",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_STRING","false",276],";",["T_WHITESPACE","\n                    ",276],["T_BREAK","break",277],";",["T_WHITESPACE","\n                ",277],"}",["T_WHITESPACE","\n            ",278],"}",["T_WHITESPACE","\n\n            ",279],["T_IF","if",281],["T_WHITESPACE"," ",281],"(","!",["T_VARIABLE","$canRemoveErrorFromQuote",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n                ",281],["T_BREAK","break",282],";",["T_WHITESPACE","\n            ",282],"}",["T_WHITESPACE","\n        ",283],"}",["T_WHITESPACE","\n\n        ",284],["T_IF","if",286],["T_WHITESPACE"," ",286],"(",["T_VARIABLE","$quote",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","getHasError",286],"(",")",["T_WHITESPACE"," ",286],["T_BOOLEAN_AND","&&",286],["T_WHITESPACE"," ",286],["T_VARIABLE","$canRemoveErrorFromQuote",286],")",["T_WHITESPACE"," ",286],"{",["T_WHITESPACE","\n            ",286],["T_VARIABLE","$params",287],["T_WHITESPACE"," ",287],"=",["T_WHITESPACE"," ",287],["T_ARRAY","array",287],"(",["T_WHITESPACE","\n                ",287],["T_CONSTANT_ENCAPSED_STRING","'origin'",288],["T_WHITESPACE"," ",288],["T_DOUBLE_ARROW","=>",288],["T_WHITESPACE"," ",288],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",288],",",["T_WHITESPACE","\n                ",288],["T_CONSTANT_ENCAPSED_STRING","'code'",289],["T_WHITESPACE"," ",289],["T_DOUBLE_ARROW","=>",289],["T_WHITESPACE"," ",289],["T_VARIABLE","$code",289],["T_WHITESPACE","\n            ",289],")",";",["T_WHITESPACE","\n            ",290],["T_VARIABLE","$quote",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","removeErrorInfosByParams",291],"(",["T_STRING","null",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$params",291],")",";",["T_WHITESPACE","\n        ",291],"}",["T_WHITESPACE","\n\n        ",292],["T_RETURN","return",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],";",["T_WHITESPACE","\n    ",294],"}",["T_WHITESPACE","\n\n    ",295],["T_DOC_COMMENT","\/**\n     * Check product inventory data when quote item quantity declaring\n     *\n     * @param  Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",297],["T_WHITESPACE","\n    ",302],["T_PUBLIC","public",303],["T_WHITESPACE"," ",303],["T_FUNCTION","function",303],["T_WHITESPACE"," ",303],["T_STRING","checkQuoteItemQty",303],"(",["T_VARIABLE","$observer",303],")",["T_WHITESPACE","\n    ",303],"{",["T_WHITESPACE","\n        ",304],["T_VARIABLE","$quoteItem",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$observer",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","getEvent",305],"(",")",["T_OBJECT_OPERATOR","->",305],["T_STRING","getItem",305],"(",")",";",["T_WHITESPACE","\n        ",305],["T_COMMENT","\/* @var $quoteItem Mage_Sales_Model_Quote_Item *\/",306],["T_WHITESPACE","\n        ",306],["T_IF","if",307],["T_WHITESPACE"," ",307],"(","!",["T_VARIABLE","$quoteItem",307],["T_WHITESPACE"," ",307],["T_BOOLEAN_OR","||",307],["T_WHITESPACE"," ",307],"!",["T_VARIABLE","$quoteItem",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getProductId",307],"(",")",["T_WHITESPACE"," ",307],["T_BOOLEAN_OR","||",307],["T_WHITESPACE"," ",307],"!",["T_VARIABLE","$quoteItem",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getQuote",307],"(",")",["T_WHITESPACE","\n            ",307],["T_BOOLEAN_OR","||",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$quoteItem",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getQuote",308],"(",")",["T_OBJECT_OPERATOR","->",308],["T_STRING","getIsSuperMode",308],"(",")",")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n            ",308],["T_RETURN","return",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],";",["T_WHITESPACE","\n        ",309],"}",["T_WHITESPACE","\n\n        ",310],["T_DOC_COMMENT","\/**\n         * Get Qty\n         *\/",312],["T_WHITESPACE","\n        ",314],["T_VARIABLE","$qty",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$quoteItem",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getQty",315],"(",")",";",["T_WHITESPACE","\n\n        ",315],["T_DOC_COMMENT","\/**\n         * Check if product in stock. For composite products check base (parent) item stosk status\n         *\/",317],["T_WHITESPACE","\n        ",319],["T_VARIABLE","$stockItem",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_VARIABLE","$quoteItem",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getProduct",320],"(",")",["T_OBJECT_OPERATOR","->",320],["T_STRING","getStockItem",320],"(",")",";",["T_WHITESPACE","\n        ",320],["T_VARIABLE","$parentStockItem",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_STRING","false",321],";",["T_WHITESPACE","\n        ",321],["T_IF","if",322],["T_WHITESPACE"," ",322],"(",["T_VARIABLE","$quoteItem",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","getParentItem",322],"(",")",")",["T_WHITESPACE"," ",322],"{",["T_WHITESPACE","\n            ",322],["T_VARIABLE","$parentStockItem",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_VARIABLE","$quoteItem",323],["T_OBJECT_OPERATOR","->",323],["T_STRING","getParentItem",323],"(",")",["T_OBJECT_OPERATOR","->",323],["T_STRING","getProduct",323],"(",")",["T_OBJECT_OPERATOR","->",323],["T_STRING","getStockItem",323],"(",")",";",["T_WHITESPACE","\n        ",323],"}",["T_WHITESPACE","\n        ",324],["T_IF","if",325],["T_WHITESPACE"," ",325],"(",["T_VARIABLE","$stockItem",325],")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n            ",325],["T_IF","if",326],["T_WHITESPACE"," ",326],"(","!",["T_VARIABLE","$stockItem",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getIsInStock",326],"(",")",["T_WHITESPACE"," ",326],["T_BOOLEAN_OR","||",326],["T_WHITESPACE"," ",326],"(",["T_VARIABLE","$parentStockItem",326],["T_WHITESPACE"," ",326],["T_BOOLEAN_AND","&&",326],["T_WHITESPACE"," ",326],"!",["T_VARIABLE","$parentStockItem",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getIsInStock",326],"(",")",")",")",["T_WHITESPACE"," ",326],"{",["T_WHITESPACE","\n                ",326],["T_VARIABLE","$quoteItem",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","addErrorInfo",327],"(",["T_WHITESPACE","\n                    ",327],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",328],",",["T_WHITESPACE","\n                    ",328],["T_STRING","Mage_CatalogInventory_Helper_Data",329],["T_DOUBLE_COLON","::",329],["T_STRING","ERROR_QTY",329],",",["T_WHITESPACE","\n                    ",329],["T_STRING","Mage",330],["T_DOUBLE_COLON","::",330],["T_STRING","helper",330],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",330],")",["T_OBJECT_OPERATOR","->",330],["T_STRING","__",330],"(",["T_CONSTANT_ENCAPSED_STRING","'This product is currently out of stock.'",330],")",["T_WHITESPACE","\n                ",330],")",";",["T_WHITESPACE","\n                ",331],["T_VARIABLE","$quoteItem",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getQuote",332],"(",")",["T_OBJECT_OPERATOR","->",332],["T_STRING","addErrorInfo",332],"(",["T_WHITESPACE","\n                    ",332],["T_CONSTANT_ENCAPSED_STRING","'stock'",333],",",["T_WHITESPACE","\n                    ",333],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",334],",",["T_WHITESPACE","\n                    ",334],["T_STRING","Mage_CatalogInventory_Helper_Data",335],["T_DOUBLE_COLON","::",335],["T_STRING","ERROR_QTY",335],",",["T_WHITESPACE","\n                    ",335],["T_STRING","Mage",336],["T_DOUBLE_COLON","::",336],["T_STRING","helper",336],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",336],")",["T_OBJECT_OPERATOR","->",336],["T_STRING","__",336],"(",["T_CONSTANT_ENCAPSED_STRING","'Some of the products are currently out of stock.'",336],")",["T_WHITESPACE","\n                ",336],")",";",["T_WHITESPACE","\n                ",337],["T_RETURN","return",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$this",338],";",["T_WHITESPACE","\n            ",338],"}",["T_WHITESPACE"," ",339],["T_ELSE","else",339],["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n                ",339],["T_COMMENT","\/\/ Delete error from item and its quote, if it was set due to item out of stock\n",340],["T_WHITESPACE","                ",341],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_removeErrorsFromQuoteAndItem",341],"(",["T_VARIABLE","$quoteItem",341],",",["T_WHITESPACE"," ",341],["T_STRING","Mage_CatalogInventory_Helper_Data",341],["T_DOUBLE_COLON","::",341],["T_STRING","ERROR_QTY",341],")",";",["T_WHITESPACE","\n            ",341],"}",["T_WHITESPACE","\n        ",342],"}",["T_WHITESPACE","\n\n        ",343],["T_DOC_COMMENT","\/**\n         * Check item for options\n         *\/",345],["T_WHITESPACE","\n        ",347],["T_VARIABLE","$options",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_VARIABLE","$quoteItem",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getQtyOptions",348],"(",")",";",["T_WHITESPACE","\n        ",348],["T_IF","if",349],["T_WHITESPACE"," ",349],"(",["T_VARIABLE","$options",349],["T_WHITESPACE"," ",349],["T_BOOLEAN_AND","&&",349],["T_WHITESPACE"," ",349],["T_VARIABLE","$qty",349],["T_WHITESPACE"," ",349],">",["T_WHITESPACE"," ",349],["T_LNUMBER","0",349],")",["T_WHITESPACE"," ",349],"{",["T_WHITESPACE","\n            ",349],["T_VARIABLE","$qty",350],["T_WHITESPACE"," ",350],"=",["T_WHITESPACE"," ",350],["T_VARIABLE","$quoteItem",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","getProduct",350],"(",")",["T_OBJECT_OPERATOR","->",350],["T_STRING","getTypeInstance",350],"(",["T_STRING","true",350],")",["T_OBJECT_OPERATOR","->",350],["T_STRING","prepareQuoteItemQty",350],"(",["T_VARIABLE","$qty",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$quoteItem",350],["T_OBJECT_OPERATOR","->",350],["T_STRING","getProduct",350],"(",")",")",";",["T_WHITESPACE","\n            ",350],["T_VARIABLE","$quoteItem",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","setData",351],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",351],",",["T_WHITESPACE"," ",351],["T_VARIABLE","$qty",351],")",";",["T_WHITESPACE","\n\n            ",351],["T_IF","if",353],["T_WHITESPACE"," ",353],"(",["T_VARIABLE","$stockItem",353],")",["T_WHITESPACE"," ",353],"{",["T_WHITESPACE","\n                ",353],["T_VARIABLE","$result",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_VARIABLE","$stockItem",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","checkQtyIncrements",354],"(",["T_VARIABLE","$qty",354],")",";",["T_WHITESPACE","\n                ",354],["T_IF","if",355],["T_WHITESPACE"," ",355],"(",["T_VARIABLE","$result",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getHasError",355],"(",")",")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n                    ",355],["T_VARIABLE","$quoteItem",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","addErrorInfo",356],"(",["T_WHITESPACE","\n                        ",356],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",357],",",["T_WHITESPACE","\n                        ",357],["T_STRING","Mage_CatalogInventory_Helper_Data",358],["T_DOUBLE_COLON","::",358],["T_STRING","ERROR_QTY_INCREMENTS",358],",",["T_WHITESPACE","\n                        ",358],["T_VARIABLE","$result",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","getMessage",359],"(",")",["T_WHITESPACE","\n                    ",359],")",";",["T_WHITESPACE","\n\n                    ",360],["T_VARIABLE","$quoteItem",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","getQuote",362],"(",")",["T_OBJECT_OPERATOR","->",362],["T_STRING","addErrorInfo",362],"(",["T_WHITESPACE","\n                        ",362],["T_VARIABLE","$result",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getQuoteMessageIndex",363],"(",")",",",["T_WHITESPACE","\n                        ",363],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",364],",",["T_WHITESPACE","\n                        ",364],["T_STRING","Mage_CatalogInventory_Helper_Data",365],["T_DOUBLE_COLON","::",365],["T_STRING","ERROR_QTY_INCREMENTS",365],",",["T_WHITESPACE","\n                        ",365],["T_VARIABLE","$result",366],["T_OBJECT_OPERATOR","->",366],["T_STRING","getQuoteMessage",366],"(",")",["T_WHITESPACE","\n                    ",366],")",";",["T_WHITESPACE","\n                ",367],"}",["T_WHITESPACE"," ",368],["T_ELSE","else",368],["T_WHITESPACE"," ",368],"{",["T_WHITESPACE","\n                    ",368],["T_COMMENT","\/\/ Delete error from item and its quote, if it was set due to qty problems\n",369],["T_WHITESPACE","                    ",370],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","_removeErrorsFromQuoteAndItem",370],"(",["T_WHITESPACE","\n                        ",370],["T_VARIABLE","$quoteItem",371],",",["T_WHITESPACE","\n                        ",371],["T_STRING","Mage_CatalogInventory_Helper_Data",372],["T_DOUBLE_COLON","::",372],["T_STRING","ERROR_QTY_INCREMENTS",372],["T_WHITESPACE","\n                    ",372],")",";",["T_WHITESPACE","\n                ",373],"}",["T_WHITESPACE","\n            ",374],"}",["T_WHITESPACE","\n\n            ",375],["T_VARIABLE","$quoteItemHasErrors",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_STRING","false",377],";",["T_WHITESPACE","\n            ",377],["T_FOREACH","foreach",378],["T_WHITESPACE"," ",378],"(",["T_VARIABLE","$options",378],["T_WHITESPACE"," ",378],["T_AS","as",378],["T_WHITESPACE"," ",378],["T_VARIABLE","$option",378],")",["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n                ",378],["T_VARIABLE","$optionValue",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_VARIABLE","$option",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","getValue",379],"(",")",";",["T_WHITESPACE","\n                ",379],["T_COMMENT","\/* @var $option Mage_Sales_Model_Quote_Item_Option *\/",380],["T_WHITESPACE","\n                ",380],["T_VARIABLE","$optionQty",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_VARIABLE","$qty",381],["T_WHITESPACE"," ",381],"*",["T_WHITESPACE"," ",381],["T_VARIABLE","$optionValue",381],";",["T_WHITESPACE","\n                ",381],["T_VARIABLE","$increaseOptionQty",382],["T_WHITESPACE"," ",382],"=",["T_WHITESPACE"," ",382],"(",["T_VARIABLE","$quoteItem",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getQtyToAdd",382],"(",")",["T_WHITESPACE"," ",382],"?",["T_WHITESPACE"," ",382],["T_VARIABLE","$quoteItem",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getQtyToAdd",382],"(",")",["T_WHITESPACE"," ",382],":",["T_WHITESPACE"," ",382],["T_VARIABLE","$qty",382],")",["T_WHITESPACE"," ",382],"*",["T_WHITESPACE"," ",382],["T_VARIABLE","$optionValue",382],";",["T_WHITESPACE","\n\n                ",382],["T_VARIABLE","$stockItem",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_VARIABLE","$option",384],["T_OBJECT_OPERATOR","->",384],["T_STRING","getProduct",384],"(",")",["T_OBJECT_OPERATOR","->",384],["T_STRING","getStockItem",384],"(",")",";",["T_WHITESPACE","\n\n                ",384],["T_IF","if",386],["T_WHITESPACE"," ",386],"(",["T_VARIABLE","$quoteItem",386],["T_OBJECT_OPERATOR","->",386],["T_STRING","getProductType",386],"(",")",["T_WHITESPACE"," ",386],["T_IS_EQUAL","==",386],["T_WHITESPACE"," ",386],["T_STRING","Mage_Catalog_Model_Product_Type",386],["T_DOUBLE_COLON","::",386],["T_STRING","TYPE_CONFIGURABLE",386],")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n                    ",386],["T_VARIABLE","$stockItem",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","setParentItem",387],"(",["T_VARIABLE","$quoteItem",387],")",";",["T_WHITESPACE","\n                    ",387],["T_VARIABLE","$stockItem",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","setProductName",388],"(",["T_VARIABLE","$quoteItem",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","getName",388],"(",")",")",";",["T_WHITESPACE","\n                ",388],"}",["T_WHITESPACE","\n\n                ",389],["T_COMMENT","\/* @var $stockItem Mage_CatalogInventory_Model_Stock_Item *\/",391],["T_WHITESPACE","\n                ",391],["T_IF","if",392],["T_WHITESPACE"," ",392],"(","!",["T_VARIABLE","$stockItem",392],["T_WHITESPACE"," ",392],["T_INSTANCEOF","instanceof",392],["T_WHITESPACE"," ",392],["T_STRING","Mage_CatalogInventory_Model_Stock_Item",392],")",["T_WHITESPACE"," ",392],"{",["T_WHITESPACE","\n                    ",392],["T_STRING","Mage",393],["T_DOUBLE_COLON","::",393],["T_STRING","throwException",393],"(",["T_WHITESPACE","\n                        ",393],["T_STRING","Mage",394],["T_DOUBLE_COLON","::",394],["T_STRING","helper",394],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",394],")",["T_OBJECT_OPERATOR","->",394],["T_STRING","__",394],"(",["T_CONSTANT_ENCAPSED_STRING","'The stock item for Product in option is not valid.'",394],")",["T_WHITESPACE","\n                    ",394],")",";",["T_WHITESPACE","\n                ",395],"}",["T_WHITESPACE","\n\n                ",396],["T_DOC_COMMENT","\/**\n                 * define that stock item is child for composite product\n                 *\/",398],["T_WHITESPACE","\n                ",400],["T_VARIABLE","$stockItem",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","setIsChildItem",401],"(",["T_STRING","true",401],")",";",["T_WHITESPACE","\n                ",401],["T_DOC_COMMENT","\/**\n                 * don't check qty increments value for option product\n                 *\/",402],["T_WHITESPACE","\n                ",404],["T_VARIABLE","$stockItem",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","setSuppressCheckQtyIncrements",405],"(",["T_STRING","true",405],")",";",["T_WHITESPACE","\n\n                ",405],["T_VARIABLE","$qtyForCheck",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_VARIABLE","$this",407],["T_OBJECT_OPERATOR","->",407],["T_STRING","_getQuoteItemQtyForCheck",407],"(",["T_WHITESPACE","\n                    ",407],["T_VARIABLE","$option",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","getProduct",408],"(",")",["T_OBJECT_OPERATOR","->",408],["T_STRING","getId",408],"(",")",",",["T_WHITESPACE","\n                    ",408],["T_VARIABLE","$quoteItem",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","getId",409],"(",")",",",["T_WHITESPACE","\n                    ",409],["T_VARIABLE","$increaseOptionQty",410],["T_WHITESPACE","\n                ",410],")",";",["T_WHITESPACE","\n\n                ",411],["T_VARIABLE","$result",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$stockItem",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","checkQuoteItemQty",413],"(",["T_VARIABLE","$optionQty",413],",",["T_WHITESPACE"," ",413],["T_VARIABLE","$qtyForCheck",413],",",["T_WHITESPACE"," ",413],["T_VARIABLE","$optionValue",413],")",";",["T_WHITESPACE","\n\n                ",413],["T_IF","if",415],["T_WHITESPACE"," ",415],"(","!",["T_STRING","is_null",415],"(",["T_VARIABLE","$result",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","getItemIsQtyDecimal",415],"(",")",")",")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n                    ",415],["T_VARIABLE","$option",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","setIsQtyDecimal",416],"(",["T_VARIABLE","$result",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getItemIsQtyDecimal",416],"(",")",")",";",["T_WHITESPACE","\n                ",416],"}",["T_WHITESPACE","\n\n                ",417],["T_IF","if",419],["T_WHITESPACE"," ",419],"(",["T_VARIABLE","$result",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getHasQtyOptionUpdate",419],"(",")",")",["T_WHITESPACE"," ",419],"{",["T_WHITESPACE","\n                    ",419],["T_VARIABLE","$option",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","setHasQtyOptionUpdate",420],"(",["T_STRING","true",420],")",";",["T_WHITESPACE","\n                    ",420],["T_VARIABLE","$quoteItem",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","updateQtyOption",421],"(",["T_VARIABLE","$option",421],",",["T_WHITESPACE"," ",421],["T_VARIABLE","$result",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","getOrigQty",421],"(",")",")",";",["T_WHITESPACE","\n                    ",421],["T_VARIABLE","$option",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","setValue",422],"(",["T_VARIABLE","$result",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getOrigQty",422],"(",")",")",";",["T_WHITESPACE","\n                    ",422],["T_DOC_COMMENT","\/**\n                     * if option's qty was updates we also need to update quote item qty\n                     *\/",423],["T_WHITESPACE","\n                    ",425],["T_VARIABLE","$quoteItem",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","setData",426],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",426],",",["T_WHITESPACE"," ",426],["T_STRING","intval",426],"(",["T_VARIABLE","$qty",426],")",")",";",["T_WHITESPACE","\n                ",426],"}",["T_WHITESPACE","\n                ",427],["T_IF","if",428],["T_WHITESPACE"," ",428],"(","!",["T_STRING","is_null",428],"(",["T_VARIABLE","$result",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","getMessage",428],"(",")",")",")",["T_WHITESPACE"," ",428],"{",["T_WHITESPACE","\n                    ",428],["T_VARIABLE","$option",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","setMessage",429],"(",["T_VARIABLE","$result",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","getMessage",429],"(",")",")",";",["T_WHITESPACE","\n                    ",429],["T_VARIABLE","$quoteItem",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","setMessage",430],"(",["T_VARIABLE","$result",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","getMessage",430],"(",")",")",";",["T_WHITESPACE","\n                ",430],"}",["T_WHITESPACE","\n                ",431],["T_IF","if",432],["T_WHITESPACE"," ",432],"(","!",["T_STRING","is_null",432],"(",["T_VARIABLE","$result",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","getItemBackorders",432],"(",")",")",")",["T_WHITESPACE"," ",432],"{",["T_WHITESPACE","\n                    ",432],["T_VARIABLE","$option",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","setBackorders",433],"(",["T_VARIABLE","$result",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","getItemBackorders",433],"(",")",")",";",["T_WHITESPACE","\n                ",433],"}",["T_WHITESPACE","\n\n                ",434],["T_IF","if",436],["T_WHITESPACE"," ",436],"(",["T_VARIABLE","$result",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getHasError",436],"(",")",")",["T_WHITESPACE"," ",436],"{",["T_WHITESPACE","\n                    ",436],["T_VARIABLE","$option",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","setHasError",437],"(",["T_STRING","true",437],")",";",["T_WHITESPACE","\n                    ",437],["T_VARIABLE","$quoteItemHasErrors",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_STRING","true",438],";",["T_WHITESPACE","\n\n                    ",438],["T_VARIABLE","$quoteItem",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","addErrorInfo",440],"(",["T_WHITESPACE","\n                        ",440],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",441],",",["T_WHITESPACE","\n                        ",441],["T_STRING","Mage_CatalogInventory_Helper_Data",442],["T_DOUBLE_COLON","::",442],["T_STRING","ERROR_QTY",442],",",["T_WHITESPACE","\n                        ",442],["T_VARIABLE","$result",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","getMessage",443],"(",")",["T_WHITESPACE","\n                    ",443],")",";",["T_WHITESPACE","\n\n                    ",444],["T_VARIABLE","$quoteItem",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","getQuote",446],"(",")",["T_OBJECT_OPERATOR","->",446],["T_STRING","addErrorInfo",446],"(",["T_WHITESPACE","\n                        ",446],["T_VARIABLE","$result",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","getQuoteMessageIndex",447],"(",")",",",["T_WHITESPACE","\n                        ",447],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",448],",",["T_WHITESPACE","\n                        ",448],["T_STRING","Mage_CatalogInventory_Helper_Data",449],["T_DOUBLE_COLON","::",449],["T_STRING","ERROR_QTY",449],",",["T_WHITESPACE","\n                        ",449],["T_VARIABLE","$result",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","getQuoteMessage",450],"(",")",["T_WHITESPACE","\n                    ",450],")",";",["T_WHITESPACE","\n                ",451],"}",["T_WHITESPACE"," ",452],["T_ELSEIF","elseif",452],["T_WHITESPACE"," ",452],"(","!",["T_VARIABLE","$quoteItemHasErrors",452],")",["T_WHITESPACE"," ",452],"{",["T_WHITESPACE","\n                    ",452],["T_COMMENT","\/\/ Delete error from item and its quote, if it was set due to qty lack\n",453],["T_WHITESPACE","                    ",454],["T_VARIABLE","$this",454],["T_OBJECT_OPERATOR","->",454],["T_STRING","_removeErrorsFromQuoteAndItem",454],"(",["T_VARIABLE","$quoteItem",454],",",["T_WHITESPACE"," ",454],["T_STRING","Mage_CatalogInventory_Helper_Data",454],["T_DOUBLE_COLON","::",454],["T_STRING","ERROR_QTY",454],")",";",["T_WHITESPACE","\n                ",454],"}",["T_WHITESPACE","\n\n                ",455],["T_VARIABLE","$stockItem",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","unsIsChildItem",457],"(",")",";",["T_WHITESPACE","\n            ",457],"}",["T_WHITESPACE","\n        ",458],"}",["T_WHITESPACE"," ",459],["T_ELSE","else",459],["T_WHITESPACE"," ",459],"{",["T_WHITESPACE","\n            ",459],["T_COMMENT","\/* @var $stockItem Mage_CatalogInventory_Model_Stock_Item *\/",460],["T_WHITESPACE","\n            ",460],["T_IF","if",461],["T_WHITESPACE"," ",461],"(","!",["T_VARIABLE","$stockItem",461],["T_WHITESPACE"," ",461],["T_INSTANCEOF","instanceof",461],["T_WHITESPACE"," ",461],["T_STRING","Mage_CatalogInventory_Model_Stock_Item",461],")",["T_WHITESPACE"," ",461],"{",["T_WHITESPACE","\n                ",461],["T_STRING","Mage",462],["T_DOUBLE_COLON","::",462],["T_STRING","throwException",462],"(",["T_STRING","Mage",462],["T_DOUBLE_COLON","::",462],["T_STRING","helper",462],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",462],")",["T_OBJECT_OPERATOR","->",462],["T_STRING","__",462],"(",["T_CONSTANT_ENCAPSED_STRING","'The stock item for Product is not valid.'",462],")",")",";",["T_WHITESPACE","\n            ",462],"}",["T_WHITESPACE","\n\n            ",463],["T_DOC_COMMENT","\/**\n             * When we work with subitem (as subproduct of bundle or configurable product)\n             *\/",465],["T_WHITESPACE","\n            ",467],["T_IF","if",468],["T_WHITESPACE"," ",468],"(",["T_VARIABLE","$quoteItem",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","getParentItem",468],"(",")",")",["T_WHITESPACE"," ",468],"{",["T_WHITESPACE","\n                ",468],["T_VARIABLE","$rowQty",469],["T_WHITESPACE"," ",469],"=",["T_WHITESPACE"," ",469],["T_VARIABLE","$quoteItem",469],["T_OBJECT_OPERATOR","->",469],["T_STRING","getParentItem",469],"(",")",["T_OBJECT_OPERATOR","->",469],["T_STRING","getQty",469],"(",")",["T_WHITESPACE"," ",469],"*",["T_WHITESPACE"," ",469],["T_VARIABLE","$qty",469],";",["T_WHITESPACE","\n                ",469],["T_DOC_COMMENT","\/**\n                 * we are using 0 because original qty was processed\n                 *\/",470],["T_WHITESPACE","\n                ",472],["T_VARIABLE","$qtyForCheck",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","_getQuoteItemQtyForCheck",473],"(",["T_WHITESPACE","\n                    ",473],["T_VARIABLE","$quoteItem",474],["T_OBJECT_OPERATOR","->",474],["T_STRING","getProduct",474],"(",")",["T_OBJECT_OPERATOR","->",474],["T_STRING","getId",474],"(",")",",",["T_WHITESPACE","\n                    ",474],["T_VARIABLE","$quoteItem",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","getId",475],"(",")",",",["T_WHITESPACE","\n                    ",475],["T_LNUMBER","0",476],["T_WHITESPACE","\n                ",476],")",";",["T_WHITESPACE","\n            ",477],"}",["T_WHITESPACE"," ",478],["T_ELSE","else",478],["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n                ",478],["T_VARIABLE","$increaseQty",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_VARIABLE","$quoteItem",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getQtyToAdd",479],"(",")",["T_WHITESPACE"," ",479],"?",["T_WHITESPACE"," ",479],["T_VARIABLE","$quoteItem",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","getQtyToAdd",479],"(",")",["T_WHITESPACE"," ",479],":",["T_WHITESPACE"," ",479],["T_VARIABLE","$qty",479],";",["T_WHITESPACE","\n                ",479],["T_VARIABLE","$rowQty",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$qty",480],";",["T_WHITESPACE","\n                ",480],["T_VARIABLE","$qtyForCheck",481],["T_WHITESPACE"," ",481],"=",["T_WHITESPACE"," ",481],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","_getQuoteItemQtyForCheck",481],"(",["T_WHITESPACE","\n                    ",481],["T_VARIABLE","$quoteItem",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","getProduct",482],"(",")",["T_OBJECT_OPERATOR","->",482],["T_STRING","getId",482],"(",")",",",["T_WHITESPACE","\n                    ",482],["T_VARIABLE","$quoteItem",483],["T_OBJECT_OPERATOR","->",483],["T_STRING","getId",483],"(",")",",",["T_WHITESPACE","\n                    ",483],["T_VARIABLE","$increaseQty",484],["T_WHITESPACE","\n                ",484],")",";",["T_WHITESPACE","\n            ",485],"}",["T_WHITESPACE","\n\n            ",486],["T_VARIABLE","$productTypeCustomOption",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_VARIABLE","$quoteItem",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","getProduct",488],"(",")",["T_OBJECT_OPERATOR","->",488],["T_STRING","getCustomOption",488],"(",["T_CONSTANT_ENCAPSED_STRING","'product_type'",488],")",";",["T_WHITESPACE","\n            ",488],["T_IF","if",489],["T_WHITESPACE"," ",489],"(","!",["T_STRING","is_null",489],"(",["T_VARIABLE","$productTypeCustomOption",489],")",")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n                ",489],["T_COMMENT","\/\/ Check if product related to current item is a part of grouped product\n",490],["T_WHITESPACE","                ",491],["T_IF","if",491],["T_WHITESPACE"," ",491],"(",["T_VARIABLE","$productTypeCustomOption",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getValue",491],"(",")",["T_WHITESPACE"," ",491],["T_IS_EQUAL","==",491],["T_WHITESPACE"," ",491],["T_STRING","Mage_Catalog_Model_Product_Type_Grouped",491],["T_DOUBLE_COLON","::",491],["T_STRING","TYPE_CODE",491],")",["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n                    ",491],["T_VARIABLE","$stockItem",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","setProductName",492],"(",["T_VARIABLE","$quoteItem",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getProduct",492],"(",")",["T_OBJECT_OPERATOR","->",492],["T_STRING","getName",492],"(",")",")",";",["T_WHITESPACE","\n                    ",492],["T_VARIABLE","$stockItem",493],["T_OBJECT_OPERATOR","->",493],["T_STRING","setIsChildItem",493],"(",["T_STRING","true",493],")",";",["T_WHITESPACE","\n                ",493],"}",["T_WHITESPACE","\n            ",494],"}",["T_WHITESPACE","\n\n            ",495],["T_VARIABLE","$result",497],["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_VARIABLE","$stockItem",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","checkQuoteItemQty",497],"(",["T_VARIABLE","$rowQty",497],",",["T_WHITESPACE"," ",497],["T_VARIABLE","$qtyForCheck",497],",",["T_WHITESPACE"," ",497],["T_VARIABLE","$qty",497],")",";",["T_WHITESPACE","\n\n            ",497],["T_IF","if",499],["T_WHITESPACE"," ",499],"(",["T_VARIABLE","$stockItem",499],["T_OBJECT_OPERATOR","->",499],["T_STRING","hasIsChildItem",499],"(",")",")",["T_WHITESPACE"," ",499],"{",["T_WHITESPACE","\n                ",499],["T_VARIABLE","$stockItem",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","unsIsChildItem",500],"(",")",";",["T_WHITESPACE","\n            ",500],"}",["T_WHITESPACE","\n\n            ",501],["T_IF","if",503],["T_WHITESPACE"," ",503],"(","!",["T_STRING","is_null",503],"(",["T_VARIABLE","$result",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","getItemIsQtyDecimal",503],"(",")",")",")",["T_WHITESPACE"," ",503],"{",["T_WHITESPACE","\n                ",503],["T_VARIABLE","$quoteItem",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","setIsQtyDecimal",504],"(",["T_VARIABLE","$result",504],["T_OBJECT_OPERATOR","->",504],["T_STRING","getItemIsQtyDecimal",504],"(",")",")",";",["T_WHITESPACE","\n                ",504],["T_IF","if",505],["T_WHITESPACE"," ",505],"(",["T_VARIABLE","$quoteItem",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","getParentItem",505],"(",")",")",["T_WHITESPACE"," ",505],"{",["T_WHITESPACE","\n                    ",505],["T_VARIABLE","$quoteItem",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getParentItem",506],"(",")",["T_OBJECT_OPERATOR","->",506],["T_STRING","setIsQtyDecimal",506],"(",["T_VARIABLE","$result",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","getItemIsQtyDecimal",506],"(",")",")",";",["T_WHITESPACE","\n                ",506],"}",["T_WHITESPACE","\n            ",507],"}",["T_WHITESPACE","\n\n            ",508],["T_DOC_COMMENT","\/**\n             * Just base (parent) item qty can be changed\n             * qty of child products are declared just during add process\n             * exception for updating also managed by product type\n             *\/",510],["T_WHITESPACE","\n            ",514],["T_IF","if",515],["T_WHITESPACE"," ",515],"(",["T_VARIABLE","$result",515],["T_OBJECT_OPERATOR","->",515],["T_STRING","getHasQtyOptionUpdate",515],"(",")",["T_WHITESPACE","\n                ",515],["T_BOOLEAN_AND","&&",516],["T_WHITESPACE"," ",516],"(","!",["T_VARIABLE","$quoteItem",516],["T_OBJECT_OPERATOR","->",516],["T_STRING","getParentItem",516],"(",")",["T_WHITESPACE","\n                    ",516],["T_BOOLEAN_OR","||",517],["T_WHITESPACE"," ",517],["T_VARIABLE","$quoteItem",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","getParentItem",517],"(",")",["T_OBJECT_OPERATOR","->",517],["T_STRING","getProduct",517],"(",")",["T_OBJECT_OPERATOR","->",517],["T_STRING","getTypeInstance",517],"(",["T_STRING","true",517],")",["T_WHITESPACE","\n                        ",517],["T_OBJECT_OPERATOR","->",518],["T_STRING","getForceChildItemQtyChanges",518],"(",["T_VARIABLE","$quoteItem",518],["T_OBJECT_OPERATOR","->",518],["T_STRING","getParentItem",518],"(",")",["T_OBJECT_OPERATOR","->",518],["T_STRING","getProduct",518],"(",")",")",["T_WHITESPACE","\n                ",518],")",["T_WHITESPACE","\n            ",519],")",["T_WHITESPACE"," ",520],"{",["T_WHITESPACE","\n                ",520],["T_VARIABLE","$quoteItem",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","setData",521],"(",["T_CONSTANT_ENCAPSED_STRING","'qty'",521],",",["T_WHITESPACE"," ",521],["T_VARIABLE","$result",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","getOrigQty",521],"(",")",")",";",["T_WHITESPACE","\n            ",521],"}",["T_WHITESPACE","\n\n            ",522],["T_IF","if",524],["T_WHITESPACE"," ",524],"(","!",["T_STRING","is_null",524],"(",["T_VARIABLE","$result",524],["T_OBJECT_OPERATOR","->",524],["T_STRING","getItemUseOldQty",524],"(",")",")",")",["T_WHITESPACE"," ",524],"{",["T_WHITESPACE","\n                ",524],["T_VARIABLE","$quoteItem",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","setUseOldQty",525],"(",["T_VARIABLE","$result",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","getItemUseOldQty",525],"(",")",")",";",["T_WHITESPACE","\n            ",525],"}",["T_WHITESPACE","\n            ",526],["T_IF","if",527],["T_WHITESPACE"," ",527],"(","!",["T_STRING","is_null",527],"(",["T_VARIABLE","$result",527],["T_OBJECT_OPERATOR","->",527],["T_STRING","getMessage",527],"(",")",")",")",["T_WHITESPACE"," ",527],"{",["T_WHITESPACE","\n                ",527],["T_VARIABLE","$quoteItem",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","setMessage",528],"(",["T_VARIABLE","$result",528],["T_OBJECT_OPERATOR","->",528],["T_STRING","getMessage",528],"(",")",")",";",["T_WHITESPACE","\n            ",528],"}",["T_WHITESPACE","\n\n            ",529],["T_IF","if",531],["T_WHITESPACE"," ",531],"(","!",["T_STRING","is_null",531],"(",["T_VARIABLE","$result",531],["T_OBJECT_OPERATOR","->",531],["T_STRING","getItemBackorders",531],"(",")",")",")",["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n                ",531],["T_VARIABLE","$quoteItem",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","setBackorders",532],"(",["T_VARIABLE","$result",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","getItemBackorders",532],"(",")",")",";",["T_WHITESPACE","\n            ",532],"}",["T_WHITESPACE","\n\n            ",533],["T_IF","if",535],["T_WHITESPACE"," ",535],"(",["T_VARIABLE","$result",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","getHasError",535],"(",")",")",["T_WHITESPACE"," ",535],"{",["T_WHITESPACE","\n                ",535],["T_VARIABLE","$quoteItem",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","addErrorInfo",536],"(",["T_WHITESPACE","\n                    ",536],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",537],",",["T_WHITESPACE","\n                    ",537],["T_STRING","Mage_CatalogInventory_Helper_Data",538],["T_DOUBLE_COLON","::",538],["T_STRING","ERROR_QTY",538],",",["T_WHITESPACE","\n                    ",538],["T_VARIABLE","$result",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","getMessage",539],"(",")",["T_WHITESPACE","\n                ",539],")",";",["T_WHITESPACE","\n\n                ",540],["T_VARIABLE","$quoteItem",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","getQuote",542],"(",")",["T_OBJECT_OPERATOR","->",542],["T_STRING","addErrorInfo",542],"(",["T_WHITESPACE","\n                    ",542],["T_VARIABLE","$result",543],["T_OBJECT_OPERATOR","->",543],["T_STRING","getQuoteMessageIndex",543],"(",")",",",["T_WHITESPACE","\n                    ",543],["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",544],",",["T_WHITESPACE","\n                    ",544],["T_STRING","Mage_CatalogInventory_Helper_Data",545],["T_DOUBLE_COLON","::",545],["T_STRING","ERROR_QTY",545],",",["T_WHITESPACE","\n                    ",545],["T_VARIABLE","$result",546],["T_OBJECT_OPERATOR","->",546],["T_STRING","getQuoteMessage",546],"(",")",["T_WHITESPACE","\n                ",546],")",";",["T_WHITESPACE","\n            ",547],"}",["T_WHITESPACE"," ",548],["T_ELSE","else",548],["T_WHITESPACE"," ",548],"{",["T_WHITESPACE","\n                ",548],["T_COMMENT","\/\/ Delete error from item and its quote, if it was set due to qty lack\n",549],["T_WHITESPACE","                ",550],["T_VARIABLE","$this",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","_removeErrorsFromQuoteAndItem",550],"(",["T_VARIABLE","$quoteItem",550],",",["T_WHITESPACE"," ",550],["T_STRING","Mage_CatalogInventory_Helper_Data",550],["T_DOUBLE_COLON","::",550],["T_STRING","ERROR_QTY",550],")",";",["T_WHITESPACE","\n            ",550],"}",["T_WHITESPACE","\n        ",551],"}",["T_WHITESPACE","\n\n        ",552],["T_RETURN","return",554],["T_WHITESPACE"," ",554],["T_VARIABLE","$this",554],";",["T_WHITESPACE","\n    ",554],"}",["T_WHITESPACE","\n\n    ",555],["T_DOC_COMMENT","\/**\n     * Get product qty includes information from all quote items\n     * Need be used only in sungleton mode\n     *\n     * @deprecated after 1.4.2.0-rc1\n     * @param int $productId\n     * @param float $itemQty\n     *\/",557],["T_WHITESPACE","\n    ",564],["T_PROTECTED","protected",565],["T_WHITESPACE"," ",565],["T_FUNCTION","function",565],["T_WHITESPACE"," ",565],["T_STRING","_getProductQtyForCheck",565],"(",["T_VARIABLE","$productId",565],",",["T_WHITESPACE"," ",565],["T_VARIABLE","$itemQty",565],")",["T_WHITESPACE","\n    ",565],"{",["T_WHITESPACE","\n        ",566],["T_VARIABLE","$qty",567],["T_WHITESPACE"," ",567],"=",["T_WHITESPACE"," ",567],["T_VARIABLE","$itemQty",567],";",["T_WHITESPACE","\n        ",567],["T_IF","if",568],["T_WHITESPACE"," ",568],"(",["T_ISSET","isset",568],"(",["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_checkedProductsQty",568],"[",["T_VARIABLE","$productId",568],"]",")",")",["T_WHITESPACE"," ",568],"{",["T_WHITESPACE","\n            ",568],["T_VARIABLE","$qty",569],["T_WHITESPACE"," ",569],["T_PLUS_EQUAL","+=",569],["T_WHITESPACE"," ",569],["T_VARIABLE","$this",569],["T_OBJECT_OPERATOR","->",569],["T_STRING","_checkedProductsQty",569],"[",["T_VARIABLE","$productId",569],"]",";",["T_WHITESPACE","\n        ",569],"}",["T_WHITESPACE","\n        ",570],["T_VARIABLE","$this",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","_checkedProductsQty",571],"[",["T_VARIABLE","$productId",571],"]",["T_WHITESPACE"," ",571],"=",["T_WHITESPACE"," ",571],["T_VARIABLE","$qty",571],";",["T_WHITESPACE","\n        ",571],["T_RETURN","return",572],["T_WHITESPACE"," ",572],["T_VARIABLE","$qty",572],";",["T_WHITESPACE","\n    ",572],"}",["T_WHITESPACE","\n\n    ",573],["T_DOC_COMMENT","\/**\n     * Get product qty includes information from all quote items\n     * Need be used only in sungleton mode\n     *\n     * @param int   $productId\n     * @param int   $quoteItemId\n     * @param float $itemQty\n     * @return int\n     *\/",575],["T_WHITESPACE","\n    ",583],["T_PROTECTED","protected",584],["T_WHITESPACE"," ",584],["T_FUNCTION","function",584],["T_WHITESPACE"," ",584],["T_STRING","_getQuoteItemQtyForCheck",584],"(",["T_VARIABLE","$productId",584],",",["T_WHITESPACE"," ",584],["T_VARIABLE","$quoteItemId",584],",",["T_WHITESPACE"," ",584],["T_VARIABLE","$itemQty",584],")",["T_WHITESPACE","\n    ",584],"{",["T_WHITESPACE","\n        ",585],["T_VARIABLE","$qty",586],["T_WHITESPACE"," ",586],"=",["T_WHITESPACE"," ",586],["T_VARIABLE","$itemQty",586],";",["T_WHITESPACE","\n        ",586],["T_IF","if",587],["T_WHITESPACE"," ",587],"(",["T_ISSET","isset",587],"(",["T_VARIABLE","$this",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","_checkedQuoteItems",587],"[",["T_VARIABLE","$productId",587],"]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",587],"]",")",["T_WHITESPACE"," ",587],["T_BOOLEAN_AND","&&",587],["T_WHITESPACE","\n            ",587],"!",["T_STRING","in_array",588],"(",["T_VARIABLE","$quoteItemId",588],",",["T_WHITESPACE"," ",588],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","_checkedQuoteItems",588],"[",["T_VARIABLE","$productId",588],"]","[",["T_CONSTANT_ENCAPSED_STRING","'items'",588],"]",")",")",["T_WHITESPACE"," ",588],"{",["T_WHITESPACE","\n                ",588],["T_VARIABLE","$qty",589],["T_WHITESPACE"," ",589],["T_PLUS_EQUAL","+=",589],["T_WHITESPACE"," ",589],["T_VARIABLE","$this",589],["T_OBJECT_OPERATOR","->",589],["T_STRING","_checkedQuoteItems",589],"[",["T_VARIABLE","$productId",589],"]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",589],"]",";",["T_WHITESPACE","\n        ",589],"}",["T_WHITESPACE","\n\n        ",590],["T_VARIABLE","$this",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","_checkedQuoteItems",592],"[",["T_VARIABLE","$productId",592],"]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",592],"]",["T_WHITESPACE"," ",592],"=",["T_WHITESPACE"," ",592],["T_VARIABLE","$qty",592],";",["T_WHITESPACE","\n        ",592],["T_VARIABLE","$this",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","_checkedQuoteItems",593],"[",["T_VARIABLE","$productId",593],"]","[",["T_CONSTANT_ENCAPSED_STRING","'items'",593],"]","[","]",["T_WHITESPACE"," ",593],"=",["T_WHITESPACE"," ",593],["T_VARIABLE","$quoteItemId",593],";",["T_WHITESPACE","\n\n        ",593],["T_RETURN","return",595],["T_WHITESPACE"," ",595],["T_VARIABLE","$qty",595],";",["T_WHITESPACE","\n    ",595],"}",["T_WHITESPACE","\n\n    ",596],["T_DOC_COMMENT","\/**\n     * Subtract qtys of quote item products after multishipping checkout\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",598],["T_WHITESPACE","\n    ",603],["T_PUBLIC","public",604],["T_WHITESPACE"," ",604],["T_FUNCTION","function",604],["T_WHITESPACE"," ",604],["T_STRING","checkoutAllSubmitAfter",604],"(",["T_STRING","Varien_Event_Observer",604],["T_WHITESPACE"," ",604],["T_VARIABLE","$observer",604],")",["T_WHITESPACE","\n    ",604],"{",["T_WHITESPACE","\n        ",605],["T_VARIABLE","$quote",606],["T_WHITESPACE"," ",606],"=",["T_WHITESPACE"," ",606],["T_VARIABLE","$observer",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","getEvent",606],"(",")",["T_OBJECT_OPERATOR","->",606],["T_STRING","getQuote",606],"(",")",";",["T_WHITESPACE","\n        ",606],["T_IF","if",607],["T_WHITESPACE"," ",607],"(","!",["T_VARIABLE","$quote",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","getInventoryProcessed",607],"(",")",")",["T_WHITESPACE"," ",607],"{",["T_WHITESPACE","\n            ",607],["T_VARIABLE","$this",608],["T_OBJECT_OPERATOR","->",608],["T_STRING","subtractQuoteInventory",608],"(",["T_VARIABLE","$observer",608],")",";",["T_WHITESPACE","\n            ",608],["T_VARIABLE","$this",609],["T_OBJECT_OPERATOR","->",609],["T_STRING","reindexQuoteInventory",609],"(",["T_VARIABLE","$observer",609],")",";",["T_WHITESPACE","\n        ",609],"}",["T_WHITESPACE","\n        ",610],["T_RETURN","return",611],["T_WHITESPACE"," ",611],["T_VARIABLE","$this",611],";",["T_WHITESPACE","\n    ",611],"}",["T_WHITESPACE","\n\n    ",612],["T_DOC_COMMENT","\/**\n     * Subtract quote items qtys from stock items related with quote items products.\n     *\n     * Used before order placing to make order save\/place transaction smaller\n     * Also called after every successful order placement to ensure subtraction of inventory\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",614],["T_WHITESPACE","\n    ",621],["T_PUBLIC","public",622],["T_WHITESPACE"," ",622],["T_FUNCTION","function",622],["T_WHITESPACE"," ",622],["T_STRING","subtractQuoteInventory",622],"(",["T_STRING","Varien_Event_Observer",622],["T_WHITESPACE"," ",622],["T_VARIABLE","$observer",622],")",["T_WHITESPACE","\n    ",622],"{",["T_WHITESPACE","\n        ",623],["T_VARIABLE","$quote",624],["T_WHITESPACE"," ",624],"=",["T_WHITESPACE"," ",624],["T_VARIABLE","$observer",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","getEvent",624],"(",")",["T_OBJECT_OPERATOR","->",624],["T_STRING","getQuote",624],"(",")",";",["T_WHITESPACE","\n\n        ",624],["T_COMMENT","\/\/ Maybe we've already processed this quote in some event during order placement\n",626],["T_WHITESPACE","        ",627],["T_COMMENT","\/\/ e.g. call in event 'sales_model_service_quote_submit_before' and later in 'checkout_submit_all_after'\n",627],["T_WHITESPACE","        ",628],["T_IF","if",628],["T_WHITESPACE"," ",628],"(",["T_VARIABLE","$quote",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","getInventoryProcessed",628],"(",")",")",["T_WHITESPACE"," ",628],"{",["T_WHITESPACE","\n            ",628],["T_RETURN","return",629],";",["T_WHITESPACE","\n        ",629],"}",["T_WHITESPACE","\n        ",630],["T_VARIABLE","$items",631],["T_WHITESPACE"," ",631],"=",["T_WHITESPACE"," ",631],["T_VARIABLE","$this",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","_getProductsQty",631],"(",["T_VARIABLE","$quote",631],["T_OBJECT_OPERATOR","->",631],["T_STRING","getAllItems",631],"(",")",")",";",["T_WHITESPACE","\n\n        ",631],["T_DOC_COMMENT","\/**\n         * Remember items\n         *\/",633],["T_WHITESPACE","\n        ",635],["T_VARIABLE","$this",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","_itemsForReindex",636],["T_WHITESPACE"," ",636],"=",["T_WHITESPACE"," ",636],["T_STRING","Mage",636],["T_DOUBLE_COLON","::",636],["T_STRING","getSingleton",636],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",636],")",["T_OBJECT_OPERATOR","->",636],["T_STRING","registerProductsSale",636],"(",["T_VARIABLE","$items",636],")",";",["T_WHITESPACE","\n\n        ",636],["T_VARIABLE","$quote",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","setInventoryProcessed",638],"(",["T_STRING","true",638],")",";",["T_WHITESPACE","\n        ",638],["T_RETURN","return",639],["T_WHITESPACE"," ",639],["T_VARIABLE","$this",639],";",["T_WHITESPACE","\n    ",639],"}",["T_WHITESPACE","\n\n    ",640],["T_DOC_COMMENT","\/**\n     * Revert quote items inventory data (cover not success order place case)\n     * @param $observer\n     *\/",642],["T_WHITESPACE","\n    ",645],["T_PUBLIC","public",646],["T_WHITESPACE"," ",646],["T_FUNCTION","function",646],["T_WHITESPACE"," ",646],["T_STRING","revertQuoteInventory",646],"(",["T_VARIABLE","$observer",646],")",["T_WHITESPACE","\n    ",646],"{",["T_WHITESPACE","\n        ",647],["T_VARIABLE","$quote",648],["T_WHITESPACE"," ",648],"=",["T_WHITESPACE"," ",648],["T_VARIABLE","$observer",648],["T_OBJECT_OPERATOR","->",648],["T_STRING","getEvent",648],"(",")",["T_OBJECT_OPERATOR","->",648],["T_STRING","getQuote",648],"(",")",";",["T_WHITESPACE","\n        ",648],["T_VARIABLE","$items",649],["T_WHITESPACE"," ",649],"=",["T_WHITESPACE"," ",649],["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","_getProductsQty",649],"(",["T_VARIABLE","$quote",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","getAllItems",649],"(",")",")",";",["T_WHITESPACE","\n        ",649],["T_STRING","Mage",650],["T_DOUBLE_COLON","::",650],["T_STRING","getSingleton",650],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",650],")",["T_OBJECT_OPERATOR","->",650],["T_STRING","revertProductsSale",650],"(",["T_VARIABLE","$items",650],")",";",["T_WHITESPACE","\n\n        ",650],["T_COMMENT","\/\/ Clear flag, so if order placement retried again with success - it will be processed\n",652],["T_WHITESPACE","        ",653],["T_VARIABLE","$quote",653],["T_OBJECT_OPERATOR","->",653],["T_STRING","setInventoryProcessed",653],"(",["T_STRING","false",653],")",";",["T_WHITESPACE","\n    ",653],"}",["T_WHITESPACE","\n\n    ",654],["T_DOC_COMMENT","\/**\n     * Adds stock item qty to $items (creates new entry or increments existing one)\n     * $items is array with following structure:\n     * array(\n     *  $productId  => array(\n     *      'qty'   => $qty,\n     *      'item'  => $stockItems|null\n     *  )\n     * )\n     *\n     * @param Mage_Sales_Model_Quote_Item $quoteItem\n     * @param array &$items\n     *\/",656],["T_WHITESPACE","\n    ",668],["T_PROTECTED","protected",669],["T_WHITESPACE"," ",669],["T_FUNCTION","function",669],["T_WHITESPACE"," ",669],["T_STRING","_addItemToQtyArray",669],"(",["T_VARIABLE","$quoteItem",669],",",["T_WHITESPACE"," ",669],"&",["T_VARIABLE","$items",669],")",["T_WHITESPACE","\n    ",669],"{",["T_WHITESPACE","\n        ",670],["T_VARIABLE","$productId",671],["T_WHITESPACE"," ",671],"=",["T_WHITESPACE"," ",671],["T_VARIABLE","$quoteItem",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","getProductId",671],"(",")",";",["T_WHITESPACE","\n        ",671],["T_IF","if",672],["T_WHITESPACE"," ",672],"(","!",["T_VARIABLE","$productId",672],")",["T_WHITESPACE","\n            ",672],["T_RETURN","return",673],";",["T_WHITESPACE","\n        ",673],["T_IF","if",674],["T_WHITESPACE"," ",674],"(",["T_ISSET","isset",674],"(",["T_VARIABLE","$items",674],"[",["T_VARIABLE","$productId",674],"]",")",")",["T_WHITESPACE"," ",674],"{",["T_WHITESPACE","\n            ",674],["T_VARIABLE","$items",675],"[",["T_VARIABLE","$productId",675],"]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",675],"]",["T_WHITESPACE"," ",675],["T_PLUS_EQUAL","+=",675],["T_WHITESPACE"," ",675],["T_VARIABLE","$quoteItem",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getTotalQty",675],"(",")",";",["T_WHITESPACE","\n        ",675],"}",["T_WHITESPACE"," ",676],["T_ELSE","else",676],["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n            ",676],["T_VARIABLE","$stockItem",677],["T_WHITESPACE"," ",677],"=",["T_WHITESPACE"," ",677],["T_STRING","null",677],";",["T_WHITESPACE","\n            ",677],["T_IF","if",678],["T_WHITESPACE"," ",678],"(",["T_VARIABLE","$quoteItem",678],["T_OBJECT_OPERATOR","->",678],["T_STRING","getProduct",678],"(",")",")",["T_WHITESPACE"," ",678],"{",["T_WHITESPACE","\n                ",678],["T_VARIABLE","$stockItem",679],["T_WHITESPACE"," ",679],"=",["T_WHITESPACE"," ",679],["T_VARIABLE","$quoteItem",679],["T_OBJECT_OPERATOR","->",679],["T_STRING","getProduct",679],"(",")",["T_OBJECT_OPERATOR","->",679],["T_STRING","getStockItem",679],"(",")",";",["T_WHITESPACE","\n            ",679],"}",["T_WHITESPACE","\n            ",680],["T_VARIABLE","$items",681],"[",["T_VARIABLE","$productId",681],"]",["T_WHITESPACE"," ",681],"=",["T_WHITESPACE"," ",681],["T_ARRAY","array",681],"(",["T_WHITESPACE","\n                ",681],["T_CONSTANT_ENCAPSED_STRING","'item'",682],["T_WHITESPACE"," ",682],["T_DOUBLE_ARROW","=>",682],["T_WHITESPACE"," ",682],["T_VARIABLE","$stockItem",682],",",["T_WHITESPACE","\n                ",682],["T_CONSTANT_ENCAPSED_STRING","'qty'",683],["T_WHITESPACE","  ",683],["T_DOUBLE_ARROW","=>",683],["T_WHITESPACE"," ",683],["T_VARIABLE","$quoteItem",683],["T_OBJECT_OPERATOR","->",683],["T_STRING","getTotalQty",683],"(",")",["T_WHITESPACE","\n            ",683],")",";",["T_WHITESPACE","\n        ",684],"}",["T_WHITESPACE","\n    ",685],"}",["T_WHITESPACE","\n\n    ",686],["T_DOC_COMMENT","\/**\n     * Prepare array with information about used product qty and product stock item\n     * result is:\n     * array(\n     *  $productId  => array(\n     *      'qty'   => $qty,\n     *      'item'  => $stockItems|null\n     *  )\n     * )\n     * @param array $relatedItems\n     * @return array\n     *\/",688],["T_WHITESPACE","\n    ",699],["T_PROTECTED","protected",700],["T_WHITESPACE"," ",700],["T_FUNCTION","function",700],["T_WHITESPACE"," ",700],["T_STRING","_getProductsQty",700],"(",["T_VARIABLE","$relatedItems",700],")",["T_WHITESPACE","\n    ",700],"{",["T_WHITESPACE","\n        ",701],["T_VARIABLE","$items",702],["T_WHITESPACE"," ",702],"=",["T_WHITESPACE"," ",702],["T_ARRAY","array",702],"(",")",";",["T_WHITESPACE","\n        ",702],["T_FOREACH","foreach",703],["T_WHITESPACE"," ",703],"(",["T_VARIABLE","$relatedItems",703],["T_WHITESPACE"," ",703],["T_AS","as",703],["T_WHITESPACE"," ",703],["T_VARIABLE","$item",703],")",["T_WHITESPACE"," ",703],"{",["T_WHITESPACE","\n            ",703],["T_VARIABLE","$productId",704],["T_WHITESPACE","  ",704],"=",["T_WHITESPACE"," ",704],["T_VARIABLE","$item",704],["T_OBJECT_OPERATOR","->",704],["T_STRING","getProductId",704],"(",")",";",["T_WHITESPACE","\n            ",704],["T_IF","if",705],["T_WHITESPACE"," ",705],"(","!",["T_VARIABLE","$productId",705],")",["T_WHITESPACE"," ",705],"{",["T_WHITESPACE","\n                ",705],["T_CONTINUE","continue",706],";",["T_WHITESPACE","\n            ",706],"}",["T_WHITESPACE","\n            ",707],["T_VARIABLE","$children",708],["T_WHITESPACE"," ",708],"=",["T_WHITESPACE"," ",708],["T_VARIABLE","$item",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","getChildrenItems",708],"(",")",";",["T_WHITESPACE","\n            ",708],["T_IF","if",709],["T_WHITESPACE"," ",709],"(",["T_VARIABLE","$children",709],")",["T_WHITESPACE"," ",709],"{",["T_WHITESPACE","\n                ",709],["T_FOREACH","foreach",710],["T_WHITESPACE"," ",710],"(",["T_VARIABLE","$children",710],["T_WHITESPACE"," ",710],["T_AS","as",710],["T_WHITESPACE"," ",710],["T_VARIABLE","$childItem",710],")",["T_WHITESPACE"," ",710],"{",["T_WHITESPACE","\n                    ",710],["T_VARIABLE","$this",711],["T_OBJECT_OPERATOR","->",711],["T_STRING","_addItemToQtyArray",711],"(",["T_VARIABLE","$childItem",711],",",["T_WHITESPACE"," ",711],["T_VARIABLE","$items",711],")",";",["T_WHITESPACE","\n                ",711],"}",["T_WHITESPACE","\n            ",712],"}",["T_WHITESPACE"," ",713],["T_ELSE","else",713],["T_WHITESPACE"," ",713],"{",["T_WHITESPACE","\n                ",713],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","_addItemToQtyArray",714],"(",["T_VARIABLE","$item",714],",",["T_WHITESPACE"," ",714],["T_VARIABLE","$items",714],")",";",["T_WHITESPACE","\n            ",714],"}",["T_WHITESPACE","\n        ",715],"}",["T_WHITESPACE","\n        ",716],["T_RETURN","return",717],["T_WHITESPACE"," ",717],["T_VARIABLE","$items",717],";",["T_WHITESPACE","\n    ",717],"}",["T_WHITESPACE","\n\n    ",718],["T_DOC_COMMENT","\/**\n     * Refresh stock index for specific stock items after succesful order placement\n     *\n     * @param $observer\n     *\/",720],["T_WHITESPACE","\n    ",724],["T_PUBLIC","public",725],["T_WHITESPACE"," ",725],["T_FUNCTION","function",725],["T_WHITESPACE"," ",725],["T_STRING","reindexQuoteInventory",725],"(",["T_VARIABLE","$observer",725],")",["T_WHITESPACE","\n    ",725],"{",["T_WHITESPACE","\n        ",726],["T_COMMENT","\/\/ Reindex quote ids\n",727],["T_WHITESPACE","        ",728],["T_VARIABLE","$quote",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_VARIABLE","$observer",728],["T_OBJECT_OPERATOR","->",728],["T_STRING","getEvent",728],"(",")",["T_OBJECT_OPERATOR","->",728],["T_STRING","getQuote",728],"(",")",";",["T_WHITESPACE","\n        ",728],["T_VARIABLE","$productIds",729],["T_WHITESPACE"," ",729],"=",["T_WHITESPACE"," ",729],["T_ARRAY","array",729],"(",")",";",["T_WHITESPACE","\n        ",729],["T_FOREACH","foreach",730],["T_WHITESPACE"," ",730],"(",["T_VARIABLE","$quote",730],["T_OBJECT_OPERATOR","->",730],["T_STRING","getAllItems",730],"(",")",["T_WHITESPACE"," ",730],["T_AS","as",730],["T_WHITESPACE"," ",730],["T_VARIABLE","$item",730],")",["T_WHITESPACE"," ",730],"{",["T_WHITESPACE","\n            ",730],["T_VARIABLE","$productIds",731],"[",["T_VARIABLE","$item",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getProductId",731],"(",")","]",["T_WHITESPACE"," ",731],"=",["T_WHITESPACE"," ",731],["T_VARIABLE","$item",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","getProductId",731],"(",")",";",["T_WHITESPACE","\n            ",731],["T_VARIABLE","$children",732],["T_WHITESPACE","   ",732],"=",["T_WHITESPACE"," ",732],["T_VARIABLE","$item",732],["T_OBJECT_OPERATOR","->",732],["T_STRING","getChildrenItems",732],"(",")",";",["T_WHITESPACE","\n            ",732],["T_IF","if",733],["T_WHITESPACE"," ",733],"(",["T_VARIABLE","$children",733],")",["T_WHITESPACE"," ",733],"{",["T_WHITESPACE","\n                ",733],["T_FOREACH","foreach",734],["T_WHITESPACE"," ",734],"(",["T_VARIABLE","$children",734],["T_WHITESPACE"," ",734],["T_AS","as",734],["T_WHITESPACE"," ",734],["T_VARIABLE","$childItem",734],")",["T_WHITESPACE"," ",734],"{",["T_WHITESPACE","\n                    ",734],["T_VARIABLE","$productIds",735],"[",["T_VARIABLE","$childItem",735],["T_OBJECT_OPERATOR","->",735],["T_STRING","getProductId",735],"(",")","]",["T_WHITESPACE"," ",735],"=",["T_WHITESPACE"," ",735],["T_VARIABLE","$childItem",735],["T_OBJECT_OPERATOR","->",735],["T_STRING","getProductId",735],"(",")",";",["T_WHITESPACE","\n                ",735],"}",["T_WHITESPACE","\n            ",736],"}",["T_WHITESPACE","\n        ",737],"}",["T_WHITESPACE","\n\n        ",738],["T_IF","if",740],["T_WHITESPACE"," ",740],"(",["T_STRING","count",740],"(",["T_VARIABLE","$productIds",740],")",")",["T_WHITESPACE"," ",740],"{",["T_WHITESPACE","\n            ",740],["T_STRING","Mage",741],["T_DOUBLE_COLON","::",741],["T_STRING","getResourceSingleton",741],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/indexer_stock'",741],")",["T_OBJECT_OPERATOR","->",741],["T_STRING","reindexProducts",741],"(",["T_VARIABLE","$productIds",741],")",";",["T_WHITESPACE","\n        ",741],"}",["T_WHITESPACE","\n\n        ",742],["T_COMMENT","\/\/ Reindex previously remembered items\n",744],["T_WHITESPACE","        ",745],["T_VARIABLE","$productIds",745],["T_WHITESPACE"," ",745],"=",["T_WHITESPACE"," ",745],["T_ARRAY","array",745],"(",")",";",["T_WHITESPACE","\n        ",745],["T_FOREACH","foreach",746],["T_WHITESPACE"," ",746],"(",["T_VARIABLE","$this",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","_itemsForReindex",746],["T_WHITESPACE"," ",746],["T_AS","as",746],["T_WHITESPACE"," ",746],["T_VARIABLE","$item",746],")",["T_WHITESPACE"," ",746],"{",["T_WHITESPACE","\n            ",746],["T_VARIABLE","$item",747],["T_OBJECT_OPERATOR","->",747],["T_STRING","save",747],"(",")",";",["T_WHITESPACE","\n            ",747],["T_VARIABLE","$productIds",748],"[","]",["T_WHITESPACE"," ",748],"=",["T_WHITESPACE"," ",748],["T_VARIABLE","$item",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","getProductId",748],"(",")",";",["T_WHITESPACE","\n        ",748],"}",["T_WHITESPACE","\n        ",749],["T_STRING","Mage",750],["T_DOUBLE_COLON","::",750],["T_STRING","getResourceSingleton",750],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product_indexer_price'",750],")",["T_OBJECT_OPERATOR","->",750],["T_STRING","reindexProductIds",750],"(",["T_VARIABLE","$productIds",750],")",";",["T_WHITESPACE","\n\n        ",750],["T_VARIABLE","$this",752],["T_OBJECT_OPERATOR","->",752],["T_STRING","_itemsForReindex",752],["T_WHITESPACE"," ",752],"=",["T_WHITESPACE"," ",752],["T_ARRAY","array",752],"(",")",";",["T_WHITESPACE"," ",752],["T_COMMENT","\/\/ Clear list of remembered items - we don't need it anymore\n",752],["T_WHITESPACE","\n        ",753],["T_RETURN","return",754],["T_WHITESPACE"," ",754],["T_VARIABLE","$this",754],";",["T_WHITESPACE","\n    ",754],"}",["T_WHITESPACE","\n\n    ",755],["T_DOC_COMMENT","\/**\n     * Return creditmemo items qty to stock\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",757],["T_WHITESPACE","\n    ",761],["T_PUBLIC","public",762],["T_WHITESPACE"," ",762],["T_FUNCTION","function",762],["T_WHITESPACE"," ",762],["T_STRING","refundOrderInventory",762],"(",["T_VARIABLE","$observer",762],")",["T_WHITESPACE","\n    ",762],"{",["T_WHITESPACE","\n        ",763],["T_COMMENT","\/* @var $creditmemo Mage_Sales_Model_Order_Creditmemo *\/",764],["T_WHITESPACE","\n        ",764],["T_VARIABLE","$creditmemo",765],["T_WHITESPACE"," ",765],"=",["T_WHITESPACE"," ",765],["T_VARIABLE","$observer",765],["T_OBJECT_OPERATOR","->",765],["T_STRING","getEvent",765],"(",")",["T_OBJECT_OPERATOR","->",765],["T_STRING","getCreditmemo",765],"(",")",";",["T_WHITESPACE","\n        ",765],["T_VARIABLE","$items",766],["T_WHITESPACE"," ",766],"=",["T_WHITESPACE"," ",766],["T_ARRAY","array",766],"(",")",";",["T_WHITESPACE","\n        ",766],["T_FOREACH","foreach",767],["T_WHITESPACE"," ",767],"(",["T_VARIABLE","$creditmemo",767],["T_OBJECT_OPERATOR","->",767],["T_STRING","getAllItems",767],"(",")",["T_WHITESPACE"," ",767],["T_AS","as",767],["T_WHITESPACE"," ",767],["T_VARIABLE","$item",767],")",["T_WHITESPACE"," ",767],"{",["T_WHITESPACE","\n            ",767],["T_COMMENT","\/* @var $item Mage_Sales_Model_Order_Creditmemo_Item *\/",768],["T_WHITESPACE","\n            ",768],["T_VARIABLE","$return",769],["T_WHITESPACE"," ",769],"=",["T_WHITESPACE"," ",769],["T_STRING","false",769],";",["T_WHITESPACE","\n            ",769],["T_IF","if",770],["T_WHITESPACE"," ",770],"(",["T_VARIABLE","$item",770],["T_OBJECT_OPERATOR","->",770],["T_STRING","hasBackToStock",770],"(",")",")",["T_WHITESPACE"," ",770],"{",["T_WHITESPACE","\n                ",770],["T_IF","if",771],["T_WHITESPACE"," ",771],"(",["T_VARIABLE","$item",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getBackToStock",771],"(",")",["T_WHITESPACE"," ",771],["T_BOOLEAN_AND","&&",771],["T_WHITESPACE"," ",771],["T_VARIABLE","$item",771],["T_OBJECT_OPERATOR","->",771],["T_STRING","getQty",771],"(",")",")",["T_WHITESPACE"," ",771],"{",["T_WHITESPACE","\n                    ",771],["T_VARIABLE","$return",772],["T_WHITESPACE"," ",772],"=",["T_WHITESPACE"," ",772],["T_STRING","true",772],";",["T_WHITESPACE","\n                ",772],"}",["T_WHITESPACE","\n            ",773],"}",["T_WHITESPACE"," ",774],["T_ELSEIF","elseif",774],["T_WHITESPACE"," ",774],"(",["T_STRING","Mage",774],["T_DOUBLE_COLON","::",774],["T_STRING","helper",774],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",774],")",["T_OBJECT_OPERATOR","->",774],["T_STRING","isAutoReturnEnabled",774],"(",")",")",["T_WHITESPACE"," ",774],"{",["T_WHITESPACE","\n                ",774],["T_VARIABLE","$return",775],["T_WHITESPACE"," ",775],"=",["T_WHITESPACE"," ",775],["T_STRING","true",775],";",["T_WHITESPACE","\n            ",775],"}",["T_WHITESPACE","\n            ",776],["T_IF","if",777],["T_WHITESPACE"," ",777],"(",["T_VARIABLE","$return",777],")",["T_WHITESPACE"," ",777],"{",["T_WHITESPACE","\n                ",777],["T_VARIABLE","$parentOrderId",778],["T_WHITESPACE"," ",778],"=",["T_WHITESPACE"," ",778],["T_VARIABLE","$item",778],["T_OBJECT_OPERATOR","->",778],["T_STRING","getOrderItem",778],"(",")",["T_OBJECT_OPERATOR","->",778],["T_STRING","getParentItemId",778],"(",")",";",["T_WHITESPACE","\n                ",778],["T_COMMENT","\/* @var $parentItem Mage_Sales_Model_Order_Creditmemo_Item *\/",779],["T_WHITESPACE","\n                ",779],["T_VARIABLE","$parentItem",780],["T_WHITESPACE"," ",780],"=",["T_WHITESPACE"," ",780],["T_VARIABLE","$parentOrderId",780],["T_WHITESPACE"," ",780],"?",["T_WHITESPACE"," ",780],["T_VARIABLE","$creditmemo",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","getItemByOrderId",780],"(",["T_VARIABLE","$parentOrderId",780],")",["T_WHITESPACE"," ",780],":",["T_WHITESPACE"," ",780],["T_STRING","false",780],";",["T_WHITESPACE","\n                ",780],["T_VARIABLE","$qty",781],["T_WHITESPACE"," ",781],"=",["T_WHITESPACE"," ",781],["T_VARIABLE","$parentItem",781],["T_WHITESPACE"," ",781],"?",["T_WHITESPACE"," ",781],"(",["T_VARIABLE","$parentItem",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","getQty",781],"(",")",["T_WHITESPACE"," ",781],"*",["T_WHITESPACE"," ",781],["T_VARIABLE","$item",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","getQty",781],"(",")",")",["T_WHITESPACE"," ",781],":",["T_WHITESPACE"," ",781],["T_VARIABLE","$item",781],["T_OBJECT_OPERATOR","->",781],["T_STRING","getQty",781],"(",")",";",["T_WHITESPACE","\n                ",781],["T_IF","if",782],["T_WHITESPACE"," ",782],"(",["T_ISSET","isset",782],"(",["T_VARIABLE","$items",782],"[",["T_VARIABLE","$item",782],["T_OBJECT_OPERATOR","->",782],["T_STRING","getProductId",782],"(",")","]",")",")",["T_WHITESPACE"," ",782],"{",["T_WHITESPACE","\n                    ",782],["T_VARIABLE","$items",783],"[",["T_VARIABLE","$item",783],["T_OBJECT_OPERATOR","->",783],["T_STRING","getProductId",783],"(",")","]","[",["T_CONSTANT_ENCAPSED_STRING","'qty'",783],"]",["T_WHITESPACE"," ",783],["T_PLUS_EQUAL","+=",783],["T_WHITESPACE"," ",783],["T_VARIABLE","$qty",783],";",["T_WHITESPACE","\n                ",783],"}",["T_WHITESPACE"," ",784],["T_ELSE","else",784],["T_WHITESPACE"," ",784],"{",["T_WHITESPACE","\n                    ",784],["T_VARIABLE","$items",785],"[",["T_VARIABLE","$item",785],["T_OBJECT_OPERATOR","->",785],["T_STRING","getProductId",785],"(",")","]",["T_WHITESPACE"," ",785],"=",["T_WHITESPACE"," ",785],["T_ARRAY","array",785],"(",["T_WHITESPACE","\n                        ",785],["T_CONSTANT_ENCAPSED_STRING","'qty'",786],["T_WHITESPACE","  ",786],["T_DOUBLE_ARROW","=>",786],["T_WHITESPACE"," ",786],["T_VARIABLE","$qty",786],",",["T_WHITESPACE","\n                        ",786],["T_CONSTANT_ENCAPSED_STRING","'item'",787],["T_WHITESPACE"," ",787],["T_DOUBLE_ARROW","=>",787],["T_WHITESPACE"," ",787],["T_STRING","null",787],",",["T_WHITESPACE","\n                    ",787],")",";",["T_WHITESPACE","\n                ",788],"}",["T_WHITESPACE","\n            ",789],"}",["T_WHITESPACE","\n        ",790],"}",["T_WHITESPACE","\n        ",791],["T_STRING","Mage",792],["T_DOUBLE_COLON","::",792],["T_STRING","getSingleton",792],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",792],")",["T_OBJECT_OPERATOR","->",792],["T_STRING","revertProductsSale",792],"(",["T_VARIABLE","$items",792],")",";",["T_WHITESPACE","\n    ",792],"}",["T_WHITESPACE","\n\n    ",793],["T_DOC_COMMENT","\/**\n     * Cancel order item\n     *\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",795],["T_WHITESPACE","\n    ",800],["T_PUBLIC","public",801],["T_WHITESPACE"," ",801],["T_FUNCTION","function",801],["T_WHITESPACE"," ",801],["T_STRING","cancelOrderItem",801],"(",["T_VARIABLE","$observer",801],")",["T_WHITESPACE","\n    ",801],"{",["T_WHITESPACE","\n        ",802],["T_VARIABLE","$item",803],["T_WHITESPACE"," ",803],"=",["T_WHITESPACE"," ",803],["T_VARIABLE","$observer",803],["T_OBJECT_OPERATOR","->",803],["T_STRING","getEvent",803],"(",")",["T_OBJECT_OPERATOR","->",803],["T_STRING","getItem",803],"(",")",";",["T_WHITESPACE","\n\n        ",803],["T_VARIABLE","$children",805],["T_WHITESPACE"," ",805],"=",["T_WHITESPACE"," ",805],["T_VARIABLE","$item",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","getChildrenItems",805],"(",")",";",["T_WHITESPACE","\n        ",805],["T_VARIABLE","$qty",806],["T_WHITESPACE"," ",806],"=",["T_WHITESPACE"," ",806],["T_VARIABLE","$item",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getQtyOrdered",806],"(",")",["T_WHITESPACE"," ",806],"-",["T_WHITESPACE"," ",806],["T_STRING","max",806],"(",["T_VARIABLE","$item",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getQtyShipped",806],"(",")",",",["T_WHITESPACE"," ",806],["T_VARIABLE","$item",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getQtyInvoiced",806],"(",")",")",["T_WHITESPACE"," ",806],"-",["T_WHITESPACE"," ",806],["T_VARIABLE","$item",806],["T_OBJECT_OPERATOR","->",806],["T_STRING","getQtyCanceled",806],"(",")",";",["T_WHITESPACE","\n\n        ",806],["T_VARIABLE","$productId",808],["T_WHITESPACE"," ",808],"=",["T_WHITESPACE"," ",808],["T_VARIABLE","$item",808],["T_OBJECT_OPERATOR","->",808],["T_STRING","getProductId",808],"(",")",";",["T_WHITESPACE","\n        ",808],["T_IF","if",809],["T_WHITESPACE"," ",809],"(",["T_VARIABLE","$item",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","getId",809],"(",")",["T_WHITESPACE"," ",809],["T_BOOLEAN_AND","&&",809],["T_WHITESPACE"," ",809],["T_VARIABLE","$productId",809],["T_WHITESPACE"," ",809],["T_BOOLEAN_AND","&&",809],["T_WHITESPACE"," ",809],["T_EMPTY","empty",809],"(",["T_VARIABLE","$children",809],")",["T_WHITESPACE"," ",809],["T_BOOLEAN_AND","&&",809],["T_WHITESPACE"," ",809],["T_VARIABLE","$qty",809],")",["T_WHITESPACE"," ",809],"{",["T_WHITESPACE","\n            ",809],["T_STRING","Mage",810],["T_DOUBLE_COLON","::",810],["T_STRING","getSingleton",810],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",810],")",["T_OBJECT_OPERATOR","->",810],["T_STRING","backItemQty",810],"(",["T_VARIABLE","$productId",810],",",["T_WHITESPACE"," ",810],["T_VARIABLE","$qty",810],")",";",["T_WHITESPACE","\n        ",810],"}",["T_WHITESPACE","\n\n        ",811],["T_RETURN","return",813],["T_WHITESPACE"," ",813],["T_VARIABLE","$this",813],";",["T_WHITESPACE","\n    ",813],"}",["T_WHITESPACE","\n\n    ",814],["T_DOC_COMMENT","\/**\n     * Update items stock status and low stock date.\n     *\n     * @param Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",816],["T_WHITESPACE","\n    ",821],["T_PUBLIC","public",822],["T_WHITESPACE"," ",822],["T_FUNCTION","function",822],["T_WHITESPACE"," ",822],["T_STRING","updateItemsStockUponConfigChange",822],"(",["T_VARIABLE","$observer",822],")",["T_WHITESPACE","\n    ",822],"{",["T_WHITESPACE","\n        ",823],["T_STRING","Mage",824],["T_DOUBLE_COLON","::",824],["T_STRING","getResourceSingleton",824],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",824],")",["T_OBJECT_OPERATOR","->",824],["T_STRING","updateSetOutOfStock",824],"(",")",";",["T_WHITESPACE","\n        ",824],["T_STRING","Mage",825],["T_DOUBLE_COLON","::",825],["T_STRING","getResourceSingleton",825],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",825],")",["T_OBJECT_OPERATOR","->",825],["T_STRING","updateSetInStock",825],"(",")",";",["T_WHITESPACE","\n        ",825],["T_STRING","Mage",826],["T_DOUBLE_COLON","::",826],["T_STRING","getResourceSingleton",826],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",826],")",["T_OBJECT_OPERATOR","->",826],["T_STRING","updateLowStockDate",826],"(",")",";",["T_WHITESPACE","\n        ",826],["T_RETURN","return",827],["T_WHITESPACE"," ",827],["T_VARIABLE","$this",827],";",["T_WHITESPACE","\n    ",827],"}",["T_WHITESPACE","\n\n    ",828],["T_DOC_COMMENT","\/**\n     * Update Only product status observer\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",830],["T_WHITESPACE","\n    ",835],["T_PUBLIC","public",836],["T_WHITESPACE"," ",836],["T_FUNCTION","function",836],["T_WHITESPACE"," ",836],["T_STRING","productStatusUpdate",836],"(",["T_STRING","Varien_Event_Observer",836],["T_WHITESPACE"," ",836],["T_VARIABLE","$observer",836],")",["T_WHITESPACE","\n    ",836],"{",["T_WHITESPACE","\n        ",837],["T_VARIABLE","$productId",838],["T_WHITESPACE"," ",838],"=",["T_WHITESPACE"," ",838],["T_VARIABLE","$observer",838],["T_OBJECT_OPERATOR","->",838],["T_STRING","getEvent",838],"(",")",["T_OBJECT_OPERATOR","->",838],["T_STRING","getProductId",838],"(",")",";",["T_WHITESPACE","\n        ",838],["T_STRING","Mage",839],["T_DOUBLE_COLON","::",839],["T_STRING","getSingleton",839],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",839],")",["T_WHITESPACE","\n            ",839],["T_OBJECT_OPERATOR","->",840],["T_STRING","updateStatus",840],"(",["T_VARIABLE","$productId",840],")",";",["T_WHITESPACE","\n        ",840],["T_RETURN","return",841],["T_WHITESPACE"," ",841],["T_VARIABLE","$this",841],";",["T_WHITESPACE","\n    ",841],"}",["T_WHITESPACE","\n\n    ",842],["T_DOC_COMMENT","\/**\n     * Catalog Product website update\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",844],["T_WHITESPACE","\n    ",849],["T_PUBLIC","public",850],["T_WHITESPACE"," ",850],["T_FUNCTION","function",850],["T_WHITESPACE"," ",850],["T_STRING","catalogProductWebsiteUpdate",850],"(",["T_STRING","Varien_Event_Observer",850],["T_WHITESPACE"," ",850],["T_VARIABLE","$observer",850],")",["T_WHITESPACE","\n    ",850],"{",["T_WHITESPACE","\n        ",851],["T_VARIABLE","$websiteIds",852],["T_WHITESPACE"," ",852],"=",["T_WHITESPACE"," ",852],["T_VARIABLE","$observer",852],["T_OBJECT_OPERATOR","->",852],["T_STRING","getEvent",852],"(",")",["T_OBJECT_OPERATOR","->",852],["T_STRING","getWebsiteIds",852],"(",")",";",["T_WHITESPACE","\n        ",852],["T_VARIABLE","$productIds",853],["T_WHITESPACE"," ",853],"=",["T_WHITESPACE"," ",853],["T_VARIABLE","$observer",853],["T_OBJECT_OPERATOR","->",853],["T_STRING","getEvent",853],"(",")",["T_OBJECT_OPERATOR","->",853],["T_STRING","getProductIds",853],"(",")",";",["T_WHITESPACE","\n\n        ",853],["T_FOREACH","foreach",855],["T_WHITESPACE"," ",855],"(",["T_VARIABLE","$websiteIds",855],["T_WHITESPACE"," ",855],["T_AS","as",855],["T_WHITESPACE"," ",855],["T_VARIABLE","$websiteId",855],")",["T_WHITESPACE"," ",855],"{",["T_WHITESPACE","\n            ",855],["T_FOREACH","foreach",856],["T_WHITESPACE"," ",856],"(",["T_VARIABLE","$productIds",856],["T_WHITESPACE"," ",856],["T_AS","as",856],["T_WHITESPACE"," ",856],["T_VARIABLE","$productId",856],")",["T_WHITESPACE"," ",856],"{",["T_WHITESPACE","\n                ",856],["T_STRING","Mage",857],["T_DOUBLE_COLON","::",857],["T_STRING","getSingleton",857],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",857],")",["T_WHITESPACE","\n                    ",857],["T_OBJECT_OPERATOR","->",858],["T_STRING","updateStatus",858],"(",["T_VARIABLE","$productId",858],",",["T_WHITESPACE"," ",858],["T_STRING","null",858],",",["T_WHITESPACE"," ",858],["T_VARIABLE","$websiteId",858],")",";",["T_WHITESPACE","\n            ",858],"}",["T_WHITESPACE","\n        ",859],"}",["T_WHITESPACE","\n\n        ",860],["T_RETURN","return",862],["T_WHITESPACE"," ",862],["T_VARIABLE","$this",862],";",["T_WHITESPACE","\n    ",862],"}",["T_WHITESPACE","\n\n    ",863],["T_DOC_COMMENT","\/**\n     * Add stock status to prepare index select\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",865],["T_WHITESPACE","\n    ",870],["T_PUBLIC","public",871],["T_WHITESPACE"," ",871],["T_FUNCTION","function",871],["T_WHITESPACE"," ",871],["T_STRING","addStockStatusToPrepareIndexSelect",871],"(",["T_STRING","Varien_Event_Observer",871],["T_WHITESPACE"," ",871],["T_VARIABLE","$observer",871],")",["T_WHITESPACE","\n    ",871],"{",["T_WHITESPACE","\n        ",872],["T_VARIABLE","$website",873],["T_WHITESPACE","    ",873],"=",["T_WHITESPACE"," ",873],["T_VARIABLE","$observer",873],["T_OBJECT_OPERATOR","->",873],["T_STRING","getEvent",873],"(",")",["T_OBJECT_OPERATOR","->",873],["T_STRING","getWebsite",873],"(",")",";",["T_WHITESPACE","\n        ",873],["T_VARIABLE","$select",874],["T_WHITESPACE","     ",874],"=",["T_WHITESPACE"," ",874],["T_VARIABLE","$observer",874],["T_OBJECT_OPERATOR","->",874],["T_STRING","getEvent",874],"(",")",["T_OBJECT_OPERATOR","->",874],["T_STRING","getSelect",874],"(",")",";",["T_WHITESPACE","\n\n        ",874],["T_STRING","Mage",876],["T_DOUBLE_COLON","::",876],["T_STRING","getSingleton",876],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",876],")",["T_WHITESPACE","\n            ",876],["T_OBJECT_OPERATOR","->",877],["T_STRING","addStockStatusToSelect",877],"(",["T_VARIABLE","$select",877],",",["T_WHITESPACE"," ",877],["T_VARIABLE","$website",877],")",";",["T_WHITESPACE","\n\n        ",877],["T_RETURN","return",879],["T_WHITESPACE"," ",879],["T_VARIABLE","$this",879],";",["T_WHITESPACE","\n    ",879],"}",["T_WHITESPACE","\n\n    ",880],["T_DOC_COMMENT","\/**\n     * Add stock status limitation to catalog product price index select object\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",882],["T_WHITESPACE","\n    ",887],["T_PUBLIC","public",888],["T_WHITESPACE"," ",888],["T_FUNCTION","function",888],["T_WHITESPACE"," ",888],["T_STRING","prepareCatalogProductIndexSelect",888],"(",["T_STRING","Varien_Event_Observer",888],["T_WHITESPACE"," ",888],["T_VARIABLE","$observer",888],")",["T_WHITESPACE","\n    ",888],"{",["T_WHITESPACE","\n        ",889],["T_VARIABLE","$select",890],["T_WHITESPACE","     ",890],"=",["T_WHITESPACE"," ",890],["T_VARIABLE","$observer",890],["T_OBJECT_OPERATOR","->",890],["T_STRING","getEvent",890],"(",")",["T_OBJECT_OPERATOR","->",890],["T_STRING","getSelect",890],"(",")",";",["T_WHITESPACE","\n        ",890],["T_VARIABLE","$entity",891],["T_WHITESPACE","     ",891],"=",["T_WHITESPACE"," ",891],["T_VARIABLE","$observer",891],["T_OBJECT_OPERATOR","->",891],["T_STRING","getEvent",891],"(",")",["T_OBJECT_OPERATOR","->",891],["T_STRING","getEntityField",891],"(",")",";",["T_WHITESPACE","\n        ",891],["T_VARIABLE","$website",892],["T_WHITESPACE","    ",892],"=",["T_WHITESPACE"," ",892],["T_VARIABLE","$observer",892],["T_OBJECT_OPERATOR","->",892],["T_STRING","getEvent",892],"(",")",["T_OBJECT_OPERATOR","->",892],["T_STRING","getWebsiteField",892],"(",")",";",["T_WHITESPACE","\n\n        ",892],["T_STRING","Mage",894],["T_DOUBLE_COLON","::",894],["T_STRING","getSingleton",894],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",894],")",["T_WHITESPACE","\n            ",894],["T_OBJECT_OPERATOR","->",895],["T_STRING","prepareCatalogProductIndexSelect",895],"(",["T_VARIABLE","$select",895],",",["T_WHITESPACE"," ",895],["T_VARIABLE","$entity",895],",",["T_WHITESPACE"," ",895],["T_VARIABLE","$website",895],")",";",["T_WHITESPACE","\n\n        ",895],["T_RETURN","return",897],["T_WHITESPACE"," ",897],["T_VARIABLE","$this",897],";",["T_WHITESPACE","\n    ",897],"}",["T_WHITESPACE","\n\n    ",898],["T_DOC_COMMENT","\/**\n     * Add stock status filter to select\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",900],["T_WHITESPACE","\n    ",905],["T_PUBLIC","public",906],["T_WHITESPACE"," ",906],["T_FUNCTION","function",906],["T_WHITESPACE"," ",906],["T_STRING","addStockStatusFilterToSelect",906],"(",["T_STRING","Varien_Event_Observer",906],["T_WHITESPACE"," ",906],["T_VARIABLE","$observer",906],")",["T_WHITESPACE","\n    ",906],"{",["T_WHITESPACE","\n        ",907],["T_VARIABLE","$select",908],["T_WHITESPACE","         ",908],"=",["T_WHITESPACE"," ",908],["T_VARIABLE","$observer",908],["T_OBJECT_OPERATOR","->",908],["T_STRING","getEvent",908],"(",")",["T_OBJECT_OPERATOR","->",908],["T_STRING","getSelect",908],"(",")",";",["T_WHITESPACE","\n        ",908],["T_VARIABLE","$entityField",909],["T_WHITESPACE","    ",909],"=",["T_WHITESPACE"," ",909],["T_VARIABLE","$observer",909],["T_OBJECT_OPERATOR","->",909],["T_STRING","getEvent",909],"(",")",["T_OBJECT_OPERATOR","->",909],["T_STRING","getEntityField",909],"(",")",";",["T_WHITESPACE","\n        ",909],["T_VARIABLE","$websiteField",910],["T_WHITESPACE","   ",910],"=",["T_WHITESPACE"," ",910],["T_VARIABLE","$observer",910],["T_OBJECT_OPERATOR","->",910],["T_STRING","getEvent",910],"(",")",["T_OBJECT_OPERATOR","->",910],["T_STRING","getWebsiteField",910],"(",")",";",["T_WHITESPACE","\n\n        ",910],["T_IF","if",912],["T_WHITESPACE"," ",912],"(",["T_VARIABLE","$entityField",912],["T_WHITESPACE"," ",912],["T_IS_IDENTICAL","===",912],["T_WHITESPACE"," ",912],["T_STRING","null",912],["T_WHITESPACE"," ",912],["T_BOOLEAN_OR","||",912],["T_WHITESPACE"," ",912],["T_VARIABLE","$websiteField",912],["T_WHITESPACE"," ",912],["T_IS_IDENTICAL","===",912],["T_WHITESPACE"," ",912],["T_STRING","null",912],")",["T_WHITESPACE"," ",912],"{",["T_WHITESPACE","\n            ",912],["T_RETURN","return",913],["T_WHITESPACE"," ",913],["T_VARIABLE","$this",913],";",["T_WHITESPACE","\n        ",913],"}",["T_WHITESPACE","\n\n        ",914],["T_IF","if",916],["T_WHITESPACE"," ",916],"(","!","(",["T_VARIABLE","$entityField",916],["T_WHITESPACE"," ",916],["T_INSTANCEOF","instanceof",916],["T_WHITESPACE"," ",916],["T_STRING","Zend_Db_Expr",916],")",")",["T_WHITESPACE"," ",916],"{",["T_WHITESPACE","\n            ",916],["T_VARIABLE","$entityField",917],["T_WHITESPACE"," ",917],"=",["T_WHITESPACE"," ",917],["T_NEW","new",917],["T_WHITESPACE"," ",917],["T_STRING","Zend_Db_Expr",917],"(",["T_VARIABLE","$entityField",917],")",";",["T_WHITESPACE","\n        ",917],"}",["T_WHITESPACE","\n        ",918],["T_IF","if",919],["T_WHITESPACE"," ",919],"(","!","(",["T_VARIABLE","$websiteField",919],["T_WHITESPACE"," ",919],["T_INSTANCEOF","instanceof",919],["T_WHITESPACE"," ",919],["T_STRING","Zend_Db_Expr",919],")",")",["T_WHITESPACE"," ",919],"{",["T_WHITESPACE","\n            ",919],["T_VARIABLE","$websiteField",920],["T_WHITESPACE"," ",920],"=",["T_WHITESPACE"," ",920],["T_NEW","new",920],["T_WHITESPACE"," ",920],["T_STRING","Zend_Db_Expr",920],"(",["T_VARIABLE","$websiteField",920],")",";",["T_WHITESPACE","\n        ",920],"}",["T_WHITESPACE","\n\n        ",921],["T_STRING","Mage",923],["T_DOUBLE_COLON","::",923],["T_STRING","getResourseSingleton",923],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock_status'",923],")",["T_WHITESPACE","\n            ",923],["T_OBJECT_OPERATOR","->",924],["T_STRING","prepareCatalogProductIndexSelect",924],"(",["T_VARIABLE","$select",924],",",["T_WHITESPACE"," ",924],["T_VARIABLE","$entityField",924],",",["T_WHITESPACE"," ",924],["T_VARIABLE","$websiteField",924],")",";",["T_WHITESPACE","\n\n        ",924],["T_RETURN","return",926],["T_WHITESPACE"," ",926],["T_VARIABLE","$this",926],";",["T_WHITESPACE","\n    ",926],"}",["T_WHITESPACE","\n\n    ",927],["T_DOC_COMMENT","\/**\n     * Lock DB rows for order products\n     *\n     * We need do it for resolving problems with inventory on placing\n     * some orders in one time\n     * @deprecated after 1.4\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",929],["T_WHITESPACE","\n    ",937],["T_PUBLIC","public",938],["T_WHITESPACE"," ",938],["T_FUNCTION","function",938],["T_WHITESPACE"," ",938],["T_STRING","lockOrderInventoryData",938],"(",["T_VARIABLE","$observer",938],")",["T_WHITESPACE","\n    ",938],"{",["T_WHITESPACE","\n        ",939],["T_VARIABLE","$order",940],["T_WHITESPACE"," ",940],"=",["T_WHITESPACE"," ",940],["T_VARIABLE","$observer",940],["T_OBJECT_OPERATOR","->",940],["T_STRING","getEvent",940],"(",")",["T_OBJECT_OPERATOR","->",940],["T_STRING","getOrder",940],"(",")",";",["T_WHITESPACE","\n        ",940],["T_VARIABLE","$productIds",941],["T_WHITESPACE"," ",941],"=",["T_WHITESPACE"," ",941],["T_ARRAY","array",941],"(",")",";",["T_WHITESPACE","\n\n        ",941],["T_DOC_COMMENT","\/**\n         * Do lock only for new order\n         *\/",943],["T_WHITESPACE","\n        ",945],["T_IF","if",946],["T_WHITESPACE"," ",946],"(",["T_VARIABLE","$order",946],["T_OBJECT_OPERATOR","->",946],["T_STRING","getId",946],"(",")",")",["T_WHITESPACE"," ",946],"{",["T_WHITESPACE","\n            ",946],["T_RETURN","return",947],["T_WHITESPACE"," ",947],["T_VARIABLE","$this",947],";",["T_WHITESPACE","\n        ",947],"}",["T_WHITESPACE","\n\n        ",948],["T_IF","if",950],["T_WHITESPACE"," ",950],"(",["T_VARIABLE","$order",950],")",["T_WHITESPACE"," ",950],"{",["T_WHITESPACE","\n            ",950],["T_FOREACH","foreach",951],["T_WHITESPACE"," ",951],"(",["T_VARIABLE","$order",951],["T_OBJECT_OPERATOR","->",951],["T_STRING","getAllItems",951],"(",")",["T_WHITESPACE"," ",951],["T_AS","as",951],["T_WHITESPACE"," ",951],["T_VARIABLE","$item",951],")",["T_WHITESPACE"," ",951],"{",["T_WHITESPACE","\n                ",951],["T_VARIABLE","$productIds",952],"[","]",["T_WHITESPACE"," ",952],"=",["T_WHITESPACE"," ",952],["T_VARIABLE","$item",952],["T_OBJECT_OPERATOR","->",952],["T_STRING","getProductId",952],"(",")",";",["T_WHITESPACE","\n            ",952],"}",["T_WHITESPACE","\n        ",953],"}",["T_WHITESPACE","\n\n        ",954],["T_IF","if",956],["T_WHITESPACE"," ",956],"(","!",["T_EMPTY","empty",956],"(",["T_VARIABLE","$productIds",956],")",")",["T_WHITESPACE"," ",956],"{",["T_WHITESPACE","\n            ",956],["T_STRING","Mage",957],["T_DOUBLE_COLON","::",957],["T_STRING","getSingleton",957],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",957],")",["T_OBJECT_OPERATOR","->",957],["T_STRING","lockProductItems",957],"(",["T_VARIABLE","$productIds",957],")",";",["T_WHITESPACE","\n        ",957],"}",["T_WHITESPACE","\n\n        ",958],["T_RETURN","return",960],["T_WHITESPACE"," ",960],["T_VARIABLE","$this",960],";",["T_WHITESPACE","\n    ",960],"}",["T_WHITESPACE","\n\n    ",961],["T_DOC_COMMENT","\/**\n     * Register saving order item\n     *\n     * @deprecated after 1.4\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",963],["T_WHITESPACE","\n    ",969],["T_PUBLIC","public",970],["T_WHITESPACE"," ",970],["T_FUNCTION","function",970],["T_WHITESPACE"," ",970],["T_STRING","createOrderItem",970],"(",["T_VARIABLE","$observer",970],")",["T_WHITESPACE","\n    ",970],"{",["T_WHITESPACE","\n        ",971],["T_VARIABLE","$item",972],["T_WHITESPACE"," ",972],"=",["T_WHITESPACE"," ",972],["T_VARIABLE","$observer",972],["T_OBJECT_OPERATOR","->",972],["T_STRING","getEvent",972],"(",")",["T_OBJECT_OPERATOR","->",972],["T_STRING","getItem",972],"(",")",";",["T_WHITESPACE","\n        ",972],["T_DOC_COMMENT","\/**\n         * Before creating order item need subtract ordered qty from product stock\n         *\/",973],["T_WHITESPACE","\n\n        ",975],["T_VARIABLE","$children",977],["T_WHITESPACE"," ",977],"=",["T_WHITESPACE"," ",977],["T_VARIABLE","$item",977],["T_OBJECT_OPERATOR","->",977],["T_STRING","getChildrenItems",977],"(",")",";",["T_WHITESPACE","\n\n        ",977],["T_IF","if",979],["T_WHITESPACE"," ",979],"(","!",["T_VARIABLE","$item",979],["T_OBJECT_OPERATOR","->",979],["T_STRING","getId",979],"(",")",["T_WHITESPACE"," ",979],["T_BOOLEAN_AND","&&",979],["T_WHITESPACE"," ",979],["T_EMPTY","empty",979],"(",["T_VARIABLE","$children",979],")",")",["T_WHITESPACE"," ",979],"{",["T_WHITESPACE","\n            ",979],["T_STRING","Mage",980],["T_DOUBLE_COLON","::",980],["T_STRING","getSingleton",980],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",980],")",["T_OBJECT_OPERATOR","->",980],["T_STRING","registerItemSale",980],"(",["T_VARIABLE","$item",980],")",";",["T_WHITESPACE","\n        ",980],"}",["T_WHITESPACE","\n\n        ",981],["T_RETURN","return",983],["T_WHITESPACE"," ",983],["T_VARIABLE","$this",983],";",["T_WHITESPACE","\n    ",983],"}",["T_WHITESPACE","\n\n    ",984],["T_DOC_COMMENT","\/**\n     * Back refunded item qty to stock\n     *\n     * @deprecated after 1.4\n     * @param   Varien_Event_Observer $observer\n     * @return  Mage_CatalogInventory_Model_Observer\n     *\/",986],["T_WHITESPACE","\n    ",992],["T_PUBLIC","public",993],["T_WHITESPACE"," ",993],["T_FUNCTION","function",993],["T_WHITESPACE"," ",993],["T_STRING","refundOrderItem",993],"(",["T_VARIABLE","$observer",993],")",["T_WHITESPACE","\n    ",993],"{",["T_WHITESPACE","\n        ",994],["T_VARIABLE","$item",995],["T_WHITESPACE"," ",995],"=",["T_WHITESPACE"," ",995],["T_VARIABLE","$observer",995],["T_OBJECT_OPERATOR","->",995],["T_STRING","getEvent",995],"(",")",["T_OBJECT_OPERATOR","->",995],["T_STRING","getCreditmemoItem",995],"(",")",";",["T_WHITESPACE","\n        ",995],["T_IF","if",996],["T_WHITESPACE"," ",996],"(",["T_VARIABLE","$item",996],["T_OBJECT_OPERATOR","->",996],["T_STRING","getId",996],"(",")",["T_WHITESPACE"," ",996],["T_BOOLEAN_AND","&&",996],["T_WHITESPACE"," ",996],["T_VARIABLE","$item",996],["T_OBJECT_OPERATOR","->",996],["T_STRING","getBackToStock",996],"(",")",["T_WHITESPACE"," ",996],["T_BOOLEAN_AND","&&",996],["T_WHITESPACE"," ",996],"(",["T_VARIABLE","$productId",996],["T_WHITESPACE"," ",996],"=",["T_WHITESPACE"," ",996],["T_VARIABLE","$item",996],["T_OBJECT_OPERATOR","->",996],["T_STRING","getProductId",996],"(",")",")",["T_WHITESPACE","\n            ",996],["T_BOOLEAN_AND","&&",997],["T_WHITESPACE"," ",997],"(",["T_VARIABLE","$qty",997],["T_WHITESPACE"," ",997],"=",["T_WHITESPACE"," ",997],["T_VARIABLE","$item",997],["T_OBJECT_OPERATOR","->",997],["T_STRING","getQty",997],"(",")",")",["T_WHITESPACE","\n        ",997],")",["T_WHITESPACE"," ",998],"{",["T_WHITESPACE","\n            ",998],["T_STRING","Mage",999],["T_DOUBLE_COLON","::",999],["T_STRING","getSingleton",999],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory\/stock'",999],")",["T_OBJECT_OPERATOR","->",999],["T_STRING","backItemQty",999],"(",["T_VARIABLE","$productId",999],",",["T_WHITESPACE"," ",999],["T_VARIABLE","$qty",999],")",";",["T_WHITESPACE","\n        ",999],"}",["T_WHITESPACE","\n        ",1000],["T_RETURN","return",1001],["T_WHITESPACE"," ",1001],["T_VARIABLE","$this",1001],";",["T_WHITESPACE","\n    ",1001],"}",["T_WHITESPACE","\n\n    ",1002],["T_DOC_COMMENT","\/**\n     * Reindex all events of product-massAction type\n     *\n     * @param Varien_Event_Observer $observer\n     *\/",1004],["T_WHITESPACE","\n    ",1008],["T_PUBLIC","public",1009],["T_WHITESPACE"," ",1009],["T_FUNCTION","function",1009],["T_WHITESPACE"," ",1009],["T_STRING","reindexProductsMassAction",1009],"(",["T_VARIABLE","$observer",1009],")",["T_WHITESPACE","\n    ",1009],"{",["T_WHITESPACE","\n        ",1010],["T_STRING","Mage",1011],["T_DOUBLE_COLON","::",1011],["T_STRING","getSingleton",1011],"(",["T_CONSTANT_ENCAPSED_STRING","'index\/indexer'",1011],")",["T_OBJECT_OPERATOR","->",1011],["T_STRING","indexEvents",1011],"(",["T_WHITESPACE","\n            ",1011],["T_STRING","Mage_Catalog_Model_Product",1012],["T_DOUBLE_COLON","::",1012],["T_STRING","ENTITY",1012],",",["T_WHITESPACE"," ",1012],["T_STRING","Mage_Index_Model_Event",1012],["T_DOUBLE_COLON","::",1012],["T_STRING","TYPE_MASS_ACTION",1012],["T_WHITESPACE","\n        ",1012],")",";",["T_WHITESPACE","\n    ",1013],"}",["T_WHITESPACE","\n\n    ",1014],["T_DOC_COMMENT","\/**\n     * Detects whether product status should be shown\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_CatalogInventory_Model_Observer\n     *\/",1016],["T_WHITESPACE","\n    ",1021],["T_PUBLIC","public",1022],["T_WHITESPACE"," ",1022],["T_FUNCTION","function",1022],["T_WHITESPACE"," ",1022],["T_STRING","displayProductStatusInfo",1022],"(",["T_VARIABLE","$observer",1022],")",["T_WHITESPACE","\n    ",1022],"{",["T_WHITESPACE","\n        ",1023],["T_VARIABLE","$info",1024],["T_WHITESPACE"," ",1024],"=",["T_WHITESPACE"," ",1024],["T_VARIABLE","$observer",1024],["T_OBJECT_OPERATOR","->",1024],["T_STRING","getEvent",1024],"(",")",["T_OBJECT_OPERATOR","->",1024],["T_STRING","getStatus",1024],"(",")",";",["T_WHITESPACE","\n        ",1024],["T_VARIABLE","$info",1025],["T_OBJECT_OPERATOR","->",1025],["T_STRING","setDisplayStatus",1025],"(",["T_STRING","Mage",1025],["T_DOUBLE_COLON","::",1025],["T_STRING","helper",1025],"(",["T_CONSTANT_ENCAPSED_STRING","'cataloginventory'",1025],")",["T_OBJECT_OPERATOR","->",1025],["T_STRING","isDisplayProductStockStatus",1025],"(",")",")",";",["T_WHITESPACE","\n        ",1025],["T_RETURN","return",1026],["T_WHITESPACE"," ",1026],["T_VARIABLE","$this",1026],";",["T_WHITESPACE","\n    ",1026],"}",["T_WHITESPACE","\n",1027],"}",["T_WHITESPACE","\n",1028]]