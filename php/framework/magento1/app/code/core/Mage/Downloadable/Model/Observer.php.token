[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Downloadable\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Downloadable Products Observer\n *\n * @category    Mage\n * @package     Mage_Downloadable\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Downloadable_Model_Observer",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","XML_PATH_DISABLE_GUEST_CHECKOUT",36],["T_WHITESPACE","   ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'catalog\/downloadable\/disable_guest_checkout'",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Prepare product to save\n     *\n     * @param   Varien_Object $observer\n     * @return  Mage_Downloadable_Model_Observer\n     *\/",38],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","prepareProductSave",44],"(",["T_VARIABLE","$observer",44],")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$request",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$observer",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getEvent",46],"(",")",["T_OBJECT_OPERATOR","->",46],["T_STRING","getRequest",46],"(",")",";",["T_WHITESPACE","\n        ",46],["T_VARIABLE","$product",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$observer",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","getEvent",47],"(",")",["T_OBJECT_OPERATOR","->",47],["T_STRING","getProduct",47],"(",")",";",["T_WHITESPACE","\n\n        ",47],["T_IF","if",49],["T_WHITESPACE"," ",49],"(",["T_VARIABLE","$downloadable",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_VARIABLE","$request",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getPost",49],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable'",49],")",")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$product",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","setDownloadableData",50],"(",["T_VARIABLE","$downloadable",50],")",";",["T_WHITESPACE","\n        ",50],"}",["T_WHITESPACE","\n\n        ",51],["T_RETURN","return",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$this",53],";",["T_WHITESPACE","\n    ",53],"}",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Save data from order to purchased links\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Downloadable_Model_Observer\n     *\/",56],["T_WHITESPACE","\n    ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","saveDownloadableOrderItem",62],"(",["T_VARIABLE","$observer",62],")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$orderItem",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$observer",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getEvent",64],"(",")",["T_OBJECT_OPERATOR","->",64],["T_STRING","getItem",64],"(",")",";",["T_WHITESPACE","\n        ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(","!",["T_VARIABLE","$orderItem",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getId",65],"(",")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n            ",65],["T_COMMENT","\/\/order not saved in the database\n",66],["T_WHITESPACE","            ",67],["T_RETURN","return",67],["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],";",["T_WHITESPACE","\n        ",67],"}",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$product",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$orderItem",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getProduct",69],"(",")",";",["T_WHITESPACE","\n        ",69],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$product",70],["T_WHITESPACE"," ",70],["T_BOOLEAN_AND","&&",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$product",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getTypeId",70],"(",")",["T_WHITESPACE"," ",70],["T_IS_NOT_EQUAL","!=",70],["T_WHITESPACE"," ",70],["T_STRING","Mage_Downloadable_Model_Product_Type",70],["T_DOUBLE_COLON","::",70],["T_STRING","TYPE_DOWNLOADABLE",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_RETURN","return",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n        ",72],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_STRING","Mage",73],["T_DOUBLE_COLON","::",73],["T_STRING","getModel",73],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link_purchased'",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","load",73],"(",["T_VARIABLE","$orderItem",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getId",73],"(",")",",",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'order_item_id'",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","getId",73],"(",")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n        ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(","!",["T_VARIABLE","$product",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$product",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","Mage",77],["T_DOUBLE_COLON","::",77],["T_STRING","getModel",77],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",77],")",["T_WHITESPACE","\n                ",77],["T_OBJECT_OPERATOR","->",78],["T_STRING","setStoreId",78],"(",["T_VARIABLE","$orderItem",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getOrder",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","getStoreId",78],"(",")",")",["T_WHITESPACE","\n                ",78],["T_OBJECT_OPERATOR","->",79],["T_STRING","load",79],"(",["T_VARIABLE","$orderItem",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","getProductId",79],"(",")",")",";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n        ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$product",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getTypeId",81],"(",")",["T_WHITESPACE"," ",81],["T_IS_EQUAL","==",81],["T_WHITESPACE"," ",81],["T_STRING","Mage_Downloadable_Model_Product_Type",81],["T_DOUBLE_COLON","::",81],["T_STRING","TYPE_DOWNLOADABLE",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$links",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$product",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getTypeInstance",82],"(",["T_STRING","true",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","getLinks",82],"(",["T_VARIABLE","$product",82],")",";",["T_WHITESPACE","\n            ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_VARIABLE","$linkIds",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$orderItem",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getProductOptionByCode",83],"(",["T_CONSTANT_ENCAPSED_STRING","'links'",83],")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                ",83],["T_VARIABLE","$linkPurchased",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING","Mage",84],["T_DOUBLE_COLON","::",84],["T_STRING","getModel",84],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link_purchased'",84],")",";",["T_WHITESPACE","\n                ",84],["T_STRING","Mage",85],["T_DOUBLE_COLON","::",85],["T_STRING","helper",85],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",85],")",["T_OBJECT_OPERATOR","->",85],["T_STRING","copyFieldset",85],"(",["T_WHITESPACE","\n                    ",85],["T_CONSTANT_ENCAPSED_STRING","'downloadable_sales_copy_order'",86],",",["T_WHITESPACE","\n                    ",86],["T_CONSTANT_ENCAPSED_STRING","'to_downloadable'",87],",",["T_WHITESPACE","\n                    ",87],["T_VARIABLE","$orderItem",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getOrder",88],"(",")",",",["T_WHITESPACE","\n                    ",88],["T_VARIABLE","$linkPurchased",89],["T_WHITESPACE","\n                ",89],")",";",["T_WHITESPACE","\n                ",90],["T_STRING","Mage",91],["T_DOUBLE_COLON","::",91],["T_STRING","helper",91],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",91],")",["T_OBJECT_OPERATOR","->",91],["T_STRING","copyFieldset",91],"(",["T_WHITESPACE","\n                    ",91],["T_CONSTANT_ENCAPSED_STRING","'downloadable_sales_copy_order_item'",92],",",["T_WHITESPACE","\n                    ",92],["T_CONSTANT_ENCAPSED_STRING","'to_downloadable'",93],",",["T_WHITESPACE","\n                    ",93],["T_VARIABLE","$orderItem",94],",",["T_WHITESPACE","\n                    ",94],["T_VARIABLE","$linkPurchased",95],["T_WHITESPACE","\n                ",95],")",";",["T_WHITESPACE","\n                ",96],["T_VARIABLE","$linkSectionTitle",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],"(",["T_WHITESPACE","\n                    ",97],["T_VARIABLE","$product",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getLinksTitle",98],"(",")","?",["T_WHITESPACE","\n                    ",98],["T_VARIABLE","$product",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getLinksTitle",99],"(",")",":",["T_STRING","Mage",99],["T_DOUBLE_COLON","::",99],["T_STRING","getStoreConfig",99],"(",["T_STRING","Mage_Downloadable_Model_Link",99],["T_DOUBLE_COLON","::",99],["T_STRING","XML_PATH_LINKS_TITLE",99],")",["T_WHITESPACE","\n                ",99],")",";",["T_WHITESPACE","\n                ",100],["T_VARIABLE","$linkPurchased",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","setLinkSectionTitle",101],"(",["T_VARIABLE","$linkSectionTitle",101],")",["T_WHITESPACE","\n                    ",101],["T_OBJECT_OPERATOR","->",102],["T_STRING","save",102],"(",")",";",["T_WHITESPACE","\n                ",102],["T_FOREACH","foreach",103],["T_WHITESPACE"," ",103],"(",["T_VARIABLE","$linkIds",103],["T_WHITESPACE"," ",103],["T_AS","as",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$linkId",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n                    ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_ISSET","isset",104],"(",["T_VARIABLE","$links",104],"[",["T_VARIABLE","$linkId",104],"]",")",")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n                        ",104],["T_VARIABLE","$linkPurchasedItem",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","Mage",105],["T_DOUBLE_COLON","::",105],["T_STRING","getModel",105],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link_purchased_item'",105],")",["T_WHITESPACE","\n                            ",105],["T_OBJECT_OPERATOR","->",106],["T_STRING","setPurchasedId",106],"(",["T_VARIABLE","$linkPurchased",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getId",106],"(",")",")",["T_WHITESPACE","\n                            ",106],["T_OBJECT_OPERATOR","->",107],["T_STRING","setOrderItemId",107],"(",["T_VARIABLE","$orderItem",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getId",107],"(",")",")",";",["T_WHITESPACE","\n\n                        ",107],["T_STRING","Mage",109],["T_DOUBLE_COLON","::",109],["T_STRING","helper",109],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",109],")",["T_OBJECT_OPERATOR","->",109],["T_STRING","copyFieldset",109],"(",["T_WHITESPACE","\n                            ",109],["T_CONSTANT_ENCAPSED_STRING","'downloadable_sales_copy_link'",110],",",["T_WHITESPACE","\n                            ",110],["T_CONSTANT_ENCAPSED_STRING","'to_purchased'",111],",",["T_WHITESPACE","\n                            ",111],["T_VARIABLE","$links",112],"[",["T_VARIABLE","$linkId",112],"]",",",["T_WHITESPACE","\n                            ",112],["T_VARIABLE","$linkPurchasedItem",113],["T_WHITESPACE","\n                        ",113],")",";",["T_WHITESPACE","\n                        ",114],["T_VARIABLE","$linkHash",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","strtr",115],"(",["T_STRING","base64_encode",115],"(",["T_STRING","microtime",115],"(",")",["T_WHITESPACE"," ",115],".",["T_WHITESPACE"," ",115],["T_VARIABLE","$linkPurchased",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getId",115],"(",")",["T_WHITESPACE"," ",115],".",["T_WHITESPACE"," ",115],["T_VARIABLE","$orderItem",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getId",115],"(",")",["T_WHITESPACE","\n                            ",115],".",["T_WHITESPACE"," ",116],["T_VARIABLE","$product",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getId",116],"(",")",")",",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'+\/='",116],",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'-_,'",116],")",";",["T_WHITESPACE","\n                        ",116],["T_VARIABLE","$numberOfDownloads",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$links",117],"[",["T_VARIABLE","$linkId",117],"]",["T_OBJECT_OPERATOR","->",117],["T_STRING","getNumberOfDownloads",117],"(",")","*",["T_VARIABLE","$orderItem",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getQtyOrdered",117],"(",")",";",["T_WHITESPACE","\n                        ",117],["T_VARIABLE","$linkPurchasedItem",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","setLinkHash",118],"(",["T_VARIABLE","$linkHash",118],")",["T_WHITESPACE","\n                            ",118],["T_OBJECT_OPERATOR","->",119],["T_STRING","setNumberOfDownloadsBought",119],"(",["T_VARIABLE","$numberOfDownloads",119],")",["T_WHITESPACE","\n                            ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","setStatus",120],"(",["T_STRING","Mage_Downloadable_Model_Link_Purchased_Item",120],["T_DOUBLE_COLON","::",120],["T_STRING","LINK_STATUS_PENDING",120],")",["T_WHITESPACE","\n                            ",120],["T_OBJECT_OPERATOR","->",121],["T_STRING","setCreatedAt",121],"(",["T_VARIABLE","$orderItem",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getCreatedAt",121],"(",")",")",["T_WHITESPACE","\n                            ",121],["T_OBJECT_OPERATOR","->",122],["T_STRING","setUpdatedAt",122],"(",["T_VARIABLE","$orderItem",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getUpdatedAt",122],"(",")",")",["T_WHITESPACE","\n                            ",122],["T_OBJECT_OPERATOR","->",123],["T_STRING","save",123],"(",")",";",["T_WHITESPACE","\n                    ",123],"}",["T_WHITESPACE","\n                ",124],"}",["T_WHITESPACE","\n            ",125],"}",["T_WHITESPACE","\n        ",126],"}",["T_WHITESPACE","\n\n        ",127],["T_RETURN","return",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],";",["T_WHITESPACE","\n    ",129],"}",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Set checkout session flag if order has downloadable product(s)\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Downloadable_Model_Observer\n     *\/",132],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","setHasDownloadableProducts",138],"(",["T_VARIABLE","$observer",138],")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$session",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","Mage",140],["T_DOUBLE_COLON","::",140],["T_STRING","getSingleton",140],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/session'",140],")",";",["T_WHITESPACE","\n        ",140],["T_IF","if",141],["T_WHITESPACE"," ",141],"(","!",["T_VARIABLE","$session",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getHasDownloadableProducts",141],"(",")",")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$order",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$observer",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getEvent",142],"(",")",["T_OBJECT_OPERATOR","->",142],["T_STRING","getOrder",142],"(",")",";",["T_WHITESPACE","\n            ",142],["T_FOREACH","foreach",143],["T_WHITESPACE"," ",143],"(",["T_VARIABLE","$order",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getAllItems",143],"(",")",["T_WHITESPACE"," ",143],["T_AS","as",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$item",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n                ",143],["T_COMMENT","\/* @var $item Mage_Sales_Model_Order_Item *\/",144],["T_WHITESPACE","\n                ",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$item",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getProductType",145],"(",")",["T_WHITESPACE"," ",145],["T_IS_EQUAL","==",145],["T_WHITESPACE"," ",145],["T_STRING","Mage_Downloadable_Model_Product_Type",145],["T_DOUBLE_COLON","::",145],["T_STRING","TYPE_DOWNLOADABLE",145],["T_WHITESPACE","\n                ",145],["T_BOOLEAN_OR","||",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$item",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getRealProductType",146],"(",")",["T_WHITESPACE"," ",146],["T_IS_EQUAL","==",146],["T_WHITESPACE"," ",146],["T_STRING","Mage_Downloadable_Model_Product_Type",146],["T_DOUBLE_COLON","::",146],["T_STRING","TYPE_DOWNLOADABLE",146],["T_WHITESPACE","\n                ",146],["T_BOOLEAN_OR","||",147],["T_WHITESPACE"," ",147],["T_VARIABLE","$item",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getProductOptionByCode",147],"(",["T_CONSTANT_ENCAPSED_STRING","'is_downloadable'",147],")",")",["T_WHITESPACE","\n                ",147],"{",["T_WHITESPACE","\n                    ",148],["T_VARIABLE","$session",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","setHasDownloadableProducts",149],"(",["T_STRING","true",149],")",";",["T_WHITESPACE","\n                    ",149],["T_BREAK","break",150],";",["T_WHITESPACE","\n                ",150],"}",["T_WHITESPACE","\n            ",151],"}",["T_WHITESPACE","\n        ",152],"}",["T_WHITESPACE","\n        ",153],["T_RETURN","return",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],";",["T_WHITESPACE","\n    ",154],"}",["T_WHITESPACE","\n\n    ",155],["T_DOC_COMMENT","\/**\n     * Set status of link\n     *\n     * @param Varien_Object $observer\n     * @return Mage_Downloadable_Model_Observer\n     *\/",157],["T_WHITESPACE","\n    ",162],["T_PUBLIC","public",163],["T_WHITESPACE"," ",163],["T_FUNCTION","function",163],["T_WHITESPACE"," ",163],["T_STRING","setLinkStatus",163],"(",["T_VARIABLE","$observer",163],")",["T_WHITESPACE","\n    ",163],"{",["T_WHITESPACE","\n        ",164],["T_VARIABLE","$order",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_VARIABLE","$observer",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","getEvent",165],"(",")",["T_OBJECT_OPERATOR","->",165],["T_STRING","getOrder",165],"(",")",";",["T_WHITESPACE","\n\n        ",165],["T_IF","if",167],["T_WHITESPACE"," ",167],"(","!",["T_VARIABLE","$order",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","getId",167],"(",")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_COMMENT","\/\/order not saved in the database\n",168],["T_WHITESPACE","            ",169],["T_RETURN","return",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE","\n\n        ",170],["T_COMMENT","\/* @var $order Mage_Sales_Model_Order *\/",172],["T_WHITESPACE","\n        ",172],["T_VARIABLE","$status",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","''",173],";",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$linkStatuses",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_ARRAY","array",174],"(",["T_WHITESPACE","\n            ",174],["T_CONSTANT_ENCAPSED_STRING","'pending'",175],["T_WHITESPACE","         ",175],["T_DOUBLE_ARROW","=>",175],["T_WHITESPACE"," ",175],["T_STRING","Mage_Downloadable_Model_Link_Purchased_Item",175],["T_DOUBLE_COLON","::",175],["T_STRING","LINK_STATUS_PENDING",175],",",["T_WHITESPACE","\n            ",175],["T_CONSTANT_ENCAPSED_STRING","'expired'",176],["T_WHITESPACE","         ",176],["T_DOUBLE_ARROW","=>",176],["T_WHITESPACE"," ",176],["T_STRING","Mage_Downloadable_Model_Link_Purchased_Item",176],["T_DOUBLE_COLON","::",176],["T_STRING","LINK_STATUS_EXPIRED",176],",",["T_WHITESPACE","\n            ",176],["T_CONSTANT_ENCAPSED_STRING","'avail'",177],["T_WHITESPACE","           ",177],["T_DOUBLE_ARROW","=>",177],["T_WHITESPACE"," ",177],["T_STRING","Mage_Downloadable_Model_Link_Purchased_Item",177],["T_DOUBLE_COLON","::",177],["T_STRING","LINK_STATUS_AVAILABLE",177],",",["T_WHITESPACE","\n            ",177],["T_CONSTANT_ENCAPSED_STRING","'payment_pending'",178],["T_WHITESPACE"," ",178],["T_DOUBLE_ARROW","=>",178],["T_WHITESPACE"," ",178],["T_STRING","Mage_Downloadable_Model_Link_Purchased_Item",178],["T_DOUBLE_COLON","::",178],["T_STRING","LINK_STATUS_PENDING_PAYMENT",178],",",["T_WHITESPACE","\n            ",178],["T_CONSTANT_ENCAPSED_STRING","'payment_review'",179],["T_WHITESPACE","  ",179],["T_DOUBLE_ARROW","=>",179],["T_WHITESPACE"," ",179],["T_STRING","Mage_Downloadable_Model_Link_Purchased_Item",179],["T_DOUBLE_COLON","::",179],["T_STRING","LINK_STATUS_PAYMENT_REVIEW",179],["T_WHITESPACE","\n        ",179],")",";",["T_WHITESPACE","\n\n        ",180],["T_VARIABLE","$downloadableItemsStatuses",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_ARRAY","array",182],"(",")",";",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$orderItemStatusToEnable",183],["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_STRING","Mage",183],["T_DOUBLE_COLON","::",183],["T_STRING","getStoreConfig",183],"(",["T_WHITESPACE","\n            ",183],["T_STRING","Mage_Downloadable_Model_Link_Purchased_Item",184],["T_DOUBLE_COLON","::",184],["T_STRING","XML_PATH_ORDER_ITEM_STATUS",184],",",["T_WHITESPACE"," ",184],["T_VARIABLE","$order",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","getStoreId",184],"(",")",["T_WHITESPACE","\n        ",184],")",";",["T_WHITESPACE","\n\n        ",185],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_VARIABLE","$order",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getState",187],"(",")",["T_WHITESPACE"," ",187],["T_IS_EQUAL","==",187],["T_WHITESPACE"," ",187],["T_STRING","Mage_Sales_Model_Order",187],["T_DOUBLE_COLON","::",187],["T_STRING","STATE_HOLDED",187],")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$status",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$linkStatuses",188],"[",["T_CONSTANT_ENCAPSED_STRING","'pending'",188],"]",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE"," ",189],["T_ELSEIF","elseif",189],["T_WHITESPACE"," ",189],"(",["T_VARIABLE","$order",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","isCanceled",189],"(",")",["T_WHITESPACE","\n                  ",189],["T_BOOLEAN_OR","||",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$order",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getState",190],"(",")",["T_WHITESPACE"," ",190],["T_IS_EQUAL","==",190],["T_WHITESPACE"," ",190],["T_STRING","Mage_Sales_Model_Order",190],["T_DOUBLE_COLON","::",190],["T_STRING","STATE_CLOSED",190],["T_WHITESPACE","\n                  ",190],["T_BOOLEAN_OR","||",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$order",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getState",191],"(",")",["T_WHITESPACE"," ",191],["T_IS_EQUAL","==",191],["T_WHITESPACE"," ",191],["T_STRING","Mage_Sales_Model_Order",191],["T_DOUBLE_COLON","::",191],["T_STRING","STATE_COMPLETE",191],["T_WHITESPACE","\n        ",191],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n            ",192],["T_VARIABLE","$expiredStatuses",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_ARRAY","array",193],"(",["T_WHITESPACE","\n                ",193],["T_STRING","Mage_Sales_Model_Order_Item",194],["T_DOUBLE_COLON","::",194],["T_STRING","STATUS_CANCELED",194],",",["T_WHITESPACE","\n                ",194],["T_STRING","Mage_Sales_Model_Order_Item",195],["T_DOUBLE_COLON","::",195],["T_STRING","STATUS_REFUNDED",195],",",["T_WHITESPACE","\n            ",195],")",";",["T_WHITESPACE","\n            ",196],["T_FOREACH","foreach",197],["T_WHITESPACE"," ",197],"(",["T_VARIABLE","$order",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getAllItems",197],"(",")",["T_WHITESPACE"," ",197],["T_AS","as",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$item",197],")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n                ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_VARIABLE","$item",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getProductType",198],"(",")",["T_WHITESPACE"," ",198],["T_IS_EQUAL","==",198],["T_WHITESPACE"," ",198],["T_STRING","Mage_Downloadable_Model_Product_Type",198],["T_DOUBLE_COLON","::",198],["T_STRING","TYPE_DOWNLOADABLE",198],["T_WHITESPACE","\n                    ",198],["T_BOOLEAN_OR","||",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$item",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","getRealProductType",199],"(",")",["T_WHITESPACE"," ",199],["T_IS_EQUAL","==",199],["T_WHITESPACE"," ",199],["T_STRING","Mage_Downloadable_Model_Product_Type",199],["T_DOUBLE_COLON","::",199],["T_STRING","TYPE_DOWNLOADABLE",199],["T_WHITESPACE","\n                ",199],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n                    ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_STRING","in_array",201],"(",["T_VARIABLE","$item",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getStatusId",201],"(",")",",",["T_WHITESPACE"," ",201],["T_VARIABLE","$expiredStatuses",201],")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                        ",201],["T_VARIABLE","$downloadableItemsStatuses",202],"[",["T_VARIABLE","$item",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","getId",202],"(",")","]",["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$linkStatuses",202],"[",["T_CONSTANT_ENCAPSED_STRING","'expired'",202],"]",";",["T_WHITESPACE","\n                    ",202],"}",["T_WHITESPACE"," ",203],["T_ELSE","else",203],["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n                        ",203],["T_VARIABLE","$downloadableItemsStatuses",204],"[",["T_VARIABLE","$item",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","getId",204],"(",")","]",["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$linkStatuses",204],"[",["T_CONSTANT_ENCAPSED_STRING","'avail'",204],"]",";",["T_WHITESPACE","\n                    ",204],"}",["T_WHITESPACE","\n                ",205],"}",["T_WHITESPACE","\n            ",206],"}",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE"," ",208],["T_ELSEIF","elseif",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$order",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getState",208],"(",")",["T_WHITESPACE"," ",208],["T_IS_EQUAL","==",208],["T_WHITESPACE"," ",208],["T_STRING","Mage_Sales_Model_Order",208],["T_DOUBLE_COLON","::",208],["T_STRING","STATE_PENDING_PAYMENT",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$status",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$linkStatuses",209],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_pending'",209],"]",";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE"," ",210],["T_ELSEIF","elseif",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$order",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getState",210],"(",")",["T_WHITESPACE"," ",210],["T_IS_EQUAL","==",210],["T_WHITESPACE"," ",210],["T_STRING","Mage_Sales_Model_Order",210],["T_DOUBLE_COLON","::",210],["T_STRING","STATE_PAYMENT_REVIEW",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n            ",210],["T_VARIABLE","$status",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_VARIABLE","$linkStatuses",211],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_review'",211],"]",";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE"," ",212],["T_ELSE","else",212],["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n            ",212],["T_VARIABLE","$availableStatuses",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_ARRAY","array",213],"(",["T_VARIABLE","$orderItemStatusToEnable",213],",",["T_WHITESPACE"," ",213],["T_STRING","Mage_Sales_Model_Order_Item",213],["T_DOUBLE_COLON","::",213],["T_STRING","STATUS_INVOICED",213],")",";",["T_WHITESPACE","\n            ",213],["T_FOREACH","foreach",214],["T_WHITESPACE"," ",214],"(",["T_VARIABLE","$order",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getAllItems",214],"(",")",["T_WHITESPACE"," ",214],["T_AS","as",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$item",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n                ",214],["T_IF","if",215],["T_WHITESPACE"," ",215],"(",["T_VARIABLE","$item",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getProductType",215],"(",")",["T_WHITESPACE"," ",215],["T_IS_EQUAL","==",215],["T_WHITESPACE"," ",215],["T_STRING","Mage_Downloadable_Model_Product_Type",215],["T_DOUBLE_COLON","::",215],["T_STRING","TYPE_DOWNLOADABLE",215],["T_WHITESPACE","\n                    ",215],["T_BOOLEAN_OR","||",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$item",216],["T_OBJECT_OPERATOR","->",216],["T_STRING","getRealProductType",216],"(",")",["T_WHITESPACE"," ",216],["T_IS_EQUAL","==",216],["T_WHITESPACE"," ",216],["T_STRING","Mage_Downloadable_Model_Product_Type",216],["T_DOUBLE_COLON","::",216],["T_STRING","TYPE_DOWNLOADABLE",216],["T_WHITESPACE","\n                ",216],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n                    ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$item",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getStatusId",218],"(",")",["T_WHITESPACE"," ",218],["T_IS_EQUAL","==",218],["T_WHITESPACE"," ",218],["T_STRING","Mage_Sales_Model_Order_Item",218],["T_DOUBLE_COLON","::",218],["T_STRING","STATUS_BACKORDERED",218],["T_WHITESPACE"," ",218],["T_BOOLEAN_AND","&&",218],["T_WHITESPACE","\n                        ",218],["T_VARIABLE","$orderItemStatusToEnable",219],["T_WHITESPACE"," ",219],["T_IS_EQUAL","==",219],["T_WHITESPACE"," ",219],["T_STRING","Mage_Sales_Model_Order_Item",219],["T_DOUBLE_COLON","::",219],["T_STRING","STATUS_PENDING",219],["T_WHITESPACE"," ",219],["T_BOOLEAN_AND","&&",219],["T_WHITESPACE","\n                        ",219],"!",["T_STRING","in_array",220],"(",["T_STRING","Mage_Sales_Model_Order_Item",220],["T_DOUBLE_COLON","::",220],["T_STRING","STATUS_BACKORDERED",220],",",["T_WHITESPACE"," ",220],["T_VARIABLE","$availableStatuses",220],",",["T_WHITESPACE"," ",220],["T_STRING","true",220],")",["T_WHITESPACE"," ",220],")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n                        ",220],["T_VARIABLE","$availableStatuses",221],"[","]",["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_STRING","Mage_Sales_Model_Order_Item",221],["T_DOUBLE_COLON","::",221],["T_STRING","STATUS_BACKORDERED",221],";",["T_WHITESPACE","\n                    ",221],"}",["T_WHITESPACE","\n\n                    ",222],["T_IF","if",224],["T_WHITESPACE"," ",224],"(",["T_STRING","in_array",224],"(",["T_VARIABLE","$item",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","getStatusId",224],"(",")",",",["T_WHITESPACE"," ",224],["T_VARIABLE","$availableStatuses",224],")",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n                        ",224],["T_VARIABLE","$downloadableItemsStatuses",225],"[",["T_VARIABLE","$item",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getId",225],"(",")","]",["T_WHITESPACE"," ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$linkStatuses",225],"[",["T_CONSTANT_ENCAPSED_STRING","'avail'",225],"]",";",["T_WHITESPACE","\n                    ",225],"}",["T_WHITESPACE","\n                ",226],"}",["T_WHITESPACE","\n            ",227],"}",["T_WHITESPACE","\n        ",228],"}",["T_WHITESPACE","\n        ",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(","!",["T_VARIABLE","$downloadableItemsStatuses",230],["T_WHITESPACE"," ",230],["T_BOOLEAN_AND","&&",230],["T_WHITESPACE"," ",230],["T_VARIABLE","$status",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_FOREACH","foreach",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$order",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getAllItems",231],"(",")",["T_WHITESPACE"," ",231],["T_AS","as",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$item",231],")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n                ",231],["T_IF","if",232],["T_WHITESPACE"," ",232],"(",["T_VARIABLE","$item",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","getProductType",232],"(",")",["T_WHITESPACE"," ",232],["T_IS_EQUAL","==",232],["T_WHITESPACE"," ",232],["T_STRING","Mage_Downloadable_Model_Product_Type",232],["T_DOUBLE_COLON","::",232],["T_STRING","TYPE_DOWNLOADABLE",232],["T_WHITESPACE","\n                    ",232],["T_BOOLEAN_OR","||",233],["T_WHITESPACE"," ",233],["T_VARIABLE","$item",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getRealProductType",233],"(",")",["T_WHITESPACE"," ",233],["T_IS_EQUAL","==",233],["T_WHITESPACE"," ",233],["T_STRING","Mage_Downloadable_Model_Product_Type",233],["T_DOUBLE_COLON","::",233],["T_STRING","TYPE_DOWNLOADABLE",233],["T_WHITESPACE","\n                ",233],")",["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n                    ",234],["T_VARIABLE","$downloadableItemsStatuses",235],"[",["T_VARIABLE","$item",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getId",235],"(",")","]",["T_WHITESPACE"," ",235],"=",["T_WHITESPACE"," ",235],["T_VARIABLE","$status",235],";",["T_WHITESPACE","\n                ",235],"}",["T_WHITESPACE","\n            ",236],"}",["T_WHITESPACE","\n        ",237],"}",["T_WHITESPACE","\n\n        ",238],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_VARIABLE","$downloadableItemsStatuses",240],")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$linkPurchased",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE"," ",241],["T_STRING","Mage",241],["T_DOUBLE_COLON","::",241],["T_STRING","getResourceModel",241],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link_purchased_item_collection'",241],")",["T_WHITESPACE","\n            ",241],["T_OBJECT_OPERATOR","->",242],["T_STRING","addFieldToFilter",242],"(",["T_CONSTANT_ENCAPSED_STRING","'order_item_id'",242],",",["T_WHITESPACE"," ",242],["T_ARRAY","array",242],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",242],["T_WHITESPACE"," ",242],["T_DOUBLE_ARROW","=>",242],["T_WHITESPACE"," ",242],["T_STRING","array_keys",242],"(",["T_VARIABLE","$downloadableItemsStatuses",242],")",")",")",";",["T_WHITESPACE","\n            ",242],["T_FOREACH","foreach",243],["T_WHITESPACE"," ",243],"(",["T_VARIABLE","$linkPurchased",243],["T_WHITESPACE"," ",243],["T_AS","as",243],["T_WHITESPACE"," ",243],["T_VARIABLE","$link",243],")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n                ",243],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_VARIABLE","$link",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","getStatus",244],"(",")",["T_WHITESPACE"," ",244],["T_IS_NOT_EQUAL","!=",244],["T_WHITESPACE"," ",244],["T_VARIABLE","$linkStatuses",244],"[",["T_CONSTANT_ENCAPSED_STRING","'expired'",244],"]",["T_WHITESPACE","\n                    ",244],["T_BOOLEAN_AND","&&",245],["T_WHITESPACE"," ",245],"!",["T_EMPTY","empty",245],"(",["T_VARIABLE","$downloadableItemsStatuses",245],"[",["T_VARIABLE","$link",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getOrderItemId",245],"(",")","]",")",["T_WHITESPACE","\n                ",245],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n                    ",246],["T_VARIABLE","$link",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","setStatus",247],"(",["T_VARIABLE","$downloadableItemsStatuses",247],"[",["T_VARIABLE","$link",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getOrderItemId",247],"(",")","]",")",["T_WHITESPACE","\n                    ",247],["T_OBJECT_OPERATOR","->",248],["T_STRING","save",248],"(",")",";",["T_WHITESPACE","\n                ",248],"}",["T_WHITESPACE","\n            ",249],"}",["T_WHITESPACE","\n        ",250],"}",["T_WHITESPACE","\n        ",251],["T_RETURN","return",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Check is allowed guest checkuot if quote contain downloadable product(s)\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Downloadable_Model_Observer\n     *\/",255],["T_WHITESPACE","\n    ",260],["T_PUBLIC","public",261],["T_WHITESPACE"," ",261],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","isAllowedGuestCheckout",261],"(",["T_STRING","Varien_Event_Observer",261],["T_WHITESPACE"," ",261],["T_VARIABLE","$observer",261],")",["T_WHITESPACE","\n    ",261],"{",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$quote",263],["T_WHITESPACE","  ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$observer",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getEvent",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","getQuote",263],"(",")",";",["T_WHITESPACE","\n        ",263],["T_COMMENT","\/* @var $quote Mage_Sales_Model_Quote *\/",264],["T_WHITESPACE","\n        ",264],["T_VARIABLE","$store",265],["T_WHITESPACE","  ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$observer",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getEvent",265],"(",")",["T_OBJECT_OPERATOR","->",265],["T_STRING","getStore",265],"(",")",";",["T_WHITESPACE","\n        ",265],["T_VARIABLE","$result",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$observer",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","getEvent",266],"(",")",["T_OBJECT_OPERATOR","->",266],["T_STRING","getResult",266],"(",")",";",["T_WHITESPACE","\n\n        ",266],["T_VARIABLE","$isContain",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_STRING","false",268],";",["T_WHITESPACE","\n\n        ",268],["T_FOREACH","foreach",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$quote",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getAllItems",270],"(",")",["T_WHITESPACE"," ",270],["T_AS","as",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$item",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_IF","if",271],["T_WHITESPACE"," ",271],"(","(",["T_VARIABLE","$product",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$item",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","getProduct",271],"(",")",")",["T_WHITESPACE"," ",271],["T_BOOLEAN_AND","&&",271],["T_WHITESPACE","\n            ",271],["T_VARIABLE","$product",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","getTypeId",272],"(",")",["T_WHITESPACE"," ",272],["T_IS_EQUAL","==",272],["T_WHITESPACE"," ",272],["T_STRING","Mage_Downloadable_Model_Product_Type",272],["T_DOUBLE_COLON","::",272],["T_STRING","TYPE_DOWNLOADABLE",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n                ",272],["T_VARIABLE","$isContain",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_STRING","true",273],";",["T_WHITESPACE","\n            ",273],"}",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n\n        ",275],["T_IF","if",277],["T_WHITESPACE"," ",277],"(",["T_VARIABLE","$isContain",277],["T_WHITESPACE"," ",277],["T_BOOLEAN_AND","&&",277],["T_WHITESPACE"," ",277],["T_STRING","Mage",277],["T_DOUBLE_COLON","::",277],["T_STRING","getStoreConfigFlag",277],"(",["T_STRING","self",277],["T_DOUBLE_COLON","::",277],["T_STRING","XML_PATH_DISABLE_GUEST_CHECKOUT",277],",",["T_WHITESPACE"," ",277],["T_VARIABLE","$store",277],")",")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n            ",277],["T_VARIABLE","$result",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","setIsAllowed",278],"(",["T_STRING","false",278],")",";",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n\n        ",279],["T_RETURN","return",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],";",["T_WHITESPACE","\n    ",281],"}",["T_WHITESPACE","\n\n    ",282],["T_DOC_COMMENT","\/**\n     * Initialize product options renderer with downloadable specific params\n     *\n     * @param Varien_Event_Observer $observer\n     * @return Mage_Downloadable_Model_Observer\n     *\/",284],["T_WHITESPACE","\n    ",289],["T_PUBLIC","public",290],["T_WHITESPACE"," ",290],["T_FUNCTION","function",290],["T_WHITESPACE"," ",290],["T_STRING","initOptionRenderer",290],"(",["T_STRING","Varien_Event_Observer",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$observer",290],")",["T_WHITESPACE","\n    ",290],"{",["T_WHITESPACE","\n        ",291],["T_VARIABLE","$block",292],["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$observer",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","getBlock",292],"(",")",";",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$block",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","addOptionsRenderCfg",293],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable'",293],",",["T_WHITESPACE"," ",293],["T_CONSTANT_ENCAPSED_STRING","'downloadable\/catalog_product_configuration'",293],")",";",["T_WHITESPACE","\n        ",293],["T_RETURN","return",294],["T_WHITESPACE"," ",294],["T_VARIABLE","$this",294],";",["T_WHITESPACE","\n    ",294],"}",["T_WHITESPACE","\n",295],"}",["T_WHITESPACE","\n",296]]