[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Downloadable\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Downloadable product type model\n *\n * @category    Mage\n * @package     Mage_Downloadable\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Downloadable_Model_Product_Type",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Product_Type_Virtual",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","TYPE_DOWNLOADABLE",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'downloadable'",36],";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Get downloadable product links\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",38],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","getLinks",44],"(",["T_VARIABLE","$product",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_STRING","null",44],")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_VARIABLE","$product",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","getProduct",46],"(",["T_VARIABLE","$product",46],")",";",["T_WHITESPACE","\n        ",46],["T_COMMENT","\/* @var Mage_Catalog_Model_Product $product *\/",47],["T_WHITESPACE","\n        ",47],["T_IF","if",48],["T_WHITESPACE"," ",48],"(",["T_STRING","is_null",48],"(",["T_VARIABLE","$product",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getDownloadableLinks",48],"(",")",")",")",["T_WHITESPACE"," ",48],"{",["T_WHITESPACE","\n            ",48],["T_VARIABLE","$_linkCollection",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_STRING","Mage",49],["T_DOUBLE_COLON","::",49],["T_STRING","getModel",49],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link'",49],")",["T_OBJECT_OPERATOR","->",49],["T_STRING","getCollection",49],"(",")",["T_WHITESPACE","\n                ",49],["T_OBJECT_OPERATOR","->",50],["T_STRING","addProductToFilter",50],"(",["T_VARIABLE","$product",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","getId",50],"(",")",")",["T_WHITESPACE","\n                ",50],["T_OBJECT_OPERATOR","->",51],["T_STRING","addTitleToResult",51],"(",["T_VARIABLE","$product",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getStoreId",51],"(",")",")",["T_WHITESPACE","\n                ",51],["T_OBJECT_OPERATOR","->",52],["T_STRING","addPriceToResult",52],"(",["T_VARIABLE","$product",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","getStore",52],"(",")",["T_OBJECT_OPERATOR","->",52],["T_STRING","getWebsiteId",52],"(",")",")",";",["T_WHITESPACE","\n            ",52],["T_VARIABLE","$linksCollectionById",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_ARRAY","array",53],"(",")",";",["T_WHITESPACE","\n            ",53],["T_FOREACH","foreach",54],["T_WHITESPACE"," ",54],"(",["T_VARIABLE","$_linkCollection",54],["T_WHITESPACE"," ",54],["T_AS","as",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$link",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n                ",54],["T_COMMENT","\/* @var Mage_Downloadable_Model_Link $link *\/",55],["T_WHITESPACE","\n\n                ",55],["T_VARIABLE","$link",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","setProduct",57],"(",["T_VARIABLE","$product",57],")",";",["T_WHITESPACE","\n                ",57],["T_VARIABLE","$linksCollectionById",58],"[",["T_VARIABLE","$link",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getId",58],"(",")","]",["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$link",58],";",["T_WHITESPACE","\n            ",58],"}",["T_WHITESPACE","\n            ",59],["T_VARIABLE","$product",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","setDownloadableLinks",60],"(",["T_VARIABLE","$linksCollectionById",60],")",";",["T_WHITESPACE","\n        ",60],"}",["T_WHITESPACE","\n        ",61],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$product",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getDownloadableLinks",62],"(",")",";",["T_WHITESPACE","\n    ",62],"}",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Check if product has links\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return boolean\n     *\/",65],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","hasLinks",71],"(",["T_VARIABLE","$product",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","null",71],")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getProduct",73],"(",["T_VARIABLE","$product",73],")",["T_OBJECT_OPERATOR","->",73],["T_STRING","hasData",73],"(",["T_CONSTANT_ENCAPSED_STRING","'links_exist'",73],")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_RETURN","return",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getProduct",74],"(",["T_VARIABLE","$product",74],")",["T_OBJECT_OPERATOR","->",74],["T_STRING","getData",74],"(",["T_CONSTANT_ENCAPSED_STRING","'links_exist'",74],")",";",["T_WHITESPACE","\n        ",74],"}",["T_WHITESPACE","\n        ",75],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_STRING","count",76],"(",["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getLinks",76],"(",["T_VARIABLE","$product",76],")",")",["T_WHITESPACE"," ",76],">",["T_WHITESPACE"," ",76],["T_LNUMBER","0",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_DOC_COMMENT","\/**\n     * Check if product has options\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return boolean\n     *\/",79],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","hasOptions",85],"(",["T_VARIABLE","$product",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","null",85],")",["T_WHITESPACE","\n    ",85],"{",["T_WHITESPACE","\n        ",86],["T_COMMENT","\/\/return true;\n",87],["T_WHITESPACE","        ",88],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getProduct",88],"(",["T_VARIABLE","$product",88],")",["T_OBJECT_OPERATOR","->",88],["T_STRING","getLinksPurchasedSeparately",88],"(",")",["T_WHITESPACE","\n            ",88],["T_BOOLEAN_OR","||",89],["T_WHITESPACE"," ",89],["T_STRING","parent",89],["T_DOUBLE_COLON","::",89],["T_STRING","hasOptions",89],"(",["T_VARIABLE","$product",89],")",";",["T_WHITESPACE","\n    ",89],"}",["T_WHITESPACE","\n\n    ",90],["T_DOC_COMMENT","\/**\n     * Check if product has required options\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",92],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","hasRequiredOptions",98],"(",["T_VARIABLE","$product",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_STRING","null",98],")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(",["T_STRING","parent",100],["T_DOUBLE_COLON","::",100],["T_STRING","hasRequiredOptions",100],"(",["T_VARIABLE","$product",100],")",["T_WHITESPACE"," ",100],["T_BOOLEAN_OR","||",100],["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getProduct",100],"(",["T_VARIABLE","$product",100],")",["T_OBJECT_OPERATOR","->",100],["T_STRING","getLinksPurchasedSeparately",100],"(",")",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n            ",100],["T_RETURN","return",101],["T_WHITESPACE"," ",101],["T_STRING","true",101],";",["T_WHITESPACE","\n        ",101],"}",["T_WHITESPACE","\n        ",102],["T_RETURN","return",103],["T_WHITESPACE"," ",103],["T_STRING","false",103],";",["T_WHITESPACE","\n    ",103],"}",["T_WHITESPACE","\n\n    ",104],["T_DOC_COMMENT","\/**\n     * Check if product cannot be purchased with no links selected\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return boolean\n     *\/",106],["T_WHITESPACE","\n    ",111],["T_PUBLIC","public",112],["T_WHITESPACE"," ",112],["T_FUNCTION","function",112],["T_WHITESPACE"," ",112],["T_STRING","getLinkSelectionRequired",112],"(",["T_VARIABLE","$product",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","null",112],")",["T_WHITESPACE","\n    ",112],"{",["T_WHITESPACE","\n        ",113],["T_RETURN","return",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getProduct",114],"(",["T_VARIABLE","$product",114],")",["T_OBJECT_OPERATOR","->",114],["T_STRING","getLinksPurchasedSeparately",114],"(",")",";",["T_WHITESPACE","\n    ",114],"}",["T_WHITESPACE","\n\n    ",115],["T_DOC_COMMENT","\/**\n     * Get downloadable product samples\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Downloadable_Model_Mysql4_Sample_Collection\n     *\/",117],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","getSamples",123],"(",["T_VARIABLE","$product",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","null",123],")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$product",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","getProduct",125],"(",["T_VARIABLE","$product",125],")",";",["T_WHITESPACE","\n        ",125],["T_COMMENT","\/* @var Mage_Catalog_Model_Product $product *\/",126],["T_WHITESPACE","\n        ",126],["T_IF","if",127],["T_WHITESPACE"," ",127],"(",["T_STRING","is_null",127],"(",["T_VARIABLE","$product",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getDownloadableSamples",127],"(",")",")",")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n            ",127],["T_VARIABLE","$_sampleCollection",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_STRING","Mage",128],["T_DOUBLE_COLON","::",128],["T_STRING","getModel",128],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/sample'",128],")",["T_OBJECT_OPERATOR","->",128],["T_STRING","getCollection",128],"(",")",["T_WHITESPACE","\n                ",128],["T_OBJECT_OPERATOR","->",129],["T_STRING","addProductToFilter",129],"(",["T_VARIABLE","$product",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getId",129],"(",")",")",["T_WHITESPACE","\n                ",129],["T_OBJECT_OPERATOR","->",130],["T_STRING","addTitleToResult",130],"(",["T_VARIABLE","$product",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getStoreId",130],"(",")",")",";",["T_WHITESPACE","\n            ",130],["T_VARIABLE","$product",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","setDownloadableSamples",131],"(",["T_VARIABLE","$_sampleCollection",131],")",";",["T_WHITESPACE","\n        ",131],"}",["T_WHITESPACE","\n\n        ",132],["T_RETURN","return",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$product",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getDownloadableSamples",134],"(",")",";",["T_WHITESPACE","\n    ",134],"}",["T_WHITESPACE","\n\n    ",135],["T_DOC_COMMENT","\/**\n     * Check if product has samples\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return boolean\n     *\/",137],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","hasSamples",143],"(",["T_VARIABLE","$product",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_STRING","null",143],")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_RETURN","return",145],["T_WHITESPACE"," ",145],["T_STRING","count",145],"(",["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","getSamples",145],"(",["T_VARIABLE","$product",145],")",")",["T_WHITESPACE"," ",145],">",["T_WHITESPACE"," ",145],["T_LNUMBER","0",145],";",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Save Product downloadable information (links and samples)\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Downloadable_Model_Product_Type\n     *\/",148],["T_WHITESPACE","\n    ",153],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","save",154],"(",["T_VARIABLE","$product",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_STRING","null",154],")",["T_WHITESPACE","\n    ",154],"{",["T_WHITESPACE","\n        ",155],["T_STRING","parent",156],["T_DOUBLE_COLON","::",156],["T_STRING","save",156],"(",["T_VARIABLE","$product",156],")",";",["T_WHITESPACE","\n\n        ",156],["T_VARIABLE","$product",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","getProduct",158],"(",["T_VARIABLE","$product",158],")",";",["T_WHITESPACE","\n        ",158],["T_COMMENT","\/* @var Mage_Catalog_Model_Product $product *\/",159],["T_WHITESPACE","\n\n        ",159],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$data",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$product",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getDownloadableData",161],"(",")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_ISSET","isset",162],"(",["T_VARIABLE","$data",162],"[",["T_CONSTANT_ENCAPSED_STRING","'sample'",162],"]",")",")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n                ",162],["T_VARIABLE","$_deleteItems",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_ARRAY","array",163],"(",")",";",["T_WHITESPACE","\n                ",163],["T_FOREACH","foreach",164],["T_WHITESPACE"," ",164],"(",["T_VARIABLE","$data",164],"[",["T_CONSTANT_ENCAPSED_STRING","'sample'",164],"]",["T_WHITESPACE"," ",164],["T_AS","as",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$sampleItem",164],")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n                    ",164],["T_IF","if",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$sampleItem",165],"[",["T_CONSTANT_ENCAPSED_STRING","'is_delete'",165],"]",["T_WHITESPACE"," ",165],["T_IS_EQUAL","==",165],["T_WHITESPACE"," ",165],["T_CONSTANT_ENCAPSED_STRING","'1'",165],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                        ",165],["T_IF","if",166],["T_WHITESPACE"," ",166],"(",["T_VARIABLE","$sampleItem",166],"[",["T_CONSTANT_ENCAPSED_STRING","'sample_id'",166],"]",")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n                            ",166],["T_VARIABLE","$_deleteItems",167],"[","]",["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$sampleItem",167],"[",["T_CONSTANT_ENCAPSED_STRING","'sample_id'",167],"]",";",["T_WHITESPACE","\n                        ",167],"}",["T_WHITESPACE","\n                    ",168],"}",["T_WHITESPACE"," ",169],["T_ELSE","else",169],["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n                        ",169],["T_UNSET","unset",170],"(",["T_VARIABLE","$sampleItem",170],"[",["T_CONSTANT_ENCAPSED_STRING","'is_delete'",170],"]",")",";",["T_WHITESPACE","\n                        ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(","!",["T_VARIABLE","$sampleItem",171],"[",["T_CONSTANT_ENCAPSED_STRING","'sample_id'",171],"]",")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n                            ",171],["T_UNSET","unset",172],"(",["T_VARIABLE","$sampleItem",172],"[",["T_CONSTANT_ENCAPSED_STRING","'sample_id'",172],"]",")",";",["T_WHITESPACE","\n                        ",172],"}",["T_WHITESPACE","\n                        ",173],["T_VARIABLE","$sampleModel",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_STRING","Mage",174],["T_DOUBLE_COLON","::",174],["T_STRING","getModel",174],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/sample'",174],")",";",["T_WHITESPACE","\n                        ",174],["T_VARIABLE","$files",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_ARRAY","array",175],"(",")",";",["T_WHITESPACE","\n                        ",175],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_ISSET","isset",176],"(",["T_VARIABLE","$sampleItem",176],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",176],"]",")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                            ",176],["T_VARIABLE","$files",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","Mage",177],["T_DOUBLE_COLON","::",177],["T_STRING","helper",177],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",177],")",["T_OBJECT_OPERATOR","->",177],["T_STRING","jsonDecode",177],"(",["T_VARIABLE","$sampleItem",177],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",177],"]",")",";",["T_WHITESPACE","\n                            ",177],["T_UNSET","unset",178],"(",["T_VARIABLE","$sampleItem",178],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",178],"]",")",";",["T_WHITESPACE","\n                        ",178],"}",["T_WHITESPACE","\n\n                        ",179],["T_IF","if",181],["T_WHITESPACE"," ",181],"(",["T_ISSET","isset",181],"(",["T_VARIABLE","$sampleItem",181],"[",["T_CONSTANT_ENCAPSED_STRING","'sample_url'",181],"]",")",")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n                            ",181],["T_VARIABLE","$sampleItem",182],"[",["T_CONSTANT_ENCAPSED_STRING","'sample_url'",182],"]",["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","Mage",182],["T_DOUBLE_COLON","::",182],["T_STRING","helper",182],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",182],")",["T_OBJECT_OPERATOR","->",182],["T_STRING","escapeUrl",182],"(",["T_VARIABLE","$sampleItem",182],"[",["T_CONSTANT_ENCAPSED_STRING","'sample_url'",182],"]",")",";",["T_WHITESPACE","\n                        ",182],"}",["T_WHITESPACE","\n\n                        ",183],["T_VARIABLE","$sampleModel",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","setData",185],"(",["T_VARIABLE","$sampleItem",185],")",["T_WHITESPACE","\n                            ",185],["T_OBJECT_OPERATOR","->",186],["T_STRING","setSampleType",186],"(",["T_VARIABLE","$sampleItem",186],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",186],"]",")",["T_WHITESPACE","\n                            ",186],["T_OBJECT_OPERATOR","->",187],["T_STRING","setProductId",187],"(",["T_VARIABLE","$product",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getId",187],"(",")",")",["T_WHITESPACE","\n                            ",187],["T_OBJECT_OPERATOR","->",188],["T_STRING","setStoreId",188],"(",["T_VARIABLE","$product",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getStoreId",188],"(",")",")",";",["T_WHITESPACE","\n\n                        ",188],["T_IF","if",190],["T_WHITESPACE"," ",190],"(",["T_VARIABLE","$sampleModel",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getSampleType",190],"(",")",["T_WHITESPACE"," ",190],["T_IS_EQUAL","==",190],["T_WHITESPACE"," ",190],["T_STRING","Mage_Downloadable_Helper_Download",190],["T_DOUBLE_COLON","::",190],["T_STRING","LINK_TYPE_FILE",190],")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                            ",190],["T_VARIABLE","$sampleFileName",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_STRING","Mage",191],["T_DOUBLE_COLON","::",191],["T_STRING","helper",191],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/file'",191],")",["T_OBJECT_OPERATOR","->",191],["T_STRING","moveFileFromTmp",191],"(",["T_WHITESPACE","\n                                ",191],["T_STRING","Mage_Downloadable_Model_Sample",192],["T_DOUBLE_COLON","::",192],["T_STRING","getBaseTmpPath",192],"(",")",",",["T_WHITESPACE","\n                                ",192],["T_STRING","Mage_Downloadable_Model_Sample",193],["T_DOUBLE_COLON","::",193],["T_STRING","getBasePath",193],"(",")",",",["T_WHITESPACE","\n                                ",193],["T_VARIABLE","$files",194],["T_WHITESPACE","\n                            ",194],")",";",["T_WHITESPACE","\n                            ",195],["T_VARIABLE","$sampleModel",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","setSampleFile",196],"(",["T_VARIABLE","$sampleFileName",196],")",";",["T_WHITESPACE","\n                        ",196],"}",["T_WHITESPACE","\n                        ",197],["T_VARIABLE","$sampleModel",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","save",198],"(",")",";",["T_WHITESPACE","\n                    ",198],"}",["T_WHITESPACE","\n                ",199],"}",["T_WHITESPACE","\n                ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_VARIABLE","$_deleteItems",201],")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                    ",201],["T_STRING","Mage",202],["T_DOUBLE_COLON","::",202],["T_STRING","getResourceModel",202],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/sample'",202],")",["T_OBJECT_OPERATOR","->",202],["T_STRING","deleteItems",202],"(",["T_VARIABLE","$_deleteItems",202],")",";",["T_WHITESPACE","\n                ",202],"}",["T_WHITESPACE","\n            ",203],"}",["T_WHITESPACE","\n            ",204],["T_IF","if",205],["T_WHITESPACE"," ",205],"(",["T_ISSET","isset",205],"(",["T_VARIABLE","$data",205],"[",["T_CONSTANT_ENCAPSED_STRING","'link'",205],"]",")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n                ",205],["T_VARIABLE","$_deleteItems",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_ARRAY","array",206],"(",")",";",["T_WHITESPACE","\n                ",206],["T_FOREACH","foreach",207],["T_WHITESPACE"," ",207],"(",["T_VARIABLE","$data",207],"[",["T_CONSTANT_ENCAPSED_STRING","'link'",207],"]",["T_WHITESPACE"," ",207],["T_AS","as",207],["T_WHITESPACE"," ",207],["T_VARIABLE","$linkItem",207],")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n                    ",207],["T_IF","if",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$linkItem",208],"[",["T_CONSTANT_ENCAPSED_STRING","'is_delete'",208],"]",["T_WHITESPACE"," ",208],["T_IS_EQUAL","==",208],["T_WHITESPACE"," ",208],["T_CONSTANT_ENCAPSED_STRING","'1'",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n                        ",208],["T_IF","if",209],["T_WHITESPACE"," ",209],"(",["T_VARIABLE","$linkItem",209],"[",["T_CONSTANT_ENCAPSED_STRING","'link_id'",209],"]",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n                            ",209],["T_VARIABLE","$_deleteItems",210],"[","]",["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_VARIABLE","$linkItem",210],"[",["T_CONSTANT_ENCAPSED_STRING","'link_id'",210],"]",";",["T_WHITESPACE","\n                        ",210],"}",["T_WHITESPACE","\n                    ",211],"}",["T_WHITESPACE"," ",212],["T_ELSE","else",212],["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n                        ",212],["T_UNSET","unset",213],"(",["T_VARIABLE","$linkItem",213],"[",["T_CONSTANT_ENCAPSED_STRING","'is_delete'",213],"]",")",";",["T_WHITESPACE","\n                        ",213],["T_IF","if",214],["T_WHITESPACE"," ",214],"(","!",["T_VARIABLE","$linkItem",214],"[",["T_CONSTANT_ENCAPSED_STRING","'link_id'",214],"]",")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n                            ",214],["T_UNSET","unset",215],"(",["T_VARIABLE","$linkItem",215],"[",["T_CONSTANT_ENCAPSED_STRING","'link_id'",215],"]",")",";",["T_WHITESPACE","\n                        ",215],"}",["T_WHITESPACE","\n                        ",216],["T_VARIABLE","$files",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_ARRAY","array",217],"(",")",";",["T_WHITESPACE","\n                        ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_ISSET","isset",218],"(",["T_VARIABLE","$linkItem",218],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",218],"]",")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n                            ",218],["T_VARIABLE","$files",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_STRING","Mage",219],["T_DOUBLE_COLON","::",219],["T_STRING","helper",219],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",219],")",["T_OBJECT_OPERATOR","->",219],["T_STRING","jsonDecode",219],"(",["T_VARIABLE","$linkItem",219],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",219],"]",")",";",["T_WHITESPACE","\n                            ",219],["T_UNSET","unset",220],"(",["T_VARIABLE","$linkItem",220],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",220],"]",")",";",["T_WHITESPACE","\n                        ",220],"}",["T_WHITESPACE","\n                        ",221],["T_VARIABLE","$sample",222],["T_WHITESPACE"," ",222],"=",["T_WHITESPACE"," ",222],["T_ARRAY","array",222],"(",")",";",["T_WHITESPACE","\n                        ",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_ISSET","isset",223],"(",["T_VARIABLE","$linkItem",223],"[",["T_CONSTANT_ENCAPSED_STRING","'sample'",223],"]",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n                            ",223],["T_VARIABLE","$sample",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$linkItem",224],"[",["T_CONSTANT_ENCAPSED_STRING","'sample'",224],"]",";",["T_WHITESPACE","\n                            ",224],["T_UNSET","unset",225],"(",["T_VARIABLE","$linkItem",225],"[",["T_CONSTANT_ENCAPSED_STRING","'sample'",225],"]",")",";",["T_WHITESPACE","\n                        ",225],"}",["T_WHITESPACE","\n                        ",226],["T_IF","if",227],["T_WHITESPACE"," ",227],"(",["T_ISSET","isset",227],"(",["T_VARIABLE","$linkItem",227],"[",["T_CONSTANT_ENCAPSED_STRING","'link_url'",227],"]",")",")",["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n                            ",227],["T_VARIABLE","$linkItem",228],"[",["T_CONSTANT_ENCAPSED_STRING","'link_url'",228],"]",["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_STRING","Mage",228],["T_DOUBLE_COLON","::",228],["T_STRING","helper",228],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",228],")",["T_OBJECT_OPERATOR","->",228],["T_STRING","escapeUrl",228],"(",["T_VARIABLE","$linkItem",228],"[",["T_CONSTANT_ENCAPSED_STRING","'link_url'",228],"]",")",";",["T_WHITESPACE","\n                        ",228],"}",["T_WHITESPACE","\n                        ",229],["T_VARIABLE","$linkModel",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_STRING","Mage",230],["T_DOUBLE_COLON","::",230],["T_STRING","getModel",230],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link'",230],")",["T_WHITESPACE","\n                            ",230],["T_OBJECT_OPERATOR","->",231],["T_STRING","setData",231],"(",["T_VARIABLE","$linkItem",231],")",["T_WHITESPACE","\n                            ",231],["T_OBJECT_OPERATOR","->",232],["T_STRING","setLinkType",232],"(",["T_VARIABLE","$linkItem",232],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",232],"]",")",["T_WHITESPACE","\n                            ",232],["T_OBJECT_OPERATOR","->",233],["T_STRING","setProductId",233],"(",["T_VARIABLE","$product",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","getId",233],"(",")",")",["T_WHITESPACE","\n                            ",233],["T_OBJECT_OPERATOR","->",234],["T_STRING","setStoreId",234],"(",["T_VARIABLE","$product",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getStoreId",234],"(",")",")",["T_WHITESPACE","\n                            ",234],["T_OBJECT_OPERATOR","->",235],["T_STRING","setWebsiteId",235],"(",["T_VARIABLE","$product",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","getStore",235],"(",")",["T_OBJECT_OPERATOR","->",235],["T_STRING","getWebsiteId",235],"(",")",")",["T_WHITESPACE","\n                            ",235],["T_OBJECT_OPERATOR","->",236],["T_STRING","setProductWebsiteIds",236],"(",["T_VARIABLE","$product",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","getWebsiteIds",236],"(",")",")",";",["T_WHITESPACE","\n                        ",236],["T_IF","if",237],["T_WHITESPACE"," ",237],"(",["T_STRING","null",237],["T_WHITESPACE"," ",237],["T_IS_IDENTICAL","===",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$linkModel",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","getPrice",237],"(",")",")",["T_WHITESPACE"," ",237],"{",["T_WHITESPACE","\n                            ",237],["T_VARIABLE","$linkModel",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","setPrice",238],"(",["T_LNUMBER","0",238],")",";",["T_WHITESPACE","\n                        ",238],"}",["T_WHITESPACE","\n                        ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_VARIABLE","$linkModel",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getIsUnlimited",240],"(",")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n                            ",240],["T_VARIABLE","$linkModel",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","setNumberOfDownloads",241],"(",["T_LNUMBER","0",241],")",";",["T_WHITESPACE","\n                        ",241],"}",["T_WHITESPACE","\n                        ",242],["T_VARIABLE","$sampleFile",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_ARRAY","array",243],"(",")",";",["T_WHITESPACE","\n                        ",243],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_VARIABLE","$sample",244],["T_WHITESPACE"," ",244],["T_BOOLEAN_AND","&&",244],["T_WHITESPACE"," ",244],["T_ISSET","isset",244],"(",["T_VARIABLE","$sample",244],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",244],"]",")",")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n                            ",244],["T_IF","if",245],["T_WHITESPACE"," ",245],"(",["T_VARIABLE","$sample",245],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",245],"]",["T_WHITESPACE"," ",245],["T_IS_EQUAL","==",245],["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'url'",245],["T_WHITESPACE"," ",245],["T_BOOLEAN_AND","&&",245],["T_WHITESPACE"," ",245],["T_VARIABLE","$sample",245],"[",["T_CONSTANT_ENCAPSED_STRING","'url'",245],"]",["T_WHITESPACE"," ",245],["T_IS_NOT_EQUAL","!=",245],["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","''",245],")",["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n                                ",245],["T_VARIABLE","$linkModel",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","setSampleUrl",246],"(",["T_STRING","Mage",246],["T_DOUBLE_COLON","::",246],["T_STRING","helper",246],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",246],")",["T_OBJECT_OPERATOR","->",246],["T_STRING","escapeUrl",246],"(",["T_VARIABLE","$sample",246],"[",["T_CONSTANT_ENCAPSED_STRING","'url'",246],"]",")",")",";",["T_WHITESPACE","\n                            ",246],"}",["T_WHITESPACE","\n                            ",247],["T_VARIABLE","$linkModel",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","setSampleType",248],"(",["T_VARIABLE","$sample",248],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",248],"]",")",";",["T_WHITESPACE","\n                            ",248],["T_VARIABLE","$sampleFile",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_STRING","Mage",249],["T_DOUBLE_COLON","::",249],["T_STRING","helper",249],"(",["T_CONSTANT_ENCAPSED_STRING","'core'",249],")",["T_OBJECT_OPERATOR","->",249],["T_STRING","jsonDecode",249],"(",["T_VARIABLE","$sample",249],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",249],"]",")",";",["T_WHITESPACE","\n                        ",249],"}",["T_WHITESPACE","\n                        ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_VARIABLE","$linkModel",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","getLinkType",251],"(",")",["T_WHITESPACE"," ",251],["T_IS_EQUAL","==",251],["T_WHITESPACE"," ",251],["T_STRING","Mage_Downloadable_Helper_Download",251],["T_DOUBLE_COLON","::",251],["T_STRING","LINK_TYPE_FILE",251],")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n                            ",251],["T_VARIABLE","$linkFileName",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_STRING","Mage",252],["T_DOUBLE_COLON","::",252],["T_STRING","helper",252],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/file'",252],")",["T_OBJECT_OPERATOR","->",252],["T_STRING","moveFileFromTmp",252],"(",["T_WHITESPACE","\n                                ",252],["T_STRING","Mage_Downloadable_Model_Link",253],["T_DOUBLE_COLON","::",253],["T_STRING","getBaseTmpPath",253],"(",")",",",["T_WHITESPACE","\n                                ",253],["T_STRING","Mage_Downloadable_Model_Link",254],["T_DOUBLE_COLON","::",254],["T_STRING","getBasePath",254],"(",")",",",["T_WHITESPACE","\n                                ",254],["T_VARIABLE","$files",255],["T_WHITESPACE","\n                            ",255],")",";",["T_WHITESPACE","\n                            ",256],["T_VARIABLE","$linkModel",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","setLinkFile",257],"(",["T_VARIABLE","$linkFileName",257],")",";",["T_WHITESPACE","\n                        ",257],"}",["T_WHITESPACE","\n                        ",258],["T_IF","if",259],["T_WHITESPACE"," ",259],"(",["T_VARIABLE","$linkModel",259],["T_OBJECT_OPERATOR","->",259],["T_STRING","getSampleType",259],"(",")",["T_WHITESPACE"," ",259],["T_IS_EQUAL","==",259],["T_WHITESPACE"," ",259],["T_STRING","Mage_Downloadable_Helper_Download",259],["T_DOUBLE_COLON","::",259],["T_STRING","LINK_TYPE_FILE",259],")",["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n                            ",259],["T_VARIABLE","$linkSampleFileName",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_STRING","Mage",260],["T_DOUBLE_COLON","::",260],["T_STRING","helper",260],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/file'",260],")",["T_OBJECT_OPERATOR","->",260],["T_STRING","moveFileFromTmp",260],"(",["T_WHITESPACE","\n                                ",260],["T_STRING","Mage_Downloadable_Model_Link",261],["T_DOUBLE_COLON","::",261],["T_STRING","getBaseSampleTmpPath",261],"(",")",",",["T_WHITESPACE","\n                                ",261],["T_STRING","Mage_Downloadable_Model_Link",262],["T_DOUBLE_COLON","::",262],["T_STRING","getBaseSamplePath",262],"(",")",",",["T_WHITESPACE","\n                                ",262],["T_VARIABLE","$sampleFile",263],["T_WHITESPACE","\n                            ",263],")",";",["T_WHITESPACE","\n                            ",264],["T_VARIABLE","$linkModel",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","setSampleFile",265],"(",["T_VARIABLE","$linkSampleFileName",265],")",";",["T_WHITESPACE","\n                        ",265],"}",["T_WHITESPACE","\n                        ",266],["T_VARIABLE","$linkModel",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","save",267],"(",")",";",["T_WHITESPACE","\n                    ",267],"}",["T_WHITESPACE","\n                ",268],"}",["T_WHITESPACE","\n                ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$_deleteItems",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n                    ",270],["T_STRING","Mage",271],["T_DOUBLE_COLON","::",271],["T_STRING","getResourceModel",271],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link'",271],")",["T_OBJECT_OPERATOR","->",271],["T_STRING","deleteItems",271],"(",["T_VARIABLE","$_deleteItems",271],")",";",["T_WHITESPACE","\n                ",271],"}",["T_WHITESPACE","\n                ",272],["T_IF","if",273],["T_WHITESPACE"," ",273],"(",["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getProduct",273],"(",["T_VARIABLE","$product",273],")",["T_OBJECT_OPERATOR","->",273],["T_STRING","getLinksPurchasedSeparately",273],"(",")",")",["T_WHITESPACE"," ",273],"{",["T_WHITESPACE","\n                    ",273],["T_VARIABLE","$this",274],["T_OBJECT_OPERATOR","->",274],["T_STRING","getProduct",274],"(",["T_VARIABLE","$product",274],")",["T_OBJECT_OPERATOR","->",274],["T_STRING","setIsCustomOptionChanged",274],"(",")",";",["T_WHITESPACE","\n                ",274],"}",["T_WHITESPACE","\n            ",275],"}",["T_WHITESPACE","\n        ",276],"}",["T_WHITESPACE","\n\n        ",277],["T_RETURN","return",279],["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],";",["T_WHITESPACE","\n    ",279],"}",["T_WHITESPACE","\n\n    ",280],["T_DOC_COMMENT","\/**\n     * Prepare product and its configuration to be added to some products list.\n     * Perform standard preparation process and then prepare options for downloadable links.\n     *\n     * @param Varien_Object $buyRequest\n     * @param Mage_Catalog_Model_Product $product\n     * @param string $processMode\n     * @return array|string\n     *\/",282],["T_WHITESPACE","\n    ",290],["T_PROTECTED","protected",291],["T_WHITESPACE"," ",291],["T_FUNCTION","function",291],["T_WHITESPACE"," ",291],["T_STRING","_prepareProduct",291],"(",["T_STRING","Varien_Object",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$buyRequest",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$product",291],",",["T_WHITESPACE"," ",291],["T_VARIABLE","$processMode",291],")",["T_WHITESPACE","\n    ",291],"{",["T_WHITESPACE","\n        ",292],["T_VARIABLE","$result",293],["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_STRING","parent",293],["T_DOUBLE_COLON","::",293],["T_STRING","_prepareProduct",293],"(",["T_VARIABLE","$buyRequest",293],",",["T_WHITESPACE"," ",293],["T_VARIABLE","$product",293],",",["T_WHITESPACE"," ",293],["T_VARIABLE","$processMode",293],")",";",["T_WHITESPACE","\n\n        ",293],["T_IF","if",295],["T_WHITESPACE"," ",295],"(",["T_STRING","is_string",295],"(",["T_VARIABLE","$result",295],")",")",["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n            ",295],["T_RETURN","return",296],["T_WHITESPACE"," ",296],["T_VARIABLE","$result",296],";",["T_WHITESPACE","\n        ",296],"}",["T_WHITESPACE","\n        ",297],["T_COMMENT","\/\/ if adding product from admin area we add all links to product\n",298],["T_WHITESPACE","        ",299],["T_VARIABLE","$originalLinksPurchasedSeparately",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_STRING","null",299],";",["T_WHITESPACE","\n        ",299],["T_IF","if",300],["T_WHITESPACE"," ",300],"(",["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getProduct",300],"(",["T_VARIABLE","$product",300],")",["T_OBJECT_OPERATOR","->",300],["T_STRING","getSkipCheckRequiredOption",300],"(",")",")",["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n            ",300],["T_VARIABLE","$originalLinksPurchasedSeparately",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","getProduct",301],"(",["T_VARIABLE","$product",301],")",["T_WHITESPACE","\n                ",301],["T_OBJECT_OPERATOR","->",302],["T_STRING","getLinksPurchasedSeparately",302],"(",")",";",["T_WHITESPACE","\n            ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","getProduct",303],"(",["T_VARIABLE","$product",303],")",["T_OBJECT_OPERATOR","->",303],["T_STRING","setLinksPurchasedSeparately",303],"(",["T_STRING","false",303],")",";",["T_WHITESPACE","\n        ",303],"}",["T_WHITESPACE","\n        ",304],["T_VARIABLE","$preparedLinks",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_ARRAY","array",305],"(",")",";",["T_WHITESPACE","\n        ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","getProduct",306],"(",["T_VARIABLE","$product",306],")",["T_OBJECT_OPERATOR","->",306],["T_STRING","getLinksPurchasedSeparately",306],"(",")",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_IF","if",307],["T_WHITESPACE"," ",307],"(",["T_VARIABLE","$links",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$buyRequest",307],["T_OBJECT_OPERATOR","->",307],["T_STRING","getLinks",307],"(",")",")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n                ",307],["T_FOREACH","foreach",308],["T_WHITESPACE"," ",308],"(",["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","getLinks",308],"(",["T_VARIABLE","$product",308],")",["T_WHITESPACE"," ",308],["T_AS","as",308],["T_WHITESPACE"," ",308],["T_VARIABLE","$link",308],")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n                    ",308],["T_IF","if",309],["T_WHITESPACE"," ",309],"(",["T_STRING","in_array",309],"(",["T_VARIABLE","$link",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","getId",309],"(",")",",",["T_WHITESPACE"," ",309],["T_VARIABLE","$links",309],")",")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n                        ",309],["T_VARIABLE","$preparedLinks",310],"[","]",["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_VARIABLE","$link",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getId",310],"(",")",";",["T_WHITESPACE","\n                    ",310],"}",["T_WHITESPACE","\n                ",311],"}",["T_WHITESPACE","\n            ",312],"}",["T_WHITESPACE","\n        ",313],"}",["T_WHITESPACE"," ",314],["T_ELSE","else",314],["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_FOREACH","foreach",315],["T_WHITESPACE"," ",315],"(",["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getLinks",315],"(",["T_VARIABLE","$product",315],")",["T_WHITESPACE"," ",315],["T_AS","as",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$link",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n                ",315],["T_VARIABLE","$preparedLinks",316],"[","]",["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_VARIABLE","$link",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getId",316],"(",")",";",["T_WHITESPACE","\n            ",316],"}",["T_WHITESPACE","\n        ",317],"}",["T_WHITESPACE","\n        ",318],["T_IF","if",319],["T_WHITESPACE"," ",319],"(",["T_STRING","null",319],["T_WHITESPACE"," ",319],["T_IS_NOT_IDENTICAL","!==",319],["T_WHITESPACE"," ",319],["T_VARIABLE","$originalLinksPurchasedSeparately",319],")",["T_WHITESPACE"," ",319],"{",["T_WHITESPACE","\n            ",319],["T_VARIABLE","$this",320],["T_OBJECT_OPERATOR","->",320],["T_STRING","getProduct",320],"(",["T_VARIABLE","$product",320],")",["T_WHITESPACE","\n                ",320],["T_OBJECT_OPERATOR","->",321],["T_STRING","setLinksPurchasedSeparately",321],"(",["T_VARIABLE","$originalLinksPurchasedSeparately",321],")",";",["T_WHITESPACE","\n        ",321],"}",["T_WHITESPACE","\n        ",322],["T_IF","if",323],["T_WHITESPACE"," ",323],"(",["T_VARIABLE","$preparedLinks",323],")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n            ",323],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","getProduct",324],"(",["T_VARIABLE","$product",324],")",["T_OBJECT_OPERATOR","->",324],["T_STRING","addCustomOption",324],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable_link_ids'",324],",",["T_WHITESPACE"," ",324],["T_STRING","implode",324],"(",["T_CONSTANT_ENCAPSED_STRING","','",324],",",["T_WHITESPACE"," ",324],["T_VARIABLE","$preparedLinks",324],")",")",";",["T_WHITESPACE","\n            ",324],["T_RETURN","return",325],["T_WHITESPACE"," ",325],["T_VARIABLE","$result",325],";",["T_WHITESPACE","\n        ",325],"}",["T_WHITESPACE","\n        ",326],["T_IF","if",327],["T_WHITESPACE"," ",327],"(",["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","getLinkSelectionRequired",327],"(",["T_VARIABLE","$product",327],")",["T_WHITESPACE"," ",327],["T_BOOLEAN_AND","&&",327],["T_WHITESPACE"," ",327],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","_isStrictProcessMode",327],"(",["T_VARIABLE","$processMode",327],")",")",["T_WHITESPACE"," ",327],"{",["T_WHITESPACE","\n            ",327],["T_RETURN","return",328],["T_WHITESPACE"," ",328],["T_STRING","Mage",328],["T_DOUBLE_COLON","::",328],["T_STRING","helper",328],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable'",328],")",["T_OBJECT_OPERATOR","->",328],["T_STRING","__",328],"(",["T_CONSTANT_ENCAPSED_STRING","'Please specify product link(s).'",328],")",";",["T_WHITESPACE","\n        ",328],"}",["T_WHITESPACE","\n        ",329],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$result",330],";",["T_WHITESPACE","\n    ",330],"}",["T_WHITESPACE","\n\n    ",331],["T_DOC_COMMENT","\/**\n     * Check if product can be bought\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return Mage_Bundle_Model_Product_Type\n     * @throws Mage_Core_Exception\n     *\/",333],["T_WHITESPACE","\n    ",339],["T_PUBLIC","public",340],["T_WHITESPACE"," ",340],["T_FUNCTION","function",340],["T_WHITESPACE"," ",340],["T_STRING","checkProductBuyState",340],"(",["T_VARIABLE","$product",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_STRING","null",340],")",["T_WHITESPACE","\n    ",340],"{",["T_WHITESPACE","\n        ",341],["T_STRING","parent",342],["T_DOUBLE_COLON","::",342],["T_STRING","checkProductBuyState",342],"(",["T_VARIABLE","$product",342],")",";",["T_WHITESPACE","\n        ",342],["T_VARIABLE","$product",343],["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_VARIABLE","$this",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","getProduct",343],"(",["T_VARIABLE","$product",343],")",";",["T_WHITESPACE","\n        ",343],["T_VARIABLE","$option",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_VARIABLE","$product",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","getCustomOption",344],"(",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",344],")",";",["T_WHITESPACE","\n        ",344],["T_IF","if",345],["T_WHITESPACE"," ",345],"(",["T_VARIABLE","$option",345],["T_WHITESPACE"," ",345],["T_INSTANCEOF","instanceof",345],["T_WHITESPACE"," ",345],["T_STRING","Mage_Sales_Model_Quote_Item_Option",345],")",["T_WHITESPACE"," ",345],"{",["T_WHITESPACE","\n            ",345],["T_VARIABLE","$buyRequest",346],["T_WHITESPACE"," ",346],"=",["T_WHITESPACE"," ",346],["T_NEW","new",346],["T_WHITESPACE"," ",346],["T_STRING","Varien_Object",346],"(",["T_STRING","unserialize",346],"(",["T_VARIABLE","$option",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","getValue",346],"(",")",")",")",";",["T_WHITESPACE","\n            ",346],["T_IF","if",347],["T_WHITESPACE"," ",347],"(","!",["T_VARIABLE","$buyRequest",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","hasLinks",347],"(",")",")",["T_WHITESPACE"," ",347],"{",["T_WHITESPACE","\n                ",347],["T_IF","if",348],["T_WHITESPACE"," ",348],"(","!",["T_VARIABLE","$product",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","getLinksPurchasedSeparately",348],"(",")",")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n                    ",348],["T_VARIABLE","$allLinksIds",349],["T_WHITESPACE"," ",349],"=",["T_WHITESPACE"," ",349],["T_STRING","Mage",349],["T_DOUBLE_COLON","::",349],["T_STRING","getModel",349],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link'",349],")",["T_WHITESPACE","\n                        ",349],["T_OBJECT_OPERATOR","->",350],["T_STRING","getCollection",350],"(",")",["T_WHITESPACE","\n                        ",350],["T_OBJECT_OPERATOR","->",351],["T_STRING","addProductToFilter",351],"(",["T_VARIABLE","$product",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getId",351],"(",")",")",["T_WHITESPACE","\n                        ",351],["T_OBJECT_OPERATOR","->",352],["T_STRING","getAllIds",352],"(",")",";",["T_WHITESPACE","\n                    ",352],["T_VARIABLE","$buyRequest",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","setLinks",353],"(",["T_VARIABLE","$allLinksIds",353],")",";",["T_WHITESPACE","\n                    ",353],["T_VARIABLE","$product",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","addCustomOption",354],"(",["T_CONSTANT_ENCAPSED_STRING","'info_buyRequest'",354],",",["T_WHITESPACE"," ",354],["T_STRING","serialize",354],"(",["T_VARIABLE","$buyRequest",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","getData",354],"(",")",")",")",";",["T_WHITESPACE","\n                ",354],"}",["T_WHITESPACE"," ",355],["T_ELSE","else",355],["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n                    ",355],["T_STRING","Mage",356],["T_DOUBLE_COLON","::",356],["T_STRING","throwException",356],"(",["T_WHITESPACE","\n                        ",356],["T_STRING","Mage",357],["T_DOUBLE_COLON","::",357],["T_STRING","helper",357],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable'",357],")",["T_OBJECT_OPERATOR","->",357],["T_STRING","__",357],"(",["T_CONSTANT_ENCAPSED_STRING","'Please specify product link(s).'",357],")",["T_WHITESPACE","\n                    ",357],")",";",["T_WHITESPACE","\n                ",358],"}",["T_WHITESPACE","\n            ",359],"}",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n        ",361],["T_RETURN","return",362],["T_WHITESPACE"," ",362],["T_VARIABLE","$this",362],";",["T_WHITESPACE","\n    ",362],"}",["T_WHITESPACE","\n\n    ",363],["T_DOC_COMMENT","\/**\n     * Prepare additional options\/information for order item which will be\n     * created from this product\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",365],["T_WHITESPACE","\n    ",371],["T_PUBLIC","public",372],["T_WHITESPACE"," ",372],["T_FUNCTION","function",372],["T_WHITESPACE"," ",372],["T_STRING","getOrderOptions",372],"(",["T_VARIABLE","$product",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_STRING","null",372],")",["T_WHITESPACE","\n    ",372],"{",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$options",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_STRING","parent",374],["T_DOUBLE_COLON","::",374],["T_STRING","getOrderOptions",374],"(",["T_VARIABLE","$product",374],")",";",["T_WHITESPACE","\n        ",374],["T_IF","if",375],["T_WHITESPACE"," ",375],"(",["T_VARIABLE","$linkIds",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getProduct",375],"(",["T_VARIABLE","$product",375],")",["T_OBJECT_OPERATOR","->",375],["T_STRING","getCustomOption",375],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable_link_ids'",375],")",")",["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n            ",375],["T_VARIABLE","$linkOptions",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_ARRAY","array",376],"(",")",";",["T_WHITESPACE","\n            ",376],["T_VARIABLE","$links",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getLinks",377],"(",["T_VARIABLE","$product",377],")",";",["T_WHITESPACE","\n            ",377],["T_FOREACH","foreach",378],["T_WHITESPACE"," ",378],"(",["T_STRING","explode",378],"(",["T_CONSTANT_ENCAPSED_STRING","','",378],",",["T_WHITESPACE"," ",378],["T_VARIABLE","$linkIds",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getValue",378],"(",")",")",["T_WHITESPACE"," ",378],["T_AS","as",378],["T_WHITESPACE"," ",378],["T_VARIABLE","$linkId",378],")",["T_WHITESPACE"," ",378],"{",["T_WHITESPACE","\n                ",378],["T_IF","if",379],["T_WHITESPACE"," ",379],"(",["T_ISSET","isset",379],"(",["T_VARIABLE","$links",379],"[",["T_VARIABLE","$linkId",379],"]",")",")",["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n                    ",379],["T_VARIABLE","$linkOptions",380],"[","]",["T_WHITESPACE"," ",380],"=",["T_WHITESPACE"," ",380],["T_VARIABLE","$linkId",380],";",["T_WHITESPACE","\n                ",380],"}",["T_WHITESPACE","\n            ",381],"}",["T_WHITESPACE","\n            ",382],["T_VARIABLE","$options",383],["T_WHITESPACE"," ",383],"=",["T_WHITESPACE"," ",383],["T_STRING","array_merge",383],"(",["T_VARIABLE","$options",383],",",["T_WHITESPACE"," ",383],["T_ARRAY","array",383],"(",["T_CONSTANT_ENCAPSED_STRING","'links'",383],["T_WHITESPACE"," ",383],["T_DOUBLE_ARROW","=>",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$linkOptions",383],")",")",";",["T_WHITESPACE","\n        ",383],"}",["T_WHITESPACE","\n        ",384],["T_VARIABLE","$options",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_STRING","array_merge",385],"(",["T_VARIABLE","$options",385],",",["T_WHITESPACE"," ",385],["T_ARRAY","array",385],"(",["T_WHITESPACE","\n            ",385],["T_CONSTANT_ENCAPSED_STRING","'is_downloadable'",386],["T_WHITESPACE"," ",386],["T_DOUBLE_ARROW","=>",386],["T_WHITESPACE"," ",386],["T_STRING","true",386],",",["T_WHITESPACE","\n            ",386],["T_CONSTANT_ENCAPSED_STRING","'real_product_type'",387],["T_WHITESPACE"," ",387],["T_DOUBLE_ARROW","=>",387],["T_WHITESPACE"," ",387],["T_STRING","self",387],["T_DOUBLE_COLON","::",387],["T_STRING","TYPE_DOWNLOADABLE",387],["T_WHITESPACE","\n        ",387],")",")",";",["T_WHITESPACE","\n        ",388],["T_RETURN","return",389],["T_WHITESPACE"," ",389],["T_VARIABLE","$options",389],";",["T_WHITESPACE","\n    ",389],"}",["T_WHITESPACE","\n\n\n\n    ",390],["T_DOC_COMMENT","\/**\n     * Setting flag if dowenloadable product can be or not in complex product\n     * based on link can be purchased separately or not\n     *\n     * @param Mage_Catalog_Model_Product $product\n     *\/",394],["T_WHITESPACE","\n    ",399],["T_PUBLIC","public",400],["T_WHITESPACE"," ",400],["T_FUNCTION","function",400],["T_WHITESPACE"," ",400],["T_STRING","beforeSave",400],"(",["T_VARIABLE","$product",400],["T_WHITESPACE"," ",400],"=",["T_WHITESPACE"," ",400],["T_STRING","null",400],")",["T_WHITESPACE","\n    ",400],"{",["T_WHITESPACE","\n        ",401],["T_STRING","parent",402],["T_DOUBLE_COLON","::",402],["T_STRING","beforeSave",402],"(",["T_VARIABLE","$product",402],")",";",["T_WHITESPACE","\n        ",402],["T_IF","if",403],["T_WHITESPACE"," ",403],"(",["T_VARIABLE","$this",403],["T_OBJECT_OPERATOR","->",403],["T_STRING","getLinkSelectionRequired",403],"(",["T_VARIABLE","$product",403],")",")",["T_WHITESPACE"," ",403],"{",["T_WHITESPACE","\n            ",403],["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","getProduct",404],"(",["T_VARIABLE","$product",404],")",["T_OBJECT_OPERATOR","->",404],["T_STRING","setTypeHasRequiredOptions",404],"(",["T_STRING","true",404],")",";",["T_WHITESPACE","\n        ",404],"}",["T_WHITESPACE"," ",405],["T_ELSE","else",405],["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n            ",405],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","getProduct",406],"(",["T_VARIABLE","$product",406],")",["T_OBJECT_OPERATOR","->",406],["T_STRING","setTypeHasRequiredOptions",406],"(",["T_STRING","false",406],")",";",["T_WHITESPACE","\n        ",406],"}",["T_WHITESPACE","\n\n        ",407],["T_COMMENT","\/\/ Update links_exist attribute value\n",409],["T_WHITESPACE","        ",410],["T_VARIABLE","$linksExist",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_STRING","false",410],";",["T_WHITESPACE","\n        ",410],["T_IF","if",411],["T_WHITESPACE"," ",411],"(",["T_VARIABLE","$data",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$product",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getDownloadableData",411],"(",")",")",["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n            ",411],["T_IF","if",412],["T_WHITESPACE"," ",412],"(",["T_ISSET","isset",412],"(",["T_VARIABLE","$data",412],"[",["T_CONSTANT_ENCAPSED_STRING","'link'",412],"]",")",")",["T_WHITESPACE"," ",412],"{",["T_WHITESPACE","\n                ",412],["T_FOREACH","foreach",413],["T_WHITESPACE"," ",413],"(",["T_VARIABLE","$data",413],"[",["T_CONSTANT_ENCAPSED_STRING","'link'",413],"]",["T_WHITESPACE"," ",413],["T_AS","as",413],["T_WHITESPACE"," ",413],["T_VARIABLE","$linkItem",413],")",["T_WHITESPACE"," ",413],"{",["T_WHITESPACE","\n                    ",413],["T_IF","if",414],["T_WHITESPACE"," ",414],"(","!",["T_ISSET","isset",414],"(",["T_VARIABLE","$linkItem",414],"[",["T_CONSTANT_ENCAPSED_STRING","'is_delete'",414],"]",")",["T_WHITESPACE"," ",414],["T_BOOLEAN_OR","||",414],["T_WHITESPACE"," ",414],"!",["T_VARIABLE","$linkItem",414],"[",["T_CONSTANT_ENCAPSED_STRING","'is_delete'",414],"]",")",["T_WHITESPACE"," ",414],"{",["T_WHITESPACE","\n                        ",414],["T_VARIABLE","$linksExist",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_STRING","true",415],";",["T_WHITESPACE","\n                        ",415],["T_BREAK","break",416],";",["T_WHITESPACE","\n                    ",416],"}",["T_WHITESPACE","\n                ",417],"}",["T_WHITESPACE","\n            ",418],"}",["T_WHITESPACE","\n        ",419],"}",["T_WHITESPACE","\n\n        ",420],["T_VARIABLE","$this",422],["T_OBJECT_OPERATOR","->",422],["T_STRING","getProduct",422],"(",["T_VARIABLE","$product",422],")",["T_OBJECT_OPERATOR","->",422],["T_STRING","setTypeHasOptions",422],"(",["T_VARIABLE","$linksExist",422],")",";",["T_WHITESPACE","\n        ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","getProduct",423],"(",["T_VARIABLE","$product",423],")",["T_OBJECT_OPERATOR","->",423],["T_STRING","setLinksExist",423],"(",["T_VARIABLE","$linksExist",423],")",";",["T_WHITESPACE","\n    ",423],"}",["T_WHITESPACE","\n\n    ",424],["T_DOC_COMMENT","\/**\n     * Retrieve additional searchable data from type instance\n     * Using based on product id and store_id data\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return array\n     *\/",426],["T_WHITESPACE","\n    ",432],["T_PUBLIC","public",433],["T_WHITESPACE"," ",433],["T_FUNCTION","function",433],["T_WHITESPACE"," ",433],["T_STRING","getSearchableData",433],"(",["T_VARIABLE","$product",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_STRING","null",433],")",["T_WHITESPACE","\n    ",433],"{",["T_WHITESPACE","\n        ",434],["T_VARIABLE","$searchData",435],["T_WHITESPACE"," ",435],"=",["T_WHITESPACE"," ",435],["T_STRING","parent",435],["T_DOUBLE_COLON","::",435],["T_STRING","getSearchableData",435],"(",["T_VARIABLE","$product",435],")",";",["T_WHITESPACE","\n        ",435],["T_VARIABLE","$product",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","getProduct",436],"(",["T_VARIABLE","$product",436],")",";",["T_WHITESPACE","\n\n        ",436],["T_VARIABLE","$linkSearchData",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_STRING","Mage",438],["T_DOUBLE_COLON","::",438],["T_STRING","getSingleton",438],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/link'",438],")",["T_WHITESPACE","\n            ",438],["T_OBJECT_OPERATOR","->",439],["T_STRING","getSearchableData",439],"(",["T_VARIABLE","$product",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getId",439],"(",")",",",["T_WHITESPACE"," ",439],["T_VARIABLE","$product",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getStoreId",439],"(",")",")",";",["T_WHITESPACE","\n        ",439],["T_IF","if",440],["T_WHITESPACE"," ",440],"(",["T_VARIABLE","$linkSearchData",440],")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n            ",440],["T_VARIABLE","$searchData",441],["T_WHITESPACE"," ",441],"=",["T_WHITESPACE"," ",441],["T_STRING","array_merge",441],"(",["T_VARIABLE","$searchData",441],",",["T_WHITESPACE"," ",441],["T_VARIABLE","$linkSearchData",441],")",";",["T_WHITESPACE","\n        ",441],"}",["T_WHITESPACE","\n\n        ",442],["T_VARIABLE","$sampleSearchData",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_STRING","Mage",444],["T_DOUBLE_COLON","::",444],["T_STRING","getSingleton",444],"(",["T_CONSTANT_ENCAPSED_STRING","'downloadable\/sample'",444],")",["T_WHITESPACE","\n            ",444],["T_OBJECT_OPERATOR","->",445],["T_STRING","getSearchableData",445],"(",["T_VARIABLE","$product",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getId",445],"(",")",",",["T_WHITESPACE"," ",445],["T_VARIABLE","$product",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getStoreId",445],"(",")",")",";",["T_WHITESPACE","\n        ",445],["T_IF","if",446],["T_WHITESPACE"," ",446],"(",["T_VARIABLE","$sampleSearchData",446],")",["T_WHITESPACE"," ",446],"{",["T_WHITESPACE","\n            ",446],["T_VARIABLE","$searchData",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_STRING","array_merge",447],"(",["T_VARIABLE","$searchData",447],",",["T_WHITESPACE"," ",447],["T_VARIABLE","$sampleSearchData",447],")",";",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE","\n\n        ",448],["T_RETURN","return",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$searchData",450],";",["T_WHITESPACE","\n    ",450],"}",["T_WHITESPACE","\n\n    ",451],["T_DOC_COMMENT","\/**\n     * Check is product available for sale\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",453],["T_WHITESPACE","\n    ",458],["T_PUBLIC","public",459],["T_WHITESPACE"," ",459],["T_FUNCTION","function",459],["T_WHITESPACE"," ",459],["T_STRING","isSalable",459],"(",["T_VARIABLE","$product",459],["T_WHITESPACE"," ",459],"=",["T_WHITESPACE"," ",459],["T_STRING","null",459],")",["T_WHITESPACE","\n    ",459],"{",["T_WHITESPACE","\n        ",460],["T_RETURN","return",461],["T_WHITESPACE"," ",461],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","hasLinks",461],"(",["T_VARIABLE","$product",461],")",["T_WHITESPACE"," ",461],["T_BOOLEAN_AND","&&",461],["T_WHITESPACE"," ",461],["T_STRING","parent",461],["T_DOUBLE_COLON","::",461],["T_STRING","isSalable",461],"(",["T_VARIABLE","$product",461],")",";",["T_WHITESPACE","\n    ",461],"}",["T_WHITESPACE","\n\n    ",462],["T_DOC_COMMENT","\/**\n     * Prepare selected options for downloadable product\n     *\n     * @param  Mage_Catalog_Model_Product $product\n     * @param  Varien_Object $buyRequest\n     * @return array\n     *\/",464],["T_WHITESPACE","\n    ",470],["T_PUBLIC","public",471],["T_WHITESPACE"," ",471],["T_FUNCTION","function",471],["T_WHITESPACE"," ",471],["T_STRING","processBuyRequest",471],"(",["T_VARIABLE","$product",471],",",["T_WHITESPACE"," ",471],["T_VARIABLE","$buyRequest",471],")",["T_WHITESPACE","\n    ",471],"{",["T_WHITESPACE","\n        ",472],["T_VARIABLE","$links",473],["T_WHITESPACE"," ",473],"=",["T_WHITESPACE"," ",473],["T_VARIABLE","$buyRequest",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","getLinks",473],"(",")",";",["T_WHITESPACE","\n        ",473],["T_VARIABLE","$links",474],["T_WHITESPACE"," ",474],"=",["T_WHITESPACE"," ",474],"(",["T_STRING","is_array",474],"(",["T_VARIABLE","$links",474],")",")",["T_WHITESPACE"," ",474],"?",["T_WHITESPACE"," ",474],["T_STRING","array_filter",474],"(",["T_VARIABLE","$links",474],",",["T_WHITESPACE"," ",474],["T_CONSTANT_ENCAPSED_STRING","'intval'",474],")",["T_WHITESPACE"," ",474],":",["T_WHITESPACE"," ",474],["T_ARRAY","array",474],"(",")",";",["T_WHITESPACE","\n\n        ",474],["T_VARIABLE","$options",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_ARRAY","array",476],"(",["T_CONSTANT_ENCAPSED_STRING","'links'",476],["T_WHITESPACE"," ",476],["T_DOUBLE_ARROW","=>",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$links",476],")",";",["T_WHITESPACE","\n\n        ",476],["T_RETURN","return",478],["T_WHITESPACE"," ",478],["T_VARIABLE","$options",478],";",["T_WHITESPACE","\n    ",478],"}",["T_WHITESPACE","\n\n    ",479],["T_DOC_COMMENT","\/**\n     * Check if downloadable product has links and they can be purchased separately\n     *\n     * @param Mage_Catalog_Model_Product $product\n     * @return bool\n     *\/",481],["T_WHITESPACE","\n    ",486],["T_PUBLIC","public",487],["T_WHITESPACE"," ",487],["T_FUNCTION","function",487],["T_WHITESPACE"," ",487],["T_STRING","canConfigure",487],"(",["T_VARIABLE","$product",487],["T_WHITESPACE"," ",487],"=",["T_WHITESPACE"," ",487],["T_STRING","null",487],")",["T_WHITESPACE","\n    ",487],"{",["T_WHITESPACE","\n        ",488],["T_RETURN","return",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","hasLinks",489],"(",["T_VARIABLE","$product",489],")",["T_WHITESPACE"," ",489],["T_BOOLEAN_AND","&&",489],["T_WHITESPACE"," ",489],["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","getProduct",489],"(",["T_VARIABLE","$product",489],")",["T_OBJECT_OPERATOR","->",489],["T_STRING","getLinksPurchasedSeparately",489],"(",")",";",["T_WHITESPACE","\n    ",489],"}",["T_WHITESPACE","\n",490],"}",["T_WHITESPACE","\n",491]]