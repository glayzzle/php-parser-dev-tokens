[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Review\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Review collection resource model\n *\n * @category    Mage\n * @package     Mage_Review\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Review_Model_Resource_Review_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Collection_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Review table\n     *\n     * @var string\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_reviewTable",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Review detail table\n     *\n     * @var string\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_reviewDetailTable",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Review status table\n     *\n     * @var string\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_reviewStatusTable",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Review entity table\n     *\n     * @var string\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$_reviewEntityTable",63],";",["T_WHITESPACE","\n\n    ",63],["T_DOC_COMMENT","\/**\n     * Review store table\n     *\n     * @var string\n     *\/",65],["T_WHITESPACE","\n    ",69],["T_PROTECTED","protected",70],["T_WHITESPACE"," ",70],["T_VARIABLE","$_reviewStoreTable",70],";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Add store data flag\n     * @var bool\n     *\/",72],["T_WHITESPACE","\n    ",75],["T_PROTECTED","protected",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$_addStoreDataFlag",76],["T_WHITESPACE","   ",76],"=",["T_WHITESPACE"," ",76],["T_STRING","false",76],";",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Define module\n     *\n     *\/",78],["T_WHITESPACE","\n    ",81],["T_PROTECTED","protected",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","_construct",82],"(",")",["T_WHITESPACE","\n    ",82],"{",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_init",84],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review'",84],")",";",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","_reviewTable",85],["T_WHITESPACE","         ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getTable",85],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review'",85],")",";",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_reviewDetailTable",86],["T_WHITESPACE","   ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getTable",86],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_detail'",86],")",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","_reviewStatusTable",87],["T_WHITESPACE","   ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getTable",87],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_status'",87],")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","_reviewEntityTable",88],["T_WHITESPACE","   ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getTable",88],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_entity'",88],")",";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_reviewStoreTable",89],["T_WHITESPACE","    ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getTable",89],"(",["T_CONSTANT_ENCAPSED_STRING","'review\/review_store'",89],")",";",["T_WHITESPACE","\n\n    ",89],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * init select\n     *\n     * @return Mage_Review_Model_Resource_Review_Product_Collection\n     *\/",93],["T_WHITESPACE","\n    ",97],["T_PROTECTED","protected",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","_initSelect",98],"(",")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_STRING","parent",100],["T_DOUBLE_COLON","::",100],["T_STRING","_initSelect",100],"(",")",";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getSelect",101],"(",")",["T_WHITESPACE","\n            ",101],["T_OBJECT_OPERATOR","->",102],["T_STRING","join",102],"(",["T_ARRAY","array",102],"(",["T_CONSTANT_ENCAPSED_STRING","'detail'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","_reviewDetailTable",102],")",",",["T_WHITESPACE","\n                ",102],["T_CONSTANT_ENCAPSED_STRING","'main_table.review_id = detail.review_id'",103],",",["T_WHITESPACE","\n                ",103],["T_ARRAY","array",104],"(",["T_CONSTANT_ENCAPSED_STRING","'detail_id'",104],",",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'title'",104],",",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'detail'",104],",",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'nickname'",104],",",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",104],")",")",";",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Enter description here ...\n     *\n     * @param unknown_type $customerId\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",108],["T_WHITESPACE","\n    ",113],["T_PUBLIC","public",114],["T_WHITESPACE"," ",114],["T_FUNCTION","function",114],["T_WHITESPACE"," ",114],["T_STRING","addCustomerFilter",114],"(",["T_VARIABLE","$customerId",114],")",["T_WHITESPACE","\n    ",114],"{",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","addFilter",116],"(",["T_CONSTANT_ENCAPSED_STRING","'customer'",116],",",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getConnection",117],"(",")",["T_OBJECT_OPERATOR","->",117],["T_STRING","quoteInto",117],"(",["T_CONSTANT_ENCAPSED_STRING","'detail.customer_id=?'",117],",",["T_WHITESPACE"," ",117],["T_VARIABLE","$customerId",117],")",",",["T_WHITESPACE","\n            ",117],["T_CONSTANT_ENCAPSED_STRING","'string'",118],")",";",["T_WHITESPACE","\n        ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Add store filter\n     *\n     * @param int|array $storeId\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",122],["T_WHITESPACE","\n    ",127],["T_PUBLIC","public",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","addStoreFilter",128],"(",["T_VARIABLE","$storeId",128],")",["T_WHITESPACE","\n    ",128],"{",["T_WHITESPACE","\n        ",129],["T_VARIABLE","$inCond",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getConnection",130],"(",")",["T_OBJECT_OPERATOR","->",130],["T_STRING","prepareSqlCondition",130],"(",["T_CONSTANT_ENCAPSED_STRING","'store.store_id'",130],",",["T_WHITESPACE"," ",130],["T_ARRAY","array",130],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$storeId",130],")",")",";",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getSelect",131],"(",")",["T_OBJECT_OPERATOR","->",131],["T_STRING","join",131],"(",["T_ARRAY","array",131],"(",["T_CONSTANT_ENCAPSED_STRING","'store'",131],["T_DOUBLE_ARROW","=>",131],["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","_reviewStoreTable",131],")",",",["T_WHITESPACE","\n            ",131],["T_CONSTANT_ENCAPSED_STRING","'main_table.review_id=store.review_id'",132],",",["T_WHITESPACE","\n            ",132],["T_ARRAY","array",133],"(",")",")",";",["T_WHITESPACE","\n        ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getSelect",134],"(",")",["T_OBJECT_OPERATOR","->",134],["T_STRING","where",134],"(",["T_VARIABLE","$inCond",134],")",";",["T_WHITESPACE","\n        ",134],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Add stores data\n     *\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",138],["T_WHITESPACE","\n    ",142],["T_PUBLIC","public",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","addStoreData",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","_addStoreDataFlag",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_STRING","true",145],";",["T_WHITESPACE","\n        ",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_VARIABLE","$this",146],";",["T_WHITESPACE","\n    ",146],"}",["T_WHITESPACE","\n\n    ",147],["T_DOC_COMMENT","\/**\n     * Add entity filter\n     *\n     * @param int|string $entity\n     * @param int $pkValue\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",149],["T_WHITESPACE","\n    ",155],["T_PUBLIC","public",156],["T_WHITESPACE"," ",156],["T_FUNCTION","function",156],["T_WHITESPACE"," ",156],["T_STRING","addEntityFilter",156],"(",["T_VARIABLE","$entity",156],",",["T_WHITESPACE"," ",156],["T_VARIABLE","$pkValue",156],")",["T_WHITESPACE","\n    ",156],"{",["T_WHITESPACE","\n        ",157],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_STRING","is_numeric",158],"(",["T_VARIABLE","$entity",158],")",")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","addFilter",159],"(",["T_CONSTANT_ENCAPSED_STRING","'entity'",159],",",["T_WHITESPACE","\n                ",159],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getConnection",160],"(",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","quoteInto",160],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.entity_id=?'",160],",",["T_WHITESPACE"," ",160],["T_VARIABLE","$entity",160],")",",",["T_WHITESPACE","\n                ",160],["T_CONSTANT_ENCAPSED_STRING","'string'",161],")",";",["T_WHITESPACE","\n        ",161],"}",["T_WHITESPACE"," ",162],["T_ELSEIF","elseif",162],["T_WHITESPACE"," ",162],"(",["T_STRING","is_string",162],"(",["T_VARIABLE","$entity",162],")",")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n            ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_select",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","join",163],"(",["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","_reviewEntityTable",163],",",["T_WHITESPACE","\n                ",163],["T_CONSTANT_ENCAPSED_STRING","'main_table.entity_id='",164],".",["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","_reviewEntityTable",164],".",["T_CONSTANT_ENCAPSED_STRING","'.entity_id'",164],",",["T_WHITESPACE","\n                ",164],["T_ARRAY","array",165],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_code'",165],")",")",";",["T_WHITESPACE","\n\n            ",165],["T_VARIABLE","$this",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","addFilter",167],"(",["T_CONSTANT_ENCAPSED_STRING","'entity'",167],",",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getConnection",168],"(",")",["T_OBJECT_OPERATOR","->",168],["T_STRING","quoteInto",168],"(",["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","_reviewEntityTable",168],".",["T_CONSTANT_ENCAPSED_STRING","'.entity_code=?'",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$entity",168],")",",",["T_WHITESPACE","\n                ",168],["T_CONSTANT_ENCAPSED_STRING","'string'",169],")",";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE","\n\n        ",170],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","addFilter",172],"(",["T_CONSTANT_ENCAPSED_STRING","'entity_pk_value'",172],",",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","getConnection",173],"(",")",["T_OBJECT_OPERATOR","->",173],["T_STRING","quoteInto",173],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.entity_pk_value=?'",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$pkValue",173],")",",",["T_WHITESPACE","\n            ",173],["T_CONSTANT_ENCAPSED_STRING","'string'",174],")",";",["T_WHITESPACE","\n\n        ",174],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$this",176],";",["T_WHITESPACE","\n    ",176],"}",["T_WHITESPACE","\n\n    ",177],["T_DOC_COMMENT","\/**\n     * Add status filter\n     *\n     * @param int|string $status\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",179],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","addStatusFilter",185],"(",["T_VARIABLE","$status",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_STRING","is_string",187],"(",["T_VARIABLE","$status",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$statuses",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","array_flip",188],"(",["T_STRING","Mage",188],["T_DOUBLE_COLON","::",188],["T_STRING","helper",188],"(",["T_CONSTANT_ENCAPSED_STRING","'review'",188],")",["T_OBJECT_OPERATOR","->",188],["T_STRING","getReviewStatuses",188],"(",")",")",";",["T_WHITESPACE","\n            ",188],["T_VARIABLE","$status",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_ISSET","isset",189],"(",["T_VARIABLE","$statuses",189],"[",["T_VARIABLE","$status",189],"]",")",["T_WHITESPACE"," ",189],"?",["T_WHITESPACE"," ",189],["T_VARIABLE","$statuses",189],"[",["T_VARIABLE","$status",189],"]",["T_WHITESPACE"," ",189],":",["T_WHITESPACE"," ",189],["T_LNUMBER","0",189],";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n        ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_STRING","is_numeric",191],"(",["T_VARIABLE","$status",191],")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","addFilter",192],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",192],",",["T_WHITESPACE","\n                ",192],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","getConnection",193],"(",")",["T_OBJECT_OPERATOR","->",193],["T_STRING","quoteInto",193],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.status_id=?'",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$status",193],")",",",["T_WHITESPACE","\n                ",193],["T_CONSTANT_ENCAPSED_STRING","'string'",194],")",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n        ",195],["T_RETURN","return",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],";",["T_WHITESPACE","\n    ",196],"}",["T_WHITESPACE","\n\n    ",197],["T_DOC_COMMENT","\/**\n     * Set date order\n     *\n     * @param string $dir\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",199],["T_WHITESPACE","\n    ",204],["T_PUBLIC","public",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","setDateOrder",205],"(",["T_VARIABLE","$dir",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","'DESC'",205],")",["T_WHITESPACE","\n    ",205],"{",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","setOrder",207],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.created_at'",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$dir",207],")",";",["T_WHITESPACE","\n        ",207],["T_RETURN","return",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],";",["T_WHITESPACE","\n    ",208],"}",["T_WHITESPACE","\n\n    ",209],["T_DOC_COMMENT","\/**\n     * Add rate votes\n     *\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",211],["T_WHITESPACE","\n    ",215],["T_PUBLIC","public",216],["T_WHITESPACE"," ",216],["T_FUNCTION","function",216],["T_WHITESPACE"," ",216],["T_STRING","addRateVotes",216],"(",")",["T_WHITESPACE","\n    ",216],"{",["T_WHITESPACE","\n        ",217],["T_FOREACH","foreach",218],["T_WHITESPACE"," ",218],"(",["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","getItems",218],"(",")",["T_WHITESPACE"," ",218],["T_AS","as",218],["T_WHITESPACE"," ",218],["T_VARIABLE","$item",218],")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$votesCollection",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_STRING","Mage",219],["T_DOUBLE_COLON","::",219],["T_STRING","getModel",219],"(",["T_CONSTANT_ENCAPSED_STRING","'rating\/rating_option_vote'",219],")",["T_WHITESPACE","\n                ",219],["T_OBJECT_OPERATOR","->",220],["T_STRING","getResourceCollection",220],"(",")",["T_WHITESPACE","\n                ",220],["T_OBJECT_OPERATOR","->",221],["T_STRING","setReviewFilter",221],"(",["T_VARIABLE","$item",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getId",221],"(",")",")",["T_WHITESPACE","\n                ",221],["T_OBJECT_OPERATOR","->",222],["T_STRING","setStoreFilter",222],"(",["T_STRING","Mage",222],["T_DOUBLE_COLON","::",222],["T_STRING","app",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","getStore",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","getId",222],"(",")",")",["T_WHITESPACE","\n                ",222],["T_OBJECT_OPERATOR","->",223],["T_STRING","addRatingInfo",223],"(",["T_STRING","Mage",223],["T_DOUBLE_COLON","::",223],["T_STRING","app",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","getStore",223],"(",")",["T_OBJECT_OPERATOR","->",223],["T_STRING","getId",223],"(",")",")",["T_WHITESPACE","\n                ",223],["T_OBJECT_OPERATOR","->",224],["T_STRING","load",224],"(",")",";",["T_WHITESPACE","\n            ",224],["T_VARIABLE","$item",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","setRatingVotes",225],"(",["T_VARIABLE","$votesCollection",225],")",";",["T_WHITESPACE","\n        ",225],"}",["T_WHITESPACE","\n\n        ",226],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_VARIABLE","$this",228],";",["T_WHITESPACE","\n    ",228],"}",["T_WHITESPACE","\n\n    ",229],["T_DOC_COMMENT","\/**\n     * Add reviews total count\n     *\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",231],["T_WHITESPACE","\n    ",235],["T_PUBLIC","public",236],["T_WHITESPACE"," ",236],["T_FUNCTION","function",236],["T_WHITESPACE"," ",236],["T_STRING","addReviewsTotalCount",236],"(",")",["T_WHITESPACE","\n    ",236],"{",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","_select",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","joinLeft",238],"(",["T_WHITESPACE","\n            ",238],["T_ARRAY","array",239],"(",["T_CONSTANT_ENCAPSED_STRING","'r'",239],["T_WHITESPACE"," ",239],["T_DOUBLE_ARROW","=>",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","_reviewTable",239],")",",",["T_WHITESPACE","\n            ",239],["T_CONSTANT_ENCAPSED_STRING","'main_table.entity_pk_value = r.entity_pk_value'",240],",",["T_WHITESPACE","\n            ",240],["T_ARRAY","array",241],"(",["T_CONSTANT_ENCAPSED_STRING","'total_reviews'",241],["T_WHITESPACE"," ",241],["T_DOUBLE_ARROW","=>",241],["T_WHITESPACE"," ",241],["T_NEW","new",241],["T_WHITESPACE"," ",241],["T_STRING","Zend_Db_Expr",241],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT(r.review_id)'",241],")",")",["T_WHITESPACE","\n        ",241],")",["T_WHITESPACE","\n        ",242],["T_OBJECT_OPERATOR","->",243],["T_STRING","group",243],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.review_id'",243],")",";",["T_WHITESPACE","\n\n        ",243],["T_COMMENT","\/*\n         * Allow analytic functions usage\n         *\/",245],["T_WHITESPACE","\n        ",247],["T_VARIABLE","$this",248],["T_OBJECT_OPERATOR","->",248],["T_STRING","_useAnalyticFunction",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_STRING","true",248],";",["T_WHITESPACE","\n\n        ",248],["T_RETURN","return",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$this",250],";",["T_WHITESPACE","\n    ",250],"}",["T_WHITESPACE","\n\n    ",251],["T_DOC_COMMENT","\/**\n     * Load data\n     *\n     * @param boolean $printQuery\n     * @param boolean $logQuery\n     * @return Mage_Review_Model_Resource_Review_Collection\n     *\/",253],["T_WHITESPACE","\n    ",259],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","load",260],"(",["T_VARIABLE","$printQuery",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_STRING","false",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$logQuery",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_STRING","false",260],")",["T_WHITESPACE","\n    ",260],"{",["T_WHITESPACE","\n        ",261],["T_IF","if",262],["T_WHITESPACE"," ",262],"(",["T_VARIABLE","$this",262],["T_OBJECT_OPERATOR","->",262],["T_STRING","isLoaded",262],"(",")",")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n            ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],";",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n        ",264],["T_STRING","Mage",265],["T_DOUBLE_COLON","::",265],["T_STRING","dispatchEvent",265],"(",["T_CONSTANT_ENCAPSED_STRING","'review_review_collection_load_before'",265],",",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",["T_CONSTANT_ENCAPSED_STRING","'collection'",265],["T_WHITESPACE"," ",265],["T_DOUBLE_ARROW","=>",265],["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],")",")",";",["T_WHITESPACE","\n        ",265],["T_STRING","parent",266],["T_DOUBLE_COLON","::",266],["T_STRING","load",266],"(",["T_VARIABLE","$printQuery",266],",",["T_WHITESPACE"," ",266],["T_VARIABLE","$logQuery",266],")",";",["T_WHITESPACE","\n        ",266],["T_IF","if",267],["T_WHITESPACE"," ",267],"(",["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","_addStoreDataFlag",267],")",["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n            ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","_addStoreData",268],"(",")",";",["T_WHITESPACE","\n        ",268],"}",["T_WHITESPACE","\n        ",269],["T_RETURN","return",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],";",["T_WHITESPACE","\n    ",270],"}",["T_WHITESPACE","\n\n    ",271],["T_DOC_COMMENT","\/**\n     * Add store data\n     *\n     *\/",273],["T_WHITESPACE","\n    ",276],["T_PROTECTED","protected",277],["T_WHITESPACE"," ",277],["T_FUNCTION","function",277],["T_WHITESPACE"," ",277],["T_STRING","_addStoreData",277],"(",")",["T_WHITESPACE","\n    ",277],"{",["T_WHITESPACE","\n        ",278],["T_VARIABLE","$adapter",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","getConnection",279],"(",")",";",["T_WHITESPACE","\n\n        ",279],["T_VARIABLE","$reviewsIds",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getColumnValues",281],"(",["T_CONSTANT_ENCAPSED_STRING","'review_id'",281],")",";",["T_WHITESPACE","\n        ",281],["T_VARIABLE","$storesToReviews",282],["T_WHITESPACE"," ",282],"=",["T_WHITESPACE"," ",282],["T_ARRAY","array",282],"(",")",";",["T_WHITESPACE","\n        ",282],["T_IF","if",283],["T_WHITESPACE"," ",283],"(",["T_STRING","count",283],"(",["T_VARIABLE","$reviewsIds",283],")",">",["T_LNUMBER","0",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_VARIABLE","$inCond",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_VARIABLE","$adapter",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","prepareSqlCondition",284],"(",["T_CONSTANT_ENCAPSED_STRING","'review_id'",284],",",["T_WHITESPACE"," ",284],["T_ARRAY","array",284],"(",["T_CONSTANT_ENCAPSED_STRING","'in'",284],["T_WHITESPACE"," ",284],["T_DOUBLE_ARROW","=>",284],["T_WHITESPACE"," ",284],["T_VARIABLE","$reviewsIds",284],")",")",";",["T_WHITESPACE","\n            ",284],["T_VARIABLE","$select",285],["T_WHITESPACE"," ",285],"=",["T_WHITESPACE"," ",285],["T_VARIABLE","$adapter",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","select",285],"(",")",["T_WHITESPACE","\n                ",285],["T_OBJECT_OPERATOR","->",286],["T_STRING","from",286],"(",["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","_reviewStoreTable",286],")",["T_WHITESPACE","\n                ",286],["T_OBJECT_OPERATOR","->",287],["T_STRING","where",287],"(",["T_VARIABLE","$inCond",287],")",";",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$result",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$adapter",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","fetchAll",288],"(",["T_VARIABLE","$select",288],")",";",["T_WHITESPACE","\n            ",288],["T_FOREACH","foreach",289],["T_WHITESPACE"," ",289],"(",["T_VARIABLE","$result",289],["T_WHITESPACE"," ",289],["T_AS","as",289],["T_WHITESPACE"," ",289],["T_VARIABLE","$row",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n                ",289],["T_IF","if",290],["T_WHITESPACE"," ",290],"(","!",["T_ISSET","isset",290],"(",["T_VARIABLE","$storesToReviews",290],"[",["T_VARIABLE","$row",290],"[",["T_CONSTANT_ENCAPSED_STRING","'review_id'",290],"]","]",")",")",["T_WHITESPACE"," ",290],"{",["T_WHITESPACE","\n                    ",290],["T_VARIABLE","$storesToReviews",291],"[",["T_VARIABLE","$row",291],"[",["T_CONSTANT_ENCAPSED_STRING","'review_id'",291],"]","]",["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_ARRAY","array",291],"(",")",";",["T_WHITESPACE","\n                ",291],"}",["T_WHITESPACE","\n                ",292],["T_VARIABLE","$storesToReviews",293],"[",["T_VARIABLE","$row",293],"[",["T_CONSTANT_ENCAPSED_STRING","'review_id'",293],"]","]","[","]",["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$row",293],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",293],"]",";",["T_WHITESPACE","\n            ",293],"}",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE","\n\n        ",295],["T_FOREACH","foreach",297],["T_WHITESPACE"," ",297],"(",["T_VARIABLE","$this",297],["T_WHITESPACE"," ",297],["T_AS","as",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$item",297],")",["T_WHITESPACE"," ",297],"{",["T_WHITESPACE","\n            ",297],["T_IF","if",298],["T_WHITESPACE"," ",298],"(",["T_ISSET","isset",298],"(",["T_VARIABLE","$storesToReviews",298],"[",["T_VARIABLE","$item",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getId",298],"(",")","]",")",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n                ",298],["T_VARIABLE","$item",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","setStores",299],"(",["T_VARIABLE","$storesToReviews",299],"[",["T_VARIABLE","$item",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getId",299],"(",")","]",")",";",["T_WHITESPACE","\n            ",299],"}",["T_WHITESPACE"," ",300],["T_ELSE","else",300],["T_WHITESPACE"," ",300],"{",["T_WHITESPACE","\n                ",300],["T_VARIABLE","$item",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","setStores",301],"(",["T_ARRAY","array",301],"(",")",")",";",["T_WHITESPACE","\n            ",301],"}",["T_WHITESPACE","\n        ",302],"}",["T_WHITESPACE","\n    ",303],"}",["T_WHITESPACE","\n",304],"}",["T_WHITESPACE","\n",305]]