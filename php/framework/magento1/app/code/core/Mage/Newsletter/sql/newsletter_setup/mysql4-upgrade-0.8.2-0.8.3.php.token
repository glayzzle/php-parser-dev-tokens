[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Newsletter\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_COMMENT","\/* @var $installer Mage_Core_Model_Resource_Setup *\/",27],["T_WHITESPACE","\n",27],["T_VARIABLE","$installer",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$this",28],";",["T_WHITESPACE","\n",28],["T_VARIABLE","$queueTable",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$installer",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","getTable",29],"(",["T_CONSTANT_ENCAPSED_STRING","'newsletter_queue'",29],")",";",["T_WHITESPACE","\n",29],["T_VARIABLE","$templateTable",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_VARIABLE","$installer",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","getTable",30],"(",["T_CONSTANT_ENCAPSED_STRING","'newsletter_template'",30],")",";",["T_WHITESPACE","\n",30],["T_VARIABLE","$conn",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$installer",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","getConnection",31],"(",")",";",["T_WHITESPACE","\n\n\n",31],["T_VARIABLE","$conn",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","addColumn",34],"(",["T_VARIABLE","$queueTable",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'newsletter_type'",34],",",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","\"int(3) default NULL AFTER `template_id`\"",34],")",";",["T_WHITESPACE","\n",34],["T_VARIABLE","$conn",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","addColumn",35],"(",["T_VARIABLE","$queueTable",35],",",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'newsletter_text'",35],",",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","\"text AFTER `newsletter_type`\"",35],")",";",["T_WHITESPACE","\n",35],["T_VARIABLE","$conn",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","addColumn",36],"(",["T_VARIABLE","$queueTable",36],",",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'newsletter_styles'",36],",",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","\"text AFTER `newsletter_text`\"",36],")",";",["T_WHITESPACE","\n",36],["T_VARIABLE","$conn",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","addColumn",37],"(",["T_VARIABLE","$queueTable",37],",",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'newsletter_subject'",37],",",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","\"varchar(200) default NULL AFTER `newsletter_styles`\"",37],")",";",["T_WHITESPACE","\n",37],["T_VARIABLE","$conn",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","addColumn",38],"(",["T_VARIABLE","$queueTable",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'newsletter_sender_name'",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","\"varchar(200) default NULL AFTER `newsletter_subject`\"",38],")",";",["T_WHITESPACE","\n",38],["T_VARIABLE","$conn",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","addColumn",39],"(",["T_VARIABLE","$queueTable",39],",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'newsletter_sender_email'",39],",",["T_WHITESPACE"," \n        ",39],["T_CONSTANT_ENCAPSED_STRING","\"varchar(200) character set latin1 collate latin1_general_ci default NULL AFTER `newsletter_sender_name`\"",40],")",";",["T_WHITESPACE","\n\n",40],["T_VARIABLE","$conn",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","modifyColumn",42],"(",["T_VARIABLE","$templateTable",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'template_text_preprocessed'",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","\"text comment 'deprecated since 1.4.0.1'\"",42],")",";",["T_WHITESPACE","\n\n",42],["T_VARIABLE","$conn",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","beginTransaction",44],"(",")",";",["T_WHITESPACE","\n\n",44],["T_TRY","try",46],["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n    ",46],["T_VARIABLE","$select",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$conn",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","select",47],"(",")",["T_WHITESPACE","\n        ",47],["T_OBJECT_OPERATOR","->",48],["T_STRING","from",48],"(",["T_ARRAY","array",48],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$queueTable",48],")",",",["T_WHITESPACE"," ",48],["T_ARRAY","array",48],"(",["T_CONSTANT_ENCAPSED_STRING","'main_table.queue_id'",48],",",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'main_table.template_id'",48],")",")",["T_WHITESPACE","\n        ",48],["T_OBJECT_OPERATOR","->",49],["T_STRING","joinLeft",49],"(",["T_WHITESPACE","\n            ",49],["T_VARIABLE","$templateTable",50],",",["T_WHITESPACE"," \n            ",50],"\"",["T_VARIABLE","$templateTable",51],["T_ENCAPSED_AND_WHITESPACE",".template_id = main_table.template_id",51],"\"",",",["T_WHITESPACE"," \n            ",51],["T_ARRAY","array",52],"(",["T_WHITESPACE","\n                ",52],["T_CONSTANT_ENCAPSED_STRING","'template_type'",53],",",["T_WHITESPACE","\n                ",53],["T_CONSTANT_ENCAPSED_STRING","'template_text'",54],",",["T_WHITESPACE","\n                ",54],["T_CONSTANT_ENCAPSED_STRING","'template_styles'",55],",",["T_WHITESPACE","\n                ",55],["T_CONSTANT_ENCAPSED_STRING","'template_subject'",56],",",["T_WHITESPACE","\n                ",56],["T_CONSTANT_ENCAPSED_STRING","'template_sender_name'",57],",",["T_WHITESPACE","\n                ",57],["T_CONSTANT_ENCAPSED_STRING","'template_sender_email'",58],["T_WHITESPACE","\n            ",58],")",["T_WHITESPACE","\n        ",59],")",";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$rows",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$conn",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","fetchAll",61],"(",["T_VARIABLE","$select",61],")",";",["T_WHITESPACE","\n\n    ",61],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$rows",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n        ",63],["T_FOREACH","foreach",64],"(",["T_VARIABLE","$rows",64],["T_WHITESPACE"," ",64],["T_AS","as",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$row",64],")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_VARIABLE","$whereBind",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$conn",65],["T_WHITESPACE","\n                ",65],["T_OBJECT_OPERATOR","->",66],["T_STRING","quoteInto",66],"(",["T_CONSTANT_ENCAPSED_STRING","'queue_id=?'",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$row",66],"[",["T_CONSTANT_ENCAPSED_STRING","'queue_id'",66],"]",")",";",["T_WHITESPACE","\n    \n            ",66],["T_VARIABLE","$conn",68],["T_WHITESPACE","\n                ",68],["T_OBJECT_OPERATOR","->",69],["T_STRING","update",69],"(",["T_WHITESPACE","\n                    ",69],["T_VARIABLE","$queueTable",70],",",["T_WHITESPACE","\n                    ",70],["T_ARRAY","array",71],"(",["T_WHITESPACE","\n                        ",71],["T_CONSTANT_ENCAPSED_STRING","'newsletter_type'",72],["T_WHITESPACE","           ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$row",72],"[",["T_CONSTANT_ENCAPSED_STRING","'template_type'",72],"]",",",["T_WHITESPACE","\n                        ",72],["T_CONSTANT_ENCAPSED_STRING","'newsletter_text'",73],["T_WHITESPACE","           ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$row",73],"[",["T_CONSTANT_ENCAPSED_STRING","'template_text'",73],"]",",",["T_WHITESPACE","\n                        ",73],["T_CONSTANT_ENCAPSED_STRING","'newsletter_styles'",74],["T_WHITESPACE","         ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$row",74],"[",["T_CONSTANT_ENCAPSED_STRING","'template_styles'",74],"]",",",["T_WHITESPACE","\n                        ",74],["T_CONSTANT_ENCAPSED_STRING","'newsletter_subject'",75],["T_WHITESPACE","        ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$row",75],"[",["T_CONSTANT_ENCAPSED_STRING","'template_subject'",75],"]",",",["T_WHITESPACE","\n                        ",75],["T_CONSTANT_ENCAPSED_STRING","'newsletter_sender_name'",76],["T_WHITESPACE","    ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$row",76],"[",["T_CONSTANT_ENCAPSED_STRING","'template_sender_name'",76],"]",",",["T_WHITESPACE","\n                        ",76],["T_CONSTANT_ENCAPSED_STRING","'newsletter_sender_email'",77],["T_WHITESPACE","   ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$row",77],"[",["T_CONSTANT_ENCAPSED_STRING","'template_sender_email'",77],"]",["T_WHITESPACE","\n                    ",77],")",",",["T_WHITESPACE","\n                    ",78],["T_VARIABLE","$whereBind",79],["T_WHITESPACE","\n                ",79],")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n    ",81],"}",["T_WHITESPACE","\n\n    ",82],["T_VARIABLE","$conn",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","commit",84],"(",")",";",["T_WHITESPACE","\n",84],"}",["T_WHITESPACE"," ",85],["T_CATCH","catch",85],["T_WHITESPACE"," ",85],"(",["T_STRING","Exception",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$e",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$conn",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","rollback",86],"(",")",";",["T_WHITESPACE","\n    ",86],["T_THROW","throw",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$e",87],";",["T_WHITESPACE","\n",87],"}",["T_WHITESPACE","\n",88]]