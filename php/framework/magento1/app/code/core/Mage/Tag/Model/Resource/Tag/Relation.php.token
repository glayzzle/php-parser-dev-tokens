[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tag\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Tag Relation resource model\n *\n * @category    Mage\n * @package     Mage_Tag\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Tag_Model_Resource_Tag_Relation",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Core_Model_Resource_Db_Abstract",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Initialize resource connection and define table resource\n     *\n     *\/",37],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","_construct",41],"(",")",["T_WHITESPACE","\n    ",41],"{",["T_WHITESPACE","\n        ",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","_init",43],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/relation'",43],",",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'tag_relation_id'",43],")",";",["T_WHITESPACE","\n    ",43],"}",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Load by Tag and Customer\n     *\n     * @param Mage_Tag_Model_Tag_Relation $model\n     * @return Mage_Tag_Model_Resource_Tag_Relation\n     *\/",46],["T_WHITESPACE","\n    ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_FUNCTION","function",52],["T_WHITESPACE"," ",52],["T_STRING","loadByTagCustomer",52],"(",["T_VARIABLE","$model",52],")",["T_WHITESPACE","\n    ",52],"{",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(",["T_VARIABLE","$model",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getTagId",54],"(",")",["T_WHITESPACE"," ",54],["T_BOOLEAN_AND","&&",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$model",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","getCustomerId",54],"(",")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_VARIABLE","$read",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","_getReadAdapter",55],"(",")",";",["T_WHITESPACE","\n            ",55],["T_VARIABLE","$bind",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",["T_WHITESPACE","\n                ",56],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",57],["T_WHITESPACE","      ",57],["T_DOUBLE_ARROW","=>",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$model",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","getTagId",57],"(",")",",",["T_WHITESPACE","\n                ",57],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",58],["T_WHITESPACE"," ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$model",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getCustomerId",58],"(",")",["T_WHITESPACE","\n            ",58],")",";",["T_WHITESPACE","\n\n            ",59],["T_VARIABLE","$select",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$read",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","select",61],"(",")",["T_WHITESPACE","\n                ",61],["T_OBJECT_OPERATOR","->",62],["T_STRING","from",62],"(",["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getMainTable",62],"(",")",")",["T_WHITESPACE","\n                ",62],["T_OBJECT_OPERATOR","->",63],["T_STRING","join",63],"(",["T_WHITESPACE","\n                    ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","getTable",64],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",64],")",",",["T_WHITESPACE","\n                    ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getTable",65],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",65],")",["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'.tag_id = '",65],["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","getMainTable",65],"(",")",["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'.tag_id'",65],["T_WHITESPACE","\n                ",65],")",["T_WHITESPACE","\n                ",66],["T_OBJECT_OPERATOR","->",67],["T_STRING","where",67],"(",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","getMainTable",67],"(",")",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'.tag_id = :tag_id'",67],")",["T_WHITESPACE","\n                ",67],["T_OBJECT_OPERATOR","->",68],["T_STRING","where",68],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_id = :customer_id'",68],")",";",["T_WHITESPACE","\n\n            ",68],["T_IF","if",70],["T_WHITESPACE"," ",70],"(",["T_VARIABLE","$model",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","getProductId",70],"(",")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n                ",70],["T_VARIABLE","$select",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","where",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getMainTable",71],"(",")",["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'.product_id = :product_id'",71],")",";",["T_WHITESPACE","\n                ",71],["T_VARIABLE","$bind",72],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",72],"]",["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$model",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","getProductId",72],"(",")",";",["T_WHITESPACE","\n            ",72],"}",["T_WHITESPACE","\n\n            ",73],["T_IF","if",75],["T_WHITESPACE"," ",75],"(",["T_VARIABLE","$model",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","hasStoreId",75],"(",")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$select",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","where",76],"(",["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","getMainTable",76],"(",")",["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'.store_id = :sore_id'",76],")",";",["T_WHITESPACE","\n                ",76],["T_VARIABLE","$bind",77],"[",["T_CONSTANT_ENCAPSED_STRING","'sore_id'",77],"]",["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$model",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getStoreId",77],"(",")",";",["T_WHITESPACE","\n            ",77],"}",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$data",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_VARIABLE","$read",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","fetchRow",79],"(",["T_VARIABLE","$select",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$bind",79],")",";",["T_WHITESPACE","\n            ",79],["T_VARIABLE","$model",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","setData",80],"(","(",["T_WHITESPACE"," ",80],["T_STRING","is_array",80],"(",["T_VARIABLE","$data",80],")",["T_WHITESPACE"," ",80],")",["T_WHITESPACE"," ",80],"?",["T_WHITESPACE"," ",80],["T_VARIABLE","$data",80],["T_WHITESPACE"," ",80],":",["T_WHITESPACE"," ",80],["T_ARRAY","array",80],"(",")",")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n\n        ",81],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],";",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Retrieve Tagged Products\n     *\n     * @param Mage_Tag_Model_Tag_Relation $model\n     * @return array\n     *\/",86],["T_WHITESPACE","\n    ",91],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","getProductIds",92],"(",["T_VARIABLE","$model",92],")",["T_WHITESPACE","\n    ",92],"{",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$bind",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_ARRAY","array",94],"(",["T_WHITESPACE","\n            ",94],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",95],["T_WHITESPACE"," ",95],["T_DOUBLE_ARROW","=>",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$model",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getTagId",95],"(",")",["T_WHITESPACE","\n        ",95],")",";",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$select",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_getReadAdapter",97],"(",")",["T_OBJECT_OPERATOR","->",97],["T_STRING","select",97],"(",")",["T_WHITESPACE","\n            ",97],["T_OBJECT_OPERATOR","->",98],["T_STRING","from",98],"(",["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","getMainTable",98],"(",")",",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'product_id'",98],")",["T_WHITESPACE","\n            ",98],["T_OBJECT_OPERATOR","->",99],["T_STRING","where",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","getMainTable",99],"(",")",["T_WHITESPACE"," ",99],".",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'.tag_id=:tag_id'",99],")",";",["T_WHITESPACE","\n\n        ",99],["T_IF","if",101],["T_WHITESPACE"," ",101],"(","!",["T_STRING","is_null",101],"(",["T_VARIABLE","$model",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getCustomerId",101],"(",")",")",")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$select",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","where",102],"(",["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","getMainTable",102],"(",")",["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","'.customer_id= :customer_id'",102],")",";",["T_WHITESPACE","\n            ",102],["T_VARIABLE","$bind",103],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",103],"]",["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$model",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","getCustomerId",103],"(",")",";",["T_WHITESPACE","\n        ",103],"}",["T_WHITESPACE","\n\n        ",104],["T_IF","if",106],["T_WHITESPACE"," ",106],"(",["T_VARIABLE","$model",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","hasStoreId",106],"(",")",")",["T_WHITESPACE"," ",106],"{",["T_WHITESPACE","\n            ",106],["T_VARIABLE","$select",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","where",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","getMainTable",107],"(",")",["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'.store_id = :store_id'",107],")",";",["T_WHITESPACE","\n            ",107],["T_VARIABLE","$bind",108],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",108],"]",["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$model",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","getStoreId",108],"(",")",";",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n\n        ",109],["T_IF","if",111],["T_WHITESPACE"," ",111],"(","!",["T_STRING","is_null",111],"(",["T_VARIABLE","$model",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","getStatusFilter",111],"(",")",")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n            ",111],["T_VARIABLE","$select",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","join",112],"(",["T_WHITESPACE","\n                ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getTable",113],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",113],")",",",["T_WHITESPACE","\n                ",113],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getTable",114],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",114],")",["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'.tag_id = '",114],["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getMainTable",114],"(",")",["T_WHITESPACE"," ",114],".",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'.tag_id'",114],["T_WHITESPACE","\n            ",114],")",["T_WHITESPACE","\n            ",115],["T_OBJECT_OPERATOR","->",116],["T_STRING","where",116],"(",["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","getTable",116],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",116],")",["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'.status = :t_status'",116],")",";",["T_WHITESPACE","\n            ",116],["T_VARIABLE","$bind",117],"[",["T_CONSTANT_ENCAPSED_STRING","'t_status'",117],"]",["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$model",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getStatusFilter",117],"(",")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n\n        ",118],["T_RETURN","return",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_getReadAdapter",120],"(",")",["T_OBJECT_OPERATOR","->",120],["T_STRING","fetchCol",120],"(",["T_VARIABLE","$select",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$bind",120],")",";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Retrieve related to product tag ids\n     *\n     * @param Mage_Tag_Model_Tag_Relation $model\n     * @return array\n     *\/",123],["T_WHITESPACE","\n    ",128],["T_PUBLIC","public",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","getRelatedTagIds",129],"(",["T_VARIABLE","$model",129],")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_VARIABLE","$productIds",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],"(",["T_STRING","is_array",131],"(",["T_VARIABLE","$model",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getProductId",131],"(",")",")",")",["T_WHITESPACE"," ",131],"?",["T_WHITESPACE"," ",131],["T_VARIABLE","$model",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getProductId",131],"(",")",["T_WHITESPACE"," ",131],":",["T_WHITESPACE"," ",131],["T_ARRAY","array",131],"(",["T_VARIABLE","$model",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","getProductId",131],"(",")",")",";",["T_WHITESPACE","\n        ",131],["T_VARIABLE","$select",132],["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_getReadAdapter",132],"(",")",["T_OBJECT_OPERATOR","->",132],["T_STRING","select",132],"(",")",["T_WHITESPACE","\n            ",132],["T_OBJECT_OPERATOR","->",133],["T_STRING","from",133],"(",["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getMainTable",133],"(",")",",",["T_WHITESPACE"," ",133],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",133],")",["T_WHITESPACE","\n            ",133],["T_OBJECT_OPERATOR","->",134],["T_STRING","where",134],"(",["T_CONSTANT_ENCAPSED_STRING","\"product_id IN(?)\"",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$productIds",134],")",["T_WHITESPACE","\n            ",134],["T_OBJECT_OPERATOR","->",135],["T_STRING","order",135],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_id'",135],")",";",["T_WHITESPACE","\n        ",135],["T_RETURN","return",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_getReadAdapter",136],"(",")",["T_OBJECT_OPERATOR","->",136],["T_STRING","fetchCol",136],"(",["T_VARIABLE","$select",136],")",";",["T_WHITESPACE","\n    ",136],"}",["T_WHITESPACE","\n\n    ",137],["T_DOC_COMMENT","\/**\n     * Deactivate tag relations by tag and customer\n     *\n     * @param int $tagId\n     * @param int $customerId\n     * @return Mage_Tag_Model_Resource_Tag_Relation\n     *\/",139],["T_WHITESPACE","\n    ",145],["T_PUBLIC","public",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","deactivate",146],"(",["T_VARIABLE","$tagId",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$customerId",146],")",["T_WHITESPACE","\n    ",146],"{",["T_WHITESPACE","\n        ",147],["T_VARIABLE","$condition",148],["T_WHITESPACE"," ",148],"=",["T_WHITESPACE"," ",148],["T_ARRAY","array",148],"(",["T_WHITESPACE","\n            ",148],["T_CONSTANT_ENCAPSED_STRING","'tag_id = ?'",149],["T_WHITESPACE","      ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$tagId",149],",",["T_WHITESPACE","\n            ",149],["T_CONSTANT_ENCAPSED_STRING","'customer_id = ?'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$customerId",150],["T_WHITESPACE","\n        ",150],")",";",["T_WHITESPACE","\n\n        ",151],["T_VARIABLE","$data",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_ARRAY","array",153],"(",["T_CONSTANT_ENCAPSED_STRING","'active'",153],["T_WHITESPACE"," ",153],["T_DOUBLE_ARROW","=>",153],["T_WHITESPACE"," ",153],["T_STRING","Mage_Tag_Model_Tag_Relation",153],["T_DOUBLE_COLON","::",153],["T_STRING","STATUS_NOT_ACTIVE",153],")",";",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_getWriteAdapter",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","update",154],"(",["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getMainTable",154],"(",")",",",["T_WHITESPACE"," ",154],["T_VARIABLE","$data",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$condition",154],")",";",["T_WHITESPACE","\n        ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],";",["T_WHITESPACE","\n    ",155],"}",["T_WHITESPACE","\n\n    ",156],["T_DOC_COMMENT","\/**\n     * Add TAG to PRODUCT relations\n     *\n     * @param Mage_Tag_Model_Tag_Relation $model\n     * @return Mage_Tag_Model_Resource_Tag_Relation\n     *\/",158],["T_WHITESPACE","\n    ",163],["T_PUBLIC","public",164],["T_WHITESPACE"," ",164],["T_FUNCTION","function",164],["T_WHITESPACE"," ",164],["T_STRING","addRelations",164],"(",["T_VARIABLE","$model",164],")",["T_WHITESPACE","\n    ",164],"{",["T_WHITESPACE","\n        ",165],["T_VARIABLE","$addedIds",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$model",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getAddedProductIds",166],"(",")",";",["T_WHITESPACE","\n\n        ",166],["T_VARIABLE","$bind",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_ARRAY","array",168],"(",["T_WHITESPACE","\n            ",168],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",169],["T_WHITESPACE","   ",169],["T_DOUBLE_ARROW","=>",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$model",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getTagId",169],"(",")",",",["T_WHITESPACE","\n            ",169],["T_CONSTANT_ENCAPSED_STRING","'store_id'",170],["T_WHITESPACE"," ",170],["T_DOUBLE_ARROW","=>",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$model",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","getStoreId",170],"(",")",["T_WHITESPACE","\n        ",170],")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$write",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","_getWriteAdapter",172],"(",")",";",["T_WHITESPACE","\n\n        ",172],["T_VARIABLE","$select",174],["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$write",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","select",174],"(",")",["T_WHITESPACE","\n            ",174],["T_OBJECT_OPERATOR","->",175],["T_STRING","from",175],"(",["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","getMainTable",175],"(",")",",",["T_WHITESPACE"," ",175],["T_CONSTANT_ENCAPSED_STRING","'product_id'",175],")",["T_WHITESPACE","\n            ",175],["T_OBJECT_OPERATOR","->",176],["T_STRING","where",176],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_id = :tag_id'",176],")",["T_WHITESPACE","\n            ",176],["T_OBJECT_OPERATOR","->",177],["T_STRING","where",177],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id = :store_id'",177],")",";",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$oldRelationIds",178],["T_WHITESPACE"," ",178],"=",["T_WHITESPACE"," ",178],["T_VARIABLE","$write",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","fetchCol",178],"(",["T_VARIABLE","$select",178],",",["T_WHITESPACE"," ",178],["T_VARIABLE","$bind",178],")",";",["T_WHITESPACE","\n\n        ",178],["T_VARIABLE","$insert",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","array_diff",180],"(",["T_VARIABLE","$addedIds",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$oldRelationIds",180],")",";",["T_WHITESPACE","\n        ",180],["T_VARIABLE","$delete",181],["T_WHITESPACE"," ",181],"=",["T_WHITESPACE"," ",181],["T_STRING","array_diff",181],"(",["T_VARIABLE","$oldRelationIds",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$addedIds",181],")",";",["T_WHITESPACE","\n\n        ",181],["T_IF","if",183],["T_WHITESPACE"," ",183],"(","!",["T_EMPTY","empty",183],"(",["T_VARIABLE","$insert",183],")",")",["T_WHITESPACE"," ",183],"{",["T_WHITESPACE","\n            ",183],["T_VARIABLE","$insertData",184],["T_WHITESPACE"," ",184],"=",["T_WHITESPACE"," ",184],["T_ARRAY","array",184],"(",")",";",["T_WHITESPACE","\n            ",184],["T_FOREACH","foreach",185],["T_WHITESPACE"," ",185],"(",["T_VARIABLE","$insert",185],["T_WHITESPACE"," ",185],["T_AS","as",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$value",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n                ",185],["T_VARIABLE","$insertData",186],"[","]",["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_ARRAY","array",186],"(",["T_WHITESPACE","\n                    ",186],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",187],["T_WHITESPACE","        ",187],["T_DOUBLE_ARROW","=>",187],["T_WHITESPACE"," ",187],["T_VARIABLE","$model",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getTagId",187],"(",")",",",["T_WHITESPACE","\n                    ",187],["T_CONSTANT_ENCAPSED_STRING","'store_id'",188],["T_WHITESPACE","      ",188],["T_DOUBLE_ARROW","=>",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$model",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getStoreId",188],"(",")",",",["T_WHITESPACE","\n                    ",188],["T_CONSTANT_ENCAPSED_STRING","'product_id'",189],["T_WHITESPACE","    ",189],["T_DOUBLE_ARROW","=>",189],["T_WHITESPACE"," ",189],["T_VARIABLE","$value",189],",",["T_WHITESPACE","\n                    ",189],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",190],["T_WHITESPACE","   ",190],["T_DOUBLE_ARROW","=>",190],["T_WHITESPACE"," ",190],["T_VARIABLE","$model",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getCustomerId",190],"(",")",",",["T_WHITESPACE","\n                    ",190],["T_CONSTANT_ENCAPSED_STRING","'created_at'",191],["T_WHITESPACE","    ",191],["T_DOUBLE_ARROW","=>",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","formatDate",191],"(",["T_STRING","time",191],"(",")",")",["T_WHITESPACE","\n                ",191],")",";",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$write",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","insertMultiple",194],"(",["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getMainTable",194],"(",")",",",["T_WHITESPACE"," ",194],["T_VARIABLE","$insertData",194],")",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n\n        ",195],["T_IF","if",197],["T_WHITESPACE"," ",197],"(","!",["T_EMPTY","empty",197],"(",["T_VARIABLE","$delete",197],")",")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$write",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","delete",198],"(",["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getMainTable",198],"(",")",",",["T_WHITESPACE"," ",198],["T_ARRAY","array",198],"(",["T_WHITESPACE","\n                ",198],["T_CONSTANT_ENCAPSED_STRING","'product_id IN (?)'",199],["T_WHITESPACE"," ",199],["T_DOUBLE_ARROW","=>",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$delete",199],",",["T_WHITESPACE","\n                ",199],["T_CONSTANT_ENCAPSED_STRING","'store_id = ?'",200],["T_WHITESPACE","      ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$model",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","getStoreId",200],"(",")",",",["T_WHITESPACE","\n            ",200],")",")",";",["T_WHITESPACE","\n        ",201],"}",["T_WHITESPACE","\n\n        ",202],["T_RETURN","return",204],["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],";",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n",205],"}",["T_WHITESPACE","\n",206]]