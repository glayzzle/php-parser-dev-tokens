[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tag\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_DOC_COMMENT","\/**\n * Tagged Product(s) Collection\n *\n * @category    Mage\n * @package     Mage_Tag\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Tag_Model_Resource_Product_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Catalog_Model_Resource_Product_Collection",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * Customer Id Filter\n     *\n     * @var int\n     *\/",37],["T_WHITESPACE","\n    ",41],["T_PROTECTED","protected",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$_customerFilterId",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Tag Id Filter\n     *\n     * @var int\n     *\/",44],["T_WHITESPACE","\n    ",48],["T_PROTECTED","protected",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$_tagIdFilter",49],";",["T_WHITESPACE","\n\n    ",49],["T_DOC_COMMENT","\/**\n     * Join Flags\n     *\n     * @var array\n     *\/",51],["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_joinFlags",56],["T_WHITESPACE","            ",56],"=",["T_WHITESPACE"," ",56],["T_ARRAY","array",56],"(",")",";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Initialize collection select\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",58],["T_WHITESPACE","\n    ",62],["T_PROTECTED","protected",63],["T_WHITESPACE"," ",63],["T_FUNCTION","function",63],["T_WHITESPACE"," ",63],["T_STRING","_initSelect",63],"(",")",["T_WHITESPACE","\n    ",63],"{",["T_WHITESPACE","\n        ",64],["T_STRING","parent",65],["T_DOUBLE_COLON","::",65],["T_STRING","_initSelect",65],"(",")",";",["T_WHITESPACE","\n\n        ",65],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","_joinFields",67],"(",")",";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getSelect",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","group",68],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",68],")",";",["T_WHITESPACE","\n\n        ",68],["T_COMMENT","\/*\n         * Allow analytic function usage\n         *\/",70],["T_WHITESPACE","\n        ",72],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","_useAnalyticFunction",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","true",73],";",["T_WHITESPACE","\n\n        ",73],["T_RETURN","return",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],";",["T_WHITESPACE","\n    ",75],"}",["T_WHITESPACE","\n\n    ",76],["T_DOC_COMMENT","\/**\n     * Set flag about joined table.\n     * setFlag method must be used in future.\n     *\n     * @deprecated after 1.3.2.3\n     *\n     * @param string $table\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",78],["T_WHITESPACE","\n    ",86],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","setJoinFlag",87],"(",["T_VARIABLE","$table",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","setFlag",89],"(",["T_VARIABLE","$table",89],",",["T_WHITESPACE"," ",89],["T_STRING","true",89],")",";",["T_WHITESPACE","\n        ",89],["T_RETURN","return",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],";",["T_WHITESPACE","\n    ",90],"}",["T_WHITESPACE","\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Get flag's status about joined table.\n     * getFlag method must be used in future.\n     *\n     * @deprecated after 1.3.2.3\n     *\n     * @param string $table\n     * @return bool\n     *\/",93],["T_WHITESPACE","\n    ",101],["T_PUBLIC","public",102],["T_WHITESPACE"," ",102],["T_FUNCTION","function",102],["T_WHITESPACE"," ",102],["T_STRING","getJoinFlag",102],"(",["T_VARIABLE","$table",102],")",["T_WHITESPACE","\n    ",102],"{",["T_WHITESPACE","\n        ",103],["T_RETURN","return",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getFlag",104],"(",["T_VARIABLE","$table",104],")",";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Unset value of join flag.\n     * Set false (bool) value to flag instead in future.\n     *\n     * @deprecated after 1.3.2.3\n     *\n     * @param string $table\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",107],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","unsetJoinFlag",116],"(",["T_VARIABLE","$table",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","null",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","setFlag",118],"(",["T_VARIABLE","$table",118],",",["T_WHITESPACE"," ",118],["T_STRING","false",118],")",";",["T_WHITESPACE","\n        ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],";",["T_WHITESPACE","\n    ",119],"}",["T_WHITESPACE","\n\n    ",120],["T_DOC_COMMENT","\/**\n     * Add tag visibility on stores\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",122],["T_WHITESPACE","\n    ",126],["T_PUBLIC","public",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","addStoresVisibility",127],"(",")",["T_WHITESPACE","\n    ",127],"{",["T_WHITESPACE","\n        ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","setFlag",129],"(",["T_CONSTANT_ENCAPSED_STRING","'add_stores_after'",129],",",["T_WHITESPACE"," ",129],["T_STRING","true",129],")",";",["T_WHITESPACE","\n        ",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Add tag visibility on stores process\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",133],["T_WHITESPACE","\n    ",137],["T_PROTECTED","protected",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","_addStoresVisibility",138],"(",")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_VARIABLE","$tagIds",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_ARRAY","array",140],"(",")",";",["T_WHITESPACE","\n        ",140],["T_FOREACH","foreach",141],["T_WHITESPACE"," ",141],"(",["T_VARIABLE","$this",141],["T_WHITESPACE"," ",141],["T_AS","as",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$item",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n            ",141],["T_VARIABLE","$tagIds",142],"[","]",["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$item",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getTagId",142],"(",")",";",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE","\n\n        ",143],["T_VARIABLE","$tagsStores",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_ARRAY","array",145],"(",")",";",["T_WHITESPACE","\n        ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_STRING","sizeof",146],"(",["T_VARIABLE","$tagIds",146],")",["T_WHITESPACE"," ",146],">",["T_WHITESPACE"," ",146],["T_LNUMBER","0",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$select",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","getConnection",147],"(",")",["T_OBJECT_OPERATOR","->",147],["T_STRING","select",147],"(",")",["T_WHITESPACE","\n                ",147],["T_OBJECT_OPERATOR","->",148],["T_STRING","from",148],"(",["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","getTable",148],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/relation'",148],")",",",["T_WHITESPACE"," ",148],["T_ARRAY","array",148],"(",["T_CONSTANT_ENCAPSED_STRING","'store_id'",148],",",["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",148],")",")",["T_WHITESPACE","\n                ",148],["T_OBJECT_OPERATOR","->",149],["T_STRING","where",149],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_id IN(?)'",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$tagIds",149],")",";",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$tagsRaw",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getConnection",150],"(",")",["T_OBJECT_OPERATOR","->",150],["T_STRING","fetchAll",150],"(",["T_VARIABLE","$select",150],")",";",["T_WHITESPACE","\n            ",150],["T_FOREACH","foreach",151],["T_WHITESPACE"," ",151],"(",["T_VARIABLE","$tagsRaw",151],["T_WHITESPACE"," ",151],["T_AS","as",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$tag",151],")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(","!",["T_ISSET","isset",152],"(",["T_VARIABLE","$tagsStores",152],"[",["T_VARIABLE","$tag",152],"[",["T_CONSTANT_ENCAPSED_STRING","'tag_id'",152],"]","]",")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n                    ",152],["T_VARIABLE","$tagsStores",153],"[",["T_VARIABLE","$tag",153],"[",["T_CONSTANT_ENCAPSED_STRING","'tag_id'",153],"]","]",["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_ARRAY","array",153],"(",")",";",["T_WHITESPACE","\n                ",153],"}",["T_WHITESPACE","\n\n                ",154],["T_VARIABLE","$tagsStores",156],"[",["T_VARIABLE","$tag",156],"[",["T_CONSTANT_ENCAPSED_STRING","'tag_id'",156],"]","]","[","]",["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_VARIABLE","$tag",156],"[",["T_CONSTANT_ENCAPSED_STRING","'store_id'",156],"]",";",["T_WHITESPACE","\n            ",156],"}",["T_WHITESPACE","\n        ",157],"}",["T_WHITESPACE","\n\n        ",158],["T_FOREACH","foreach",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$this",160],["T_WHITESPACE"," ",160],["T_AS","as",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$item",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n            ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_ISSET","isset",161],"(",["T_VARIABLE","$tagsStores",161],"[",["T_VARIABLE","$item",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getTagId",161],"(",")","]",")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n                ",161],["T_VARIABLE","$item",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","setStores",162],"(",["T_VARIABLE","$tagsStores",162],"[",["T_VARIABLE","$item",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","getTagId",162],"(",")","]",")",";",["T_WHITESPACE","\n            ",162],"}",["T_WHITESPACE"," ",163],["T_ELSE","else",163],["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                ",163],["T_VARIABLE","$item",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","setStores",164],"(",["T_ARRAY","array",164],"(",")",")",";",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n\n        ",166],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Add group by tag\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",171],["T_WHITESPACE","\n    ",175],["T_PUBLIC","public",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","addGroupByTag",176],"(",")",["T_WHITESPACE","\n    ",176],"{",["T_WHITESPACE","\n        ",177],["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getSelect",178],"(",")",["T_OBJECT_OPERATOR","->",178],["T_STRING","group",178],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.tag_relation_id'",178],")",";",["T_WHITESPACE","\n        ",178],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$this",179],";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n\n    ",180],["T_DOC_COMMENT","\/**\n     * Add Store ID filter\n     *\n     * @param int|array $store\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",182],["T_WHITESPACE","\n    ",187],["T_PUBLIC","public",188],["T_WHITESPACE"," ",188],["T_FUNCTION","function",188],["T_WHITESPACE"," ",188],["T_STRING","addStoreFilter",188],"(",["T_VARIABLE","$store",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","null",188],")",["T_WHITESPACE","\n    ",188],"{",["T_WHITESPACE","\n        ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_STRING","is_null",190],"(",["T_VARIABLE","$store",190],")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getSelect",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","where",191],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.store_id IN (?)'",191],",",["T_WHITESPACE"," ",191],["T_VARIABLE","$store",191],")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n        ",192],["T_RETURN","return",193],["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],";",["T_WHITESPACE","\n    ",193],"}",["T_WHITESPACE","\n\n    ",194],["T_DOC_COMMENT","\/**\n     * Set Customer filter\n     * If incoming parameter is array and has element with key 'null'\n     * then condition with IS NULL or IS NOT NULL will be added.\n     * Otherwise condition with IN() will be added\n     *\n     * @param int|array $customerId\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",196],["T_WHITESPACE","\n    ",204],["T_PUBLIC","public",205],["T_WHITESPACE"," ",205],["T_FUNCTION","function",205],["T_WHITESPACE"," ",205],["T_STRING","addCustomerFilter",205],"(",["T_VARIABLE","$customerId",205],")",["T_WHITESPACE","\n    ",205],"{",["T_WHITESPACE","\n        ",206],["T_IF","if",207],["T_WHITESPACE"," ",207],"(",["T_STRING","is_array",207],"(",["T_VARIABLE","$customerId",207],")",["T_WHITESPACE"," ",207],["T_BOOLEAN_AND","&&",207],["T_WHITESPACE"," ",207],["T_ISSET","isset",207],"(",["T_VARIABLE","$customerId",207],"[",["T_CONSTANT_ENCAPSED_STRING","'null'",207],"]",")",")",["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_VARIABLE","$condition",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$customerId",208],"[",["T_CONSTANT_ENCAPSED_STRING","'null'",208],"]",")",["T_WHITESPACE"," ",208],"?",["T_WHITESPACE"," ",208],["T_CONSTANT_ENCAPSED_STRING","'IS NULL'",208],["T_WHITESPACE"," ",208],":",["T_WHITESPACE"," ",208],["T_CONSTANT_ENCAPSED_STRING","'IS NOT NULL'",208],";",["T_WHITESPACE","\n            ",208],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getSelect",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","where",209],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.customer_id '",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_VARIABLE","$condition",209],")",";",["T_WHITESPACE","\n            ",209],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$this",210],";",["T_WHITESPACE","\n        ",210],"}",["T_WHITESPACE","\n        ",211],["T_VARIABLE","$this",212],["T_OBJECT_OPERATOR","->",212],["T_STRING","getSelect",212],"(",")",["T_OBJECT_OPERATOR","->",212],["T_STRING","where",212],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.customer_id IN(?)'",212],",",["T_WHITESPACE"," ",212],["T_VARIABLE","$customerId",212],")",";",["T_WHITESPACE","\n        ",212],["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","_customerFilterId",213],["T_WHITESPACE"," ",213],"=",["T_WHITESPACE"," ",213],["T_VARIABLE","$customerId",213],";",["T_WHITESPACE","\n        ",213],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_VARIABLE","$this",214],";",["T_WHITESPACE","\n    ",214],"}",["T_WHITESPACE","\n\n    ",215],["T_DOC_COMMENT","\/**\n     * Set tag filter\n     *\n     * @param int $tagId\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",217],["T_WHITESPACE","\n    ",222],["T_PUBLIC","public",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","addTagFilter",223],"(",["T_VARIABLE","$tagId",223],")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","getSelect",225],"(",")",["T_OBJECT_OPERATOR","->",225],["T_STRING","where",225],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.tag_id = ?'",225],",",["T_WHITESPACE"," ",225],["T_VARIABLE","$tagId",225],")",";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","setFlag",226],"(",["T_CONSTANT_ENCAPSED_STRING","'distinct'",226],",",["T_WHITESPACE"," ",226],["T_STRING","true",226],")",";",["T_WHITESPACE","\n        ",226],["T_RETURN","return",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$this",227],";",["T_WHITESPACE","\n    ",227],"}",["T_WHITESPACE","\n\n    ",228],["T_DOC_COMMENT","\/**\n     * Add tag status filter\n     *\n     * @param int $status\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",230],["T_WHITESPACE","\n    ",235],["T_PUBLIC","public",236],["T_WHITESPACE"," ",236],["T_FUNCTION","function",236],["T_WHITESPACE"," ",236],["T_STRING","addStatusFilter",236],"(",["T_VARIABLE","$status",236],")",["T_WHITESPACE","\n    ",236],"{",["T_WHITESPACE","\n        ",237],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","getSelect",238],"(",")",["T_OBJECT_OPERATOR","->",238],["T_STRING","where",238],"(",["T_CONSTANT_ENCAPSED_STRING","'t.status = ?'",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$status",238],")",";",["T_WHITESPACE","\n        ",238],["T_RETURN","return",239],["T_WHITESPACE"," ",239],["T_VARIABLE","$this",239],";",["T_WHITESPACE","\n    ",239],"}",["T_WHITESPACE","\n\n    ",240],["T_DOC_COMMENT","\/**\n     * Set DESC order to collection\n     *\n     * @param string $dir\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",242],["T_WHITESPACE","\n    ",247],["T_PUBLIC","public",248],["T_WHITESPACE"," ",248],["T_FUNCTION","function",248],["T_WHITESPACE"," ",248],["T_STRING","setDescOrder",248],"(",["T_VARIABLE","$dir",248],["T_WHITESPACE"," ",248],"=",["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'DESC'",248],")",["T_WHITESPACE","\n    ",248],"{",["T_WHITESPACE","\n        ",249],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","setOrder",250],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.tag_relation_id'",250],",",["T_WHITESPACE"," ",250],["T_VARIABLE","$dir",250],")",";",["T_WHITESPACE","\n        ",250],["T_RETURN","return",251],["T_WHITESPACE"," ",251],["T_VARIABLE","$this",251],";",["T_WHITESPACE","\n    ",251],"}",["T_WHITESPACE","\n\n    ",252],["T_DOC_COMMENT","\/**\n     * Add Popularity\n     *\n     * @param int $tagId\n     * @param int $storeId\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",254],["T_WHITESPACE","\n    ",260],["T_PUBLIC","public",261],["T_WHITESPACE"," ",261],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","addPopularity",261],"(",["T_VARIABLE","$tagId",261],",",["T_WHITESPACE"," ",261],["T_VARIABLE","$storeId",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_STRING","null",261],")",["T_WHITESPACE","\n    ",261],"{",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$tagRelationTable",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getTable",263],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/relation'",263],")",";",["T_WHITESPACE","\n\n        ",263],["T_VARIABLE","$condition",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",["T_WHITESPACE","\n            ",265],["T_CONSTANT_ENCAPSED_STRING","'prelation.product_id=e.entity_id'",266],["T_WHITESPACE","\n        ",266],")",";",["T_WHITESPACE","\n\n        ",267],["T_IF","if",269],["T_WHITESPACE"," ",269],"(","!",["T_STRING","is_null",269],"(",["T_VARIABLE","$storeId",269],")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_VARIABLE","$condition",270],"[","]",["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","getConnection",270],"(",")",["T_OBJECT_OPERATOR","->",270],["T_STRING","quoteInto",270],"(",["T_CONSTANT_ENCAPSED_STRING","'prelation.store_id = ?'",270],",",["T_WHITESPACE"," ",270],["T_VARIABLE","$storeId",270],")",";",["T_WHITESPACE","\n        ",270],"}",["T_WHITESPACE","\n        ",271],["T_VARIABLE","$condition",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_STRING","join",272],"(",["T_CONSTANT_ENCAPSED_STRING","' AND '",272],",",["T_WHITESPACE"," ",272],["T_VARIABLE","$condition",272],")",";",["T_WHITESPACE","\n        ",272],["T_VARIABLE","$innerSelect",273],["T_WHITESPACE"," ",273],"=",["T_WHITESPACE"," ",273],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","getConnection",273],"(",")",["T_OBJECT_OPERATOR","->",273],["T_STRING","select",273],"(",")",["T_WHITESPACE","\n        ",273],["T_OBJECT_OPERATOR","->",274],["T_STRING","from",274],"(",["T_WHITESPACE","\n            ",274],["T_ARRAY","array",275],"(",["T_CONSTANT_ENCAPSED_STRING","'relation'",275],["T_WHITESPACE"," ",275],["T_DOUBLE_ARROW","=>",275],["T_WHITESPACE"," ",275],["T_VARIABLE","$tagRelationTable",275],")",",",["T_WHITESPACE","\n            ",275],["T_ARRAY","array",276],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",276],",",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'store_id'",276],",",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'popularity'",276],["T_WHITESPACE"," ",276],["T_DOUBLE_ARROW","=>",276],["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT relation.tag_relation_id)'",276],")",["T_WHITESPACE","\n        ",276],")",["T_WHITESPACE","\n        ",277],["T_OBJECT_OPERATOR","->",278],["T_STRING","where",278],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.tag_id = ?'",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$tagId",278],")",["T_WHITESPACE","\n        ",278],["T_OBJECT_OPERATOR","->",279],["T_STRING","group",279],"(",["T_ARRAY","array",279],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",279],",",["T_WHITESPACE"," ",279],["T_CONSTANT_ENCAPSED_STRING","'store_id'",279],")",")",";",["T_WHITESPACE","\n\n        ",279],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getSelect",281],"(",")",["T_WHITESPACE","\n            ",281],["T_OBJECT_OPERATOR","->",282],["T_STRING","joinLeft",282],"(",["T_WHITESPACE","\n                ",282],["T_ARRAY","array",283],"(",["T_CONSTANT_ENCAPSED_STRING","'prelation'",283],["T_WHITESPACE"," ",283],["T_DOUBLE_ARROW","=>",283],["T_WHITESPACE"," ",283],["T_VARIABLE","$innerSelect",283],")",",",["T_WHITESPACE","\n                ",283],["T_VARIABLE","$condition",284],",",["T_WHITESPACE","\n                ",284],["T_ARRAY","array",285],"(",["T_CONSTANT_ENCAPSED_STRING","'popularity'",285],["T_WHITESPACE"," ",285],["T_DOUBLE_ARROW","=>",285],["T_WHITESPACE"," ",285],["T_CONSTANT_ENCAPSED_STRING","'prelation.popularity'",285],")",["T_WHITESPACE","\n            ",285],")",";",["T_WHITESPACE","\n\n        ",286],["T_VARIABLE","$this",288],["T_OBJECT_OPERATOR","->",288],["T_STRING","_tagIdFilter",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_VARIABLE","$tagId",288],";",["T_WHITESPACE","\n        ",288],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","setFlag",289],"(",["T_CONSTANT_ENCAPSED_STRING","'prelation'",289],",",["T_WHITESPACE"," ",289],["T_STRING","true",289],")",";",["T_WHITESPACE","\n        ",289],["T_RETURN","return",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$this",290],";",["T_WHITESPACE","\n    ",290],"}",["T_WHITESPACE","\n\n    ",291],["T_DOC_COMMENT","\/**\n     * Add Popularity Filter\n     *\n     * @param mixed $condition\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",293],["T_WHITESPACE","\n    ",298],["T_PUBLIC","public",299],["T_WHITESPACE"," ",299],["T_FUNCTION","function",299],["T_WHITESPACE"," ",299],["T_STRING","addPopularityFilter",299],"(",["T_VARIABLE","$condition",299],")",["T_WHITESPACE","\n    ",299],"{",["T_WHITESPACE","\n        ",300],["T_VARIABLE","$tagRelationTable",301],["T_WHITESPACE"," ",301],"=",["T_WHITESPACE"," ",301],["T_STRING","Mage",301],["T_DOUBLE_COLON","::",301],["T_STRING","getSingleton",301],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource'",301],")",["T_WHITESPACE","\n            ",301],["T_OBJECT_OPERATOR","->",302],["T_STRING","getTableName",302],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/relation'",302],")",";",["T_WHITESPACE","\n\n        ",302],["T_VARIABLE","$select",304],["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","getConnection",304],"(",")",["T_OBJECT_OPERATOR","->",304],["T_STRING","select",304],"(",")",["T_WHITESPACE","\n            ",304],["T_OBJECT_OPERATOR","->",305],["T_STRING","from",305],"(",["T_VARIABLE","$tagRelationTable",305],",",["T_WHITESPACE"," ",305],["T_ARRAY","array",305],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",305],",",["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","'popularity'",305],["T_WHITESPACE"," ",305],["T_DOUBLE_ARROW","=>",305],["T_WHITESPACE"," ",305],["T_CONSTANT_ENCAPSED_STRING","'COUNT(DISTINCT tag_relation_id)'",305],")",")",["T_WHITESPACE","\n            ",305],["T_OBJECT_OPERATOR","->",306],["T_STRING","where",306],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_id = :tag_id'",306],")",["T_WHITESPACE","\n            ",306],["T_OBJECT_OPERATOR","->",307],["T_STRING","group",307],"(",["T_CONSTANT_ENCAPSED_STRING","'product_id'",307],")",["T_WHITESPACE","\n            ",307],["T_OBJECT_OPERATOR","->",308],["T_STRING","having",308],"(",["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_getConditionSql",308],"(",["T_CONSTANT_ENCAPSED_STRING","'popularity'",308],",",["T_WHITESPACE"," ",308],["T_VARIABLE","$condition",308],")",")",";",["T_WHITESPACE","\n\n        ",308],["T_VARIABLE","$prodIds",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_ARRAY","array",310],"(",")",";",["T_WHITESPACE","\n        ",310],["T_FOREACH","foreach",311],["T_WHITESPACE"," ",311],"(",["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","getConnection",311],"(",")",["T_OBJECT_OPERATOR","->",311],["T_STRING","fetchAll",311],"(",["T_VARIABLE","$select",311],",",["T_WHITESPACE"," ",311],["T_ARRAY","array",311],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_id'",311],["T_WHITESPACE"," ",311],["T_DOUBLE_ARROW","=>",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_tagIdFilter",311],")",")",["T_WHITESPACE"," ",311],["T_AS","as",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$item",311],")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n            ",311],["T_VARIABLE","$prodIds",312],"[","]",["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$item",312],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",312],"]",";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n\n        ",313],["T_IF","if",315],["T_WHITESPACE"," ",315],"(",["T_STRING","sizeof",315],"(",["T_VARIABLE","$prodIds",315],")",["T_WHITESPACE"," ",315],">",["T_WHITESPACE"," ",315],["T_LNUMBER","0",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","getSelect",316],"(",")",["T_OBJECT_OPERATOR","->",316],["T_STRING","where",316],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(?)'",316],",",["T_WHITESPACE"," ",316],["T_VARIABLE","$prodIds",316],")",";",["T_WHITESPACE","\n        ",316],"}",["T_WHITESPACE"," ",317],["T_ELSE","else",317],["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n            ",317],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getSelect",318],"(",")",["T_OBJECT_OPERATOR","->",318],["T_STRING","where",318],"(",["T_CONSTANT_ENCAPSED_STRING","'e.entity_id IN(0)'",318],")",";",["T_WHITESPACE","\n        ",318],"}",["T_WHITESPACE","\n\n        ",319],["T_RETURN","return",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$this",321],";",["T_WHITESPACE","\n    ",321],"}",["T_WHITESPACE","\n\n    ",322],["T_DOC_COMMENT","\/**\n     * Set tag active filter to collection\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",324],["T_WHITESPACE","\n    ",328],["T_PUBLIC","public",329],["T_WHITESPACE"," ",329],["T_FUNCTION","function",329],["T_WHITESPACE"," ",329],["T_STRING","setActiveFilter",329],"(",")",["T_WHITESPACE","\n    ",329],"{",["T_WHITESPACE","\n        ",330],["T_VARIABLE","$active",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_STRING","Mage_Tag_Model_Tag_Relation",331],["T_DOUBLE_COLON","::",331],["T_STRING","STATUS_ACTIVE",331],";",["T_WHITESPACE","\n        ",331],["T_VARIABLE","$this",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","getSelect",332],"(",")",["T_OBJECT_OPERATOR","->",332],["T_STRING","where",332],"(",["T_CONSTANT_ENCAPSED_STRING","'relation.active = ?'",332],",",["T_WHITESPACE"," ",332],["T_VARIABLE","$active",332],")",";",["T_WHITESPACE","\n        ",332],["T_IF","if",333],["T_WHITESPACE"," ",333],"(",["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","getFlag",333],"(",["T_CONSTANT_ENCAPSED_STRING","'prelation'",333],")",")",["T_WHITESPACE"," ",333],"{",["T_WHITESPACE","\n            ",333],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getSelect",334],"(",")",["T_OBJECT_OPERATOR","->",334],["T_STRING","where",334],"(",["T_CONSTANT_ENCAPSED_STRING","'prelation.active = ?'",334],",",["T_WHITESPACE"," ",334],["T_VARIABLE","$active",334],")",";",["T_WHITESPACE","\n        ",334],"}",["T_WHITESPACE","\n        ",335],["T_RETURN","return",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$this",336],";",["T_WHITESPACE","\n    ",336],"}",["T_WHITESPACE","\n\n    ",337],["T_DOC_COMMENT","\/**\n     * Add Product Tags\n     *\n     * @param int $storeId\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",339],["T_WHITESPACE","\n    ",344],["T_PUBLIC","public",345],["T_WHITESPACE"," ",345],["T_FUNCTION","function",345],["T_WHITESPACE"," ",345],["T_STRING","addProductTags",345],"(",["T_VARIABLE","$storeId",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_STRING","null",345],")",["T_WHITESPACE","\n    ",345],"{",["T_WHITESPACE","\n        ",346],["T_FOREACH","foreach",347],["T_WHITESPACE"," ",347],"(",["T_VARIABLE","$this",347],["T_OBJECT_OPERATOR","->",347],["T_STRING","getItems",347],"(",")",["T_WHITESPACE"," ",347],["T_AS","as",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$item",347],")",["T_WHITESPACE"," ",347],"{",["T_WHITESPACE","\n            ",347],["T_VARIABLE","$tagsCollection",348],["T_WHITESPACE"," ",348],"=",["T_WHITESPACE"," ",348],["T_STRING","Mage",348],["T_DOUBLE_COLON","::",348],["T_STRING","getModel",348],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",348],")",["T_OBJECT_OPERATOR","->",348],["T_STRING","getResourceCollection",348],"(",")",";",["T_WHITESPACE","\n\n            ",348],["T_IF","if",350],["T_WHITESPACE"," ",350],"(","!",["T_STRING","is_null",350],"(",["T_VARIABLE","$storeId",350],")",")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n                ",350],["T_VARIABLE","$tagsCollection",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","addStoreFilter",351],"(",["T_VARIABLE","$storeId",351],")",";",["T_WHITESPACE","\n            ",351],"}",["T_WHITESPACE","\n\n            ",352],["T_VARIABLE","$tagsCollection",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","addPopularity",354],"(",")",["T_WHITESPACE","\n                ",354],["T_OBJECT_OPERATOR","->",355],["T_STRING","addProductFilter",355],"(",["T_VARIABLE","$item",355],["T_OBJECT_OPERATOR","->",355],["T_STRING","getEntityId",355],"(",")",")",["T_WHITESPACE","\n                ",355],["T_OBJECT_OPERATOR","->",356],["T_STRING","addCustomerFilter",356],"(",["T_VARIABLE","$this",356],["T_OBJECT_OPERATOR","->",356],["T_STRING","_customerFilterId",356],")",["T_WHITESPACE","\n                ",356],["T_OBJECT_OPERATOR","->",357],["T_STRING","setActiveFilter",357],"(",")",";",["T_WHITESPACE","\n\n            ",357],["T_VARIABLE","$tagsCollection",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","load",359],"(",")",";",["T_WHITESPACE","\n            ",359],["T_VARIABLE","$item",360],["T_OBJECT_OPERATOR","->",360],["T_STRING","setProductTags",360],"(",["T_VARIABLE","$tagsCollection",360],")",";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n\n        ",361],["T_RETURN","return",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],";",["T_WHITESPACE","\n    ",363],"}",["T_WHITESPACE","\n\n    ",364],["T_DOC_COMMENT","\/**\n     * Join fields process\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",366],["T_WHITESPACE","\n    ",370],["T_PROTECTED","protected",371],["T_WHITESPACE"," ",371],["T_FUNCTION","function",371],["T_WHITESPACE"," ",371],["T_STRING","_joinFields",371],"(",")",["T_WHITESPACE","\n    ",371],"{",["T_WHITESPACE","\n        ",372],["T_VARIABLE","$tagTable",373],["T_WHITESPACE","           ",373],"=",["T_WHITESPACE"," ",373],["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","getTable",373],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",373],")",";",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$tagRelationTable",374],["T_WHITESPACE","   ",374],"=",["T_WHITESPACE"," ",374],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","getTable",374],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/relation'",374],")",";",["T_WHITESPACE","\n\n        ",374],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","addAttributeToSelect",376],"(",["T_CONSTANT_ENCAPSED_STRING","'name'",376],")",["T_WHITESPACE","\n            ",376],["T_OBJECT_OPERATOR","->",377],["T_STRING","addAttributeToSelect",377],"(",["T_CONSTANT_ENCAPSED_STRING","'price'",377],")",["T_WHITESPACE","\n            ",377],["T_OBJECT_OPERATOR","->",378],["T_STRING","addAttributeToSelect",378],"(",["T_CONSTANT_ENCAPSED_STRING","'small_image'",378],")",";",["T_WHITESPACE","\n\n        ",378],["T_VARIABLE","$this",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","getSelect",380],"(",")",["T_WHITESPACE","\n            ",380],["T_OBJECT_OPERATOR","->",381],["T_STRING","join",381],"(",["T_ARRAY","array",381],"(",["T_CONSTANT_ENCAPSED_STRING","'relation'",381],["T_WHITESPACE"," ",381],["T_DOUBLE_ARROW","=>",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$tagRelationTable",381],")",",",["T_WHITESPACE"," ",381],["T_CONSTANT_ENCAPSED_STRING","'relation.product_id = e.entity_id'",381],",",["T_WHITESPACE"," ",381],["T_ARRAY","array",381],"(",["T_WHITESPACE","\n                ",381],["T_CONSTANT_ENCAPSED_STRING","'product_id'",382],["T_WHITESPACE","    ",382],["T_DOUBLE_ARROW","=>",382],["T_WHITESPACE"," ",382],["T_CONSTANT_ENCAPSED_STRING","'product_id'",382],",",["T_WHITESPACE","\n                ",382],["T_CONSTANT_ENCAPSED_STRING","'item_store_id'",383],["T_WHITESPACE"," ",383],["T_DOUBLE_ARROW","=>",383],["T_WHITESPACE"," ",383],["T_CONSTANT_ENCAPSED_STRING","'store_id'",383],",",["T_WHITESPACE","\n            ",383],")",")",["T_WHITESPACE","\n            ",384],["T_OBJECT_OPERATOR","->",385],["T_STRING","join",385],"(",["T_ARRAY","array",385],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",385],["T_WHITESPACE"," ",385],["T_DOUBLE_ARROW","=>",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$tagTable",385],")",",",["T_WHITESPACE","\n                ",385],["T_CONSTANT_ENCAPSED_STRING","'t.tag_id = relation.tag_id'",386],",",["T_WHITESPACE","\n                ",386],["T_ARRAY","array",387],"(",["T_WHITESPACE","\n                    ",387],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",388],",",["T_WHITESPACE","\n                    ",388],["T_CONSTANT_ENCAPSED_STRING","'tag_status'",389],["T_WHITESPACE"," ",389],["T_DOUBLE_ARROW","=>",389],["T_WHITESPACE"," ",389],["T_CONSTANT_ENCAPSED_STRING","'status'",389],",",["T_WHITESPACE","\n                    ",389],["T_CONSTANT_ENCAPSED_STRING","'tag_name'",390],["T_WHITESPACE","   ",390],["T_DOUBLE_ARROW","=>",390],["T_WHITESPACE"," ",390],["T_CONSTANT_ENCAPSED_STRING","'name'",390],",",["T_WHITESPACE","\n                    ",390],["T_CONSTANT_ENCAPSED_STRING","'store_id'",391],["T_WHITESPACE","   ",391],["T_DOUBLE_ARROW","=>",391],["T_WHITESPACE"," ",391],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","getConnection",391],"(",")",["T_OBJECT_OPERATOR","->",391],["T_STRING","getCheckSql",391],"(",["T_WHITESPACE","\n                        ",391],["T_CONSTANT_ENCAPSED_STRING","'t.first_store_id = 0'",392],",",["T_WHITESPACE","\n                        ",392],["T_CONSTANT_ENCAPSED_STRING","'relation.store_id'",393],",",["T_WHITESPACE","\n                        ",393],["T_CONSTANT_ENCAPSED_STRING","'t.first_store_id'",394],["T_WHITESPACE","\n                    ",394],")",["T_WHITESPACE","\n                ",395],")",["T_WHITESPACE","\n            ",396],")",";",["T_WHITESPACE","\n\n        ",397],["T_RETURN","return",399],["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],";",["T_WHITESPACE","\n    ",399],"}",["T_WHITESPACE","\n\n    ",400],["T_DOC_COMMENT","\/**\n     * After load adding data\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",402],["T_WHITESPACE","\n    ",406],["T_PROTECTED","protected",407],["T_WHITESPACE"," ",407],["T_FUNCTION","function",407],["T_WHITESPACE"," ",407],["T_STRING","_afterLoad",407],"(",")",["T_WHITESPACE","\n    ",407],"{",["T_WHITESPACE","\n        ",408],["T_STRING","parent",409],["T_DOUBLE_COLON","::",409],["T_STRING","_afterLoad",409],"(",")",";",["T_WHITESPACE","\n\n        ",409],["T_IF","if",411],["T_WHITESPACE"," ",411],"(",["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","getFlag",411],"(",["T_CONSTANT_ENCAPSED_STRING","'add_stores_after'",411],")",")",["T_WHITESPACE"," ",411],"{",["T_WHITESPACE","\n            ",411],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","_addStoresVisibility",412],"(",")",";",["T_WHITESPACE","\n        ",412],"}",["T_WHITESPACE","\n\n        ",413],["T_IF","if",415],["T_WHITESPACE"," ",415],"(",["T_STRING","count",415],"(",["T_VARIABLE","$this",415],")",["T_WHITESPACE"," ",415],">",["T_WHITESPACE"," ",415],["T_LNUMBER","0",415],")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n            ",415],["T_STRING","Mage",416],["T_DOUBLE_COLON","::",416],["T_STRING","dispatchEvent",416],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_tag_product_collection_load_after'",416],",",["T_WHITESPACE"," ",416],["T_ARRAY","array",416],"(",["T_WHITESPACE","\n                ",416],["T_CONSTANT_ENCAPSED_STRING","'collection'",417],["T_WHITESPACE"," ",417],["T_DOUBLE_ARROW","=>",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_WHITESPACE","\n            ",417],")",")",";",["T_WHITESPACE","\n        ",418],"}",["T_WHITESPACE","\n\n        ",419],["T_RETURN","return",421],["T_WHITESPACE"," ",421],["T_VARIABLE","$this",421],";",["T_WHITESPACE","\n    ",421],"}",["T_WHITESPACE","\n\n    ",422],["T_DOC_COMMENT","\/**\n     * Render SQL for retrieve product count\n     *\n     * @return string\n     *\/",424],["T_WHITESPACE","\n    ",428],["T_PUBLIC","public",429],["T_WHITESPACE"," ",429],["T_FUNCTION","function",429],["T_WHITESPACE"," ",429],["T_STRING","getSelectCountSql",429],"(",")",["T_WHITESPACE","\n    ",429],"{",["T_WHITESPACE","\n        ",430],["T_VARIABLE","$countSelect",431],["T_WHITESPACE"," ",431],"=",["T_WHITESPACE"," ",431],["T_CLONE","clone",431],["T_WHITESPACE"," ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","getSelect",431],"(",")",";",["T_WHITESPACE","\n\n        ",431],["T_VARIABLE","$countSelect",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","reset",433],"(",["T_STRING","Zend_Db_Select",433],["T_DOUBLE_COLON","::",433],["T_STRING","COLUMNS",433],")",";",["T_WHITESPACE","\n        ",433],["T_VARIABLE","$countSelect",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","reset",434],"(",["T_STRING","Zend_Db_Select",434],["T_DOUBLE_COLON","::",434],["T_STRING","ORDER",434],")",";",["T_WHITESPACE","\n        ",434],["T_VARIABLE","$countSelect",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","reset",435],"(",["T_STRING","Zend_Db_Select",435],["T_DOUBLE_COLON","::",435],["T_STRING","LIMIT_COUNT",435],")",";",["T_WHITESPACE","\n        ",435],["T_VARIABLE","$countSelect",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","reset",436],"(",["T_STRING","Zend_Db_Select",436],["T_DOUBLE_COLON","::",436],["T_STRING","LIMIT_OFFSET",436],")",";",["T_WHITESPACE","\n        ",436],["T_VARIABLE","$countSelect",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","reset",437],"(",["T_STRING","Zend_Db_Select",437],["T_DOUBLE_COLON","::",437],["T_STRING","GROUP",437],")",";",["T_WHITESPACE","\n\n        ",437],["T_IF","if",439],["T_WHITESPACE"," ",439],"(",["T_VARIABLE","$this",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","getFlag",439],"(",["T_CONSTANT_ENCAPSED_STRING","'group_tag'",439],")",")",["T_WHITESPACE"," ",439],"{",["T_WHITESPACE","\n            ",439],["T_VARIABLE","$field",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_CONSTANT_ENCAPSED_STRING","'relation.tag_id'",440],";",["T_WHITESPACE","\n        ",440],"}",["T_WHITESPACE"," ",441],["T_ELSE","else",441],["T_WHITESPACE"," ",441],"{",["T_WHITESPACE","\n            ",441],["T_VARIABLE","$field",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_CONSTANT_ENCAPSED_STRING","'e.entity_id'",442],";",["T_WHITESPACE","\n        ",442],"}",["T_WHITESPACE","\n        ",443],["T_VARIABLE","$expr",444],["T_WHITESPACE"," ",444],"=",["T_WHITESPACE"," ",444],["T_NEW","new",444],["T_WHITESPACE"," ",444],["T_STRING","Zend_Db_Expr",444],"(",["T_CONSTANT_ENCAPSED_STRING","'COUNT('",444],["T_WHITESPACE","\n            ",444],".",["T_WHITESPACE"," ",445],"(",["T_VARIABLE","$this",445],["T_OBJECT_OPERATOR","->",445],["T_STRING","getFlag",445],"(",["T_CONSTANT_ENCAPSED_STRING","'distinct'",445],")",["T_WHITESPACE"," ",445],"?",["T_WHITESPACE"," ",445],["T_CONSTANT_ENCAPSED_STRING","'DISTINCT '",445],["T_WHITESPACE"," ",445],":",["T_WHITESPACE"," ",445],["T_CONSTANT_ENCAPSED_STRING","''",445],")",["T_WHITESPACE","\n            ",445],".",["T_WHITESPACE"," ",446],["T_VARIABLE","$field",446],["T_WHITESPACE"," ",446],".",["T_WHITESPACE"," ",446],["T_CONSTANT_ENCAPSED_STRING","')'",446],")",";",["T_WHITESPACE","\n\n        ",446],["T_VARIABLE","$countSelect",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","columns",448],"(",["T_VARIABLE","$expr",448],")",";",["T_WHITESPACE","\n\n        ",448],["T_RETURN","return",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$countSelect",450],";",["T_WHITESPACE","\n    ",450],"}",["T_WHITESPACE","\n\n    ",451],["T_DOC_COMMENT","\/**\n     * Treat \"order by\" items as attributes to sort\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",453],["T_WHITESPACE","\n    ",457],["T_PROTECTED","protected",458],["T_WHITESPACE"," ",458],["T_FUNCTION","function",458],["T_WHITESPACE"," ",458],["T_STRING","_renderOrders",458],"(",")",["T_WHITESPACE","\n    ",458],"{",["T_WHITESPACE","\n        ",459],["T_IF","if",460],["T_WHITESPACE"," ",460],"(","!",["T_VARIABLE","$this",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","_isOrdersRendered",460],")",["T_WHITESPACE"," ",460],"{",["T_WHITESPACE","\n            ",460],["T_STRING","parent",461],["T_DOUBLE_COLON","::",461],["T_STRING","_renderOrders",461],"(",")",";",["T_WHITESPACE","\n\n            ",461],["T_VARIABLE","$orders",463],["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getSelect",463],"(",")",["T_WHITESPACE","\n                ",463],["T_OBJECT_OPERATOR","->",464],["T_STRING","getPart",464],"(",["T_STRING","Zend_Db_Select",464],["T_DOUBLE_COLON","::",464],["T_STRING","ORDER",464],")",";",["T_WHITESPACE","\n\n            ",464],["T_VARIABLE","$appliedOrders",466],["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_ARRAY","array",466],"(",")",";",["T_WHITESPACE","\n            ",466],["T_FOREACH","foreach",467],["T_WHITESPACE"," ",467],"(",["T_VARIABLE","$orders",467],["T_WHITESPACE"," ",467],["T_AS","as",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$order",467],")",["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n                ",467],["T_VARIABLE","$appliedOrders",468],"[",["T_VARIABLE","$order",468],"[",["T_LNUMBER","0",468],"]","]",["T_WHITESPACE"," ",468],"=",["T_WHITESPACE"," ",468],["T_STRING","true",468],";",["T_WHITESPACE","\n            ",468],"}",["T_WHITESPACE","\n\n            ",469],["T_FOREACH","foreach",471],["T_WHITESPACE"," ",471],"(",["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","_orders",471],["T_WHITESPACE"," ",471],["T_AS","as",471],["T_WHITESPACE"," ",471],["T_VARIABLE","$field",471],["T_WHITESPACE"," ",471],["T_DOUBLE_ARROW","=>",471],["T_WHITESPACE"," ",471],["T_VARIABLE","$direction",471],")",["T_WHITESPACE"," ",471],"{",["T_WHITESPACE","\n                ",471],["T_IF","if",472],["T_WHITESPACE"," ",472],"(",["T_EMPTY","empty",472],"(",["T_VARIABLE","$appliedOrders",472],"[",["T_VARIABLE","$field",472],"]",")",")",["T_WHITESPACE"," ",472],"{",["T_WHITESPACE","\n                    ",472],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","_select",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","order",473],"(",["T_NEW","new",473],["T_WHITESPACE"," ",473],["T_STRING","Zend_Db_Expr",473],"(",["T_VARIABLE","$field",473],["T_WHITESPACE"," ",473],".",["T_WHITESPACE"," ",473],["T_CONSTANT_ENCAPSED_STRING","' '",473],["T_WHITESPACE"," ",473],".",["T_WHITESPACE"," ",473],["T_VARIABLE","$direction",473],")",")",";",["T_WHITESPACE","\n                ",473],"}",["T_WHITESPACE","\n            ",474],"}",["T_WHITESPACE","\n        ",475],"}",["T_WHITESPACE","\n        ",476],["T_RETURN","return",477],["T_WHITESPACE"," ",477],["T_VARIABLE","$this",477],";",["T_WHITESPACE","\n    ",477],"}",["T_WHITESPACE","\n\n    ",478],["T_DOC_COMMENT","\/**\n     * Set Id Fieldname as Tag Relation Id\n     *\n     * @return Mage_Tag_Model_Resource_Product_Collection\n     *\/",480],["T_WHITESPACE","\n    ",484],["T_PUBLIC","public",485],["T_WHITESPACE"," ",485],["T_FUNCTION","function",485],["T_WHITESPACE"," ",485],["T_STRING","setRelationId",485],"(",")",["T_WHITESPACE","\n    ",485],"{",["T_WHITESPACE","\n        ",486],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","_setIdFieldName",487],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_relation_id'",487],")",";",["T_WHITESPACE","\n        ",487],["T_RETURN","return",488],["T_WHITESPACE"," ",488],["T_VARIABLE","$this",488],";",["T_WHITESPACE","\n    ",488],"}",["T_WHITESPACE","\n",489],"}",["T_WHITESPACE","\n",490]]