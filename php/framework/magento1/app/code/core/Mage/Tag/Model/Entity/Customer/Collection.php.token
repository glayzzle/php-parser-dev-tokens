[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tag\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Customers collection\n *\n * @category   Mage\n * @package    Mage_Tag\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n\n",33],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Tag_Model_Entity_Customer_Collection",35],["T_WHITESPACE"," ",35],["T_EXTENDS","extends",35],["T_WHITESPACE"," ",35],["T_STRING","Mage_Customer_Model_Entity_Customer_Collection",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_PROTECTED","protected",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$_tagTable",37],";",["T_WHITESPACE","\n    ",37],["T_PROTECTED","protected",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$_tagRelTable",38],";",["T_WHITESPACE","\n\n    ",38],["T_PUBLIC","public",40],["T_WHITESPACE"," ",40],["T_FUNCTION","function",40],["T_WHITESPACE"," ",40],["T_STRING","__construct",40],"(",")",["T_WHITESPACE","\n    ",40],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$resource",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_STRING","Mage",42],["T_DOUBLE_COLON","::",42],["T_STRING","getSingleton",42],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/resource'",42],")",";",["T_WHITESPACE","\n        ",42],["T_STRING","parent",43],["T_DOUBLE_COLON","::",43],["T_STRING","__construct",43],"(",")",";",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","_tagTable",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$resource",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getTableName",44],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",44],")",";",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","_tagRelTable",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$resource",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","getTableName",45],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag_relation'",45],")",";",["T_WHITESPACE","\n\n",45],["T_COMMENT","\/\/        $this->joinField('tag_total_used', $this->_tagRelTable, 'count(_table_tag_total_used.tag_relations_id)', 'entity_val_id=entity_id', array('entity_id' => '2'));\n",47],["T_COMMENT","\/\/        $this->getSelect()->group('tag_tag_id');\n",48],["T_COMMENT","\/\/        echo $this->getSelect();\n",49],["T_COMMENT","\/\/        $this->_productTable = $resource->getTableName('catalog\/product');\n",50],["T_COMMENT","\/\/        $this->_select->from(array('p' => $this->_productTable))\n",51],["T_COMMENT","\/\/            ->join(array('tr' => $this->_tagRelTable), 'tr.entity_val_id=p.product_id and tr.entity_id=1', array('total_used' => 'count(tr.tag_relations_id)'))\n",52],["T_COMMENT","\/\/            ->group('p.product_id', 'tr.tag_id')\n",53],["T_COMMENT","\/\/        ;\n",54],["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n\n    ",56],["T_PUBLIC","public",58],["T_WHITESPACE"," ",58],["T_FUNCTION","function",58],["T_WHITESPACE"," ",58],["T_STRING","addTagFilter",58],"(",["T_VARIABLE","$tagId",58],")",["T_WHITESPACE","\n    ",58],"{",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","joinField",60],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_tag_id'",60],",",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","_tagRelTable",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'tag_id'",60],",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'customer_id=entity_id'",60],")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getSelect",61],"(",")",["T_OBJECT_OPERATOR","->",61],["T_STRING","where",61],"(",["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_getAttributeTableAlias",61],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_tag_id'",61],")",["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'.tag_id=?'",61],",",["T_WHITESPACE"," ",61],["T_VARIABLE","$tagId",61],")",";",["T_WHITESPACE","\n        ",61],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],";",["T_WHITESPACE","\n    ",62],"}",["T_WHITESPACE","\n\n    ",63],["T_PUBLIC","public",65],["T_WHITESPACE"," ",65],["T_FUNCTION","function",65],["T_WHITESPACE"," ",65],["T_STRING","addProductFilter",65],"(",["T_VARIABLE","$productId",65],")",["T_WHITESPACE","\n    ",65],"{",["T_WHITESPACE","\n        ",66],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","joinField",67],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_product_id'",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","_tagRelTable",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'product_id'",67],",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'customer_id=entity_id'",67],")",";",["T_WHITESPACE","\n        ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getSelect",68],"(",")",["T_OBJECT_OPERATOR","->",68],["T_STRING","where",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","_getAttributeTableAlias",68],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_product_id'",68],")",["T_WHITESPACE"," ",68],".",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'.product_id=?'",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$productId",68],")",";",["T_WHITESPACE","\n        ",68],["T_RETURN","return",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],";",["T_WHITESPACE","\n    ",69],"}",["T_WHITESPACE","\n\n    ",70],["T_PUBLIC","public",72],["T_WHITESPACE"," ",72],["T_FUNCTION","function",72],["T_WHITESPACE"," ",72],["T_STRING","load",72],"(",["T_VARIABLE","$printQuery",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","false",72],",",["T_WHITESPACE"," ",72],["T_VARIABLE","$logQuery",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_STRING","false",72],")",["T_WHITESPACE","\n    ",72],"{",["T_WHITESPACE","\n        ",73],["T_STRING","parent",74],["T_DOUBLE_COLON","::",74],["T_STRING","load",74],"(",["T_VARIABLE","$printQuery",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$logQuery",74],")",";",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_loadTags",75],"(",["T_VARIABLE","$printQuery",75],",",["T_WHITESPACE"," ",75],["T_VARIABLE","$logQuery",75],")",";",["T_WHITESPACE","\n        ",75],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],";",["T_WHITESPACE","\n    ",76],"}",["T_WHITESPACE","\n\n    ",77],["T_PROTECTED","protected",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","_loadTags",79],"(",["T_VARIABLE","$printQuery",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_STRING","false",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$logQuery",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_STRING","false",79],")",["T_WHITESPACE","\n    ",79],"{",["T_WHITESPACE","\n        ",80],["T_IF","if",81],["T_WHITESPACE"," ",81],"(",["T_EMPTY","empty",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_items",81],")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$customerIds",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_ARRAY","array",84],"(",")",";",["T_WHITESPACE","\n        ",84],["T_FOREACH","foreach",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getItems",85],"(",")",["T_WHITESPACE"," ",85],["T_AS","as",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$item",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$customerIds",86],"[","]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$item",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getId",86],"(",")",";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getSelect",88],"(",")",["T_OBJECT_OPERATOR","->",88],["T_STRING","reset",88],"(",")",["T_WHITESPACE","\n            ",88],["T_OBJECT_OPERATOR","->",89],["T_STRING","from",89],"(",["T_ARRAY","array",89],"(",["T_CONSTANT_ENCAPSED_STRING","'tr'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_tagRelTable",89],")",",",["T_WHITESPACE"," ",89],["T_ARRAY","array",89],"(",["T_CONSTANT_ENCAPSED_STRING","'*'",89],",",["T_CONSTANT_ENCAPSED_STRING","'total_used'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'count(tr.tag_relation_id)'",89],")",")",["T_WHITESPACE","\n            ",89],["T_OBJECT_OPERATOR","->",90],["T_STRING","joinLeft",90],"(",["T_ARRAY","array",90],"(",["T_CONSTANT_ENCAPSED_STRING","'t'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_tagTable",90],")",",",["T_CONSTANT_ENCAPSED_STRING","'t.tag_id=tr.tag_id'",90],")",["T_WHITESPACE","\n            ",90],["T_OBJECT_OPERATOR","->",91],["T_STRING","group",91],"(",["T_ARRAY","array",91],"(",["T_CONSTANT_ENCAPSED_STRING","'tr.customer_id'",91],",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'t.tag_id'",91],")",")",["T_WHITESPACE","\n            ",91],["T_OBJECT_OPERATOR","->",92],["T_STRING","where",92],"(",["T_CONSTANT_ENCAPSED_STRING","'tr.customer_id in (?)'",92],",",["T_VARIABLE","$customerIds",92],")",["T_WHITESPACE","\n        ",92],";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","printLogQuery",94],"(",["T_VARIABLE","$printQuery",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$logQuery",94],")",";",["T_WHITESPACE","\n\n        ",94],["T_VARIABLE","$tags",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_ARRAY","array",96],"(",")",";",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$data",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","_read",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","fetchAll",97],"(",["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getSelect",97],"(",")",")",";",["T_WHITESPACE","\n        ",97],["T_FOREACH","foreach",98],["T_WHITESPACE"," ",98],"(",["T_VARIABLE","$data",98],["T_WHITESPACE"," ",98],["T_AS","as",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$row",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(","!",["T_ISSET","isset",99],"(",["T_VARIABLE","$tags",99],"[",["T_WHITESPACE"," ",99],["T_VARIABLE","$row",99],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",99],"]",["T_WHITESPACE"," ",99],"]",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n                ",99],["T_VARIABLE","$tags",100],"[",["T_WHITESPACE"," ",100],["T_VARIABLE","$row",100],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",100],"]",["T_WHITESPACE"," ",100],"]",["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_ARRAY","array",100],"(",")",";",["T_WHITESPACE","\n            ",100],"}",["T_WHITESPACE","\n            ",101],["T_VARIABLE","$tags",102],"[",["T_WHITESPACE"," ",102],["T_VARIABLE","$row",102],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",102],"]",["T_WHITESPACE"," ",102],"]","[","]",["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$row",102],";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n        ",103],["T_FOREACH","foreach",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","getItems",104],"(",")",["T_WHITESPACE"," ",104],["T_AS","as",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$item",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(",["T_ISSET","isset",105],"(",["T_VARIABLE","$tags",105],"[",["T_VARIABLE","$item",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","getId",105],"(",")","]",")",")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n                ",105],["T_VARIABLE","$item",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","setData",106],"(",["T_CONSTANT_ENCAPSED_STRING","'tags'",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$tags",106],"[",["T_VARIABLE","$item",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","getId",106],"(",")","]",")",";",["T_WHITESPACE","\n            ",106],"}",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n        ",108],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n",110],"}",["T_WHITESPACE","\n",112]]