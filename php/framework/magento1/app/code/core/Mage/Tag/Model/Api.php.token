[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Tag\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Product Tag API\n *\n * @category   Mage\n * @package    Mage_Tag\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Tag_Model_Api",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Catalog_Model_Api_Resource",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * Retrieve list of tags for specified product\n     *\n     * @param int $productId\n     * @param string|int $store\n     * @return array\n     *\/",36],["T_WHITESPACE","\n    ",42],["T_PUBLIC","public",43],["T_WHITESPACE"," ",43],["T_FUNCTION","function",43],["T_WHITESPACE"," ",43],["T_STRING","items",43],"(",["T_VARIABLE","$productId",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$store",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_STRING","null",43],")",["T_WHITESPACE","\n    ",43],"{",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$result",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],"(",")",";",["T_WHITESPACE","\n        ",45],["T_COMMENT","\/\/ fields list to return\n",46],["T_WHITESPACE","        ",47],["T_VARIABLE","$fieldsForResult",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_ARRAY","array",47],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_id'",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'name'",47],")",";",["T_WHITESPACE","\n\n        ",47],["T_DOC_COMMENT","\/** @var $product Mage_Catalog_Model_Product *\/",49],["T_WHITESPACE","\n        ",49],["T_VARIABLE","$product",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","Mage",50],["T_DOUBLE_COLON","::",50],["T_STRING","getModel",50],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",50],")",["T_OBJECT_OPERATOR","->",50],["T_STRING","load",50],"(",["T_VARIABLE","$productId",50],")",";",["T_WHITESPACE","\n        ",50],["T_IF","if",51],["T_WHITESPACE"," ",51],"(","!",["T_VARIABLE","$product",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","getId",51],"(",")",")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n            ",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","_fault",52],"(",["T_CONSTANT_ENCAPSED_STRING","'product_not_exists'",52],")",";",["T_WHITESPACE","\n        ",52],"}",["T_WHITESPACE","\n\n        ",53],["T_DOC_COMMENT","\/** @var $tags Mage_Tag_Model_Resource_Tag_Collection *\/",55],["T_WHITESPACE","\n        ",55],["T_VARIABLE","$tags",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","Mage",56],["T_DOUBLE_COLON","::",56],["T_STRING","getModel",56],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",56],")",["T_OBJECT_OPERATOR","->",56],["T_STRING","getCollection",56],"(",")",["T_OBJECT_OPERATOR","->",56],["T_STRING","joinRel",56],"(",")",["T_OBJECT_OPERATOR","->",56],["T_STRING","addProductFilter",56],"(",["T_VARIABLE","$productId",56],")",";",["T_WHITESPACE","\n        ",56],["T_IF","if",57],["T_WHITESPACE"," ",57],"(",["T_VARIABLE","$store",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n            ",57],["T_VARIABLE","$tags",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","addStoreFilter",58],"(",["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","_getStoreId",58],"(",["T_VARIABLE","$store",58],")",")",";",["T_WHITESPACE","\n        ",58],"}",["T_WHITESPACE","\n\n        ",59],["T_DOC_COMMENT","\/** @var $tag Mage_Tag_Model_Tag *\/",61],["T_WHITESPACE","\n        ",61],["T_FOREACH","foreach",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$tags",62],["T_WHITESPACE"," ",62],["T_AS","as",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$tag",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$result",63],"[",["T_VARIABLE","$tag",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","getId",63],"(",")","]",["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$tag",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","toArray",63],"(",["T_VARIABLE","$fieldsForResult",63],")",";",["T_WHITESPACE","\n        ",63],"}",["T_WHITESPACE","\n\n        ",64],["T_RETURN","return",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$result",66],";",["T_WHITESPACE","\n    ",66],"}",["T_WHITESPACE","\n\n    ",67],["T_DOC_COMMENT","\/**\n     * Retrieve tag info as array('name'-> .., 'status' => ..,\n     * 'base_popularity' => .., 'products' => array($productId => $popularity, ...))\n     *\n     * @param int $tagId\n     * @param string|int $store\n     * @return array\n     *\/",69],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","info",77],"(",["T_VARIABLE","$tagId",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$store",77],")",["T_WHITESPACE","\n    ",77],"{",["T_WHITESPACE","\n        ",78],["T_VARIABLE","$result",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_ARRAY","array",79],"(",")",";",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$storeId",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_getStoreId",80],"(",["T_VARIABLE","$store",80],")",";",["T_WHITESPACE","\n        ",80],["T_DOC_COMMENT","\/** @var $tag Mage_Tag_Model_Tag *\/",81],["T_WHITESPACE","\n        ",81],["T_VARIABLE","$tag",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING","Mage",82],["T_DOUBLE_COLON","::",82],["T_STRING","getModel",82],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","setStoreId",82],"(",["T_VARIABLE","$storeId",82],")",["T_OBJECT_OPERATOR","->",82],["T_STRING","setAddBasePopularity",82],"(",")",["T_OBJECT_OPERATOR","->",82],["T_STRING","load",82],"(",["T_VARIABLE","$tagId",82],")",";",["T_WHITESPACE","\n        ",82],["T_IF","if",83],["T_WHITESPACE"," ",83],"(","!",["T_VARIABLE","$tag",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getId",83],"(",")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","_fault",84],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_not_exists'",84],")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE","\n        ",85],["T_VARIABLE","$result",86],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",86],"]",["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$tag",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getStatus",86],"(",")",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$result",87],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",87],"]",["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$tag",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getName",87],"(",")",";",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$result",88],"[",["T_CONSTANT_ENCAPSED_STRING","'base_popularity'",88],"]",["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],"(",["T_STRING","is_numeric",88],"(",["T_VARIABLE","$tag",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getBasePopularity",88],"(",")",")",")",["T_WHITESPACE"," ",88],"?",["T_WHITESPACE"," ",88],["T_VARIABLE","$tag",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getBasePopularity",88],"(",")",["T_WHITESPACE"," ",88],":",["T_WHITESPACE"," ",88],["T_LNUMBER","0",88],";",["T_WHITESPACE","\n        ",88],["T_COMMENT","\/\/ retrieve array($productId => $popularity, ...)\n",89],["T_WHITESPACE","        ",90],["T_VARIABLE","$result",90],"[",["T_CONSTANT_ENCAPSED_STRING","'products'",90],"]",["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_ARRAY","array",90],"(",")",";",["T_WHITESPACE","\n        ",90],["T_VARIABLE","$relatedProductsCollection",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_VARIABLE","$tag",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getEntityCollection",91],"(",")",["T_OBJECT_OPERATOR","->",91],["T_STRING","addTagFilter",91],"(",["T_VARIABLE","$tagId",91],")",["T_WHITESPACE","\n            ",91],["T_OBJECT_OPERATOR","->",92],["T_STRING","addStoreFilter",92],"(",["T_VARIABLE","$storeId",92],")",["T_OBJECT_OPERATOR","->",92],["T_STRING","addPopularity",92],"(",["T_VARIABLE","$tagId",92],")",";",["T_WHITESPACE","\n        ",92],["T_FOREACH","foreach",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$relatedProductsCollection",93],["T_WHITESPACE"," ",93],["T_AS","as",93],["T_WHITESPACE"," ",93],["T_VARIABLE","$product",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$result",94],"[",["T_CONSTANT_ENCAPSED_STRING","'products'",94],"]","[",["T_VARIABLE","$product",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getId",94],"(",")","]",["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$product",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getPopularity",94],"(",")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n\n        ",95],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$result",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Add tag(s) to product.\n     * Return array of added\/updated tags as array($tagName => $tagId, ...)\n     *\n     * @param array $data\n     * @return array\n     *\/",100],["T_WHITESPACE","\n    ",106],["T_PUBLIC","public",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","add",107],"(",["T_VARIABLE","$data",107],")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$data",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_prepareDataForAdd",109],"(",["T_VARIABLE","$data",109],")",";",["T_WHITESPACE","\n        ",109],["T_DOC_COMMENT","\/** @var $product Mage_Catalog_Model_Product *\/",110],["T_WHITESPACE","\n        ",110],["T_VARIABLE","$product",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","Mage",111],["T_DOUBLE_COLON","::",111],["T_STRING","getModel",111],"(",["T_CONSTANT_ENCAPSED_STRING","'catalog\/product'",111],")",["T_OBJECT_OPERATOR","->",111],["T_STRING","load",111],"(",["T_VARIABLE","$data",111],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",111],"]",")",";",["T_WHITESPACE","\n        ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(","!",["T_VARIABLE","$product",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getId",112],"(",")",")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","_fault",113],"(",["T_CONSTANT_ENCAPSED_STRING","'product_not_exists'",113],")",";",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n        ",114],["T_DOC_COMMENT","\/** @var $customer Mage_Customer_Model_Customer *\/",115],["T_WHITESPACE","\n        ",115],["T_VARIABLE","$customer",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","Mage",116],["T_DOUBLE_COLON","::",116],["T_STRING","getModel",116],"(",["T_CONSTANT_ENCAPSED_STRING","'customer\/customer'",116],")",["T_OBJECT_OPERATOR","->",116],["T_STRING","load",116],"(",["T_VARIABLE","$data",116],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",116],"]",")",";",["T_WHITESPACE","\n        ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(","!",["T_VARIABLE","$customer",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getId",117],"(",")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_fault",118],"(",["T_CONSTANT_ENCAPSED_STRING","'customer_not_exists'",118],")",";",["T_WHITESPACE","\n        ",118],"}",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$storeId",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","_getStoreId",120],"(",["T_VARIABLE","$data",120],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",120],"]",")",";",["T_WHITESPACE","\n\n        ",120],["T_TRY","try",122],["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n            ",122],["T_DOC_COMMENT","\/** @var $tag Mage_Tag_Model_Tag *\/",123],["T_WHITESPACE","\n            ",123],["T_VARIABLE","$tag",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","Mage",124],["T_DOUBLE_COLON","::",124],["T_STRING","getModel",124],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",124],")",";",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$tagNamesArr",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","Mage",125],["T_DOUBLE_COLON","::",125],["T_STRING","helper",125],"(",["T_CONSTANT_ENCAPSED_STRING","'tag'",125],")",["T_OBJECT_OPERATOR","->",125],["T_STRING","cleanTags",125],"(",["T_STRING","Mage",125],["T_DOUBLE_COLON","::",125],["T_STRING","helper",125],"(",["T_CONSTANT_ENCAPSED_STRING","'tag'",125],")",["T_OBJECT_OPERATOR","->",125],["T_STRING","extractTags",125],"(",["T_VARIABLE","$data",125],"[",["T_CONSTANT_ENCAPSED_STRING","'tag'",125],"]",")",")",";",["T_WHITESPACE","\n            ",125],["T_FOREACH","foreach",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$tagNamesArr",126],["T_WHITESPACE"," ",126],["T_AS","as",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$tagName",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                ",126],["T_COMMENT","\/\/ unset previously added tag data\n",127],["T_WHITESPACE","                ",128],["T_VARIABLE","$tag",128],["T_OBJECT_OPERATOR","->",128],["T_STRING","unsetData",128],"(",")",";",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$tag",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","loadByName",129],"(",["T_VARIABLE","$tagName",129],")",";",["T_WHITESPACE","\n                ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(","!",["T_VARIABLE","$tag",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getId",130],"(",")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                    ",130],["T_VARIABLE","$tag",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","setName",131],"(",["T_VARIABLE","$tagName",131],")",["T_WHITESPACE","\n                        ",131],["T_OBJECT_OPERATOR","->",132],["T_STRING","setFirstCustomerId",132],"(",["T_VARIABLE","$customer",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","getId",132],"(",")",")",["T_WHITESPACE","\n                        ",132],["T_OBJECT_OPERATOR","->",133],["T_STRING","setFirstStoreId",133],"(",["T_VARIABLE","$storeId",133],")",["T_WHITESPACE","\n                        ",133],["T_OBJECT_OPERATOR","->",134],["T_STRING","setStatus",134],"(",["T_VARIABLE","$tag",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getPendingStatus",134],"(",")",")",["T_WHITESPACE","\n                        ",134],["T_OBJECT_OPERATOR","->",135],["T_STRING","save",135],"(",")",";",["T_WHITESPACE","\n                ",135],"}",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$tag",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","saveRelation",137],"(",["T_VARIABLE","$product",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getId",137],"(",")",",",["T_WHITESPACE"," ",137],["T_VARIABLE","$customer",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getId",137],"(",")",",",["T_WHITESPACE"," ",137],["T_VARIABLE","$storeId",137],")",";",["T_WHITESPACE","\n                ",137],["T_VARIABLE","$result",138],"[",["T_VARIABLE","$tagName",138],"]",["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$tag",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","getId",138],"(",")",";",["T_WHITESPACE","\n            ",138],"}",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE"," ",140],["T_CATCH","catch",140],["T_WHITESPACE"," ",140],"(",["T_STRING","Mage_Core_Exception",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$e",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","_fault",141],"(",["T_CONSTANT_ENCAPSED_STRING","'save_error'",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$e",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getMessage",141],"(",")",")",";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n\n        ",142],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$result",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * Change existing tag information\n     *\n     * @param int $tagId\n     * @param array $data\n     * @param string|int $store\n     * @return bool\n     *\/",147],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","update",155],"(",["T_VARIABLE","$tagId",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$data",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$store",155],")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_VARIABLE","$data",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","_prepareDataForUpdate",157],"(",["T_VARIABLE","$data",157],")",";",["T_WHITESPACE","\n        ",157],["T_VARIABLE","$storeId",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getStoreId",158],"(",["T_VARIABLE","$store",158],")",";",["T_WHITESPACE","\n        ",158],["T_DOC_COMMENT","\/** @var $tag Mage_Tag_Model_Tag *\/",159],["T_WHITESPACE","\n        ",159],["T_VARIABLE","$tag",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","Mage",160],["T_DOUBLE_COLON","::",160],["T_STRING","getModel",160],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",160],")",["T_OBJECT_OPERATOR","->",160],["T_STRING","setStoreId",160],"(",["T_VARIABLE","$storeId",160],")",["T_OBJECT_OPERATOR","->",160],["T_STRING","setAddBasePopularity",160],"(",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","load",160],"(",["T_VARIABLE","$tagId",160],")",";",["T_WHITESPACE","\n        ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(","!",["T_VARIABLE","$tag",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","getId",161],"(",")",")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","_fault",162],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_not_exists'",162],")",";",["T_WHITESPACE","\n        ",162],"}",["T_WHITESPACE","\n\n        ",163],["T_COMMENT","\/\/ store should be set for 'base_popularity' to be saved in Mage_Tag_Model_Resource_Tag::_afterSave()\n",165],["T_WHITESPACE","        ",166],["T_VARIABLE","$tag",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","setStore",166],"(",["T_VARIABLE","$storeId",166],")",";",["T_WHITESPACE","\n        ",166],["T_IF","if",167],["T_WHITESPACE"," ",167],"(",["T_ISSET","isset",167],"(",["T_VARIABLE","$data",167],"[",["T_CONSTANT_ENCAPSED_STRING","'base_popularity'",167],"]",")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n            ",167],["T_VARIABLE","$tag",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","setBasePopularity",168],"(",["T_VARIABLE","$data",168],"[",["T_CONSTANT_ENCAPSED_STRING","'base_popularity'",168],"]",")",";",["T_WHITESPACE","\n        ",168],"}",["T_WHITESPACE","\n        ",169],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_ISSET","isset",170],"(",["T_VARIABLE","$data",170],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",170],"]",")",")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$tag",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","setName",171],"(",["T_STRING","trim",171],"(",["T_VARIABLE","$data",171],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",171],"]",")",")",";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n        ",172],["T_IF","if",173],["T_WHITESPACE"," ",173],"(",["T_ISSET","isset",173],"(",["T_VARIABLE","$data",173],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",173],"]",")",")",["T_WHITESPACE"," ",173],"{",["T_WHITESPACE","\n            ",173],["T_COMMENT","\/\/ validate tag status\n",174],["T_WHITESPACE","            ",175],["T_IF","if",175],["T_WHITESPACE"," ",175],"(","!",["T_STRING","in_array",175],"(",["T_VARIABLE","$data",175],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",175],"]",",",["T_WHITESPACE"," ",175],["T_ARRAY","array",175],"(",["T_WHITESPACE","\n                ",175],["T_VARIABLE","$tag",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getApprovedStatus",176],"(",")",",",["T_WHITESPACE"," ",176],["T_VARIABLE","$tag",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getPendingStatus",176],"(",")",",",["T_WHITESPACE"," ",176],["T_VARIABLE","$tag",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","getDisabledStatus",176],"(",")",")",")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n                ",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_fault",177],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_data'",177],")",";",["T_WHITESPACE","\n            ",177],"}",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$tag",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","setStatus",179],"(",["T_VARIABLE","$data",179],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",179],"]",")",";",["T_WHITESPACE","\n        ",179],"}",["T_WHITESPACE","\n\n        ",180],["T_TRY","try",182],["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n            ",182],["T_VARIABLE","$tag",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","save",183],"(",")",";",["T_WHITESPACE","\n        ",183],"}",["T_WHITESPACE"," ",184],["T_CATCH","catch",184],["T_WHITESPACE"," ",184],"(",["T_STRING","Mage_Core_Exception",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$e",184],")",["T_WHITESPACE"," ",184],"{",["T_WHITESPACE","\n            ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","_fault",185],"(",["T_CONSTANT_ENCAPSED_STRING","'save_error'",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$e",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getMessage",185],"(",")",")",";",["T_WHITESPACE","\n        ",185],"}",["T_WHITESPACE","\n\n        ",186],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_STRING","true",188],";",["T_WHITESPACE","\n    ",188],"}",["T_WHITESPACE","\n\n    ",189],["T_DOC_COMMENT","\/**\n     * Remove existing tag\n     *\n     * @param int $tagId\n     * @return bool\n     *\/",191],["T_WHITESPACE","\n    ",196],["T_PUBLIC","public",197],["T_WHITESPACE"," ",197],["T_FUNCTION","function",197],["T_WHITESPACE"," ",197],["T_STRING","remove",197],"(",["T_VARIABLE","$tagId",197],")",["T_WHITESPACE","\n    ",197],"{",["T_WHITESPACE","\n        ",198],["T_DOC_COMMENT","\/** @var $tag Mage_Tag_Model_Tag *\/",199],["T_WHITESPACE","\n        ",199],["T_VARIABLE","$tag",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_STRING","Mage",200],["T_DOUBLE_COLON","::",200],["T_STRING","getModel",200],"(",["T_CONSTANT_ENCAPSED_STRING","'tag\/tag'",200],")",["T_OBJECT_OPERATOR","->",200],["T_STRING","load",200],"(",["T_VARIABLE","$tagId",200],")",";",["T_WHITESPACE","\n        ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(","!",["T_VARIABLE","$tag",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getId",201],"(",")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$this",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","_fault",202],"(",["T_CONSTANT_ENCAPSED_STRING","'tag_not_exists'",202],")",";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n        ",203],["T_TRY","try",204],["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n            ",204],["T_VARIABLE","$tag",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","delete",205],"(",")",";",["T_WHITESPACE","\n        ",205],"}",["T_WHITESPACE"," ",206],["T_CATCH","catch",206],["T_WHITESPACE"," ",206],"(",["T_STRING","Mage_Core_Exception",206],["T_WHITESPACE"," ",206],["T_VARIABLE","$e",206],")",["T_WHITESPACE"," ",206],"{",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_fault",207],"(",["T_CONSTANT_ENCAPSED_STRING","'remove_error'",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$e",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","getMessage",207],"(",")",")",";",["T_WHITESPACE","\n        ",207],"}",["T_WHITESPACE","\n\n        ",208],["T_RETURN","return",210],["T_WHITESPACE"," ",210],["T_STRING","true",210],";",["T_WHITESPACE","\n    ",210],"}",["T_WHITESPACE","\n\n    ",211],["T_DOC_COMMENT","\/**\n     * Check data before add\n     *\n     * @param array $data\n     * @return array\n     *\/",213],["T_WHITESPACE","\n    ",218],["T_PROTECTED","protected",219],["T_WHITESPACE"," ",219],["T_FUNCTION","function",219],["T_WHITESPACE"," ",219],["T_STRING","_prepareDataForAdd",219],"(",["T_VARIABLE","$data",219],")",["T_WHITESPACE","\n    ",219],"{",["T_WHITESPACE","\n        ",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(","!",["T_ISSET","isset",221],"(",["T_VARIABLE","$data",221],"[",["T_CONSTANT_ENCAPSED_STRING","'product_id'",221],"]",")",["T_WHITESPACE"," ",221],["T_LOGICAL_OR","or",221],["T_WHITESPACE"," ",221],"!",["T_ISSET","isset",221],"(",["T_VARIABLE","$data",221],"[",["T_CONSTANT_ENCAPSED_STRING","'tag'",221],"]",")",["T_WHITESPACE","\n            ",221],["T_LOGICAL_OR","or",222],["T_WHITESPACE"," ",222],"!",["T_ISSET","isset",222],"(",["T_VARIABLE","$data",222],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",222],"]",")",["T_WHITESPACE"," ",222],["T_LOGICAL_OR","or",222],["T_WHITESPACE"," ",222],"!",["T_ISSET","isset",222],"(",["T_VARIABLE","$data",222],"[",["T_CONSTANT_ENCAPSED_STRING","'store'",222],"]",")",")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","_fault",223],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_data'",223],")",";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE","\n\n        ",224],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$data",226],";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_DOC_COMMENT","\/**\n     * Check data before update\n     *\n     * @param $data\n     * @return\n     *\/",229],["T_WHITESPACE","\n    ",234],["T_PROTECTED","protected",235],["T_WHITESPACE"," ",235],["T_FUNCTION","function",235],["T_WHITESPACE"," ",235],["T_STRING","_prepareDataForUpdate",235],"(",["T_VARIABLE","$data",235],")",["T_WHITESPACE","\n    ",235],"{",["T_WHITESPACE","\n        ",236],["T_COMMENT","\/\/ $data should contain at least one field to change\n",237],["T_WHITESPACE","        ",238],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_WHITESPACE"," ",238],"!","(",["T_ISSET","isset",238],"(",["T_VARIABLE","$data",238],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",238],"]",")",["T_WHITESPACE"," ",238],["T_LOGICAL_OR","or",238],["T_WHITESPACE"," ",238],["T_ISSET","isset",238],"(",["T_VARIABLE","$data",238],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",238],"]",")",["T_WHITESPACE"," ",238],["T_LOGICAL_OR","or",238],["T_WHITESPACE"," ",238],["T_ISSET","isset",238],"(",["T_VARIABLE","$data",238],"[",["T_CONSTANT_ENCAPSED_STRING","'base_popularity'",238],"]",")",")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n            ",238],["T_VARIABLE","$this",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","_fault",239],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid_data'",239],")",";",["T_WHITESPACE","\n        ",239],"}",["T_WHITESPACE","\n\n        ",240],["T_RETURN","return",242],["T_WHITESPACE"," ",242],["T_VARIABLE","$data",242],";",["T_WHITESPACE","\n    ",242],"}",["T_WHITESPACE","\n",243],"}",["T_WHITESPACE","\n",244]]