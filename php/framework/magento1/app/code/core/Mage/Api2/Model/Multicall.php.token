[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Api2\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * API2 model for multiple internal calls to subresources of specified resource\n *\n * @category   Mage\n * @package    Mage_Api2\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Api2_Model_Multicall",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n\n    ",35],["T_DOC_COMMENT","\/**\n     * @var Mage_Api2_Model_Request\n     *\/",37],["T_WHITESPACE","\n    ",39],["T_PROTECTED","protected",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$_parentCallRequest",40],";",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * @var string\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_parentResourceId",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Multicall to subresources of specified resource\n     *\n     * @param string $parentResourceId\n     * @param string $parentResourceName\n     * @param Mage_Api2_Model_Request $parentCallRequest\n     * @return Mage_Api2_Model_Response\n     *\/",47],["T_WHITESPACE","\n    ",54],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","call",55],"(",["T_VARIABLE","$parentResourceId",55],",",["T_WHITESPACE"," ",55],["T_VARIABLE","$parentResourceName",55],",",["T_WHITESPACE"," ",55],["T_STRING","Mage_Api2_Model_Request",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$parentCallRequest",55],")",["T_WHITESPACE","\n    ",55],"{",["T_WHITESPACE","\n        ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","_parentResourceId",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$parentResourceId",57],";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","_parentCallRequest",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$parentCallRequest",58],";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$subresources",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","_getDeclaredSubresources",59],"(",["T_VARIABLE","$parentResourceName",59],")",";",["T_WHITESPACE","\n        ",59],["T_FOREACH","foreach",60],["T_WHITESPACE"," ",60],"(",["T_VARIABLE","$subresources",60],["T_WHITESPACE"," ",60],["T_AS","as",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$subresource",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n            ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","_callSubresource",61],"(",["T_VARIABLE","$subresource",61],")",";",["T_WHITESPACE","\n        ",61],"}",["T_WHITESPACE","\n\n        ",62],["T_RETURN","return",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","_getResponse",64],"(",")",";",["T_WHITESPACE","\n    ",64],"}",["T_WHITESPACE","\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Make call to specified subresource with data from request\n     *\n     * @param Mage_Core_Model_Config_Element $subresource\n     * @return Mage_Api2_Model_Multicall\n     *\/",67],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],["T_STRING","_callSubresource",73],"(",["T_VARIABLE","$subresource",73],")",["T_WHITESPACE","\n    ",73],"{",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$bodyParams",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","_getRequest",75],"(",")",["T_OBJECT_OPERATOR","->",75],["T_STRING","getBodyParams",75],"(",")",";",["T_WHITESPACE","\n        ",75],["T_COMMENT","\/\/ check if subresource data exists in request\n",76],["T_WHITESPACE","        ",77],["T_VARIABLE","$requestParamName",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING_CAST","(string)",77],["T_VARIABLE","$subresource",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","request_param_name",77],";",["T_WHITESPACE","\n        ",77],["T_IF","if",78],["T_WHITESPACE"," ",78],"(","!","(",["T_STRING","is_array",78],"(",["T_VARIABLE","$bodyParams",78],")",["T_WHITESPACE"," ",78],["T_BOOLEAN_AND","&&",78],["T_WHITESPACE"," ",78],["T_STRING","array_key_exists",78],"(",["T_VARIABLE","$requestParamName",78],",",["T_WHITESPACE"," ",78],["T_VARIABLE","$bodyParams",78],")",["T_WHITESPACE","\n            ",78],["T_BOOLEAN_AND","&&",79],["T_WHITESPACE"," ",79],["T_STRING","is_array",79],"(",["T_VARIABLE","$bodyParams",79],"[",["T_VARIABLE","$requestParamName",79],"]",")",")",["T_WHITESPACE","\n        ",79],")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n            ",80],["T_RETURN","return",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],";",["T_WHITESPACE","\n        ",81],"}",["T_WHITESPACE","\n        ",82],["T_COMMENT","\/\/ make internal call\n",83],["T_WHITESPACE","        ",84],["T_VARIABLE","$subresourceType",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_STRING_CAST","(string)",84],["T_VARIABLE","$subresource",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","type",84],";",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$requestData",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$bodyParams",85],"[",["T_VARIABLE","$requestParamName",85],"]",";",["T_WHITESPACE","\n        ",85],["T_SWITCH","switch",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$subresourceType",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n            ",86],["T_CASE","case",87],["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'collection'",87],":",["T_WHITESPACE","\n                ",87],["T_FOREACH","foreach",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$requestData",88],["T_WHITESPACE"," ",88],["T_AS","as",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$subresourceData",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","_internalCall",89],"(",["T_VARIABLE","$subresource",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$subresourceData",89],")",";",["T_WHITESPACE","\n                ",89],"}",["T_WHITESPACE","\n                ",90],["T_BREAK","break",91],";",["T_WHITESPACE","\n            ",91],["T_CASE","case",92],["T_WHITESPACE"," ",92],["T_CONSTANT_ENCAPSED_STRING","'instance'",92],":",["T_WHITESPACE","\n            ",92],["T_DEFAULT","default",93],":",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_internalCall",94],"(",["T_VARIABLE","$subresource",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$requestData",94],")",";",["T_WHITESPACE","\n                ",94],["T_BREAK","break",95],";",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n        ",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],";",["T_WHITESPACE","\n    ",97],"}",["T_WHITESPACE","\n\n    ",98],["T_DOC_COMMENT","\/**\n     * Make internal call to specified subresource on with specified data via API2 server\n     *\n     * @param Mage_Core_Model_Config_Element $subresource\n     * @param array $requestData\n     * @throws Mage_Api2_Exception\n     * @return Mage_Api2_Model_Multicall\n     *\/",100],["T_WHITESPACE","\n    ",107],["T_PROTECTED","protected",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","_internalCall",108],"(",["T_VARIABLE","$subresource",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$requestData",108],")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_TRY","try",110],["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(","!",["T_STRING","is_array",111],"(",["T_VARIABLE","$requestData",111],")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n                ",111],["T_THROW","throw",112],["T_WHITESPACE"," ",112],["T_NEW","new",112],["T_WHITESPACE"," ",112],["T_STRING","Mage_Api2_Exception",112],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid data format'",112],",",["T_WHITESPACE"," ",112],["T_STRING","Mage_Api2_Model_Server",112],["T_DOUBLE_COLON","::",112],["T_STRING","HTTP_BAD_REQUEST",112],")",";",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE","\n            ",113],["T_VARIABLE","$subresourceIdKey",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_STRING_CAST","(string)",114],["T_VARIABLE","$subresource",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","id_param_name",114],";",["T_WHITESPACE","\n            ",114],["T_DOC_COMMENT","\/** @var $server Mage_Api2_Model_Server *\/",115],["T_WHITESPACE","\n            ",115],["T_VARIABLE","$server",116],["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_STRING","Mage",116],["T_DOUBLE_COLON","::",116],["T_STRING","getSingleton",116],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/server'",116],")",";",["T_WHITESPACE","\n\n            ",116],["T_COMMENT","\/\/ create subresource item before linking it to main resource\n",118],["T_WHITESPACE","            ",119],["T_IF","if",119],["T_WHITESPACE"," ",119],"(","!",["T_STRING","array_key_exists",119],"(",["T_VARIABLE","$subresourceIdKey",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$requestData",119],")",")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n                ",119],["T_VARIABLE","$subresourceCreateResourceName",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING_CAST","(string)",120],["T_VARIABLE","$subresource",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","create_resource_name",120],";",["T_WHITESPACE","\n                ",120],["T_VARIABLE","$internalRequest",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_prepareRequest",121],"(",["T_VARIABLE","$subresourceCreateResourceName",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$requestData",121],")",";",["T_WHITESPACE","\n                ",121],["T_DOC_COMMENT","\/** @var $internalCreateResponse Mage_Api2_Model_Response *\/",122],["T_WHITESPACE","\n                ",122],["T_VARIABLE","$internalCreateResponse",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_STRING","Mage",123],["T_DOUBLE_COLON","::",123],["T_STRING","getModel",123],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/response'",123],")",";",["T_WHITESPACE","\n                ",123],["T_VARIABLE","$server",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","internalCall",124],"(",["T_VARIABLE","$internalRequest",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$internalCreateResponse",124],")",";",["T_WHITESPACE","\n                ",124],["T_VARIABLE","$createdSubresourceInstanceId",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","_getCreatedResourceId",125],"(",["T_VARIABLE","$internalCreateResponse",125],")",";",["T_WHITESPACE","\n                ",125],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_EMPTY","empty",126],"(",["T_VARIABLE","$createdSubresourceInstanceId",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n                    ",126],["T_THROW","throw",127],["T_WHITESPACE"," ",127],["T_NEW","new",127],["T_WHITESPACE"," ",127],["T_STRING","Mage_Api2_Exception",127],"(",["T_CONSTANT_ENCAPSED_STRING","'Error during subresource creation'",127],",",["T_WHITESPACE","\n                        ",127],["T_STRING","Mage_Api2_Model_Server",128],["T_DOUBLE_COLON","::",128],["T_STRING","HTTP_INTERNAL_ERROR",128],")",";",["T_WHITESPACE","\n                ",128],"}",["T_WHITESPACE","\n                ",129],["T_VARIABLE","$requestData",130],"[",["T_VARIABLE","$subresourceIdKey",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$createdSubresourceInstanceId",130],";",["T_WHITESPACE","\n            ",130],"}",["T_WHITESPACE","\n\n            ",131],["T_COMMENT","\/\/ link subresource to main resource\n",133],["T_WHITESPACE","            ",134],["T_VARIABLE","$subresourceName",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_STRING_CAST","(string)",134],["T_VARIABLE","$subresource",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","name",134],";",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$parentResourceIdFieldName",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING_CAST","(string)",135],["T_VARIABLE","$subresource",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","parent_resource_id_field_name",135],";",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$internalRequest",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","_prepareRequest",136],"(",["T_VARIABLE","$subresourceName",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$requestData",136],",",["T_WHITESPACE"," ",136],["T_VARIABLE","$parentResourceIdFieldName",136],")",";",["T_WHITESPACE","\n\n            ",136],["T_DOC_COMMENT","\/** @var $internalResponse Mage_Api2_Model_Response *\/",138],["T_WHITESPACE","\n            ",138],["T_VARIABLE","$internalResponse",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","Mage",139],["T_DOUBLE_COLON","::",139],["T_STRING","getModel",139],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/response'",139],")",";",["T_WHITESPACE","\n            ",139],["T_VARIABLE","$server",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","internalCall",140],"(",["T_VARIABLE","$internalRequest",140],",",["T_WHITESPACE"," ",140],["T_VARIABLE","$internalResponse",140],")",";",["T_WHITESPACE","\n        ",140],"}",["T_WHITESPACE"," ",141],["T_CATCH","catch",141],["T_WHITESPACE"," ",141],"(",["T_STRING","Exception",141],["T_WHITESPACE"," ",141],["T_VARIABLE","$e",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n            ",141],["T_COMMENT","\/\/ TODO: implement strict mode\n",142],["T_WHITESPACE","            ",143],["T_STRING","Mage",143],["T_DOUBLE_COLON","::",143],["T_STRING","logException",143],"(",["T_VARIABLE","$e",143],")",";",["T_WHITESPACE","\n            ",143],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_getResponse",144],"(",")",["T_OBJECT_OPERATOR","->",144],["T_STRING","setException",144],"(",["T_VARIABLE","$e",144],")",";",["T_WHITESPACE","\n            ",144],["T_COMMENT","\/\/ TODO: Refactor partial success idintification process\n",145],["T_WHITESPACE","            ",146],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","_getResponse",146],"(",")",["T_OBJECT_OPERATOR","->",146],["T_STRING","setHttpResponseCode",146],"(",["T_STRING","Mage_Api2_Model_Server",146],["T_DOUBLE_COLON","::",146],["T_STRING","HTTP_CREATED",146],")",";",["T_WHITESPACE","\n        ",146],"}",["T_WHITESPACE","\n\n        ",147],["T_IF","if",149],["T_WHITESPACE"," ",149],"(",["T_ISSET","isset",149],"(",["T_VARIABLE","$internalCreateResponse",149],")",")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","_aggregateResponse",150],"(",["T_VARIABLE","$internalCreateResponse",150],")",";",["T_WHITESPACE","\n        ",150],"}",["T_WHITESPACE","\n        ",151],["T_IF","if",152],["T_WHITESPACE"," ",152],"(",["T_ISSET","isset",152],"(",["T_VARIABLE","$internalResponse",152],")",")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n            ",152],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_aggregateResponse",153],"(",["T_VARIABLE","$internalResponse",153],")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n\n        ",154],["T_RETURN","return",156],["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],";",["T_WHITESPACE","\n    ",156],"}",["T_WHITESPACE","\n\n    ",157],["T_DOC_COMMENT","\/**\n     * Prepare internal request\n     *\n     * @param string $subresourceName\n     * @param array $data\n     * @param string|null $parentResourceIdFieldName\n     * @return Mage_Api2_Model_Request_Internal\n     *\/",159],["T_WHITESPACE","\n    ",166],["T_PROTECTED","protected",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","_prepareRequest",167],"(",["T_VARIABLE","$subresourceName",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$data",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$parentResourceIdFieldName",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_STRING","null",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_VARIABLE","$subresourceUri",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_createSubresourceUri",169],"(",["T_VARIABLE","$subresourceName",169],",",["T_WHITESPACE"," ",169],["T_VARIABLE","$parentResourceIdFieldName",169],")",";",["T_WHITESPACE","\n        ",169],["T_DOC_COMMENT","\/** @var $internalRequest Mage_Api2_Model_Request_Internal *\/",170],["T_WHITESPACE","\n        ",170],["T_VARIABLE","$internalRequest",171],["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_STRING","Mage",171],["T_DOUBLE_COLON","::",171],["T_STRING","getModel",171],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/request_internal'",171],")",";",["T_WHITESPACE","\n        ",171],["T_VARIABLE","$internalRequest",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","setRequestUri",172],"(",["T_VARIABLE","$subresourceUri",172],")",";",["T_WHITESPACE","\n        ",172],["T_VARIABLE","$internalRequest",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","setBodyParams",173],"(",["T_VARIABLE","$data",173],")",";",["T_WHITESPACE","\n        ",173],["T_VARIABLE","$internalRequest",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","setMethod",174],"(",["T_CONSTANT_ENCAPSED_STRING","'POST'",174],")",";",["T_WHITESPACE","\n        ",174],["T_RETURN","return",175],["T_WHITESPACE"," ",175],["T_VARIABLE","$internalRequest",175],";",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n\n    ",176],["T_DOC_COMMENT","\/**\n     * Generate subresource uri\n     *\n     * @param string $subresourceName\n     * @param string $parentResourceIdFieldName\n     * @return string\n     *\/",178],["T_WHITESPACE","\n    ",184],["T_PROTECTED","protected",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","_createSubresourceUri",185],"(",["T_VARIABLE","$subresourceName",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$parentResourceIdFieldName",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_STRING","null",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_DOC_COMMENT","\/** @var $apiTypeRoute Mage_Api2_Model_Route_ApiType *\/",187],["T_WHITESPACE","\n        ",187],["T_VARIABLE","$apiTypeRoute",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","Mage",188],["T_DOUBLE_COLON","::",188],["T_STRING","getModel",188],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/route_apiType'",188],")",";",["T_WHITESPACE","\n\n        ",188],["T_VARIABLE","$chain",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$apiTypeRoute",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","chain",190],"(",["T_WHITESPACE","\n            ",190],["T_NEW","new",191],["T_WHITESPACE"," ",191],["T_STRING","Zend_Controller_Router_Route",191],"(",["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","_getConfig",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","getMainRoute",191],"(",["T_VARIABLE","$subresourceName",191],")",")",["T_WHITESPACE","\n        ",191],")",";",["T_WHITESPACE","\n        ",192],["T_VARIABLE","$params",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_ARRAY","array",193],"(",")",";",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$params",194],"[",["T_CONSTANT_ENCAPSED_STRING","'api_type'",194],"]",["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_CONSTANT_ENCAPSED_STRING","'rest'",194],";",["T_WHITESPACE","\n        ",194],["T_IF","if",195],["T_WHITESPACE"," ",195],"(",["T_STRING","null",195],["T_WHITESPACE"," ",195],["T_IS_NOT_IDENTICAL","!==",195],["T_WHITESPACE"," ",195],["T_VARIABLE","$parentResourceIdFieldName",195],")",["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$params",196],"[",["T_VARIABLE","$parentResourceIdFieldName",196],"]",["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","_parentResourceId",196],";",["T_WHITESPACE","\n        ",196],"}",["T_WHITESPACE","\n        ",197],["T_VARIABLE","$uri",198],["T_WHITESPACE"," ",198],"=",["T_WHITESPACE"," ",198],["T_VARIABLE","$chain",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","assemble",198],"(",["T_VARIABLE","$params",198],")",";",["T_WHITESPACE","\n\n        ",198],["T_RETURN","return",200],["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'\/'",200],["T_WHITESPACE"," ",200],".",["T_WHITESPACE"," ",200],["T_VARIABLE","$uri",200],";",["T_WHITESPACE","\n    ",200],"}",["T_WHITESPACE","\n\n    ",201],["T_DOC_COMMENT","\/**\n     * Retrieve list of subresources declared in configuration\n     *\n     * @param string $parentResourceName\n     * @return array\n     *\/",203],["T_WHITESPACE","\n    ",208],["T_PROTECTED","protected",209],["T_WHITESPACE"," ",209],["T_FUNCTION","function",209],["T_WHITESPACE"," ",209],["T_STRING","_getDeclaredSubresources",209],"(",["T_VARIABLE","$parentResourceName",209],")",["T_WHITESPACE","\n    ",209],"{",["T_WHITESPACE","\n        ",210],["T_RETURN","return",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","_getConfig",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","getResourceSubresources",211],"(",["T_VARIABLE","$parentResourceName",211],")",";",["T_WHITESPACE","\n    ",211],"}",["T_WHITESPACE","\n\n    ",212],["T_DOC_COMMENT","\/**\n     * Retrieve API2 config\n     *\n     * @return Mage_Api2_Model_Config\n     *\/",214],["T_WHITESPACE","\n    ",218],["T_PROTECTED","protected",219],["T_WHITESPACE"," ",219],["T_FUNCTION","function",219],["T_WHITESPACE"," ",219],["T_STRING","_getConfig",219],"(",")",["T_WHITESPACE","\n    ",219],"{",["T_WHITESPACE","\n        ",220],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_STRING","Mage",221],["T_DOUBLE_COLON","::",221],["T_STRING","getSingleton",221],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/config'",221],")",";",["T_WHITESPACE","\n    ",221],"}",["T_WHITESPACE","\n\n    ",222],["T_DOC_COMMENT","\/**\n     * Retrieve global response\n     *\n     * @return Mage_Api2_Model_Response\n     *\/",224],["T_WHITESPACE","\n    ",228],["T_PROTECTED","protected",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","_getResponse",229],"(",")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_RETURN","return",231],["T_WHITESPACE"," ",231],["T_STRING","Mage",231],["T_DOUBLE_COLON","::",231],["T_STRING","getSingleton",231],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/response'",231],")",";",["T_WHITESPACE","\n    ",231],"}",["T_WHITESPACE","\n\n    ",232],["T_DOC_COMMENT","\/**\n     * Retrieve parent request\n     *\n     * @return Mage_Api2_Model_Request\n     *\/",234],["T_WHITESPACE","\n    ",238],["T_PROTECTED","protected",239],["T_WHITESPACE"," ",239],["T_FUNCTION","function",239],["T_WHITESPACE"," ",239],["T_STRING","_getRequest",239],"(",")",["T_WHITESPACE","\n    ",239],"{",["T_WHITESPACE","\n        ",240],["T_RETURN","return",241],["T_WHITESPACE"," ",241],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_parentCallRequest",241],";",["T_WHITESPACE","\n    ",241],"}",["T_WHITESPACE","\n\n    ",242],["T_DOC_COMMENT","\/**\n     * Add internal call response to global response\n     *\n     * @param Mage_Api2_Model_Response $response\n     *\/",244],["T_WHITESPACE","\n    ",248],["T_PROTECTED","protected",249],["T_WHITESPACE"," ",249],["T_FUNCTION","function",249],["T_WHITESPACE"," ",249],["T_STRING","_aggregateResponse",249],"(",["T_STRING","Mage_Api2_Model_Response",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$response",249],")",["T_WHITESPACE","\n    ",249],"{",["T_WHITESPACE","\n        ",250],["T_IF","if",251],["T_WHITESPACE"," ",251],"(",["T_VARIABLE","$response",251],["T_OBJECT_OPERATOR","->",251],["T_STRING","isException",251],"(",")",")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n            ",251],["T_VARIABLE","$errors",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$response",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getException",252],"(",")",";",["T_WHITESPACE","\n            ",252],["T_COMMENT","\/\/ @TODO: add subresource prefix to error messages\n",253],["T_WHITESPACE","            ",254],["T_FOREACH","foreach",254],["T_WHITESPACE"," ",254],"(",["T_VARIABLE","$errors",254],["T_WHITESPACE"," ",254],["T_AS","as",254],["T_WHITESPACE"," ",254],["T_VARIABLE","$error",254],")",["T_WHITESPACE"," ",254],"{",["T_WHITESPACE","\n                ",254],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","_getResponse",255],"(",")",["T_OBJECT_OPERATOR","->",255],["T_STRING","setException",255],"(",["T_VARIABLE","$error",255],")",";",["T_WHITESPACE","\n            ",255],"}",["T_WHITESPACE","\n        ",256],"}",["T_WHITESPACE","\n    ",257],"}",["T_WHITESPACE","\n\n    ",258],["T_DOC_COMMENT","\/**\n     * Retrieve created resource id from response\n     *\n     * @param Mage_Api2_Model_Response $response\n     * @return string|int\n     *\/",260],["T_WHITESPACE","\n    ",265],["T_PROTECTED","protected",266],["T_WHITESPACE"," ",266],["T_FUNCTION","function",266],["T_WHITESPACE"," ",266],["T_STRING","_getCreatedResourceId",266],"(",["T_VARIABLE","$response",266],")",["T_WHITESPACE","\n    ",266],"{",["T_WHITESPACE","\n        ",267],["T_VARIABLE","$resourceId",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_LNUMBER","0",268],";",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$headers",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$response",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","getHeaders",269],"(",")",";",["T_WHITESPACE","\n        ",269],["T_FOREACH","foreach",270],["T_WHITESPACE"," ",270],"(",["T_VARIABLE","$headers",270],["T_WHITESPACE"," ",270],["T_AS","as",270],["T_WHITESPACE"," ",270],["T_VARIABLE","$header",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n            ",270],["T_IF","if",271],["T_WHITESPACE"," ",271],"(",["T_VARIABLE","$header",271],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",271],"]",["T_WHITESPACE"," ",271],["T_IS_EQUAL","==",271],["T_WHITESPACE"," ",271],["T_CONSTANT_ENCAPSED_STRING","'Location'",271],")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n                ",271],["T_LIST","list",272],"(",["T_VARIABLE","$resourceId",272],")",["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_STRING","array_reverse",272],"(",["T_STRING","explode",272],"(",["T_CONSTANT_ENCAPSED_STRING","'\/'",272],",",["T_WHITESPACE"," ",272],["T_VARIABLE","$header",272],"[",["T_CONSTANT_ENCAPSED_STRING","'value'",272],"]",")",")",";",["T_WHITESPACE","\n                ",272],["T_BREAK","break",273],";",["T_WHITESPACE","\n            ",273],"}",["T_WHITESPACE","\n        ",274],"}",["T_WHITESPACE","\n        ",275],["T_RETURN","return",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$resourceId",276],";",["T_WHITESPACE","\n    ",276],"}",["T_WHITESPACE","\n",277],"}",["T_WHITESPACE","\n",278]]