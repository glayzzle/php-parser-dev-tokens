[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Api2\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * API User ACL model\n *\n * @category   Mage\n * @package    Mage_Api2\n * @author     Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Api2_Model_Acl",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Zend_Acl",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_DOC_COMMENT","\/**\n     * REST ACL roles collection\n     *\n     * @var Mage_Api2_Model_Resource_Acl_Global_Role_Collection\n     *\/",36],["T_WHITESPACE","\n    ",40],["T_PROTECTED","protected",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$_rolesCollection",41],";",["T_WHITESPACE","\n\n    ",41],["T_DOC_COMMENT","\/**\n     * API2 config model instance\n     *\n     * @var Mage_Api2_Model_Config\n     *\/",43],["T_WHITESPACE","\n    ",47],["T_PROTECTED","protected",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$_config",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * Resource type of request\n     *\n     * @var string\n     *\/",50],["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_resourceType",55],";",["T_WHITESPACE","\n\n    ",55],["T_DOC_COMMENT","\/**\n     * Operation of request\n     *\n     * @var string\n     *\/",57],["T_WHITESPACE","\n    ",61],["T_PROTECTED","protected",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$_operation",62],";",["T_WHITESPACE","\n\n    ",62],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param array $options\n     *\/",64],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","__construct",69],"(",["T_VARIABLE","$options",69],")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(","!",["T_ISSET","isset",71],"(",["T_VARIABLE","$options",71],"[",["T_CONSTANT_ENCAPSED_STRING","'resource_type'",71],"]",")",["T_WHITESPACE"," ",71],["T_BOOLEAN_OR","||",71],["T_WHITESPACE"," ",71],["T_EMPTY","empty",71],"(",["T_VARIABLE","$options",71],"[",["T_CONSTANT_ENCAPSED_STRING","'resource_type'",71],"]",")",")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_THROW","throw",72],["T_WHITESPACE"," ",72],["T_NEW","new",72],["T_WHITESPACE"," ",72],["T_STRING","Exception",72],"(",["T_CONSTANT_ENCAPSED_STRING","\"Passed parameter 'resource_type' is wrong.\"",72],")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n        ",73],["T_IF","if",74],["T_WHITESPACE"," ",74],"(","!",["T_ISSET","isset",74],"(",["T_VARIABLE","$options",74],"[",["T_CONSTANT_ENCAPSED_STRING","'operation'",74],"]",")",["T_WHITESPACE"," ",74],["T_BOOLEAN_OR","||",74],["T_WHITESPACE"," ",74],["T_EMPTY","empty",74],"(",["T_VARIABLE","$options",74],"[",["T_CONSTANT_ENCAPSED_STRING","'operation'",74],"]",")",")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_THROW","throw",75],["T_WHITESPACE"," ",75],["T_NEW","new",75],["T_WHITESPACE"," ",75],["T_STRING","Exception",75],"(",["T_CONSTANT_ENCAPSED_STRING","\"Passed parameter 'operation' is wrong.\"",75],")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","_resourceType",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$options",77],"[",["T_CONSTANT_ENCAPSED_STRING","'resource_type'",77],"]",";",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","_operation",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_VARIABLE","$options",78],"[",["T_CONSTANT_ENCAPSED_STRING","'operation'",78],"]",";",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","_setResources",80],"(",")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","_setRoles",81],"(",")",";",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","_setRules",82],"(",")",";",["T_WHITESPACE","\n    ",82],"}",["T_WHITESPACE","\n\n    ",83],["T_DOC_COMMENT","\/**\n     * Retrieve REST ACL roles collection\n     *\n     * @return Mage_Api2_Model_Resource_Acl_Global_Role_Collection\n     *\/",85],["T_WHITESPACE","\n    ",89],["T_PROTECTED","protected",90],["T_WHITESPACE"," ",90],["T_FUNCTION","function",90],["T_WHITESPACE"," ",90],["T_STRING","_getRolesCollection",90],"(",")",["T_WHITESPACE","\n    ",90],"{",["T_WHITESPACE","\n        ",91],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_STRING","null",92],["T_WHITESPACE"," ",92],["T_IS_IDENTICAL","===",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","_rolesCollection",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n            ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","_rolesCollection",93],["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_STRING","Mage",93],["T_DOUBLE_COLON","::",93],["T_STRING","getResourceModel",93],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/acl_global_role_collection'",93],")",";",["T_WHITESPACE","\n        ",93],"}",["T_WHITESPACE","\n        ",94],["T_RETURN","return",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","_rolesCollection",95],";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Retrieve API2 config model instance\n     *\n     * @return Mage_Api2_Model_Config\n     *\/",98],["T_WHITESPACE","\n    ",102],["T_PROTECTED","protected",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","_getConfig",103],"(",")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_IF","if",105],["T_WHITESPACE"," ",105],"(",["T_STRING","null",105],["T_WHITESPACE"," ",105],["T_IS_IDENTICAL","===",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","_config",105],")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n            ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_config",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_STRING","Mage",106],["T_DOUBLE_COLON","::",106],["T_STRING","getModel",106],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/config'",106],")",";",["T_WHITESPACE","\n        ",106],"}",["T_WHITESPACE","\n        ",107],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_VARIABLE","$this",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","_config",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Retrieve resources types and set into ACL\n     *\n     * @return Mage_Api2_Model_Acl\n     *\/",111],["T_WHITESPACE","\n    ",115],["T_PROTECTED","protected",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","_setResources",116],"(",")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_FOREACH","foreach",118],["T_WHITESPACE"," ",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_getConfig",118],"(",")",["T_OBJECT_OPERATOR","->",118],["T_STRING","getResourcesTypes",118],"(",")",["T_WHITESPACE"," ",118],["T_AS","as",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$type",118],")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","addResource",119],"(",["T_VARIABLE","$type",119],")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n        ",120],["T_RETURN","return",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],";",["T_WHITESPACE","\n    ",121],"}",["T_WHITESPACE","\n\n    ",122],["T_DOC_COMMENT","\/**\n     * Retrieve roles from DB and set into ACL\n     *\n     * @return Mage_Api2_Model_Acl\n     *\/",124],["T_WHITESPACE","\n    ",128],["T_PROTECTED","protected",129],["T_WHITESPACE"," ",129],["T_FUNCTION","function",129],["T_WHITESPACE"," ",129],["T_STRING","_setRoles",129],"(",")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_DOC_COMMENT","\/** @var $role Mage_Api2_Model_Acl_Global_Role *\/",131],["T_WHITESPACE","\n        ",131],["T_FOREACH","foreach",132],["T_WHITESPACE"," ",132],"(",["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","_getRolesCollection",132],"(",")",["T_WHITESPACE"," ",132],["T_AS","as",132],["T_WHITESPACE"," ",132],["T_VARIABLE","$role",132],")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","addRole",133],"(",["T_VARIABLE","$role",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","getId",133],"(",")",")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n        ",134],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],";",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Retrieve rules data from DB and inject it into ACL\n     *\n     * @return Mage_Api2_Model_Acl\n     *\/",138],["T_WHITESPACE","\n    ",142],["T_PROTECTED","protected",143],["T_WHITESPACE"," ",143],["T_FUNCTION","function",143],["T_WHITESPACE"," ",143],["T_STRING","_setRules",143],"(",")",["T_WHITESPACE","\n    ",143],"{",["T_WHITESPACE","\n        ",144],["T_DOC_COMMENT","\/** @var $rulesCollection Mage_Api2_Model_Resource_Acl_Global_Rule_Collection *\/",145],["T_WHITESPACE","\n        ",145],["T_VARIABLE","$rulesCollection",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","Mage",146],["T_DOUBLE_COLON","::",146],["T_STRING","getResourceModel",146],"(",["T_CONSTANT_ENCAPSED_STRING","'api2\/acl_global_rule_collection'",146],")",";",["T_WHITESPACE","\n\n        ",146],["T_DOC_COMMENT","\/** @var $rule Mage_Api2_Model_Acl_Global_Rule *\/",148],["T_WHITESPACE","\n        ",148],["T_FOREACH","foreach",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$rulesCollection",149],["T_WHITESPACE"," ",149],["T_AS","as",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$rule",149],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_STRING","Mage_Api2_Model_Acl_Global_Rule",150],["T_DOUBLE_COLON","::",150],["T_STRING","RESOURCE_ALL",150],["T_WHITESPACE"," ",150],["T_IS_IDENTICAL","===",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$rule",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","getResourceId",150],"(",")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(",["T_STRING","in_array",151],"(",["T_VARIABLE","$rule",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","getRoleId",151],"(",")",",",["T_WHITESPACE"," ",151],["T_STRING","Mage_Api2_Model_Acl_Global_Role",151],["T_DOUBLE_COLON","::",151],["T_STRING","getSystemRoles",151],"(",")",")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                    ",151],["T_DOC_COMMENT","\/** @var $role Mage_Api2_Model_Acl_Global_Role *\/",152],["T_WHITESPACE","\n                    ",152],["T_VARIABLE","$role",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","_getRolesCollection",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","getItemById",153],"(",["T_VARIABLE","$rule",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getRoleId",153],"(",")",")",";",["T_WHITESPACE","\n                    ",153],["T_VARIABLE","$privileges",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","_getConfig",154],"(",")",["T_OBJECT_OPERATOR","->",154],["T_STRING","getResourceUserPrivileges",154],"(",["T_WHITESPACE","\n                        ",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","_resourceType",155],",",["T_WHITESPACE","\n                        ",155],["T_VARIABLE","$role",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","getConfigNodeName",156],"(",")",["T_WHITESPACE","\n                    ",156],")",";",["T_WHITESPACE","\n\n                    ",157],["T_IF","if",159],["T_WHITESPACE"," ",159],"(","!",["T_STRING","array_key_exists",159],"(",["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","_operation",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$privileges",159],")",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                        ",159],["T_CONTINUE","continue",160],";",["T_WHITESPACE","\n                    ",160],"}",["T_WHITESPACE","\n                ",161],"}",["T_WHITESPACE","\n\n                ",162],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","allow",164],"(",["T_VARIABLE","$rule",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getRoleId",164],"(",")",")",";",["T_WHITESPACE","\n            ",164],"}",["T_WHITESPACE"," ",165],["T_ELSE","else",165],["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n                ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","allow",166],"(",["T_VARIABLE","$rule",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getRoleId",166],"(",")",",",["T_WHITESPACE"," ",166],["T_VARIABLE","$rule",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getResourceId",166],"(",")",",",["T_WHITESPACE"," ",166],["T_VARIABLE","$rule",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getPrivilege",166],"(",")",")",";",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n        ",167],"}",["T_WHITESPACE","\n        ",168],["T_RETURN","return",169],["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],";",["T_WHITESPACE","\n    ",169],"}",["T_WHITESPACE","\n\n    ",170],["T_DOC_COMMENT","\/**\n     * Adds a Role having an identifier unique to the registry\n     * OVERRIDE to allow numeric roles identifiers\n     *\n     * @param int $roleId Role identifier\n     * @param Zend_Acl_Role_Interface|string|array $parents\n     * @return Zend_Acl Provides a fluent interface\n     *\/",172],["T_WHITESPACE","\n    ",179],["T_PUBLIC","public",180],["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],["T_STRING","addRole",180],"(",["T_VARIABLE","$roleId",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$parents",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_STRING","null",180],")",["T_WHITESPACE","\n    ",180],"{",["T_WHITESPACE","\n        ",181],["T_IF","if",182],["T_WHITESPACE"," ",182],"(","!",["T_STRING","is_numeric",182],"(",["T_VARIABLE","$roleId",182],")",")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n            ",182],["T_THROW","throw",183],["T_WHITESPACE"," ",183],["T_NEW","new",183],["T_WHITESPACE"," ",183],["T_STRING","Exception",183],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid role identifier'",183],")",";",["T_WHITESPACE","\n        ",183],"}",["T_WHITESPACE","\n        ",184],["T_RETURN","return",185],["T_WHITESPACE"," ",185],["T_STRING","parent",185],["T_DOUBLE_COLON","::",185],["T_STRING","addRole",185],"(",["T_STRING_CAST","(string)",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$roleId",185],")",";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n",186],"}",["T_WHITESPACE","\n",187]]