[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Mage\n * @package     Mage_Cms\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n",25],["T_DOC_COMMENT","\/**\n * Wysiwyg Images model\n *\n * @category    Mage\n * @package     Mage_Cms\n * @author      Magento Core Team <core@magentocommerce.com>\n *\/",27],["T_WHITESPACE","\n",33],["T_CLASS","class",34],["T_WHITESPACE"," ",34],["T_STRING","Mage_Cms_Model_Wysiwyg_Images_Storage",34],["T_WHITESPACE"," ",34],["T_EXTENDS","extends",34],["T_WHITESPACE"," ",34],["T_STRING","Varien_Object",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_CONST","const",36],["T_WHITESPACE"," ",36],["T_STRING","DIRECTORY_NAME_REGEXP",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'\/^[a-z0-9\\-\\_]+$\/si'",36],";",["T_WHITESPACE","\n    ",36],["T_CONST","const",37],["T_WHITESPACE"," ",37],["T_STRING","THUMBS_DIRECTORY_NAME",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'.thumbs'",37],";",["T_WHITESPACE","\n    ",37],["T_CONST","const",38],["T_WHITESPACE"," ",38],["T_STRING","THUMB_PLACEHOLDER_PATH_SUFFIX",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'images\/placeholder\/thumbnail.jpg'",38],";",["T_WHITESPACE","\n\n    ",38],["T_DOC_COMMENT","\/**\n     * Config object\n     *\n     * @var Mage_Core_Model_Config_Element\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$_config",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Config object as array\n     *\n     * @var array\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$_configAsArray",52],";",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Return one-level child directories for specified path\n     *\n     * @param string $path Parent directory path\n     * @return Varien_Data_Collection_Filesystem\n     *\/",54],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","getDirsCollection",60],"(",["T_VARIABLE","$path",60],")",["T_WHITESPACE","\n    ",60],"{",["T_WHITESPACE","\n        ",61],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_STRING","Mage",62],["T_DOUBLE_COLON","::",62],["T_STRING","helper",62],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",62],")",["T_OBJECT_OPERATOR","->",62],["T_STRING","checkDbUsage",62],"(",")",")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n            ",62],["T_VARIABLE","$subDirectories",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","Mage",63],["T_DOUBLE_COLON","::",63],["T_STRING","getModel",63],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_directory_database'",63],")",["T_OBJECT_OPERATOR","->",63],["T_STRING","getSubdirectories",63],"(",["T_VARIABLE","$path",63],")",";",["T_WHITESPACE","\n            ",63],["T_FOREACH","foreach",64],["T_WHITESPACE"," ",64],"(",["T_VARIABLE","$subDirectories",64],["T_WHITESPACE"," ",64],["T_AS","as",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$directory",64],")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n                ",64],["T_VARIABLE","$fullPath",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","rtrim",65],"(",["T_VARIABLE","$path",65],",",["T_WHITESPACE"," ",65],["T_STRING","DS",65],")",["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_STRING","DS",65],["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_VARIABLE","$directory",65],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",65],"]",";",["T_WHITESPACE","\n                  ",65],["T_IF","if",66],["T_WHITESPACE"," ",66],"(","!",["T_STRING","file_exists",66],"(",["T_VARIABLE","$fullPath",66],")",")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n                    ",66],["T_STRING","mkdir",67],"(",["T_VARIABLE","$fullPath",67],",",["T_WHITESPACE"," ",67],["T_LNUMBER","0777",67],",",["T_WHITESPACE"," ",67],["T_STRING","true",67],")",";",["T_WHITESPACE","\n                ",67],"}",["T_WHITESPACE","\n            ",68],"}",["T_WHITESPACE","\n        ",69],"}",["T_WHITESPACE","\n\n        ",70],["T_VARIABLE","$conditions",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_ARRAY","array",72],"(",["T_CONSTANT_ENCAPSED_STRING","'reg_exp'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_ARRAY","array",72],"(",")",",",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'plain'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_ARRAY","array",72],"(",")",")",";",["T_WHITESPACE","\n\n        ",72],["T_FOREACH","foreach",74],["T_WHITESPACE"," ",74],"(",["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getConfig",74],"(",")",["T_OBJECT_OPERATOR","->",74],["T_STRING","dirs",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","exclude",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","children",74],"(",")",["T_WHITESPACE"," ",74],["T_AS","as",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$dir",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_VARIABLE","$conditions",75],"[",["T_VARIABLE","$dir",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","getAttribute",75],"(",["T_CONSTANT_ENCAPSED_STRING","'regexp'",75],")",["T_WHITESPACE"," ",75],"?",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'reg_exp'",75],["T_WHITESPACE"," ",75],":",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'plain'",75],"]","[",["T_STRING_CAST","(string)",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$dir",75],"]",["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","true",75],";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n        ",76],["T_COMMENT","\/\/ \"include\" section takes precedence and can revoke directory exclusion\n",77],["T_WHITESPACE","        ",78],["T_FOREACH","foreach",78],["T_WHITESPACE"," ",78],"(",["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","getConfig",78],"(",")",["T_OBJECT_OPERATOR","->",78],["T_STRING","dirs",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","include",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","children",78],"(",")",["T_WHITESPACE"," ",78],["T_AS","as",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$dir",78],")",["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_UNSET","unset",79],"(",["T_VARIABLE","$conditions",79],"[",["T_CONSTANT_ENCAPSED_STRING","'regexp'",79],"]","[",["T_STRING_CAST","(string)",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$dir",79],"]",",",["T_WHITESPACE"," ",79],["T_VARIABLE","$conditions",79],"[",["T_CONSTANT_ENCAPSED_STRING","'plain'",79],"]","[",["T_STRING_CAST","(string)",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$dir",79],"]",")",";",["T_WHITESPACE","\n        ",79],"}",["T_WHITESPACE","\n\n        ",80],["T_VARIABLE","$regExp",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$conditions",82],"[",["T_CONSTANT_ENCAPSED_STRING","'reg_exp'",82],"]",["T_WHITESPACE"," ",82],"?",["T_WHITESPACE"," ",82],"(",["T_CONSTANT_ENCAPSED_STRING","'~'",82],["T_WHITESPACE"," ",82],".",["T_WHITESPACE"," ",82],["T_STRING","implode",82],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",82],",",["T_WHITESPACE"," ",82],["T_STRING","array_keys",82],"(",["T_VARIABLE","$conditions",82],"[",["T_CONSTANT_ENCAPSED_STRING","'reg_exp'",82],"]",")",")",["T_WHITESPACE"," ",82],".",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'~i'",82],")",["T_WHITESPACE"," ",82],":",["T_WHITESPACE"," ",82],["T_STRING","null",82],";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$collection",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getCollection",83],"(",["T_VARIABLE","$path",83],")",["T_WHITESPACE","\n            ",83],["T_OBJECT_OPERATOR","->",84],["T_STRING","setCollectDirs",84],"(",["T_STRING","true",84],")",["T_WHITESPACE","\n            ",84],["T_OBJECT_OPERATOR","->",85],["T_STRING","setCollectFiles",85],"(",["T_STRING","false",85],")",["T_WHITESPACE","\n            ",85],["T_OBJECT_OPERATOR","->",86],["T_STRING","setCollectRecursively",86],"(",["T_STRING","false",86],")",";",["T_WHITESPACE","\n        ",86],["T_VARIABLE","$storageRootLength",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","strlen",87],"(",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","getHelper",87],"(",")",["T_OBJECT_OPERATOR","->",87],["T_STRING","getStorageRoot",87],"(",")",")",";",["T_WHITESPACE","\n\n        ",87],["T_FOREACH","foreach",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$collection",89],["T_WHITESPACE"," ",89],["T_AS","as",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$key",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$value",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$rootChildParts",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","explode",90],"(",["T_STRING","DIRECTORY_SEPARATOR",90],",",["T_WHITESPACE"," ",90],["T_STRING","substr",90],"(",["T_VARIABLE","$value",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getFilename",90],"(",")",",",["T_WHITESPACE"," ",90],["T_VARIABLE","$storageRootLength",90],")",")",";",["T_WHITESPACE","\n\n            ",90],["T_IF","if",92],["T_WHITESPACE"," ",92],"(",["T_STRING","array_key_exists",92],"(",["T_STRING","end",92],"(",["T_VARIABLE","$rootChildParts",92],")",",",["T_WHITESPACE"," ",92],["T_VARIABLE","$conditions",92],"[",["T_CONSTANT_ENCAPSED_STRING","'plain'",92],"]",")",["T_WHITESPACE","\n                ",92],["T_BOOLEAN_OR","||",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$regExp",93],["T_WHITESPACE"," ",93],["T_BOOLEAN_AND","&&",93],["T_WHITESPACE"," ",93],["T_STRING","preg_match",93],"(",["T_VARIABLE","$regExp",93],",",["T_WHITESPACE"," ",93],["T_VARIABLE","$value",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getFilename",93],"(",")",")",")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n                ",93],["T_VARIABLE","$collection",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","removeItemByKey",94],"(",["T_VARIABLE","$key",94],")",";",["T_WHITESPACE","\n            ",94],"}",["T_WHITESPACE","\n        ",95],"}",["T_WHITESPACE","\n\n        ",96],["T_RETURN","return",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$collection",98],";",["T_WHITESPACE","\n    ",98],"}",["T_WHITESPACE","\n\n    ",99],["T_DOC_COMMENT","\/**\n     * Return files\n     *\n     * @param string $path Parent directory path\n     * @param string $type Type of storage, e.g. image, media etc.\n     * @return Varien_Data_Collection_Filesystem\n     *\/",101],["T_WHITESPACE","\n    ",107],["T_PUBLIC","public",108],["T_WHITESPACE"," ",108],["T_FUNCTION","function",108],["T_WHITESPACE"," ",108],["T_STRING","getFilesCollection",108],"(",["T_VARIABLE","$path",108],",",["T_WHITESPACE"," ",108],["T_VARIABLE","$type",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_STRING","null",108],")",["T_WHITESPACE","\n    ",108],"{",["T_WHITESPACE","\n        ",109],["T_IF","if",110],["T_WHITESPACE"," ",110],"(",["T_STRING","Mage",110],["T_DOUBLE_COLON","::",110],["T_STRING","helper",110],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",110],")",["T_OBJECT_OPERATOR","->",110],["T_STRING","checkDbUsage",110],"(",")",")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$files",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","Mage",111],["T_DOUBLE_COLON","::",111],["T_STRING","getModel",111],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",111],")",["T_OBJECT_OPERATOR","->",111],["T_STRING","getDirectoryFiles",111],"(",["T_VARIABLE","$path",111],")",";",["T_WHITESPACE","\n\n            ",111],["T_VARIABLE","$fileStorageModel",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_STRING","Mage",113],["T_DOUBLE_COLON","::",113],["T_STRING","getModel",113],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_file'",113],")",";",["T_WHITESPACE","\n            ",113],["T_FOREACH","foreach",114],["T_WHITESPACE"," ",114],"(",["T_VARIABLE","$files",114],["T_WHITESPACE"," ",114],["T_AS","as",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$file",114],")",["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n                ",114],["T_VARIABLE","$fileStorageModel",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","saveFile",115],"(",["T_VARIABLE","$file",115],")",";",["T_WHITESPACE","\n            ",115],"}",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n\n        ",117],["T_VARIABLE","$collection",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getCollection",119],"(",["T_VARIABLE","$path",119],")",["T_WHITESPACE","\n            ",119],["T_OBJECT_OPERATOR","->",120],["T_STRING","setCollectDirs",120],"(",["T_STRING","false",120],")",["T_WHITESPACE","\n            ",120],["T_OBJECT_OPERATOR","->",121],["T_STRING","setCollectFiles",121],"(",["T_STRING","true",121],")",["T_WHITESPACE","\n            ",121],["T_OBJECT_OPERATOR","->",122],["T_STRING","setCollectRecursively",122],"(",["T_STRING","false",122],")",["T_WHITESPACE","\n            ",122],["T_OBJECT_OPERATOR","->",123],["T_STRING","setOrder",123],"(",["T_CONSTANT_ENCAPSED_STRING","'mtime'",123],",",["T_WHITESPACE"," ",123],["T_STRING","Varien_Data_Collection",123],["T_DOUBLE_COLON","::",123],["T_STRING","SORT_ORDER_ASC",123],")",";",["T_WHITESPACE","\n\n        ",123],["T_COMMENT","\/\/ Add files extension filter\n",125],["T_WHITESPACE","        ",126],["T_IF","if",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$allowed",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getAllowedExtensions",126],"(",["T_VARIABLE","$type",126],")",")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$collection",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","setFilesFilter",127],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\\.('",127],["T_WHITESPACE"," ",127],".",["T_WHITESPACE"," ",127],["T_STRING","implode",127],"(",["T_CONSTANT_ENCAPSED_STRING","'|'",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$allowed",127],")",".",["T_WHITESPACE"," ",127],["T_CONSTANT_ENCAPSED_STRING","')$\/i'",127],")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE","\n\n        ",128],["T_VARIABLE","$helper",130],["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$this",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","getHelper",130],"(",")",";",["T_WHITESPACE","\n\n        ",130],["T_COMMENT","\/\/ prepare items\n",132],["T_WHITESPACE","        ",133],["T_FOREACH","foreach",133],["T_WHITESPACE"," ",133],"(",["T_VARIABLE","$collection",133],["T_WHITESPACE"," ",133],["T_AS","as",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$item",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$item",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","setId",134],"(",["T_VARIABLE","$helper",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","idEncode",134],"(",["T_VARIABLE","$item",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","getBasename",134],"(",")",")",")",";",["T_WHITESPACE","\n            ",134],["T_VARIABLE","$item",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","setName",135],"(",["T_VARIABLE","$item",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","getBasename",135],"(",")",")",";",["T_WHITESPACE","\n            ",135],["T_VARIABLE","$item",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","setShortName",136],"(",["T_VARIABLE","$helper",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getShortFilename",136],"(",["T_VARIABLE","$item",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","getBasename",136],"(",")",")",")",";",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$item",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","setUrl",137],"(",["T_VARIABLE","$helper",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getCurrentUrl",137],"(",")",["T_WHITESPACE"," ",137],".",["T_WHITESPACE"," ",137],["T_VARIABLE","$item",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getBasename",137],"(",")",")",";",["T_WHITESPACE","\n\n            ",137],["T_IF","if",139],["T_WHITESPACE"," ",139],"(",["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","isImage",139],"(",["T_VARIABLE","$item",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","getBasename",139],"(",")",")",")",["T_WHITESPACE"," ",139],"{",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$thumbUrl",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getThumbnailUrl",140],"(",["T_VARIABLE","$item",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getFilename",140],"(",")",",",["T_WHITESPACE"," ",140],["T_STRING","true",140],")",";",["T_WHITESPACE","\n                ",140],["T_COMMENT","\/\/ generate thumbnail \"on the fly\" if it does not exists\n",141],["T_WHITESPACE","                ",142],["T_IF","if",142],"(","!",["T_WHITESPACE"," ",142],["T_VARIABLE","$thumbUrl",142],")",["T_WHITESPACE"," ",142],"{",["T_WHITESPACE","\n                    ",142],["T_VARIABLE","$thumbUrl",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_STRING","Mage",143],["T_DOUBLE_COLON","::",143],["T_STRING","getSingleton",143],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/url'",143],")",["T_OBJECT_OPERATOR","->",143],["T_STRING","getUrl",143],"(",["T_CONSTANT_ENCAPSED_STRING","'*\/*\/thumbnail'",143],",",["T_WHITESPACE"," ",143],["T_ARRAY","array",143],"(",["T_CONSTANT_ENCAPSED_STRING","'file'",143],["T_WHITESPACE"," ",143],["T_DOUBLE_ARROW","=>",143],["T_WHITESPACE"," ",143],["T_VARIABLE","$item",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getId",143],"(",")",")",")",";",["T_WHITESPACE","\n                ",143],"}",["T_WHITESPACE","\n\n                ",144],["T_VARIABLE","$size",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],"@",["T_STRING","getimagesize",146],"(",["T_VARIABLE","$item",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getFilename",146],"(",")",")",";",["T_WHITESPACE","\n\n                ",146],["T_IF","if",148],["T_WHITESPACE"," ",148],"(",["T_STRING","is_array",148],"(",["T_VARIABLE","$size",148],")",")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n                    ",148],["T_VARIABLE","$item",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","setWidth",149],"(",["T_VARIABLE","$size",149],"[",["T_LNUMBER","0",149],"]",")",";",["T_WHITESPACE","\n                    ",149],["T_VARIABLE","$item",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","setHeight",150],"(",["T_VARIABLE","$size",150],"[",["T_LNUMBER","1",150],"]",")",";",["T_WHITESPACE","\n                ",150],"}",["T_WHITESPACE","\n            ",151],"}",["T_WHITESPACE"," ",152],["T_ELSE","else",152],["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n                ",152],["T_VARIABLE","$thumbUrl",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_STRING","Mage",153],["T_DOUBLE_COLON","::",153],["T_STRING","getDesign",153],"(",")",["T_OBJECT_OPERATOR","->",153],["T_STRING","getSkinBaseUrl",153],"(",")",["T_WHITESPACE"," ",153],".",["T_WHITESPACE"," ",153],["T_STRING","self",153],["T_DOUBLE_COLON","::",153],["T_STRING","THUMB_PLACEHOLDER_PATH_SUFFIX",153],";",["T_WHITESPACE","\n            ",153],"}",["T_WHITESPACE","\n\n            ",154],["T_VARIABLE","$item",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","setThumbUrl",156],"(",["T_VARIABLE","$thumbUrl",156],")",";",["T_WHITESPACE","\n        ",156],"}",["T_WHITESPACE","\n\n        ",157],["T_RETURN","return",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$collection",159],";",["T_WHITESPACE","\n    ",159],"}",["T_WHITESPACE","\n\n    ",160],["T_DOC_COMMENT","\/**\n     * Storage collection\n     *\n     * @param string $path Path to the directory\n     * @return Varien_Data_Collection_Filesystem\n     *\/",162],["T_WHITESPACE","\n    ",167],["T_PUBLIC","public",168],["T_WHITESPACE"," ",168],["T_FUNCTION","function",168],["T_WHITESPACE"," ",168],["T_STRING","getCollection",168],"(",["T_VARIABLE","$path",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_STRING","null",168],")",["T_WHITESPACE","\n    ",168],"{",["T_WHITESPACE","\n        ",169],["T_VARIABLE","$collection",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_STRING","Mage",170],["T_DOUBLE_COLON","::",170],["T_STRING","getModel",170],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images_storage_collection'",170],")",";",["T_WHITESPACE","\n        ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_VARIABLE","$path",171],["T_WHITESPACE"," ",171],["T_IS_NOT_IDENTICAL","!==",171],["T_WHITESPACE"," ",171],["T_STRING","null",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$collection",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","addTargetDir",172],"(",["T_VARIABLE","$path",172],")",";",["T_WHITESPACE","\n        ",172],"}",["T_WHITESPACE","\n        ",173],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$collection",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Create new directory in storage\n     *\n     * @param string $name New directory name\n     * @param string $path Parent directory path\n     * @throws Mage_Core_Exception\n     * @return array New directory info\n     *\/",177],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","createDirectory",185],"(",["T_VARIABLE","$name",185],",",["T_WHITESPACE"," ",185],["T_VARIABLE","$path",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(","!",["T_STRING","preg_match",187],"(",["T_STRING","self",187],["T_DOUBLE_COLON","::",187],["T_STRING","DIRECTORY_NAME_REGEXP",187],",",["T_WHITESPACE"," ",187],["T_VARIABLE","$name",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_STRING","Mage",188],["T_DOUBLE_COLON","::",188],["T_STRING","throwException",188],"(",["T_STRING","Mage",188],["T_DOUBLE_COLON","::",188],["T_STRING","helper",188],"(",["T_CONSTANT_ENCAPSED_STRING","'cms'",188],")",["T_OBJECT_OPERATOR","->",188],["T_STRING","__",188],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid folder name. Please, use alphanumeric characters, underscores and dashes.'",188],")",")",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE","\n        ",189],["T_IF","if",190],["T_WHITESPACE"," ",190],"(","!",["T_STRING","is_dir",190],"(",["T_VARIABLE","$path",190],")",["T_WHITESPACE"," ",190],["T_BOOLEAN_OR","||",190],["T_WHITESPACE"," ",190],"!",["T_STRING","is_writable",190],"(",["T_VARIABLE","$path",190],")",")",["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n            ",190],["T_VARIABLE","$path",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getHelper",191],"(",")",["T_OBJECT_OPERATOR","->",191],["T_STRING","getStorageRoot",191],"(",")",";",["T_WHITESPACE","\n        ",191],"}",["T_WHITESPACE","\n\n        ",192],["T_VARIABLE","$newPath",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$path",194],["T_WHITESPACE"," ",194],".",["T_WHITESPACE"," ",194],["T_STRING","DS",194],["T_WHITESPACE"," ",194],".",["T_WHITESPACE"," ",194],["T_VARIABLE","$name",194],";",["T_WHITESPACE","\n\n        ",194],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_STRING","file_exists",196],"(",["T_VARIABLE","$newPath",196],")",")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_STRING","Mage",197],["T_DOUBLE_COLON","::",197],["T_STRING","throwException",197],"(",["T_STRING","Mage",197],["T_DOUBLE_COLON","::",197],["T_STRING","helper",197],"(",["T_CONSTANT_ENCAPSED_STRING","'cms'",197],")",["T_OBJECT_OPERATOR","->",197],["T_STRING","__",197],"(",["T_CONSTANT_ENCAPSED_STRING","'A directory with the same name already exists. Please try another folder name.'",197],")",")",";",["T_WHITESPACE","\n        ",197],"}",["T_WHITESPACE","\n\n        ",198],["T_VARIABLE","$io",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_NEW","new",200],["T_WHITESPACE"," ",200],["T_STRING","Varien_Io_File",200],"(",")",";",["T_WHITESPACE","\n        ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_VARIABLE","$io",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","mkdir",201],"(",["T_VARIABLE","$newPath",201],")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_IF","if",202],["T_WHITESPACE"," ",202],"(",["T_STRING","Mage",202],["T_DOUBLE_COLON","::",202],["T_STRING","helper",202],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",202],")",["T_OBJECT_OPERATOR","->",202],["T_STRING","checkDbUsage",202],"(",")",")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n                ",202],["T_VARIABLE","$relativePath",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_STRING","Mage",203],["T_DOUBLE_COLON","::",203],["T_STRING","helper",203],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",203],")",["T_OBJECT_OPERATOR","->",203],["T_STRING","getMediaRelativePath",203],"(",["T_VARIABLE","$newPath",203],")",";",["T_WHITESPACE","\n                ",203],["T_STRING","Mage",204],["T_DOUBLE_COLON","::",204],["T_STRING","getModel",204],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_directory_database'",204],")",["T_OBJECT_OPERATOR","->",204],["T_STRING","createRecursive",204],"(",["T_VARIABLE","$relativePath",204],")",";",["T_WHITESPACE","\n            ",204],"}",["T_WHITESPACE","\n\n            ",205],["T_VARIABLE","$result",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_ARRAY","array",207],"(",["T_WHITESPACE","\n                ",207],["T_CONSTANT_ENCAPSED_STRING","'name'",208],["T_WHITESPACE","          ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$name",208],",",["T_WHITESPACE","\n                ",208],["T_CONSTANT_ENCAPSED_STRING","'short_name'",209],["T_WHITESPACE","    ",209],["T_DOUBLE_ARROW","=>",209],["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","getHelper",209],"(",")",["T_OBJECT_OPERATOR","->",209],["T_STRING","getShortFilename",209],"(",["T_VARIABLE","$name",209],")",",",["T_WHITESPACE","\n                ",209],["T_CONSTANT_ENCAPSED_STRING","'path'",210],["T_WHITESPACE","          ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_VARIABLE","$newPath",210],",",["T_WHITESPACE","\n                ",210],["T_CONSTANT_ENCAPSED_STRING","'id'",211],["T_WHITESPACE","            ",211],["T_DOUBLE_ARROW","=>",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","getHelper",211],"(",")",["T_OBJECT_OPERATOR","->",211],["T_STRING","convertPathToId",211],"(",["T_VARIABLE","$newPath",211],")",["T_WHITESPACE","\n            ",211],")",";",["T_WHITESPACE","\n            ",212],["T_RETURN","return",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$result",213],";",["T_WHITESPACE","\n        ",213],"}",["T_WHITESPACE","\n        ",214],["T_STRING","Mage",215],["T_DOUBLE_COLON","::",215],["T_STRING","throwException",215],"(",["T_STRING","Mage",215],["T_DOUBLE_COLON","::",215],["T_STRING","helper",215],"(",["T_CONSTANT_ENCAPSED_STRING","'cms'",215],")",["T_OBJECT_OPERATOR","->",215],["T_STRING","__",215],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot create new directory.'",215],")",")",";",["T_WHITESPACE","\n    ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Recursively delete directory from storage\n     *\n     * @param string $path Target dir\n     * @return void\n     *\/",218],["T_WHITESPACE","\n    ",223],["T_PUBLIC","public",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","deleteDirectory",224],"(",["T_VARIABLE","$path",224],")",["T_WHITESPACE","\n    ",224],"{",["T_WHITESPACE","\n        ",225],["T_COMMENT","\/\/ prevent accidental root directory deleting\n",226],["T_WHITESPACE","        ",227],["T_VARIABLE","$rootCmp",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_STRING","rtrim",227],"(",["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","getHelper",227],"(",")",["T_OBJECT_OPERATOR","->",227],["T_STRING","getStorageRoot",227],"(",")",",",["T_WHITESPACE"," ",227],["T_STRING","DS",227],")",";",["T_WHITESPACE","\n        ",227],["T_VARIABLE","$pathCmp",228],["T_WHITESPACE"," ",228],"=",["T_WHITESPACE"," ",228],["T_STRING","rtrim",228],"(",["T_VARIABLE","$path",228],",",["T_WHITESPACE"," ",228],["T_STRING","DS",228],")",";",["T_WHITESPACE","\n\n        ",228],["T_VARIABLE","$io",230],["T_WHITESPACE"," ",230],"=",["T_WHITESPACE"," ",230],["T_NEW","new",230],["T_WHITESPACE"," ",230],["T_STRING","Varien_Io_File",230],"(",")",";",["T_WHITESPACE","\n\n        ",230],["T_IF","if",232],["T_WHITESPACE"," ",232],"(",["T_VARIABLE","$rootCmp",232],["T_WHITESPACE"," ",232],["T_IS_EQUAL","==",232],["T_WHITESPACE"," ",232],["T_VARIABLE","$pathCmp",232],")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n            ",232],["T_STRING","Mage",233],["T_DOUBLE_COLON","::",233],["T_STRING","throwException",233],"(",["T_STRING","Mage",233],["T_DOUBLE_COLON","::",233],["T_STRING","helper",233],"(",["T_CONSTANT_ENCAPSED_STRING","'cms'",233],")",["T_OBJECT_OPERATOR","->",233],["T_STRING","__",233],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot delete root directory %s.'",233],",",["T_WHITESPACE","\n                ",233],["T_VARIABLE","$io",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","getFilteredPath",234],"(",["T_VARIABLE","$path",234],")",")",")",";",["T_WHITESPACE","\n        ",234],"}",["T_WHITESPACE","\n\n        ",235],["T_IF","if",237],["T_WHITESPACE"," ",237],"(",["T_STRING","Mage",237],["T_DOUBLE_COLON","::",237],["T_STRING","helper",237],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",237],")",["T_OBJECT_OPERATOR","->",237],["T_STRING","checkDbUsage",237],"(",")",")",["T_WHITESPACE"," ",237],"{",["T_WHITESPACE","\n            ",237],["T_STRING","Mage",238],["T_DOUBLE_COLON","::",238],["T_STRING","getModel",238],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_directory_database'",238],")",["T_OBJECT_OPERATOR","->",238],["T_STRING","deleteDirectory",238],"(",["T_VARIABLE","$path",238],")",";",["T_WHITESPACE","\n        ",238],"}",["T_WHITESPACE","\n        ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(","!",["T_VARIABLE","$io",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","rmdir",240],"(",["T_VARIABLE","$path",240],",",["T_WHITESPACE"," ",240],["T_STRING","true",240],")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_STRING","Mage",241],["T_DOUBLE_COLON","::",241],["T_STRING","throwException",241],"(",["T_STRING","Mage",241],["T_DOUBLE_COLON","::",241],["T_STRING","helper",241],"(",["T_CONSTANT_ENCAPSED_STRING","'cms'",241],")",["T_OBJECT_OPERATOR","->",241],["T_STRING","__",241],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot delete directory %s.'",241],",",["T_WHITESPACE"," ",241],["T_VARIABLE","$io",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","getFilteredPath",241],"(",["T_VARIABLE","$path",241],")",")",")",";",["T_WHITESPACE","\n        ",241],"}",["T_WHITESPACE","\n\n        ",242],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_STRING","strpos",244],"(",["T_VARIABLE","$pathCmp",244],",",["T_WHITESPACE"," ",244],["T_VARIABLE","$rootCmp",244],")",["T_WHITESPACE"," ",244],["T_IS_IDENTICAL","===",244],["T_WHITESPACE"," ",244],["T_LNUMBER","0",244],")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n            ",244],["T_VARIABLE","$io",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","rmdir",245],"(",["T_VARIABLE","$this",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","getThumbnailRoot",245],"(",")",["T_WHITESPACE"," ",245],".",["T_WHITESPACE"," ",245],["T_STRING","DS",245],["T_WHITESPACE"," ",245],".",["T_WHITESPACE"," ",245],["T_STRING","ltrim",245],"(",["T_STRING","substr",245],"(",["T_VARIABLE","$pathCmp",245],",",["T_WHITESPACE"," ",245],["T_STRING","strlen",245],"(",["T_VARIABLE","$rootCmp",245],")",")",",",["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'\\\\\/'",245],")",",",["T_WHITESPACE"," ",245],["T_STRING","true",245],")",";",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE","\n    ",246],"}",["T_WHITESPACE","\n\n    ",247],["T_DOC_COMMENT","\/**\n     * Delete file (and its thumbnail if exists) from storage\n     *\n     * @param string $target File path to be deleted\n     * @return Mage_Cms_Model_Wysiwyg_Images_Storage\n     *\/",249],["T_WHITESPACE","\n    ",254],["T_PUBLIC","public",255],["T_WHITESPACE"," ",255],["T_FUNCTION","function",255],["T_WHITESPACE"," ",255],["T_STRING","deleteFile",255],"(",["T_VARIABLE","$target",255],")",["T_WHITESPACE","\n    ",255],"{",["T_WHITESPACE","\n        ",256],["T_VARIABLE","$io",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_NEW","new",257],["T_WHITESPACE"," ",257],["T_STRING","Varien_Io_File",257],"(",")",";",["T_WHITESPACE","\n        ",257],["T_VARIABLE","$io",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","rm",258],"(",["T_VARIABLE","$target",258],")",";",["T_WHITESPACE","\n        ",258],["T_STRING","Mage",259],["T_DOUBLE_COLON","::",259],["T_STRING","helper",259],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",259],")",["T_OBJECT_OPERATOR","->",259],["T_STRING","deleteFile",259],"(",["T_VARIABLE","$target",259],")",";",["T_WHITESPACE","\n\n        ",259],["T_VARIABLE","$thumb",261],["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","getThumbnailPath",261],"(",["T_VARIABLE","$target",261],",",["T_WHITESPACE"," ",261],["T_STRING","true",261],")",";",["T_WHITESPACE","\n        ",261],["T_IF","if",262],["T_WHITESPACE"," ",262],"(",["T_VARIABLE","$thumb",262],")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n            ",262],["T_VARIABLE","$io",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","rm",263],"(",["T_VARIABLE","$thumb",263],")",";",["T_WHITESPACE","\n            ",263],["T_STRING","Mage",264],["T_DOUBLE_COLON","::",264],["T_STRING","helper",264],"(",["T_CONSTANT_ENCAPSED_STRING","'core\/file_storage_database'",264],")",["T_OBJECT_OPERATOR","->",264],["T_STRING","deleteFile",264],"(",["T_VARIABLE","$thumb",264],")",";",["T_WHITESPACE","\n        ",264],"}",["T_WHITESPACE","\n        ",265],["T_RETURN","return",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$this",266],";",["T_WHITESPACE","\n    ",266],"}",["T_WHITESPACE","\n\n\n    ",267],["T_DOC_COMMENT","\/**\n     * Upload and resize new file\n     *\n     * @param string $targetPath Target directory\n     * @param string $type Type of storage, e.g. image, media etc.\n     * @throws Mage_Core_Exception\n     * @return array File info Array\n     *\/",270],["T_WHITESPACE","\n    ",277],["T_PUBLIC","public",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","uploadFile",278],"(",["T_VARIABLE","$targetPath",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$type",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_STRING","null",278],")",["T_WHITESPACE","\n    ",278],"{",["T_WHITESPACE","\n        ",279],["T_VARIABLE","$uploader",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_NEW","new",280],["T_WHITESPACE"," ",280],["T_STRING","Mage_Core_Model_File_Uploader",280],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",280],")",";",["T_WHITESPACE","\n        ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$allowed",281],["T_WHITESPACE"," ",281],"=",["T_WHITESPACE"," ",281],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","getAllowedExtensions",281],"(",["T_VARIABLE","$type",281],")",")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n            ",281],["T_VARIABLE","$uploader",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","setAllowedExtensions",282],"(",["T_VARIABLE","$allowed",282],")",";",["T_WHITESPACE","\n        ",282],"}",["T_WHITESPACE","\n        ",283],["T_VARIABLE","$uploader",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","setAllowRenameFiles",284],"(",["T_STRING","true",284],")",";",["T_WHITESPACE","\n        ",284],["T_VARIABLE","$uploader",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","setFilesDispersion",285],"(",["T_STRING","false",285],")",";",["T_WHITESPACE","\n        ",285],["T_VARIABLE","$result",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_VARIABLE","$uploader",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","save",286],"(",["T_VARIABLE","$targetPath",286],")",";",["T_WHITESPACE","\n\n        ",286],["T_IF","if",288],["T_WHITESPACE"," ",288],"(","!",["T_VARIABLE","$result",288],")",["T_WHITESPACE"," ",288],"{",["T_WHITESPACE","\n            ",288],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","throwException",289],"(",["T_WHITESPACE"," ",289],["T_STRING","Mage",289],["T_DOUBLE_COLON","::",289],["T_STRING","helper",289],"(",["T_CONSTANT_ENCAPSED_STRING","'cms'",289],")",["T_OBJECT_OPERATOR","->",289],["T_STRING","__",289],"(",["T_CONSTANT_ENCAPSED_STRING","'Cannot upload file.'",289],")",["T_WHITESPACE"," ",289],")",";",["T_WHITESPACE","\n        ",289],"}",["T_WHITESPACE","\n\n        ",290],["T_COMMENT","\/\/ create thumbnail\n",292],["T_WHITESPACE","        ",293],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","resizeFile",293],"(",["T_VARIABLE","$targetPath",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_STRING","DS",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_VARIABLE","$uploader",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","getUploadedFileName",293],"(",")",",",["T_WHITESPACE"," ",293],["T_STRING","true",293],")",";",["T_WHITESPACE","\n\n        ",293],["T_VARIABLE","$result",295],"[",["T_CONSTANT_ENCAPSED_STRING","'cookie'",295],"]",["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_ARRAY","array",295],"(",["T_WHITESPACE","\n            ",295],["T_CONSTANT_ENCAPSED_STRING","'name'",296],["T_WHITESPACE","     ",296],["T_DOUBLE_ARROW","=>",296],["T_WHITESPACE"," ",296],["T_STRING","session_name",296],"(",")",",",["T_WHITESPACE","\n            ",296],["T_CONSTANT_ENCAPSED_STRING","'value'",297],["T_WHITESPACE","    ",297],["T_DOUBLE_ARROW","=>",297],["T_WHITESPACE"," ",297],["T_VARIABLE","$this",297],["T_OBJECT_OPERATOR","->",297],["T_STRING","getSession",297],"(",")",["T_OBJECT_OPERATOR","->",297],["T_STRING","getSessionId",297],"(",")",",",["T_WHITESPACE","\n            ",297],["T_CONSTANT_ENCAPSED_STRING","'lifetime'",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$this",298],["T_OBJECT_OPERATOR","->",298],["T_STRING","getSession",298],"(",")",["T_OBJECT_OPERATOR","->",298],["T_STRING","getCookieLifetime",298],"(",")",",",["T_WHITESPACE","\n            ",298],["T_CONSTANT_ENCAPSED_STRING","'path'",299],["T_WHITESPACE","     ",299],["T_DOUBLE_ARROW","=>",299],["T_WHITESPACE"," ",299],["T_VARIABLE","$this",299],["T_OBJECT_OPERATOR","->",299],["T_STRING","getSession",299],"(",")",["T_OBJECT_OPERATOR","->",299],["T_STRING","getCookiePath",299],"(",")",",",["T_WHITESPACE","\n            ",299],["T_CONSTANT_ENCAPSED_STRING","'domain'",300],["T_WHITESPACE","   ",300],["T_DOUBLE_ARROW","=>",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$this",300],["T_OBJECT_OPERATOR","->",300],["T_STRING","getSession",300],"(",")",["T_OBJECT_OPERATOR","->",300],["T_STRING","getCookieDomain",300],"(",")",["T_WHITESPACE","\n        ",300],")",";",["T_WHITESPACE","\n\n        ",301],["T_RETURN","return",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$result",303],";",["T_WHITESPACE","\n    ",303],"}",["T_WHITESPACE","\n\n    ",304],["T_DOC_COMMENT","\/**\n     * Thumbnail path getter\n     *\n     * @param  string $filePath original file path\n     * @param  boolean $checkFile OPTIONAL is it necessary to check file availability\n     * @return string | false\n     *\/",306],["T_WHITESPACE","\n    ",312],["T_PUBLIC","public",313],["T_WHITESPACE"," ",313],["T_FUNCTION","function",313],["T_WHITESPACE"," ",313],["T_STRING","getThumbnailPath",313],"(",["T_VARIABLE","$filePath",313],",",["T_WHITESPACE"," ",313],["T_VARIABLE","$checkFile",313],["T_WHITESPACE"," ",313],"=",["T_WHITESPACE"," ",313],["T_STRING","false",313],")",["T_WHITESPACE","\n    ",313],"{",["T_WHITESPACE","\n        ",314],["T_VARIABLE","$mediaRootDir",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_VARIABLE","$this",315],["T_OBJECT_OPERATOR","->",315],["T_STRING","getHelper",315],"(",")",["T_OBJECT_OPERATOR","->",315],["T_STRING","getStorageRoot",315],"(",")",";",["T_WHITESPACE","\n\n        ",315],["T_IF","if",317],["T_WHITESPACE"," ",317],"(",["T_STRING","strpos",317],"(",["T_VARIABLE","$filePath",317],",",["T_WHITESPACE"," ",317],["T_VARIABLE","$mediaRootDir",317],")",["T_WHITESPACE"," ",317],["T_IS_IDENTICAL","===",317],["T_WHITESPACE"," ",317],["T_LNUMBER","0",317],")",["T_WHITESPACE"," ",317],"{",["T_WHITESPACE","\n            ",317],["T_VARIABLE","$thumbPath",318],["T_WHITESPACE"," ",318],"=",["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","getThumbnailRoot",318],"(",")",["T_WHITESPACE"," ",318],".",["T_WHITESPACE"," ",318],["T_STRING","DS",318],["T_WHITESPACE"," ",318],".",["T_WHITESPACE"," ",318],["T_STRING","substr",318],"(",["T_VARIABLE","$filePath",318],",",["T_WHITESPACE"," ",318],["T_STRING","strlen",318],"(",["T_VARIABLE","$mediaRootDir",318],")",")",";",["T_WHITESPACE","\n\n            ",318],["T_IF","if",320],["T_WHITESPACE"," ",320],"(","!",["T_WHITESPACE"," ",320],["T_VARIABLE","$checkFile",320],["T_WHITESPACE"," ",320],["T_BOOLEAN_OR","||",320],["T_WHITESPACE"," ",320],["T_STRING","is_readable",320],"(",["T_VARIABLE","$thumbPath",320],")",")",["T_WHITESPACE"," ",320],"{",["T_WHITESPACE","\n                ",320],["T_RETURN","return",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$thumbPath",321],";",["T_WHITESPACE","\n            ",321],"}",["T_WHITESPACE","\n        ",322],"}",["T_WHITESPACE","\n\n        ",323],["T_RETURN","return",325],["T_WHITESPACE"," ",325],["T_STRING","false",325],";",["T_WHITESPACE","\n    ",325],"}",["T_WHITESPACE","\n\n    ",326],["T_DOC_COMMENT","\/**\n     * Thumbnail URL getter\n     *\n     * @param  string $filePath original file path\n     * @param  boolean $checkFile OPTIONAL is it necessary to check file availability\n     * @return string | false\n     *\/",328],["T_WHITESPACE","\n    ",334],["T_PUBLIC","public",335],["T_WHITESPACE"," ",335],["T_FUNCTION","function",335],["T_WHITESPACE"," ",335],["T_STRING","getThumbnailUrl",335],"(",["T_VARIABLE","$filePath",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$checkFile",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_STRING","false",335],")",["T_WHITESPACE","\n    ",335],"{",["T_WHITESPACE","\n        ",336],["T_VARIABLE","$mediaRootDir",337],["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_VARIABLE","$this",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","getHelper",337],"(",")",["T_OBJECT_OPERATOR","->",337],["T_STRING","getStorageRoot",337],"(",")",";",["T_WHITESPACE","\n\n        ",337],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_STRING","strpos",339],"(",["T_VARIABLE","$filePath",339],",",["T_WHITESPACE"," ",339],["T_VARIABLE","$mediaRootDir",339],")",["T_WHITESPACE"," ",339],["T_IS_IDENTICAL","===",339],["T_WHITESPACE"," ",339],["T_LNUMBER","0",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$thumbSuffix",340],["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_STRING","self",340],["T_DOUBLE_COLON","::",340],["T_STRING","THUMBS_DIRECTORY_NAME",340],["T_WHITESPACE"," ",340],".",["T_WHITESPACE"," ",340],["T_STRING","DS",340],["T_WHITESPACE"," ",340],".",["T_WHITESPACE"," ",340],["T_STRING","Mage_Cms_Model_Wysiwyg_Config",340],["T_DOUBLE_COLON","::",340],["T_STRING","IMAGE_DIRECTORY",340],["T_WHITESPACE","\n                ",340],".",["T_WHITESPACE"," ",341],["T_STRING","DS",341],["T_WHITESPACE"," ",341],".",["T_WHITESPACE"," ",341],["T_STRING","substr",341],"(",["T_VARIABLE","$filePath",341],",",["T_WHITESPACE"," ",341],["T_STRING","strlen",341],"(",["T_VARIABLE","$mediaRootDir",341],")",")",";",["T_WHITESPACE","\n\n            ",341],["T_IF","if",343],["T_WHITESPACE"," ",343],"(","!",["T_WHITESPACE"," ",343],["T_VARIABLE","$checkFile",343],["T_WHITESPACE"," ",343],["T_BOOLEAN_OR","||",343],["T_WHITESPACE"," ",343],["T_STRING","is_readable",343],"(",["T_VARIABLE","$mediaRootDir",343],["T_WHITESPACE"," ",343],".",["T_WHITESPACE"," ",343],["T_VARIABLE","$thumbSuffix",343],")",")",["T_WHITESPACE"," ",343],"{",["T_WHITESPACE","\n                ",343],["T_VARIABLE","$randomIndex",344],["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_CONSTANT_ENCAPSED_STRING","'?rand='",344],["T_WHITESPACE"," ",344],".",["T_WHITESPACE"," ",344],["T_STRING","time",344],"(",")",";",["T_WHITESPACE","\n                ",344],["T_VARIABLE","$thumbUrl",345],["T_WHITESPACE"," ",345],"=",["T_WHITESPACE"," ",345],["T_VARIABLE","$this",345],["T_OBJECT_OPERATOR","->",345],["T_STRING","getHelper",345],"(",")",["T_OBJECT_OPERATOR","->",345],["T_STRING","getBaseUrl",345],"(",")",["T_WHITESPACE"," ",345],".",["T_WHITESPACE"," ",345],["T_STRING","Mage_Cms_Model_Wysiwyg_Config",345],["T_DOUBLE_COLON","::",345],["T_STRING","IMAGE_DIRECTORY",345],["T_WHITESPACE","\n                    ",345],".",["T_WHITESPACE"," ",346],["T_STRING","DS",346],["T_WHITESPACE"," ",346],".",["T_WHITESPACE"," ",346],["T_VARIABLE","$thumbSuffix",346],";",["T_WHITESPACE","\n                ",346],["T_RETURN","return",347],["T_WHITESPACE"," ",347],["T_STRING","str_replace",347],"(",["T_CONSTANT_ENCAPSED_STRING","'\\\\'",347],",",["T_WHITESPACE"," ",347],["T_CONSTANT_ENCAPSED_STRING","'\/'",347],",",["T_WHITESPACE"," ",347],["T_VARIABLE","$thumbUrl",347],")",["T_WHITESPACE"," ",347],".",["T_WHITESPACE"," ",347],["T_VARIABLE","$randomIndex",347],";",["T_WHITESPACE","\n            ",347],"}",["T_WHITESPACE","\n        ",348],"}",["T_WHITESPACE","\n\n        ",349],["T_RETURN","return",351],["T_WHITESPACE"," ",351],["T_STRING","false",351],";",["T_WHITESPACE","\n    ",351],"}",["T_WHITESPACE","\n\n    ",352],["T_DOC_COMMENT","\/**\n     * Create thumbnail for image and save it to thumbnails directory\n     *\n     * @param string $source Image path to be resized\n     * @param bool $keepRation Keep aspect ratio or not\n     * @return bool|string Resized filepath or false if errors were occurred\n     *\/",354],["T_WHITESPACE","\n    ",360],["T_PUBLIC","public",361],["T_WHITESPACE"," ",361],["T_FUNCTION","function",361],["T_WHITESPACE"," ",361],["T_STRING","resizeFile",361],"(",["T_VARIABLE","$source",361],",",["T_WHITESPACE"," ",361],["T_VARIABLE","$keepRation",361],["T_WHITESPACE"," ",361],"=",["T_WHITESPACE"," ",361],["T_STRING","true",361],")",["T_WHITESPACE","\n    ",361],"{",["T_WHITESPACE","\n        ",362],["T_IF","if",363],["T_WHITESPACE"," ",363],"(","!",["T_STRING","is_file",363],"(",["T_VARIABLE","$source",363],")",["T_WHITESPACE"," ",363],["T_BOOLEAN_OR","||",363],["T_WHITESPACE"," ",363],"!",["T_STRING","is_readable",363],"(",["T_VARIABLE","$source",363],")",")",["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n            ",363],["T_RETURN","return",364],["T_WHITESPACE"," ",364],["T_STRING","false",364],";",["T_WHITESPACE","\n        ",364],"}",["T_WHITESPACE","\n\n        ",365],["T_VARIABLE","$targetDir",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getThumbsPath",367],"(",["T_VARIABLE","$source",367],")",";",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$io",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_NEW","new",368],["T_WHITESPACE"," ",368],["T_STRING","Varien_Io_File",368],"(",")",";",["T_WHITESPACE","\n        ",368],["T_IF","if",369],["T_WHITESPACE"," ",369],"(","!",["T_VARIABLE","$io",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","isWriteable",369],"(",["T_VARIABLE","$targetDir",369],")",")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$io",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","mkdir",370],"(",["T_VARIABLE","$targetDir",370],")",";",["T_WHITESPACE","\n        ",370],"}",["T_WHITESPACE","\n        ",371],["T_IF","if",372],["T_WHITESPACE"," ",372],"(","!",["T_VARIABLE","$io",372],["T_OBJECT_OPERATOR","->",372],["T_STRING","isWriteable",372],"(",["T_VARIABLE","$targetDir",372],")",")",["T_WHITESPACE"," ",372],"{",["T_WHITESPACE","\n            ",372],["T_RETURN","return",373],["T_WHITESPACE"," ",373],["T_STRING","false",373],";",["T_WHITESPACE","\n        ",373],"}",["T_WHITESPACE","\n        ",374],["T_VARIABLE","$image",375],["T_WHITESPACE"," ",375],"=",["T_WHITESPACE"," ",375],["T_STRING","Varien_Image_Adapter",375],["T_DOUBLE_COLON","::",375],["T_STRING","factory",375],"(",["T_CONSTANT_ENCAPSED_STRING","'GD2'",375],")",";",["T_WHITESPACE","\n        ",375],["T_VARIABLE","$image",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","open",376],"(",["T_VARIABLE","$source",376],")",";",["T_WHITESPACE","\n        ",376],["T_VARIABLE","$width",377],["T_WHITESPACE"," ",377],"=",["T_WHITESPACE"," ",377],["T_VARIABLE","$this",377],["T_OBJECT_OPERATOR","->",377],["T_STRING","getConfigData",377],"(",["T_CONSTANT_ENCAPSED_STRING","'resize_width'",377],")",";",["T_WHITESPACE","\n        ",377],["T_VARIABLE","$height",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","getConfigData",378],"(",["T_CONSTANT_ENCAPSED_STRING","'resize_height'",378],")",";",["T_WHITESPACE","\n        ",378],["T_VARIABLE","$image",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","keepAspectRatio",379],"(",["T_VARIABLE","$keepRation",379],")",";",["T_WHITESPACE","\n        ",379],["T_VARIABLE","$image",380],["T_OBJECT_OPERATOR","->",380],["T_STRING","resize",380],"(",["T_VARIABLE","$width",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$height",380],")",";",["T_WHITESPACE","\n        ",380],["T_VARIABLE","$dest",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_VARIABLE","$targetDir",381],["T_WHITESPACE"," ",381],".",["T_WHITESPACE"," ",381],["T_STRING","DS",381],["T_WHITESPACE"," ",381],".",["T_WHITESPACE"," ",381],["T_STRING","pathinfo",381],"(",["T_VARIABLE","$source",381],",",["T_WHITESPACE"," ",381],["T_STRING","PATHINFO_BASENAME",381],")",";",["T_WHITESPACE","\n        ",381],["T_VARIABLE","$image",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","save",382],"(",["T_VARIABLE","$dest",382],")",";",["T_WHITESPACE","\n        ",382],["T_IF","if",383],["T_WHITESPACE"," ",383],"(",["T_STRING","is_file",383],"(",["T_VARIABLE","$dest",383],")",")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n            ",383],["T_RETURN","return",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$dest",384],";",["T_WHITESPACE","\n        ",384],"}",["T_WHITESPACE","\n        ",385],["T_RETURN","return",386],["T_WHITESPACE"," ",386],["T_STRING","false",386],";",["T_WHITESPACE","\n    ",386],"}",["T_WHITESPACE","\n\n    ",387],["T_DOC_COMMENT","\/**\n     * Resize images on the fly in controller action\n     *\n     * @param string File basename\n     * @return bool|string Thumbnail path or false for errors\n     *\/",389],["T_WHITESPACE","\n    ",394],["T_PUBLIC","public",395],["T_WHITESPACE"," ",395],["T_FUNCTION","function",395],["T_WHITESPACE"," ",395],["T_STRING","resizeOnTheFly",395],"(",["T_VARIABLE","$filename",395],")",["T_WHITESPACE","\n    ",395],"{",["T_WHITESPACE","\n        ",396],["T_VARIABLE","$path",397],["T_WHITESPACE"," ",397],"=",["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getSession",397],"(",")",["T_OBJECT_OPERATOR","->",397],["T_STRING","getCurrentPath",397],"(",")",";",["T_WHITESPACE","\n        ",397],["T_IF","if",398],["T_WHITESPACE"," ",398],"(","!",["T_VARIABLE","$path",398],")",["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n            ",398],["T_VARIABLE","$path",399],["T_WHITESPACE"," ",399],"=",["T_WHITESPACE"," ",399],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","getHelper",399],"(",")",["T_OBJECT_OPERATOR","->",399],["T_STRING","getCurrentPath",399],"(",")",";",["T_WHITESPACE","\n        ",399],"}",["T_WHITESPACE","\n        ",400],["T_RETURN","return",401],["T_WHITESPACE"," ",401],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","resizeFile",401],"(",["T_VARIABLE","$path",401],["T_WHITESPACE"," ",401],".",["T_WHITESPACE"," ",401],["T_STRING","DS",401],["T_WHITESPACE"," ",401],".",["T_WHITESPACE"," ",401],["T_VARIABLE","$filename",401],")",";",["T_WHITESPACE","\n    ",401],"}",["T_WHITESPACE","\n\n    ",402],["T_DOC_COMMENT","\/**\n     * Return thumbnails directory path for file\/current directory\n     *\n     * @param string $filePath Path to the file\n     * @return string\n     *\/",404],["T_WHITESPACE","\n    ",409],["T_PUBLIC","public",410],["T_WHITESPACE"," ",410],["T_FUNCTION","function",410],["T_WHITESPACE"," ",410],["T_STRING","getThumbsPath",410],"(",["T_VARIABLE","$filePath",410],["T_WHITESPACE"," ",410],"=",["T_WHITESPACE"," ",410],["T_STRING","false",410],")",["T_WHITESPACE","\n    ",410],"{",["T_WHITESPACE","\n        ",411],["T_VARIABLE","$mediaRootDir",412],["T_WHITESPACE"," ",412],"=",["T_WHITESPACE"," ",412],["T_STRING","Mage",412],["T_DOUBLE_COLON","::",412],["T_STRING","getConfig",412],"(",")",["T_OBJECT_OPERATOR","->",412],["T_STRING","getOptions",412],"(",")",["T_OBJECT_OPERATOR","->",412],["T_STRING","getMediaDir",412],"(",")",";",["T_WHITESPACE","\n        ",412],["T_VARIABLE","$thumbnailDir",413],["T_WHITESPACE"," ",413],"=",["T_WHITESPACE"," ",413],["T_VARIABLE","$this",413],["T_OBJECT_OPERATOR","->",413],["T_STRING","getThumbnailRoot",413],"(",")",";",["T_WHITESPACE","\n\n        ",413],["T_IF","if",415],["T_WHITESPACE"," ",415],"(",["T_VARIABLE","$filePath",415],["T_WHITESPACE"," ",415],["T_BOOLEAN_AND","&&",415],["T_WHITESPACE"," ",415],["T_STRING","strpos",415],"(",["T_VARIABLE","$filePath",415],",",["T_WHITESPACE"," ",415],["T_VARIABLE","$mediaRootDir",415],")",["T_WHITESPACE"," ",415],["T_IS_IDENTICAL","===",415],["T_WHITESPACE"," ",415],["T_LNUMBER","0",415],")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n            ",415],["T_VARIABLE","$thumbnailDir",416],["T_WHITESPACE"," ",416],["T_CONCAT_EQUAL",".=",416],["T_WHITESPACE"," ",416],["T_STRING","DS",416],["T_WHITESPACE"," ",416],".",["T_WHITESPACE"," ",416],["T_STRING","dirname",416],"(",["T_STRING","substr",416],"(",["T_VARIABLE","$filePath",416],",",["T_WHITESPACE"," ",416],["T_STRING","strlen",416],"(",["T_VARIABLE","$mediaRootDir",416],")",")",")",";",["T_WHITESPACE","\n        ",416],"}",["T_WHITESPACE","\n\n        ",417],["T_RETURN","return",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$thumbnailDir",419],";",["T_WHITESPACE","\n    ",419],"}",["T_WHITESPACE","\n\n    ",420],["T_DOC_COMMENT","\/**\n     * Media Storage Helper getter\n     * @return Mage_Cms_Helper_Wysiwyg_Images\n     *\/",422],["T_WHITESPACE","\n    ",425],["T_PUBLIC","public",426],["T_WHITESPACE"," ",426],["T_FUNCTION","function",426],["T_WHITESPACE"," ",426],["T_STRING","getHelper",426],"(",")",["T_WHITESPACE","\n    ",426],"{",["T_WHITESPACE","\n        ",427],["T_RETURN","return",428],["T_WHITESPACE"," ",428],["T_STRING","Mage",428],["T_DOUBLE_COLON","::",428],["T_STRING","helper",428],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/wysiwyg_images'",428],")",";",["T_WHITESPACE","\n    ",428],"}",["T_WHITESPACE","\n\n    ",429],["T_DOC_COMMENT","\/**\n     * Storage session\n     *\n     * @return Mage_Adminhtml_Model_Session\n     *\/",431],["T_WHITESPACE","\n    ",435],["T_PUBLIC","public",436],["T_WHITESPACE"," ",436],["T_FUNCTION","function",436],["T_WHITESPACE"," ",436],["T_STRING","getSession",436],"(",")",["T_WHITESPACE","\n    ",436],"{",["T_WHITESPACE","\n        ",437],["T_RETURN","return",438],["T_WHITESPACE"," ",438],["T_STRING","Mage",438],["T_DOUBLE_COLON","::",438],["T_STRING","getSingleton",438],"(",["T_CONSTANT_ENCAPSED_STRING","'adminhtml\/session'",438],")",";",["T_WHITESPACE","\n    ",438],"}",["T_WHITESPACE","\n\n    ",439],["T_DOC_COMMENT","\/**\n     * Config object getter\n     *\n     * @return Mage_Core_Model_Config_Element\n     *\/",441],["T_WHITESPACE","\n    ",445],["T_PUBLIC","public",446],["T_WHITESPACE"," ",446],["T_FUNCTION","function",446],["T_WHITESPACE"," ",446],["T_STRING","getConfig",446],"(",")",["T_WHITESPACE","\n    ",446],"{",["T_WHITESPACE","\n        ",447],["T_IF","if",448],["T_WHITESPACE"," ",448],"(","!",["T_WHITESPACE"," ",448],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","_config",448],")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","_config",449],["T_WHITESPACE"," ",449],"=",["T_WHITESPACE"," ",449],["T_STRING","Mage",449],["T_DOUBLE_COLON","::",449],["T_STRING","getConfig",449],"(",")",["T_OBJECT_OPERATOR","->",449],["T_STRING","getNode",449],"(",["T_CONSTANT_ENCAPSED_STRING","'cms\/browser'",449],",",["T_WHITESPACE"," ",449],["T_CONSTANT_ENCAPSED_STRING","'adminhtml'",449],")",";",["T_WHITESPACE","\n        ",449],"}",["T_WHITESPACE","\n\n        ",450],["T_RETURN","return",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","_config",452],";",["T_WHITESPACE","\n    ",452],"}",["T_WHITESPACE","\n\n    ",453],["T_DOC_COMMENT","\/**\n     * Config object as array getter\n     *\n     * @return array\n     *\/",455],["T_WHITESPACE","\n    ",459],["T_PUBLIC","public",460],["T_WHITESPACE"," ",460],["T_FUNCTION","function",460],["T_WHITESPACE"," ",460],["T_STRING","getConfigAsArray",460],"(",")",["T_WHITESPACE","\n    ",460],"{",["T_WHITESPACE","\n        ",461],["T_IF","if",462],["T_WHITESPACE"," ",462],"(","!",["T_WHITESPACE"," ",462],["T_VARIABLE","$this",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","_configAsArray",462],")",["T_WHITESPACE"," ",462],"{",["T_WHITESPACE","\n            ",462],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","_configAsArray",463],["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","getConfig",463],"(",")",["T_OBJECT_OPERATOR","->",463],["T_STRING","asCanonicalArray",463],"(",")",";",["T_WHITESPACE","\n        ",463],"}",["T_WHITESPACE","\n\n        ",464],["T_RETURN","return",466],["T_WHITESPACE"," ",466],["T_VARIABLE","$this",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","_configAsArray",466],";",["T_WHITESPACE","\n    ",466],"}",["T_WHITESPACE","\n\n    ",467],["T_DOC_COMMENT","\/**\n     * Wysiwyg Config reader\n     *\n     * @param string $key\n     * @param mixed $default\n     * @return mixed\n     *\/",469],["T_WHITESPACE","\n    ",475],["T_PUBLIC","public",476],["T_WHITESPACE"," ",476],["T_FUNCTION","function",476],["T_WHITESPACE"," ",476],["T_STRING","getConfigData",476],"(",["T_VARIABLE","$key",476],",",["T_WHITESPACE"," ",476],["T_VARIABLE","$default",476],"=",["T_STRING","false",476],")",["T_WHITESPACE","\n    ",476],"{",["T_WHITESPACE","\n        ",477],["T_VARIABLE","$configArray",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$this",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","getConfigAsArray",478],"(",")",";",["T_WHITESPACE","\n        ",478],["T_VARIABLE","$key",479],["T_WHITESPACE"," ",479],"=",["T_WHITESPACE"," ",479],["T_STRING_CAST","(string)",479],["T_WHITESPACE"," ",479],["T_VARIABLE","$key",479],";",["T_WHITESPACE","\n\n        ",479],["T_RETURN","return",481],["T_WHITESPACE"," ",481],["T_STRING","array_key_exists",481],"(",["T_VARIABLE","$key",481],",",["T_WHITESPACE"," ",481],["T_VARIABLE","$configArray",481],")",["T_WHITESPACE"," ",481],"?",["T_WHITESPACE"," ",481],["T_VARIABLE","$configArray",481],"[",["T_VARIABLE","$key",481],"]",["T_WHITESPACE"," ",481],":",["T_WHITESPACE"," ",481],["T_VARIABLE","$default",481],";",["T_WHITESPACE","\n    ",481],"}",["T_WHITESPACE","\n\n    ",482],["T_DOC_COMMENT","\/**\n     * Prepare allowed_extensions config settings\n     *\n     * @param string $type Type of storage, e.g. image, media etc.\n     * @return array Array of allowed file extensions\n     *\/",484],["T_WHITESPACE","\n    ",489],["T_PUBLIC","public",490],["T_WHITESPACE"," ",490],["T_FUNCTION","function",490],["T_WHITESPACE"," ",490],["T_STRING","getAllowedExtensions",490],"(",["T_VARIABLE","$type",490],["T_WHITESPACE"," ",490],"=",["T_WHITESPACE"," ",490],["T_STRING","null",490],")",["T_WHITESPACE","\n    ",490],"{",["T_WHITESPACE","\n        ",491],["T_VARIABLE","$extensions",492],["T_WHITESPACE"," ",492],"=",["T_WHITESPACE"," ",492],["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","getConfigData",492],"(",["T_CONSTANT_ENCAPSED_STRING","'extensions'",492],")",";",["T_WHITESPACE","\n\n        ",492],["T_IF","if",494],["T_WHITESPACE"," ",494],"(",["T_STRING","is_string",494],"(",["T_VARIABLE","$type",494],")",["T_WHITESPACE"," ",494],["T_BOOLEAN_AND","&&",494],["T_WHITESPACE"," ",494],["T_STRING","array_key_exists",494],"(","\"",["T_CURLY_OPEN","{",494],["T_VARIABLE","$type",494],"}",["T_ENCAPSED_AND_WHITESPACE","_allowed",494],"\"",",",["T_WHITESPACE"," ",494],["T_VARIABLE","$extensions",494],")",")",["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n            ",494],["T_VARIABLE","$allowed",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_VARIABLE","$extensions",495],"[","\"",["T_CURLY_OPEN","{",495],["T_VARIABLE","$type",495],"}",["T_ENCAPSED_AND_WHITESPACE","_allowed",495],"\"","]",";",["T_WHITESPACE","\n        ",495],"}",["T_WHITESPACE"," ",496],["T_ELSE","else",496],["T_WHITESPACE"," ",496],"{",["T_WHITESPACE","\n            ",496],["T_VARIABLE","$allowed",497],["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_VARIABLE","$extensions",497],"[",["T_CONSTANT_ENCAPSED_STRING","'allowed'",497],"]",";",["T_WHITESPACE","\n        ",497],"}",["T_WHITESPACE","\n\n        ",498],["T_RETURN","return",500],["T_WHITESPACE"," ",500],["T_STRING","array_keys",500],"(",["T_STRING","array_filter",500],"(",["T_VARIABLE","$allowed",500],")",")",";",["T_WHITESPACE","\n    ",500],"}",["T_WHITESPACE","\n\n    ",501],["T_DOC_COMMENT","\/**\n     * Thumbnail root directory getter\n     *\n     * @return string\n     *\/",503],["T_WHITESPACE","\n    ",507],["T_PUBLIC","public",508],["T_WHITESPACE"," ",508],["T_FUNCTION","function",508],["T_WHITESPACE"," ",508],["T_STRING","getThumbnailRoot",508],"(",")",["T_WHITESPACE","\n    ",508],"{",["T_WHITESPACE","\n        ",509],["T_RETURN","return",510],["T_WHITESPACE"," ",510],["T_VARIABLE","$this",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","getHelper",510],"(",")",["T_OBJECT_OPERATOR","->",510],["T_STRING","getStorageRoot",510],"(",")",["T_WHITESPACE"," ",510],".",["T_WHITESPACE"," ",510],["T_STRING","self",510],["T_DOUBLE_COLON","::",510],["T_STRING","THUMBS_DIRECTORY_NAME",510],";",["T_WHITESPACE","\n    ",510],"}",["T_WHITESPACE","\n\n    ",511],["T_DOC_COMMENT","\/**\n     * Simple way to check whether file is image or not based on extension\n     *\n     * @param string $filename\n     * @return bool\n     *\/",513],["T_WHITESPACE","\n    ",518],["T_PUBLIC","public",519],["T_WHITESPACE"," ",519],["T_FUNCTION","function",519],["T_WHITESPACE"," ",519],["T_STRING","isImage",519],"(",["T_VARIABLE","$filename",519],")",["T_WHITESPACE","\n    ",519],"{",["T_WHITESPACE","\n        ",520],["T_IF","if",521],["T_WHITESPACE"," ",521],"(","!",["T_VARIABLE","$this",521],["T_OBJECT_OPERATOR","->",521],["T_STRING","hasData",521],"(",["T_CONSTANT_ENCAPSED_STRING","'_image_extensions'",521],")",")",["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n            ",521],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","setData",522],"(",["T_CONSTANT_ENCAPSED_STRING","'_image_extensions'",522],",",["T_WHITESPACE"," ",522],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","getAllowedExtensions",522],"(",["T_CONSTANT_ENCAPSED_STRING","'image'",522],")",")",";",["T_WHITESPACE","\n        ",522],"}",["T_WHITESPACE","\n        ",523],["T_VARIABLE","$ext",524],["T_WHITESPACE"," ",524],"=",["T_WHITESPACE"," ",524],["T_STRING","strtolower",524],"(",["T_STRING","pathinfo",524],"(",["T_VARIABLE","$filename",524],",",["T_WHITESPACE"," ",524],["T_STRING","PATHINFO_EXTENSION",524],")",")",";",["T_WHITESPACE","\n        ",524],["T_RETURN","return",525],["T_WHITESPACE"," ",525],["T_STRING","in_array",525],"(",["T_VARIABLE","$ext",525],",",["T_WHITESPACE"," ",525],["T_VARIABLE","$this",525],["T_OBJECT_OPERATOR","->",525],["T_STRING","_getData",525],"(",["T_CONSTANT_ENCAPSED_STRING","'_image_extensions'",525],")",")",";",["T_WHITESPACE","\n    ",525],"}",["T_WHITESPACE","\n",526],"}",["T_WHITESPACE","\n",527]]