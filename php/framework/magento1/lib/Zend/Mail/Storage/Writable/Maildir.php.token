[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Zend Framework\n *\n * LICENSE\n *\n * This source file is subject to the new BSD license that is bundled\n * with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/framework.zend.com\/license\/new-bsd\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@zend.com so we can send you a copy immediately.\n *\n * @category   Zend\n * @package    Zend_Mail\n * @subpackage Storage\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n * @version    $Id$\n *\/",2],["T_WHITESPACE","\n\n\n",21],["T_DOC_COMMENT","\/**\n * @see Zend_Mail_Storage_Folder_Maildir\n *\/",24],["T_WHITESPACE","\n",26],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Folder\/Maildir.php';\n",27],["T_WHITESPACE","\n",28],["T_DOC_COMMENT","\/**\n * @see Zend_Mail_Storage_Writable_Interface\n *\/",29],["T_WHITESPACE","\n",31],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Writable\/Interface.php';\n",32],["T_WHITESPACE","\n\n",33],["T_DOC_COMMENT","\/**\n * @category   Zend\n * @package    Zend_Mail\n * @subpackage Storage\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",35],["T_WHITESPACE","\n",41],["T_CLASS","class",42],["T_WHITESPACE"," ",42],["T_STRING","Zend_Mail_Storage_Writable_Maildir",42],["T_WHITESPACE"," ",42],["T_EXTENDS","extends",42],["T_WHITESPACE","    ",42],["T_STRING","Zend_Mail_Storage_Folder_Maildir",42],["T_WHITESPACE","\n                                         ",42],["T_IMPLEMENTS","implements",43],["T_WHITESPACE"," ",43],["T_STRING","Zend_Mail_Storage_Writable_Interface",43],["T_WHITESPACE","\n",43],"{",["T_WHITESPACE","\n    ",44],["T_COMMENT","\/\/ TODO: init maildir (+ constructor option create if not found)\n",45],["T_WHITESPACE","\n    ",46],["T_DOC_COMMENT","\/**\n     * use quota and size of quota if given\n     * @var bool|int\n     *\/",47],["T_WHITESPACE","\n    ",50],["T_PROTECTED","protected",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$_quota",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * create a new maildir\n     *\n     * If the given dir is already a valid maildir this will not fail.\n     *\n     * @param string $dir directory for the new maildir (may already exist)\n     * @return null\n     * @throws Zend_Mail_Storage_Exception\n     *\/",53],["T_WHITESPACE","\n    ",61],["T_PUBLIC","public",62],["T_WHITESPACE"," ",62],["T_STATIC","static",62],["T_WHITESPACE"," ",62],["T_FUNCTION","function",62],["T_WHITESPACE"," ",62],["T_STRING","initMaildir",62],"(",["T_VARIABLE","$dir",62],")",["T_WHITESPACE","\n    ",62],"{",["T_WHITESPACE","\n        ",63],["T_IF","if",64],["T_WHITESPACE"," ",64],"(",["T_STRING","file_exists",64],"(",["T_VARIABLE","$dir",64],")",")",["T_WHITESPACE"," ",64],"{",["T_WHITESPACE","\n            ",64],["T_IF","if",65],["T_WHITESPACE"," ",65],"(","!",["T_STRING","is_dir",65],"(",["T_VARIABLE","$dir",65],")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n                ",65],["T_DOC_COMMENT","\/**\n                 * @see Zend_Mail_Storage_Exception\n                 *\/",66],["T_WHITESPACE","\n                ",68],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",69],["T_WHITESPACE","                ",70],["T_THROW","throw",70],["T_WHITESPACE"," ",70],["T_NEW","new",70],["T_WHITESPACE"," ",70],["T_STRING","Zend_Mail_Storage_Exception",70],"(",["T_CONSTANT_ENCAPSED_STRING","'maildir must be a directory if already exists'",70],")",";",["T_WHITESPACE","\n            ",70],"}",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE"," ",72],["T_ELSE","else",72],["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_IF","if",73],["T_WHITESPACE"," ",73],"(","!",["T_STRING","mkdir",73],"(",["T_VARIABLE","$dir",73],")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n                ",73],["T_DOC_COMMENT","\/**\n                 * @see Zend_Mail_Storage_Exception\n                 *\/",74],["T_WHITESPACE","\n                ",76],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",77],["T_WHITESPACE","                ",78],["T_VARIABLE","$dir",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","dirname",78],"(",["T_VARIABLE","$dir",78],")",";",["T_WHITESPACE","\n                ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(","!",["T_STRING","file_exists",79],"(",["T_VARIABLE","$dir",79],")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n                    ",79],["T_THROW","throw",80],["T_WHITESPACE"," ",80],["T_NEW","new",80],["T_WHITESPACE"," ",80],["T_STRING","Zend_Mail_Storage_Exception",80],"(","\"",["T_ENCAPSED_AND_WHITESPACE","parent ",80],["T_VARIABLE","$dir",80],["T_ENCAPSED_AND_WHITESPACE"," not found",80],"\"",")",";",["T_WHITESPACE","\n                ",80],"}",["T_WHITESPACE"," ",81],["T_ELSE","else",81],["T_WHITESPACE"," ",81],["T_IF","if",81],["T_WHITESPACE"," ",81],"(","!",["T_STRING","is_dir",81],"(",["T_VARIABLE","$dir",81],")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n                    ",81],["T_THROW","throw",82],["T_WHITESPACE"," ",82],["T_NEW","new",82],["T_WHITESPACE"," ",82],["T_STRING","Zend_Mail_Storage_Exception",82],"(","\"",["T_ENCAPSED_AND_WHITESPACE","parent ",82],["T_VARIABLE","$dir",82],["T_ENCAPSED_AND_WHITESPACE"," not a directory",82],"\"",")",";",["T_WHITESPACE","\n                ",82],"}",["T_WHITESPACE"," ",83],["T_ELSE","else",83],["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n                    ",83],["T_THROW","throw",84],["T_WHITESPACE"," ",84],["T_NEW","new",84],["T_WHITESPACE"," ",84],["T_STRING","Zend_Mail_Storage_Exception",84],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot create maildir'",84],")",";",["T_WHITESPACE","\n                ",84],"}",["T_WHITESPACE","\n            ",85],"}",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n\n        ",87],["T_FOREACH","foreach",89],["T_WHITESPACE"," ",89],"(",["T_ARRAY","array",89],"(",["T_CONSTANT_ENCAPSED_STRING","'cur'",89],",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'tmp'",89],",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'new'",89],")",["T_WHITESPACE"," ",89],["T_AS","as",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$subdir",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(","!","@",["T_STRING","mkdir",90],"(",["T_VARIABLE","$dir",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_STRING","DIRECTORY_SEPARATOR",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_VARIABLE","$subdir",90],")",")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n                ",90],["T_COMMENT","\/\/ ignore if dir exists (i.e. was already valid maildir or two processes try to create one)\n",91],["T_WHITESPACE","                ",92],["T_IF","if",92],["T_WHITESPACE"," ",92],"(","!",["T_STRING","file_exists",92],"(",["T_VARIABLE","$dir",92],["T_WHITESPACE"," ",92],".",["T_WHITESPACE"," ",92],["T_STRING","DIRECTORY_SEPARATOR",92],["T_WHITESPACE"," ",92],".",["T_WHITESPACE"," ",92],["T_VARIABLE","$subdir",92],")",")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n                    ",92],["T_DOC_COMMENT","\/**\n                     * @see Zend_Mail_Storage_Exception\n                     *\/",93],["T_WHITESPACE","\n                    ",95],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",96],["T_WHITESPACE","                    ",97],["T_THROW","throw",97],["T_WHITESPACE"," ",97],["T_NEW","new",97],["T_WHITESPACE"," ",97],["T_STRING","Zend_Mail_Storage_Exception",97],"(",["T_CONSTANT_ENCAPSED_STRING","'could not create subdir '",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_VARIABLE","$subdir",97],")",";",["T_WHITESPACE","\n                ",97],"}",["T_WHITESPACE","\n            ",98],"}",["T_WHITESPACE","\n        ",99],"}",["T_WHITESPACE","\n    ",100],"}",["T_WHITESPACE","\n\n    ",101],["T_DOC_COMMENT","\/**\n     * Create instance with parameters\n     * Additional parameters are (see parent for more):\n     *   - create if true a new maildir is create if none exists\n     *\n     * @param array $params mail reader specific parameters\n     * @throws Zend_Mail_Storage_Exception\n     *\/",103],["T_WHITESPACE","\n    ",110],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","__construct",111],"(",["T_VARIABLE","$params",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n        ",111],["T_IF","if",112],["T_WHITESPACE"," ",112],"(",["T_STRING","is_array",112],"(",["T_VARIABLE","$params",112],")",")",["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n            ",112],["T_VARIABLE","$params",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_OBJECT_CAST","(object)",113],["T_VARIABLE","$params",113],";",["T_WHITESPACE","\n        ",113],"}",["T_WHITESPACE","\n\n        ",114],["T_IF","if",116],["T_WHITESPACE"," ",116],"(","!",["T_EMPTY","empty",116],"(",["T_VARIABLE","$params",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","create",116],")",["T_WHITESPACE"," ",116],["T_BOOLEAN_AND","&&",116],["T_WHITESPACE"," ",116],["T_ISSET","isset",116],"(",["T_VARIABLE","$params",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","dirname",116],")",["T_WHITESPACE"," ",116],["T_BOOLEAN_AND","&&",116],["T_WHITESPACE"," ",116],"!",["T_STRING","file_exists",116],"(",["T_VARIABLE","$params",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","dirname",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_STRING","DIRECTORY_SEPARATOR",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'cur'",116],")",")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_STRING","self",117],["T_DOUBLE_COLON","::",117],["T_STRING","initMaildir",117],"(",["T_VARIABLE","$params",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","dirname",117],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n\n        ",118],["T_STRING","parent",120],["T_DOUBLE_COLON","::",120],["T_STRING","__construct",120],"(",["T_VARIABLE","$params",120],")",";",["T_WHITESPACE","\n    ",120],"}",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * create a new folder\n     *\n     * This method also creates parent folders if necessary. Some mail storages may restrict, which folder\n     * may be used as parent or which chars may be used in the folder name\n     *\n     * @param   string                          $name         global name of folder, local name if $parentFolder is set\n     * @param   string|Zend_Mail_Storage_Folder $parentFolder parent folder for new folder, else root folder is parent\n     * @return  string only used internally (new created maildir)\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",123],["T_WHITESPACE","\n    ",133],["T_PUBLIC","public",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","createFolder",134],"(",["T_VARIABLE","$name",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$parentFolder",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_STRING","null",134],")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_VARIABLE","$parentFolder",136],["T_WHITESPACE"," ",136],["T_INSTANCEOF","instanceof",136],["T_WHITESPACE"," ",136],["T_STRING","Zend_Mail_Storage_Folder",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$folder",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$parentFolder",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","getGlobalName",137],"(",")",["T_WHITESPACE"," ",137],".",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_delim",137],["T_WHITESPACE"," ",137],".",["T_WHITESPACE"," ",137],["T_VARIABLE","$name",137],";",["T_WHITESPACE","\n        ",137],"}",["T_WHITESPACE"," ",138],["T_ELSE","else",138],["T_WHITESPACE"," ",138],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_VARIABLE","$parentFolder",138],["T_WHITESPACE"," ",138],["T_IS_NOT_EQUAL","!=",138],["T_WHITESPACE"," ",138],["T_STRING","null",138],")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$folder",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","rtrim",139],"(",["T_VARIABLE","$parentFolder",139],",",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_delim",139],")",["T_WHITESPACE"," ",139],".",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","_delim",139],["T_WHITESPACE"," ",139],".",["T_WHITESPACE"," ",139],["T_VARIABLE","$name",139],";",["T_WHITESPACE","\n        ",139],"}",["T_WHITESPACE"," ",140],["T_ELSE","else",140],["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n            ",140],["T_VARIABLE","$folder",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$name",141],";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n\n        ",142],["T_VARIABLE","$folder",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","trim",144],"(",["T_VARIABLE","$folder",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","_delim",144],")",";",["T_WHITESPACE","\n\n        ",144],["T_COMMENT","\/\/ first we check if we try to create a folder that does exist\n",146],["T_WHITESPACE","        ",147],["T_VARIABLE","$exists",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_STRING","null",147],";",["T_WHITESPACE","\n        ",147],["T_TRY","try",148],["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_VARIABLE","$exists",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","getFolders",149],"(",["T_VARIABLE","$folder",149],")",";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE"," ",150],["T_CATCH","catch",150],["T_WHITESPACE"," ",150],"(",["T_STRING","Zend_Mail_Exception",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$e",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_COMMENT","\/\/ ok\n",151],["T_WHITESPACE","        ",152],"}",["T_WHITESPACE","\n        ",152],["T_IF","if",153],["T_WHITESPACE"," ",153],"(",["T_VARIABLE","$exists",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n            ",153],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",154],["T_WHITESPACE","\n            ",156],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",157],["T_WHITESPACE","            ",158],["T_THROW","throw",158],["T_WHITESPACE"," ",158],["T_NEW","new",158],["T_WHITESPACE"," ",158],["T_STRING","Zend_Mail_Storage_Exception",158],"(",["T_CONSTANT_ENCAPSED_STRING","'folder already exists'",158],")",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE","\n\n        ",159],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_STRING","strpos",161],"(",["T_VARIABLE","$folder",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_delim",161],["T_WHITESPACE"," ",161],".",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","_delim",161],")",["T_WHITESPACE"," ",161],["T_IS_NOT_IDENTICAL","!==",161],["T_WHITESPACE"," ",161],["T_STRING","false",161],")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n            ",161],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",162],["T_WHITESPACE","\n            ",164],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",165],["T_WHITESPACE","            ",166],["T_THROW","throw",166],["T_WHITESPACE"," ",166],["T_NEW","new",166],["T_WHITESPACE"," ",166],["T_STRING","Zend_Mail_Storage_Exception",166],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid name - folder parts may not be empty'",166],")",";",["T_WHITESPACE","\n        ",166],"}",["T_WHITESPACE","\n\n        ",167],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_STRING","strpos",169],"(",["T_VARIABLE","$folder",169],",",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",169],["T_WHITESPACE"," ",169],".",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","_delim",169],")",["T_WHITESPACE"," ",169],["T_IS_IDENTICAL","===",169],["T_WHITESPACE"," ",169],["T_LNUMBER","0",169],")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$folder",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_STRING","substr",170],"(",["T_VARIABLE","$folder",170],",",["T_WHITESPACE"," ",170],["T_LNUMBER","6",170],")",";",["T_WHITESPACE","\n        ",170],"}",["T_WHITESPACE","\n\n        ",171],["T_VARIABLE","$fulldir",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","_rootdir",173],["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'.'",173],["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_VARIABLE","$folder",173],";",["T_WHITESPACE","\n\n        ",173],["T_COMMENT","\/\/ check if we got tricked and would create a dir outside of the rootdir or not as direct child\n",175],["T_WHITESPACE","        ",176],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_STRING","strpos",176],"(",["T_VARIABLE","$folder",176],",",["T_WHITESPACE"," ",176],["T_STRING","DIRECTORY_SEPARATOR",176],")",["T_WHITESPACE"," ",176],["T_IS_NOT_IDENTICAL","!==",176],["T_WHITESPACE"," ",176],["T_STRING","false",176],["T_WHITESPACE"," ",176],["T_BOOLEAN_OR","||",176],["T_WHITESPACE"," ",176],["T_STRING","strpos",176],"(",["T_VARIABLE","$folder",176],",",["T_WHITESPACE"," ",176],["T_CONSTANT_ENCAPSED_STRING","'\/'",176],")",["T_WHITESPACE"," ",176],["T_IS_NOT_IDENTICAL","!==",176],["T_WHITESPACE"," ",176],["T_STRING","false",176],["T_WHITESPACE","\n            ",176],["T_BOOLEAN_OR","||",177],["T_WHITESPACE"," ",177],["T_STRING","dirname",177],"(",["T_VARIABLE","$fulldir",177],")",["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_STRING","DIRECTORY_SEPARATOR",177],["T_WHITESPACE"," ",177],["T_IS_NOT_EQUAL","!=",177],["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","_rootdir",177],")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n            ",177],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",178],["T_WHITESPACE","\n            ",180],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",181],["T_WHITESPACE","            ",182],["T_THROW","throw",182],["T_WHITESPACE"," ",182],["T_NEW","new",182],["T_WHITESPACE"," ",182],["T_STRING","Zend_Mail_Storage_Exception",182],"(",["T_CONSTANT_ENCAPSED_STRING","'invalid name - no directory seprator allowed in folder name'",182],")",";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n\n        ",183],["T_COMMENT","\/\/ has a parent folder?\n",185],["T_WHITESPACE","        ",186],["T_VARIABLE","$parent",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","null",186],";",["T_WHITESPACE","\n        ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_STRING","strpos",187],"(",["T_VARIABLE","$folder",187],",",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","_delim",187],")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_COMMENT","\/\/ let's see if the parent folder exists\n",188],["T_WHITESPACE","            ",189],["T_VARIABLE","$parent",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_STRING","substr",189],"(",["T_VARIABLE","$folder",189],",",["T_WHITESPACE"," ",189],["T_LNUMBER","0",189],",",["T_WHITESPACE"," ",189],["T_STRING","strrpos",189],"(",["T_VARIABLE","$folder",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","_delim",189],")",")",";",["T_WHITESPACE","\n            ",189],["T_TRY","try",190],["T_WHITESPACE"," ",190],"{",["T_WHITESPACE","\n                ",190],["T_VARIABLE","$this",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getFolders",191],"(",["T_VARIABLE","$parent",191],")",";",["T_WHITESPACE","\n            ",191],"}",["T_WHITESPACE"," ",192],["T_CATCH","catch",192],["T_WHITESPACE"," ",192],"(",["T_STRING","Zend_Mail_Exception",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$e",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n                ",192],["T_COMMENT","\/\/ does not - create parent folder\n",193],["T_WHITESPACE","                ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","createFolder",194],"(",["T_VARIABLE","$parent",194],")",";",["T_WHITESPACE","\n            ",194],"}",["T_WHITESPACE","\n        ",195],"}",["T_WHITESPACE","\n\n        ",196],["T_IF","if",198],["T_WHITESPACE"," ",198],"(","!","@",["T_STRING","mkdir",198],"(",["T_VARIABLE","$fulldir",198],")",["T_WHITESPACE"," ",198],["T_BOOLEAN_OR","||",198],["T_WHITESPACE"," ",198],"!","@",["T_STRING","mkdir",198],"(",["T_VARIABLE","$fulldir",198],["T_WHITESPACE"," ",198],".",["T_WHITESPACE"," ",198],["T_STRING","DIRECTORY_SEPARATOR",198],["T_WHITESPACE"," ",198],".",["T_WHITESPACE"," ",198],["T_CONSTANT_ENCAPSED_STRING","'cur'",198],")",")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",199],["T_WHITESPACE","\n            ",201],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",202],["T_WHITESPACE","            ",203],["T_THROW","throw",203],["T_WHITESPACE"," ",203],["T_NEW","new",203],["T_WHITESPACE"," ",203],["T_STRING","Zend_Mail_Storage_Exception",203],"(",["T_CONSTANT_ENCAPSED_STRING","'error while creating new folder, may be created incompletly'",203],")",";",["T_WHITESPACE","\n        ",203],"}",["T_WHITESPACE","\n\n        ",204],["T_STRING","mkdir",206],"(",["T_VARIABLE","$fulldir",206],["T_WHITESPACE"," ",206],".",["T_WHITESPACE"," ",206],["T_STRING","DIRECTORY_SEPARATOR",206],["T_WHITESPACE"," ",206],".",["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","'new'",206],")",";",["T_WHITESPACE","\n        ",206],["T_STRING","mkdir",207],"(",["T_VARIABLE","$fulldir",207],["T_WHITESPACE"," ",207],".",["T_WHITESPACE"," ",207],["T_STRING","DIRECTORY_SEPARATOR",207],["T_WHITESPACE"," ",207],".",["T_WHITESPACE"," ",207],["T_CONSTANT_ENCAPSED_STRING","'tmp'",207],")",";",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$localName",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$parent",209],["T_WHITESPACE"," ",209],"?",["T_WHITESPACE"," ",209],["T_STRING","substr",209],"(",["T_VARIABLE","$folder",209],",",["T_WHITESPACE"," ",209],["T_STRING","strlen",209],"(",["T_VARIABLE","$parent",209],")",["T_WHITESPACE"," ",209],"+",["T_WHITESPACE"," ",209],["T_LNUMBER","1",209],")",["T_WHITESPACE"," ",209],":",["T_WHITESPACE"," ",209],["T_VARIABLE","$folder",209],";",["T_WHITESPACE","\n        ",209],["T_VARIABLE","$this",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","getFolders",210],"(",["T_VARIABLE","$parent",210],")",["T_OBJECT_OPERATOR","->",210],["T_VARIABLE","$localName",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_NEW","new",210],["T_WHITESPACE"," ",210],["T_STRING","Zend_Mail_Storage_Folder",210],"(",["T_VARIABLE","$localName",210],",",["T_WHITESPACE"," ",210],["T_VARIABLE","$folder",210],",",["T_WHITESPACE"," ",210],["T_STRING","true",210],")",";",["T_WHITESPACE","\n\n        ",210],["T_RETURN","return",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$fulldir",212],";",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * remove a folder\n     *\n     * @param   string|Zend_Mail_Storage_Folder $name      name or instance of folder\n     * @return  null\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",215],["T_WHITESPACE","\n    ",221],["T_PUBLIC","public",222],["T_WHITESPACE"," ",222],["T_FUNCTION","function",222],["T_WHITESPACE"," ",222],["T_STRING","removeFolder",222],"(",["T_VARIABLE","$name",222],")",["T_WHITESPACE","\n    ",222],"{",["T_WHITESPACE","\n        ",223],["T_COMMENT","\/\/ TODO: This could fail in the middle of the task, which is not optimal.\n",224],["T_WHITESPACE","        ",225],["T_COMMENT","\/\/ But there is no defined standard way to mark a folder as removed and there is no atomar fs-op\n",225],["T_WHITESPACE","        ",226],["T_COMMENT","\/\/ to remove a directory. Also moving the folder to a\/the trash folder is not possible, as\n",226],["T_WHITESPACE","        ",227],["T_COMMENT","\/\/ all parent folders must be created. What we could do is add a dash to the front of the\n",227],["T_WHITESPACE","        ",228],["T_COMMENT","\/\/ directory name and it should be ignored as long as other processes obey the standard.\n",228],["T_WHITESPACE","\n        ",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$name",230],["T_WHITESPACE"," ",230],["T_INSTANCEOF","instanceof",230],["T_WHITESPACE"," ",230],["T_STRING","Zend_Mail_Storage_Folder",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n            ",230],["T_VARIABLE","$name",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$name",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","getGlobalName",231],"(",")",";",["T_WHITESPACE","\n        ",231],"}",["T_WHITESPACE","\n\n        ",232],["T_VARIABLE","$name",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","trim",234],"(",["T_VARIABLE","$name",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$this",234],["T_OBJECT_OPERATOR","->",234],["T_STRING","_delim",234],")",";",["T_WHITESPACE","\n        ",234],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_STRING","strpos",235],"(",["T_VARIABLE","$name",235],",",["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",235],["T_WHITESPACE"," ",235],".",["T_WHITESPACE"," ",235],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","_delim",235],")",["T_WHITESPACE"," ",235],["T_IS_IDENTICAL","===",235],["T_WHITESPACE"," ",235],["T_LNUMBER","0",235],")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n            ",235],["T_VARIABLE","$name",236],["T_WHITESPACE"," ",236],"=",["T_WHITESPACE"," ",236],["T_STRING","substr",236],"(",["T_VARIABLE","$name",236],",",["T_WHITESPACE"," ",236],["T_LNUMBER","6",236],")",";",["T_WHITESPACE","\n        ",236],"}",["T_WHITESPACE","\n\n        ",237],["T_COMMENT","\/\/ check if folder exists and has no children\n",239],["T_WHITESPACE","        ",240],["T_IF","if",240],["T_WHITESPACE"," ",240],"(","!",["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","getFolders",240],"(",["T_VARIABLE","$name",240],")",["T_OBJECT_OPERATOR","->",240],["T_STRING","isLeaf",240],"(",")",")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",241],["T_WHITESPACE","\n            ",243],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",244],["T_WHITESPACE","            ",245],["T_THROW","throw",245],["T_WHITESPACE"," ",245],["T_NEW","new",245],["T_WHITESPACE"," ",245],["T_STRING","Zend_Mail_Storage_Exception",245],"(",["T_CONSTANT_ENCAPSED_STRING","'delete children first'",245],")",";",["T_WHITESPACE","\n        ",245],"}",["T_WHITESPACE","\n\n        ",246],["T_IF","if",248],["T_WHITESPACE"," ",248],"(",["T_VARIABLE","$name",248],["T_WHITESPACE"," ",248],["T_IS_EQUAL","==",248],["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",248],["T_WHITESPACE"," ",248],["T_BOOLEAN_OR","||",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$name",248],["T_WHITESPACE"," ",248],["T_IS_EQUAL","==",248],["T_WHITESPACE"," ",248],["T_STRING","DIRECTORY_SEPARATOR",248],["T_WHITESPACE"," ",248],["T_BOOLEAN_OR","||",248],["T_WHITESPACE"," ",248],["T_VARIABLE","$name",248],["T_WHITESPACE"," ",248],["T_IS_EQUAL","==",248],["T_WHITESPACE"," ",248],["T_CONSTANT_ENCAPSED_STRING","'\/'",248],")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n            ",248],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",249],["T_WHITESPACE","\n            ",251],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",252],["T_WHITESPACE","            ",253],["T_THROW","throw",253],["T_WHITESPACE"," ",253],["T_NEW","new",253],["T_WHITESPACE"," ",253],["T_STRING","Zend_Mail_Storage_Exception",253],"(",["T_CONSTANT_ENCAPSED_STRING","'wont delete INBOX'",253],")",";",["T_WHITESPACE","\n        ",253],"}",["T_WHITESPACE","\n\n        ",254],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_VARIABLE","$name",256],["T_WHITESPACE"," ",256],["T_IS_EQUAL","==",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","getCurrentFolder",256],"(",")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",257],["T_WHITESPACE","\n            ",259],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",260],["T_WHITESPACE","            ",261],["T_THROW","throw",261],["T_WHITESPACE"," ",261],["T_NEW","new",261],["T_WHITESPACE"," ",261],["T_STRING","Zend_Mail_Storage_Exception",261],"(",["T_CONSTANT_ENCAPSED_STRING","'wont delete selected folder'",261],")",";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n\n        ",262],["T_FOREACH","foreach",264],["T_WHITESPACE"," ",264],"(",["T_ARRAY","array",264],"(",["T_CONSTANT_ENCAPSED_STRING","'tmp'",264],",",["T_WHITESPACE"," ",264],["T_CONSTANT_ENCAPSED_STRING","'new'",264],",",["T_WHITESPACE"," ",264],["T_CONSTANT_ENCAPSED_STRING","'cur'",264],",",["T_WHITESPACE"," ",264],["T_CONSTANT_ENCAPSED_STRING","'.'",264],")",["T_WHITESPACE"," ",264],["T_AS","as",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$subdir",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$dir",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$this",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","_rootdir",265],["T_WHITESPACE"," ",265],".",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","'.'",265],["T_WHITESPACE"," ",265],".",["T_WHITESPACE"," ",265],["T_VARIABLE","$name",265],["T_WHITESPACE"," ",265],".",["T_WHITESPACE"," ",265],["T_STRING","DIRECTORY_SEPARATOR",265],["T_WHITESPACE"," ",265],".",["T_WHITESPACE"," ",265],["T_VARIABLE","$subdir",265],";",["T_WHITESPACE","\n            ",265],["T_IF","if",266],["T_WHITESPACE"," ",266],"(","!",["T_STRING","file_exists",266],"(",["T_VARIABLE","$dir",266],")",")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n                ",266],["T_CONTINUE","continue",267],";",["T_WHITESPACE","\n            ",267],"}",["T_WHITESPACE","\n            ",268],["T_VARIABLE","$dh",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_STRING","opendir",269],"(",["T_VARIABLE","$dir",269],")",";",["T_WHITESPACE","\n            ",269],["T_IF","if",270],["T_WHITESPACE"," ",270],"(","!",["T_VARIABLE","$dh",270],")",["T_WHITESPACE"," ",270],"{",["T_WHITESPACE","\n                ",270],["T_DOC_COMMENT","\/**\n                 * @see Zend_Mail_Storage_Exception\n                 *\/",271],["T_WHITESPACE","\n                ",273],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",274],["T_WHITESPACE","                ",275],["T_THROW","throw",275],["T_WHITESPACE"," ",275],["T_NEW","new",275],["T_WHITESPACE"," ",275],["T_STRING","Zend_Mail_Storage_Exception",275],"(","\"",["T_ENCAPSED_AND_WHITESPACE","error opening ",275],["T_VARIABLE","$subdir",275],"\"",")",";",["T_WHITESPACE","\n            ",275],"}",["T_WHITESPACE","\n            ",276],["T_WHILE","while",277],["T_WHITESPACE"," ",277],"(","(",["T_VARIABLE","$entry",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_STRING","readdir",277],"(",["T_VARIABLE","$dh",277],")",")",["T_WHITESPACE"," ",277],["T_IS_NOT_IDENTICAL","!==",277],["T_WHITESPACE"," ",277],["T_STRING","false",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n                ",277],["T_IF","if",278],["T_WHITESPACE"," ",278],"(",["T_VARIABLE","$entry",278],["T_WHITESPACE"," ",278],["T_IS_EQUAL","==",278],["T_WHITESPACE"," ",278],["T_CONSTANT_ENCAPSED_STRING","'.'",278],["T_WHITESPACE"," ",278],["T_BOOLEAN_OR","||",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$entry",278],["T_WHITESPACE"," ",278],["T_IS_EQUAL","==",278],["T_WHITESPACE"," ",278],["T_CONSTANT_ENCAPSED_STRING","'..'",278],")",["T_WHITESPACE"," ",278],"{",["T_WHITESPACE","\n                    ",278],["T_CONTINUE","continue",279],";",["T_WHITESPACE","\n                ",279],"}",["T_WHITESPACE","\n                ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(","!",["T_STRING","unlink",281],"(",["T_VARIABLE","$dir",281],["T_WHITESPACE"," ",281],".",["T_WHITESPACE"," ",281],["T_STRING","DIRECTORY_SEPARATOR",281],["T_WHITESPACE"," ",281],".",["T_WHITESPACE"," ",281],["T_VARIABLE","$entry",281],")",")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n                    ",281],["T_DOC_COMMENT","\/**\n                     * @see Zend_Mail_Storage_Exception\n                     *\/",282],["T_WHITESPACE","\n                    ",284],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",285],["T_WHITESPACE","                    ",286],["T_THROW","throw",286],["T_WHITESPACE"," ",286],["T_NEW","new",286],["T_WHITESPACE"," ",286],["T_STRING","Zend_Mail_Storage_Exception",286],"(","\"",["T_ENCAPSED_AND_WHITESPACE","error cleaning ",286],["T_VARIABLE","$subdir",286],"\"",")",";",["T_WHITESPACE","\n                ",286],"}",["T_WHITESPACE","\n            ",287],"}",["T_WHITESPACE","\n            ",288],["T_STRING","closedir",289],"(",["T_VARIABLE","$dh",289],")",";",["T_WHITESPACE","\n            ",289],["T_IF","if",290],["T_WHITESPACE"," ",290],"(",["T_VARIABLE","$subdir",290],["T_WHITESPACE"," ",290],["T_IS_NOT_IDENTICAL","!==",290],["T_WHITESPACE"," ",290],["T_CONSTANT_ENCAPSED_STRING","'.'",290],")",["T_WHITESPACE"," ",290],"{",["T_WHITESPACE","\n                ",290],["T_IF","if",291],["T_WHITESPACE"," ",291],"(","!",["T_STRING","rmdir",291],"(",["T_VARIABLE","$dir",291],")",")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n                    ",291],["T_DOC_COMMENT","\/**\n                     * @see Zend_Mail_Storage_Exception\n                     *\/",292],["T_WHITESPACE","\n                    ",294],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",295],["T_WHITESPACE","                    ",296],["T_THROW","throw",296],["T_WHITESPACE"," ",296],["T_NEW","new",296],["T_WHITESPACE"," ",296],["T_STRING","Zend_Mail_Storage_Exception",296],"(","\"",["T_ENCAPSED_AND_WHITESPACE","error removing ",296],["T_VARIABLE","$subdir",296],"\"",")",";",["T_WHITESPACE","\n                ",296],"}",["T_WHITESPACE","\n            ",297],"}",["T_WHITESPACE","\n        ",298],"}",["T_WHITESPACE","\n\n        ",299],["T_IF","if",301],["T_WHITESPACE"," ",301],"(","!",["T_STRING","rmdir",301],"(",["T_VARIABLE","$this",301],["T_OBJECT_OPERATOR","->",301],["T_STRING","_rootdir",301],["T_WHITESPACE"," ",301],".",["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","'.'",301],["T_WHITESPACE"," ",301],".",["T_WHITESPACE"," ",301],["T_VARIABLE","$name",301],")",")",["T_WHITESPACE"," ",301],"{",["T_WHITESPACE","\n            ",301],["T_COMMENT","\/\/ at least we should try to make it a valid maildir again\n",302],["T_WHITESPACE","            ",303],["T_STRING","mkdir",303],"(",["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","_rootdir",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'.'",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_VARIABLE","$name",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_STRING","DIRECTORY_SEPARATOR",303],["T_WHITESPACE"," ",303],".",["T_WHITESPACE"," ",303],["T_CONSTANT_ENCAPSED_STRING","'cur'",303],")",";",["T_WHITESPACE","\n            ",303],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",304],["T_WHITESPACE","\n            ",306],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",307],["T_WHITESPACE","            ",308],["T_THROW","throw",308],["T_WHITESPACE"," ",308],["T_NEW","new",308],["T_WHITESPACE"," ",308],["T_STRING","Zend_Mail_Storage_Exception",308],"(",["T_CONSTANT_ENCAPSED_STRING","\"error removing maindir\"",308],")",";",["T_WHITESPACE","\n        ",308],"}",["T_WHITESPACE","\n\n        ",309],["T_VARIABLE","$parent",311],["T_WHITESPACE"," ",311],"=",["T_WHITESPACE"," ",311],["T_STRING","strpos",311],"(",["T_VARIABLE","$name",311],",",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_delim",311],")",["T_WHITESPACE"," ",311],"?",["T_WHITESPACE"," ",311],["T_STRING","substr",311],"(",["T_VARIABLE","$name",311],",",["T_WHITESPACE"," ",311],["T_LNUMBER","0",311],",",["T_WHITESPACE"," ",311],["T_STRING","strrpos",311],"(",["T_VARIABLE","$name",311],",",["T_WHITESPACE"," ",311],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","_delim",311],")",")",["T_WHITESPACE"," ",311],":",["T_WHITESPACE"," ",311],["T_STRING","null",311],";",["T_WHITESPACE","\n        ",311],["T_VARIABLE","$localName",312],["T_WHITESPACE"," ",312],"=",["T_WHITESPACE"," ",312],["T_VARIABLE","$parent",312],["T_WHITESPACE"," ",312],"?",["T_WHITESPACE"," ",312],["T_STRING","substr",312],"(",["T_VARIABLE","$name",312],",",["T_WHITESPACE"," ",312],["T_STRING","strlen",312],"(",["T_VARIABLE","$parent",312],")",["T_WHITESPACE"," ",312],"+",["T_WHITESPACE"," ",312],["T_LNUMBER","1",312],")",["T_WHITESPACE"," ",312],":",["T_WHITESPACE"," ",312],["T_VARIABLE","$name",312],";",["T_WHITESPACE","\n        ",312],["T_UNSET","unset",313],"(",["T_VARIABLE","$this",313],["T_OBJECT_OPERATOR","->",313],["T_STRING","getFolders",313],"(",["T_VARIABLE","$parent",313],")",["T_OBJECT_OPERATOR","->",313],["T_VARIABLE","$localName",313],")",";",["T_WHITESPACE","\n    ",313],"}",["T_WHITESPACE","\n\n    ",314],["T_DOC_COMMENT","\/**\n     * rename and\/or move folder\n     *\n     * The new name has the same restrictions as in createFolder()\n     *\n     * @param   string|Zend_Mail_Storage_Folder $oldName name or instance of folder\n     * @param   string                          $newName new global name of folder\n     * @return  null\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",316],["T_WHITESPACE","\n    ",325],["T_PUBLIC","public",326],["T_WHITESPACE"," ",326],["T_FUNCTION","function",326],["T_WHITESPACE"," ",326],["T_STRING","renameFolder",326],"(",["T_VARIABLE","$oldName",326],",",["T_WHITESPACE"," ",326],["T_VARIABLE","$newName",326],")",["T_WHITESPACE","\n    ",326],"{",["T_WHITESPACE","\n        ",327],["T_COMMENT","\/\/ TODO: This is also not atomar and has similar problems as removeFolder()\n",328],["T_WHITESPACE","\n        ",329],["T_IF","if",330],["T_WHITESPACE"," ",330],"(",["T_VARIABLE","$oldName",330],["T_WHITESPACE"," ",330],["T_INSTANCEOF","instanceof",330],["T_WHITESPACE"," ",330],["T_STRING","Zend_Mail_Storage_Folder",330],")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n            ",330],["T_VARIABLE","$oldName",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_VARIABLE","$oldName",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","getGlobalName",331],"(",")",";",["T_WHITESPACE","\n        ",331],"}",["T_WHITESPACE","\n\n        ",332],["T_VARIABLE","$oldName",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_STRING","trim",334],"(",["T_VARIABLE","$oldName",334],",",["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","_delim",334],")",";",["T_WHITESPACE","\n        ",334],["T_IF","if",335],["T_WHITESPACE"," ",335],"(",["T_STRING","strpos",335],"(",["T_VARIABLE","$oldName",335],",",["T_WHITESPACE"," ",335],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",335],["T_WHITESPACE"," ",335],".",["T_WHITESPACE"," ",335],["T_VARIABLE","$this",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","_delim",335],")",["T_WHITESPACE"," ",335],["T_IS_IDENTICAL","===",335],["T_WHITESPACE"," ",335],["T_LNUMBER","0",335],")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n            ",335],["T_VARIABLE","$oldName",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_STRING","substr",336],"(",["T_VARIABLE","$oldName",336],",",["T_WHITESPACE"," ",336],["T_LNUMBER","6",336],")",";",["T_WHITESPACE","\n        ",336],"}",["T_WHITESPACE","\n\n        ",337],["T_VARIABLE","$newName",339],["T_WHITESPACE"," ",339],"=",["T_WHITESPACE"," ",339],["T_STRING","trim",339],"(",["T_VARIABLE","$newName",339],",",["T_WHITESPACE"," ",339],["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","_delim",339],")",";",["T_WHITESPACE","\n        ",339],["T_IF","if",340],["T_WHITESPACE"," ",340],"(",["T_STRING","strpos",340],"(",["T_VARIABLE","$newName",340],",",["T_WHITESPACE"," ",340],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",340],["T_WHITESPACE"," ",340],".",["T_WHITESPACE"," ",340],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","_delim",340],")",["T_WHITESPACE"," ",340],["T_IS_IDENTICAL","===",340],["T_WHITESPACE"," ",340],["T_LNUMBER","0",340],")",["T_WHITESPACE"," ",340],"{",["T_WHITESPACE","\n            ",340],["T_VARIABLE","$newName",341],["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_STRING","substr",341],"(",["T_VARIABLE","$newName",341],",",["T_WHITESPACE"," ",341],["T_LNUMBER","6",341],")",";",["T_WHITESPACE","\n        ",341],"}",["T_WHITESPACE","\n\n        ",342],["T_IF","if",344],["T_WHITESPACE"," ",344],"(",["T_STRING","strpos",344],"(",["T_VARIABLE","$newName",344],",",["T_WHITESPACE"," ",344],["T_VARIABLE","$oldName",344],["T_WHITESPACE"," ",344],".",["T_WHITESPACE"," ",344],["T_VARIABLE","$this",344],["T_OBJECT_OPERATOR","->",344],["T_STRING","_delim",344],")",["T_WHITESPACE"," ",344],["T_IS_IDENTICAL","===",344],["T_WHITESPACE"," ",344],["T_LNUMBER","0",344],")",["T_WHITESPACE"," ",344],"{",["T_WHITESPACE","\n            ",344],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",345],["T_WHITESPACE","\n            ",347],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",348],["T_WHITESPACE","            ",349],["T_THROW","throw",349],["T_WHITESPACE"," ",349],["T_NEW","new",349],["T_WHITESPACE"," ",349],["T_STRING","Zend_Mail_Storage_Exception",349],"(",["T_CONSTANT_ENCAPSED_STRING","'new folder cannot be a child of old folder'",349],")",";",["T_WHITESPACE","\n        ",349],"}",["T_WHITESPACE","\n\n        ",350],["T_COMMENT","\/\/ check if folder exists and has no children\n",352],["T_WHITESPACE","        ",353],["T_VARIABLE","$folder",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_VARIABLE","$this",353],["T_OBJECT_OPERATOR","->",353],["T_STRING","getFolders",353],"(",["T_VARIABLE","$oldName",353],")",";",["T_WHITESPACE","\n\n        ",353],["T_IF","if",355],["T_WHITESPACE"," ",355],"(",["T_VARIABLE","$oldName",355],["T_WHITESPACE"," ",355],["T_IS_EQUAL","==",355],["T_WHITESPACE"," ",355],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",355],["T_WHITESPACE"," ",355],["T_BOOLEAN_OR","||",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$oldName",355],["T_WHITESPACE"," ",355],["T_IS_EQUAL","==",355],["T_WHITESPACE"," ",355],["T_STRING","DIRECTORY_SEPARATOR",355],["T_WHITESPACE"," ",355],["T_BOOLEAN_OR","||",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$oldName",355],["T_WHITESPACE"," ",355],["T_IS_EQUAL","==",355],["T_WHITESPACE"," ",355],["T_CONSTANT_ENCAPSED_STRING","'\/'",355],")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n            ",355],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",356],["T_WHITESPACE","\n            ",358],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",359],["T_WHITESPACE","            ",360],["T_THROW","throw",360],["T_WHITESPACE"," ",360],["T_NEW","new",360],["T_WHITESPACE"," ",360],["T_STRING","Zend_Mail_Storage_Exception",360],"(",["T_CONSTANT_ENCAPSED_STRING","'wont rename INBOX'",360],")",";",["T_WHITESPACE","\n        ",360],"}",["T_WHITESPACE","\n\n        ",361],["T_IF","if",363],["T_WHITESPACE"," ",363],"(",["T_VARIABLE","$oldName",363],["T_WHITESPACE"," ",363],["T_IS_EQUAL","==",363],["T_WHITESPACE"," ",363],["T_VARIABLE","$this",363],["T_OBJECT_OPERATOR","->",363],["T_STRING","getCurrentFolder",363],"(",")",")",["T_WHITESPACE"," ",363],"{",["T_WHITESPACE","\n            ",363],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",364],["T_WHITESPACE","\n            ",366],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",367],["T_WHITESPACE","            ",368],["T_THROW","throw",368],["T_WHITESPACE"," ",368],["T_NEW","new",368],["T_WHITESPACE"," ",368],["T_STRING","Zend_Mail_Storage_Exception",368],"(",["T_CONSTANT_ENCAPSED_STRING","'wont rename selected folder'",368],")",";",["T_WHITESPACE","\n        ",368],"}",["T_WHITESPACE","\n\n        ",369],["T_VARIABLE","$newdir",371],["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_VARIABLE","$this",371],["T_OBJECT_OPERATOR","->",371],["T_STRING","createFolder",371],"(",["T_VARIABLE","$newName",371],")",";",["T_WHITESPACE","\n\n        ",371],["T_IF","if",373],["T_WHITESPACE"," ",373],"(","!",["T_VARIABLE","$folder",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","isLeaf",373],"(",")",")",["T_WHITESPACE"," ",373],"{",["T_WHITESPACE","\n            ",373],["T_FOREACH","foreach",374],["T_WHITESPACE"," ",374],"(",["T_VARIABLE","$folder",374],["T_WHITESPACE"," ",374],["T_AS","as",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$k",374],["T_WHITESPACE"," ",374],["T_DOUBLE_ARROW","=>",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$v",374],")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n                ",374],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","renameFolder",375],"(",["T_VARIABLE","$v",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getGlobalName",375],"(",")",",",["T_WHITESPACE"," ",375],["T_VARIABLE","$newName",375],["T_WHITESPACE"," ",375],".",["T_WHITESPACE"," ",375],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","_delim",375],["T_WHITESPACE"," ",375],".",["T_WHITESPACE"," ",375],["T_VARIABLE","$k",375],")",";",["T_WHITESPACE","\n            ",375],"}",["T_WHITESPACE","\n        ",376],"}",["T_WHITESPACE","\n\n        ",377],["T_VARIABLE","$olddir",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_VARIABLE","$this",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","_rootdir",379],["T_WHITESPACE"," ",379],".",["T_WHITESPACE"," ",379],["T_CONSTANT_ENCAPSED_STRING","'.'",379],["T_WHITESPACE"," ",379],".",["T_WHITESPACE"," ",379],["T_VARIABLE","$folder",379],";",["T_WHITESPACE","\n        ",379],["T_FOREACH","foreach",380],["T_WHITESPACE"," ",380],"(",["T_ARRAY","array",380],"(",["T_CONSTANT_ENCAPSED_STRING","'tmp'",380],",",["T_WHITESPACE"," ",380],["T_CONSTANT_ENCAPSED_STRING","'new'",380],",",["T_WHITESPACE"," ",380],["T_CONSTANT_ENCAPSED_STRING","'cur'",380],")",["T_WHITESPACE"," ",380],["T_AS","as",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$subdir",380],")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n            ",380],["T_VARIABLE","$subdir",381],["T_WHITESPACE"," ",381],"=",["T_WHITESPACE"," ",381],["T_STRING","DIRECTORY_SEPARATOR",381],["T_WHITESPACE"," ",381],".",["T_WHITESPACE"," ",381],["T_VARIABLE","$subdir",381],";",["T_WHITESPACE","\n            ",381],["T_IF","if",382],["T_WHITESPACE"," ",382],"(","!",["T_STRING","file_exists",382],"(",["T_VARIABLE","$olddir",382],["T_WHITESPACE"," ",382],".",["T_WHITESPACE"," ",382],["T_VARIABLE","$subdir",382],")",")",["T_WHITESPACE"," ",382],"{",["T_WHITESPACE","\n                ",382],["T_CONTINUE","continue",383],";",["T_WHITESPACE","\n            ",383],"}",["T_WHITESPACE","\n            ",384],["T_COMMENT","\/\/ using copy or moving files would be even better - but also much slower\n",385],["T_WHITESPACE","            ",386],["T_IF","if",386],["T_WHITESPACE"," ",386],"(","!",["T_STRING","rename",386],"(",["T_VARIABLE","$olddir",386],["T_WHITESPACE"," ",386],".",["T_WHITESPACE"," ",386],["T_VARIABLE","$subdir",386],",",["T_WHITESPACE"," ",386],["T_VARIABLE","$newdir",386],["T_WHITESPACE"," ",386],".",["T_WHITESPACE"," ",386],["T_VARIABLE","$subdir",386],")",")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n                ",386],["T_DOC_COMMENT","\/**\n                 * @see Zend_Mail_Storage_Exception\n                 *\/",387],["T_WHITESPACE","\n                ",389],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",390],["T_WHITESPACE","                ",391],["T_THROW","throw",391],["T_WHITESPACE"," ",391],["T_NEW","new",391],["T_WHITESPACE"," ",391],["T_STRING","Zend_Mail_Storage_Exception",391],"(",["T_CONSTANT_ENCAPSED_STRING","'error while moving '",391],["T_WHITESPACE"," ",391],".",["T_WHITESPACE"," ",391],["T_VARIABLE","$subdir",391],")",";",["T_WHITESPACE","\n            ",391],"}",["T_WHITESPACE","\n        ",392],"}",["T_WHITESPACE","\n        ",393],["T_COMMENT","\/\/ create a dummy if removing fails - otherwise we can't read it next time\n",394],["T_WHITESPACE","        ",395],["T_STRING","mkdir",395],"(",["T_VARIABLE","$olddir",395],["T_WHITESPACE"," ",395],".",["T_WHITESPACE"," ",395],["T_STRING","DIRECTORY_SEPARATOR",395],["T_WHITESPACE"," ",395],".",["T_WHITESPACE"," ",395],["T_CONSTANT_ENCAPSED_STRING","'cur'",395],")",";",["T_WHITESPACE","\n        ",395],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","removeFolder",396],"(",["T_VARIABLE","$oldName",396],")",";",["T_WHITESPACE","\n    ",396],"}",["T_WHITESPACE","\n\n    ",397],["T_DOC_COMMENT","\/**\n     * create a uniqueid for maildir filename\n     *\n     * This is nearly the format defined in the maildir standard. The microtime() call should already\n     * create a uniqueid, the pid is for multicore\/-cpu machine that manage to call this function at the\n     * exact same time, and uname() gives us the hostname for multiple machines accessing the same storage.\n     *\n     * If someone disables posix we create a random number of the same size, so this method should also\n     * work on Windows - if you manage to get maildir working on Windows.\n     * Microtime could also be disabled, altough I've never seen it.\n     *\n     * @return string new uniqueid\n     *\/",399],["T_WHITESPACE","\n    ",411],["T_PROTECTED","protected",412],["T_WHITESPACE"," ",412],["T_FUNCTION","function",412],["T_WHITESPACE"," ",412],["T_STRING","_createUniqueId",412],"(",")",["T_WHITESPACE","\n    ",412],"{",["T_WHITESPACE","\n        ",413],["T_VARIABLE","$id",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_CONSTANT_ENCAPSED_STRING","''",414],";",["T_WHITESPACE","\n        ",414],["T_VARIABLE","$id",415],["T_WHITESPACE"," ",415],["T_CONCAT_EQUAL",".=",415],["T_WHITESPACE"," ",415],["T_STRING","function_exists",415],"(",["T_CONSTANT_ENCAPSED_STRING","'microtime'",415],")",["T_WHITESPACE"," ",415],"?",["T_WHITESPACE"," ",415],["T_STRING","microtime",415],"(",["T_STRING","true",415],")",["T_WHITESPACE"," ",415],":",["T_WHITESPACE"," ",415],"(",["T_STRING","time",415],"(",")",["T_WHITESPACE"," ",415],".",["T_WHITESPACE"," ",415],["T_CONSTANT_ENCAPSED_STRING","' '",415],["T_WHITESPACE"," ",415],".",["T_WHITESPACE"," ",415],["T_STRING","rand",415],"(",["T_LNUMBER","0",415],",",["T_WHITESPACE"," ",415],["T_LNUMBER","100000",415],")",")",";",["T_WHITESPACE","\n        ",415],["T_VARIABLE","$id",416],["T_WHITESPACE"," ",416],["T_CONCAT_EQUAL",".=",416],["T_WHITESPACE"," ",416],["T_CONSTANT_ENCAPSED_STRING","'.'",416],["T_WHITESPACE"," ",416],".",["T_WHITESPACE"," ",416],"(",["T_STRING","function_exists",416],"(",["T_CONSTANT_ENCAPSED_STRING","'posix_getpid'",416],")",["T_WHITESPACE"," ",416],"?",["T_WHITESPACE"," ",416],["T_STRING","posix_getpid",416],"(",")",["T_WHITESPACE"," ",416],":",["T_WHITESPACE"," ",416],["T_STRING","rand",416],"(",["T_LNUMBER","50",416],",",["T_WHITESPACE"," ",416],["T_LNUMBER","65535",416],")",")",";",["T_WHITESPACE","\n        ",416],["T_VARIABLE","$id",417],["T_WHITESPACE"," ",417],["T_CONCAT_EQUAL",".=",417],["T_WHITESPACE"," ",417],["T_CONSTANT_ENCAPSED_STRING","'.'",417],["T_WHITESPACE"," ",417],".",["T_WHITESPACE"," ",417],["T_STRING","php_uname",417],"(",["T_CONSTANT_ENCAPSED_STRING","'n'",417],")",";",["T_WHITESPACE","\n\n        ",417],["T_RETURN","return",419],["T_WHITESPACE"," ",419],["T_VARIABLE","$id",419],";",["T_WHITESPACE","\n    ",419],"}",["T_WHITESPACE","\n\n    ",420],["T_DOC_COMMENT","\/**\n     * open a temporary maildir file\n     *\n     * makes sure tmp\/ exists and create a file with a unique name\n     * you should close the returned filehandle!\n     *\n     * @param   string $folder name of current folder without leading .\n     * @return  array array('dirname' => dir of maildir folder, 'uniq' => unique id, 'filename' => name of create file\n     *                     'handle'  => file opened for writing)\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",422],["T_WHITESPACE","\n    ",432],["T_PROTECTED","protected",433],["T_WHITESPACE"," ",433],["T_FUNCTION","function",433],["T_WHITESPACE"," ",433],["T_STRING","_createTmpFile",433],"(",["T_VARIABLE","$folder",433],["T_WHITESPACE"," ",433],"=",["T_WHITESPACE"," ",433],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",433],")",["T_WHITESPACE","\n    ",433],"{",["T_WHITESPACE","\n        ",434],["T_IF","if",435],["T_WHITESPACE"," ",435],"(",["T_VARIABLE","$folder",435],["T_WHITESPACE"," ",435],["T_IS_EQUAL","==",435],["T_WHITESPACE"," ",435],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",435],")",["T_WHITESPACE"," ",435],"{",["T_WHITESPACE","\n            ",435],["T_VARIABLE","$tmpdir",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","_rootdir",436],["T_WHITESPACE"," ",436],".",["T_WHITESPACE"," ",436],["T_STRING","DIRECTORY_SEPARATOR",436],["T_WHITESPACE"," ",436],".",["T_WHITESPACE"," ",436],["T_CONSTANT_ENCAPSED_STRING","'tmp'",436],["T_WHITESPACE"," ",436],".",["T_WHITESPACE"," ",436],["T_STRING","DIRECTORY_SEPARATOR",436],";",["T_WHITESPACE","\n        ",436],"}",["T_WHITESPACE"," ",437],["T_ELSE","else",437],["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n            ",437],["T_VARIABLE","$tmpdir",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_VARIABLE","$this",438],["T_OBJECT_OPERATOR","->",438],["T_STRING","_rootdir",438],["T_WHITESPACE"," ",438],".",["T_WHITESPACE"," ",438],["T_CONSTANT_ENCAPSED_STRING","'.'",438],["T_WHITESPACE"," ",438],".",["T_WHITESPACE"," ",438],["T_VARIABLE","$folder",438],["T_WHITESPACE"," ",438],".",["T_WHITESPACE"," ",438],["T_STRING","DIRECTORY_SEPARATOR",438],["T_WHITESPACE"," ",438],".",["T_WHITESPACE"," ",438],["T_CONSTANT_ENCAPSED_STRING","'tmp'",438],["T_WHITESPACE"," ",438],".",["T_WHITESPACE"," ",438],["T_STRING","DIRECTORY_SEPARATOR",438],";",["T_WHITESPACE","\n        ",438],"}",["T_WHITESPACE","\n        ",439],["T_IF","if",440],["T_WHITESPACE"," ",440],"(","!",["T_STRING","file_exists",440],"(",["T_VARIABLE","$tmpdir",440],")",")",["T_WHITESPACE"," ",440],"{",["T_WHITESPACE","\n            ",440],["T_IF","if",441],["T_WHITESPACE"," ",441],"(","!",["T_STRING","mkdir",441],"(",["T_VARIABLE","$tmpdir",441],")",")",["T_WHITESPACE"," ",441],"{",["T_WHITESPACE","\n                ",441],["T_DOC_COMMENT","\/**\n                 * @see Zend_Mail_Storage_Exception\n                 *\/",442],["T_WHITESPACE","\n                ",444],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",445],["T_WHITESPACE","                ",446],["T_THROW","throw",446],["T_WHITESPACE"," ",446],["T_NEW","new",446],["T_WHITESPACE"," ",446],["T_STRING","Zend_Mail_Storage_Exception",446],"(",["T_CONSTANT_ENCAPSED_STRING","'problems creating tmp dir'",446],")",";",["T_WHITESPACE","\n            ",446],"}",["T_WHITESPACE","\n        ",447],"}",["T_WHITESPACE","\n\n        ",448],["T_COMMENT","\/\/ we should retry to create a unique id if a file with the same name exists\n",450],["T_WHITESPACE","        ",451],["T_COMMENT","\/\/ to avoid a script timeout we only wait 1 second (instead of 2) and stop\n",451],["T_WHITESPACE","        ",452],["T_COMMENT","\/\/ after a defined retry count\n",452],["T_WHITESPACE","        ",453],["T_COMMENT","\/\/ if you change this variable take into account that it can take up to $max_tries seconds\n",453],["T_WHITESPACE","        ",454],["T_COMMENT","\/\/ normally we should have a valid unique name after the first try, we're just following the \"standard\" here\n",454],["T_WHITESPACE","        ",455],["T_VARIABLE","$max_tries",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_LNUMBER","5",455],";",["T_WHITESPACE","\n        ",455],["T_FOR","for",456],["T_WHITESPACE"," ",456],"(",["T_VARIABLE","$i",456],["T_WHITESPACE"," ",456],"=",["T_WHITESPACE"," ",456],["T_LNUMBER","0",456],";",["T_WHITESPACE"," ",456],["T_VARIABLE","$i",456],["T_WHITESPACE"," ",456],"<",["T_WHITESPACE"," ",456],["T_VARIABLE","$max_tries",456],";",["T_WHITESPACE"," ",456],["T_INC","++",456],["T_VARIABLE","$i",456],")",["T_WHITESPACE"," ",456],"{",["T_WHITESPACE","\n            ",456],["T_VARIABLE","$uniq",457],["T_WHITESPACE"," ",457],"=",["T_WHITESPACE"," ",457],["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","_createUniqueId",457],"(",")",";",["T_WHITESPACE","\n            ",457],["T_IF","if",458],["T_WHITESPACE"," ",458],"(","!",["T_STRING","file_exists",458],"(",["T_VARIABLE","$tmpdir",458],["T_WHITESPACE"," ",458],".",["T_WHITESPACE"," ",458],["T_VARIABLE","$uniq",458],")",")",["T_WHITESPACE"," ",458],"{",["T_WHITESPACE","\n                ",458],["T_COMMENT","\/\/ here is the race condition! - as defined in the standard\n",459],["T_WHITESPACE","                ",460],["T_COMMENT","\/\/ to avoid having a long time between stat()ing the file and creating it we're opening it here\n",460],["T_WHITESPACE","                ",461],["T_COMMENT","\/\/ to mark the filename as taken\n",461],["T_WHITESPACE","                ",462],["T_VARIABLE","$fh",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_STRING","fopen",462],"(",["T_VARIABLE","$tmpdir",462],["T_WHITESPACE"," ",462],".",["T_WHITESPACE"," ",462],["T_VARIABLE","$uniq",462],",",["T_WHITESPACE"," ",462],["T_CONSTANT_ENCAPSED_STRING","'w'",462],")",";",["T_WHITESPACE","\n                ",462],["T_IF","if",463],["T_WHITESPACE"," ",463],"(","!",["T_VARIABLE","$fh",463],")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n                    ",463],["T_DOC_COMMENT","\/**\n                     * @see Zend_Mail_Storage_Exception\n                     *\/",464],["T_WHITESPACE","\n                    ",466],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",467],["T_WHITESPACE","                    ",468],["T_THROW","throw",468],["T_WHITESPACE"," ",468],["T_NEW","new",468],["T_WHITESPACE"," ",468],["T_STRING","Zend_Mail_Storage_Exception",468],"(",["T_CONSTANT_ENCAPSED_STRING","'could not open temp file'",468],")",";",["T_WHITESPACE","\n                ",468],"}",["T_WHITESPACE","\n                ",469],["T_BREAK","break",470],";",["T_WHITESPACE","\n            ",470],"}",["T_WHITESPACE","\n            ",471],["T_STRING","sleep",472],"(",["T_LNUMBER","1",472],")",";",["T_WHITESPACE","\n        ",472],"}",["T_WHITESPACE","\n\n        ",473],["T_IF","if",475],["T_WHITESPACE"," ",475],"(","!",["T_VARIABLE","$fh",475],")",["T_WHITESPACE"," ",475],"{",["T_WHITESPACE","\n            ",475],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",476],["T_WHITESPACE","\n            ",478],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",479],["T_WHITESPACE","            ",480],["T_THROW","throw",480],["T_WHITESPACE"," ",480],["T_NEW","new",480],["T_WHITESPACE"," ",480],["T_STRING","Zend_Mail_Storage_Exception",480],"(","\"",["T_ENCAPSED_AND_WHITESPACE","tried ",480],["T_VARIABLE","$max_tries",480],["T_ENCAPSED_AND_WHITESPACE"," unique ids for a temp file, but all were taken",480],"\"",["T_WHITESPACE","\n                                                ",480],".",["T_WHITESPACE"," ",481],["T_CONSTANT_ENCAPSED_STRING","' - giving up'",481],")",";",["T_WHITESPACE","\n        ",481],"}",["T_WHITESPACE","\n\n        ",482],["T_RETURN","return",484],["T_WHITESPACE"," ",484],["T_ARRAY","array",484],"(",["T_CONSTANT_ENCAPSED_STRING","'dirname'",484],["T_WHITESPACE"," ",484],["T_DOUBLE_ARROW","=>",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","_rootdir",484],["T_WHITESPACE"," ",484],".",["T_WHITESPACE"," ",484],["T_CONSTANT_ENCAPSED_STRING","'.'",484],["T_WHITESPACE"," ",484],".",["T_WHITESPACE"," ",484],["T_VARIABLE","$folder",484],",",["T_WHITESPACE"," ",484],["T_CONSTANT_ENCAPSED_STRING","'uniq'",484],["T_WHITESPACE"," ",484],["T_DOUBLE_ARROW","=>",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$uniq",484],",",["T_WHITESPACE"," ",484],["T_CONSTANT_ENCAPSED_STRING","'filename'",484],["T_WHITESPACE"," ",484],["T_DOUBLE_ARROW","=>",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$tmpdir",484],["T_WHITESPACE"," ",484],".",["T_WHITESPACE"," ",484],["T_VARIABLE","$uniq",484],",",["T_WHITESPACE","\n                     ",484],["T_CONSTANT_ENCAPSED_STRING","'handle'",485],["T_WHITESPACE"," ",485],["T_DOUBLE_ARROW","=>",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$fh",485],")",";",["T_WHITESPACE","\n    ",485],"}",["T_WHITESPACE","\n\n    ",486],["T_DOC_COMMENT","\/**\n     * create an info string for filenames with given flags\n     *\n     * @param   array $flags wanted flags, with the reference you'll get the set flags with correct key (= char for flag)\n     * @return  string info string for version 2 filenames including the leading colon\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",488],["T_WHITESPACE","\n    ",494],["T_PROTECTED","protected",495],["T_WHITESPACE"," ",495],["T_FUNCTION","function",495],["T_WHITESPACE"," ",495],["T_STRING","_getInfoString",495],"(","&",["T_VARIABLE","$flags",495],")",["T_WHITESPACE","\n    ",495],"{",["T_WHITESPACE","\n        ",496],["T_COMMENT","\/\/ accessing keys is easier, faster and it removes duplicated flags\n",497],["T_WHITESPACE","        ",498],["T_VARIABLE","$wanted_flags",498],["T_WHITESPACE"," ",498],"=",["T_WHITESPACE"," ",498],["T_STRING","array_flip",498],"(",["T_VARIABLE","$flags",498],")",";",["T_WHITESPACE","\n        ",498],["T_IF","if",499],["T_WHITESPACE"," ",499],"(",["T_ISSET","isset",499],"(",["T_VARIABLE","$wanted_flags",499],"[",["T_STRING","Zend_Mail_Storage",499],["T_DOUBLE_COLON","::",499],["T_STRING","FLAG_RECENT",499],"]",")",")",["T_WHITESPACE"," ",499],"{",["T_WHITESPACE","\n            ",499],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",500],["T_WHITESPACE","\n            ",502],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",503],["T_WHITESPACE","            ",504],["T_THROW","throw",504],["T_WHITESPACE"," ",504],["T_NEW","new",504],["T_WHITESPACE"," ",504],["T_STRING","Zend_Mail_Storage_Exception",504],"(",["T_CONSTANT_ENCAPSED_STRING","'recent flag may not be set'",504],")",";",["T_WHITESPACE","\n        ",504],"}",["T_WHITESPACE","\n\n        ",505],["T_VARIABLE","$info",507],["T_WHITESPACE"," ",507],"=",["T_WHITESPACE"," ",507],["T_CONSTANT_ENCAPSED_STRING","':2,'",507],";",["T_WHITESPACE","\n        ",507],["T_VARIABLE","$flags",508],["T_WHITESPACE"," ",508],"=",["T_WHITESPACE"," ",508],["T_ARRAY","array",508],"(",")",";",["T_WHITESPACE","\n        ",508],["T_FOREACH","foreach",509],["T_WHITESPACE"," ",509],"(",["T_STRING","Zend_Mail_Storage_Maildir",509],["T_DOUBLE_COLON","::",509],["T_VARIABLE","$_knownFlags",509],["T_WHITESPACE"," ",509],["T_AS","as",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$char",509],["T_WHITESPACE"," ",509],["T_DOUBLE_ARROW","=>",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$flag",509],")",["T_WHITESPACE"," ",509],"{",["T_WHITESPACE","\n            ",509],["T_IF","if",510],["T_WHITESPACE"," ",510],"(","!",["T_ISSET","isset",510],"(",["T_VARIABLE","$wanted_flags",510],"[",["T_VARIABLE","$flag",510],"]",")",")",["T_WHITESPACE"," ",510],"{",["T_WHITESPACE","\n                ",510],["T_CONTINUE","continue",511],";",["T_WHITESPACE","\n            ",511],"}",["T_WHITESPACE","\n            ",512],["T_VARIABLE","$info",513],["T_WHITESPACE"," ",513],["T_CONCAT_EQUAL",".=",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$char",513],";",["T_WHITESPACE","\n            ",513],["T_VARIABLE","$flags",514],"[",["T_VARIABLE","$char",514],"]",["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_VARIABLE","$flag",514],";",["T_WHITESPACE","\n            ",514],["T_UNSET","unset",515],"(",["T_VARIABLE","$wanted_flags",515],"[",["T_VARIABLE","$flag",515],"]",")",";",["T_WHITESPACE","\n        ",515],"}",["T_WHITESPACE","\n\n        ",516],["T_IF","if",518],["T_WHITESPACE"," ",518],"(","!",["T_EMPTY","empty",518],"(",["T_VARIABLE","$wanted_flags",518],")",")",["T_WHITESPACE"," ",518],"{",["T_WHITESPACE","\n            ",518],["T_VARIABLE","$wanted_flags",519],["T_WHITESPACE"," ",519],"=",["T_WHITESPACE"," ",519],["T_STRING","implode",519],"(",["T_CONSTANT_ENCAPSED_STRING","', '",519],",",["T_WHITESPACE"," ",519],["T_STRING","array_keys",519],"(",["T_VARIABLE","$wanted_flags",519],")",")",";",["T_WHITESPACE","\n            ",519],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",520],["T_WHITESPACE","\n            ",522],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",523],["T_WHITESPACE","            ",524],["T_THROW","throw",524],["T_WHITESPACE"," ",524],["T_NEW","new",524],["T_WHITESPACE"," ",524],["T_STRING","Zend_Mail_Storage_Exception",524],"(",["T_CONSTANT_ENCAPSED_STRING","'unknown flag(s): '",524],["T_WHITESPACE"," ",524],".",["T_WHITESPACE"," ",524],["T_VARIABLE","$wanted_flags",524],")",";",["T_WHITESPACE","\n        ",524],"}",["T_WHITESPACE","\n\n        ",525],["T_RETURN","return",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$info",527],";",["T_WHITESPACE","\n    ",527],"}",["T_WHITESPACE","\n\n    ",528],["T_DOC_COMMENT","\/**\n     * append a new message to mail storage\n     *\n     * @param   string|stream                              $message message as string or stream resource\n     * @param   null|string|Zend_Mail_Storage_Folder       $folder  folder for new message, else current folder is taken\n     * @param   null|array                                 $flags   set flags for new message, else a default set is used\n     * @param   bool                                       $recent  handle this mail as if recent flag has been set,\n     *                                                              should only be used in delivery\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",530],["T_WHITESPACE","\n     ",539],["T_COMMENT","\/\/ not yet * @param string|Zend_Mail_Message|Zend_Mime_Message $message message as string or instance of message class\n",540],["T_WHITESPACE","\n    ",541],["T_PUBLIC","public",542],["T_WHITESPACE"," ",542],["T_FUNCTION","function",542],["T_WHITESPACE"," ",542],["T_STRING","appendMessage",542],"(",["T_VARIABLE","$message",542],",",["T_WHITESPACE"," ",542],["T_VARIABLE","$folder",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_STRING","null",542],",",["T_WHITESPACE"," ",542],["T_VARIABLE","$flags",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_STRING","null",542],",",["T_WHITESPACE"," ",542],["T_VARIABLE","$recent",542],["T_WHITESPACE"," ",542],"=",["T_WHITESPACE"," ",542],["T_STRING","false",542],")",["T_WHITESPACE","\n    ",542],"{",["T_WHITESPACE","\n        ",543],["T_IF","if",544],["T_WHITESPACE"," ",544],"(",["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","_quota",544],["T_WHITESPACE"," ",544],["T_BOOLEAN_AND","&&",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$this",544],["T_OBJECT_OPERATOR","->",544],["T_STRING","checkQuota",544],"(",")",")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n            ",544],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",545],["T_WHITESPACE","\n            ",547],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",548],["T_WHITESPACE","            ",549],["T_THROW","throw",549],["T_WHITESPACE"," ",549],["T_NEW","new",549],["T_WHITESPACE"," ",549],["T_STRING","Zend_Mail_Storage_Exception",549],"(",["T_CONSTANT_ENCAPSED_STRING","'storage is over quota!'",549],")",";",["T_WHITESPACE","\n        ",549],"}",["T_WHITESPACE","\n\n        ",550],["T_IF","if",552],["T_WHITESPACE"," ",552],"(",["T_VARIABLE","$folder",552],["T_WHITESPACE"," ",552],["T_IS_IDENTICAL","===",552],["T_WHITESPACE"," ",552],["T_STRING","null",552],")",["T_WHITESPACE"," ",552],"{",["T_WHITESPACE","\n            ",552],["T_VARIABLE","$folder",553],["T_WHITESPACE"," ",553],"=",["T_WHITESPACE"," ",553],["T_VARIABLE","$this",553],["T_OBJECT_OPERATOR","->",553],["T_STRING","_currentFolder",553],";",["T_WHITESPACE","\n        ",553],"}",["T_WHITESPACE","\n\n        ",554],["T_IF","if",556],["T_WHITESPACE"," ",556],"(","!","(",["T_VARIABLE","$folder",556],["T_WHITESPACE"," ",556],["T_INSTANCEOF","instanceof",556],["T_WHITESPACE"," ",556],["T_STRING","Zend_Mail_Storage_Folder",556],")",")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n            ",556],["T_VARIABLE","$folder",557],["T_WHITESPACE"," ",557],"=",["T_WHITESPACE"," ",557],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getFolders",557],"(",["T_VARIABLE","$folder",557],")",";",["T_WHITESPACE","\n        ",557],"}",["T_WHITESPACE","\n\n        ",558],["T_IF","if",560],["T_WHITESPACE"," ",560],"(",["T_VARIABLE","$flags",560],["T_WHITESPACE"," ",560],["T_IS_IDENTICAL","===",560],["T_WHITESPACE"," ",560],["T_STRING","null",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n            ",560],["T_VARIABLE","$flags",561],["T_WHITESPACE"," ",561],"=",["T_WHITESPACE"," ",561],["T_ARRAY","array",561],"(",["T_STRING","Zend_Mail_Storage",561],["T_DOUBLE_COLON","::",561],["T_STRING","FLAG_SEEN",561],")",";",["T_WHITESPACE","\n        ",561],"}",["T_WHITESPACE","\n        ",562],["T_VARIABLE","$info",563],["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_VARIABLE","$this",563],["T_OBJECT_OPERATOR","->",563],["T_STRING","_getInfoString",563],"(",["T_VARIABLE","$flags",563],")",";",["T_WHITESPACE","\n        ",563],["T_VARIABLE","$temp_file",564],["T_WHITESPACE"," ",564],"=",["T_WHITESPACE"," ",564],["T_VARIABLE","$this",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","_createTmpFile",564],"(",["T_VARIABLE","$folder",564],["T_OBJECT_OPERATOR","->",564],["T_STRING","getGlobalName",564],"(",")",")",";",["T_WHITESPACE","\n\n        ",564],["T_COMMENT","\/\/ TODO: handle class instances for $message\n",566],["T_WHITESPACE","        ",567],["T_IF","if",567],["T_WHITESPACE"," ",567],"(",["T_STRING","is_resource",567],"(",["T_VARIABLE","$message",567],")",["T_WHITESPACE"," ",567],["T_BOOLEAN_AND","&&",567],["T_WHITESPACE"," ",567],["T_STRING","get_resource_type",567],"(",["T_VARIABLE","$message",567],")",["T_WHITESPACE"," ",567],["T_IS_EQUAL","==",567],["T_WHITESPACE"," ",567],["T_CONSTANT_ENCAPSED_STRING","'stream'",567],")",["T_WHITESPACE"," ",567],"{",["T_WHITESPACE","\n            ",567],["T_STRING","stream_copy_to_stream",568],"(",["T_VARIABLE","$message",568],",",["T_WHITESPACE"," ",568],["T_VARIABLE","$temp_file",568],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",568],"]",")",";",["T_WHITESPACE","\n        ",568],"}",["T_WHITESPACE"," ",569],["T_ELSE","else",569],["T_WHITESPACE"," ",569],"{",["T_WHITESPACE","\n            ",569],["T_STRING","fputs",570],"(",["T_VARIABLE","$temp_file",570],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",570],"]",",",["T_WHITESPACE"," ",570],["T_VARIABLE","$message",570],")",";",["T_WHITESPACE","\n        ",570],"}",["T_WHITESPACE","\n        ",571],["T_STRING","fclose",572],"(",["T_VARIABLE","$temp_file",572],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",572],"]",")",";",["T_WHITESPACE","\n\n        ",572],["T_COMMENT","\/\/ we're adding the size to the filename for maildir++\n",574],["T_WHITESPACE","        ",575],["T_VARIABLE","$size",575],["T_WHITESPACE"," ",575],"=",["T_WHITESPACE"," ",575],["T_STRING","filesize",575],"(",["T_VARIABLE","$temp_file",575],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",575],"]",")",";",["T_WHITESPACE","\n        ",575],["T_IF","if",576],["T_WHITESPACE"," ",576],"(",["T_VARIABLE","$size",576],["T_WHITESPACE"," ",576],["T_IS_NOT_IDENTICAL","!==",576],["T_WHITESPACE"," ",576],["T_STRING","false",576],")",["T_WHITESPACE"," ",576],"{",["T_WHITESPACE","\n            ",576],["T_VARIABLE","$info",577],["T_WHITESPACE"," ",577],"=",["T_WHITESPACE"," ",577],["T_CONSTANT_ENCAPSED_STRING","',S='",577],["T_WHITESPACE"," ",577],".",["T_WHITESPACE"," ",577],["T_VARIABLE","$size",577],["T_WHITESPACE"," ",577],".",["T_WHITESPACE"," ",577],["T_VARIABLE","$info",577],";",["T_WHITESPACE","\n        ",577],"}",["T_WHITESPACE","\n        ",578],["T_VARIABLE","$new_filename",579],["T_WHITESPACE"," ",579],"=",["T_WHITESPACE"," ",579],["T_VARIABLE","$temp_file",579],"[",["T_CONSTANT_ENCAPSED_STRING","'dirname'",579],"]",["T_WHITESPACE"," ",579],".",["T_WHITESPACE"," ",579],["T_STRING","DIRECTORY_SEPARATOR",579],";",["T_WHITESPACE","\n        ",579],["T_VARIABLE","$new_filename",580],["T_WHITESPACE"," ",580],["T_CONCAT_EQUAL",".=",580],["T_WHITESPACE"," ",580],["T_VARIABLE","$recent",580],["T_WHITESPACE"," ",580],"?",["T_WHITESPACE"," ",580],["T_CONSTANT_ENCAPSED_STRING","'new'",580],["T_WHITESPACE"," ",580],":",["T_WHITESPACE"," ",580],["T_CONSTANT_ENCAPSED_STRING","'cur'",580],";",["T_WHITESPACE","\n        ",580],["T_VARIABLE","$new_filename",581],["T_WHITESPACE"," ",581],["T_CONCAT_EQUAL",".=",581],["T_WHITESPACE"," ",581],["T_STRING","DIRECTORY_SEPARATOR",581],["T_WHITESPACE"," ",581],".",["T_WHITESPACE"," ",581],["T_VARIABLE","$temp_file",581],"[",["T_CONSTANT_ENCAPSED_STRING","'uniq'",581],"]",["T_WHITESPACE"," ",581],".",["T_WHITESPACE"," ",581],["T_VARIABLE","$info",581],";",["T_WHITESPACE","\n\n        ",581],["T_COMMENT","\/\/ we're throwing any exception after removing our temp file and saving it to this variable instead\n",583],["T_WHITESPACE","        ",584],["T_VARIABLE","$exception",584],["T_WHITESPACE"," ",584],"=",["T_WHITESPACE"," ",584],["T_STRING","null",584],";",["T_WHITESPACE","\n\n        ",584],["T_IF","if",586],["T_WHITESPACE"," ",586],"(","!",["T_STRING","link",586],"(",["T_VARIABLE","$temp_file",586],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",586],"]",",",["T_WHITESPACE"," ",586],["T_VARIABLE","$new_filename",586],")",")",["T_WHITESPACE"," ",586],"{",["T_WHITESPACE","\n            ",586],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",587],["T_WHITESPACE","\n            ",589],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",590],["T_WHITESPACE","            ",591],["T_VARIABLE","$exception",591],["T_WHITESPACE"," ",591],"=",["T_WHITESPACE"," ",591],["T_NEW","new",591],["T_WHITESPACE"," ",591],["T_STRING","Zend_Mail_Storage_Exception",591],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot link message file to final dir'",591],")",";",["T_WHITESPACE","\n        ",591],"}",["T_WHITESPACE","\n        ",592],"@",["T_STRING","unlink",593],"(",["T_VARIABLE","$temp_file",593],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",593],"]",")",";",["T_WHITESPACE","\n\n        ",593],["T_IF","if",595],["T_WHITESPACE"," ",595],"(",["T_VARIABLE","$exception",595],")",["T_WHITESPACE"," ",595],"{",["T_WHITESPACE","\n            ",595],["T_THROW","throw",596],["T_WHITESPACE"," ",596],["T_VARIABLE","$exception",596],";",["T_WHITESPACE","\n        ",596],"}",["T_WHITESPACE","\n\n        ",597],["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","_files",599],"[","]",["T_WHITESPACE"," ",599],"=",["T_WHITESPACE"," ",599],["T_ARRAY","array",599],"(",["T_CONSTANT_ENCAPSED_STRING","'uniq'",599],["T_WHITESPACE","     ",599],["T_DOUBLE_ARROW","=>",599],["T_WHITESPACE"," ",599],["T_VARIABLE","$temp_file",599],"[",["T_CONSTANT_ENCAPSED_STRING","'uniq'",599],"]",",",["T_WHITESPACE","\n                                ",599],["T_CONSTANT_ENCAPSED_STRING","'flags'",600],["T_WHITESPACE","    ",600],["T_DOUBLE_ARROW","=>",600],["T_WHITESPACE"," ",600],["T_VARIABLE","$flags",600],",",["T_WHITESPACE","\n                                ",600],["T_CONSTANT_ENCAPSED_STRING","'filename'",601],["T_WHITESPACE"," ",601],["T_DOUBLE_ARROW","=>",601],["T_WHITESPACE"," ",601],["T_VARIABLE","$new_filename",601],")",";",["T_WHITESPACE","\n        ",601],["T_IF","if",602],["T_WHITESPACE"," ",602],"(",["T_VARIABLE","$this",602],["T_OBJECT_OPERATOR","->",602],["T_STRING","_quota",602],")",["T_WHITESPACE"," ",602],"{",["T_WHITESPACE","\n            ",602],["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","_addQuotaEntry",603],"(",["T_INT_CAST","(int)",603],["T_VARIABLE","$size",603],",",["T_WHITESPACE"," ",603],["T_LNUMBER","1",603],")",";",["T_WHITESPACE","\n        ",603],"}",["T_WHITESPACE","\n    ",604],"}",["T_WHITESPACE","\n\n    ",605],["T_DOC_COMMENT","\/**\n     * copy an existing message\n     *\n     * @param   int                             $id     number of message\n     * @param   string|Zend_Mail_Storage_Folder $folder name or instance of targer folder\n     * @return  null\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",607],["T_WHITESPACE","\n    ",614],["T_PUBLIC","public",615],["T_WHITESPACE"," ",615],["T_FUNCTION","function",615],["T_WHITESPACE"," ",615],["T_STRING","copyMessage",615],"(",["T_VARIABLE","$id",615],",",["T_WHITESPACE"," ",615],["T_VARIABLE","$folder",615],")",["T_WHITESPACE","\n    ",615],"{",["T_WHITESPACE","\n        ",616],["T_IF","if",617],["T_WHITESPACE"," ",617],"(",["T_VARIABLE","$this",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","_quota",617],["T_WHITESPACE"," ",617],["T_BOOLEAN_AND","&&",617],["T_WHITESPACE"," ",617],["T_VARIABLE","$this",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","checkQuota",617],"(",")",")",["T_WHITESPACE"," ",617],"{",["T_WHITESPACE","\n            ",617],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",618],["T_WHITESPACE","\n            ",620],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",621],["T_WHITESPACE","            ",622],["T_THROW","throw",622],["T_WHITESPACE"," ",622],["T_NEW","new",622],["T_WHITESPACE"," ",622],["T_STRING","Zend_Mail_Storage_Exception",622],"(",["T_CONSTANT_ENCAPSED_STRING","'storage is over quota!'",622],")",";",["T_WHITESPACE","\n        ",622],"}",["T_WHITESPACE","\n\n        ",623],["T_IF","if",625],["T_WHITESPACE"," ",625],"(","!","(",["T_VARIABLE","$folder",625],["T_WHITESPACE"," ",625],["T_INSTANCEOF","instanceof",625],["T_WHITESPACE"," ",625],["T_STRING","Zend_Mail_Storage_Folder",625],")",")",["T_WHITESPACE"," ",625],"{",["T_WHITESPACE","\n            ",625],["T_VARIABLE","$folder",626],["T_WHITESPACE"," ",626],"=",["T_WHITESPACE"," ",626],["T_VARIABLE","$this",626],["T_OBJECT_OPERATOR","->",626],["T_STRING","getFolders",626],"(",["T_VARIABLE","$folder",626],")",";",["T_WHITESPACE","\n        ",626],"}",["T_WHITESPACE","\n\n        ",627],["T_VARIABLE","$filedata",629],["T_WHITESPACE"," ",629],"=",["T_WHITESPACE"," ",629],["T_VARIABLE","$this",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","_getFileData",629],"(",["T_VARIABLE","$id",629],")",";",["T_WHITESPACE","\n        ",629],["T_VARIABLE","$old_file",630],["T_WHITESPACE"," ",630],"=",["T_WHITESPACE"," ",630],["T_VARIABLE","$filedata",630],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",630],"]",";",["T_WHITESPACE","\n        ",630],["T_VARIABLE","$flags",631],["T_WHITESPACE"," ",631],"=",["T_WHITESPACE"," ",631],["T_VARIABLE","$filedata",631],"[",["T_CONSTANT_ENCAPSED_STRING","'flags'",631],"]",";",["T_WHITESPACE","\n\n        ",631],["T_COMMENT","\/\/ copied message can't be recent\n",633],["T_WHITESPACE","        ",634],["T_WHILE","while",634],["T_WHITESPACE"," ",634],"(","(",["T_VARIABLE","$key",634],["T_WHITESPACE"," ",634],"=",["T_WHITESPACE"," ",634],["T_STRING","array_search",634],"(",["T_STRING","Zend_Mail_Storage",634],["T_DOUBLE_COLON","::",634],["T_STRING","FLAG_RECENT",634],",",["T_WHITESPACE"," ",634],["T_VARIABLE","$flags",634],")",")",["T_WHITESPACE"," ",634],["T_IS_NOT_IDENTICAL","!==",634],["T_WHITESPACE"," ",634],["T_STRING","false",634],")",["T_WHITESPACE"," ",634],"{",["T_WHITESPACE","\n            ",634],["T_UNSET","unset",635],"(",["T_VARIABLE","$flags",635],"[",["T_VARIABLE","$key",635],"]",")",";",["T_WHITESPACE","\n        ",635],"}",["T_WHITESPACE","\n        ",636],["T_VARIABLE","$info",637],["T_WHITESPACE"," ",637],"=",["T_WHITESPACE"," ",637],["T_VARIABLE","$this",637],["T_OBJECT_OPERATOR","->",637],["T_STRING","_getInfoString",637],"(",["T_VARIABLE","$flags",637],")",";",["T_WHITESPACE","\n\n        ",637],["T_COMMENT","\/\/ we're creating the copy as temp file before moving to cur\/\n",639],["T_WHITESPACE","        ",640],["T_VARIABLE","$temp_file",640],["T_WHITESPACE"," ",640],"=",["T_WHITESPACE"," ",640],["T_VARIABLE","$this",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","_createTmpFile",640],"(",["T_VARIABLE","$folder",640],["T_OBJECT_OPERATOR","->",640],["T_STRING","getGlobalName",640],"(",")",")",";",["T_WHITESPACE","\n        ",640],["T_COMMENT","\/\/ we don't write directly to the file\n",641],["T_WHITESPACE","        ",642],["T_STRING","fclose",642],"(",["T_VARIABLE","$temp_file",642],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",642],"]",")",";",["T_WHITESPACE","\n\n        ",642],["T_COMMENT","\/\/ we're adding the size to the filename for maildir++\n",644],["T_WHITESPACE","        ",645],["T_VARIABLE","$size",645],["T_WHITESPACE"," ",645],"=",["T_WHITESPACE"," ",645],["T_STRING","filesize",645],"(",["T_VARIABLE","$old_file",645],")",";",["T_WHITESPACE","\n        ",645],["T_IF","if",646],["T_WHITESPACE"," ",646],"(",["T_VARIABLE","$size",646],["T_WHITESPACE"," ",646],["T_IS_NOT_IDENTICAL","!==",646],["T_WHITESPACE"," ",646],["T_STRING","false",646],")",["T_WHITESPACE"," ",646],"{",["T_WHITESPACE","\n            ",646],["T_VARIABLE","$info",647],["T_WHITESPACE"," ",647],"=",["T_WHITESPACE"," ",647],["T_CONSTANT_ENCAPSED_STRING","',S='",647],["T_WHITESPACE"," ",647],".",["T_WHITESPACE"," ",647],["T_VARIABLE","$size",647],["T_WHITESPACE"," ",647],".",["T_WHITESPACE"," ",647],["T_VARIABLE","$info",647],";",["T_WHITESPACE","\n        ",647],"}",["T_WHITESPACE","\n\n        ",648],["T_VARIABLE","$new_file",650],["T_WHITESPACE"," ",650],"=",["T_WHITESPACE"," ",650],["T_VARIABLE","$temp_file",650],"[",["T_CONSTANT_ENCAPSED_STRING","'dirname'",650],"]",["T_WHITESPACE"," ",650],".",["T_WHITESPACE"," ",650],["T_STRING","DIRECTORY_SEPARATOR",650],["T_WHITESPACE"," ",650],".",["T_WHITESPACE"," ",650],["T_CONSTANT_ENCAPSED_STRING","'cur'",650],["T_WHITESPACE"," ",650],".",["T_WHITESPACE"," ",650],["T_STRING","DIRECTORY_SEPARATOR",650],["T_WHITESPACE"," ",650],".",["T_WHITESPACE"," ",650],["T_VARIABLE","$temp_file",650],"[",["T_CONSTANT_ENCAPSED_STRING","'uniq'",650],"]",["T_WHITESPACE"," ",650],".",["T_WHITESPACE"," ",650],["T_VARIABLE","$info",650],";",["T_WHITESPACE","\n\n        ",650],["T_COMMENT","\/\/ we're throwing any exception after removing our temp file and saving it to this variable instead\n",652],["T_WHITESPACE","        ",653],["T_VARIABLE","$exception",653],["T_WHITESPACE"," ",653],"=",["T_WHITESPACE"," ",653],["T_STRING","null",653],";",["T_WHITESPACE","\n\n        ",653],["T_IF","if",655],["T_WHITESPACE"," ",655],"(","!",["T_STRING","copy",655],"(",["T_VARIABLE","$old_file",655],",",["T_WHITESPACE"," ",655],["T_VARIABLE","$temp_file",655],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",655],"]",")",")",["T_WHITESPACE"," ",655],"{",["T_WHITESPACE","\n            ",655],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",656],["T_WHITESPACE","\n            ",658],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",659],["T_WHITESPACE","            ",660],["T_VARIABLE","$exception",660],["T_WHITESPACE"," ",660],"=",["T_WHITESPACE"," ",660],["T_NEW","new",660],["T_WHITESPACE"," ",660],["T_STRING","Zend_Mail_Storage_Exception",660],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot copy message file'",660],")",";",["T_WHITESPACE","\n        ",660],"}",["T_WHITESPACE"," ",661],["T_ELSE","else",661],["T_WHITESPACE"," ",661],["T_IF","if",661],["T_WHITESPACE"," ",661],"(","!",["T_STRING","link",661],"(",["T_VARIABLE","$temp_file",661],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",661],"]",",",["T_WHITESPACE"," ",661],["T_VARIABLE","$new_file",661],")",")",["T_WHITESPACE"," ",661],"{",["T_WHITESPACE","\n            ",661],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",662],["T_WHITESPACE","\n            ",664],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",665],["T_WHITESPACE","            ",666],["T_VARIABLE","$exception",666],["T_WHITESPACE"," ",666],"=",["T_WHITESPACE"," ",666],["T_NEW","new",666],["T_WHITESPACE"," ",666],["T_STRING","Zend_Mail_Storage_Exception",666],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot link message file to final dir'",666],")",";",["T_WHITESPACE","\n        ",666],"}",["T_WHITESPACE","\n        ",667],"@",["T_STRING","unlink",668],"(",["T_VARIABLE","$temp_file",668],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",668],"]",")",";",["T_WHITESPACE","\n\n        ",668],["T_IF","if",670],["T_WHITESPACE"," ",670],"(",["T_VARIABLE","$exception",670],")",["T_WHITESPACE"," ",670],"{",["T_WHITESPACE","\n            ",670],["T_THROW","throw",671],["T_WHITESPACE"," ",671],["T_VARIABLE","$exception",671],";",["T_WHITESPACE","\n        ",671],"}",["T_WHITESPACE","\n\n        ",672],["T_IF","if",674],["T_WHITESPACE"," ",674],"(",["T_VARIABLE","$folder",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","getGlobalName",674],"(",")",["T_WHITESPACE"," ",674],["T_IS_EQUAL","==",674],["T_WHITESPACE"," ",674],["T_VARIABLE","$this",674],["T_OBJECT_OPERATOR","->",674],["T_STRING","_currentFolder",674],["T_WHITESPACE","\n            ",674],["T_BOOLEAN_OR","||",675],["T_WHITESPACE"," ",675],"(",["T_VARIABLE","$this",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","_currentFolder",675],["T_WHITESPACE"," ",675],["T_IS_EQUAL","==",675],["T_WHITESPACE"," ",675],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",675],["T_WHITESPACE"," ",675],["T_BOOLEAN_AND","&&",675],["T_WHITESPACE"," ",675],["T_VARIABLE","$folder",675],["T_OBJECT_OPERATOR","->",675],["T_STRING","getGlobalName",675],"(",")",["T_WHITESPACE"," ",675],["T_IS_EQUAL","==",675],["T_WHITESPACE"," ",675],["T_CONSTANT_ENCAPSED_STRING","'\/'",675],")",")",["T_WHITESPACE"," ",675],"{",["T_WHITESPACE","\n            ",675],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","_files",676],"[","]",["T_WHITESPACE"," ",676],"=",["T_WHITESPACE"," ",676],["T_ARRAY","array",676],"(",["T_CONSTANT_ENCAPSED_STRING","'uniq'",676],["T_WHITESPACE","     ",676],["T_DOUBLE_ARROW","=>",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$temp_file",676],"[",["T_CONSTANT_ENCAPSED_STRING","'uniq'",676],"]",",",["T_WHITESPACE","\n                                    ",676],["T_CONSTANT_ENCAPSED_STRING","'flags'",677],["T_WHITESPACE","    ",677],["T_DOUBLE_ARROW","=>",677],["T_WHITESPACE"," ",677],["T_VARIABLE","$flags",677],",",["T_WHITESPACE","\n                                    ",677],["T_CONSTANT_ENCAPSED_STRING","'filename'",678],["T_WHITESPACE"," ",678],["T_DOUBLE_ARROW","=>",678],["T_WHITESPACE"," ",678],["T_VARIABLE","$new_file",678],")",";",["T_WHITESPACE","\n        ",678],"}",["T_WHITESPACE","\n\n        ",679],["T_IF","if",681],["T_WHITESPACE"," ",681],"(",["T_VARIABLE","$this",681],["T_OBJECT_OPERATOR","->",681],["T_STRING","_quota",681],")",["T_WHITESPACE"," ",681],"{",["T_WHITESPACE","\n            ",681],["T_VARIABLE","$this",682],["T_OBJECT_OPERATOR","->",682],["T_STRING","_addQuotaEntry",682],"(",["T_INT_CAST","(int)",682],["T_VARIABLE","$size",682],",",["T_WHITESPACE"," ",682],["T_LNUMBER","1",682],")",";",["T_WHITESPACE","\n        ",682],"}",["T_WHITESPACE","\n    ",683],"}",["T_WHITESPACE","\n\n    ",684],["T_DOC_COMMENT","\/**\n     * move an existing message\n     *\n     * @param  int                             $id     number of message\n     * @param  string|Zend_Mail_Storage_Folder $folder name or instance of targer folder\n     * @return null\n     * @throws Zend_Mail_Storage_Exception\n     *\/",686],["T_WHITESPACE","\n    ",693],["T_PUBLIC","public",694],["T_WHITESPACE"," ",694],["T_FUNCTION","function",694],["T_WHITESPACE"," ",694],["T_STRING","moveMessage",694],"(",["T_VARIABLE","$id",694],",",["T_WHITESPACE"," ",694],["T_VARIABLE","$folder",694],")",["T_WHITESPACE"," ",694],"{",["T_WHITESPACE","\n        ",694],["T_IF","if",695],["T_WHITESPACE"," ",695],"(","!","(",["T_VARIABLE","$folder",695],["T_WHITESPACE"," ",695],["T_INSTANCEOF","instanceof",695],["T_WHITESPACE"," ",695],["T_STRING","Zend_Mail_Storage_Folder",695],")",")",["T_WHITESPACE"," ",695],"{",["T_WHITESPACE","\n            ",695],["T_VARIABLE","$folder",696],["T_WHITESPACE"," ",696],"=",["T_WHITESPACE"," ",696],["T_VARIABLE","$this",696],["T_OBJECT_OPERATOR","->",696],["T_STRING","getFolders",696],"(",["T_VARIABLE","$folder",696],")",";",["T_WHITESPACE","\n        ",696],"}",["T_WHITESPACE","\n\n        ",697],["T_IF","if",699],["T_WHITESPACE"," ",699],"(",["T_VARIABLE","$folder",699],["T_OBJECT_OPERATOR","->",699],["T_STRING","getGlobalName",699],"(",")",["T_WHITESPACE"," ",699],["T_IS_EQUAL","==",699],["T_WHITESPACE"," ",699],["T_VARIABLE","$this",699],["T_OBJECT_OPERATOR","->",699],["T_STRING","_currentFolder",699],["T_WHITESPACE","\n            ",699],["T_BOOLEAN_OR","||",700],["T_WHITESPACE"," ",700],"(",["T_VARIABLE","$this",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","_currentFolder",700],["T_WHITESPACE"," ",700],["T_IS_EQUAL","==",700],["T_WHITESPACE"," ",700],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",700],["T_WHITESPACE"," ",700],["T_BOOLEAN_AND","&&",700],["T_WHITESPACE"," ",700],["T_VARIABLE","$folder",700],["T_OBJECT_OPERATOR","->",700],["T_STRING","getGlobalName",700],"(",")",["T_WHITESPACE"," ",700],["T_IS_EQUAL","==",700],["T_WHITESPACE"," ",700],["T_CONSTANT_ENCAPSED_STRING","'\/'",700],")",")",["T_WHITESPACE"," ",700],"{",["T_WHITESPACE","\n            ",700],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",701],["T_WHITESPACE","\n            ",703],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",704],["T_WHITESPACE","            ",705],["T_THROW","throw",705],["T_WHITESPACE"," ",705],["T_NEW","new",705],["T_WHITESPACE"," ",705],["T_STRING","Zend_Mail_Storage_Exception",705],"(",["T_CONSTANT_ENCAPSED_STRING","'target is current folder'",705],")",";",["T_WHITESPACE","\n        ",705],"}",["T_WHITESPACE","\n\n        ",706],["T_VARIABLE","$filedata",708],["T_WHITESPACE"," ",708],"=",["T_WHITESPACE"," ",708],["T_VARIABLE","$this",708],["T_OBJECT_OPERATOR","->",708],["T_STRING","_getFileData",708],"(",["T_VARIABLE","$id",708],")",";",["T_WHITESPACE","\n        ",708],["T_VARIABLE","$old_file",709],["T_WHITESPACE"," ",709],"=",["T_WHITESPACE"," ",709],["T_VARIABLE","$filedata",709],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",709],"]",";",["T_WHITESPACE","\n        ",709],["T_VARIABLE","$flags",710],["T_WHITESPACE"," ",710],"=",["T_WHITESPACE"," ",710],["T_VARIABLE","$filedata",710],"[",["T_CONSTANT_ENCAPSED_STRING","'flags'",710],"]",";",["T_WHITESPACE","\n\n        ",710],["T_COMMENT","\/\/ moved message can't be recent\n",712],["T_WHITESPACE","        ",713],["T_WHILE","while",713],["T_WHITESPACE"," ",713],"(","(",["T_VARIABLE","$key",713],["T_WHITESPACE"," ",713],"=",["T_WHITESPACE"," ",713],["T_STRING","array_search",713],"(",["T_STRING","Zend_Mail_Storage",713],["T_DOUBLE_COLON","::",713],["T_STRING","FLAG_RECENT",713],",",["T_WHITESPACE"," ",713],["T_VARIABLE","$flags",713],")",")",["T_WHITESPACE"," ",713],["T_IS_NOT_IDENTICAL","!==",713],["T_WHITESPACE"," ",713],["T_STRING","false",713],")",["T_WHITESPACE"," ",713],"{",["T_WHITESPACE","\n            ",713],["T_UNSET","unset",714],"(",["T_VARIABLE","$flags",714],"[",["T_VARIABLE","$key",714],"]",")",";",["T_WHITESPACE","\n        ",714],"}",["T_WHITESPACE","\n        ",715],["T_VARIABLE","$info",716],["T_WHITESPACE"," ",716],"=",["T_WHITESPACE"," ",716],["T_VARIABLE","$this",716],["T_OBJECT_OPERATOR","->",716],["T_STRING","_getInfoString",716],"(",["T_VARIABLE","$flags",716],")",";",["T_WHITESPACE","\n\n        ",716],["T_COMMENT","\/\/ reserving a new name\n",718],["T_WHITESPACE","        ",719],["T_VARIABLE","$temp_file",719],["T_WHITESPACE"," ",719],"=",["T_WHITESPACE"," ",719],["T_VARIABLE","$this",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","_createTmpFile",719],"(",["T_VARIABLE","$folder",719],["T_OBJECT_OPERATOR","->",719],["T_STRING","getGlobalName",719],"(",")",")",";",["T_WHITESPACE","\n        ",719],["T_STRING","fclose",720],"(",["T_VARIABLE","$temp_file",720],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",720],"]",")",";",["T_WHITESPACE","\n\n        ",720],["T_COMMENT","\/\/ we're adding the size to the filename for maildir++\n",722],["T_WHITESPACE","        ",723],["T_VARIABLE","$size",723],["T_WHITESPACE"," ",723],"=",["T_WHITESPACE"," ",723],["T_STRING","filesize",723],"(",["T_VARIABLE","$old_file",723],")",";",["T_WHITESPACE","\n        ",723],["T_IF","if",724],["T_WHITESPACE"," ",724],"(",["T_VARIABLE","$size",724],["T_WHITESPACE"," ",724],["T_IS_NOT_IDENTICAL","!==",724],["T_WHITESPACE"," ",724],["T_STRING","false",724],")",["T_WHITESPACE"," ",724],"{",["T_WHITESPACE","\n            ",724],["T_VARIABLE","$info",725],["T_WHITESPACE"," ",725],"=",["T_WHITESPACE"," ",725],["T_CONSTANT_ENCAPSED_STRING","',S='",725],["T_WHITESPACE"," ",725],".",["T_WHITESPACE"," ",725],["T_VARIABLE","$size",725],["T_WHITESPACE"," ",725],".",["T_WHITESPACE"," ",725],["T_VARIABLE","$info",725],";",["T_WHITESPACE","\n        ",725],"}",["T_WHITESPACE","\n\n        ",726],["T_VARIABLE","$new_file",728],["T_WHITESPACE"," ",728],"=",["T_WHITESPACE"," ",728],["T_VARIABLE","$temp_file",728],"[",["T_CONSTANT_ENCAPSED_STRING","'dirname'",728],"]",["T_WHITESPACE"," ",728],".",["T_WHITESPACE"," ",728],["T_STRING","DIRECTORY_SEPARATOR",728],["T_WHITESPACE"," ",728],".",["T_WHITESPACE"," ",728],["T_CONSTANT_ENCAPSED_STRING","'cur'",728],["T_WHITESPACE"," ",728],".",["T_WHITESPACE"," ",728],["T_STRING","DIRECTORY_SEPARATOR",728],["T_WHITESPACE"," ",728],".",["T_WHITESPACE"," ",728],["T_VARIABLE","$temp_file",728],"[",["T_CONSTANT_ENCAPSED_STRING","'uniq'",728],"]",["T_WHITESPACE"," ",728],".",["T_WHITESPACE"," ",728],["T_VARIABLE","$info",728],";",["T_WHITESPACE","\n\n        ",728],["T_COMMENT","\/\/ we're throwing any exception after removing our temp file and saving it to this variable instead\n",730],["T_WHITESPACE","        ",731],["T_VARIABLE","$exception",731],["T_WHITESPACE"," ",731],"=",["T_WHITESPACE"," ",731],["T_STRING","null",731],";",["T_WHITESPACE","\n\n        ",731],["T_IF","if",733],["T_WHITESPACE"," ",733],"(","!",["T_STRING","rename",733],"(",["T_VARIABLE","$old_file",733],",",["T_WHITESPACE"," ",733],["T_VARIABLE","$new_file",733],")",")",["T_WHITESPACE"," ",733],"{",["T_WHITESPACE","\n            ",733],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",734],["T_WHITESPACE","\n            ",736],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",737],["T_WHITESPACE","            ",738],["T_VARIABLE","$exception",738],["T_WHITESPACE"," ",738],"=",["T_WHITESPACE"," ",738],["T_NEW","new",738],["T_WHITESPACE"," ",738],["T_STRING","Zend_Mail_Storage_Exception",738],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot move message file'",738],")",";",["T_WHITESPACE","\n        ",738],"}",["T_WHITESPACE","\n        ",739],"@",["T_STRING","unlink",740],"(",["T_VARIABLE","$temp_file",740],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",740],"]",")",";",["T_WHITESPACE","\n\n        ",740],["T_IF","if",742],["T_WHITESPACE"," ",742],"(",["T_VARIABLE","$exception",742],")",["T_WHITESPACE"," ",742],"{",["T_WHITESPACE","\n            ",742],["T_THROW","throw",743],["T_WHITESPACE"," ",743],["T_VARIABLE","$exception",743],";",["T_WHITESPACE","\n        ",743],"}",["T_WHITESPACE","\n\n        ",744],["T_UNSET","unset",746],"(",["T_VARIABLE","$this",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","_files",746],"[",["T_VARIABLE","$id",746],["T_WHITESPACE"," ",746],"-",["T_WHITESPACE"," ",746],["T_LNUMBER","1",746],"]",")",";",["T_WHITESPACE","\n        ",746],["T_COMMENT","\/\/ remove the gap\n",747],["T_WHITESPACE","        ",748],["T_VARIABLE","$this",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","_files",748],["T_WHITESPACE"," ",748],"=",["T_WHITESPACE"," ",748],["T_STRING","array_values",748],"(",["T_VARIABLE","$this",748],["T_OBJECT_OPERATOR","->",748],["T_STRING","_files",748],")",";",["T_WHITESPACE","\n    ",748],"}",["T_WHITESPACE","\n\n\n    ",749],["T_DOC_COMMENT","\/**\n     * set flags for message\n     *\n     * NOTE: this method can't set the recent flag.\n     *\n     * @param   int   $id    number of message\n     * @param   array $flags new flags for message\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",752],["T_WHITESPACE","\n    ",760],["T_PUBLIC","public",761],["T_WHITESPACE"," ",761],["T_FUNCTION","function",761],["T_WHITESPACE"," ",761],["T_STRING","setFlags",761],"(",["T_VARIABLE","$id",761],",",["T_WHITESPACE"," ",761],["T_VARIABLE","$flags",761],")",["T_WHITESPACE","\n    ",761],"{",["T_WHITESPACE","\n        ",762],["T_VARIABLE","$info",763],["T_WHITESPACE"," ",763],"=",["T_WHITESPACE"," ",763],["T_VARIABLE","$this",763],["T_OBJECT_OPERATOR","->",763],["T_STRING","_getInfoString",763],"(",["T_VARIABLE","$flags",763],")",";",["T_WHITESPACE","\n        ",763],["T_VARIABLE","$filedata",764],["T_WHITESPACE"," ",764],"=",["T_WHITESPACE"," ",764],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","_getFileData",764],"(",["T_VARIABLE","$id",764],")",";",["T_WHITESPACE","\n\n        ",764],["T_COMMENT","\/\/ NOTE: double dirname to make sure we always move to cur. if recent flag has been set (message is in new) it will be moved to cur.\n",766],["T_WHITESPACE","        ",767],["T_VARIABLE","$new_filename",767],["T_WHITESPACE"," ",767],"=",["T_WHITESPACE"," ",767],["T_STRING","dirname",767],"(",["T_STRING","dirname",767],"(",["T_VARIABLE","$filedata",767],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",767],"]",")",")",["T_WHITESPACE"," ",767],".",["T_WHITESPACE"," ",767],["T_STRING","DIRECTORY_SEPARATOR",767],["T_WHITESPACE"," ",767],".",["T_WHITESPACE"," ",767],["T_CONSTANT_ENCAPSED_STRING","'cur'",767],["T_WHITESPACE"," ",767],".",["T_WHITESPACE"," ",767],["T_STRING","DIRECTORY_SEPARATOR",767],["T_WHITESPACE"," ",767],".",["T_WHITESPACE"," ",767],"\"",["T_VARIABLE","$filedata",767],"[",["T_STRING","uniq",767],"]",["T_VARIABLE","$info",767],"\"",";",["T_WHITESPACE","\n\n        ",767],["T_IF","if",769],["T_WHITESPACE"," ",769],"(","!","@",["T_STRING","rename",769],"(",["T_VARIABLE","$filedata",769],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",769],"]",",",["T_WHITESPACE"," ",769],["T_VARIABLE","$new_filename",769],")",")",["T_WHITESPACE"," ",769],"{",["T_WHITESPACE","\n            ",769],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",770],["T_WHITESPACE","\n            ",772],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",773],["T_WHITESPACE","            ",774],["T_THROW","throw",774],["T_WHITESPACE"," ",774],["T_NEW","new",774],["T_WHITESPACE"," ",774],["T_STRING","Zend_Mail_Storage_Exception",774],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot rename file'",774],")",";",["T_WHITESPACE","\n        ",774],"}",["T_WHITESPACE","\n\n        ",775],["T_VARIABLE","$filedata",777],"[",["T_CONSTANT_ENCAPSED_STRING","'flags'",777],"]",["T_WHITESPACE","    ",777],"=",["T_WHITESPACE"," ",777],["T_VARIABLE","$flags",777],";",["T_WHITESPACE","\n        ",777],["T_VARIABLE","$filedata",778],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",778],"]",["T_WHITESPACE"," ",778],"=",["T_WHITESPACE"," ",778],["T_VARIABLE","$new_filename",778],";",["T_WHITESPACE","\n\n        ",778],["T_VARIABLE","$this",780],["T_OBJECT_OPERATOR","->",780],["T_STRING","_files",780],"[",["T_VARIABLE","$id",780],["T_WHITESPACE"," ",780],"-",["T_WHITESPACE"," ",780],["T_LNUMBER","1",780],"]",["T_WHITESPACE"," ",780],"=",["T_WHITESPACE"," ",780],["T_VARIABLE","$filedata",780],";",["T_WHITESPACE","\n    ",780],"}",["T_WHITESPACE","\n\n\n    ",781],["T_DOC_COMMENT","\/**\n     * stub for not supported message deletion\n     *\n     * @return  null\n     * @throws  Zend_Mail_Storage_Exception\n     *\/",784],["T_WHITESPACE","\n    ",789],["T_PUBLIC","public",790],["T_WHITESPACE"," ",790],["T_FUNCTION","function",790],["T_WHITESPACE"," ",790],["T_STRING","removeMessage",790],"(",["T_VARIABLE","$id",790],")",["T_WHITESPACE","\n    ",790],"{",["T_WHITESPACE","\n        ",791],["T_VARIABLE","$filename",792],["T_WHITESPACE"," ",792],"=",["T_WHITESPACE"," ",792],["T_VARIABLE","$this",792],["T_OBJECT_OPERATOR","->",792],["T_STRING","_getFileData",792],"(",["T_VARIABLE","$id",792],",",["T_WHITESPACE"," ",792],["T_CONSTANT_ENCAPSED_STRING","'filename'",792],")",";",["T_WHITESPACE","\n\n        ",792],["T_IF","if",794],["T_WHITESPACE"," ",794],"(",["T_VARIABLE","$this",794],["T_OBJECT_OPERATOR","->",794],["T_STRING","_quota",794],")",["T_WHITESPACE"," ",794],"{",["T_WHITESPACE","\n            ",794],["T_VARIABLE","$size",795],["T_WHITESPACE"," ",795],"=",["T_WHITESPACE"," ",795],["T_STRING","filesize",795],"(",["T_VARIABLE","$filename",795],")",";",["T_WHITESPACE","\n        ",795],"}",["T_WHITESPACE","\n\n        ",796],["T_IF","if",798],["T_WHITESPACE"," ",798],"(","!","@",["T_STRING","unlink",798],"(",["T_VARIABLE","$filename",798],")",")",["T_WHITESPACE"," ",798],"{",["T_WHITESPACE","\n            ",798],["T_DOC_COMMENT","\/**\n             * @see Zend_Mail_Storage_Exception\n             *\/",799],["T_WHITESPACE","\n            ",801],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",802],["T_WHITESPACE","            ",803],["T_THROW","throw",803],["T_WHITESPACE"," ",803],["T_NEW","new",803],["T_WHITESPACE"," ",803],["T_STRING","Zend_Mail_Storage_Exception",803],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot remove message'",803],")",";",["T_WHITESPACE","\n        ",803],"}",["T_WHITESPACE","\n        ",804],["T_UNSET","unset",805],"(",["T_VARIABLE","$this",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","_files",805],"[",["T_VARIABLE","$id",805],["T_WHITESPACE"," ",805],"-",["T_WHITESPACE"," ",805],["T_LNUMBER","1",805],"]",")",";",["T_WHITESPACE","\n        ",805],["T_COMMENT","\/\/ remove the gap\n",806],["T_WHITESPACE","        ",807],["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","_files",807],["T_WHITESPACE"," ",807],"=",["T_WHITESPACE"," ",807],["T_STRING","array_values",807],"(",["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","_files",807],")",";",["T_WHITESPACE","\n        ",807],["T_IF","if",808],["T_WHITESPACE"," ",808],"(",["T_VARIABLE","$this",808],["T_OBJECT_OPERATOR","->",808],["T_STRING","_quota",808],")",["T_WHITESPACE"," ",808],"{",["T_WHITESPACE","\n            ",808],["T_VARIABLE","$this",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","_addQuotaEntry",809],"(",["T_LNUMBER","0",809],["T_WHITESPACE"," ",809],"-",["T_WHITESPACE"," ",809],["T_INT_CAST","(int)",809],["T_VARIABLE","$size",809],",",["T_WHITESPACE"," ",809],"-",["T_LNUMBER","1",809],")",";",["T_WHITESPACE","\n        ",809],"}",["T_WHITESPACE","\n    ",810],"}",["T_WHITESPACE","\n\n    ",811],["T_DOC_COMMENT","\/**\n     * enable\/disable quota and set a quota value if wanted or needed\n     *\n     * You can enable\/disable quota with true\/false. If you don't have\n     * a MDA or want to enforce a quota value you can also set this value\n     * here. Use array('size' => SIZE_QUOTA, 'count' => MAX_MESSAGE) do\n     * define your quota. Order of these fields does matter!\n     *\n     * @param bool|array $value new quota value\n     * @return null\n     *\/",813],["T_WHITESPACE","\n    ",823],["T_PUBLIC","public",824],["T_WHITESPACE"," ",824],["T_FUNCTION","function",824],["T_WHITESPACE"," ",824],["T_STRING","setQuota",824],"(",["T_VARIABLE","$value",824],")",["T_WHITESPACE"," ",824],"{",["T_WHITESPACE","\n        ",824],["T_VARIABLE","$this",825],["T_OBJECT_OPERATOR","->",825],["T_STRING","_quota",825],["T_WHITESPACE"," ",825],"=",["T_WHITESPACE"," ",825],["T_VARIABLE","$value",825],";",["T_WHITESPACE","\n    ",825],"}",["T_WHITESPACE","\n\n    ",826],["T_DOC_COMMENT","\/**\n     * get currently set quota\n     *\n     * @see Zend_Mail_Storage_Writable_Maildir::setQuota()\n     *\n     * @return bool|array\n     *\/",828],["T_WHITESPACE","\n    ",834],["T_PUBLIC","public",835],["T_WHITESPACE"," ",835],["T_FUNCTION","function",835],["T_WHITESPACE"," ",835],["T_STRING","getQuota",835],"(",["T_VARIABLE","$fromStorage",835],["T_WHITESPACE"," ",835],"=",["T_WHITESPACE"," ",835],["T_STRING","false",835],")",["T_WHITESPACE"," ",835],"{",["T_WHITESPACE","\n        ",835],["T_IF","if",836],["T_WHITESPACE"," ",836],"(",["T_VARIABLE","$fromStorage",836],")",["T_WHITESPACE"," ",836],"{",["T_WHITESPACE","\n            ",836],["T_VARIABLE","$fh",837],["T_WHITESPACE"," ",837],"=",["T_WHITESPACE"," ",837],"@",["T_STRING","fopen",837],"(",["T_VARIABLE","$this",837],["T_OBJECT_OPERATOR","->",837],["T_STRING","_rootdir",837],["T_WHITESPACE"," ",837],".",["T_WHITESPACE"," ",837],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",837],",",["T_WHITESPACE"," ",837],["T_CONSTANT_ENCAPSED_STRING","'r'",837],")",";",["T_WHITESPACE","\n            ",837],["T_IF","if",838],["T_WHITESPACE"," ",838],"(","!",["T_VARIABLE","$fh",838],")",["T_WHITESPACE"," ",838],"{",["T_WHITESPACE","\n                ",838],["T_DOC_COMMENT","\/**\n                 * @see Zend_Mail_Storage_Exception\n                 *\/",839],["T_WHITESPACE","\n                ",841],["T_COMMENT","#require_once 'Zend\/Mail\/Storage\/Exception.php';\n",842],["T_WHITESPACE","                ",843],["T_THROW","throw",843],["T_WHITESPACE"," ",843],["T_NEW","new",843],["T_WHITESPACE"," ",843],["T_STRING","Zend_Mail_Storage_Exception",843],"(",["T_CONSTANT_ENCAPSED_STRING","'cannot open maildirsize'",843],")",";",["T_WHITESPACE","\n            ",843],"}",["T_WHITESPACE","\n            ",844],["T_VARIABLE","$definition",845],["T_WHITESPACE"," ",845],"=",["T_WHITESPACE"," ",845],["T_STRING","fgets",845],"(",["T_VARIABLE","$fh",845],")",";",["T_WHITESPACE","\n            ",845],["T_STRING","fclose",846],"(",["T_VARIABLE","$fh",846],")",";",["T_WHITESPACE","\n            ",846],["T_VARIABLE","$definition",847],["T_WHITESPACE"," ",847],"=",["T_WHITESPACE"," ",847],["T_STRING","explode",847],"(",["T_CONSTANT_ENCAPSED_STRING","','",847],",",["T_WHITESPACE"," ",847],["T_STRING","trim",847],"(",["T_VARIABLE","$definition",847],")",")",";",["T_WHITESPACE","\n            ",847],["T_VARIABLE","$quota",848],["T_WHITESPACE"," ",848],"=",["T_WHITESPACE"," ",848],["T_ARRAY","array",848],"(",")",";",["T_WHITESPACE","\n            ",848],["T_FOREACH","foreach",849],["T_WHITESPACE"," ",849],"(",["T_VARIABLE","$definition",849],["T_WHITESPACE"," ",849],["T_AS","as",849],["T_WHITESPACE"," ",849],["T_VARIABLE","$member",849],")",["T_WHITESPACE"," ",849],"{",["T_WHITESPACE","\n                ",849],["T_VARIABLE","$key",850],["T_WHITESPACE"," ",850],"=",["T_WHITESPACE"," ",850],["T_VARIABLE","$member",850],"[",["T_STRING","strlen",850],"(",["T_VARIABLE","$member",850],")",["T_WHITESPACE"," ",850],"-",["T_WHITESPACE"," ",850],["T_LNUMBER","1",850],"]",";",["T_WHITESPACE","\n                ",850],["T_IF","if",851],["T_WHITESPACE"," ",851],"(",["T_VARIABLE","$key",851],["T_WHITESPACE"," ",851],["T_IS_EQUAL","==",851],["T_WHITESPACE"," ",851],["T_CONSTANT_ENCAPSED_STRING","'S'",851],["T_WHITESPACE"," ",851],["T_BOOLEAN_OR","||",851],["T_WHITESPACE"," ",851],["T_VARIABLE","$key",851],["T_WHITESPACE"," ",851],["T_IS_EQUAL","==",851],["T_WHITESPACE"," ",851],["T_CONSTANT_ENCAPSED_STRING","'C'",851],")",["T_WHITESPACE"," ",851],"{",["T_WHITESPACE","\n                    ",851],["T_VARIABLE","$key",852],["T_WHITESPACE"," ",852],"=",["T_WHITESPACE"," ",852],["T_VARIABLE","$key",852],["T_WHITESPACE"," ",852],["T_IS_EQUAL","==",852],["T_WHITESPACE"," ",852],["T_CONSTANT_ENCAPSED_STRING","'C'",852],["T_WHITESPACE"," ",852],"?",["T_WHITESPACE"," ",852],["T_CONSTANT_ENCAPSED_STRING","'count'",852],["T_WHITESPACE"," ",852],":",["T_WHITESPACE"," ",852],["T_CONSTANT_ENCAPSED_STRING","'size'",852],";",["T_WHITESPACE","\n                ",852],"}",["T_WHITESPACE","\n                ",853],["T_VARIABLE","$quota",854],"[",["T_VARIABLE","$key",854],"]",["T_WHITESPACE"," ",854],"=",["T_WHITESPACE"," ",854],["T_STRING","substr",854],"(",["T_VARIABLE","$member",854],",",["T_WHITESPACE"," ",854],["T_LNUMBER","0",854],",",["T_WHITESPACE"," ",854],"-",["T_LNUMBER","1",854],")",";",["T_WHITESPACE","\n            ",854],"}",["T_WHITESPACE","\n            ",855],["T_RETURN","return",856],["T_WHITESPACE"," ",856],["T_VARIABLE","$quota",856],";",["T_WHITESPACE","\n        ",856],"}",["T_WHITESPACE","\n\n        ",857],["T_RETURN","return",859],["T_WHITESPACE"," ",859],["T_VARIABLE","$this",859],["T_OBJECT_OPERATOR","->",859],["T_STRING","_quota",859],";",["T_WHITESPACE","\n    ",859],"}",["T_WHITESPACE","\n\n    ",860],["T_DOC_COMMENT","\/**\n     * @see http:\/\/www.inter7.com\/courierimap\/README.maildirquota.html \"Calculating maildirsize\"\n     *\/",862],["T_WHITESPACE","\n    ",864],["T_PROTECTED","protected",865],["T_WHITESPACE"," ",865],["T_FUNCTION","function",865],["T_WHITESPACE"," ",865],["T_STRING","_calculateMaildirsize",865],"(",")",["T_WHITESPACE"," ",865],"{",["T_WHITESPACE","\n        ",865],["T_VARIABLE","$timestamps",866],["T_WHITESPACE"," ",866],"=",["T_WHITESPACE"," ",866],["T_ARRAY","array",866],"(",")",";",["T_WHITESPACE","\n        ",866],["T_VARIABLE","$messages",867],["T_WHITESPACE"," ",867],"=",["T_WHITESPACE"," ",867],["T_LNUMBER","0",867],";",["T_WHITESPACE","\n        ",867],["T_VARIABLE","$total_size",868],["T_WHITESPACE"," ",868],"=",["T_WHITESPACE"," ",868],["T_LNUMBER","0",868],";",["T_WHITESPACE","\n\n        ",868],["T_IF","if",870],["T_WHITESPACE"," ",870],"(",["T_STRING","is_array",870],"(",["T_VARIABLE","$this",870],["T_OBJECT_OPERATOR","->",870],["T_STRING","_quota",870],")",")",["T_WHITESPACE"," ",870],"{",["T_WHITESPACE","\n            ",870],["T_VARIABLE","$quota",871],["T_WHITESPACE"," ",871],"=",["T_WHITESPACE"," ",871],["T_VARIABLE","$this",871],["T_OBJECT_OPERATOR","->",871],["T_STRING","_quota",871],";",["T_WHITESPACE","\n        ",871],"}",["T_WHITESPACE"," ",872],["T_ELSE","else",872],["T_WHITESPACE"," ",872],"{",["T_WHITESPACE","\n            ",872],["T_TRY","try",873],["T_WHITESPACE"," ",873],"{",["T_WHITESPACE","\n                ",873],["T_VARIABLE","$quota",874],["T_WHITESPACE"," ",874],"=",["T_WHITESPACE"," ",874],["T_VARIABLE","$this",874],["T_OBJECT_OPERATOR","->",874],["T_STRING","getQuota",874],"(",["T_STRING","true",874],")",";",["T_WHITESPACE","\n            ",874],"}",["T_WHITESPACE"," ",875],["T_CATCH","catch",875],["T_WHITESPACE"," ",875],"(",["T_STRING","Zend_Mail_Storage_Exception",875],["T_WHITESPACE"," ",875],["T_VARIABLE","$e",875],")",["T_WHITESPACE"," ",875],"{",["T_WHITESPACE","\n                ",875],["T_THROW","throw",876],["T_WHITESPACE"," ",876],["T_NEW","new",876],["T_WHITESPACE"," ",876],["T_STRING","Zend_Mail_Storage_Exception",876],"(",["T_CONSTANT_ENCAPSED_STRING","'no quota definition found'",876],",",["T_WHITESPACE"," ",876],["T_LNUMBER","0",876],",",["T_WHITESPACE"," ",876],["T_VARIABLE","$e",876],")",";",["T_WHITESPACE","\n            ",876],"}",["T_WHITESPACE","\n        ",877],"}",["T_WHITESPACE","\n\n        ",878],["T_VARIABLE","$folders",880],["T_WHITESPACE"," ",880],"=",["T_WHITESPACE"," ",880],["T_NEW","new",880],["T_WHITESPACE"," ",880],["T_STRING","RecursiveIteratorIterator",880],"(",["T_VARIABLE","$this",880],["T_OBJECT_OPERATOR","->",880],["T_STRING","getFolders",880],"(",")",",",["T_WHITESPACE"," ",880],["T_STRING","RecursiveIteratorIterator",880],["T_DOUBLE_COLON","::",880],["T_STRING","SELF_FIRST",880],")",";",["T_WHITESPACE","\n        ",880],["T_FOREACH","foreach",881],["T_WHITESPACE"," ",881],"(",["T_VARIABLE","$folders",881],["T_WHITESPACE"," ",881],["T_AS","as",881],["T_WHITESPACE"," ",881],["T_VARIABLE","$folder",881],")",["T_WHITESPACE"," ",881],"{",["T_WHITESPACE","\n            ",881],["T_VARIABLE","$subdir",882],["T_WHITESPACE"," ",882],"=",["T_WHITESPACE"," ",882],["T_VARIABLE","$folder",882],["T_OBJECT_OPERATOR","->",882],["T_STRING","getGlobalName",882],"(",")",";",["T_WHITESPACE","\n            ",882],["T_IF","if",883],["T_WHITESPACE"," ",883],"(",["T_VARIABLE","$subdir",883],["T_WHITESPACE"," ",883],["T_IS_EQUAL","==",883],["T_WHITESPACE"," ",883],["T_CONSTANT_ENCAPSED_STRING","'INBOX'",883],")",["T_WHITESPACE"," ",883],"{",["T_WHITESPACE","\n                ",883],["T_VARIABLE","$subdir",884],["T_WHITESPACE"," ",884],"=",["T_WHITESPACE"," ",884],["T_CONSTANT_ENCAPSED_STRING","''",884],";",["T_WHITESPACE","\n            ",884],"}",["T_WHITESPACE"," ",885],["T_ELSE","else",885],["T_WHITESPACE"," ",885],"{",["T_WHITESPACE","\n                ",885],["T_VARIABLE","$subdir",886],["T_WHITESPACE"," ",886],"=",["T_WHITESPACE"," ",886],["T_CONSTANT_ENCAPSED_STRING","'.'",886],["T_WHITESPACE"," ",886],".",["T_WHITESPACE"," ",886],["T_VARIABLE","$subdir",886],";",["T_WHITESPACE","\n            ",886],"}",["T_WHITESPACE","\n            ",887],["T_IF","if",888],["T_WHITESPACE"," ",888],"(",["T_VARIABLE","$subdir",888],["T_WHITESPACE"," ",888],["T_IS_EQUAL","==",888],["T_WHITESPACE"," ",888],["T_CONSTANT_ENCAPSED_STRING","'Trash'",888],")",["T_WHITESPACE"," ",888],"{",["T_WHITESPACE","\n                ",888],["T_CONTINUE","continue",889],";",["T_WHITESPACE","\n            ",889],"}",["T_WHITESPACE","\n\n            ",890],["T_FOREACH","foreach",892],["T_WHITESPACE"," ",892],"(",["T_ARRAY","array",892],"(",["T_CONSTANT_ENCAPSED_STRING","'cur'",892],",",["T_WHITESPACE"," ",892],["T_CONSTANT_ENCAPSED_STRING","'new'",892],")",["T_WHITESPACE"," ",892],["T_AS","as",892],["T_WHITESPACE"," ",892],["T_VARIABLE","$subsubdir",892],")",["T_WHITESPACE"," ",892],"{",["T_WHITESPACE","\n                ",892],["T_VARIABLE","$dirname",893],["T_WHITESPACE"," ",893],"=",["T_WHITESPACE"," ",893],["T_VARIABLE","$this",893],["T_OBJECT_OPERATOR","->",893],["T_STRING","_rootdir",893],["T_WHITESPACE"," ",893],".",["T_WHITESPACE"," ",893],["T_VARIABLE","$subdir",893],["T_WHITESPACE"," ",893],".",["T_WHITESPACE"," ",893],["T_STRING","DIRECTORY_SEPARATOR",893],["T_WHITESPACE"," ",893],".",["T_WHITESPACE"," ",893],["T_VARIABLE","$subsubdir",893],["T_WHITESPACE"," ",893],".",["T_WHITESPACE"," ",893],["T_STRING","DIRECTORY_SEPARATOR",893],";",["T_WHITESPACE","\n                ",893],["T_IF","if",894],["T_WHITESPACE"," ",894],"(","!",["T_STRING","file_exists",894],"(",["T_VARIABLE","$dirname",894],")",")",["T_WHITESPACE"," ",894],"{",["T_WHITESPACE","\n                    ",894],["T_CONTINUE","continue",895],";",["T_WHITESPACE","\n                ",895],"}",["T_WHITESPACE","\n                ",896],["T_COMMENT","\/\/ NOTE: we are using mtime instead of \"the latest timestamp\". The latest would be atime\n",897],["T_WHITESPACE","                ",898],["T_COMMENT","\/\/ and as we are accessing the directory it would make the whole calculation useless.\n",898],["T_WHITESPACE","                ",899],["T_VARIABLE","$timestamps",899],"[",["T_VARIABLE","$dirname",899],"]",["T_WHITESPACE"," ",899],"=",["T_WHITESPACE"," ",899],["T_STRING","filemtime",899],"(",["T_VARIABLE","$dirname",899],")",";",["T_WHITESPACE","\n\n                ",899],["T_VARIABLE","$dh",901],["T_WHITESPACE"," ",901],"=",["T_WHITESPACE"," ",901],["T_STRING","opendir",901],"(",["T_VARIABLE","$dirname",901],")",";",["T_WHITESPACE","\n                ",901],["T_COMMENT","\/\/ NOTE: Should have been checked in constructor. Not throwing an exception here, quotas will\n",902],["T_WHITESPACE","                ",903],["T_COMMENT","\/\/ therefore not be fully enforeced, but next request will fail anyway, if problem persists.\n",903],["T_WHITESPACE","                ",904],["T_IF","if",904],["T_WHITESPACE"," ",904],"(","!",["T_VARIABLE","$dh",904],")",["T_WHITESPACE"," ",904],"{",["T_WHITESPACE","\n                    ",904],["T_CONTINUE","continue",905],";",["T_WHITESPACE","\n                ",905],"}",["T_WHITESPACE","\n\n\n                ",906],["T_WHILE","while",909],["T_WHITESPACE"," ",909],"(","(",["T_VARIABLE","$entry",909],["T_WHITESPACE"," ",909],"=",["T_WHITESPACE"," ",909],["T_STRING","readdir",909],"(",")",")",["T_WHITESPACE"," ",909],["T_IS_NOT_IDENTICAL","!==",909],["T_WHITESPACE"," ",909],["T_STRING","false",909],")",["T_WHITESPACE"," ",909],"{",["T_WHITESPACE","\n                    ",909],["T_IF","if",910],["T_WHITESPACE"," ",910],"(",["T_VARIABLE","$entry",910],"[",["T_LNUMBER","0",910],"]",["T_WHITESPACE"," ",910],["T_IS_EQUAL","==",910],["T_WHITESPACE"," ",910],["T_CONSTANT_ENCAPSED_STRING","'.'",910],["T_WHITESPACE"," ",910],["T_BOOLEAN_OR","||",910],["T_WHITESPACE"," ",910],"!",["T_STRING","is_file",910],"(",["T_VARIABLE","$dirname",910],["T_WHITESPACE"," ",910],".",["T_WHITESPACE"," ",910],["T_VARIABLE","$entry",910],")",")",["T_WHITESPACE"," ",910],"{",["T_WHITESPACE","\n                        ",910],["T_CONTINUE","continue",911],";",["T_WHITESPACE","\n                    ",911],"}",["T_WHITESPACE","\n\n                    ",912],["T_IF","if",914],["T_WHITESPACE"," ",914],"(",["T_STRING","strpos",914],"(",["T_VARIABLE","$entry",914],",",["T_WHITESPACE"," ",914],["T_CONSTANT_ENCAPSED_STRING","',S='",914],")",")",["T_WHITESPACE"," ",914],"{",["T_WHITESPACE","\n                        ",914],["T_STRING","strtok",915],"(",["T_VARIABLE","$entry",915],",",["T_WHITESPACE"," ",915],["T_CONSTANT_ENCAPSED_STRING","'='",915],")",";",["T_WHITESPACE","\n                        ",915],["T_VARIABLE","$filesize",916],["T_WHITESPACE"," ",916],"=",["T_WHITESPACE"," ",916],["T_STRING","strtok",916],"(",["T_CONSTANT_ENCAPSED_STRING","':'",916],")",";",["T_WHITESPACE","\n                        ",916],["T_IF","if",917],["T_WHITESPACE"," ",917],"(",["T_STRING","is_numeric",917],"(",["T_VARIABLE","$filesize",917],")",")",["T_WHITESPACE"," ",917],"{",["T_WHITESPACE","\n                            ",917],["T_VARIABLE","$total_size",918],["T_WHITESPACE"," ",918],["T_PLUS_EQUAL","+=",918],["T_WHITESPACE"," ",918],["T_VARIABLE","$filesize",918],";",["T_WHITESPACE","\n                            ",918],["T_INC","++",919],["T_VARIABLE","$messages",919],";",["T_WHITESPACE","\n                            ",919],["T_CONTINUE","continue",920],";",["T_WHITESPACE","\n                        ",920],"}",["T_WHITESPACE","\n                    ",921],"}",["T_WHITESPACE","\n                    ",922],["T_VARIABLE","$size",923],["T_WHITESPACE"," ",923],"=",["T_WHITESPACE"," ",923],["T_STRING","filesize",923],"(",["T_VARIABLE","$dirname",923],["T_WHITESPACE"," ",923],".",["T_WHITESPACE"," ",923],["T_VARIABLE","$entry",923],")",";",["T_WHITESPACE","\n                    ",923],["T_IF","if",924],["T_WHITESPACE"," ",924],"(",["T_VARIABLE","$size",924],["T_WHITESPACE"," ",924],["T_IS_IDENTICAL","===",924],["T_WHITESPACE"," ",924],["T_STRING","false",924],")",["T_WHITESPACE"," ",924],"{",["T_WHITESPACE","\n                        ",924],["T_COMMENT","\/\/ ignore, as we assume file got removed\n",925],["T_WHITESPACE","                        ",926],["T_CONTINUE","continue",926],";",["T_WHITESPACE","\n                    ",926],"}",["T_WHITESPACE","\n                    ",927],["T_VARIABLE","$total_size",928],["T_WHITESPACE"," ",928],["T_PLUS_EQUAL","+=",928],["T_WHITESPACE"," ",928],["T_VARIABLE","$size",928],";",["T_WHITESPACE","\n                    ",928],["T_INC","++",929],["T_VARIABLE","$messages",929],";",["T_WHITESPACE","\n                ",929],"}",["T_WHITESPACE","\n            ",930],"}",["T_WHITESPACE","\n        ",931],"}",["T_WHITESPACE","\n\n        ",932],["T_VARIABLE","$tmp",934],["T_WHITESPACE"," ",934],"=",["T_WHITESPACE"," ",934],["T_VARIABLE","$this",934],["T_OBJECT_OPERATOR","->",934],["T_STRING","_createTmpFile",934],"(",")",";",["T_WHITESPACE","\n        ",934],["T_VARIABLE","$fh",935],["T_WHITESPACE"," ",935],"=",["T_WHITESPACE"," ",935],["T_VARIABLE","$tmp",935],"[",["T_CONSTANT_ENCAPSED_STRING","'handle'",935],"]",";",["T_WHITESPACE","\n        ",935],["T_VARIABLE","$definition",936],["T_WHITESPACE"," ",936],"=",["T_WHITESPACE"," ",936],["T_ARRAY","array",936],"(",")",";",["T_WHITESPACE","\n        ",936],["T_FOREACH","foreach",937],["T_WHITESPACE"," ",937],"(",["T_VARIABLE","$quota",937],["T_WHITESPACE"," ",937],["T_AS","as",937],["T_WHITESPACE"," ",937],["T_VARIABLE","$type",937],["T_WHITESPACE"," ",937],["T_DOUBLE_ARROW","=>",937],["T_WHITESPACE"," ",937],["T_VARIABLE","$value",937],")",["T_WHITESPACE"," ",937],"{",["T_WHITESPACE","\n            ",937],["T_IF","if",938],["T_WHITESPACE"," ",938],"(",["T_VARIABLE","$type",938],["T_WHITESPACE"," ",938],["T_IS_EQUAL","==",938],["T_WHITESPACE"," ",938],["T_CONSTANT_ENCAPSED_STRING","'size'",938],["T_WHITESPACE"," ",938],["T_BOOLEAN_OR","||",938],["T_WHITESPACE"," ",938],["T_VARIABLE","$type",938],["T_WHITESPACE"," ",938],["T_IS_EQUAL","==",938],["T_WHITESPACE"," ",938],["T_CONSTANT_ENCAPSED_STRING","'count'",938],")",["T_WHITESPACE"," ",938],"{",["T_WHITESPACE","\n                ",938],["T_VARIABLE","$type",939],["T_WHITESPACE"," ",939],"=",["T_WHITESPACE"," ",939],["T_VARIABLE","$type",939],["T_WHITESPACE"," ",939],["T_IS_EQUAL","==",939],["T_WHITESPACE"," ",939],["T_CONSTANT_ENCAPSED_STRING","'count'",939],["T_WHITESPACE"," ",939],"?",["T_WHITESPACE"," ",939],["T_CONSTANT_ENCAPSED_STRING","'C'",939],["T_WHITESPACE"," ",939],":",["T_WHITESPACE"," ",939],["T_CONSTANT_ENCAPSED_STRING","'S'",939],";",["T_WHITESPACE","\n            ",939],"}",["T_WHITESPACE","\n            ",940],["T_VARIABLE","$definition",941],"[","]",["T_WHITESPACE"," ",941],"=",["T_WHITESPACE"," ",941],["T_VARIABLE","$value",941],["T_WHITESPACE"," ",941],".",["T_WHITESPACE"," ",941],["T_VARIABLE","$type",941],";",["T_WHITESPACE","\n        ",941],"}",["T_WHITESPACE","\n        ",942],["T_VARIABLE","$definition",943],["T_WHITESPACE"," ",943],"=",["T_WHITESPACE"," ",943],["T_STRING","implode",943],"(",["T_CONSTANT_ENCAPSED_STRING","','",943],",",["T_WHITESPACE"," ",943],["T_VARIABLE","$definition",943],")",";",["T_WHITESPACE","\n        ",943],["T_STRING","fputs",944],"(",["T_VARIABLE","$fh",944],",",["T_WHITESPACE"," ",944],"\"",["T_VARIABLE","$definition",944],["T_ENCAPSED_AND_WHITESPACE","\\n",944],"\"",")",";",["T_WHITESPACE","\n        ",944],["T_STRING","fputs",945],"(",["T_VARIABLE","$fh",945],",",["T_WHITESPACE"," ",945],"\"",["T_VARIABLE","$total_size",945],["T_ENCAPSED_AND_WHITESPACE"," ",945],["T_VARIABLE","$messages",945],["T_ENCAPSED_AND_WHITESPACE","\\n",945],"\"",")",";",["T_WHITESPACE","\n        ",945],["T_STRING","fclose",946],"(",["T_VARIABLE","$fh",946],")",";",["T_WHITESPACE","\n        ",946],["T_STRING","rename",947],"(",["T_VARIABLE","$tmp",947],"[",["T_CONSTANT_ENCAPSED_STRING","'filename'",947],"]",",",["T_WHITESPACE"," ",947],["T_VARIABLE","$this",947],["T_OBJECT_OPERATOR","->",947],["T_STRING","_rootdir",947],["T_WHITESPACE"," ",947],".",["T_WHITESPACE"," ",947],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",947],")",";",["T_WHITESPACE","\n        ",947],["T_FOREACH","foreach",948],["T_WHITESPACE"," ",948],"(",["T_VARIABLE","$timestamps",948],["T_WHITESPACE"," ",948],["T_AS","as",948],["T_WHITESPACE"," ",948],["T_VARIABLE","$dir",948],["T_WHITESPACE"," ",948],["T_DOUBLE_ARROW","=>",948],["T_WHITESPACE"," ",948],["T_VARIABLE","$timestamp",948],")",["T_WHITESPACE"," ",948],"{",["T_WHITESPACE","\n            ",948],["T_IF","if",949],["T_WHITESPACE"," ",949],"(",["T_VARIABLE","$timestamp",949],["T_WHITESPACE"," ",949],"<",["T_WHITESPACE"," ",949],["T_STRING","filemtime",949],"(",["T_VARIABLE","$dir",949],")",")",["T_WHITESPACE"," ",949],"{",["T_WHITESPACE","\n                ",949],["T_STRING","unlink",950],"(",["T_VARIABLE","$this",950],["T_OBJECT_OPERATOR","->",950],["T_STRING","_rootdir",950],["T_WHITESPACE"," ",950],".",["T_WHITESPACE"," ",950],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",950],")",";",["T_WHITESPACE","\n                ",950],["T_BREAK","break",951],";",["T_WHITESPACE","\n            ",951],"}",["T_WHITESPACE","\n        ",952],"}",["T_WHITESPACE","\n\n        ",953],["T_RETURN","return",955],["T_WHITESPACE"," ",955],["T_ARRAY","array",955],"(",["T_CONSTANT_ENCAPSED_STRING","'size'",955],["T_WHITESPACE"," ",955],["T_DOUBLE_ARROW","=>",955],["T_WHITESPACE"," ",955],["T_VARIABLE","$total_size",955],",",["T_WHITESPACE"," ",955],["T_CONSTANT_ENCAPSED_STRING","'count'",955],["T_WHITESPACE"," ",955],["T_DOUBLE_ARROW","=>",955],["T_WHITESPACE"," ",955],["T_VARIABLE","$messages",955],",",["T_WHITESPACE"," ",955],["T_CONSTANT_ENCAPSED_STRING","'quota'",955],["T_WHITESPACE"," ",955],["T_DOUBLE_ARROW","=>",955],["T_WHITESPACE"," ",955],["T_VARIABLE","$quota",955],")",";",["T_WHITESPACE","\n    ",955],"}",["T_WHITESPACE","\n\n    ",956],["T_DOC_COMMENT","\/**\n     * @see http:\/\/www.inter7.com\/courierimap\/README.maildirquota.html \"Calculating the quota for a Maildir++\"\n     *\/",958],["T_WHITESPACE","\n    ",960],["T_PROTECTED","protected",961],["T_WHITESPACE"," ",961],["T_FUNCTION","function",961],["T_WHITESPACE"," ",961],["T_STRING","_calculateQuota",961],"(",["T_VARIABLE","$forceRecalc",961],["T_WHITESPACE"," ",961],"=",["T_WHITESPACE"," ",961],["T_STRING","false",961],")",["T_WHITESPACE"," ",961],"{",["T_WHITESPACE","\n        ",961],["T_VARIABLE","$fh",962],["T_WHITESPACE"," ",962],"=",["T_WHITESPACE"," ",962],["T_STRING","null",962],";",["T_WHITESPACE","\n        ",962],["T_VARIABLE","$total_size",963],["T_WHITESPACE"," ",963],"=",["T_WHITESPACE"," ",963],["T_LNUMBER","0",963],";",["T_WHITESPACE","\n        ",963],["T_VARIABLE","$messages",964],["T_WHITESPACE","   ",964],"=",["T_WHITESPACE"," ",964],["T_LNUMBER","0",964],";",["T_WHITESPACE","\n        ",964],["T_VARIABLE","$maildirsize",965],["T_WHITESPACE"," ",965],"=",["T_WHITESPACE"," ",965],["T_CONSTANT_ENCAPSED_STRING","''",965],";",["T_WHITESPACE","\n        ",965],["T_IF","if",966],["T_WHITESPACE"," ",966],"(","!",["T_VARIABLE","$forceRecalc",966],["T_WHITESPACE"," ",966],["T_BOOLEAN_AND","&&",966],["T_WHITESPACE"," ",966],["T_STRING","file_exists",966],"(",["T_VARIABLE","$this",966],["T_OBJECT_OPERATOR","->",966],["T_STRING","_rootdir",966],["T_WHITESPACE"," ",966],".",["T_WHITESPACE"," ",966],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",966],")",["T_WHITESPACE"," ",966],["T_BOOLEAN_AND","&&",966],["T_WHITESPACE"," ",966],["T_STRING","filesize",966],"(",["T_VARIABLE","$this",966],["T_OBJECT_OPERATOR","->",966],["T_STRING","_rootdir",966],["T_WHITESPACE"," ",966],".",["T_WHITESPACE"," ",966],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",966],")",["T_WHITESPACE"," ",966],"<",["T_WHITESPACE"," ",966],["T_LNUMBER","5120",966],")",["T_WHITESPACE"," ",966],"{",["T_WHITESPACE","\n            ",966],["T_VARIABLE","$fh",967],["T_WHITESPACE"," ",967],"=",["T_WHITESPACE"," ",967],["T_STRING","fopen",967],"(",["T_VARIABLE","$this",967],["T_OBJECT_OPERATOR","->",967],["T_STRING","_rootdir",967],["T_WHITESPACE"," ",967],".",["T_WHITESPACE"," ",967],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",967],",",["T_WHITESPACE"," ",967],["T_CONSTANT_ENCAPSED_STRING","'r'",967],")",";",["T_WHITESPACE","\n        ",967],"}",["T_WHITESPACE","\n        ",968],["T_IF","if",969],["T_WHITESPACE"," ",969],"(",["T_VARIABLE","$fh",969],")",["T_WHITESPACE"," ",969],"{",["T_WHITESPACE","\n            ",969],["T_VARIABLE","$maildirsize",970],["T_WHITESPACE"," ",970],"=",["T_WHITESPACE"," ",970],["T_STRING","fread",970],"(",["T_VARIABLE","$fh",970],",",["T_WHITESPACE"," ",970],["T_LNUMBER","5120",970],")",";",["T_WHITESPACE","\n            ",970],["T_IF","if",971],["T_WHITESPACE"," ",971],"(",["T_STRING","strlen",971],"(",["T_VARIABLE","$maildirsize",971],")",["T_WHITESPACE"," ",971],["T_IS_GREATER_OR_EQUAL",">=",971],["T_WHITESPACE"," ",971],["T_LNUMBER","5120",971],")",["T_WHITESPACE"," ",971],"{",["T_WHITESPACE","\n                ",971],["T_STRING","fclose",972],"(",["T_VARIABLE","$fh",972],")",";",["T_WHITESPACE","\n                ",972],["T_VARIABLE","$fh",973],["T_WHITESPACE"," ",973],"=",["T_WHITESPACE"," ",973],["T_STRING","null",973],";",["T_WHITESPACE","\n                ",973],["T_VARIABLE","$maildirsize",974],["T_WHITESPACE"," ",974],"=",["T_WHITESPACE"," ",974],["T_CONSTANT_ENCAPSED_STRING","''",974],";",["T_WHITESPACE","\n            ",974],"}",["T_WHITESPACE","\n        ",975],"}",["T_WHITESPACE","\n        ",976],["T_IF","if",977],["T_WHITESPACE"," ",977],"(","!",["T_VARIABLE","$fh",977],")",["T_WHITESPACE"," ",977],"{",["T_WHITESPACE","\n            ",977],["T_VARIABLE","$result",978],["T_WHITESPACE"," ",978],"=",["T_WHITESPACE"," ",978],["T_VARIABLE","$this",978],["T_OBJECT_OPERATOR","->",978],["T_STRING","_calculateMaildirsize",978],"(",")",";",["T_WHITESPACE","\n            ",978],["T_VARIABLE","$total_size",979],["T_WHITESPACE"," ",979],"=",["T_WHITESPACE"," ",979],["T_VARIABLE","$result",979],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",979],"]",";",["T_WHITESPACE","\n            ",979],["T_VARIABLE","$messages",980],["T_WHITESPACE","   ",980],"=",["T_WHITESPACE"," ",980],["T_VARIABLE","$result",980],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",980],"]",";",["T_WHITESPACE","\n            ",980],["T_VARIABLE","$quota",981],["T_WHITESPACE","      ",981],"=",["T_WHITESPACE"," ",981],["T_VARIABLE","$result",981],"[",["T_CONSTANT_ENCAPSED_STRING","'quota'",981],"]",";",["T_WHITESPACE","\n        ",981],"}",["T_WHITESPACE"," ",982],["T_ELSE","else",982],["T_WHITESPACE"," ",982],"{",["T_WHITESPACE","\n            ",982],["T_VARIABLE","$maildirsize",983],["T_WHITESPACE"," ",983],"=",["T_WHITESPACE"," ",983],["T_STRING","explode",983],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",983],",",["T_WHITESPACE"," ",983],["T_VARIABLE","$maildirsize",983],")",";",["T_WHITESPACE","\n            ",983],["T_IF","if",984],["T_WHITESPACE"," ",984],"(",["T_STRING","is_array",984],"(",["T_VARIABLE","$this",984],["T_OBJECT_OPERATOR","->",984],["T_STRING","_quota",984],")",")",["T_WHITESPACE"," ",984],"{",["T_WHITESPACE","\n                ",984],["T_VARIABLE","$quota",985],["T_WHITESPACE"," ",985],"=",["T_WHITESPACE"," ",985],["T_VARIABLE","$this",985],["T_OBJECT_OPERATOR","->",985],["T_STRING","_quota",985],";",["T_WHITESPACE","\n            ",985],"}",["T_WHITESPACE"," ",986],["T_ELSE","else",986],["T_WHITESPACE"," ",986],"{",["T_WHITESPACE","\n                ",986],["T_VARIABLE","$definition",987],["T_WHITESPACE"," ",987],"=",["T_WHITESPACE"," ",987],["T_STRING","explode",987],"(",["T_CONSTANT_ENCAPSED_STRING","','",987],",",["T_WHITESPACE"," ",987],["T_VARIABLE","$maildirsize",987],"[",["T_LNUMBER","0",987],"]",")",";",["T_WHITESPACE","\n                ",987],["T_VARIABLE","$quota",988],["T_WHITESPACE"," ",988],"=",["T_WHITESPACE"," ",988],["T_ARRAY","array",988],"(",")",";",["T_WHITESPACE","\n                ",988],["T_FOREACH","foreach",989],["T_WHITESPACE"," ",989],"(",["T_VARIABLE","$definition",989],["T_WHITESPACE"," ",989],["T_AS","as",989],["T_WHITESPACE"," ",989],["T_VARIABLE","$member",989],")",["T_WHITESPACE"," ",989],"{",["T_WHITESPACE","\n                    ",989],["T_VARIABLE","$key",990],["T_WHITESPACE"," ",990],"=",["T_WHITESPACE"," ",990],["T_VARIABLE","$member",990],"[",["T_STRING","strlen",990],"(",["T_VARIABLE","$member",990],")",["T_WHITESPACE"," ",990],"-",["T_WHITESPACE"," ",990],["T_LNUMBER","1",990],"]",";",["T_WHITESPACE","\n                    ",990],["T_IF","if",991],["T_WHITESPACE"," ",991],"(",["T_VARIABLE","$key",991],["T_WHITESPACE"," ",991],["T_IS_EQUAL","==",991],["T_WHITESPACE"," ",991],["T_CONSTANT_ENCAPSED_STRING","'S'",991],["T_WHITESPACE"," ",991],["T_BOOLEAN_OR","||",991],["T_WHITESPACE"," ",991],["T_VARIABLE","$key",991],["T_WHITESPACE"," ",991],["T_IS_EQUAL","==",991],["T_WHITESPACE"," ",991],["T_CONSTANT_ENCAPSED_STRING","'C'",991],")",["T_WHITESPACE"," ",991],"{",["T_WHITESPACE","\n                        ",991],["T_VARIABLE","$key",992],["T_WHITESPACE"," ",992],"=",["T_WHITESPACE"," ",992],["T_VARIABLE","$key",992],["T_WHITESPACE"," ",992],["T_IS_EQUAL","==",992],["T_WHITESPACE"," ",992],["T_CONSTANT_ENCAPSED_STRING","'C'",992],["T_WHITESPACE"," ",992],"?",["T_WHITESPACE"," ",992],["T_CONSTANT_ENCAPSED_STRING","'count'",992],["T_WHITESPACE"," ",992],":",["T_WHITESPACE"," ",992],["T_CONSTANT_ENCAPSED_STRING","'size'",992],";",["T_WHITESPACE","\n                    ",992],"}",["T_WHITESPACE","\n                    ",993],["T_VARIABLE","$quota",994],"[",["T_VARIABLE","$key",994],"]",["T_WHITESPACE"," ",994],"=",["T_WHITESPACE"," ",994],["T_STRING","substr",994],"(",["T_VARIABLE","$member",994],",",["T_WHITESPACE"," ",994],["T_LNUMBER","0",994],",",["T_WHITESPACE"," ",994],"-",["T_LNUMBER","1",994],")",";",["T_WHITESPACE","\n                ",994],"}",["T_WHITESPACE","\n            ",995],"}",["T_WHITESPACE","\n            ",996],["T_UNSET","unset",997],"(",["T_VARIABLE","$maildirsize",997],"[",["T_LNUMBER","0",997],"]",")",";",["T_WHITESPACE","\n            ",997],["T_FOREACH","foreach",998],["T_WHITESPACE"," ",998],"(",["T_VARIABLE","$maildirsize",998],["T_WHITESPACE"," ",998],["T_AS","as",998],["T_WHITESPACE"," ",998],["T_VARIABLE","$line",998],")",["T_WHITESPACE"," ",998],"{",["T_WHITESPACE","\n                ",998],["T_LIST","list",999],"(",["T_VARIABLE","$size",999],",",["T_WHITESPACE"," ",999],["T_VARIABLE","$count",999],")",["T_WHITESPACE"," ",999],"=",["T_WHITESPACE"," ",999],["T_STRING","explode",999],"(",["T_CONSTANT_ENCAPSED_STRING","' '",999],",",["T_WHITESPACE"," ",999],["T_STRING","trim",999],"(",["T_VARIABLE","$line",999],")",")",";",["T_WHITESPACE","\n                ",999],["T_VARIABLE","$total_size",1000],["T_WHITESPACE"," ",1000],["T_PLUS_EQUAL","+=",1000],["T_WHITESPACE"," ",1000],["T_VARIABLE","$size",1000],";",["T_WHITESPACE","\n                ",1000],["T_VARIABLE","$messages",1001],["T_WHITESPACE","   ",1001],["T_PLUS_EQUAL","+=",1001],["T_WHITESPACE"," ",1001],["T_VARIABLE","$count",1001],";",["T_WHITESPACE","\n            ",1001],"}",["T_WHITESPACE","\n        ",1002],"}",["T_WHITESPACE","\n\n        ",1003],["T_VARIABLE","$over_quota",1005],["T_WHITESPACE"," ",1005],"=",["T_WHITESPACE"," ",1005],["T_STRING","false",1005],";",["T_WHITESPACE","\n        ",1005],["T_VARIABLE","$over_quota",1006],["T_WHITESPACE"," ",1006],"=",["T_WHITESPACE"," ",1006],["T_VARIABLE","$over_quota",1006],["T_WHITESPACE"," ",1006],["T_BOOLEAN_OR","||",1006],["T_WHITESPACE"," ",1006],"(",["T_ISSET","isset",1006],"(",["T_VARIABLE","$quota",1006],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",1006],"]",")",["T_WHITESPACE","  ",1006],["T_BOOLEAN_AND","&&",1006],["T_WHITESPACE"," ",1006],["T_VARIABLE","$total_size",1006],["T_WHITESPACE"," ",1006],">",["T_WHITESPACE"," ",1006],["T_VARIABLE","$quota",1006],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",1006],"]",")",";",["T_WHITESPACE","\n        ",1006],["T_VARIABLE","$over_quota",1007],["T_WHITESPACE"," ",1007],"=",["T_WHITESPACE"," ",1007],["T_VARIABLE","$over_quota",1007],["T_WHITESPACE"," ",1007],["T_BOOLEAN_OR","||",1007],["T_WHITESPACE"," ",1007],"(",["T_ISSET","isset",1007],"(",["T_VARIABLE","$quota",1007],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",1007],"]",")",["T_WHITESPACE"," ",1007],["T_BOOLEAN_AND","&&",1007],["T_WHITESPACE"," ",1007],["T_VARIABLE","$messages",1007],["T_WHITESPACE","   ",1007],">",["T_WHITESPACE"," ",1007],["T_VARIABLE","$quota",1007],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",1007],"]",")",";",["T_WHITESPACE","\n        ",1007],["T_COMMENT","\/\/ NOTE: $maildirsize equals false if it wasn't set (AKA we recalculated) or it's only\n",1008],["T_WHITESPACE","        ",1009],["T_COMMENT","\/\/ one line, because $maildirsize[0] gets unsetted.\n",1009],["T_WHITESPACE","        ",1010],["T_COMMENT","\/\/ Also we're using local time to calculate the 15 minute offset. Touching a file just for known the\n",1010],["T_WHITESPACE","        ",1011],["T_COMMENT","\/\/ local time of the file storage isn't worth the hassle.\n",1011],["T_WHITESPACE","        ",1012],["T_IF","if",1012],["T_WHITESPACE"," ",1012],"(",["T_VARIABLE","$over_quota",1012],["T_WHITESPACE"," ",1012],["T_BOOLEAN_AND","&&",1012],["T_WHITESPACE"," ",1012],"(",["T_VARIABLE","$maildirsize",1012],["T_WHITESPACE"," ",1012],["T_BOOLEAN_OR","||",1012],["T_WHITESPACE"," ",1012],["T_STRING","filemtime",1012],"(",["T_VARIABLE","$this",1012],["T_OBJECT_OPERATOR","->",1012],["T_STRING","_rootdir",1012],["T_WHITESPACE"," ",1012],".",["T_WHITESPACE"," ",1012],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",1012],")",["T_WHITESPACE"," ",1012],">",["T_WHITESPACE"," ",1012],["T_STRING","time",1012],"(",")",["T_WHITESPACE"," ",1012],"-",["T_WHITESPACE"," ",1012],["T_LNUMBER","900",1012],")",")",["T_WHITESPACE"," ",1012],"{",["T_WHITESPACE","\n            ",1012],["T_VARIABLE","$result",1013],["T_WHITESPACE"," ",1013],"=",["T_WHITESPACE"," ",1013],["T_VARIABLE","$this",1013],["T_OBJECT_OPERATOR","->",1013],["T_STRING","_calculateMaildirsize",1013],"(",")",";",["T_WHITESPACE","\n            ",1013],["T_VARIABLE","$total_size",1014],["T_WHITESPACE"," ",1014],"=",["T_WHITESPACE"," ",1014],["T_VARIABLE","$result",1014],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",1014],"]",";",["T_WHITESPACE","\n            ",1014],["T_VARIABLE","$messages",1015],["T_WHITESPACE","   ",1015],"=",["T_WHITESPACE"," ",1015],["T_VARIABLE","$result",1015],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",1015],"]",";",["T_WHITESPACE","\n            ",1015],["T_VARIABLE","$quota",1016],["T_WHITESPACE","      ",1016],"=",["T_WHITESPACE"," ",1016],["T_VARIABLE","$result",1016],"[",["T_CONSTANT_ENCAPSED_STRING","'quota'",1016],"]",";",["T_WHITESPACE","\n            ",1016],["T_VARIABLE","$over_quota",1017],["T_WHITESPACE"," ",1017],"=",["T_WHITESPACE"," ",1017],["T_STRING","false",1017],";",["T_WHITESPACE","\n            ",1017],["T_VARIABLE","$over_quota",1018],["T_WHITESPACE"," ",1018],"=",["T_WHITESPACE"," ",1018],["T_VARIABLE","$over_quota",1018],["T_WHITESPACE"," ",1018],["T_BOOLEAN_OR","||",1018],["T_WHITESPACE"," ",1018],"(",["T_ISSET","isset",1018],"(",["T_VARIABLE","$quota",1018],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",1018],"]",")",["T_WHITESPACE","  ",1018],["T_BOOLEAN_AND","&&",1018],["T_WHITESPACE"," ",1018],["T_VARIABLE","$total_size",1018],["T_WHITESPACE"," ",1018],">",["T_WHITESPACE"," ",1018],["T_VARIABLE","$quota",1018],"[",["T_CONSTANT_ENCAPSED_STRING","'size'",1018],"]",")",";",["T_WHITESPACE","\n            ",1018],["T_VARIABLE","$over_quota",1019],["T_WHITESPACE"," ",1019],"=",["T_WHITESPACE"," ",1019],["T_VARIABLE","$over_quota",1019],["T_WHITESPACE"," ",1019],["T_BOOLEAN_OR","||",1019],["T_WHITESPACE"," ",1019],"(",["T_ISSET","isset",1019],"(",["T_VARIABLE","$quota",1019],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",1019],"]",")",["T_WHITESPACE"," ",1019],["T_BOOLEAN_AND","&&",1019],["T_WHITESPACE"," ",1019],["T_VARIABLE","$messages",1019],["T_WHITESPACE","   ",1019],">",["T_WHITESPACE"," ",1019],["T_VARIABLE","$quota",1019],"[",["T_CONSTANT_ENCAPSED_STRING","'count'",1019],"]",")",";",["T_WHITESPACE","\n        ",1019],"}",["T_WHITESPACE","\n\n        ",1020],["T_IF","if",1022],["T_WHITESPACE"," ",1022],"(",["T_VARIABLE","$fh",1022],")",["T_WHITESPACE"," ",1022],"{",["T_WHITESPACE","\n            ",1022],["T_COMMENT","\/\/ TODO is there a safe way to keep the handle open for writing?\n",1023],["T_WHITESPACE","            ",1024],["T_STRING","fclose",1024],"(",["T_VARIABLE","$fh",1024],")",";",["T_WHITESPACE","\n        ",1024],"}",["T_WHITESPACE","\n\n        ",1025],["T_RETURN","return",1027],["T_WHITESPACE"," ",1027],["T_ARRAY","array",1027],"(",["T_CONSTANT_ENCAPSED_STRING","'size'",1027],["T_WHITESPACE"," ",1027],["T_DOUBLE_ARROW","=>",1027],["T_WHITESPACE"," ",1027],["T_VARIABLE","$total_size",1027],",",["T_WHITESPACE"," ",1027],["T_CONSTANT_ENCAPSED_STRING","'count'",1027],["T_WHITESPACE"," ",1027],["T_DOUBLE_ARROW","=>",1027],["T_WHITESPACE"," ",1027],["T_VARIABLE","$messages",1027],",",["T_WHITESPACE"," ",1027],["T_CONSTANT_ENCAPSED_STRING","'quota'",1027],["T_WHITESPACE"," ",1027],["T_DOUBLE_ARROW","=>",1027],["T_WHITESPACE"," ",1027],["T_VARIABLE","$quota",1027],",",["T_WHITESPACE"," ",1027],["T_CONSTANT_ENCAPSED_STRING","'over_quota'",1027],["T_WHITESPACE"," ",1027],["T_DOUBLE_ARROW","=>",1027],["T_WHITESPACE"," ",1027],["T_VARIABLE","$over_quota",1027],")",";",["T_WHITESPACE","\n    ",1027],"}",["T_WHITESPACE","\n\n    ",1028],["T_PROTECTED","protected",1030],["T_WHITESPACE"," ",1030],["T_FUNCTION","function",1030],["T_WHITESPACE"," ",1030],["T_STRING","_addQuotaEntry",1030],"(",["T_VARIABLE","$size",1030],",",["T_WHITESPACE"," ",1030],["T_VARIABLE","$count",1030],["T_WHITESPACE"," ",1030],"=",["T_WHITESPACE"," ",1030],["T_LNUMBER","1",1030],")",["T_WHITESPACE"," ",1030],"{",["T_WHITESPACE","\n        ",1030],["T_IF","if",1031],["T_WHITESPACE"," ",1031],"(","!",["T_STRING","file_exists",1031],"(",["T_VARIABLE","$this",1031],["T_OBJECT_OPERATOR","->",1031],["T_STRING","_rootdir",1031],["T_WHITESPACE"," ",1031],".",["T_WHITESPACE"," ",1031],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",1031],")",")",["T_WHITESPACE"," ",1031],"{",["T_WHITESPACE","\n            ",1031],["T_COMMENT","\/\/ TODO: should get file handler from _calculateQuota\n",1032],["T_WHITESPACE","        ",1033],"}",["T_WHITESPACE","\n        ",1033],["T_VARIABLE","$size",1034],["T_WHITESPACE"," ",1034],"=",["T_WHITESPACE"," ",1034],["T_INT_CAST","(int)",1034],["T_VARIABLE","$size",1034],";",["T_WHITESPACE","\n        ",1034],["T_VARIABLE","$count",1035],["T_WHITESPACE"," ",1035],"=",["T_WHITESPACE"," ",1035],["T_INT_CAST","(int)",1035],["T_VARIABLE","$count",1035],";",["T_WHITESPACE","\n        ",1035],["T_STRING","file_put_contents",1036],"(",["T_VARIABLE","$this",1036],["T_OBJECT_OPERATOR","->",1036],["T_STRING","_rootdir",1036],["T_WHITESPACE"," ",1036],".",["T_WHITESPACE"," ",1036],["T_CONSTANT_ENCAPSED_STRING","'maildirsize'",1036],",",["T_WHITESPACE"," ",1036],"\"",["T_VARIABLE","$size",1036],["T_ENCAPSED_AND_WHITESPACE"," ",1036],["T_VARIABLE","$count",1036],["T_ENCAPSED_AND_WHITESPACE","\\n",1036],"\"",",",["T_WHITESPACE"," ",1036],["T_STRING","FILE_APPEND",1036],")",";",["T_WHITESPACE","\n    ",1036],"}",["T_WHITESPACE","\n\n    ",1037],["T_DOC_COMMENT","\/**\n     * check if storage is currently over quota\n     *\n     * @param bool $detailedResponse return known data of quota and current size and message count @see _calculateQuota()\n     * @return bool|array over quota state or detailed response\n     *\/",1039],["T_WHITESPACE","\n    ",1044],["T_PUBLIC","public",1045],["T_WHITESPACE"," ",1045],["T_FUNCTION","function",1045],["T_WHITESPACE"," ",1045],["T_STRING","checkQuota",1045],"(",["T_VARIABLE","$detailedResponse",1045],["T_WHITESPACE"," ",1045],"=",["T_WHITESPACE"," ",1045],["T_STRING","false",1045],",",["T_WHITESPACE"," ",1045],["T_VARIABLE","$forceRecalc",1045],["T_WHITESPACE"," ",1045],"=",["T_WHITESPACE"," ",1045],["T_STRING","false",1045],")",["T_WHITESPACE"," ",1045],"{",["T_WHITESPACE","\n        ",1045],["T_VARIABLE","$result",1046],["T_WHITESPACE"," ",1046],"=",["T_WHITESPACE"," ",1046],["T_VARIABLE","$this",1046],["T_OBJECT_OPERATOR","->",1046],["T_STRING","_calculateQuota",1046],"(",["T_VARIABLE","$forceRecalc",1046],")",";",["T_WHITESPACE","\n        ",1046],["T_RETURN","return",1047],["T_WHITESPACE"," ",1047],["T_VARIABLE","$detailedResponse",1047],["T_WHITESPACE"," ",1047],"?",["T_WHITESPACE"," ",1047],["T_VARIABLE","$result",1047],["T_WHITESPACE"," ",1047],":",["T_WHITESPACE"," ",1047],["T_VARIABLE","$result",1047],"[",["T_CONSTANT_ENCAPSED_STRING","'over_quota'",1047],"]",";",["T_WHITESPACE","\n    ",1047],"}",["T_WHITESPACE","\n",1048],"}",["T_WHITESPACE","\n",1049]]