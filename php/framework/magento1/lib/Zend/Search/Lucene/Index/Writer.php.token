[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Zend Framework\n *\n * LICENSE\n *\n * This source file is subject to the new BSD license that is bundled\n * with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/framework.zend.com\/license\/new-bsd\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@zend.com so we can send you a copy immediately.\n *\n * @category   Zend\n * @package    Zend_Search_Lucene\n * @subpackage Index\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n * @version    $Id$\n *\/",2],["T_WHITESPACE","\n\n\n",21],["T_DOC_COMMENT","\/** Zend_Search_Lucene_LockManager *\/",24],["T_WHITESPACE","\n",24],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/LockManager.php';\n",25],["T_WHITESPACE","\n\n",26],["T_DOC_COMMENT","\/**\n * @category   Zend\n * @package    Zend_Search_Lucene\n * @subpackage Index\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",28],["T_WHITESPACE","\n",34],["T_CLASS","class",35],["T_WHITESPACE"," ",35],["T_STRING","Zend_Search_Lucene_Index_Writer",35],["T_WHITESPACE","\n",35],"{",["T_WHITESPACE","\n    ",36],["T_DOC_COMMENT","\/**\n     * @todo Implement Analyzer substitution\n     * @todo Implement Zend_Search_Lucene_Storage_DirectoryRAM and Zend_Search_Lucene_Storage_FileRAM to use it for\n     *       temporary index files\n     * @todo Directory lock processing\n     *\/",37],["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * Number of documents required before the buffered in-memory\n     * documents are written into a new Segment\n     *\n     * Default value is 10\n     *\n     * @var integer\n     *\/",44],["T_WHITESPACE","\n    ",51],["T_PUBLIC","public",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$maxBufferedDocs",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_LNUMBER","10",52],";",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Largest number of documents ever merged by addDocument().\n     * Small values (e.g., less than 10,000) are best for interactive indexing,\n     * as this limits the length of pauses while indexing to a few seconds.\n     * Larger values are best for batched indexing and speedier searches.\n     *\n     * Default value is PHP_INT_MAX\n     *\n     * @var integer\n     *\/",54],["T_WHITESPACE","\n    ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_VARIABLE","$maxMergeDocs",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","PHP_INT_MAX",64],";",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * Determines how often segment indices are merged by addDocument().\n     *\n     * With smaller values, less RAM is used while indexing,\n     * and searches on unoptimized indices are faster,\n     * but indexing speed is slower.\n     *\n     * With larger values, more RAM is used during indexing,\n     * and while searches on unoptimized indices are slower,\n     * indexing is faster.\n     *\n     * Thus larger values (> 10) are best for batch index creation,\n     * and smaller values (< 10) for indices that are interactively maintained.\n     *\n     * Default value is 10\n     *\n     * @var integer\n     *\/",66],["T_WHITESPACE","\n    ",83],["T_PUBLIC","public",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$mergeFactor",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_LNUMBER","10",84],";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * File system adapter.\n     *\n     * @var Zend_Search_Lucene_Storage_Directory\n     *\/",86],["T_WHITESPACE","\n    ",90],["T_PRIVATE","private",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$_directory",91],["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_STRING","null",91],";",["T_WHITESPACE","\n\n\n    ",91],["T_DOC_COMMENT","\/**\n     * Changes counter.\n     *\n     * @var integer\n     *\/",94],["T_WHITESPACE","\n    ",98],["T_PRIVATE","private",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$_versionUpdate",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_LNUMBER","0",99],";",["T_WHITESPACE","\n\n    ",99],["T_DOC_COMMENT","\/**\n     * List of the segments, created by index writer\n     * Array of Zend_Search_Lucene_Index_SegmentInfo objects\n     *\n     * @var array\n     *\/",101],["T_WHITESPACE","\n    ",106],["T_PRIVATE","private",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$_newSegments",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",")",";",["T_WHITESPACE","\n\n    ",107],["T_DOC_COMMENT","\/**\n     * List of segments to be deleted on commit\n     *\n     * @var array\n     *\/",109],["T_WHITESPACE","\n    ",113],["T_PRIVATE","private",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$_segmentsToDelete",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_ARRAY","array",114],"(",")",";",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Current segment to add documents\n     *\n     * @var Zend_Search_Lucene_Index_SegmentWriter_DocumentWriter\n     *\/",116],["T_WHITESPACE","\n    ",120],["T_PRIVATE","private",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$_currentSegment",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_STRING","null",121],";",["T_WHITESPACE","\n\n    ",121],["T_DOC_COMMENT","\/**\n     * Array of Zend_Search_Lucene_Index_SegmentInfo objects for this index.\n     *\n     * It's a reference to the corresponding Zend_Search_Lucene::$_segmentInfos array\n     *\n     * @var array Zend_Search_Lucene_Index_SegmentInfo\n     *\/",123],["T_WHITESPACE","\n    ",129],["T_PRIVATE","private",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$_segmentInfos",130],";",["T_WHITESPACE","\n\n    ",130],["T_DOC_COMMENT","\/**\n     * Index target format version\n     *\n     * @var integer\n     *\/",132],["T_WHITESPACE","\n    ",136],["T_PRIVATE","private",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$_targetFormatVersion",137],";",["T_WHITESPACE","\n\n    ",137],["T_DOC_COMMENT","\/**\n     * List of indexfiles extensions\n     *\n     * @var array\n     *\/",139],["T_WHITESPACE","\n    ",143],["T_PRIVATE","private",144],["T_WHITESPACE"," ",144],["T_STATIC","static",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$_indexExtensions",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_ARRAY","array",144],"(",["T_CONSTANT_ENCAPSED_STRING","'.cfs'",144],["T_WHITESPACE"," ",144],["T_DOUBLE_ARROW","=>",144],["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'.cfs'",144],",",["T_WHITESPACE","\n                                             ",144],["T_CONSTANT_ENCAPSED_STRING","'.cfx'",145],["T_WHITESPACE"," ",145],["T_DOUBLE_ARROW","=>",145],["T_WHITESPACE"," ",145],["T_CONSTANT_ENCAPSED_STRING","'.cfx'",145],",",["T_WHITESPACE","\n                                             ",145],["T_CONSTANT_ENCAPSED_STRING","'.fnm'",146],["T_WHITESPACE"," ",146],["T_DOUBLE_ARROW","=>",146],["T_WHITESPACE"," ",146],["T_CONSTANT_ENCAPSED_STRING","'.fnm'",146],",",["T_WHITESPACE","\n                                             ",146],["T_CONSTANT_ENCAPSED_STRING","'.fdx'",147],["T_WHITESPACE"," ",147],["T_DOUBLE_ARROW","=>",147],["T_WHITESPACE"," ",147],["T_CONSTANT_ENCAPSED_STRING","'.fdx'",147],",",["T_WHITESPACE","\n                                             ",147],["T_CONSTANT_ENCAPSED_STRING","'.fdt'",148],["T_WHITESPACE"," ",148],["T_DOUBLE_ARROW","=>",148],["T_WHITESPACE"," ",148],["T_CONSTANT_ENCAPSED_STRING","'.fdt'",148],",",["T_WHITESPACE","\n                                             ",148],["T_CONSTANT_ENCAPSED_STRING","'.tis'",149],["T_WHITESPACE"," ",149],["T_DOUBLE_ARROW","=>",149],["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'.tis'",149],",",["T_WHITESPACE","\n                                             ",149],["T_CONSTANT_ENCAPSED_STRING","'.tii'",150],["T_WHITESPACE"," ",150],["T_DOUBLE_ARROW","=>",150],["T_WHITESPACE"," ",150],["T_CONSTANT_ENCAPSED_STRING","'.tii'",150],",",["T_WHITESPACE","\n                                             ",150],["T_CONSTANT_ENCAPSED_STRING","'.frq'",151],["T_WHITESPACE"," ",151],["T_DOUBLE_ARROW","=>",151],["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","'.frq'",151],",",["T_WHITESPACE","\n                                             ",151],["T_CONSTANT_ENCAPSED_STRING","'.prx'",152],["T_WHITESPACE"," ",152],["T_DOUBLE_ARROW","=>",152],["T_WHITESPACE"," ",152],["T_CONSTANT_ENCAPSED_STRING","'.prx'",152],",",["T_WHITESPACE","\n                                             ",152],["T_CONSTANT_ENCAPSED_STRING","'.tvx'",153],["T_WHITESPACE"," ",153],["T_DOUBLE_ARROW","=>",153],["T_WHITESPACE"," ",153],["T_CONSTANT_ENCAPSED_STRING","'.tvx'",153],",",["T_WHITESPACE","\n                                             ",153],["T_CONSTANT_ENCAPSED_STRING","'.tvd'",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_CONSTANT_ENCAPSED_STRING","'.tvd'",154],",",["T_WHITESPACE","\n                                             ",154],["T_CONSTANT_ENCAPSED_STRING","'.tvf'",155],["T_WHITESPACE"," ",155],["T_DOUBLE_ARROW","=>",155],["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","'.tvf'",155],",",["T_WHITESPACE","\n                                             ",155],["T_CONSTANT_ENCAPSED_STRING","'.del'",156],["T_WHITESPACE"," ",156],["T_DOUBLE_ARROW","=>",156],["T_WHITESPACE"," ",156],["T_CONSTANT_ENCAPSED_STRING","'.del'",156],",",["T_WHITESPACE","\n                                             ",156],["T_CONSTANT_ENCAPSED_STRING","'.sti'",157],["T_WHITESPACE"," ",157],["T_DOUBLE_ARROW","=>",157],["T_WHITESPACE"," ",157],["T_CONSTANT_ENCAPSED_STRING","'.sti'",157],["T_WHITESPACE"," ",157],")",";",["T_WHITESPACE","\n\n\n    ",157],["T_DOC_COMMENT","\/**\n     * Create empty index\n     *\n     * @param Zend_Search_Lucene_Storage_Directory $directory\n     * @param integer $generation\n     * @param integer $nameCount\n     *\/",160],["T_WHITESPACE","\n    ",166],["T_PUBLIC","public",167],["T_WHITESPACE"," ",167],["T_STATIC","static",167],["T_WHITESPACE"," ",167],["T_FUNCTION","function",167],["T_WHITESPACE"," ",167],["T_STRING","createIndex",167],"(",["T_STRING","Zend_Search_Lucene_Storage_Directory",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$directory",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$generation",167],",",["T_WHITESPACE"," ",167],["T_VARIABLE","$nameCount",167],")",["T_WHITESPACE","\n    ",167],"{",["T_WHITESPACE","\n        ",168],["T_IF","if",169],["T_WHITESPACE"," ",169],"(",["T_VARIABLE","$generation",169],["T_WHITESPACE"," ",169],["T_IS_EQUAL","==",169],["T_WHITESPACE"," ",169],["T_LNUMBER","0",169],")",["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n            ",169],["T_COMMENT","\/\/ Create index in pre-2.1 mode\n",170],["T_WHITESPACE","            ",171],["T_FOREACH","foreach",171],["T_WHITESPACE"," ",171],"(",["T_VARIABLE","$directory",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","fileList",171],"(",")",["T_WHITESPACE"," ",171],["T_AS","as",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$file",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n                ",171],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_VARIABLE","$file",172],["T_WHITESPACE"," ",172],["T_IS_EQUAL","==",172],["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'deletable'",172],["T_WHITESPACE"," ",172],["T_BOOLEAN_OR","||",172],["T_WHITESPACE","\n                    ",172],["T_VARIABLE","$file",173],["T_WHITESPACE"," ",173],["T_IS_EQUAL","==",173],["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'segments'",173],["T_WHITESPACE","  ",173],["T_BOOLEAN_OR","||",173],["T_WHITESPACE","\n                    ",173],["T_ISSET","isset",174],"(",["T_STRING","self",174],["T_DOUBLE_COLON","::",174],["T_VARIABLE","$_indexExtensions",174],"[",["T_WHITESPACE"," ",174],["T_STRING","substr",174],"(",["T_VARIABLE","$file",174],",",["T_WHITESPACE"," ",174],["T_STRING","strlen",174],"(",["T_VARIABLE","$file",174],")","-",["T_LNUMBER","4",174],")","]",")",["T_WHITESPACE"," ",174],["T_BOOLEAN_OR","||",174],["T_WHITESPACE","\n                    ",174],["T_STRING","preg_match",175],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\\.f\\d+$\/i'",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$file",175],")",["T_WHITESPACE"," ",175],["T_COMMENT","\/* matches <segment_name>.f<decimal_nmber> file names *\/",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n                        ",175],["T_VARIABLE","$directory",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","deleteFile",176],"(",["T_VARIABLE","$file",176],")",";",["T_WHITESPACE","\n                    ",176],"}",["T_WHITESPACE","\n            ",177],"}",["T_WHITESPACE","\n\n            ",178],["T_VARIABLE","$segmentsFile",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$directory",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","createFile",180],"(",["T_CONSTANT_ENCAPSED_STRING","'segments'",180],")",";",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$segmentsFile",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","writeInt",181],"(",["T_INT_CAST","(int)",181],["T_LNUMBER","0xFFFFFFFF",181],")",";",["T_WHITESPACE","\n\n            ",181],["T_COMMENT","\/\/ write version (initialized by current time)\n",183],["T_WHITESPACE","            ",184],["T_VARIABLE","$segmentsFile",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","writeLong",184],"(",["T_STRING","round",184],"(",["T_STRING","microtime",184],"(",["T_STRING","true",184],")",")",")",";",["T_WHITESPACE","\n\n            ",184],["T_COMMENT","\/\/ write name counter\n",186],["T_WHITESPACE","            ",187],["T_VARIABLE","$segmentsFile",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","writeInt",187],"(",["T_VARIABLE","$nameCount",187],")",";",["T_WHITESPACE","\n            ",187],["T_COMMENT","\/\/ write segment counter\n",188],["T_WHITESPACE","            ",189],["T_VARIABLE","$segmentsFile",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","writeInt",189],"(",["T_LNUMBER","0",189],")",";",["T_WHITESPACE","\n\n            ",189],["T_VARIABLE","$deletableFile",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_VARIABLE","$directory",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","createFile",191],"(",["T_CONSTANT_ENCAPSED_STRING","'deletable'",191],")",";",["T_WHITESPACE","\n            ",191],["T_COMMENT","\/\/ write counter\n",192],["T_WHITESPACE","            ",193],["T_VARIABLE","$deletableFile",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","writeInt",193],"(",["T_LNUMBER","0",193],")",";",["T_WHITESPACE","\n        ",193],"}",["T_WHITESPACE"," ",194],["T_ELSE","else",194],["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n            ",194],["T_VARIABLE","$genFile",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_VARIABLE","$directory",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","createFile",195],"(",["T_CONSTANT_ENCAPSED_STRING","'segments.gen'",195],")",";",["T_WHITESPACE","\n\n            ",195],["T_VARIABLE","$genFile",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","writeInt",197],"(",["T_INT_CAST","(int)",197],["T_LNUMBER","0xFFFFFFFE",197],")",";",["T_WHITESPACE","\n            ",197],["T_COMMENT","\/\/ Write generation two times\n",198],["T_WHITESPACE","            ",199],["T_VARIABLE","$genFile",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","writeLong",199],"(",["T_VARIABLE","$generation",199],")",";",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$genFile",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","writeLong",200],"(",["T_VARIABLE","$generation",200],")",";",["T_WHITESPACE","\n\n            ",200],["T_VARIABLE","$segmentsFile",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$directory",202],["T_OBJECT_OPERATOR","->",202],["T_STRING","createFile",202],"(",["T_STRING","Zend_Search_Lucene",202],["T_DOUBLE_COLON","::",202],["T_STRING","getSegmentFileName",202],"(",["T_VARIABLE","$generation",202],")",")",";",["T_WHITESPACE","\n            ",202],["T_VARIABLE","$segmentsFile",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","writeInt",203],"(",["T_INT_CAST","(int)",203],["T_LNUMBER","0xFFFFFFFD",203],")",";",["T_WHITESPACE","\n\n            ",203],["T_COMMENT","\/\/ write version (initialized by current time)\n",205],["T_WHITESPACE","            ",206],["T_VARIABLE","$segmentsFile",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","writeLong",206],"(",["T_STRING","round",206],"(",["T_STRING","microtime",206],"(",["T_STRING","true",206],")",")",")",";",["T_WHITESPACE","\n\n            ",206],["T_COMMENT","\/\/ write name counter\n",208],["T_WHITESPACE","            ",209],["T_VARIABLE","$segmentsFile",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","writeInt",209],"(",["T_VARIABLE","$nameCount",209],")",";",["T_WHITESPACE","\n            ",209],["T_COMMENT","\/\/ write segment counter\n",210],["T_WHITESPACE","            ",211],["T_VARIABLE","$segmentsFile",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","writeInt",211],"(",["T_LNUMBER","0",211],")",";",["T_WHITESPACE","\n        ",211],"}",["T_WHITESPACE","\n    ",212],"}",["T_WHITESPACE","\n\n    ",213],["T_DOC_COMMENT","\/**\n     * Open the index for writing\n     *\n     * @param Zend_Search_Lucene_Storage_Directory $directory\n     * @param array $segmentInfos\n     * @param integer $targetFormatVersion\n     * @param Zend_Search_Lucene_Storage_File $cleanUpLock\n     *\/",215],["T_WHITESPACE","\n    ",222],["T_PUBLIC","public",223],["T_WHITESPACE"," ",223],["T_FUNCTION","function",223],["T_WHITESPACE"," ",223],["T_STRING","__construct",223],"(",["T_STRING","Zend_Search_Lucene_Storage_Directory",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$directory",223],",",["T_WHITESPACE"," ",223],"&",["T_VARIABLE","$segmentInfos",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$targetFormatVersion",223],")",["T_WHITESPACE","\n    ",223],"{",["T_WHITESPACE","\n        ",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","_directory",225],["T_WHITESPACE","           ",225],"=",["T_WHITESPACE"," ",225],["T_VARIABLE","$directory",225],";",["T_WHITESPACE","\n        ",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","_segmentInfos",226],["T_WHITESPACE","        ",226],"=",["T_WHITESPACE"," ",226],"&",["T_VARIABLE","$segmentInfos",226],";",["T_WHITESPACE","\n        ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","_targetFormatVersion",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$targetFormatVersion",227],";",["T_WHITESPACE","\n    ",227],"}",["T_WHITESPACE","\n\n    ",228],["T_DOC_COMMENT","\/**\n     * Adds a document to this index.\n     *\n     * @param Zend_Search_Lucene_Document $document\n     *\/",230],["T_WHITESPACE","\n    ",234],["T_PUBLIC","public",235],["T_WHITESPACE"," ",235],["T_FUNCTION","function",235],["T_WHITESPACE"," ",235],["T_STRING","addDocument",235],"(",["T_STRING","Zend_Search_Lucene_Document",235],["T_WHITESPACE"," ",235],["T_VARIABLE","$document",235],")",["T_WHITESPACE","\n    ",235],"{",["T_WHITESPACE","\n        ",236],["T_DOC_COMMENT","\/** Zend_Search_Lucene_Index_SegmentWriter_DocumentWriter *\/",237],["T_WHITESPACE","\n        ",237],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Index\/SegmentWriter\/DocumentWriter.php';\n",238],["T_WHITESPACE","\n        ",239],["T_IF","if",240],["T_WHITESPACE"," ",240],"(",["T_VARIABLE","$this",240],["T_OBJECT_OPERATOR","->",240],["T_STRING","_currentSegment",240],["T_WHITESPACE"," ",240],["T_IS_IDENTICAL","===",240],["T_WHITESPACE"," ",240],["T_STRING","null",240],")",["T_WHITESPACE"," ",240],"{",["T_WHITESPACE","\n            ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","_currentSegment",241],["T_WHITESPACE"," ",241],"=",["T_WHITESPACE","\n                ",241],["T_NEW","new",242],["T_WHITESPACE"," ",242],["T_STRING","Zend_Search_Lucene_Index_SegmentWriter_DocumentWriter",242],"(",["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","_directory",242],",",["T_WHITESPACE"," ",242],["T_VARIABLE","$this",242],["T_OBJECT_OPERATOR","->",242],["T_STRING","_newSegmentName",242],"(",")",")",";",["T_WHITESPACE","\n        ",242],"}",["T_WHITESPACE","\n        ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","_currentSegment",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","addDocument",244],"(",["T_VARIABLE","$document",244],")",";",["T_WHITESPACE","\n\n        ",244],["T_IF","if",246],["T_WHITESPACE"," ",246],"(",["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","_currentSegment",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","count",246],"(",")",["T_WHITESPACE"," ",246],["T_IS_GREATER_OR_EQUAL",">=",246],["T_WHITESPACE"," ",246],["T_VARIABLE","$this",246],["T_OBJECT_OPERATOR","->",246],["T_STRING","maxBufferedDocs",246],")",["T_WHITESPACE"," ",246],"{",["T_WHITESPACE","\n            ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","commit",247],"(",")",";",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE","\n\n        ",248],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","_maybeMergeSegments",250],"(",")",";",["T_WHITESPACE","\n\n        ",250],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","_versionUpdate",252],["T_INC","++",252],";",["T_WHITESPACE","\n    ",252],"}",["T_WHITESPACE","\n\n\n    ",253],["T_DOC_COMMENT","\/**\n     * Check if we have anything to merge\n     *\n     * @return boolean\n     *\/",256],["T_WHITESPACE","\n    ",260],["T_PRIVATE","private",261],["T_WHITESPACE"," ",261],["T_FUNCTION","function",261],["T_WHITESPACE"," ",261],["T_STRING","_hasAnythingToMerge",261],"(",")",["T_WHITESPACE","\n    ",261],"{",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$segmentSizes",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_ARRAY","array",263],"(",")",";",["T_WHITESPACE","\n        ",263],["T_FOREACH","foreach",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$this",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","_segmentInfos",264],["T_WHITESPACE"," ",264],["T_AS","as",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$segName",264],["T_WHITESPACE"," ",264],["T_DOUBLE_ARROW","=>",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$segmentInfo",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n            ",264],["T_VARIABLE","$segmentSizes",265],"[",["T_VARIABLE","$segName",265],"]",["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$segmentInfo",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","count",265],"(",")",";",["T_WHITESPACE","\n        ",265],"}",["T_WHITESPACE","\n\n        ",266],["T_VARIABLE","$mergePool",268],["T_WHITESPACE","   ",268],"=",["T_WHITESPACE"," ",268],["T_ARRAY","array",268],"(",")",";",["T_WHITESPACE","\n        ",268],["T_VARIABLE","$poolSize",269],["T_WHITESPACE","    ",269],"=",["T_WHITESPACE"," ",269],["T_LNUMBER","0",269],";",["T_WHITESPACE","\n        ",269],["T_VARIABLE","$sizeToMerge",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","maxBufferedDocs",270],";",["T_WHITESPACE","\n        ",270],["T_STRING","asort",271],"(",["T_VARIABLE","$segmentSizes",271],",",["T_WHITESPACE"," ",271],["T_STRING","SORT_NUMERIC",271],")",";",["T_WHITESPACE","\n        ",271],["T_FOREACH","foreach",272],["T_WHITESPACE"," ",272],"(",["T_VARIABLE","$segmentSizes",272],["T_WHITESPACE"," ",272],["T_AS","as",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$segName",272],["T_WHITESPACE"," ",272],["T_DOUBLE_ARROW","=>",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$size",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n            ",272],["T_COMMENT","\/\/ Check, if segment comes into a new merging block\n",273],["T_WHITESPACE","            ",274],["T_WHILE","while",274],["T_WHITESPACE"," ",274],"(",["T_VARIABLE","$size",274],["T_WHITESPACE"," ",274],["T_IS_GREATER_OR_EQUAL",">=",274],["T_WHITESPACE"," ",274],["T_VARIABLE","$sizeToMerge",274],")",["T_WHITESPACE"," ",274],"{",["T_WHITESPACE","\n                ",274],["T_COMMENT","\/\/ Merge previous block if it's large enough\n",275],["T_WHITESPACE","                ",276],["T_IF","if",276],["T_WHITESPACE"," ",276],"(",["T_VARIABLE","$poolSize",276],["T_WHITESPACE"," ",276],["T_IS_GREATER_OR_EQUAL",">=",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$sizeToMerge",276],")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n                    ",276],["T_RETURN","return",277],["T_WHITESPACE"," ",277],["T_STRING","true",277],";",["T_WHITESPACE","\n                ",277],"}",["T_WHITESPACE","\n                ",278],["T_VARIABLE","$mergePool",279],["T_WHITESPACE","   ",279],"=",["T_WHITESPACE"," ",279],["T_ARRAY","array",279],"(",")",";",["T_WHITESPACE","\n                ",279],["T_VARIABLE","$poolSize",280],["T_WHITESPACE","    ",280],"=",["T_WHITESPACE"," ",280],["T_LNUMBER","0",280],";",["T_WHITESPACE","\n\n                ",280],["T_VARIABLE","$sizeToMerge",282],["T_WHITESPACE"," ",282],["T_MUL_EQUAL","*=",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","mergeFactor",282],";",["T_WHITESPACE","\n\n                ",282],["T_IF","if",284],["T_WHITESPACE"," ",284],"(",["T_VARIABLE","$sizeToMerge",284],["T_WHITESPACE"," ",284],">",["T_WHITESPACE"," ",284],["T_VARIABLE","$this",284],["T_OBJECT_OPERATOR","->",284],["T_STRING","maxMergeDocs",284],")",["T_WHITESPACE"," ",284],"{",["T_WHITESPACE","\n                    ",284],["T_RETURN","return",285],["T_WHITESPACE"," ",285],["T_STRING","false",285],";",["T_WHITESPACE","\n                ",285],"}",["T_WHITESPACE","\n            ",286],"}",["T_WHITESPACE","\n\n            ",287],["T_VARIABLE","$mergePool",289],"[","]",["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_VARIABLE","$this",289],["T_OBJECT_OPERATOR","->",289],["T_STRING","_segmentInfos",289],"[",["T_VARIABLE","$segName",289],"]",";",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$poolSize",290],["T_WHITESPACE"," ",290],["T_PLUS_EQUAL","+=",290],["T_WHITESPACE"," ",290],["T_VARIABLE","$size",290],";",["T_WHITESPACE","\n        ",290],"}",["T_WHITESPACE","\n\n        ",291],["T_IF","if",293],["T_WHITESPACE"," ",293],"(",["T_VARIABLE","$poolSize",293],["T_WHITESPACE"," ",293],["T_IS_GREATER_OR_EQUAL",">=",293],["T_WHITESPACE"," ",293],["T_VARIABLE","$sizeToMerge",293],")",["T_WHITESPACE"," ",293],"{",["T_WHITESPACE","\n            ",293],["T_RETURN","return",294],["T_WHITESPACE"," ",294],["T_STRING","true",294],";",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE","\n\n        ",295],["T_RETURN","return",297],["T_WHITESPACE"," ",297],["T_STRING","false",297],";",["T_WHITESPACE","\n    ",297],"}",["T_WHITESPACE","\n\n    ",298],["T_DOC_COMMENT","\/**\n     * Merge segments if necessary\n     *\/",300],["T_WHITESPACE","\n    ",302],["T_PRIVATE","private",303],["T_WHITESPACE"," ",303],["T_FUNCTION","function",303],["T_WHITESPACE"," ",303],["T_STRING","_maybeMergeSegments",303],"(",")",["T_WHITESPACE","\n    ",303],"{",["T_WHITESPACE","\n        ",304],["T_IF","if",305],["T_WHITESPACE"," ",305],"(",["T_STRING","Zend_Search_Lucene_LockManager",305],["T_DOUBLE_COLON","::",305],["T_STRING","obtainOptimizationLock",305],"(",["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","_directory",305],")",["T_WHITESPACE"," ",305],["T_IS_IDENTICAL","===",305],["T_WHITESPACE"," ",305],["T_STRING","false",305],")",["T_WHITESPACE"," ",305],"{",["T_WHITESPACE","\n            ",305],["T_RETURN","return",306],";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n\n        ",307],["T_IF","if",309],["T_WHITESPACE"," ",309],"(","!",["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","_hasAnythingToMerge",309],"(",")",")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n            ",309],["T_STRING","Zend_Search_Lucene_LockManager",310],["T_DOUBLE_COLON","::",310],["T_STRING","releaseOptimizationLock",310],"(",["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","_directory",310],")",";",["T_WHITESPACE","\n            ",310],["T_RETURN","return",311],";",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n\n        ",312],["T_COMMENT","\/\/ Update segments list to be sure all segments are not merged yet by another process\n",314],["T_WHITESPACE","        ",315],["T_COMMENT","\/\/\n",315],["T_WHITESPACE","        ",316],["T_COMMENT","\/\/ Segment merging functionality is concentrated in this class and surrounded\n",316],["T_WHITESPACE","        ",317],["T_COMMENT","\/\/ by optimization lock obtaining\/releasing.\n",317],["T_WHITESPACE","        ",318],["T_COMMENT","\/\/ _updateSegments() refreshes segments list from the latest index generation.\n",318],["T_WHITESPACE","        ",319],["T_COMMENT","\/\/ So only new segments can be added to the index while we are merging some already existing\n",319],["T_WHITESPACE","        ",320],["T_COMMENT","\/\/ segments.\n",320],["T_WHITESPACE","        ",321],["T_COMMENT","\/\/ Newly added segments will be also included into the index by the _updateSegments() call\n",321],["T_WHITESPACE","        ",322],["T_COMMENT","\/\/ either by another process or by the current process with the commit() call at the end of _mergeSegments() method.\n",322],["T_WHITESPACE","        ",323],["T_COMMENT","\/\/ That's guaranteed by the serialisation of _updateSegments() execution using exclusive locks.\n",323],["T_WHITESPACE","        ",324],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","_updateSegments",324],"(",")",";",["T_WHITESPACE","\n\n        ",324],["T_COMMENT","\/\/ Perform standard auto-optimization procedure\n",326],["T_WHITESPACE","        ",327],["T_VARIABLE","$segmentSizes",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_ARRAY","array",327],"(",")",";",["T_WHITESPACE","\n        ",327],["T_FOREACH","foreach",328],["T_WHITESPACE"," ",328],"(",["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","_segmentInfos",328],["T_WHITESPACE"," ",328],["T_AS","as",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$segName",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_VARIABLE","$segmentInfo",328],")",["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n            ",328],["T_VARIABLE","$segmentSizes",329],"[",["T_VARIABLE","$segName",329],"]",["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_VARIABLE","$segmentInfo",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","count",329],"(",")",";",["T_WHITESPACE","\n        ",329],"}",["T_WHITESPACE","\n\n        ",330],["T_VARIABLE","$mergePool",332],["T_WHITESPACE","   ",332],"=",["T_WHITESPACE"," ",332],["T_ARRAY","array",332],"(",")",";",["T_WHITESPACE","\n        ",332],["T_VARIABLE","$poolSize",333],["T_WHITESPACE","    ",333],"=",["T_WHITESPACE"," ",333],["T_LNUMBER","0",333],";",["T_WHITESPACE","\n        ",333],["T_VARIABLE","$sizeToMerge",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","maxBufferedDocs",334],";",["T_WHITESPACE","\n        ",334],["T_STRING","asort",335],"(",["T_VARIABLE","$segmentSizes",335],",",["T_WHITESPACE"," ",335],["T_STRING","SORT_NUMERIC",335],")",";",["T_WHITESPACE","\n        ",335],["T_FOREACH","foreach",336],["T_WHITESPACE"," ",336],"(",["T_VARIABLE","$segmentSizes",336],["T_WHITESPACE"," ",336],["T_AS","as",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$segName",336],["T_WHITESPACE"," ",336],["T_DOUBLE_ARROW","=>",336],["T_WHITESPACE"," ",336],["T_VARIABLE","$size",336],")",["T_WHITESPACE"," ",336],"{",["T_WHITESPACE","\n            ",336],["T_COMMENT","\/\/ Check, if segment comes into a new merging block\n",337],["T_WHITESPACE","            ",338],["T_WHILE","while",338],["T_WHITESPACE"," ",338],"(",["T_VARIABLE","$size",338],["T_WHITESPACE"," ",338],["T_IS_GREATER_OR_EQUAL",">=",338],["T_WHITESPACE"," ",338],["T_VARIABLE","$sizeToMerge",338],")",["T_WHITESPACE"," ",338],"{",["T_WHITESPACE","\n                ",338],["T_COMMENT","\/\/ Merge previous block if it's large enough\n",339],["T_WHITESPACE","                ",340],["T_IF","if",340],["T_WHITESPACE"," ",340],"(",["T_VARIABLE","$poolSize",340],["T_WHITESPACE"," ",340],["T_IS_GREATER_OR_EQUAL",">=",340],["T_WHITESPACE"," ",340],["T_VARIABLE","$sizeToMerge",340],")",["T_WHITESPACE"," ",340],"{",["T_WHITESPACE","\n                    ",340],["T_VARIABLE","$this",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","_mergeSegments",341],"(",["T_VARIABLE","$mergePool",341],")",";",["T_WHITESPACE","\n                ",341],"}",["T_WHITESPACE","\n                ",342],["T_VARIABLE","$mergePool",343],["T_WHITESPACE","   ",343],"=",["T_WHITESPACE"," ",343],["T_ARRAY","array",343],"(",")",";",["T_WHITESPACE","\n                ",343],["T_VARIABLE","$poolSize",344],["T_WHITESPACE","    ",344],"=",["T_WHITESPACE"," ",344],["T_LNUMBER","0",344],";",["T_WHITESPACE","\n\n                ",344],["T_VARIABLE","$sizeToMerge",346],["T_WHITESPACE"," ",346],["T_MUL_EQUAL","*=",346],["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","mergeFactor",346],";",["T_WHITESPACE","\n\n                ",346],["T_IF","if",348],["T_WHITESPACE"," ",348],"(",["T_VARIABLE","$sizeToMerge",348],["T_WHITESPACE"," ",348],">",["T_WHITESPACE"," ",348],["T_VARIABLE","$this",348],["T_OBJECT_OPERATOR","->",348],["T_STRING","maxMergeDocs",348],")",["T_WHITESPACE"," ",348],"{",["T_WHITESPACE","\n                    ",348],["T_STRING","Zend_Search_Lucene_LockManager",349],["T_DOUBLE_COLON","::",349],["T_STRING","releaseOptimizationLock",349],"(",["T_VARIABLE","$this",349],["T_OBJECT_OPERATOR","->",349],["T_STRING","_directory",349],")",";",["T_WHITESPACE","\n                    ",349],["T_RETURN","return",350],";",["T_WHITESPACE","\n                ",350],"}",["T_WHITESPACE","\n            ",351],"}",["T_WHITESPACE","\n\n            ",352],["T_VARIABLE","$mergePool",354],"[","]",["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_VARIABLE","$this",354],["T_OBJECT_OPERATOR","->",354],["T_STRING","_segmentInfos",354],"[",["T_VARIABLE","$segName",354],"]",";",["T_WHITESPACE","\n            ",354],["T_VARIABLE","$poolSize",355],["T_WHITESPACE"," ",355],["T_PLUS_EQUAL","+=",355],["T_WHITESPACE"," ",355],["T_VARIABLE","$size",355],";",["T_WHITESPACE","\n        ",355],"}",["T_WHITESPACE","\n\n        ",356],["T_IF","if",358],["T_WHITESPACE"," ",358],"(",["T_VARIABLE","$poolSize",358],["T_WHITESPACE"," ",358],["T_IS_GREATER_OR_EQUAL",">=",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$sizeToMerge",358],")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n            ",358],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","_mergeSegments",359],"(",["T_VARIABLE","$mergePool",359],")",";",["T_WHITESPACE","\n        ",359],"}",["T_WHITESPACE","\n\n        ",360],["T_STRING","Zend_Search_Lucene_LockManager",362],["T_DOUBLE_COLON","::",362],["T_STRING","releaseOptimizationLock",362],"(",["T_VARIABLE","$this",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","_directory",362],")",";",["T_WHITESPACE","\n    ",362],"}",["T_WHITESPACE","\n\n    ",363],["T_DOC_COMMENT","\/**\n     * Merge specified segments\n     *\n     * $segments is an array of SegmentInfo objects\n     *\n     * @param array $segments\n     *\/",365],["T_WHITESPACE","\n    ",371],["T_PRIVATE","private",372],["T_WHITESPACE"," ",372],["T_FUNCTION","function",372],["T_WHITESPACE"," ",372],["T_STRING","_mergeSegments",372],"(",["T_VARIABLE","$segments",372],")",["T_WHITESPACE","\n    ",372],"{",["T_WHITESPACE","\n        ",373],["T_VARIABLE","$newName",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_VARIABLE","$this",374],["T_OBJECT_OPERATOR","->",374],["T_STRING","_newSegmentName",374],"(",")",";",["T_WHITESPACE","\n\n        ",374],["T_DOC_COMMENT","\/** Zend_Search_Lucene_Index_SegmentMerger *\/",376],["T_WHITESPACE","\n        ",376],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Index\/SegmentMerger.php';\n",377],["T_WHITESPACE","        ",378],["T_VARIABLE","$merger",378],["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_NEW","new",378],["T_WHITESPACE"," ",378],["T_STRING","Zend_Search_Lucene_Index_SegmentMerger",378],"(",["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","_directory",378],",",["T_WHITESPACE","\n                                                             ",378],["T_VARIABLE","$newName",379],")",";",["T_WHITESPACE","\n        ",379],["T_FOREACH","foreach",380],["T_WHITESPACE"," ",380],"(",["T_VARIABLE","$segments",380],["T_WHITESPACE"," ",380],["T_AS","as",380],["T_WHITESPACE"," ",380],["T_VARIABLE","$segmentInfo",380],")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n            ",380],["T_VARIABLE","$merger",381],["T_OBJECT_OPERATOR","->",381],["T_STRING","addSource",381],"(",["T_VARIABLE","$segmentInfo",381],")",";",["T_WHITESPACE","\n            ",381],["T_VARIABLE","$this",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","_segmentsToDelete",382],"[",["T_VARIABLE","$segmentInfo",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getName",382],"(",")","]",["T_WHITESPACE"," ",382],"=",["T_WHITESPACE"," ",382],["T_VARIABLE","$segmentInfo",382],["T_OBJECT_OPERATOR","->",382],["T_STRING","getName",382],"(",")",";",["T_WHITESPACE","\n        ",382],"}",["T_WHITESPACE","\n\n        ",383],["T_VARIABLE","$newSegment",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],["T_VARIABLE","$merger",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","merge",385],"(",")",";",["T_WHITESPACE","\n        ",385],["T_IF","if",386],["T_WHITESPACE"," ",386],"(",["T_VARIABLE","$newSegment",386],["T_WHITESPACE"," ",386],["T_IS_NOT_IDENTICAL","!==",386],["T_WHITESPACE"," ",386],["T_STRING","null",386],")",["T_WHITESPACE"," ",386],"{",["T_WHITESPACE","\n            ",386],["T_VARIABLE","$this",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","_newSegments",387],"[",["T_VARIABLE","$newSegment",387],["T_OBJECT_OPERATOR","->",387],["T_STRING","getName",387],"(",")","]",["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],["T_VARIABLE","$newSegment",387],";",["T_WHITESPACE","\n        ",387],"}",["T_WHITESPACE","\n\n        ",388],["T_VARIABLE","$this",390],["T_OBJECT_OPERATOR","->",390],["T_STRING","commit",390],"(",")",";",["T_WHITESPACE","\n    ",390],"}",["T_WHITESPACE","\n\n    ",391],["T_DOC_COMMENT","\/**\n     * Update segments file by adding current segment to a list\n     *\n     * @throws Zend_Search_Lucene_Exception\n     *\/",393],["T_WHITESPACE","\n    ",397],["T_PRIVATE","private",398],["T_WHITESPACE"," ",398],["T_FUNCTION","function",398],["T_WHITESPACE"," ",398],["T_STRING","_updateSegments",398],"(",")",["T_WHITESPACE","\n    ",398],"{",["T_WHITESPACE","\n        ",399],["T_COMMENT","\/\/ Get an exclusive index lock\n",400],["T_WHITESPACE","        ",401],["T_STRING","Zend_Search_Lucene_LockManager",401],["T_DOUBLE_COLON","::",401],["T_STRING","obtainWriteLock",401],"(",["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","_directory",401],")",";",["T_WHITESPACE","\n\n        ",401],["T_COMMENT","\/\/ Write down changes for the segments\n",403],["T_WHITESPACE","        ",404],["T_FOREACH","foreach",404],["T_WHITESPACE"," ",404],"(",["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","_segmentInfos",404],["T_WHITESPACE"," ",404],["T_AS","as",404],["T_WHITESPACE"," ",404],["T_VARIABLE","$segInfo",404],")",["T_WHITESPACE"," ",404],"{",["T_WHITESPACE","\n            ",404],["T_VARIABLE","$segInfo",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","writeChanges",405],"(",")",";",["T_WHITESPACE","\n        ",405],"}",["T_WHITESPACE","\n\n\n        ",406],["T_VARIABLE","$generation",409],["T_WHITESPACE"," ",409],"=",["T_WHITESPACE"," ",409],["T_STRING","Zend_Search_Lucene",409],["T_DOUBLE_COLON","::",409],["T_STRING","getActualGeneration",409],"(",["T_VARIABLE","$this",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","_directory",409],")",";",["T_WHITESPACE","\n        ",409],["T_VARIABLE","$segmentsFile",410],["T_WHITESPACE","   ",410],"=",["T_WHITESPACE"," ",410],["T_VARIABLE","$this",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","_directory",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","getFileObject",410],"(",["T_STRING","Zend_Search_Lucene",410],["T_DOUBLE_COLON","::",410],["T_STRING","getSegmentFileName",410],"(",["T_VARIABLE","$generation",410],")",",",["T_WHITESPACE"," ",410],["T_STRING","false",410],")",";",["T_WHITESPACE","\n        ",410],["T_VARIABLE","$newSegmentFile",411],["T_WHITESPACE"," ",411],"=",["T_WHITESPACE"," ",411],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","_directory",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","createFile",411],"(",["T_STRING","Zend_Search_Lucene",411],["T_DOUBLE_COLON","::",411],["T_STRING","getSegmentFileName",411],"(",["T_INC","++",411],["T_VARIABLE","$generation",411],")",",",["T_WHITESPACE"," ",411],["T_STRING","false",411],")",";",["T_WHITESPACE","\n\n        ",411],["T_TRY","try",413],["T_WHITESPACE"," ",413],"{",["T_WHITESPACE","\n            ",413],["T_VARIABLE","$genFile",414],["T_WHITESPACE"," ",414],"=",["T_WHITESPACE"," ",414],["T_VARIABLE","$this",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","_directory",414],["T_OBJECT_OPERATOR","->",414],["T_STRING","getFileObject",414],"(",["T_CONSTANT_ENCAPSED_STRING","'segments.gen'",414],",",["T_WHITESPACE"," ",414],["T_STRING","false",414],")",";",["T_WHITESPACE","\n        ",414],"}",["T_WHITESPACE"," ",415],["T_CATCH","catch",415],["T_WHITESPACE"," ",415],"(",["T_STRING","Zend_Search_Lucene_Exception",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$e",415],")",["T_WHITESPACE"," ",415],"{",["T_WHITESPACE","\n            ",415],["T_IF","if",416],["T_WHITESPACE"," ",416],"(",["T_STRING","strpos",416],"(",["T_VARIABLE","$e",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","getMessage",416],"(",")",",",["T_WHITESPACE"," ",416],["T_CONSTANT_ENCAPSED_STRING","'is not readable'",416],")",["T_WHITESPACE"," ",416],["T_IS_NOT_IDENTICAL","!==",416],["T_WHITESPACE"," ",416],["T_STRING","false",416],")",["T_WHITESPACE"," ",416],"{",["T_WHITESPACE","\n                ",416],["T_VARIABLE","$genFile",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","_directory",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","createFile",417],"(",["T_CONSTANT_ENCAPSED_STRING","'segments.gen'",417],")",";",["T_WHITESPACE","\n            ",417],"}",["T_WHITESPACE"," ",418],["T_ELSE","else",418],["T_WHITESPACE"," ",418],"{",["T_WHITESPACE","\n                ",418],["T_THROW","throw",419],["T_WHITESPACE"," ",419],["T_NEW","new",419],["T_WHITESPACE"," ",419],["T_STRING","Zend_Search_Lucene_Exception",419],"(",["T_VARIABLE","$e",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getMessage",419],"(",")",",",["T_WHITESPACE"," ",419],["T_VARIABLE","$e",419],["T_OBJECT_OPERATOR","->",419],["T_STRING","getCode",419],"(",")",",",["T_WHITESPACE"," ",419],["T_VARIABLE","$e",419],")",";",["T_WHITESPACE","\n            ",419],"}",["T_WHITESPACE","\n        ",420],"}",["T_WHITESPACE","\n\n        ",421],["T_VARIABLE","$genFile",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","writeInt",423],"(",["T_INT_CAST","(int)",423],["T_LNUMBER","0xFFFFFFFE",423],")",";",["T_WHITESPACE","\n        ",423],["T_COMMENT","\/\/ Write generation (first copy)\n",424],["T_WHITESPACE","        ",425],["T_VARIABLE","$genFile",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","writeLong",425],"(",["T_VARIABLE","$generation",425],")",";",["T_WHITESPACE","\n\n        ",425],["T_TRY","try",427],["T_WHITESPACE"," ",427],"{",["T_WHITESPACE","\n            ",427],["T_COMMENT","\/\/ Write format marker\n",428],["T_WHITESPACE","            ",429],["T_IF","if",429],["T_WHITESPACE"," ",429],"(",["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","_targetFormatVersion",429],["T_WHITESPACE"," ",429],["T_IS_EQUAL","==",429],["T_WHITESPACE"," ",429],["T_STRING","Zend_Search_Lucene",429],["T_DOUBLE_COLON","::",429],["T_STRING","FORMAT_2_1",429],")",["T_WHITESPACE"," ",429],"{",["T_WHITESPACE","\n                ",429],["T_VARIABLE","$newSegmentFile",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","writeInt",430],"(",["T_INT_CAST","(int)",430],["T_LNUMBER","0xFFFFFFFD",430],")",";",["T_WHITESPACE","\n            ",430],"}",["T_WHITESPACE"," ",431],["T_ELSE","else",431],["T_WHITESPACE"," ",431],["T_IF","if",431],["T_WHITESPACE"," ",431],"(",["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","_targetFormatVersion",431],["T_WHITESPACE"," ",431],["T_IS_EQUAL","==",431],["T_WHITESPACE"," ",431],["T_STRING","Zend_Search_Lucene",431],["T_DOUBLE_COLON","::",431],["T_STRING","FORMAT_2_3",431],")",["T_WHITESPACE"," ",431],"{",["T_WHITESPACE","\n                ",431],["T_VARIABLE","$newSegmentFile",432],["T_OBJECT_OPERATOR","->",432],["T_STRING","writeInt",432],"(",["T_INT_CAST","(int)",432],["T_LNUMBER","0xFFFFFFFC",432],")",";",["T_WHITESPACE","\n            ",432],"}",["T_WHITESPACE","\n\n            ",433],["T_COMMENT","\/\/ Read src file format identifier\n",435],["T_WHITESPACE","            ",436],["T_VARIABLE","$format",436],["T_WHITESPACE"," ",436],"=",["T_WHITESPACE"," ",436],["T_VARIABLE","$segmentsFile",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","readInt",436],"(",")",";",["T_WHITESPACE","\n            ",436],["T_IF","if",437],["T_WHITESPACE"," ",437],"(",["T_VARIABLE","$format",437],["T_WHITESPACE"," ",437],["T_IS_EQUAL","==",437],["T_WHITESPACE"," ",437],["T_INT_CAST","(int)",437],["T_LNUMBER","0xFFFFFFFF",437],")",["T_WHITESPACE"," ",437],"{",["T_WHITESPACE","\n                ",437],["T_VARIABLE","$srcFormat",438],["T_WHITESPACE"," ",438],"=",["T_WHITESPACE"," ",438],["T_STRING","Zend_Search_Lucene",438],["T_DOUBLE_COLON","::",438],["T_STRING","FORMAT_PRE_2_1",438],";",["T_WHITESPACE","\n            ",438],"}",["T_WHITESPACE"," ",439],["T_ELSE","else",439],["T_WHITESPACE"," ",439],["T_IF","if",439],["T_WHITESPACE"," ",439],"(",["T_VARIABLE","$format",439],["T_WHITESPACE"," ",439],["T_IS_EQUAL","==",439],["T_WHITESPACE"," ",439],["T_INT_CAST","(int)",439],["T_LNUMBER","0xFFFFFFFD",439],")",["T_WHITESPACE"," ",439],"{",["T_WHITESPACE","\n                ",439],["T_VARIABLE","$srcFormat",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_STRING","Zend_Search_Lucene",440],["T_DOUBLE_COLON","::",440],["T_STRING","FORMAT_2_1",440],";",["T_WHITESPACE","\n            ",440],"}",["T_WHITESPACE"," ",441],["T_ELSE","else",441],["T_WHITESPACE"," ",441],["T_IF","if",441],["T_WHITESPACE"," ",441],"(",["T_VARIABLE","$format",441],["T_WHITESPACE"," ",441],["T_IS_EQUAL","==",441],["T_WHITESPACE"," ",441],["T_INT_CAST","(int)",441],["T_LNUMBER","0xFFFFFFFC",441],")",["T_WHITESPACE"," ",441],"{",["T_WHITESPACE","\n                ",441],["T_VARIABLE","$srcFormat",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_STRING","Zend_Search_Lucene",442],["T_DOUBLE_COLON","::",442],["T_STRING","FORMAT_2_3",442],";",["T_WHITESPACE","\n            ",442],"}",["T_WHITESPACE"," ",443],["T_ELSE","else",443],["T_WHITESPACE"," ",443],"{",["T_WHITESPACE","\n                ",443],["T_THROW","throw",444],["T_WHITESPACE"," ",444],["T_NEW","new",444],["T_WHITESPACE"," ",444],["T_STRING","Zend_Search_Lucene_Exception",444],"(",["T_CONSTANT_ENCAPSED_STRING","'Unsupported segments file format'",444],")",";",["T_WHITESPACE","\n            ",444],"}",["T_WHITESPACE","\n\n            ",445],["T_VARIABLE","$version",447],["T_WHITESPACE"," ",447],"=",["T_WHITESPACE"," ",447],["T_VARIABLE","$segmentsFile",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","readLong",447],"(",")",["T_WHITESPACE"," ",447],"+",["T_WHITESPACE"," ",447],["T_VARIABLE","$this",447],["T_OBJECT_OPERATOR","->",447],["T_STRING","_versionUpdate",447],";",["T_WHITESPACE","\n            ",447],["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","_versionUpdate",448],["T_WHITESPACE"," ",448],"=",["T_WHITESPACE"," ",448],["T_LNUMBER","0",448],";",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$newSegmentFile",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","writeLong",449],"(",["T_VARIABLE","$version",449],")",";",["T_WHITESPACE","\n\n            ",449],["T_COMMENT","\/\/ Write segment name counter\n",451],["T_WHITESPACE","            ",452],["T_VARIABLE","$newSegmentFile",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","writeInt",452],"(",["T_VARIABLE","$segmentsFile",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","readInt",452],"(",")",")",";",["T_WHITESPACE","\n\n            ",452],["T_COMMENT","\/\/ Get number of segments offset\n",454],["T_WHITESPACE","            ",455],["T_VARIABLE","$numOfSegmentsOffset",455],["T_WHITESPACE"," ",455],"=",["T_WHITESPACE"," ",455],["T_VARIABLE","$newSegmentFile",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","tell",455],"(",")",";",["T_WHITESPACE","\n            ",455],["T_COMMENT","\/\/ Write dummy data (segment counter)\n",456],["T_WHITESPACE","            ",457],["T_VARIABLE","$newSegmentFile",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","writeInt",457],"(",["T_LNUMBER","0",457],")",";",["T_WHITESPACE","\n\n            ",457],["T_COMMENT","\/\/ Read number of segemnts\n",459],["T_WHITESPACE","            ",460],["T_VARIABLE","$segmentsCount",460],["T_WHITESPACE"," ",460],"=",["T_WHITESPACE"," ",460],["T_VARIABLE","$segmentsFile",460],["T_OBJECT_OPERATOR","->",460],["T_STRING","readInt",460],"(",")",";",["T_WHITESPACE","\n\n            ",460],["T_VARIABLE","$segments",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_ARRAY","array",462],"(",")",";",["T_WHITESPACE","\n            ",462],["T_FOR","for",463],["T_WHITESPACE"," ",463],"(",["T_VARIABLE","$count",463],["T_WHITESPACE"," ",463],"=",["T_WHITESPACE"," ",463],["T_LNUMBER","0",463],";",["T_WHITESPACE"," ",463],["T_VARIABLE","$count",463],["T_WHITESPACE"," ",463],"<",["T_WHITESPACE"," ",463],["T_VARIABLE","$segmentsCount",463],";",["T_WHITESPACE"," ",463],["T_VARIABLE","$count",463],["T_INC","++",463],")",["T_WHITESPACE"," ",463],"{",["T_WHITESPACE","\n                ",463],["T_VARIABLE","$segName",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$segmentsFile",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","readString",464],"(",")",";",["T_WHITESPACE","\n                ",464],["T_VARIABLE","$segSize",465],["T_WHITESPACE"," ",465],"=",["T_WHITESPACE"," ",465],["T_VARIABLE","$segmentsFile",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","readInt",465],"(",")",";",["T_WHITESPACE","\n\n                ",465],["T_IF","if",467],["T_WHITESPACE"," ",467],"(",["T_VARIABLE","$srcFormat",467],["T_WHITESPACE"," ",467],["T_IS_EQUAL","==",467],["T_WHITESPACE"," ",467],["T_STRING","Zend_Search_Lucene",467],["T_DOUBLE_COLON","::",467],["T_STRING","FORMAT_PRE_2_1",467],")",["T_WHITESPACE"," ",467],"{",["T_WHITESPACE","\n                    ",467],["T_COMMENT","\/\/ pre-2.1 index format\n",468],["T_WHITESPACE","                    ",469],["T_VARIABLE","$delGen",469],["T_WHITESPACE","            ",469],"=",["T_WHITESPACE"," ",469],["T_LNUMBER","0",469],";",["T_WHITESPACE","\n                    ",469],["T_VARIABLE","$hasSingleNormFile",470],["T_WHITESPACE"," ",470],"=",["T_WHITESPACE"," ",470],["T_STRING","false",470],";",["T_WHITESPACE","\n                    ",470],["T_VARIABLE","$numField",471],["T_WHITESPACE","          ",471],"=",["T_WHITESPACE"," ",471],["T_INT_CAST","(int)",471],["T_LNUMBER","0xFFFFFFFF",471],";",["T_WHITESPACE","\n                    ",471],["T_VARIABLE","$isCompoundByte",472],["T_WHITESPACE","    ",472],"=",["T_WHITESPACE"," ",472],["T_LNUMBER","0",472],";",["T_WHITESPACE","\n                    ",472],["T_VARIABLE","$docStoreOptions",473],["T_WHITESPACE","   ",473],"=",["T_WHITESPACE"," ",473],["T_STRING","null",473],";",["T_WHITESPACE","\n                ",473],"}",["T_WHITESPACE"," ",474],["T_ELSE","else",474],["T_WHITESPACE"," ",474],"{",["T_WHITESPACE","\n                    ",474],["T_VARIABLE","$delGen",475],["T_WHITESPACE"," ",475],"=",["T_WHITESPACE"," ",475],["T_VARIABLE","$segmentsFile",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","readLong",475],"(",")",";",["T_WHITESPACE","\n\n                    ",475],["T_IF","if",477],["T_WHITESPACE"," ",477],"(",["T_VARIABLE","$srcFormat",477],["T_WHITESPACE"," ",477],["T_IS_EQUAL","==",477],["T_WHITESPACE"," ",477],["T_STRING","Zend_Search_Lucene",477],["T_DOUBLE_COLON","::",477],["T_STRING","FORMAT_2_3",477],")",["T_WHITESPACE"," ",477],"{",["T_WHITESPACE","\n                        ",477],["T_VARIABLE","$docStoreOffset",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_VARIABLE","$segmentsFile",478],["T_OBJECT_OPERATOR","->",478],["T_STRING","readInt",478],"(",")",";",["T_WHITESPACE","\n\n                        ",478],["T_IF","if",480],["T_WHITESPACE"," ",480],"(",["T_VARIABLE","$docStoreOffset",480],["T_WHITESPACE"," ",480],["T_IS_NOT_EQUAL","!=",480],["T_WHITESPACE"," ",480],["T_INT_CAST","(int)",480],["T_LNUMBER","0xFFFFFFFF",480],")",["T_WHITESPACE"," ",480],"{",["T_WHITESPACE","\n                            ",480],["T_VARIABLE","$docStoreSegment",481],["T_WHITESPACE","        ",481],"=",["T_WHITESPACE"," ",481],["T_VARIABLE","$segmentsFile",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","readString",481],"(",")",";",["T_WHITESPACE","\n                            ",481],["T_VARIABLE","$docStoreIsCompoundFile",482],["T_WHITESPACE"," ",482],"=",["T_WHITESPACE"," ",482],["T_VARIABLE","$segmentsFile",482],["T_OBJECT_OPERATOR","->",482],["T_STRING","readByte",482],"(",")",";",["T_WHITESPACE","\n\n                            ",482],["T_VARIABLE","$docStoreOptions",484],["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_ARRAY","array",484],"(",["T_CONSTANT_ENCAPSED_STRING","'offset'",484],["T_WHITESPACE","     ",484],["T_DOUBLE_ARROW","=>",484],["T_WHITESPACE"," ",484],["T_VARIABLE","$docStoreOffset",484],",",["T_WHITESPACE","\n                                                     ",484],["T_CONSTANT_ENCAPSED_STRING","'segment'",485],["T_WHITESPACE","    ",485],["T_DOUBLE_ARROW","=>",485],["T_WHITESPACE"," ",485],["T_VARIABLE","$docStoreSegment",485],",",["T_WHITESPACE","\n                                                     ",485],["T_CONSTANT_ENCAPSED_STRING","'isCompound'",486],["T_WHITESPACE"," ",486],["T_DOUBLE_ARROW","=>",486],["T_WHITESPACE"," ",486],"(",["T_VARIABLE","$docStoreIsCompoundFile",486],["T_WHITESPACE"," ",486],["T_IS_EQUAL","==",486],["T_WHITESPACE"," ",486],["T_LNUMBER","1",486],")",")",";",["T_WHITESPACE","\n                        ",486],"}",["T_WHITESPACE"," ",487],["T_ELSE","else",487],["T_WHITESPACE"," ",487],"{",["T_WHITESPACE","\n                            ",487],["T_VARIABLE","$docStoreOptions",488],["T_WHITESPACE"," ",488],"=",["T_WHITESPACE"," ",488],["T_STRING","null",488],";",["T_WHITESPACE","\n                        ",488],"}",["T_WHITESPACE","\n                    ",489],"}",["T_WHITESPACE"," ",490],["T_ELSE","else",490],["T_WHITESPACE"," ",490],"{",["T_WHITESPACE","\n                        ",490],["T_VARIABLE","$docStoreOptions",491],["T_WHITESPACE"," ",491],"=",["T_WHITESPACE"," ",491],["T_STRING","null",491],";",["T_WHITESPACE","\n                    ",491],"}",["T_WHITESPACE","\n\n                    ",492],["T_VARIABLE","$hasSingleNormFile",494],["T_WHITESPACE"," ",494],"=",["T_WHITESPACE"," ",494],["T_VARIABLE","$segmentsFile",494],["T_OBJECT_OPERATOR","->",494],["T_STRING","readByte",494],"(",")",";",["T_WHITESPACE","\n                    ",494],["T_VARIABLE","$numField",495],["T_WHITESPACE","          ",495],"=",["T_WHITESPACE"," ",495],["T_VARIABLE","$segmentsFile",495],["T_OBJECT_OPERATOR","->",495],["T_STRING","readInt",495],"(",")",";",["T_WHITESPACE","\n\n                    ",495],["T_VARIABLE","$normGens",497],["T_WHITESPACE"," ",497],"=",["T_WHITESPACE"," ",497],["T_ARRAY","array",497],"(",")",";",["T_WHITESPACE","\n                    ",497],["T_IF","if",498],["T_WHITESPACE"," ",498],"(",["T_VARIABLE","$numField",498],["T_WHITESPACE"," ",498],["T_IS_NOT_EQUAL","!=",498],["T_WHITESPACE"," ",498],["T_INT_CAST","(int)",498],["T_LNUMBER","0xFFFFFFFF",498],")",["T_WHITESPACE"," ",498],"{",["T_WHITESPACE","\n                        ",498],["T_FOR","for",499],["T_WHITESPACE"," ",499],"(",["T_VARIABLE","$count1",499],["T_WHITESPACE"," ",499],"=",["T_WHITESPACE"," ",499],["T_LNUMBER","0",499],";",["T_WHITESPACE"," ",499],["T_VARIABLE","$count1",499],["T_WHITESPACE"," ",499],"<",["T_WHITESPACE"," ",499],["T_VARIABLE","$numField",499],";",["T_WHITESPACE"," ",499],["T_VARIABLE","$count1",499],["T_INC","++",499],")",["T_WHITESPACE"," ",499],"{",["T_WHITESPACE","\n                            ",499],["T_VARIABLE","$normGens",500],"[","]",["T_WHITESPACE"," ",500],"=",["T_WHITESPACE"," ",500],["T_VARIABLE","$segmentsFile",500],["T_OBJECT_OPERATOR","->",500],["T_STRING","readLong",500],"(",")",";",["T_WHITESPACE","\n                        ",500],"}",["T_WHITESPACE","\n                    ",501],"}",["T_WHITESPACE","\n                    ",502],["T_VARIABLE","$isCompoundByte",503],["T_WHITESPACE","    ",503],"=",["T_WHITESPACE"," ",503],["T_VARIABLE","$segmentsFile",503],["T_OBJECT_OPERATOR","->",503],["T_STRING","readByte",503],"(",")",";",["T_WHITESPACE","\n                ",503],"}",["T_WHITESPACE","\n\n                ",504],["T_IF","if",506],["T_WHITESPACE"," ",506],"(","!",["T_STRING","in_array",506],"(",["T_VARIABLE","$segName",506],",",["T_WHITESPACE"," ",506],["T_VARIABLE","$this",506],["T_OBJECT_OPERATOR","->",506],["T_STRING","_segmentsToDelete",506],")",")",["T_WHITESPACE"," ",506],"{",["T_WHITESPACE","\n                    ",506],["T_COMMENT","\/\/ Load segment if necessary\n",507],["T_WHITESPACE","                    ",508],["T_IF","if",508],["T_WHITESPACE"," ",508],"(","!",["T_ISSET","isset",508],"(",["T_VARIABLE","$this",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","_segmentInfos",508],"[",["T_VARIABLE","$segName",508],"]",")",")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n                        ",508],["T_IF","if",509],["T_WHITESPACE"," ",509],"(",["T_VARIABLE","$isCompoundByte",509],["T_WHITESPACE"," ",509],["T_IS_EQUAL","==",509],["T_WHITESPACE"," ",509],["T_LNUMBER","0xFF",509],")",["T_WHITESPACE"," ",509],"{",["T_WHITESPACE","\n                            ",509],["T_COMMENT","\/\/ The segment is not a compound file\n",510],["T_WHITESPACE","                            ",511],["T_VARIABLE","$isCompound",511],["T_WHITESPACE"," ",511],"=",["T_WHITESPACE"," ",511],["T_STRING","false",511],";",["T_WHITESPACE","\n                        ",511],"}",["T_WHITESPACE"," ",512],["T_ELSE","else",512],["T_WHITESPACE"," ",512],["T_IF","if",512],["T_WHITESPACE"," ",512],"(",["T_VARIABLE","$isCompoundByte",512],["T_WHITESPACE"," ",512],["T_IS_EQUAL","==",512],["T_WHITESPACE"," ",512],["T_LNUMBER","0x00",512],")",["T_WHITESPACE"," ",512],"{",["T_WHITESPACE","\n                            ",512],["T_COMMENT","\/\/ The status is unknown\n",513],["T_WHITESPACE","                            ",514],["T_VARIABLE","$isCompound",514],["T_WHITESPACE"," ",514],"=",["T_WHITESPACE"," ",514],["T_STRING","null",514],";",["T_WHITESPACE","\n                        ",514],"}",["T_WHITESPACE"," ",515],["T_ELSE","else",515],["T_WHITESPACE"," ",515],["T_IF","if",515],["T_WHITESPACE"," ",515],"(",["T_VARIABLE","$isCompoundByte",515],["T_WHITESPACE"," ",515],["T_IS_EQUAL","==",515],["T_WHITESPACE"," ",515],["T_LNUMBER","0x01",515],")",["T_WHITESPACE"," ",515],"{",["T_WHITESPACE","\n                            ",515],["T_COMMENT","\/\/ The segment is a compound file\n",516],["T_WHITESPACE","                            ",517],["T_VARIABLE","$isCompound",517],["T_WHITESPACE"," ",517],"=",["T_WHITESPACE"," ",517],["T_STRING","true",517],";",["T_WHITESPACE","\n                        ",517],"}",["T_WHITESPACE","\n\n                        ",518],["T_DOC_COMMENT","\/** Zend_Search_Lucene_Index_SegmentInfo *\/",520],["T_WHITESPACE","\n                        ",520],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Index\/SegmentInfo.php';\n",521],["T_WHITESPACE","                        ",522],["T_VARIABLE","$this",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","_segmentInfos",522],"[",["T_VARIABLE","$segName",522],"]",["T_WHITESPACE"," ",522],"=",["T_WHITESPACE","\n                                    ",522],["T_NEW","new",523],["T_WHITESPACE"," ",523],["T_STRING","Zend_Search_Lucene_Index_SegmentInfo",523],"(",["T_VARIABLE","$this",523],["T_OBJECT_OPERATOR","->",523],["T_STRING","_directory",523],",",["T_WHITESPACE","\n                                                                             ",523],["T_VARIABLE","$segName",524],",",["T_WHITESPACE","\n                                                                             ",524],["T_VARIABLE","$segSize",525],",",["T_WHITESPACE","\n                                                                             ",525],["T_VARIABLE","$delGen",526],",",["T_WHITESPACE","\n                                                                             ",526],["T_VARIABLE","$docStoreOptions",527],",",["T_WHITESPACE","\n                                                                             ",527],["T_VARIABLE","$hasSingleNormFile",528],",",["T_WHITESPACE","\n                                                                             ",528],["T_VARIABLE","$isCompound",529],")",";",["T_WHITESPACE","\n                    ",529],"}",["T_WHITESPACE"," ",530],["T_ELSE","else",530],["T_WHITESPACE"," ",530],"{",["T_WHITESPACE","\n                        ",530],["T_COMMENT","\/\/ Retrieve actual deletions file generation number\n",531],["T_WHITESPACE","                        ",532],["T_VARIABLE","$delGen",532],["T_WHITESPACE"," ",532],"=",["T_WHITESPACE"," ",532],["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","_segmentInfos",532],"[",["T_VARIABLE","$segName",532],"]",["T_OBJECT_OPERATOR","->",532],["T_STRING","getDelGen",532],"(",")",";",["T_WHITESPACE","\n                    ",532],"}",["T_WHITESPACE","\n\n                    ",533],["T_VARIABLE","$newSegmentFile",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","writeString",535],"(",["T_VARIABLE","$segName",535],")",";",["T_WHITESPACE","\n                    ",535],["T_VARIABLE","$newSegmentFile",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","writeInt",536],"(",["T_VARIABLE","$segSize",536],")",";",["T_WHITESPACE","\n                    ",536],["T_VARIABLE","$newSegmentFile",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","writeLong",537],"(",["T_VARIABLE","$delGen",537],")",";",["T_WHITESPACE","\n                    ",537],["T_IF","if",538],["T_WHITESPACE"," ",538],"(",["T_VARIABLE","$this",538],["T_OBJECT_OPERATOR","->",538],["T_STRING","_targetFormatVersion",538],["T_WHITESPACE"," ",538],["T_IS_EQUAL","==",538],["T_WHITESPACE"," ",538],["T_STRING","Zend_Search_Lucene",538],["T_DOUBLE_COLON","::",538],["T_STRING","FORMAT_2_3",538],")",["T_WHITESPACE"," ",538],"{",["T_WHITESPACE","\n                        ",538],["T_IF","if",539],["T_WHITESPACE"," ",539],"(",["T_VARIABLE","$docStoreOptions",539],["T_WHITESPACE"," ",539],["T_IS_NOT_IDENTICAL","!==",539],["T_WHITESPACE"," ",539],["T_STRING","null",539],")",["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n                            ",539],["T_VARIABLE","$newSegmentFile",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","writeInt",540],"(",["T_VARIABLE","$docStoreOffset",540],")",";",["T_WHITESPACE","\n                            ",540],["T_VARIABLE","$newSegmentFile",541],["T_OBJECT_OPERATOR","->",541],["T_STRING","writeString",541],"(",["T_VARIABLE","$docStoreSegment",541],")",";",["T_WHITESPACE","\n                            ",541],["T_VARIABLE","$newSegmentFile",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","writeByte",542],"(",["T_VARIABLE","$docStoreIsCompoundFile",542],")",";",["T_WHITESPACE","\n                        ",542],"}",["T_WHITESPACE"," ",543],["T_ELSE","else",543],["T_WHITESPACE"," ",543],"{",["T_WHITESPACE","\n                            ",543],["T_COMMENT","\/\/ Set DocStoreOffset to -1\n",544],["T_WHITESPACE","                            ",545],["T_VARIABLE","$newSegmentFile",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","writeInt",545],"(",["T_INT_CAST","(int)",545],["T_LNUMBER","0xFFFFFFFF",545],")",";",["T_WHITESPACE","\n                        ",545],"}",["T_WHITESPACE","\n                    ",546],"}",["T_WHITESPACE"," ",547],["T_ELSE","else",547],["T_WHITESPACE"," ",547],["T_IF","if",547],["T_WHITESPACE"," ",547],"(",["T_VARIABLE","$docStoreOptions",547],["T_WHITESPACE"," ",547],["T_IS_NOT_IDENTICAL","!==",547],["T_WHITESPACE"," ",547],["T_STRING","null",547],")",["T_WHITESPACE"," ",547],"{",["T_WHITESPACE","\n                        ",547],["T_COMMENT","\/\/ Release index write lock\n",548],["T_WHITESPACE","                        ",549],["T_STRING","Zend_Search_Lucene_LockManager",549],["T_DOUBLE_COLON","::",549],["T_STRING","releaseWriteLock",549],"(",["T_VARIABLE","$this",549],["T_OBJECT_OPERATOR","->",549],["T_STRING","_directory",549],")",";",["T_WHITESPACE","\n\n                        ",549],["T_THROW","throw",551],["T_WHITESPACE"," ",551],["T_NEW","new",551],["T_WHITESPACE"," ",551],["T_STRING","Zend_Search_Lucene_Exception",551],"(",["T_CONSTANT_ENCAPSED_STRING","'Index conversion to lower format version is not supported.'",551],")",";",["T_WHITESPACE","\n                    ",551],"}",["T_WHITESPACE","\n\n                    ",552],["T_VARIABLE","$newSegmentFile",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","writeByte",554],"(",["T_VARIABLE","$hasSingleNormFile",554],")",";",["T_WHITESPACE","\n                    ",554],["T_VARIABLE","$newSegmentFile",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","writeInt",555],"(",["T_VARIABLE","$numField",555],")",";",["T_WHITESPACE","\n                    ",555],["T_IF","if",556],["T_WHITESPACE"," ",556],"(",["T_VARIABLE","$numField",556],["T_WHITESPACE"," ",556],["T_IS_NOT_EQUAL","!=",556],["T_WHITESPACE"," ",556],["T_INT_CAST","(int)",556],["T_LNUMBER","0xFFFFFFFF",556],")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n                        ",556],["T_FOREACH","foreach",557],["T_WHITESPACE"," ",557],"(",["T_VARIABLE","$normGens",557],["T_WHITESPACE"," ",557],["T_AS","as",557],["T_WHITESPACE"," ",557],["T_VARIABLE","$normGen",557],")",["T_WHITESPACE"," ",557],"{",["T_WHITESPACE","\n                            ",557],["T_VARIABLE","$newSegmentFile",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","writeLong",558],"(",["T_VARIABLE","$normGen",558],")",";",["T_WHITESPACE","\n                        ",558],"}",["T_WHITESPACE","\n                    ",559],"}",["T_WHITESPACE","\n                    ",560],["T_VARIABLE","$newSegmentFile",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","writeByte",561],"(",["T_VARIABLE","$isCompoundByte",561],")",";",["T_WHITESPACE","\n\n                    ",561],["T_VARIABLE","$segments",563],"[",["T_VARIABLE","$segName",563],"]",["T_WHITESPACE"," ",563],"=",["T_WHITESPACE"," ",563],["T_VARIABLE","$segSize",563],";",["T_WHITESPACE","\n                ",563],"}",["T_WHITESPACE","\n            ",564],"}",["T_WHITESPACE","\n            ",565],["T_VARIABLE","$segmentsFile",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","close",566],"(",")",";",["T_WHITESPACE","\n\n            ",566],["T_VARIABLE","$segmentsCount",568],["T_WHITESPACE"," ",568],"=",["T_WHITESPACE"," ",568],["T_STRING","count",568],"(",["T_VARIABLE","$segments",568],")",["T_WHITESPACE"," ",568],"+",["T_WHITESPACE"," ",568],["T_STRING","count",568],"(",["T_VARIABLE","$this",568],["T_OBJECT_OPERATOR","->",568],["T_STRING","_newSegments",568],")",";",["T_WHITESPACE","\n\n            ",568],["T_FOREACH","foreach",570],["T_WHITESPACE"," ",570],"(",["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","_newSegments",570],["T_WHITESPACE"," ",570],["T_AS","as",570],["T_WHITESPACE"," ",570],["T_VARIABLE","$segName",570],["T_WHITESPACE"," ",570],["T_DOUBLE_ARROW","=>",570],["T_WHITESPACE"," ",570],["T_VARIABLE","$segmentInfo",570],")",["T_WHITESPACE"," ",570],"{",["T_WHITESPACE","\n                ",570],["T_VARIABLE","$newSegmentFile",571],["T_OBJECT_OPERATOR","->",571],["T_STRING","writeString",571],"(",["T_VARIABLE","$segName",571],")",";",["T_WHITESPACE","\n                ",571],["T_VARIABLE","$newSegmentFile",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","writeInt",572],"(",["T_VARIABLE","$segmentInfo",572],["T_OBJECT_OPERATOR","->",572],["T_STRING","count",572],"(",")",")",";",["T_WHITESPACE","\n\n                ",572],["T_COMMENT","\/\/ delete file generation: -1 (there is no delete file yet)\n",574],["T_WHITESPACE","                ",575],["T_VARIABLE","$newSegmentFile",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","writeInt",575],"(",["T_INT_CAST","(int)",575],["T_LNUMBER","0xFFFFFFFF",575],")",";",["T_VARIABLE","$newSegmentFile",575],["T_OBJECT_OPERATOR","->",575],["T_STRING","writeInt",575],"(",["T_INT_CAST","(int)",575],["T_LNUMBER","0xFFFFFFFF",575],")",";",["T_WHITESPACE","\n                ",575],["T_IF","if",576],["T_WHITESPACE"," ",576],"(",["T_VARIABLE","$this",576],["T_OBJECT_OPERATOR","->",576],["T_STRING","_targetFormatVersion",576],["T_WHITESPACE"," ",576],["T_IS_EQUAL","==",576],["T_WHITESPACE"," ",576],["T_STRING","Zend_Search_Lucene",576],["T_DOUBLE_COLON","::",576],["T_STRING","FORMAT_2_3",576],")",["T_WHITESPACE"," ",576],"{",["T_WHITESPACE","\n                    ",576],["T_COMMENT","\/\/ docStoreOffset: -1 (segment doesn't use shared doc store)\n",577],["T_WHITESPACE","                    ",578],["T_VARIABLE","$newSegmentFile",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","writeInt",578],"(",["T_INT_CAST","(int)",578],["T_LNUMBER","0xFFFFFFFF",578],")",";",["T_WHITESPACE","\n                ",578],"}",["T_WHITESPACE","\n                ",579],["T_COMMENT","\/\/ HasSingleNormFile\n",580],["T_WHITESPACE","                ",581],["T_VARIABLE","$newSegmentFile",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","writeByte",581],"(",["T_VARIABLE","$segmentInfo",581],["T_OBJECT_OPERATOR","->",581],["T_STRING","hasSingleNormFile",581],"(",")",")",";",["T_WHITESPACE","\n                ",581],["T_COMMENT","\/\/ NumField\n",582],["T_WHITESPACE","                ",583],["T_VARIABLE","$newSegmentFile",583],["T_OBJECT_OPERATOR","->",583],["T_STRING","writeInt",583],"(",["T_INT_CAST","(int)",583],["T_LNUMBER","0xFFFFFFFF",583],")",";",["T_WHITESPACE","\n                ",583],["T_COMMENT","\/\/ IsCompoundFile\n",584],["T_WHITESPACE","                ",585],["T_VARIABLE","$newSegmentFile",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","writeByte",585],"(",["T_VARIABLE","$segmentInfo",585],["T_OBJECT_OPERATOR","->",585],["T_STRING","isCompound",585],"(",")",["T_WHITESPACE"," ",585],"?",["T_WHITESPACE"," ",585],["T_LNUMBER","1",585],["T_WHITESPACE"," ",585],":",["T_WHITESPACE"," ",585],"-",["T_LNUMBER","1",585],")",";",["T_WHITESPACE","\n\n                ",585],["T_VARIABLE","$segments",587],"[",["T_VARIABLE","$segmentInfo",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","getName",587],"(",")","]",["T_WHITESPACE"," ",587],"=",["T_WHITESPACE"," ",587],["T_VARIABLE","$segmentInfo",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","count",587],"(",")",";",["T_WHITESPACE","\n                ",587],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","_segmentInfos",588],"[",["T_VARIABLE","$segName",588],"]",["T_WHITESPACE"," ",588],"=",["T_WHITESPACE"," ",588],["T_VARIABLE","$segmentInfo",588],";",["T_WHITESPACE","\n            ",588],"}",["T_WHITESPACE","\n            ",589],["T_VARIABLE","$this",590],["T_OBJECT_OPERATOR","->",590],["T_STRING","_newSegments",590],["T_WHITESPACE"," ",590],"=",["T_WHITESPACE"," ",590],["T_ARRAY","array",590],"(",")",";",["T_WHITESPACE","\n\n            ",590],["T_VARIABLE","$newSegmentFile",592],["T_OBJECT_OPERATOR","->",592],["T_STRING","seek",592],"(",["T_VARIABLE","$numOfSegmentsOffset",592],")",";",["T_WHITESPACE","\n            ",592],["T_VARIABLE","$newSegmentFile",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","writeInt",593],"(",["T_VARIABLE","$segmentsCount",593],")",";",["T_WHITESPACE","  ",593],["T_COMMENT","\/\/ Update segments count\n",593],["T_WHITESPACE","            ",594],["T_VARIABLE","$newSegmentFile",594],["T_OBJECT_OPERATOR","->",594],["T_STRING","close",594],"(",")",";",["T_WHITESPACE","\n        ",594],"}",["T_WHITESPACE"," ",595],["T_CATCH","catch",595],["T_WHITESPACE"," ",595],"(",["T_STRING","Exception",595],["T_WHITESPACE"," ",595],["T_VARIABLE","$e",595],")",["T_WHITESPACE"," ",595],"{",["T_WHITESPACE","\n            ",595],["T_DOC_COMMENT","\/** Restore previous index generation *\/",596],["T_WHITESPACE","\n            ",596],["T_VARIABLE","$generation",597],["T_DEC","--",597],";",["T_WHITESPACE","\n            ",597],["T_VARIABLE","$genFile",598],["T_OBJECT_OPERATOR","->",598],["T_STRING","seek",598],"(",["T_LNUMBER","4",598],",",["T_WHITESPACE"," ",598],["T_STRING","SEEK_SET",598],")",";",["T_WHITESPACE","\n            ",598],["T_COMMENT","\/\/ Write generation number twice\n",599],["T_WHITESPACE","            ",600],["T_VARIABLE","$genFile",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","writeLong",600],"(",["T_VARIABLE","$generation",600],")",";",["T_WHITESPACE"," ",600],["T_VARIABLE","$genFile",600],["T_OBJECT_OPERATOR","->",600],["T_STRING","writeLong",600],"(",["T_VARIABLE","$generation",600],")",";",["T_WHITESPACE","\n\n            ",600],["T_COMMENT","\/\/ Release index write lock\n",602],["T_WHITESPACE","            ",603],["T_STRING","Zend_Search_Lucene_LockManager",603],["T_DOUBLE_COLON","::",603],["T_STRING","releaseWriteLock",603],"(",["T_VARIABLE","$this",603],["T_OBJECT_OPERATOR","->",603],["T_STRING","_directory",603],")",";",["T_WHITESPACE","\n\n            ",603],["T_COMMENT","\/\/ Throw the exception\n",605],["T_WHITESPACE","            ",606],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Exception.php';\n",606],["T_WHITESPACE","            ",607],["T_THROW","throw",607],["T_WHITESPACE"," ",607],["T_NEW","new",607],["T_WHITESPACE"," ",607],["T_STRING","Zend_Search_Lucene_Exception",607],"(",["T_VARIABLE","$e",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","getMessage",607],"(",")",",",["T_WHITESPACE"," ",607],["T_VARIABLE","$e",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","getCode",607],"(",")",",",["T_WHITESPACE"," ",607],["T_VARIABLE","$e",607],")",";",["T_WHITESPACE","\n        ",607],"}",["T_WHITESPACE","\n\n        ",608],["T_COMMENT","\/\/ Write generation (second copy)\n",610],["T_WHITESPACE","        ",611],["T_VARIABLE","$genFile",611],["T_OBJECT_OPERATOR","->",611],["T_STRING","writeLong",611],"(",["T_VARIABLE","$generation",611],")",";",["T_WHITESPACE","\n\n\n        ",611],["T_COMMENT","\/\/ Check if another update or read process is not running now\n",614],["T_WHITESPACE","        ",615],["T_COMMENT","\/\/ If yes, skip clean-up procedure\n",615],["T_WHITESPACE","        ",616],["T_IF","if",616],["T_WHITESPACE"," ",616],"(",["T_STRING","Zend_Search_Lucene_LockManager",616],["T_DOUBLE_COLON","::",616],["T_STRING","escalateReadLock",616],"(",["T_VARIABLE","$this",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","_directory",616],")",")",["T_WHITESPACE"," ",616],"{",["T_WHITESPACE","\n            ",616],["T_DOC_COMMENT","\/**\n             * Clean-up directory\n             *\/",617],["T_WHITESPACE","\n            ",619],["T_VARIABLE","$filesToDelete",620],["T_WHITESPACE"," ",620],"=",["T_WHITESPACE"," ",620],["T_ARRAY","array",620],"(",")",";",["T_WHITESPACE","\n            ",620],["T_VARIABLE","$filesTypes",621],["T_WHITESPACE","    ",621],"=",["T_WHITESPACE"," ",621],["T_ARRAY","array",621],"(",")",";",["T_WHITESPACE","\n            ",621],["T_VARIABLE","$filesNumbers",622],["T_WHITESPACE","  ",622],"=",["T_WHITESPACE"," ",622],["T_ARRAY","array",622],"(",")",";",["T_WHITESPACE","\n\n            ",622],["T_COMMENT","\/\/ list of .del files of currently used segments\n",624],["T_WHITESPACE","            ",625],["T_COMMENT","\/\/ each segment can have several generations of .del files\n",625],["T_WHITESPACE","            ",626],["T_COMMENT","\/\/ only last should not be deleted\n",626],["T_WHITESPACE","            ",627],["T_VARIABLE","$delFiles",627],["T_WHITESPACE"," ",627],"=",["T_WHITESPACE"," ",627],["T_ARRAY","array",627],"(",")",";",["T_WHITESPACE","\n\n            ",627],["T_FOREACH","foreach",629],["T_WHITESPACE"," ",629],"(",["T_VARIABLE","$this",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","_directory",629],["T_OBJECT_OPERATOR","->",629],["T_STRING","fileList",629],"(",")",["T_WHITESPACE"," ",629],["T_AS","as",629],["T_WHITESPACE"," ",629],["T_VARIABLE","$file",629],")",["T_WHITESPACE"," ",629],"{",["T_WHITESPACE","\n                ",629],["T_IF","if",630],["T_WHITESPACE"," ",630],"(",["T_VARIABLE","$file",630],["T_WHITESPACE"," ",630],["T_IS_EQUAL","==",630],["T_WHITESPACE"," ",630],["T_CONSTANT_ENCAPSED_STRING","'deletable'",630],")",["T_WHITESPACE"," ",630],"{",["T_WHITESPACE","\n                    ",630],["T_COMMENT","\/\/ 'deletable' file\n",631],["T_WHITESPACE","                    ",632],["T_VARIABLE","$filesToDelete",632],"[","]",["T_WHITESPACE"," ",632],"=",["T_WHITESPACE"," ",632],["T_VARIABLE","$file",632],";",["T_WHITESPACE","\n                    ",632],["T_VARIABLE","$filesTypes",633],"[","]",["T_WHITESPACE","    ",633],"=",["T_WHITESPACE"," ",633],["T_LNUMBER","0",633],";",["T_WHITESPACE"," ",633],["T_COMMENT","\/\/ delete this file first, since it's not used starting from Lucene v2.1\n",633],["T_WHITESPACE","                    ",634],["T_VARIABLE","$filesNumbers",634],"[","]",["T_WHITESPACE","  ",634],"=",["T_WHITESPACE"," ",634],["T_LNUMBER","0",634],";",["T_WHITESPACE","\n                ",634],"}",["T_WHITESPACE"," ",635],["T_ELSE","else",635],["T_WHITESPACE"," ",635],["T_IF","if",635],["T_WHITESPACE"," ",635],"(",["T_VARIABLE","$file",635],["T_WHITESPACE"," ",635],["T_IS_EQUAL","==",635],["T_WHITESPACE"," ",635],["T_CONSTANT_ENCAPSED_STRING","'segments'",635],")",["T_WHITESPACE"," ",635],"{",["T_WHITESPACE","\n                    ",635],["T_COMMENT","\/\/ 'segments' file\n",636],["T_WHITESPACE","                    ",637],["T_VARIABLE","$filesToDelete",637],"[","]",["T_WHITESPACE"," ",637],"=",["T_WHITESPACE"," ",637],["T_VARIABLE","$file",637],";",["T_WHITESPACE","\n                    ",637],["T_VARIABLE","$filesTypes",638],"[","]",["T_WHITESPACE","    ",638],"=",["T_WHITESPACE"," ",638],["T_LNUMBER","1",638],";",["T_WHITESPACE"," ",638],["T_COMMENT","\/\/ second file to be deleted \"zero\" version of segments file (Lucene pre-2.1)\n",638],["T_WHITESPACE","                    ",639],["T_VARIABLE","$filesNumbers",639],"[","]",["T_WHITESPACE","  ",639],"=",["T_WHITESPACE"," ",639],["T_LNUMBER","0",639],";",["T_WHITESPACE","\n                ",639],"}",["T_WHITESPACE"," ",640],["T_ELSE","else",640],["T_WHITESPACE"," ",640],["T_IF","if",640],["T_WHITESPACE"," ",640],"(",["T_STRING","preg_match",640],"(",["T_CONSTANT_ENCAPSED_STRING","'\/^segments_[a-zA-Z0-9]+$\/i'",640],",",["T_WHITESPACE"," ",640],["T_VARIABLE","$file",640],")",")",["T_WHITESPACE"," ",640],"{",["T_WHITESPACE","\n                    ",640],["T_COMMENT","\/\/ 'segments_xxx' file\n",641],["T_WHITESPACE","                    ",642],["T_COMMENT","\/\/ Check if it's not a just created generation file\n",642],["T_WHITESPACE","                    ",643],["T_IF","if",643],["T_WHITESPACE"," ",643],"(",["T_VARIABLE","$file",643],["T_WHITESPACE"," ",643],["T_IS_NOT_EQUAL","!=",643],["T_WHITESPACE"," ",643],["T_STRING","Zend_Search_Lucene",643],["T_DOUBLE_COLON","::",643],["T_STRING","getSegmentFileName",643],"(",["T_VARIABLE","$generation",643],")",")",["T_WHITESPACE"," ",643],"{",["T_WHITESPACE","\n                        ",643],["T_VARIABLE","$filesToDelete",644],"[","]",["T_WHITESPACE"," ",644],"=",["T_WHITESPACE"," ",644],["T_VARIABLE","$file",644],";",["T_WHITESPACE","\n                        ",644],["T_VARIABLE","$filesTypes",645],"[","]",["T_WHITESPACE","    ",645],"=",["T_WHITESPACE"," ",645],["T_LNUMBER","2",645],";",["T_WHITESPACE"," ",645],["T_COMMENT","\/\/ first group of files for deletions\n",645],["T_WHITESPACE","                        ",646],["T_VARIABLE","$filesNumbers",646],"[","]",["T_WHITESPACE","  ",646],"=",["T_WHITESPACE"," ",646],["T_INT_CAST","(int)",646],["T_STRING","base_convert",646],"(",["T_STRING","substr",646],"(",["T_VARIABLE","$file",646],",",["T_WHITESPACE"," ",646],["T_LNUMBER","9",646],")",",",["T_WHITESPACE"," ",646],["T_LNUMBER","36",646],",",["T_WHITESPACE"," ",646],["T_LNUMBER","10",646],")",";",["T_WHITESPACE"," ",646],["T_COMMENT","\/\/ ordered by segment generation numbers\n",646],["T_WHITESPACE","                    ",647],"}",["T_WHITESPACE","\n                ",647],"}",["T_WHITESPACE"," ",648],["T_ELSE","else",648],["T_WHITESPACE"," ",648],["T_IF","if",648],["T_WHITESPACE"," ",648],"(",["T_STRING","preg_match",648],"(",["T_CONSTANT_ENCAPSED_STRING","'\/(^_([a-zA-Z0-9]+))\\.f\\d+$\/i'",648],",",["T_WHITESPACE"," ",648],["T_VARIABLE","$file",648],",",["T_WHITESPACE"," ",648],["T_VARIABLE","$matches",648],")",")",["T_WHITESPACE"," ",648],"{",["T_WHITESPACE","\n                    ",648],["T_COMMENT","\/\/ one of per segment files ('<segment_name>.f<decimal_number>')\n",649],["T_WHITESPACE","                    ",650],["T_COMMENT","\/\/ Check if it's not one of the segments in the current segments set\n",650],["T_WHITESPACE","                    ",651],["T_IF","if",651],["T_WHITESPACE"," ",651],"(","!",["T_ISSET","isset",651],"(",["T_VARIABLE","$segments",651],"[",["T_VARIABLE","$matches",651],"[",["T_LNUMBER","1",651],"]","]",")",")",["T_WHITESPACE"," ",651],"{",["T_WHITESPACE","\n                        ",651],["T_VARIABLE","$filesToDelete",652],"[","]",["T_WHITESPACE"," ",652],"=",["T_WHITESPACE"," ",652],["T_VARIABLE","$file",652],";",["T_WHITESPACE","\n                        ",652],["T_VARIABLE","$filesTypes",653],"[","]",["T_WHITESPACE","    ",653],"=",["T_WHITESPACE"," ",653],["T_LNUMBER","3",653],";",["T_WHITESPACE"," ",653],["T_COMMENT","\/\/ second group of files for deletions\n",653],["T_WHITESPACE","                        ",654],["T_VARIABLE","$filesNumbers",654],"[","]",["T_WHITESPACE","  ",654],"=",["T_WHITESPACE"," ",654],["T_INT_CAST","(int)",654],["T_STRING","base_convert",654],"(",["T_VARIABLE","$matches",654],"[",["T_LNUMBER","2",654],"]",",",["T_WHITESPACE"," ",654],["T_LNUMBER","36",654],",",["T_WHITESPACE"," ",654],["T_LNUMBER","10",654],")",";",["T_WHITESPACE"," ",654],["T_COMMENT","\/\/ order by segment number\n",654],["T_WHITESPACE","                    ",655],"}",["T_WHITESPACE","\n                ",655],"}",["T_WHITESPACE"," ",656],["T_ELSE","else",656],["T_WHITESPACE"," ",656],["T_IF","if",656],["T_WHITESPACE"," ",656],"(",["T_STRING","preg_match",656],"(",["T_CONSTANT_ENCAPSED_STRING","'\/(^_([a-zA-Z0-9]+))(_([a-zA-Z0-9]+))\\.del$\/i'",656],",",["T_WHITESPACE"," ",656],["T_VARIABLE","$file",656],",",["T_WHITESPACE"," ",656],["T_VARIABLE","$matches",656],")",")",["T_WHITESPACE"," ",656],"{",["T_WHITESPACE","\n                    ",656],["T_COMMENT","\/\/ one of per segment files ('<segment_name>_<del_generation>.del' where <segment_name> is '_<segment_number>')\n",657],["T_WHITESPACE","                    ",658],["T_COMMENT","\/\/ Check if it's not one of the segments in the current segments set\n",658],["T_WHITESPACE","                    ",659],["T_IF","if",659],["T_WHITESPACE"," ",659],"(","!",["T_ISSET","isset",659],"(",["T_VARIABLE","$segments",659],"[",["T_VARIABLE","$matches",659],"[",["T_LNUMBER","1",659],"]","]",")",")",["T_WHITESPACE"," ",659],"{",["T_WHITESPACE","\n                        ",659],["T_VARIABLE","$filesToDelete",660],"[","]",["T_WHITESPACE"," ",660],"=",["T_WHITESPACE"," ",660],["T_VARIABLE","$file",660],";",["T_WHITESPACE","\n                        ",660],["T_VARIABLE","$filesTypes",661],"[","]",["T_WHITESPACE","    ",661],"=",["T_WHITESPACE"," ",661],["T_LNUMBER","3",661],";",["T_WHITESPACE"," ",661],["T_COMMENT","\/\/ second group of files for deletions\n",661],["T_WHITESPACE","                        ",662],["T_VARIABLE","$filesNumbers",662],"[","]",["T_WHITESPACE","  ",662],"=",["T_WHITESPACE"," ",662],["T_INT_CAST","(int)",662],["T_STRING","base_convert",662],"(",["T_VARIABLE","$matches",662],"[",["T_LNUMBER","2",662],"]",",",["T_WHITESPACE"," ",662],["T_LNUMBER","36",662],",",["T_WHITESPACE"," ",662],["T_LNUMBER","10",662],")",";",["T_WHITESPACE"," ",662],["T_COMMENT","\/\/ order by segment number\n",662],["T_WHITESPACE","                    ",663],"}",["T_WHITESPACE"," ",663],["T_ELSE","else",663],["T_WHITESPACE"," ",663],"{",["T_WHITESPACE","\n                        ",663],["T_VARIABLE","$segmentNumber",664],["T_WHITESPACE"," ",664],"=",["T_WHITESPACE"," ",664],["T_INT_CAST","(int)",664],["T_STRING","base_convert",664],"(",["T_VARIABLE","$matches",664],"[",["T_LNUMBER","2",664],"]",",",["T_WHITESPACE"," ",664],["T_LNUMBER","36",664],",",["T_WHITESPACE"," ",664],["T_LNUMBER","10",664],")",";",["T_WHITESPACE","\n                        ",664],["T_VARIABLE","$delGeneration",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_INT_CAST","(int)",665],["T_STRING","base_convert",665],"(",["T_VARIABLE","$matches",665],"[",["T_LNUMBER","4",665],"]",",",["T_WHITESPACE"," ",665],["T_LNUMBER","36",665],",",["T_WHITESPACE"," ",665],["T_LNUMBER","10",665],")",";",["T_WHITESPACE","\n                        ",665],["T_IF","if",666],["T_WHITESPACE"," ",666],"(","!",["T_ISSET","isset",666],"(",["T_VARIABLE","$delFiles",666],"[",["T_VARIABLE","$segmentNumber",666],"]",")",")",["T_WHITESPACE"," ",666],"{",["T_WHITESPACE","\n                            ",666],["T_VARIABLE","$delFiles",667],"[",["T_VARIABLE","$segmentNumber",667],"]",["T_WHITESPACE"," ",667],"=",["T_WHITESPACE"," ",667],["T_ARRAY","array",667],"(",")",";",["T_WHITESPACE","\n                        ",667],"}",["T_WHITESPACE","\n                        ",668],["T_VARIABLE","$delFiles",669],"[",["T_VARIABLE","$segmentNumber",669],"]","[",["T_VARIABLE","$delGeneration",669],"]",["T_WHITESPACE"," ",669],"=",["T_WHITESPACE"," ",669],["T_VARIABLE","$file",669],";",["T_WHITESPACE","\n                    ",669],"}",["T_WHITESPACE","\n                ",670],"}",["T_WHITESPACE"," ",671],["T_ELSE","else",671],["T_WHITESPACE"," ",671],["T_IF","if",671],["T_WHITESPACE"," ",671],"(",["T_ISSET","isset",671],"(",["T_STRING","self",671],["T_DOUBLE_COLON","::",671],["T_VARIABLE","$_indexExtensions",671],"[",["T_STRING","substr",671],"(",["T_VARIABLE","$file",671],",",["T_WHITESPACE"," ",671],["T_STRING","strlen",671],"(",["T_VARIABLE","$file",671],")","-",["T_LNUMBER","4",671],")","]",")",")",["T_WHITESPACE"," ",671],"{",["T_WHITESPACE","\n                    ",671],["T_COMMENT","\/\/ one of per segment files ('<segment_name>.<ext>')\n",672],["T_WHITESPACE","                    ",673],["T_VARIABLE","$segmentName",673],["T_WHITESPACE"," ",673],"=",["T_WHITESPACE"," ",673],["T_STRING","substr",673],"(",["T_VARIABLE","$file",673],",",["T_WHITESPACE"," ",673],["T_LNUMBER","0",673],",",["T_WHITESPACE"," ",673],["T_STRING","strlen",673],"(",["T_VARIABLE","$file",673],")",["T_WHITESPACE"," ",673],"-",["T_WHITESPACE"," ",673],["T_LNUMBER","4",673],")",";",["T_WHITESPACE","\n                    ",673],["T_COMMENT","\/\/ Check if it's not one of the segments in the current segments set\n",674],["T_WHITESPACE","                    ",675],["T_IF","if",675],["T_WHITESPACE"," ",675],"(","!",["T_ISSET","isset",675],"(",["T_VARIABLE","$segments",675],"[",["T_VARIABLE","$segmentName",675],"]",")",["T_WHITESPACE","  ",675],["T_BOOLEAN_AND","&&",675],["T_WHITESPACE","\n                        ",675],"(",["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","_currentSegment",676],["T_WHITESPACE"," ",676],["T_IS_IDENTICAL","===",676],["T_WHITESPACE"," ",676],["T_STRING","null",676],["T_WHITESPACE","  ",676],["T_BOOLEAN_OR","||",676],["T_WHITESPACE","  ",676],["T_VARIABLE","$this",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","_currentSegment",676],["T_OBJECT_OPERATOR","->",676],["T_STRING","getName",676],"(",")",["T_WHITESPACE"," ",676],["T_IS_NOT_EQUAL","!=",676],["T_WHITESPACE"," ",676],["T_VARIABLE","$segmentName",676],")",")",["T_WHITESPACE"," ",676],"{",["T_WHITESPACE","\n                        ",676],["T_VARIABLE","$filesToDelete",677],"[","]",["T_WHITESPACE"," ",677],"=",["T_WHITESPACE"," ",677],["T_VARIABLE","$file",677],";",["T_WHITESPACE","\n                        ",677],["T_VARIABLE","$filesTypes",678],"[","]",["T_WHITESPACE","    ",678],"=",["T_WHITESPACE"," ",678],["T_LNUMBER","3",678],";",["T_WHITESPACE"," ",678],["T_COMMENT","\/\/ second group of files for deletions\n",678],["T_WHITESPACE","                        ",679],["T_VARIABLE","$filesNumbers",679],"[","]",["T_WHITESPACE","  ",679],"=",["T_WHITESPACE"," ",679],["T_INT_CAST","(int)",679],["T_STRING","base_convert",679],"(",["T_STRING","substr",679],"(",["T_VARIABLE","$file",679],",",["T_WHITESPACE"," ",679],["T_LNUMBER","1",679],["T_WHITESPACE"," ",679],["T_COMMENT","\/* skip '_' *\/",679],",",["T_WHITESPACE"," ",679],["T_STRING","strlen",679],"(",["T_VARIABLE","$file",679],")","-",["T_LNUMBER","5",679],")",",",["T_WHITESPACE"," ",679],["T_LNUMBER","36",679],",",["T_WHITESPACE"," ",679],["T_LNUMBER","10",679],")",";",["T_WHITESPACE"," ",679],["T_COMMENT","\/\/ order by segment number\n",679],["T_WHITESPACE","                    ",680],"}",["T_WHITESPACE","\n                ",680],"}",["T_WHITESPACE","\n            ",681],"}",["T_WHITESPACE","\n\n            ",682],["T_VARIABLE","$maxGenNumber",684],["T_WHITESPACE"," ",684],"=",["T_WHITESPACE"," ",684],["T_LNUMBER","0",684],";",["T_WHITESPACE","\n            ",684],["T_COMMENT","\/\/ process .del files of currently used segments\n",685],["T_WHITESPACE","            ",686],["T_FOREACH","foreach",686],["T_WHITESPACE"," ",686],"(",["T_VARIABLE","$delFiles",686],["T_WHITESPACE"," ",686],["T_AS","as",686],["T_WHITESPACE"," ",686],["T_VARIABLE","$segmentNumber",686],["T_WHITESPACE"," ",686],["T_DOUBLE_ARROW","=>",686],["T_WHITESPACE"," ",686],["T_VARIABLE","$segmentDelFiles",686],")",["T_WHITESPACE"," ",686],"{",["T_WHITESPACE","\n                ",686],["T_STRING","ksort",687],"(",["T_VARIABLE","$delFiles",687],"[",["T_VARIABLE","$segmentNumber",687],"]",",",["T_WHITESPACE"," ",687],["T_STRING","SORT_NUMERIC",687],")",";",["T_WHITESPACE","\n                ",687],["T_STRING","array_pop",688],"(",["T_VARIABLE","$delFiles",688],"[",["T_VARIABLE","$segmentNumber",688],"]",")",";",["T_WHITESPACE"," ",688],["T_COMMENT","\/\/ remove last delete file generation from candidates for deleting\n",688],["T_WHITESPACE","\n                ",689],["T_STRING","end",690],"(",["T_VARIABLE","$delFiles",690],"[",["T_VARIABLE","$segmentNumber",690],"]",")",";",["T_WHITESPACE","\n                ",690],["T_VARIABLE","$lastGenNumber",691],["T_WHITESPACE"," ",691],"=",["T_WHITESPACE"," ",691],["T_STRING","key",691],"(",["T_VARIABLE","$delFiles",691],"[",["T_VARIABLE","$segmentNumber",691],"]",")",";",["T_WHITESPACE","\n                ",691],["T_IF","if",692],["T_WHITESPACE"," ",692],"(",["T_VARIABLE","$lastGenNumber",692],["T_WHITESPACE"," ",692],">",["T_WHITESPACE"," ",692],["T_VARIABLE","$maxGenNumber",692],")",["T_WHITESPACE"," ",692],"{",["T_WHITESPACE","\n                    ",692],["T_VARIABLE","$maxGenNumber",693],["T_WHITESPACE"," ",693],"=",["T_WHITESPACE"," ",693],["T_VARIABLE","$lastGenNumber",693],";",["T_WHITESPACE","\n                ",693],"}",["T_WHITESPACE","\n            ",694],"}",["T_WHITESPACE","\n            ",695],["T_FOREACH","foreach",696],["T_WHITESPACE"," ",696],"(",["T_VARIABLE","$delFiles",696],["T_WHITESPACE"," ",696],["T_AS","as",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$segmentNumber",696],["T_WHITESPACE"," ",696],["T_DOUBLE_ARROW","=>",696],["T_WHITESPACE"," ",696],["T_VARIABLE","$segmentDelFiles",696],")",["T_WHITESPACE"," ",696],"{",["T_WHITESPACE","\n                ",696],["T_FOREACH","foreach",697],["T_WHITESPACE"," ",697],"(",["T_VARIABLE","$segmentDelFiles",697],["T_WHITESPACE"," ",697],["T_AS","as",697],["T_WHITESPACE"," ",697],["T_VARIABLE","$delGeneration",697],["T_WHITESPACE"," ",697],["T_DOUBLE_ARROW","=>",697],["T_WHITESPACE"," ",697],["T_VARIABLE","$file",697],")",["T_WHITESPACE"," ",697],"{",["T_WHITESPACE","\n                        ",697],["T_VARIABLE","$filesToDelete",698],"[","]",["T_WHITESPACE"," ",698],"=",["T_WHITESPACE"," ",698],["T_VARIABLE","$file",698],";",["T_WHITESPACE","\n                        ",698],["T_VARIABLE","$filesTypes",699],"[","]",["T_WHITESPACE","    ",699],"=",["T_WHITESPACE"," ",699],["T_LNUMBER","4",699],";",["T_WHITESPACE"," ",699],["T_COMMENT","\/\/ third group of files for deletions\n",699],["T_WHITESPACE","                        ",700],["T_VARIABLE","$filesNumbers",700],"[","]",["T_WHITESPACE","  ",700],"=",["T_WHITESPACE"," ",700],["T_VARIABLE","$segmentNumber",700],"*",["T_VARIABLE","$maxGenNumber",700],["T_WHITESPACE"," ",700],"+",["T_WHITESPACE"," ",700],["T_VARIABLE","$delGeneration",700],";",["T_WHITESPACE"," ",700],["T_COMMENT","\/\/ order by <segment_number>,<del_generation> pair\n",700],["T_WHITESPACE","                ",701],"}",["T_WHITESPACE","\n            ",701],"}",["T_WHITESPACE","\n\n            ",702],["T_COMMENT","\/\/ Reorder files for deleting\n",704],["T_WHITESPACE","            ",705],["T_STRING","array_multisort",705],"(",["T_VARIABLE","$filesTypes",705],",",["T_WHITESPACE","    ",705],["T_STRING","SORT_ASC",705],",",["T_WHITESPACE"," ",705],["T_STRING","SORT_NUMERIC",705],",",["T_WHITESPACE","\n                            ",705],["T_VARIABLE","$filesNumbers",706],",",["T_WHITESPACE","  ",706],["T_STRING","SORT_ASC",706],",",["T_WHITESPACE"," ",706],["T_STRING","SORT_NUMERIC",706],",",["T_WHITESPACE","\n                            ",706],["T_VARIABLE","$filesToDelete",707],",",["T_WHITESPACE"," ",707],["T_STRING","SORT_ASC",707],",",["T_WHITESPACE"," ",707],["T_STRING","SORT_STRING",707],")",";",["T_WHITESPACE","\n\n            ",707],["T_FOREACH","foreach",709],["T_WHITESPACE"," ",709],"(",["T_VARIABLE","$filesToDelete",709],["T_WHITESPACE"," ",709],["T_AS","as",709],["T_WHITESPACE"," ",709],["T_VARIABLE","$file",709],")",["T_WHITESPACE"," ",709],"{",["T_WHITESPACE","\n                ",709],["T_TRY","try",710],["T_WHITESPACE"," ",710],"{",["T_WHITESPACE","\n                    ",710],["T_DOC_COMMENT","\/** Skip shared docstore segments deleting *\/",711],["T_WHITESPACE","\n                    ",711],["T_DOC_COMMENT","\/** @todo Process '.cfx' files to check if them are already unused *\/",712],["T_WHITESPACE","\n                    ",712],["T_IF","if",713],["T_WHITESPACE"," ",713],"(",["T_STRING","substr",713],"(",["T_VARIABLE","$file",713],",",["T_WHITESPACE"," ",713],["T_STRING","strlen",713],"(",["T_VARIABLE","$file",713],")","-",["T_LNUMBER","4",713],")",["T_WHITESPACE"," ",713],["T_IS_NOT_EQUAL","!=",713],["T_WHITESPACE"," ",713],["T_CONSTANT_ENCAPSED_STRING","'.cfx'",713],")",["T_WHITESPACE"," ",713],"{",["T_WHITESPACE","\n                        ",713],["T_VARIABLE","$this",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","_directory",714],["T_OBJECT_OPERATOR","->",714],["T_STRING","deleteFile",714],"(",["T_VARIABLE","$file",714],")",";",["T_WHITESPACE","\n                    ",714],"}",["T_WHITESPACE","\n                ",715],"}",["T_WHITESPACE"," ",716],["T_CATCH","catch",716],["T_WHITESPACE"," ",716],"(",["T_STRING","Zend_Search_Lucene_Exception",716],["T_WHITESPACE"," ",716],["T_VARIABLE","$e",716],")",["T_WHITESPACE"," ",716],"{",["T_WHITESPACE","\n                    ",716],["T_IF","if",717],["T_WHITESPACE"," ",717],"(",["T_STRING","strpos",717],"(",["T_VARIABLE","$e",717],["T_OBJECT_OPERATOR","->",717],["T_STRING","getMessage",717],"(",")",",",["T_WHITESPACE"," ",717],["T_CONSTANT_ENCAPSED_STRING","'Can\\'t delete file'",717],")",["T_WHITESPACE"," ",717],["T_IS_IDENTICAL","===",717],["T_WHITESPACE"," ",717],["T_STRING","false",717],")",["T_WHITESPACE"," ",717],"{",["T_WHITESPACE","\n                        ",717],["T_COMMENT","\/\/ That's not \"file is under processing or already deleted\" exception\n",718],["T_WHITESPACE","                        ",719],["T_COMMENT","\/\/ Pass it through\n",719],["T_WHITESPACE","                        ",720],["T_THROW","throw",720],["T_WHITESPACE"," ",720],["T_NEW","new",720],["T_WHITESPACE"," ",720],["T_STRING","Zend_Search_Lucene_Exception",720],"(",["T_VARIABLE","$e",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","getMessage",720],"(",")",",",["T_WHITESPACE"," ",720],["T_VARIABLE","$e",720],["T_OBJECT_OPERATOR","->",720],["T_STRING","getCode",720],"(",")",",",["T_WHITESPACE"," ",720],["T_VARIABLE","$e",720],")",";",["T_WHITESPACE","\n                    ",720],"}",["T_WHITESPACE","\n                ",721],"}",["T_WHITESPACE","\n            ",722],"}",["T_WHITESPACE","\n\n            ",723],["T_COMMENT","\/\/ Return read lock into the previous state\n",725],["T_WHITESPACE","            ",726],["T_STRING","Zend_Search_Lucene_LockManager",726],["T_DOUBLE_COLON","::",726],["T_STRING","deEscalateReadLock",726],"(",["T_VARIABLE","$this",726],["T_OBJECT_OPERATOR","->",726],["T_STRING","_directory",726],")",";",["T_WHITESPACE","\n        ",726],"}",["T_WHITESPACE"," ",727],["T_ELSE","else",727],["T_WHITESPACE"," ",727],"{",["T_WHITESPACE","\n            ",727],["T_COMMENT","\/\/ Only release resources if another index reader is running now\n",728],["T_WHITESPACE","            ",729],["T_FOREACH","foreach",729],["T_WHITESPACE"," ",729],"(",["T_VARIABLE","$this",729],["T_OBJECT_OPERATOR","->",729],["T_STRING","_segmentsToDelete",729],["T_WHITESPACE"," ",729],["T_AS","as",729],["T_WHITESPACE"," ",729],["T_VARIABLE","$segName",729],")",["T_WHITESPACE"," ",729],"{",["T_WHITESPACE","\n                ",729],["T_FOREACH","foreach",730],["T_WHITESPACE"," ",730],"(",["T_STRING","self",730],["T_DOUBLE_COLON","::",730],["T_VARIABLE","$_indexExtensions",730],["T_WHITESPACE"," ",730],["T_AS","as",730],["T_WHITESPACE"," ",730],["T_VARIABLE","$ext",730],")",["T_WHITESPACE"," ",730],"{",["T_WHITESPACE","\n                    ",730],["T_VARIABLE","$this",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","_directory",731],["T_OBJECT_OPERATOR","->",731],["T_STRING","purgeFile",731],"(",["T_VARIABLE","$segName",731],["T_WHITESPACE"," ",731],".",["T_WHITESPACE"," ",731],["T_VARIABLE","$ext",731],")",";",["T_WHITESPACE","\n                ",731],"}",["T_WHITESPACE","\n            ",732],"}",["T_WHITESPACE","\n        ",733],"}",["T_WHITESPACE","\n\n        ",734],["T_COMMENT","\/\/ Clean-up _segmentsToDelete container\n",736],["T_WHITESPACE","        ",737],["T_VARIABLE","$this",737],["T_OBJECT_OPERATOR","->",737],["T_STRING","_segmentsToDelete",737],["T_WHITESPACE"," ",737],"=",["T_WHITESPACE"," ",737],["T_ARRAY","array",737],"(",")",";",["T_WHITESPACE","\n\n\n        ",737],["T_COMMENT","\/\/ Release index write lock\n",740],["T_WHITESPACE","        ",741],["T_STRING","Zend_Search_Lucene_LockManager",741],["T_DOUBLE_COLON","::",741],["T_STRING","releaseWriteLock",741],"(",["T_VARIABLE","$this",741],["T_OBJECT_OPERATOR","->",741],["T_STRING","_directory",741],")",";",["T_WHITESPACE","\n\n        ",741],["T_COMMENT","\/\/ Remove unused segments from segments list\n",743],["T_WHITESPACE","        ",744],["T_FOREACH","foreach",744],["T_WHITESPACE"," ",744],"(",["T_VARIABLE","$this",744],["T_OBJECT_OPERATOR","->",744],["T_STRING","_segmentInfos",744],["T_WHITESPACE"," ",744],["T_AS","as",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$segName",744],["T_WHITESPACE"," ",744],["T_DOUBLE_ARROW","=>",744],["T_WHITESPACE"," ",744],["T_VARIABLE","$segmentInfo",744],")",["T_WHITESPACE"," ",744],"{",["T_WHITESPACE","\n            ",744],["T_IF","if",745],["T_WHITESPACE"," ",745],"(","!",["T_ISSET","isset",745],"(",["T_VARIABLE","$segments",745],"[",["T_VARIABLE","$segName",745],"]",")",")",["T_WHITESPACE"," ",745],"{",["T_WHITESPACE","\n                ",745],["T_UNSET","unset",746],"(",["T_VARIABLE","$this",746],["T_OBJECT_OPERATOR","->",746],["T_STRING","_segmentInfos",746],"[",["T_VARIABLE","$segName",746],"]",")",";",["T_WHITESPACE","\n            ",746],"}",["T_WHITESPACE","\n        ",747],"}",["T_WHITESPACE","\n    ",748],"}",["T_WHITESPACE","\n\n    ",749],["T_DOC_COMMENT","\/**\n     * Commit current changes\n     *\/",751],["T_WHITESPACE","\n    ",753],["T_PUBLIC","public",754],["T_WHITESPACE"," ",754],["T_FUNCTION","function",754],["T_WHITESPACE"," ",754],["T_STRING","commit",754],"(",")",["T_WHITESPACE","\n    ",754],"{",["T_WHITESPACE","\n        ",755],["T_IF","if",756],["T_WHITESPACE"," ",756],"(",["T_VARIABLE","$this",756],["T_OBJECT_OPERATOR","->",756],["T_STRING","_currentSegment",756],["T_WHITESPACE"," ",756],["T_IS_NOT_IDENTICAL","!==",756],["T_WHITESPACE"," ",756],["T_STRING","null",756],")",["T_WHITESPACE"," ",756],"{",["T_WHITESPACE","\n            ",756],["T_VARIABLE","$newSegment",757],["T_WHITESPACE"," ",757],"=",["T_WHITESPACE"," ",757],["T_VARIABLE","$this",757],["T_OBJECT_OPERATOR","->",757],["T_STRING","_currentSegment",757],["T_OBJECT_OPERATOR","->",757],["T_STRING","close",757],"(",")",";",["T_WHITESPACE","\n            ",757],["T_IF","if",758],["T_WHITESPACE"," ",758],"(",["T_VARIABLE","$newSegment",758],["T_WHITESPACE"," ",758],["T_IS_NOT_IDENTICAL","!==",758],["T_WHITESPACE"," ",758],["T_STRING","null",758],")",["T_WHITESPACE"," ",758],"{",["T_WHITESPACE","\n                ",758],["T_VARIABLE","$this",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","_newSegments",759],"[",["T_VARIABLE","$newSegment",759],["T_OBJECT_OPERATOR","->",759],["T_STRING","getName",759],"(",")","]",["T_WHITESPACE"," ",759],"=",["T_WHITESPACE"," ",759],["T_VARIABLE","$newSegment",759],";",["T_WHITESPACE","\n            ",759],"}",["T_WHITESPACE","\n            ",760],["T_VARIABLE","$this",761],["T_OBJECT_OPERATOR","->",761],["T_STRING","_currentSegment",761],["T_WHITESPACE"," ",761],"=",["T_WHITESPACE"," ",761],["T_STRING","null",761],";",["T_WHITESPACE","\n        ",761],"}",["T_WHITESPACE","\n\n        ",762],["T_VARIABLE","$this",764],["T_OBJECT_OPERATOR","->",764],["T_STRING","_updateSegments",764],"(",")",";",["T_WHITESPACE","\n    ",764],"}",["T_WHITESPACE","\n\n\n    ",765],["T_DOC_COMMENT","\/**\n     * Merges the provided indexes into this index.\n     *\n     * @param array $readers\n     * @return void\n     *\/",768],["T_WHITESPACE","\n    ",773],["T_PUBLIC","public",774],["T_WHITESPACE"," ",774],["T_FUNCTION","function",774],["T_WHITESPACE"," ",774],["T_STRING","addIndexes",774],"(",["T_VARIABLE","$readers",774],")",["T_WHITESPACE","\n    ",774],"{",["T_WHITESPACE","\n        ",775],["T_DOC_COMMENT","\/**\n         * @todo implementation\n         *\/",776],["T_WHITESPACE","\n    ",778],"}",["T_WHITESPACE","\n\n    ",779],["T_DOC_COMMENT","\/**\n     * Merges all segments together into new one\n     *\n     * Returns true on success and false if another optimization or auto-optimization process\n     * is running now\n     *\n     * @return boolean\n     *\/",781],["T_WHITESPACE","\n    ",788],["T_PUBLIC","public",789],["T_WHITESPACE"," ",789],["T_FUNCTION","function",789],["T_WHITESPACE"," ",789],["T_STRING","optimize",789],"(",")",["T_WHITESPACE","\n    ",789],"{",["T_WHITESPACE","\n        ",790],["T_IF","if",791],["T_WHITESPACE"," ",791],"(",["T_STRING","Zend_Search_Lucene_LockManager",791],["T_DOUBLE_COLON","::",791],["T_STRING","obtainOptimizationLock",791],"(",["T_VARIABLE","$this",791],["T_OBJECT_OPERATOR","->",791],["T_STRING","_directory",791],")",["T_WHITESPACE"," ",791],["T_IS_IDENTICAL","===",791],["T_WHITESPACE"," ",791],["T_STRING","false",791],")",["T_WHITESPACE"," ",791],"{",["T_WHITESPACE","\n            ",791],["T_RETURN","return",792],["T_WHITESPACE"," ",792],["T_STRING","false",792],";",["T_WHITESPACE","\n        ",792],"}",["T_WHITESPACE","\n\n        ",793],["T_COMMENT","\/\/ Update segments list to be sure all segments are not merged yet by another process\n",795],["T_WHITESPACE","        ",796],["T_COMMENT","\/\/\n",796],["T_WHITESPACE","        ",797],["T_COMMENT","\/\/ Segment merging functionality is concentrated in this class and surrounded\n",797],["T_WHITESPACE","        ",798],["T_COMMENT","\/\/ by optimization lock obtaining\/releasing.\n",798],["T_WHITESPACE","        ",799],["T_COMMENT","\/\/ _updateSegments() refreshes segments list from the latest index generation.\n",799],["T_WHITESPACE","        ",800],["T_COMMENT","\/\/ So only new segments can be added to the index while we are merging some already existing\n",800],["T_WHITESPACE","        ",801],["T_COMMENT","\/\/ segments.\n",801],["T_WHITESPACE","        ",802],["T_COMMENT","\/\/ Newly added segments will be also included into the index by the _updateSegments() call\n",802],["T_WHITESPACE","        ",803],["T_COMMENT","\/\/ either by another process or by the current process with the commit() call at the end of _mergeSegments() method.\n",803],["T_WHITESPACE","        ",804],["T_COMMENT","\/\/ That's guaranteed by the serialisation of _updateSegments() execution using exclusive locks.\n",804],["T_WHITESPACE","        ",805],["T_VARIABLE","$this",805],["T_OBJECT_OPERATOR","->",805],["T_STRING","_updateSegments",805],"(",")",";",["T_WHITESPACE","\n\n        ",805],["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","_mergeSegments",807],"(",["T_VARIABLE","$this",807],["T_OBJECT_OPERATOR","->",807],["T_STRING","_segmentInfos",807],")",";",["T_WHITESPACE","\n\n        ",807],["T_STRING","Zend_Search_Lucene_LockManager",809],["T_DOUBLE_COLON","::",809],["T_STRING","releaseOptimizationLock",809],"(",["T_VARIABLE","$this",809],["T_OBJECT_OPERATOR","->",809],["T_STRING","_directory",809],")",";",["T_WHITESPACE","\n\n        ",809],["T_RETURN","return",811],["T_WHITESPACE"," ",811],["T_STRING","true",811],";",["T_WHITESPACE","\n    ",811],"}",["T_WHITESPACE","\n\n    ",812],["T_DOC_COMMENT","\/**\n     * Get name for new segment\n     *\n     * @return string\n     *\/",814],["T_WHITESPACE","\n    ",818],["T_PRIVATE","private",819],["T_WHITESPACE"," ",819],["T_FUNCTION","function",819],["T_WHITESPACE"," ",819],["T_STRING","_newSegmentName",819],"(",")",["T_WHITESPACE","\n    ",819],"{",["T_WHITESPACE","\n        ",820],["T_STRING","Zend_Search_Lucene_LockManager",821],["T_DOUBLE_COLON","::",821],["T_STRING","obtainWriteLock",821],"(",["T_VARIABLE","$this",821],["T_OBJECT_OPERATOR","->",821],["T_STRING","_directory",821],")",";",["T_WHITESPACE","\n\n        ",821],["T_VARIABLE","$generation",823],["T_WHITESPACE"," ",823],"=",["T_WHITESPACE"," ",823],["T_STRING","Zend_Search_Lucene",823],["T_DOUBLE_COLON","::",823],["T_STRING","getActualGeneration",823],"(",["T_VARIABLE","$this",823],["T_OBJECT_OPERATOR","->",823],["T_STRING","_directory",823],")",";",["T_WHITESPACE","\n        ",823],["T_VARIABLE","$segmentsFile",824],["T_WHITESPACE"," ",824],"=",["T_WHITESPACE"," ",824],["T_VARIABLE","$this",824],["T_OBJECT_OPERATOR","->",824],["T_STRING","_directory",824],["T_OBJECT_OPERATOR","->",824],["T_STRING","getFileObject",824],"(",["T_STRING","Zend_Search_Lucene",824],["T_DOUBLE_COLON","::",824],["T_STRING","getSegmentFileName",824],"(",["T_VARIABLE","$generation",824],")",",",["T_WHITESPACE"," ",824],["T_STRING","false",824],")",";",["T_WHITESPACE","\n\n        ",824],["T_VARIABLE","$segmentsFile",826],["T_OBJECT_OPERATOR","->",826],["T_STRING","seek",826],"(",["T_LNUMBER","12",826],")",";",["T_WHITESPACE"," ",826],["T_COMMENT","\/\/ 12 = 4 (int, file format marker) + 8 (long, index version)\n",826],["T_WHITESPACE","        ",827],["T_VARIABLE","$segmentNameCounter",827],["T_WHITESPACE"," ",827],"=",["T_WHITESPACE"," ",827],["T_VARIABLE","$segmentsFile",827],["T_OBJECT_OPERATOR","->",827],["T_STRING","readInt",827],"(",")",";",["T_WHITESPACE","\n\n        ",827],["T_VARIABLE","$segmentsFile",829],["T_OBJECT_OPERATOR","->",829],["T_STRING","seek",829],"(",["T_LNUMBER","12",829],")",";",["T_WHITESPACE"," ",829],["T_COMMENT","\/\/ 12 = 4 (int, file format marker) + 8 (long, index version)\n",829],["T_WHITESPACE","        ",830],["T_VARIABLE","$segmentsFile",830],["T_OBJECT_OPERATOR","->",830],["T_STRING","writeInt",830],"(",["T_VARIABLE","$segmentNameCounter",830],["T_WHITESPACE"," ",830],"+",["T_WHITESPACE"," ",830],["T_LNUMBER","1",830],")",";",["T_WHITESPACE","\n\n        ",830],["T_COMMENT","\/\/ Flash output to guarantee that wrong value will not be loaded between unlock and\n",832],["T_WHITESPACE","        ",833],["T_COMMENT","\/\/ return (which calls $segmentsFile destructor)\n",833],["T_WHITESPACE","        ",834],["T_VARIABLE","$segmentsFile",834],["T_OBJECT_OPERATOR","->",834],["T_STRING","flush",834],"(",")",";",["T_WHITESPACE","\n\n        ",834],["T_STRING","Zend_Search_Lucene_LockManager",836],["T_DOUBLE_COLON","::",836],["T_STRING","releaseWriteLock",836],"(",["T_VARIABLE","$this",836],["T_OBJECT_OPERATOR","->",836],["T_STRING","_directory",836],")",";",["T_WHITESPACE","\n\n        ",836],["T_RETURN","return",838],["T_WHITESPACE"," ",838],["T_CONSTANT_ENCAPSED_STRING","'_'",838],["T_WHITESPACE"," ",838],".",["T_WHITESPACE"," ",838],["T_STRING","base_convert",838],"(",["T_VARIABLE","$segmentNameCounter",838],",",["T_WHITESPACE"," ",838],["T_LNUMBER","10",838],",",["T_WHITESPACE"," ",838],["T_LNUMBER","36",838],")",";",["T_WHITESPACE","\n    ",838],"}",["T_WHITESPACE","\n\n",839],"}",["T_WHITESPACE","\n",841]]