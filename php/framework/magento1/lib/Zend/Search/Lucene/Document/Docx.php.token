[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Zend Framework\n *\n * LICENSE\n *\n * This source file is subject to the new BSD license that is bundled\n * with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/framework.zend.com\/license\/new-bsd\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@zend.com so we can send you a copy immediately.\n *\n * @category   Zend\n * @package    Zend_Search_Lucene\n * @subpackage Document\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n * @version    $Id$\n *\/",2],["T_WHITESPACE","\n\n",21],["T_DOC_COMMENT","\/** Zend_Search_Lucene_Document_OpenXml *\/",23],["T_WHITESPACE","\n",23],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Document\/OpenXml.php';\n",24],["T_WHITESPACE","\n",25],["T_DOC_COMMENT","\/** Zend_Xml_Security *\/",26],["T_WHITESPACE","\n",26],["T_COMMENT","#require_once 'Zend\/Xml\/Security.php';\n",27],["T_WHITESPACE","\n",28],["T_DOC_COMMENT","\/**\n * Docx document.\n *\n * @category   Zend\n * @package    Zend_Search_Lucene\n * @subpackage Document\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",29],["T_WHITESPACE","\n",37],["T_CLASS","class",38],["T_WHITESPACE"," ",38],["T_STRING","Zend_Search_Lucene_Document_Docx",38],["T_WHITESPACE"," ",38],["T_EXTENDS","extends",38],["T_WHITESPACE"," ",38],["T_STRING","Zend_Search_Lucene_Document_OpenXml",38],["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n    ",38],["T_DOC_COMMENT","\/**\n     * Xml Schema - WordprocessingML\n     *\n     * @var string\n     *\/",39],["T_WHITESPACE","\n    ",43],["T_CONST","const",44],["T_WHITESPACE"," ",44],["T_STRING","SCHEMA_WORDPROCESSINGML",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","'http:\/\/schemas.openxmlformats.org\/wordprocessingml\/2006\/main'",44],";",["T_WHITESPACE","\n\n    ",44],["T_DOC_COMMENT","\/**\n     * Object constructor\n     *\n     * @param string  $fileName\n     * @param boolean $storeContent\n     * @throws Zend_Search_Lucene_Exception\n     *\/",46],["T_WHITESPACE","\n    ",52],["T_PRIVATE","private",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","__construct",53],"(",["T_VARIABLE","$fileName",53],",",["T_WHITESPACE"," ",53],["T_VARIABLE","$storeContent",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n        ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","!",["T_STRING","class_exists",54],"(",["T_CONSTANT_ENCAPSED_STRING","'ZipArchive'",54],",",["T_WHITESPACE"," ",54],["T_STRING","false",54],")",")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Exception.php';\n",55],["T_WHITESPACE","            ",56],["T_THROW","throw",56],["T_WHITESPACE"," ",56],["T_NEW","new",56],["T_WHITESPACE"," ",56],["T_STRING","Zend_Search_Lucene_Exception",56],"(",["T_CONSTANT_ENCAPSED_STRING","'MS Office documents processing functionality requires Zip extension to be loaded'",56],")",";",["T_WHITESPACE","\n        ",56],"}",["T_WHITESPACE","\n\n        ",57],["T_COMMENT","\/\/ Document data holders\n",59],["T_WHITESPACE","        ",60],["T_VARIABLE","$documentBody",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_ARRAY","array",60],"(",")",";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$coreProperties",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_ARRAY","array",61],"(",")",";",["T_WHITESPACE","\n\n        ",61],["T_COMMENT","\/\/ Open OpenXML package\n",63],["T_WHITESPACE","        ",64],["T_VARIABLE","$package",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_NEW","new",64],["T_WHITESPACE"," ",64],["T_STRING","ZipArchive",64],"(",")",";",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$package",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","open",65],"(",["T_VARIABLE","$fileName",65],")",";",["T_WHITESPACE","\n\n        ",65],["T_COMMENT","\/\/ Read relations and search for officeDocument\n",67],["T_WHITESPACE","        ",68],["T_VARIABLE","$relationsXml",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$package",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getFromName",68],"(",["T_CONSTANT_ENCAPSED_STRING","'_rels\/.rels'",68],")",";",["T_WHITESPACE","\n        ",68],["T_IF","if",69],["T_WHITESPACE"," ",69],"(",["T_VARIABLE","$relationsXml",69],["T_WHITESPACE"," ",69],["T_IS_IDENTICAL","===",69],["T_WHITESPACE"," ",69],["T_STRING","false",69],")",["T_WHITESPACE"," ",69],"{",["T_WHITESPACE","\n            ",69],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Exception.php';\n",70],["T_WHITESPACE","            ",71],["T_THROW","throw",71],["T_WHITESPACE"," ",71],["T_NEW","new",71],["T_WHITESPACE"," ",71],["T_STRING","Zend_Search_Lucene_Exception",71],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid archive or corrupted .docx file.'",71],")",";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$relations",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_STRING","Zend_Xml_Security",73],["T_DOUBLE_COLON","::",73],["T_STRING","scan",73],"(",["T_VARIABLE","$relationsXml",73],")",";",["T_WHITESPACE","\n        ",73],["T_FOREACH","foreach",74],"(",["T_VARIABLE","$relations",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","Relationship",74],["T_WHITESPACE"," ",74],["T_AS","as",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$rel",74],")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(",["T_VARIABLE","$rel",75],["T_WHITESPACE"," ",75],"[",["T_CONSTANT_ENCAPSED_STRING","\"Type\"",75],"]",["T_WHITESPACE"," ",75],["T_IS_EQUAL","==",75],["T_WHITESPACE"," ",75],["T_STRING","Zend_Search_Lucene_Document_OpenXml",75],["T_DOUBLE_COLON","::",75],["T_STRING","SCHEMA_OFFICEDOCUMENT",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n                ",75],["T_COMMENT","\/\/ Found office document! Read in contents...\n",76],["T_WHITESPACE","                ",77],["T_VARIABLE","$contents",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","Zend_Xml_Security",77],["T_DOUBLE_COLON","::",77],["T_STRING","scan",77],"(",["T_VARIABLE","$package",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getFromName",77],"(",["T_WHITESPACE","\n                                                                ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","absoluteZipPath",78],"(",["T_STRING","dirname",78],"(",["T_VARIABLE","$rel",78],"[",["T_CONSTANT_ENCAPSED_STRING","'Target'",78],"]",")",["T_WHITESPACE","\n                                                              ",78],".",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'\/'",79],["T_WHITESPACE","\n                                                              ",79],".",["T_WHITESPACE"," ",80],["T_STRING","basename",80],"(",["T_VARIABLE","$rel",80],"[",["T_CONSTANT_ENCAPSED_STRING","'Target'",80],"]",")",")",["T_WHITESPACE","\n                                                                       ",80],")",")",";",["T_WHITESPACE","\n\n                ",81],["T_VARIABLE","$contents",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","registerXPathNamespace",83],"(",["T_CONSTANT_ENCAPSED_STRING","'w'",83],",",["T_WHITESPACE"," ",83],["T_STRING","Zend_Search_Lucene_Document_Docx",83],["T_DOUBLE_COLON","::",83],["T_STRING","SCHEMA_WORDPROCESSINGML",83],")",";",["T_WHITESPACE","\n                ",83],["T_VARIABLE","$paragraphs",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$contents",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","xpath",84],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/w:body\/w:p'",84],")",";",["T_WHITESPACE","\n\n                ",84],["T_FOREACH","foreach",86],["T_WHITESPACE"," ",86],"(",["T_VARIABLE","$paragraphs",86],["T_WHITESPACE"," ",86],["T_AS","as",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$paragraph",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n                    ",86],["T_VARIABLE","$runs",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$paragraph",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","xpath",87],"(",["T_CONSTANT_ENCAPSED_STRING","'.\/\/w:r\/*[name() = \"w:t\" or name() = \"w:br\"]'",87],")",";",["T_WHITESPACE","\n\n                    ",87],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$runs",89],["T_WHITESPACE"," ",89],["T_IS_IDENTICAL","===",89],["T_WHITESPACE"," ",89],["T_STRING","false",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n                        ",89],["T_COMMENT","\/\/ Paragraph doesn't contain any text or breaks\n",90],["T_WHITESPACE","                        ",91],["T_CONTINUE","continue",91],";",["T_WHITESPACE","\n                    ",91],"}",["T_WHITESPACE","\n\n                    ",92],["T_FOREACH","foreach",94],["T_WHITESPACE"," ",94],"(",["T_VARIABLE","$runs",94],["T_WHITESPACE"," ",94],["T_AS","as",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$run",94],")",["T_WHITESPACE"," ",94],"{",["T_WHITESPACE","\n                     ",94],["T_IF","if",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$run",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getName",95],"(",")",["T_WHITESPACE"," ",95],["T_IS_EQUAL","==",95],["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'br'",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n                         ",95],["T_COMMENT","\/\/ Break element\n",96],["T_WHITESPACE","                         ",97],["T_VARIABLE","$documentBody",97],"[","]",["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","' '",97],";",["T_WHITESPACE","\n                     ",97],"}",["T_WHITESPACE"," ",98],["T_ELSE","else",98],["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                         ",98],["T_VARIABLE","$documentBody",99],"[","]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING_CAST","(string)",99],["T_VARIABLE","$run",99],";",["T_WHITESPACE","\n                     ",99],"}",["T_WHITESPACE","\n                    ",100],"}",["T_WHITESPACE","\n\n                    ",101],["T_COMMENT","\/\/ Add space after each paragraph. So they are not bound together.\n",103],["T_WHITESPACE","                    ",104],["T_VARIABLE","$documentBody",104],"[","]",["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","' '",104],";",["T_WHITESPACE","\n                ",104],"}",["T_WHITESPACE","\n\n                ",105],["T_BREAK","break",107],";",["T_WHITESPACE","\n            ",107],"}",["T_WHITESPACE","\n        ",108],"}",["T_WHITESPACE","\n\n        ",109],["T_COMMENT","\/\/ Read core properties\n",111],["T_WHITESPACE","        ",112],["T_VARIABLE","$coreProperties",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","extractMetaData",112],"(",["T_VARIABLE","$package",112],")",";",["T_WHITESPACE","\n\n        ",112],["T_COMMENT","\/\/ Close file\n",114],["T_WHITESPACE","        ",115],["T_VARIABLE","$package",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","close",115],"(",")",";",["T_WHITESPACE","\n\n        ",115],["T_COMMENT","\/\/ Store filename\n",117],["T_WHITESPACE","        ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","addField",118],"(",["T_STRING","Zend_Search_Lucene_Field",118],["T_DOUBLE_COLON","::",118],["T_STRING","Text",118],"(",["T_CONSTANT_ENCAPSED_STRING","'filename'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$fileName",118],",",["T_WHITESPACE"," ",118],["T_CONSTANT_ENCAPSED_STRING","'UTF-8'",118],")",")",";",["T_WHITESPACE","\n\n        ",118],["T_COMMENT","\/\/ Store contents\n",120],["T_WHITESPACE","        ",121],["T_IF","if",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$storeContent",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","addField",122],"(",["T_STRING","Zend_Search_Lucene_Field",122],["T_DOUBLE_COLON","::",122],["T_STRING","Text",122],"(",["T_CONSTANT_ENCAPSED_STRING","'body'",122],",",["T_WHITESPACE"," ",122],["T_STRING","implode",122],"(",["T_CONSTANT_ENCAPSED_STRING","''",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$documentBody",122],")",",",["T_WHITESPACE"," ",122],["T_CONSTANT_ENCAPSED_STRING","'UTF-8'",122],")",")",";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE"," ",123],["T_ELSE","else",123],["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","addField",124],"(",["T_STRING","Zend_Search_Lucene_Field",124],["T_DOUBLE_COLON","::",124],["T_STRING","UnStored",124],"(",["T_CONSTANT_ENCAPSED_STRING","'body'",124],",",["T_WHITESPACE"," ",124],["T_STRING","implode",124],"(",["T_CONSTANT_ENCAPSED_STRING","''",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$documentBody",124],")",",",["T_WHITESPACE"," ",124],["T_CONSTANT_ENCAPSED_STRING","'UTF-8'",124],")",")",";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n\n        ",125],["T_COMMENT","\/\/ Store meta data properties\n",127],["T_WHITESPACE","        ",128],["T_FOREACH","foreach",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$coreProperties",128],["T_WHITESPACE"," ",128],["T_AS","as",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$key",128],["T_WHITESPACE"," ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$value",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","addField",129],"(",["T_STRING","Zend_Search_Lucene_Field",129],["T_DOUBLE_COLON","::",129],["T_STRING","Text",129],"(",["T_VARIABLE","$key",129],",",["T_WHITESPACE"," ",129],["T_VARIABLE","$value",129],",",["T_WHITESPACE"," ",129],["T_CONSTANT_ENCAPSED_STRING","'UTF-8'",129],")",")",";",["T_WHITESPACE","\n        ",129],"}",["T_WHITESPACE","\n\n        ",130],["T_COMMENT","\/\/ Store title (if not present in meta data)\n",132],["T_WHITESPACE","        ",133],["T_IF","if",133],["T_WHITESPACE"," ",133],"(","!",["T_WHITESPACE"," ",133],["T_ISSET","isset",133],"(",["T_VARIABLE","$coreProperties",133],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",133],"]",")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","addField",134],"(",["T_STRING","Zend_Search_Lucene_Field",134],["T_DOUBLE_COLON","::",134],["T_STRING","Text",134],"(",["T_CONSTANT_ENCAPSED_STRING","'title'",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$fileName",134],",",["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","'UTF-8'",134],")",")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n    ",135],"}",["T_WHITESPACE","\n\n    ",136],["T_DOC_COMMENT","\/**\n     * Load Docx document from a file\n     *\n     * @param string  $fileName\n     * @param boolean $storeContent\n     * @return Zend_Search_Lucene_Document_Docx\n     * @throws Zend_Search_Lucene_Document_Exception\n     *\/",138],["T_WHITESPACE","\n    ",145],["T_PUBLIC","public",146],["T_WHITESPACE"," ",146],["T_STATIC","static",146],["T_WHITESPACE"," ",146],["T_FUNCTION","function",146],["T_WHITESPACE"," ",146],["T_STRING","loadDocxFile",146],"(",["T_VARIABLE","$fileName",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$storeContent",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","false",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n        ",146],["T_IF","if",147],["T_WHITESPACE"," ",147],"(","!",["T_STRING","is_readable",147],"(",["T_VARIABLE","$fileName",147],")",")",["T_WHITESPACE"," ",147],"{",["T_WHITESPACE","\n            ",147],["T_COMMENT","#require_once 'Zend\/Search\/Lucene\/Document\/Exception.php';\n",148],["T_WHITESPACE","            ",149],["T_THROW","throw",149],["T_WHITESPACE"," ",149],["T_NEW","new",149],["T_WHITESPACE"," ",149],["T_STRING","Zend_Search_Lucene_Document_Exception",149],"(",["T_CONSTANT_ENCAPSED_STRING","'Provided file \\''",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_VARIABLE","$fileName",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","'\\' is not readable.'",149],")",";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n\n        ",150],["T_RETURN","return",152],["T_WHITESPACE"," ",152],["T_NEW","new",152],["T_WHITESPACE"," ",152],["T_STRING","Zend_Search_Lucene_Document_Docx",152],"(",["T_VARIABLE","$fileName",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$storeContent",152],")",";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n",153],"}",["T_WHITESPACE","\n",154]]