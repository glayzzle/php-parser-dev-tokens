[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * LICENSE\n *\n * This source file is subject to the new BSD license that is bundled\n * with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/framework.zend.com\/license\/new-bsd\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@zend.com so we can send you a copy immediately.\n *\n * @category   Zend\n * @package    Zend_Cloud\n * @subpackage StorageService\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",2],["T_WHITESPACE","\n\n",18],["T_COMMENT","#require_once 'Zend\/Service\/Amazon\/S3.php';\n",20],["T_COMMENT","#require_once 'Zend\/Cloud\/StorageService\/Adapter.php';\n",21],["T_COMMENT","#require_once 'Zend\/Cloud\/StorageService\/Exception.php';\n",22],["T_WHITESPACE","\n",23],["T_DOC_COMMENT","\/**\n * S3 adapter for unstructured cloud storage.\n *\n * @category   Zend\n * @package    Zend_Cloud\n * @subpackage StorageService\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",24],["T_WHITESPACE","\n",32],["T_CLASS","class",33],["T_WHITESPACE"," ",33],["T_STRING","Zend_Cloud_StorageService_Adapter_S3",33],["T_WHITESPACE","\n    ",33],["T_IMPLEMENTS","implements",34],["T_WHITESPACE"," ",34],["T_STRING","Zend_Cloud_StorageService_Adapter",34],["T_WHITESPACE","\n",34],"{",["T_WHITESPACE","\n    ",35],["T_COMMENT","\/*\n     * Options array keys for the S3 adapter.\n     *\/",36],["T_WHITESPACE","\n    ",38],["T_CONST","const",39],["T_WHITESPACE"," ",39],["T_STRING","BUCKET_NAME",39],["T_WHITESPACE","      ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'bucket_name'",39],";",["T_WHITESPACE","\n    ",39],["T_CONST","const",40],["T_WHITESPACE"," ",40],["T_STRING","BUCKET_AS_DOMAIN",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'bucket_as_domain?'",40],";",["T_WHITESPACE","\n    ",40],["T_CONST","const",41],["T_WHITESPACE"," ",41],["T_STRING","FETCH_STREAM",41],["T_WHITESPACE","     ",41],"=",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'fetch_stream'",41],";",["T_WHITESPACE","\n    ",41],["T_CONST","const",42],["T_WHITESPACE"," ",42],["T_STRING","METADATA",42],["T_WHITESPACE","         ",42],"=",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'metadata'",42],";",["T_WHITESPACE","\n\n    ",42],["T_DOC_COMMENT","\/**\n     * AWS constants\n     *\/",44],["T_WHITESPACE","\n    ",46],["T_CONST","const",47],["T_WHITESPACE"," ",47],["T_STRING","AWS_ACCESS_KEY",47],["T_WHITESPACE","   ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'aws_accesskey'",47],";",["T_WHITESPACE","\n    ",47],["T_CONST","const",48],["T_WHITESPACE"," ",48],["T_STRING","AWS_SECRET_KEY",48],["T_WHITESPACE","   ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'aws_secretkey'",48],";",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * S3 service instance.\n     * @var Zend_Service_Amazon_S3\n     *\/",50],["T_WHITESPACE","\n    ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$_s3",54],";",["T_WHITESPACE","\n    ",54],["T_PROTECTED","protected",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$_defaultBucketName",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","null",55],";",["T_WHITESPACE","\n    ",55],["T_PROTECTED","protected",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$_defaultBucketAsDomain",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","false",56],";",["T_WHITESPACE","\n\n    ",56],["T_DOC_COMMENT","\/**\n     * Constructor\n     *\n     * @param  array|Zend_Config $options\n     * @return void\n     *\/",58],["T_WHITESPACE","\n    ",63],["T_PUBLIC","public",64],["T_WHITESPACE"," ",64],["T_FUNCTION","function",64],["T_WHITESPACE"," ",64],["T_STRING","__construct",64],"(",["T_VARIABLE","$options",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_ARRAY","array",64],"(",")",")",["T_WHITESPACE","\n    ",64],"{",["T_WHITESPACE","\n        ",65],["T_IF","if",66],["T_WHITESPACE"," ",66],"(",["T_VARIABLE","$options",66],["T_WHITESPACE"," ",66],["T_INSTANCEOF","instanceof",66],["T_WHITESPACE"," ",66],["T_STRING","Zend_Config",66],")",["T_WHITESPACE"," ",66],"{",["T_WHITESPACE","\n            ",66],["T_VARIABLE","$options",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$options",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","toArray",67],"(",")",";",["T_WHITESPACE","\n        ",67],"}",["T_WHITESPACE","\n\n        ",68],["T_IF","if",70],["T_WHITESPACE"," ",70],"(","!",["T_STRING","is_array",70],"(",["T_VARIABLE","$options",70],")",")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n            ",70],["T_THROW","throw",71],["T_WHITESPACE"," ",71],["T_NEW","new",71],["T_WHITESPACE"," ",71],["T_STRING","Zend_Cloud_StorageService_Exception",71],"(",["T_CONSTANT_ENCAPSED_STRING","'Invalid options provided'",71],")",";",["T_WHITESPACE","\n        ",71],"}",["T_WHITESPACE","\n\n        ",72],["T_IF","if",74],["T_WHITESPACE"," ",74],"(","!",["T_ISSET","isset",74],"(",["T_VARIABLE","$options",74],"[",["T_STRING","self",74],["T_DOUBLE_COLON","::",74],["T_STRING","AWS_ACCESS_KEY",74],"]",")",["T_WHITESPACE"," ",74],["T_BOOLEAN_OR","||",74],["T_WHITESPACE"," ",74],"!",["T_ISSET","isset",74],"(",["T_VARIABLE","$options",74],"[",["T_STRING","self",74],["T_DOUBLE_COLON","::",74],["T_STRING","AWS_SECRET_KEY",74],"]",")",")",["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n            ",74],["T_THROW","throw",75],["T_WHITESPACE"," ",75],["T_NEW","new",75],["T_WHITESPACE"," ",75],["T_STRING","Zend_Cloud_StorageService_Exception",75],"(",["T_CONSTANT_ENCAPSED_STRING","'AWS keys not specified!'",75],")",";",["T_WHITESPACE","\n        ",75],"}",["T_WHITESPACE","\n\n        ",76],["T_TRY","try",78],["T_WHITESPACE"," ",78],"{",["T_WHITESPACE","\n            ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","_s3",79],["T_WHITESPACE"," ",79],"=",["T_WHITESPACE"," ",79],["T_NEW","new",79],["T_WHITESPACE"," ",79],["T_STRING","Zend_Service_Amazon_S3",79],"(",["T_VARIABLE","$options",79],"[",["T_STRING","self",79],["T_DOUBLE_COLON","::",79],["T_STRING","AWS_ACCESS_KEY",79],"]",",",["T_WHITESPACE","\n                                                ",79],["T_VARIABLE","$options",80],"[",["T_STRING","self",80],["T_DOUBLE_COLON","::",80],["T_STRING","AWS_SECRET_KEY",80],"]",")",";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE"," ",81],["T_CATCH","catch",81],["T_WHITESPACE"," ",81],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",81],["T_WHITESPACE","  ",81],["T_VARIABLE","$e",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_THROW","throw",82],["T_WHITESPACE"," ",82],["T_NEW","new",82],["T_WHITESPACE"," ",82],["T_STRING","Zend_Cloud_StorageService_Exception",82],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on create: '",82],".",["T_VARIABLE","$e",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getMessage",82],"(",")",",",["T_WHITESPACE"," ",82],["T_VARIABLE","$e",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","getCode",82],"(",")",",",["T_WHITESPACE"," ",82],["T_VARIABLE","$e",82],")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE","\n\n        ",83],["T_IF","if",85],["T_WHITESPACE"," ",85],"(",["T_ISSET","isset",85],"(",["T_VARIABLE","$options",85],"[",["T_STRING","self",85],["T_DOUBLE_COLON","::",85],["T_STRING","HTTP_ADAPTER",85],"]",")",")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","_s3",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getHttpClient",86],"(",")",["T_OBJECT_OPERATOR","->",86],["T_STRING","setAdapter",86],"(",["T_VARIABLE","$options",86],"[",["T_STRING","self",86],["T_DOUBLE_COLON","::",86],["T_STRING","HTTP_ADAPTER",86],"]",")",";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n\n        ",87],["T_IF","if",89],["T_WHITESPACE"," ",89],"(",["T_ISSET","isset",89],"(",["T_VARIABLE","$options",89],"[",["T_STRING","self",89],["T_DOUBLE_COLON","::",89],["T_STRING","BUCKET_NAME",89],"]",")",")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","_defaultBucketName",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$options",90],"[",["T_STRING","self",90],["T_DOUBLE_COLON","::",90],["T_STRING","BUCKET_NAME",90],"]",";",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n\n        ",91],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_ISSET","isset",93],"(",["T_VARIABLE","$options",93],"[",["T_STRING","self",93],["T_DOUBLE_COLON","::",93],["T_STRING","BUCKET_AS_DOMAIN",93],"]",")",")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","_defaultBucketAsDomain",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$options",94],"[",["T_STRING","self",94],["T_DOUBLE_COLON","::",94],["T_STRING","BUCKET_AS_DOMAIN",94],"]",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Get an item from the storage service.\n     *\n     * @TODO Support streams\n     *\n     * @param  string $path\n     * @param  array $options\n     * @return string\n     *\/",98],["T_WHITESPACE","\n    ",106],["T_PUBLIC","public",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","fetchItem",107],"(",["T_VARIABLE","$path",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$options",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_ARRAY","array",107],"(",")",")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$fullPath",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$this",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","_getFullPath",109],"(",["T_VARIABLE","$path",109],",",["T_WHITESPACE"," ",109],["T_VARIABLE","$options",109],")",";",["T_WHITESPACE","\n        ",109],["T_TRY","try",110],["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n            ",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(","!",["T_EMPTY","empty",111],"(",["T_VARIABLE","$options",111],"[",["T_STRING","self",111],["T_DOUBLE_COLON","::",111],["T_STRING","FETCH_STREAM",111],"]",")",")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n                ",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_VARIABLE","$this",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","_s3",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","getObjectStream",112],"(",["T_VARIABLE","$fullPath",112],",",["T_WHITESPACE"," ",112],["T_VARIABLE","$options",112],"[",["T_STRING","self",112],["T_DOUBLE_COLON","::",112],["T_STRING","FETCH_STREAM",112],"]",")",";",["T_WHITESPACE","\n            ",112],"}",["T_WHITESPACE"," ",113],["T_ELSE","else",113],["T_WHITESPACE"," ",113],"{",["T_WHITESPACE","\n                ",113],["T_RETURN","return",114],["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","_s3",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getObject",114],"(",["T_VARIABLE","$fullPath",114],")",";",["T_WHITESPACE","\n            ",114],"}",["T_WHITESPACE","\n        ",115],"}",["T_WHITESPACE"," ",116],["T_CATCH","catch",116],["T_WHITESPACE"," ",116],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",116],["T_WHITESPACE","  ",116],["T_VARIABLE","$e",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_THROW","throw",117],["T_WHITESPACE"," ",117],["T_NEW","new",117],["T_WHITESPACE"," ",117],["T_STRING","Zend_Cloud_StorageService_Exception",117],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on fetch: '",117],".",["T_VARIABLE","$e",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getMessage",117],"(",")",",",["T_WHITESPACE"," ",117],["T_VARIABLE","$e",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getCode",117],"(",")",",",["T_WHITESPACE"," ",117],["T_VARIABLE","$e",117],")",";",["T_WHITESPACE","\n        ",117],"}",["T_WHITESPACE","\n    ",118],"}",["T_WHITESPACE","\n\n    ",119],["T_DOC_COMMENT","\/**\n     * Store an item in the storage service.\n     *\n     * WARNING: This operation overwrites any item that is located at\n     * $destinationPath.\n     *\n     * @TODO Support streams\n     *\n     * @param string $destinationPath\n     * @param string|resource $data\n     * @param  array $options\n     * @return void\n     *\/",121],["T_WHITESPACE","\n    ",133],["T_PUBLIC","public",134],["T_WHITESPACE"," ",134],["T_FUNCTION","function",134],["T_WHITESPACE"," ",134],["T_STRING","storeItem",134],"(",["T_VARIABLE","$destinationPath",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$data",134],",",["T_WHITESPACE"," ",134],["T_VARIABLE","$options",134],["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_ARRAY","array",134],"(",")",")",["T_WHITESPACE","\n    ",134],"{",["T_WHITESPACE","\n        ",135],["T_TRY","try",136],["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n            ",136],["T_VARIABLE","$fullPath",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","_getFullPath",137],"(",["T_VARIABLE","$destinationPath",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$options",137],")",";",["T_WHITESPACE","\n            ",137],["T_RETURN","return",138],["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","_s3",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","putObject",138],"(",["T_WHITESPACE","\n                ",138],["T_VARIABLE","$fullPath",139],",",["T_WHITESPACE","\n                ",139],["T_VARIABLE","$data",140],",",["T_WHITESPACE","\n                ",140],["T_EMPTY","empty",141],"(",["T_VARIABLE","$options",141],"[",["T_STRING","self",141],["T_DOUBLE_COLON","::",141],["T_STRING","METADATA",141],"]",")",["T_WHITESPACE"," ",141],"?",["T_WHITESPACE"," ",141],["T_STRING","null",141],["T_WHITESPACE"," ",141],":",["T_WHITESPACE"," ",141],["T_VARIABLE","$options",141],"[",["T_STRING","self",141],["T_DOUBLE_COLON","::",141],["T_STRING","METADATA",141],"]",["T_WHITESPACE","\n            ",141],")",";",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE"," ",143],["T_CATCH","catch",143],["T_WHITESPACE"," ",143],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",143],["T_WHITESPACE","  ",143],["T_VARIABLE","$e",143],")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n            ",143],["T_THROW","throw",144],["T_WHITESPACE"," ",144],["T_NEW","new",144],["T_WHITESPACE"," ",144],["T_STRING","Zend_Cloud_StorageService_Exception",144],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on store: '",144],".",["T_VARIABLE","$e",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getMessage",144],"(",")",",",["T_WHITESPACE"," ",144],["T_VARIABLE","$e",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getCode",144],"(",")",",",["T_WHITESPACE"," ",144],["T_VARIABLE","$e",144],")",";",["T_WHITESPACE","\n        ",144],"}",["T_WHITESPACE","\n    ",145],"}",["T_WHITESPACE","\n\n    ",146],["T_DOC_COMMENT","\/**\n     * Delete an item in the storage service.\n     *\n     * @param  string $path\n     * @param  array $options\n     * @return void\n     *\/",148],["T_WHITESPACE","\n    ",154],["T_PUBLIC","public",155],["T_WHITESPACE"," ",155],["T_FUNCTION","function",155],["T_WHITESPACE"," ",155],["T_STRING","deleteItem",155],"(",["T_VARIABLE","$path",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$options",155],["T_WHITESPACE"," ",155],"=",["T_WHITESPACE"," ",155],["T_ARRAY","array",155],"(",")",")",["T_WHITESPACE","\n    ",155],"{",["T_WHITESPACE","\n        ",156],["T_TRY","try",157],["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_s3",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","removeObject",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","_getFullPath",158],"(",["T_VARIABLE","$path",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$options",158],")",")",";",["T_WHITESPACE","\n        ",158],"}",["T_WHITESPACE"," ",159],["T_CATCH","catch",159],["T_WHITESPACE"," ",159],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",159],["T_WHITESPACE","  ",159],["T_VARIABLE","$e",159],")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n            ",159],["T_THROW","throw",160],["T_WHITESPACE"," ",160],["T_NEW","new",160],["T_WHITESPACE"," ",160],["T_STRING","Zend_Cloud_StorageService_Exception",160],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on delete: '",160],".",["T_VARIABLE","$e",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getMessage",160],"(",")",",",["T_WHITESPACE"," ",160],["T_VARIABLE","$e",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","getCode",160],"(",")",",",["T_WHITESPACE"," ",160],["T_VARIABLE","$e",160],")",";",["T_WHITESPACE","\n        ",160],"}",["T_WHITESPACE","\n    ",161],"}",["T_WHITESPACE","\n\n    ",162],["T_DOC_COMMENT","\/**\n     * Copy an item in the storage service to a given path.\n     *\n     * WARNING: This operation is *very* expensive for services that do not\n     * support copying an item natively.\n     *\n     * @TODO Support streams for those services that don't support natively\n     *\n     * @param  string $sourcePath\n     * @param  string $destination path\n     * @param  array $options\n     * @return void\n     *\/",164],["T_WHITESPACE","\n    ",176],["T_PUBLIC","public",177],["T_WHITESPACE"," ",177],["T_FUNCTION","function",177],["T_WHITESPACE"," ",177],["T_STRING","copyItem",177],"(",["T_VARIABLE","$sourcePath",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$destinationPath",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$options",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_ARRAY","array",177],"(",")",")",["T_WHITESPACE","\n    ",177],"{",["T_WHITESPACE","\n        ",178],["T_TRY","try",179],["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n            ",179],["T_VARIABLE","$fullSourcePath",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$this",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","_getFullPath",180],"(",["T_VARIABLE","$sourcePath",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$options",180],")",";",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$fullDestPath",181],["T_WHITESPACE","   ",181],"=",["T_WHITESPACE"," ",181],["T_VARIABLE","$this",181],["T_OBJECT_OPERATOR","->",181],["T_STRING","_getFullPath",181],"(",["T_VARIABLE","$destinationPath",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$options",181],")",";",["T_WHITESPACE","\n            ",181],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","_s3",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","copyObject",182],"(",["T_WHITESPACE","\n                ",182],["T_VARIABLE","$fullSourcePath",183],",",["T_WHITESPACE","\n                ",183],["T_VARIABLE","$fullDestPath",184],",",["T_WHITESPACE","\n                ",184],["T_EMPTY","empty",185],"(",["T_VARIABLE","$options",185],"[",["T_STRING","self",185],["T_DOUBLE_COLON","::",185],["T_STRING","METADATA",185],"]",")",["T_WHITESPACE"," ",185],"?",["T_WHITESPACE"," ",185],["T_STRING","null",185],["T_WHITESPACE"," ",185],":",["T_WHITESPACE"," ",185],["T_VARIABLE","$options",185],"[",["T_STRING","self",185],["T_DOUBLE_COLON","::",185],["T_STRING","METADATA",185],"]",["T_WHITESPACE","\n            ",185],")",";",["T_WHITESPACE","\n\n        ",186],"}",["T_WHITESPACE"," ",188],["T_CATCH","catch",188],["T_WHITESPACE"," ",188],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",188],["T_WHITESPACE","  ",188],["T_VARIABLE","$e",188],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n            ",188],["T_THROW","throw",189],["T_WHITESPACE"," ",189],["T_NEW","new",189],["T_WHITESPACE"," ",189],["T_STRING","Zend_Cloud_StorageService_Exception",189],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on copy: '",189],".",["T_VARIABLE","$e",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getMessage",189],"(",")",",",["T_WHITESPACE"," ",189],["T_VARIABLE","$e",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getCode",189],"(",")",",",["T_WHITESPACE"," ",189],["T_VARIABLE","$e",189],")",";",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n    ",190],"}",["T_WHITESPACE","\n\n    ",191],["T_DOC_COMMENT","\/**\n     * Move an item in the storage service to a given path.\n     *\n     * @TODO Support streams for those services that don't support natively\n     *\n     * @param  string $sourcePath\n     * @param  string $destination path\n     * @param  array $options\n     * @return void\n     *\/",193],["T_WHITESPACE","\n    ",202],["T_PUBLIC","public",203],["T_WHITESPACE"," ",203],["T_FUNCTION","function",203],["T_WHITESPACE"," ",203],["T_STRING","moveItem",203],"(",["T_VARIABLE","$sourcePath",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$destinationPath",203],",",["T_WHITESPACE"," ",203],["T_VARIABLE","$options",203],["T_WHITESPACE"," ",203],"=",["T_WHITESPACE"," ",203],["T_ARRAY","array",203],"(",")",")",["T_WHITESPACE","\n    ",203],"{",["T_WHITESPACE","\n        ",204],["T_TRY","try",205],["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$fullSourcePath",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$this",206],["T_OBJECT_OPERATOR","->",206],["T_STRING","_getFullPath",206],"(",["T_VARIABLE","$sourcePath",206],",",["T_WHITESPACE"," ",206],["T_VARIABLE","$options",206],")",";",["T_WHITESPACE","\n            ",206],["T_VARIABLE","$fullDestPath",207],["T_WHITESPACE","   ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$this",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","_getFullPath",207],"(",["T_VARIABLE","$destinationPath",207],",",["T_WHITESPACE"," ",207],["T_VARIABLE","$options",207],")",";",["T_WHITESPACE","\n            ",207],["T_RETURN","return",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","_s3",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","moveObject",208],"(",["T_WHITESPACE","\n                ",208],["T_VARIABLE","$fullSourcePath",209],",",["T_WHITESPACE","\n                ",209],["T_VARIABLE","$fullDestPath",210],",",["T_WHITESPACE","\n                ",210],["T_EMPTY","empty",211],"(",["T_VARIABLE","$options",211],"[",["T_STRING","self",211],["T_DOUBLE_COLON","::",211],["T_STRING","METADATA",211],"]",")",["T_WHITESPACE"," ",211],"?",["T_WHITESPACE"," ",211],["T_STRING","null",211],["T_WHITESPACE"," ",211],":",["T_WHITESPACE"," ",211],["T_VARIABLE","$options",211],"[",["T_STRING","self",211],["T_DOUBLE_COLON","::",211],["T_STRING","METADATA",211],"]",["T_WHITESPACE","\n            ",211],")",";",["T_WHITESPACE","\n        ",212],"}",["T_WHITESPACE"," ",213],["T_CATCH","catch",213],["T_WHITESPACE"," ",213],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",213],["T_WHITESPACE","  ",213],["T_VARIABLE","$e",213],")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_THROW","throw",214],["T_WHITESPACE"," ",214],["T_NEW","new",214],["T_WHITESPACE"," ",214],["T_STRING","Zend_Cloud_StorageService_Exception",214],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on move: '",214],".",["T_VARIABLE","$e",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getMessage",214],"(",")",",",["T_WHITESPACE"," ",214],["T_VARIABLE","$e",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getCode",214],"(",")",",",["T_WHITESPACE"," ",214],["T_VARIABLE","$e",214],")",";",["T_WHITESPACE","\n        ",214],"}",["T_WHITESPACE","\n     ",215],"}",["T_WHITESPACE","\n\n    ",216],["T_DOC_COMMENT","\/**\n     * Rename an item in the storage service to a given name.\n     *\n     *\n     * @param  string $path\n     * @param  string $name\n     * @param  array $options\n     * @return void\n     *\/",218],["T_WHITESPACE","\n    ",226],["T_PUBLIC","public",227],["T_WHITESPACE"," ",227],["T_FUNCTION","function",227],["T_WHITESPACE"," ",227],["T_STRING","renameItem",227],"(",["T_VARIABLE","$path",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$name",227],",",["T_WHITESPACE"," ",227],["T_VARIABLE","$options",227],["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_STRING","null",227],")",["T_WHITESPACE","\n    ",227],"{",["T_WHITESPACE","\n        ",228],["T_COMMENT","#require_once 'Zend\/Cloud\/OperationNotAvailableException.php';\n",229],["T_WHITESPACE","        ",230],["T_THROW","throw",230],["T_WHITESPACE"," ",230],["T_NEW","new",230],["T_WHITESPACE"," ",230],["T_STRING","Zend_Cloud_OperationNotAvailableException",230],"(",["T_CONSTANT_ENCAPSED_STRING","'Rename not implemented'",230],")",";",["T_WHITESPACE","\n    ",230],"}",["T_WHITESPACE","\n\n    ",231],["T_DOC_COMMENT","\/**\n     * List items in the given directory in the storage service\n     *\n     * The $path must be a directory\n     *\n     *\n     * @param  string $path Must be a directory\n     * @param  array $options\n     * @return array A list of item names\n     *\/",233],["T_WHITESPACE","\n    ",242],["T_PUBLIC","public",243],["T_WHITESPACE"," ",243],["T_FUNCTION","function",243],["T_WHITESPACE"," ",243],["T_STRING","listItems",243],"(",["T_VARIABLE","$path",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$options",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_STRING","null",243],")",["T_WHITESPACE","\n    ",243],"{",["T_WHITESPACE","\n        ",244],["T_TRY","try",245],["T_WHITESPACE"," ",245],"{",["T_WHITESPACE","\n            ",245],["T_COMMENT","\/\/ TODO Support 'prefix' parameter for Zend_Service_Amazon_S3::getObjectsByBucket()\n",246],["T_WHITESPACE","            ",247],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_s3",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","getObjectsByBucket",247],"(",["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","_defaultBucketName",247],")",";",["T_WHITESPACE","\n        ",247],"}",["T_WHITESPACE"," ",248],["T_CATCH","catch",248],["T_WHITESPACE"," ",248],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",248],["T_WHITESPACE","  ",248],["T_VARIABLE","$e",248],")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n            ",248],["T_THROW","throw",249],["T_WHITESPACE"," ",249],["T_NEW","new",249],["T_WHITESPACE"," ",249],["T_STRING","Zend_Cloud_StorageService_Exception",249],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on list: '",249],".",["T_VARIABLE","$e",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getMessage",249],"(",")",",",["T_WHITESPACE"," ",249],["T_VARIABLE","$e",249],["T_OBJECT_OPERATOR","->",249],["T_STRING","getCode",249],"(",")",",",["T_WHITESPACE"," ",249],["T_VARIABLE","$e",249],")",";",["T_WHITESPACE","\n        ",249],"}",["T_WHITESPACE","\n    ",250],"}",["T_WHITESPACE","\n\n    ",251],["T_DOC_COMMENT","\/**\n     * Get a key\/value array of metadata for the given path.\n     *\n     * @param  string $path\n     * @param  array $options\n     * @return array\n     *\/",253],["T_WHITESPACE","\n    ",259],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","fetchMetadata",260],"(",["T_VARIABLE","$path",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$options",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_ARRAY","array",260],"(",")",")",["T_WHITESPACE","\n    ",260],"{",["T_WHITESPACE","\n        ",261],["T_TRY","try",262],["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n            ",262],["T_RETURN","return",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_s3",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","getInfo",263],"(",["T_VARIABLE","$this",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","_getFullPath",263],"(",["T_VARIABLE","$path",263],",",["T_WHITESPACE"," ",263],["T_VARIABLE","$options",263],")",")",";",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE"," ",264],["T_CATCH","catch",264],["T_WHITESPACE"," ",264],"(",["T_STRING","Zend_Service_Amazon_S3_Exception",264],["T_WHITESPACE","  ",264],["T_VARIABLE","$e",264],")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n            ",264],["T_THROW","throw",265],["T_WHITESPACE"," ",265],["T_NEW","new",265],["T_WHITESPACE"," ",265],["T_STRING","Zend_Cloud_StorageService_Exception",265],"(",["T_CONSTANT_ENCAPSED_STRING","'Error on fetch: '",265],".",["T_VARIABLE","$e",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getMessage",265],"(",")",",",["T_WHITESPACE"," ",265],["T_VARIABLE","$e",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","getCode",265],"(",")",",",["T_WHITESPACE"," ",265],["T_VARIABLE","$e",265],")",";",["T_WHITESPACE","\n        ",265],"}",["T_WHITESPACE","\n    ",266],"}",["T_WHITESPACE","\n\n    ",267],["T_DOC_COMMENT","\/**\n     * Store a key\/value array of metadata at the given path.\n     * WARNING: This operation overwrites any metadata that is located at\n     * $destinationPath.\n     *\n     * @param  string $destinationPath\n     * @param  array $options\n     * @return void\n     *\/",269],["T_WHITESPACE","\n    ",277],["T_PUBLIC","public",278],["T_WHITESPACE"," ",278],["T_FUNCTION","function",278],["T_WHITESPACE"," ",278],["T_STRING","storeMetadata",278],"(",["T_VARIABLE","$destinationPath",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$metadata",278],",",["T_WHITESPACE"," ",278],["T_VARIABLE","$options",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_ARRAY","array",278],"(",")",")",["T_WHITESPACE","\n    ",278],"{",["T_WHITESPACE","\n        ",279],["T_COMMENT","#require_once 'Zend\/Cloud\/OperationNotAvailableException.php';\n",280],["T_WHITESPACE","        ",281],["T_THROW","throw",281],["T_WHITESPACE"," ",281],["T_NEW","new",281],["T_WHITESPACE"," ",281],["T_STRING","Zend_Cloud_OperationNotAvailableException",281],"(",["T_CONSTANT_ENCAPSED_STRING","'Storing separate metadata is not supported, use storeItem() with \\'metadata\\' option key'",281],")",";",["T_WHITESPACE","\n    ",281],"}",["T_WHITESPACE","\n\n    ",282],["T_DOC_COMMENT","\/**\n     * Delete a key\/value array of metadata at the given path.\n     *\n     * @param  string $path\n     * @param  array $options\n     * @return void\n     *\/",284],["T_WHITESPACE","\n    ",290],["T_PUBLIC","public",291],["T_WHITESPACE"," ",291],["T_FUNCTION","function",291],["T_WHITESPACE"," ",291],["T_STRING","deleteMetadata",291],"(",["T_VARIABLE","$path",291],")",["T_WHITESPACE","\n    ",291],"{",["T_WHITESPACE","\n        ",292],["T_COMMENT","#require_once 'Zend\/Cloud\/OperationNotAvailableException.php';\n",293],["T_WHITESPACE","        ",294],["T_THROW","throw",294],["T_WHITESPACE"," ",294],["T_NEW","new",294],["T_WHITESPACE"," ",294],["T_STRING","Zend_Cloud_OperationNotAvailableException",294],"(",["T_CONSTANT_ENCAPSED_STRING","'Deleting metadata not supported'",294],")",";",["T_WHITESPACE","\n    ",294],"}",["T_WHITESPACE","\n\n    ",295],["T_DOC_COMMENT","\/**\n     * Get full path, including bucket, for an object\n     *\n     * @param  string $path\n     * @param  array $options\n     * @return void\n     *\/",297],["T_WHITESPACE","\n    ",303],["T_PROTECTED","protected",304],["T_WHITESPACE"," ",304],["T_FUNCTION","function",304],["T_WHITESPACE"," ",304],["T_STRING","_getFullPath",304],"(",["T_VARIABLE","$path",304],",",["T_WHITESPACE"," ",304],["T_VARIABLE","$options",304],")",["T_WHITESPACE","\n    ",304],"{",["T_WHITESPACE","\n        ",305],["T_IF","if",306],["T_WHITESPACE"," ",306],"(",["T_ISSET","isset",306],"(",["T_VARIABLE","$options",306],"[",["T_STRING","self",306],["T_DOUBLE_COLON","::",306],["T_STRING","BUCKET_NAME",306],"]",")",")",["T_WHITESPACE"," ",306],"{",["T_WHITESPACE","\n            ",306],["T_VARIABLE","$bucket",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_VARIABLE","$options",307],"[",["T_STRING","self",307],["T_DOUBLE_COLON","::",307],["T_STRING","BUCKET_NAME",307],"]",";",["T_WHITESPACE","\n        ",307],"}",["T_WHITESPACE"," ",308],["T_ELSE","else",308],["T_WHITESPACE"," ",308],["T_IF","if",308],["T_WHITESPACE"," ",308],"(",["T_ISSET","isset",308],"(",["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","_defaultBucketName",308],")",")",["T_WHITESPACE"," ",308],"{",["T_WHITESPACE","\n            ",308],["T_VARIABLE","$bucket",309],["T_WHITESPACE"," ",309],"=",["T_WHITESPACE"," ",309],["T_VARIABLE","$this",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","_defaultBucketName",309],";",["T_WHITESPACE","\n        ",309],"}",["T_WHITESPACE"," ",310],["T_ELSE","else",310],["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_COMMENT","#require_once 'Zend\/Cloud\/StorageService\/Exception.php';\n",311],["T_WHITESPACE","            ",312],["T_THROW","throw",312],["T_WHITESPACE"," ",312],["T_NEW","new",312],["T_WHITESPACE"," ",312],["T_STRING","Zend_Cloud_StorageService_Exception",312],"(",["T_CONSTANT_ENCAPSED_STRING","'Bucket name must be specified for S3 adapter.'",312],")",";",["T_WHITESPACE","\n        ",312],"}",["T_WHITESPACE","\n\n        ",313],["T_IF","if",315],["T_WHITESPACE"," ",315],"(",["T_ISSET","isset",315],"(",["T_VARIABLE","$options",315],"[",["T_STRING","self",315],["T_DOUBLE_COLON","::",315],["T_STRING","BUCKET_AS_DOMAIN",315],"]",")",")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n            ",315],["T_COMMENT","\/\/ TODO: support bucket domain names\n",316],["T_WHITESPACE","            ",317],["T_COMMENT","#require_once 'Zend\/Cloud\/StorageService\/Exception.php';\n",317],["T_WHITESPACE","            ",318],["T_THROW","throw",318],["T_WHITESPACE"," ",318],["T_NEW","new",318],["T_WHITESPACE"," ",318],["T_STRING","Zend_Cloud_StorageService_Exception",318],"(",["T_CONSTANT_ENCAPSED_STRING","'The S3 adapter does not currently support buckets in domain names.'",318],")",";",["T_WHITESPACE","\n        ",318],"}",["T_WHITESPACE","\n\n        ",319],["T_RETURN","return",321],["T_WHITESPACE"," ",321],["T_STRING","trim",321],"(",["T_VARIABLE","$bucket",321],")",["T_WHITESPACE"," ",321],".",["T_WHITESPACE"," ",321],["T_CONSTANT_ENCAPSED_STRING","'\/'",321],["T_WHITESPACE"," ",321],".",["T_WHITESPACE"," ",321],["T_STRING","trim",321],"(",["T_VARIABLE","$path",321],")",";",["T_WHITESPACE","\n    ",321],"}",["T_WHITESPACE","\n\n    ",322],["T_DOC_COMMENT","\/**\n     * Get the concrete client.\n     * @return Zend_Service_Amazon_S3\n     *\/",324],["T_WHITESPACE","\n    ",327],["T_PUBLIC","public",328],["T_WHITESPACE"," ",328],["T_FUNCTION","function",328],["T_WHITESPACE"," ",328],["T_STRING","getClient",328],"(",")",["T_WHITESPACE","\n    ",328],"{",["T_WHITESPACE","\n         ",329],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","_s3",330],";",["T_WHITESPACE","\n    ",330],"}",["T_WHITESPACE","\n",331],"}",["T_WHITESPACE","\n",332]]