[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * LICENSE\n *\n * This source file is subject to the new BSD license that is bundled\n * with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/framework.zend.com\/license\/new-bsd\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@zend.com so we can send you a copy immediately.\n *\n * @category   Zend\n * @package    Zend_Cloud\n * @subpackage DocumentService\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",2],["T_WHITESPACE","\n\n",18],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Adapter.php';\n",20],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Instance.php';\n",21],["T_WHITESPACE","\n",22],["T_DOC_COMMENT","\/**\n * Abstract infrastructure service adapter\n *\n * @category   Zend\n * @package    Zend_Cloud_Infrastructure\n * @subpackage Adapter\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",23],["T_WHITESPACE","\n",31],["T_ABSTRACT","abstract",32],["T_WHITESPACE"," ",32],["T_CLASS","class",32],["T_WHITESPACE"," ",32],["T_STRING","Zend_Cloud_Infrastructure_Adapter_AbstractAdapter",32],["T_WHITESPACE"," ",32],["T_IMPLEMENTS","implements",32],["T_WHITESPACE"," ",32],["T_STRING","Zend_Cloud_Infrastructure_Adapter",32],["T_WHITESPACE","\n",32],"{",["T_WHITESPACE","\n    ",33],["T_DOC_COMMENT","\/**\n     * Store the last response from the adpter\n     * \n     * @var array\n     *\/",34],["T_WHITESPACE","\n    ",38],["T_PROTECTED","protected",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$adapterResult",39],";",["T_WHITESPACE","\n    \n    ",39],["T_DOC_COMMENT","\/**\n     * Valid metrics for monitor\n     * \n     * @var array\n     *\/",41],["T_WHITESPACE","\n    ",45],["T_PROTECTED","protected",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$validMetrics",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_ARRAY","array",46],"(",["T_WHITESPACE","\n        ",46],["T_STRING","Zend_Cloud_Infrastructure_Instance",47],["T_DOUBLE_COLON","::",47],["T_STRING","MONITOR_CPU",47],",",["T_WHITESPACE","\n        ",47],["T_STRING","Zend_Cloud_Infrastructure_Instance",48],["T_DOUBLE_COLON","::",48],["T_STRING","MONITOR_RAM",48],",",["T_WHITESPACE","\n        ",48],["T_STRING","Zend_Cloud_Infrastructure_Instance",49],["T_DOUBLE_COLON","::",49],["T_STRING","MONITOR_DISK",49],",",["T_WHITESPACE","\n        ",49],["T_STRING","Zend_Cloud_Infrastructure_Instance",50],["T_DOUBLE_COLON","::",50],["T_STRING","MONITOR_DISK_READ",50],",",["T_WHITESPACE","\n        ",50],["T_STRING","Zend_Cloud_Infrastructure_Instance",51],["T_DOUBLE_COLON","::",51],["T_STRING","MONITOR_DISK_WRITE",51],",",["T_WHITESPACE","\n        ",51],["T_STRING","Zend_Cloud_Infrastructure_Instance",52],["T_DOUBLE_COLON","::",52],["T_STRING","MONITOR_NETWORK_IN",52],",",["T_WHITESPACE","\n        ",52],["T_STRING","Zend_Cloud_Infrastructure_Instance",53],["T_DOUBLE_COLON","::",53],["T_STRING","MONITOR_NETWORK_OUT",53],",",["T_WHITESPACE","\n    ",53],")",";",["T_WHITESPACE","\n\n    ",54],["T_DOC_COMMENT","\/**\n     * Get the last result of the adapter\n     *\n     * @return array\n     *\/",56],["T_WHITESPACE","\n    ",60],["T_PUBLIC","public",61],["T_WHITESPACE"," ",61],["T_FUNCTION","function",61],["T_WHITESPACE"," ",61],["T_STRING","getAdapterResult",61],"(",")",["T_WHITESPACE","\n    ",61],"{",["T_WHITESPACE","\n        ",62],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","adapterResult",63],";",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n\n    ",64],["T_DOC_COMMENT","\/**\n     * Wait for status $status with a timeout of $timeout seconds\n     * \n     * @param  string $id\n     * @param  string $status\n     * @param  integer $timeout \n     * @return boolean\n     *\/",66],["T_WHITESPACE","\n    ",73],["T_PUBLIC","public",74],["T_WHITESPACE"," ",74],["T_FUNCTION","function",74],["T_WHITESPACE"," ",74],["T_STRING","waitStatusInstance",74],"(",["T_VARIABLE","$id",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$status",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$timeout",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_STRING","self",74],["T_DOUBLE_COLON","::",74],["T_STRING","TIMEOUT_STATUS_CHANGE",74],")",["T_WHITESPACE","\n    ",74],"{",["T_WHITESPACE","\n        ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_EMPTY","empty",76],"(",["T_VARIABLE","$id",76],")",["T_WHITESPACE"," ",76],["T_BOOLEAN_OR","||",76],["T_WHITESPACE"," ",76],["T_EMPTY","empty",76],"(",["T_VARIABLE","$status",76],")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","false",77],";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$num",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_LNUMBER","0",80],";",["T_WHITESPACE","\n        ",80],["T_WHILE","while",81],["T_WHITESPACE"," ",81],"(","(",["T_VARIABLE","$num",81],"<",["T_VARIABLE","$timeout",81],")",["T_WHITESPACE"," ",81],["T_BOOLEAN_AND","&&",81],["T_WHITESPACE"," ",81],"(",["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","statusInstance",81],"(",["T_VARIABLE","$id",81],")",["T_WHITESPACE"," ",81],["T_IS_NOT_EQUAL","!=",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$status",81],")",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n            ",81],["T_STRING","sleep",82],"(",["T_STRING","self",82],["T_DOUBLE_COLON","::",82],["T_STRING","TIME_STEP_STATUS_CHANGE",82],")",";",["T_WHITESPACE","\n            ",82],["T_VARIABLE","$num",83],["T_WHITESPACE"," ",83],["T_PLUS_EQUAL","+=",83],["T_WHITESPACE"," ",83],["T_STRING","self",83],["T_DOUBLE_COLON","::",83],["T_STRING","TIME_STEP_STATUS_CHANGE",83],";",["T_WHITESPACE","\n        ",83],"}",["T_WHITESPACE","\n        ",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],"(",["T_VARIABLE","$num",85],["T_WHITESPACE"," ",85],"<",["T_WHITESPACE"," ",85],["T_VARIABLE","$timeout",85],")",";",["T_WHITESPACE","\n    ",85],"}",["T_WHITESPACE","\n\n    ",86],["T_DOC_COMMENT","\/**\n     * Run arbitrary shell script on an instance\n     *\n     * @param  string $id\n     * @param  array $param\n     * @param  string|array $cmd\n     * @return string|array\n     *\/",88],["T_WHITESPACE"," \n    ",95],["T_PUBLIC","public",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","deployInstance",96],"(",["T_VARIABLE","$id",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$params",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$cmd",96],")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(","!",["T_STRING","function_exists",98],"(",["T_CONSTANT_ENCAPSED_STRING","\"ssh2_connect\"",98],")",")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n            ",98],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Exception.php';\n",99],["T_WHITESPACE","            ",100],["T_THROW","throw",100],["T_WHITESPACE"," ",100],["T_NEW","new",100],["T_WHITESPACE"," ",100],["T_STRING","Zend_Cloud_Infrastructure_Exception",100],"(",["T_CONSTANT_ENCAPSED_STRING","'Deployment requires the PHP \"SSH\" extension (ext\/ssh2)'",100],")",";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE","\n\n        ",101],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_EMPTY","empty",103],"(",["T_VARIABLE","$id",103],")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n            ",103],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Exception.php';\n",104],["T_WHITESPACE","            ",105],["T_THROW","throw",105],["T_WHITESPACE"," ",105],["T_NEW","new",105],["T_WHITESPACE"," ",105],["T_STRING","Zend_Cloud_Infrastructure_Exception",105],"(",["T_CONSTANT_ENCAPSED_STRING","'You must specify the instance where to deploy'",105],")",";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_IF","if",108],["T_WHITESPACE"," ",108],"(",["T_EMPTY","empty",108],"(",["T_VARIABLE","$cmd",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Exception.php';\n",109],["T_WHITESPACE","            ",110],["T_THROW","throw",110],["T_WHITESPACE"," ",110],["T_NEW","new",110],["T_WHITESPACE"," ",110],["T_STRING","Zend_Cloud_Infrastructure_Exception",110],"(",["T_CONSTANT_ENCAPSED_STRING","'You must specify the shell commands to run on the instance'",110],")",";",["T_WHITESPACE","\n        ",110],"}",["T_WHITESPACE","\n\n        ",111],["T_IF","if",113],["T_WHITESPACE"," ",113],"(",["T_EMPTY","empty",113],"(",["T_VARIABLE","$params",113],")",["T_WHITESPACE"," \n            ",113],["T_BOOLEAN_OR","||",114],["T_WHITESPACE"," ",114],["T_EMPTY","empty",114],"(",["T_VARIABLE","$params",114],"[",["T_STRING","Zend_Cloud_Infrastructure_Instance",114],["T_DOUBLE_COLON","::",114],["T_STRING","SSH_USERNAME",114],"]",")",["T_WHITESPACE"," \n            ",114],["T_BOOLEAN_OR","||",115],["T_WHITESPACE"," ",115],"(",["T_EMPTY","empty",115],"(",["T_VARIABLE","$params",115],"[",["T_STRING","Zend_Cloud_Infrastructure_Instance",115],["T_DOUBLE_COLON","::",115],["T_STRING","SSH_PASSWORD",115],"]",")",["T_WHITESPACE"," \n                ",115],["T_BOOLEAN_AND","&&",116],["T_WHITESPACE"," ",116],["T_EMPTY","empty",116],"(",["T_VARIABLE","$params",116],"[",["T_STRING","Zend_Cloud_Infrastructure_Instance",116],["T_DOUBLE_COLON","::",116],["T_STRING","SSH_KEY",116],"]",")",")",["T_WHITESPACE","\n        ",116],")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Exception.php';\n",118],["T_WHITESPACE","            ",119],["T_THROW","throw",119],["T_WHITESPACE"," ",119],["T_NEW","new",119],["T_WHITESPACE"," ",119],["T_STRING","Zend_Cloud_Infrastructure_Exception",119],"(",["T_CONSTANT_ENCAPSED_STRING","'You must specify the params for the SSH connection'",119],")",";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE","\n\n        ",120],["T_VARIABLE","$host",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","publicDnsInstance",122],"(",["T_VARIABLE","$id",122],")",";",["T_WHITESPACE","\n        ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_EMPTY","empty",123],"(",["T_VARIABLE","$host",123],")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Exception.php';\n",124],["T_WHITESPACE","            ",125],["T_THROW","throw",125],["T_WHITESPACE"," ",125],["T_NEW","new",125],["T_WHITESPACE"," ",125],["T_STRING","Zend_Cloud_Infrastructure_Exception",125],"(",["T_STRING","sprintf",125],"(",["T_WHITESPACE","\n                ",125],["T_CONSTANT_ENCAPSED_STRING","'The instance identified by \"%s\" does not exist'",126],",",["T_WHITESPACE"," \n                ",126],["T_VARIABLE","$id",127],["T_WHITESPACE","\n            ",127],")",")",";",["T_WHITESPACE","\n        ",128],"}",["T_WHITESPACE","\n\n        ",129],["T_VARIABLE","$conn",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","ssh2_connect",131],"(",["T_VARIABLE","$host",131],")",";",["T_WHITESPACE","\n        ",131],["T_IF","if",132],["T_WHITESPACE"," ",132],"(","!",["T_STRING","ssh2_auth_password",132],"(",["T_VARIABLE","$conn",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$params",132],"[",["T_STRING","Zend_Cloud_Infrastructure_Instance",132],["T_DOUBLE_COLON","::",132],["T_STRING","SSH_USERNAME",132],"]",",",["T_WHITESPACE"," \n                ",132],["T_VARIABLE","$params",133],"[",["T_STRING","Zend_Cloud_Infrastructure_Instance",133],["T_DOUBLE_COLON","::",133],["T_STRING","SSH_PASSWORD",133],"]",")",")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_COMMENT","#require_once 'Zend\/Cloud\/Infrastructure\/Exception.php';\n",134],["T_WHITESPACE","            ",135],["T_THROW","throw",135],["T_WHITESPACE"," ",135],["T_NEW","new",135],["T_WHITESPACE"," ",135],["T_STRING","Zend_Cloud_Infrastructure_Exception",135],"(",["T_CONSTANT_ENCAPSED_STRING","'SSH authentication failed'",135],")",";",["T_WHITESPACE","\n        ",135],"}",["T_WHITESPACE","\n\n        ",136],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_STRING","is_array",138],"(",["T_VARIABLE","$cmd",138],")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$result",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_ARRAY","array",139],"(",")",";",["T_WHITESPACE","\n            ",139],["T_FOREACH","foreach",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$cmd",140],["T_WHITESPACE"," ",140],["T_AS","as",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$command",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$stream",141],["T_WHITESPACE","      ",141],"=",["T_WHITESPACE"," ",141],["T_STRING","ssh2_exec",141],"(",["T_VARIABLE","$conn",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$command",141],")",";",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$errorStream",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","ssh2_fetch_stream",142],"(",["T_VARIABLE","$stream",142],",",["T_WHITESPACE"," ",142],["T_STRING","SSH2_STREAM_STDERR",142],")",";",["T_WHITESPACE","\n\n                ",142],["T_STRING","stream_set_blocking",144],"(",["T_VARIABLE","$errorStream",144],",",["T_WHITESPACE"," ",144],["T_STRING","true",144],")",";",["T_WHITESPACE","\n                ",144],["T_STRING","stream_set_blocking",145],"(",["T_VARIABLE","$stream",145],",",["T_WHITESPACE"," ",145],["T_STRING","true",145],")",";",["T_WHITESPACE"," \n\n                ",145],["T_VARIABLE","$output",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_STRING","stream_get_contents",147],"(",["T_VARIABLE","$stream",147],")",";",["T_WHITESPACE","\n                ",147],["T_VARIABLE","$error",148],["T_WHITESPACE","  ",148],"=",["T_WHITESPACE"," ",148],["T_STRING","stream_get_contents",148],"(",["T_VARIABLE","$errorStream",148],")",";",["T_WHITESPACE","\n                \n                ",148],["T_IF","if",150],["T_WHITESPACE"," ",150],"(",["T_EMPTY","empty",150],"(",["T_VARIABLE","$error",150],")",")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n                    ",150],["T_VARIABLE","$result",151],"[",["T_VARIABLE","$command",151],"]",["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$output",151],";",["T_WHITESPACE","\n                ",151],"}",["T_WHITESPACE"," ",152],["T_ELSE","else",152],["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n                    ",152],["T_VARIABLE","$result",153],"[",["T_VARIABLE","$command",153],"]",["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$error",153],";",["T_WHITESPACE","\n                ",153],"}",["T_WHITESPACE","\n            ",154],"}",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE"," ",156],["T_ELSE","else",156],["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_VARIABLE","$stream",157],["T_WHITESPACE","      ",157],"=",["T_WHITESPACE"," ",157],["T_STRING","ssh2_exec",157],"(",["T_VARIABLE","$conn",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$cmd",157],")",";",["T_WHITESPACE","\n            ",157],["T_VARIABLE","$result",158],["T_WHITESPACE","      ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","stream_set_blocking",158],"(",["T_VARIABLE","$stream",158],",",["T_WHITESPACE"," ",158],["T_STRING","true",158],")",";",["T_WHITESPACE","\n            ",158],["T_VARIABLE","$errorStream",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","ssh2_fetch_stream",159],"(",["T_VARIABLE","$stream",159],",",["T_WHITESPACE"," ",159],["T_STRING","SSH2_STREAM_STDERR",159],")",";",["T_WHITESPACE","\n\n            ",159],["T_STRING","stream_set_blocking",161],"(",["T_VARIABLE","$errorStream",161],",",["T_WHITESPACE"," ",161],["T_STRING","true",161],")",";",["T_WHITESPACE","\n            ",161],["T_STRING","stream_set_blocking",162],"(",["T_VARIABLE","$stream",162],",",["T_WHITESPACE"," ",162],["T_STRING","true",162],")",";",["T_WHITESPACE"," \n\n            ",162],["T_VARIABLE","$output",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_STRING","stream_get_contents",164],"(",["T_VARIABLE","$stream",164],")",";",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$error",165],["T_WHITESPACE","  ",165],"=",["T_WHITESPACE"," ",165],["T_STRING","stream_get_contents",165],"(",["T_VARIABLE","$errorStream",165],")",";",["T_WHITESPACE","\n            \n            ",165],["T_IF","if",167],["T_WHITESPACE"," ",167],"(",["T_EMPTY","empty",167],"(",["T_VARIABLE","$error",167],")",")",["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n                ",167],["T_VARIABLE","$result",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$output",168],";",["T_WHITESPACE","\n            ",168],"}",["T_WHITESPACE"," ",169],["T_ELSE","else",169],["T_WHITESPACE"," ",169],"{",["T_WHITESPACE","\n                ",169],["T_VARIABLE","$result",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_VARIABLE","$error",170],";",["T_WHITESPACE","\n            ",170],"}",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","    \n        ",172],["T_RETURN","return",173],["T_WHITESPACE"," ",173],["T_VARIABLE","$result",173],";",["T_WHITESPACE","\n    ",173],"}",["T_WHITESPACE","\n",174],"}",["T_WHITESPACE","\n",175]]