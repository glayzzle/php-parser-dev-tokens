[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_DOC_COMMENT","\/**\n * Zend Framework\n *\n * LICENSE\n *\n * This source file is subject to the new BSD license that is bundled\n * with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/framework.zend.com\/license\/new-bsd\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@zend.com so we can send you a copy immediately.\n *\n * @category   Zend\n * @package    Zend_Http\n * @subpackage Client_Adapter\n * @version    $Id$\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",3],["T_WHITESPACE","\n\n",22],["T_DOC_COMMENT","\/**\n * @see Zend_Uri_Http\n *\/",24],["T_WHITESPACE","\n",26],["T_COMMENT","#require_once 'Zend\/Uri\/Http.php';\n",27],["T_DOC_COMMENT","\/**\n * @see Zend_Http_Client\n *\/",28],["T_WHITESPACE","\n",30],["T_COMMENT","#require_once 'Zend\/Http\/Client.php';\n",31],["T_DOC_COMMENT","\/**\n * @see Zend_Http_Client_Adapter_Socket\n *\/",32],["T_WHITESPACE","\n",34],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Socket.php';\n",35],["T_WHITESPACE","\n",36],["T_DOC_COMMENT","\/**\n * HTTP Proxy-supporting Zend_Http_Client adapter class, based on the default\n * socket based adapter.\n *\n * Should be used if proxy HTTP access is required. If no proxy is set, will\n * fall back to Zend_Http_Client_Adapter_Socket behavior. Just like the\n * default Socket adapter, this adapter does not require any special extensions\n * installed.\n *\n * @category   Zend\n * @package    Zend_Http\n * @subpackage Client_Adapter\n * @copyright  Copyright (c) 2005-2015 Zend Technologies USA Inc. (http:\/\/www.zend.com)\n * @license    http:\/\/framework.zend.com\/license\/new-bsd     New BSD License\n *\/",37],["T_WHITESPACE","\n",51],["T_CLASS","class",52],["T_WHITESPACE"," ",52],["T_STRING","Zend_Http_Client_Adapter_Proxy",52],["T_WHITESPACE"," ",52],["T_EXTENDS","extends",52],["T_WHITESPACE"," ",52],["T_STRING","Zend_Http_Client_Adapter_Socket",52],["T_WHITESPACE","\n",52],"{",["T_WHITESPACE","\n    ",53],["T_DOC_COMMENT","\/**\n     * Parameters array\n     *\n     * @var array\n     *\/",54],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$config",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_ARRAY","array",59],"(",["T_WHITESPACE","\n        ",59],["T_CONSTANT_ENCAPSED_STRING","'ssltransport'",60],["T_WHITESPACE","  ",60],["T_DOUBLE_ARROW","=>",60],["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'ssl'",60],",",["T_WHITESPACE","\n        ",60],["T_CONSTANT_ENCAPSED_STRING","'sslcert'",61],["T_WHITESPACE","       ",61],["T_DOUBLE_ARROW","=>",61],["T_WHITESPACE"," ",61],["T_STRING","null",61],",",["T_WHITESPACE","\n        ",61],["T_CONSTANT_ENCAPSED_STRING","'sslpassphrase'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_STRING","null",62],",",["T_WHITESPACE","\n        ",62],["T_CONSTANT_ENCAPSED_STRING","'sslusecontext'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_STRING","false",63],",",["T_WHITESPACE","\n        ",63],["T_CONSTANT_ENCAPSED_STRING","'proxy_host'",64],["T_WHITESPACE","    ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","''",64],",",["T_WHITESPACE","\n        ",64],["T_CONSTANT_ENCAPSED_STRING","'proxy_port'",65],["T_WHITESPACE","    ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_LNUMBER","8080",65],",",["T_WHITESPACE","\n        ",65],["T_CONSTANT_ENCAPSED_STRING","'proxy_user'",66],["T_WHITESPACE","    ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","''",66],",",["T_WHITESPACE","\n        ",66],["T_CONSTANT_ENCAPSED_STRING","'proxy_pass'",67],["T_WHITESPACE","    ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","''",67],",",["T_WHITESPACE","\n        ",67],["T_CONSTANT_ENCAPSED_STRING","'proxy_auth'",68],["T_WHITESPACE","    ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_STRING","Zend_Http_Client",68],["T_DOUBLE_COLON","::",68],["T_STRING","AUTH_BASIC",68],",",["T_WHITESPACE","\n        ",68],["T_CONSTANT_ENCAPSED_STRING","'persistent'",69],["T_WHITESPACE","    ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_STRING","false",69],",",["T_WHITESPACE","\n    ",69],")",";",["T_WHITESPACE","\n\n    ",70],["T_DOC_COMMENT","\/**\n     * Whether HTTPS CONNECT was already negotiated with the proxy or not\n     *\n     * @var boolean\n     *\/",72],["T_WHITESPACE","\n    ",76],["T_PROTECTED","protected",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$negotiated",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","false",77],";",["T_WHITESPACE","\n    \n    ",77],["T_DOC_COMMENT","\/**\n     * Stores the last CONNECT handshake request\n     * \n     * @var string\n     *\/",79],["T_WHITESPACE","\n    ",83],["T_PROTECTED","protected",84],["T_WHITESPACE"," ",84],["T_VARIABLE","$connectHandshakeRequest",84],";",["T_WHITESPACE","\n\n    ",84],["T_DOC_COMMENT","\/**\n     * Connect to the remote server\n     *\n     * Will try to connect to the proxy server. If no proxy was set, will\n     * fall back to the target server (behave like regular Socket adapter)\n     *\n     * @param string  $host\n     * @param int     $port\n     * @param boolean $secure\n     *\/",86],["T_WHITESPACE","\n    ",95],["T_PUBLIC","public",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","connect",96],"(",["T_VARIABLE","$host",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$port",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_LNUMBER","80",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$secure",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","false",96],")",["T_WHITESPACE","\n    ",96],"{",["T_WHITESPACE","\n        ",97],["T_COMMENT","\/\/ If no proxy is set, fall back to Socket adapter\n",98],["T_WHITESPACE","        ",99],["T_IF","if",99],["T_WHITESPACE"," ",99],"(","!",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","config",99],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_host'",99],"]",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n            ",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_STRING","parent",100],["T_DOUBLE_COLON","::",100],["T_STRING","connect",100],"(",["T_VARIABLE","$host",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$port",100],",",["T_WHITESPACE"," ",100],["T_VARIABLE","$secure",100],")",";",["T_WHITESPACE","\n        ",100],"}",["T_WHITESPACE","\n\n        ",101],["T_COMMENT","\/* Url might require stream context even if proxy connection doesn't *\/",103],["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$secure",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n            ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","config",105],"[",["T_CONSTANT_ENCAPSED_STRING","'sslusecontext'",105],"]",["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","true",105],";",["T_WHITESPACE","\n        ",105],"}",["T_WHITESPACE","\n\n        ",106],["T_COMMENT","\/\/ Connect (a non-secure connection) to the proxy server\n",108],["T_WHITESPACE","        ",109],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_STRING","parent",109],["T_DOUBLE_COLON","::",109],["T_STRING","connect",109],"(",["T_WHITESPACE","\n            ",109],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","config",110],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_host'",110],"]",",",["T_WHITESPACE","\n            ",110],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","config",111],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_port'",111],"]",",",["T_WHITESPACE","\n            ",111],["T_STRING","false",112],["T_WHITESPACE","\n        ",112],")",";",["T_WHITESPACE","\n    ",113],"}",["T_WHITESPACE","\n\n    ",114],["T_DOC_COMMENT","\/**\n     * Send request to the proxy server\n     *\n     * @param string        $method\n     * @param Zend_Uri_Http $uri\n     * @param string        $http_ver\n     * @param array         $headers\n     * @param string        $body\n     * @return string Request as string\n     * @throws Zend_Http_Client_Adapter_Exception\n     *\/",116],["T_WHITESPACE","\n    ",126],["T_PUBLIC","public",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","write",127],"(",["T_WHITESPACE","\n        ",127],["T_VARIABLE","$method",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$uri",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$http_ver",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'1.1'",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$headers",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_ARRAY","array",128],"(",")",",",["T_WHITESPACE"," ",128],["T_VARIABLE","$body",128],["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","''",128],["T_WHITESPACE","\n    ",128],")",["T_WHITESPACE","\n    ",129],"{",["T_WHITESPACE","\n        ",130],["T_COMMENT","\/\/ If no proxy is set, fall back to default Socket adapter\n",131],["T_WHITESPACE","        ",132],["T_IF","if",132],["T_WHITESPACE"," ",132],"(","!",["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","config",132],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_host'",132],"]",")",["T_WHITESPACE"," ",132],"{",["T_WHITESPACE","\n            ",132],["T_RETURN","return",133],["T_WHITESPACE"," ",133],["T_STRING","parent",133],["T_DOUBLE_COLON","::",133],["T_STRING","write",133],"(",["T_VARIABLE","$method",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$uri",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$http_ver",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$headers",133],",",["T_WHITESPACE"," ",133],["T_VARIABLE","$body",133],")",";",["T_WHITESPACE","\n        ",133],"}",["T_WHITESPACE","\n\n        ",134],["T_COMMENT","\/\/ Make sure we're properly connected\n",136],["T_WHITESPACE","        ",137],["T_IF","if",137],["T_WHITESPACE"," ",137],"(","!",["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","socket",137],")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n            ",137],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\n",138],["T_WHITESPACE","            ",139],["T_THROW","throw",139],["T_WHITESPACE"," ",139],["T_NEW","new",139],["T_WHITESPACE"," ",139],["T_STRING","Zend_Http_Client_Adapter_Exception",139],"(",["T_WHITESPACE","\n                ",139],["T_CONSTANT_ENCAPSED_STRING","'Trying to write but we are not connected'",140],["T_WHITESPACE","\n            ",140],")",";",["T_WHITESPACE","\n        ",141],"}",["T_WHITESPACE","\n\n        ",142],["T_VARIABLE","$host",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","config",144],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_host'",144],"]",";",["T_WHITESPACE","\n        ",144],["T_VARIABLE","$port",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","config",145],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_port'",145],"]",";",["T_WHITESPACE","\n\n        ",145],["T_IF","if",147],["T_WHITESPACE"," ",147],"(",["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","connected_to",147],"[",["T_LNUMBER","0",147],"]",["T_WHITESPACE"," ",147],["T_IS_NOT_EQUAL","!=",147],["T_WHITESPACE"," ",147],"\"",["T_ENCAPSED_AND_WHITESPACE","tcp:\/\/",147],["T_VARIABLE","$host",147],"\"",["T_WHITESPACE","\n            ",147],["T_BOOLEAN_OR","||",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$this",148],["T_OBJECT_OPERATOR","->",148],["T_STRING","connected_to",148],"[",["T_LNUMBER","1",148],"]",["T_WHITESPACE"," ",148],["T_IS_NOT_EQUAL","!=",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$port",148],["T_WHITESPACE","\n        ",148],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n            ",149],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\n",150],["T_WHITESPACE","            ",151],["T_THROW","throw",151],["T_WHITESPACE"," ",151],["T_NEW","new",151],["T_WHITESPACE"," ",151],["T_STRING","Zend_Http_Client_Adapter_Exception",151],"(",["T_WHITESPACE","\n                ",151],["T_CONSTANT_ENCAPSED_STRING","'Trying to write but we are connected to the wrong proxy server'",152],["T_WHITESPACE","\n            ",152],")",";",["T_WHITESPACE","\n        ",153],"}",["T_WHITESPACE","\n\n        ",154],["T_COMMENT","\/\/ Add Proxy-Authorization header\n",156],["T_WHITESPACE","        ",157],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","config",157],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_user'",157],"]",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n            ",157],["T_COMMENT","\/\/ Check to see if one already exists\n",158],["T_WHITESPACE","            ",159],["T_VARIABLE","$hasProxyAuthHeader",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_STRING","false",159],";",["T_WHITESPACE","\n            ",159],["T_FOREACH","foreach",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$headers",160],["T_WHITESPACE"," ",160],["T_AS","as",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$k",160],["T_WHITESPACE"," ",160],["T_DOUBLE_ARROW","=>",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$v",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n                ",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_STRING_CAST","(string)",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$k",161],["T_WHITESPACE"," ",161],["T_IS_EQUAL","==",161],["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'proxy-authorization'",161],["T_WHITESPACE","\n                    ",161],["T_BOOLEAN_OR","||",162],["T_WHITESPACE"," ",162],["T_STRING","preg_match",162],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/^proxy-authorization:\/i\"",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$v",162],")",["T_WHITESPACE","\n                ",162],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                    ",163],["T_VARIABLE","$hasProxyAuthHeader",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_STRING","true",164],";",["T_WHITESPACE","\n                    ",164],["T_BREAK","break",165],";",["T_WHITESPACE","\n                ",165],"}",["T_WHITESPACE","\n            ",166],"}",["T_WHITESPACE","\n            ",167],["T_IF","if",168],["T_WHITESPACE"," ",168],"(","!",["T_VARIABLE","$hasProxyAuthHeader",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n                ",168],["T_VARIABLE","$headers",169],"[","]",["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'Proxy-authorization: '",169],["T_WHITESPACE","\n                    ",169],".",["T_WHITESPACE"," ",170],["T_STRING","Zend_Http_Client",170],["T_DOUBLE_COLON","::",170],["T_STRING","encodeAuthHeader",170],"(",["T_WHITESPACE","\n                        ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","config",171],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_user'",171],"]",",",["T_WHITESPACE","\n                        ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","config",172],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_pass'",172],"]",",",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","config",172],"[",["T_CONSTANT_ENCAPSED_STRING","'proxy_auth'",172],"]",["T_WHITESPACE","\n                    ",172],")",";",["T_WHITESPACE","\n            ",173],"}",["T_WHITESPACE","\n        ",174],"}",["T_WHITESPACE","\n\n        ",175],["T_COMMENT","\/\/ if we are proxying HTTPS, preform CONNECT handshake with the proxy\n",177],["T_WHITESPACE","        ",178],["T_IF","if",178],["T_WHITESPACE"," ",178],"(",["T_VARIABLE","$uri",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","getScheme",178],"(",")",["T_WHITESPACE"," ",178],["T_IS_EQUAL","==",178],["T_WHITESPACE"," ",178],["T_CONSTANT_ENCAPSED_STRING","'https'",178],["T_WHITESPACE"," ",178],["T_BOOLEAN_AND","&&",178],["T_WHITESPACE"," ",178],"(","!",["T_VARIABLE","$this",178],["T_OBJECT_OPERATOR","->",178],["T_STRING","negotiated",178],")",")",["T_WHITESPACE"," ",178],"{",["T_WHITESPACE","\n            ",178],["T_VARIABLE","$this",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","connectHandshake",179],"(",["T_WHITESPACE","\n                ",179],["T_VARIABLE","$uri",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getHost",180],"(",")",",",["T_WHITESPACE"," ",180],["T_VARIABLE","$uri",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getPort",180],"(",")",",",["T_WHITESPACE"," ",180],["T_VARIABLE","$http_ver",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$headers",180],["T_WHITESPACE","\n            ",180],")",";",["T_WHITESPACE","\n            ",181],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","negotiated",182],["T_WHITESPACE"," ",182],"=",["T_WHITESPACE"," ",182],["T_STRING","true",182],";",["T_WHITESPACE","\n        ",182],"}",["T_WHITESPACE","\n\n        ",183],["T_COMMENT","\/\/ Save request method for later\n",185],["T_WHITESPACE","        ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","method",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$method",186],";",["T_WHITESPACE","\n\n        ",186],["T_COMMENT","\/\/ Build request headers\n",188],["T_WHITESPACE","        ",189],["T_IF","if",189],["T_WHITESPACE"," ",189],"(",["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","negotiated",189],")",["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_VARIABLE","$path",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$uri",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","getPath",190],"(",")",";",["T_WHITESPACE","\n            ",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_VARIABLE","$uri",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","getQuery",191],"(",")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n                ",191],["T_VARIABLE","$path",192],["T_WHITESPACE"," ",192],["T_CONCAT_EQUAL",".=",192],["T_WHITESPACE"," ",192],["T_CONSTANT_ENCAPSED_STRING","'?'",192],["T_WHITESPACE"," ",192],".",["T_WHITESPACE"," ",192],["T_VARIABLE","$uri",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getQuery",192],"(",")",";",["T_WHITESPACE","\n            ",192],"}",["T_WHITESPACE","\n            ",193],["T_VARIABLE","$request",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],"\"",["T_VARIABLE","$method",194],["T_ENCAPSED_AND_WHITESPACE"," ",194],["T_VARIABLE","$path",194],["T_ENCAPSED_AND_WHITESPACE"," HTTP\/",194],["T_VARIABLE","$http_ver",194],["T_ENCAPSED_AND_WHITESPACE","\\r\\n",194],"\"",";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE"," ",195],["T_ELSE","else",195],["T_WHITESPACE"," ",195],"{",["T_WHITESPACE","\n            ",195],["T_VARIABLE","$request",196],["T_WHITESPACE"," ",196],"=",["T_WHITESPACE"," ",196],"\"",["T_VARIABLE","$method",196],["T_ENCAPSED_AND_WHITESPACE"," ",196],["T_VARIABLE","$uri",196],["T_ENCAPSED_AND_WHITESPACE"," HTTP\/",196],["T_VARIABLE","$http_ver",196],["T_ENCAPSED_AND_WHITESPACE","\\r\\n",196],"\"",";",["T_WHITESPACE","\n        ",196],"}",["T_WHITESPACE","\n\n        ",197],["T_COMMENT","\/\/ Add all headers to the request string\n",199],["T_WHITESPACE","        ",200],["T_FOREACH","foreach",200],["T_WHITESPACE"," ",200],"(",["T_VARIABLE","$headers",200],["T_WHITESPACE"," ",200],["T_AS","as",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$k",200],["T_WHITESPACE"," ",200],["T_DOUBLE_ARROW","=>",200],["T_WHITESPACE"," ",200],["T_VARIABLE","$v",200],")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n            ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_STRING","is_string",201],"(",["T_VARIABLE","$k",201],")",")",["T_WHITESPACE"," ",201],["T_VARIABLE","$v",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],"\"",["T_VARIABLE","$k",201],["T_ENCAPSED_AND_WHITESPACE",": ",201],["T_VARIABLE","$v",201],"\"",";",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$request",202],["T_WHITESPACE"," ",202],["T_CONCAT_EQUAL",".=",202],["T_WHITESPACE"," ",202],"\"",["T_VARIABLE","$v",202],["T_ENCAPSED_AND_WHITESPACE","\\r\\n",202],"\"",";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n\n        ",203],["T_IF","if",205],"(",["T_STRING","is_resource",205],"(",["T_VARIABLE","$body",205],")",")",["T_WHITESPACE"," ",205],"{",["T_WHITESPACE","\n            ",205],["T_VARIABLE","$request",206],["T_WHITESPACE"," ",206],["T_CONCAT_EQUAL",".=",206],["T_WHITESPACE"," ",206],["T_CONSTANT_ENCAPSED_STRING","\"\\r\\n\"",206],";",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE"," ",207],["T_ELSE","else",207],["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n            ",207],["T_COMMENT","\/\/ Add the request body\n",208],["T_WHITESPACE","            ",209],["T_VARIABLE","$request",209],["T_WHITESPACE"," ",209],["T_CONCAT_EQUAL",".=",209],["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","\"\\r\\n\"",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_VARIABLE","$body",209],";",["T_WHITESPACE","\n        ",209],"}",["T_WHITESPACE","\n\n        ",210],["T_COMMENT","\/\/ Send the request\n",212],["T_WHITESPACE","        ",213],["T_IF","if",213],["T_WHITESPACE"," ",213],"(","!","@",["T_STRING","fwrite",213],"(",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","socket",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$request",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n            ",213],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\n",214],["T_WHITESPACE","            ",215],["T_THROW","throw",215],["T_WHITESPACE"," ",215],["T_NEW","new",215],["T_WHITESPACE"," ",215],["T_STRING","Zend_Http_Client_Adapter_Exception",215],"(",["T_WHITESPACE","\n                ",215],["T_CONSTANT_ENCAPSED_STRING","'Error writing request to proxy server'",216],["T_WHITESPACE","\n            ",216],")",";",["T_WHITESPACE","\n        ",217],"}",["T_WHITESPACE","\n\n        ",218],["T_IF","if",220],"(",["T_STRING","is_resource",220],"(",["T_VARIABLE","$body",220],")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_IF","if",221],"(",["T_STRING","stream_copy_to_stream",221],"(",["T_VARIABLE","$body",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","socket",221],")",["T_WHITESPACE"," ",221],["T_IS_EQUAL","==",221],["T_WHITESPACE"," ",221],["T_LNUMBER","0",221],")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n                ",221],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\n",222],["T_WHITESPACE","                ",223],["T_THROW","throw",223],["T_WHITESPACE"," ",223],["T_NEW","new",223],["T_WHITESPACE"," ",223],["T_STRING","Zend_Http_Client_Adapter_Exception",223],"(",["T_WHITESPACE","\n                    ",223],["T_CONSTANT_ENCAPSED_STRING","'Error writing request to server'",224],["T_WHITESPACE","\n                ",224],")",";",["T_WHITESPACE","\n            ",225],"}",["T_WHITESPACE","\n        ",226],"}",["T_WHITESPACE","\n\n        ",227],["T_RETURN","return",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$request",229],";",["T_WHITESPACE","\n    ",229],"}",["T_WHITESPACE","\n\n    ",230],["T_DOC_COMMENT","\/**\n     * Preform handshaking with HTTPS proxy using CONNECT method\n     *\n     * @param string  $host\n     * @param integer $port\n     * @param string  $http_ver\n     * @param array   $headers\n     * @return void\n     * @throws Zend_Http_Client_Adapter_Exception\n     *\/",232],["T_WHITESPACE","\n    ",241],["T_PROTECTED","protected",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","connectHandshake",242],"(",["T_WHITESPACE","\n        ",242],["T_VARIABLE","$host",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$port",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_LNUMBER","443",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$http_ver",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","'1.1'",243],",",["T_WHITESPACE"," ",243],["T_ARRAY","array",243],["T_WHITESPACE"," ",243],"&",["T_VARIABLE","$headers",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_ARRAY","array",243],"(",")",["T_WHITESPACE","\n    ",243],")",["T_WHITESPACE","\n    ",244],"{",["T_WHITESPACE","\n        ",245],["T_VARIABLE","$request",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],"\"",["T_ENCAPSED_AND_WHITESPACE","CONNECT ",246],["T_VARIABLE","$host",246],["T_ENCAPSED_AND_WHITESPACE",":",246],["T_VARIABLE","$port",246],["T_ENCAPSED_AND_WHITESPACE"," HTTP\/",246],["T_VARIABLE","$http_ver",246],["T_ENCAPSED_AND_WHITESPACE","\\r\\n",246],"\"",["T_WHITESPACE"," ",246],".",["T_WHITESPACE","\n                   ",246],["T_CONSTANT_ENCAPSED_STRING","\"Host: \"",247],["T_WHITESPACE"," ",247],".",["T_WHITESPACE"," ",247],["T_VARIABLE","$host",247],["T_WHITESPACE"," ",247],".",["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","\"\\r\\n\"",247],";",["T_WHITESPACE","\n\n        ",247],["T_COMMENT","\/\/ Process provided headers, including important ones to CONNECT request\n",249],["T_WHITESPACE","        ",250],["T_FOREACH","foreach",250],["T_WHITESPACE"," ",250],"(",["T_VARIABLE","$headers",250],["T_WHITESPACE"," ",250],["T_AS","as",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$k",250],["T_WHITESPACE"," ",250],["T_DOUBLE_ARROW","=>",250],["T_WHITESPACE"," ",250],["T_VARIABLE","$v",250],")",["T_WHITESPACE"," ",250],"{",["T_WHITESPACE","\n            ",250],["T_SWITCH","switch",251],["T_WHITESPACE"," ",251],"(",["T_STRING","strtolower",251],"(",["T_STRING","substr",251],"(",["T_VARIABLE","$v",251],",",["T_LNUMBER","0",251],",",["T_STRING","strpos",251],"(",["T_VARIABLE","$v",251],",",["T_CONSTANT_ENCAPSED_STRING","':'",251],")",")",")",")",["T_WHITESPACE"," ",251],"{",["T_WHITESPACE","\n                ",251],["T_CASE","case",252],["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'proxy-authorization'",252],":",["T_WHITESPACE","\n                    ",252],["T_COMMENT","\/\/ break intentionally omitted\n",253],["T_WHITESPACE","\n                ",254],["T_CASE","case",255],["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'user-agent'",255],":",["T_WHITESPACE","\n                    ",255],["T_VARIABLE","$request",256],["T_WHITESPACE"," ",256],["T_CONCAT_EQUAL",".=",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$v",256],["T_WHITESPACE"," ",256],".",["T_WHITESPACE"," ",256],["T_CONSTANT_ENCAPSED_STRING","\"\\r\\n\"",256],";",["T_WHITESPACE","\n                    ",256],["T_BREAK","break",257],";",["T_WHITESPACE","\n\n                ",257],["T_DEFAULT","default",259],":",["T_WHITESPACE","\n                    ",259],["T_BREAK","break",260],";",["T_WHITESPACE","\n            ",260],"}",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n        ",262],["T_VARIABLE","$request",263],["T_WHITESPACE"," ",263],["T_CONCAT_EQUAL",".=",263],["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","\"\\r\\n\"",263],";",["T_WHITESPACE","\n        \n        ",263],["T_COMMENT","\/\/ @see ZF-3189\n",265],["T_WHITESPACE","        ",266],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","connectHandshakeRequest",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$request",266],";",["T_WHITESPACE","\n\n        ",266],["T_COMMENT","\/\/ Send the request\n",268],["T_WHITESPACE","        ",269],["T_IF","if",269],["T_WHITESPACE"," ",269],"(","!","@",["T_STRING","fwrite",269],"(",["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","socket",269],",",["T_WHITESPACE"," ",269],["T_VARIABLE","$request",269],")",")",["T_WHITESPACE"," ",269],"{",["T_WHITESPACE","\n            ",269],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\n",270],["T_WHITESPACE","            ",271],["T_THROW","throw",271],["T_WHITESPACE"," ",271],["T_NEW","new",271],["T_WHITESPACE"," ",271],["T_STRING","Zend_Http_Client_Adapter_Exception",271],"(",["T_WHITESPACE","\n                ",271],["T_CONSTANT_ENCAPSED_STRING","'Error writing request to proxy server'",272],["T_WHITESPACE","\n            ",272],")",";",["T_WHITESPACE","\n        ",273],"}",["T_WHITESPACE","\n\n        ",274],["T_COMMENT","\/\/ Read response headers only\n",276],["T_WHITESPACE","        ",277],["T_VARIABLE","$response",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","''",277],";",["T_WHITESPACE","\n        ",277],["T_VARIABLE","$gotStatus",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_STRING","false",278],";",["T_WHITESPACE","\n        ",278],["T_WHILE","while",279],["T_WHITESPACE"," ",279],"(",["T_VARIABLE","$line",279],["T_WHITESPACE"," ",279],"=",["T_WHITESPACE"," ",279],"@",["T_STRING","fgets",279],"(",["T_VARIABLE","$this",279],["T_OBJECT_OPERATOR","->",279],["T_STRING","socket",279],")",")",["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n            ",279],["T_VARIABLE","$gotStatus",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_VARIABLE","$gotStatus",280],["T_WHITESPACE"," ",280],["T_BOOLEAN_OR","||",280],["T_WHITESPACE"," ",280],"(",["T_STRING","strpos",280],"(",["T_VARIABLE","$line",280],",",["T_WHITESPACE"," ",280],["T_CONSTANT_ENCAPSED_STRING","'HTTP'",280],")",["T_WHITESPACE"," ",280],["T_IS_NOT_IDENTICAL","!==",280],["T_WHITESPACE"," ",280],["T_STRING","false",280],")",";",["T_WHITESPACE","\n            ",280],["T_IF","if",281],["T_WHITESPACE"," ",281],"(",["T_VARIABLE","$gotStatus",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n                ",281],["T_VARIABLE","$response",282],["T_WHITESPACE"," ",282],["T_CONCAT_EQUAL",".=",282],["T_WHITESPACE"," ",282],["T_VARIABLE","$line",282],";",["T_WHITESPACE","\n                ",282],["T_IF","if",283],["T_WHITESPACE"," ",283],"(","!",["T_STRING","chop",283],"(",["T_VARIABLE","$line",283],")",")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n                    ",283],["T_BREAK","break",284],";",["T_WHITESPACE","\n                ",284],"}",["T_WHITESPACE","\n            ",285],"}",["T_WHITESPACE","\n        ",286],"}",["T_WHITESPACE","\n\n        ",287],["T_COMMENT","\/\/ Check that the response from the proxy is 200\n",289],["T_WHITESPACE","        ",290],["T_IF","if",290],["T_WHITESPACE"," ",290],"(",["T_STRING","Zend_Http_Response",290],["T_DOUBLE_COLON","::",290],["T_STRING","extractCode",290],"(",["T_VARIABLE","$response",290],")",["T_WHITESPACE"," ",290],["T_IS_NOT_EQUAL","!=",290],["T_WHITESPACE"," ",290],["T_LNUMBER","200",290],")",["T_WHITESPACE"," ",290],"{",["T_WHITESPACE","\n            ",290],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\n",291],["T_WHITESPACE","            ",292],["T_THROW","throw",292],["T_WHITESPACE"," ",292],["T_NEW","new",292],["T_WHITESPACE"," ",292],["T_STRING","Zend_Http_Client_Adapter_Exception",292],"(",["T_WHITESPACE","\n                ",292],["T_CONSTANT_ENCAPSED_STRING","'Unable to connect to HTTPS proxy. Server response: '",293],["T_WHITESPACE"," ",293],".",["T_WHITESPACE"," ",293],["T_VARIABLE","$response",293],["T_WHITESPACE","\n            ",293],")",";",["T_WHITESPACE","\n        ",294],"}",["T_WHITESPACE","\n\n        ",295],["T_COMMENT","\/\/ If all is good, switch socket to secure mode. We have to fall back\n",297],["T_WHITESPACE","        ",298],["T_COMMENT","\/\/ through the different modes\n",298],["T_WHITESPACE","        ",299],["T_VARIABLE","$modes",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_ARRAY","array",299],"(",["T_WHITESPACE","\n            ",299],["T_STRING","STREAM_CRYPTO_METHOD_TLS_CLIENT",300],",",["T_WHITESPACE","\n            ",300],["T_STRING","STREAM_CRYPTO_METHOD_SSLv3_CLIENT",301],",",["T_WHITESPACE","\n            ",301],["T_STRING","STREAM_CRYPTO_METHOD_SSLv23_CLIENT",302],",",["T_WHITESPACE","\n            ",302],["T_STRING","STREAM_CRYPTO_METHOD_SSLv2_CLIENT",303],["T_WHITESPACE","\n        ",303],")",";",["T_WHITESPACE","\n\n        ",304],["T_VARIABLE","$success",306],["T_WHITESPACE"," ",306],"=",["T_WHITESPACE"," ",306],["T_STRING","false",306],";",["T_WHITESPACE","\n        ",306],["T_FOREACH","foreach",307],"(",["T_VARIABLE","$modes",307],["T_WHITESPACE"," ",307],["T_AS","as",307],["T_WHITESPACE"," ",307],["T_VARIABLE","$mode",307],")",["T_WHITESPACE"," ",307],"{",["T_WHITESPACE","\n            ",307],["T_VARIABLE","$success",308],["T_WHITESPACE"," ",308],"=",["T_WHITESPACE"," ",308],["T_STRING","stream_socket_enable_crypto",308],"(",["T_VARIABLE","$this",308],["T_OBJECT_OPERATOR","->",308],["T_STRING","socket",308],",",["T_WHITESPACE"," ",308],["T_STRING","true",308],",",["T_WHITESPACE"," ",308],["T_VARIABLE","$mode",308],")",";",["T_WHITESPACE","\n            ",308],["T_IF","if",309],["T_WHITESPACE"," ",309],"(",["T_VARIABLE","$success",309],")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n                ",309],["T_BREAK","break",310],";",["T_WHITESPACE","\n            ",310],"}",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n\n        ",312],["T_IF","if",314],["T_WHITESPACE"," ",314],"(","!",["T_VARIABLE","$success",314],")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n            ",314],["T_COMMENT","#require_once 'Zend\/Http\/Client\/Adapter\/Exception.php';\n",315],["T_WHITESPACE","            ",316],["T_THROW","throw",316],["T_WHITESPACE"," ",316],["T_NEW","new",316],["T_WHITESPACE"," ",316],["T_STRING","Zend_Http_Client_Adapter_Exception",316],"(",["T_WHITESPACE","\n                ",316],["T_CONSTANT_ENCAPSED_STRING","'Unable to connect to HTTPS server through proxy: could not '",317],["T_WHITESPACE","\n                ",317],".",["T_WHITESPACE"," ",318],["T_CONSTANT_ENCAPSED_STRING","'negotiate secure connection.'",318],["T_WHITESPACE","\n            ",318],")",";",["T_WHITESPACE","\n        ",319],"}",["T_WHITESPACE","\n    ",320],"}",["T_WHITESPACE","\n\n    ",321],["T_DOC_COMMENT","\/**\n     * Close the connection to the server\n     *\n     *\/",323],["T_WHITESPACE","\n    ",326],["T_PUBLIC","public",327],["T_WHITESPACE"," ",327],["T_FUNCTION","function",327],["T_WHITESPACE"," ",327],["T_STRING","close",327],"(",")",["T_WHITESPACE","\n    ",327],"{",["T_WHITESPACE","\n        ",328],["T_STRING","parent",329],["T_DOUBLE_COLON","::",329],["T_STRING","close",329],"(",")",";",["T_WHITESPACE","\n        ",329],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","negotiated",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_STRING","false",330],";",["T_WHITESPACE","\n    ",330],"}",["T_WHITESPACE","\n\n    ",331],["T_DOC_COMMENT","\/**\n     * Destructor: make sure the socket is disconnected\n     *\n     *\/",333],["T_WHITESPACE","\n    ",336],["T_PUBLIC","public",337],["T_WHITESPACE"," ",337],["T_FUNCTION","function",337],["T_WHITESPACE"," ",337],["T_STRING","__destruct",337],"(",")",["T_WHITESPACE","\n    ",337],"{",["T_WHITESPACE","\n        ",338],["T_IF","if",339],["T_WHITESPACE"," ",339],"(",["T_VARIABLE","$this",339],["T_OBJECT_OPERATOR","->",339],["T_STRING","socket",339],")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n            ",339],["T_VARIABLE","$this",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","close",340],"(",")",";",["T_WHITESPACE","\n        ",340],"}",["T_WHITESPACE","\n    ",341],"}",["T_WHITESPACE","\n",342],"}",["T_WHITESPACE","\n",343]]