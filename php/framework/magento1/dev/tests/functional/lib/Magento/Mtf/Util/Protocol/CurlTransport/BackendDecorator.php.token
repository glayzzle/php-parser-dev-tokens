[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Magento\n *\n * NOTICE OF LICENSE\n *\n * This source file is subject to the Open Software License (OSL 3.0)\n * that is bundled with this package in the file LICENSE.txt.\n * It is also available through the world-wide-web at this URL:\n * http:\/\/opensource.org\/licenses\/osl-3.0.php\n * If you did not receive a copy of the license and are unable to\n * obtain it through the world-wide-web, please send an email\n * to license@magento.com so we can send you a copy immediately.\n *\n * DISCLAIMER\n *\n * Do not edit or add to this file if you wish to upgrade Magento to newer\n * versions in the future. If you wish to customize Magento for your\n * needs please refer to http:\/\/www.magento.com for more information.\n *\n * @category    Tests\n * @package     Tests_Functional\n * @copyright  Copyright (c) 2006-2016 X.commerce, Inc. and affiliates (http:\/\/www.magento.com)\n * @license    http:\/\/opensource.org\/licenses\/osl-3.0.php  Open Software License (OSL 3.0)\n *\/",2],["T_WHITESPACE","\n\n\n",25],["T_NAMESPACE","namespace",28],["T_WHITESPACE"," ",28],["T_STRING","Magento",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Mtf",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Util",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Protocol",28],["T_NS_SEPARATOR","\\",28],["T_STRING","CurlTransport",28],";",["T_WHITESPACE","\n\n",28],["T_USE","use",30],["T_WHITESPACE"," ",30],["T_STRING","Magento",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Mtf",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Config",30],["T_NS_SEPARATOR","\\",30],["T_STRING","DataInterface",30],";",["T_WHITESPACE","\n",30],["T_USE","use",31],["T_WHITESPACE"," ",31],["T_STRING","Magento",31],["T_NS_SEPARATOR","\\",31],["T_STRING","Mtf",31],["T_NS_SEPARATOR","\\",31],["T_STRING","Util",31],["T_NS_SEPARATOR","\\",31],["T_STRING","Protocol",31],["T_NS_SEPARATOR","\\",31],["T_STRING","CurlInterface",31],";",["T_WHITESPACE","\n",31],["T_USE","use",32],["T_WHITESPACE"," ",32],["T_STRING","Magento",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Mtf",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Util",32],["T_NS_SEPARATOR","\\",32],["T_STRING","Protocol",32],["T_NS_SEPARATOR","\\",32],["T_STRING","CurlTransport",32],";",["T_WHITESPACE","\n",32],["T_USE","use",33],["T_WHITESPACE"," ",33],["T_STRING","Magento",33],["T_NS_SEPARATOR","\\",33],["T_STRING","Mtf",33],["T_NS_SEPARATOR","\\",33],["T_STRING","System",33],["T_NS_SEPARATOR","\\",33],["T_STRING","Event",33],["T_NS_SEPARATOR","\\",33],["T_STRING","EventManagerInterface",33],";",["T_WHITESPACE","\n\n",33],["T_DOC_COMMENT","\/**\n * Curl transport on backend.\n *\/",35],["T_WHITESPACE","\n",37],["T_CLASS","class",38],["T_WHITESPACE"," ",38],["T_STRING","BackendDecorator",38],["T_WHITESPACE"," ",38],["T_IMPLEMENTS","implements",38],["T_WHITESPACE"," ",38],["T_STRING","CurlInterface",38],["T_WHITESPACE","\n",38],"{",["T_WHITESPACE","\n    ",39],["T_DOC_COMMENT","\/**\n     * Event Manager.\n     *\n     * @var EventManagerInterface\n     *\/",40],["T_WHITESPACE","\n    ",44],["T_PROTECTED","protected",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$eventManager",45],";",["T_WHITESPACE","\n\n    ",45],["T_DOC_COMMENT","\/**\n     * Curl transport protocol.\n     *\n     * @var CurlTransport\n     *\/",47],["T_WHITESPACE","\n    ",51],["T_PROTECTED","protected",52],["T_WHITESPACE"," ",52],["T_VARIABLE","$transport",52],";",["T_WHITESPACE","\n\n    ",52],["T_DOC_COMMENT","\/**\n     * Form key.\n     *\n     * @var string\n     *\/",54],["T_WHITESPACE","\n    ",58],["T_PROTECTED","protected",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$formKey",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","null",59],";",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * Response data.\n     *\n     * @var string\n     *\/",61],["T_WHITESPACE","\n    ",65],["T_PROTECTED","protected",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$response",66],";",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * System config.\n     *\n     * @var DataInterface\n     *\/",68],["T_WHITESPACE","\n    ",72],["T_PROTECTED","protected",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$configuration",73],";",["T_WHITESPACE","\n\n    ",73],["T_DOC_COMMENT","\/**\n     * @constructor\n     * @param CurlTransport $transport\n     * @param DataInterface $configuration\n     *\/",75],["T_WHITESPACE","\n    ",79],["T_PUBLIC","public",80],["T_WHITESPACE"," ",80],["T_FUNCTION","function",80],["T_WHITESPACE"," ",80],["T_STRING","__construct",80],"(",["T_STRING","CurlTransport",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$transport",80],",",["T_WHITESPACE"," ",80],["T_STRING","DataInterface",80],["T_WHITESPACE"," ",80],["T_VARIABLE","$configuration",80],")",["T_WHITESPACE","\n    ",80],"{",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","transport",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$transport",82],";",["T_WHITESPACE","\n        ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","configuration",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$configuration",83],";",["T_WHITESPACE","\n        ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","authorize",84],"(",")",";",["T_WHITESPACE","\n    ",84],"}",["T_WHITESPACE","\n\n    ",85],["T_DOC_COMMENT","\/**\n     * Authorize customer on backend.\n     *\n     * @throws \\Exception\n     * @return void\n     *\/",87],["T_WHITESPACE","\n    ",92],["T_PROTECTED","protected",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","authorize",93],"(",")",["T_WHITESPACE","\n    ",93],"{",["T_WHITESPACE","\n        ",94],["T_COMMENT","\/\/ Perform GET to backend url so form_key is set\n",95],["T_WHITESPACE","        ",96],["T_VARIABLE","$url",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$_ENV",96],"[",["T_CONSTANT_ENCAPSED_STRING","'app_backend_url'",96],"]",";",["T_WHITESPACE","\n        ",96],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","transport",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","write",97],"(",["T_VARIABLE","$url",97],",",["T_WHITESPACE"," ",97],"[","]",",",["T_WHITESPACE"," ",97],["T_STRING","CurlInterface",97],["T_DOUBLE_COLON","::",97],["T_STRING","GET",97],")",";",["T_WHITESPACE","\n        ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","read",98],"(",")",";",["T_WHITESPACE","\n\n        ",98],["T_VARIABLE","$data",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],"[",["T_WHITESPACE","\n            ",100],["T_CONSTANT_ENCAPSED_STRING","'login[username]'",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","configuration",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","get",101],"(",["T_CONSTANT_ENCAPSED_STRING","'application\/0\/backendLogin\/0\/value'",101],")",",",["T_WHITESPACE","\n            ",101],["T_CONSTANT_ENCAPSED_STRING","'login[password]'",102],["T_WHITESPACE"," ",102],["T_DOUBLE_ARROW","=>",102],["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","configuration",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","get",102],"(",["T_CONSTANT_ENCAPSED_STRING","'application\/0\/backendPassword\/0\/value'",102],")",",",["T_WHITESPACE","\n            ",102],["T_CONSTANT_ENCAPSED_STRING","'form_key'",103],["T_WHITESPACE"," ",103],["T_DOUBLE_ARROW","=>",103],["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","formKey",103],",",["T_WHITESPACE","\n        ",103],"]",";",["T_WHITESPACE","\n        ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","transport",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","write",105],"(",["T_VARIABLE","$url",105],",",["T_WHITESPACE"," ",105],["T_VARIABLE","$data",105],",",["T_WHITESPACE"," ",105],["T_STRING","CurlInterface",105],["T_DOUBLE_COLON","::",105],["T_STRING","POST",105],",",["T_WHITESPACE"," ",105],"[","]",")",";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$response",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","read",106],"(",")",";",["T_WHITESPACE","\n\n        ",106],["T_IF","if",108],["T_WHITESPACE"," ",108],"(","!",["T_STRING","strpos",108],"(",["T_VARIABLE","$response",108],",",["T_WHITESPACE"," ",108],["T_CONSTANT_ENCAPSED_STRING","'link-logout'",108],")",")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n            ",108],["T_THROW","throw",109],["T_WHITESPACE"," ",109],["T_NEW","new",109],["T_WHITESPACE"," ",109],["T_NS_SEPARATOR","\\",109],["T_STRING","Exception",109],"(",["T_WHITESPACE","\n                ",109],["T_CONSTANT_ENCAPSED_STRING","\"Admin user cannot be logged in by curl handler!\"",110],["T_WHITESPACE","\n            ",110],")",";",["T_WHITESPACE","\n        ",111],"}",["T_WHITESPACE","\n    ",112],"}",["T_WHITESPACE","\n\n    ",113],["T_DOC_COMMENT","\/**\n     * Init Form Key from response.\n     *\n     * @return void\n     *\/",115],["T_WHITESPACE","\n    ",119],["T_PROTECTED","protected",120],["T_WHITESPACE"," ",120],["T_FUNCTION","function",120],["T_WHITESPACE"," ",120],["T_STRING","initFormKey",120],"(",")",["T_WHITESPACE","\n    ",120],"{",["T_WHITESPACE","\n        ",121],["T_STRING","preg_match",122],"(",["T_CONSTANT_ENCAPSED_STRING","'!var FORM_KEY = \\'(\\w+)\\';!'",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","response",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$matches",122],")",";",["T_WHITESPACE","\n\n        ",122],["T_IF","if",124],["T_WHITESPACE"," ",124],"(","!",["T_EMPTY","empty",124],"(",["T_VARIABLE","$matches",124],"[",["T_LNUMBER","1",124],"]",")",")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","formKey",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$matches",125],"[",["T_LNUMBER","1",125],"]",";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE"," ",126],["T_ELSE","else",126],["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_STRING","preg_match",127],"(",["T_CONSTANT_ENCAPSED_STRING","'!input name=\"form_key\" type=\"hidden\" value=\"(\\w+)\"!'",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","response",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$matches",127],")",";",["T_WHITESPACE","\n            ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(","!",["T_EMPTY","empty",128],"(",["T_VARIABLE","$matches",128],"[",["T_LNUMBER","1",128],"]",")",")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n                ",128],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","formKey",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$matches",129],"[",["T_LNUMBER","1",129],"]",";",["T_WHITESPACE","\n            ",129],"}",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n    ",131],"}",["T_WHITESPACE","\n\n    ",132],["T_DOC_COMMENT","\/**\n     * Send request to the remote server.\n     *\n     * @param string $url\n     * @param mixed $params\n     * @param string $method\n     * @param mixed $headers\n     * @return void\n     * @throws \\Exception\n     *\/",134],["T_WHITESPACE","\n    ",143],["T_PUBLIC","public",144],["T_WHITESPACE"," ",144],["T_FUNCTION","function",144],["T_WHITESPACE"," ",144],["T_STRING","write",144],"(",["T_VARIABLE","$url",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$params",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],"[","]",",",["T_WHITESPACE"," ",144],["T_VARIABLE","$method",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","CurlInterface",144],["T_DOUBLE_COLON","::",144],["T_STRING","POST",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$headers",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],"[","]",")",["T_WHITESPACE","\n    ",144],"{",["T_WHITESPACE","\n        ",145],["T_IF","if",146],["T_WHITESPACE"," ",146],"(",["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","formKey",146],")",["T_WHITESPACE"," ",146],"{",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$params",147],"[",["T_CONSTANT_ENCAPSED_STRING","'form_key'",147],"]",["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","formKey",147],";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE"," ",148],["T_ELSE","else",148],["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n            ",148],["T_THROW","throw",149],["T_WHITESPACE"," ",149],["T_NEW","new",149],["T_WHITESPACE"," ",149],["T_NS_SEPARATOR","\\",149],["T_STRING","Exception",149],"(",["T_STRING","sprintf",149],"(",["T_CONSTANT_ENCAPSED_STRING","'Form key is absent! Url: \"%s\" Response: \"%s\"'",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$url",149],",",["T_WHITESPACE"," ",149],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","response",149],")",")",";",["T_WHITESPACE","\n        ",149],"}",["T_WHITESPACE","\n        ",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","transport",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","write",151],"(",["T_VARIABLE","$url",151],",",["T_WHITESPACE"," ",151],["T_STRING","http_build_query",151],"(",["T_VARIABLE","$params",151],")",",",["T_WHITESPACE"," ",151],["T_VARIABLE","$method",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$headers",151],")",";",["T_WHITESPACE","\n    ",151],"}",["T_WHITESPACE","\n\n    ",152],["T_DOC_COMMENT","\/**\n     * Read response from server.\n     *\n     * @return string\n     *\/",154],["T_WHITESPACE","\n    ",158],["T_PUBLIC","public",159],["T_WHITESPACE"," ",159],["T_FUNCTION","function",159],["T_WHITESPACE"," ",159],["T_STRING","read",159],"(",")",["T_WHITESPACE","\n    ",159],"{",["T_WHITESPACE","\n        ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","response",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","transport",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","read",161],"(",")",";",["T_WHITESPACE","\n        ",161],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","initFormKey",162],"(",")",";",["T_WHITESPACE","\n        ",162],["T_RETURN","return",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","response",163],";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n\n    ",164],["T_DOC_COMMENT","\/**\n     * Add additional option to cURL.\n     *\n     * @param int $option the CURLOPT_* constants\n     * @param mixed $value\n     * @return void\n     *\/",166],["T_WHITESPACE","\n    ",172],["T_PUBLIC","public",173],["T_WHITESPACE"," ",173],["T_FUNCTION","function",173],["T_WHITESPACE"," ",173],["T_STRING","addOption",173],"(",["T_VARIABLE","$option",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$value",173],")",["T_WHITESPACE","\n    ",173],"{",["T_WHITESPACE","\n        ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","transport",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","addOption",175],"(",["T_VARIABLE","$option",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$value",175],")",";",["T_WHITESPACE","\n    ",175],"}",["T_WHITESPACE","\n\n    ",176],["T_DOC_COMMENT","\/**\n     * Close the connection to the server.\n     *\n     * @return void\n     *\/",178],["T_WHITESPACE","\n    ",182],["T_PUBLIC","public",183],["T_WHITESPACE"," ",183],["T_FUNCTION","function",183],["T_WHITESPACE"," ",183],["T_STRING","close",183],"(",")",["T_WHITESPACE","\n    ",183],"{",["T_WHITESPACE","\n        ",184],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","transport",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","close",185],"(",")",";",["T_WHITESPACE","\n    ",185],"}",["T_WHITESPACE","\n",186],"}",["T_WHITESPACE","\n",187]]