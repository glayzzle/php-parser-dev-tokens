[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ModelExtensionPaymentSecureTradingPp",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Model",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\t",2],["T_PUBLIC","public",3],["T_WHITESPACE"," ",3],["T_FUNCTION","function",3],["T_WHITESPACE"," ",3],["T_STRING","getMethod",3],"(",["T_VARIABLE","$address",3],",",["T_WHITESPACE"," ",3],["T_VARIABLE","$total",3],")",["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\t\t",3],["T_VARIABLE","$this",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","load",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","language",4],"(",["T_CONSTANT_ENCAPSED_STRING","'extension\/payment\/securetrading_pp'",4],")",";",["T_WHITESPACE","\n\n\t\t",4],["T_VARIABLE","$query",6],["T_WHITESPACE"," ",6],"=",["T_WHITESPACE"," ",6],["T_VARIABLE","$this",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","db",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","query",6],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",6],["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_STRING","DB_PREFIX",6],["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_CONSTANT_ENCAPSED_STRING","\"zone_to_geo_zone WHERE geo_zone_id = '\"",6],["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_INT_CAST","(int)",6],["T_VARIABLE","$this",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","config",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","get",6],"(",["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp_geo_zone_id'",6],")",["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_CONSTANT_ENCAPSED_STRING","\"' AND country_id = '\"",6],["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_INT_CAST","(int)",6],["T_VARIABLE","$address",6],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",6],"]",["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_CONSTANT_ENCAPSED_STRING","\"' AND (zone_id = '\"",6],["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_INT_CAST","(int)",6],["T_VARIABLE","$address",6],"[",["T_CONSTANT_ENCAPSED_STRING","'zone_id'",6],"]",["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_CONSTANT_ENCAPSED_STRING","\"' OR zone_id = '0')\"",6],")",";",["T_WHITESPACE","\n\n\t\t",6],["T_IF","if",8],["T_WHITESPACE"," ",8],"(",["T_VARIABLE","$this",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","config",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","get",8],"(",["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp_total'",8],")",["T_WHITESPACE"," ",8],">",["T_WHITESPACE"," ",8],["T_VARIABLE","$total",8],")",["T_WHITESPACE"," ",8],"{",["T_WHITESPACE","\n\t\t\t",8],["T_VARIABLE","$status",9],["T_WHITESPACE"," ",9],"=",["T_WHITESPACE"," ",9],["T_STRING","false",9],";",["T_WHITESPACE","\n\t\t",9],"}",["T_WHITESPACE"," ",10],["T_ELSEIF","elseif",10],["T_WHITESPACE"," ",10],"(","!",["T_VARIABLE","$this",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","config",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","get",10],"(",["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp_geo_zone_id'",10],")",")",["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\t\t\t",10],["T_VARIABLE","$status",11],["T_WHITESPACE"," ",11],"=",["T_WHITESPACE"," ",11],["T_STRING","true",11],";",["T_WHITESPACE","\n\t\t",11],"}",["T_WHITESPACE"," ",12],["T_ELSEIF","elseif",12],["T_WHITESPACE"," ",12],"(",["T_VARIABLE","$query",12],["T_OBJECT_OPERATOR","->",12],["T_STRING","num_rows",12],")",["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\t\t\t",12],["T_VARIABLE","$status",13],["T_WHITESPACE"," ",13],"=",["T_WHITESPACE"," ",13],["T_STRING","true",13],";",["T_WHITESPACE","\n\t\t",13],"}",["T_WHITESPACE"," ",14],["T_ELSE","else",14],["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\t\t\t",14],["T_VARIABLE","$status",15],["T_WHITESPACE"," ",15],"=",["T_WHITESPACE"," ",15],["T_STRING","false",15],";",["T_WHITESPACE","\n\t\t",15],"}",["T_WHITESPACE","\n\n\t\t",16],["T_VARIABLE","$method_data",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_ARRAY","array",18],"(",")",";",["T_WHITESPACE","\n\n\t\t",18],["T_IF","if",20],["T_WHITESPACE"," ",20],"(",["T_VARIABLE","$status",20],")",["T_WHITESPACE"," ",20],"{",["T_WHITESPACE","\n\t\t\t",20],["T_VARIABLE","$method_data",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_ARRAY","array",21],"(",["T_WHITESPACE","\n\t\t\t\t",21],["T_CONSTANT_ENCAPSED_STRING","'code'",22],["T_WHITESPACE","       ",22],["T_DOUBLE_ARROW","=>",22],["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp'",22],",",["T_WHITESPACE","\n\t\t\t\t",22],["T_CONSTANT_ENCAPSED_STRING","'title'",23],["T_WHITESPACE","      ",23],["T_DOUBLE_ARROW","=>",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$this",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","language",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","get",23],"(",["T_CONSTANT_ENCAPSED_STRING","'text_title'",23],")",",",["T_WHITESPACE","\n\t\t\t\t",23],["T_CONSTANT_ENCAPSED_STRING","'terms'",24],["T_WHITESPACE","      ",24],["T_DOUBLE_ARROW","=>",24],["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","''",24],",",["T_WHITESPACE","\n\t\t\t\t",24],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",25],["T_WHITESPACE"," ",25],["T_DOUBLE_ARROW","=>",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","config",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","get",25],"(",["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp_sort_order'",25],")",["T_WHITESPACE","\n\t\t\t",25],")",";",["T_WHITESPACE","\n\t\t",26],"}",["T_WHITESPACE","\n\n\t\t",27],["T_RETURN","return",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$method_data",29],";",["T_WHITESPACE","\n\t",29],"}",["T_WHITESPACE","\n\n\t",30],["T_PUBLIC","public",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","getOrder",32],"(",["T_VARIABLE","$order_id",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n\t\t",32],["T_VARIABLE","$qry",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","db",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","query",33],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",33],["T_WHITESPACE"," ",33],".",["T_WHITESPACE"," ",33],["T_STRING","DB_PREFIX",33],["T_WHITESPACE"," ",33],".",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","\"securetrading_pp_order` WHERE `order_id` = '\"",33],["T_WHITESPACE"," ",33],".",["T_WHITESPACE"," ",33],["T_INT_CAST","(int)",33],["T_VARIABLE","$order_id",33],["T_WHITESPACE"," ",33],".",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","\"' LIMIT 1\"",33],")",";",["T_WHITESPACE","\n\n\t\t",33],["T_RETURN","return",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$qry",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","row",35],";",["T_WHITESPACE","\n\t",35],"}",["T_WHITESPACE","\n\n\t",36],["T_PUBLIC","public",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","editOrder",38],"(",["T_VARIABLE","$order_id",38],",",["T_WHITESPACE"," ",38],["T_VARIABLE","$order",38],")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n\t\t",38],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","query",39],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_STRING","DB_PREFIX",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"order` SET shipping_firstname = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_firstname'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', shipping_lastname = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_lastname'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', shipping_address_1 = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_address_1'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', shipping_address_2 = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_address_2'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', shipping_city = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_city'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', shipping_zone = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_zone'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', shipping_zone_id = \"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_INT_CAST","(int)",39],["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_zone_id'",39],"]",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\", shipping_country = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_country'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', shipping_country_id = \"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_INT_CAST","(int)",39],["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_country_id'",39],"]",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\", shipping_postcode = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'shipping_postcode'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"',  payment_firstname = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_firstname'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', payment_lastname = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_lastname'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', payment_address_1 = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_address_1'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', payment_address_2 = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_address_2'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', payment_city = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_city'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', payment_zone = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_zone'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', payment_zone_id = \"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_INT_CAST","(int)",39],["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_zone_id'",39],"]",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\", payment_country = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_country'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"', payment_country_id = \"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_INT_CAST","(int)",39],["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_country_id'",39],"]",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\", payment_postcode = '\"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","db",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","escape",39],"(",["T_VARIABLE","$order",39],"[",["T_CONSTANT_ENCAPSED_STRING","'payment_postcode'",39],"]",")",["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE order_id = \"",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_INT_CAST","(int)",39],["T_VARIABLE","$order_id",39],")",";",["T_WHITESPACE","\n\t",39],"}",["T_WHITESPACE","\n\n\t",40],["T_PUBLIC","public",42],["T_WHITESPACE"," ",42],["T_FUNCTION","function",42],["T_WHITESPACE"," ",42],["T_STRING","addReference",42],"(",["T_VARIABLE","$order_id",42],",",["T_WHITESPACE"," ",42],["T_VARIABLE","$reference",42],")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n\t\t",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","db",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","query",43],"(",["T_CONSTANT_ENCAPSED_STRING","\"REPLACE INTO \"",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_STRING","DB_PREFIX",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","\"securetrading_pp_order SET order_id = \"",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_INT_CAST","(int)",43],["T_VARIABLE","$order_id",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","\", transaction_reference = '\"",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","db",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","escape",43],"(",["T_VARIABLE","$reference",43],")",["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","\"', `created` = now()\"",43],")",";",["T_WHITESPACE","\n\t",43],"}",["T_WHITESPACE","\n\n\t",44],["T_PUBLIC","public",46],["T_WHITESPACE"," ",46],["T_FUNCTION","function",46],["T_WHITESPACE"," ",46],["T_STRING","confirmOrder",46],"(",["T_VARIABLE","$order_id",46],",",["T_WHITESPACE"," ",46],["T_VARIABLE","$order_status_id",46],",",["T_WHITESPACE"," ",46],["T_VARIABLE","$comment",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","''",46],",",["T_WHITESPACE"," ",46],["T_VARIABLE","$notify",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","false",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n\n\t\t",46],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","logger",48],"(",["T_CONSTANT_ENCAPSED_STRING","'confirmOrder'",48],")",";",["T_WHITESPACE","\n\n\t\t",48],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","load",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","model",50],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/order'",50],")",";",["T_WHITESPACE","\n\n\t\t",50],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","db",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","query",52],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_STRING","DB_PREFIX",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","\"order` SET order_status_id = 0 WHERE order_id = \"",52],["T_WHITESPACE","  ",52],".",["T_WHITESPACE"," ",52],["T_INT_CAST","(int)",52],["T_VARIABLE","$order_id",52],")",";",["T_WHITESPACE","\n\n\t\t",52],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","model_checkout_order",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","addOrderHistory",54],"(",["T_VARIABLE","$order_id",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$order_status_id",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$comment",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$notify",54],")",";",["T_WHITESPACE","\n\n\t\t",54],["T_VARIABLE","$order_info",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","model_checkout_order",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","getOrder",56],"(",["T_VARIABLE","$order_id",56],")",";",["T_WHITESPACE","\n\n\t\t",56],["T_VARIABLE","$securetrading_pp_order",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getOrder",58],"(",["T_VARIABLE","$order_id",58],")",";",["T_WHITESPACE","\n\n\t\t",58],["T_VARIABLE","$amount",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","currency",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","format",60],"(",["T_VARIABLE","$order_info",60],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",60],"]",",",["T_WHITESPACE"," ",60],["T_VARIABLE","$order_info",60],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",60],"]",",",["T_WHITESPACE"," ",60],["T_STRING","false",60],",",["T_WHITESPACE"," ",60],["T_STRING","false",60],")",";",["T_WHITESPACE","\n\n\t\t",60],["T_SWITCH","switch",62],"(",["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","config",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","get",62],"(",["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp_settle_status'",62],")",")","{",["T_WHITESPACE","\n\t\t\t",62],["T_CASE","case",63],["T_WHITESPACE"," ",63],["T_LNUMBER","0",63],":",["T_WHITESPACE","\n\t\t\t\t",63],["T_VARIABLE","$trans_type",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'auth'",64],";",["T_WHITESPACE","\n\t\t\t\t",64],["T_BREAK","break",65],";",["T_WHITESPACE","\n\t\t\t",65],["T_CASE","case",66],["T_WHITESPACE"," ",66],["T_LNUMBER","1",66],":",["T_WHITESPACE","\n\t\t\t\t",66],["T_VARIABLE","$trans_type",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'auth'",67],";",["T_WHITESPACE","\n\t\t\t\t",67],["T_BREAK","break",68],";",["T_WHITESPACE","\n\t\t\t",68],["T_CASE","case",69],["T_WHITESPACE"," ",69],["T_LNUMBER","2",69],":",["T_WHITESPACE","\n\t\t\t\t",69],["T_VARIABLE","$trans_type",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'suspended'",70],";",["T_WHITESPACE","\n\t\t\t\t",70],["T_BREAK","break",71],";",["T_WHITESPACE","\n\t\t\t",71],["T_CASE","case",72],["T_WHITESPACE"," ",72],["T_LNUMBER","100",72],":",["T_WHITESPACE","\n\t\t\t\t",72],["T_VARIABLE","$trans_type",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'payment'",73],";",["T_WHITESPACE","\n\t\t\t\t",73],["T_BREAK","break",74],";",["T_WHITESPACE","\n\t\t\t",74],["T_DEFAULT","default",75],["T_WHITESPACE"," ",75],":",["T_WHITESPACE","\n\t\t\t\t",75],["T_VARIABLE","$trans_type",76],["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'default'",76],";",["T_WHITESPACE","\n\t\t",76],"}",["T_WHITESPACE","\n\n\t\t",77],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","db",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","query",79],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_STRING","DB_PREFIX",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","\"securetrading_pp_order` SET `settle_type` = '\"",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","config",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","get",79],"(",["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp_settle_status'",79],")",["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","\"', `modified` = now(), `currency_code` = '\"",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","db",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","escape",79],"(",["T_VARIABLE","$order_info",79],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",79],"]",")",["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","\"', `total` = '\"",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_VARIABLE","$amount",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE order_id = \"",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_INT_CAST","(int)",79],["T_VARIABLE","$order_info",79],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",79],"]",")",";",["T_WHITESPACE","\n\n\t\t",79],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","db",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","query",81],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_STRING","DB_PREFIX",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","\"securetrading_pp_order_transaction` SET `securetrading_pp_order_id` = '\"",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_INT_CAST","(int)",81],["T_VARIABLE","$securetrading_pp_order",81],"[",["T_CONSTANT_ENCAPSED_STRING","'securetrading_pp_order_id'",81],"]",["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","\"', `amount` = '\"",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_VARIABLE","$amount",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","\"', type = '\"",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_VARIABLE","$trans_type",81],["T_WHITESPACE"," ",81],".",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","\"',  `created` = now()\"",81],")",";",["T_WHITESPACE","\n\n\t",81],"}",["T_WHITESPACE","\n\n\t",83],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","updateOrder",85],"(",["T_VARIABLE","$order_id",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$order_status_id",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$comment",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","''",85],",",["T_WHITESPACE"," ",85],["T_VARIABLE","$notify",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","false",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n\t\t",85],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","load",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","model",86],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/order'",86],")",";",["T_WHITESPACE","\n\n\t\t",86],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","db",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","query",88],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_STRING","DB_PREFIX",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","\"order` SET order_status_id = \"",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_INT_CAST","(int)",88],["T_VARIABLE","$order_status_id",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","\" WHERE order_id = \"",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_INT_CAST","(int)",88],["T_VARIABLE","$order_id",88],")",";",["T_WHITESPACE","\n\n\t\t",88],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","model_checkout_order",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","addOrderHistory",90],"(",["T_VARIABLE","$order_id",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$order_status_id",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$comment",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$notify",90],")",";",["T_WHITESPACE","\n\t",90],"}",["T_WHITESPACE","\n\n\t",91],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","getCountry",93],"(",["T_VARIABLE","$iso_code_2",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n\t\t",93],["T_RETURN","return",94],["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","db",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","query",94],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_STRING","DB_PREFIX",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","\"country WHERE LOWER(iso_code_2) = '\"",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","db",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","escape",94],"(",["T_VARIABLE","$iso_code_2",94],")",["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","\"'\"",94],")",["T_OBJECT_OPERATOR","->",94],["T_STRING","row",94],";",["T_WHITESPACE","\n\t",94],"}",["T_WHITESPACE","\n\n\t",95],["T_PUBLIC","public",97],["T_WHITESPACE"," ",97],["T_FUNCTION","function",97],["T_WHITESPACE"," ",97],["T_STRING","logger",97],"(",["T_VARIABLE","$message",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n\t\t",97],["T_VARIABLE","$log",98],["T_WHITESPACE"," ",98],"=",["T_WHITESPACE"," ",98],["T_NEW","new",98],["T_WHITESPACE"," ",98],["T_STRING","Log",98],"(",["T_CONSTANT_ENCAPSED_STRING","'secure.log'",98],")",";",["T_WHITESPACE","\n\t\t",98],["T_VARIABLE","$log",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","write",99],"(",["T_VARIABLE","$message",99],")",";",["T_WHITESPACE","\n\t",99],"}",["T_WHITESPACE","\n",100],"}"]