[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_CLASS","class",3],["T_WHITESPACE"," ",3],["T_STRING","ModelExtensionPaymentWorldpay",3],["T_WHITESPACE"," ",3],["T_EXTENDS","extends",3],["T_WHITESPACE"," ",3],["T_STRING","Model",3],["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\n\t",3],["T_PUBLIC","public",5],["T_WHITESPACE"," ",5],["T_FUNCTION","function",5],["T_WHITESPACE"," ",5],["T_STRING","getMethod",5],"(",["T_VARIABLE","$address",5],",",["T_WHITESPACE"," ",5],["T_VARIABLE","$total",5],")",["T_WHITESPACE"," ",5],"{",["T_WHITESPACE","\n\t\t",5],["T_VARIABLE","$this",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","load",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","language",6],"(",["T_CONSTANT_ENCAPSED_STRING","'extension\/payment\/worldpay'",6],")",";",["T_WHITESPACE","\n\n\t\t",6],["T_VARIABLE","$query",8],["T_WHITESPACE"," ",8],"=",["T_WHITESPACE"," ",8],["T_VARIABLE","$this",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","db",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","query",8],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",8],["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_STRING","DB_PREFIX",8],["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_CONSTANT_ENCAPSED_STRING","\"zone_to_geo_zone WHERE geo_zone_id = '\"",8],["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_INT_CAST","(int)",8],["T_VARIABLE","$this",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","config",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","get",8],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_geo_zone_id'",8],")",["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_CONSTANT_ENCAPSED_STRING","\"' AND country_id = '\"",8],["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_INT_CAST","(int)",8],["T_VARIABLE","$address",8],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",8],"]",["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_CONSTANT_ENCAPSED_STRING","\"' AND (zone_id = '\"",8],["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_INT_CAST","(int)",8],["T_VARIABLE","$address",8],"[",["T_CONSTANT_ENCAPSED_STRING","'zone_id'",8],"]",["T_WHITESPACE"," ",8],".",["T_WHITESPACE"," ",8],["T_CONSTANT_ENCAPSED_STRING","\"' OR zone_id = '0')\"",8],")",";",["T_WHITESPACE","\n\n\t\t",8],["T_IF","if",10],["T_WHITESPACE"," ",10],"(",["T_VARIABLE","$this",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","config",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","get",10],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_total'",10],")",["T_WHITESPACE"," ",10],">",["T_WHITESPACE"," ",10],["T_LNUMBER","0",10],["T_WHITESPACE"," ",10],["T_BOOLEAN_AND","&&",10],["T_WHITESPACE"," ",10],["T_VARIABLE","$this",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","config",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","get",10],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_total'",10],")",["T_WHITESPACE"," ",10],">",["T_WHITESPACE"," ",10],["T_VARIABLE","$total",10],")",["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\t\t\t",10],["T_VARIABLE","$status",11],["T_WHITESPACE"," ",11],"=",["T_WHITESPACE"," ",11],["T_STRING","false",11],";",["T_WHITESPACE","\n\t\t",11],"}",["T_WHITESPACE"," ",12],["T_ELSEIF","elseif",12],["T_WHITESPACE"," ",12],"(","!",["T_VARIABLE","$this",12],["T_OBJECT_OPERATOR","->",12],["T_STRING","config",12],["T_OBJECT_OPERATOR","->",12],["T_STRING","get",12],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_geo_zone_id'",12],")",")",["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\t\t\t",12],["T_VARIABLE","$status",13],["T_WHITESPACE"," ",13],"=",["T_WHITESPACE"," ",13],["T_STRING","true",13],";",["T_WHITESPACE","\n\t\t",13],"}",["T_WHITESPACE"," ",14],["T_ELSEIF","elseif",14],["T_WHITESPACE"," ",14],"(",["T_VARIABLE","$query",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","num_rows",14],")",["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\t\t\t",14],["T_VARIABLE","$status",15],["T_WHITESPACE"," ",15],"=",["T_WHITESPACE"," ",15],["T_STRING","true",15],";",["T_WHITESPACE","\n\t\t",15],"}",["T_WHITESPACE"," ",16],["T_ELSE","else",16],["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n\t\t\t",16],["T_VARIABLE","$status",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_STRING","false",17],";",["T_WHITESPACE","\n\t\t",17],"}",["T_WHITESPACE","\n\n\t\t",18],["T_VARIABLE","$method_data",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_ARRAY","array",20],"(",")",";",["T_WHITESPACE","\n\n\t\t",20],["T_IF","if",22],["T_WHITESPACE"," ",22],"(",["T_VARIABLE","$status",22],")",["T_WHITESPACE"," ",22],"{",["T_WHITESPACE","\n\t\t\t",22],["T_VARIABLE","$method_data",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_ARRAY","array",23],"(",["T_WHITESPACE","\n\t\t\t\t",23],["T_CONSTANT_ENCAPSED_STRING","'code'",24],["T_WHITESPACE"," ",24],["T_DOUBLE_ARROW","=>",24],["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'worldpay'",24],",",["T_WHITESPACE","\n\t\t\t\t",24],["T_CONSTANT_ENCAPSED_STRING","'title'",25],["T_WHITESPACE"," ",25],["T_DOUBLE_ARROW","=>",25],["T_WHITESPACE"," ",25],["T_VARIABLE","$this",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","language",25],["T_OBJECT_OPERATOR","->",25],["T_STRING","get",25],"(",["T_CONSTANT_ENCAPSED_STRING","'text_title'",25],")",",",["T_WHITESPACE","\n\t\t\t\t",25],["T_CONSTANT_ENCAPSED_STRING","'terms'",26],["T_WHITESPACE"," ",26],["T_DOUBLE_ARROW","=>",26],["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","''",26],",",["T_WHITESPACE","\n\t\t\t\t",26],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",27],["T_WHITESPACE"," ",27],["T_DOUBLE_ARROW","=>",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","config",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","get",27],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_sort_order'",27],")",["T_WHITESPACE","\n\t\t\t",27],")",";",["T_WHITESPACE","\n\t\t",28],"}",["T_WHITESPACE","\n\n\t\t",29],["T_RETURN","return",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$method_data",31],";",["T_WHITESPACE","\n\t",31],"}",["T_WHITESPACE","\n\n\t",32],["T_PUBLIC","public",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","getCards",34],"(",["T_VARIABLE","$customer_id",34],")",["T_WHITESPACE"," ",34],"{",["T_WHITESPACE","\n\n\t\t",34],["T_VARIABLE","$query",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","db",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","query",36],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",36],["T_WHITESPACE"," ",36],".",["T_WHITESPACE"," ",36],["T_STRING","DB_PREFIX",36],["T_WHITESPACE"," ",36],".",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_card WHERE customer_id = '\"",36],["T_WHITESPACE"," ",36],".",["T_WHITESPACE"," ",36],["T_INT_CAST","(int)",36],["T_VARIABLE","$customer_id",36],["T_WHITESPACE"," ",36],".",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","\"'\"",36],")",";",["T_WHITESPACE","\n\n\t\t",36],["T_VARIABLE","$card_data",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",")",";",["T_WHITESPACE","\n\n\t\t",38],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","load",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","model",40],"(",["T_CONSTANT_ENCAPSED_STRING","'account\/address'",40],")",";",["T_WHITESPACE","\n\n\t\t",40],["T_FOREACH","foreach",42],["T_WHITESPACE"," ",42],"(",["T_VARIABLE","$query",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","rows",42],["T_WHITESPACE"," ",42],["T_AS","as",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$row",42],")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n\n\t\t\t",42],["T_VARIABLE","$card_data",44],"[","]",["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_ARRAY","array",44],"(",["T_WHITESPACE","\n\t\t\t\t",44],["T_CONSTANT_ENCAPSED_STRING","'card_id'",45],["T_WHITESPACE"," ",45],["T_DOUBLE_ARROW","=>",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$row",45],"[",["T_CONSTANT_ENCAPSED_STRING","'card_id'",45],"]",",",["T_WHITESPACE","\n\t\t\t\t",45],["T_CONSTANT_ENCAPSED_STRING","'customer_id'",46],["T_WHITESPACE"," ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$row",46],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",46],"]",",",["T_WHITESPACE","\n\t\t\t\t",46],["T_CONSTANT_ENCAPSED_STRING","'token'",47],["T_WHITESPACE"," ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$row",47],"[",["T_CONSTANT_ENCAPSED_STRING","'token'",47],"]",",",["T_WHITESPACE","\n\t\t\t\t",47],["T_CONSTANT_ENCAPSED_STRING","'digits'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$row",48],"[",["T_CONSTANT_ENCAPSED_STRING","'digits'",48],"]",",",["T_WHITESPACE","\n\t\t\t\t",48],["T_CONSTANT_ENCAPSED_STRING","'expiry'",49],["T_WHITESPACE"," ",49],["T_DOUBLE_ARROW","=>",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$row",49],"[",["T_CONSTANT_ENCAPSED_STRING","'expiry'",49],"]",",",["T_WHITESPACE","\n\t\t\t\t",49],["T_CONSTANT_ENCAPSED_STRING","'type'",50],["T_WHITESPACE"," ",50],["T_DOUBLE_ARROW","=>",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$row",50],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",50],"]",",",["T_WHITESPACE","\n\t\t\t",50],")",";",["T_WHITESPACE","\n\t\t",51],"}",["T_WHITESPACE","\n\t\t",52],["T_RETURN","return",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$card_data",53],";",["T_WHITESPACE","\n\t",53],"}",["T_WHITESPACE","\n\n\t",54],["T_PUBLIC","public",56],["T_WHITESPACE"," ",56],["T_FUNCTION","function",56],["T_WHITESPACE"," ",56],["T_STRING","addCard",56],"(",["T_VARIABLE","$order_id",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$card_data",56],")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n\t\t",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","query",57],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT into \"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_STRING","DB_PREFIX",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_card SET customer_id = '\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","escape",57],"(",["T_VARIABLE","$card_data",57],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",57],"]",")",["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"', order_id = '\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","escape",57],"(",["T_VARIABLE","$order_id",57],")",["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"', digits = '\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","escape",57],"(",["T_VARIABLE","$card_data",57],"[",["T_CONSTANT_ENCAPSED_STRING","'Last4Digits'",57],"]",")",["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"', expiry = '\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","escape",57],"(",["T_VARIABLE","$card_data",57],"[",["T_CONSTANT_ENCAPSED_STRING","'ExpiryDate'",57],"]",")",["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"', type = '\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","escape",57],"(",["T_VARIABLE","$card_data",57],"[",["T_CONSTANT_ENCAPSED_STRING","'CardType'",57],"]",")",["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"', token = '\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","escape",57],"(",["T_VARIABLE","$card_data",57],"[",["T_CONSTANT_ENCAPSED_STRING","'Token'",57],"]",")",["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"'\"",57],")",";",["T_WHITESPACE","\n\t",57],"}",["T_WHITESPACE","\n\n\t",58],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","deleteCard",60],"(",["T_VARIABLE","$token",60],")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n\t\t",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","db",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","query",61],"(",["T_CONSTANT_ENCAPSED_STRING","\"DELETE FROM \"",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_STRING","DB_PREFIX",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_card WHERE customer_id = '\"",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","customer",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","isLogged",61],"(",")",["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","\"' AND token = '\"",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","db",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","escape",61],"(",["T_VARIABLE","$token",61],")",["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","\"'\"",61],")",";",["T_WHITESPACE","\n\n\t\t",61],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","db",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","countAffected",63],"(",")",["T_WHITESPACE"," ",63],">",["T_WHITESPACE"," ",63],["T_LNUMBER","0",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n\t\t\t",63],["T_RETURN","return",64],["T_WHITESPACE"," ",64],["T_STRING","true",64],";",["T_WHITESPACE","\n\t\t",64],"}",["T_WHITESPACE"," ",65],["T_ELSE","else",65],["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n\t\t\t",65],["T_RETURN","return",66],["T_WHITESPACE"," ",66],["T_STRING","false",66],";",["T_WHITESPACE","\n\t\t",66],"}",["T_WHITESPACE","\n\t",67],"}",["T_WHITESPACE","\n\n\t",68],["T_PUBLIC","public",70],["T_WHITESPACE"," ",70],["T_FUNCTION","function",70],["T_WHITESPACE"," ",70],["T_STRING","addOrder",70],"(",["T_VARIABLE","$order_info",70],",",["T_WHITESPACE"," ",70],["T_VARIABLE","$order_code",70],")",["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n\t\t",70],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","db",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","query",71],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_STRING","DB_PREFIX",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order` SET `order_id` = '\"",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_INT_CAST","(int)",71],["T_VARIABLE","$order_info",71],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",71],"]",["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","\"', `order_code` = '\"",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","db",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","escape",71],"(",["T_VARIABLE","$order_code",71],")",["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","\"', `date_added` = now(), `date_modified` = now(), `currency_code` = '\"",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","db",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","escape",71],"(",["T_VARIABLE","$order_info",71],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",71],"]",")",["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","\"', `total` = '\"",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","currency",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","format",71],"(",["T_VARIABLE","$order_info",71],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",71],"]",",",["T_WHITESPACE"," ",71],["T_VARIABLE","$order_info",71],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",71],"]",",",["T_WHITESPACE"," ",71],["T_STRING","false",71],",",["T_WHITESPACE"," ",71],["T_STRING","false",71],")",["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","\"'\"",71],")",";",["T_WHITESPACE","\n\n\t\t",71],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","db",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","getLastId",73],"(",")",";",["T_WHITESPACE","\n\t",73],"}",["T_WHITESPACE","\n\n\t",74],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","getOrder",76],"(",["T_VARIABLE","$order_id",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n\t\t",76],["T_VARIABLE","$qry",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","db",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","query",77],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",77],["T_WHITESPACE"," ",77],".",["T_WHITESPACE"," ",77],["T_STRING","DB_PREFIX",77],["T_WHITESPACE"," ",77],".",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order` WHERE `order_id` = '\"",77],["T_WHITESPACE"," ",77],".",["T_WHITESPACE"," ",77],["T_INT_CAST","(int)",77],["T_VARIABLE","$order_id",77],["T_WHITESPACE"," ",77],".",["T_WHITESPACE"," ",77],["T_CONSTANT_ENCAPSED_STRING","\"' LIMIT 1\"",77],")",";",["T_WHITESPACE","\n\n\t\t",77],["T_IF","if",79],["T_WHITESPACE"," ",79],"(",["T_VARIABLE","$qry",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","num_rows",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n\t\t\t",79],["T_VARIABLE","$order",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$qry",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","row",80],";",["T_WHITESPACE","\n\t\t\t",80],["T_VARIABLE","$order",81],"[",["T_CONSTANT_ENCAPSED_STRING","'transactions'",81],"]",["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getTransactions",81],"(",["T_VARIABLE","$order",81],"[",["T_CONSTANT_ENCAPSED_STRING","'worldpay_order_id'",81],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",81],["T_RETURN","return",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$order",83],";",["T_WHITESPACE","\n\t\t",83],"}",["T_WHITESPACE"," ",84],["T_ELSE","else",84],["T_WHITESPACE"," ",84],"{",["T_WHITESPACE","\n\t\t\t",84],["T_RETURN","return",85],["T_WHITESPACE"," ",85],["T_STRING","false",85],";",["T_WHITESPACE","\n\t\t",85],"}",["T_WHITESPACE","\n\t",86],"}",["T_WHITESPACE","\n\n\t",87],["T_PUBLIC","public",89],["T_WHITESPACE"," ",89],["T_FUNCTION","function",89],["T_WHITESPACE"," ",89],["T_STRING","addTransaction",89],"(",["T_VARIABLE","$worldpay_order_id",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$type",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$order_info",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n\t\t",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","db",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","query",90],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_STRING","DB_PREFIX",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order_transaction` SET `worldpay_order_id` = '\"",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_INT_CAST","(int)",90],["T_VARIABLE","$worldpay_order_id",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","\"', `date_added` = now(), `type` = '\"",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","db",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","escape",90],"(",["T_VARIABLE","$type",90],")",["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","\"', `amount` = '\"",90],["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","currency",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","format",90],"(",["T_VARIABLE","$order_info",90],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",90],"]",",",["T_WHITESPACE"," ",90],["T_VARIABLE","$order_info",90],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",90],"]",",",["T_WHITESPACE"," ",90],["T_STRING","false",90],",",["T_WHITESPACE"," ",90],["T_STRING","false",90],")",["T_WHITESPACE"," ",90],".",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","\"'\"",90],")",";",["T_WHITESPACE","\n\t",90],"}",["T_WHITESPACE","\n\n\t",91],["T_PUBLIC","public",93],["T_WHITESPACE"," ",93],["T_FUNCTION","function",93],["T_WHITESPACE"," ",93],["T_STRING","getTransactions",93],"(",["T_VARIABLE","$worldpay_order_id",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n\t\t",93],["T_VARIABLE","$qry",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","db",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","query",94],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_STRING","DB_PREFIX",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order_transaction` WHERE `worldpay_order_id` = '\"",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_INT_CAST","(int)",94],["T_VARIABLE","$worldpay_order_id",94],["T_WHITESPACE"," ",94],".",["T_WHITESPACE"," ",94],["T_CONSTANT_ENCAPSED_STRING","\"'\"",94],")",";",["T_WHITESPACE","\n\n\t\t",94],["T_IF","if",96],["T_WHITESPACE"," ",96],"(",["T_VARIABLE","$qry",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","num_rows",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n\t\t\t",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$qry",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","rows",97],";",["T_WHITESPACE","\n\t\t",97],"}",["T_WHITESPACE"," ",98],["T_ELSE","else",98],["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n\t\t\t",98],["T_RETURN","return",99],["T_WHITESPACE"," ",99],["T_STRING","false",99],";",["T_WHITESPACE","\n\t\t",99],"}",["T_WHITESPACE","\n\t",100],"}",["T_WHITESPACE","\n\n\t",101],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","recurringPayment",103],"(",["T_VARIABLE","$item",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$order_id_rand",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$token",103],")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n\n\t\t",103],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","load",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","model",105],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/recurring'",105],")",";",["T_WHITESPACE","\n\t\t",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","load",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","model",106],"(",["T_CONSTANT_ENCAPSED_STRING","'extension\/payment\/worldpay'",106],")",";",["T_WHITESPACE","\n\t\t",106],["T_COMMENT","\/\/trial information\n",107],["T_WHITESPACE","\t\t",108],["T_IF","if",108],["T_WHITESPACE"," ",108],"(",["T_VARIABLE","$item",108],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",108],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial'",108],"]",["T_WHITESPACE"," ",108],["T_IS_EQUAL","==",108],["T_WHITESPACE"," ",108],["T_LNUMBER","1",108],")",["T_WHITESPACE"," ",108],"{",["T_WHITESPACE","\n\t\t\t",108],["T_VARIABLE","$price",109],["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_VARIABLE","$item",109],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",109],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_price'",109],"]",";",["T_WHITESPACE","\n\t\t\t",109],["T_VARIABLE","$trial_amt",110],["T_WHITESPACE"," ",110],"=",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","currency",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","format",110],"(",["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","tax",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","calculate",110],"(",["T_VARIABLE","$item",110],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",110],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_price'",110],"]",",",["T_WHITESPACE"," ",110],["T_VARIABLE","$item",110],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",110],"]",",",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","config",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","get",110],"(",["T_CONSTANT_ENCAPSED_STRING","'config_tax'",110],")",")",",",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","session",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","data",110],"[",["T_CONSTANT_ENCAPSED_STRING","'currency'",110],"]",",",["T_WHITESPACE"," ",110],["T_STRING","false",110],",",["T_WHITESPACE"," ",110],["T_STRING","false",110],")",["T_WHITESPACE"," ",110],"*",["T_WHITESPACE"," ",110],["T_VARIABLE","$item",110],"[",["T_CONSTANT_ENCAPSED_STRING","'quantity'",110],"]",["T_WHITESPACE"," ",110],".",["T_WHITESPACE"," ",110],["T_CONSTANT_ENCAPSED_STRING","' '",110],["T_WHITESPACE"," ",110],".",["T_WHITESPACE"," ",110],["T_VARIABLE","$this",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","session",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","data",110],"[",["T_CONSTANT_ENCAPSED_STRING","'currency'",110],"]",";",["T_WHITESPACE","\n\t\t\t",110],["T_VARIABLE","$trial_text",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_STRING","sprintf",111],"(",["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","language",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","get",111],"(",["T_CONSTANT_ENCAPSED_STRING","'text_trial'",111],")",",",["T_WHITESPACE"," ",111],["T_VARIABLE","$trial_amt",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$item",111],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",111],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_cycle'",111],"]",",",["T_WHITESPACE"," ",111],["T_VARIABLE","$item",111],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",111],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_frequency'",111],"]",",",["T_WHITESPACE"," ",111],["T_VARIABLE","$item",111],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",111],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_duration'",111],"]",")",";",["T_WHITESPACE","\n\t\t",111],"}",["T_WHITESPACE"," ",112],["T_ELSE","else",112],["T_WHITESPACE"," ",112],"{",["T_WHITESPACE","\n\t\t\t",112],["T_VARIABLE","$price",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$item",113],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",113],"]","[",["T_CONSTANT_ENCAPSED_STRING","'price'",113],"]",";",["T_WHITESPACE","\n\t\t\t",113],["T_VARIABLE","$trial_text",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","''",114],";",["T_WHITESPACE","\n\t\t",114],"}",["T_WHITESPACE","\n\n\t\t",115],["T_VARIABLE","$recurring_amt",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","currency",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","format",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","tax",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","calculate",117],"(",["T_VARIABLE","$item",117],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",117],"]","[",["T_CONSTANT_ENCAPSED_STRING","'price'",117],"]",",",["T_WHITESPACE"," ",117],["T_VARIABLE","$item",117],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",117],"]",",",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","config",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","get",117],"(",["T_CONSTANT_ENCAPSED_STRING","'config_tax'",117],")",")",",",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","session",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","data",117],"[",["T_CONSTANT_ENCAPSED_STRING","'currency'",117],"]",",",["T_WHITESPACE"," ",117],["T_STRING","false",117],",",["T_WHITESPACE"," ",117],["T_STRING","false",117],")",["T_WHITESPACE"," ",117],"*",["T_WHITESPACE"," ",117],["T_VARIABLE","$item",117],"[",["T_CONSTANT_ENCAPSED_STRING","'quantity'",117],"]",["T_WHITESPACE"," ",117],".",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","' '",117],["T_WHITESPACE"," ",117],".",["T_WHITESPACE"," ",117],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","session",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","data",117],"[",["T_CONSTANT_ENCAPSED_STRING","'currency'",117],"]",";",["T_WHITESPACE","\n\t\t",117],["T_VARIABLE","$recurring_description",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$trial_text",118],["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_STRING","sprintf",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","language",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","get",118],"(",["T_CONSTANT_ENCAPSED_STRING","'text_recurring'",118],")",",",["T_WHITESPACE"," ",118],["T_VARIABLE","$recurring_amt",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$item",118],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",118],"]","[",["T_CONSTANT_ENCAPSED_STRING","'cycle'",118],"]",",",["T_WHITESPACE"," ",118],["T_VARIABLE","$item",118],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",118],"]","[",["T_CONSTANT_ENCAPSED_STRING","'frequency'",118],"]",")",";",["T_WHITESPACE","\n\n\t\t",118],["T_IF","if",120],["T_WHITESPACE"," ",120],"(",["T_VARIABLE","$item",120],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",120],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",120],"]",["T_WHITESPACE"," ",120],">",["T_WHITESPACE"," ",120],["T_LNUMBER","0",120],")",["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n\t\t\t",120],["T_VARIABLE","$recurring_description",121],["T_WHITESPACE"," ",121],["T_CONCAT_EQUAL",".=",121],["T_WHITESPACE"," ",121],["T_STRING","sprintf",121],"(",["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","language",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","get",121],"(",["T_CONSTANT_ENCAPSED_STRING","'text_length'",121],")",",",["T_WHITESPACE"," ",121],["T_VARIABLE","$item",121],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",121],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",121],"]",")",";",["T_WHITESPACE","\n\t\t",121],"}",["T_WHITESPACE","\n\n\t\t",122],["T_VARIABLE","$order_recurring_id",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","model_checkout_recurring",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","create",124],"(",["T_VARIABLE","$item",124],",",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","session",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","data",124],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",124],"]",",",["T_WHITESPACE"," ",124],["T_VARIABLE","$recurring_description",124],")",";",["T_WHITESPACE","\n\t\t",124],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","model_checkout_recurring",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","addReference",125],"(",["T_VARIABLE","$order_recurring_id",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$order_id_rand",125],")",";",["T_WHITESPACE","\n\n\t\t",125],["T_VARIABLE","$order_info",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","model_checkout_order",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getOrder",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","session",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","data",127],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",127],"]",")",";",["T_WHITESPACE","\n\n\t\t",127],["T_VARIABLE","$order",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_ARRAY","array",129],"(",["T_WHITESPACE","\n\t\t\t",129],["T_CONSTANT_ENCAPSED_STRING","\"token\"",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$token",130],",",["T_WHITESPACE","\n\t\t\t",130],["T_CONSTANT_ENCAPSED_STRING","\"orderType\"",131],["T_WHITESPACE"," ",131],["T_DOUBLE_ARROW","=>",131],["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'RECURRING'",131],",",["T_WHITESPACE","\n\t\t\t",131],["T_CONSTANT_ENCAPSED_STRING","\"amount\"",132],["T_WHITESPACE"," ",132],["T_DOUBLE_ARROW","=>",132],["T_WHITESPACE"," ",132],["T_INT_CAST","(int)",132],"(",["T_VARIABLE","$price",132],["T_WHITESPACE"," ",132],"*",["T_WHITESPACE"," ",132],["T_LNUMBER","100",132],")",",",["T_WHITESPACE","\n\t\t\t",132],["T_CONSTANT_ENCAPSED_STRING","\"currencyCode\"",133],["T_WHITESPACE"," ",133],["T_DOUBLE_ARROW","=>",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$order_info",133],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",133],"]",",",["T_WHITESPACE","\n\t\t\t",133],["T_CONSTANT_ENCAPSED_STRING","\"name\"",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$order_info",134],"[",["T_CONSTANT_ENCAPSED_STRING","'firstname'",134],"]",["T_WHITESPACE"," ",134],".",["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","' '",134],["T_WHITESPACE"," ",134],".",["T_WHITESPACE"," ",134],["T_VARIABLE","$order_info",134],"[",["T_CONSTANT_ENCAPSED_STRING","'lastname'",134],"]",",",["T_WHITESPACE","\n\t\t\t",134],["T_CONSTANT_ENCAPSED_STRING","\"orderDescription\"",135],["T_WHITESPACE"," ",135],["T_DOUBLE_ARROW","=>",135],["T_WHITESPACE"," ",135],["T_VARIABLE","$order_info",135],"[",["T_CONSTANT_ENCAPSED_STRING","'store_name'",135],"]",["T_WHITESPACE"," ",135],".",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","' - '",135],["T_WHITESPACE"," ",135],".",["T_WHITESPACE"," ",135],["T_STRING","date",135],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",135],")",",",["T_WHITESPACE","\n\t\t\t",135],["T_CONSTANT_ENCAPSED_STRING","\"customerOrderCode\"",136],["T_WHITESPACE"," ",136],["T_DOUBLE_ARROW","=>",136],["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'orderRecurring-'",136],["T_WHITESPACE"," ",136],".",["T_WHITESPACE"," ",136],["T_VARIABLE","$order_recurring_id",136],["T_WHITESPACE","\n\t\t",136],")",";",["T_WHITESPACE","\n\n\t\t",137],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","model_extension_payment_worldpay",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","logger",139],"(",["T_VARIABLE","$order",139],")",";",["T_WHITESPACE","\n\n\t\t",139],["T_VARIABLE","$response_data",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","model_extension_payment_worldpay",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","sendCurl",141],"(",["T_CONSTANT_ENCAPSED_STRING","'orders'",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$order",141],")",";",["T_WHITESPACE","\n\n\t\t",141],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","model_extension_payment_worldpay",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","logger",143],"(",["T_VARIABLE","$response_data",143],")",";",["T_WHITESPACE","\n\n\t\t",143],["T_VARIABLE","$next_payment",145],["T_WHITESPACE"," ",145],"=",["T_WHITESPACE"," ",145],["T_NEW","new",145],["T_WHITESPACE"," ",145],["T_STRING","DateTime",145],"(",["T_CONSTANT_ENCAPSED_STRING","'now'",145],")",";",["T_WHITESPACE","\n\t\t",145],["T_VARIABLE","$trial_end",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_NEW","new",146],["T_WHITESPACE"," ",146],["T_STRING","DateTime",146],"(",["T_CONSTANT_ENCAPSED_STRING","'now'",146],")",";",["T_WHITESPACE","\n\t\t",146],["T_VARIABLE","$subscription_end",147],["T_WHITESPACE"," ",147],"=",["T_WHITESPACE"," ",147],["T_NEW","new",147],["T_WHITESPACE"," ",147],["T_STRING","DateTime",147],"(",["T_CONSTANT_ENCAPSED_STRING","'now'",147],")",";",["T_WHITESPACE","\n\n\t\t",147],["T_IF","if",149],["T_WHITESPACE"," ",149],"(",["T_VARIABLE","$item",149],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",149],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial'",149],"]",["T_WHITESPACE"," ",149],["T_IS_EQUAL","==",149],["T_WHITESPACE"," ",149],["T_LNUMBER","1",149],["T_WHITESPACE"," ",149],["T_BOOLEAN_AND","&&",149],["T_WHITESPACE"," ",149],["T_VARIABLE","$item",149],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",149],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_duration'",149],"]",["T_WHITESPACE"," ",149],["T_IS_NOT_EQUAL","!=",149],["T_WHITESPACE"," ",149],["T_LNUMBER","0",149],")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n\t\t\t",149],["T_VARIABLE","$next_payment",150],["T_WHITESPACE"," ",150],"=",["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","calculateSchedule",150],"(",["T_VARIABLE","$item",150],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",150],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_frequency'",150],"]",",",["T_WHITESPACE"," ",150],["T_VARIABLE","$next_payment",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$item",150],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",150],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_cycle'",150],"]",")",";",["T_WHITESPACE","\n\t\t\t",150],["T_VARIABLE","$trial_end",151],["T_WHITESPACE"," ",151],"=",["T_WHITESPACE"," ",151],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","calculateSchedule",151],"(",["T_VARIABLE","$item",151],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",151],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_frequency'",151],"]",",",["T_WHITESPACE"," ",151],["T_VARIABLE","$trial_end",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$item",151],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",151],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_cycle'",151],"]",["T_WHITESPACE"," ",151],"*",["T_WHITESPACE"," ",151],["T_VARIABLE","$item",151],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",151],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_duration'",151],"]",")",";",["T_WHITESPACE","\n\t\t",151],"}",["T_WHITESPACE"," ",152],["T_ELSEIF","elseif",152],["T_WHITESPACE"," ",152],"(",["T_VARIABLE","$item",152],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",152],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial'",152],"]",["T_WHITESPACE"," ",152],["T_IS_EQUAL","==",152],["T_WHITESPACE"," ",152],["T_LNUMBER","1",152],")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n\t\t\t",152],["T_VARIABLE","$next_payment",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$this",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","calculateSchedule",153],"(",["T_VARIABLE","$item",153],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",153],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_frequency'",153],"]",",",["T_WHITESPACE"," ",153],["T_VARIABLE","$next_payment",153],",",["T_WHITESPACE"," ",153],["T_VARIABLE","$item",153],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",153],"]","[",["T_CONSTANT_ENCAPSED_STRING","'trial_cycle'",153],"]",")",";",["T_WHITESPACE","\n\t\t\t",153],["T_VARIABLE","$trial_end",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_NEW","new",154],["T_WHITESPACE"," ",154],["T_STRING","DateTime",154],"(",["T_CONSTANT_ENCAPSED_STRING","'0000-00-00'",154],")",";",["T_WHITESPACE","\n\t\t",154],"}",["T_WHITESPACE","\n\n\t\t",155],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_VARIABLE","$trial_end",157],["T_WHITESPACE"," ",157],">",["T_WHITESPACE"," ",157],["T_VARIABLE","$subscription_end",157],["T_WHITESPACE"," ",157],["T_BOOLEAN_AND","&&",157],["T_WHITESPACE"," ",157],["T_VARIABLE","$item",157],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",157],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",157],"]",["T_WHITESPACE"," ",157],["T_IS_NOT_EQUAL","!=",157],["T_WHITESPACE"," ",157],["T_LNUMBER","0",157],")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n\t\t\t",157],["T_VARIABLE","$subscription_end",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_NEW","new",158],["T_WHITESPACE"," ",158],["T_STRING","DateTime",158],"(",["T_STRING","date_format",158],"(",["T_VARIABLE","$trial_end",158],",",["T_WHITESPACE"," ",158],["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",158],")",")",";",["T_WHITESPACE","\n\t\t\t",158],["T_VARIABLE","$subscription_end",159],["T_WHITESPACE"," ",159],"=",["T_WHITESPACE"," ",159],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","calculateSchedule",159],"(",["T_VARIABLE","$item",159],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",159],"]","[",["T_CONSTANT_ENCAPSED_STRING","'frequency'",159],"]",",",["T_WHITESPACE"," ",159],["T_VARIABLE","$subscription_end",159],",",["T_WHITESPACE"," ",159],["T_VARIABLE","$item",159],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",159],"]","[",["T_CONSTANT_ENCAPSED_STRING","'cycle'",159],"]",["T_WHITESPACE"," ",159],"*",["T_WHITESPACE"," ",159],["T_VARIABLE","$item",159],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",159],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",159],"]",")",";",["T_WHITESPACE","\n\t\t",159],"}",["T_WHITESPACE"," ",160],["T_ELSEIF","elseif",160],["T_WHITESPACE"," ",160],"(",["T_VARIABLE","$trial_end",160],["T_WHITESPACE"," ",160],["T_IS_EQUAL","==",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$subscription_end",160],["T_WHITESPACE"," ",160],["T_BOOLEAN_AND","&&",160],["T_WHITESPACE"," ",160],["T_VARIABLE","$item",160],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",160],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",160],"]",["T_WHITESPACE"," ",160],["T_IS_NOT_EQUAL","!=",160],["T_WHITESPACE"," ",160],["T_LNUMBER","0",160],")",["T_WHITESPACE"," ",160],"{",["T_WHITESPACE","\n\t\t\t",160],["T_VARIABLE","$next_payment",161],["T_WHITESPACE"," ",161],"=",["T_WHITESPACE"," ",161],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","calculateSchedule",161],"(",["T_VARIABLE","$item",161],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",161],"]","[",["T_CONSTANT_ENCAPSED_STRING","'frequency'",161],"]",",",["T_WHITESPACE"," ",161],["T_VARIABLE","$next_payment",161],",",["T_WHITESPACE"," ",161],["T_VARIABLE","$item",161],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",161],"]","[",["T_CONSTANT_ENCAPSED_STRING","'cycle'",161],"]",")",";",["T_WHITESPACE","\n\t\t\t",161],["T_VARIABLE","$subscription_end",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","calculateSchedule",162],"(",["T_VARIABLE","$item",162],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",162],"]","[",["T_CONSTANT_ENCAPSED_STRING","'frequency'",162],"]",",",["T_WHITESPACE"," ",162],["T_VARIABLE","$subscription_end",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$item",162],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",162],"]","[",["T_CONSTANT_ENCAPSED_STRING","'cycle'",162],"]",["T_WHITESPACE"," ",162],"*",["T_WHITESPACE"," ",162],["T_VARIABLE","$item",162],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",162],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",162],"]",")",";",["T_WHITESPACE","\n\t\t",162],"}",["T_WHITESPACE"," ",163],["T_ELSEIF","elseif",163],["T_WHITESPACE"," ",163],"(",["T_VARIABLE","$trial_end",163],["T_WHITESPACE"," ",163],">",["T_WHITESPACE"," ",163],["T_VARIABLE","$subscription_end",163],["T_WHITESPACE"," ",163],["T_BOOLEAN_AND","&&",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$item",163],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",163],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",163],"]",["T_WHITESPACE"," ",163],["T_IS_EQUAL","==",163],["T_WHITESPACE"," ",163],["T_LNUMBER","0",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n\t\t\t",163],["T_VARIABLE","$subscription_end",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_NEW","new",164],["T_WHITESPACE"," ",164],["T_STRING","DateTime",164],"(",["T_CONSTANT_ENCAPSED_STRING","'0000-00-00'",164],")",";",["T_WHITESPACE","\n\t\t",164],"}",["T_WHITESPACE"," ",165],["T_ELSEIF","elseif",165],["T_WHITESPACE"," ",165],"(",["T_VARIABLE","$trial_end",165],["T_WHITESPACE"," ",165],["T_IS_EQUAL","==",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$subscription_end",165],["T_WHITESPACE"," ",165],["T_BOOLEAN_AND","&&",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$item",165],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",165],"]","[",["T_CONSTANT_ENCAPSED_STRING","'duration'",165],"]",["T_WHITESPACE"," ",165],["T_IS_EQUAL","==",165],["T_WHITESPACE"," ",165],["T_LNUMBER","0",165],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n\t\t\t",165],["T_VARIABLE","$next_payment",166],["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","calculateSchedule",166],"(",["T_VARIABLE","$item",166],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",166],"]","[",["T_CONSTANT_ENCAPSED_STRING","'frequency'",166],"]",",",["T_WHITESPACE"," ",166],["T_VARIABLE","$next_payment",166],",",["T_WHITESPACE"," ",166],["T_VARIABLE","$item",166],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring'",166],"]","[",["T_CONSTANT_ENCAPSED_STRING","'cycle'",166],"]",")",";",["T_WHITESPACE","\n\t\t\t",166],["T_VARIABLE","$subscription_end",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_NEW","new",167],["T_WHITESPACE"," ",167],["T_STRING","DateTime",167],"(",["T_CONSTANT_ENCAPSED_STRING","'0000-00-00'",167],")",";",["T_WHITESPACE","\n\t\t",167],"}",["T_WHITESPACE","\n\n\t\t",168],["T_IF","if",170],["T_WHITESPACE"," ",170],"(",["T_ISSET","isset",170],"(",["T_VARIABLE","$response_data",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","paymentStatus",170],")",["T_WHITESPACE"," ",170],["T_BOOLEAN_AND","&&",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$response_data",170],["T_OBJECT_OPERATOR","->",170],["T_STRING","paymentStatus",170],["T_WHITESPACE"," ",170],["T_IS_EQUAL","==",170],["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'SUCCESS'",170],")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n\t\t\t",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","addRecurringOrder",171],"(",["T_VARIABLE","$order_info",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$response_data",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","orderCode",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$token",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$price",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$order_recurring_id",171],",",["T_WHITESPACE"," ",171],["T_STRING","date_format",171],"(",["T_VARIABLE","$trial_end",171],",",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",171],")",",",["T_WHITESPACE"," ",171],["T_STRING","date_format",171],"(",["T_VARIABLE","$subscription_end",171],",",["T_WHITESPACE"," ",171],["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",171],")",")",";",["T_WHITESPACE","\n\n\t\t\t",171],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","updateRecurringOrder",173],"(",["T_VARIABLE","$order_recurring_id",173],",",["T_WHITESPACE"," ",173],["T_STRING","date_format",173],"(",["T_VARIABLE","$next_payment",173],",",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",173],")",")",";",["T_WHITESPACE","\n\n\t\t\t",173],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","addProfileTransaction",175],"(",["T_VARIABLE","$order_recurring_id",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$response_data",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","orderCode",175],",",["T_WHITESPACE"," ",175],["T_VARIABLE","$price",175],",",["T_WHITESPACE"," ",175],["T_LNUMBER","1",175],")",";",["T_WHITESPACE","\n\t\t",175],"}",["T_WHITESPACE"," ",176],["T_ELSE","else",176],["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n\t\t\t",176],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","addProfileTransaction",177],"(",["T_VARIABLE","$order_recurring_id",177],",",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","''",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$price",177],",",["T_WHITESPACE"," ",177],["T_LNUMBER","4",177],")",";",["T_WHITESPACE","\n\t\t",177],"}",["T_WHITESPACE","\n\t",178],"}",["T_WHITESPACE","\n\n\t",179],["T_PUBLIC","public",181],["T_WHITESPACE"," ",181],["T_FUNCTION","function",181],["T_WHITESPACE"," ",181],["T_STRING","cronPayment",181],"(",")",["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n\n\t\t",181],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","load",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","model",183],"(",["T_CONSTANT_ENCAPSED_STRING","'account\/order'",183],")",";",["T_WHITESPACE","\n\t\t",183],["T_VARIABLE","$this",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","load",184],["T_OBJECT_OPERATOR","->",184],["T_STRING","model",184],"(",["T_CONSTANT_ENCAPSED_STRING","'checkout\/order'",184],")",";",["T_WHITESPACE","\n\t\t",184],["T_VARIABLE","$profiles",185],["T_WHITESPACE"," ",185],"=",["T_WHITESPACE"," ",185],["T_VARIABLE","$this",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","getProfiles",185],"(",")",";",["T_WHITESPACE","\n\t\t",185],["T_VARIABLE","$cron_data",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_ARRAY","array",186],"(",")",";",["T_WHITESPACE","\n\t\t",186],["T_VARIABLE","$i",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_LNUMBER","1",187],";",["T_WHITESPACE","\n\t\t",187],["T_FOREACH","foreach",188],["T_WHITESPACE"," ",188],"(",["T_VARIABLE","$profiles",188],["T_WHITESPACE"," ",188],["T_AS","as",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$profile",188],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n\t\t\t",188],["T_VARIABLE","$recurring_order",189],["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","getRecurringOrder",189],"(",["T_VARIABLE","$profile",189],"[",["T_CONSTANT_ENCAPSED_STRING","'order_recurring_id'",189],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",189],["T_VARIABLE","$today",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_NEW","new",191],["T_WHITESPACE"," ",191],["T_STRING","DateTime",191],"(",["T_CONSTANT_ENCAPSED_STRING","'now'",191],")",";",["T_WHITESPACE","\n\t\t\t",191],["T_VARIABLE","$unlimited",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_NEW","new",192],["T_WHITESPACE"," ",192],["T_STRING","DateTime",192],"(",["T_CONSTANT_ENCAPSED_STRING","'0000-00-00'",192],")",";",["T_WHITESPACE","\n\t\t\t",192],["T_VARIABLE","$next_payment",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_NEW","new",193],["T_WHITESPACE"," ",193],["T_STRING","DateTime",193],"(",["T_VARIABLE","$recurring_order",193],"[",["T_CONSTANT_ENCAPSED_STRING","'next_payment'",193],"]",")",";",["T_WHITESPACE","\n\t\t\t",193],["T_VARIABLE","$trial_end",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_NEW","new",194],["T_WHITESPACE"," ",194],["T_STRING","DateTime",194],"(",["T_VARIABLE","$recurring_order",194],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_end'",194],"]",")",";",["T_WHITESPACE","\n\t\t\t",194],["T_VARIABLE","$subscription_end",195],["T_WHITESPACE"," ",195],"=",["T_WHITESPACE"," ",195],["T_NEW","new",195],["T_WHITESPACE"," ",195],["T_STRING","DateTime",195],"(",["T_VARIABLE","$recurring_order",195],"[",["T_CONSTANT_ENCAPSED_STRING","'subscription_end'",195],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",195],["T_VARIABLE","$order_info",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","model_checkout_order",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","getOrder",197],"(",["T_VARIABLE","$profile",197],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",197],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",197],["T_IF","if",199],["T_WHITESPACE"," ",199],"(","(",["T_VARIABLE","$today",199],["T_WHITESPACE"," ",199],">",["T_WHITESPACE"," ",199],["T_VARIABLE","$next_payment",199],")",["T_WHITESPACE"," ",199],["T_BOOLEAN_AND","&&",199],["T_WHITESPACE"," ",199],"(",["T_VARIABLE","$trial_end",199],["T_WHITESPACE"," ",199],">",["T_WHITESPACE"," ",199],["T_VARIABLE","$today",199],["T_WHITESPACE"," ",199],["T_BOOLEAN_OR","||",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$trial_end",199],["T_WHITESPACE"," ",199],["T_IS_EQUAL","==",199],["T_WHITESPACE"," ",199],["T_VARIABLE","$unlimited",199],")",")",["T_WHITESPACE"," ",199],"{",["T_WHITESPACE","\n\t\t\t\t",199],["T_VARIABLE","$price",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","currency",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","format",200],"(",["T_VARIABLE","$profile",200],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_price'",200],"]",",",["T_WHITESPACE"," ",200],["T_VARIABLE","$order_info",200],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",200],"]",",",["T_WHITESPACE"," ",200],["T_STRING","false",200],",",["T_WHITESPACE"," ",200],["T_STRING","false",200],")",";",["T_WHITESPACE","\n\t\t\t\t",200],["T_VARIABLE","$frequency",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_VARIABLE","$profile",201],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_frequency'",201],"]",";",["T_WHITESPACE","\n\t\t\t\t",201],["T_VARIABLE","$cycle",202],["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$profile",202],"[",["T_CONSTANT_ENCAPSED_STRING","'trial_cycle'",202],"]",";",["T_WHITESPACE","\n\t\t\t",202],"}",["T_WHITESPACE"," ",203],["T_ELSEIF","elseif",203],["T_WHITESPACE"," ",203],"(","(",["T_VARIABLE","$today",203],["T_WHITESPACE"," ",203],">",["T_WHITESPACE"," ",203],["T_VARIABLE","$next_payment",203],")",["T_WHITESPACE"," ",203],["T_BOOLEAN_AND","&&",203],["T_WHITESPACE"," ",203],"(",["T_VARIABLE","$subscription_end",203],["T_WHITESPACE"," ",203],">",["T_WHITESPACE"," ",203],["T_VARIABLE","$today",203],["T_WHITESPACE"," ",203],["T_BOOLEAN_OR","||",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$subscription_end",203],["T_WHITESPACE"," ",203],["T_IS_EQUAL","==",203],["T_WHITESPACE"," ",203],["T_VARIABLE","$unlimited",203],")",")",["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n\t\t\t\t",203],["T_VARIABLE","$price",204],["T_WHITESPACE"," ",204],"=",["T_WHITESPACE"," ",204],["T_VARIABLE","$this",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","currency",204],["T_OBJECT_OPERATOR","->",204],["T_STRING","format",204],"(",["T_VARIABLE","$profile",204],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring_price'",204],"]",",",["T_WHITESPACE"," ",204],["T_VARIABLE","$order_info",204],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",204],"]",",",["T_WHITESPACE"," ",204],["T_STRING","false",204],",",["T_WHITESPACE"," ",204],["T_STRING","false",204],")",";",["T_WHITESPACE","\n\t\t\t\t",204],["T_VARIABLE","$frequency",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_VARIABLE","$profile",205],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring_frequency'",205],"]",";",["T_WHITESPACE","\n\t\t\t\t",205],["T_VARIABLE","$cycle",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_VARIABLE","$profile",206],"[",["T_CONSTANT_ENCAPSED_STRING","'recurring_cycle'",206],"]",";",["T_WHITESPACE","\n\t\t\t",206],"}",["T_WHITESPACE"," ",207],["T_ELSE","else",207],["T_WHITESPACE"," ",207],"{",["T_WHITESPACE","\n\t\t\t\t",207],["T_CONTINUE","continue",208],";",["T_WHITESPACE","\n\t\t\t",208],"}",["T_WHITESPACE","\n\n\t\t\t",209],["T_VARIABLE","$order",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_ARRAY","array",211],"(",["T_WHITESPACE","\n\t\t\t\t",211],["T_CONSTANT_ENCAPSED_STRING","\"token\"",212],["T_WHITESPACE"," ",212],["T_DOUBLE_ARROW","=>",212],["T_WHITESPACE"," ",212],["T_VARIABLE","$recurring_order",212],"[",["T_CONSTANT_ENCAPSED_STRING","'token'",212],"]",",",["T_WHITESPACE","\n\t\t\t\t",212],["T_CONSTANT_ENCAPSED_STRING","\"orderType\"",213],["T_WHITESPACE"," ",213],["T_DOUBLE_ARROW","=>",213],["T_WHITESPACE"," ",213],["T_CONSTANT_ENCAPSED_STRING","'RECURRING'",213],",",["T_WHITESPACE","\n\t\t\t\t",213],["T_CONSTANT_ENCAPSED_STRING","\"amount\"",214],["T_WHITESPACE"," ",214],["T_DOUBLE_ARROW","=>",214],["T_WHITESPACE"," ",214],["T_INT_CAST","(int)",214],"(",["T_VARIABLE","$price",214],["T_WHITESPACE"," ",214],"*",["T_WHITESPACE"," ",214],["T_LNUMBER","100",214],")",",",["T_WHITESPACE","\n\t\t\t\t",214],["T_CONSTANT_ENCAPSED_STRING","\"currencyCode\"",215],["T_WHITESPACE"," ",215],["T_DOUBLE_ARROW","=>",215],["T_WHITESPACE"," ",215],["T_VARIABLE","$order_info",215],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",215],"]",",",["T_WHITESPACE","\n\t\t\t\t",215],["T_CONSTANT_ENCAPSED_STRING","\"name\"",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$order_info",216],"[",["T_CONSTANT_ENCAPSED_STRING","'firstname'",216],"]",["T_WHITESPACE"," ",216],".",["T_WHITESPACE"," ",216],["T_CONSTANT_ENCAPSED_STRING","' '",216],["T_WHITESPACE"," ",216],".",["T_WHITESPACE"," ",216],["T_VARIABLE","$order_info",216],"[",["T_CONSTANT_ENCAPSED_STRING","'lastname'",216],"]",",",["T_WHITESPACE","\n\t\t\t\t",216],["T_CONSTANT_ENCAPSED_STRING","\"orderDescription\"",217],["T_WHITESPACE"," ",217],["T_DOUBLE_ARROW","=>",217],["T_WHITESPACE"," ",217],["T_VARIABLE","$order_info",217],"[",["T_CONSTANT_ENCAPSED_STRING","'store_name'",217],"]",["T_WHITESPACE"," ",217],".",["T_WHITESPACE"," ",217],["T_CONSTANT_ENCAPSED_STRING","' - '",217],["T_WHITESPACE"," ",217],".",["T_WHITESPACE"," ",217],["T_STRING","date",217],"(",["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",217],")",",",["T_WHITESPACE","\n\t\t\t\t",217],["T_CONSTANT_ENCAPSED_STRING","\"customerOrderCode\"",218],["T_WHITESPACE"," ",218],["T_DOUBLE_ARROW","=>",218],["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","'orderRecurring-'",218],["T_WHITESPACE"," ",218],".",["T_WHITESPACE"," ",218],["T_VARIABLE","$profile",218],"[",["T_CONSTANT_ENCAPSED_STRING","'order_recurring_id'",218],"]",["T_WHITESPACE"," ",218],".",["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","'-repeat-'",218],["T_WHITESPACE"," ",218],".",["T_WHITESPACE"," ",218],["T_VARIABLE","$i",218],["T_INC","++",218],["T_WHITESPACE","\n\t\t\t",218],")",";",["T_WHITESPACE","\n\n\t\t\t",219],["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","model_extension_payment_worldpay",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","logger",221],"(",["T_VARIABLE","$order",221],")",";",["T_WHITESPACE","\n\n\t\t\t",221],["T_VARIABLE","$response_data",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","model_extension_payment_worldpay",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","sendCurl",223],"(",["T_CONSTANT_ENCAPSED_STRING","'orders'",223],",",["T_WHITESPACE"," ",223],["T_VARIABLE","$order",223],")",";",["T_WHITESPACE","\n\n\t\t\t",223],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","model_extension_payment_worldpay",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","logger",225],"(",["T_VARIABLE","$response_data",225],")",";",["T_WHITESPACE","\n\n\t\t\t",225],["T_VARIABLE","$cron_data",227],"[","]",["T_WHITESPACE"," ",227],"=",["T_WHITESPACE"," ",227],["T_VARIABLE","$response_data",227],";",["T_WHITESPACE","\n\n\t\t\t",227],["T_IF","if",229],["T_WHITESPACE"," ",229],"(",["T_ISSET","isset",229],"(",["T_VARIABLE","$response_data",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","paymentStatus",229],")",["T_WHITESPACE"," ",229],["T_BOOLEAN_AND","&&",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$response_data",229],["T_OBJECT_OPERATOR","->",229],["T_STRING","paymentStatus",229],["T_WHITESPACE"," ",229],["T_IS_EQUAL","==",229],["T_WHITESPACE"," ",229],["T_CONSTANT_ENCAPSED_STRING","'SUCCESS'",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n\t\t\t\t",229],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","addProfileTransaction",230],"(",["T_VARIABLE","$profile",230],"[",["T_CONSTANT_ENCAPSED_STRING","'order_recurring_id'",230],"]",",",["T_WHITESPACE"," ",230],["T_VARIABLE","$response_data",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","orderCode",230],",",["T_WHITESPACE"," ",230],["T_VARIABLE","$price",230],",",["T_WHITESPACE"," ",230],["T_LNUMBER","1",230],")",";",["T_WHITESPACE","\n\t\t\t\t",230],["T_VARIABLE","$next_payment",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_VARIABLE","$this",231],["T_OBJECT_OPERATOR","->",231],["T_STRING","calculateSchedule",231],"(",["T_VARIABLE","$frequency",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$next_payment",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$cycle",231],")",";",["T_WHITESPACE","\n\t\t\t\t",231],["T_VARIABLE","$next_payment",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_STRING","date_format",232],"(",["T_VARIABLE","$next_payment",232],",",["T_WHITESPACE"," ",232],["T_CONSTANT_ENCAPSED_STRING","'Y-m-d H:i:s'",232],")",";",["T_WHITESPACE","\n\t\t\t\t",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","updateRecurringOrder",233],"(",["T_VARIABLE","$profile",233],"[",["T_CONSTANT_ENCAPSED_STRING","'order_recurring_id'",233],"]",",",["T_WHITESPACE"," ",233],["T_VARIABLE","$next_payment",233],")",";",["T_WHITESPACE","\n\t\t\t",233],"}",["T_WHITESPACE"," ",234],["T_ELSE","else",234],["T_WHITESPACE"," ",234],"{",["T_WHITESPACE","\n\t\t\t\t",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","addProfileTransaction",235],"(",["T_VARIABLE","$profile",235],"[",["T_CONSTANT_ENCAPSED_STRING","'order_recurring_id'",235],"]",",",["T_WHITESPACE"," ",235],["T_CONSTANT_ENCAPSED_STRING","''",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$price",235],",",["T_WHITESPACE"," ",235],["T_LNUMBER","4",235],")",";",["T_WHITESPACE","\n\t\t\t",235],"}",["T_WHITESPACE","\n\t\t",236],"}",["T_WHITESPACE","\n\t\t",237],["T_VARIABLE","$log",238],["T_WHITESPACE"," ",238],"=",["T_WHITESPACE"," ",238],["T_NEW","new",238],["T_WHITESPACE"," ",238],["T_STRING","Log",238],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_recurring_orders.log'",238],")",";",["T_WHITESPACE","\n\t\t",238],["T_VARIABLE","$log",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","write",239],"(",["T_STRING","print_r",239],"(",["T_VARIABLE","$cron_data",239],",",["T_WHITESPACE"," ",239],["T_LNUMBER","1",239],")",")",";",["T_WHITESPACE","\n\t\t",239],["T_RETURN","return",240],["T_WHITESPACE"," ",240],["T_VARIABLE","$cron_data",240],";",["T_WHITESPACE","\n\t",240],"}",["T_WHITESPACE","\n\n\t",241],["T_PRIVATE","private",243],["T_WHITESPACE"," ",243],["T_FUNCTION","function",243],["T_WHITESPACE"," ",243],["T_STRING","calculateSchedule",243],"(",["T_VARIABLE","$frequency",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$next_payment",243],",",["T_WHITESPACE"," ",243],["T_VARIABLE","$cycle",243],")",["T_WHITESPACE"," ",243],"{",["T_WHITESPACE","\n\t\t",243],["T_IF","if",244],["T_WHITESPACE"," ",244],"(",["T_VARIABLE","$frequency",244],["T_WHITESPACE"," ",244],["T_IS_EQUAL","==",244],["T_WHITESPACE"," ",244],["T_CONSTANT_ENCAPSED_STRING","'semi_month'",244],")",["T_WHITESPACE"," ",244],"{",["T_WHITESPACE","\n\t\t\t",244],["T_VARIABLE","$day",245],["T_WHITESPACE"," ",245],"=",["T_WHITESPACE"," ",245],["T_STRING","date_format",245],"(",["T_VARIABLE","$next_payment",245],",",["T_WHITESPACE"," ",245],["T_CONSTANT_ENCAPSED_STRING","'d'",245],")",";",["T_WHITESPACE","\n\t\t\t",245],["T_VARIABLE","$value",246],["T_WHITESPACE"," ",246],"=",["T_WHITESPACE"," ",246],["T_LNUMBER","15",246],["T_WHITESPACE"," ",246],"-",["T_WHITESPACE"," ",246],["T_VARIABLE","$day",246],";",["T_WHITESPACE","\n\t\t\t",246],["T_VARIABLE","$isEven",247],["T_WHITESPACE"," ",247],"=",["T_WHITESPACE"," ",247],["T_STRING","false",247],";",["T_WHITESPACE","\n\t\t\t",247],["T_IF","if",248],["T_WHITESPACE"," ",248],"(",["T_VARIABLE","$cycle",248],["T_WHITESPACE"," ",248],"%",["T_WHITESPACE"," ",248],["T_LNUMBER","2",248],["T_WHITESPACE"," ",248],["T_IS_EQUAL","==",248],["T_WHITESPACE"," ",248],["T_LNUMBER","0",248],")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n\t\t\t\t",248],["T_VARIABLE","$isEven",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_STRING","true",249],";",["T_WHITESPACE","\n\t\t\t",249],"}",["T_WHITESPACE","\n\n\t\t\t",250],["T_VARIABLE","$odd",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],"(",["T_VARIABLE","$cycle",252],["T_WHITESPACE"," ",252],"+",["T_WHITESPACE"," ",252],["T_LNUMBER","1",252],")",["T_WHITESPACE"," ",252],"\/",["T_WHITESPACE"," ",252],["T_LNUMBER","2",252],";",["T_WHITESPACE","\n\t\t\t",252],["T_VARIABLE","$plus_even",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],"(",["T_VARIABLE","$cycle",253],["T_WHITESPACE"," ",253],"\/",["T_WHITESPACE"," ",253],["T_LNUMBER","2",253],")",["T_WHITESPACE"," ",253],"+",["T_WHITESPACE"," ",253],["T_LNUMBER","1",253],";",["T_WHITESPACE","\n\t\t\t",253],["T_VARIABLE","$minus_even",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$cycle",254],["T_WHITESPACE"," ",254],"\/",["T_WHITESPACE"," ",254],["T_LNUMBER","2",254],";",["T_WHITESPACE","\n\n\t\t\t",254],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_VARIABLE","$day",256],["T_WHITESPACE"," ",256],["T_IS_EQUAL","==",256],["T_WHITESPACE"," ",256],["T_LNUMBER","1",256],")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n\t\t\t\t",256],["T_VARIABLE","$odd",257],["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$odd",257],["T_WHITESPACE"," ",257],"-",["T_WHITESPACE"," ",257],["T_LNUMBER","1",257],";",["T_WHITESPACE","\n\t\t\t\t",257],["T_VARIABLE","$plus_even",258],["T_WHITESPACE"," ",258],"=",["T_WHITESPACE"," ",258],["T_VARIABLE","$plus_even",258],["T_WHITESPACE"," ",258],"-",["T_WHITESPACE"," ",258],["T_LNUMBER","1",258],";",["T_WHITESPACE","\n\t\t\t\t",258],["T_VARIABLE","$day",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_LNUMBER","16",259],";",["T_WHITESPACE","\n\t\t\t",259],"}",["T_WHITESPACE","\n\n\t\t\t",260],["T_IF","if",262],["T_WHITESPACE"," ",262],"(",["T_VARIABLE","$day",262],["T_WHITESPACE"," ",262],["T_IS_SMALLER_OR_EQUAL","<=",262],["T_WHITESPACE"," ",262],["T_LNUMBER","15",262],["T_WHITESPACE"," ",262],["T_BOOLEAN_AND","&&",262],["T_WHITESPACE"," ",262],["T_VARIABLE","$isEven",262],")",["T_WHITESPACE"," ",262],"{",["T_WHITESPACE","\n\t\t\t\t",262],["T_VARIABLE","$next_payment",263],["T_OBJECT_OPERATOR","->",263],["T_STRING","modify",263],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",263],["T_WHITESPACE"," ",263],".",["T_WHITESPACE"," ",263],["T_VARIABLE","$value",263],["T_WHITESPACE"," ",263],".",["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","' day'",263],")",";",["T_WHITESPACE","\n\t\t\t\t",263],["T_VARIABLE","$next_payment",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","modify",264],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",264],["T_WHITESPACE"," ",264],".",["T_WHITESPACE"," ",264],["T_VARIABLE","$minus_even",264],["T_WHITESPACE"," ",264],".",["T_WHITESPACE"," ",264],["T_CONSTANT_ENCAPSED_STRING","' month'",264],")",";",["T_WHITESPACE","\n\t\t\t",264],"}",["T_WHITESPACE"," ",265],["T_ELSEIF","elseif",265],["T_WHITESPACE"," ",265],"(",["T_VARIABLE","$day",265],["T_WHITESPACE"," ",265],["T_IS_SMALLER_OR_EQUAL","<=",265],["T_WHITESPACE"," ",265],["T_LNUMBER","15",265],")",["T_WHITESPACE"," ",265],"{",["T_WHITESPACE","\n\t\t\t\t",265],["T_VARIABLE","$next_payment",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","modify",266],"(",["T_CONSTANT_ENCAPSED_STRING","'first day of this month'",266],")",";",["T_WHITESPACE","\n\t\t\t\t",266],["T_VARIABLE","$next_payment",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","modify",267],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",267],["T_WHITESPACE"," ",267],".",["T_WHITESPACE"," ",267],["T_VARIABLE","$odd",267],["T_WHITESPACE"," ",267],".",["T_WHITESPACE"," ",267],["T_CONSTANT_ENCAPSED_STRING","' month'",267],")",";",["T_WHITESPACE","\n\t\t\t",267],"}",["T_WHITESPACE"," ",268],["T_ELSEIF","elseif",268],["T_WHITESPACE"," ",268],"(",["T_VARIABLE","$day",268],["T_WHITESPACE"," ",268],">",["T_WHITESPACE"," ",268],["T_LNUMBER","15",268],["T_WHITESPACE"," ",268],["T_BOOLEAN_AND","&&",268],["T_WHITESPACE"," ",268],["T_VARIABLE","$isEven",268],")",["T_WHITESPACE"," ",268],"{",["T_WHITESPACE","\n\t\t\t\t",268],["T_VARIABLE","$next_payment",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","modify",269],"(",["T_CONSTANT_ENCAPSED_STRING","'first day of this month'",269],")",";",["T_WHITESPACE","\n\t\t\t\t",269],["T_VARIABLE","$next_payment",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","modify",270],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",270],["T_WHITESPACE"," ",270],".",["T_WHITESPACE"," ",270],["T_VARIABLE","$plus_even",270],["T_WHITESPACE"," ",270],".",["T_WHITESPACE"," ",270],["T_CONSTANT_ENCAPSED_STRING","' month'",270],")",";",["T_WHITESPACE","\n\t\t\t",270],"}",["T_WHITESPACE"," ",271],["T_ELSEIF","elseif",271],["T_WHITESPACE"," ",271],"(",["T_VARIABLE","$day",271],["T_WHITESPACE"," ",271],">",["T_WHITESPACE"," ",271],["T_LNUMBER","15",271],")",["T_WHITESPACE"," ",271],"{",["T_WHITESPACE","\n\t\t\t\t",271],["T_VARIABLE","$next_payment",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","modify",272],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",272],["T_WHITESPACE"," ",272],".",["T_WHITESPACE"," ",272],["T_VARIABLE","$value",272],["T_WHITESPACE"," ",272],".",["T_WHITESPACE"," ",272],["T_CONSTANT_ENCAPSED_STRING","' day'",272],")",";",["T_WHITESPACE","\n\t\t\t\t",272],["T_VARIABLE","$next_payment",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","modify",273],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",273],["T_WHITESPACE"," ",273],".",["T_WHITESPACE"," ",273],["T_VARIABLE","$odd",273],["T_WHITESPACE"," ",273],".",["T_WHITESPACE"," ",273],["T_CONSTANT_ENCAPSED_STRING","' month'",273],")",";",["T_WHITESPACE","\n\t\t\t",273],"}",["T_WHITESPACE","\n\t\t",274],"}",["T_WHITESPACE"," ",275],["T_ELSE","else",275],["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n\t\t\t",275],["T_VARIABLE","$next_payment",276],["T_OBJECT_OPERATOR","->",276],["T_STRING","modify",276],"(",["T_CONSTANT_ENCAPSED_STRING","'+'",276],["T_WHITESPACE"," ",276],".",["T_WHITESPACE"," ",276],["T_VARIABLE","$cycle",276],["T_WHITESPACE"," ",276],".",["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","' '",276],["T_WHITESPACE"," ",276],".",["T_WHITESPACE"," ",276],["T_VARIABLE","$frequency",276],")",";",["T_WHITESPACE","\n\t\t",276],"}",["T_WHITESPACE","\n\t\t",277],["T_RETURN","return",278],["T_WHITESPACE"," ",278],["T_VARIABLE","$next_payment",278],";",["T_WHITESPACE","\n\t",278],"}",["T_WHITESPACE","\n\n\t",279],["T_PRIVATE","private",281],["T_WHITESPACE"," ",281],["T_FUNCTION","function",281],["T_WHITESPACE"," ",281],["T_STRING","addRecurringOrder",281],"(",["T_VARIABLE","$order_info",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$order_code",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$token",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$price",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$order_recurring_id",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$trial_end",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$subscription_end",281],")",["T_WHITESPACE"," ",281],"{",["T_WHITESPACE","\n\t\t",281],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","db",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","query",282],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_STRING","DB_PREFIX",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order_recurring` SET `order_id` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_INT_CAST","(int)",282],["T_VARIABLE","$order_info",282],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",282],"]",["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"', `order_recurring_id` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_INT_CAST","(int)",282],["T_VARIABLE","$order_recurring_id",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"', `order_code` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","db",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","escape",282],"(",["T_VARIABLE","$order_code",282],")",["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"', `token` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","db",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","escape",282],"(",["T_VARIABLE","$token",282],")",["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"', `date_added` = now(), `date_modified` = now(), `next_payment` = now(), `trial_end` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_VARIABLE","$trial_end",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"', `subscription_end` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_VARIABLE","$subscription_end",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"', `currency_code` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","db",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","escape",282],"(",["T_VARIABLE","$order_info",282],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",282],"]",")",["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"', `total` = '\"",282],["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_VARIABLE","$this",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","currency",282],["T_OBJECT_OPERATOR","->",282],["T_STRING","format",282],"(",["T_VARIABLE","$price",282],",",["T_WHITESPACE"," ",282],["T_VARIABLE","$order_info",282],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",282],"]",",",["T_WHITESPACE"," ",282],["T_STRING","false",282],",",["T_WHITESPACE"," ",282],["T_STRING","false",282],")",["T_WHITESPACE"," ",282],".",["T_WHITESPACE"," ",282],["T_CONSTANT_ENCAPSED_STRING","\"'\"",282],")",";",["T_WHITESPACE","\n\t",282],"}",["T_WHITESPACE","\n\n\t",283],["T_PRIVATE","private",285],["T_WHITESPACE"," ",285],["T_FUNCTION","function",285],["T_WHITESPACE"," ",285],["T_STRING","updateRecurringOrder",285],"(",["T_VARIABLE","$order_recurring_id",285],",",["T_WHITESPACE"," ",285],["T_VARIABLE","$next_payment",285],")",["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n\t\t",285],["T_VARIABLE","$this",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","db",286],["T_OBJECT_OPERATOR","->",286],["T_STRING","query",286],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",286],["T_WHITESPACE"," ",286],".",["T_WHITESPACE"," ",286],["T_STRING","DB_PREFIX",286],["T_WHITESPACE"," ",286],".",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order_recurring` SET `next_payment` = '\"",286],["T_WHITESPACE"," ",286],".",["T_WHITESPACE"," ",286],["T_VARIABLE","$next_payment",286],["T_WHITESPACE"," ",286],".",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","\"', `date_modified` = now() WHERE `order_recurring_id` = '\"",286],["T_WHITESPACE"," ",286],".",["T_WHITESPACE"," ",286],["T_INT_CAST","(int)",286],["T_VARIABLE","$order_recurring_id",286],["T_WHITESPACE"," ",286],".",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","\"'\"",286],")",";",["T_WHITESPACE","\n\t",286],"}",["T_WHITESPACE","\n\n\t",287],["T_PRIVATE","private",289],["T_WHITESPACE"," ",289],["T_FUNCTION","function",289],["T_WHITESPACE"," ",289],["T_STRING","getRecurringOrder",289],"(",["T_VARIABLE","$order_recurring_id",289],")",["T_WHITESPACE"," ",289],"{",["T_WHITESPACE","\n\t\t",289],["T_VARIABLE","$qry",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","db",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","query",290],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",290],["T_WHITESPACE"," ",290],".",["T_WHITESPACE"," ",290],["T_STRING","DB_PREFIX",290],["T_WHITESPACE"," ",290],".",["T_WHITESPACE"," ",290],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order_recurring WHERE order_recurring_id = '\"",290],["T_WHITESPACE"," ",290],".",["T_WHITESPACE"," ",290],["T_INT_CAST","(int)",290],["T_VARIABLE","$order_recurring_id",290],["T_WHITESPACE"," ",290],".",["T_WHITESPACE"," ",290],["T_CONSTANT_ENCAPSED_STRING","\"'\"",290],")",";",["T_WHITESPACE","\n\t\t",290],["T_RETURN","return",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$qry",291],["T_OBJECT_OPERATOR","->",291],["T_STRING","row",291],";",["T_WHITESPACE","\n\t",291],"}",["T_WHITESPACE","\n\n\t",292],["T_PRIVATE","private",294],["T_WHITESPACE"," ",294],["T_FUNCTION","function",294],["T_WHITESPACE"," ",294],["T_STRING","addProfileTransaction",294],"(",["T_VARIABLE","$order_recurring_id",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$order_code",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$price",294],",",["T_WHITESPACE"," ",294],["T_VARIABLE","$type",294],")",["T_WHITESPACE"," ",294],"{",["T_WHITESPACE","\n\t\t",294],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","db",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","query",295],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_STRING","DB_PREFIX",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","\"order_recurring_transaction` SET `order_recurring_id` = '\"",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_INT_CAST","(int)",295],["T_VARIABLE","$order_recurring_id",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","\"', `date_added` = NOW(), `amount` = '\"",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_DOUBLE_CAST","(float)",295],["T_VARIABLE","$price",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","\"', `type` = '\"",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_INT_CAST","(int)",295],["T_VARIABLE","$type",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","\"', `reference` = '\"",295],["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_VARIABLE","$this",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","db",295],["T_OBJECT_OPERATOR","->",295],["T_STRING","escape",295],"(",["T_VARIABLE","$order_code",295],")",["T_WHITESPACE"," ",295],".",["T_WHITESPACE"," ",295],["T_CONSTANT_ENCAPSED_STRING","\"'\"",295],")",";",["T_WHITESPACE","\n\t",295],"}",["T_WHITESPACE","\n\n\t",296],["T_PRIVATE","private",298],["T_WHITESPACE"," ",298],["T_FUNCTION","function",298],["T_WHITESPACE"," ",298],["T_STRING","getProfiles",298],"(",")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n\t\t",298],["T_VARIABLE","$sql",299],["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tSELECT `or`.order_recurring_id\n\t\t\tFROM `\"",299],["T_WHITESPACE"," ",301],".",["T_WHITESPACE"," ",301],["T_STRING","DB_PREFIX",301],["T_WHITESPACE"," ",301],".",["T_WHITESPACE"," ",301],["T_CONSTANT_ENCAPSED_STRING","\"order_recurring` `or`\n\t\t\tJOIN `\"",301],["T_WHITESPACE"," ",302],".",["T_WHITESPACE"," ",302],["T_STRING","DB_PREFIX",302],["T_WHITESPACE"," ",302],".",["T_WHITESPACE"," ",302],["T_CONSTANT_ENCAPSED_STRING","\"order` `o` USING(`order_id`)\n\t\t\tWHERE o.payment_code = 'worldpay'\"",302],";",["T_WHITESPACE","\n\n\t\t",303],["T_VARIABLE","$qry",305],["T_WHITESPACE"," ",305],"=",["T_WHITESPACE"," ",305],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","db",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","query",305],"(",["T_VARIABLE","$sql",305],")",";",["T_WHITESPACE","\n\n\t\t",305],["T_VARIABLE","$order_recurring",307],["T_WHITESPACE"," ",307],"=",["T_WHITESPACE"," ",307],["T_ARRAY","array",307],"(",")",";",["T_WHITESPACE","\n\n\t\t",307],["T_FOREACH","foreach",309],["T_WHITESPACE"," ",309],"(",["T_VARIABLE","$qry",309],["T_OBJECT_OPERATOR","->",309],["T_STRING","rows",309],["T_WHITESPACE"," ",309],["T_AS","as",309],["T_WHITESPACE"," ",309],["T_VARIABLE","$profile",309],")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n\t\t\t",309],["T_VARIABLE","$order_recurring",310],"[","]",["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","getProfile",310],"(",["T_VARIABLE","$profile",310],"[",["T_CONSTANT_ENCAPSED_STRING","'order_recurring_id'",310],"]",")",";",["T_WHITESPACE","\n\t\t",310],"}",["T_WHITESPACE","\n\t\t",311],["T_RETURN","return",312],["T_WHITESPACE"," ",312],["T_VARIABLE","$order_recurring",312],";",["T_WHITESPACE","\n\t",312],"}",["T_WHITESPACE","\n\n\t",313],["T_PRIVATE","private",315],["T_WHITESPACE"," ",315],["T_FUNCTION","function",315],["T_WHITESPACE"," ",315],["T_STRING","getProfile",315],"(",["T_VARIABLE","$order_recurring_id",315],")",["T_WHITESPACE"," ",315],"{",["T_WHITESPACE","\n\t\t",315],["T_VARIABLE","$qry",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_VARIABLE","$this",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","db",316],["T_OBJECT_OPERATOR","->",316],["T_STRING","query",316],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",316],["T_WHITESPACE"," ",316],".",["T_WHITESPACE"," ",316],["T_STRING","DB_PREFIX",316],["T_WHITESPACE"," ",316],".",["T_WHITESPACE"," ",316],["T_CONSTANT_ENCAPSED_STRING","\"order_recurring WHERE order_recurring_id = \"",316],["T_WHITESPACE"," ",316],".",["T_WHITESPACE"," ",316],["T_INT_CAST","(int)",316],["T_VARIABLE","$order_recurring_id",316],")",";",["T_WHITESPACE","\n\t\t",316],["T_RETURN","return",317],["T_WHITESPACE"," ",317],["T_VARIABLE","$qry",317],["T_OBJECT_OPERATOR","->",317],["T_STRING","row",317],";",["T_WHITESPACE","\n\t",317],"}",["T_WHITESPACE","\n\n\t",318],["T_PUBLIC","public",320],["T_WHITESPACE"," ",320],["T_FUNCTION","function",320],["T_WHITESPACE"," ",320],["T_STRING","getWorldpayOrder",320],"(",["T_VARIABLE","$worldpay_order_id",320],")",["T_WHITESPACE"," ",320],"{",["T_WHITESPACE","\n\t\t",320],["T_VARIABLE","$qry",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_VARIABLE","$this",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","db",321],["T_OBJECT_OPERATOR","->",321],["T_STRING","query",321],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",321],["T_WHITESPACE"," ",321],".",["T_WHITESPACE"," ",321],["T_STRING","DB_PREFIX",321],["T_WHITESPACE"," ",321],".",["T_WHITESPACE"," ",321],["T_CONSTANT_ENCAPSED_STRING","\"worldpay_order WHERE order_code = \"",321],["T_WHITESPACE"," ",321],".",["T_WHITESPACE"," ",321],["T_INT_CAST","(int)",321],["T_VARIABLE","$worldpay_order_id",321],")",";",["T_WHITESPACE","\n\t\t",321],["T_RETURN","return",322],["T_WHITESPACE"," ",322],["T_VARIABLE","$qry",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","row",322],";",["T_WHITESPACE","\n\t",322],"}",["T_WHITESPACE","\n\n\t",323],["T_PUBLIC","public",325],["T_WHITESPACE"," ",325],["T_FUNCTION","function",325],["T_WHITESPACE"," ",325],["T_STRING","updateCronJobRunTime",325],"(",")",["T_WHITESPACE"," ",325],"{",["T_WHITESPACE","\n\t\t",325],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","db",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","query",326],"(",["T_CONSTANT_ENCAPSED_STRING","\"DELETE FROM `\"",326],["T_WHITESPACE"," ",326],".",["T_WHITESPACE"," ",326],["T_STRING","DB_PREFIX",326],["T_WHITESPACE"," ",326],".",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","\"setting` WHERE `code` = 'worldpay' AND `key` = 'worldpay_last_cron_job_run'\"",326],")",";",["T_WHITESPACE","\n\t\t",326],["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","db",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","query",327],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",327],["T_WHITESPACE"," ",327],".",["T_WHITESPACE"," ",327],["T_STRING","DB_PREFIX",327],["T_WHITESPACE"," ",327],".",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","\"setting` (`store_id`, `code`, `key`, `value`, `serialized`) VALUES (0, 'worldpay', 'worldpay_last_cron_job_run', NOW(), 0)\"",327],")",";",["T_WHITESPACE","\n\t",327],"}",["T_WHITESPACE","\n\n\t",328],["T_PUBLIC","public",330],["T_WHITESPACE"," ",330],["T_FUNCTION","function",330],["T_WHITESPACE"," ",330],["T_STRING","sendCurl",330],"(",["T_VARIABLE","$url",330],",",["T_WHITESPACE"," ",330],["T_VARIABLE","$order",330],["T_WHITESPACE"," ",330],"=",["T_WHITESPACE"," ",330],["T_STRING","null",330],")",["T_WHITESPACE"," ",330],"{",["T_WHITESPACE","\n\t\t",330],["T_VARIABLE","$curl",331],["T_WHITESPACE"," ",331],"=",["T_WHITESPACE"," ",331],["T_STRING","curl_init",331],"(",")",";",["T_WHITESPACE","\n\t\t",331],["T_STRING","curl_setopt",332],"(",["T_VARIABLE","$curl",332],",",["T_WHITESPACE"," ",332],["T_STRING","CURLOPT_URL",332],",",["T_WHITESPACE"," ",332],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/api.worldpay.com\/v1\/'",332],["T_WHITESPACE"," ",332],".",["T_WHITESPACE"," ",332],["T_VARIABLE","$url",332],")",";",["T_WHITESPACE","\n\t\t",332],["T_VARIABLE","$content_length",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_LNUMBER","0",333],";",["T_WHITESPACE","\n\t\t",333],["T_IF","if",334],["T_WHITESPACE"," ",334],"(",["T_VARIABLE","$order",334],")",["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n\t\t\t",334],["T_VARIABLE","$json",335],["T_WHITESPACE"," ",335],"=",["T_WHITESPACE"," ",335],["T_STRING","json_encode",335],"(",["T_VARIABLE","$order",335],")",";",["T_WHITESPACE","\n\t\t\t",335],["T_VARIABLE","$content_length",336],["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_STRING","strlen",336],"(",["T_VARIABLE","$json",336],")",";",["T_WHITESPACE","\n\t\t\t",336],["T_STRING","curl_setopt",337],"(",["T_VARIABLE","$curl",337],",",["T_WHITESPACE"," ",337],["T_STRING","CURLOPT_CUSTOMREQUEST",337],",",["T_WHITESPACE"," ",337],["T_CONSTANT_ENCAPSED_STRING","'POST'",337],")",";",["T_WHITESPACE","\n\t\t\t",337],["T_STRING","curl_setopt",338],"(",["T_VARIABLE","$curl",338],",",["T_WHITESPACE"," ",338],["T_STRING","CURLOPT_POSTFIELDS",338],",",["T_WHITESPACE"," ",338],["T_VARIABLE","$json",338],")",";",["T_WHITESPACE","\n\t\t",338],"}",["T_WHITESPACE","\n\t\t",339],["T_STRING","curl_setopt",340],"(",["T_VARIABLE","$curl",340],",",["T_WHITESPACE"," ",340],["T_STRING","CURLOPT_RETURNTRANSFER",340],",",["T_WHITESPACE"," ",340],["T_STRING","true",340],")",";",["T_WHITESPACE","\n\t\t",340],["T_STRING","curl_setopt",341],"(",["T_VARIABLE","$curl",341],",",["T_WHITESPACE"," ",341],["T_STRING","CURLOPT_CONNECTTIMEOUT",341],",",["T_WHITESPACE"," ",341],["T_LNUMBER","0",341],")",";",["T_WHITESPACE","\n\t\t",341],["T_STRING","curl_setopt",342],"(",["T_VARIABLE","$curl",342],",",["T_WHITESPACE"," ",342],["T_STRING","CURLOPT_HTTP_VERSION",342],",",["T_WHITESPACE"," ",342],["T_STRING","CURL_HTTP_VERSION_1_0",342],")",";",["T_WHITESPACE","\n\t\t",342],["T_STRING","curl_setopt",343],"(",["T_VARIABLE","$curl",343],",",["T_WHITESPACE"," ",343],["T_STRING","CURLOPT_TIMEOUT",343],",",["T_WHITESPACE"," ",343],["T_LNUMBER","10",343],")",";",["T_WHITESPACE","\n\t\t",343],["T_STRING","curl_setopt",344],"(",["T_WHITESPACE","\n\t\t\t\t",344],["T_VARIABLE","$curl",345],",",["T_WHITESPACE"," ",345],["T_STRING","CURLOPT_HTTPHEADER",345],",",["T_WHITESPACE"," ",345],["T_ARRAY","array",345],"(",["T_WHITESPACE","\n\t\t\t",345],["T_CONSTANT_ENCAPSED_STRING","\"Authorization: \"",346],["T_WHITESPACE"," ",346],".",["T_WHITESPACE"," ",346],["T_VARIABLE","$this",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","config",346],["T_OBJECT_OPERATOR","->",346],["T_STRING","get",346],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_service_key'",346],")",",",["T_WHITESPACE","\n\t\t\t",346],["T_CONSTANT_ENCAPSED_STRING","\"Content-Type: application\/json\"",347],",",["T_WHITESPACE","\n\t\t\t",347],["T_CONSTANT_ENCAPSED_STRING","\"Content-Length: \"",348],["T_WHITESPACE"," ",348],".",["T_WHITESPACE"," ",348],["T_VARIABLE","$content_length",348],["T_WHITESPACE","\n\t\t\t\t",348],")",["T_WHITESPACE","\n\t\t",349],")",";",["T_WHITESPACE","\n\n\t\t",350],["T_VARIABLE","$result",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_STRING","json_decode",352],"(",["T_STRING","curl_exec",352],"(",["T_VARIABLE","$curl",352],")",")",";",["T_WHITESPACE","\n\t\t",352],["T_STRING","curl_close",353],"(",["T_VARIABLE","$curl",353],")",";",["T_WHITESPACE","\n\t\t",353],["T_RETURN","return",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$result",354],";",["T_WHITESPACE","\n\t",354],"}",["T_WHITESPACE","\n\n\t",355],["T_PUBLIC","public",357],["T_WHITESPACE"," ",357],["T_FUNCTION","function",357],["T_WHITESPACE"," ",357],["T_STRING","logger",357],"(",["T_VARIABLE","$data",357],")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n\t\t",357],["T_IF","if",358],["T_WHITESPACE"," ",358],"(",["T_VARIABLE","$this",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","config",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","get",358],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_debug'",358],")",")",["T_WHITESPACE"," ",358],"{",["T_WHITESPACE","\n\t\t\t",358],["T_VARIABLE","$log",359],["T_WHITESPACE"," ",359],"=",["T_WHITESPACE"," ",359],["T_NEW","new",359],["T_WHITESPACE"," ",359],["T_STRING","Log",359],"(",["T_CONSTANT_ENCAPSED_STRING","'worldpay_debug.log'",359],")",";",["T_WHITESPACE","\n\t\t\t",359],["T_VARIABLE","$backtrace",360],["T_WHITESPACE"," ",360],"=",["T_WHITESPACE"," ",360],["T_STRING","debug_backtrace",360],"(",")",";",["T_WHITESPACE","\n\t\t\t",360],["T_VARIABLE","$log",361],["T_OBJECT_OPERATOR","->",361],["T_STRING","write",361],"(",["T_VARIABLE","$backtrace",361],"[",["T_LNUMBER","6",361],"]","[",["T_CONSTANT_ENCAPSED_STRING","'class'",361],"]",["T_WHITESPACE"," ",361],".",["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","'::'",361],["T_WHITESPACE"," ",361],".",["T_WHITESPACE"," ",361],["T_VARIABLE","$backtrace",361],"[",["T_LNUMBER","6",361],"]","[",["T_CONSTANT_ENCAPSED_STRING","'function'",361],"]",["T_WHITESPACE"," ",361],".",["T_WHITESPACE"," ",361],["T_CONSTANT_ENCAPSED_STRING","' Data:  '",361],["T_WHITESPACE"," ",361],".",["T_WHITESPACE"," ",361],["T_STRING","print_r",361],"(",["T_VARIABLE","$data",361],",",["T_WHITESPACE"," ",361],["T_LNUMBER","1",361],")",")",";",["T_WHITESPACE","\n\t\t",361],"}",["T_WHITESPACE","\n\t",362],"}",["T_WHITESPACE","\n\n\t",363],["T_PUBLIC","public",365],["T_WHITESPACE"," ",365],["T_FUNCTION","function",365],["T_WHITESPACE"," ",365],["T_STRING","recurringPayments",365],"(",")",["T_WHITESPACE"," ",365],"{",["T_WHITESPACE","\n\t\t",365],["T_COMMENT","\/*\n\t\t * Used by the checkout to state the module\n\t\t * supports recurring profiles.\n\t\t *\/",366],["T_WHITESPACE","\n\t\t",369],["T_RETURN","return",370],["T_WHITESPACE"," ",370],["T_STRING","true",370],";",["T_WHITESPACE","\n\t",370],"}",["T_WHITESPACE","\n\n",371],"}",["T_WHITESPACE","\n",373]]