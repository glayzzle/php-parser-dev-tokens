[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ModelExtensionPaymentKlarnaInvoice",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Model",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\t",2],["T_PUBLIC","public",3],["T_WHITESPACE"," ",3],["T_FUNCTION","function",3],["T_WHITESPACE"," ",3],["T_STRING","getMethod",3],"(",["T_VARIABLE","$address",3],",",["T_WHITESPACE"," ",3],["T_VARIABLE","$total",3],")",["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\t\t",3],["T_VARIABLE","$this",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","load",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","language",4],"(",["T_CONSTANT_ENCAPSED_STRING","'extension\/payment\/klarna_invoice'",4],")",";",["T_WHITESPACE","\n\n\t\t",4],["T_VARIABLE","$status",6],["T_WHITESPACE"," ",6],"=",["T_WHITESPACE"," ",6],["T_STRING","true",6],";",["T_WHITESPACE","\n\n\t\t",6],["T_VARIABLE","$klarna_invoice",8],["T_WHITESPACE"," ",8],"=",["T_WHITESPACE"," ",8],["T_VARIABLE","$this",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","config",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","get",8],"(",["T_CONSTANT_ENCAPSED_STRING","'klarna_invoice'",8],")",";",["T_WHITESPACE","\n\n\t\t",8],["T_IF","if",10],["T_WHITESPACE"," ",10],"(","!",["T_ISSET","isset",10],"(",["T_VARIABLE","$klarna_invoice",10],"[",["T_VARIABLE","$address",10],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",10],"]","]",")",")",["T_WHITESPACE"," ",10],"{",["T_WHITESPACE","\n\t\t\t",10],["T_VARIABLE","$status",11],["T_WHITESPACE"," ",11],"=",["T_WHITESPACE"," ",11],["T_STRING","false",11],";",["T_WHITESPACE","\n\t\t",11],"}",["T_WHITESPACE"," ",12],["T_ELSEIF","elseif",12],["T_WHITESPACE"," ",12],"(","!",["T_VARIABLE","$klarna_invoice",12],"[",["T_VARIABLE","$address",12],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",12],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'status'",12],"]",")",["T_WHITESPACE"," ",12],"{",["T_WHITESPACE","\n\t\t\t",12],["T_VARIABLE","$status",13],["T_WHITESPACE"," ",13],"=",["T_WHITESPACE"," ",13],["T_STRING","false",13],";",["T_WHITESPACE","\n\t\t",13],"}",["T_WHITESPACE","\n\n\t\t",14],["T_IF","if",16],["T_WHITESPACE"," ",16],"(",["T_VARIABLE","$status",16],")",["T_WHITESPACE"," ",16],"{",["T_WHITESPACE","\n\t\t\t",16],["T_VARIABLE","$query",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_VARIABLE","$this",17],["T_OBJECT_OPERATOR","->",17],["T_STRING","db",17],["T_OBJECT_OPERATOR","->",17],["T_STRING","query",17],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM \"",17],["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_STRING","DB_PREFIX",17],["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_CONSTANT_ENCAPSED_STRING","\"zone_to_geo_zone WHERE geo_zone_id = '\"",17],["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_INT_CAST","(int)",17],["T_VARIABLE","$klarna_invoice",17],"[",["T_VARIABLE","$address",17],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",17],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'geo_zone_id'",17],"]",["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_CONSTANT_ENCAPSED_STRING","\"' AND country_id = '\"",17],["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_INT_CAST","(int)",17],["T_VARIABLE","$address",17],"[",["T_CONSTANT_ENCAPSED_STRING","'country_id'",17],"]",["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_CONSTANT_ENCAPSED_STRING","\"' AND (zone_id = '\"",17],["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_INT_CAST","(int)",17],["T_VARIABLE","$address",17],"[",["T_CONSTANT_ENCAPSED_STRING","'zone_id'",17],"]",["T_WHITESPACE"," ",17],".",["T_WHITESPACE"," ",17],["T_CONSTANT_ENCAPSED_STRING","\"' OR zone_id = '0')\"",17],")",";",["T_WHITESPACE","\n\n\t\t\t",17],["T_IF","if",19],["T_WHITESPACE"," ",19],"(",["T_VARIABLE","$klarna_invoice",19],"[",["T_VARIABLE","$address",19],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",19],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'total'",19],"]",["T_WHITESPACE"," ",19],">",["T_WHITESPACE"," ",19],["T_LNUMBER","0",19],["T_WHITESPACE"," ",19],["T_BOOLEAN_AND","&&",19],["T_WHITESPACE"," ",19],["T_VARIABLE","$klarna_invoice",19],"[",["T_VARIABLE","$address",19],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",19],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'total'",19],"]",["T_WHITESPACE"," ",19],">",["T_WHITESPACE"," ",19],["T_VARIABLE","$total",19],")",["T_WHITESPACE"," ",19],"{",["T_WHITESPACE","\n\t\t\t\t",19],["T_VARIABLE","$status",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_STRING","false",20],";",["T_WHITESPACE","\n\t\t\t",20],"}",["T_WHITESPACE"," ",21],["T_ELSEIF","elseif",21],["T_WHITESPACE"," ",21],"(","!",["T_VARIABLE","$klarna_invoice",21],"[",["T_VARIABLE","$address",21],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",21],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'geo_zone_id'",21],"]",")",["T_WHITESPACE"," ",21],"{",["T_WHITESPACE","\n\t\t\t\t",21],["T_VARIABLE","$status",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_STRING","true",22],";",["T_WHITESPACE","\n\t\t\t",22],"}",["T_WHITESPACE"," ",23],["T_ELSEIF","elseif",23],["T_WHITESPACE"," ",23],"(",["T_VARIABLE","$query",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","num_rows",23],")",["T_WHITESPACE"," ",23],"{",["T_WHITESPACE","\n\t\t\t\t",23],["T_VARIABLE","$status",24],["T_WHITESPACE"," ",24],"=",["T_WHITESPACE"," ",24],["T_STRING","true",24],";",["T_WHITESPACE","\n\t\t\t",24],"}",["T_WHITESPACE"," ",25],["T_ELSE","else",25],["T_WHITESPACE"," ",25],"{",["T_WHITESPACE","\n\t\t\t\t",25],["T_VARIABLE","$status",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_STRING","false",26],";",["T_WHITESPACE","\n\t\t\t",26],"}",["T_WHITESPACE","\n\n\t\t\t",27],["T_COMMENT","\/\/ Maps countries to currencies\n",29],["T_WHITESPACE","\t\t\t",30],["T_VARIABLE","$country_to_currency",30],["T_WHITESPACE"," ",30],"=",["T_WHITESPACE"," ",30],["T_ARRAY","array",30],"(",["T_WHITESPACE","\n\t\t\t\t",30],["T_CONSTANT_ENCAPSED_STRING","'NOR'",31],["T_WHITESPACE"," ",31],["T_DOUBLE_ARROW","=>",31],["T_WHITESPACE"," ",31],["T_CONSTANT_ENCAPSED_STRING","'NOK'",31],",",["T_WHITESPACE","\n\t\t\t\t",31],["T_CONSTANT_ENCAPSED_STRING","'SWE'",32],["T_WHITESPACE"," ",32],["T_DOUBLE_ARROW","=>",32],["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'SEK'",32],",",["T_WHITESPACE","\n\t\t\t\t",32],["T_CONSTANT_ENCAPSED_STRING","'FIN'",33],["T_WHITESPACE"," ",33],["T_DOUBLE_ARROW","=>",33],["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'EUR'",33],",",["T_WHITESPACE","\n\t\t\t\t",33],["T_CONSTANT_ENCAPSED_STRING","'DNK'",34],["T_WHITESPACE"," ",34],["T_DOUBLE_ARROW","=>",34],["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'DKK'",34],",",["T_WHITESPACE","\n\t\t\t\t",34],["T_CONSTANT_ENCAPSED_STRING","'DEU'",35],["T_WHITESPACE"," ",35],["T_DOUBLE_ARROW","=>",35],["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","'EUR'",35],",",["T_WHITESPACE","\n\t\t\t\t",35],["T_CONSTANT_ENCAPSED_STRING","'NLD'",36],["T_WHITESPACE"," ",36],["T_DOUBLE_ARROW","=>",36],["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'EUR'",36],",",["T_WHITESPACE","\n\t\t\t",36],")",";",["T_WHITESPACE","\n\n\t\t\t",37],["T_IF","if",39],["T_WHITESPACE"," ",39],"(","!",["T_ISSET","isset",39],"(",["T_VARIABLE","$country_to_currency",39],"[",["T_VARIABLE","$address",39],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",39],"]","]",")",["T_WHITESPACE"," ",39],["T_BOOLEAN_OR","||",39],["T_WHITESPACE"," ",39],"!",["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","currency",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","has",39],"(",["T_VARIABLE","$country_to_currency",39],"[",["T_VARIABLE","$address",39],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",39],"]","]",")",")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n\t\t\t\t",39],["T_VARIABLE","$status",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_STRING","false",40],";",["T_WHITESPACE","\n\t\t\t",40],"}",["T_WHITESPACE","\n\t\t",41],"}",["T_WHITESPACE","\n\n\t\t",42],["T_VARIABLE","$method",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_ARRAY","array",44],"(",")",";",["T_WHITESPACE","\n\n\t\t",44],["T_IF","if",46],["T_WHITESPACE"," ",46],"(",["T_VARIABLE","$status",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n\t\t\t",46],["T_VARIABLE","$klarna_fee",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","config",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","get",47],"(",["T_CONSTANT_ENCAPSED_STRING","'klarna_fee'",47],")",";",["T_WHITESPACE","\n\n\t\t\t",47],["T_IF","if",49],["T_WHITESPACE"," ",49],"(",["T_VARIABLE","$klarna_fee",49],"[",["T_VARIABLE","$address",49],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",49],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'status'",49],"]",["T_WHITESPACE"," ",49],["T_BOOLEAN_AND","&&",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","cart",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","getSubTotal",49],"(",")",["T_WHITESPACE"," ",49],"<",["T_WHITESPACE"," ",49],["T_VARIABLE","$klarna_fee",49],"[",["T_VARIABLE","$address",49],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",49],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'total'",49],"]",")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n\t\t\t\t",49],["T_VARIABLE","$terms",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_STRING","sprintf",50],"(",["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","language",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","get",50],"(",["T_CONSTANT_ENCAPSED_STRING","'text_terms_fee'",50],")",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","currency",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","format",50],"(",["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","tax",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","calculate",50],"(",["T_VARIABLE","$klarna_fee",50],"[",["T_VARIABLE","$address",50],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",50],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'fee'",50],"]",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$klarna_fee",50],"[",["T_VARIABLE","$address",50],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",50],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",50],"]",")",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","session",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","data",50],"[",["T_CONSTANT_ENCAPSED_STRING","'currency'",50],"]",",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","''",50],")",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$klarna_invoice",50],"[",["T_VARIABLE","$address",50],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",50],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'merchant'",50],"]",",",["T_WHITESPACE"," ",50],["T_STRING","strtolower",50],"(",["T_VARIABLE","$address",50],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_2'",50],"]",")",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","currency",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","format",50],"(",["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","tax",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","calculate",50],"(",["T_VARIABLE","$klarna_fee",50],"[",["T_VARIABLE","$address",50],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",50],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'fee'",50],"]",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$klarna_fee",50],"[",["T_VARIABLE","$address",50],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",50],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",50],"]",")",",",["T_WHITESPACE"," ",50],["T_VARIABLE","$country_to_currency",50],"[",["T_VARIABLE","$address",50],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",50],"]","]",",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","''",50],",",["T_WHITESPACE"," ",50],["T_STRING","false",50],")",")",";",["T_WHITESPACE","\n\t\t\t",50],"}",["T_WHITESPACE"," ",51],["T_ELSE","else",51],["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n\t\t\t\t",51],["T_VARIABLE","$terms",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_STRING","sprintf",52],"(",["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","language",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","get",52],"(",["T_CONSTANT_ENCAPSED_STRING","'text_terms_no_fee'",52],")",",",["T_WHITESPACE"," ",52],["T_VARIABLE","$klarna_invoice",52],"[",["T_VARIABLE","$address",52],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",52],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'merchant'",52],"]",",",["T_WHITESPACE"," ",52],["T_STRING","strtolower",52],"(",["T_VARIABLE","$address",52],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_2'",52],"]",")",")",";",["T_WHITESPACE","\n\t\t\t",52],"}",["T_WHITESPACE","\n\n\t\t\t",53],["T_VARIABLE","$method",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_ARRAY","array",55],"(",["T_WHITESPACE","\n\t\t\t\t",55],["T_CONSTANT_ENCAPSED_STRING","'code'",56],["T_WHITESPACE","       ",56],["T_DOUBLE_ARROW","=>",56],["T_WHITESPACE"," ",56],["T_CONSTANT_ENCAPSED_STRING","'klarna_invoice'",56],",",["T_WHITESPACE","\n\t\t\t\t",56],["T_CONSTANT_ENCAPSED_STRING","'title'",57],["T_WHITESPACE","      ",57],["T_DOUBLE_ARROW","=>",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","language",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","get",57],"(",["T_CONSTANT_ENCAPSED_STRING","'text_title'",57],")",",",["T_WHITESPACE","\n\t\t\t\t",57],["T_CONSTANT_ENCAPSED_STRING","'terms'",58],["T_WHITESPACE","      ",58],["T_DOUBLE_ARROW","=>",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$terms",58],",",["T_WHITESPACE","\n\t\t\t\t",58],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",59],["T_WHITESPACE"," ",59],["T_DOUBLE_ARROW","=>",59],["T_WHITESPACE"," ",59],["T_VARIABLE","$klarna_invoice",59],"[",["T_VARIABLE","$address",59],"[",["T_CONSTANT_ENCAPSED_STRING","'iso_code_3'",59],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'sort_order'",59],"]",["T_WHITESPACE","\n\t\t\t",59],")",";",["T_WHITESPACE","\n\t\t",60],"}",["T_WHITESPACE","\n\n\t\t",61],["T_RETURN","return",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$method",63],";",["T_WHITESPACE","\n\t",63],"}",["T_WHITESPACE","\n",64],"}"]