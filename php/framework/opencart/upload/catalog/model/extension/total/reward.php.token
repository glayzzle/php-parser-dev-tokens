[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ModelExtensionTotalReward",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Model",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\t",2],["T_PUBLIC","public",3],["T_WHITESPACE"," ",3],["T_FUNCTION","function",3],["T_WHITESPACE"," ",3],["T_STRING","getTotal",3],"(",["T_VARIABLE","$total",3],")",["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\t\t",3],["T_IF","if",4],["T_WHITESPACE"," ",4],"(",["T_ISSET","isset",4],"(",["T_VARIABLE","$this",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","session",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","data",4],"[",["T_CONSTANT_ENCAPSED_STRING","'reward'",4],"]",")",")",["T_WHITESPACE"," ",4],"{",["T_WHITESPACE","\n\t\t\t",4],["T_VARIABLE","$this",5],["T_OBJECT_OPERATOR","->",5],["T_STRING","load",5],["T_OBJECT_OPERATOR","->",5],["T_STRING","language",5],"(",["T_CONSTANT_ENCAPSED_STRING","'extension\/total\/reward'",5],")",";",["T_WHITESPACE","\n\n\t\t\t",5],["T_VARIABLE","$points",7],["T_WHITESPACE"," ",7],"=",["T_WHITESPACE"," ",7],["T_VARIABLE","$this",7],["T_OBJECT_OPERATOR","->",7],["T_STRING","customer",7],["T_OBJECT_OPERATOR","->",7],["T_STRING","getRewardPoints",7],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",7],["T_IF","if",9],["T_WHITESPACE"," ",9],"(",["T_VARIABLE","$this",9],["T_OBJECT_OPERATOR","->",9],["T_STRING","session",9],["T_OBJECT_OPERATOR","->",9],["T_STRING","data",9],"[",["T_CONSTANT_ENCAPSED_STRING","'reward'",9],"]",["T_WHITESPACE"," ",9],["T_IS_SMALLER_OR_EQUAL","<=",9],["T_WHITESPACE"," ",9],["T_VARIABLE","$points",9],")",["T_WHITESPACE"," ",9],"{",["T_WHITESPACE","\n\t\t\t\t",9],["T_VARIABLE","$discount_total",10],["T_WHITESPACE"," ",10],"=",["T_WHITESPACE"," ",10],["T_LNUMBER","0",10],";",["T_WHITESPACE","\n\n\t\t\t\t",10],["T_VARIABLE","$points_total",12],["T_WHITESPACE"," ",12],"=",["T_WHITESPACE"," ",12],["T_LNUMBER","0",12],";",["T_WHITESPACE","\n\n\t\t\t\t",12],["T_FOREACH","foreach",14],["T_WHITESPACE"," ",14],"(",["T_VARIABLE","$this",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","cart",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","getProducts",14],"(",")",["T_WHITESPACE"," ",14],["T_AS","as",14],["T_WHITESPACE"," ",14],["T_VARIABLE","$product",14],")",["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\t\t\t\t\t",14],["T_IF","if",15],["T_WHITESPACE"," ",15],"(",["T_VARIABLE","$product",15],"[",["T_CONSTANT_ENCAPSED_STRING","'points'",15],"]",")",["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n\t\t\t\t\t\t",15],["T_VARIABLE","$points_total",16],["T_WHITESPACE"," ",16],["T_PLUS_EQUAL","+=",16],["T_WHITESPACE"," ",16],["T_VARIABLE","$product",16],"[",["T_CONSTANT_ENCAPSED_STRING","'points'",16],"]",";",["T_WHITESPACE","\n\t\t\t\t\t",16],"}",["T_WHITESPACE","\n\t\t\t\t",17],"}",["T_WHITESPACE","\n\n\t\t\t\t",18],["T_VARIABLE","$points",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_STRING","min",20],"(",["T_VARIABLE","$points",20],",",["T_WHITESPACE"," ",20],["T_VARIABLE","$points_total",20],")",";",["T_WHITESPACE","\n\n\t\t\t\t",20],["T_FOREACH","foreach",22],["T_WHITESPACE"," ",22],"(",["T_VARIABLE","$this",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","cart",22],["T_OBJECT_OPERATOR","->",22],["T_STRING","getProducts",22],"(",")",["T_WHITESPACE"," ",22],["T_AS","as",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$product",22],")",["T_WHITESPACE"," ",22],"{",["T_WHITESPACE","\n\t\t\t\t\t",22],["T_VARIABLE","$discount",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_LNUMBER","0",23],";",["T_WHITESPACE","\n\n\t\t\t\t\t",23],["T_IF","if",25],["T_WHITESPACE"," ",25],"(",["T_VARIABLE","$product",25],"[",["T_CONSTANT_ENCAPSED_STRING","'points'",25],"]",")",["T_WHITESPACE"," ",25],"{",["T_WHITESPACE","\n\t\t\t\t\t\t",25],["T_VARIABLE","$discount",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_VARIABLE","$product",26],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",26],"]",["T_WHITESPACE"," ",26],"*",["T_WHITESPACE"," ",26],"(",["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","session",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","data",26],"[",["T_CONSTANT_ENCAPSED_STRING","'reward'",26],"]",["T_WHITESPACE"," ",26],"\/",["T_WHITESPACE"," ",26],["T_VARIABLE","$points_total",26],")",";",["T_WHITESPACE","\n\n\t\t\t\t\t\t",26],["T_IF","if",28],["T_WHITESPACE"," ",28],"(",["T_VARIABLE","$product",28],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",28],"]",")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n\t\t\t\t\t\t\t",28],["T_VARIABLE","$tax_rates",29],["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","tax",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","getRates",29],"(",["T_VARIABLE","$product",29],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",29],"]",["T_WHITESPACE"," ",29],"-",["T_WHITESPACE"," ",29],"(",["T_VARIABLE","$product",29],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",29],"]",["T_WHITESPACE"," ",29],"-",["T_WHITESPACE"," ",29],["T_VARIABLE","$discount",29],")",",",["T_WHITESPACE"," ",29],["T_VARIABLE","$product",29],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_class_id'",29],"]",")",";",["T_WHITESPACE","\n\n\t\t\t\t\t\t\t",29],["T_FOREACH","foreach",31],["T_WHITESPACE"," ",31],"(",["T_VARIABLE","$tax_rates",31],["T_WHITESPACE"," ",31],["T_AS","as",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$tax_rate",31],")",["T_WHITESPACE"," ",31],"{",["T_WHITESPACE","\n\t\t\t\t\t\t\t\t",31],["T_IF","if",32],["T_WHITESPACE"," ",32],"(",["T_VARIABLE","$tax_rate",32],"[",["T_CONSTANT_ENCAPSED_STRING","'type'",32],"]",["T_WHITESPACE"," ",32],["T_IS_EQUAL","==",32],["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'P'",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n\t\t\t\t\t\t\t\t\t",32],["T_VARIABLE","$total",33],"[",["T_CONSTANT_ENCAPSED_STRING","'taxes'",33],"]","[",["T_VARIABLE","$tax_rate",33],"[",["T_CONSTANT_ENCAPSED_STRING","'tax_rate_id'",33],"]","]",["T_WHITESPACE"," ",33],["T_MINUS_EQUAL","-=",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$tax_rate",33],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",33],"]",";",["T_WHITESPACE","\n\t\t\t\t\t\t\t\t",33],"}",["T_WHITESPACE","\n\t\t\t\t\t\t\t",34],"}",["T_WHITESPACE","\n\t\t\t\t\t\t",35],"}",["T_WHITESPACE","\n\t\t\t\t\t",36],"}",["T_WHITESPACE","\n\n\t\t\t\t\t",37],["T_VARIABLE","$discount_total",39],["T_WHITESPACE"," ",39],["T_PLUS_EQUAL","+=",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$discount",39],";",["T_WHITESPACE","\n\t\t\t\t",39],"}",["T_WHITESPACE","\n\n\t\t\t\t",40],["T_VARIABLE","$total",42],"[",["T_CONSTANT_ENCAPSED_STRING","'totals'",42],"]","[","]",["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_ARRAY","array",42],"(",["T_WHITESPACE","\n\t\t\t\t\t",42],["T_CONSTANT_ENCAPSED_STRING","'code'",43],["T_WHITESPACE","       ",43],["T_DOUBLE_ARROW","=>",43],["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'reward'",43],",",["T_WHITESPACE","\n\t\t\t\t\t",43],["T_CONSTANT_ENCAPSED_STRING","'title'",44],["T_WHITESPACE","      ",44],["T_DOUBLE_ARROW","=>",44],["T_WHITESPACE"," ",44],["T_STRING","sprintf",44],"(",["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","language",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","get",44],"(",["T_CONSTANT_ENCAPSED_STRING","'text_reward'",44],")",",",["T_WHITESPACE"," ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","session",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","data",44],"[",["T_CONSTANT_ENCAPSED_STRING","'reward'",44],"]",")",",",["T_WHITESPACE","\n\t\t\t\t\t",44],["T_CONSTANT_ENCAPSED_STRING","'value'",45],["T_WHITESPACE","      ",45],["T_DOUBLE_ARROW","=>",45],["T_WHITESPACE"," ",45],"-",["T_VARIABLE","$discount_total",45],",",["T_WHITESPACE","\n\t\t\t\t\t",45],["T_CONSTANT_ENCAPSED_STRING","'sort_order'",46],["T_WHITESPACE"," ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","config",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","get",46],"(",["T_CONSTANT_ENCAPSED_STRING","'reward_sort_order'",46],")",["T_WHITESPACE","\n\t\t\t\t",46],")",";",["T_WHITESPACE","\n\n\t\t\t\t",47],["T_VARIABLE","$total",49],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",49],"]",["T_WHITESPACE"," ",49],["T_MINUS_EQUAL","-=",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$discount_total",49],";",["T_WHITESPACE","\n\t\t\t",49],"}",["T_WHITESPACE","\n\t\t",50],"}",["T_WHITESPACE","\n\t",51],"}",["T_WHITESPACE","\n\n\t",52],["T_PUBLIC","public",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","confirm",54],"(",["T_VARIABLE","$order_info",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$order_total",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n\t\t",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","load",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","language",55],"(",["T_CONSTANT_ENCAPSED_STRING","'extension\/total\/reward'",55],")",";",["T_WHITESPACE","\n\n\t\t",55],["T_VARIABLE","$points",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_LNUMBER","0",57],";",["T_WHITESPACE","\n\n\t\t",57],["T_VARIABLE","$start",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","strpos",59],"(",["T_VARIABLE","$order_total",59],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",59],"]",",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'('",59],")",["T_WHITESPACE"," ",59],"+",["T_WHITESPACE"," ",59],["T_LNUMBER","1",59],";",["T_WHITESPACE","\n\t\t",59],["T_VARIABLE","$end",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","strrpos",60],"(",["T_VARIABLE","$order_total",60],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",60],"]",",",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","')'",60],")",";",["T_WHITESPACE","\n\n\t\t",60],["T_IF","if",62],["T_WHITESPACE"," ",62],"(",["T_VARIABLE","$start",62],["T_WHITESPACE"," ",62],["T_BOOLEAN_AND","&&",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$end",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n\t\t\t",62],["T_VARIABLE","$points",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","substr",63],"(",["T_VARIABLE","$order_total",63],"[",["T_CONSTANT_ENCAPSED_STRING","'title'",63],"]",",",["T_WHITESPACE"," ",63],["T_VARIABLE","$start",63],",",["T_WHITESPACE"," ",63],["T_VARIABLE","$end",63],["T_WHITESPACE"," ",63],"-",["T_WHITESPACE"," ",63],["T_VARIABLE","$start",63],")",";",["T_WHITESPACE","\n\t\t",63],"}",["T_WHITESPACE","\n\n\t\t",64],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","load",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","model",66],"(",["T_CONSTANT_ENCAPSED_STRING","'account\/customer'",66],")",";",["T_WHITESPACE","\n\n\t\t",66],["T_IF","if",68],["T_WHITESPACE"," ",68],"(",["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","model_account_customer",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","getRewardTotal",68],"(",["T_VARIABLE","$order_info",68],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",68],"]",")",["T_WHITESPACE"," ",68],["T_IS_GREATER_OR_EQUAL",">=",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$points",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n\t\t\t",68],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","db",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","query",69],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO \"",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_STRING","DB_PREFIX",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","\"customer_reward SET customer_id = '\"",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_INT_CAST","(int)",69],["T_VARIABLE","$order_info",69],"[",["T_CONSTANT_ENCAPSED_STRING","'customer_id'",69],"]",["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","\"', order_id = '\"",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_INT_CAST","(int)",69],["T_VARIABLE","$order_info",69],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",69],"]",["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","\"', description = '\"",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","db",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","escape",69],"(",["T_STRING","sprintf",69],"(",["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","language",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","get",69],"(",["T_CONSTANT_ENCAPSED_STRING","'text_order_id'",69],")",",",["T_WHITESPACE"," ",69],["T_INT_CAST","(int)",69],["T_VARIABLE","$order_info",69],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",69],"]",")",")",["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","\"', points = '\"",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_DOUBLE_CAST","(float)",69],"-",["T_VARIABLE","$points",69],["T_WHITESPACE"," ",69],".",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","\"', date_added = NOW()\"",69],")",";",["T_WHITESPACE","\n\t\t",69],"}",["T_WHITESPACE"," ",70],["T_ELSE","else",70],["T_WHITESPACE"," ",70],"{",["T_WHITESPACE","\n\t\t\t",70],["T_RETURN","return",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","config",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","get",71],"(",["T_CONSTANT_ENCAPSED_STRING","'config_fraud_status_id'",71],")",";",["T_WHITESPACE","\n\t\t",71],"}",["T_WHITESPACE","\n\t",72],"}",["T_WHITESPACE","\n\n\t",73],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","unconfirm",75],"(",["T_VARIABLE","$order_id",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n\t\t",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","db",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","query",76],"(",["T_CONSTANT_ENCAPSED_STRING","\"DELETE FROM \"",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_STRING","DB_PREFIX",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","\"customer_reward WHERE order_id = '\"",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_INT_CAST","(int)",76],["T_VARIABLE","$order_id",76],["T_WHITESPACE"," ",76],".",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","\"' AND points < 0\"",76],")",";",["T_WHITESPACE","\n\t",76],"}",["T_WHITESPACE","\n",77],"}",["T_WHITESPACE","\n",78]]