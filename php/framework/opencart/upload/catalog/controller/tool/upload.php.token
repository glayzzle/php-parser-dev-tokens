[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ControllerToolUpload",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Controller",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\t",2],["T_PUBLIC","public",3],["T_WHITESPACE"," ",3],["T_FUNCTION","function",3],["T_WHITESPACE"," ",3],["T_STRING","index",3],"(",")",["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\t\t",3],["T_VARIABLE","$this",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","load",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","language",4],"(",["T_CONSTANT_ENCAPSED_STRING","'tool\/upload'",4],")",";",["T_WHITESPACE","\n\n\t\t",4],["T_VARIABLE","$json",6],["T_WHITESPACE"," ",6],"=",["T_WHITESPACE"," ",6],["T_ARRAY","array",6],"(",")",";",["T_WHITESPACE","\n\n\t\t",6],["T_IF","if",8],["T_WHITESPACE"," ",8],"(","!",["T_EMPTY","empty",8],"(",["T_VARIABLE","$this",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","request",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","files",8],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",8],"]","[",["T_CONSTANT_ENCAPSED_STRING","'name'",8],"]",")",["T_WHITESPACE"," ",8],["T_BOOLEAN_AND","&&",8],["T_WHITESPACE"," ",8],["T_STRING","is_file",8],"(",["T_VARIABLE","$this",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","request",8],["T_OBJECT_OPERATOR","->",8],["T_STRING","files",8],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",8],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tmp_name'",8],"]",")",")",["T_WHITESPACE"," ",8],"{",["T_WHITESPACE","\n\t\t\t",8],["T_COMMENT","\/\/ Sanitize the filename\n",9],["T_WHITESPACE","\t\t\t",10],["T_VARIABLE","$filename",10],["T_WHITESPACE"," ",10],"=",["T_WHITESPACE"," ",10],["T_STRING","basename",10],"(",["T_STRING","preg_replace",10],"(",["T_CONSTANT_ENCAPSED_STRING","'\/[^a-zA-Z0-9\\.\\-\\s+]\/'",10],",",["T_WHITESPACE"," ",10],["T_CONSTANT_ENCAPSED_STRING","''",10],",",["T_WHITESPACE"," ",10],["T_STRING","html_entity_decode",10],"(",["T_VARIABLE","$this",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","request",10],["T_OBJECT_OPERATOR","->",10],["T_STRING","files",10],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",10],"]","[",["T_CONSTANT_ENCAPSED_STRING","'name'",10],"]",",",["T_WHITESPACE"," ",10],["T_STRING","ENT_QUOTES",10],",",["T_WHITESPACE"," ",10],["T_CONSTANT_ENCAPSED_STRING","'UTF-8'",10],")",")",")",";",["T_WHITESPACE","\n\n\t\t\t",10],["T_COMMENT","\/\/ Validate the filename length\n",12],["T_WHITESPACE","\t\t\t",13],["T_IF","if",13],["T_WHITESPACE"," ",13],"(","(",["T_STRING","utf8_strlen",13],"(",["T_VARIABLE","$filename",13],")",["T_WHITESPACE"," ",13],"<",["T_WHITESPACE"," ",13],["T_LNUMBER","3",13],")",["T_WHITESPACE"," ",13],["T_BOOLEAN_OR","||",13],["T_WHITESPACE"," ",13],"(",["T_STRING","utf8_strlen",13],"(",["T_VARIABLE","$filename",13],")",["T_WHITESPACE"," ",13],">",["T_WHITESPACE"," ",13],["T_LNUMBER","64",13],")",")",["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\t\t\t\t",13],["T_VARIABLE","$json",14],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",14],"]",["T_WHITESPACE"," ",14],"=",["T_WHITESPACE"," ",14],["T_VARIABLE","$this",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","language",14],["T_OBJECT_OPERATOR","->",14],["T_STRING","get",14],"(",["T_CONSTANT_ENCAPSED_STRING","'error_filename'",14],")",";",["T_WHITESPACE","\n\t\t\t",14],"}",["T_WHITESPACE","\n\n\t\t\t",15],["T_COMMENT","\/\/ Allowed file extension types\n",17],["T_WHITESPACE","\t\t\t",18],["T_VARIABLE","$allowed",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_ARRAY","array",18],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",18],["T_VARIABLE","$extension_allowed",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_STRING","preg_replace",20],"(",["T_CONSTANT_ENCAPSED_STRING","'~\\r?\\n~'",20],",",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",20],",",["T_WHITESPACE"," ",20],["T_VARIABLE","$this",20],["T_OBJECT_OPERATOR","->",20],["T_STRING","config",20],["T_OBJECT_OPERATOR","->",20],["T_STRING","get",20],"(",["T_CONSTANT_ENCAPSED_STRING","'config_file_ext_allowed'",20],")",")",";",["T_WHITESPACE","\n\n\t\t\t",20],["T_VARIABLE","$filetypes",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_STRING","explode",22],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",22],",",["T_WHITESPACE"," ",22],["T_VARIABLE","$extension_allowed",22],")",";",["T_WHITESPACE","\n\n\t\t\t",22],["T_FOREACH","foreach",24],["T_WHITESPACE"," ",24],"(",["T_VARIABLE","$filetypes",24],["T_WHITESPACE"," ",24],["T_AS","as",24],["T_WHITESPACE"," ",24],["T_VARIABLE","$filetype",24],")",["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n\t\t\t\t",24],["T_VARIABLE","$allowed",25],"[","]",["T_WHITESPACE"," ",25],"=",["T_WHITESPACE"," ",25],["T_STRING","trim",25],"(",["T_VARIABLE","$filetype",25],")",";",["T_WHITESPACE","\n\t\t\t",25],"}",["T_WHITESPACE","\n\n\t\t\t",26],["T_IF","if",28],["T_WHITESPACE"," ",28],"(","!",["T_STRING","in_array",28],"(",["T_STRING","strtolower",28],"(",["T_STRING","substr",28],"(",["T_STRING","strrchr",28],"(",["T_VARIABLE","$filename",28],",",["T_WHITESPACE"," ",28],["T_CONSTANT_ENCAPSED_STRING","'.'",28],")",",",["T_WHITESPACE"," ",28],["T_LNUMBER","1",28],")",")",",",["T_WHITESPACE"," ",28],["T_VARIABLE","$allowed",28],")",")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n\t\t\t\t",28],["T_VARIABLE","$json",29],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",29],"]",["T_WHITESPACE"," ",29],"=",["T_WHITESPACE"," ",29],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","language",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","get",29],"(",["T_CONSTANT_ENCAPSED_STRING","'error_filetype'",29],")",";",["T_WHITESPACE","\n\t\t\t",29],"}",["T_WHITESPACE","\n\n\t\t\t",30],["T_COMMENT","\/\/ Allowed file mime types\n",32],["T_WHITESPACE","\t\t\t",33],["T_VARIABLE","$allowed",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_ARRAY","array",33],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",33],["T_VARIABLE","$mime_allowed",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_STRING","preg_replace",35],"(",["T_CONSTANT_ENCAPSED_STRING","'~\\r?\\n~'",35],",",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","config",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","get",35],"(",["T_CONSTANT_ENCAPSED_STRING","'config_file_mime_allowed'",35],")",")",";",["T_WHITESPACE","\n\n\t\t\t",35],["T_VARIABLE","$filetypes",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_STRING","explode",37],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",37],",",["T_WHITESPACE"," ",37],["T_VARIABLE","$mime_allowed",37],")",";",["T_WHITESPACE","\n\n\t\t\t",37],["T_FOREACH","foreach",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$filetypes",39],["T_WHITESPACE"," ",39],["T_AS","as",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$filetype",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n\t\t\t\t",39],["T_VARIABLE","$allowed",40],"[","]",["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_STRING","trim",40],"(",["T_VARIABLE","$filetype",40],")",";",["T_WHITESPACE","\n\t\t\t",40],"}",["T_WHITESPACE","\n\n\t\t\t",41],["T_IF","if",43],["T_WHITESPACE"," ",43],"(","!",["T_STRING","in_array",43],"(",["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","request",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","files",43],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",43],"]","[",["T_CONSTANT_ENCAPSED_STRING","'type'",43],"]",",",["T_WHITESPACE"," ",43],["T_VARIABLE","$allowed",43],")",")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n\t\t\t\t",43],["T_VARIABLE","$json",44],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",44],"]",["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","language",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","get",44],"(",["T_CONSTANT_ENCAPSED_STRING","'error_filetype'",44],")",";",["T_WHITESPACE","\n\t\t\t",44],"}",["T_WHITESPACE","\n\n\t\t\t",45],["T_COMMENT","\/\/ Check to see if any PHP files are trying to be uploaded\n",47],["T_WHITESPACE","\t\t\t",48],["T_VARIABLE","$content",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_STRING","file_get_contents",48],"(",["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","request",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","files",48],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",48],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tmp_name'",48],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",48],["T_IF","if",50],["T_WHITESPACE"," ",50],"(",["T_STRING","preg_match",50],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\\<\\?php\/i'",50],",",["T_WHITESPACE"," ",50],["T_VARIABLE","$content",50],")",")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n\t\t\t\t",50],["T_VARIABLE","$json",51],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",51],"]",["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","language",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","get",51],"(",["T_CONSTANT_ENCAPSED_STRING","'error_filetype'",51],")",";",["T_WHITESPACE","\n\t\t\t",51],"}",["T_WHITESPACE","\n\n\t\t\t",52],["T_COMMENT","\/\/ Return any upload error\n",54],["T_WHITESPACE","\t\t\t",55],["T_IF","if",55],["T_WHITESPACE"," ",55],"(",["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","request",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","files",55],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",55],"]","[",["T_CONSTANT_ENCAPSED_STRING","'error'",55],"]",["T_WHITESPACE"," ",55],["T_IS_NOT_EQUAL","!=",55],["T_WHITESPACE"," ",55],["T_STRING","UPLOAD_ERR_OK",55],")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n\t\t\t\t",55],["T_VARIABLE","$json",56],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",56],"]",["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","language",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","get",56],"(",["T_CONSTANT_ENCAPSED_STRING","'error_upload_'",56],["T_WHITESPACE"," ",56],".",["T_WHITESPACE"," ",56],["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","request",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","files",56],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",56],"]","[",["T_CONSTANT_ENCAPSED_STRING","'error'",56],"]",")",";",["T_WHITESPACE","\n\t\t\t",56],"}",["T_WHITESPACE","\n\t\t",57],"}",["T_WHITESPACE"," ",58],["T_ELSE","else",58],["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n\t\t\t",58],["T_VARIABLE","$json",59],"[",["T_CONSTANT_ENCAPSED_STRING","'error'",59],"]",["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","language",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","get",59],"(",["T_CONSTANT_ENCAPSED_STRING","'error_upload'",59],")",";",["T_WHITESPACE","\n\t\t",59],"}",["T_WHITESPACE","\n\n\t\t",60],["T_IF","if",62],["T_WHITESPACE"," ",62],"(","!",["T_VARIABLE","$json",62],")",["T_WHITESPACE"," ",62],"{",["T_WHITESPACE","\n\t\t\t",62],["T_VARIABLE","$file",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$filename",63],["T_WHITESPACE"," ",63],".",["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'.'",63],["T_WHITESPACE"," ",63],".",["T_WHITESPACE"," ",63],["T_STRING","token",63],"(",["T_LNUMBER","32",63],")",";",["T_WHITESPACE","\n\n\t\t\t",63],["T_STRING","move_uploaded_file",65],"(",["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","request",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","files",65],"[",["T_CONSTANT_ENCAPSED_STRING","'file'",65],"]","[",["T_CONSTANT_ENCAPSED_STRING","'tmp_name'",65],"]",",",["T_WHITESPACE"," ",65],["T_STRING","DIR_UPLOAD",65],["T_WHITESPACE"," ",65],".",["T_WHITESPACE"," ",65],["T_VARIABLE","$file",65],")",";",["T_WHITESPACE","\n\n\t\t\t",65],["T_COMMENT","\/\/ Hide the uploaded file name so people can not link to it directly.\n",67],["T_WHITESPACE","\t\t\t",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","load",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","model",68],"(",["T_CONSTANT_ENCAPSED_STRING","'tool\/upload'",68],")",";",["T_WHITESPACE","\n\n\t\t\t",68],["T_VARIABLE","$json",70],"[",["T_CONSTANT_ENCAPSED_STRING","'code'",70],"]",["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","model_tool_upload",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","addUpload",70],"(",["T_VARIABLE","$filename",70],",",["T_WHITESPACE"," ",70],["T_VARIABLE","$file",70],")",";",["T_WHITESPACE","\n\n\t\t\t",70],["T_VARIABLE","$json",72],"[",["T_CONSTANT_ENCAPSED_STRING","'success'",72],"]",["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","language",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","get",72],"(",["T_CONSTANT_ENCAPSED_STRING","'text_upload'",72],")",";",["T_WHITESPACE","\n\t\t",72],"}",["T_WHITESPACE","\n\n\t\t",73],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","response",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","addHeader",75],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Type: application\/json'",75],")",";",["T_WHITESPACE","\n\t\t",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","response",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","setOutput",76],"(",["T_STRING","json_encode",76],"(",["T_VARIABLE","$json",76],")",")",";",["T_WHITESPACE","\n\t",76],"}",["T_WHITESPACE","\n",77],"}"]