[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ModelExtensionPaymentAmazonLoginPay",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Model",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\n\t",2],["T_PUBLIC","public",4],["T_WHITESPACE"," ",4],["T_FUNCTION","function",4],["T_WHITESPACE"," ",4],["T_STRING","install",4],"(",")",["T_WHITESPACE"," ",4],"{",["T_WHITESPACE","\n\t\t",4],["T_VARIABLE","$this",5],["T_OBJECT_OPERATOR","->",5],["T_STRING","db",5],["T_OBJECT_OPERATOR","->",5],["T_STRING","query",5],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE `\"",5],["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_STRING","DB_PREFIX",6],["T_WHITESPACE"," ",6],".",["T_WHITESPACE"," ",6],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order` (\n\t\t\t\t`amazon_login_pay_order_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t\t`order_id` int(11) NOT NULL,\n\t\t\t\t`amazon_order_reference_id` varchar(255) NOT NULL,\n\t\t\t\t`amazon_authorization_id` varchar(255) NOT NULL,\n\t\t\t\t`free_shipping`  tinyint NOT NULL DEFAULT 0,\n\t\t\t\t`date_added` DATETIME NOT NULL,\n\t\t\t\t`modified` DATETIME NOT NULL,\n\t\t\t\t`capture_status` INT(1) DEFAULT NULL,\n\t\t\t\t`cancel_status` INT(1) DEFAULT NULL,\n\t\t\t\t`refund_status` INT(1) DEFAULT NULL,\n\t\t\t\t`currency_code` CHAR(3) NOT NULL,\n\t\t\t\t`total` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t\tKEY `amazon_order_reference_id` (`amazon_order_reference_id`),\n\t\t\t\tPRIMARY KEY `amazon_login_pay_order_id` (`amazon_login_pay_order_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;\n\t\t\"",6],")",";",["T_WHITESPACE","\n\n\t\t",22],["T_VARIABLE","$this",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","db",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","query",24],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE `\"",24],["T_WHITESPACE"," ",25],".",["T_WHITESPACE"," ",25],["T_STRING","DB_PREFIX",25],["T_WHITESPACE"," ",25],".",["T_WHITESPACE"," ",25],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_total_tax` (\n\t\t\t\t`order_total_id`  INT,\n\t\t\t\t`code` VARCHAR(255),\n\t\t\t\t`tax` DECIMAL(10, 4) NOT NULL,\n\t\t\t\tPRIMARY KEY (`order_total_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;\n\t\t\"",25],")",";",["T_WHITESPACE","\n\n\t\t",31],["T_VARIABLE","$this",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","db",33],["T_OBJECT_OPERATOR","->",33],["T_STRING","query",33],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",33],["T_WHITESPACE"," ",34],".",["T_WHITESPACE"," ",34],["T_STRING","DB_PREFIX",34],["T_WHITESPACE"," ",34],".",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction` (\n\t\t\t  `amazon_login_pay_order_transaction_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `amazon_login_pay_order_id` INT(11) NOT NULL,\n\t\t\t  `amazon_authorization_id` varchar(255),\n\t\t\t  `amazon_capture_id` varchar(255),\n\t\t\t  `amazon_refund_id` varchar(255),\n\t\t\t  `date_added` DATETIME NOT NULL,\n\t\t\t  `type` ENUM('authorization', 'capture', 'refund', 'cancel') DEFAULT NULL,\n\t\t\t  `status` ENUM('Open', 'Pending', 'Completed', 'Suspended', 'Declined', 'Closed', 'Canceled') DEFAULT NULL,\n\t\t\t  `amount` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t  PRIMARY KEY (`amazon_login_pay_order_transaction_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\n\t\t\t\"",34],")",";",["T_WHITESPACE","\n\t",46],"}",["T_WHITESPACE","\n\n\t",47],["T_PUBLIC","public",49],["T_WHITESPACE"," ",49],["T_FUNCTION","function",49],["T_WHITESPACE"," ",49],["T_STRING","uninstall",49],"(",")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n\t\t",49],["T_VARIABLE","$this",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","db",50],["T_OBJECT_OPERATOR","->",50],["T_STRING","query",50],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",50],["T_WHITESPACE"," ",50],".",["T_WHITESPACE"," ",50],["T_STRING","DB_PREFIX",50],["T_WHITESPACE"," ",50],".",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order`;\"",50],")",";",["T_WHITESPACE","\n\t\t",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","db",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","query",51],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",51],["T_WHITESPACE"," ",51],".",["T_WHITESPACE"," ",51],["T_STRING","DB_PREFIX",51],["T_WHITESPACE"," ",51],".",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_total_tax`;\"",51],")",";",["T_WHITESPACE","\n\t\t",51],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","db",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","query",52],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_STRING","DB_PREFIX",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction`;\"",52],")",";",["T_WHITESPACE","\n\t",52],"}",["T_WHITESPACE","\n\n\t",53],["T_PUBLIC","public",55],["T_WHITESPACE"," ",55],["T_FUNCTION","function",55],["T_WHITESPACE"," ",55],["T_STRING","getOrder",55],"(",["T_VARIABLE","$order_id",55],")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n\n\t\t",55],["T_VARIABLE","$qry",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","db",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","query",57],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_STRING","DB_PREFIX",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order` WHERE `order_id` = '\"",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_INT_CAST","(int)",57],["T_VARIABLE","$order_id",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","\"' LIMIT 1\"",57],")",";",["T_WHITESPACE","\n\n\t\t",57],["T_IF","if",59],["T_WHITESPACE"," ",59],"(",["T_VARIABLE","$qry",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","num_rows",59],")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n\t\t\t",59],["T_VARIABLE","$order",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$qry",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","row",60],";",["T_WHITESPACE","\n\t\t\t",60],["T_VARIABLE","$order",61],"[",["T_CONSTANT_ENCAPSED_STRING","'transactions'",61],"]",["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","getTransactions",61],"(",["T_VARIABLE","$order",61],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_order_id'",61],"]",",",["T_WHITESPACE"," ",61],["T_VARIABLE","$qry",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","row",61],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",61],"]",")",";",["T_WHITESPACE","\n\t\t\t",61],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$order",62],";",["T_WHITESPACE","\n\t\t",62],"}",["T_WHITESPACE"," ",63],["T_ELSE","else",63],["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n\t\t\t",63],["T_RETURN","return",64],["T_WHITESPACE"," ",64],["T_STRING","false",64],";",["T_WHITESPACE","\n\t\t",64],"}",["T_WHITESPACE","\n\t",65],"}",["T_WHITESPACE","\n\n\t",66],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","cancel",68],"(",["T_VARIABLE","$amazon_login_pay_order",68],")",["T_WHITESPACE"," ",68],"{",["T_WHITESPACE","\n\t\t",68],["T_VARIABLE","$total_captured",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","getTotalCaptured",69],"(",["T_VARIABLE","$amazon_login_pay_order",69],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_order_id'",69],"]",")",";",["T_WHITESPACE","\n\n\t\t",69],["T_IF","if",71],["T_WHITESPACE"," ",71],"(","!",["T_EMPTY","empty",71],"(",["T_VARIABLE","$amazon_login_pay_order",71],")",["T_WHITESPACE"," ",71],["T_BOOLEAN_AND","&&",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$total_captured",71],["T_WHITESPACE"," ",71],["T_IS_EQUAL","==",71],["T_WHITESPACE"," ",71],["T_LNUMBER","0",71],")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n\n\t\t\t",71],["T_VARIABLE","$cancel_response",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",")",";",["T_WHITESPACE","\n\t\t\t",73],["T_VARIABLE","$cancel_paramter_data",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_ARRAY","array",74],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",74],["T_VARIABLE","$cancel_paramter_data",76],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonOrderReferenceId'",76],"]",["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$amazon_login_pay_order",76],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_order_reference_id'",76],"]",";",["T_WHITESPACE","\n\t\t\t",76],["T_VARIABLE","$cancel_details",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","offAmazon",77],"(",["T_CONSTANT_ENCAPSED_STRING","'CancelOrderReference'",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$cancel_paramter_data",77],")",";",["T_WHITESPACE","\n\t\t\t",77],["T_VARIABLE","$cancel_details_xml",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","simplexml_load_string",78],"(",["T_VARIABLE","$cancel_details",78],"[",["T_CONSTANT_ENCAPSED_STRING","'ResponseBody'",78],"]",")",";",["T_WHITESPACE","\n\t\t\t",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","logger",79],"(",["T_VARIABLE","$cancel_details_xml",79],")",";",["T_WHITESPACE","\n\t\t\t",79],["T_IF","if",80],["T_WHITESPACE"," ",80],"(",["T_ISSET","isset",80],"(",["T_VARIABLE","$cancel_details_xml",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","Error",80],")",")",["T_WHITESPACE"," ",80],"{",["T_WHITESPACE","\n\t\t\t\t",80],["T_VARIABLE","$cancel_response",81],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",81],"]",["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'Error'",81],";",["T_WHITESPACE","\n\t\t\t\t",81],["T_VARIABLE","$cancel_response",82],"[",["T_CONSTANT_ENCAPSED_STRING","'status_detail'",82],"]",["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_STRING_CAST","(string)",82],["T_VARIABLE","$cancel_details_xml",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","Error",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","Code",82],["T_WHITESPACE"," ",82],".",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","': '",82],["T_WHITESPACE"," ",82],".",["T_WHITESPACE"," ",82],["T_STRING_CAST","(string)",82],["T_VARIABLE","$cancel_details_xml",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","Error",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","Message",82],";",["T_WHITESPACE","\n\t\t\t",82],"}",["T_WHITESPACE"," ",83],["T_ELSE","else",83],["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n\t\t\t\t",83],["T_VARIABLE","$cancel_response",84],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",84],"]",["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","'Completed'",84],";",["T_WHITESPACE","\n\t\t\t",84],"}",["T_WHITESPACE","\n\t\t\t",85],["T_RETURN","return",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$cancel_response",86],";",["T_WHITESPACE","\n\t\t",86],"}",["T_WHITESPACE"," ",87],["T_ELSE","else",87],["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n\t\t\t",87],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_STRING","false",88],";",["T_WHITESPACE","\n\t\t",88],"}",["T_WHITESPACE","\n\t",89],"}",["T_WHITESPACE","\n\n\t",90],["T_PUBLIC","public",92],["T_WHITESPACE"," ",92],["T_FUNCTION","function",92],["T_WHITESPACE"," ",92],["T_STRING","updateCancelStatus",92],"(",["T_VARIABLE","$amazon_login_pay_order_id",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$status",92],")",["T_WHITESPACE"," ",92],"{",["T_WHITESPACE","\n\t\t",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","db",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","query",93],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_STRING","DB_PREFIX",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order` SET `cancel_status` = '\"",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_INT_CAST","(int)",93],["T_VARIABLE","$status",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `amazon_login_pay_order_id` = '\"",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_INT_CAST","(int)",93],["T_VARIABLE","$amazon_login_pay_order_id",93],["T_WHITESPACE"," ",93],".",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","\"'\"",93],")",";",["T_WHITESPACE","\n\t",93],"}",["T_WHITESPACE","\n\n\t",94],["T_PUBLIC","public",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","capture",96],"(",["T_VARIABLE","$amazon_login_pay_order",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$amount",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n\t\t",96],["T_VARIABLE","$total_captured",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","getTotalCaptured",97],"(",["T_VARIABLE","$amazon_login_pay_order",97],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_order_id'",97],"]",")",";",["T_WHITESPACE","\n\n\t\t",97],["T_IF","if",99],["T_WHITESPACE"," ",99],"(","!",["T_EMPTY","empty",99],"(",["T_VARIABLE","$amazon_login_pay_order",99],")",["T_WHITESPACE"," ",99],["T_BOOLEAN_AND","&&",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$amazon_login_pay_order",99],"[",["T_CONSTANT_ENCAPSED_STRING","'capture_status'",99],"]",["T_WHITESPACE"," ",99],["T_IS_EQUAL","==",99],["T_WHITESPACE"," ",99],["T_LNUMBER","0",99],["T_WHITESPACE"," ",99],["T_BOOLEAN_AND","&&",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$total_captured",99],["T_WHITESPACE"," ",99],"+",["T_WHITESPACE"," ",99],["T_VARIABLE","$amount",99],["T_WHITESPACE"," ",99],["T_IS_SMALLER_OR_EQUAL","<=",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$amazon_login_pay_order",99],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",99],"]",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n\t\t\t",99],["T_IF","if",100],["T_WHITESPACE"," ",100],"(",["T_STRING","count",100],"(",["T_VARIABLE","$amazon_login_pay_order",100],"[",["T_CONSTANT_ENCAPSED_STRING","'transactions'",100],"]",")",["T_WHITESPACE"," ",100],["T_IS_NOT_EQUAL","!=",100],["T_WHITESPACE"," ",100],["T_LNUMBER","1",100],")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n\t\t\t\t",100],["T_VARIABLE","$amazon_authorization",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","authorize",101],"(",["T_VARIABLE","$amazon_login_pay_order",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$amount",101],")",";",["T_WHITESPACE","\n\t\t\t\t",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_ISSET","isset",102],"(",["T_VARIABLE","$amazon_authorization",102],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonAuthorizationId'",102],"]",")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n\t\t\t\t\t",102],["T_VARIABLE","$amazon_authorization_id",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$amazon_authorization",103],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonAuthorizationId'",103],"]",";",["T_WHITESPACE","\n\t\t\t\t",103],"}",["T_WHITESPACE"," ",104],["T_ELSE","else",104],["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n\t\t\t\t\t",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$amazon_authorization",105],";",["T_WHITESPACE","\n\t\t\t\t",105],"}",["T_WHITESPACE","\n\t\t\t",106],"}",["T_WHITESPACE"," ",107],["T_ELSE","else",107],["T_WHITESPACE"," ",107],"{",["T_WHITESPACE","\n\t\t\t\t",107],["T_VARIABLE","$amazon_authorization_id",108],["T_WHITESPACE"," ",108],"=",["T_WHITESPACE"," ",108],["T_VARIABLE","$amazon_login_pay_order",108],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_authorization_id'",108],"]",";",["T_WHITESPACE","\n\t\t\t",108],"}",["T_WHITESPACE","\n\n\t\t\t",109],["T_VARIABLE","$capture_paramter_data",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_ARRAY","array",111],"(",")",";",["T_WHITESPACE","\n\t\t\t",111],["T_VARIABLE","$capture_paramter_data",112],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonOrderReferenceId'",112],"]",["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_VARIABLE","$amazon_login_pay_order",112],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_order_reference_id'",112],"]",";",["T_WHITESPACE","\n\t\t\t",112],["T_VARIABLE","$capture_paramter_data",113],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonAuthorizationId'",113],"]",["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$amazon_authorization_id",113],";",["T_WHITESPACE","\n\t\t\t",113],["T_VARIABLE","$capture_paramter_data",114],"[",["T_CONSTANT_ENCAPSED_STRING","'CaptureAmount.Amount'",114],"]",["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$amount",114],";",["T_WHITESPACE","\n\t\t\t",114],["T_VARIABLE","$capture_paramter_data",115],"[",["T_CONSTANT_ENCAPSED_STRING","'CaptureAmount.CurrencyCode'",115],"]",["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$amazon_login_pay_order",115],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",115],"]",";",["T_WHITESPACE","\n\t\t\t",115],["T_VARIABLE","$capture_paramter_data",116],"[",["T_CONSTANT_ENCAPSED_STRING","'CaptureReferenceId'",116],"]",["T_WHITESPACE"," ",116],"=",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'capture_'",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_STRING","mt_rand",116],"(",")",";",["T_WHITESPACE","\n\t\t\t",116],["T_VARIABLE","$capture_paramter_data",117],"[",["T_CONSTANT_ENCAPSED_STRING","'TransactionTimeout'",117],"]",["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_LNUMBER","0",117],";",["T_WHITESPACE","\n\t\t\t",117],["T_VARIABLE","$capture_details",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","offAmazon",118],"(",["T_CONSTANT_ENCAPSED_STRING","'Capture'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$capture_paramter_data",118],")",";",["T_WHITESPACE","\n\n\t\t\t",118],["T_VARIABLE","$capture_response",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","validateResponse",120],"(",["T_CONSTANT_ENCAPSED_STRING","'Capture'",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$capture_details",120],")",";",["T_WHITESPACE","\n\t\t\t",120],["T_VARIABLE","$capture_response",121],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonAuthorizationId'",121],"]",["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$amazon_authorization_id",121],";",["T_WHITESPACE","\n\t\t\t",121],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$capture_response",122],";",["T_WHITESPACE","\n\t\t",122],"}",["T_WHITESPACE"," ",123],["T_ELSE","else",123],["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n\t\t\t",123],["T_RETURN","return",124],["T_WHITESPACE"," ",124],["T_STRING","false",124],";",["T_WHITESPACE","\n\t\t",124],"}",["T_WHITESPACE","\n\t",125],"}",["T_WHITESPACE","\n\n\t",126],["T_PRIVATE","private",128],["T_WHITESPACE"," ",128],["T_FUNCTION","function",128],["T_WHITESPACE"," ",128],["T_STRING","authorize",128],"(",["T_VARIABLE","$amazon_login_pay_order",128],",",["T_WHITESPACE"," ",128],["T_VARIABLE","$amount",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n\t\t",128],["T_VARIABLE","$authorize_paramter_data",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_ARRAY","array",129],"(",")",";",["T_WHITESPACE","\n\t\t",129],["T_VARIABLE","$authorize_paramter_data",130],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonOrderReferenceId'",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_VARIABLE","$amazon_login_pay_order",130],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_order_reference_id'",130],"]",";",["T_WHITESPACE","\n\t\t",130],["T_VARIABLE","$authorize_paramter_data",131],"[",["T_CONSTANT_ENCAPSED_STRING","'AuthorizationAmount.Amount'",131],"]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$amount",131],";",["T_WHITESPACE","\n\t\t",131],["T_VARIABLE","$authorize_paramter_data",132],"[",["T_CONSTANT_ENCAPSED_STRING","'AuthorizationAmount.CurrencyCode'",132],"]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$amazon_login_pay_order",132],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",132],"]",";",["T_WHITESPACE","\n\t\t",132],["T_VARIABLE","$authorize_paramter_data",133],"[",["T_CONSTANT_ENCAPSED_STRING","'AuthorizationReferenceId'",133],"]",["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_CONSTANT_ENCAPSED_STRING","'auth_'",133],["T_WHITESPACE"," ",133],".",["T_WHITESPACE"," ",133],["T_STRING","mt_rand",133],"(",")",";",["T_WHITESPACE","\n\t\t",133],["T_VARIABLE","$authorize_paramter_data",134],"[",["T_CONSTANT_ENCAPSED_STRING","'TransactionTimeout'",134],"]",["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_LNUMBER","0",134],";",["T_WHITESPACE","\n\t\t",134],["T_VARIABLE","$authorize_details",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","offAmazon",135],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorize'",135],",",["T_WHITESPACE"," ",135],["T_VARIABLE","$authorize_paramter_data",135],")",";",["T_WHITESPACE","\n\n\t\t",135],["T_RETURN","return",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","validateResponse",137],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorize'",137],",",["T_WHITESPACE"," ",137],["T_VARIABLE","$authorize_details",137],")",";",["T_WHITESPACE","\n\t",137],"}",["T_WHITESPACE","\n\n\t",138],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","closeOrderRef",140],"(",["T_VARIABLE","$amazon_order_reference_id",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n\t\t",140],["T_VARIABLE","$close_paramter_data",141],["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_ARRAY","array",141],"(",")",";",["T_WHITESPACE","\n\t\t",141],["T_VARIABLE","$close_paramter_data",142],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonOrderReferenceId'",142],"]",["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$amazon_order_reference_id",142],";",["T_WHITESPACE","\n\t\t",142],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","offAmazon",143],"(",["T_CONSTANT_ENCAPSED_STRING","'CloseOrderReference'",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$close_paramter_data",143],")",";",["T_WHITESPACE","\n\t\t",143],["T_VARIABLE","$close_details",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","offAmazon",144],"(",["T_CONSTANT_ENCAPSED_STRING","'CloseOrderReference'",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$close_paramter_data",144],")",";",["T_WHITESPACE","\n\t\t",144],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","logger",145],"(",["T_VARIABLE","$close_details",145],")",";",["T_WHITESPACE","\n\t",145],"}",["T_WHITESPACE","\n\n\t",146],["T_PUBLIC","public",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","updateCaptureStatus",148],"(",["T_VARIABLE","$amazon_login_pay_order_id",148],",",["T_WHITESPACE"," ",148],["T_VARIABLE","$status",148],")",["T_WHITESPACE"," ",148],"{",["T_WHITESPACE","\n\t\t",148],["T_VARIABLE","$this",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","db",149],["T_OBJECT_OPERATOR","->",149],["T_STRING","query",149],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_STRING","DB_PREFIX",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order` SET `capture_status` = '\"",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_INT_CAST","(int)",149],["T_VARIABLE","$status",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `amazon_login_pay_order_id` = '\"",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_INT_CAST","(int)",149],["T_VARIABLE","$amazon_login_pay_order_id",149],["T_WHITESPACE"," ",149],".",["T_WHITESPACE"," ",149],["T_CONSTANT_ENCAPSED_STRING","\"'\"",149],")",";",["T_WHITESPACE","\n\t",149],"}",["T_WHITESPACE","\n\n\t",150],["T_PUBLIC","public",152],["T_WHITESPACE"," ",152],["T_FUNCTION","function",152],["T_WHITESPACE"," ",152],["T_STRING","refund",152],"(",["T_VARIABLE","$amazon_login_pay_order",152],",",["T_WHITESPACE"," ",152],["T_VARIABLE","$amount",152],")",["T_WHITESPACE"," ",152],"{",["T_WHITESPACE","\n\t\t",152],["T_IF","if",153],["T_WHITESPACE"," ",153],"(","!",["T_EMPTY","empty",153],"(",["T_VARIABLE","$amazon_login_pay_order",153],")",["T_WHITESPACE"," ",153],["T_BOOLEAN_AND","&&",153],["T_WHITESPACE"," ",153],["T_VARIABLE","$amazon_login_pay_order",153],"[",["T_CONSTANT_ENCAPSED_STRING","'refund_status'",153],"]",["T_WHITESPACE"," ",153],["T_IS_NOT_EQUAL","!=",153],["T_WHITESPACE"," ",153],["T_LNUMBER","1",153],")",["T_WHITESPACE"," ",153],"{",["T_WHITESPACE","\n\t\t\t",153],["T_VARIABLE","$amazon_captures_remaining",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],["T_VARIABLE","$this",154],["T_OBJECT_OPERATOR","->",154],["T_STRING","getUnCaptured",154],"(",["T_VARIABLE","$amazon_login_pay_order",154],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_order_id'",154],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",154],["T_VARIABLE","$refund_response",156],["T_WHITESPACE"," ",156],"=",["T_WHITESPACE"," ",156],["T_ARRAY","array",156],"(",")",";",["T_WHITESPACE","\n\t\t\t",156],["T_VARIABLE","$i",157],["T_WHITESPACE"," ",157],"=",["T_WHITESPACE"," ",157],["T_LNUMBER","0",157],";",["T_WHITESPACE","\n\t\t\t",157],["T_VARIABLE","$count",158],["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_STRING","count",158],"(",["T_VARIABLE","$amazon_captures_remaining",158],")",";",["T_WHITESPACE","\n\t\t\t",158],["T_FOR","for",159],["T_WHITESPACE"," ",159],"(",["T_VARIABLE","$amount",159],";",["T_WHITESPACE"," ",159],["T_VARIABLE","$amount",159],["T_WHITESPACE"," ",159],">",["T_WHITESPACE"," ",159],["T_LNUMBER","0",159],["T_WHITESPACE"," ",159],["T_BOOLEAN_AND","&&",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$count",159],["T_WHITESPACE"," ",159],">",["T_WHITESPACE"," ",159],["T_VARIABLE","$i",159],";",["T_WHITESPACE"," ",159],["T_VARIABLE","$amount",159],["T_WHITESPACE"," ",159],["T_MINUS_EQUAL","-=",159],["T_WHITESPACE"," ",159],["T_VARIABLE","$amazon_captures_remaining",159],"[",["T_VARIABLE","$i",159],["T_INC","++",159],"]","[",["T_CONSTANT_ENCAPSED_STRING","'capture_remaining'",159],"]",")",["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n\t\t\t\t",159],["T_VARIABLE","$refund_amount",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$amount",160],";",["T_WHITESPACE","\n\t\t\t\t",160],["T_IF","if",161],["T_WHITESPACE"," ",161],"(",["T_VARIABLE","$amazon_captures_remaining",161],"[",["T_VARIABLE","$i",161],"]","[",["T_CONSTANT_ENCAPSED_STRING","'capture_remaining'",161],"]",["T_WHITESPACE"," ",161],["T_IS_SMALLER_OR_EQUAL","<=",161],["T_WHITESPACE"," ",161],["T_VARIABLE","$amount",161],")",["T_WHITESPACE"," ",161],"{",["T_WHITESPACE","\n\t\t\t\t\t",161],["T_VARIABLE","$refund_amount",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$amazon_captures_remaining",162],"[",["T_VARIABLE","$i",162],"]","[",["T_CONSTANT_ENCAPSED_STRING","'capture_remaining'",162],"]",";",["T_WHITESPACE","\n\t\t\t\t",162],"}",["T_WHITESPACE","\n\n\t\t\t\t",163],["T_VARIABLE","$refund_paramter_data",165],["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_ARRAY","array",165],"(",")",";",["T_WHITESPACE","\n\t\t\t\t",165],["T_VARIABLE","$refund_paramter_data",166],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonOrderReferenceId'",166],"]",["T_WHITESPACE"," ",166],"=",["T_WHITESPACE"," ",166],["T_VARIABLE","$amazon_login_pay_order",166],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_order_reference_id'",166],"]",";",["T_WHITESPACE","\n\t\t\t\t",166],["T_VARIABLE","$refund_paramter_data",167],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonCaptureId'",167],"]",["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$amazon_captures_remaining",167],"[",["T_VARIABLE","$i",167],"]","[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",167],"]",";",["T_WHITESPACE","\n\t\t\t\t",167],["T_VARIABLE","$refund_paramter_data",168],"[",["T_CONSTANT_ENCAPSED_STRING","'RefundAmount.Amount'",168],"]",["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$refund_amount",168],";",["T_WHITESPACE","\n\t\t\t\t",168],["T_VARIABLE","$refund_paramter_data",169],"[",["T_CONSTANT_ENCAPSED_STRING","'RefundAmount.CurrencyCode'",169],"]",["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$amazon_login_pay_order",169],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",169],"]",";",["T_WHITESPACE","\n\t\t\t\t",169],["T_VARIABLE","$refund_paramter_data",170],"[",["T_CONSTANT_ENCAPSED_STRING","'RefundReferenceId'",170],"]",["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_CONSTANT_ENCAPSED_STRING","'refund_'",170],["T_WHITESPACE"," ",170],".",["T_WHITESPACE"," ",170],["T_STRING","mt_rand",170],"(",")",";",["T_WHITESPACE","\n\t\t\t\t",170],["T_VARIABLE","$refund_paramter_data",171],"[",["T_CONSTANT_ENCAPSED_STRING","'TransactionTimeout'",171],"]",["T_WHITESPACE"," ",171],"=",["T_WHITESPACE"," ",171],["T_LNUMBER","0",171],";",["T_WHITESPACE","\n\t\t\t\t",171],["T_VARIABLE","$refund_details",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","offAmazon",172],"(",["T_CONSTANT_ENCAPSED_STRING","'Refund'",172],",",["T_WHITESPACE"," ",172],["T_VARIABLE","$refund_paramter_data",172],")",";",["T_WHITESPACE","\n\t\t\t\t",172],["T_VARIABLE","$refund_response",173],"[",["T_VARIABLE","$i",173],"]",["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","validateResponse",173],"(",["T_CONSTANT_ENCAPSED_STRING","'Refund'",173],",",["T_WHITESPACE"," ",173],["T_VARIABLE","$refund_details",173],")",";",["T_WHITESPACE","\n\t\t\t\t",173],["T_VARIABLE","$refund_response",174],"[",["T_VARIABLE","$i",174],"]","[",["T_CONSTANT_ENCAPSED_STRING","'amazon_authorization_id'",174],"]",["T_WHITESPACE"," ",174],"=",["T_WHITESPACE"," ",174],["T_VARIABLE","$amazon_captures_remaining",174],"[",["T_VARIABLE","$i",174],"]","[",["T_CONSTANT_ENCAPSED_STRING","'amazon_authorization_id'",174],"]",";",["T_WHITESPACE","\n\t\t\t\t",174],["T_VARIABLE","$refund_response",175],"[",["T_VARIABLE","$i",175],"]","[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",175],"]",["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$amazon_captures_remaining",175],"[",["T_VARIABLE","$i",175],"]","[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",175],"]",";",["T_WHITESPACE","\n\t\t\t\t",175],["T_VARIABLE","$refund_response",176],"[",["T_VARIABLE","$i",176],"]","[",["T_CONSTANT_ENCAPSED_STRING","'amount'",176],"]",["T_WHITESPACE"," ",176],"=",["T_WHITESPACE"," ",176],["T_VARIABLE","$refund_amount",176],";",["T_WHITESPACE","\n\t\t\t",176],"}",["T_WHITESPACE","\n\n\t\t\t",177],["T_RETURN","return",179],["T_WHITESPACE"," ",179],["T_VARIABLE","$refund_response",179],";",["T_WHITESPACE","\n\t\t",179],"}",["T_WHITESPACE"," ",180],["T_ELSE","else",180],["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n\t\t\t",180],["T_RETURN","return",181],["T_WHITESPACE"," ",181],["T_STRING","false",181],";",["T_WHITESPACE","\n\t\t",181],"}",["T_WHITESPACE","\n\t",182],"}",["T_WHITESPACE","\n\n\t",183],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","getUnCaptured",185],"(",["T_VARIABLE","$amazon_login_pay_order_id",185],")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n\t\t",185],["T_VARIABLE","$qry",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","db",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","query",186],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",186],["T_WHITESPACE"," ",186],".",["T_WHITESPACE"," ",186],["T_STRING","DB_PREFIX",186],["T_WHITESPACE"," ",186],".",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction` WHERE (`type` = 'refund' OR `type` = 'capture') AND `amazon_login_pay_order_id` = '\"",186],["T_WHITESPACE"," ",186],".",["T_WHITESPACE"," ",186],["T_INT_CAST","(int)",186],["T_VARIABLE","$amazon_login_pay_order_id",186],["T_WHITESPACE"," ",186],".",["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","\"' ORDER BY `date_added`\"",186],")",";",["T_WHITESPACE","\n\t\t",186],["T_VARIABLE","$uncaptured",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_ARRAY","array",187],"(",")",";",["T_WHITESPACE","\n\t\t",187],["T_FOREACH","foreach",188],["T_WHITESPACE"," ",188],"(",["T_VARIABLE","$qry",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","rows",188],["T_WHITESPACE"," ",188],["T_AS","as",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$row",188],")",["T_WHITESPACE"," ",188],"{",["T_WHITESPACE","\n\t\t\t",188],["T_VARIABLE","$uncaptured",189],"[",["T_VARIABLE","$row",189],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",189],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'amazon_authorization_id'",189],"]",["T_WHITESPACE"," ",189],"=",["T_WHITESPACE"," ",189],["T_VARIABLE","$row",189],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_authorization_id'",189],"]",";",["T_WHITESPACE","\n\t\t\t",189],["T_VARIABLE","$uncaptured",190],"[",["T_VARIABLE","$row",190],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",190],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",190],"]",["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$row",190],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",190],"]",";",["T_WHITESPACE","\n\t\t\t",190],["T_IF","if",191],["T_WHITESPACE"," ",191],"(",["T_ISSET","isset",191],"(",["T_VARIABLE","$uncaptured",191],"[",["T_VARIABLE","$row",191],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",191],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'capture_remaining'",191],"]",")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n\t\t\t\t",191],["T_VARIABLE","$uncaptured",192],"[",["T_VARIABLE","$row",192],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",192],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'capture_remaining'",192],"]",["T_WHITESPACE"," ",192],["T_PLUS_EQUAL","+=",192],["T_WHITESPACE"," ",192],["T_VARIABLE","$row",192],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",192],"]",";",["T_WHITESPACE","\n\t\t\t",192],"}",["T_WHITESPACE"," ",193],["T_ELSE","else",193],["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n\t\t\t\t",193],["T_VARIABLE","$uncaptured",194],"[",["T_VARIABLE","$row",194],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",194],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'capture_remaining'",194],"]",["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_VARIABLE","$row",194],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",194],"]",";",["T_WHITESPACE","\n\t\t\t",194],"}",["T_WHITESPACE","\n\n\t\t\t",195],["T_IF","if",197],["T_WHITESPACE"," ",197],"(",["T_VARIABLE","$uncaptured",197],"[",["T_VARIABLE","$row",197],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",197],"]","]","[",["T_CONSTANT_ENCAPSED_STRING","'capture_remaining'",197],"]",["T_WHITESPACE"," ",197],["T_IS_EQUAL","==",197],["T_WHITESPACE"," ",197],["T_LNUMBER","0",197],")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n\t\t\t\t",197],["T_UNSET","unset",198],"(",["T_VARIABLE","$uncaptured",198],"[",["T_VARIABLE","$row",198],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_capture_id'",198],"]","]",")",";",["T_WHITESPACE","\n\t\t\t",198],"}",["T_WHITESPACE","\n\t\t",199],"}",["T_WHITESPACE","\n\t\t",200],["T_RETURN","return",201],["T_WHITESPACE"," ",201],["T_STRING","array_values",201],"(",["T_VARIABLE","$uncaptured",201],")",";",["T_WHITESPACE","\n\t",201],"}",["T_WHITESPACE","\n\n\t",202],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","updateRefundStatus",204],"(",["T_VARIABLE","$amazon_login_pay_order_id",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$status",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n\t\t",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","db",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","query",205],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_STRING","DB_PREFIX",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order` SET `refund_status` = '\"",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_INT_CAST","(int)",205],["T_VARIABLE","$status",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `amazon_login_pay_order_id` = '\"",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_INT_CAST","(int)",205],["T_VARIABLE","$amazon_login_pay_order_id",205],["T_WHITESPACE"," ",205],".",["T_WHITESPACE"," ",205],["T_CONSTANT_ENCAPSED_STRING","\"'\"",205],")",";",["T_WHITESPACE","\n\t",205],"}",["T_WHITESPACE","\n\n\t",206],["T_PUBLIC","public",208],["T_WHITESPACE"," ",208],["T_FUNCTION","function",208],["T_WHITESPACE"," ",208],["T_STRING","getCapturesRemaining",208],"(",["T_VARIABLE","$amazon_login_pay_order_id",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n\t\t",208],["T_VARIABLE","$query",209],["T_WHITESPACE"," ",209],"=",["T_WHITESPACE"," ",209],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","db",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","query",209],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_STRING","DB_PREFIX",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction` WHERE `amazon_login_pay_order_id` = '\"",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_INT_CAST","(int)",209],["T_VARIABLE","$amazon_login_pay_order_id",209],["T_WHITESPACE"," ",209],".",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","\"' AND capture_remaining != '0' ORDER BY `date_added`\"",209],")",";",["T_WHITESPACE","\n\t\t",209],["T_IF","if",210],["T_WHITESPACE"," ",210],"(",["T_VARIABLE","$query",210],["T_OBJECT_OPERATOR","->",210],["T_STRING","num_rows",210],")",["T_WHITESPACE"," ",210],"{",["T_WHITESPACE","\n\t\t\t",210],["T_RETURN","return",211],["T_WHITESPACE"," ",211],["T_VARIABLE","$query",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","rows",211],";",["T_WHITESPACE","\n\t\t",211],"}",["T_WHITESPACE"," ",212],["T_ELSE","else",212],["T_WHITESPACE"," ",212],"{",["T_WHITESPACE","\n\t\t\t",212],["T_RETURN","return",213],["T_WHITESPACE"," ",213],["T_STRING","false",213],";",["T_WHITESPACE","\n\t\t",213],"}",["T_WHITESPACE","\n\t",214],"}",["T_WHITESPACE","\n\n\t",215],["T_PRIVATE","private",217],["T_WHITESPACE"," ",217],["T_FUNCTION","function",217],["T_WHITESPACE"," ",217],["T_STRING","getTransactions",217],"(",["T_VARIABLE","$amazon_login_pay_order_id",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$currency_code",217],")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n\t\t",217],["T_VARIABLE","$query",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","db",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","query",218],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",218],["T_WHITESPACE"," ",218],".",["T_WHITESPACE"," ",218],["T_STRING","DB_PREFIX",218],["T_WHITESPACE"," ",218],".",["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction` WHERE `amazon_login_pay_order_id` = '\"",218],["T_WHITESPACE"," ",218],".",["T_WHITESPACE"," ",218],["T_INT_CAST","(int)",218],["T_VARIABLE","$amazon_login_pay_order_id",218],["T_WHITESPACE"," ",218],".",["T_WHITESPACE"," ",218],["T_CONSTANT_ENCAPSED_STRING","\"'\"",218],")",";",["T_WHITESPACE","\n\n\t\t",218],["T_VARIABLE","$transactions",220],["T_WHITESPACE"," ",220],"=",["T_WHITESPACE"," ",220],["T_ARRAY","array",220],"(",")",";",["T_WHITESPACE","\n\t\t",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(",["T_VARIABLE","$query",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","num_rows",221],")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n\t\t\t",221],["T_FOREACH","foreach",222],["T_WHITESPACE"," ",222],"(",["T_VARIABLE","$query",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","rows",222],["T_WHITESPACE"," ",222],["T_AS","as",222],["T_WHITESPACE"," ",222],["T_VARIABLE","$row",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n\t\t\t\t",222],["T_VARIABLE","$row",223],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",223],"]",["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","currency",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","format",223],"(",["T_VARIABLE","$row",223],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",223],"]",",",["T_WHITESPACE"," ",223],["T_VARIABLE","$currency_code",223],",",["T_WHITESPACE"," ",223],["T_STRING","true",223],",",["T_WHITESPACE"," ",223],["T_STRING","true",223],")",";",["T_WHITESPACE","\n\t\t\t\t",223],["T_VARIABLE","$transactions",224],"[","]",["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_VARIABLE","$row",224],";",["T_WHITESPACE","\n\t\t\t",224],"}",["T_WHITESPACE","\n\t\t\t",225],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_VARIABLE","$transactions",226],";",["T_WHITESPACE","\n\t\t",226],"}",["T_WHITESPACE"," ",227],["T_ELSE","else",227],["T_WHITESPACE"," ",227],"{",["T_WHITESPACE","\n\t\t\t",227],["T_RETURN","return",228],["T_WHITESPACE"," ",228],["T_STRING","false",228],";",["T_WHITESPACE","\n\t\t",228],"}",["T_WHITESPACE","\n\t",229],"}",["T_WHITESPACE","\n\n\t",230],["T_PUBLIC","public",232],["T_WHITESPACE"," ",232],["T_FUNCTION","function",232],["T_WHITESPACE"," ",232],["T_STRING","addTransaction",232],"(",["T_VARIABLE","$amazon_login_pay_order_id",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$type",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$status",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$total",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$amazon_authorization_id",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_STRING","null",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$amazon_capture_id",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_STRING","null",232],",",["T_WHITESPACE"," ",232],["T_VARIABLE","$amazon_refund_id",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_STRING","null",232],")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n\t\t",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","db",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","query",233],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_STRING","DB_PREFIX",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction` SET `amazon_login_pay_order_id` = '\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_INT_CAST","(int)",233],["T_VARIABLE","$amazon_login_pay_order_id",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"',`amazon_authorization_id` = '\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","db",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","escape",233],"(",["T_VARIABLE","$amazon_authorization_id",233],")",["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"',`amazon_capture_id` = '\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","db",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","escape",233],"(",["T_VARIABLE","$amazon_capture_id",233],")",["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"',`amazon_refund_id` = '\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","db",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","escape",233],"(",["T_VARIABLE","$amazon_refund_id",233],")",["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"',  `date_added` = now(), `type` = '\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","db",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","escape",233],"(",["T_VARIABLE","$type",233],")",["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"', `amount` = '\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_DOUBLE_CAST","(double)",233],["T_VARIABLE","$total",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"', `status` = '\"",233],["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","db",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","escape",233],"(",["T_VARIABLE","$status",233],")",["T_WHITESPACE"," ",233],".",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","\"'\"",233],")",";",["T_WHITESPACE","\n\t",233],"}",["T_WHITESPACE","\n\n\t",234],["T_PUBLIC","public",236],["T_WHITESPACE"," ",236],["T_FUNCTION","function",236],["T_WHITESPACE"," ",236],["T_STRING","getTotalCaptured",236],"(",["T_VARIABLE","$amazon_login_pay_order_id",236],")",["T_WHITESPACE"," ",236],"{",["T_WHITESPACE","\n\t\t",236],["T_VARIABLE","$query",237],["T_WHITESPACE"," ",237],"=",["T_WHITESPACE"," ",237],["T_VARIABLE","$this",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","db",237],["T_OBJECT_OPERATOR","->",237],["T_STRING","query",237],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",237],["T_WHITESPACE"," ",237],".",["T_WHITESPACE"," ",237],["T_STRING","DB_PREFIX",237],["T_WHITESPACE"," ",237],".",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction` WHERE `amazon_login_pay_order_id` = '\"",237],["T_WHITESPACE"," ",237],".",["T_WHITESPACE"," ",237],["T_INT_CAST","(int)",237],["T_VARIABLE","$amazon_login_pay_order_id",237],["T_WHITESPACE"," ",237],".",["T_WHITESPACE"," ",237],["T_CONSTANT_ENCAPSED_STRING","\"' AND (`type` = 'capture' OR `type` = 'refund') AND (`status` = 'Completed' OR `status` = 'Closed')\"",237],")",";",["T_WHITESPACE","\n\n\t\t",237],["T_RETURN","return",239],["T_WHITESPACE"," ",239],["T_DOUBLE_CAST","(double)",239],["T_VARIABLE","$query",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","row",239],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",239],"]",";",["T_WHITESPACE","\n\t",239],"}",["T_WHITESPACE","\n\n\t",240],["T_PUBLIC","public",242],["T_WHITESPACE"," ",242],["T_FUNCTION","function",242],["T_WHITESPACE"," ",242],["T_STRING","getTotalRefunded",242],"(",["T_VARIABLE","$amazon_login_pay_order_id",242],")",["T_WHITESPACE"," ",242],"{",["T_WHITESPACE","\n\t\t",242],["T_VARIABLE","$query",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_VARIABLE","$this",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","db",243],["T_OBJECT_OPERATOR","->",243],["T_STRING","query",243],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",243],["T_WHITESPACE"," ",243],".",["T_WHITESPACE"," ",243],["T_STRING","DB_PREFIX",243],["T_WHITESPACE"," ",243],".",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","\"amazon_login_pay_order_transaction` WHERE `amazon_login_pay_order_id` = '\"",243],["T_WHITESPACE"," ",243],".",["T_WHITESPACE"," ",243],["T_INT_CAST","(int)",243],["T_VARIABLE","$amazon_login_pay_order_id",243],["T_WHITESPACE"," ",243],".",["T_WHITESPACE"," ",243],["T_CONSTANT_ENCAPSED_STRING","\"' AND 'refund'\"",243],")",";",["T_WHITESPACE","\n\n\t\t",243],["T_RETURN","return",245],["T_WHITESPACE"," ",245],["T_DOUBLE_CAST","(double)",245],["T_VARIABLE","$query",245],["T_OBJECT_OPERATOR","->",245],["T_STRING","row",245],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",245],"]",";",["T_WHITESPACE","\n\t",245],"}",["T_WHITESPACE","\n\n\t",246],["T_PUBLIC","public",248],["T_WHITESPACE"," ",248],["T_FUNCTION","function",248],["T_WHITESPACE"," ",248],["T_STRING","validateDetails",248],"(",["T_VARIABLE","$data",248],")",["T_WHITESPACE"," ",248],"{",["T_WHITESPACE","\n\t\t",248],["T_VARIABLE","$validate_paramter_data",249],["T_WHITESPACE"," ",249],"=",["T_WHITESPACE"," ",249],["T_ARRAY","array",249],"(",")",";",["T_WHITESPACE","\n\t\t",249],["T_VARIABLE","$validate_paramter_data",250],"[",["T_CONSTANT_ENCAPSED_STRING","'AWSAccessKeyId'",250],"]",["T_WHITESPACE"," ",250],"=",["T_WHITESPACE"," ",250],["T_VARIABLE","$data",250],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_access_key'",250],"]",";",["T_WHITESPACE","\n\t\t",250],["T_VARIABLE","$validate_paramter_data",251],"[",["T_CONSTANT_ENCAPSED_STRING","'SellerId'",251],"]",["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_VARIABLE","$data",251],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_merchant_id'",251],"]",";",["T_WHITESPACE","\n\t\t",251],["T_VARIABLE","$validate_paramter_data",252],"[",["T_CONSTANT_ENCAPSED_STRING","'AmazonOrderReferenceId'",252],"]",["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_CONSTANT_ENCAPSED_STRING","'validate details'",252],";",["T_WHITESPACE","\n\t\t",252],["T_VARIABLE","$validate_details",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","offAmazon",253],"(",["T_CONSTANT_ENCAPSED_STRING","'GetOrderReferenceDetails'",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$validate_paramter_data",253],")",";",["T_WHITESPACE","\n\t\t",253],["T_VARIABLE","$validate_response",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_VARIABLE","$this",254],["T_OBJECT_OPERATOR","->",254],["T_STRING","validateResponse",254],"(",["T_CONSTANT_ENCAPSED_STRING","'GetOrderReferenceDetails'",254],",",["T_WHITESPACE"," ",254],["T_VARIABLE","$validate_details",254],")",";",["T_WHITESPACE","\n\t\t",254],["T_IF","if",255],"(",["T_VARIABLE","$validate_response",255],"[",["T_CONSTANT_ENCAPSED_STRING","'error_code'",255],"]",["T_WHITESPACE"," ",255],["T_BOOLEAN_AND","&&",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$validate_response",255],"[",["T_CONSTANT_ENCAPSED_STRING","'error_code'",255],"]",["T_WHITESPACE"," ",255],["T_IS_NOT_EQUAL","!=",255],["T_WHITESPACE"," ",255],["T_CONSTANT_ENCAPSED_STRING","'InvalidOrderReferenceId'",255],")","{",["T_WHITESPACE","\n\t\t\t",255],["T_RETURN","return",256],["T_WHITESPACE"," ",256],["T_VARIABLE","$validate_response",256],";",["T_WHITESPACE","\n\t\t",256],"}",["T_WHITESPACE","\n\t",257],"}",["T_WHITESPACE","\n\n\t",258],["T_PUBLIC","public",260],["T_WHITESPACE"," ",260],["T_FUNCTION","function",260],["T_WHITESPACE"," ",260],["T_STRING","offAmazon",260],"(",["T_VARIABLE","$Action",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$parameter_data",260],",",["T_WHITESPACE"," ",260],["T_VARIABLE","$post_data",260],["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_ARRAY","array",260],"(",")",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n\t\t",260],["T_IF","if",261],"(","!",["T_EMPTY","empty",261],"(",["T_VARIABLE","$post_data",261],")",")","{",["T_WHITESPACE","\n\t\t\t",261],["T_VARIABLE","$merchant_id",262],["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$post_data",262],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_merchant_id'",262],"]",";",["T_WHITESPACE","\n\t\t\t",262],["T_VARIABLE","$access_key",263],["T_WHITESPACE"," ",263],"=",["T_WHITESPACE"," ",263],["T_VARIABLE","$post_data",263],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_access_key'",263],"]",";",["T_WHITESPACE","\n\t\t\t",263],["T_VARIABLE","$access_secret",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$post_data",264],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_access_secret'",264],"]",";",["T_WHITESPACE","\n\t\t\t",264],["T_VARIABLE","$test",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_VARIABLE","$post_data",265],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_test'",265],"]",";",["T_WHITESPACE","\n\t\t\t",265],["T_VARIABLE","$payment_region",266],["T_WHITESPACE"," ",266],"=",["T_WHITESPACE"," ",266],["T_VARIABLE","$post_data",266],"[",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_payment_region'",266],"]",";",["T_WHITESPACE","\n\t\t",266],"}",["T_WHITESPACE"," ",267],["T_ELSE","else",267],["T_WHITESPACE"," ",267],"{",["T_WHITESPACE","\n\t\t\t",267],["T_VARIABLE","$merchant_id",268],["T_WHITESPACE"," ",268],"=",["T_WHITESPACE"," ",268],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","config",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","get",268],"(",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_merchant_id'",268],")",";",["T_WHITESPACE","\n\t\t\t",268],["T_VARIABLE","$access_key",269],["T_WHITESPACE"," ",269],"=",["T_WHITESPACE"," ",269],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","config",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","get",269],"(",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_access_key'",269],")",";",["T_WHITESPACE","\n\t\t\t",269],["T_VARIABLE","$access_secret",270],["T_WHITESPACE"," ",270],"=",["T_WHITESPACE"," ",270],["T_VARIABLE","$this",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","config",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","get",270],"(",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_access_secret'",270],")",";",["T_WHITESPACE","\n\t\t\t",270],["T_VARIABLE","$test",271],["T_WHITESPACE"," ",271],"=",["T_WHITESPACE"," ",271],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","config",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","get",271],"(",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_test'",271],")",";",["T_WHITESPACE","\n\t\t\t",271],["T_VARIABLE","$payment_region",272],["T_WHITESPACE"," ",272],"=",["T_WHITESPACE"," ",272],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","config",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","get",272],"(",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_payment_region'",272],")",";",["T_WHITESPACE","\n\n\t\t",272],"}",["T_WHITESPACE","\n\n\t\t",274],["T_IF","if",276],["T_WHITESPACE"," ",276],"(",["T_VARIABLE","$test",276],["T_WHITESPACE"," ",276],["T_IS_EQUAL","==",276],["T_WHITESPACE"," ",276],["T_CONSTANT_ENCAPSED_STRING","'sandbox'",276],")",["T_WHITESPACE"," ",276],"{",["T_WHITESPACE","\n\t\t\t",276],["T_IF","if",277],["T_WHITESPACE"," ",277],"(",["T_VARIABLE","$payment_region",277],["T_WHITESPACE"," ",277],["T_IS_EQUAL","==",277],["T_WHITESPACE"," ",277],["T_CONSTANT_ENCAPSED_STRING","'USD'",277],")",["T_WHITESPACE"," ",277],"{",["T_WHITESPACE","\n\t\t\t\t",277],["T_VARIABLE","$url",278],["T_WHITESPACE"," ",278],"=",["T_WHITESPACE"," ",278],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/mws.amazonservices.com\/OffAmazonPayments_Sandbox\/2013-01-01\/'",278],";",["T_WHITESPACE","\n\t\t\t",278],"}",["T_WHITESPACE"," ",279],["T_ELSE","else",279],["T_WHITESPACE"," ",279],"{",["T_WHITESPACE","\n\t\t\t\t",279],["T_VARIABLE","$url",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/mws-eu.amazonservices.com\/OffAmazonPayments_Sandbox\/2013-01-01\/'",280],";",["T_WHITESPACE","\n\t\t\t",280],"}",["T_WHITESPACE","\n\t\t",281],"}",["T_WHITESPACE"," ",282],["T_ELSE","else",282],["T_WHITESPACE"," ",282],"{",["T_WHITESPACE","\n\t\t\t",282],["T_IF","if",283],["T_WHITESPACE"," ",283],"(",["T_VARIABLE","$payment_region",283],["T_WHITESPACE"," ",283],["T_IS_EQUAL","==",283],["T_WHITESPACE"," ",283],["T_CONSTANT_ENCAPSED_STRING","'USD'",283],")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n\t\t\t\t",283],["T_VARIABLE","$url",284],["T_WHITESPACE"," ",284],"=",["T_WHITESPACE"," ",284],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/mws.amazonservices.com\/OffAmazonPayments\/2013-01-01\/'",284],";",["T_WHITESPACE","\n\t\t\t",284],"}",["T_WHITESPACE"," ",285],["T_ELSE","else",285],["T_WHITESPACE"," ",285],"{",["T_WHITESPACE","\n\t\t\t\t",285],["T_VARIABLE","$url",286],["T_WHITESPACE"," ",286],"=",["T_WHITESPACE"," ",286],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/mws-eu.amazonservices.com\/OffAmazonPayments\/2013-01-01\/'",286],";",["T_WHITESPACE","\n\t\t\t",286],"}",["T_WHITESPACE","\n\t\t",287],"}",["T_WHITESPACE","\n\n\t\t",288],["T_VARIABLE","$parameters",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_ARRAY","array",290],"(",")",";",["T_WHITESPACE","\n\t\t",290],["T_VARIABLE","$parameters",291],"[",["T_CONSTANT_ENCAPSED_STRING","'AWSAccessKeyId'",291],"]",["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_VARIABLE","$access_key",291],";",["T_WHITESPACE","\n\t\t",291],["T_VARIABLE","$parameters",292],"[",["T_CONSTANT_ENCAPSED_STRING","'Action'",292],"]",["T_WHITESPACE"," ",292],"=",["T_WHITESPACE"," ",292],["T_VARIABLE","$Action",292],";",["T_WHITESPACE","\n\t\t",292],["T_VARIABLE","$parameters",293],"[",["T_CONSTANT_ENCAPSED_STRING","'SellerId'",293],"]",["T_WHITESPACE"," ",293],"=",["T_WHITESPACE"," ",293],["T_VARIABLE","$merchant_id",293],";",["T_WHITESPACE","\n\t\t",293],["T_VARIABLE","$parameters",294],"[",["T_CONSTANT_ENCAPSED_STRING","'SignatureMethod'",294],"]",["T_WHITESPACE"," ",294],"=",["T_WHITESPACE"," ",294],["T_CONSTANT_ENCAPSED_STRING","'HmacSHA256'",294],";",["T_WHITESPACE","\n\t\t",294],["T_VARIABLE","$parameters",295],"[",["T_CONSTANT_ENCAPSED_STRING","'SignatureVersion'",295],"]",["T_WHITESPACE"," ",295],"=",["T_WHITESPACE"," ",295],["T_LNUMBER","2",295],";",["T_WHITESPACE","\n\t\t",295],["T_VARIABLE","$parameters",296],"[",["T_CONSTANT_ENCAPSED_STRING","'Timestamp'",296],"]",["T_WHITESPACE"," ",296],"=",["T_WHITESPACE"," ",296],["T_STRING","date",296],"(",["T_CONSTANT_ENCAPSED_STRING","'c'",296],",",["T_WHITESPACE"," ",296],["T_STRING","time",296],"(",")",")",";",["T_WHITESPACE","\n\t\t",296],["T_VARIABLE","$parameters",297],"[",["T_CONSTANT_ENCAPSED_STRING","'Version'",297],"]",["T_WHITESPACE"," ",297],"=",["T_WHITESPACE"," ",297],["T_CONSTANT_ENCAPSED_STRING","'2013-01-01'",297],";",["T_WHITESPACE","\n\t\t",297],["T_FOREACH","foreach",298],["T_WHITESPACE"," ",298],"(",["T_VARIABLE","$parameter_data",298],["T_WHITESPACE"," ",298],["T_AS","as",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$k",298],["T_WHITESPACE"," ",298],["T_DOUBLE_ARROW","=>",298],["T_WHITESPACE"," ",298],["T_VARIABLE","$v",298],")",["T_WHITESPACE"," ",298],"{",["T_WHITESPACE","\n\t\t\t",298],["T_VARIABLE","$parameters",299],"[",["T_VARIABLE","$k",299],"]",["T_WHITESPACE"," ",299],"=",["T_WHITESPACE"," ",299],["T_VARIABLE","$v",299],";",["T_WHITESPACE","\n\t\t",299],"}",["T_WHITESPACE","\n\n\t\t",300],["T_VARIABLE","$query",302],["T_WHITESPACE"," ",302],"=",["T_WHITESPACE"," ",302],["T_VARIABLE","$this",302],["T_OBJECT_OPERATOR","->",302],["T_STRING","calculateStringToSignV2",302],"(",["T_VARIABLE","$parameters",302],",",["T_WHITESPACE"," ",302],["T_VARIABLE","$url",302],")",";",["T_WHITESPACE","\n\n\t\t",302],["T_VARIABLE","$parameters",304],"[",["T_CONSTANT_ENCAPSED_STRING","'Signature'",304],"]",["T_WHITESPACE"," ",304],"=",["T_WHITESPACE"," ",304],["T_STRING","base64_encode",304],"(",["T_STRING","hash_hmac",304],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",304],",",["T_WHITESPACE"," ",304],["T_VARIABLE","$query",304],",",["T_WHITESPACE"," ",304],["T_VARIABLE","$access_secret",304],",",["T_WHITESPACE"," ",304],["T_STRING","true",304],")",")",";",["T_WHITESPACE","\n\n\t\t",304],["T_RETURN","return",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","sendCurl",306],"(",["T_VARIABLE","$url",306],",",["T_WHITESPACE"," ",306],["T_VARIABLE","$parameters",306],")",";",["T_WHITESPACE","\n\t",306],"}",["T_WHITESPACE","\n\n\t",307],["T_PRIVATE","private",309],["T_WHITESPACE"," ",309],["T_FUNCTION","function",309],["T_WHITESPACE"," ",309],["T_STRING","validateResponse",309],"(",["T_VARIABLE","$action",309],",",["T_WHITESPACE"," ",309],["T_VARIABLE","$details",309],")",["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n\t\t",309],["T_VARIABLE","$details_xml",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_STRING","simplexml_load_string",310],"(",["T_VARIABLE","$details",310],"[",["T_CONSTANT_ENCAPSED_STRING","'ResponseBody'",310],"]",")",";",["T_WHITESPACE","\n\t\t",310],["T_VARIABLE","$this",311],["T_OBJECT_OPERATOR","->",311],["T_STRING","logger",311],"(",["T_VARIABLE","$details_xml",311],")",";",["T_WHITESPACE","\n\t\t",311],["T_SWITCH","switch",312],["T_WHITESPACE"," ",312],"(",["T_VARIABLE","$action",312],")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n\t\t\t",312],["T_CASE","case",313],["T_WHITESPACE"," ",313],["T_CONSTANT_ENCAPSED_STRING","'Authorize'",313],":",["T_WHITESPACE","\n\t\t\t\t",313],["T_VARIABLE","$result",314],["T_WHITESPACE"," ",314],"=",["T_WHITESPACE"," ",314],["T_CONSTANT_ENCAPSED_STRING","'AuthorizeResult'",314],";",["T_WHITESPACE","\n\t\t\t\t",314],["T_VARIABLE","$details",315],["T_WHITESPACE"," ",315],"=",["T_WHITESPACE"," ",315],["T_CONSTANT_ENCAPSED_STRING","'AuthorizationDetails'",315],";",["T_WHITESPACE","\n\t\t\t\t",315],["T_VARIABLE","$status",316],["T_WHITESPACE"," ",316],"=",["T_WHITESPACE"," ",316],["T_CONSTANT_ENCAPSED_STRING","'AuthorizationStatus'",316],";",["T_WHITESPACE","\n\t\t\t\t",316],["T_VARIABLE","$amazon_id",317],["T_WHITESPACE"," ",317],"=",["T_WHITESPACE"," ",317],["T_CONSTANT_ENCAPSED_STRING","'AmazonAuthorizationId'",317],";",["T_WHITESPACE","\n\t\t\t\t",317],["T_BREAK","break",318],";",["T_WHITESPACE","\n\t\t\t",318],["T_CASE","case",319],["T_WHITESPACE"," ",319],["T_CONSTANT_ENCAPSED_STRING","'Capture'",319],":",["T_WHITESPACE","\n\t\t\t\t",319],["T_VARIABLE","$result",320],["T_WHITESPACE"," ",320],"=",["T_WHITESPACE"," ",320],["T_CONSTANT_ENCAPSED_STRING","'CaptureResult'",320],";",["T_WHITESPACE","\n\t\t\t\t",320],["T_VARIABLE","$details",321],["T_WHITESPACE"," ",321],"=",["T_WHITESPACE"," ",321],["T_CONSTANT_ENCAPSED_STRING","'CaptureDetails'",321],";",["T_WHITESPACE","\n\t\t\t\t",321],["T_VARIABLE","$status",322],["T_WHITESPACE"," ",322],"=",["T_WHITESPACE"," ",322],["T_CONSTANT_ENCAPSED_STRING","'CaptureStatus'",322],";",["T_WHITESPACE","\n\t\t\t\t",322],["T_VARIABLE","$amazon_id",323],["T_WHITESPACE"," ",323],"=",["T_WHITESPACE"," ",323],["T_CONSTANT_ENCAPSED_STRING","'AmazonCaptureId'",323],";",["T_WHITESPACE","\n\t\t\t\t",323],["T_BREAK","break",324],";",["T_WHITESPACE","\n\t\t\t",324],["T_CASE","case",325],["T_WHITESPACE"," ",325],["T_CONSTANT_ENCAPSED_STRING","'Refund'",325],":",["T_WHITESPACE","\n\t\t\t\t",325],["T_VARIABLE","$result",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_CONSTANT_ENCAPSED_STRING","'RefundResult'",326],";",["T_WHITESPACE","\n\t\t\t\t",326],["T_VARIABLE","$details",327],["T_WHITESPACE"," ",327],"=",["T_WHITESPACE"," ",327],["T_CONSTANT_ENCAPSED_STRING","'RefundDetails'",327],";",["T_WHITESPACE","\n\t\t\t\t",327],["T_VARIABLE","$status",328],["T_WHITESPACE"," ",328],"=",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'RefundStatus'",328],";",["T_WHITESPACE","\n\t\t\t\t",328],["T_VARIABLE","$amazon_id",329],["T_WHITESPACE"," ",329],"=",["T_WHITESPACE"," ",329],["T_CONSTANT_ENCAPSED_STRING","'AmazonRefundId'",329],";",["T_WHITESPACE","\n\t\t",329],"}",["T_WHITESPACE","\n\n\t\t",330],["T_VARIABLE","$details_xml",332],["T_OBJECT_OPERATOR","->",332],["T_STRING","registerXPathNamespace",332],"(",["T_CONSTANT_ENCAPSED_STRING","'m'",332],",",["T_WHITESPACE"," ",332],["T_CONSTANT_ENCAPSED_STRING","'http:\/\/mws.amazonservices.com\/schema\/OffAmazonPayments\/2013-01-01'",332],")",";",["T_WHITESPACE","\n\t\t",332],["T_VARIABLE","$error_set",333],["T_WHITESPACE"," ",333],"=",["T_WHITESPACE"," ",333],["T_VARIABLE","$details_xml",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","xpath",333],"(",["T_CONSTANT_ENCAPSED_STRING","'\/\/m:ReasonCode'",333],")",";",["T_WHITESPACE","\n\n\t\t",333],["T_IF","if",335],["T_WHITESPACE"," ",335],"(",["T_ISSET","isset",335],"(",["T_VARIABLE","$details_xml",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","Error",335],")",")",["T_WHITESPACE"," ",335],"{",["T_WHITESPACE","\n\t\t\t",335],["T_VARIABLE","$response",336],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",336],"]",["T_WHITESPACE"," ",336],"=",["T_WHITESPACE"," ",336],["T_CONSTANT_ENCAPSED_STRING","'Error'",336],";",["T_WHITESPACE","\n\t\t\t",336],["T_VARIABLE","$response",337],"[",["T_CONSTANT_ENCAPSED_STRING","'error_code'",337],"]",["T_WHITESPACE"," ",337],"=",["T_WHITESPACE"," ",337],["T_STRING_CAST","(string)",337],["T_VARIABLE","$details_xml",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","Error",337],["T_OBJECT_OPERATOR","->",337],["T_STRING","Code",337],";",["T_WHITESPACE","\n\t\t\t",337],["T_VARIABLE","$response",338],"[",["T_CONSTANT_ENCAPSED_STRING","'status_detail'",338],"]",["T_WHITESPACE"," ",338],"=",["T_WHITESPACE"," ",338],["T_STRING_CAST","(string)",338],["T_VARIABLE","$details_xml",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","Error",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","Code",338],["T_WHITESPACE"," ",338],".",["T_WHITESPACE"," ",338],["T_CONSTANT_ENCAPSED_STRING","': '",338],["T_WHITESPACE"," ",338],".",["T_WHITESPACE"," ",338],["T_STRING_CAST","(string)",338],["T_VARIABLE","$details_xml",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","Error",338],["T_OBJECT_OPERATOR","->",338],["T_STRING","Message",338],";",["T_WHITESPACE","\n\t\t",338],"}",["T_WHITESPACE"," ",339],["T_ELSEIF","elseif",339],["T_WHITESPACE"," ",339],"(","!",["T_EMPTY","empty",339],"(",["T_VARIABLE","$error_set",339],")",")",["T_WHITESPACE"," ",339],"{",["T_WHITESPACE","\n\t\t\t",339],["T_VARIABLE","$response",340],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",340],"]",["T_WHITESPACE"," ",340],"=",["T_WHITESPACE"," ",340],["T_STRING_CAST","(string)",340],["T_VARIABLE","$details_xml",340],["T_OBJECT_OPERATOR","->",340],["T_VARIABLE","$result",340],["T_OBJECT_OPERATOR","->",340],["T_VARIABLE","$details",340],["T_OBJECT_OPERATOR","->",340],["T_VARIABLE","$status",340],["T_OBJECT_OPERATOR","->",340],["T_STRING","State",340],";",["T_WHITESPACE","\n\t\t\t",340],["T_VARIABLE","$response",341],"[",["T_CONSTANT_ENCAPSED_STRING","'status_detail'",341],"]",["T_WHITESPACE"," ",341],"=",["T_WHITESPACE"," ",341],["T_STRING_CAST","(string)",341],["T_VARIABLE","$details_xml",341],["T_OBJECT_OPERATOR","->",341],["T_VARIABLE","$result",341],["T_OBJECT_OPERATOR","->",341],["T_VARIABLE","$details",341],["T_OBJECT_OPERATOR","->",341],["T_VARIABLE","$status",341],["T_OBJECT_OPERATOR","->",341],["T_STRING","ReasonCode",341],";",["T_WHITESPACE","\n\t\t",341],"}",["T_WHITESPACE"," ",342],["T_ELSE","else",342],["T_WHITESPACE"," ",342],"{",["T_WHITESPACE","\n\t\t\t",342],["T_VARIABLE","$response",343],"[",["T_CONSTANT_ENCAPSED_STRING","'status'",343],"]",["T_WHITESPACE"," ",343],"=",["T_WHITESPACE"," ",343],["T_STRING_CAST","(string)",343],["T_VARIABLE","$details_xml",343],["T_OBJECT_OPERATOR","->",343],["T_VARIABLE","$result",343],["T_OBJECT_OPERATOR","->",343],["T_VARIABLE","$details",343],["T_OBJECT_OPERATOR","->",343],["T_VARIABLE","$status",343],["T_OBJECT_OPERATOR","->",343],["T_STRING","State",343],";",["T_WHITESPACE","\n\t\t\t",343],["T_VARIABLE","$response",344],"[",["T_VARIABLE","$amazon_id",344],"]",["T_WHITESPACE"," ",344],"=",["T_WHITESPACE"," ",344],["T_STRING_CAST","(string)",344],["T_VARIABLE","$details_xml",344],["T_OBJECT_OPERATOR","->",344],["T_VARIABLE","$result",344],["T_OBJECT_OPERATOR","->",344],["T_VARIABLE","$details",344],["T_OBJECT_OPERATOR","->",344],["T_VARIABLE","$amazon_id",344],";",["T_WHITESPACE","\n\t\t",344],"}",["T_WHITESPACE","\n\n\t\t",345],["T_RETURN","return",347],["T_WHITESPACE"," ",347],["T_VARIABLE","$response",347],";",["T_WHITESPACE","\n\t",347],"}",["T_WHITESPACE","\n\n\t",348],["T_PUBLIC","public",350],["T_WHITESPACE"," ",350],["T_FUNCTION","function",350],["T_WHITESPACE"," ",350],["T_STRING","sendCurl",350],"(",["T_VARIABLE","$url",350],",",["T_WHITESPACE"," ",350],["T_VARIABLE","$parameters",350],")",["T_WHITESPACE"," ",350],"{",["T_WHITESPACE","\n\t\t",350],["T_VARIABLE","$query",351],["T_WHITESPACE"," ",351],"=",["T_WHITESPACE"," ",351],["T_VARIABLE","$this",351],["T_OBJECT_OPERATOR","->",351],["T_STRING","getParametersAsString",351],"(",["T_VARIABLE","$parameters",351],")",";",["T_WHITESPACE","\n\n\t\t",351],["T_VARIABLE","$curl",353],["T_WHITESPACE"," ",353],"=",["T_WHITESPACE"," ",353],["T_STRING","curl_init",353],"(",["T_VARIABLE","$url",353],")",";",["T_WHITESPACE","\n\n\t\t",353],["T_STRING","curl_setopt",355],"(",["T_VARIABLE","$curl",355],",",["T_WHITESPACE"," ",355],["T_STRING","CURLOPT_URL",355],",",["T_WHITESPACE"," ",355],["T_VARIABLE","$url",355],")",";",["T_WHITESPACE","\n\t\t",355],["T_STRING","curl_setopt",356],"(",["T_VARIABLE","$curl",356],",",["T_WHITESPACE"," ",356],["T_STRING","CURLOPT_PORT",356],",",["T_WHITESPACE"," ",356],["T_LNUMBER","443",356],")",";",["T_WHITESPACE","\n\t\t",356],["T_STRING","curl_setopt",357],"(",["T_VARIABLE","$curl",357],",",["T_WHITESPACE"," ",357],["T_STRING","CURLOPT_SSL_VERIFYPEER",357],",",["T_WHITESPACE"," ",357],["T_STRING","true",357],")",";",["T_WHITESPACE","\n\t\t",357],["T_STRING","curl_setopt",358],"(",["T_VARIABLE","$curl",358],",",["T_WHITESPACE"," ",358],["T_STRING","CURLOPT_SSL_VERIFYHOST",358],",",["T_WHITESPACE"," ",358],["T_LNUMBER","2",358],")",";",["T_WHITESPACE","\n\t\t",358],["T_STRING","curl_setopt",359],"(",["T_VARIABLE","$curl",359],",",["T_WHITESPACE"," ",359],["T_STRING","CURLOPT_USERAGENT",359],",",["T_WHITESPACE"," ",359],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","request",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","server",359],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_USER_AGENT'",359],"]",")",";",["T_WHITESPACE","\n\t\t",359],["T_STRING","curl_setopt",360],"(",["T_VARIABLE","$curl",360],",",["T_WHITESPACE"," ",360],["T_STRING","CURLOPT_POST",360],",",["T_WHITESPACE"," ",360],["T_STRING","true",360],")",";",["T_WHITESPACE","\n\t\t",360],["T_STRING","curl_setopt",361],"(",["T_VARIABLE","$curl",361],",",["T_WHITESPACE"," ",361],["T_STRING","CURLOPT_POSTFIELDS",361],",",["T_WHITESPACE"," ",361],["T_VARIABLE","$query",361],")",";",["T_WHITESPACE","\n\t\t",361],["T_STRING","curl_setopt",362],"(",["T_VARIABLE","$curl",362],",",["T_WHITESPACE"," ",362],["T_STRING","CURLOPT_HEADER",362],",",["T_WHITESPACE"," ",362],["T_STRING","true",362],")",";",["T_WHITESPACE","\n\t\t",362],["T_STRING","curl_setopt",363],"(",["T_VARIABLE","$curl",363],",",["T_WHITESPACE"," ",363],["T_STRING","CURLOPT_RETURNTRANSFER",363],",",["T_WHITESPACE"," ",363],["T_STRING","true",363],")",";",["T_WHITESPACE","\n\n\t\t",363],["T_VARIABLE","$response",365],["T_WHITESPACE"," ",365],"=",["T_WHITESPACE"," ",365],["T_STRING","curl_exec",365],"(",["T_VARIABLE","$curl",365],")",";",["T_WHITESPACE","\n\t\t",365],["T_STRING","curl_close",366],"(",["T_VARIABLE","$curl",366],")",";",["T_WHITESPACE","\n\n\t\t",366],["T_LIST","list",368],"(",["T_VARIABLE","$other",368],",",["T_WHITESPACE"," ",368],["T_VARIABLE","$responseBody",368],")",["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_STRING","explode",368],"(",["T_CONSTANT_ENCAPSED_STRING","\"\\r\\n\\r\\n\"",368],",",["T_WHITESPACE"," ",368],["T_VARIABLE","$response",368],",",["T_WHITESPACE"," ",368],["T_LNUMBER","2",368],")",";",["T_WHITESPACE","\n\t\t",368],["T_VARIABLE","$other",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_STRING","preg_split",369],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/\\r\\n|\\n|\\r\/\"",369],",",["T_WHITESPACE"," ",369],["T_VARIABLE","$other",369],")",";",["T_WHITESPACE","\n\n\t\t",369],["T_LIST","list",371],"(",["T_VARIABLE","$protocol",371],",",["T_WHITESPACE"," ",371],["T_VARIABLE","$code",371],",",["T_WHITESPACE"," ",371],["T_VARIABLE","$text",371],")",["T_WHITESPACE"," ",371],"=",["T_WHITESPACE"," ",371],["T_STRING","explode",371],"(",["T_CONSTANT_ENCAPSED_STRING","' '",371],",",["T_WHITESPACE"," ",371],["T_STRING","trim",371],"(",["T_STRING","array_shift",371],"(",["T_VARIABLE","$other",371],")",")",",",["T_WHITESPACE"," ",371],["T_LNUMBER","3",371],")",";",["T_WHITESPACE","\n\t\t",371],["T_RETURN","return",372],["T_WHITESPACE"," ",372],["T_ARRAY","array",372],"(",["T_CONSTANT_ENCAPSED_STRING","'status'",372],["T_WHITESPACE"," ",372],["T_DOUBLE_ARROW","=>",372],["T_WHITESPACE"," ",372],["T_INT_CAST","(int)",372],["T_VARIABLE","$code",372],",",["T_WHITESPACE"," ",372],["T_CONSTANT_ENCAPSED_STRING","'ResponseBody'",372],["T_WHITESPACE"," ",372],["T_DOUBLE_ARROW","=>",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$responseBody",372],")",";",["T_WHITESPACE","\n\t",372],"}",["T_WHITESPACE","\n\n\t",373],["T_PRIVATE","private",375],["T_WHITESPACE"," ",375],["T_FUNCTION","function",375],["T_WHITESPACE"," ",375],["T_STRING","getParametersAsString",375],"(",["T_ARRAY","array",375],["T_WHITESPACE"," ",375],["T_VARIABLE","$parameters",375],")",["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n\t\t",375],["T_VARIABLE","$queryParameters",376],["T_WHITESPACE"," ",376],"=",["T_WHITESPACE"," ",376],["T_ARRAY","array",376],"(",")",";",["T_WHITESPACE","\n\t\t",376],["T_FOREACH","foreach",377],["T_WHITESPACE"," ",377],"(",["T_VARIABLE","$parameters",377],["T_WHITESPACE"," ",377],["T_AS","as",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$key",377],["T_WHITESPACE"," ",377],["T_DOUBLE_ARROW","=>",377],["T_WHITESPACE"," ",377],["T_VARIABLE","$value",377],")",["T_WHITESPACE"," ",377],"{",["T_WHITESPACE","\n\t\t\t",377],["T_VARIABLE","$queryParameters",378],"[","]",["T_WHITESPACE"," ",378],"=",["T_WHITESPACE"," ",378],["T_VARIABLE","$key",378],["T_WHITESPACE"," ",378],".",["T_WHITESPACE"," ",378],["T_CONSTANT_ENCAPSED_STRING","'='",378],["T_WHITESPACE"," ",378],".",["T_WHITESPACE"," ",378],["T_VARIABLE","$this",378],["T_OBJECT_OPERATOR","->",378],["T_STRING","urlencode",378],"(",["T_VARIABLE","$value",378],")",";",["T_WHITESPACE","\n\t\t",378],"}",["T_WHITESPACE","\n\t\t",379],["T_RETURN","return",380],["T_WHITESPACE"," ",380],["T_STRING","implode",380],"(",["T_CONSTANT_ENCAPSED_STRING","'&'",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$queryParameters",380],")",";",["T_WHITESPACE","\n\t",380],"}",["T_WHITESPACE","\n\n\t",381],["T_PRIVATE","private",383],["T_WHITESPACE"," ",383],["T_FUNCTION","function",383],["T_WHITESPACE"," ",383],["T_STRING","calculateStringToSignV2",383],"(",["T_ARRAY","array",383],["T_WHITESPACE"," ",383],["T_VARIABLE","$parameters",383],",",["T_WHITESPACE"," ",383],["T_VARIABLE","$url",383],")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n\t\t",383],["T_VARIABLE","$data",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_CONSTANT_ENCAPSED_STRING","'POST'",384],";",["T_WHITESPACE","\n\t\t",384],["T_VARIABLE","$data",385],["T_WHITESPACE"," ",385],["T_CONCAT_EQUAL",".=",385],["T_WHITESPACE"," ",385],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",385],";",["T_WHITESPACE","\n\t\t",385],["T_VARIABLE","$endpoint",386],["T_WHITESPACE"," ",386],"=",["T_WHITESPACE"," ",386],["T_STRING","parse_url",386],"(",["T_VARIABLE","$url",386],")",";",["T_WHITESPACE","\n\t\t",386],["T_VARIABLE","$data",387],["T_WHITESPACE"," ",387],["T_CONCAT_EQUAL",".=",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$endpoint",387],"[",["T_CONSTANT_ENCAPSED_STRING","'host'",387],"]",";",["T_WHITESPACE","\n\t\t",387],["T_VARIABLE","$data",388],["T_WHITESPACE"," ",388],["T_CONCAT_EQUAL",".=",388],["T_WHITESPACE"," ",388],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",388],";",["T_WHITESPACE","\n\t\t",388],["T_VARIABLE","$uri",389],["T_WHITESPACE"," ",389],"=",["T_WHITESPACE"," ",389],["T_STRING","array_key_exists",389],"(",["T_CONSTANT_ENCAPSED_STRING","'path'",389],",",["T_WHITESPACE"," ",389],["T_VARIABLE","$endpoint",389],")",["T_WHITESPACE"," ",389],"?",["T_WHITESPACE"," ",389],["T_VARIABLE","$endpoint",389],"[",["T_CONSTANT_ENCAPSED_STRING","'path'",389],"]",["T_WHITESPACE"," ",389],":",["T_WHITESPACE"," ",389],["T_STRING","null",389],";",["T_WHITESPACE","\n\t\t",389],["T_IF","if",390],["T_WHITESPACE"," ",390],"(","!",["T_ISSET","isset",390],"(",["T_VARIABLE","$uri",390],")",")",["T_WHITESPACE"," ",390],"{",["T_WHITESPACE","\n\t\t\t",390],["T_VARIABLE","$uri",391],["T_WHITESPACE"," ",391],"=",["T_WHITESPACE"," ",391],["T_CONSTANT_ENCAPSED_STRING","\"\/\"",391],";",["T_WHITESPACE","\n\t\t",391],"}",["T_WHITESPACE","\n\t\t",392],["T_VARIABLE","$uriencoded",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_STRING","implode",393],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/\"",393],",",["T_WHITESPACE"," ",393],["T_STRING","array_map",393],"(",["T_ARRAY","array",393],"(",["T_VARIABLE","$this",393],",",["T_WHITESPACE"," ",393],["T_CONSTANT_ENCAPSED_STRING","\"urlencode\"",393],")",",",["T_WHITESPACE"," ",393],["T_STRING","explode",393],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/\"",393],",",["T_WHITESPACE"," ",393],["T_VARIABLE","$uri",393],")",")",")",";",["T_WHITESPACE","\n\t\t",393],["T_VARIABLE","$data",394],["T_WHITESPACE"," ",394],["T_CONCAT_EQUAL",".=",394],["T_WHITESPACE"," ",394],["T_VARIABLE","$uriencoded",394],";",["T_WHITESPACE","\n\t\t",394],["T_VARIABLE","$data",395],["T_WHITESPACE"," ",395],["T_CONCAT_EQUAL",".=",395],["T_WHITESPACE"," ",395],["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",395],";",["T_WHITESPACE","\n\t\t",395],["T_STRING","uksort",396],"(",["T_VARIABLE","$parameters",396],",",["T_WHITESPACE"," ",396],["T_CONSTANT_ENCAPSED_STRING","'strcmp'",396],")",";",["T_WHITESPACE","\n\t\t",396],["T_VARIABLE","$data",397],["T_WHITESPACE"," ",397],["T_CONCAT_EQUAL",".=",397],["T_WHITESPACE"," ",397],["T_VARIABLE","$this",397],["T_OBJECT_OPERATOR","->",397],["T_STRING","getParametersAsString",397],"(",["T_VARIABLE","$parameters",397],")",";",["T_WHITESPACE","\n\t\t",397],["T_RETURN","return",398],["T_WHITESPACE"," ",398],["T_VARIABLE","$data",398],";",["T_WHITESPACE","\n\t",398],"}",["T_WHITESPACE","\n\n\t",399],["T_PRIVATE","private",401],["T_WHITESPACE"," ",401],["T_FUNCTION","function",401],["T_WHITESPACE"," ",401],["T_STRING","urlencode",401],"(",["T_VARIABLE","$value",401],")",["T_WHITESPACE"," ",401],"{",["T_WHITESPACE","\n\t\t",401],["T_RETURN","return",402],["T_WHITESPACE"," ",402],["T_STRING","str_replace",402],"(",["T_CONSTANT_ENCAPSED_STRING","'%7E'",402],",",["T_WHITESPACE"," ",402],["T_CONSTANT_ENCAPSED_STRING","'~'",402],",",["T_WHITESPACE"," ",402],["T_STRING","rawurlencode",402],"(",["T_VARIABLE","$value",402],")",")",";",["T_WHITESPACE","\n\t",402],"}",["T_WHITESPACE","\n\n\t",403],["T_PUBLIC","public",405],["T_WHITESPACE"," ",405],["T_FUNCTION","function",405],["T_WHITESPACE"," ",405],["T_STRING","logger",405],"(",["T_VARIABLE","$message",405],")",["T_WHITESPACE"," ",405],"{",["T_WHITESPACE","\n\t\t",405],["T_IF","if",406],["T_WHITESPACE"," ",406],"(",["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","config",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","get",406],"(",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay_debug'",406],")",["T_WHITESPACE"," ",406],["T_IS_EQUAL","==",406],["T_WHITESPACE"," ",406],["T_LNUMBER","1",406],")",["T_WHITESPACE"," ",406],"{",["T_WHITESPACE","\n\t\t\t",406],["T_VARIABLE","$log",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_NEW","new",407],["T_WHITESPACE"," ",407],["T_STRING","Log",407],"(",["T_CONSTANT_ENCAPSED_STRING","'amazon_login_pay.log'",407],")",";",["T_WHITESPACE","\n\t\t\t",407],["T_VARIABLE","$backtrace",408],["T_WHITESPACE"," ",408],"=",["T_WHITESPACE"," ",408],["T_STRING","debug_backtrace",408],"(",")",";",["T_WHITESPACE","\n\t\t\t",408],["T_VARIABLE","$log",409],["T_OBJECT_OPERATOR","->",409],["T_STRING","write",409],"(",["T_CONSTANT_ENCAPSED_STRING","'Origin: '",409],["T_WHITESPACE"," ",409],".",["T_WHITESPACE"," ",409],["T_VARIABLE","$backtrace",409],"[",["T_LNUMBER","6",409],"]","[",["T_CONSTANT_ENCAPSED_STRING","'class'",409],"]",["T_WHITESPACE"," ",409],".",["T_WHITESPACE"," ",409],["T_CONSTANT_ENCAPSED_STRING","'::'",409],["T_WHITESPACE"," ",409],".",["T_WHITESPACE"," ",409],["T_VARIABLE","$backtrace",409],"[",["T_LNUMBER","6",409],"]","[",["T_CONSTANT_ENCAPSED_STRING","'function'",409],"]",")",";",["T_WHITESPACE","\n\t\t\t",409],["T_VARIABLE","$log",410],["T_OBJECT_OPERATOR","->",410],["T_STRING","write",410],"(",["T_STRING","print_r",410],"(",["T_VARIABLE","$message",410],",",["T_WHITESPACE"," ",410],["T_LNUMBER","1",410],")",")",";",["T_WHITESPACE","\n\t\t",410],"}",["T_WHITESPACE","\n\t",411],"}",["T_WHITESPACE","\n",412],"}"]