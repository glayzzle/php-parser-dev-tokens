[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ModelExtensionPaymentBluepayredirect",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Model",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\t",2],["T_PUBLIC","public",3],["T_WHITESPACE"," ",3],["T_FUNCTION","function",3],["T_WHITESPACE"," ",3],["T_STRING","install",3],"(",")",["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\t\t",3],["T_VARIABLE","$this",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","db",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","query",4],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",4],["T_WHITESPACE"," ",5],".",["T_WHITESPACE"," ",5],["T_STRING","DB_PREFIX",5],["T_WHITESPACE"," ",5],".",["T_WHITESPACE"," ",5],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order` (\n\t\t\t  `bluepay_redirect_order_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `order_id` INT(11) NOT NULL,\n\t\t\t  `transaction_id` VARCHAR(50),\n\t\t\t  `date_added` DATETIME NOT NULL,\n\t\t\t  `date_modified` DATETIME NOT NULL,\n\t\t\t  `release_status` INT(1) DEFAULT 0,\n\t\t\t  `void_status` INT(1) DEFAULT 0,\n\t\t\t  `rebate_status` INT(1) DEFAULT 0,\n\t\t\t  `currency_code` CHAR(3) NOT NULL,\n\t\t\t  `total` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t  PRIMARY KEY (`bluepay_redirect_order_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",5],")",";",["T_WHITESPACE","\n\n\t\t",17],["T_VARIABLE","$this",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","db",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","query",19],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",19],["T_WHITESPACE"," ",20],".",["T_WHITESPACE"," ",20],["T_STRING","DB_PREFIX",20],["T_WHITESPACE"," ",20],".",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order_transaction` (\n\t\t\t  `bluepay_redirect_order_transaction_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `bluepay_redirect_order_id` INT(11) NOT NULL,\n\t\t\t  `date_added` DATETIME NOT NULL,\n\t\t\t  `type` ENUM('auth', 'payment', 'rebate', 'void') DEFAULT NULL,\n\t\t\t  `amount` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t  PRIMARY KEY (`bluepay_redirect_order_transaction_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",20],")",";",["T_WHITESPACE","\n\n\t\t",27],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","db",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","query",29],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",29],["T_WHITESPACE"," ",30],".",["T_WHITESPACE"," ",30],["T_STRING","DB_PREFIX",30],["T_WHITESPACE"," ",30],".",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_card` (\n\t\t\t  `card_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `customer_id` INT(11) NOT NULL,\n\t\t\t  `token` VARCHAR(50) NOT NULL,\n\t\t\t  `digits` VARCHAR(4) NOT NULL,\n\t\t\t  `expiry` VARCHAR(5) NOT NULL,\n\t\t\t  `type` VARCHAR(50) NOT NULL,\n\t\t\t  PRIMARY KEY (`card_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",30],")",";",["T_WHITESPACE","\n\t",38],"}",["T_WHITESPACE","\n\n\t",39],["T_PUBLIC","public",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","uninstall",41],"(",")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n\t\t",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","db",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","query",42],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",42],["T_WHITESPACE"," ",42],".",["T_WHITESPACE"," ",42],["T_STRING","DB_PREFIX",42],["T_WHITESPACE"," ",42],".",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order`;\"",42],")",";",["T_WHITESPACE","\n\t\t",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","db",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","query",43],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_STRING","DB_PREFIX",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order_transaction`;\"",43],")",";",["T_WHITESPACE","\n\t\t",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","db",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","query",44],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",44],["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_STRING","DB_PREFIX",44],["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_card`;\"",44],")",";",["T_WHITESPACE","\n\t",44],"}",["T_WHITESPACE","\n\n\t",45],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","void",47],"(",["T_VARIABLE","$order_id",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n\t\t",47],["T_VARIABLE","$bluepay_redirect_order",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getOrder",48],"(",["T_VARIABLE","$order_id",48],")",";",["T_WHITESPACE","\n\n\t\t",48],["T_IF","if",50],["T_WHITESPACE"," ",50],"(","!",["T_EMPTY","empty",50],"(",["T_VARIABLE","$bluepay_redirect_order",50],")",["T_WHITESPACE"," ",50],["T_BOOLEAN_AND","&&",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$bluepay_redirect_order",50],"[",["T_CONSTANT_ENCAPSED_STRING","'release_status'",50],"]",["T_WHITESPACE"," ",50],["T_IS_EQUAL","==",50],["T_WHITESPACE"," ",50],["T_LNUMBER","1",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n\n\t\t\t",50],["T_VARIABLE","$void_data",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_ARRAY","array",52],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",52],["T_VARIABLE","$void_data",54],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",54],"]",["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","config",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","get",54],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_account_id'",54],")",";",["T_WHITESPACE","\n\t\t\t",54],["T_VARIABLE","$void_data",55],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",55],"]",["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'VOID'",55],";",["T_WHITESPACE","\n\t\t\t",55],["T_VARIABLE","$void_data",56],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",56],"]",["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","strtoupper",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","config",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","get",56],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_test'",56],")",")",";",["T_WHITESPACE","\n\t\t\t",56],["T_VARIABLE","$void_data",57],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",57],"]",["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$bluepay_redirect_order",57],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",57],"]",";",["T_WHITESPACE","\n\n\t\t\t",57],["T_VARIABLE","$void_data",59],"[",["T_CONSTANT_ENCAPSED_STRING","'APPROVED_URL'",59],"]",["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","HTTP_CATALOG",59],["T_WHITESPACE"," ",59],".",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",59],";",["T_WHITESPACE","\n\t\t\t",59],["T_VARIABLE","$void_data",60],"[",["T_CONSTANT_ENCAPSED_STRING","'DECLINED_URL'",60],"]",["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","HTTP_CATALOG",60],["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",60],";",["T_WHITESPACE","\n\t\t\t",60],["T_VARIABLE","$void_data",61],"[",["T_CONSTANT_ENCAPSED_STRING","'MISSING_URL'",61],"]",["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","HTTP_CATALOG",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",61],";",["T_WHITESPACE","\n\n\t\t\t",61],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_ISSET","isset",63],"(",["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","request",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","server",63],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",63],"]",")",")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n\t\t\t\t",63],["T_VARIABLE","$void_data",64],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_IP\"",64],"]",["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","request",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","server",64],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",64],"]",";",["T_WHITESPACE","\n\t\t\t",64],"}",["T_WHITESPACE","\n\n\t\t\t",65],["T_VARIABLE","$tamper_proof_data",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","config",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","get",67],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_secret_key'",67],")",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",67],"]",";",["T_WHITESPACE","\n\n\t\t\t",67],["T_VARIABLE","$void_data",69],"[",["T_CONSTANT_ENCAPSED_STRING","\"TAMPER_PROOF_SEAL\"",69],"]",["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","md5",69],"(",["T_VARIABLE","$tamper_proof_data",69],")",";",["T_WHITESPACE","\n\n\t\t\t",69],["T_VARIABLE","$response_data",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","sendCurl",71],"(",["T_CONSTANT_ENCAPSED_STRING","'https:\/\/secure.bluepay.com\/interfaces\/bp10emu'",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$void_data",71],")",";",["T_WHITESPACE","\n\n\t\t\t",71],["T_RETURN","return",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$response_data",73],";",["T_WHITESPACE","\n\t\t",73],"}",["T_WHITESPACE"," ",74],["T_ELSE","else",74],["T_WHITESPACE"," ",74],"{",["T_WHITESPACE","\n\t\t\t",74],["T_RETURN","return",75],["T_WHITESPACE"," ",75],["T_STRING","false",75],";",["T_WHITESPACE","\n\t\t",75],"}",["T_WHITESPACE","\n\t",76],"}",["T_WHITESPACE","\n\n\t",77],["T_PUBLIC","public",79],["T_WHITESPACE"," ",79],["T_FUNCTION","function",79],["T_WHITESPACE"," ",79],["T_STRING","updateVoidStatus",79],"(",["T_VARIABLE","$bluepay_redirect_order_id",79],",",["T_WHITESPACE"," ",79],["T_VARIABLE","$status",79],")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n\t\t",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","db",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","query",80],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_STRING","DB_PREFIX",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order` SET `void_status` = '\"",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_INT_CAST","(int)",80],["T_VARIABLE","$status",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_redirect_order_id` = '\"",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_INT_CAST","(int)",80],["T_VARIABLE","$bluepay_redirect_order_id",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","\"'\"",80],")",";",["T_WHITESPACE","\n\t",80],"}",["T_WHITESPACE","\n\n\t",81],["T_PUBLIC","public",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","release",83],"(",["T_VARIABLE","$order_id",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$amount",83],")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n\t\t",83],["T_VARIABLE","$bluepay_redirect_order",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getOrder",84],"(",["T_VARIABLE","$order_id",84],")",";",["T_WHITESPACE","\n\t\t",84],["T_VARIABLE","$total_released",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getTotalReleased",85],"(",["T_VARIABLE","$bluepay_redirect_order",85],"[",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_order_id'",85],"]",")",";",["T_WHITESPACE","\n\n\t\t",85],["T_IF","if",87],["T_WHITESPACE"," ",87],"(","!",["T_EMPTY","empty",87],"(",["T_VARIABLE","$bluepay_redirect_order",87],")",["T_WHITESPACE"," ",87],["T_BOOLEAN_AND","&&",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$bluepay_redirect_order",87],"[",["T_CONSTANT_ENCAPSED_STRING","'release_status'",87],"]",["T_WHITESPACE"," ",87],["T_IS_EQUAL","==",87],["T_WHITESPACE"," ",87],["T_LNUMBER","0",87],["T_WHITESPACE"," ",87],["T_BOOLEAN_AND","&&",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$total_released",87],["T_WHITESPACE"," ",87],"+",["T_WHITESPACE"," ",87],["T_VARIABLE","$amount",87],["T_WHITESPACE"," ",87],["T_IS_SMALLER_OR_EQUAL","<=",87],["T_WHITESPACE"," ",87],["T_VARIABLE","$bluepay_redirect_order",87],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",87],"]",")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n\t\t\t",87],["T_VARIABLE","$release_data",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_ARRAY","array",88],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",88],["T_VARIABLE","$release_data",90],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",90],"]",["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","config",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","get",90],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_account_id'",90],")",";",["T_WHITESPACE","\n\t\t\t",90],["T_VARIABLE","$release_data",91],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",91],"]",["T_WHITESPACE"," ",91],"=",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'CAPTURE'",91],";",["T_WHITESPACE","\n\t\t\t",91],["T_VARIABLE","$release_data",92],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",92],"]",["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","strtoupper",92],"(",["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","config",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","get",92],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_test'",92],")",")",";",["T_WHITESPACE","\n\t\t\t",92],["T_VARIABLE","$release_data",93],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",93],"]",["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$bluepay_redirect_order",93],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",93],"]",";",["T_WHITESPACE","\n\t\t\t",93],["T_VARIABLE","$release_data",94],"[",["T_CONSTANT_ENCAPSED_STRING","\"AMOUNT\"",94],"]",["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$amount",94],";",["T_WHITESPACE","\n\t\t\t",94],["T_VARIABLE","$release_data",95],"[",["T_CONSTANT_ENCAPSED_STRING","'APPROVED_URL'",95],"]",["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","HTTP_CATALOG",95],["T_WHITESPACE"," ",95],".",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",95],";",["T_WHITESPACE","\n\t\t\t",95],["T_VARIABLE","$release_data",96],"[",["T_CONSTANT_ENCAPSED_STRING","'DECLINED_URL'",96],"]",["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","HTTP_CATALOG",96],["T_WHITESPACE"," ",96],".",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",96],";",["T_WHITESPACE","\n\t\t\t",96],["T_VARIABLE","$release_data",97],"[",["T_CONSTANT_ENCAPSED_STRING","'MISSING_URL'",97],"]",["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","HTTP_CATALOG",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",97],";",["T_WHITESPACE","\n\n\t\t\t",97],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_ISSET","isset",99],"(",["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","request",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","server",99],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",99],"]",")",")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n\t\t\t\t",99],["T_VARIABLE","$release_data",100],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_IP\"",100],"]",["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","request",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","server",100],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",100],"]",";",["T_WHITESPACE","\n\t\t\t",100],"}",["T_WHITESPACE","\n\n\t\t\t",101],["T_VARIABLE","$tamper_proof_data",103],["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","config",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","get",103],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_secret_key'",103],")",["T_WHITESPACE"," ",103],".",["T_WHITESPACE"," ",103],["T_VARIABLE","$release_data",103],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",103],"]",["T_WHITESPACE"," ",103],".",["T_WHITESPACE"," ",103],["T_VARIABLE","$release_data",103],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",103],"]",["T_WHITESPACE"," ",103],".",["T_WHITESPACE"," ",103],["T_VARIABLE","$release_data",103],"[",["T_CONSTANT_ENCAPSED_STRING","\"AMOUNT\"",103],"]",["T_WHITESPACE"," ",103],".",["T_WHITESPACE"," ",103],["T_VARIABLE","$release_data",103],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",103],"]",["T_WHITESPACE"," ",103],".",["T_WHITESPACE"," ",103],["T_VARIABLE","$release_data",103],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",103],"]",";",["T_WHITESPACE","\n\n\t\t\t",103],["T_VARIABLE","$release_data",105],"[",["T_CONSTANT_ENCAPSED_STRING","\"TAMPER_PROOF_SEAL\"",105],"]",["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_STRING","md5",105],"(",["T_VARIABLE","$tamper_proof_data",105],")",";",["T_WHITESPACE","\n\n\t\t\t",105],["T_VARIABLE","$response_data",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","sendCurl",107],"(",["T_CONSTANT_ENCAPSED_STRING","'https:\/\/secure.bluepay.com\/interfaces\/bp10emu'",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$release_data",107],")",";",["T_WHITESPACE","\n\n\t\t\t",107],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_VARIABLE","$response_data",109],";",["T_WHITESPACE","\n\t\t",109],"}",["T_WHITESPACE"," ",110],["T_ELSE","else",110],["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n\t\t\t",110],["T_RETURN","return",111],["T_WHITESPACE"," ",111],["T_STRING","false",111],";",["T_WHITESPACE","\n\t\t",111],"}",["T_WHITESPACE","\n\t",112],"}",["T_WHITESPACE","\n\n\t",113],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","updateReleaseStatus",115],"(",["T_VARIABLE","$bluepay_redirect_order_id",115],",",["T_WHITESPACE"," ",115],["T_VARIABLE","$status",115],")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n\t\t",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","db",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","query",116],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_STRING","DB_PREFIX",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order` SET `release_status` = '\"",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_INT_CAST","(int)",116],["T_VARIABLE","$status",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_redirect_order_id` = '\"",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_INT_CAST","(int)",116],["T_VARIABLE","$bluepay_redirect_order_id",116],["T_WHITESPACE"," ",116],".",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","\"'\"",116],")",";",["T_WHITESPACE","\n\t",116],"}",["T_WHITESPACE","\n\n\t",117],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","rebate",119],"(",["T_VARIABLE","$order_id",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$amount",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n\t\t",119],["T_VARIABLE","$bluepay_redirect_order",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","getOrder",120],"(",["T_VARIABLE","$order_id",120],")",";",["T_WHITESPACE","\n\n\t\t",120],["T_IF","if",122],["T_WHITESPACE"," ",122],"(","!",["T_EMPTY","empty",122],"(",["T_VARIABLE","$bluepay_redirect_order",122],")",["T_WHITESPACE"," ",122],["T_BOOLEAN_AND","&&",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$bluepay_redirect_order",122],"[",["T_CONSTANT_ENCAPSED_STRING","'rebate_status'",122],"]",["T_WHITESPACE"," ",122],["T_IS_NOT_EQUAL","!=",122],["T_WHITESPACE"," ",122],["T_LNUMBER","1",122],")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n\t\t\t",122],["T_VARIABLE","$rebate_data",123],["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_ARRAY","array",123],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",123],["T_VARIABLE","$rebate_data",125],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",125],"]",["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_VARIABLE","$this",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","config",125],["T_OBJECT_OPERATOR","->",125],["T_STRING","get",125],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_account_id'",125],")",";",["T_WHITESPACE","\n\t\t\t",125],["T_VARIABLE","$rebate_data",126],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",126],"]",["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_CONSTANT_ENCAPSED_STRING","'REFUND'",126],";",["T_WHITESPACE","\n\t\t\t",126],["T_VARIABLE","$rebate_data",127],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",127],"]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","strtoupper",127],"(",["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","config",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","get",127],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_test'",127],")",")",";",["T_WHITESPACE","\n\t\t\t",127],["T_VARIABLE","$rebate_data",128],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",128],"]",["T_WHITESPACE"," ",128],"=",["T_WHITESPACE"," ",128],["T_VARIABLE","$bluepay_redirect_order",128],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",128],"]",";",["T_WHITESPACE","\n\t\t\t",128],["T_VARIABLE","$rebate_data",129],"[",["T_CONSTANT_ENCAPSED_STRING","\"AMOUNT\"",129],"]",["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$amount",129],";",["T_WHITESPACE","\n\t\t\t",129],["T_VARIABLE","$rebate_data",130],"[",["T_CONSTANT_ENCAPSED_STRING","'APPROVED_URL'",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_STRING","HTTP_CATALOG",130],["T_WHITESPACE"," ",130],".",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",130],";",["T_WHITESPACE","\n\t\t\t",130],["T_VARIABLE","$rebate_data",131],"[",["T_CONSTANT_ENCAPSED_STRING","'DECLINED_URL'",131],"]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","HTTP_CATALOG",131],["T_WHITESPACE"," ",131],".",["T_WHITESPACE"," ",131],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",131],";",["T_WHITESPACE","\n\t\t\t",131],["T_VARIABLE","$rebate_data",132],"[",["T_CONSTANT_ENCAPSED_STRING","'MISSING_URL'",132],"]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_STRING","HTTP_CATALOG",132],["T_WHITESPACE"," ",132],".",["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_redirect\/callback'",132],";",["T_WHITESPACE","\n\n\t\t\t",132],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_ISSET","isset",134],"(",["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","request",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","server",134],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",134],"]",")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n\t\t\t\t",134],["T_VARIABLE","$rebate_data",135],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_IP\"",135],"]",["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_VARIABLE","$this",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","request",135],["T_OBJECT_OPERATOR","->",135],["T_STRING","server",135],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",135],"]",";",["T_WHITESPACE","\n\t\t\t",135],"}",["T_WHITESPACE","\n\n\t\t\t",136],["T_VARIABLE","$tamper_proof_data",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","config",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","get",138],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_secret_key'",138],")",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$rebate_data",138],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",138],"]",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$rebate_data",138],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",138],"]",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$rebate_data",138],"[",["T_CONSTANT_ENCAPSED_STRING","'AMOUNT'",138],"]",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$rebate_data",138],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",138],"]",["T_WHITESPACE"," ",138],".",["T_WHITESPACE"," ",138],["T_VARIABLE","$rebate_data",138],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",138],"]",";",["T_WHITESPACE","\n\n\t\t\t",138],["T_VARIABLE","$rebate_data",140],"[",["T_CONSTANT_ENCAPSED_STRING","\"TAMPER_PROOF_SEAL\"",140],"]",["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_STRING","md5",140],"(",["T_VARIABLE","$tamper_proof_data",140],")",";",["T_WHITESPACE","\n\n\t\t\t",140],["T_VARIABLE","$response_data",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","sendCurl",142],"(",["T_CONSTANT_ENCAPSED_STRING","'https:\/\/secure.bluepay.com\/interfaces\/bp10emu'",142],",",["T_WHITESPACE"," ",142],["T_VARIABLE","$rebate_data",142],")",";",["T_WHITESPACE","\n\n\t\t\t",142],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$response_data",144],";",["T_WHITESPACE","\n\t\t",144],"}",["T_WHITESPACE"," ",145],["T_ELSE","else",145],["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n\t\t\t",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_STRING","false",146],";",["T_WHITESPACE","\n\t\t",146],"}",["T_WHITESPACE","\n\t",147],"}",["T_WHITESPACE","\n\n\t",148],["T_PUBLIC","public",150],["T_WHITESPACE"," ",150],["T_FUNCTION","function",150],["T_WHITESPACE"," ",150],["T_STRING","updateRebateStatus",150],"(",["T_VARIABLE","$bluepay_redirect_order_id",150],",",["T_WHITESPACE"," ",150],["T_VARIABLE","$status",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n\t\t",150],["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","db",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","query",151],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_STRING","DB_PREFIX",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order` SET `rebate_status` = '\"",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_INT_CAST","(int)",151],["T_VARIABLE","$status",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_redirect_order_id` = '\"",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_INT_CAST","(int)",151],["T_VARIABLE","$bluepay_redirect_order_id",151],["T_WHITESPACE"," ",151],".",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","\"'\"",151],")",";",["T_WHITESPACE","\n\t",151],"}",["T_WHITESPACE","\n\n\t",152],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","updateTransactionId",154],"(",["T_VARIABLE","$bluepay_redirect_order_id",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$transaction_id",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n\t\t",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","db",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","query",155],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_STRING","DB_PREFIX",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order` SET `transaction_id` = '\"",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_INT_CAST","(int)",155],["T_VARIABLE","$transaction_id",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_redirect_order_id` = '\"",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_INT_CAST","(int)",155],["T_VARIABLE","$bluepay_redirect_order_id",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","\"'\"",155],")",";",["T_WHITESPACE","\n\t",155],"}",["T_WHITESPACE","\n\n\t",156],["T_PUBLIC","public",158],["T_WHITESPACE"," ",158],["T_FUNCTION","function",158],["T_WHITESPACE"," ",158],["T_STRING","getOrder",158],"(",["T_VARIABLE","$order_id",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n\n\t\t",158],["T_VARIABLE","$qry",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$this",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","db",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","query",160],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_STRING","DB_PREFIX",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order` WHERE `order_id` = '\"",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_INT_CAST","(int)",160],["T_VARIABLE","$order_id",160],["T_WHITESPACE"," ",160],".",["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","\"' LIMIT 1\"",160],")",";",["T_WHITESPACE","\n\n\t\t",160],["T_IF","if",162],["T_WHITESPACE"," ",162],"(",["T_VARIABLE","$qry",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","num_rows",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n\t\t\t",162],["T_VARIABLE","$order",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$qry",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","row",163],";",["T_WHITESPACE","\n\t\t\t",163],["T_VARIABLE","$order",164],"[",["T_CONSTANT_ENCAPSED_STRING","'transactions'",164],"]",["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getTransactions",164],"(",["T_VARIABLE","$order",164],"[",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_order_id'",164],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",164],["T_RETURN","return",166],["T_WHITESPACE"," ",166],["T_VARIABLE","$order",166],";",["T_WHITESPACE","\n\t\t",166],"}",["T_WHITESPACE"," ",167],["T_ELSE","else",167],["T_WHITESPACE"," ",167],"{",["T_WHITESPACE","\n\t\t\t",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_STRING","false",168],";",["T_WHITESPACE","\n\t\t",168],"}",["T_WHITESPACE","\n\t",169],"}",["T_WHITESPACE","\n\n\t",170],["T_PRIVATE","private",172],["T_WHITESPACE"," ",172],["T_FUNCTION","function",172],["T_WHITESPACE"," ",172],["T_STRING","getTransactions",172],"(",["T_VARIABLE","$bluepay_redirect_order_id",172],")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n\t\t",172],["T_VARIABLE","$qry",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","db",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","query",173],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",173],["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_STRING","DB_PREFIX",173],["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order_transaction` WHERE `bluepay_redirect_order_id` = '\"",173],["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_INT_CAST","(int)",173],["T_VARIABLE","$bluepay_redirect_order_id",173],["T_WHITESPACE"," ",173],".",["T_WHITESPACE"," ",173],["T_CONSTANT_ENCAPSED_STRING","\"'\"",173],")",";",["T_WHITESPACE","\n\n\t\t",173],["T_IF","if",175],["T_WHITESPACE"," ",175],"(",["T_VARIABLE","$qry",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","num_rows",175],")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n\t\t\t",175],["T_RETURN","return",176],["T_WHITESPACE"," ",176],["T_VARIABLE","$qry",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","rows",176],";",["T_WHITESPACE","\n\t\t",176],"}",["T_WHITESPACE"," ",177],["T_ELSE","else",177],["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n\t\t\t",177],["T_RETURN","return",178],["T_WHITESPACE"," ",178],["T_STRING","false",178],";",["T_WHITESPACE","\n\t\t",178],"}",["T_WHITESPACE","\n\t",179],"}",["T_WHITESPACE","\n\n\t",180],["T_PUBLIC","public",182],["T_WHITESPACE"," ",182],["T_FUNCTION","function",182],["T_WHITESPACE"," ",182],["T_STRING","addTransaction",182],"(",["T_VARIABLE","$bluepay_redirect_order_id",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$type",182],",",["T_WHITESPACE"," ",182],["T_VARIABLE","$total",182],")",["T_WHITESPACE"," ",182],"{",["T_WHITESPACE","\n\t\t",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","db",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","query",183],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_STRING","DB_PREFIX",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order_transaction` SET `bluepay_redirect_order_id` = '\"",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_INT_CAST","(int)",183],["T_VARIABLE","$bluepay_redirect_order_id",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","\"', `date_added` = now(), `type` = '\"",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","db",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","escape",183],"(",["T_VARIABLE","$type",183],")",["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","\"', `amount` = '\"",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_DOUBLE_CAST","(float)",183],["T_VARIABLE","$total",183],["T_WHITESPACE"," ",183],".",["T_WHITESPACE"," ",183],["T_CONSTANT_ENCAPSED_STRING","\"'\"",183],")",";",["T_WHITESPACE","\n\t",183],"}",["T_WHITESPACE","\n\n\t",184],["T_PUBLIC","public",186],["T_WHITESPACE"," ",186],["T_FUNCTION","function",186],["T_WHITESPACE"," ",186],["T_STRING","getTotalReleased",186],"(",["T_VARIABLE","$bluepay_redirect_order_id",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n\t\t",186],["T_VARIABLE","$query",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","db",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","query",187],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE"," ",187],["T_STRING","DB_PREFIX",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order_transaction` WHERE `bluepay_redirect_order_id` = '\"",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE"," ",187],["T_INT_CAST","(int)",187],["T_VARIABLE","$bluepay_redirect_order_id",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","\"' AND (`type` = 'payment' OR `type` = 'rebate')\"",187],")",";",["T_WHITESPACE","\n\n\t\t",187],["T_RETURN","return",189],["T_WHITESPACE"," ",189],["T_DOUBLE_CAST","(float)",189],["T_VARIABLE","$query",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","row",189],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",189],"]",";",["T_WHITESPACE","\n\t",189],"}",["T_WHITESPACE","\n\n\t",190],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","getTotalRebated",192],"(",["T_VARIABLE","$bluepay_redirect_order_id",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n\t\t",192],["T_VARIABLE","$query",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","db",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","query",193],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_STRING","DB_PREFIX",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_redirect_order_transaction` WHERE `bluepay_redirect_order_id` = '\"",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_INT_CAST","(int)",193],["T_VARIABLE","$bluepay_redirect_order_id",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","\"' AND 'rebate'\"",193],")",";",["T_WHITESPACE","\n\n\t\t",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_DOUBLE_CAST","(float)",195],["T_VARIABLE","$query",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","row",195],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",195],"]",";",["T_WHITESPACE","\n\t",195],"}",["T_WHITESPACE","\n\n\t",196],["T_PUBLIC","public",198],["T_WHITESPACE"," ",198],["T_FUNCTION","function",198],["T_WHITESPACE"," ",198],["T_STRING","sendCurl",198],"(",["T_VARIABLE","$url",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$post_data",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n\t\t",198],["T_VARIABLE","$curl",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_STRING","curl_init",199],"(",["T_VARIABLE","$url",199],")",";",["T_WHITESPACE","\n\n\t\t",199],["T_STRING","curl_setopt",201],"(",["T_VARIABLE","$curl",201],",",["T_WHITESPACE"," ",201],["T_STRING","CURLOPT_PORT",201],",",["T_WHITESPACE"," ",201],["T_LNUMBER","443",201],")",";",["T_WHITESPACE","\n\t\t",201],["T_STRING","curl_setopt",202],"(",["T_VARIABLE","$curl",202],",",["T_WHITESPACE"," ",202],["T_STRING","CURLOPT_HEADER",202],",",["T_WHITESPACE"," ",202],["T_LNUMBER","0",202],")",";",["T_WHITESPACE","\n\t\t",202],["T_STRING","curl_setopt",203],"(",["T_VARIABLE","$curl",203],",",["T_WHITESPACE"," ",203],["T_STRING","CURLOPT_SSL_VERIFYPEER",203],",",["T_WHITESPACE"," ",203],["T_LNUMBER","0",203],")",";",["T_WHITESPACE","\n\t\t",203],["T_STRING","curl_setopt",204],"(",["T_VARIABLE","$curl",204],",",["T_WHITESPACE"," ",204],["T_STRING","CURLOPT_RETURNTRANSFER",204],",",["T_WHITESPACE"," ",204],["T_LNUMBER","1",204],")",";",["T_WHITESPACE","\n\t\t",204],["T_STRING","curl_setopt",205],"(",["T_VARIABLE","$curl",205],",",["T_WHITESPACE"," ",205],["T_STRING","CURLOPT_FOLLOWLOCATION",205],",",["T_WHITESPACE"," ",205],["T_STRING","true",205],")",";",["T_WHITESPACE","\n\t\t",205],["T_STRING","curl_setopt",206],"(",["T_VARIABLE","$curl",206],",",["T_WHITESPACE"," ",206],["T_STRING","CURLOPT_FORBID_REUSE",206],",",["T_WHITESPACE"," ",206],["T_LNUMBER","1",206],")",";",["T_WHITESPACE","\n\t\t",206],["T_STRING","curl_setopt",207],"(",["T_VARIABLE","$curl",207],",",["T_WHITESPACE"," ",207],["T_STRING","CURLOPT_FRESH_CONNECT",207],",",["T_WHITESPACE"," ",207],["T_LNUMBER","1",207],")",";",["T_WHITESPACE","\n\t\t",207],["T_STRING","curl_setopt",208],"(",["T_VARIABLE","$curl",208],",",["T_WHITESPACE"," ",208],["T_STRING","CURLOPT_POST",208],",",["T_WHITESPACE"," ",208],["T_LNUMBER","1",208],")",";",["T_WHITESPACE","\n\t\t",208],["T_STRING","curl_setopt",209],"(",["T_VARIABLE","$curl",209],",",["T_WHITESPACE"," ",209],["T_STRING","CURLOPT_POSTFIELDS",209],",",["T_WHITESPACE"," ",209],["T_STRING","http_build_query",209],"(",["T_VARIABLE","$post_data",209],")",")",";",["T_WHITESPACE","\n\n\t\t",209],["T_VARIABLE","$response_data",211],["T_WHITESPACE"," ",211],"=",["T_WHITESPACE"," ",211],["T_STRING","curl_exec",211],"(",["T_VARIABLE","$curl",211],")",";",["T_WHITESPACE","\n\t\t",211],["T_STRING","curl_close",212],"(",["T_VARIABLE","$curl",212],")",";",["T_WHITESPACE","\n\n\t\t",212],["T_RETURN","return",214],["T_WHITESPACE"," ",214],["T_STRING","json_decode",214],"(",["T_VARIABLE","$response_data",214],",",["T_WHITESPACE"," ",214],["T_STRING","true",214],")",";",["T_WHITESPACE","\n\t",214],"}",["T_WHITESPACE","\n\n\t",215],["T_PUBLIC","public",217],["T_WHITESPACE"," ",217],["T_FUNCTION","function",217],["T_WHITESPACE"," ",217],["T_STRING","callback",217],"(",")",["T_WHITESPACE"," ",217],"{",["T_WHITESPACE","\n\t\t",217],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","response",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","addHeader",218],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Type: application\/json'",218],")",";",["T_WHITESPACE","\n\t\t",218],["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","response",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","setOutput",219],"(",["T_STRING","json_encode",219],"(",["T_VARIABLE","$this",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","request",219],["T_OBJECT_OPERATOR","->",219],["T_STRING","get",219],")",")",";",["T_WHITESPACE","\n\t",219],"}",["T_WHITESPACE","\n\n\t",220],["T_PUBLIC","public",222],["T_WHITESPACE"," ",222],["T_FUNCTION","function",222],["T_WHITESPACE"," ",222],["T_STRING","logger",222],"(",["T_VARIABLE","$message",222],")",["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n\t\t",222],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","config",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","get",223],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect_debug'",223],")",["T_WHITESPACE"," ",223],["T_IS_EQUAL","==",223],["T_WHITESPACE"," ",223],["T_LNUMBER","1",223],")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n\t\t\t",223],["T_VARIABLE","$log",224],["T_WHITESPACE"," ",224],"=",["T_WHITESPACE"," ",224],["T_NEW","new",224],["T_WHITESPACE"," ",224],["T_STRING","Log",224],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_redirect.log'",224],")",";",["T_WHITESPACE","\n\t\t\t",224],["T_VARIABLE","$log",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","write",225],"(",["T_VARIABLE","$message",225],")",";",["T_WHITESPACE","\n\t\t",225],"}",["T_WHITESPACE","\n\t",226],"}",["T_WHITESPACE","\n",227],"}",["T_WHITESPACE","\n",228]]