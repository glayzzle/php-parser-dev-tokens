[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_CLASS","class",3],["T_WHITESPACE"," ",3],["T_STRING","ModelExtensionPaymentG2aPay",3],["T_WHITESPACE"," ",3],["T_EXTENDS","extends",3],["T_WHITESPACE"," ",3],["T_STRING","Model",3],["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\n\t",3],["T_PUBLIC","public",5],["T_WHITESPACE"," ",5],["T_FUNCTION","function",5],["T_WHITESPACE"," ",5],["T_STRING","install",5],"(",")",["T_WHITESPACE"," ",5],"{",["T_WHITESPACE","\n\t\t",5],["T_VARIABLE","$this",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","db",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","query",6],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE `\"",6],["T_WHITESPACE"," ",7],".",["T_WHITESPACE"," ",7],["T_STRING","DB_PREFIX",7],["T_WHITESPACE"," ",7],".",["T_WHITESPACE"," ",7],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order` (\n\t\t\t\t`g2apay_order_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t\t`order_id` int(11) NOT NULL,\n\t\t\t\t`g2apay_transaction_id` varchar(255) NOT NULL,\n\t\t\t\t`date_added` DATETIME NOT NULL,\n\t\t\t\t`modified` DATETIME NOT NULL,\n\t\t\t\t`refund_status` INT(1) DEFAULT NULL,\n\t\t\t\t`currency_code` CHAR(3) NOT NULL,\n\t\t\t\t`total` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t\tKEY `g2apay_transaction_id` (`g2apay_transaction_id`),\n\t\t\t\tPRIMARY KEY `g2apay_order_id` (`g2apay_order_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT CHARSET=utf8 COLLATE=utf8_general_ci;\n\t\t\"",7],")",";",["T_WHITESPACE","\n\n\t\t",19],["T_VARIABLE","$this",21],["T_OBJECT_OPERATOR","->",21],["T_STRING","db",21],["T_OBJECT_OPERATOR","->",21],["T_STRING","query",21],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",21],["T_WHITESPACE"," ",22],".",["T_WHITESPACE"," ",22],["T_STRING","DB_PREFIX",22],["T_WHITESPACE"," ",22],".",["T_WHITESPACE"," ",22],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order_transaction` (\n\t\t\t  `g2apay_order_transaction_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `g2apay_order_id` INT(11) NOT NULL,\n\t\t\t  `date_added` DATETIME NOT NULL,\n\t\t\t  `type` ENUM('payment', 'refund') DEFAULT NULL,\n\t\t\t  `amount` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t  PRIMARY KEY (`g2apay_order_transaction_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\n\t\t\t\"",22],")",";",["T_WHITESPACE","\n\t",30],"}",["T_WHITESPACE","\n\n\t",31],["T_PUBLIC","public",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","uninstall",33],"(",")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n\t\t",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","db",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","query",34],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",34],["T_WHITESPACE"," ",34],".",["T_WHITESPACE"," ",34],["T_STRING","DB_PREFIX",34],["T_WHITESPACE"," ",34],".",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order`;\"",34],")",";",["T_WHITESPACE","\n\t\t",34],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","db",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","query",35],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",35],["T_WHITESPACE"," ",35],".",["T_WHITESPACE"," ",35],["T_STRING","DB_PREFIX",35],["T_WHITESPACE"," ",35],".",["T_WHITESPACE"," ",35],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order_transaction`;\"",35],")",";",["T_WHITESPACE","\n\t",35],"}",["T_WHITESPACE","\n\n\t",36],["T_PUBLIC","public",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","getOrder",38],"(",["T_VARIABLE","$order_id",38],")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n\n\t\t",38],["T_VARIABLE","$qry",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","db",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","query",40],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",40],["T_WHITESPACE"," ",40],".",["T_WHITESPACE"," ",40],["T_STRING","DB_PREFIX",40],["T_WHITESPACE"," ",40],".",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order` WHERE `order_id` = '\"",40],["T_WHITESPACE"," ",40],".",["T_WHITESPACE"," ",40],["T_INT_CAST","(int)",40],["T_VARIABLE","$order_id",40],["T_WHITESPACE"," ",40],".",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","\"' LIMIT 1\"",40],")",";",["T_WHITESPACE","\n\n\t\t",40],["T_IF","if",42],["T_WHITESPACE"," ",42],"(",["T_VARIABLE","$qry",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","num_rows",42],")",["T_WHITESPACE"," ",42],"{",["T_WHITESPACE","\n\t\t\t",42],["T_VARIABLE","$order",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$qry",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","row",43],";",["T_WHITESPACE","\n\t\t\t",43],["T_VARIABLE","$order",44],"[",["T_CONSTANT_ENCAPSED_STRING","'transactions'",44],"]",["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","getTransactions",44],"(",["T_VARIABLE","$order",44],"[",["T_CONSTANT_ENCAPSED_STRING","'g2apay_order_id'",44],"]",",",["T_WHITESPACE"," ",44],["T_VARIABLE","$qry",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","row",44],"[",["T_CONSTANT_ENCAPSED_STRING","'currency_code'",44],"]",")",";",["T_WHITESPACE","\n\t\t\t",44],["T_RETURN","return",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$order",45],";",["T_WHITESPACE","\n\t\t",45],"}",["T_WHITESPACE"," ",46],["T_ELSE","else",46],["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n\t\t\t",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_STRING","false",47],";",["T_WHITESPACE","\n\t\t",47],"}",["T_WHITESPACE","\n\t",48],"}",["T_WHITESPACE","\n\n\t",49],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","getTotalReleased",51],"(",["T_VARIABLE","$g2apay_order_id",51],")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n\t\t",51],["T_VARIABLE","$query",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$this",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","db",52],["T_OBJECT_OPERATOR","->",52],["T_STRING","query",52],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_STRING","DB_PREFIX",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order_transaction` WHERE `g2apay_order_id` = '\"",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_INT_CAST","(int)",52],["T_VARIABLE","$g2apay_order_id",52],["T_WHITESPACE"," ",52],".",["T_WHITESPACE"," ",52],["T_CONSTANT_ENCAPSED_STRING","\"' AND (`type` = 'payment' OR `type` = 'refund')\"",52],")",";",["T_WHITESPACE","\n\n\t\t",52],["T_RETURN","return",54],["T_WHITESPACE"," ",54],["T_DOUBLE_CAST","(double)",54],["T_VARIABLE","$query",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","row",54],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",54],"]",";",["T_WHITESPACE","\n\t",54],"}",["T_WHITESPACE","\n\n\t",55],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","refund",57],"(",["T_VARIABLE","$g2apay_order",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$amount",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n\t\t",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(","!",["T_EMPTY","empty",58],"(",["T_VARIABLE","$g2apay_order",58],")",["T_WHITESPACE"," ",58],["T_BOOLEAN_AND","&&",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$g2apay_order",58],"[",["T_CONSTANT_ENCAPSED_STRING","'refund_status'",58],"]",["T_WHITESPACE"," ",58],["T_IS_NOT_EQUAL","!=",58],["T_WHITESPACE"," ",58],["T_LNUMBER","1",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n\t\t\t",58],["T_IF","if",59],["T_WHITESPACE"," ",59],"(",["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","config",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","get",59],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay_environment'",59],")",["T_WHITESPACE"," ",59],["T_IS_EQUAL","==",59],["T_WHITESPACE"," ",59],["T_LNUMBER","1",59],")",["T_WHITESPACE"," ",59],"{",["T_WHITESPACE","\n\t\t\t\t",59],["T_VARIABLE","$url",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/pay.g2a.com\/rest\/transactions\/'",60],["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_VARIABLE","$g2apay_order",60],"[",["T_CONSTANT_ENCAPSED_STRING","'g2apay_transaction_id'",60],"]",";",["T_WHITESPACE","\n\t\t\t",60],"}",["T_WHITESPACE"," ",61],["T_ELSE","else",61],["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n\t\t\t\t",61],["T_VARIABLE","$url",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'https:\/\/www.test.pay.g2a.com\/rest\/transactions\/'",62],["T_WHITESPACE"," ",62],".",["T_WHITESPACE"," ",62],["T_VARIABLE","$g2apay_order",62],"[",["T_CONSTANT_ENCAPSED_STRING","'g2apay_transaction_id'",62],"]",";",["T_WHITESPACE","\n\t\t\t",62],"}",["T_WHITESPACE","\n\n\t\t\t",63],["T_VARIABLE","$refunded_amount",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_STRING","round",65],"(",["T_VARIABLE","$amount",65],",",["T_WHITESPACE"," ",65],["T_LNUMBER","2",65],")",";",["T_WHITESPACE","\n\n\t\t\t",65],["T_VARIABLE","$string",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$g2apay_order",67],"[",["T_CONSTANT_ENCAPSED_STRING","'g2apay_transaction_id'",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$g2apay_order",67],"[",["T_CONSTANT_ENCAPSED_STRING","'order_id'",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_STRING","round",67],"(",["T_VARIABLE","$g2apay_order",67],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",67],"]",",",["T_WHITESPACE"," ",67],["T_LNUMBER","2",67],")",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$refunded_amount",67],["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_STRING","html_entity_decode",67],"(",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","config",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","get",67],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay_secret'",67],")",")",";",["T_WHITESPACE","\n\t\t\t",67],["T_VARIABLE","$hash",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","hash",68],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$string",68],")",";",["T_WHITESPACE","\n\n\t\t\t",68],["T_VARIABLE","$fields",70],["T_WHITESPACE"," ",70],"=",["T_WHITESPACE"," ",70],["T_ARRAY","array",70],"(",["T_WHITESPACE","\n\t\t\t\t",70],["T_CONSTANT_ENCAPSED_STRING","'action'",71],["T_WHITESPACE"," ",71],["T_DOUBLE_ARROW","=>",71],["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'refund'",71],",",["T_WHITESPACE","\n\t\t\t\t",71],["T_CONSTANT_ENCAPSED_STRING","'amount'",72],["T_WHITESPACE"," ",72],["T_DOUBLE_ARROW","=>",72],["T_WHITESPACE"," ",72],["T_VARIABLE","$refunded_amount",72],",",["T_WHITESPACE","\n\t\t\t\t",72],["T_CONSTANT_ENCAPSED_STRING","'hash'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$hash",73],",",["T_WHITESPACE","\n\t\t\t",73],")",";",["T_WHITESPACE","\n\n\t\t\t",74],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","sendCurl",76],"(",["T_VARIABLE","$url",76],",",["T_WHITESPACE"," ",76],["T_VARIABLE","$fields",76],")",";",["T_WHITESPACE","\n\t\t",76],"}",["T_WHITESPACE"," ",77],["T_ELSE","else",77],["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n\t\t\t",77],["T_RETURN","return",78],["T_WHITESPACE"," ",78],["T_STRING","false",78],";",["T_WHITESPACE","\n\t\t",78],"}",["T_WHITESPACE","\n\t",79],"}",["T_WHITESPACE","\n\n\t",80],["T_PUBLIC","public",82],["T_WHITESPACE"," ",82],["T_FUNCTION","function",82],["T_WHITESPACE"," ",82],["T_STRING","updateRefundStatus",82],"(",["T_VARIABLE","$g2apay_order_id",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$status",82],")",["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n\t\t",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","db",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","query",83],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_STRING","DB_PREFIX",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order` SET `refund_status` = '\"",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_INT_CAST","(int)",83],["T_VARIABLE","$status",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `g2apay_order_id` = '\"",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_INT_CAST","(int)",83],["T_VARIABLE","$g2apay_order_id",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","\"'\"",83],")",";",["T_WHITESPACE","\n\t",83],"}",["T_WHITESPACE","\n\n\t",84],["T_PRIVATE","private",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","getTransactions",86],"(",["T_VARIABLE","$g2apay_order_id",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$currency_code",86],")",["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n\t\t",86],["T_VARIABLE","$query",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","db",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","query",87],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_STRING","DB_PREFIX",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order_transaction` WHERE `g2apay_order_id` = '\"",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_INT_CAST","(int)",87],["T_VARIABLE","$g2apay_order_id",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","\"'\"",87],")",";",["T_WHITESPACE","\n\n\t\t",87],["T_VARIABLE","$transactions",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_ARRAY","array",89],"(",")",";",["T_WHITESPACE","\n\t\t",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$query",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","num_rows",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n\t\t\t",90],["T_FOREACH","foreach",91],["T_WHITESPACE"," ",91],"(",["T_VARIABLE","$query",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","rows",91],["T_WHITESPACE"," ",91],["T_AS","as",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$row",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n\t\t\t\t",91],["T_VARIABLE","$row",92],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",92],"]",["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","currency",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","format",92],"(",["T_VARIABLE","$row",92],"[",["T_CONSTANT_ENCAPSED_STRING","'amount'",92],"]",",",["T_WHITESPACE"," ",92],["T_VARIABLE","$currency_code",92],",",["T_WHITESPACE"," ",92],["T_STRING","true",92],",",["T_WHITESPACE"," ",92],["T_STRING","true",92],")",";",["T_WHITESPACE","\n\t\t\t\t",92],["T_VARIABLE","$transactions",93],"[","]",["T_WHITESPACE"," ",93],"=",["T_WHITESPACE"," ",93],["T_VARIABLE","$row",93],";",["T_WHITESPACE","\n\t\t\t",93],"}",["T_WHITESPACE","\n\t\t\t",94],["T_RETURN","return",95],["T_WHITESPACE"," ",95],["T_VARIABLE","$transactions",95],";",["T_WHITESPACE","\n\t\t",95],"}",["T_WHITESPACE"," ",96],["T_ELSE","else",96],["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n\t\t\t",96],["T_RETURN","return",97],["T_WHITESPACE"," ",97],["T_STRING","false",97],";",["T_WHITESPACE","\n\t\t",97],"}",["T_WHITESPACE","\n\t",98],"}",["T_WHITESPACE","\n\n\t",99],["T_PUBLIC","public",101],["T_WHITESPACE"," ",101],["T_FUNCTION","function",101],["T_WHITESPACE"," ",101],["T_STRING","addTransaction",101],"(",["T_VARIABLE","$g2apay_order_id",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$type",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$total",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n\t\t",101],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","db",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","query",102],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",102],["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_STRING","DB_PREFIX",102],["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order_transaction` SET `g2apay_order_id` = '\"",102],["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_INT_CAST","(int)",102],["T_VARIABLE","$g2apay_order_id",102],["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","\"',`date_added` = now(), `type` = '\"",102],["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","db",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","escape",102],"(",["T_VARIABLE","$type",102],")",["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","\"', `amount` = '\"",102],["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_DOUBLE_CAST","(double)",102],["T_VARIABLE","$total",102],["T_WHITESPACE"," ",102],".",["T_WHITESPACE"," ",102],["T_CONSTANT_ENCAPSED_STRING","\"'\"",102],")",";",["T_WHITESPACE","\n\t",102],"}",["T_WHITESPACE","\n\n\t",103],["T_PUBLIC","public",105],["T_WHITESPACE"," ",105],["T_FUNCTION","function",105],["T_WHITESPACE"," ",105],["T_STRING","getTotalRefunded",105],"(",["T_VARIABLE","$g2apay_order_id",105],")",["T_WHITESPACE"," ",105],"{",["T_WHITESPACE","\n\t\t",105],["T_VARIABLE","$query",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","db",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","query",106],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",106],["T_WHITESPACE"," ",106],".",["T_WHITESPACE"," ",106],["T_STRING","DB_PREFIX",106],["T_WHITESPACE"," ",106],".",["T_WHITESPACE"," ",106],["T_CONSTANT_ENCAPSED_STRING","\"g2apay_order_transaction` WHERE `g2apay_order_id` = '\"",106],["T_WHITESPACE"," ",106],".",["T_WHITESPACE"," ",106],["T_INT_CAST","(int)",106],["T_VARIABLE","$g2apay_order_id",106],["T_WHITESPACE"," ",106],".",["T_WHITESPACE"," ",106],["T_CONSTANT_ENCAPSED_STRING","\"' AND 'refund'\"",106],")",";",["T_WHITESPACE","\n\n\t\t",106],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_DOUBLE_CAST","(double)",108],["T_VARIABLE","$query",108],["T_OBJECT_OPERATOR","->",108],["T_STRING","row",108],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",108],"]",";",["T_WHITESPACE","\n\t",108],"}",["T_WHITESPACE","\n\n\t",109],["T_PUBLIC","public",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","sendCurl",111],"(",["T_VARIABLE","$url",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$fields",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n\t\t",111],["T_VARIABLE","$curl",112],["T_WHITESPACE"," ",112],"=",["T_WHITESPACE"," ",112],["T_STRING","curl_init",112],"(",["T_VARIABLE","$url",112],")",";",["T_WHITESPACE","\n\t\t",112],["T_STRING","curl_setopt",113],"(",["T_VARIABLE","$curl",113],",",["T_WHITESPACE"," ",113],["T_STRING","CURLOPT_URL",113],",",["T_WHITESPACE"," ",113],["T_VARIABLE","$url",113],")",";",["T_WHITESPACE","\n\t\t",113],["T_STRING","curl_setopt",114],"(",["T_VARIABLE","$curl",114],",",["T_WHITESPACE"," ",114],["T_STRING","CURLOPT_RETURNTRANSFER",114],",",["T_WHITESPACE"," ",114],["T_STRING","true",114],")",";",["T_WHITESPACE","\n\t\t",114],["T_STRING","curl_setopt",115],"(",["T_VARIABLE","$curl",115],",",["T_WHITESPACE"," ",115],["T_STRING","CURLOPT_CUSTOMREQUEST",115],",",["T_WHITESPACE"," ",115],["T_CONSTANT_ENCAPSED_STRING","\"PUT\"",115],")",";",["T_WHITESPACE","\n\t\t",115],["T_STRING","curl_setopt",116],"(",["T_VARIABLE","$curl",116],",",["T_WHITESPACE"," ",116],["T_STRING","CURLOPT_POSTFIELDS",116],",",["T_WHITESPACE"," ",116],["T_STRING","http_build_query",116],"(",["T_VARIABLE","$fields",116],")",")",";",["T_WHITESPACE","\n\n\t\t",116],["T_VARIABLE","$auth_hash",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_STRING","hash",118],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",118],",",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","config",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","get",118],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay_api_hash'",118],")",["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","config",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","get",118],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay_username'",118],")",["T_WHITESPACE"," ",118],".",["T_WHITESPACE"," ",118],["T_STRING","html_entity_decode",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","config",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","get",118],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay_secret'",118],")",")",")",";",["T_WHITESPACE","\n\t\t",118],["T_VARIABLE","$authorization",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","config",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","get",119],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay_api_hash'",119],")",["T_WHITESPACE"," ",119],".",["T_WHITESPACE"," ",119],["T_CONSTANT_ENCAPSED_STRING","\";\"",119],["T_WHITESPACE"," ",119],".",["T_WHITESPACE"," ",119],["T_VARIABLE","$auth_hash",119],";",["T_WHITESPACE","\n\t\t",119],["T_STRING","curl_setopt",120],"(",["T_WHITESPACE","\n\t\t\t\t",120],["T_VARIABLE","$curl",121],",",["T_WHITESPACE"," ",121],["T_STRING","CURLOPT_HTTPHEADER",121],",",["T_WHITESPACE"," ",121],["T_ARRAY","array",121],"(",["T_WHITESPACE","\n\t\t\t",121],["T_CONSTANT_ENCAPSED_STRING","\"Authorization: \"",122],["T_WHITESPACE"," ",122],".",["T_WHITESPACE"," ",122],["T_VARIABLE","$authorization",122],["T_WHITESPACE","\n\t\t\t\t",122],")",["T_WHITESPACE","\n\t\t",123],")",";",["T_WHITESPACE","\n\n\t\t",124],["T_VARIABLE","$response",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_STRING","json_decode",126],"(",["T_STRING","curl_exec",126],"(",["T_VARIABLE","$curl",126],")",")",";",["T_WHITESPACE","\n\n\t\t",126],["T_STRING","curl_close",128],"(",["T_VARIABLE","$curl",128],")",";",["T_WHITESPACE","\n\t\t",128],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_STRING","is_object",129],"(",["T_VARIABLE","$response",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n\t\t\t",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_STRING_CAST","(string)",130],["T_VARIABLE","$response",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","status",130],";",["T_WHITESPACE","\n\t\t",130],"}",["T_WHITESPACE"," ",131],["T_ELSE","else",131],["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n\t\t\t",131],["T_RETURN","return",132],["T_WHITESPACE"," ",132],["T_STRING","str_replace",132],"(",["T_CONSTANT_ENCAPSED_STRING","'\"'",132],",",["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","\"\"",132],",",["T_WHITESPACE"," ",132],["T_VARIABLE","$response",132],")",";",["T_WHITESPACE","\n\t\t",132],"}",["T_WHITESPACE","\n\t",133],"}",["T_WHITESPACE","\n\n\t",134],["T_PUBLIC","public",136],["T_WHITESPACE"," ",136],["T_FUNCTION","function",136],["T_WHITESPACE"," ",136],["T_STRING","logger",136],"(",["T_VARIABLE","$message",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n\t\t",136],["T_IF","if",137],["T_WHITESPACE"," ",137],"(",["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","config",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","get",137],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay_debug'",137],")",["T_WHITESPACE"," ",137],["T_IS_EQUAL","==",137],["T_WHITESPACE"," ",137],["T_LNUMBER","1",137],")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n\t\t\t",137],["T_VARIABLE","$log",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_NEW","new",138],["T_WHITESPACE"," ",138],["T_STRING","Log",138],"(",["T_CONSTANT_ENCAPSED_STRING","'g2apay.log'",138],")",";",["T_WHITESPACE","\n\t\t\t",138],["T_VARIABLE","$backtrace",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_STRING","debug_backtrace",139],"(",")",";",["T_WHITESPACE","\n\t\t\t",139],["T_VARIABLE","$log",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","write",140],"(",["T_CONSTANT_ENCAPSED_STRING","'Origin: '",140],["T_WHITESPACE"," ",140],".",["T_WHITESPACE"," ",140],["T_VARIABLE","$backtrace",140],"[",["T_LNUMBER","6",140],"]","[",["T_CONSTANT_ENCAPSED_STRING","'class'",140],"]",["T_WHITESPACE"," ",140],".",["T_WHITESPACE"," ",140],["T_CONSTANT_ENCAPSED_STRING","'::'",140],["T_WHITESPACE"," ",140],".",["T_WHITESPACE"," ",140],["T_VARIABLE","$backtrace",140],"[",["T_LNUMBER","6",140],"]","[",["T_CONSTANT_ENCAPSED_STRING","'function'",140],"]",")",";",["T_WHITESPACE","\n\t\t\t",140],["T_VARIABLE","$log",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","write",141],"(",["T_STRING","print_r",141],"(",["T_VARIABLE","$message",141],",",["T_WHITESPACE"," ",141],["T_LNUMBER","1",141],")",")",";",["T_WHITESPACE","\n\t\t",141],"}",["T_WHITESPACE","\n\t",142],"}",["T_WHITESPACE","\n\n",143],"}",["T_WHITESPACE","\n",145]]