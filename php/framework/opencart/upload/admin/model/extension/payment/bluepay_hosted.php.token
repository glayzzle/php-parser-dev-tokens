[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ModelExtensionPaymentBluePayHosted",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Model",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\t",2],["T_PUBLIC","public",3],["T_WHITESPACE"," ",3],["T_FUNCTION","function",3],["T_WHITESPACE"," ",3],["T_STRING","install",3],"(",")",["T_WHITESPACE"," ",3],"{",["T_WHITESPACE","\n\t\t",3],["T_VARIABLE","$this",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","db",4],["T_OBJECT_OPERATOR","->",4],["T_STRING","query",4],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",4],["T_WHITESPACE"," ",5],".",["T_WHITESPACE"," ",5],["T_STRING","DB_PREFIX",5],["T_WHITESPACE"," ",5],".",["T_WHITESPACE"," ",5],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order` (\n\t\t\t  `bluepay_hosted_order_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `order_id` INT(11) NOT NULL,\n\t\t\t  `transaction_id` VARCHAR(50),\n\t\t\t  `date_added` DATETIME NOT NULL,\n\t\t\t  `date_modified` DATETIME NOT NULL,\n\t\t\t  `release_status` INT(1) DEFAULT 0,\n\t\t\t  `void_status` INT(1) DEFAULT 0,\n\t\t\t  `rebate_status` INT(1) DEFAULT 0,\n\t\t\t  `currency_code` CHAR(3) NOT NULL,\n\t\t\t  `total` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t  PRIMARY KEY (`bluepay_hosted_order_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",5],")",";",["T_WHITESPACE","\n\n\t\t",17],["T_VARIABLE","$this",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","db",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","query",19],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",19],["T_WHITESPACE"," ",20],".",["T_WHITESPACE"," ",20],["T_STRING","DB_PREFIX",20],["T_WHITESPACE"," ",20],".",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order_transaction` (\n\t\t\t  `bluepay_hosted_order_transaction_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `bluepay_hosted_order_id` INT(11) NOT NULL,\n\t\t\t  `date_added` DATETIME NOT NULL,\n\t\t\t  `type` ENUM('auth', 'payment', 'rebate', 'void') DEFAULT NULL,\n\t\t\t  `amount` DECIMAL( 10, 2 ) NOT NULL,\n\t\t\t  PRIMARY KEY (`bluepay_hosted_order_transaction_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",20],")",";",["T_WHITESPACE","\n\n\t\t",27],["T_VARIABLE","$this",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","db",29],["T_OBJECT_OPERATOR","->",29],["T_STRING","query",29],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",29],["T_WHITESPACE"," ",30],".",["T_WHITESPACE"," ",30],["T_STRING","DB_PREFIX",30],["T_WHITESPACE"," ",30],".",["T_WHITESPACE"," ",30],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_card` (\n\t\t\t  `card_id` INT(11) NOT NULL AUTO_INCREMENT,\n\t\t\t  `customer_id` INT(11) NOT NULL,\n\t\t\t  `token` VARCHAR(50) NOT NULL,\n\t\t\t  `digits` VARCHAR(4) NOT NULL,\n\t\t\t  `expiry` VARCHAR(5) NOT NULL,\n\t\t\t  `type` VARCHAR(50) NOT NULL,\n\t\t\t  PRIMARY KEY (`card_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",30],")",";",["T_WHITESPACE","\n\t",38],"}",["T_WHITESPACE","\n\n\t",39],["T_PUBLIC","public",41],["T_WHITESPACE"," ",41],["T_FUNCTION","function",41],["T_WHITESPACE"," ",41],["T_STRING","uninstall",41],"(",")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n\t\t",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","db",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","query",42],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",42],["T_WHITESPACE"," ",42],".",["T_WHITESPACE"," ",42],["T_STRING","DB_PREFIX",42],["T_WHITESPACE"," ",42],".",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order`;\"",42],")",";",["T_WHITESPACE","\n\t\t",42],["T_VARIABLE","$this",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","db",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","query",43],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_STRING","DB_PREFIX",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order_transaction`;\"",43],")",";",["T_WHITESPACE","\n\t\t",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","db",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","query",44],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",44],["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_STRING","DB_PREFIX",44],["T_WHITESPACE"," ",44],".",["T_WHITESPACE"," ",44],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_card`;\"",44],")",";",["T_WHITESPACE","\n\t",44],"}",["T_WHITESPACE","\n\n\t",45],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","void",47],"(",["T_VARIABLE","$order_id",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n\t\t",47],["T_VARIABLE","$bluepay_hosted_order",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","getOrder",48],"(",["T_VARIABLE","$order_id",48],")",";",["T_WHITESPACE","\n\n\t\t",48],["T_IF","if",50],["T_WHITESPACE"," ",50],"(","!",["T_EMPTY","empty",50],"(",["T_VARIABLE","$bluepay_hosted_order",50],")",["T_WHITESPACE"," ",50],["T_BOOLEAN_AND","&&",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$bluepay_hosted_order",50],"[",["T_CONSTANT_ENCAPSED_STRING","'release_status'",50],"]",["T_WHITESPACE"," ",50],["T_IS_EQUAL","==",50],["T_WHITESPACE"," ",50],["T_LNUMBER","1",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n\n\t\t\t",50],["T_VARIABLE","$void_data",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_ARRAY","array",52],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",52],["T_VARIABLE","$void_data",54],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",54],"]",["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","config",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","get",54],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_account_id'",54],")",";",["T_WHITESPACE","\n\t\t\t",54],["T_VARIABLE","$void_data",55],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",55],"]",["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'VOID'",55],";",["T_WHITESPACE","\n\t\t\t",55],["T_VARIABLE","$void_data",56],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",56],"]",["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_STRING","strtoupper",56],"(",["T_VARIABLE","$this",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","config",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","get",56],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_test'",56],")",")",";",["T_WHITESPACE","\n\t\t\t",56],["T_VARIABLE","$void_data",57],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",57],"]",["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$bluepay_hosted_order",57],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",57],"]",";",["T_WHITESPACE","\n\n\t\t\t",57],["T_VARIABLE","$void_data",59],"[",["T_CONSTANT_ENCAPSED_STRING","'APPROVED_URL'",59],"]",["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_STRING","HTTP_CATALOG",59],["T_WHITESPACE"," ",59],".",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",59],";",["T_WHITESPACE","\n\t\t\t",59],["T_VARIABLE","$void_data",60],"[",["T_CONSTANT_ENCAPSED_STRING","'DECLINED_URL'",60],"]",["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","HTTP_CATALOG",60],["T_WHITESPACE"," ",60],".",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",60],";",["T_WHITESPACE","\n\t\t\t",60],["T_VARIABLE","$void_data",61],"[",["T_CONSTANT_ENCAPSED_STRING","'MISSING_URL'",61],"]",["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","HTTP_CATALOG",61],["T_WHITESPACE"," ",61],".",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",61],";",["T_WHITESPACE","\n\n\t\t\t",61],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_ISSET","isset",63],"(",["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","request",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","server",63],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",63],"]",")",")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n\t\t\t\t",63],["T_VARIABLE","$void_data",64],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_IP\"",64],"]",["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","request",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","server",64],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",64],"]",";",["T_WHITESPACE","\n\t\t\t",64],"}",["T_WHITESPACE","\n\n\t\t\t",65],["T_VARIABLE","$tamper_proof_data",67],["T_WHITESPACE"," ",67],"=",["T_WHITESPACE"," ",67],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","config",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","get",67],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_secret_key'",67],")",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",67],"]",["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_VARIABLE","$void_data",67],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",67],"]",";",["T_WHITESPACE","\n\n\t\t\t",67],["T_VARIABLE","$void_data",69],"[",["T_CONSTANT_ENCAPSED_STRING","\"TAMPER_PROOF_SEAL\"",69],"]",["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","md5",69],"(",["T_VARIABLE","$tamper_proof_data",69],")",";",["T_WHITESPACE","\n\n\t\t\t",69],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","logger",71],"(",["T_CONSTANT_ENCAPSED_STRING","'$void_data:\\r\\n'",71],["T_WHITESPACE"," ",71],".",["T_WHITESPACE"," ",71],["T_STRING","print_r",71],"(",["T_VARIABLE","$void_data",71],",",["T_WHITESPACE"," ",71],["T_LNUMBER","1",71],")",")",";",["T_WHITESPACE","\n\n\t\t\t",71],["T_VARIABLE","$response_data",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","sendCurl",73],"(",["T_CONSTANT_ENCAPSED_STRING","'https:\/\/secure.bluepay.com\/interfaces\/bp10emu'",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$void_data",73],")",";",["T_WHITESPACE","\n\n\t\t\t",73],["T_RETURN","return",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$response_data",75],";",["T_WHITESPACE","\n\t\t",75],"}",["T_WHITESPACE"," ",76],["T_ELSE","else",76],["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n\t\t\t",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_STRING","false",77],";",["T_WHITESPACE","\n\t\t",77],"}",["T_WHITESPACE","\n\t",78],"}",["T_WHITESPACE","\n\n\t",79],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","updateVoidStatus",81],"(",["T_VARIABLE","$bluepay_hosted_order_id",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$status",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n\t\t",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","logger",82],"(",["T_CONSTANT_ENCAPSED_STRING","'$bluepay_hosted_order_id:\\r\\n'",82],["T_WHITESPACE"," ",82],".",["T_WHITESPACE"," ",82],["T_STRING","print_r",82],"(",["T_VARIABLE","$bluepay_hosted_order_id",82],",",["T_WHITESPACE"," ",82],["T_LNUMBER","1",82],")",")",";",["T_WHITESPACE","\n\t\t",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","logger",83],"(",["T_CONSTANT_ENCAPSED_STRING","'$status:\\r\\n'",83],["T_WHITESPACE"," ",83],".",["T_WHITESPACE"," ",83],["T_STRING","print_r",83],"(",["T_VARIABLE","$status",83],",",["T_WHITESPACE"," ",83],["T_LNUMBER","1",83],")",")",";",["T_WHITESPACE","\n\t\t",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","db",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","query",84],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_STRING","DB_PREFIX",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order` SET `void_status` = '\"",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_INT_CAST","(int)",84],["T_VARIABLE","$status",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_hosted_order_id` = '\"",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_INT_CAST","(int)",84],["T_VARIABLE","$bluepay_hosted_order_id",84],["T_WHITESPACE"," ",84],".",["T_WHITESPACE"," ",84],["T_CONSTANT_ENCAPSED_STRING","\"'\"",84],")",";",["T_WHITESPACE","\n\t",84],"}",["T_WHITESPACE","\n\n\t",85],["T_PUBLIC","public",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","release",87],"(",["T_VARIABLE","$order_id",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$amount",87],")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE","\n\t\t",87],["T_VARIABLE","$bluepay_hosted_order",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getOrder",88],"(",["T_VARIABLE","$order_id",88],")",";",["T_WHITESPACE","\n\t\t",88],["T_VARIABLE","$total_released",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getTotalReleased",89],"(",["T_VARIABLE","$bluepay_hosted_order",89],"[",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_order_id'",89],"]",")",";",["T_WHITESPACE","\n\n\t\t",89],["T_IF","if",91],["T_WHITESPACE"," ",91],"(","!",["T_EMPTY","empty",91],"(",["T_VARIABLE","$bluepay_hosted_order",91],")",["T_WHITESPACE"," ",91],["T_BOOLEAN_AND","&&",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$bluepay_hosted_order",91],"[",["T_CONSTANT_ENCAPSED_STRING","'release_status'",91],"]",["T_WHITESPACE"," ",91],["T_IS_EQUAL","==",91],["T_WHITESPACE"," ",91],["T_LNUMBER","0",91],["T_WHITESPACE"," ",91],["T_BOOLEAN_AND","&&",91],["T_WHITESPACE"," ",91],"(",["T_VARIABLE","$total_released",91],["T_WHITESPACE"," ",91],"+",["T_WHITESPACE"," ",91],["T_VARIABLE","$amount",91],["T_WHITESPACE"," ",91],["T_IS_SMALLER_OR_EQUAL","<=",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$bluepay_hosted_order",91],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",91],"]",")",")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n\t\t\t",91],["T_VARIABLE","$release_data",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_ARRAY","array",92],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",92],["T_VARIABLE","$release_data",94],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",94],"]",["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","config",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","get",94],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_account_id'",94],")",";",["T_WHITESPACE","\n\t\t\t",94],["T_VARIABLE","$release_data",95],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",95],"]",["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_CONSTANT_ENCAPSED_STRING","'CAPTURE'",95],";",["T_WHITESPACE","\n\t\t\t",95],["T_VARIABLE","$release_data",96],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",96],"]",["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","strtoupper",96],"(",["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","config",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","get",96],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_test'",96],")",")",";",["T_WHITESPACE","\n\t\t\t",96],["T_VARIABLE","$release_data",97],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",97],"]",["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_VARIABLE","$bluepay_hosted_order",97],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",97],"]",";",["T_WHITESPACE","\n\n\t\t\t",97],["T_VARIABLE","$release_data",99],"[",["T_CONSTANT_ENCAPSED_STRING","'APPROVED_URL'",99],"]",["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_STRING","HTTP_CATALOG",99],["T_WHITESPACE"," ",99],".",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",99],";",["T_WHITESPACE","\n\t\t\t",99],["T_VARIABLE","$release_data",100],"[",["T_CONSTANT_ENCAPSED_STRING","'DECLINED_URL'",100],"]",["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_STRING","HTTP_CATALOG",100],["T_WHITESPACE"," ",100],".",["T_WHITESPACE"," ",100],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",100],";",["T_WHITESPACE","\n\t\t\t",100],["T_VARIABLE","$release_data",101],"[",["T_CONSTANT_ENCAPSED_STRING","'MISSING_URL'",101],"]",["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_STRING","HTTP_CATALOG",101],["T_WHITESPACE"," ",101],".",["T_WHITESPACE"," ",101],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",101],";",["T_WHITESPACE","\n\n\t\t\t",101],["T_IF","if",103],["T_WHITESPACE"," ",103],"(",["T_ISSET","isset",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","request",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","server",103],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",103],"]",")",")",["T_WHITESPACE"," ",103],"{",["T_WHITESPACE","\n\t\t\t\t",103],["T_VARIABLE","$release_data",104],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_IP\"",104],"]",["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","request",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","server",104],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",104],"]",";",["T_WHITESPACE","\n\t\t\t",104],"}",["T_WHITESPACE","\n\n\t\t\t",105],["T_VARIABLE","$tamper_proof_data",107],["T_WHITESPACE"," ",107],"=",["T_WHITESPACE"," ",107],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","config",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","get",107],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_secret_key'",107],")",["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_VARIABLE","$release_data",107],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",107],"]",["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_VARIABLE","$release_data",107],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",107],"]",["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_VARIABLE","$release_data",107],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",107],"]",["T_WHITESPACE"," ",107],".",["T_WHITESPACE"," ",107],["T_VARIABLE","$release_data",107],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",107],"]",";",["T_WHITESPACE","\n\n\t\t\t",107],["T_VARIABLE","$release_data",109],"[",["T_CONSTANT_ENCAPSED_STRING","\"TAMPER_PROOF_SEAL\"",109],"]",["T_WHITESPACE"," ",109],"=",["T_WHITESPACE"," ",109],["T_STRING","md5",109],"(",["T_VARIABLE","$tamper_proof_data",109],")",";",["T_WHITESPACE","\n\n\t\t\t",109],["T_VARIABLE","$response_data",111],["T_WHITESPACE"," ",111],"=",["T_WHITESPACE"," ",111],["T_VARIABLE","$this",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","sendCurl",111],"(",["T_CONSTANT_ENCAPSED_STRING","'https:\/\/secure.bluepay.com\/interfaces\/bp10emu'",111],",",["T_WHITESPACE"," ",111],["T_VARIABLE","$release_data",111],")",";",["T_WHITESPACE","\n\n\t\t\t",111],["T_RETURN","return",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$response_data",113],";",["T_WHITESPACE","\n\t\t",113],"}",["T_WHITESPACE"," ",114],["T_ELSE","else",114],["T_WHITESPACE"," ",114],"{",["T_WHITESPACE","\n\t\t\t",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_STRING","false",115],";",["T_WHITESPACE","\n\t\t",115],"}",["T_WHITESPACE","\n\t",116],"}",["T_WHITESPACE","\n\n\t",117],["T_PUBLIC","public",119],["T_WHITESPACE"," ",119],["T_FUNCTION","function",119],["T_WHITESPACE"," ",119],["T_STRING","updateReleaseStatus",119],"(",["T_VARIABLE","$bluepay_hosted_order_id",119],",",["T_WHITESPACE"," ",119],["T_VARIABLE","$status",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n\t\t",119],["T_VARIABLE","$this",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","db",120],["T_OBJECT_OPERATOR","->",120],["T_STRING","query",120],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_STRING","DB_PREFIX",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order` SET `release_status` = '\"",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_INT_CAST","(int)",120],["T_VARIABLE","$status",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_hosted_order_id` = '\"",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_INT_CAST","(int)",120],["T_VARIABLE","$bluepay_hosted_order_id",120],["T_WHITESPACE"," ",120],".",["T_WHITESPACE"," ",120],["T_CONSTANT_ENCAPSED_STRING","\"'\"",120],")",";",["T_WHITESPACE","\n\t",120],"}",["T_WHITESPACE","\n\n\t",121],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","rebate",123],"(",["T_VARIABLE","$order_id",123],",",["T_WHITESPACE"," ",123],["T_VARIABLE","$amount",123],")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n\t\t",123],["T_VARIABLE","$bluepay_hosted_order",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","getOrder",124],"(",["T_VARIABLE","$order_id",124],")",";",["T_WHITESPACE","\n\n\t\t",124],["T_IF","if",126],["T_WHITESPACE"," ",126],"(","!",["T_EMPTY","empty",126],"(",["T_VARIABLE","$bluepay_hosted_order",126],")",["T_WHITESPACE"," ",126],["T_BOOLEAN_AND","&&",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$bluepay_hosted_order",126],"[",["T_CONSTANT_ENCAPSED_STRING","'rebate_status'",126],"]",["T_WHITESPACE"," ",126],["T_IS_NOT_EQUAL","!=",126],["T_WHITESPACE"," ",126],["T_LNUMBER","1",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n\t\t\t",126],["T_VARIABLE","$rebate_data",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_ARRAY","array",127],"(",")",";",["T_WHITESPACE","\n\n\t\t\t",127],["T_VARIABLE","$rebate_data",129],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",129],"]",["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","config",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","get",129],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_account_id'",129],")",";",["T_WHITESPACE","\n\t\t\t",129],["T_VARIABLE","$rebate_data",130],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",130],"]",["T_WHITESPACE"," ",130],"=",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","'REFUND'",130],";",["T_WHITESPACE","\n\t\t\t",130],["T_VARIABLE","$rebate_data",131],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",131],"]",["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_STRING","strtoupper",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","config",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","get",131],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_test'",131],")",")",";",["T_WHITESPACE","\n\t\t\t",131],["T_VARIABLE","$rebate_data",132],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",132],"]",["T_WHITESPACE"," ",132],"=",["T_WHITESPACE"," ",132],["T_VARIABLE","$bluepay_hosted_order",132],"[",["T_CONSTANT_ENCAPSED_STRING","'transaction_id'",132],"]",";",["T_WHITESPACE","\n\t\t\t",132],["T_VARIABLE","$rebate_data",133],"[",["T_CONSTANT_ENCAPSED_STRING","\"AMOUNT\"",133],"]",["T_WHITESPACE"," ",133],"=",["T_WHITESPACE"," ",133],["T_VARIABLE","$amount",133],";",["T_WHITESPACE","\n\t\t\t",133],["T_VARIABLE","$rebate_data",134],"[",["T_CONSTANT_ENCAPSED_STRING","'APPROVED_URL'",134],"]",["T_WHITESPACE"," ",134],"=",["T_WHITESPACE"," ",134],["T_STRING","HTTP_CATALOG",134],["T_WHITESPACE"," ",134],".",["T_WHITESPACE"," ",134],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",134],";",["T_WHITESPACE","\n\t\t\t",134],["T_VARIABLE","$rebate_data",135],"[",["T_CONSTANT_ENCAPSED_STRING","'DECLINED_URL'",135],"]",["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],["T_STRING","HTTP_CATALOG",135],["T_WHITESPACE"," ",135],".",["T_WHITESPACE"," ",135],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",135],";",["T_WHITESPACE","\n\t\t\t",135],["T_VARIABLE","$rebate_data",136],"[",["T_CONSTANT_ENCAPSED_STRING","'MISSING_URL'",136],"]",["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","HTTP_CATALOG",136],["T_WHITESPACE"," ",136],".",["T_WHITESPACE"," ",136],["T_CONSTANT_ENCAPSED_STRING","'index.php?route=extension\/payment\/bluepay_hosted\/adminCallback'",136],";",["T_WHITESPACE","\n\n\t\t\t",136],["T_IF","if",138],["T_WHITESPACE"," ",138],"(",["T_ISSET","isset",138],"(",["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","request",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","server",138],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",138],"]",")",")",["T_WHITESPACE"," ",138],"{",["T_WHITESPACE","\n\t\t\t\t",138],["T_VARIABLE","$rebate_data",139],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_IP\"",139],"]",["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","request",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","server",139],"[",["T_CONSTANT_ENCAPSED_STRING","\"REMOTE_ADDR\"",139],"]",";",["T_WHITESPACE","\n\t\t\t",139],"}",["T_WHITESPACE","\n\n\t\t\t",140],["T_VARIABLE","$tamper_proof_data",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","config",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","get",142],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_secret_key'",142],")",["T_WHITESPACE"," ",142],".",["T_WHITESPACE"," ",142],["T_VARIABLE","$rebate_data",142],"[",["T_CONSTANT_ENCAPSED_STRING","'MERCHANT'",142],"]",["T_WHITESPACE"," ",142],".",["T_WHITESPACE"," ",142],["T_VARIABLE","$rebate_data",142],"[",["T_CONSTANT_ENCAPSED_STRING","\"TRANSACTION_TYPE\"",142],"]",["T_WHITESPACE"," ",142],".",["T_WHITESPACE"," ",142],["T_VARIABLE","$rebate_data",142],"[",["T_CONSTANT_ENCAPSED_STRING","'AMOUNT'",142],"]",["T_WHITESPACE"," ",142],".",["T_WHITESPACE"," ",142],["T_VARIABLE","$rebate_data",142],"[",["T_CONSTANT_ENCAPSED_STRING","\"RRNO\"",142],"]",["T_WHITESPACE"," ",142],".",["T_WHITESPACE"," ",142],["T_VARIABLE","$rebate_data",142],"[",["T_CONSTANT_ENCAPSED_STRING","\"MODE\"",142],"]",";",["T_WHITESPACE","\n\n\t\t\t",142],["T_VARIABLE","$rebate_data",144],"[",["T_CONSTANT_ENCAPSED_STRING","\"TAMPER_PROOF_SEAL\"",144],"]",["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","md5",144],"(",["T_VARIABLE","$tamper_proof_data",144],")",";",["T_WHITESPACE","\n\n\t\t\t",144],["T_VARIABLE","$response_data",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_VARIABLE","$this",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","sendCurl",146],"(",["T_CONSTANT_ENCAPSED_STRING","'https:\/\/secure.bluepay.com\/interfaces\/bp10emu'",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$rebate_data",146],")",";",["T_WHITESPACE","\n\n\t\t\t",146],["T_RETURN","return",148],["T_WHITESPACE"," ",148],["T_VARIABLE","$response_data",148],";",["T_WHITESPACE","\n\t\t",148],"}",["T_WHITESPACE"," ",149],["T_ELSE","else",149],["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n\t\t\t",149],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_STRING","false",150],";",["T_WHITESPACE","\n\t\t",150],"}",["T_WHITESPACE","\n\t",151],"}",["T_WHITESPACE","\n\n\t",152],["T_PUBLIC","public",154],["T_WHITESPACE"," ",154],["T_FUNCTION","function",154],["T_WHITESPACE"," ",154],["T_STRING","updateRebateStatus",154],"(",["T_VARIABLE","$bluepay_hosted_order_id",154],",",["T_WHITESPACE"," ",154],["T_VARIABLE","$status",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n\t\t",154],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","db",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","query",155],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_STRING","DB_PREFIX",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order` SET `rebate_status` = '\"",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_INT_CAST","(int)",155],["T_VARIABLE","$status",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_hosted_order_id` = '\"",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_INT_CAST","(int)",155],["T_VARIABLE","$bluepay_hosted_order_id",155],["T_WHITESPACE"," ",155],".",["T_WHITESPACE"," ",155],["T_CONSTANT_ENCAPSED_STRING","\"'\"",155],")",";",["T_WHITESPACE","\n\t",155],"}",["T_WHITESPACE","\n\n\t",156],["T_PUBLIC","public",158],["T_WHITESPACE"," ",158],["T_FUNCTION","function",158],["T_WHITESPACE"," ",158],["T_STRING","updateTransactionId",158],"(",["T_VARIABLE","$bluepay_hosted_order_id",158],",",["T_WHITESPACE"," ",158],["T_VARIABLE","$transaction_id",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n\t\t",158],["T_VARIABLE","$this",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","db",159],["T_OBJECT_OPERATOR","->",159],["T_STRING","query",159],"(",["T_CONSTANT_ENCAPSED_STRING","\"UPDATE `\"",159],["T_WHITESPACE"," ",159],".",["T_WHITESPACE"," ",159],["T_STRING","DB_PREFIX",159],["T_WHITESPACE"," ",159],".",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order` SET `transaction_id` = '\"",159],["T_WHITESPACE"," ",159],".",["T_WHITESPACE"," ",159],["T_INT_CAST","(int)",159],["T_VARIABLE","$transaction_id",159],["T_WHITESPACE"," ",159],".",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","\"' WHERE `bluepay_hosted_order_id` = '\"",159],["T_WHITESPACE"," ",159],".",["T_WHITESPACE"," ",159],["T_INT_CAST","(int)",159],["T_VARIABLE","$bluepay_hosted_order_id",159],["T_WHITESPACE"," ",159],".",["T_WHITESPACE"," ",159],["T_CONSTANT_ENCAPSED_STRING","\"'\"",159],")",";",["T_WHITESPACE","\n\t",159],"}",["T_WHITESPACE","\n\n\t",160],["T_PUBLIC","public",162],["T_WHITESPACE"," ",162],["T_FUNCTION","function",162],["T_WHITESPACE"," ",162],["T_STRING","getOrder",162],"(",["T_VARIABLE","$order_id",162],")",["T_WHITESPACE"," ",162],"{",["T_WHITESPACE","\n\n\t\t",162],["T_VARIABLE","$qry",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","db",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","query",164],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",164],["T_WHITESPACE"," ",164],".",["T_WHITESPACE"," ",164],["T_STRING","DB_PREFIX",164],["T_WHITESPACE"," ",164],".",["T_WHITESPACE"," ",164],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order` WHERE `order_id` = '\"",164],["T_WHITESPACE"," ",164],".",["T_WHITESPACE"," ",164],["T_INT_CAST","(int)",164],["T_VARIABLE","$order_id",164],["T_WHITESPACE"," ",164],".",["T_WHITESPACE"," ",164],["T_CONSTANT_ENCAPSED_STRING","\"' LIMIT 1\"",164],")",";",["T_WHITESPACE","\n\n\t\t",164],["T_IF","if",166],["T_WHITESPACE"," ",166],"(",["T_VARIABLE","$qry",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","num_rows",166],")",["T_WHITESPACE"," ",166],"{",["T_WHITESPACE","\n\t\t\t",166],["T_VARIABLE","$order",167],["T_WHITESPACE"," ",167],"=",["T_WHITESPACE"," ",167],["T_VARIABLE","$qry",167],["T_OBJECT_OPERATOR","->",167],["T_STRING","row",167],";",["T_WHITESPACE","\n\t\t\t",167],["T_VARIABLE","$order",168],"[",["T_CONSTANT_ENCAPSED_STRING","'transactions'",168],"]",["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getTransactions",168],"(",["T_VARIABLE","$order",168],"[",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_order_id'",168],"]",")",";",["T_WHITESPACE","\n\n\t\t\t",168],["T_RETURN","return",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$order",170],";",["T_WHITESPACE","\n\t\t",170],"}",["T_WHITESPACE"," ",171],["T_ELSE","else",171],["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n\t\t\t",171],["T_RETURN","return",172],["T_WHITESPACE"," ",172],["T_STRING","false",172],";",["T_WHITESPACE","\n\t\t",172],"}",["T_WHITESPACE","\n\t",173],"}",["T_WHITESPACE","\n\n\t",174],["T_PRIVATE","private",176],["T_WHITESPACE"," ",176],["T_FUNCTION","function",176],["T_WHITESPACE"," ",176],["T_STRING","getTransactions",176],"(",["T_VARIABLE","$bluepay_hosted_order_id",176],")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n\t\t",176],["T_VARIABLE","$qry",177],["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","db",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","query",177],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",177],["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_STRING","DB_PREFIX",177],["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order_transaction` WHERE `bluepay_hosted_order_id` = '\"",177],["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_INT_CAST","(int)",177],["T_VARIABLE","$bluepay_hosted_order_id",177],["T_WHITESPACE"," ",177],".",["T_WHITESPACE"," ",177],["T_CONSTANT_ENCAPSED_STRING","\"'\"",177],")",";",["T_WHITESPACE","\n\n\t\t",177],["T_IF","if",179],["T_WHITESPACE"," ",179],"(",["T_VARIABLE","$qry",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","num_rows",179],")",["T_WHITESPACE"," ",179],"{",["T_WHITESPACE","\n\t\t\t",179],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$qry",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","rows",180],";",["T_WHITESPACE","\n\t\t",180],"}",["T_WHITESPACE"," ",181],["T_ELSE","else",181],["T_WHITESPACE"," ",181],"{",["T_WHITESPACE","\n\t\t\t",181],["T_RETURN","return",182],["T_WHITESPACE"," ",182],["T_STRING","false",182],";",["T_WHITESPACE","\n\t\t",182],"}",["T_WHITESPACE","\n\t",183],"}",["T_WHITESPACE","\n\n\t",184],["T_PUBLIC","public",186],["T_WHITESPACE"," ",186],["T_FUNCTION","function",186],["T_WHITESPACE"," ",186],["T_STRING","addTransaction",186],"(",["T_VARIABLE","$bluepay_hosted_order_id",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$type",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$total",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n\t\t",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","logger",187],"(",["T_CONSTANT_ENCAPSED_STRING","'$type:\\r\\n'",187],["T_WHITESPACE"," ",187],".",["T_WHITESPACE"," ",187],["T_STRING","print_r",187],"(",["T_VARIABLE","$type",187],",",["T_WHITESPACE"," ",187],["T_LNUMBER","1",187],")",")",";",["T_WHITESPACE","\n\t\t",187],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","logger",188],"(",["T_CONSTANT_ENCAPSED_STRING","'$total:\\r\\n'",188],["T_WHITESPACE"," ",188],".",["T_WHITESPACE"," ",188],["T_STRING","print_r",188],"(",["T_VARIABLE","$total",188],",",["T_WHITESPACE"," ",188],["T_LNUMBER","1",188],")",")",";",["T_WHITESPACE","\n\t\t",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","db",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","query",189],"(",["T_CONSTANT_ENCAPSED_STRING","\"INSERT INTO `\"",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_STRING","DB_PREFIX",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order_transaction` SET `bluepay_hosted_order_id` = '\"",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_INT_CAST","(int)",189],["T_VARIABLE","$bluepay_hosted_order_id",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","\"', `date_added` = now(), `type` = '\"",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","db",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","escape",189],"(",["T_VARIABLE","$type",189],")",["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","\"', `amount` = '\"",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_DOUBLE_CAST","(float)",189],["T_VARIABLE","$total",189],["T_WHITESPACE"," ",189],".",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","\"'\"",189],")",";",["T_WHITESPACE","\n\t",189],"}",["T_WHITESPACE","\n\n\t",190],["T_PUBLIC","public",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","getTotalReleased",192],"(",["T_VARIABLE","$bluepay_hosted_order_id",192],")",["T_WHITESPACE"," ",192],"{",["T_WHITESPACE","\n\t\t",192],["T_VARIABLE","$query",193],["T_WHITESPACE"," ",193],"=",["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","db",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","query",193],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_STRING","DB_PREFIX",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order_transaction` WHERE `bluepay_hosted_order_id` = '\"",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_INT_CAST","(int)",193],["T_VARIABLE","$bluepay_hosted_order_id",193],["T_WHITESPACE"," ",193],".",["T_WHITESPACE"," ",193],["T_CONSTANT_ENCAPSED_STRING","\"' AND (`type` = 'payment' OR `type` = 'rebate')\"",193],")",";",["T_WHITESPACE","\n\n\t\t",193],["T_RETURN","return",195],["T_WHITESPACE"," ",195],["T_DOUBLE_CAST","(float)",195],["T_VARIABLE","$query",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","row",195],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",195],"]",";",["T_WHITESPACE","\n\t",195],"}",["T_WHITESPACE","\n\n\t",196],["T_PUBLIC","public",198],["T_WHITESPACE"," ",198],["T_FUNCTION","function",198],["T_WHITESPACE"," ",198],["T_STRING","getTotalRebated",198],"(",["T_VARIABLE","$bluepay_hosted_order_id",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n\t\t",198],["T_VARIABLE","$query",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_VARIABLE","$this",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","db",199],["T_OBJECT_OPERATOR","->",199],["T_STRING","query",199],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT SUM(`amount`) AS `total` FROM `\"",199],["T_WHITESPACE"," ",199],".",["T_WHITESPACE"," ",199],["T_STRING","DB_PREFIX",199],["T_WHITESPACE"," ",199],".",["T_WHITESPACE"," ",199],["T_CONSTANT_ENCAPSED_STRING","\"bluepay_hosted_order_transaction` WHERE `bluepay_hosted_order_id` = '\"",199],["T_WHITESPACE"," ",199],".",["T_WHITESPACE"," ",199],["T_INT_CAST","(int)",199],["T_VARIABLE","$bluepay_hosted_order_id",199],["T_WHITESPACE"," ",199],".",["T_WHITESPACE"," ",199],["T_CONSTANT_ENCAPSED_STRING","\"' AND 'rebate'\"",199],")",";",["T_WHITESPACE","\n\n\t\t",199],["T_RETURN","return",201],["T_WHITESPACE"," ",201],["T_DOUBLE_CAST","(float)",201],["T_VARIABLE","$query",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","row",201],"[",["T_CONSTANT_ENCAPSED_STRING","'total'",201],"]",";",["T_WHITESPACE","\n\t",201],"}",["T_WHITESPACE","\n\n\t",202],["T_PUBLIC","public",204],["T_WHITESPACE"," ",204],["T_FUNCTION","function",204],["T_WHITESPACE"," ",204],["T_STRING","sendCurl",204],"(",["T_VARIABLE","$url",204],",",["T_WHITESPACE"," ",204],["T_VARIABLE","$post_data",204],")",["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n\t\t",204],["T_VARIABLE","$curl",205],["T_WHITESPACE"," ",205],"=",["T_WHITESPACE"," ",205],["T_STRING","curl_init",205],"(",["T_VARIABLE","$url",205],")",";",["T_WHITESPACE","\n\n\t\t",205],["T_STRING","curl_setopt",207],"(",["T_VARIABLE","$curl",207],",",["T_WHITESPACE"," ",207],["T_STRING","CURLOPT_PORT",207],",",["T_WHITESPACE"," ",207],["T_LNUMBER","443",207],")",";",["T_WHITESPACE","\n\t\t",207],["T_STRING","curl_setopt",208],"(",["T_VARIABLE","$curl",208],",",["T_WHITESPACE"," ",208],["T_STRING","CURLOPT_HEADER",208],",",["T_WHITESPACE"," ",208],["T_LNUMBER","0",208],")",";",["T_WHITESPACE","\n\t\t",208],["T_STRING","curl_setopt",209],"(",["T_VARIABLE","$curl",209],",",["T_WHITESPACE"," ",209],["T_STRING","CURLOPT_SSL_VERIFYPEER",209],",",["T_WHITESPACE"," ",209],["T_LNUMBER","0",209],")",";",["T_WHITESPACE","\n\t\t",209],["T_STRING","curl_setopt",210],"(",["T_VARIABLE","$curl",210],",",["T_WHITESPACE"," ",210],["T_STRING","CURLOPT_RETURNTRANSFER",210],",",["T_WHITESPACE"," ",210],["T_LNUMBER","1",210],")",";",["T_WHITESPACE","\n\t\t",210],["T_STRING","curl_setopt",211],"(",["T_VARIABLE","$curl",211],",",["T_WHITESPACE"," ",211],["T_STRING","CURLOPT_FOLLOWLOCATION",211],",",["T_WHITESPACE"," ",211],["T_STRING","true",211],")",";",["T_WHITESPACE","\n\t\t",211],["T_STRING","curl_setopt",212],"(",["T_VARIABLE","$curl",212],",",["T_WHITESPACE"," ",212],["T_STRING","CURLOPT_FORBID_REUSE",212],",",["T_WHITESPACE"," ",212],["T_LNUMBER","1",212],")",";",["T_WHITESPACE","\n\t\t",212],["T_STRING","curl_setopt",213],"(",["T_VARIABLE","$curl",213],",",["T_WHITESPACE"," ",213],["T_STRING","CURLOPT_FRESH_CONNECT",213],",",["T_WHITESPACE"," ",213],["T_LNUMBER","1",213],")",";",["T_WHITESPACE","\n\t\t",213],["T_STRING","curl_setopt",214],"(",["T_VARIABLE","$curl",214],",",["T_WHITESPACE"," ",214],["T_STRING","CURLOPT_POST",214],",",["T_WHITESPACE"," ",214],["T_LNUMBER","1",214],")",";",["T_WHITESPACE","\n\t\t",214],["T_STRING","curl_setopt",215],"(",["T_VARIABLE","$curl",215],",",["T_WHITESPACE"," ",215],["T_STRING","CURLOPT_POSTFIELDS",215],",",["T_WHITESPACE"," ",215],["T_STRING","http_build_query",215],"(",["T_VARIABLE","$post_data",215],")",")",";",["T_WHITESPACE","\n\n\t\t",215],["T_VARIABLE","$response_data",217],["T_WHITESPACE"," ",217],"=",["T_WHITESPACE"," ",217],["T_STRING","curl_exec",217],"(",["T_VARIABLE","$curl",217],")",";",["T_WHITESPACE","\n\n\t\t",217],["T_STRING","curl_close",219],"(",["T_VARIABLE","$curl",219],")",";",["T_WHITESPACE","\n\n\t\t",219],["T_RETURN","return",221],["T_WHITESPACE"," ",221],["T_STRING","json_decode",221],"(",["T_VARIABLE","$response_data",221],",",["T_WHITESPACE"," ",221],["T_STRING","true",221],")",";",["T_WHITESPACE","\n\t",221],"}",["T_WHITESPACE","\n\n\t",222],["T_PUBLIC","public",224],["T_WHITESPACE"," ",224],["T_FUNCTION","function",224],["T_WHITESPACE"," ",224],["T_STRING","adminCallback",224],"(",")",["T_WHITESPACE"," ",224],"{",["T_WHITESPACE","\n\t\t",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","response",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","addHeader",225],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Type: application\/json'",225],")",";",["T_WHITESPACE","\n\t\t",225],["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","response",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","setOutput",226],"(",["T_STRING","json_encode",226],"(",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","request",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","get",226],")",")",";",["T_WHITESPACE","\n\t",226],"}",["T_WHITESPACE","\n\n\t",227],["T_PUBLIC","public",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","logger",229],"(",["T_VARIABLE","$message",229],")",["T_WHITESPACE"," ",229],"{",["T_WHITESPACE","\n\t\t",229],["T_IF","if",230],["T_WHITESPACE"," ",230],"(",["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","config",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","get",230],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted_debug'",230],")",["T_WHITESPACE"," ",230],["T_IS_EQUAL","==",230],["T_WHITESPACE"," ",230],["T_LNUMBER","1",230],")",["T_WHITESPACE"," ",230],"{",["T_WHITESPACE","\n\t\t\t",230],["T_VARIABLE","$log",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_NEW","new",231],["T_WHITESPACE"," ",231],["T_STRING","Log",231],"(",["T_CONSTANT_ENCAPSED_STRING","'bluepay_hosted.log'",231],")",";",["T_WHITESPACE","\n\t\t\t",231],["T_VARIABLE","$log",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","write",232],"(",["T_VARIABLE","$message",232],")",";",["T_WHITESPACE","\n\t\t",232],"}",["T_WHITESPACE","\n\t",233],"}",["T_WHITESPACE","\n",234],"}"]