[["T_OPEN_TAG","<?php\n",1],["T_CLASS","class",2],["T_WHITESPACE"," ",2],["T_STRING","ModelExtensionPaymentDivido",2],["T_WHITESPACE"," ",2],["T_EXTENDS","extends",2],["T_WHITESPACE"," ",2],["T_STRING","Model",2],["T_WHITESPACE"," ",2],"{",["T_WHITESPACE","\n\t",2],["T_CONST","const",3],["T_WHITESPACE"," ",3],["T_STRING","CACHE_KEY_PLANS",3],["T_WHITESPACE"," ",3],"=",["T_WHITESPACE"," ",3],["T_CONSTANT_ENCAPSED_STRING","'divido_plans'",3],";",["T_WHITESPACE","\n\n\t",3],["T_PUBLIC","public",5],["T_WHITESPACE"," ",5],["T_FUNCTION","function",5],["T_WHITESPACE"," ",5],["T_STRING","getAllPlans",5],"(",")",["T_WHITESPACE"," ",5],"{",["T_WHITESPACE","\n\t\t",5],["T_IF","if",6],["T_WHITESPACE"," ",6],"(",["T_VARIABLE","$plans",6],["T_WHITESPACE"," ",6],"=",["T_WHITESPACE"," ",6],["T_VARIABLE","$this",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","cache",6],["T_OBJECT_OPERATOR","->",6],["T_STRING","get",6],"(",["T_STRING","self",6],["T_DOUBLE_COLON","::",6],["T_STRING","CACHE_KEY_PLANS",6],")",")",["T_WHITESPACE"," ",6],"{",["T_WHITESPACE","\n\t\t\t",6],["T_COMMENT","\/\/ OpenCart 2.1 decodes json objects to associative arrays so we\n",7],["T_WHITESPACE","\t\t\t",8],["T_COMMENT","\/\/ need to make sure we're getting a list of simple objects back.\n",8],["T_WHITESPACE","\t\t\t",9],["T_VARIABLE","$plans",9],["T_WHITESPACE"," ",9],"=",["T_WHITESPACE"," ",9],["T_STRING","array_map",9],"(",["T_FUNCTION","function",9],["T_WHITESPACE"," ",9],"(",["T_VARIABLE","$plan",9],")",["T_WHITESPACE"," ",9],"{",["T_WHITESPACE","\n\t\t\t\t",9],["T_RETURN","return",10],["T_WHITESPACE"," ",10],["T_OBJECT_CAST","(object)",10],["T_VARIABLE","$plan",10],";",["T_WHITESPACE","\n\t\t\t",10],"}",",",["T_WHITESPACE"," ",11],["T_VARIABLE","$plans",11],")",";",["T_WHITESPACE","\n\n\t\t\t",11],["T_RETURN","return",13],["T_WHITESPACE"," ",13],["T_VARIABLE","$plans",13],";",["T_WHITESPACE","\n\t\t",13],"}",["T_WHITESPACE","\n\n\t\t",14],["T_VARIABLE","$api_key",16],["T_WHITESPACE"," ",16],"=",["T_WHITESPACE"," ",16],["T_VARIABLE","$this",16],["T_OBJECT_OPERATOR","->",16],["T_STRING","config",16],["T_OBJECT_OPERATOR","->",16],["T_STRING","get",16],"(",["T_CONSTANT_ENCAPSED_STRING","'divido_api_key'",16],")",";",["T_WHITESPACE","\n\t\t",16],["T_IF","if",17],["T_WHITESPACE"," ",17],"(","!",["T_VARIABLE","$api_key",17],")",["T_WHITESPACE"," ",17],"{",["T_WHITESPACE","\n\t\t\t",17],["T_THROW","throw",18],["T_WHITESPACE"," ",18],["T_NEW","new",18],["T_WHITESPACE"," ",18],["T_STRING","Exception",18],"(",["T_CONSTANT_ENCAPSED_STRING","\"No Divido api-key defined\"",18],")",";",["T_WHITESPACE","\n\t\t",18],"}",["T_WHITESPACE","\n\n\t\t",19],["T_STRING","Divido",21],["T_DOUBLE_COLON","::",21],["T_STRING","setMerchant",21],"(",["T_VARIABLE","$api_key",21],")",";",["T_WHITESPACE","\n\n\t\t",21],["T_VARIABLE","$response",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],["T_STRING","Divido_Finances",23],["T_DOUBLE_COLON","::",23],["T_STRING","all",23],"(",")",";",["T_WHITESPACE","\n\t\t",23],["T_IF","if",24],["T_WHITESPACE"," ",24],"(",["T_VARIABLE","$response",24],["T_OBJECT_OPERATOR","->",24],["T_STRING","status",24],["T_WHITESPACE"," ",24],["T_IS_NOT_EQUAL","!=",24],["T_WHITESPACE"," ",24],["T_CONSTANT_ENCAPSED_STRING","'ok'",24],")",["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n\t\t\t",24],["T_THROW","throw",25],["T_WHITESPACE"," ",25],["T_NEW","new",25],["T_WHITESPACE"," ",25],["T_STRING","Exception",25],"(",["T_CONSTANT_ENCAPSED_STRING","\"Can't get list of finance plans from Divido!\"",25],")",";",["T_WHITESPACE","\n\t\t",25],"}",["T_WHITESPACE","\n\n\t\t",26],["T_VARIABLE","$plans",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_VARIABLE","$response",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","finances",28],";",["T_WHITESPACE","\n\n\t\t",28],["T_COMMENT","\/\/ OpenCart 2.1 switched to json for their file storage cache, so\n",30],["T_WHITESPACE","\t\t",31],["T_COMMENT","\/\/ we need to convert to a simple object.\n",31],["T_WHITESPACE","\t\t",32],["T_VARIABLE","$plans_plain",32],["T_WHITESPACE"," ",32],"=",["T_WHITESPACE"," ",32],["T_ARRAY","array",32],"(",")",";",["T_WHITESPACE","\n\t\t",32],["T_FOREACH","foreach",33],["T_WHITESPACE"," ",33],"(",["T_VARIABLE","$plans",33],["T_WHITESPACE"," ",33],["T_AS","as",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$plan",33],")",["T_WHITESPACE"," ",33],"{",["T_WHITESPACE","\n\t\t\t",33],["T_VARIABLE","$plan_copy",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_NEW","new",34],["T_WHITESPACE"," ",34],["T_STRING","stdClass",34],"(",")",";",["T_WHITESPACE","\n\t\t\t",34],["T_VARIABLE","$plan_copy",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","id",35],["T_WHITESPACE","                 ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$plan",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","id",35],";",["T_WHITESPACE","\n\t\t\t",35],["T_VARIABLE","$plan_copy",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","text",36],["T_WHITESPACE","               ",36],"=",["T_WHITESPACE"," ",36],["T_VARIABLE","$plan",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","text",36],";",["T_WHITESPACE","\n\t\t\t",36],["T_VARIABLE","$plan_copy",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","country",37],["T_WHITESPACE","            ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$plan",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","country",37],";",["T_WHITESPACE","\n\t\t\t",37],["T_VARIABLE","$plan_copy",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","min_amount",38],["T_WHITESPACE","         ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$plan",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","min_amount",38],";",["T_WHITESPACE","\n\t\t\t",38],["T_VARIABLE","$plan_copy",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","min_deposit",39],["T_WHITESPACE","        ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$plan",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","min_deposit",39],";",["T_WHITESPACE","\n\t\t\t",39],["T_VARIABLE","$plan_copy",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","max_deposit",40],["T_WHITESPACE","        ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$plan",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","max_deposit",40],";",["T_WHITESPACE","\n\t\t\t",40],["T_VARIABLE","$plan_copy",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","interest_rate",41],["T_WHITESPACE","      ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$plan",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","interest_rate",41],";",["T_WHITESPACE","\n\t\t\t",41],["T_VARIABLE","$plan_copy",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","deferral_period",42],["T_WHITESPACE","    ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$plan",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","deferral_period",42],";",["T_WHITESPACE","\n\t\t\t",42],["T_VARIABLE","$plan_copy",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","agreement_duration",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$plan",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","agreement_duration",43],";",["T_WHITESPACE","\n\n\t\t\t",43],["T_VARIABLE","$plans_plain",45],"[","]",["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_VARIABLE","$plan_copy",45],";",["T_WHITESPACE","\n\t\t",45],"}",["T_WHITESPACE","\n\n\t\t",46],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","cache",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","set",48],"(",["T_STRING","self",48],["T_DOUBLE_COLON","::",48],["T_STRING","CACHE_KEY_PLANS",48],",",["T_WHITESPACE"," ",48],["T_VARIABLE","$plans_plain",48],")",";",["T_WHITESPACE","\n\n\t\t",48],["T_RETURN","return",50],["T_WHITESPACE"," ",50],["T_VARIABLE","$plans_plain",50],";",["T_WHITESPACE","\n\t",50],"}",["T_WHITESPACE","\n\n\t",51],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","getLookupByOrderId",53],"(",["T_VARIABLE","$order_id",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n\t\t",53],["T_RETURN","return",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","db",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","query",54],"(",["T_CONSTANT_ENCAPSED_STRING","\"SELECT * FROM `\"",54],["T_WHITESPACE"," ",54],".",["T_WHITESPACE"," ",54],["T_STRING","DB_PREFIX",54],["T_WHITESPACE"," ",54],".",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","\"divido_lookup` WHERE `order_id` = \"",54],["T_WHITESPACE"," ",54],".",["T_WHITESPACE"," ",54],["T_INT_CAST","(int)",54],["T_VARIABLE","$order_id",54],")",";",["T_WHITESPACE","\n\t",54],"}",["T_WHITESPACE","\n\n\t",55],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_FUNCTION","function",57],["T_WHITESPACE"," ",57],["T_STRING","install",57],"(",")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n\t\t",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","db",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","query",58],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",58],["T_WHITESPACE"," ",59],".",["T_WHITESPACE"," ",59],["T_STRING","DB_PREFIX",59],["T_WHITESPACE"," ",59],".",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","\"divido_product` (\n\t\t\t\t`product_id` INT(11) NOT NULL,\n\t\t\t\t`display` CHAR(7) NOT NULL,\n\t\t\t\t`plans` text,\n\t\t\t\tPRIMARY KEY (`product_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",59],")",";",["T_WHITESPACE","\n\n\t\t",64],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","db",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","query",66],"(",["T_CONSTANT_ENCAPSED_STRING","\"\n\t\t\tCREATE TABLE IF NOT EXISTS `\"",66],["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_STRING","DB_PREFIX",67],["T_WHITESPACE"," ",67],".",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","\"divido_lookup` (\n\t\t\t\t`order_id` INT(11) NOT NULL,\n\t\t\t\t`salt` CHAR(64) NOT NULL,\n\t\t\t\t`proposal_id` CHAR(40),\n\t\t\t\t`application_id` CHAR(40),\n\t\t\t\t`deposit_amount` NUMERIC(6,2),\n\t\t\t  PRIMARY KEY (`order_id`)\n\t\t\t) ENGINE=MyISAM DEFAULT COLLATE=utf8_general_ci;\"",67],")",";",["T_WHITESPACE","\n\t",74],"}",["T_WHITESPACE","\n\n\t",75],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_FUNCTION","function",77],["T_WHITESPACE"," ",77],["T_STRING","uninstall",77],"(",")",["T_WHITESPACE"," ",77],"{",["T_WHITESPACE","\n\t\t",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","db",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","query",78],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",78],["T_WHITESPACE"," ",78],".",["T_WHITESPACE"," ",78],["T_STRING","DB_PREFIX",78],["T_WHITESPACE"," ",78],".",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","\"divido_product`;\"",78],")",";",["T_WHITESPACE","\n\t\t",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","db",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","query",79],"(",["T_CONSTANT_ENCAPSED_STRING","\"DROP TABLE IF EXISTS `\"",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_STRING","DB_PREFIX",79],["T_WHITESPACE"," ",79],".",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","\"divido_lookup`;\"",79],")",";",["T_WHITESPACE","\n\t",79],"}",["T_WHITESPACE","\n",80],"}",["T_WHITESPACE","\n",81]]