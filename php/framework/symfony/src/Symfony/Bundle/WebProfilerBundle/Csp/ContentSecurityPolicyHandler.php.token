[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_COMMENT","\/*\n * This file is part of the Symfony package.\n *\n * (c) Fabien Potencier <fabien@symfony.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n *\/",3],["T_WHITESPACE","\n\n",10],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Symfony",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Bundle",12],["T_NS_SEPARATOR","\\",12],["T_STRING","WebProfilerBundle",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Csp",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Symfony",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Component",14],["T_NS_SEPARATOR","\\",14],["T_STRING","HttpFoundation",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Request",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpFoundation",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Response",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * Handles Content-Security-Policy HTTP header for the WebProfiler Bundle.\n *\n * @author Romain Neutron <imprec@gmail.com>\n *\n * @internal\n *\/",17],["T_WHITESPACE","\n",23],["T_CLASS","class",24],["T_WHITESPACE"," ",24],["T_STRING","ContentSecurityPolicyHandler",24],["T_WHITESPACE","\n",24],"{",["T_WHITESPACE","\n    ",25],["T_PRIVATE","private",26],["T_WHITESPACE"," ",26],["T_VARIABLE","$nonceGenerator",26],";",["T_WHITESPACE","\n    ",26],["T_PRIVATE","private",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$cspDisabled",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_STRING","false",27],";",["T_WHITESPACE","\n\n    ",27],["T_PUBLIC","public",29],["T_WHITESPACE"," ",29],["T_FUNCTION","function",29],["T_WHITESPACE"," ",29],["T_STRING","__construct",29],"(",["T_STRING","NonceGenerator",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$nonceGenerator",29],")",["T_WHITESPACE","\n    ",29],"{",["T_WHITESPACE","\n        ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","nonceGenerator",31],["T_WHITESPACE"," ",31],"=",["T_WHITESPACE"," ",31],["T_VARIABLE","$nonceGenerator",31],";",["T_WHITESPACE","\n    ",31],"}",["T_WHITESPACE","\n\n    ",32],["T_DOC_COMMENT","\/**\n     * Returns an array of nonces to be used in Twig templates and Content-Security-Policy headers.\n     *\n     * Nonce can be provided by;\n     *  - The request - In case HTML content is fetched via AJAX and inserted in DOM, it must use the same nonce as origin\n     *  - The response -  A call to getNonces() has already been done previously. Same nonce are returned\n     *  - They are otherwise randomly generated\n     *\n     * @return array\n     *\/",34],["T_WHITESPACE","\n    ",43],["T_PUBLIC","public",44],["T_WHITESPACE"," ",44],["T_FUNCTION","function",44],["T_WHITESPACE"," ",44],["T_STRING","getNonces",44],"(",["T_STRING","Request",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$request",44],",",["T_WHITESPACE"," ",44],["T_STRING","Response",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$response",44],")",["T_WHITESPACE","\n    ",44],"{",["T_WHITESPACE","\n        ",45],["T_IF","if",46],["T_WHITESPACE"," ",46],"(",["T_VARIABLE","$request",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","headers",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","has",46],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Script-Nonce'",46],")",["T_WHITESPACE"," ",46],["T_BOOLEAN_AND","&&",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$request",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","headers",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","has",46],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Style-Nonce'",46],")",")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n            ",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_ARRAY","array",47],"(",["T_WHITESPACE","\n                ",47],["T_CONSTANT_ENCAPSED_STRING","'csp_script_nonce'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$request",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","headers",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","get",48],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Script-Nonce'",48],")",",",["T_WHITESPACE","\n                ",48],["T_CONSTANT_ENCAPSED_STRING","'csp_style_nonce'",49],["T_WHITESPACE"," ",49],["T_DOUBLE_ARROW","=>",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$request",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","headers",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","get",49],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Style-Nonce'",49],")",",",["T_WHITESPACE","\n            ",49],")",";",["T_WHITESPACE","\n        ",50],"}",["T_WHITESPACE","\n\n        ",51],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$response",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","headers",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","has",53],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Script-Nonce'",53],")",["T_WHITESPACE"," ",53],["T_BOOLEAN_AND","&&",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$response",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","headers",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","has",53],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Style-Nonce'",53],")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_RETURN","return",54],["T_WHITESPACE"," ",54],["T_ARRAY","array",54],"(",["T_WHITESPACE","\n                ",54],["T_CONSTANT_ENCAPSED_STRING","'csp_script_nonce'",55],["T_WHITESPACE"," ",55],["T_DOUBLE_ARROW","=>",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$response",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","headers",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","get",55],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Script-Nonce'",55],")",",",["T_WHITESPACE","\n                ",55],["T_CONSTANT_ENCAPSED_STRING","'csp_style_nonce'",56],["T_WHITESPACE"," ",56],["T_DOUBLE_ARROW","=>",56],["T_WHITESPACE"," ",56],["T_VARIABLE","$response",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","headers",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","get",56],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Style-Nonce'",56],")",",",["T_WHITESPACE","\n            ",56],")",";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$nonces",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_ARRAY","array",60],"(",["T_WHITESPACE","\n            ",60],["T_CONSTANT_ENCAPSED_STRING","'csp_script_nonce'",61],["T_WHITESPACE"," ",61],["T_DOUBLE_ARROW","=>",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","generateNonce",61],"(",")",",",["T_WHITESPACE","\n            ",61],["T_CONSTANT_ENCAPSED_STRING","'csp_style_nonce'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","generateNonce",62],"(",")",",",["T_WHITESPACE","\n        ",62],")",";",["T_WHITESPACE","\n\n        ",63],["T_VARIABLE","$response",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","headers",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","set",65],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Script-Nonce'",65],",",["T_WHITESPACE"," ",65],["T_VARIABLE","$nonces",65],"[",["T_CONSTANT_ENCAPSED_STRING","'csp_script_nonce'",65],"]",")",";",["T_WHITESPACE","\n        ",65],["T_VARIABLE","$response",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","headers",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","set",66],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Style-Nonce'",66],",",["T_WHITESPACE"," ",66],["T_VARIABLE","$nonces",66],"[",["T_CONSTANT_ENCAPSED_STRING","'csp_style_nonce'",66],"]",")",";",["T_WHITESPACE","\n\n        ",66],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_VARIABLE","$nonces",68],";",["T_WHITESPACE","\n    ",68],"}",["T_WHITESPACE","\n\n    ",69],["T_DOC_COMMENT","\/**\n     * Disables Content-Security-Policy.\n     *\n     * All related headers will be removed.\n     *\/",71],["T_WHITESPACE","\n    ",75],["T_PUBLIC","public",76],["T_WHITESPACE"," ",76],["T_FUNCTION","function",76],["T_WHITESPACE"," ",76],["T_STRING","disableCsp",76],"(",")",["T_WHITESPACE","\n    ",76],"{",["T_WHITESPACE","\n        ",77],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","cspDisabled",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","true",78],";",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Cleanup temporary headers and updates Content-Security-Policy headers.\n     *\n     * @return array Nonces used by the bundle in Content-Security-Policy header\n     *\/",81],["T_WHITESPACE","\n    ",85],["T_PUBLIC","public",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","updateResponseHeaders",86],"(",["T_STRING","Request",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$request",86],",",["T_WHITESPACE"," ",86],["T_STRING","Response",86],["T_WHITESPACE"," ",86],["T_VARIABLE","$response",86],")",["T_WHITESPACE","\n    ",86],"{",["T_WHITESPACE","\n        ",87],["T_IF","if",88],["T_WHITESPACE"," ",88],"(",["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","cspDisabled",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n            ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","removeCspHeaders",89],"(",["T_VARIABLE","$response",89],")",";",["T_WHITESPACE","\n\n            ",89],["T_RETURN","return",91],["T_WHITESPACE"," ",91],["T_ARRAY","array",91],"(",")",";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n\n        ",92],["T_VARIABLE","$nonces",94],["T_WHITESPACE"," ",94],"=",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getNonces",94],"(",["T_VARIABLE","$request",94],",",["T_WHITESPACE"," ",94],["T_VARIABLE","$response",94],")",";",["T_WHITESPACE","\n        ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","cleanHeaders",95],"(",["T_VARIABLE","$response",95],")",";",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","updateCspHeaders",96],"(",["T_VARIABLE","$response",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$nonces",96],")",";",["T_WHITESPACE","\n\n        ",96],["T_RETURN","return",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$nonces",98],";",["T_WHITESPACE","\n    ",98],"}",["T_WHITESPACE","\n\n    ",99],["T_PRIVATE","private",101],["T_WHITESPACE"," ",101],["T_FUNCTION","function",101],["T_WHITESPACE"," ",101],["T_STRING","cleanHeaders",101],"(",["T_STRING","Response",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$response",101],")",["T_WHITESPACE","\n    ",101],"{",["T_WHITESPACE","\n        ",102],["T_VARIABLE","$response",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","headers",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","remove",103],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Script-Nonce'",103],")",";",["T_WHITESPACE","\n        ",103],["T_VARIABLE","$response",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","headers",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","remove",104],"(",["T_CONSTANT_ENCAPSED_STRING","'X-SymfonyProfiler-Style-Nonce'",104],")",";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_PRIVATE","private",107],["T_WHITESPACE"," ",107],["T_FUNCTION","function",107],["T_WHITESPACE"," ",107],["T_STRING","removeCspHeaders",107],"(",["T_STRING","Response",107],["T_WHITESPACE"," ",107],["T_VARIABLE","$response",107],")",["T_WHITESPACE","\n    ",107],"{",["T_WHITESPACE","\n        ",108],["T_VARIABLE","$response",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","headers",109],["T_OBJECT_OPERATOR","->",109],["T_STRING","remove",109],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Content-Security-Policy'",109],")",";",["T_WHITESPACE","\n        ",109],["T_VARIABLE","$response",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","headers",110],["T_OBJECT_OPERATOR","->",110],["T_STRING","remove",110],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Security-Policy'",110],")",";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_DOC_COMMENT","\/**\n     * Updates Content-Security-Policy headers in a response.\n     *\n     * @return array\n     *\/",113],["T_WHITESPACE","\n    ",117],["T_PRIVATE","private",118],["T_WHITESPACE"," ",118],["T_FUNCTION","function",118],["T_WHITESPACE"," ",118],["T_STRING","updateCspHeaders",118],"(",["T_STRING","Response",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$response",118],",",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$nonces",118],["T_WHITESPACE"," ",118],"=",["T_WHITESPACE"," ",118],["T_ARRAY","array",118],"(",")",")",["T_WHITESPACE","\n    ",118],"{",["T_WHITESPACE","\n        ",119],["T_VARIABLE","$nonces",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","array_replace",120],"(",["T_ARRAY","array",120],"(",["T_WHITESPACE","\n            ",120],["T_CONSTANT_ENCAPSED_STRING","'csp_script_nonce'",121],["T_WHITESPACE"," ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","generateNonce",121],"(",")",",",["T_WHITESPACE","\n            ",121],["T_CONSTANT_ENCAPSED_STRING","'csp_style_nonce'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","generateNonce",122],"(",")",",",["T_WHITESPACE","\n        ",122],")",",",["T_WHITESPACE"," ",123],["T_VARIABLE","$nonces",123],")",";",["T_WHITESPACE","\n\n        ",123],["T_VARIABLE","$ruleIsSet",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","false",125],";",["T_WHITESPACE","\n\n        ",125],["T_VARIABLE","$headers",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$this",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getCspHeaders",127],"(",["T_VARIABLE","$response",127],")",";",["T_WHITESPACE","\n\n        ",127],["T_FOREACH","foreach",129],["T_WHITESPACE"," ",129],"(",["T_VARIABLE","$headers",129],["T_WHITESPACE"," ",129],["T_AS","as",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$header",129],["T_WHITESPACE"," ",129],["T_DOUBLE_ARROW","=>",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$directives",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_FOREACH","foreach",130],["T_WHITESPACE"," ",130],"(",["T_ARRAY","array",130],"(",["T_CONSTANT_ENCAPSED_STRING","'script-src'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","'csp_script_nonce'",130],",",["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","'style-src'",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_CONSTANT_ENCAPSED_STRING","'csp_style_nonce'",130],")",["T_WHITESPACE"," ",130],["T_AS","as",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$type",130],["T_WHITESPACE"," ",130],["T_DOUBLE_ARROW","=>",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$tokenName",130],")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                ",130],["T_IF","if",131],["T_WHITESPACE"," ",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","authorizesInline",131],"(",["T_VARIABLE","$directives",131],",",["T_WHITESPACE"," ",131],["T_VARIABLE","$type",131],")",")",["T_WHITESPACE"," ",131],"{",["T_WHITESPACE","\n                    ",131],["T_CONTINUE","continue",132],";",["T_WHITESPACE","\n                ",132],"}",["T_WHITESPACE","\n                ",133],["T_IF","if",134],["T_WHITESPACE"," ",134],"(","!",["T_ISSET","isset",134],"(",["T_VARIABLE","$headers",134],"[",["T_VARIABLE","$header",134],"]","[",["T_VARIABLE","$type",134],"]",")",")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n                    ",134],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_ISSET","isset",135],"(",["T_VARIABLE","$headers",135],"[",["T_VARIABLE","$header",135],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default-src'",135],"]",")",")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n                        ",135],["T_VARIABLE","$headers",136],"[",["T_VARIABLE","$header",136],"]","[",["T_VARIABLE","$type",136],"]",["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_VARIABLE","$headers",136],"[",["T_VARIABLE","$header",136],"]","[",["T_CONSTANT_ENCAPSED_STRING","'default-src'",136],"]",";",["T_WHITESPACE","\n                    ",136],"}",["T_WHITESPACE"," ",137],["T_ELSE","else",137],["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n                        ",137],["T_COMMENT","\/\/ If there is no script-src\/style-src and no default-src, no additional rules required.\n",138],["T_WHITESPACE","                        ",139],["T_CONTINUE","continue",139],";",["T_WHITESPACE","\n                    ",139],"}",["T_WHITESPACE","\n                ",140],"}",["T_WHITESPACE","\n                ",141],["T_VARIABLE","$ruleIsSet",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","true",142],";",["T_WHITESPACE","\n                ",142],["T_IF","if",143],["T_WHITESPACE"," ",143],"(","!",["T_STRING","in_array",143],"(",["T_CONSTANT_ENCAPSED_STRING","'\\'unsafe-inline\\''",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$headers",143],"[",["T_VARIABLE","$header",143],"]","[",["T_VARIABLE","$type",143],"]",",",["T_WHITESPACE"," ",143],["T_STRING","true",143],")",")",["T_WHITESPACE"," ",143],"{",["T_WHITESPACE","\n                    ",143],["T_VARIABLE","$headers",144],"[",["T_VARIABLE","$header",144],"]","[",["T_VARIABLE","$type",144],"]","[","]",["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_CONSTANT_ENCAPSED_STRING","'\\'unsafe-inline\\''",144],";",["T_WHITESPACE","\n                ",144],"}",["T_WHITESPACE","\n                ",145],["T_VARIABLE","$headers",146],"[",["T_VARIABLE","$header",146],"]","[",["T_VARIABLE","$type",146],"]","[","]",["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_STRING","sprintf",146],"(",["T_CONSTANT_ENCAPSED_STRING","'\\'nonce-%s\\''",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$nonces",146],"[",["T_VARIABLE","$tokenName",146],"]",")",";",["T_WHITESPACE","\n            ",146],"}",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n\n        ",148],["T_IF","if",150],["T_WHITESPACE"," ",150],"(","!",["T_VARIABLE","$ruleIsSet",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_RETURN","return",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$nonces",151],";",["T_WHITESPACE","\n        ",151],"}",["T_WHITESPACE","\n\n        ",152],["T_FOREACH","foreach",154],["T_WHITESPACE"," ",154],"(",["T_VARIABLE","$headers",154],["T_WHITESPACE"," ",154],["T_AS","as",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$header",154],["T_WHITESPACE"," ",154],["T_DOUBLE_ARROW","=>",154],["T_WHITESPACE"," ",154],["T_VARIABLE","$directives",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_VARIABLE","$response",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","headers",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","set",155],"(",["T_VARIABLE","$header",155],",",["T_WHITESPACE"," ",155],["T_VARIABLE","$this",155],["T_OBJECT_OPERATOR","->",155],["T_STRING","generateCspHeader",155],"(",["T_VARIABLE","$directives",155],")",")",";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n\n        ",156],["T_RETURN","return",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$nonces",158],";",["T_WHITESPACE","\n    ",158],"}",["T_WHITESPACE","\n\n    ",159],["T_DOC_COMMENT","\/**\n     * Generates a valid Content-Security-Policy nonce.\n     *\n     * @return string\n     *\/",161],["T_WHITESPACE","\n    ",165],["T_PRIVATE","private",166],["T_WHITESPACE"," ",166],["T_FUNCTION","function",166],["T_WHITESPACE"," ",166],["T_STRING","generateNonce",166],"(",")",["T_WHITESPACE","\n    ",166],"{",["T_WHITESPACE","\n        ",167],["T_RETURN","return",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","nonceGenerator",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","generate",168],"(",")",";",["T_WHITESPACE","\n    ",168],"}",["T_WHITESPACE","\n\n    ",169],["T_DOC_COMMENT","\/**\n     * Converts a directive set array into Content-Security-Policy header.\n     *\n     * @param array $directives The directive set\n     *\n     * @return string The Content-Security-Policy header\n     *\/",171],["T_WHITESPACE","\n    ",177],["T_PRIVATE","private",178],["T_WHITESPACE"," ",178],["T_FUNCTION","function",178],["T_WHITESPACE"," ",178],["T_STRING","generateCspHeader",178],"(",["T_ARRAY","array",178],["T_WHITESPACE"," ",178],["T_VARIABLE","$directives",178],")",["T_WHITESPACE","\n    ",178],"{",["T_WHITESPACE","\n        ",179],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_STRING","array_reduce",180],"(",["T_STRING","array_keys",180],"(",["T_VARIABLE","$directives",180],")",",",["T_WHITESPACE"," ",180],["T_FUNCTION","function",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$res",180],",",["T_WHITESPACE"," ",180],["T_VARIABLE","$name",180],")",["T_WHITESPACE"," ",180],["T_USE","use",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$directives",180],")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_RETURN","return",181],["T_WHITESPACE"," ",181],"(",["T_VARIABLE","$res",181],["T_WHITESPACE"," ",181],["T_IS_NOT_IDENTICAL","!==",181],["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","''",181],["T_WHITESPACE"," ",181],"?",["T_WHITESPACE"," ",181],["T_VARIABLE","$res",181],".",["T_CONSTANT_ENCAPSED_STRING","'; '",181],["T_WHITESPACE"," ",181],":",["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","''",181],")",".",["T_STRING","sprintf",181],"(",["T_CONSTANT_ENCAPSED_STRING","'%s %s'",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$name",181],",",["T_WHITESPACE"," ",181],["T_STRING","implode",181],"(",["T_CONSTANT_ENCAPSED_STRING","' '",181],",",["T_WHITESPACE"," ",181],["T_VARIABLE","$directives",181],"[",["T_VARIABLE","$name",181],"]",")",")",";",["T_WHITESPACE","\n        ",181],"}",",",["T_WHITESPACE"," ",182],["T_CONSTANT_ENCAPSED_STRING","''",182],")",";",["T_WHITESPACE","\n    ",182],"}",["T_WHITESPACE","\n\n    ",183],["T_DOC_COMMENT","\/**\n     * Converts a Content-Security-Policy header value into a directive set array.\n     *\n     * @param string $header The header value\n     *\n     * @return array The directive set\n     *\/",185],["T_WHITESPACE","\n    ",191],["T_PRIVATE","private",192],["T_WHITESPACE"," ",192],["T_FUNCTION","function",192],["T_WHITESPACE"," ",192],["T_STRING","parseDirectives",192],"(",["T_VARIABLE","$header",192],")",["T_WHITESPACE","\n    ",192],"{",["T_WHITESPACE","\n        ",193],["T_VARIABLE","$directives",194],["T_WHITESPACE"," ",194],"=",["T_WHITESPACE"," ",194],["T_ARRAY","array",194],"(",")",";",["T_WHITESPACE","\n\n        ",194],["T_FOREACH","foreach",196],["T_WHITESPACE"," ",196],"(",["T_STRING","explode",196],"(",["T_CONSTANT_ENCAPSED_STRING","';'",196],",",["T_WHITESPACE"," ",196],["T_VARIABLE","$header",196],")",["T_WHITESPACE"," ",196],["T_AS","as",196],["T_WHITESPACE"," ",196],["T_VARIABLE","$directive",196],")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$parts",197],["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_STRING","explode",197],"(",["T_CONSTANT_ENCAPSED_STRING","' '",197],",",["T_WHITESPACE"," ",197],["T_STRING","trim",197],"(",["T_VARIABLE","$directive",197],")",")",";",["T_WHITESPACE","\n            ",197],["T_IF","if",198],["T_WHITESPACE"," ",198],"(",["T_STRING","count",198],"(",["T_VARIABLE","$parts",198],")",["T_WHITESPACE"," ",198],"<",["T_WHITESPACE"," ",198],["T_LNUMBER","1",198],")",["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n                ",198],["T_CONTINUE","continue",199],";",["T_WHITESPACE","\n            ",199],"}",["T_WHITESPACE","\n            ",200],["T_VARIABLE","$name",201],["T_WHITESPACE"," ",201],"=",["T_WHITESPACE"," ",201],["T_STRING","array_shift",201],"(",["T_VARIABLE","$parts",201],")",";",["T_WHITESPACE","\n            ",201],["T_VARIABLE","$directives",202],"[",["T_VARIABLE","$name",202],"]",["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_VARIABLE","$parts",202],";",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n\n        ",203],["T_RETURN","return",205],["T_WHITESPACE"," ",205],["T_VARIABLE","$directives",205],";",["T_WHITESPACE","\n    ",205],"}",["T_WHITESPACE","\n\n    ",206],["T_DOC_COMMENT","\/**\n     * Detects if the 'unsafe-inline' is prevented for a directive within the directive set.\n     *\n     * @param array  $directivesSet The directive set\n     * @param string $type          The name of the directive to check\n     *\n     * @return bool\n     *\/",208],["T_WHITESPACE","\n    ",215],["T_PRIVATE","private",216],["T_WHITESPACE"," ",216],["T_FUNCTION","function",216],["T_WHITESPACE"," ",216],["T_STRING","authorizesInline",216],"(",["T_ARRAY","array",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$directivesSet",216],",",["T_WHITESPACE"," ",216],["T_VARIABLE","$type",216],")",["T_WHITESPACE","\n    ",216],"{",["T_WHITESPACE","\n        ",217],["T_IF","if",218],["T_WHITESPACE"," ",218],"(",["T_ISSET","isset",218],"(",["T_VARIABLE","$directivesSet",218],"[",["T_VARIABLE","$type",218],"]",")",")",["T_WHITESPACE"," ",218],"{",["T_WHITESPACE","\n            ",218],["T_VARIABLE","$directives",219],["T_WHITESPACE"," ",219],"=",["T_WHITESPACE"," ",219],["T_VARIABLE","$directivesSet",219],"[",["T_VARIABLE","$type",219],"]",";",["T_WHITESPACE","\n        ",219],"}",["T_WHITESPACE"," ",220],["T_ELSEIF","elseif",220],["T_WHITESPACE"," ",220],"(",["T_ISSET","isset",220],"(",["T_VARIABLE","$directivesSet",220],"[",["T_CONSTANT_ENCAPSED_STRING","'default-src'",220],"]",")",")",["T_WHITESPACE"," ",220],"{",["T_WHITESPACE","\n            ",220],["T_VARIABLE","$directives",221],["T_WHITESPACE"," ",221],"=",["T_WHITESPACE"," ",221],["T_VARIABLE","$directivesSet",221],"[",["T_CONSTANT_ENCAPSED_STRING","'default-src'",221],"]",";",["T_WHITESPACE","\n        ",221],"}",["T_WHITESPACE"," ",222],["T_ELSE","else",222],["T_WHITESPACE"," ",222],"{",["T_WHITESPACE","\n            ",222],["T_RETURN","return",223],["T_WHITESPACE"," ",223],["T_STRING","false",223],";",["T_WHITESPACE","\n        ",223],"}",["T_WHITESPACE","\n\n        ",224],["T_RETURN","return",226],["T_WHITESPACE"," ",226],["T_STRING","in_array",226],"(",["T_CONSTANT_ENCAPSED_STRING","'\\'unsafe-inline\\''",226],",",["T_WHITESPACE"," ",226],["T_VARIABLE","$directives",226],",",["T_WHITESPACE"," ",226],["T_STRING","true",226],")",["T_WHITESPACE"," ",226],["T_BOOLEAN_AND","&&",226],["T_WHITESPACE"," ",226],"!",["T_VARIABLE","$this",226],["T_OBJECT_OPERATOR","->",226],["T_STRING","hasHashOrNonce",226],"(",["T_VARIABLE","$directives",226],")",";",["T_WHITESPACE","\n    ",226],"}",["T_WHITESPACE","\n\n    ",227],["T_PRIVATE","private",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","hasHashOrNonce",229],"(",["T_ARRAY","array",229],["T_WHITESPACE"," ",229],["T_VARIABLE","$directives",229],")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_FOREACH","foreach",231],["T_WHITESPACE"," ",231],"(",["T_VARIABLE","$directives",231],["T_WHITESPACE"," ",231],["T_AS","as",231],["T_WHITESPACE"," ",231],["T_VARIABLE","$directive",231],")",["T_WHITESPACE"," ",231],"{",["T_WHITESPACE","\n            ",231],["T_IF","if",232],["T_WHITESPACE"," ",232],"(",["T_CONSTANT_ENCAPSED_STRING","'\\''",232],["T_WHITESPACE"," ",232],["T_IS_NOT_IDENTICAL","!==",232],["T_WHITESPACE"," ",232],["T_STRING","substr",232],"(",["T_VARIABLE","$directive",232],",",["T_WHITESPACE"," ",232],"-",["T_LNUMBER","1",232],")",")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n                ",232],["T_CONTINUE","continue",233],";",["T_WHITESPACE","\n            ",233],"}",["T_WHITESPACE","\n            ",234],["T_IF","if",235],["T_WHITESPACE"," ",235],"(",["T_CONSTANT_ENCAPSED_STRING","'\\'nonce-'",235],["T_WHITESPACE"," ",235],["T_IS_IDENTICAL","===",235],["T_WHITESPACE"," ",235],["T_STRING","substr",235],"(",["T_VARIABLE","$directive",235],",",["T_WHITESPACE"," ",235],["T_LNUMBER","0",235],",",["T_WHITESPACE"," ",235],["T_LNUMBER","7",235],")",")",["T_WHITESPACE"," ",235],"{",["T_WHITESPACE","\n                ",235],["T_RETURN","return",236],["T_WHITESPACE"," ",236],["T_STRING","true",236],";",["T_WHITESPACE","\n            ",236],"}",["T_WHITESPACE","\n            ",237],["T_IF","if",238],["T_WHITESPACE"," ",238],"(",["T_STRING","in_array",238],"(",["T_STRING","substr",238],"(",["T_VARIABLE","$directive",238],",",["T_WHITESPACE"," ",238],["T_LNUMBER","0",238],",",["T_WHITESPACE"," ",238],["T_LNUMBER","8",238],")",",",["T_WHITESPACE"," ",238],["T_ARRAY","array",238],"(",["T_CONSTANT_ENCAPSED_STRING","'\\'sha256-'",238],",",["T_WHITESPACE"," ",238],["T_CONSTANT_ENCAPSED_STRING","'\\'sha384-'",238],",",["T_WHITESPACE"," ",238],["T_CONSTANT_ENCAPSED_STRING","'\\'sha512-'",238],")",",",["T_WHITESPACE"," ",238],["T_STRING","true",238],")",")",["T_WHITESPACE"," ",238],"{",["T_WHITESPACE","\n                ",238],["T_RETURN","return",239],["T_WHITESPACE"," ",239],["T_STRING","true",239],";",["T_WHITESPACE","\n            ",239],"}",["T_WHITESPACE","\n        ",240],"}",["T_WHITESPACE","\n\n        ",241],["T_RETURN","return",243],["T_WHITESPACE"," ",243],["T_STRING","false",243],";",["T_WHITESPACE","\n    ",243],"}",["T_WHITESPACE","\n\n    ",244],["T_DOC_COMMENT","\/**\n     * Retrieves the Content-Security-Policy headers (either X-Content-Security-Policy or Content-Security-Policy) from\n     * a response.\n     *\n     * @return array An associative array of headers\n     *\/",246],["T_WHITESPACE","\n    ",251],["T_PRIVATE","private",252],["T_WHITESPACE"," ",252],["T_FUNCTION","function",252],["T_WHITESPACE"," ",252],["T_STRING","getCspHeaders",252],"(",["T_STRING","Response",252],["T_WHITESPACE"," ",252],["T_VARIABLE","$response",252],")",["T_WHITESPACE","\n    ",252],"{",["T_WHITESPACE","\n        ",253],["T_VARIABLE","$headers",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_ARRAY","array",254],"(",")",";",["T_WHITESPACE","\n\n        ",254],["T_IF","if",256],["T_WHITESPACE"," ",256],"(",["T_VARIABLE","$response",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","headers",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","has",256],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Security-Policy'",256],")",")",["T_WHITESPACE"," ",256],"{",["T_WHITESPACE","\n            ",256],["T_VARIABLE","$headers",257],"[",["T_CONSTANT_ENCAPSED_STRING","'Content-Security-Policy'",257],"]",["T_WHITESPACE"," ",257],"=",["T_WHITESPACE"," ",257],["T_VARIABLE","$this",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","parseDirectives",257],"(",["T_VARIABLE","$response",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","headers",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","get",257],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Security-Policy'",257],")",")",";",["T_WHITESPACE","\n        ",257],"}",["T_WHITESPACE","\n\n        ",258],["T_IF","if",260],["T_WHITESPACE"," ",260],"(",["T_VARIABLE","$response",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","headers",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","has",260],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Content-Security-Policy'",260],")",")",["T_WHITESPACE"," ",260],"{",["T_WHITESPACE","\n            ",260],["T_VARIABLE","$headers",261],"[",["T_CONSTANT_ENCAPSED_STRING","'X-Content-Security-Policy'",261],"]",["T_WHITESPACE"," ",261],"=",["T_WHITESPACE"," ",261],["T_VARIABLE","$this",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","parseDirectives",261],"(",["T_VARIABLE","$response",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","headers",261],["T_OBJECT_OPERATOR","->",261],["T_STRING","get",261],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Content-Security-Policy'",261],")",")",";",["T_WHITESPACE","\n        ",261],"}",["T_WHITESPACE","\n\n        ",262],["T_RETURN","return",264],["T_WHITESPACE"," ",264],["T_VARIABLE","$headers",264],";",["T_WHITESPACE","\n    ",264],"}",["T_WHITESPACE","\n",265],"}",["T_WHITESPACE","\n",266]]