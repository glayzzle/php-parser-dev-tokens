[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_COMMENT","\/*\n * This file is part of the Symfony package.\n *\n * (c) Fabien Potencier <fabien@symfony.com>\n *\n * This code is partially based on the Rack-Cache library by Ryan Tomayko,\n * which is released under the MIT license.\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n *\/",3],["T_WHITESPACE","\n\n",13],["T_NAMESPACE","namespace",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpKernel",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpCache",15],";",["T_WHITESPACE","\n\n",15],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Symfony",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Component",17],["T_NS_SEPARATOR","\\",17],["T_STRING","HttpFoundation",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Request",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Symfony",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Component",18],["T_NS_SEPARATOR","\\",18],["T_STRING","HttpFoundation",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Response",18],";",["T_WHITESPACE","\n\n",18],["T_DOC_COMMENT","\/**\n * Store implements all the logic for storing cache metadata (Request and Response headers).\n *\n * @author Fabien Potencier <fabien@symfony.com>\n *\/",20],["T_WHITESPACE","\n",24],["T_CLASS","class",25],["T_WHITESPACE"," ",25],["T_STRING","Store",25],["T_WHITESPACE"," ",25],["T_IMPLEMENTS","implements",25],["T_WHITESPACE"," ",25],["T_STRING","StoreInterface",25],["T_WHITESPACE","\n",25],"{",["T_WHITESPACE","\n    ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$root",27],";",["T_WHITESPACE","\n    ",27],["T_PRIVATE","private",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$keyCache",28],";",["T_WHITESPACE","\n    ",28],["T_PRIVATE","private",29],["T_WHITESPACE"," ",29],["T_VARIABLE","$locks",29],";",["T_WHITESPACE","\n\n    ",29],["T_DOC_COMMENT","\/**\n     * Constructor.\n     *\n     * @param string $root The path to the cache directory\n     *\n     * @throws \\RuntimeException\n     *\/",31],["T_WHITESPACE","\n    ",37],["T_PUBLIC","public",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","__construct",38],"(",["T_VARIABLE","$root",38],")",["T_WHITESPACE","\n    ",38],"{",["T_WHITESPACE","\n        ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","root",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$root",40],";",["T_WHITESPACE","\n        ",40],["T_IF","if",41],["T_WHITESPACE"," ",41],"(","!",["T_STRING","file_exists",41],"(",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","root",41],")",["T_WHITESPACE"," ",41],["T_BOOLEAN_AND","&&",41],["T_WHITESPACE"," ",41],"!","@",["T_STRING","mkdir",41],"(",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","root",41],",",["T_WHITESPACE"," ",41],["T_LNUMBER","0777",41],",",["T_WHITESPACE"," ",41],["T_STRING","true",41],")",["T_WHITESPACE"," ",41],["T_BOOLEAN_AND","&&",41],["T_WHITESPACE"," ",41],"!",["T_STRING","is_dir",41],"(",["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","root",41],")",")",["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n            ",41],["T_THROW","throw",42],["T_WHITESPACE"," ",42],["T_NEW","new",42],["T_WHITESPACE"," ",42],["T_NS_SEPARATOR","\\",42],["T_STRING","RuntimeException",42],"(",["T_STRING","sprintf",42],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to create the store directory (%s).'",42],",",["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","root",42],")",")",";",["T_WHITESPACE","\n        ",42],"}",["T_WHITESPACE","\n        ",43],["T_VARIABLE","$this",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","keyCache",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_NEW","new",44],["T_WHITESPACE"," ",44],["T_NS_SEPARATOR","\\",44],["T_STRING","SplObjectStorage",44],"(",")",";",["T_WHITESPACE","\n        ",44],["T_VARIABLE","$this",45],["T_OBJECT_OPERATOR","->",45],["T_STRING","locks",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_ARRAY","array",45],"(",")",";",["T_WHITESPACE","\n    ",45],"}",["T_WHITESPACE","\n\n    ",46],["T_DOC_COMMENT","\/**\n     * Cleanups storage.\n     *\/",48],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","cleanup",51],"(",")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_COMMENT","\/\/ unlock everything\n",53],["T_WHITESPACE","        ",54],["T_FOREACH","foreach",54],["T_WHITESPACE"," ",54],"(",["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","locks",54],["T_WHITESPACE"," ",54],["T_AS","as",54],["T_WHITESPACE"," ",54],["T_VARIABLE","$lock",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n            ",54],["T_STRING","flock",55],"(",["T_VARIABLE","$lock",55],",",["T_WHITESPACE"," ",55],["T_STRING","LOCK_UN",55],")",";",["T_WHITESPACE","\n            ",55],["T_STRING","fclose",56],"(",["T_VARIABLE","$lock",56],")",";",["T_WHITESPACE","\n        ",56],"}",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","locks",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_ARRAY","array",59],"(",")",";",["T_WHITESPACE","\n    ",59],"}",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * Tries to lock the cache for a given Request, without blocking.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return bool|string true if the lock is acquired, the path to the current lock otherwise\n     *\/",62],["T_WHITESPACE","\n    ",68],["T_PUBLIC","public",69],["T_WHITESPACE"," ",69],["T_FUNCTION","function",69],["T_WHITESPACE"," ",69],["T_STRING","lock",69],"(",["T_STRING","Request",69],["T_WHITESPACE"," ",69],["T_VARIABLE","$request",69],")",["T_WHITESPACE","\n    ",69],"{",["T_WHITESPACE","\n        ",70],["T_VARIABLE","$key",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","getCacheKey",71],"(",["T_VARIABLE","$request",71],")",";",["T_WHITESPACE","\n\n        ",71],["T_IF","if",73],["T_WHITESPACE"," ",73],"(","!",["T_ISSET","isset",73],"(",["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","locks",73],"[",["T_VARIABLE","$key",73],"]",")",")",["T_WHITESPACE"," ",73],"{",["T_WHITESPACE","\n            ",73],["T_VARIABLE","$path",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","getPath",74],"(",["T_VARIABLE","$key",74],")",";",["T_WHITESPACE","\n            ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(","!",["T_STRING","file_exists",75],"(",["T_STRING","dirname",75],"(",["T_VARIABLE","$path",75],")",")",["T_WHITESPACE"," ",75],["T_BOOLEAN_AND","&&",75],["T_WHITESPACE"," ",75],["T_STRING","false",75],["T_WHITESPACE"," ",75],["T_IS_IDENTICAL","===",75],["T_WHITESPACE"," ",75],"@",["T_STRING","mkdir",75],"(",["T_STRING","dirname",75],"(",["T_VARIABLE","$path",75],")",",",["T_WHITESPACE"," ",75],["T_LNUMBER","0777",75],",",["T_WHITESPACE"," ",75],["T_STRING","true",75],")",["T_WHITESPACE"," ",75],["T_BOOLEAN_AND","&&",75],["T_WHITESPACE"," ",75],"!",["T_STRING","is_dir",75],"(",["T_STRING","dirname",75],"(",["T_VARIABLE","$path",75],")",")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n                ",75],["T_RETURN","return",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$path",76],";",["T_WHITESPACE","\n            ",76],"}",["T_WHITESPACE","\n            ",77],["T_VARIABLE","$h",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","fopen",78],"(",["T_VARIABLE","$path",78],",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'cb'",78],")",";",["T_WHITESPACE","\n            ",78],["T_IF","if",79],["T_WHITESPACE"," ",79],"(","!",["T_STRING","flock",79],"(",["T_VARIABLE","$h",79],",",["T_WHITESPACE"," ",79],["T_STRING","LOCK_EX",79],["T_WHITESPACE"," ",79],"|",["T_WHITESPACE"," ",79],["T_STRING","LOCK_NB",79],")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n                ",79],["T_STRING","fclose",80],"(",["T_VARIABLE","$h",80],")",";",["T_WHITESPACE","\n\n                ",80],["T_RETURN","return",82],["T_WHITESPACE"," ",82],["T_VARIABLE","$path",82],";",["T_WHITESPACE","\n            ",82],"}",["T_WHITESPACE","\n\n            ",83],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","locks",85],"[",["T_VARIABLE","$key",85],"]",["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$h",85],";",["T_WHITESPACE","\n        ",85],"}",["T_WHITESPACE","\n\n        ",86],["T_RETURN","return",88],["T_WHITESPACE"," ",88],["T_STRING","true",88],";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n\n    ",89],["T_DOC_COMMENT","\/**\n     * Releases the lock for the given Request.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return bool False if the lock file does not exist or cannot be unlocked, true otherwise\n     *\/",91],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","unlock",98],"(",["T_STRING","Request",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$request",98],")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$key",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getCacheKey",100],"(",["T_VARIABLE","$request",100],")",";",["T_WHITESPACE","\n\n        ",100],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_ISSET","isset",102],"(",["T_VARIABLE","$this",102],["T_OBJECT_OPERATOR","->",102],["T_STRING","locks",102],"[",["T_VARIABLE","$key",102],"]",")",")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n            ",102],["T_STRING","flock",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","locks",103],"[",["T_VARIABLE","$key",103],"]",",",["T_WHITESPACE"," ",103],["T_STRING","LOCK_UN",103],")",";",["T_WHITESPACE","\n            ",103],["T_STRING","fclose",104],"(",["T_VARIABLE","$this",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","locks",104],"[",["T_VARIABLE","$key",104],"]",")",";",["T_WHITESPACE","\n            ",104],["T_UNSET","unset",105],"(",["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","locks",105],"[",["T_VARIABLE","$key",105],"]",")",";",["T_WHITESPACE","\n\n            ",105],["T_RETURN","return",107],["T_WHITESPACE"," ",107],["T_STRING","true",107],";",["T_WHITESPACE","\n        ",107],"}",["T_WHITESPACE","\n\n        ",108],["T_RETURN","return",110],["T_WHITESPACE"," ",110],["T_STRING","false",110],";",["T_WHITESPACE","\n    ",110],"}",["T_WHITESPACE","\n\n    ",111],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","isLocked",113],"(",["T_STRING","Request",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$request",113],")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$key",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","getCacheKey",115],"(",["T_VARIABLE","$request",115],")",";",["T_WHITESPACE","\n\n        ",115],["T_IF","if",117],["T_WHITESPACE"," ",117],"(",["T_ISSET","isset",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","locks",117],"[",["T_VARIABLE","$key",117],"]",")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n            ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_STRING","true",118],";",["T_WHITESPACE"," ",118],["T_COMMENT","\/\/ shortcut if lock held by this process\n",118],["T_WHITESPACE","        ",119],"}",["T_WHITESPACE","\n\n        ",119],["T_IF","if",121],["T_WHITESPACE"," ",121],"(","!",["T_STRING","file_exists",121],"(",["T_VARIABLE","$path",121],["T_WHITESPACE"," ",121],"=",["T_WHITESPACE"," ",121],["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getPath",121],"(",["T_VARIABLE","$key",121],")",")",")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n            ",121],["T_RETURN","return",122],["T_WHITESPACE"," ",122],["T_STRING","false",122],";",["T_WHITESPACE","\n        ",122],"}",["T_WHITESPACE","\n\n        ",123],["T_VARIABLE","$h",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_STRING","fopen",125],"(",["T_VARIABLE","$path",125],",",["T_WHITESPACE"," ",125],["T_CONSTANT_ENCAPSED_STRING","'rb'",125],")",";",["T_WHITESPACE","\n        ",125],["T_STRING","flock",126],"(",["T_VARIABLE","$h",126],",",["T_WHITESPACE"," ",126],["T_STRING","LOCK_EX",126],["T_WHITESPACE"," ",126],"|",["T_WHITESPACE"," ",126],["T_STRING","LOCK_NB",126],",",["T_WHITESPACE"," ",126],["T_VARIABLE","$wouldBlock",126],")",";",["T_WHITESPACE","\n        ",126],["T_STRING","flock",127],"(",["T_VARIABLE","$h",127],",",["T_WHITESPACE"," ",127],["T_STRING","LOCK_UN",127],")",";",["T_WHITESPACE"," ",127],["T_COMMENT","\/\/ release the lock we just acquired\n",127],["T_WHITESPACE","        ",128],["T_STRING","fclose",128],"(",["T_VARIABLE","$h",128],")",";",["T_WHITESPACE","\n\n        ",128],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_BOOL_CAST","(bool)",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$wouldBlock",130],";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Locates a cached Response for the Request provided.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return Response|null A Response instance, or null if no cache entry was found\n     *\/",133],["T_WHITESPACE","\n    ",139],["T_PUBLIC","public",140],["T_WHITESPACE"," ",140],["T_FUNCTION","function",140],["T_WHITESPACE"," ",140],["T_STRING","lookup",140],"(",["T_STRING","Request",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$request",140],")",["T_WHITESPACE","\n    ",140],"{",["T_WHITESPACE","\n        ",141],["T_VARIABLE","$key",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_VARIABLE","$this",142],["T_OBJECT_OPERATOR","->",142],["T_STRING","getCacheKey",142],"(",["T_VARIABLE","$request",142],")",";",["T_WHITESPACE","\n\n        ",142],["T_IF","if",144],["T_WHITESPACE"," ",144],"(","!",["T_VARIABLE","$entries",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_VARIABLE","$this",144],["T_OBJECT_OPERATOR","->",144],["T_STRING","getMetadata",144],"(",["T_VARIABLE","$key",144],")",")",["T_WHITESPACE"," ",144],"{",["T_WHITESPACE","\n            ",144],["T_RETURN","return",145],";",["T_WHITESPACE","\n        ",145],"}",["T_WHITESPACE","\n\n        ",146],["T_COMMENT","\/\/ find a cached entry that matches the request.\n",148],["T_WHITESPACE","        ",149],["T_VARIABLE","$match",149],["T_WHITESPACE"," ",149],"=",["T_WHITESPACE"," ",149],["T_STRING","null",149],";",["T_WHITESPACE","\n        ",149],["T_FOREACH","foreach",150],["T_WHITESPACE"," ",150],"(",["T_VARIABLE","$entries",150],["T_WHITESPACE"," ",150],["T_AS","as",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$entry",150],")",["T_WHITESPACE"," ",150],"{",["T_WHITESPACE","\n            ",150],["T_IF","if",151],["T_WHITESPACE"," ",151],"(",["T_VARIABLE","$this",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","requestsMatch",151],"(",["T_ISSET","isset",151],"(",["T_VARIABLE","$entry",151],"[",["T_LNUMBER","1",151],"]","[",["T_CONSTANT_ENCAPSED_STRING","'vary'",151],"]","[",["T_LNUMBER","0",151],"]",")",["T_WHITESPACE"," ",151],"?",["T_WHITESPACE"," ",151],["T_STRING","implode",151],"(",["T_CONSTANT_ENCAPSED_STRING","', '",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$entry",151],"[",["T_LNUMBER","1",151],"]","[",["T_CONSTANT_ENCAPSED_STRING","'vary'",151],"]",")",["T_WHITESPACE"," ",151],":",["T_WHITESPACE"," ",151],["T_CONSTANT_ENCAPSED_STRING","''",151],",",["T_WHITESPACE"," ",151],["T_VARIABLE","$request",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","headers",151],["T_OBJECT_OPERATOR","->",151],["T_STRING","all",151],"(",")",",",["T_WHITESPACE"," ",151],["T_VARIABLE","$entry",151],"[",["T_LNUMBER","0",151],"]",")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n                ",151],["T_VARIABLE","$match",152],["T_WHITESPACE"," ",152],"=",["T_WHITESPACE"," ",152],["T_VARIABLE","$entry",152],";",["T_WHITESPACE","\n\n                ",152],["T_BREAK","break",154],";",["T_WHITESPACE","\n            ",154],"}",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n\n        ",156],["T_IF","if",158],["T_WHITESPACE"," ",158],"(",["T_STRING","null",158],["T_WHITESPACE"," ",158],["T_IS_IDENTICAL","===",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$match",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_RETURN","return",159],";",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n\n        ",160],["T_LIST","list",162],"(",["T_VARIABLE","$req",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$headers",162],")",["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_VARIABLE","$match",162],";",["T_WHITESPACE","\n        ",162],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_STRING","file_exists",163],"(",["T_VARIABLE","$body",163],["T_WHITESPACE"," ",163],"=",["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","getPath",163],"(",["T_VARIABLE","$headers",163],"[",["T_CONSTANT_ENCAPSED_STRING","'x-content-digest'",163],"]","[",["T_LNUMBER","0",163],"]",")",")",")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n            ",163],["T_RETURN","return",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","restoreResponse",164],"(",["T_VARIABLE","$headers",164],",",["T_WHITESPACE"," ",164],["T_VARIABLE","$body",164],")",";",["T_WHITESPACE","\n        ",164],"}",["T_WHITESPACE","\n\n        ",165],["T_COMMENT","\/\/ TODO the metaStore referenced an entity that doesn't exist in\n",167],["T_WHITESPACE","        ",168],["T_COMMENT","\/\/ the entityStore. We definitely want to return nil but we should\n",168],["T_WHITESPACE","        ",169],["T_COMMENT","\/\/ also purge the entry from the meta-store when this is detected.\n",169],["T_WHITESPACE","    ",170],"}",["T_WHITESPACE","\n\n    ",170],["T_DOC_COMMENT","\/**\n     * Writes a cache entry to the store for the given Request and Response.\n     *\n     * Existing entries are read and any that match the response are removed. This\n     * method calls write with the new list of cache entries.\n     *\n     * @param Request  $request  A Request instance\n     * @param Response $response A Response instance\n     *\n     * @return string The key under which the response is stored\n     *\n     * @throws \\RuntimeException\n     *\/",172],["T_WHITESPACE","\n    ",184],["T_PUBLIC","public",185],["T_WHITESPACE"," ",185],["T_FUNCTION","function",185],["T_WHITESPACE"," ",185],["T_STRING","write",185],"(",["T_STRING","Request",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$request",185],",",["T_WHITESPACE"," ",185],["T_STRING","Response",185],["T_WHITESPACE"," ",185],["T_VARIABLE","$response",185],")",["T_WHITESPACE","\n    ",185],"{",["T_WHITESPACE","\n        ",186],["T_VARIABLE","$key",187],["T_WHITESPACE"," ",187],"=",["T_WHITESPACE"," ",187],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","getCacheKey",187],"(",["T_VARIABLE","$request",187],")",";",["T_WHITESPACE","\n        ",187],["T_VARIABLE","$storedEnv",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","persistRequest",188],"(",["T_VARIABLE","$request",188],")",";",["T_WHITESPACE","\n\n        ",188],["T_COMMENT","\/\/ write the response body to the entity store if this is the original response\n",190],["T_WHITESPACE","        ",191],["T_IF","if",191],["T_WHITESPACE"," ",191],"(","!",["T_VARIABLE","$response",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","headers",191],["T_OBJECT_OPERATOR","->",191],["T_STRING","has",191],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Content-Digest'",191],")",")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n            ",191],["T_VARIABLE","$digest",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","generateContentDigest",192],"(",["T_VARIABLE","$response",192],")",";",["T_WHITESPACE","\n\n            ",192],["T_IF","if",194],["T_WHITESPACE"," ",194],"(",["T_STRING","false",194],["T_WHITESPACE"," ",194],["T_IS_IDENTICAL","===",194],["T_WHITESPACE"," ",194],["T_VARIABLE","$this",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","save",194],"(",["T_VARIABLE","$digest",194],",",["T_WHITESPACE"," ",194],["T_VARIABLE","$response",194],["T_OBJECT_OPERATOR","->",194],["T_STRING","getContent",194],"(",")",")",")",["T_WHITESPACE"," ",194],"{",["T_WHITESPACE","\n                ",194],["T_THROW","throw",195],["T_WHITESPACE"," ",195],["T_NEW","new",195],["T_WHITESPACE"," ",195],["T_NS_SEPARATOR","\\",195],["T_STRING","RuntimeException",195],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to store the entity.'",195],")",";",["T_WHITESPACE","\n            ",195],"}",["T_WHITESPACE","\n\n            ",196],["T_VARIABLE","$response",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","headers",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","set",198],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Content-Digest'",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$digest",198],")",";",["T_WHITESPACE","\n\n            ",198],["T_IF","if",200],["T_WHITESPACE"," ",200],"(","!",["T_VARIABLE","$response",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","headers",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","has",200],"(",["T_CONSTANT_ENCAPSED_STRING","'Transfer-Encoding'",200],")",")",["T_WHITESPACE"," ",200],"{",["T_WHITESPACE","\n                ",200],["T_VARIABLE","$response",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","headers",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","set",201],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Length'",201],",",["T_WHITESPACE"," ",201],["T_STRING","strlen",201],"(",["T_VARIABLE","$response",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","getContent",201],"(",")",")",")",";",["T_WHITESPACE","\n            ",201],"}",["T_WHITESPACE","\n        ",202],"}",["T_WHITESPACE","\n\n        ",203],["T_COMMENT","\/\/ read existing cache entries, remove non-varying, and add this one to the list\n",205],["T_WHITESPACE","        ",206],["T_VARIABLE","$entries",206],["T_WHITESPACE"," ",206],"=",["T_WHITESPACE"," ",206],["T_ARRAY","array",206],"(",")",";",["T_WHITESPACE","\n        ",206],["T_VARIABLE","$vary",207],["T_WHITESPACE"," ",207],"=",["T_WHITESPACE"," ",207],["T_VARIABLE","$response",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","headers",207],["T_OBJECT_OPERATOR","->",207],["T_STRING","get",207],"(",["T_CONSTANT_ENCAPSED_STRING","'vary'",207],")",";",["T_WHITESPACE","\n        ",207],["T_FOREACH","foreach",208],["T_WHITESPACE"," ",208],"(",["T_VARIABLE","$this",208],["T_OBJECT_OPERATOR","->",208],["T_STRING","getMetadata",208],"(",["T_VARIABLE","$key",208],")",["T_WHITESPACE"," ",208],["T_AS","as",208],["T_WHITESPACE"," ",208],["T_VARIABLE","$entry",208],")",["T_WHITESPACE"," ",208],"{",["T_WHITESPACE","\n            ",208],["T_IF","if",209],["T_WHITESPACE"," ",209],"(","!",["T_ISSET","isset",209],"(",["T_VARIABLE","$entry",209],"[",["T_LNUMBER","1",209],"]","[",["T_CONSTANT_ENCAPSED_STRING","'vary'",209],"]","[",["T_LNUMBER","0",209],"]",")",")",["T_WHITESPACE"," ",209],"{",["T_WHITESPACE","\n                ",209],["T_VARIABLE","$entry",210],"[",["T_LNUMBER","1",210],"]","[",["T_CONSTANT_ENCAPSED_STRING","'vary'",210],"]",["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],"(",["T_CONSTANT_ENCAPSED_STRING","''",210],")",";",["T_WHITESPACE","\n            ",210],"}",["T_WHITESPACE","\n\n            ",211],["T_IF","if",213],["T_WHITESPACE"," ",213],"(",["T_VARIABLE","$vary",213],["T_WHITESPACE"," ",213],["T_IS_NOT_EQUAL","!=",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$entry",213],"[",["T_LNUMBER","1",213],"]","[",["T_CONSTANT_ENCAPSED_STRING","'vary'",213],"]","[",["T_LNUMBER","0",213],"]",["T_WHITESPACE"," ",213],["T_BOOLEAN_OR","||",213],["T_WHITESPACE"," ",213],"!",["T_VARIABLE","$this",213],["T_OBJECT_OPERATOR","->",213],["T_STRING","requestsMatch",213],"(",["T_VARIABLE","$vary",213],",",["T_WHITESPACE"," ",213],["T_VARIABLE","$entry",213],"[",["T_LNUMBER","0",213],"]",",",["T_WHITESPACE"," ",213],["T_VARIABLE","$storedEnv",213],")",")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n                ",213],["T_VARIABLE","$entries",214],"[","]",["T_WHITESPACE"," ",214],"=",["T_WHITESPACE"," ",214],["T_VARIABLE","$entry",214],";",["T_WHITESPACE","\n            ",214],"}",["T_WHITESPACE","\n        ",215],"}",["T_WHITESPACE","\n\n        ",216],["T_VARIABLE","$headers",218],["T_WHITESPACE"," ",218],"=",["T_WHITESPACE"," ",218],["T_VARIABLE","$this",218],["T_OBJECT_OPERATOR","->",218],["T_STRING","persistResponse",218],"(",["T_VARIABLE","$response",218],")",";",["T_WHITESPACE","\n        ",218],["T_UNSET","unset",219],"(",["T_VARIABLE","$headers",219],"[",["T_CONSTANT_ENCAPSED_STRING","'age'",219],"]",")",";",["T_WHITESPACE","\n\n        ",219],["T_STRING","array_unshift",221],"(",["T_VARIABLE","$entries",221],",",["T_WHITESPACE"," ",221],["T_ARRAY","array",221],"(",["T_VARIABLE","$storedEnv",221],",",["T_WHITESPACE"," ",221],["T_VARIABLE","$headers",221],")",")",";",["T_WHITESPACE","\n\n        ",221],["T_IF","if",223],["T_WHITESPACE"," ",223],"(",["T_STRING","false",223],["T_WHITESPACE"," ",223],["T_IS_IDENTICAL","===",223],["T_WHITESPACE"," ",223],["T_VARIABLE","$this",223],["T_OBJECT_OPERATOR","->",223],["T_STRING","save",223],"(",["T_VARIABLE","$key",223],",",["T_WHITESPACE"," ",223],["T_STRING","serialize",223],"(",["T_VARIABLE","$entries",223],")",")",")",["T_WHITESPACE"," ",223],"{",["T_WHITESPACE","\n            ",223],["T_THROW","throw",224],["T_WHITESPACE"," ",224],["T_NEW","new",224],["T_WHITESPACE"," ",224],["T_NS_SEPARATOR","\\",224],["T_STRING","RuntimeException",224],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to store the metadata.'",224],")",";",["T_WHITESPACE","\n        ",224],"}",["T_WHITESPACE","\n\n        ",225],["T_RETURN","return",227],["T_WHITESPACE"," ",227],["T_VARIABLE","$key",227],";",["T_WHITESPACE","\n    ",227],"}",["T_WHITESPACE","\n\n    ",228],["T_DOC_COMMENT","\/**\n     * Returns content digest for $response.\n     *\n     * @param Response $response\n     *\n     * @return string\n     *\/",230],["T_WHITESPACE","\n    ",236],["T_PROTECTED","protected",237],["T_WHITESPACE"," ",237],["T_FUNCTION","function",237],["T_WHITESPACE"," ",237],["T_STRING","generateContentDigest",237],"(",["T_STRING","Response",237],["T_WHITESPACE"," ",237],["T_VARIABLE","$response",237],")",["T_WHITESPACE","\n    ",237],"{",["T_WHITESPACE","\n        ",238],["T_RETURN","return",239],["T_WHITESPACE"," ",239],["T_CONSTANT_ENCAPSED_STRING","'en'",239],".",["T_STRING","hash",239],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",239],",",["T_WHITESPACE"," ",239],["T_VARIABLE","$response",239],["T_OBJECT_OPERATOR","->",239],["T_STRING","getContent",239],"(",")",")",";",["T_WHITESPACE","\n    ",239],"}",["T_WHITESPACE","\n\n    ",240],["T_DOC_COMMENT","\/**\n     * Invalidates all cache entries that match the request.\n     *\n     * @param Request $request A Request instance\n     *\n     * @throws \\RuntimeException\n     *\/",242],["T_WHITESPACE","\n    ",248],["T_PUBLIC","public",249],["T_WHITESPACE"," ",249],["T_FUNCTION","function",249],["T_WHITESPACE"," ",249],["T_STRING","invalidate",249],"(",["T_STRING","Request",249],["T_WHITESPACE"," ",249],["T_VARIABLE","$request",249],")",["T_WHITESPACE","\n    ",249],"{",["T_WHITESPACE","\n        ",250],["T_VARIABLE","$modified",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_STRING","false",251],";",["T_WHITESPACE","\n        ",251],["T_VARIABLE","$key",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_VARIABLE","$this",252],["T_OBJECT_OPERATOR","->",252],["T_STRING","getCacheKey",252],"(",["T_VARIABLE","$request",252],")",";",["T_WHITESPACE","\n\n        ",252],["T_VARIABLE","$entries",254],["T_WHITESPACE"," ",254],"=",["T_WHITESPACE"," ",254],["T_ARRAY","array",254],"(",")",";",["T_WHITESPACE","\n        ",254],["T_FOREACH","foreach",255],["T_WHITESPACE"," ",255],"(",["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","getMetadata",255],"(",["T_VARIABLE","$key",255],")",["T_WHITESPACE"," ",255],["T_AS","as",255],["T_WHITESPACE"," ",255],["T_VARIABLE","$entry",255],")",["T_WHITESPACE"," ",255],"{",["T_WHITESPACE","\n            ",255],["T_VARIABLE","$response",256],["T_WHITESPACE"," ",256],"=",["T_WHITESPACE"," ",256],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","restoreResponse",256],"(",["T_VARIABLE","$entry",256],"[",["T_LNUMBER","1",256],"]",")",";",["T_WHITESPACE","\n            ",256],["T_IF","if",257],["T_WHITESPACE"," ",257],"(",["T_VARIABLE","$response",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","isFresh",257],"(",")",")",["T_WHITESPACE"," ",257],"{",["T_WHITESPACE","\n                ",257],["T_VARIABLE","$response",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","expire",258],"(",")",";",["T_WHITESPACE","\n                ",258],["T_VARIABLE","$modified",259],["T_WHITESPACE"," ",259],"=",["T_WHITESPACE"," ",259],["T_STRING","true",259],";",["T_WHITESPACE","\n                ",259],["T_VARIABLE","$entries",260],"[","]",["T_WHITESPACE"," ",260],"=",["T_WHITESPACE"," ",260],["T_ARRAY","array",260],"(",["T_VARIABLE","$entry",260],"[",["T_LNUMBER","0",260],"]",",",["T_WHITESPACE"," ",260],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","persistResponse",260],"(",["T_VARIABLE","$response",260],")",")",";",["T_WHITESPACE","\n            ",260],"}",["T_WHITESPACE"," ",261],["T_ELSE","else",261],["T_WHITESPACE"," ",261],"{",["T_WHITESPACE","\n                ",261],["T_VARIABLE","$entries",262],"[","]",["T_WHITESPACE"," ",262],"=",["T_WHITESPACE"," ",262],["T_VARIABLE","$entry",262],";",["T_WHITESPACE","\n            ",262],"}",["T_WHITESPACE","\n        ",263],"}",["T_WHITESPACE","\n\n        ",264],["T_IF","if",266],["T_WHITESPACE"," ",266],"(",["T_VARIABLE","$modified",266],["T_WHITESPACE"," ",266],["T_BOOLEAN_AND","&&",266],["T_WHITESPACE"," ",266],["T_STRING","false",266],["T_WHITESPACE"," ",266],["T_IS_IDENTICAL","===",266],["T_WHITESPACE"," ",266],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","save",266],"(",["T_VARIABLE","$key",266],",",["T_WHITESPACE"," ",266],["T_STRING","serialize",266],"(",["T_VARIABLE","$entries",266],")",")",")",["T_WHITESPACE"," ",266],"{",["T_WHITESPACE","\n            ",266],["T_THROW","throw",267],["T_WHITESPACE"," ",267],["T_NEW","new",267],["T_WHITESPACE"," ",267],["T_NS_SEPARATOR","\\",267],["T_STRING","RuntimeException",267],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to store the metadata.'",267],")",";",["T_WHITESPACE","\n        ",267],"}",["T_WHITESPACE","\n    ",268],"}",["T_WHITESPACE","\n\n    ",269],["T_DOC_COMMENT","\/**\n     * Determines whether two Request HTTP header sets are non-varying based on\n     * the vary response header value provided.\n     *\n     * @param string $vary A Response vary header\n     * @param array  $env1 A Request HTTP header array\n     * @param array  $env2 A Request HTTP header array\n     *\n     * @return bool true if the two environments match, false otherwise\n     *\/",271],["T_WHITESPACE","\n    ",280],["T_PRIVATE","private",281],["T_WHITESPACE"," ",281],["T_FUNCTION","function",281],["T_WHITESPACE"," ",281],["T_STRING","requestsMatch",281],"(",["T_VARIABLE","$vary",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$env1",281],",",["T_WHITESPACE"," ",281],["T_VARIABLE","$env2",281],")",["T_WHITESPACE","\n    ",281],"{",["T_WHITESPACE","\n        ",282],["T_IF","if",283],["T_WHITESPACE"," ",283],"(",["T_EMPTY","empty",283],"(",["T_VARIABLE","$vary",283],")",")",["T_WHITESPACE"," ",283],"{",["T_WHITESPACE","\n            ",283],["T_RETURN","return",284],["T_WHITESPACE"," ",284],["T_STRING","true",284],";",["T_WHITESPACE","\n        ",284],"}",["T_WHITESPACE","\n\n        ",285],["T_FOREACH","foreach",287],["T_WHITESPACE"," ",287],"(",["T_STRING","preg_split",287],"(",["T_CONSTANT_ENCAPSED_STRING","'\/[\\s,]+\/'",287],",",["T_WHITESPACE"," ",287],["T_VARIABLE","$vary",287],")",["T_WHITESPACE"," ",287],["T_AS","as",287],["T_WHITESPACE"," ",287],["T_VARIABLE","$header",287],")",["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n            ",287],["T_VARIABLE","$key",288],["T_WHITESPACE"," ",288],"=",["T_WHITESPACE"," ",288],["T_STRING","str_replace",288],"(",["T_CONSTANT_ENCAPSED_STRING","'_'",288],",",["T_WHITESPACE"," ",288],["T_CONSTANT_ENCAPSED_STRING","'-'",288],",",["T_WHITESPACE"," ",288],["T_STRING","strtolower",288],"(",["T_VARIABLE","$header",288],")",")",";",["T_WHITESPACE","\n            ",288],["T_VARIABLE","$v1",289],["T_WHITESPACE"," ",289],"=",["T_WHITESPACE"," ",289],["T_ISSET","isset",289],"(",["T_VARIABLE","$env1",289],"[",["T_VARIABLE","$key",289],"]",")",["T_WHITESPACE"," ",289],"?",["T_WHITESPACE"," ",289],["T_VARIABLE","$env1",289],"[",["T_VARIABLE","$key",289],"]",["T_WHITESPACE"," ",289],":",["T_WHITESPACE"," ",289],["T_STRING","null",289],";",["T_WHITESPACE","\n            ",289],["T_VARIABLE","$v2",290],["T_WHITESPACE"," ",290],"=",["T_WHITESPACE"," ",290],["T_ISSET","isset",290],"(",["T_VARIABLE","$env2",290],"[",["T_VARIABLE","$key",290],"]",")",["T_WHITESPACE"," ",290],"?",["T_WHITESPACE"," ",290],["T_VARIABLE","$env2",290],"[",["T_VARIABLE","$key",290],"]",["T_WHITESPACE"," ",290],":",["T_WHITESPACE"," ",290],["T_STRING","null",290],";",["T_WHITESPACE","\n            ",290],["T_IF","if",291],["T_WHITESPACE"," ",291],"(",["T_VARIABLE","$v1",291],["T_WHITESPACE"," ",291],["T_IS_NOT_IDENTICAL","!==",291],["T_WHITESPACE"," ",291],["T_VARIABLE","$v2",291],")",["T_WHITESPACE"," ",291],"{",["T_WHITESPACE","\n                ",291],["T_RETURN","return",292],["T_WHITESPACE"," ",292],["T_STRING","false",292],";",["T_WHITESPACE","\n            ",292],"}",["T_WHITESPACE","\n        ",293],"}",["T_WHITESPACE","\n\n        ",294],["T_RETURN","return",296],["T_WHITESPACE"," ",296],["T_STRING","true",296],";",["T_WHITESPACE","\n    ",296],"}",["T_WHITESPACE","\n\n    ",297],["T_DOC_COMMENT","\/**\n     * Gets all data associated with the given key.\n     *\n     * Use this method only if you know what you are doing.\n     *\n     * @param string $key The store key\n     *\n     * @return array An array of data associated with the key\n     *\/",299],["T_WHITESPACE","\n    ",307],["T_PRIVATE","private",308],["T_WHITESPACE"," ",308],["T_FUNCTION","function",308],["T_WHITESPACE"," ",308],["T_STRING","getMetadata",308],"(",["T_VARIABLE","$key",308],")",["T_WHITESPACE","\n    ",308],"{",["T_WHITESPACE","\n        ",309],["T_IF","if",310],["T_WHITESPACE"," ",310],"(","!",["T_VARIABLE","$entries",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","load",310],"(",["T_VARIABLE","$key",310],")",")",["T_WHITESPACE"," ",310],"{",["T_WHITESPACE","\n            ",310],["T_RETURN","return",311],["T_WHITESPACE"," ",311],["T_ARRAY","array",311],"(",")",";",["T_WHITESPACE","\n        ",311],"}",["T_WHITESPACE","\n\n        ",312],["T_RETURN","return",314],["T_WHITESPACE"," ",314],["T_STRING","unserialize",314],"(",["T_VARIABLE","$entries",314],")",";",["T_WHITESPACE","\n    ",314],"}",["T_WHITESPACE","\n\n    ",315],["T_DOC_COMMENT","\/**\n     * Purges data for the given URL.\n     *\n     * @param string $url A URL\n     *\n     * @return bool true if the URL exists and has been purged, false otherwise\n     *\/",317],["T_WHITESPACE","\n    ",323],["T_PUBLIC","public",324],["T_WHITESPACE"," ",324],["T_FUNCTION","function",324],["T_WHITESPACE"," ",324],["T_STRING","purge",324],"(",["T_VARIABLE","$url",324],")",["T_WHITESPACE","\n    ",324],"{",["T_WHITESPACE","\n        ",325],["T_VARIABLE","$key",326],["T_WHITESPACE"," ",326],"=",["T_WHITESPACE"," ",326],["T_VARIABLE","$this",326],["T_OBJECT_OPERATOR","->",326],["T_STRING","getCacheKey",326],"(",["T_STRING","Request",326],["T_DOUBLE_COLON","::",326],["T_STRING","create",326],"(",["T_VARIABLE","$url",326],")",")",";",["T_WHITESPACE","\n\n        ",326],["T_IF","if",328],["T_WHITESPACE"," ",328],"(",["T_ISSET","isset",328],"(",["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","locks",328],"[",["T_VARIABLE","$key",328],"]",")",")",["T_WHITESPACE"," ",328],"{",["T_WHITESPACE","\n            ",328],["T_STRING","flock",329],"(",["T_VARIABLE","$this",329],["T_OBJECT_OPERATOR","->",329],["T_STRING","locks",329],"[",["T_VARIABLE","$key",329],"]",",",["T_WHITESPACE"," ",329],["T_STRING","LOCK_UN",329],")",";",["T_WHITESPACE","\n            ",329],["T_STRING","fclose",330],"(",["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","locks",330],"[",["T_VARIABLE","$key",330],"]",")",";",["T_WHITESPACE","\n            ",330],["T_UNSET","unset",331],"(",["T_VARIABLE","$this",331],["T_OBJECT_OPERATOR","->",331],["T_STRING","locks",331],"[",["T_VARIABLE","$key",331],"]",")",";",["T_WHITESPACE","\n        ",331],"}",["T_WHITESPACE","\n\n        ",332],["T_IF","if",334],["T_WHITESPACE"," ",334],"(",["T_STRING","file_exists",334],"(",["T_VARIABLE","$path",334],["T_WHITESPACE"," ",334],"=",["T_WHITESPACE"," ",334],["T_VARIABLE","$this",334],["T_OBJECT_OPERATOR","->",334],["T_STRING","getPath",334],"(",["T_VARIABLE","$key",334],")",")",")",["T_WHITESPACE"," ",334],"{",["T_WHITESPACE","\n            ",334],["T_STRING","unlink",335],"(",["T_VARIABLE","$path",335],")",";",["T_WHITESPACE","\n\n            ",335],["T_RETURN","return",337],["T_WHITESPACE"," ",337],["T_STRING","true",337],";",["T_WHITESPACE","\n        ",337],"}",["T_WHITESPACE","\n\n        ",338],["T_RETURN","return",340],["T_WHITESPACE"," ",340],["T_STRING","false",340],";",["T_WHITESPACE","\n    ",340],"}",["T_WHITESPACE","\n\n    ",341],["T_DOC_COMMENT","\/**\n     * Loads data for the given key.\n     *\n     * @param string $key The store key\n     *\n     * @return string The data associated with the key\n     *\/",343],["T_WHITESPACE","\n    ",349],["T_PRIVATE","private",350],["T_WHITESPACE"," ",350],["T_FUNCTION","function",350],["T_WHITESPACE"," ",350],["T_STRING","load",350],"(",["T_VARIABLE","$key",350],")",["T_WHITESPACE","\n    ",350],"{",["T_WHITESPACE","\n        ",351],["T_VARIABLE","$path",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_VARIABLE","$this",352],["T_OBJECT_OPERATOR","->",352],["T_STRING","getPath",352],"(",["T_VARIABLE","$key",352],")",";",["T_WHITESPACE","\n\n        ",352],["T_RETURN","return",354],["T_WHITESPACE"," ",354],["T_STRING","file_exists",354],"(",["T_VARIABLE","$path",354],")",["T_WHITESPACE"," ",354],"?",["T_WHITESPACE"," ",354],["T_STRING","file_get_contents",354],"(",["T_VARIABLE","$path",354],")",["T_WHITESPACE"," ",354],":",["T_WHITESPACE"," ",354],["T_STRING","false",354],";",["T_WHITESPACE","\n    ",354],"}",["T_WHITESPACE","\n\n    ",355],["T_DOC_COMMENT","\/**\n     * Save data for the given key.\n     *\n     * @param string $key  The store key\n     * @param string $data The data to store\n     *\n     * @return bool\n     *\/",357],["T_WHITESPACE","\n    ",364],["T_PRIVATE","private",365],["T_WHITESPACE"," ",365],["T_FUNCTION","function",365],["T_WHITESPACE"," ",365],["T_STRING","save",365],"(",["T_VARIABLE","$key",365],",",["T_WHITESPACE"," ",365],["T_VARIABLE","$data",365],")",["T_WHITESPACE","\n    ",365],"{",["T_WHITESPACE","\n        ",366],["T_VARIABLE","$path",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$this",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getPath",367],"(",["T_VARIABLE","$key",367],")",";",["T_WHITESPACE","\n\n        ",367],["T_IF","if",369],["T_WHITESPACE"," ",369],"(",["T_ISSET","isset",369],"(",["T_VARIABLE","$this",369],["T_OBJECT_OPERATOR","->",369],["T_STRING","locks",369],"[",["T_VARIABLE","$key",369],"]",")",")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$fp",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_VARIABLE","$this",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","locks",370],"[",["T_VARIABLE","$key",370],"]",";",["T_WHITESPACE","\n            ",370],"@",["T_STRING","ftruncate",371],"(",["T_VARIABLE","$fp",371],",",["T_WHITESPACE"," ",371],["T_LNUMBER","0",371],")",";",["T_WHITESPACE","\n            ",371],"@",["T_STRING","fseek",372],"(",["T_VARIABLE","$fp",372],",",["T_WHITESPACE"," ",372],["T_LNUMBER","0",372],")",";",["T_WHITESPACE","\n            ",372],["T_VARIABLE","$len",373],["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],"@",["T_STRING","fwrite",373],"(",["T_VARIABLE","$fp",373],",",["T_WHITESPACE"," ",373],["T_VARIABLE","$data",373],")",";",["T_WHITESPACE","\n            ",373],["T_IF","if",374],["T_WHITESPACE"," ",374],"(",["T_STRING","strlen",374],"(",["T_VARIABLE","$data",374],")",["T_WHITESPACE"," ",374],["T_IS_NOT_IDENTICAL","!==",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$len",374],")",["T_WHITESPACE"," ",374],"{",["T_WHITESPACE","\n                ",374],"@",["T_STRING","ftruncate",375],"(",["T_VARIABLE","$fp",375],",",["T_WHITESPACE"," ",375],["T_LNUMBER","0",375],")",";",["T_WHITESPACE","\n\n                ",375],["T_RETURN","return",377],["T_WHITESPACE"," ",377],["T_STRING","false",377],";",["T_WHITESPACE","\n            ",377],"}",["T_WHITESPACE","\n        ",378],"}",["T_WHITESPACE"," ",379],["T_ELSE","else",379],["T_WHITESPACE"," ",379],"{",["T_WHITESPACE","\n            ",379],["T_IF","if",380],["T_WHITESPACE"," ",380],"(","!",["T_STRING","file_exists",380],"(",["T_STRING","dirname",380],"(",["T_VARIABLE","$path",380],")",")",["T_WHITESPACE"," ",380],["T_BOOLEAN_AND","&&",380],["T_WHITESPACE"," ",380],["T_STRING","false",380],["T_WHITESPACE"," ",380],["T_IS_IDENTICAL","===",380],["T_WHITESPACE"," ",380],"@",["T_STRING","mkdir",380],"(",["T_STRING","dirname",380],"(",["T_VARIABLE","$path",380],")",",",["T_WHITESPACE"," ",380],["T_LNUMBER","0777",380],",",["T_WHITESPACE"," ",380],["T_STRING","true",380],")",["T_WHITESPACE"," ",380],["T_BOOLEAN_AND","&&",380],["T_WHITESPACE"," ",380],"!",["T_STRING","is_dir",380],"(",["T_STRING","dirname",380],"(",["T_VARIABLE","$path",380],")",")",")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n                ",380],["T_RETURN","return",381],["T_WHITESPACE"," ",381],["T_STRING","false",381],";",["T_WHITESPACE","\n            ",381],"}",["T_WHITESPACE","\n\n            ",382],["T_VARIABLE","$tmpFile",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_STRING","tempnam",384],"(",["T_STRING","dirname",384],"(",["T_VARIABLE","$path",384],")",",",["T_WHITESPACE"," ",384],["T_STRING","basename",384],"(",["T_VARIABLE","$path",384],")",")",";",["T_WHITESPACE","\n            ",384],["T_IF","if",385],["T_WHITESPACE"," ",385],"(",["T_STRING","false",385],["T_WHITESPACE"," ",385],["T_IS_IDENTICAL","===",385],["T_WHITESPACE"," ",385],["T_VARIABLE","$fp",385],["T_WHITESPACE"," ",385],"=",["T_WHITESPACE"," ",385],"@",["T_STRING","fopen",385],"(",["T_VARIABLE","$tmpFile",385],",",["T_WHITESPACE"," ",385],["T_CONSTANT_ENCAPSED_STRING","'wb'",385],")",")",["T_WHITESPACE"," ",385],"{",["T_WHITESPACE","\n                ",385],["T_RETURN","return",386],["T_WHITESPACE"," ",386],["T_STRING","false",386],";",["T_WHITESPACE","\n            ",386],"}",["T_WHITESPACE","\n            ",387],"@",["T_STRING","fwrite",388],"(",["T_VARIABLE","$fp",388],",",["T_WHITESPACE"," ",388],["T_VARIABLE","$data",388],")",";",["T_WHITESPACE","\n            ",388],"@",["T_STRING","fclose",389],"(",["T_VARIABLE","$fp",389],")",";",["T_WHITESPACE","\n\n            ",389],["T_IF","if",391],["T_WHITESPACE"," ",391],"(",["T_VARIABLE","$data",391],["T_WHITESPACE"," ",391],["T_IS_NOT_EQUAL","!=",391],["T_WHITESPACE"," ",391],["T_STRING","file_get_contents",391],"(",["T_VARIABLE","$tmpFile",391],")",")",["T_WHITESPACE"," ",391],"{",["T_WHITESPACE","\n                ",391],["T_RETURN","return",392],["T_WHITESPACE"," ",392],["T_STRING","false",392],";",["T_WHITESPACE","\n            ",392],"}",["T_WHITESPACE","\n\n            ",393],["T_IF","if",395],["T_WHITESPACE"," ",395],"(",["T_STRING","false",395],["T_WHITESPACE"," ",395],["T_IS_IDENTICAL","===",395],["T_WHITESPACE"," ",395],"@",["T_STRING","rename",395],"(",["T_VARIABLE","$tmpFile",395],",",["T_WHITESPACE"," ",395],["T_VARIABLE","$path",395],")",")",["T_WHITESPACE"," ",395],"{",["T_WHITESPACE","\n                ",395],["T_RETURN","return",396],["T_WHITESPACE"," ",396],["T_STRING","false",396],";",["T_WHITESPACE","\n            ",396],"}",["T_WHITESPACE","\n        ",397],"}",["T_WHITESPACE","\n\n        ",398],"@",["T_STRING","chmod",400],"(",["T_VARIABLE","$path",400],",",["T_WHITESPACE"," ",400],["T_LNUMBER","0666",400],["T_WHITESPACE"," ",400],"&",["T_WHITESPACE"," ",400],"~",["T_STRING","umask",400],"(",")",")",";",["T_WHITESPACE","\n    ",400],"}",["T_WHITESPACE","\n\n    ",401],["T_PUBLIC","public",403],["T_WHITESPACE"," ",403],["T_FUNCTION","function",403],["T_WHITESPACE"," ",403],["T_STRING","getPath",403],"(",["T_VARIABLE","$key",403],")",["T_WHITESPACE","\n    ",403],"{",["T_WHITESPACE","\n        ",404],["T_RETURN","return",405],["T_WHITESPACE"," ",405],["T_VARIABLE","$this",405],["T_OBJECT_OPERATOR","->",405],["T_STRING","root",405],".",["T_STRING","DIRECTORY_SEPARATOR",405],".",["T_STRING","substr",405],"(",["T_VARIABLE","$key",405],",",["T_WHITESPACE"," ",405],["T_LNUMBER","0",405],",",["T_WHITESPACE"," ",405],["T_LNUMBER","2",405],")",".",["T_STRING","DIRECTORY_SEPARATOR",405],".",["T_STRING","substr",405],"(",["T_VARIABLE","$key",405],",",["T_WHITESPACE"," ",405],["T_LNUMBER","2",405],",",["T_WHITESPACE"," ",405],["T_LNUMBER","2",405],")",".",["T_STRING","DIRECTORY_SEPARATOR",405],".",["T_STRING","substr",405],"(",["T_VARIABLE","$key",405],",",["T_WHITESPACE"," ",405],["T_LNUMBER","4",405],",",["T_WHITESPACE"," ",405],["T_LNUMBER","2",405],")",".",["T_STRING","DIRECTORY_SEPARATOR",405],".",["T_STRING","substr",405],"(",["T_VARIABLE","$key",405],",",["T_WHITESPACE"," ",405],["T_LNUMBER","6",405],")",";",["T_WHITESPACE","\n    ",405],"}",["T_WHITESPACE","\n\n    ",406],["T_DOC_COMMENT","\/**\n     * Generates a cache key for the given Request.\n     *\n     * This method should return a key that must only depend on a\n     * normalized version of the request URI.\n     *\n     * If the same URI can have more than one representation, based on some\n     * headers, use a Vary header to indicate them, and each representation will\n     * be stored independently under the same cache key.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return string A key for the given Request\n     *\/",408],["T_WHITESPACE","\n    ",421],["T_PROTECTED","protected",422],["T_WHITESPACE"," ",422],["T_FUNCTION","function",422],["T_WHITESPACE"," ",422],["T_STRING","generateCacheKey",422],"(",["T_STRING","Request",422],["T_WHITESPACE"," ",422],["T_VARIABLE","$request",422],")",["T_WHITESPACE","\n    ",422],"{",["T_WHITESPACE","\n        ",423],["T_RETURN","return",424],["T_WHITESPACE"," ",424],["T_CONSTANT_ENCAPSED_STRING","'md'",424],".",["T_STRING","hash",424],"(",["T_CONSTANT_ENCAPSED_STRING","'sha256'",424],",",["T_WHITESPACE"," ",424],["T_VARIABLE","$request",424],["T_OBJECT_OPERATOR","->",424],["T_STRING","getUri",424],"(",")",")",";",["T_WHITESPACE","\n    ",424],"}",["T_WHITESPACE","\n\n    ",425],["T_DOC_COMMENT","\/**\n     * Returns a cache key for the given Request.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return string A key for the given Request\n     *\/",427],["T_WHITESPACE","\n    ",433],["T_PRIVATE","private",434],["T_WHITESPACE"," ",434],["T_FUNCTION","function",434],["T_WHITESPACE"," ",434],["T_STRING","getCacheKey",434],"(",["T_STRING","Request",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$request",434],")",["T_WHITESPACE","\n    ",434],"{",["T_WHITESPACE","\n        ",435],["T_IF","if",436],["T_WHITESPACE"," ",436],"(",["T_ISSET","isset",436],"(",["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","keyCache",436],"[",["T_VARIABLE","$request",436],"]",")",")",["T_WHITESPACE"," ",436],"{",["T_WHITESPACE","\n            ",436],["T_RETURN","return",437],["T_WHITESPACE"," ",437],["T_VARIABLE","$this",437],["T_OBJECT_OPERATOR","->",437],["T_STRING","keyCache",437],"[",["T_VARIABLE","$request",437],"]",";",["T_WHITESPACE","\n        ",437],"}",["T_WHITESPACE","\n\n        ",438],["T_RETURN","return",440],["T_WHITESPACE"," ",440],["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","keyCache",440],"[",["T_VARIABLE","$request",440],"]",["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_VARIABLE","$this",440],["T_OBJECT_OPERATOR","->",440],["T_STRING","generateCacheKey",440],"(",["T_VARIABLE","$request",440],")",";",["T_WHITESPACE","\n    ",440],"}",["T_WHITESPACE","\n\n    ",441],["T_DOC_COMMENT","\/**\n     * Persists the Request HTTP headers.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return array An array of HTTP headers\n     *\/",443],["T_WHITESPACE","\n    ",449],["T_PRIVATE","private",450],["T_WHITESPACE"," ",450],["T_FUNCTION","function",450],["T_WHITESPACE"," ",450],["T_STRING","persistRequest",450],"(",["T_STRING","Request",450],["T_WHITESPACE"," ",450],["T_VARIABLE","$request",450],")",["T_WHITESPACE","\n    ",450],"{",["T_WHITESPACE","\n        ",451],["T_RETURN","return",452],["T_WHITESPACE"," ",452],["T_VARIABLE","$request",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","headers",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","all",452],"(",")",";",["T_WHITESPACE","\n    ",452],"}",["T_WHITESPACE","\n\n    ",453],["T_DOC_COMMENT","\/**\n     * Persists the Response HTTP headers.\n     *\n     * @param Response $response A Response instance\n     *\n     * @return array An array of HTTP headers\n     *\/",455],["T_WHITESPACE","\n    ",461],["T_PRIVATE","private",462],["T_WHITESPACE"," ",462],["T_FUNCTION","function",462],["T_WHITESPACE"," ",462],["T_STRING","persistResponse",462],"(",["T_STRING","Response",462],["T_WHITESPACE"," ",462],["T_VARIABLE","$response",462],")",["T_WHITESPACE","\n    ",462],"{",["T_WHITESPACE","\n        ",463],["T_VARIABLE","$headers",464],["T_WHITESPACE"," ",464],"=",["T_WHITESPACE"," ",464],["T_VARIABLE","$response",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","headers",464],["T_OBJECT_OPERATOR","->",464],["T_STRING","all",464],"(",")",";",["T_WHITESPACE","\n        ",464],["T_VARIABLE","$headers",465],"[",["T_CONSTANT_ENCAPSED_STRING","'X-Status'",465],"]",["T_WHITESPACE"," ",465],"=",["T_WHITESPACE"," ",465],["T_ARRAY","array",465],"(",["T_VARIABLE","$response",465],["T_OBJECT_OPERATOR","->",465],["T_STRING","getStatusCode",465],"(",")",")",";",["T_WHITESPACE","\n\n        ",465],["T_RETURN","return",467],["T_WHITESPACE"," ",467],["T_VARIABLE","$headers",467],";",["T_WHITESPACE","\n    ",467],"}",["T_WHITESPACE","\n\n    ",468],["T_DOC_COMMENT","\/**\n     * Restores a Response from the HTTP headers and body.\n     *\n     * @param array  $headers An array of HTTP headers for the Response\n     * @param string $body    The Response body\n     *\n     * @return Response\n     *\/",470],["T_WHITESPACE","\n    ",477],["T_PRIVATE","private",478],["T_WHITESPACE"," ",478],["T_FUNCTION","function",478],["T_WHITESPACE"," ",478],["T_STRING","restoreResponse",478],"(",["T_VARIABLE","$headers",478],",",["T_WHITESPACE"," ",478],["T_VARIABLE","$body",478],["T_WHITESPACE"," ",478],"=",["T_WHITESPACE"," ",478],["T_STRING","null",478],")",["T_WHITESPACE","\n    ",478],"{",["T_WHITESPACE","\n        ",479],["T_VARIABLE","$status",480],["T_WHITESPACE"," ",480],"=",["T_WHITESPACE"," ",480],["T_VARIABLE","$headers",480],"[",["T_CONSTANT_ENCAPSED_STRING","'X-Status'",480],"]","[",["T_LNUMBER","0",480],"]",";",["T_WHITESPACE","\n        ",480],["T_UNSET","unset",481],"(",["T_VARIABLE","$headers",481],"[",["T_CONSTANT_ENCAPSED_STRING","'X-Status'",481],"]",")",";",["T_WHITESPACE","\n\n        ",481],["T_IF","if",483],["T_WHITESPACE"," ",483],"(",["T_STRING","null",483],["T_WHITESPACE"," ",483],["T_IS_NOT_IDENTICAL","!==",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$body",483],")",["T_WHITESPACE"," ",483],"{",["T_WHITESPACE","\n            ",483],["T_VARIABLE","$headers",484],"[",["T_CONSTANT_ENCAPSED_STRING","'X-Body-File'",484],"]",["T_WHITESPACE"," ",484],"=",["T_WHITESPACE"," ",484],["T_ARRAY","array",484],"(",["T_VARIABLE","$body",484],")",";",["T_WHITESPACE","\n        ",484],"}",["T_WHITESPACE","\n\n        ",485],["T_RETURN","return",487],["T_WHITESPACE"," ",487],["T_NEW","new",487],["T_WHITESPACE"," ",487],["T_STRING","Response",487],"(",["T_VARIABLE","$body",487],",",["T_WHITESPACE"," ",487],["T_VARIABLE","$status",487],",",["T_WHITESPACE"," ",487],["T_VARIABLE","$headers",487],")",";",["T_WHITESPACE","\n    ",487],"}",["T_WHITESPACE","\n",488],"}",["T_WHITESPACE","\n",489]]