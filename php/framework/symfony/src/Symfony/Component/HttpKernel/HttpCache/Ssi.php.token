[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_COMMENT","\/*\n * This file is part of the Symfony package.\n *\n * (c) Fabien Potencier <fabien@symfony.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n *\/",3],["T_WHITESPACE","\n\n",10],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Symfony",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Component",12],["T_NS_SEPARATOR","\\",12],["T_STRING","HttpKernel",12],["T_NS_SEPARATOR","\\",12],["T_STRING","HttpCache",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Symfony",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Component",14],["T_NS_SEPARATOR","\\",14],["T_STRING","HttpFoundation",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Request",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpFoundation",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Response",15],";",["T_WHITESPACE","\n\n",15],["T_DOC_COMMENT","\/**\n * Ssi implements the SSI capabilities to Request and Response instances.\n *\n * @author Sebastian Krebs <krebs.seb@gmail.com>\n *\/",17],["T_WHITESPACE","\n",21],["T_CLASS","class",22],["T_WHITESPACE"," ",22],["T_STRING","Ssi",22],["T_WHITESPACE"," ",22],["T_EXTENDS","extends",22],["T_WHITESPACE"," ",22],["T_STRING","AbstractSurrogate",22],["T_WHITESPACE","\n",22],"{",["T_WHITESPACE","\n    ",23],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PUBLIC","public",27],["T_WHITESPACE"," ",27],["T_FUNCTION","function",27],["T_WHITESPACE"," ",27],["T_STRING","getName",27],"(",")",["T_WHITESPACE","\n    ",27],"{",["T_WHITESPACE","\n        ",28],["T_RETURN","return",29],["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'ssi'",29],";",["T_WHITESPACE","\n    ",29],"}",["T_WHITESPACE","\n\n    ",30],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",32],["T_WHITESPACE","\n    ",34],["T_PUBLIC","public",35],["T_WHITESPACE"," ",35],["T_FUNCTION","function",35],["T_WHITESPACE"," ",35],["T_STRING","addSurrogateControl",35],"(",["T_STRING","Response",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$response",35],")",["T_WHITESPACE","\n    ",35],"{",["T_WHITESPACE","\n        ",36],["T_IF","if",37],["T_WHITESPACE"," ",37],"(",["T_STRING","false",37],["T_WHITESPACE"," ",37],["T_IS_NOT_IDENTICAL","!==",37],["T_WHITESPACE"," ",37],["T_STRING","strpos",37],"(",["T_VARIABLE","$response",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","getContent",37],"(",")",",",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'<!--#include'",37],")",")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n            ",37],["T_VARIABLE","$response",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","headers",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","set",38],"(",["T_CONSTANT_ENCAPSED_STRING","'Surrogate-Control'",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'content=\"SSI\/1.0\"'",38],")",";",["T_WHITESPACE","\n        ",38],"}",["T_WHITESPACE","\n    ",39],"}",["T_WHITESPACE","\n\n    ",40],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",42],["T_WHITESPACE","\n    ",44],["T_PUBLIC","public",45],["T_WHITESPACE"," ",45],["T_FUNCTION","function",45],["T_WHITESPACE"," ",45],["T_STRING","renderIncludeTag",45],"(",["T_VARIABLE","$uri",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$alt",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","null",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$ignoreErrors",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","true",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$comment",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_CONSTANT_ENCAPSED_STRING","''",45],")",["T_WHITESPACE","\n    ",45],"{",["T_WHITESPACE","\n        ",46],["T_RETURN","return",47],["T_WHITESPACE"," ",47],["T_STRING","sprintf",47],"(",["T_CONSTANT_ENCAPSED_STRING","'<!--#include virtual=\"%s\" -->'",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$uri",47],")",";",["T_WHITESPACE","\n    ",47],"}",["T_WHITESPACE","\n\n    ",48],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",50],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_FUNCTION","function",53],["T_WHITESPACE"," ",53],["T_STRING","process",53],"(",["T_STRING","Request",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$request",53],",",["T_WHITESPACE"," ",53],["T_STRING","Response",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$response",53],")",["T_WHITESPACE","\n    ",53],"{",["T_WHITESPACE","\n        ",54],["T_VARIABLE","$type",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_VARIABLE","$response",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","headers",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","get",55],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Type'",55],")",";",["T_WHITESPACE","\n        ",55],["T_IF","if",56],["T_WHITESPACE"," ",56],"(",["T_EMPTY","empty",56],"(",["T_VARIABLE","$type",56],")",")",["T_WHITESPACE"," ",56],"{",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$type",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'text\/html'",57],";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n\n        ",58],["T_VARIABLE","$parts",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_STRING","explode",60],"(",["T_CONSTANT_ENCAPSED_STRING","';'",60],",",["T_WHITESPACE"," ",60],["T_VARIABLE","$type",60],")",";",["T_WHITESPACE","\n        ",60],["T_IF","if",61],["T_WHITESPACE"," ",61],"(","!",["T_STRING","in_array",61],"(",["T_VARIABLE","$parts",61],"[",["T_LNUMBER","0",61],"]",",",["T_WHITESPACE"," ",61],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","contentTypes",61],")",")",["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n            ",61],["T_RETURN","return",62],["T_WHITESPACE"," ",62],["T_VARIABLE","$response",62],";",["T_WHITESPACE","\n        ",62],"}",["T_WHITESPACE","\n\n        ",63],["T_COMMENT","\/\/ we don't use a proper XML parser here as we can have SSI tags in a plain text response\n",65],["T_WHITESPACE","        ",66],["T_VARIABLE","$content",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_VARIABLE","$response",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","getContent",66],"(",")",";",["T_WHITESPACE","\n\n        ",66],["T_VARIABLE","$chunks",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_STRING","preg_split",68],"(",["T_CONSTANT_ENCAPSED_STRING","'#<!--\\#include\\s+(.*?)\\s*-->#'",68],",",["T_WHITESPACE"," ",68],["T_VARIABLE","$content",68],",",["T_WHITESPACE"," ",68],"-",["T_LNUMBER","1",68],",",["T_WHITESPACE"," ",68],["T_STRING","PREG_SPLIT_DELIM_CAPTURE",68],")",";",["T_WHITESPACE","\n        ",68],["T_VARIABLE","$chunks",69],"[",["T_LNUMBER","0",69],"]",["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_STRING","str_replace",69],"(",["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","phpEscapeMap",69],"[",["T_LNUMBER","0",69],"]",",",["T_WHITESPACE"," ",69],["T_VARIABLE","$this",69],["T_OBJECT_OPERATOR","->",69],["T_STRING","phpEscapeMap",69],"[",["T_LNUMBER","1",69],"]",",",["T_WHITESPACE"," ",69],["T_VARIABLE","$chunks",69],"[",["T_LNUMBER","0",69],"]",")",";",["T_WHITESPACE","\n\n        ",69],["T_VARIABLE","$i",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_LNUMBER","1",71],";",["T_WHITESPACE","\n        ",71],["T_WHILE","while",72],["T_WHITESPACE"," ",72],"(",["T_ISSET","isset",72],"(",["T_VARIABLE","$chunks",72],"[",["T_VARIABLE","$i",72],"]",")",")",["T_WHITESPACE"," ",72],"{",["T_WHITESPACE","\n            ",72],["T_VARIABLE","$options",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_ARRAY","array",73],"(",")",";",["T_WHITESPACE","\n            ",73],["T_STRING","preg_match_all",74],"(",["T_CONSTANT_ENCAPSED_STRING","'\/(virtual)=\"([^\"]*?)\"\/'",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$chunks",74],"[",["T_VARIABLE","$i",74],"]",",",["T_WHITESPACE"," ",74],["T_VARIABLE","$matches",74],",",["T_WHITESPACE"," ",74],["T_STRING","PREG_SET_ORDER",74],")",";",["T_WHITESPACE","\n            ",74],["T_FOREACH","foreach",75],["T_WHITESPACE"," ",75],"(",["T_VARIABLE","$matches",75],["T_WHITESPACE"," ",75],["T_AS","as",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$set",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n                ",75],["T_VARIABLE","$options",76],"[",["T_VARIABLE","$set",76],"[",["T_LNUMBER","1",76],"]","]",["T_WHITESPACE"," ",76],"=",["T_WHITESPACE"," ",76],["T_VARIABLE","$set",76],"[",["T_LNUMBER","2",76],"]",";",["T_WHITESPACE","\n            ",76],"}",["T_WHITESPACE","\n\n            ",77],["T_IF","if",79],["T_WHITESPACE"," ",79],"(","!",["T_ISSET","isset",79],"(",["T_VARIABLE","$options",79],"[",["T_CONSTANT_ENCAPSED_STRING","'virtual'",79],"]",")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n                ",79],["T_THROW","throw",80],["T_WHITESPACE"," ",80],["T_NEW","new",80],["T_WHITESPACE"," ",80],["T_NS_SEPARATOR","\\",80],["T_STRING","RuntimeException",80],"(",["T_CONSTANT_ENCAPSED_STRING","'Unable to process an SSI tag without a \"virtual\" attribute.'",80],")",";",["T_WHITESPACE","\n            ",80],"}",["T_WHITESPACE","\n\n            ",81],["T_VARIABLE","$chunks",83],"[",["T_VARIABLE","$i",83],"]",["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_STRING","sprintf",83],"(",["T_CONSTANT_ENCAPSED_STRING","'<?php echo $this->surrogate->handle($this, %s, \\'\\', false) ?>'",83],".",["T_CONSTANT_ENCAPSED_STRING","\"\\n\"",83],",",["T_WHITESPACE","\n                ",83],["T_STRING","var_export",84],"(",["T_VARIABLE","$options",84],"[",["T_CONSTANT_ENCAPSED_STRING","'virtual'",84],"]",",",["T_WHITESPACE"," ",84],["T_STRING","true",84],")",["T_WHITESPACE","\n            ",84],")",";",["T_WHITESPACE","\n            ",85],["T_INC","++",86],["T_VARIABLE","$i",86],";",["T_WHITESPACE","\n            ",86],["T_VARIABLE","$chunks",87],"[",["T_VARIABLE","$i",87],"]",["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","str_replace",87],"(",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","phpEscapeMap",87],"[",["T_LNUMBER","0",87],"]",",",["T_WHITESPACE"," ",87],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","phpEscapeMap",87],"[",["T_LNUMBER","1",87],"]",",",["T_WHITESPACE"," ",87],["T_VARIABLE","$chunks",87],"[",["T_VARIABLE","$i",87],"]",")",";",["T_WHITESPACE","\n            ",87],["T_INC","++",88],["T_VARIABLE","$i",88],";",["T_WHITESPACE","\n        ",88],"}",["T_WHITESPACE","\n        ",89],["T_VARIABLE","$content",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_STRING","implode",90],"(",["T_CONSTANT_ENCAPSED_STRING","''",90],",",["T_WHITESPACE"," ",90],["T_VARIABLE","$chunks",90],")",";",["T_WHITESPACE","\n\n        ",90],["T_VARIABLE","$response",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","setContent",92],"(",["T_VARIABLE","$content",92],")",";",["T_WHITESPACE","\n        ",92],["T_VARIABLE","$response",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","headers",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","set",93],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-Eval'",93],",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'SSI'",93],")",";",["T_WHITESPACE","\n\n        ",93],["T_COMMENT","\/\/ remove SSI\/1.0 from the Surrogate-Control header\n",95],["T_WHITESPACE","        ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","removeFromControl",96],"(",["T_VARIABLE","$response",96],")",";",["T_WHITESPACE","\n    ",96],"}",["T_WHITESPACE","\n",97],"}",["T_WHITESPACE","\n",98]]