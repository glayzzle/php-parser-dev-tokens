[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_COMMENT","\/*\n * This file is part of the Symfony package.\n *\n * (c) Fabien Potencier <fabien@symfony.com>\n *\n * This code is partially based on the Rack-Cache library by Ryan Tomayko,\n * which is released under the MIT license.\n * (based on commit 02d2b48d75bcb63cf1c0c7149c077ad256542801)\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n *\/",3],["T_WHITESPACE","\n\n",14],["T_NAMESPACE","namespace",16],["T_WHITESPACE"," ",16],["T_STRING","Symfony",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Component",16],["T_NS_SEPARATOR","\\",16],["T_STRING","HttpKernel",16],["T_NS_SEPARATOR","\\",16],["T_STRING","HttpCache",16],";",["T_WHITESPACE","\n\n",16],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Symfony",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Component",18],["T_NS_SEPARATOR","\\",18],["T_STRING","HttpKernel",18],["T_NS_SEPARATOR","\\",18],["T_STRING","HttpKernelInterface",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Symfony",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Component",19],["T_NS_SEPARATOR","\\",19],["T_STRING","HttpKernel",19],["T_NS_SEPARATOR","\\",19],["T_STRING","TerminableInterface",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Symfony",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Component",20],["T_NS_SEPARATOR","\\",20],["T_STRING","HttpFoundation",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Request",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Symfony",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Component",21],["T_NS_SEPARATOR","\\",21],["T_STRING","HttpFoundation",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Response",21],";",["T_WHITESPACE","\n\n",21],["T_DOC_COMMENT","\/**\n * Cache provides HTTP caching.\n *\n * @author Fabien Potencier <fabien@symfony.com>\n *\/",23],["T_WHITESPACE","\n",27],["T_CLASS","class",28],["T_WHITESPACE"," ",28],["T_STRING","HttpCache",28],["T_WHITESPACE"," ",28],["T_IMPLEMENTS","implements",28],["T_WHITESPACE"," ",28],["T_STRING","HttpKernelInterface",28],",",["T_WHITESPACE"," ",28],["T_STRING","TerminableInterface",28],["T_WHITESPACE","\n",28],"{",["T_WHITESPACE","\n    ",29],["T_PRIVATE","private",30],["T_WHITESPACE"," ",30],["T_VARIABLE","$kernel",30],";",["T_WHITESPACE","\n    ",30],["T_PRIVATE","private",31],["T_WHITESPACE"," ",31],["T_VARIABLE","$store",31],";",["T_WHITESPACE","\n    ",31],["T_PRIVATE","private",32],["T_WHITESPACE"," ",32],["T_VARIABLE","$request",32],";",["T_WHITESPACE","\n    ",32],["T_PRIVATE","private",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$surrogate",33],";",["T_WHITESPACE","\n    ",33],["T_PRIVATE","private",34],["T_WHITESPACE"," ",34],["T_VARIABLE","$surrogateCacheStrategy",34],";",["T_WHITESPACE","\n    ",34],["T_PRIVATE","private",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$options",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_ARRAY","array",35],"(",")",";",["T_WHITESPACE","\n    ",35],["T_PRIVATE","private",36],["T_WHITESPACE"," ",36],["T_VARIABLE","$traces",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_ARRAY","array",36],"(",")",";",["T_WHITESPACE","\n\n    ",36],["T_DOC_COMMENT","\/**\n     * Constructor.\n     *\n     * The available options are:\n     *\n     *   * debug:                 If true, the traces are added as a HTTP header to ease debugging\n     *\n     *   * default_ttl            The number of seconds that a cache entry should be considered\n     *                            fresh when no explicit freshness information is provided in\n     *                            a response. Explicit Cache-Control or Expires headers\n     *                            override this value. (default: 0)\n     *\n     *   * private_headers        Set of request headers that trigger \"private\" cache-control behavior\n     *                            on responses that don't explicitly state whether the response is\n     *                            public or private via a Cache-Control directive. (default: Authorization and Cookie)\n     *\n     *   * allow_reload           Specifies whether the client can force a cache reload by including a\n     *                            Cache-Control \"no-cache\" directive in the request. Set it to ``true``\n     *                            for compliance with RFC 2616. (default: false)\n     *\n     *   * allow_revalidate       Specifies whether the client can force a cache revalidate by including\n     *                            a Cache-Control \"max-age=0\" directive in the request. Set it to ``true``\n     *                            for compliance with RFC 2616. (default: false)\n     *\n     *   * stale_while_revalidate Specifies the default number of seconds (the granularity is the second as the\n     *                            Response TTL precision is a second) during which the cache can immediately return\n     *                            a stale response while it revalidates it in the background (default: 2).\n     *                            This setting is overridden by the stale-while-revalidate HTTP Cache-Control\n     *                            extension (see RFC 5861).\n     *\n     *   * stale_if_error         Specifies the default number of seconds (the granularity is the second) during which\n     *                            the cache can serve a stale response when an error is encountered (default: 60).\n     *                            This setting is overridden by the stale-if-error HTTP Cache-Control extension\n     *                            (see RFC 5861).\n     *\n     * @param HttpKernelInterface $kernel    An HttpKernelInterface instance\n     * @param StoreInterface      $store     A Store instance\n     * @param SurrogateInterface  $surrogate A SurrogateInterface instance\n     * @param array               $options   An array of options\n     *\/",38],["T_WHITESPACE","\n    ",77],["T_PUBLIC","public",78],["T_WHITESPACE"," ",78],["T_FUNCTION","function",78],["T_WHITESPACE"," ",78],["T_STRING","__construct",78],"(",["T_STRING","HttpKernelInterface",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$kernel",78],",",["T_WHITESPACE"," ",78],["T_STRING","StoreInterface",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$store",78],",",["T_WHITESPACE"," ",78],["T_STRING","SurrogateInterface",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$surrogate",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_STRING","null",78],",",["T_WHITESPACE"," ",78],["T_ARRAY","array",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$options",78],["T_WHITESPACE"," ",78],"=",["T_WHITESPACE"," ",78],["T_ARRAY","array",78],"(",")",")",["T_WHITESPACE","\n    ",78],"{",["T_WHITESPACE","\n        ",79],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","store",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$store",80],";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","kernel",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$kernel",81],";",["T_WHITESPACE","\n        ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","surrogate",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$surrogate",82],";",["T_WHITESPACE","\n\n        ",82],["T_COMMENT","\/\/ needed in case there is a fatal error because the backend is too slow to respond\n",84],["T_WHITESPACE","        ",85],["T_STRING","register_shutdown_function",85],"(",["T_ARRAY","array",85],"(",["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","store",85],",",["T_WHITESPACE"," ",85],["T_CONSTANT_ENCAPSED_STRING","'cleanup'",85],")",")",";",["T_WHITESPACE","\n\n        ",85],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","options",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_STRING","array_merge",87],"(",["T_ARRAY","array",87],"(",["T_WHITESPACE","\n            ",87],["T_CONSTANT_ENCAPSED_STRING","'debug'",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],["T_STRING","false",88],",",["T_WHITESPACE","\n            ",88],["T_CONSTANT_ENCAPSED_STRING","'default_ttl'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_LNUMBER","0",89],",",["T_WHITESPACE","\n            ",89],["T_CONSTANT_ENCAPSED_STRING","'private_headers'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_ARRAY","array",90],"(",["T_CONSTANT_ENCAPSED_STRING","'Authorization'",90],",",["T_WHITESPACE"," ",90],["T_CONSTANT_ENCAPSED_STRING","'Cookie'",90],")",",",["T_WHITESPACE","\n            ",90],["T_CONSTANT_ENCAPSED_STRING","'allow_reload'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],["T_STRING","false",91],",",["T_WHITESPACE","\n            ",91],["T_CONSTANT_ENCAPSED_STRING","'allow_revalidate'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_STRING","false",92],",",["T_WHITESPACE","\n            ",92],["T_CONSTANT_ENCAPSED_STRING","'stale_while_revalidate'",93],["T_WHITESPACE"," ",93],["T_DOUBLE_ARROW","=>",93],["T_WHITESPACE"," ",93],["T_LNUMBER","2",93],",",["T_WHITESPACE","\n            ",93],["T_CONSTANT_ENCAPSED_STRING","'stale_if_error'",94],["T_WHITESPACE"," ",94],["T_DOUBLE_ARROW","=>",94],["T_WHITESPACE"," ",94],["T_LNUMBER","60",94],",",["T_WHITESPACE","\n        ",94],")",",",["T_WHITESPACE"," ",95],["T_VARIABLE","$options",95],")",";",["T_WHITESPACE","\n    ",95],"}",["T_WHITESPACE","\n\n    ",96],["T_DOC_COMMENT","\/**\n     * Gets the current store.\n     *\n     * @return StoreInterface $store A StoreInterface instance\n     *\/",98],["T_WHITESPACE","\n    ",102],["T_PUBLIC","public",103],["T_WHITESPACE"," ",103],["T_FUNCTION","function",103],["T_WHITESPACE"," ",103],["T_STRING","getStore",103],"(",")",["T_WHITESPACE","\n    ",103],"{",["T_WHITESPACE","\n        ",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","store",105],";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Returns an array of events that took place during processing of the last request.\n     *\n     * @return array An array of events\n     *\/",108],["T_WHITESPACE","\n    ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","getTraces",113],"(",")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_RETURN","return",115],["T_WHITESPACE"," ",115],["T_VARIABLE","$this",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","traces",115],";",["T_WHITESPACE","\n    ",115],"}",["T_WHITESPACE","\n\n    ",116],["T_DOC_COMMENT","\/**\n     * Returns a log message for the events of the last request processing.\n     *\n     * @return string A log message\n     *\/",118],["T_WHITESPACE","\n    ",122],["T_PUBLIC","public",123],["T_WHITESPACE"," ",123],["T_FUNCTION","function",123],["T_WHITESPACE"," ",123],["T_STRING","getLog",123],"(",")",["T_WHITESPACE","\n    ",123],"{",["T_WHITESPACE","\n        ",124],["T_VARIABLE","$log",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_ARRAY","array",125],"(",")",";",["T_WHITESPACE","\n        ",125],["T_FOREACH","foreach",126],["T_WHITESPACE"," ",126],"(",["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","traces",126],["T_WHITESPACE"," ",126],["T_AS","as",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$request",126],["T_WHITESPACE"," ",126],["T_DOUBLE_ARROW","=>",126],["T_WHITESPACE"," ",126],["T_VARIABLE","$traces",126],")",["T_WHITESPACE"," ",126],"{",["T_WHITESPACE","\n            ",126],["T_VARIABLE","$log",127],"[","]",["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_STRING","sprintf",127],"(",["T_CONSTANT_ENCAPSED_STRING","'%s: %s'",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$request",127],",",["T_WHITESPACE"," ",127],["T_STRING","implode",127],"(",["T_CONSTANT_ENCAPSED_STRING","', '",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$traces",127],")",")",";",["T_WHITESPACE","\n        ",127],"}",["T_WHITESPACE","\n\n        ",128],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_STRING","implode",130],"(",["T_CONSTANT_ENCAPSED_STRING","'; '",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$log",130],")",";",["T_WHITESPACE","\n    ",130],"}",["T_WHITESPACE","\n\n    ",131],["T_DOC_COMMENT","\/**\n     * Gets the Request instance associated with the master request.\n     *\n     * @return Request A Request instance\n     *\/",133],["T_WHITESPACE","\n    ",137],["T_PUBLIC","public",138],["T_WHITESPACE"," ",138],["T_FUNCTION","function",138],["T_WHITESPACE"," ",138],["T_STRING","getRequest",138],"(",")",["T_WHITESPACE","\n    ",138],"{",["T_WHITESPACE","\n        ",139],["T_RETURN","return",140],["T_WHITESPACE"," ",140],["T_VARIABLE","$this",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","request",140],";",["T_WHITESPACE","\n    ",140],"}",["T_WHITESPACE","\n\n    ",141],["T_DOC_COMMENT","\/**\n     * Gets the Kernel instance.\n     *\n     * @return HttpKernelInterface An HttpKernelInterface instance\n     *\/",143],["T_WHITESPACE","\n    ",147],["T_PUBLIC","public",148],["T_WHITESPACE"," ",148],["T_FUNCTION","function",148],["T_WHITESPACE"," ",148],["T_STRING","getKernel",148],"(",")",["T_WHITESPACE","\n    ",148],"{",["T_WHITESPACE","\n        ",149],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$this",150],["T_OBJECT_OPERATOR","->",150],["T_STRING","kernel",150],";",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Gets the Surrogate instance.\n     *\n     * @return SurrogateInterface A Surrogate instance\n     *\n     * @throws \\LogicException\n     *\/",153],["T_WHITESPACE","\n    ",159],["T_PUBLIC","public",160],["T_WHITESPACE"," ",160],["T_FUNCTION","function",160],["T_WHITESPACE"," ",160],["T_STRING","getSurrogate",160],"(",")",["T_WHITESPACE","\n    ",160],"{",["T_WHITESPACE","\n        ",161],["T_RETURN","return",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","surrogate",162],";",["T_WHITESPACE","\n    ",162],"}",["T_WHITESPACE","\n\n    ",163],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",165],["T_WHITESPACE","\n    ",167],["T_PUBLIC","public",168],["T_WHITESPACE"," ",168],["T_FUNCTION","function",168],["T_WHITESPACE"," ",168],["T_STRING","handle",168],"(",["T_STRING","Request",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$request",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$type",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_STRING","HttpKernelInterface",168],["T_DOUBLE_COLON","::",168],["T_STRING","MASTER_REQUEST",168],",",["T_WHITESPACE"," ",168],["T_VARIABLE","$catch",168],["T_WHITESPACE"," ",168],"=",["T_WHITESPACE"," ",168],["T_STRING","true",168],")",["T_WHITESPACE","\n    ",168],"{",["T_WHITESPACE","\n        ",169],["T_COMMENT","\/\/ FIXME: catch exceptions and implement a 500 error page here? -> in Varnish, there is a built-in error page mechanism\n",170],["T_WHITESPACE","        ",171],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_STRING","HttpKernelInterface",171],["T_DOUBLE_COLON","::",171],["T_STRING","MASTER_REQUEST",171],["T_WHITESPACE"," ",171],["T_IS_IDENTICAL","===",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$type",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n            ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","traces",172],["T_WHITESPACE"," ",172],"=",["T_WHITESPACE"," ",172],["T_ARRAY","array",172],"(",")",";",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","request",173],["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$request",173],";",["T_WHITESPACE","\n            ",173],["T_IF","if",174],["T_WHITESPACE"," ",174],"(",["T_STRING","null",174],["T_WHITESPACE"," ",174],["T_IS_NOT_IDENTICAL","!==",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$this",174],["T_OBJECT_OPERATOR","->",174],["T_STRING","surrogate",174],")",["T_WHITESPACE"," ",174],"{",["T_WHITESPACE","\n                ",174],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","surrogateCacheStrategy",175],["T_WHITESPACE"," ",175],"=",["T_WHITESPACE"," ",175],["T_VARIABLE","$this",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","surrogate",175],["T_OBJECT_OPERATOR","->",175],["T_STRING","createCacheStrategy",175],"(",")",";",["T_WHITESPACE","\n            ",175],"}",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n\n        ",177],["T_VARIABLE","$path",179],["T_WHITESPACE"," ",179],"=",["T_WHITESPACE"," ",179],["T_VARIABLE","$request",179],["T_OBJECT_OPERATOR","->",179],["T_STRING","getPathInfo",179],"(",")",";",["T_WHITESPACE","\n        ",179],["T_IF","if",180],["T_WHITESPACE"," ",180],"(",["T_VARIABLE","$qs",180],["T_WHITESPACE"," ",180],"=",["T_WHITESPACE"," ",180],["T_VARIABLE","$request",180],["T_OBJECT_OPERATOR","->",180],["T_STRING","getQueryString",180],"(",")",")",["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n            ",180],["T_VARIABLE","$path",181],["T_WHITESPACE"," ",181],["T_CONCAT_EQUAL",".=",181],["T_WHITESPACE"," ",181],["T_CONSTANT_ENCAPSED_STRING","'?'",181],".",["T_VARIABLE","$qs",181],";",["T_WHITESPACE","\n        ",181],"}",["T_WHITESPACE","\n        ",182],["T_VARIABLE","$this",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","traces",183],"[",["T_VARIABLE","$request",183],["T_OBJECT_OPERATOR","->",183],["T_STRING","getMethod",183],"(",")",".",["T_CONSTANT_ENCAPSED_STRING","' '",183],".",["T_VARIABLE","$path",183],"]",["T_WHITESPACE"," ",183],"=",["T_WHITESPACE"," ",183],["T_ARRAY","array",183],"(",")",";",["T_WHITESPACE","\n\n        ",183],["T_IF","if",185],["T_WHITESPACE"," ",185],"(","!",["T_VARIABLE","$request",185],["T_OBJECT_OPERATOR","->",185],["T_STRING","isMethodSafe",185],"(",["T_STRING","false",185],")",")",["T_WHITESPACE"," ",185],"{",["T_WHITESPACE","\n            ",185],["T_VARIABLE","$response",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_VARIABLE","$this",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","invalidate",186],"(",["T_VARIABLE","$request",186],",",["T_WHITESPACE"," ",186],["T_VARIABLE","$catch",186],")",";",["T_WHITESPACE","\n        ",186],"}",["T_WHITESPACE"," ",187],["T_ELSEIF","elseif",187],["T_WHITESPACE"," ",187],"(",["T_VARIABLE","$request",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","headers",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","has",187],"(",["T_CONSTANT_ENCAPSED_STRING","'expect'",187],")",["T_WHITESPACE"," ",187],["T_BOOLEAN_OR","||",187],["T_WHITESPACE"," ",187],"!",["T_VARIABLE","$request",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","isMethodCacheable",187],"(",")",")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n            ",187],["T_VARIABLE","$response",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_VARIABLE","$this",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","pass",188],"(",["T_VARIABLE","$request",188],",",["T_WHITESPACE"," ",188],["T_VARIABLE","$catch",188],")",";",["T_WHITESPACE","\n        ",188],"}",["T_WHITESPACE"," ",189],["T_ELSE","else",189],["T_WHITESPACE"," ",189],"{",["T_WHITESPACE","\n            ",189],["T_VARIABLE","$response",190],["T_WHITESPACE"," ",190],"=",["T_WHITESPACE"," ",190],["T_VARIABLE","$this",190],["T_OBJECT_OPERATOR","->",190],["T_STRING","lookup",190],"(",["T_VARIABLE","$request",190],",",["T_WHITESPACE"," ",190],["T_VARIABLE","$catch",190],")",";",["T_WHITESPACE","\n        ",190],"}",["T_WHITESPACE","\n\n        ",191],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","restoreResponseBody",193],"(",["T_VARIABLE","$request",193],",",["T_WHITESPACE"," ",193],["T_VARIABLE","$response",193],")",";",["T_WHITESPACE","\n\n        ",193],["T_VARIABLE","$response",195],["T_OBJECT_OPERATOR","->",195],["T_STRING","setDate",195],"(",["T_NS_SEPARATOR","\\",195],["T_STRING","DateTime",195],["T_DOUBLE_COLON","::",195],["T_STRING","createFromFormat",195],"(",["T_CONSTANT_ENCAPSED_STRING","'U'",195],",",["T_WHITESPACE"," ",195],["T_STRING","time",195],"(",")",",",["T_WHITESPACE"," ",195],["T_NEW","new",195],["T_WHITESPACE"," ",195],["T_NS_SEPARATOR","\\",195],["T_STRING","DateTimeZone",195],"(",["T_CONSTANT_ENCAPSED_STRING","'UTC'",195],")",")",")",";",["T_WHITESPACE","\n\n        ",195],["T_IF","if",197],["T_WHITESPACE"," ",197],"(",["T_STRING","HttpKernelInterface",197],["T_DOUBLE_COLON","::",197],["T_STRING","MASTER_REQUEST",197],["T_WHITESPACE"," ",197],["T_IS_IDENTICAL","===",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$type",197],["T_WHITESPACE"," ",197],["T_BOOLEAN_AND","&&",197],["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","options",197],"[",["T_CONSTANT_ENCAPSED_STRING","'debug'",197],"]",")",["T_WHITESPACE"," ",197],"{",["T_WHITESPACE","\n            ",197],["T_VARIABLE","$response",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","headers",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","set",198],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Symfony-Cache'",198],",",["T_WHITESPACE"," ",198],["T_VARIABLE","$this",198],["T_OBJECT_OPERATOR","->",198],["T_STRING","getLog",198],"(",")",")",";",["T_WHITESPACE","\n        ",198],"}",["T_WHITESPACE","\n\n        ",199],["T_IF","if",201],["T_WHITESPACE"," ",201],"(",["T_STRING","null",201],["T_WHITESPACE"," ",201],["T_IS_NOT_IDENTICAL","!==",201],["T_WHITESPACE"," ",201],["T_VARIABLE","$this",201],["T_OBJECT_OPERATOR","->",201],["T_STRING","surrogate",201],")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n            ",201],["T_IF","if",202],["T_WHITESPACE"," ",202],"(",["T_STRING","HttpKernelInterface",202],["T_DOUBLE_COLON","::",202],["T_STRING","MASTER_REQUEST",202],["T_WHITESPACE"," ",202],["T_IS_IDENTICAL","===",202],["T_WHITESPACE"," ",202],["T_VARIABLE","$type",202],")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n                ",202],["T_VARIABLE","$this",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","surrogateCacheStrategy",203],["T_OBJECT_OPERATOR","->",203],["T_STRING","update",203],"(",["T_VARIABLE","$response",203],")",";",["T_WHITESPACE","\n            ",203],"}",["T_WHITESPACE"," ",204],["T_ELSE","else",204],["T_WHITESPACE"," ",204],"{",["T_WHITESPACE","\n                ",204],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","surrogateCacheStrategy",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","add",205],"(",["T_VARIABLE","$response",205],")",";",["T_WHITESPACE","\n            ",205],"}",["T_WHITESPACE","\n        ",206],"}",["T_WHITESPACE","\n\n        ",207],["T_VARIABLE","$response",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","prepare",209],"(",["T_VARIABLE","$request",209],")",";",["T_WHITESPACE","\n\n        ",209],["T_VARIABLE","$response",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","isNotModified",211],"(",["T_VARIABLE","$request",211],")",";",["T_WHITESPACE","\n\n        ",211],["T_RETURN","return",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$response",213],";",["T_WHITESPACE","\n    ",213],"}",["T_WHITESPACE","\n\n    ",214],["T_DOC_COMMENT","\/**\n     * {@inheritdoc}\n     *\/",216],["T_WHITESPACE","\n    ",218],["T_PUBLIC","public",219],["T_WHITESPACE"," ",219],["T_FUNCTION","function",219],["T_WHITESPACE"," ",219],["T_STRING","terminate",219],"(",["T_STRING","Request",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$request",219],",",["T_WHITESPACE"," ",219],["T_STRING","Response",219],["T_WHITESPACE"," ",219],["T_VARIABLE","$response",219],")",["T_WHITESPACE","\n    ",219],"{",["T_WHITESPACE","\n        ",220],["T_IF","if",221],["T_WHITESPACE"," ",221],"(",["T_VARIABLE","$this",221],["T_OBJECT_OPERATOR","->",221],["T_STRING","getKernel",221],"(",")",["T_WHITESPACE"," ",221],["T_INSTANCEOF","instanceof",221],["T_WHITESPACE"," ",221],["T_STRING","TerminableInterface",221],")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n            ",221],["T_VARIABLE","$this",222],["T_OBJECT_OPERATOR","->",222],["T_STRING","getKernel",222],"(",")",["T_OBJECT_OPERATOR","->",222],["T_STRING","terminate",222],"(",["T_VARIABLE","$request",222],",",["T_WHITESPACE"," ",222],["T_VARIABLE","$response",222],")",";",["T_WHITESPACE","\n        ",222],"}",["T_WHITESPACE","\n    ",223],"}",["T_WHITESPACE","\n\n    ",224],["T_DOC_COMMENT","\/**\n     * Forwards the Request to the backend without storing the Response in the cache.\n     *\n     * @param Request $request A Request instance\n     * @param bool    $catch   Whether to process exceptions\n     *\n     * @return Response A Response instance\n     *\/",226],["T_WHITESPACE","\n    ",233],["T_PROTECTED","protected",234],["T_WHITESPACE"," ",234],["T_FUNCTION","function",234],["T_WHITESPACE"," ",234],["T_STRING","pass",234],"(",["T_STRING","Request",234],["T_WHITESPACE"," ",234],["T_VARIABLE","$request",234],",",["T_WHITESPACE"," ",234],["T_VARIABLE","$catch",234],["T_WHITESPACE"," ",234],"=",["T_WHITESPACE"," ",234],["T_STRING","false",234],")",["T_WHITESPACE","\n    ",234],"{",["T_WHITESPACE","\n        ",235],["T_VARIABLE","$this",236],["T_OBJECT_OPERATOR","->",236],["T_STRING","record",236],"(",["T_VARIABLE","$request",236],",",["T_WHITESPACE"," ",236],["T_CONSTANT_ENCAPSED_STRING","'pass'",236],")",";",["T_WHITESPACE","\n\n        ",236],["T_RETURN","return",238],["T_WHITESPACE"," ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","forward",238],"(",["T_VARIABLE","$request",238],",",["T_WHITESPACE"," ",238],["T_VARIABLE","$catch",238],")",";",["T_WHITESPACE","\n    ",238],"}",["T_WHITESPACE","\n\n    ",239],["T_DOC_COMMENT","\/**\n     * Invalidates non-safe methods (like POST, PUT, and DELETE).\n     *\n     * @param Request $request A Request instance\n     * @param bool    $catch   Whether to process exceptions\n     *\n     * @return Response A Response instance\n     *\n     * @throws \\Exception\n     *\n     * @see RFC2616 13.10\n     *\/",241],["T_WHITESPACE","\n    ",252],["T_PROTECTED","protected",253],["T_WHITESPACE"," ",253],["T_FUNCTION","function",253],["T_WHITESPACE"," ",253],["T_STRING","invalidate",253],"(",["T_STRING","Request",253],["T_WHITESPACE"," ",253],["T_VARIABLE","$request",253],",",["T_WHITESPACE"," ",253],["T_VARIABLE","$catch",253],["T_WHITESPACE"," ",253],"=",["T_WHITESPACE"," ",253],["T_STRING","false",253],")",["T_WHITESPACE","\n    ",253],"{",["T_WHITESPACE","\n        ",254],["T_VARIABLE","$response",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_VARIABLE","$this",255],["T_OBJECT_OPERATOR","->",255],["T_STRING","pass",255],"(",["T_VARIABLE","$request",255],",",["T_WHITESPACE"," ",255],["T_VARIABLE","$catch",255],")",";",["T_WHITESPACE","\n\n        ",255],["T_COMMENT","\/\/ invalidate only when the response is successful\n",257],["T_WHITESPACE","        ",258],["T_IF","if",258],["T_WHITESPACE"," ",258],"(",["T_VARIABLE","$response",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","isSuccessful",258],"(",")",["T_WHITESPACE"," ",258],["T_BOOLEAN_OR","||",258],["T_WHITESPACE"," ",258],["T_VARIABLE","$response",258],["T_OBJECT_OPERATOR","->",258],["T_STRING","isRedirect",258],"(",")",")",["T_WHITESPACE"," ",258],"{",["T_WHITESPACE","\n            ",258],["T_TRY","try",259],["T_WHITESPACE"," ",259],"{",["T_WHITESPACE","\n                ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","store",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","invalidate",260],"(",["T_VARIABLE","$request",260],")",";",["T_WHITESPACE","\n\n                ",260],["T_COMMENT","\/\/ As per the RFC, invalidate Location and Content-Location URLs if present\n",262],["T_WHITESPACE","                ",263],["T_FOREACH","foreach",263],["T_WHITESPACE"," ",263],"(",["T_ARRAY","array",263],"(",["T_CONSTANT_ENCAPSED_STRING","'Location'",263],",",["T_WHITESPACE"," ",263],["T_CONSTANT_ENCAPSED_STRING","'Content-Location'",263],")",["T_WHITESPACE"," ",263],["T_AS","as",263],["T_WHITESPACE"," ",263],["T_VARIABLE","$header",263],")",["T_WHITESPACE"," ",263],"{",["T_WHITESPACE","\n                    ",263],["T_IF","if",264],["T_WHITESPACE"," ",264],"(",["T_VARIABLE","$uri",264],["T_WHITESPACE"," ",264],"=",["T_WHITESPACE"," ",264],["T_VARIABLE","$response",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","headers",264],["T_OBJECT_OPERATOR","->",264],["T_STRING","get",264],"(",["T_VARIABLE","$header",264],")",")",["T_WHITESPACE"," ",264],"{",["T_WHITESPACE","\n                        ",264],["T_VARIABLE","$subRequest",265],["T_WHITESPACE"," ",265],"=",["T_WHITESPACE"," ",265],["T_STRING","Request",265],["T_DOUBLE_COLON","::",265],["T_STRING","create",265],"(",["T_VARIABLE","$uri",265],",",["T_WHITESPACE"," ",265],["T_CONSTANT_ENCAPSED_STRING","'get'",265],",",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",")",",",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",")",",",["T_WHITESPACE"," ",265],["T_ARRAY","array",265],"(",")",",",["T_WHITESPACE"," ",265],["T_VARIABLE","$request",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","server",265],["T_OBJECT_OPERATOR","->",265],["T_STRING","all",265],"(",")",")",";",["T_WHITESPACE","\n\n                        ",265],["T_VARIABLE","$this",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","store",267],["T_OBJECT_OPERATOR","->",267],["T_STRING","invalidate",267],"(",["T_VARIABLE","$subRequest",267],")",";",["T_WHITESPACE","\n                    ",267],"}",["T_WHITESPACE","\n                ",268],"}",["T_WHITESPACE","\n\n                ",269],["T_VARIABLE","$this",271],["T_OBJECT_OPERATOR","->",271],["T_STRING","record",271],"(",["T_VARIABLE","$request",271],",",["T_WHITESPACE"," ",271],["T_CONSTANT_ENCAPSED_STRING","'invalidate'",271],")",";",["T_WHITESPACE","\n            ",271],"}",["T_WHITESPACE"," ",272],["T_CATCH","catch",272],["T_WHITESPACE"," ",272],"(",["T_NS_SEPARATOR","\\",272],["T_STRING","Exception",272],["T_WHITESPACE"," ",272],["T_VARIABLE","$e",272],")",["T_WHITESPACE"," ",272],"{",["T_WHITESPACE","\n                ",272],["T_VARIABLE","$this",273],["T_OBJECT_OPERATOR","->",273],["T_STRING","record",273],"(",["T_VARIABLE","$request",273],",",["T_WHITESPACE"," ",273],["T_CONSTANT_ENCAPSED_STRING","'invalidate-failed'",273],")",";",["T_WHITESPACE","\n\n                ",273],["T_IF","if",275],["T_WHITESPACE"," ",275],"(",["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","options",275],"[",["T_CONSTANT_ENCAPSED_STRING","'debug'",275],"]",")",["T_WHITESPACE"," ",275],"{",["T_WHITESPACE","\n                    ",275],["T_THROW","throw",276],["T_WHITESPACE"," ",276],["T_VARIABLE","$e",276],";",["T_WHITESPACE","\n                ",276],"}",["T_WHITESPACE","\n            ",277],"}",["T_WHITESPACE","\n        ",278],"}",["T_WHITESPACE","\n\n        ",279],["T_RETURN","return",281],["T_WHITESPACE"," ",281],["T_VARIABLE","$response",281],";",["T_WHITESPACE","\n    ",281],"}",["T_WHITESPACE","\n\n    ",282],["T_DOC_COMMENT","\/**\n     * Lookups a Response from the cache for the given Request.\n     *\n     * When a matching cache entry is found and is fresh, it uses it as the\n     * response without forwarding any request to the backend. When a matching\n     * cache entry is found but is stale, it attempts to \"validate\" the entry with\n     * the backend using conditional GET. When no matching cache entry is found,\n     * it triggers \"miss\" processing.\n     *\n     * @param Request $request A Request instance\n     * @param bool    $catch   whether to process exceptions\n     *\n     * @return Response A Response instance\n     *\n     * @throws \\Exception\n     *\/",284],["T_WHITESPACE","\n    ",299],["T_PROTECTED","protected",300],["T_WHITESPACE"," ",300],["T_FUNCTION","function",300],["T_WHITESPACE"," ",300],["T_STRING","lookup",300],"(",["T_STRING","Request",300],["T_WHITESPACE"," ",300],["T_VARIABLE","$request",300],",",["T_WHITESPACE"," ",300],["T_VARIABLE","$catch",300],["T_WHITESPACE"," ",300],"=",["T_WHITESPACE"," ",300],["T_STRING","false",300],")",["T_WHITESPACE","\n    ",300],"{",["T_WHITESPACE","\n        ",301],["T_COMMENT","\/\/ if allow_reload and no-cache Cache-Control, allow a cache reload\n",302],["T_WHITESPACE","        ",303],["T_IF","if",303],["T_WHITESPACE"," ",303],"(",["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","options",303],"[",["T_CONSTANT_ENCAPSED_STRING","'allow_reload'",303],"]",["T_WHITESPACE"," ",303],["T_BOOLEAN_AND","&&",303],["T_WHITESPACE"," ",303],["T_VARIABLE","$request",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","isNoCache",303],"(",")",")",["T_WHITESPACE"," ",303],"{",["T_WHITESPACE","\n            ",303],["T_VARIABLE","$this",304],["T_OBJECT_OPERATOR","->",304],["T_STRING","record",304],"(",["T_VARIABLE","$request",304],",",["T_WHITESPACE"," ",304],["T_CONSTANT_ENCAPSED_STRING","'reload'",304],")",";",["T_WHITESPACE","\n\n            ",304],["T_RETURN","return",306],["T_WHITESPACE"," ",306],["T_VARIABLE","$this",306],["T_OBJECT_OPERATOR","->",306],["T_STRING","fetch",306],"(",["T_VARIABLE","$request",306],",",["T_WHITESPACE"," ",306],["T_VARIABLE","$catch",306],")",";",["T_WHITESPACE","\n        ",306],"}",["T_WHITESPACE","\n\n        ",307],["T_TRY","try",309],["T_WHITESPACE"," ",309],"{",["T_WHITESPACE","\n            ",309],["T_VARIABLE","$entry",310],["T_WHITESPACE"," ",310],"=",["T_WHITESPACE"," ",310],["T_VARIABLE","$this",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","store",310],["T_OBJECT_OPERATOR","->",310],["T_STRING","lookup",310],"(",["T_VARIABLE","$request",310],")",";",["T_WHITESPACE","\n        ",310],"}",["T_WHITESPACE"," ",311],["T_CATCH","catch",311],["T_WHITESPACE"," ",311],"(",["T_NS_SEPARATOR","\\",311],["T_STRING","Exception",311],["T_WHITESPACE"," ",311],["T_VARIABLE","$e",311],")",["T_WHITESPACE"," ",311],"{",["T_WHITESPACE","\n            ",311],["T_VARIABLE","$this",312],["T_OBJECT_OPERATOR","->",312],["T_STRING","record",312],"(",["T_VARIABLE","$request",312],",",["T_WHITESPACE"," ",312],["T_CONSTANT_ENCAPSED_STRING","'lookup-failed'",312],")",";",["T_WHITESPACE","\n\n            ",312],["T_IF","if",314],["T_WHITESPACE"," ",314],"(",["T_VARIABLE","$this",314],["T_OBJECT_OPERATOR","->",314],["T_STRING","options",314],"[",["T_CONSTANT_ENCAPSED_STRING","'debug'",314],"]",")",["T_WHITESPACE"," ",314],"{",["T_WHITESPACE","\n                ",314],["T_THROW","throw",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$e",315],";",["T_WHITESPACE","\n            ",315],"}",["T_WHITESPACE","\n\n            ",316],["T_RETURN","return",318],["T_WHITESPACE"," ",318],["T_VARIABLE","$this",318],["T_OBJECT_OPERATOR","->",318],["T_STRING","pass",318],"(",["T_VARIABLE","$request",318],",",["T_WHITESPACE"," ",318],["T_VARIABLE","$catch",318],")",";",["T_WHITESPACE","\n        ",318],"}",["T_WHITESPACE","\n\n        ",319],["T_IF","if",321],["T_WHITESPACE"," ",321],"(",["T_STRING","null",321],["T_WHITESPACE"," ",321],["T_IS_IDENTICAL","===",321],["T_WHITESPACE"," ",321],["T_VARIABLE","$entry",321],")",["T_WHITESPACE"," ",321],"{",["T_WHITESPACE","\n            ",321],["T_VARIABLE","$this",322],["T_OBJECT_OPERATOR","->",322],["T_STRING","record",322],"(",["T_VARIABLE","$request",322],",",["T_WHITESPACE"," ",322],["T_CONSTANT_ENCAPSED_STRING","'miss'",322],")",";",["T_WHITESPACE","\n\n            ",322],["T_RETURN","return",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$this",324],["T_OBJECT_OPERATOR","->",324],["T_STRING","fetch",324],"(",["T_VARIABLE","$request",324],",",["T_WHITESPACE"," ",324],["T_VARIABLE","$catch",324],")",";",["T_WHITESPACE","\n        ",324],"}",["T_WHITESPACE","\n\n        ",325],["T_IF","if",327],["T_WHITESPACE"," ",327],"(","!",["T_VARIABLE","$this",327],["T_OBJECT_OPERATOR","->",327],["T_STRING","isFreshEnough",327],"(",["T_VARIABLE","$request",327],",",["T_WHITESPACE"," ",327],["T_VARIABLE","$entry",327],")",")",["T_WHITESPACE"," ",327],"{",["T_WHITESPACE","\n            ",327],["T_VARIABLE","$this",328],["T_OBJECT_OPERATOR","->",328],["T_STRING","record",328],"(",["T_VARIABLE","$request",328],",",["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'stale'",328],")",";",["T_WHITESPACE","\n\n            ",328],["T_RETURN","return",330],["T_WHITESPACE"," ",330],["T_VARIABLE","$this",330],["T_OBJECT_OPERATOR","->",330],["T_STRING","validate",330],"(",["T_VARIABLE","$request",330],",",["T_WHITESPACE"," ",330],["T_VARIABLE","$entry",330],",",["T_WHITESPACE"," ",330],["T_VARIABLE","$catch",330],")",";",["T_WHITESPACE","\n        ",330],"}",["T_WHITESPACE","\n\n        ",331],["T_VARIABLE","$this",333],["T_OBJECT_OPERATOR","->",333],["T_STRING","record",333],"(",["T_VARIABLE","$request",333],",",["T_WHITESPACE"," ",333],["T_CONSTANT_ENCAPSED_STRING","'fresh'",333],")",";",["T_WHITESPACE","\n\n        ",333],["T_VARIABLE","$entry",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","headers",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","set",335],"(",["T_CONSTANT_ENCAPSED_STRING","'Age'",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$entry",335],["T_OBJECT_OPERATOR","->",335],["T_STRING","getAge",335],"(",")",")",";",["T_WHITESPACE","\n\n        ",335],["T_RETURN","return",337],["T_WHITESPACE"," ",337],["T_VARIABLE","$entry",337],";",["T_WHITESPACE","\n    ",337],"}",["T_WHITESPACE","\n\n    ",338],["T_DOC_COMMENT","\/**\n     * Validates that a cache entry is fresh.\n     *\n     * The original request is used as a template for a conditional\n     * GET request with the backend.\n     *\n     * @param Request  $request A Request instance\n     * @param Response $entry   A Response instance to validate\n     * @param bool     $catch   Whether to process exceptions\n     *\n     * @return Response A Response instance\n     *\/",340],["T_WHITESPACE","\n    ",351],["T_PROTECTED","protected",352],["T_WHITESPACE"," ",352],["T_FUNCTION","function",352],["T_WHITESPACE"," ",352],["T_STRING","validate",352],"(",["T_STRING","Request",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$request",352],",",["T_WHITESPACE"," ",352],["T_STRING","Response",352],["T_WHITESPACE"," ",352],["T_VARIABLE","$entry",352],",",["T_WHITESPACE"," ",352],["T_VARIABLE","$catch",352],["T_WHITESPACE"," ",352],"=",["T_WHITESPACE"," ",352],["T_STRING","false",352],")",["T_WHITESPACE","\n    ",352],"{",["T_WHITESPACE","\n        ",353],["T_VARIABLE","$subRequest",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_CLONE","clone",354],["T_WHITESPACE"," ",354],["T_VARIABLE","$request",354],";",["T_WHITESPACE","\n\n        ",354],["T_COMMENT","\/\/ send no head requests because we want content\n",356],["T_WHITESPACE","        ",357],["T_IF","if",357],["T_WHITESPACE"," ",357],"(",["T_CONSTANT_ENCAPSED_STRING","'HEAD'",357],["T_WHITESPACE"," ",357],["T_IS_IDENTICAL","===",357],["T_WHITESPACE"," ",357],["T_VARIABLE","$request",357],["T_OBJECT_OPERATOR","->",357],["T_STRING","getMethod",357],"(",")",")",["T_WHITESPACE"," ",357],"{",["T_WHITESPACE","\n            ",357],["T_VARIABLE","$subRequest",358],["T_OBJECT_OPERATOR","->",358],["T_STRING","setMethod",358],"(",["T_CONSTANT_ENCAPSED_STRING","'GET'",358],")",";",["T_WHITESPACE","\n        ",358],"}",["T_WHITESPACE","\n\n        ",359],["T_COMMENT","\/\/ add our cached last-modified validator\n",361],["T_WHITESPACE","        ",362],["T_VARIABLE","$subRequest",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","headers",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","set",362],"(",["T_CONSTANT_ENCAPSED_STRING","'if_modified_since'",362],",",["T_WHITESPACE"," ",362],["T_VARIABLE","$entry",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","headers",362],["T_OBJECT_OPERATOR","->",362],["T_STRING","get",362],"(",["T_CONSTANT_ENCAPSED_STRING","'Last-Modified'",362],")",")",";",["T_WHITESPACE","\n\n        ",362],["T_COMMENT","\/\/ Add our cached etag validator to the environment.\n",364],["T_WHITESPACE","        ",365],["T_COMMENT","\/\/ We keep the etags from the client to handle the case when the client\n",365],["T_WHITESPACE","        ",366],["T_COMMENT","\/\/ has a different private valid entry which is not cached here.\n",366],["T_WHITESPACE","        ",367],["T_VARIABLE","$cachedEtags",367],["T_WHITESPACE"," ",367],"=",["T_WHITESPACE"," ",367],["T_VARIABLE","$entry",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getEtag",367],"(",")",["T_WHITESPACE"," ",367],"?",["T_WHITESPACE"," ",367],["T_ARRAY","array",367],"(",["T_VARIABLE","$entry",367],["T_OBJECT_OPERATOR","->",367],["T_STRING","getEtag",367],"(",")",")",["T_WHITESPACE"," ",367],":",["T_WHITESPACE"," ",367],["T_ARRAY","array",367],"(",")",";",["T_WHITESPACE","\n        ",367],["T_VARIABLE","$requestEtags",368],["T_WHITESPACE"," ",368],"=",["T_WHITESPACE"," ",368],["T_VARIABLE","$request",368],["T_OBJECT_OPERATOR","->",368],["T_STRING","getETags",368],"(",")",";",["T_WHITESPACE","\n        ",368],["T_IF","if",369],["T_WHITESPACE"," ",369],"(",["T_VARIABLE","$etags",369],["T_WHITESPACE"," ",369],"=",["T_WHITESPACE"," ",369],["T_STRING","array_unique",369],"(",["T_STRING","array_merge",369],"(",["T_VARIABLE","$cachedEtags",369],",",["T_WHITESPACE"," ",369],["T_VARIABLE","$requestEtags",369],")",")",")",["T_WHITESPACE"," ",369],"{",["T_WHITESPACE","\n            ",369],["T_VARIABLE","$subRequest",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","headers",370],["T_OBJECT_OPERATOR","->",370],["T_STRING","set",370],"(",["T_CONSTANT_ENCAPSED_STRING","'if_none_match'",370],",",["T_WHITESPACE"," ",370],["T_STRING","implode",370],"(",["T_CONSTANT_ENCAPSED_STRING","', '",370],",",["T_WHITESPACE"," ",370],["T_VARIABLE","$etags",370],")",")",";",["T_WHITESPACE","\n        ",370],"}",["T_WHITESPACE","\n\n        ",371],["T_VARIABLE","$response",373],["T_WHITESPACE"," ",373],"=",["T_WHITESPACE"," ",373],["T_VARIABLE","$this",373],["T_OBJECT_OPERATOR","->",373],["T_STRING","forward",373],"(",["T_VARIABLE","$subRequest",373],",",["T_WHITESPACE"," ",373],["T_VARIABLE","$catch",373],",",["T_WHITESPACE"," ",373],["T_VARIABLE","$entry",373],")",";",["T_WHITESPACE","\n\n        ",373],["T_IF","if",375],["T_WHITESPACE"," ",375],"(",["T_LNUMBER","304",375],["T_WHITESPACE"," ",375],["T_IS_EQUAL","==",375],["T_WHITESPACE"," ",375],["T_VARIABLE","$response",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","getStatusCode",375],"(",")",")",["T_WHITESPACE"," ",375],"{",["T_WHITESPACE","\n            ",375],["T_VARIABLE","$this",376],["T_OBJECT_OPERATOR","->",376],["T_STRING","record",376],"(",["T_VARIABLE","$request",376],",",["T_WHITESPACE"," ",376],["T_CONSTANT_ENCAPSED_STRING","'valid'",376],")",";",["T_WHITESPACE","\n\n            ",376],["T_COMMENT","\/\/ return the response and not the cache entry if the response is valid but not cached\n",378],["T_WHITESPACE","            ",379],["T_VARIABLE","$etag",379],["T_WHITESPACE"," ",379],"=",["T_WHITESPACE"," ",379],["T_VARIABLE","$response",379],["T_OBJECT_OPERATOR","->",379],["T_STRING","getEtag",379],"(",")",";",["T_WHITESPACE","\n            ",379],["T_IF","if",380],["T_WHITESPACE"," ",380],"(",["T_VARIABLE","$etag",380],["T_WHITESPACE"," ",380],["T_BOOLEAN_AND","&&",380],["T_WHITESPACE"," ",380],["T_STRING","in_array",380],"(",["T_VARIABLE","$etag",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$requestEtags",380],")",["T_WHITESPACE"," ",380],["T_BOOLEAN_AND","&&",380],["T_WHITESPACE"," ",380],"!",["T_STRING","in_array",380],"(",["T_VARIABLE","$etag",380],",",["T_WHITESPACE"," ",380],["T_VARIABLE","$cachedEtags",380],")",")",["T_WHITESPACE"," ",380],"{",["T_WHITESPACE","\n                ",380],["T_RETURN","return",381],["T_WHITESPACE"," ",381],["T_VARIABLE","$response",381],";",["T_WHITESPACE","\n            ",381],"}",["T_WHITESPACE","\n\n            ",382],["T_VARIABLE","$entry",384],["T_WHITESPACE"," ",384],"=",["T_WHITESPACE"," ",384],["T_CLONE","clone",384],["T_WHITESPACE"," ",384],["T_VARIABLE","$entry",384],";",["T_WHITESPACE","\n            ",384],["T_VARIABLE","$entry",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","headers",385],["T_OBJECT_OPERATOR","->",385],["T_STRING","remove",385],"(",["T_CONSTANT_ENCAPSED_STRING","'Date'",385],")",";",["T_WHITESPACE","\n\n            ",385],["T_FOREACH","foreach",387],["T_WHITESPACE"," ",387],"(",["T_ARRAY","array",387],"(",["T_CONSTANT_ENCAPSED_STRING","'Date'",387],",",["T_WHITESPACE"," ",387],["T_CONSTANT_ENCAPSED_STRING","'Expires'",387],",",["T_WHITESPACE"," ",387],["T_CONSTANT_ENCAPSED_STRING","'Cache-Control'",387],",",["T_WHITESPACE"," ",387],["T_CONSTANT_ENCAPSED_STRING","'ETag'",387],",",["T_WHITESPACE"," ",387],["T_CONSTANT_ENCAPSED_STRING","'Last-Modified'",387],")",["T_WHITESPACE"," ",387],["T_AS","as",387],["T_WHITESPACE"," ",387],["T_VARIABLE","$name",387],")",["T_WHITESPACE"," ",387],"{",["T_WHITESPACE","\n                ",387],["T_IF","if",388],["T_WHITESPACE"," ",388],"(",["T_VARIABLE","$response",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","headers",388],["T_OBJECT_OPERATOR","->",388],["T_STRING","has",388],"(",["T_VARIABLE","$name",388],")",")",["T_WHITESPACE"," ",388],"{",["T_WHITESPACE","\n                    ",388],["T_VARIABLE","$entry",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","headers",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","set",389],"(",["T_VARIABLE","$name",389],",",["T_WHITESPACE"," ",389],["T_VARIABLE","$response",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","headers",389],["T_OBJECT_OPERATOR","->",389],["T_STRING","get",389],"(",["T_VARIABLE","$name",389],")",")",";",["T_WHITESPACE","\n                ",389],"}",["T_WHITESPACE","\n            ",390],"}",["T_WHITESPACE","\n\n            ",391],["T_VARIABLE","$response",393],["T_WHITESPACE"," ",393],"=",["T_WHITESPACE"," ",393],["T_VARIABLE","$entry",393],";",["T_WHITESPACE","\n        ",393],"}",["T_WHITESPACE"," ",394],["T_ELSE","else",394],["T_WHITESPACE"," ",394],"{",["T_WHITESPACE","\n            ",394],["T_VARIABLE","$this",395],["T_OBJECT_OPERATOR","->",395],["T_STRING","record",395],"(",["T_VARIABLE","$request",395],",",["T_WHITESPACE"," ",395],["T_CONSTANT_ENCAPSED_STRING","'invalid'",395],")",";",["T_WHITESPACE","\n        ",395],"}",["T_WHITESPACE","\n\n        ",396],["T_IF","if",398],["T_WHITESPACE"," ",398],"(",["T_VARIABLE","$response",398],["T_OBJECT_OPERATOR","->",398],["T_STRING","isCacheable",398],"(",")",")",["T_WHITESPACE"," ",398],"{",["T_WHITESPACE","\n            ",398],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","store",399],"(",["T_VARIABLE","$request",399],",",["T_WHITESPACE"," ",399],["T_VARIABLE","$response",399],")",";",["T_WHITESPACE","\n        ",399],"}",["T_WHITESPACE","\n\n        ",400],["T_RETURN","return",402],["T_WHITESPACE"," ",402],["T_VARIABLE","$response",402],";",["T_WHITESPACE","\n    ",402],"}",["T_WHITESPACE","\n\n    ",403],["T_DOC_COMMENT","\/**\n     * Forwards the Request to the backend and determines whether the response should be stored.\n     *\n     * This methods is triggered when the cache missed or a reload is required.\n     *\n     * @param Request $request A Request instance\n     * @param bool    $catch   whether to process exceptions\n     *\n     * @return Response A Response instance\n     *\/",405],["T_WHITESPACE","\n    ",414],["T_PROTECTED","protected",415],["T_WHITESPACE"," ",415],["T_FUNCTION","function",415],["T_WHITESPACE"," ",415],["T_STRING","fetch",415],"(",["T_STRING","Request",415],["T_WHITESPACE"," ",415],["T_VARIABLE","$request",415],",",["T_WHITESPACE"," ",415],["T_VARIABLE","$catch",415],["T_WHITESPACE"," ",415],"=",["T_WHITESPACE"," ",415],["T_STRING","false",415],")",["T_WHITESPACE","\n    ",415],"{",["T_WHITESPACE","\n        ",416],["T_VARIABLE","$subRequest",417],["T_WHITESPACE"," ",417],"=",["T_WHITESPACE"," ",417],["T_CLONE","clone",417],["T_WHITESPACE"," ",417],["T_VARIABLE","$request",417],";",["T_WHITESPACE","\n\n        ",417],["T_COMMENT","\/\/ send no head requests because we want content\n",419],["T_WHITESPACE","        ",420],["T_IF","if",420],["T_WHITESPACE"," ",420],"(",["T_CONSTANT_ENCAPSED_STRING","'HEAD'",420],["T_WHITESPACE"," ",420],["T_IS_IDENTICAL","===",420],["T_WHITESPACE"," ",420],["T_VARIABLE","$request",420],["T_OBJECT_OPERATOR","->",420],["T_STRING","getMethod",420],"(",")",")",["T_WHITESPACE"," ",420],"{",["T_WHITESPACE","\n            ",420],["T_VARIABLE","$subRequest",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","setMethod",421],"(",["T_CONSTANT_ENCAPSED_STRING","'GET'",421],")",";",["T_WHITESPACE","\n        ",421],"}",["T_WHITESPACE","\n\n        ",422],["T_COMMENT","\/\/ avoid that the backend sends no content\n",424],["T_WHITESPACE","        ",425],["T_VARIABLE","$subRequest",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","headers",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","remove",425],"(",["T_CONSTANT_ENCAPSED_STRING","'if_modified_since'",425],")",";",["T_WHITESPACE","\n        ",425],["T_VARIABLE","$subRequest",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","headers",426],["T_OBJECT_OPERATOR","->",426],["T_STRING","remove",426],"(",["T_CONSTANT_ENCAPSED_STRING","'if_none_match'",426],")",";",["T_WHITESPACE","\n\n        ",426],["T_VARIABLE","$response",428],["T_WHITESPACE"," ",428],"=",["T_WHITESPACE"," ",428],["T_VARIABLE","$this",428],["T_OBJECT_OPERATOR","->",428],["T_STRING","forward",428],"(",["T_VARIABLE","$subRequest",428],",",["T_WHITESPACE"," ",428],["T_VARIABLE","$catch",428],")",";",["T_WHITESPACE","\n\n        ",428],["T_IF","if",430],["T_WHITESPACE"," ",430],"(",["T_VARIABLE","$response",430],["T_OBJECT_OPERATOR","->",430],["T_STRING","isCacheable",430],"(",")",")",["T_WHITESPACE"," ",430],"{",["T_WHITESPACE","\n            ",430],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","store",431],"(",["T_VARIABLE","$request",431],",",["T_WHITESPACE"," ",431],["T_VARIABLE","$response",431],")",";",["T_WHITESPACE","\n        ",431],"}",["T_WHITESPACE","\n\n        ",432],["T_RETURN","return",434],["T_WHITESPACE"," ",434],["T_VARIABLE","$response",434],";",["T_WHITESPACE","\n    ",434],"}",["T_WHITESPACE","\n\n    ",435],["T_DOC_COMMENT","\/**\n     * Forwards the Request to the backend and returns the Response.\n     *\n     * @param Request  $request A Request instance\n     * @param bool     $catch   Whether to catch exceptions or not\n     * @param Response $entry   A Response instance (the stale entry if present, null otherwise)\n     *\n     * @return Response A Response instance\n     *\/",437],["T_WHITESPACE","\n    ",445],["T_PROTECTED","protected",446],["T_WHITESPACE"," ",446],["T_FUNCTION","function",446],["T_WHITESPACE"," ",446],["T_STRING","forward",446],"(",["T_STRING","Request",446],["T_WHITESPACE"," ",446],["T_VARIABLE","$request",446],",",["T_WHITESPACE"," ",446],["T_VARIABLE","$catch",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_STRING","false",446],",",["T_WHITESPACE"," ",446],["T_STRING","Response",446],["T_WHITESPACE"," ",446],["T_VARIABLE","$entry",446],["T_WHITESPACE"," ",446],"=",["T_WHITESPACE"," ",446],["T_STRING","null",446],")",["T_WHITESPACE","\n    ",446],"{",["T_WHITESPACE","\n        ",447],["T_IF","if",448],["T_WHITESPACE"," ",448],"(",["T_VARIABLE","$this",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","surrogate",448],")",["T_WHITESPACE"," ",448],"{",["T_WHITESPACE","\n            ",448],["T_VARIABLE","$this",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","surrogate",449],["T_OBJECT_OPERATOR","->",449],["T_STRING","addSurrogateCapability",449],"(",["T_VARIABLE","$request",449],")",";",["T_WHITESPACE","\n        ",449],"}",["T_WHITESPACE","\n\n        ",450],["T_COMMENT","\/\/ modify the X-Forwarded-For header if needed\n",452],["T_WHITESPACE","        ",453],["T_VARIABLE","$forwardedFor",453],["T_WHITESPACE"," ",453],"=",["T_WHITESPACE"," ",453],["T_VARIABLE","$request",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","headers",453],["T_OBJECT_OPERATOR","->",453],["T_STRING","get",453],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Forwarded-For'",453],")",";",["T_WHITESPACE","\n        ",453],["T_IF","if",454],["T_WHITESPACE"," ",454],"(",["T_VARIABLE","$forwardedFor",454],")",["T_WHITESPACE"," ",454],"{",["T_WHITESPACE","\n            ",454],["T_VARIABLE","$request",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","headers",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","set",455],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Forwarded-For'",455],",",["T_WHITESPACE"," ",455],["T_VARIABLE","$forwardedFor",455],".",["T_CONSTANT_ENCAPSED_STRING","', '",455],".",["T_VARIABLE","$request",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","server",455],["T_OBJECT_OPERATOR","->",455],["T_STRING","get",455],"(",["T_CONSTANT_ENCAPSED_STRING","'REMOTE_ADDR'",455],")",")",";",["T_WHITESPACE","\n        ",455],"}",["T_WHITESPACE"," ",456],["T_ELSE","else",456],["T_WHITESPACE"," ",456],"{",["T_WHITESPACE","\n            ",456],["T_VARIABLE","$request",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","headers",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","set",457],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Forwarded-For'",457],",",["T_WHITESPACE"," ",457],["T_VARIABLE","$request",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","server",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","get",457],"(",["T_CONSTANT_ENCAPSED_STRING","'REMOTE_ADDR'",457],")",")",";",["T_WHITESPACE","\n        ",457],"}",["T_WHITESPACE","\n\n        ",458],["T_COMMENT","\/\/ fix the client IP address by setting it to 127.0.0.1 as HttpCache\n",460],["T_WHITESPACE","        ",461],["T_COMMENT","\/\/ is always called from the same process as the backend.\n",461],["T_WHITESPACE","        ",462],["T_VARIABLE","$request",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","server",462],["T_OBJECT_OPERATOR","->",462],["T_STRING","set",462],"(",["T_CONSTANT_ENCAPSED_STRING","'REMOTE_ADDR'",462],",",["T_WHITESPACE"," ",462],["T_CONSTANT_ENCAPSED_STRING","'127.0.0.1'",462],")",";",["T_WHITESPACE","\n\n        ",462],["T_COMMENT","\/\/ make sure HttpCache is a trusted proxy\n",464],["T_WHITESPACE","        ",465],["T_IF","if",465],["T_WHITESPACE"," ",465],"(","!",["T_STRING","in_array",465],"(",["T_CONSTANT_ENCAPSED_STRING","'127.0.0.1'",465],",",["T_WHITESPACE"," ",465],["T_VARIABLE","$trustedProxies",465],["T_WHITESPACE"," ",465],"=",["T_WHITESPACE"," ",465],["T_STRING","Request",465],["T_DOUBLE_COLON","::",465],["T_STRING","getTrustedProxies",465],"(",")",")",")",["T_WHITESPACE"," ",465],"{",["T_WHITESPACE","\n            ",465],["T_VARIABLE","$trustedProxies",466],"[","]",["T_WHITESPACE"," ",466],"=",["T_WHITESPACE"," ",466],["T_CONSTANT_ENCAPSED_STRING","'127.0.0.1'",466],";",["T_WHITESPACE","\n            ",466],["T_STRING","Request",467],["T_DOUBLE_COLON","::",467],["T_STRING","setTrustedProxies",467],"(",["T_VARIABLE","$trustedProxies",467],")",";",["T_WHITESPACE","\n        ",467],"}",["T_WHITESPACE","\n\n        ",468],["T_COMMENT","\/\/ always a \"master\" request (as the real master request can be in cache)\n",470],["T_WHITESPACE","        ",471],["T_VARIABLE","$response",471],["T_WHITESPACE"," ",471],"=",["T_WHITESPACE"," ",471],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","kernel",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","handle",471],"(",["T_VARIABLE","$request",471],",",["T_WHITESPACE"," ",471],["T_STRING","HttpKernelInterface",471],["T_DOUBLE_COLON","::",471],["T_STRING","MASTER_REQUEST",471],",",["T_WHITESPACE"," ",471],["T_VARIABLE","$catch",471],")",";",["T_WHITESPACE","\n        ",471],["T_COMMENT","\/\/ FIXME: we probably need to also catch exceptions if raw === true\n",472],["T_WHITESPACE","\n        ",473],["T_COMMENT","\/\/ we don't implement the stale-if-error on Requests, which is nonetheless part of the RFC\n",474],["T_WHITESPACE","        ",475],["T_IF","if",475],["T_WHITESPACE"," ",475],"(",["T_STRING","null",475],["T_WHITESPACE"," ",475],["T_IS_NOT_IDENTICAL","!==",475],["T_WHITESPACE"," ",475],["T_VARIABLE","$entry",475],["T_WHITESPACE"," ",475],["T_BOOLEAN_AND","&&",475],["T_WHITESPACE"," ",475],["T_STRING","in_array",475],"(",["T_VARIABLE","$response",475],["T_OBJECT_OPERATOR","->",475],["T_STRING","getStatusCode",475],"(",")",",",["T_WHITESPACE"," ",475],["T_ARRAY","array",475],"(",["T_LNUMBER","500",475],",",["T_WHITESPACE"," ",475],["T_LNUMBER","502",475],",",["T_WHITESPACE"," ",475],["T_LNUMBER","503",475],",",["T_WHITESPACE"," ",475],["T_LNUMBER","504",475],")",")",")",["T_WHITESPACE"," ",475],"{",["T_WHITESPACE","\n            ",475],["T_IF","if",476],["T_WHITESPACE"," ",476],"(",["T_STRING","null",476],["T_WHITESPACE"," ",476],["T_IS_IDENTICAL","===",476],["T_WHITESPACE"," ",476],["T_VARIABLE","$age",476],["T_WHITESPACE"," ",476],"=",["T_WHITESPACE"," ",476],["T_VARIABLE","$entry",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","headers",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","getCacheControlDirective",476],"(",["T_CONSTANT_ENCAPSED_STRING","'stale-if-error'",476],")",")",["T_WHITESPACE"," ",476],"{",["T_WHITESPACE","\n                ",476],["T_VARIABLE","$age",477],["T_WHITESPACE"," ",477],"=",["T_WHITESPACE"," ",477],["T_VARIABLE","$this",477],["T_OBJECT_OPERATOR","->",477],["T_STRING","options",477],"[",["T_CONSTANT_ENCAPSED_STRING","'stale_if_error'",477],"]",";",["T_WHITESPACE","\n            ",477],"}",["T_WHITESPACE","\n\n            ",478],["T_IF","if",480],["T_WHITESPACE"," ",480],"(",["T_STRING","abs",480],"(",["T_VARIABLE","$entry",480],["T_OBJECT_OPERATOR","->",480],["T_STRING","getTtl",480],"(",")",")",["T_WHITESPACE"," ",480],"<",["T_WHITESPACE"," ",480],["T_VARIABLE","$age",480],")",["T_WHITESPACE"," ",480],"{",["T_WHITESPACE","\n                ",480],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","record",481],"(",["T_VARIABLE","$request",481],",",["T_WHITESPACE"," ",481],["T_CONSTANT_ENCAPSED_STRING","'stale-if-error'",481],")",";",["T_WHITESPACE","\n\n                ",481],["T_RETURN","return",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$entry",483],";",["T_WHITESPACE","\n            ",483],"}",["T_WHITESPACE","\n        ",484],"}",["T_WHITESPACE","\n\n        ",485],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","processResponseBody",487],"(",["T_VARIABLE","$request",487],",",["T_WHITESPACE"," ",487],["T_VARIABLE","$response",487],")",";",["T_WHITESPACE","\n\n        ",487],["T_IF","if",489],["T_WHITESPACE"," ",489],"(",["T_VARIABLE","$this",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","isPrivateRequest",489],"(",["T_VARIABLE","$request",489],")",["T_WHITESPACE"," ",489],["T_BOOLEAN_AND","&&",489],["T_WHITESPACE"," ",489],"!",["T_VARIABLE","$response",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","headers",489],["T_OBJECT_OPERATOR","->",489],["T_STRING","hasCacheControlDirective",489],"(",["T_CONSTANT_ENCAPSED_STRING","'public'",489],")",")",["T_WHITESPACE"," ",489],"{",["T_WHITESPACE","\n            ",489],["T_VARIABLE","$response",490],["T_OBJECT_OPERATOR","->",490],["T_STRING","setPrivate",490],"(",")",";",["T_WHITESPACE","\n        ",490],"}",["T_WHITESPACE"," ",491],["T_ELSEIF","elseif",491],["T_WHITESPACE"," ",491],"(",["T_VARIABLE","$this",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","options",491],"[",["T_CONSTANT_ENCAPSED_STRING","'default_ttl'",491],"]",["T_WHITESPACE"," ",491],">",["T_WHITESPACE"," ",491],["T_LNUMBER","0",491],["T_WHITESPACE"," ",491],["T_BOOLEAN_AND","&&",491],["T_WHITESPACE"," ",491],["T_STRING","null",491],["T_WHITESPACE"," ",491],["T_IS_IDENTICAL","===",491],["T_WHITESPACE"," ",491],["T_VARIABLE","$response",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getTtl",491],"(",")",["T_WHITESPACE"," ",491],["T_BOOLEAN_AND","&&",491],["T_WHITESPACE"," ",491],"!",["T_VARIABLE","$response",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","headers",491],["T_OBJECT_OPERATOR","->",491],["T_STRING","getCacheControlDirective",491],"(",["T_CONSTANT_ENCAPSED_STRING","'must-revalidate'",491],")",")",["T_WHITESPACE"," ",491],"{",["T_WHITESPACE","\n            ",491],["T_VARIABLE","$response",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","setTtl",492],"(",["T_VARIABLE","$this",492],["T_OBJECT_OPERATOR","->",492],["T_STRING","options",492],"[",["T_CONSTANT_ENCAPSED_STRING","'default_ttl'",492],"]",")",";",["T_WHITESPACE","\n        ",492],"}",["T_WHITESPACE","\n\n        ",493],["T_RETURN","return",495],["T_WHITESPACE"," ",495],["T_VARIABLE","$response",495],";",["T_WHITESPACE","\n    ",495],"}",["T_WHITESPACE","\n\n    ",496],["T_DOC_COMMENT","\/**\n     * Checks whether the cache entry is \"fresh enough\" to satisfy the Request.\n     *\n     * @param Request  $request A Request instance\n     * @param Response $entry   A Response instance\n     *\n     * @return bool true if the cache entry if fresh enough, false otherwise\n     *\/",498],["T_WHITESPACE","\n    ",505],["T_PROTECTED","protected",506],["T_WHITESPACE"," ",506],["T_FUNCTION","function",506],["T_WHITESPACE"," ",506],["T_STRING","isFreshEnough",506],"(",["T_STRING","Request",506],["T_WHITESPACE"," ",506],["T_VARIABLE","$request",506],",",["T_WHITESPACE"," ",506],["T_STRING","Response",506],["T_WHITESPACE"," ",506],["T_VARIABLE","$entry",506],")",["T_WHITESPACE","\n    ",506],"{",["T_WHITESPACE","\n        ",507],["T_IF","if",508],["T_WHITESPACE"," ",508],"(","!",["T_VARIABLE","$entry",508],["T_OBJECT_OPERATOR","->",508],["T_STRING","isFresh",508],"(",")",")",["T_WHITESPACE"," ",508],"{",["T_WHITESPACE","\n            ",508],["T_RETURN","return",509],["T_WHITESPACE"," ",509],["T_VARIABLE","$this",509],["T_OBJECT_OPERATOR","->",509],["T_STRING","lock",509],"(",["T_VARIABLE","$request",509],",",["T_WHITESPACE"," ",509],["T_VARIABLE","$entry",509],")",";",["T_WHITESPACE","\n        ",509],"}",["T_WHITESPACE","\n\n        ",510],["T_IF","if",512],["T_WHITESPACE"," ",512],"(",["T_VARIABLE","$this",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","options",512],"[",["T_CONSTANT_ENCAPSED_STRING","'allow_revalidate'",512],"]",["T_WHITESPACE"," ",512],["T_BOOLEAN_AND","&&",512],["T_WHITESPACE"," ",512],["T_STRING","null",512],["T_WHITESPACE"," ",512],["T_IS_NOT_IDENTICAL","!==",512],["T_WHITESPACE"," ",512],["T_VARIABLE","$maxAge",512],["T_WHITESPACE"," ",512],"=",["T_WHITESPACE"," ",512],["T_VARIABLE","$request",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","headers",512],["T_OBJECT_OPERATOR","->",512],["T_STRING","getCacheControlDirective",512],"(",["T_CONSTANT_ENCAPSED_STRING","'max-age'",512],")",")",["T_WHITESPACE"," ",512],"{",["T_WHITESPACE","\n            ",512],["T_RETURN","return",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$maxAge",513],["T_WHITESPACE"," ",513],">",["T_WHITESPACE"," ",513],["T_LNUMBER","0",513],["T_WHITESPACE"," ",513],["T_BOOLEAN_AND","&&",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$maxAge",513],["T_WHITESPACE"," ",513],["T_IS_GREATER_OR_EQUAL",">=",513],["T_WHITESPACE"," ",513],["T_VARIABLE","$entry",513],["T_OBJECT_OPERATOR","->",513],["T_STRING","getAge",513],"(",")",";",["T_WHITESPACE","\n        ",513],"}",["T_WHITESPACE","\n\n        ",514],["T_RETURN","return",516],["T_WHITESPACE"," ",516],["T_STRING","true",516],";",["T_WHITESPACE","\n    ",516],"}",["T_WHITESPACE","\n\n    ",517],["T_DOC_COMMENT","\/**\n     * Locks a Request during the call to the backend.\n     *\n     * @param Request  $request A Request instance\n     * @param Response $entry   A Response instance\n     *\n     * @return bool true if the cache entry can be returned even if it is staled, false otherwise\n     *\/",519],["T_WHITESPACE","\n    ",526],["T_PROTECTED","protected",527],["T_WHITESPACE"," ",527],["T_FUNCTION","function",527],["T_WHITESPACE"," ",527],["T_STRING","lock",527],"(",["T_STRING","Request",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$request",527],",",["T_WHITESPACE"," ",527],["T_STRING","Response",527],["T_WHITESPACE"," ",527],["T_VARIABLE","$entry",527],")",["T_WHITESPACE","\n    ",527],"{",["T_WHITESPACE","\n        ",528],["T_COMMENT","\/\/ try to acquire a lock to call the backend\n",529],["T_WHITESPACE","        ",530],["T_VARIABLE","$lock",530],["T_WHITESPACE"," ",530],"=",["T_WHITESPACE"," ",530],["T_VARIABLE","$this",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","store",530],["T_OBJECT_OPERATOR","->",530],["T_STRING","lock",530],"(",["T_VARIABLE","$request",530],")",";",["T_WHITESPACE","\n\n        ",530],["T_COMMENT","\/\/ there is already another process calling the backend\n",532],["T_WHITESPACE","        ",533],["T_IF","if",533],["T_WHITESPACE"," ",533],"(",["T_STRING","true",533],["T_WHITESPACE"," ",533],["T_IS_NOT_IDENTICAL","!==",533],["T_WHITESPACE"," ",533],["T_VARIABLE","$lock",533],")",["T_WHITESPACE"," ",533],"{",["T_WHITESPACE","\n            ",533],["T_COMMENT","\/\/ check if we can serve the stale entry\n",534],["T_WHITESPACE","            ",535],["T_IF","if",535],["T_WHITESPACE"," ",535],"(",["T_STRING","null",535],["T_WHITESPACE"," ",535],["T_IS_IDENTICAL","===",535],["T_WHITESPACE"," ",535],["T_VARIABLE","$age",535],["T_WHITESPACE"," ",535],"=",["T_WHITESPACE"," ",535],["T_VARIABLE","$entry",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","headers",535],["T_OBJECT_OPERATOR","->",535],["T_STRING","getCacheControlDirective",535],"(",["T_CONSTANT_ENCAPSED_STRING","'stale-while-revalidate'",535],")",")",["T_WHITESPACE"," ",535],"{",["T_WHITESPACE","\n                ",535],["T_VARIABLE","$age",536],["T_WHITESPACE"," ",536],"=",["T_WHITESPACE"," ",536],["T_VARIABLE","$this",536],["T_OBJECT_OPERATOR","->",536],["T_STRING","options",536],"[",["T_CONSTANT_ENCAPSED_STRING","'stale_while_revalidate'",536],"]",";",["T_WHITESPACE","\n            ",536],"}",["T_WHITESPACE","\n\n            ",537],["T_IF","if",539],["T_WHITESPACE"," ",539],"(",["T_STRING","abs",539],"(",["T_VARIABLE","$entry",539],["T_OBJECT_OPERATOR","->",539],["T_STRING","getTtl",539],"(",")",")",["T_WHITESPACE"," ",539],"<",["T_WHITESPACE"," ",539],["T_VARIABLE","$age",539],")",["T_WHITESPACE"," ",539],"{",["T_WHITESPACE","\n                ",539],["T_VARIABLE","$this",540],["T_OBJECT_OPERATOR","->",540],["T_STRING","record",540],"(",["T_VARIABLE","$request",540],",",["T_WHITESPACE"," ",540],["T_CONSTANT_ENCAPSED_STRING","'stale-while-revalidate'",540],")",";",["T_WHITESPACE","\n\n                ",540],["T_COMMENT","\/\/ server the stale response while there is a revalidation\n",542],["T_WHITESPACE","                ",543],["T_RETURN","return",543],["T_WHITESPACE"," ",543],["T_STRING","true",543],";",["T_WHITESPACE","\n            ",543],"}",["T_WHITESPACE","\n\n            ",544],["T_COMMENT","\/\/ wait for the lock to be released\n",546],["T_WHITESPACE","            ",547],["T_VARIABLE","$wait",547],["T_WHITESPACE"," ",547],"=",["T_WHITESPACE"," ",547],["T_LNUMBER","0",547],";",["T_WHITESPACE","\n            ",547],["T_WHILE","while",548],["T_WHITESPACE"," ",548],"(",["T_VARIABLE","$this",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","store",548],["T_OBJECT_OPERATOR","->",548],["T_STRING","isLocked",548],"(",["T_VARIABLE","$request",548],")",["T_WHITESPACE"," ",548],["T_BOOLEAN_AND","&&",548],["T_WHITESPACE"," ",548],["T_VARIABLE","$wait",548],["T_WHITESPACE"," ",548],"<",["T_WHITESPACE"," ",548],["T_LNUMBER","5000000",548],")",["T_WHITESPACE"," ",548],"{",["T_WHITESPACE","\n                ",548],["T_STRING","usleep",549],"(",["T_LNUMBER","50000",549],")",";",["T_WHITESPACE","\n                ",549],["T_VARIABLE","$wait",550],["T_WHITESPACE"," ",550],["T_PLUS_EQUAL","+=",550],["T_WHITESPACE"," ",550],["T_LNUMBER","50000",550],";",["T_WHITESPACE","\n            ",550],"}",["T_WHITESPACE","\n\n            ",551],["T_IF","if",553],["T_WHITESPACE"," ",553],"(",["T_VARIABLE","$wait",553],["T_WHITESPACE"," ",553],"<",["T_WHITESPACE"," ",553],["T_LNUMBER","5000000",553],")",["T_WHITESPACE"," ",553],"{",["T_WHITESPACE","\n                ",553],["T_COMMENT","\/\/ replace the current entry with the fresh one\n",554],["T_WHITESPACE","                ",555],["T_VARIABLE","$new",555],["T_WHITESPACE"," ",555],"=",["T_WHITESPACE"," ",555],["T_VARIABLE","$this",555],["T_OBJECT_OPERATOR","->",555],["T_STRING","lookup",555],"(",["T_VARIABLE","$request",555],")",";",["T_WHITESPACE","\n                ",555],["T_VARIABLE","$entry",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","headers",556],["T_WHITESPACE"," ",556],"=",["T_WHITESPACE"," ",556],["T_VARIABLE","$new",556],["T_OBJECT_OPERATOR","->",556],["T_STRING","headers",556],";",["T_WHITESPACE","\n                ",556],["T_VARIABLE","$entry",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","setContent",557],"(",["T_VARIABLE","$new",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","getContent",557],"(",")",")",";",["T_WHITESPACE","\n                ",557],["T_VARIABLE","$entry",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","setStatusCode",558],"(",["T_VARIABLE","$new",558],["T_OBJECT_OPERATOR","->",558],["T_STRING","getStatusCode",558],"(",")",")",";",["T_WHITESPACE","\n                ",558],["T_VARIABLE","$entry",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","setProtocolVersion",559],"(",["T_VARIABLE","$new",559],["T_OBJECT_OPERATOR","->",559],["T_STRING","getProtocolVersion",559],"(",")",")",";",["T_WHITESPACE","\n                ",559],["T_FOREACH","foreach",560],["T_WHITESPACE"," ",560],"(",["T_VARIABLE","$new",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","headers",560],["T_OBJECT_OPERATOR","->",560],["T_STRING","getCookies",560],"(",")",["T_WHITESPACE"," ",560],["T_AS","as",560],["T_WHITESPACE"," ",560],["T_VARIABLE","$cookie",560],")",["T_WHITESPACE"," ",560],"{",["T_WHITESPACE","\n                    ",560],["T_VARIABLE","$entry",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","headers",561],["T_OBJECT_OPERATOR","->",561],["T_STRING","setCookie",561],"(",["T_VARIABLE","$cookie",561],")",";",["T_WHITESPACE","\n                ",561],"}",["T_WHITESPACE","\n            ",562],"}",["T_WHITESPACE"," ",563],["T_ELSE","else",563],["T_WHITESPACE"," ",563],"{",["T_WHITESPACE","\n                ",563],["T_COMMENT","\/\/ backend is slow as hell, send a 503 response (to avoid the dog pile effect)\n",564],["T_WHITESPACE","                ",565],["T_VARIABLE","$entry",565],["T_OBJECT_OPERATOR","->",565],["T_STRING","setStatusCode",565],"(",["T_LNUMBER","503",565],")",";",["T_WHITESPACE","\n                ",565],["T_VARIABLE","$entry",566],["T_OBJECT_OPERATOR","->",566],["T_STRING","setContent",566],"(",["T_CONSTANT_ENCAPSED_STRING","'503 Service Unavailable'",566],")",";",["T_WHITESPACE","\n                ",566],["T_VARIABLE","$entry",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","headers",567],["T_OBJECT_OPERATOR","->",567],["T_STRING","set",567],"(",["T_CONSTANT_ENCAPSED_STRING","'Retry-After'",567],",",["T_WHITESPACE"," ",567],["T_LNUMBER","10",567],")",";",["T_WHITESPACE","\n            ",567],"}",["T_WHITESPACE","\n\n            ",568],["T_RETURN","return",570],["T_WHITESPACE"," ",570],["T_STRING","true",570],";",["T_WHITESPACE","\n        ",570],"}",["T_WHITESPACE","\n\n        ",571],["T_COMMENT","\/\/ we have the lock, call the backend\n",573],["T_WHITESPACE","        ",574],["T_RETURN","return",574],["T_WHITESPACE"," ",574],["T_STRING","false",574],";",["T_WHITESPACE","\n    ",574],"}",["T_WHITESPACE","\n\n    ",575],["T_DOC_COMMENT","\/**\n     * Writes the Response to the cache.\n     *\n     * @param Request  $request  A Request instance\n     * @param Response $response A Response instance\n     *\n     * @throws \\Exception\n     *\/",577],["T_WHITESPACE","\n    ",584],["T_PROTECTED","protected",585],["T_WHITESPACE"," ",585],["T_FUNCTION","function",585],["T_WHITESPACE"," ",585],["T_STRING","store",585],"(",["T_STRING","Request",585],["T_WHITESPACE"," ",585],["T_VARIABLE","$request",585],",",["T_WHITESPACE"," ",585],["T_STRING","Response",585],["T_WHITESPACE"," ",585],["T_VARIABLE","$response",585],")",["T_WHITESPACE","\n    ",585],"{",["T_WHITESPACE","\n        ",586],["T_IF","if",587],["T_WHITESPACE"," ",587],"(","!",["T_VARIABLE","$response",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","headers",587],["T_OBJECT_OPERATOR","->",587],["T_STRING","has",587],"(",["T_CONSTANT_ENCAPSED_STRING","'Date'",587],")",")",["T_WHITESPACE"," ",587],"{",["T_WHITESPACE","\n            ",587],["T_VARIABLE","$response",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","setDate",588],"(",["T_NS_SEPARATOR","\\",588],["T_STRING","DateTime",588],["T_DOUBLE_COLON","::",588],["T_STRING","createFromFormat",588],"(",["T_CONSTANT_ENCAPSED_STRING","'U'",588],",",["T_WHITESPACE"," ",588],["T_STRING","time",588],"(",")",")",")",";",["T_WHITESPACE","\n        ",588],"}",["T_WHITESPACE","\n        ",589],["T_TRY","try",590],["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n            ",590],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","store",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","write",591],"(",["T_VARIABLE","$request",591],",",["T_WHITESPACE"," ",591],["T_VARIABLE","$response",591],")",";",["T_WHITESPACE","\n\n            ",591],["T_VARIABLE","$this",593],["T_OBJECT_OPERATOR","->",593],["T_STRING","record",593],"(",["T_VARIABLE","$request",593],",",["T_WHITESPACE"," ",593],["T_CONSTANT_ENCAPSED_STRING","'store'",593],")",";",["T_WHITESPACE","\n\n            ",593],["T_VARIABLE","$response",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","headers",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","set",595],"(",["T_CONSTANT_ENCAPSED_STRING","'Age'",595],",",["T_WHITESPACE"," ",595],["T_VARIABLE","$response",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","getAge",595],"(",")",")",";",["T_WHITESPACE","\n        ",595],"}",["T_WHITESPACE"," ",596],["T_CATCH","catch",596],["T_WHITESPACE"," ",596],"(",["T_NS_SEPARATOR","\\",596],["T_STRING","Exception",596],["T_WHITESPACE"," ",596],["T_VARIABLE","$e",596],")",["T_WHITESPACE"," ",596],"{",["T_WHITESPACE","\n            ",596],["T_VARIABLE","$this",597],["T_OBJECT_OPERATOR","->",597],["T_STRING","record",597],"(",["T_VARIABLE","$request",597],",",["T_WHITESPACE"," ",597],["T_CONSTANT_ENCAPSED_STRING","'store-failed'",597],")",";",["T_WHITESPACE","\n\n            ",597],["T_IF","if",599],["T_WHITESPACE"," ",599],"(",["T_VARIABLE","$this",599],["T_OBJECT_OPERATOR","->",599],["T_STRING","options",599],"[",["T_CONSTANT_ENCAPSED_STRING","'debug'",599],"]",")",["T_WHITESPACE"," ",599],"{",["T_WHITESPACE","\n                ",599],["T_THROW","throw",600],["T_WHITESPACE"," ",600],["T_VARIABLE","$e",600],";",["T_WHITESPACE","\n            ",600],"}",["T_WHITESPACE","\n        ",601],"}",["T_WHITESPACE","\n\n        ",602],["T_COMMENT","\/\/ now that the response is cached, release the lock\n",604],["T_WHITESPACE","        ",605],["T_VARIABLE","$this",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","store",605],["T_OBJECT_OPERATOR","->",605],["T_STRING","unlock",605],"(",["T_VARIABLE","$request",605],")",";",["T_WHITESPACE","\n    ",605],"}",["T_WHITESPACE","\n\n    ",606],["T_DOC_COMMENT","\/**\n     * Restores the Response body.\n     *\n     * @param Request  $request  A Request instance\n     * @param Response $response A Response instance\n     *\/",608],["T_WHITESPACE","\n    ",613],["T_PRIVATE","private",614],["T_WHITESPACE"," ",614],["T_FUNCTION","function",614],["T_WHITESPACE"," ",614],["T_STRING","restoreResponseBody",614],"(",["T_STRING","Request",614],["T_WHITESPACE"," ",614],["T_VARIABLE","$request",614],",",["T_WHITESPACE"," ",614],["T_STRING","Response",614],["T_WHITESPACE"," ",614],["T_VARIABLE","$response",614],")",["T_WHITESPACE","\n    ",614],"{",["T_WHITESPACE","\n        ",615],["T_IF","if",616],["T_WHITESPACE"," ",616],"(",["T_VARIABLE","$request",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","isMethod",616],"(",["T_CONSTANT_ENCAPSED_STRING","'HEAD'",616],")",["T_WHITESPACE"," ",616],["T_BOOLEAN_OR","||",616],["T_WHITESPACE"," ",616],["T_LNUMBER","304",616],["T_WHITESPACE"," ",616],["T_IS_IDENTICAL","===",616],["T_WHITESPACE"," ",616],["T_VARIABLE","$response",616],["T_OBJECT_OPERATOR","->",616],["T_STRING","getStatusCode",616],"(",")",")",["T_WHITESPACE"," ",616],"{",["T_WHITESPACE","\n            ",616],["T_VARIABLE","$response",617],["T_OBJECT_OPERATOR","->",617],["T_STRING","setContent",617],"(",["T_STRING","null",617],")",";",["T_WHITESPACE","\n            ",617],["T_VARIABLE","$response",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","headers",618],["T_OBJECT_OPERATOR","->",618],["T_STRING","remove",618],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-Eval'",618],")",";",["T_WHITESPACE","\n            ",618],["T_VARIABLE","$response",619],["T_OBJECT_OPERATOR","->",619],["T_STRING","headers",619],["T_OBJECT_OPERATOR","->",619],["T_STRING","remove",619],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-File'",619],")",";",["T_WHITESPACE","\n\n            ",619],["T_RETURN","return",621],";",["T_WHITESPACE","\n        ",621],"}",["T_WHITESPACE","\n\n        ",622],["T_IF","if",624],["T_WHITESPACE"," ",624],"(",["T_VARIABLE","$response",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","headers",624],["T_OBJECT_OPERATOR","->",624],["T_STRING","has",624],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-Eval'",624],")",")",["T_WHITESPACE"," ",624],"{",["T_WHITESPACE","\n            ",624],["T_STRING","ob_start",625],"(",")",";",["T_WHITESPACE","\n\n            ",625],["T_IF","if",627],["T_WHITESPACE"," ",627],"(",["T_VARIABLE","$response",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","headers",627],["T_OBJECT_OPERATOR","->",627],["T_STRING","has",627],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-File'",627],")",")",["T_WHITESPACE"," ",627],"{",["T_WHITESPACE","\n                ",627],["T_INCLUDE","include",628],["T_WHITESPACE"," ",628],["T_VARIABLE","$response",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","headers",628],["T_OBJECT_OPERATOR","->",628],["T_STRING","get",628],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-File'",628],")",";",["T_WHITESPACE","\n            ",628],"}",["T_WHITESPACE"," ",629],["T_ELSE","else",629],["T_WHITESPACE"," ",629],"{",["T_WHITESPACE","\n                ",629],["T_EVAL","eval",630],"(",["T_CONSTANT_ENCAPSED_STRING","'; ?>'",630],".",["T_VARIABLE","$response",630],["T_OBJECT_OPERATOR","->",630],["T_STRING","getContent",630],"(",")",".",["T_CONSTANT_ENCAPSED_STRING","'<?php ;'",630],")",";",["T_WHITESPACE","\n            ",630],"}",["T_WHITESPACE","\n\n            ",631],["T_VARIABLE","$response",633],["T_OBJECT_OPERATOR","->",633],["T_STRING","setContent",633],"(",["T_STRING","ob_get_clean",633],"(",")",")",";",["T_WHITESPACE","\n            ",633],["T_VARIABLE","$response",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","headers",634],["T_OBJECT_OPERATOR","->",634],["T_STRING","remove",634],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-Eval'",634],")",";",["T_WHITESPACE","\n            ",634],["T_IF","if",635],["T_WHITESPACE"," ",635],"(","!",["T_VARIABLE","$response",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","headers",635],["T_OBJECT_OPERATOR","->",635],["T_STRING","has",635],"(",["T_CONSTANT_ENCAPSED_STRING","'Transfer-Encoding'",635],")",")",["T_WHITESPACE"," ",635],"{",["T_WHITESPACE","\n                ",635],["T_VARIABLE","$response",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","headers",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","set",636],"(",["T_CONSTANT_ENCAPSED_STRING","'Content-Length'",636],",",["T_WHITESPACE"," ",636],["T_STRING","strlen",636],"(",["T_VARIABLE","$response",636],["T_OBJECT_OPERATOR","->",636],["T_STRING","getContent",636],"(",")",")",")",";",["T_WHITESPACE","\n            ",636],"}",["T_WHITESPACE","\n        ",637],"}",["T_WHITESPACE"," ",638],["T_ELSEIF","elseif",638],["T_WHITESPACE"," ",638],"(",["T_VARIABLE","$response",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","headers",638],["T_OBJECT_OPERATOR","->",638],["T_STRING","has",638],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-File'",638],")",")",["T_WHITESPACE"," ",638],"{",["T_WHITESPACE","\n            ",638],["T_VARIABLE","$response",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","setContent",639],"(",["T_STRING","file_get_contents",639],"(",["T_VARIABLE","$response",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","headers",639],["T_OBJECT_OPERATOR","->",639],["T_STRING","get",639],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-File'",639],")",")",")",";",["T_WHITESPACE","\n        ",639],"}",["T_WHITESPACE"," ",640],["T_ELSE","else",640],["T_WHITESPACE"," ",640],"{",["T_WHITESPACE","\n            ",640],["T_RETURN","return",641],";",["T_WHITESPACE","\n        ",641],"}",["T_WHITESPACE","\n\n        ",642],["T_VARIABLE","$response",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","headers",644],["T_OBJECT_OPERATOR","->",644],["T_STRING","remove",644],"(",["T_CONSTANT_ENCAPSED_STRING","'X-Body-File'",644],")",";",["T_WHITESPACE","\n    ",644],"}",["T_WHITESPACE","\n\n    ",645],["T_PROTECTED","protected",647],["T_WHITESPACE"," ",647],["T_FUNCTION","function",647],["T_WHITESPACE"," ",647],["T_STRING","processResponseBody",647],"(",["T_STRING","Request",647],["T_WHITESPACE"," ",647],["T_VARIABLE","$request",647],",",["T_WHITESPACE"," ",647],["T_STRING","Response",647],["T_WHITESPACE"," ",647],["T_VARIABLE","$response",647],")",["T_WHITESPACE","\n    ",647],"{",["T_WHITESPACE","\n        ",648],["T_IF","if",649],["T_WHITESPACE"," ",649],"(",["T_STRING","null",649],["T_WHITESPACE"," ",649],["T_IS_NOT_IDENTICAL","!==",649],["T_WHITESPACE"," ",649],["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","surrogate",649],["T_WHITESPACE"," ",649],["T_BOOLEAN_AND","&&",649],["T_WHITESPACE"," ",649],["T_VARIABLE","$this",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","surrogate",649],["T_OBJECT_OPERATOR","->",649],["T_STRING","needsParsing",649],"(",["T_VARIABLE","$response",649],")",")",["T_WHITESPACE"," ",649],"{",["T_WHITESPACE","\n            ",649],["T_VARIABLE","$this",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","surrogate",650],["T_OBJECT_OPERATOR","->",650],["T_STRING","process",650],"(",["T_VARIABLE","$request",650],",",["T_WHITESPACE"," ",650],["T_VARIABLE","$response",650],")",";",["T_WHITESPACE","\n        ",650],"}",["T_WHITESPACE","\n    ",651],"}",["T_WHITESPACE","\n\n    ",652],["T_DOC_COMMENT","\/**\n     * Checks if the Request includes authorization or other sensitive information\n     * that should cause the Response to be considered private by default.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return bool true if the Request is private, false otherwise\n     *\/",654],["T_WHITESPACE","\n    ",661],["T_PRIVATE","private",662],["T_WHITESPACE"," ",662],["T_FUNCTION","function",662],["T_WHITESPACE"," ",662],["T_STRING","isPrivateRequest",662],"(",["T_STRING","Request",662],["T_WHITESPACE"," ",662],["T_VARIABLE","$request",662],")",["T_WHITESPACE","\n    ",662],"{",["T_WHITESPACE","\n        ",663],["T_FOREACH","foreach",664],["T_WHITESPACE"," ",664],"(",["T_VARIABLE","$this",664],["T_OBJECT_OPERATOR","->",664],["T_STRING","options",664],"[",["T_CONSTANT_ENCAPSED_STRING","'private_headers'",664],"]",["T_WHITESPACE"," ",664],["T_AS","as",664],["T_WHITESPACE"," ",664],["T_VARIABLE","$key",664],")",["T_WHITESPACE"," ",664],"{",["T_WHITESPACE","\n            ",664],["T_VARIABLE","$key",665],["T_WHITESPACE"," ",665],"=",["T_WHITESPACE"," ",665],["T_STRING","strtolower",665],"(",["T_STRING","str_replace",665],"(",["T_CONSTANT_ENCAPSED_STRING","'HTTP_'",665],",",["T_WHITESPACE"," ",665],["T_CONSTANT_ENCAPSED_STRING","''",665],",",["T_WHITESPACE"," ",665],["T_VARIABLE","$key",665],")",")",";",["T_WHITESPACE","\n\n            ",665],["T_IF","if",667],["T_WHITESPACE"," ",667],"(",["T_CONSTANT_ENCAPSED_STRING","'cookie'",667],["T_WHITESPACE"," ",667],["T_IS_IDENTICAL","===",667],["T_WHITESPACE"," ",667],["T_VARIABLE","$key",667],")",["T_WHITESPACE"," ",667],"{",["T_WHITESPACE","\n                ",667],["T_IF","if",668],["T_WHITESPACE"," ",668],"(",["T_STRING","count",668],"(",["T_VARIABLE","$request",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","cookies",668],["T_OBJECT_OPERATOR","->",668],["T_STRING","all",668],"(",")",")",")",["T_WHITESPACE"," ",668],"{",["T_WHITESPACE","\n                    ",668],["T_RETURN","return",669],["T_WHITESPACE"," ",669],["T_STRING","true",669],";",["T_WHITESPACE","\n                ",669],"}",["T_WHITESPACE","\n            ",670],"}",["T_WHITESPACE"," ",671],["T_ELSEIF","elseif",671],["T_WHITESPACE"," ",671],"(",["T_VARIABLE","$request",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","headers",671],["T_OBJECT_OPERATOR","->",671],["T_STRING","has",671],"(",["T_VARIABLE","$key",671],")",")",["T_WHITESPACE"," ",671],"{",["T_WHITESPACE","\n                ",671],["T_RETURN","return",672],["T_WHITESPACE"," ",672],["T_STRING","true",672],";",["T_WHITESPACE","\n            ",672],"}",["T_WHITESPACE","\n        ",673],"}",["T_WHITESPACE","\n\n        ",674],["T_RETURN","return",676],["T_WHITESPACE"," ",676],["T_STRING","false",676],";",["T_WHITESPACE","\n    ",676],"}",["T_WHITESPACE","\n\n    ",677],["T_DOC_COMMENT","\/**\n     * Records that an event took place.\n     *\n     * @param Request $request A Request instance\n     * @param string  $event   The event name\n     *\/",679],["T_WHITESPACE","\n    ",684],["T_PRIVATE","private",685],["T_WHITESPACE"," ",685],["T_FUNCTION","function",685],["T_WHITESPACE"," ",685],["T_STRING","record",685],"(",["T_STRING","Request",685],["T_WHITESPACE"," ",685],["T_VARIABLE","$request",685],",",["T_WHITESPACE"," ",685],["T_VARIABLE","$event",685],")",["T_WHITESPACE","\n    ",685],"{",["T_WHITESPACE","\n        ",686],["T_VARIABLE","$path",687],["T_WHITESPACE"," ",687],"=",["T_WHITESPACE"," ",687],["T_VARIABLE","$request",687],["T_OBJECT_OPERATOR","->",687],["T_STRING","getPathInfo",687],"(",")",";",["T_WHITESPACE","\n        ",687],["T_IF","if",688],["T_WHITESPACE"," ",688],"(",["T_VARIABLE","$qs",688],["T_WHITESPACE"," ",688],"=",["T_WHITESPACE"," ",688],["T_VARIABLE","$request",688],["T_OBJECT_OPERATOR","->",688],["T_STRING","getQueryString",688],"(",")",")",["T_WHITESPACE"," ",688],"{",["T_WHITESPACE","\n            ",688],["T_VARIABLE","$path",689],["T_WHITESPACE"," ",689],["T_CONCAT_EQUAL",".=",689],["T_WHITESPACE"," ",689],["T_CONSTANT_ENCAPSED_STRING","'?'",689],".",["T_VARIABLE","$qs",689],";",["T_WHITESPACE","\n        ",689],"}",["T_WHITESPACE","\n        ",690],["T_VARIABLE","$this",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","traces",691],"[",["T_VARIABLE","$request",691],["T_OBJECT_OPERATOR","->",691],["T_STRING","getMethod",691],"(",")",".",["T_CONSTANT_ENCAPSED_STRING","' '",691],".",["T_VARIABLE","$path",691],"]","[","]",["T_WHITESPACE"," ",691],"=",["T_WHITESPACE"," ",691],["T_VARIABLE","$event",691],";",["T_WHITESPACE","\n    ",691],"}",["T_WHITESPACE","\n",692],"}",["T_WHITESPACE","\n",693]]