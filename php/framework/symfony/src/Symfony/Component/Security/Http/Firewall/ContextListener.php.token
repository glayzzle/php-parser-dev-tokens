[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_COMMENT","\/*\n * This file is part of the Symfony package.\n *\n * (c) Fabien Potencier <fabien@symfony.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n *\/",3],["T_WHITESPACE","\n\n",10],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Symfony",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Component",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Security",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Http",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Firewall",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Psr",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Log",14],["T_NS_SEPARATOR","\\",14],["T_STRING","LoggerInterface",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpKernel",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Event",15],["T_NS_SEPARATOR","\\",15],["T_STRING","GetResponseEvent",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Symfony",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Component",16],["T_NS_SEPARATOR","\\",16],["T_STRING","HttpKernel",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Event",16],["T_NS_SEPARATOR","\\",16],["T_STRING","FilterResponseEvent",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Symfony",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Component",17],["T_NS_SEPARATOR","\\",17],["T_STRING","HttpKernel",17],["T_NS_SEPARATOR","\\",17],["T_STRING","KernelEvents",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Symfony",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Component",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Security",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Core",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Authentication",18],["T_NS_SEPARATOR","\\",18],["T_STRING","AuthenticationTrustResolver",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Symfony",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Component",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Security",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Core",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Authentication",19],["T_NS_SEPARATOR","\\",19],["T_STRING","AuthenticationTrustResolverInterface",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Symfony",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Component",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Security",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Core",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Authentication",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Token",20],["T_NS_SEPARATOR","\\",20],["T_STRING","AnonymousToken",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Symfony",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Component",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Security",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Core",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Authentication",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Token",21],["T_NS_SEPARATOR","\\",21],["T_STRING","RememberMeToken",21],";",["T_WHITESPACE","\n",21],["T_USE","use",22],["T_WHITESPACE"," ",22],["T_STRING","Symfony",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Component",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Security",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Core",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Authentication",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Token",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Storage",22],["T_NS_SEPARATOR","\\",22],["T_STRING","TokenStorageInterface",22],";",["T_WHITESPACE","\n",22],["T_USE","use",23],["T_WHITESPACE"," ",23],["T_STRING","Symfony",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Component",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Security",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Core",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Authentication",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Token",23],["T_NS_SEPARATOR","\\",23],["T_STRING","TokenInterface",23],";",["T_WHITESPACE","\n",23],["T_USE","use",24],["T_WHITESPACE"," ",24],["T_STRING","Symfony",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Component",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Security",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Core",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Exception",24],["T_NS_SEPARATOR","\\",24],["T_STRING","UsernameNotFoundException",24],";",["T_WHITESPACE","\n",24],["T_USE","use",25],["T_WHITESPACE"," ",25],["T_STRING","Symfony",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Component",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Security",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Core",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Exception",25],["T_NS_SEPARATOR","\\",25],["T_STRING","UnsupportedUserException",25],";",["T_WHITESPACE","\n",25],["T_USE","use",26],["T_WHITESPACE"," ",26],["T_STRING","Symfony",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Component",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Security",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Core",26],["T_NS_SEPARATOR","\\",26],["T_STRING","User",26],["T_NS_SEPARATOR","\\",26],["T_STRING","UserInterface",26],";",["T_WHITESPACE","\n",26],["T_USE","use",27],["T_WHITESPACE"," ",27],["T_STRING","Symfony",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Component",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Security",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Core",27],["T_NS_SEPARATOR","\\",27],["T_STRING","User",27],["T_NS_SEPARATOR","\\",27],["T_STRING","UserProviderInterface",27],";",["T_WHITESPACE","\n",27],["T_USE","use",28],["T_WHITESPACE"," ",28],["T_STRING","Symfony",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Component",28],["T_NS_SEPARATOR","\\",28],["T_STRING","EventDispatcher",28],["T_NS_SEPARATOR","\\",28],["T_STRING","EventDispatcherInterface",28],";",["T_WHITESPACE","\n\n",28],["T_DOC_COMMENT","\/**\n * ContextListener manages the SecurityContext persistence through a session.\n *\n * @author Fabien Potencier <fabien@symfony.com>\n * @author Johannes M. Schmitt <schmittjoh@gmail.com>\n *\/",30],["T_WHITESPACE","\n",35],["T_CLASS","class",36],["T_WHITESPACE"," ",36],["T_STRING","ContextListener",36],["T_WHITESPACE"," ",36],["T_IMPLEMENTS","implements",36],["T_WHITESPACE"," ",36],["T_STRING","ListenerInterface",36],["T_WHITESPACE","\n",36],"{",["T_WHITESPACE","\n    ",37],["T_PRIVATE","private",38],["T_WHITESPACE"," ",38],["T_VARIABLE","$tokenStorage",38],";",["T_WHITESPACE","\n    ",38],["T_PRIVATE","private",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$contextKey",39],";",["T_WHITESPACE","\n    ",39],["T_PRIVATE","private",40],["T_WHITESPACE"," ",40],["T_VARIABLE","$sessionKey",40],";",["T_WHITESPACE","\n    ",40],["T_PRIVATE","private",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$logger",41],";",["T_WHITESPACE","\n    ",41],["T_PRIVATE","private",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$userProviders",42],";",["T_WHITESPACE","\n    ",42],["T_PRIVATE","private",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$dispatcher",43],";",["T_WHITESPACE","\n    ",43],["T_PRIVATE","private",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$registered",44],";",["T_WHITESPACE","\n    ",44],["T_PRIVATE","private",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$trustResolver",45],";",["T_WHITESPACE","\n\n    ",45],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_FUNCTION","function",47],["T_WHITESPACE"," ",47],["T_STRING","__construct",47],"(",["T_STRING","TokenStorageInterface",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$tokenStorage",47],",",["T_WHITESPACE"," ",47],["T_ARRAY","array",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$userProviders",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$contextKey",47],",",["T_WHITESPACE"," ",47],["T_STRING","LoggerInterface",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$logger",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","null",47],",",["T_WHITESPACE"," ",47],["T_STRING","EventDispatcherInterface",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$dispatcher",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","null",47],",",["T_WHITESPACE"," ",47],["T_STRING","AuthenticationTrustResolverInterface",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$trustResolver",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_STRING","null",47],")",["T_WHITESPACE","\n    ",47],"{",["T_WHITESPACE","\n        ",48],["T_IF","if",49],["T_WHITESPACE"," ",49],"(",["T_EMPTY","empty",49],"(",["T_VARIABLE","$contextKey",49],")",")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n            ",49],["T_THROW","throw",50],["T_WHITESPACE"," ",50],["T_NEW","new",50],["T_WHITESPACE"," ",50],["T_NS_SEPARATOR","\\",50],["T_STRING","InvalidArgumentException",50],"(",["T_CONSTANT_ENCAPSED_STRING","'$contextKey must not be empty.'",50],")",";",["T_WHITESPACE","\n        ",50],"}",["T_WHITESPACE","\n\n        ",51],["T_FOREACH","foreach",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$userProviders",53],["T_WHITESPACE"," ",53],["T_AS","as",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$userProvider",53],")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_IF","if",54],["T_WHITESPACE"," ",54],"(","!",["T_VARIABLE","$userProvider",54],["T_WHITESPACE"," ",54],["T_INSTANCEOF","instanceof",54],["T_WHITESPACE"," ",54],["T_STRING","UserProviderInterface",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n                ",54],["T_THROW","throw",55],["T_WHITESPACE"," ",55],["T_NEW","new",55],["T_WHITESPACE"," ",55],["T_NS_SEPARATOR","\\",55],["T_STRING","InvalidArgumentException",55],"(",["T_STRING","sprintf",55],"(",["T_CONSTANT_ENCAPSED_STRING","'User provider \"%s\" must implement \"Symfony\\Component\\Security\\Core\\User\\UserProviderInterface\".'",55],",",["T_WHITESPACE"," ",55],["T_STRING","get_class",55],"(",["T_VARIABLE","$userProvider",55],")",")",")",";",["T_WHITESPACE","\n            ",55],"}",["T_WHITESPACE","\n        ",56],"}",["T_WHITESPACE","\n\n        ",57],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","tokenStorage",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$tokenStorage",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","userProviders",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$userProviders",60],";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","contextKey",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$contextKey",61],";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","sessionKey",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'_security_'",62],".",["T_VARIABLE","$contextKey",62],";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","logger",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$logger",63],";",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","dispatcher",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$dispatcher",64],";",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","trustResolver",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$trustResolver",65],["T_WHITESPACE"," ",65],"?",":",["T_WHITESPACE"," ",65],["T_NEW","new",65],["T_WHITESPACE"," ",65],["T_STRING","AuthenticationTrustResolver",65],"(",["T_STRING","AnonymousToken",65],["T_DOUBLE_COLON","::",65],["T_CLASS","class",65],",",["T_WHITESPACE"," ",65],["T_STRING","RememberMeToken",65],["T_DOUBLE_COLON","::",65],["T_CLASS","class",65],")",";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Reads the Security Token from the session.\n     *\n     * @param GetResponseEvent $event A GetResponseEvent instance\n     *\/",68],["T_WHITESPACE","\n    ",72],["T_PUBLIC","public",73],["T_WHITESPACE"," ",73],["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],["T_STRING","handle",73],"(",["T_STRING","GetResponseEvent",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$event",73],")",["T_WHITESPACE","\n    ",73],"{",["T_WHITESPACE","\n        ",74],["T_IF","if",75],["T_WHITESPACE"," ",75],"(","!",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","registered",75],["T_WHITESPACE"," ",75],["T_BOOLEAN_AND","&&",75],["T_WHITESPACE"," ",75],["T_STRING","null",75],["T_WHITESPACE"," ",75],["T_IS_NOT_IDENTICAL","!==",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","dispatcher",75],["T_WHITESPACE"," ",75],["T_BOOLEAN_AND","&&",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$event",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","isMasterRequest",75],"(",")",")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n            ",75],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","dispatcher",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","addListener",76],"(",["T_STRING","KernelEvents",76],["T_DOUBLE_COLON","::",76],["T_STRING","RESPONSE",76],",",["T_WHITESPACE"," ",76],["T_ARRAY","array",76],"(",["T_VARIABLE","$this",76],",",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'onKernelResponse'",76],")",")",";",["T_WHITESPACE","\n            ",76],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","registered",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_STRING","true",77],";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_VARIABLE","$request",80],["T_WHITESPACE"," ",80],"=",["T_WHITESPACE"," ",80],["T_VARIABLE","$event",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","getRequest",80],"(",")",";",["T_WHITESPACE","\n        ",80],["T_VARIABLE","$session",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],["T_VARIABLE","$request",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","hasPreviousSession",81],"(",")",["T_WHITESPACE"," ",81],"?",["T_WHITESPACE"," ",81],["T_VARIABLE","$request",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","getSession",81],"(",")",["T_WHITESPACE"," ",81],":",["T_WHITESPACE"," ",81],["T_STRING","null",81],";",["T_WHITESPACE","\n\n        ",81],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_STRING","null",83],["T_WHITESPACE"," ",83],["T_IS_IDENTICAL","===",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$session",83],["T_WHITESPACE"," ",83],["T_BOOLEAN_OR","||",83],["T_WHITESPACE"," ",83],["T_STRING","null",83],["T_WHITESPACE"," ",83],["T_IS_IDENTICAL","===",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$token",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$session",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","get",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","sessionKey",83],")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","tokenStorage",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","setToken",84],"(",["T_STRING","null",84],")",";",["T_WHITESPACE","\n\n            ",84],["T_RETURN","return",86],";",["T_WHITESPACE","\n        ",86],"}",["T_WHITESPACE","\n\n        ",87],["T_VARIABLE","$token",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","unserialize",89],"(",["T_VARIABLE","$token",89],")",";",["T_WHITESPACE","\n\n        ",89],["T_IF","if",91],["T_WHITESPACE"," ",91],"(",["T_STRING","null",91],["T_WHITESPACE"," ",91],["T_IS_NOT_IDENTICAL","!==",91],["T_WHITESPACE"," ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","logger",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n            ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","logger",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","debug",92],"(",["T_CONSTANT_ENCAPSED_STRING","'Read existing security token from the session.'",92],",",["T_WHITESPACE"," ",92],["T_ARRAY","array",92],"(",["T_CONSTANT_ENCAPSED_STRING","'key'",92],["T_WHITESPACE"," ",92],["T_DOUBLE_ARROW","=>",92],["T_WHITESPACE"," ",92],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","sessionKey",92],")",")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n\n        ",93],["T_IF","if",95],["T_WHITESPACE"," ",95],"(",["T_VARIABLE","$token",95],["T_WHITESPACE"," ",95],["T_INSTANCEOF","instanceof",95],["T_WHITESPACE"," ",95],["T_STRING","TokenInterface",95],")",["T_WHITESPACE"," ",95],"{",["T_WHITESPACE","\n            ",95],["T_VARIABLE","$token",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_VARIABLE","$this",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","refreshUser",96],"(",["T_VARIABLE","$token",96],")",";",["T_WHITESPACE","\n        ",96],"}",["T_WHITESPACE"," ",97],["T_ELSEIF","elseif",97],["T_WHITESPACE"," ",97],"(",["T_STRING","null",97],["T_WHITESPACE"," ",97],["T_IS_NOT_IDENTICAL","!==",97],["T_WHITESPACE"," ",97],["T_VARIABLE","$token",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_IF","if",98],["T_WHITESPACE"," ",98],"(",["T_STRING","null",98],["T_WHITESPACE"," ",98],["T_IS_NOT_IDENTICAL","!==",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","logger",98],")",["T_WHITESPACE"," ",98],"{",["T_WHITESPACE","\n                ",98],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","logger",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","warning",99],"(",["T_CONSTANT_ENCAPSED_STRING","'Expected a security token from the session, got something else.'",99],",",["T_WHITESPACE"," ",99],["T_ARRAY","array",99],"(",["T_CONSTANT_ENCAPSED_STRING","'key'",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$this",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","sessionKey",99],",",["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'received'",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$token",99],")",")",";",["T_WHITESPACE","\n            ",99],"}",["T_WHITESPACE","\n\n            ",100],["T_VARIABLE","$token",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_STRING","null",102],";",["T_WHITESPACE","\n        ",102],"}",["T_WHITESPACE","\n\n        ",103],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","tokenStorage",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","setToken",105],"(",["T_VARIABLE","$token",105],")",";",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n\n    ",106],["T_DOC_COMMENT","\/**\n     * Writes the security token into the session.\n     *\n     * @param FilterResponseEvent $event A FilterResponseEvent instance\n     *\/",108],["T_WHITESPACE","\n    ",112],["T_PUBLIC","public",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","onKernelResponse",113],"(",["T_STRING","FilterResponseEvent",113],["T_WHITESPACE"," ",113],["T_VARIABLE","$event",113],")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_IF","if",115],["T_WHITESPACE"," ",115],"(","!",["T_VARIABLE","$event",115],["T_OBJECT_OPERATOR","->",115],["T_STRING","isMasterRequest",115],"(",")",")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n            ",115],["T_RETURN","return",116],";",["T_WHITESPACE","\n        ",116],"}",["T_WHITESPACE","\n\n        ",117],["T_IF","if",119],["T_WHITESPACE"," ",119],"(","!",["T_VARIABLE","$event",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","getRequest",119],"(",")",["T_OBJECT_OPERATOR","->",119],["T_STRING","hasSession",119],"(",")",")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n            ",119],["T_RETURN","return",120],";",["T_WHITESPACE","\n        ",120],"}",["T_WHITESPACE","\n\n        ",121],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","dispatcher",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","removeListener",123],"(",["T_STRING","KernelEvents",123],["T_DOUBLE_COLON","::",123],["T_STRING","RESPONSE",123],",",["T_WHITESPACE"," ",123],["T_ARRAY","array",123],"(",["T_VARIABLE","$this",123],",",["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'onKernelResponse'",123],")",")",";",["T_WHITESPACE","\n        ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","registered",124],["T_WHITESPACE"," ",124],"=",["T_WHITESPACE"," ",124],["T_STRING","false",124],";",["T_WHITESPACE","\n\n        ",124],["T_VARIABLE","$request",126],["T_WHITESPACE"," ",126],"=",["T_WHITESPACE"," ",126],["T_VARIABLE","$event",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","getRequest",126],"(",")",";",["T_WHITESPACE","\n        ",126],["T_VARIABLE","$session",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$request",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","getSession",127],"(",")",";",["T_WHITESPACE","\n\n        ",127],["T_IF","if",129],["T_WHITESPACE"," ",129],"(","(",["T_STRING","null",129],["T_WHITESPACE"," ",129],["T_IS_IDENTICAL","===",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$token",129],["T_WHITESPACE"," ",129],"=",["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","tokenStorage",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","getToken",129],"(",")",")",["T_WHITESPACE"," ",129],["T_BOOLEAN_OR","||",129],["T_WHITESPACE"," ",129],["T_VARIABLE","$this",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","trustResolver",129],["T_OBJECT_OPERATOR","->",129],["T_STRING","isAnonymous",129],"(",["T_VARIABLE","$token",129],")",")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n            ",129],["T_IF","if",130],["T_WHITESPACE"," ",130],"(",["T_VARIABLE","$request",130],["T_OBJECT_OPERATOR","->",130],["T_STRING","hasPreviousSession",130],"(",")",")",["T_WHITESPACE"," ",130],"{",["T_WHITESPACE","\n                ",130],["T_VARIABLE","$session",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","remove",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","sessionKey",131],")",";",["T_WHITESPACE","\n            ",131],"}",["T_WHITESPACE","\n        ",132],"}",["T_WHITESPACE"," ",133],["T_ELSE","else",133],["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$session",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","set",134],"(",["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","sessionKey",134],",",["T_WHITESPACE"," ",134],["T_STRING","serialize",134],"(",["T_VARIABLE","$token",134],")",")",";",["T_WHITESPACE","\n\n            ",134],["T_IF","if",136],["T_WHITESPACE"," ",136],"(",["T_STRING","null",136],["T_WHITESPACE"," ",136],["T_IS_NOT_IDENTICAL","!==",136],["T_WHITESPACE"," ",136],["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","logger",136],")",["T_WHITESPACE"," ",136],"{",["T_WHITESPACE","\n                ",136],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","logger",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","debug",137],"(",["T_CONSTANT_ENCAPSED_STRING","'Stored the security token in the session.'",137],",",["T_WHITESPACE"," ",137],["T_ARRAY","array",137],"(",["T_CONSTANT_ENCAPSED_STRING","'key'",137],["T_WHITESPACE"," ",137],["T_DOUBLE_ARROW","=>",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","sessionKey",137],")",")",";",["T_WHITESPACE","\n            ",137],"}",["T_WHITESPACE","\n        ",138],"}",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n\n    ",140],["T_DOC_COMMENT","\/**\n     * Refreshes the user by reloading it from the user provider.\n     *\n     * @param TokenInterface $token\n     *\n     * @return TokenInterface|null\n     *\n     * @throws \\RuntimeException\n     *\/",142],["T_WHITESPACE","\n    ",150],["T_PROTECTED","protected",151],["T_WHITESPACE"," ",151],["T_FUNCTION","function",151],["T_WHITESPACE"," ",151],["T_STRING","refreshUser",151],"(",["T_STRING","TokenInterface",151],["T_WHITESPACE"," ",151],["T_VARIABLE","$token",151],")",["T_WHITESPACE","\n    ",151],"{",["T_WHITESPACE","\n        ",152],["T_VARIABLE","$user",153],["T_WHITESPACE"," ",153],"=",["T_WHITESPACE"," ",153],["T_VARIABLE","$token",153],["T_OBJECT_OPERATOR","->",153],["T_STRING","getUser",153],"(",")",";",["T_WHITESPACE","\n        ",153],["T_IF","if",154],["T_WHITESPACE"," ",154],"(","!",["T_VARIABLE","$user",154],["T_WHITESPACE"," ",154],["T_INSTANCEOF","instanceof",154],["T_WHITESPACE"," ",154],["T_STRING","UserInterface",154],")",["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n            ",154],["T_RETURN","return",155],["T_WHITESPACE"," ",155],["T_VARIABLE","$token",155],";",["T_WHITESPACE","\n        ",155],"}",["T_WHITESPACE","\n\n        ",156],["T_FOREACH","foreach",158],["T_WHITESPACE"," ",158],"(",["T_VARIABLE","$this",158],["T_OBJECT_OPERATOR","->",158],["T_STRING","userProviders",158],["T_WHITESPACE"," ",158],["T_AS","as",158],["T_WHITESPACE"," ",158],["T_VARIABLE","$provider",158],")",["T_WHITESPACE"," ",158],"{",["T_WHITESPACE","\n            ",158],["T_TRY","try",159],["T_WHITESPACE"," ",159],"{",["T_WHITESPACE","\n                ",159],["T_VARIABLE","$refreshedUser",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_VARIABLE","$provider",160],["T_OBJECT_OPERATOR","->",160],["T_STRING","refreshUser",160],"(",["T_VARIABLE","$user",160],")",";",["T_WHITESPACE","\n                ",160],["T_VARIABLE","$token",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","setUser",161],"(",["T_VARIABLE","$refreshedUser",161],")",";",["T_WHITESPACE","\n\n                ",161],["T_IF","if",163],["T_WHITESPACE"," ",163],"(",["T_STRING","null",163],["T_WHITESPACE"," ",163],["T_IS_NOT_IDENTICAL","!==",163],["T_WHITESPACE"," ",163],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","logger",163],")",["T_WHITESPACE"," ",163],"{",["T_WHITESPACE","\n                    ",163],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","logger",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","debug",164],"(",["T_CONSTANT_ENCAPSED_STRING","'User was reloaded from a user provider.'",164],",",["T_WHITESPACE"," ",164],["T_ARRAY","array",164],"(",["T_CONSTANT_ENCAPSED_STRING","'username'",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$refreshedUser",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getUsername",164],"(",")",",",["T_WHITESPACE"," ",164],["T_CONSTANT_ENCAPSED_STRING","'provider'",164],["T_WHITESPACE"," ",164],["T_DOUBLE_ARROW","=>",164],["T_WHITESPACE"," ",164],["T_STRING","get_class",164],"(",["T_VARIABLE","$provider",164],")",")",")",";",["T_WHITESPACE","\n                ",164],"}",["T_WHITESPACE","\n\n                ",165],["T_RETURN","return",167],["T_WHITESPACE"," ",167],["T_VARIABLE","$token",167],";",["T_WHITESPACE","\n            ",167],"}",["T_WHITESPACE"," ",168],["T_CATCH","catch",168],["T_WHITESPACE"," ",168],"(",["T_STRING","UnsupportedUserException",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$e",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n                ",168],["T_COMMENT","\/\/ let's try the next user provider\n",169],["T_WHITESPACE","            ",170],"}",["T_WHITESPACE"," ",170],["T_CATCH","catch",170],["T_WHITESPACE"," ",170],"(",["T_STRING","UsernameNotFoundException",170],["T_WHITESPACE"," ",170],["T_VARIABLE","$e",170],")",["T_WHITESPACE"," ",170],"{",["T_WHITESPACE","\n                ",170],["T_IF","if",171],["T_WHITESPACE"," ",171],"(",["T_STRING","null",171],["T_WHITESPACE"," ",171],["T_IS_NOT_IDENTICAL","!==",171],["T_WHITESPACE"," ",171],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","logger",171],")",["T_WHITESPACE"," ",171],"{",["T_WHITESPACE","\n                    ",171],["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","logger",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","warning",172],"(",["T_CONSTANT_ENCAPSED_STRING","'Username could not be found in the selected user provider.'",172],",",["T_WHITESPACE"," ",172],["T_ARRAY","array",172],"(",["T_CONSTANT_ENCAPSED_STRING","'username'",172],["T_WHITESPACE"," ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_VARIABLE","$e",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getUsername",172],"(",")",",",["T_WHITESPACE"," ",172],["T_CONSTANT_ENCAPSED_STRING","'provider'",172],["T_WHITESPACE"," ",172],["T_DOUBLE_ARROW","=>",172],["T_WHITESPACE"," ",172],["T_STRING","get_class",172],"(",["T_VARIABLE","$provider",172],")",")",")",";",["T_WHITESPACE","\n                ",172],"}",["T_WHITESPACE","\n\n                ",173],["T_RETURN","return",175],";",["T_WHITESPACE","\n            ",175],"}",["T_WHITESPACE","\n        ",176],"}",["T_WHITESPACE","\n\n        ",177],["T_THROW","throw",179],["T_WHITESPACE"," ",179],["T_NEW","new",179],["T_WHITESPACE"," ",179],["T_NS_SEPARATOR","\\",179],["T_STRING","RuntimeException",179],"(",["T_STRING","sprintf",179],"(",["T_CONSTANT_ENCAPSED_STRING","'There is no user provider for user \"%s\".'",179],",",["T_WHITESPACE"," ",179],["T_STRING","get_class",179],"(",["T_VARIABLE","$user",179],")",")",")",";",["T_WHITESPACE","\n    ",179],"}",["T_WHITESPACE","\n",180],"}",["T_WHITESPACE","\n",181]]