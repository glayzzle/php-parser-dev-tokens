[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_COMMENT","\/*\n * This file is part of the Symfony package.\n *\n * (c) Fabien Potencier <fabien@symfony.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n *\/",3],["T_WHITESPACE","\n\n",10],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Symfony",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Component",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Security",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Http",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Firewall",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Symfony",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Component",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Security",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Core",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Exception",14],["T_NS_SEPARATOR","\\",14],["T_STRING","AccessDeniedException",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Security",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Core",15],["T_NS_SEPARATOR","\\",15],["T_STRING","User",15],["T_NS_SEPARATOR","\\",15],["T_STRING","UserInterface",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Symfony",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Component",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Security",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Core",16],["T_NS_SEPARATOR","\\",16],["T_STRING","User",16],["T_NS_SEPARATOR","\\",16],["T_STRING","UserProviderInterface",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Symfony",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Component",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Security",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Core",17],["T_NS_SEPARATOR","\\",17],["T_STRING","User",17],["T_NS_SEPARATOR","\\",17],["T_STRING","UserCheckerInterface",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Symfony",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Component",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Security",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Core",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Authorization",18],["T_NS_SEPARATOR","\\",18],["T_STRING","AccessDecisionManagerInterface",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Psr",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Log",19],["T_NS_SEPARATOR","\\",19],["T_STRING","LoggerInterface",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Symfony",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Component",20],["T_NS_SEPARATOR","\\",20],["T_STRING","HttpKernel",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Event",20],["T_NS_SEPARATOR","\\",20],["T_STRING","GetResponseEvent",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Symfony",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Component",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Security",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Core",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Exception",21],["T_NS_SEPARATOR","\\",21],["T_STRING","AuthenticationException",21],";",["T_WHITESPACE","\n",21],["T_USE","use",22],["T_WHITESPACE"," ",22],["T_STRING","Symfony",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Component",22],["T_NS_SEPARATOR","\\",22],["T_STRING","HttpFoundation",22],["T_NS_SEPARATOR","\\",22],["T_STRING","RedirectResponse",22],";",["T_WHITESPACE","\n",22],["T_USE","use",23],["T_WHITESPACE"," ",23],["T_STRING","Symfony",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Component",23],["T_NS_SEPARATOR","\\",23],["T_STRING","HttpFoundation",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Request",23],";",["T_WHITESPACE","\n",23],["T_USE","use",24],["T_WHITESPACE"," ",24],["T_STRING","Symfony",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Component",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Security",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Core",24],["T_NS_SEPARATOR","\\",24],["T_STRING","Role",24],["T_NS_SEPARATOR","\\",24],["T_STRING","SwitchUserRole",24],";",["T_WHITESPACE","\n",24],["T_USE","use",25],["T_WHITESPACE"," ",25],["T_STRING","Symfony",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Component",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Security",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Core",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Authentication",25],["T_NS_SEPARATOR","\\",25],["T_STRING","Token",25],["T_NS_SEPARATOR","\\",25],["T_STRING","UsernamePasswordToken",25],";",["T_WHITESPACE","\n",25],["T_USE","use",26],["T_WHITESPACE"," ",26],["T_STRING","Symfony",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Component",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Security",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Core",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Authentication",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Token",26],["T_NS_SEPARATOR","\\",26],["T_STRING","Storage",26],["T_NS_SEPARATOR","\\",26],["T_STRING","TokenStorageInterface",26],";",["T_WHITESPACE","\n",26],["T_USE","use",27],["T_WHITESPACE"," ",27],["T_STRING","Symfony",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Component",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Security",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Core",27],["T_NS_SEPARATOR","\\",27],["T_STRING","Exception",27],["T_NS_SEPARATOR","\\",27],["T_STRING","AuthenticationCredentialsNotFoundException",27],";",["T_WHITESPACE","\n",27],["T_USE","use",28],["T_WHITESPACE"," ",28],["T_STRING","Symfony",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Component",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Security",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Core",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Authentication",28],["T_NS_SEPARATOR","\\",28],["T_STRING","Token",28],["T_NS_SEPARATOR","\\",28],["T_STRING","TokenInterface",28],";",["T_WHITESPACE","\n",28],["T_USE","use",29],["T_WHITESPACE"," ",29],["T_STRING","Symfony",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Component",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Security",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Http",29],["T_NS_SEPARATOR","\\",29],["T_STRING","Event",29],["T_NS_SEPARATOR","\\",29],["T_STRING","SwitchUserEvent",29],";",["T_WHITESPACE","\n",29],["T_USE","use",30],["T_WHITESPACE"," ",30],["T_STRING","Symfony",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Component",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Security",30],["T_NS_SEPARATOR","\\",30],["T_STRING","Http",30],["T_NS_SEPARATOR","\\",30],["T_STRING","SecurityEvents",30],";",["T_WHITESPACE","\n",30],["T_USE","use",31],["T_WHITESPACE"," ",31],["T_STRING","Symfony",31],["T_NS_SEPARATOR","\\",31],["T_STRING","Component",31],["T_NS_SEPARATOR","\\",31],["T_STRING","EventDispatcher",31],["T_NS_SEPARATOR","\\",31],["T_STRING","EventDispatcherInterface",31],";",["T_WHITESPACE","\n\n",31],["T_DOC_COMMENT","\/**\n * SwitchUserListener allows a user to impersonate another one temporarily\n * (like the Unix su command).\n *\n * @author Fabien Potencier <fabien@symfony.com>\n *\/",33],["T_WHITESPACE","\n",38],["T_CLASS","class",39],["T_WHITESPACE"," ",39],["T_STRING","SwitchUserListener",39],["T_WHITESPACE"," ",39],["T_IMPLEMENTS","implements",39],["T_WHITESPACE"," ",39],["T_STRING","ListenerInterface",39],["T_WHITESPACE","\n",39],"{",["T_WHITESPACE","\n    ",40],["T_PRIVATE","private",41],["T_WHITESPACE"," ",41],["T_VARIABLE","$tokenStorage",41],";",["T_WHITESPACE","\n    ",41],["T_PRIVATE","private",42],["T_WHITESPACE"," ",42],["T_VARIABLE","$provider",42],";",["T_WHITESPACE","\n    ",42],["T_PRIVATE","private",43],["T_WHITESPACE"," ",43],["T_VARIABLE","$userChecker",43],";",["T_WHITESPACE","\n    ",43],["T_PRIVATE","private",44],["T_WHITESPACE"," ",44],["T_VARIABLE","$providerKey",44],";",["T_WHITESPACE","\n    ",44],["T_PRIVATE","private",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$accessDecisionManager",45],";",["T_WHITESPACE","\n    ",45],["T_PRIVATE","private",46],["T_WHITESPACE"," ",46],["T_VARIABLE","$usernameParameter",46],";",["T_WHITESPACE","\n    ",46],["T_PRIVATE","private",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$role",47],";",["T_WHITESPACE","\n    ",47],["T_PRIVATE","private",48],["T_WHITESPACE"," ",48],["T_VARIABLE","$logger",48],";",["T_WHITESPACE","\n    ",48],["T_PRIVATE","private",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$dispatcher",49],";",["T_WHITESPACE","\n\n    ",49],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","__construct",51],"(",["T_STRING","TokenStorageInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$tokenStorage",51],",",["T_WHITESPACE"," ",51],["T_STRING","UserProviderInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$provider",51],",",["T_WHITESPACE"," ",51],["T_STRING","UserCheckerInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$userChecker",51],",",["T_WHITESPACE"," ",51],["T_VARIABLE","$providerKey",51],",",["T_WHITESPACE"," ",51],["T_STRING","AccessDecisionManagerInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$accessDecisionManager",51],",",["T_WHITESPACE"," ",51],["T_STRING","LoggerInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$logger",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","null",51],",",["T_WHITESPACE"," ",51],["T_VARIABLE","$usernameParameter",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'_switch_user'",51],",",["T_WHITESPACE"," ",51],["T_VARIABLE","$role",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'ROLE_ALLOWED_TO_SWITCH'",51],",",["T_WHITESPACE"," ",51],["T_STRING","EventDispatcherInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$dispatcher",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","null",51],")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_EMPTY","empty",53],"(",["T_VARIABLE","$providerKey",53],")",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_THROW","throw",54],["T_WHITESPACE"," ",54],["T_NEW","new",54],["T_WHITESPACE"," ",54],["T_NS_SEPARATOR","\\",54],["T_STRING","InvalidArgumentException",54],"(",["T_CONSTANT_ENCAPSED_STRING","'$providerKey must not be empty.'",54],")",";",["T_WHITESPACE","\n        ",54],"}",["T_WHITESPACE","\n\n        ",55],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","tokenStorage",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_VARIABLE","$tokenStorage",57],";",["T_WHITESPACE","\n        ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","provider",58],["T_WHITESPACE"," ",58],"=",["T_WHITESPACE"," ",58],["T_VARIABLE","$provider",58],";",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","userChecker",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$userChecker",59],";",["T_WHITESPACE","\n        ",59],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","providerKey",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_VARIABLE","$providerKey",60],";",["T_WHITESPACE","\n        ",60],["T_VARIABLE","$this",61],["T_OBJECT_OPERATOR","->",61],["T_STRING","accessDecisionManager",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_VARIABLE","$accessDecisionManager",61],";",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","usernameParameter",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$usernameParameter",62],";",["T_WHITESPACE","\n        ",62],["T_VARIABLE","$this",63],["T_OBJECT_OPERATOR","->",63],["T_STRING","role",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_VARIABLE","$role",63],";",["T_WHITESPACE","\n        ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","logger",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$logger",64],";",["T_WHITESPACE","\n        ",64],["T_VARIABLE","$this",65],["T_OBJECT_OPERATOR","->",65],["T_STRING","dispatcher",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],["T_VARIABLE","$dispatcher",65],";",["T_WHITESPACE","\n    ",65],"}",["T_WHITESPACE","\n\n    ",66],["T_DOC_COMMENT","\/**\n     * Handles the switch to another user.\n     *\n     * @param GetResponseEvent $event A GetResponseEvent instance\n     *\n     * @throws \\LogicException if switching to a user failed\n     *\/",68],["T_WHITESPACE","\n    ",74],["T_PUBLIC","public",75],["T_WHITESPACE"," ",75],["T_FUNCTION","function",75],["T_WHITESPACE"," ",75],["T_STRING","handle",75],"(",["T_STRING","GetResponseEvent",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$event",75],")",["T_WHITESPACE","\n    ",75],"{",["T_WHITESPACE","\n        ",76],["T_VARIABLE","$request",77],["T_WHITESPACE"," ",77],"=",["T_WHITESPACE"," ",77],["T_VARIABLE","$event",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","getRequest",77],"(",")",";",["T_WHITESPACE","\n\n        ",77],["T_IF","if",79],["T_WHITESPACE"," ",79],"(","!",["T_VARIABLE","$request",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","get",79],"(",["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","usernameParameter",79],")",")",["T_WHITESPACE"," ",79],"{",["T_WHITESPACE","\n            ",79],["T_RETURN","return",80],";",["T_WHITESPACE","\n        ",80],"}",["T_WHITESPACE","\n\n        ",81],["T_IF","if",83],["T_WHITESPACE"," ",83],"(",["T_CONSTANT_ENCAPSED_STRING","'_exit'",83],["T_WHITESPACE"," ",83],["T_IS_IDENTICAL","===",83],["T_WHITESPACE"," ",83],["T_VARIABLE","$request",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","get",83],"(",["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","usernameParameter",83],")",")",["T_WHITESPACE"," ",83],"{",["T_WHITESPACE","\n            ",83],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","tokenStorage",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","setToken",84],"(",["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","attemptExitUser",84],"(",["T_VARIABLE","$request",84],")",")",";",["T_WHITESPACE","\n        ",84],"}",["T_WHITESPACE"," ",85],["T_ELSE","else",85],["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n            ",85],["T_TRY","try",86],["T_WHITESPACE"," ",86],"{",["T_WHITESPACE","\n                ",86],["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","tokenStorage",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","setToken",87],"(",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","attemptSwitchUser",87],"(",["T_VARIABLE","$request",87],")",")",";",["T_WHITESPACE","\n            ",87],"}",["T_WHITESPACE"," ",88],["T_CATCH","catch",88],["T_WHITESPACE"," ",88],"(",["T_STRING","AuthenticationException",88],["T_WHITESPACE"," ",88],["T_VARIABLE","$e",88],")",["T_WHITESPACE"," ",88],"{",["T_WHITESPACE","\n                ",88],["T_THROW","throw",89],["T_WHITESPACE"," ",89],["T_NEW","new",89],["T_WHITESPACE"," ",89],["T_NS_SEPARATOR","\\",89],["T_STRING","LogicException",89],"(",["T_STRING","sprintf",89],"(",["T_CONSTANT_ENCAPSED_STRING","'Switch User failed: \"%s\"'",89],",",["T_WHITESPACE"," ",89],["T_VARIABLE","$e",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getMessage",89],"(",")",")",")",";",["T_WHITESPACE","\n            ",89],"}",["T_WHITESPACE","\n        ",90],"}",["T_WHITESPACE","\n\n        ",91],["T_VARIABLE","$request",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","query",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","remove",93],"(",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","usernameParameter",93],")",";",["T_WHITESPACE","\n        ",93],["T_VARIABLE","$request",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","server",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","set",94],"(",["T_CONSTANT_ENCAPSED_STRING","'QUERY_STRING'",94],",",["T_WHITESPACE"," ",94],["T_STRING","http_build_query",94],"(",["T_VARIABLE","$request",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","query",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","all",94],"(",")",")",")",";",["T_WHITESPACE","\n\n        ",94],["T_VARIABLE","$response",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_NEW","new",96],["T_WHITESPACE"," ",96],["T_STRING","RedirectResponse",96],"(",["T_VARIABLE","$request",96],["T_OBJECT_OPERATOR","->",96],["T_STRING","getUri",96],"(",")",",",["T_WHITESPACE"," ",96],["T_LNUMBER","302",96],")",";",["T_WHITESPACE","\n\n        ",96],["T_VARIABLE","$event",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","setResponse",98],"(",["T_VARIABLE","$response",98],")",";",["T_WHITESPACE","\n    ",98],"}",["T_WHITESPACE","\n\n    ",99],["T_DOC_COMMENT","\/**\n     * Attempts to switch to another user.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return TokenInterface|null The new TokenInterface if successfully switched, null otherwise\n     *\n     * @throws \\LogicException\n     * @throws AccessDeniedException\n     *\/",101],["T_WHITESPACE","\n    ",110],["T_PRIVATE","private",111],["T_WHITESPACE"," ",111],["T_FUNCTION","function",111],["T_WHITESPACE"," ",111],["T_STRING","attemptSwitchUser",111],"(",["T_STRING","Request",111],["T_WHITESPACE"," ",111],["T_VARIABLE","$request",111],")",["T_WHITESPACE","\n    ",111],"{",["T_WHITESPACE","\n        ",112],["T_VARIABLE","$token",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$this",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","tokenStorage",113],["T_OBJECT_OPERATOR","->",113],["T_STRING","getToken",113],"(",")",";",["T_WHITESPACE","\n        ",113],["T_VARIABLE","$originalToken",114],["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_VARIABLE","$this",114],["T_OBJECT_OPERATOR","->",114],["T_STRING","getOriginalToken",114],"(",["T_VARIABLE","$token",114],")",";",["T_WHITESPACE","\n\n        ",114],["T_IF","if",116],["T_WHITESPACE"," ",116],"(",["T_STRING","false",116],["T_WHITESPACE"," ",116],["T_IS_NOT_IDENTICAL","!==",116],["T_WHITESPACE"," ",116],["T_VARIABLE","$originalToken",116],")",["T_WHITESPACE"," ",116],"{",["T_WHITESPACE","\n            ",116],["T_IF","if",117],["T_WHITESPACE"," ",117],"(",["T_VARIABLE","$token",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","getUsername",117],"(",")",["T_WHITESPACE"," ",117],["T_IS_IDENTICAL","===",117],["T_WHITESPACE"," ",117],["T_VARIABLE","$request",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","get",117],"(",["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","usernameParameter",117],")",")",["T_WHITESPACE"," ",117],"{",["T_WHITESPACE","\n                ",117],["T_RETURN","return",118],["T_WHITESPACE"," ",118],["T_VARIABLE","$token",118],";",["T_WHITESPACE","\n            ",118],"}",["T_WHITESPACE","\n\n            ",119],["T_THROW","throw",121],["T_WHITESPACE"," ",121],["T_NEW","new",121],["T_WHITESPACE"," ",121],["T_NS_SEPARATOR","\\",121],["T_STRING","LogicException",121],"(",["T_STRING","sprintf",121],"(",["T_CONSTANT_ENCAPSED_STRING","'You are already switched to \"%s\" user.'",121],",",["T_WHITESPACE"," ",121],["T_VARIABLE","$token",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","getUsername",121],"(",")",")",")",";",["T_WHITESPACE","\n        ",121],"}",["T_WHITESPACE","\n\n        ",122],["T_IF","if",124],["T_WHITESPACE"," ",124],"(",["T_STRING","false",124],["T_WHITESPACE"," ",124],["T_IS_IDENTICAL","===",124],["T_WHITESPACE"," ",124],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","accessDecisionManager",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","decide",124],"(",["T_VARIABLE","$token",124],",",["T_WHITESPACE"," ",124],["T_ARRAY","array",124],"(",["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","role",124],")",")",")",["T_WHITESPACE"," ",124],"{",["T_WHITESPACE","\n            ",124],["T_VARIABLE","$exception",125],["T_WHITESPACE"," ",125],"=",["T_WHITESPACE"," ",125],["T_NEW","new",125],["T_WHITESPACE"," ",125],["T_STRING","AccessDeniedException",125],"(",")",";",["T_WHITESPACE","\n            ",125],["T_VARIABLE","$exception",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","setAttributes",126],"(",["T_VARIABLE","$this",126],["T_OBJECT_OPERATOR","->",126],["T_STRING","role",126],")",";",["T_WHITESPACE","\n\n            ",126],["T_THROW","throw",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$exception",128],";",["T_WHITESPACE","\n        ",128],"}",["T_WHITESPACE","\n\n        ",129],["T_VARIABLE","$username",131],["T_WHITESPACE"," ",131],"=",["T_WHITESPACE"," ",131],["T_VARIABLE","$request",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","get",131],"(",["T_VARIABLE","$this",131],["T_OBJECT_OPERATOR","->",131],["T_STRING","usernameParameter",131],")",";",["T_WHITESPACE","\n\n        ",131],["T_IF","if",133],["T_WHITESPACE"," ",133],"(",["T_STRING","null",133],["T_WHITESPACE"," ",133],["T_IS_NOT_IDENTICAL","!==",133],["T_WHITESPACE"," ",133],["T_VARIABLE","$this",133],["T_OBJECT_OPERATOR","->",133],["T_STRING","logger",133],")",["T_WHITESPACE"," ",133],"{",["T_WHITESPACE","\n            ",133],["T_VARIABLE","$this",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","logger",134],["T_OBJECT_OPERATOR","->",134],["T_STRING","info",134],"(",["T_CONSTANT_ENCAPSED_STRING","'Attempting to switch to user.'",134],",",["T_WHITESPACE"," ",134],["T_ARRAY","array",134],"(",["T_CONSTANT_ENCAPSED_STRING","'username'",134],["T_WHITESPACE"," ",134],["T_DOUBLE_ARROW","=>",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$username",134],")",")",";",["T_WHITESPACE","\n        ",134],"}",["T_WHITESPACE","\n\n        ",135],["T_VARIABLE","$user",137],["T_WHITESPACE"," ",137],"=",["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","provider",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","loadUserByUsername",137],"(",["T_VARIABLE","$username",137],")",";",["T_WHITESPACE","\n        ",137],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","userChecker",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","checkPostAuth",138],"(",["T_VARIABLE","$user",138],")",";",["T_WHITESPACE","\n\n        ",138],["T_VARIABLE","$roles",140],["T_WHITESPACE"," ",140],"=",["T_WHITESPACE"," ",140],["T_VARIABLE","$user",140],["T_OBJECT_OPERATOR","->",140],["T_STRING","getRoles",140],"(",")",";",["T_WHITESPACE","\n        ",140],["T_VARIABLE","$roles",141],"[","]",["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_NEW","new",141],["T_WHITESPACE"," ",141],["T_STRING","SwitchUserRole",141],"(",["T_CONSTANT_ENCAPSED_STRING","'ROLE_PREVIOUS_ADMIN'",141],",",["T_WHITESPACE"," ",141],["T_VARIABLE","$this",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","tokenStorage",141],["T_OBJECT_OPERATOR","->",141],["T_STRING","getToken",141],"(",")",")",";",["T_WHITESPACE","\n\n        ",141],["T_VARIABLE","$token",143],["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_NEW","new",143],["T_WHITESPACE"," ",143],["T_STRING","UsernamePasswordToken",143],"(",["T_VARIABLE","$user",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$user",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","getPassword",143],"(",")",",",["T_WHITESPACE"," ",143],["T_VARIABLE","$this",143],["T_OBJECT_OPERATOR","->",143],["T_STRING","providerKey",143],",",["T_WHITESPACE"," ",143],["T_VARIABLE","$roles",143],")",";",["T_WHITESPACE","\n\n        ",143],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_STRING","null",145],["T_WHITESPACE"," ",145],["T_IS_NOT_IDENTICAL","!==",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$this",145],["T_OBJECT_OPERATOR","->",145],["T_STRING","dispatcher",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n            ",145],["T_VARIABLE","$switchEvent",146],["T_WHITESPACE"," ",146],"=",["T_WHITESPACE"," ",146],["T_NEW","new",146],["T_WHITESPACE"," ",146],["T_STRING","SwitchUserEvent",146],"(",["T_VARIABLE","$request",146],",",["T_WHITESPACE"," ",146],["T_VARIABLE","$token",146],["T_OBJECT_OPERATOR","->",146],["T_STRING","getUser",146],"(",")",")",";",["T_WHITESPACE","\n            ",146],["T_VARIABLE","$this",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","dispatcher",147],["T_OBJECT_OPERATOR","->",147],["T_STRING","dispatch",147],"(",["T_STRING","SecurityEvents",147],["T_DOUBLE_COLON","::",147],["T_STRING","SWITCH_USER",147],",",["T_WHITESPACE"," ",147],["T_VARIABLE","$switchEvent",147],")",";",["T_WHITESPACE","\n        ",147],"}",["T_WHITESPACE","\n\n        ",148],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_VARIABLE","$token",150],";",["T_WHITESPACE","\n    ",150],"}",["T_WHITESPACE","\n\n    ",151],["T_DOC_COMMENT","\/**\n     * Attempts to exit from an already switched user.\n     *\n     * @param Request $request A Request instance\n     *\n     * @return TokenInterface The original TokenInterface instance\n     *\n     * @throws AuthenticationCredentialsNotFoundException\n     *\/",153],["T_WHITESPACE","\n    ",161],["T_PRIVATE","private",162],["T_WHITESPACE"," ",162],["T_FUNCTION","function",162],["T_WHITESPACE"," ",162],["T_STRING","attemptExitUser",162],"(",["T_STRING","Request",162],["T_WHITESPACE"," ",162],["T_VARIABLE","$request",162],")",["T_WHITESPACE","\n    ",162],"{",["T_WHITESPACE","\n        ",163],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_STRING","false",164],["T_WHITESPACE"," ",164],["T_IS_IDENTICAL","===",164],["T_WHITESPACE"," ",164],["T_VARIABLE","$original",164],["T_WHITESPACE"," ",164],"=",["T_WHITESPACE"," ",164],["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getOriginalToken",164],"(",["T_VARIABLE","$this",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","tokenStorage",164],["T_OBJECT_OPERATOR","->",164],["T_STRING","getToken",164],"(",")",")",")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_THROW","throw",165],["T_WHITESPACE"," ",165],["T_NEW","new",165],["T_WHITESPACE"," ",165],["T_STRING","AuthenticationCredentialsNotFoundException",165],"(",["T_CONSTANT_ENCAPSED_STRING","'Could not find original Token object.'",165],")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n\n        ",166],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_STRING","null",168],["T_WHITESPACE"," ",168],["T_IS_NOT_IDENTICAL","!==",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","dispatcher",168],["T_WHITESPACE"," ",168],["T_BOOLEAN_AND","&&",168],["T_WHITESPACE"," ",168],["T_VARIABLE","$original",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","getUser",168],"(",")",["T_WHITESPACE"," ",168],["T_INSTANCEOF","instanceof",168],["T_WHITESPACE"," ",168],["T_STRING","UserInterface",168],")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$user",169],["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","provider",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","refreshUser",169],"(",["T_VARIABLE","$original",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","getUser",169],"(",")",")",";",["T_WHITESPACE","\n            ",169],["T_VARIABLE","$switchEvent",170],["T_WHITESPACE"," ",170],"=",["T_WHITESPACE"," ",170],["T_NEW","new",170],["T_WHITESPACE"," ",170],["T_STRING","SwitchUserEvent",170],"(",["T_VARIABLE","$request",170],",",["T_WHITESPACE"," ",170],["T_VARIABLE","$user",170],")",";",["T_WHITESPACE","\n            ",170],["T_VARIABLE","$this",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","dispatcher",171],["T_OBJECT_OPERATOR","->",171],["T_STRING","dispatch",171],"(",["T_STRING","SecurityEvents",171],["T_DOUBLE_COLON","::",171],["T_STRING","SWITCH_USER",171],",",["T_WHITESPACE"," ",171],["T_VARIABLE","$switchEvent",171],")",";",["T_WHITESPACE","\n        ",171],"}",["T_WHITESPACE","\n\n        ",172],["T_RETURN","return",174],["T_WHITESPACE"," ",174],["T_VARIABLE","$original",174],";",["T_WHITESPACE","\n    ",174],"}",["T_WHITESPACE","\n\n    ",175],["T_DOC_COMMENT","\/**\n     * Gets the original Token from a switched one.\n     *\n     * @param TokenInterface $token A switched TokenInterface instance\n     *\n     * @return TokenInterface|false The original TokenInterface instance, false if the current TokenInterface is not switched\n     *\/",177],["T_WHITESPACE","\n    ",183],["T_PRIVATE","private",184],["T_WHITESPACE"," ",184],["T_FUNCTION","function",184],["T_WHITESPACE"," ",184],["T_STRING","getOriginalToken",184],"(",["T_STRING","TokenInterface",184],["T_WHITESPACE"," ",184],["T_VARIABLE","$token",184],")",["T_WHITESPACE","\n    ",184],"{",["T_WHITESPACE","\n        ",185],["T_FOREACH","foreach",186],["T_WHITESPACE"," ",186],"(",["T_VARIABLE","$token",186],["T_OBJECT_OPERATOR","->",186],["T_STRING","getRoles",186],"(",")",["T_WHITESPACE"," ",186],["T_AS","as",186],["T_WHITESPACE"," ",186],["T_VARIABLE","$role",186],")",["T_WHITESPACE"," ",186],"{",["T_WHITESPACE","\n            ",186],["T_IF","if",187],["T_WHITESPACE"," ",187],"(",["T_VARIABLE","$role",187],["T_WHITESPACE"," ",187],["T_INSTANCEOF","instanceof",187],["T_WHITESPACE"," ",187],["T_STRING","SwitchUserRole",187],")",["T_WHITESPACE"," ",187],"{",["T_WHITESPACE","\n                ",187],["T_RETURN","return",188],["T_WHITESPACE"," ",188],["T_VARIABLE","$role",188],["T_OBJECT_OPERATOR","->",188],["T_STRING","getSource",188],"(",")",";",["T_WHITESPACE","\n            ",188],"}",["T_WHITESPACE","\n        ",189],"}",["T_WHITESPACE","\n\n        ",190],["T_RETURN","return",192],["T_WHITESPACE"," ",192],["T_STRING","false",192],";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n",193],"}",["T_WHITESPACE","\n",194]]