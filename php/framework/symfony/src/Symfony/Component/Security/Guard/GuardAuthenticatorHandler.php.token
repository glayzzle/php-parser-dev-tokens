[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_COMMENT","\/*\n * This file is part of the Symfony package.\n *\n * (c) Fabien Potencier <fabien@symfony.com>\n *\n * For the full copyright and license information, please view the LICENSE\n * file that was distributed with this source code.\n *\/",3],["T_WHITESPACE","\n\n",10],["T_NAMESPACE","namespace",12],["T_WHITESPACE"," ",12],["T_STRING","Symfony",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Component",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Security",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Guard",12],";",["T_WHITESPACE","\n\n",12],["T_USE","use",14],["T_WHITESPACE"," ",14],["T_STRING","Symfony",14],["T_NS_SEPARATOR","\\",14],["T_STRING","Component",14],["T_NS_SEPARATOR","\\",14],["T_STRING","EventDispatcher",14],["T_NS_SEPARATOR","\\",14],["T_STRING","EventDispatcherInterface",14],";",["T_WHITESPACE","\n",14],["T_USE","use",15],["T_WHITESPACE"," ",15],["T_STRING","Symfony",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Component",15],["T_NS_SEPARATOR","\\",15],["T_STRING","HttpFoundation",15],["T_NS_SEPARATOR","\\",15],["T_STRING","Request",15],";",["T_WHITESPACE","\n",15],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","Symfony",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Component",16],["T_NS_SEPARATOR","\\",16],["T_STRING","HttpFoundation",16],["T_NS_SEPARATOR","\\",16],["T_STRING","Response",16],";",["T_WHITESPACE","\n",16],["T_USE","use",17],["T_WHITESPACE"," ",17],["T_STRING","Symfony",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Component",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Security",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Core",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Authentication",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Token",17],["T_NS_SEPARATOR","\\",17],["T_STRING","Storage",17],["T_NS_SEPARATOR","\\",17],["T_STRING","TokenStorageInterface",17],";",["T_WHITESPACE","\n",17],["T_USE","use",18],["T_WHITESPACE"," ",18],["T_STRING","Symfony",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Component",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Security",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Core",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Authentication",18],["T_NS_SEPARATOR","\\",18],["T_STRING","Token",18],["T_NS_SEPARATOR","\\",18],["T_STRING","TokenInterface",18],";",["T_WHITESPACE","\n",18],["T_USE","use",19],["T_WHITESPACE"," ",19],["T_STRING","Symfony",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Component",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Security",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Core",19],["T_NS_SEPARATOR","\\",19],["T_STRING","Exception",19],["T_NS_SEPARATOR","\\",19],["T_STRING","AuthenticationException",19],";",["T_WHITESPACE","\n",19],["T_USE","use",20],["T_WHITESPACE"," ",20],["T_STRING","Symfony",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Component",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Security",20],["T_NS_SEPARATOR","\\",20],["T_STRING","Core",20],["T_NS_SEPARATOR","\\",20],["T_STRING","User",20],["T_NS_SEPARATOR","\\",20],["T_STRING","UserInterface",20],";",["T_WHITESPACE","\n",20],["T_USE","use",21],["T_WHITESPACE"," ",21],["T_STRING","Symfony",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Component",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Security",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Guard",21],["T_NS_SEPARATOR","\\",21],["T_STRING","Token",21],["T_NS_SEPARATOR","\\",21],["T_STRING","PostAuthenticationGuardToken",21],";",["T_WHITESPACE","\n",21],["T_USE","use",22],["T_WHITESPACE"," ",22],["T_STRING","Symfony",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Component",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Security",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Http",22],["T_NS_SEPARATOR","\\",22],["T_STRING","Event",22],["T_NS_SEPARATOR","\\",22],["T_STRING","InteractiveLoginEvent",22],";",["T_WHITESPACE","\n",22],["T_USE","use",23],["T_WHITESPACE"," ",23],["T_STRING","Symfony",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Component",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Security",23],["T_NS_SEPARATOR","\\",23],["T_STRING","Http",23],["T_NS_SEPARATOR","\\",23],["T_STRING","SecurityEvents",23],";",["T_WHITESPACE","\n\n",23],["T_DOC_COMMENT","\/**\n * A utility class that does much of the *work* during the guard authentication process.\n *\n * By having the logic here instead of the listener, more of the process\n * can be called directly (e.g. for manual authentication) or overridden.\n *\n * @author Ryan Weaver <ryan@knpuniversity.com>\n *\/",25],["T_WHITESPACE","\n",32],["T_CLASS","class",33],["T_WHITESPACE"," ",33],["T_STRING","GuardAuthenticatorHandler",33],["T_WHITESPACE","\n",33],"{",["T_WHITESPACE","\n    ",34],["T_PRIVATE","private",35],["T_WHITESPACE"," ",35],["T_VARIABLE","$tokenStorage",35],";",["T_WHITESPACE","\n\n    ",35],["T_PRIVATE","private",37],["T_WHITESPACE"," ",37],["T_VARIABLE","$dispatcher",37],";",["T_WHITESPACE","\n\n    ",37],["T_PUBLIC","public",39],["T_WHITESPACE"," ",39],["T_FUNCTION","function",39],["T_WHITESPACE"," ",39],["T_STRING","__construct",39],"(",["T_STRING","TokenStorageInterface",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$tokenStorage",39],",",["T_WHITESPACE"," ",39],["T_STRING","EventDispatcherInterface",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$eventDispatcher",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_STRING","null",39],")",["T_WHITESPACE","\n    ",39],"{",["T_WHITESPACE","\n        ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","tokenStorage",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$tokenStorage",41],";",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","dispatcher",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$eventDispatcher",42],";",["T_WHITESPACE","\n    ",42],"}",["T_WHITESPACE","\n\n    ",43],["T_DOC_COMMENT","\/**\n     * Authenticates the given token in the system.\n     *\n     * @param TokenInterface $token\n     * @param Request        $request\n     *\/",45],["T_WHITESPACE","\n    ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","authenticateWithToken",51],"(",["T_STRING","TokenInterface",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$token",51],",",["T_WHITESPACE"," ",51],["T_STRING","Request",51],["T_WHITESPACE"," ",51],["T_VARIABLE","$request",51],")",["T_WHITESPACE","\n    ",51],"{",["T_WHITESPACE","\n        ",52],["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","tokenStorage",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","setToken",53],"(",["T_VARIABLE","$token",53],")",";",["T_WHITESPACE","\n\n        ",53],["T_IF","if",55],["T_WHITESPACE"," ",55],"(",["T_STRING","null",55],["T_WHITESPACE"," ",55],["T_IS_NOT_IDENTICAL","!==",55],["T_WHITESPACE"," ",55],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","dispatcher",55],")",["T_WHITESPACE"," ",55],"{",["T_WHITESPACE","\n            ",55],["T_VARIABLE","$loginEvent",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_NEW","new",56],["T_WHITESPACE"," ",56],["T_STRING","InteractiveLoginEvent",56],"(",["T_VARIABLE","$request",56],",",["T_WHITESPACE"," ",56],["T_VARIABLE","$token",56],")",";",["T_WHITESPACE","\n            ",56],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","dispatcher",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","dispatch",57],"(",["T_STRING","SecurityEvents",57],["T_DOUBLE_COLON","::",57],["T_STRING","INTERACTIVE_LOGIN",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$loginEvent",57],")",";",["T_WHITESPACE","\n        ",57],"}",["T_WHITESPACE","\n    ",58],"}",["T_WHITESPACE","\n\n    ",59],["T_DOC_COMMENT","\/**\n     * Returns the \"on success\" response for the given GuardAuthenticator.\n     *\n     * @param TokenInterface              $token\n     * @param Request                     $request\n     * @param GuardAuthenticatorInterface $guardAuthenticator\n     * @param string                      $providerKey        The provider (i.e. firewall) key\n     *\n     * @return null|Response\n     *\/",61],["T_WHITESPACE","\n    ",70],["T_PUBLIC","public",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","handleAuthenticationSuccess",71],"(",["T_STRING","TokenInterface",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$token",71],",",["T_WHITESPACE"," ",71],["T_STRING","Request",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$request",71],",",["T_WHITESPACE"," ",71],["T_STRING","GuardAuthenticatorInterface",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$guardAuthenticator",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$providerKey",71],")",["T_WHITESPACE","\n    ",71],"{",["T_WHITESPACE","\n        ",72],["T_VARIABLE","$response",73],["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_VARIABLE","$guardAuthenticator",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","onAuthenticationSuccess",73],"(",["T_VARIABLE","$request",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$token",73],",",["T_WHITESPACE"," ",73],["T_VARIABLE","$providerKey",73],")",";",["T_WHITESPACE","\n\n        ",73],["T_COMMENT","\/\/ check that it's a Response or null\n",75],["T_WHITESPACE","        ",76],["T_IF","if",76],["T_WHITESPACE"," ",76],"(",["T_VARIABLE","$response",76],["T_WHITESPACE"," ",76],["T_INSTANCEOF","instanceof",76],["T_WHITESPACE"," ",76],["T_STRING","Response",76],["T_WHITESPACE"," ",76],["T_BOOLEAN_OR","||",76],["T_WHITESPACE"," ",76],["T_STRING","null",76],["T_WHITESPACE"," ",76],["T_IS_IDENTICAL","===",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$response",76],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_RETURN","return",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$response",77],";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n\n        ",78],["T_THROW","throw",80],["T_WHITESPACE"," ",80],["T_NEW","new",80],["T_WHITESPACE"," ",80],["T_NS_SEPARATOR","\\",80],["T_STRING","UnexpectedValueException",80],"(",["T_STRING","sprintf",80],"(",["T_WHITESPACE","\n            ",80],["T_CONSTANT_ENCAPSED_STRING","'The %s::onAuthenticationSuccess method must return null or a Response object. You returned %s.'",81],",",["T_WHITESPACE","\n            ",81],["T_STRING","get_class",82],"(",["T_VARIABLE","$guardAuthenticator",82],")",",",["T_WHITESPACE","\n            ",82],["T_STRING","is_object",83],"(",["T_VARIABLE","$response",83],")",["T_WHITESPACE"," ",83],"?",["T_WHITESPACE"," ",83],["T_STRING","get_class",83],"(",["T_VARIABLE","$response",83],")",["T_WHITESPACE"," ",83],":",["T_WHITESPACE"," ",83],["T_STRING","gettype",83],"(",["T_VARIABLE","$response",83],")",["T_WHITESPACE","\n        ",83],")",")",";",["T_WHITESPACE","\n    ",84],"}",["T_WHITESPACE","\n\n    ",85],["T_DOC_COMMENT","\/**\n     * Convenience method for authenticating the user and returning the\n     * Response *if any* for success.\n     *\n     * @param UserInterface               $user\n     * @param Request                     $request\n     * @param GuardAuthenticatorInterface $authenticator\n     * @param string                      $providerKey   The provider (i.e. firewall) key\n     *\n     * @return Response|null\n     *\/",87],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","authenticateUserAndHandleSuccess",98],"(",["T_STRING","UserInterface",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$user",98],",",["T_WHITESPACE"," ",98],["T_STRING","Request",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$request",98],",",["T_WHITESPACE"," ",98],["T_STRING","GuardAuthenticatorInterface",98],["T_WHITESPACE"," ",98],["T_VARIABLE","$authenticator",98],",",["T_WHITESPACE"," ",98],["T_VARIABLE","$providerKey",98],")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_COMMENT","\/\/ create an authenticated token for the User\n",100],["T_WHITESPACE","        ",101],["T_VARIABLE","$token",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$authenticator",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","createAuthenticatedToken",101],"(",["T_VARIABLE","$user",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$providerKey",101],")",";",["T_WHITESPACE","\n        ",101],["T_COMMENT","\/\/ authenticate this in the system\n",102],["T_WHITESPACE","        ",103],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","authenticateWithToken",103],"(",["T_VARIABLE","$token",103],",",["T_WHITESPACE"," ",103],["T_VARIABLE","$request",103],")",";",["T_WHITESPACE","\n\n        ",103],["T_COMMENT","\/\/ return the success metric\n",105],["T_WHITESPACE","        ",106],["T_RETURN","return",106],["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","handleAuthenticationSuccess",106],"(",["T_VARIABLE","$token",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$request",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$authenticator",106],",",["T_WHITESPACE"," ",106],["T_VARIABLE","$providerKey",106],")",";",["T_WHITESPACE","\n    ",106],"}",["T_WHITESPACE","\n\n    ",107],["T_DOC_COMMENT","\/**\n     * Handles an authentication failure and returns the Response for the\n     * GuardAuthenticator.\n     *\n     * @param AuthenticationException     $authenticationException\n     * @param Request                     $request\n     * @param GuardAuthenticatorInterface $guardAuthenticator\n     * @param string                      $providerKey             The key of the firewall\n     *\n     * @return null|Response\n     *\/",109],["T_WHITESPACE","\n    ",119],["T_PUBLIC","public",120],["T_WHITESPACE"," ",120],["T_FUNCTION","function",120],["T_WHITESPACE"," ",120],["T_STRING","handleAuthenticationFailure",120],"(",["T_STRING","AuthenticationException",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$authenticationException",120],",",["T_WHITESPACE"," ",120],["T_STRING","Request",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$request",120],",",["T_WHITESPACE"," ",120],["T_STRING","GuardAuthenticatorInterface",120],["T_WHITESPACE"," ",120],["T_VARIABLE","$guardAuthenticator",120],",",["T_WHITESPACE"," ",120],["T_VARIABLE","$providerKey",120],")",["T_WHITESPACE","\n    ",120],"{",["T_WHITESPACE","\n        ",121],["T_VARIABLE","$token",122],["T_WHITESPACE"," ",122],"=",["T_WHITESPACE"," ",122],["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","tokenStorage",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getToken",122],"(",")",";",["T_WHITESPACE","\n        ",122],["T_IF","if",123],["T_WHITESPACE"," ",123],"(",["T_VARIABLE","$token",123],["T_WHITESPACE"," ",123],["T_INSTANCEOF","instanceof",123],["T_WHITESPACE"," ",123],["T_STRING","PostAuthenticationGuardToken",123],["T_WHITESPACE"," ",123],["T_BOOLEAN_AND","&&",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$providerKey",123],["T_WHITESPACE"," ",123],["T_IS_IDENTICAL","===",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$token",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","getProviderKey",123],"(",")",")",["T_WHITESPACE"," ",123],"{",["T_WHITESPACE","\n            ",123],["T_VARIABLE","$this",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","tokenStorage",124],["T_OBJECT_OPERATOR","->",124],["T_STRING","setToken",124],"(",["T_STRING","null",124],")",";",["T_WHITESPACE","\n        ",124],"}",["T_WHITESPACE","\n\n        ",125],["T_VARIABLE","$response",127],["T_WHITESPACE"," ",127],"=",["T_WHITESPACE"," ",127],["T_VARIABLE","$guardAuthenticator",127],["T_OBJECT_OPERATOR","->",127],["T_STRING","onAuthenticationFailure",127],"(",["T_VARIABLE","$request",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$authenticationException",127],")",";",["T_WHITESPACE","\n        ",127],["T_IF","if",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$response",128],["T_WHITESPACE"," ",128],["T_INSTANCEOF","instanceof",128],["T_WHITESPACE"," ",128],["T_STRING","Response",128],["T_WHITESPACE"," ",128],["T_BOOLEAN_OR","||",128],["T_WHITESPACE"," ",128],["T_STRING","null",128],["T_WHITESPACE"," ",128],["T_IS_IDENTICAL","===",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$response",128],")",["T_WHITESPACE"," ",128],"{",["T_WHITESPACE","\n            ",128],["T_COMMENT","\/\/ returning null is ok, it means they want the request to continue\n",129],["T_WHITESPACE","            ",130],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_VARIABLE","$response",130],";",["T_WHITESPACE","\n        ",130],"}",["T_WHITESPACE","\n\n        ",131],["T_THROW","throw",133],["T_WHITESPACE"," ",133],["T_NEW","new",133],["T_WHITESPACE"," ",133],["T_NS_SEPARATOR","\\",133],["T_STRING","UnexpectedValueException",133],"(",["T_STRING","sprintf",133],"(",["T_WHITESPACE","\n            ",133],["T_CONSTANT_ENCAPSED_STRING","'The %s::onAuthenticationFailure method must return null or a Response object. You returned %s.'",134],",",["T_WHITESPACE","\n            ",134],["T_STRING","get_class",135],"(",["T_VARIABLE","$guardAuthenticator",135],")",",",["T_WHITESPACE","\n            ",135],["T_STRING","is_object",136],"(",["T_VARIABLE","$response",136],")",["T_WHITESPACE"," ",136],"?",["T_WHITESPACE"," ",136],["T_STRING","get_class",136],"(",["T_VARIABLE","$response",136],")",["T_WHITESPACE"," ",136],":",["T_WHITESPACE"," ",136],["T_STRING","gettype",136],"(",["T_VARIABLE","$response",136],")",["T_WHITESPACE","\n        ",136],")",")",";",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n",138],"}",["T_WHITESPACE","\n",139]]