[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * @link http:\/\/www.yiiframework.com\/\n * @copyright Copyright (c) 2008 Yii Software LLC\n * @license http:\/\/www.yiiframework.com\/license\/\n *\/",2],["T_WHITESPACE","\n\n",6],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","yii",8],["T_NS_SEPARATOR","\\",8],["T_STRING","mutex",8],";",["T_WHITESPACE","\n\n",8],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Yii",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","yii",11],["T_NS_SEPARATOR","\\",11],["T_STRING","base",11],["T_NS_SEPARATOR","\\",11],["T_STRING","InvalidConfigException",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","yii",12],["T_NS_SEPARATOR","\\",12],["T_STRING","helpers",12],["T_NS_SEPARATOR","\\",12],["T_STRING","FileHelper",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * FileMutex implements mutex \"lock\" mechanism via local file system files.\n * This component relies on PHP `flock()` function.\n *\n * Application configuration example:\n *\n * ```\n * [\n *     'components' => [\n *         'mutex' => [\n *             'class' => 'yii\\mutex\\FileMutex'\n *         ],\n *     ],\n * ]\n * ```\n *\n * Note: this component can maintain the locks only for the single web server,\n * it probably will not suffice to your in case you are using cloud server solution.\n *\n * Warning: due to `flock()` function nature this component is unreliable when\n * using a multithreaded server API like ISAPI.\n *\n * @see Mutex\n *\n * @author resurtm <resurtm@gmail.com>\n * @since 2.0\n *\/",14],["T_WHITESPACE","\n",40],["T_CLASS","class",41],["T_WHITESPACE"," ",41],["T_STRING","FileMutex",41],["T_WHITESPACE"," ",41],["T_EXTENDS","extends",41],["T_WHITESPACE"," ",41],["T_STRING","Mutex",41],["T_WHITESPACE","\n",41],"{",["T_WHITESPACE","\n    ",42],["T_DOC_COMMENT","\/**\n     * @var string the directory to store mutex files. You may use path alias here.\n     * Defaults to the \"mutex\" subdirectory under the application runtime path.\n     *\/",43],["T_WHITESPACE","\n    ",46],["T_PUBLIC","public",47],["T_WHITESPACE"," ",47],["T_VARIABLE","$mutexPath",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'@runtime\/mutex'",47],";",["T_WHITESPACE","\n    ",47],["T_DOC_COMMENT","\/**\n     * @var int the permission to be set for newly created mutex files.\n     * This value will be used by PHP chmod() function. No umask will be applied.\n     * If not set, the permission will be determined by the current environment.\n     *\/",48],["T_WHITESPACE","\n    ",52],["T_PUBLIC","public",53],["T_WHITESPACE"," ",53],["T_VARIABLE","$fileMode",53],";",["T_WHITESPACE","\n    ",53],["T_DOC_COMMENT","\/**\n     * @var int the permission to be set for newly created directories.\n     * This value will be used by PHP chmod() function. No umask will be applied.\n     * Defaults to 0775, meaning the directory is read-writable by owner and group,\n     * but read-only for other users.\n     *\/",54],["T_WHITESPACE","\n    ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_VARIABLE","$dirMode",60],["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_LNUMBER","0775",60],";",["T_WHITESPACE","\n\n    ",60],["T_DOC_COMMENT","\/**\n     * @var resource[] stores all opened lock files. Keys are lock names and values are file handles.\n     *\/",62],["T_WHITESPACE","\n    ",64],["T_PRIVATE","private",65],["T_WHITESPACE"," ",65],["T_VARIABLE","$_files",65],["T_WHITESPACE"," ",65],"=",["T_WHITESPACE"," ",65],"[","]",";",["T_WHITESPACE","\n\n\n    ",65],["T_DOC_COMMENT","\/**\n     * Initializes mutex component implementation dedicated for UNIX, GNU\/Linux, Mac OS X, and other UNIX-like\n     * operating systems.\n     * @throws InvalidConfigException\n     *\/",68],["T_WHITESPACE","\n    ",72],["T_PUBLIC","public",73],["T_WHITESPACE"," ",73],["T_FUNCTION","function",73],["T_WHITESPACE"," ",73],["T_STRING","init",73],"(",")",["T_WHITESPACE","\n    ",73],"{",["T_WHITESPACE","\n        ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","mutexPath",75],["T_WHITESPACE"," ",75],"=",["T_WHITESPACE"," ",75],["T_STRING","Yii",75],["T_DOUBLE_COLON","::",75],["T_STRING","getAlias",75],"(",["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","mutexPath",75],")",";",["T_WHITESPACE","\n        ",75],["T_IF","if",76],["T_WHITESPACE"," ",76],"(","!",["T_STRING","is_dir",76],"(",["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","mutexPath",76],")",")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n            ",76],["T_STRING","FileHelper",77],["T_DOUBLE_COLON","::",77],["T_STRING","createDirectory",77],"(",["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","mutexPath",77],",",["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","dirMode",77],",",["T_WHITESPACE"," ",77],["T_STRING","true",77],")",";",["T_WHITESPACE","\n        ",77],"}",["T_WHITESPACE","\n    ",78],"}",["T_WHITESPACE","\n\n    ",79],["T_DOC_COMMENT","\/**\n     * Acquires lock by given name.\n     * @param string $name of the lock to be acquired.\n     * @param int $timeout to wait for lock to become released.\n     * @return bool acquiring result.\n     *\/",81],["T_WHITESPACE","\n    ",86],["T_PROTECTED","protected",87],["T_WHITESPACE"," ",87],["T_FUNCTION","function",87],["T_WHITESPACE"," ",87],["T_STRING","acquireLock",87],"(",["T_VARIABLE","$name",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$timeout",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_LNUMBER","0",87],")",["T_WHITESPACE","\n    ",87],"{",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$file",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","fopen",89],"(",["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","getLockFilePath",89],"(",["T_VARIABLE","$name",89],")",",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'w+'",89],")",";",["T_WHITESPACE","\n        ",89],["T_IF","if",90],["T_WHITESPACE"," ",90],"(",["T_VARIABLE","$file",90],["T_WHITESPACE"," ",90],["T_IS_IDENTICAL","===",90],["T_WHITESPACE"," ",90],["T_STRING","false",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE","\n            ",90],["T_RETURN","return",91],["T_WHITESPACE"," ",91],["T_STRING","false",91],";",["T_WHITESPACE","\n        ",91],"}",["T_WHITESPACE","\n        ",92],["T_IF","if",93],["T_WHITESPACE"," ",93],"(",["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","fileMode",93],["T_WHITESPACE"," ",93],["T_IS_NOT_IDENTICAL","!==",93],["T_WHITESPACE"," ",93],["T_STRING","null",93],")",["T_WHITESPACE"," ",93],"{",["T_WHITESPACE","\n            ",93],"@",["T_STRING","chmod",94],"(",["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getLockFilePath",94],"(",["T_VARIABLE","$name",94],")",",",["T_WHITESPACE"," ",94],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","fileMode",94],")",";",["T_WHITESPACE","\n        ",94],"}",["T_WHITESPACE","\n        ",95],["T_VARIABLE","$waitTime",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_LNUMBER","0",96],";",["T_WHITESPACE","\n        ",96],["T_WHILE","while",97],["T_WHITESPACE"," ",97],"(","!",["T_STRING","flock",97],"(",["T_VARIABLE","$file",97],",",["T_WHITESPACE"," ",97],["T_STRING","LOCK_EX",97],["T_WHITESPACE"," ",97],"|",["T_WHITESPACE"," ",97],["T_STRING","LOCK_NB",97],")",")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n            ",97],["T_VARIABLE","$waitTime",98],["T_INC","++",98],";",["T_WHITESPACE","\n            ",98],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$waitTime",99],["T_WHITESPACE"," ",99],">",["T_WHITESPACE"," ",99],["T_VARIABLE","$timeout",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n                ",99],["T_STRING","fclose",100],"(",["T_VARIABLE","$file",100],")",";",["T_WHITESPACE","\n\n                ",100],["T_RETURN","return",102],["T_WHITESPACE"," ",102],["T_STRING","false",102],";",["T_WHITESPACE","\n            ",102],"}",["T_WHITESPACE","\n            ",103],["T_STRING","sleep",104],"(",["T_LNUMBER","1",104],")",";",["T_WHITESPACE","\n        ",104],"}",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","_files",106],"[",["T_VARIABLE","$name",106],"]",["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$file",106],";",["T_WHITESPACE","\n\n        ",106],["T_RETURN","return",108],["T_WHITESPACE"," ",108],["T_STRING","true",108],";",["T_WHITESPACE","\n    ",108],"}",["T_WHITESPACE","\n\n    ",109],["T_DOC_COMMENT","\/**\n     * Releases lock by given name.\n     * @param string $name of the lock to be released.\n     * @return bool release result.\n     *\/",111],["T_WHITESPACE","\n    ",115],["T_PROTECTED","protected",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","releaseLock",116],"(",["T_VARIABLE","$name",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(","!",["T_ISSET","isset",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_files",118],"[",["T_VARIABLE","$name",118],"]",")",["T_WHITESPACE"," ",118],["T_BOOLEAN_OR","||",118],["T_WHITESPACE"," ",118],"!",["T_STRING","flock",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","_files",118],"[",["T_VARIABLE","$name",118],"]",",",["T_WHITESPACE"," ",118],["T_STRING","LOCK_UN",118],")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_RETURN","return",119],["T_WHITESPACE"," ",119],["T_STRING","false",119],";",["T_WHITESPACE","\n        ",119],"}",["T_WHITESPACE"," ",120],["T_ELSE","else",120],["T_WHITESPACE"," ",120],"{",["T_WHITESPACE","\n            ",120],["T_STRING","fclose",121],"(",["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","_files",121],"[",["T_VARIABLE","$name",121],"]",")",";",["T_WHITESPACE","\n            ",121],["T_STRING","unlink",122],"(",["T_VARIABLE","$this",122],["T_OBJECT_OPERATOR","->",122],["T_STRING","getLockFilePath",122],"(",["T_VARIABLE","$name",122],")",")",";",["T_WHITESPACE","\n            ",122],["T_UNSET","unset",123],"(",["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","_files",123],"[",["T_VARIABLE","$name",123],"]",")",";",["T_WHITESPACE","\n\n            ",123],["T_RETURN","return",125],["T_WHITESPACE"," ",125],["T_STRING","true",125],";",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Generate path for lock file.\n     * @param string $name\n     * @return string\n     * @since 2.0.10\n     *\/",129],["T_WHITESPACE","\n    ",134],["T_PROTECTED","protected",135],["T_WHITESPACE"," ",135],["T_FUNCTION","function",135],["T_WHITESPACE"," ",135],["T_STRING","getLockFilePath",135],"(",["T_VARIABLE","$name",135],")",["T_WHITESPACE","\n    ",135],"{",["T_WHITESPACE","\n        ",136],["T_RETURN","return",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$this",137],["T_OBJECT_OPERATOR","->",137],["T_STRING","mutexPath",137],["T_WHITESPACE"," ",137],".",["T_WHITESPACE"," ",137],["T_STRING","DIRECTORY_SEPARATOR",137],["T_WHITESPACE"," ",137],".",["T_WHITESPACE"," ",137],["T_STRING","md5",137],"(",["T_VARIABLE","$name",137],")",["T_WHITESPACE"," ",137],".",["T_WHITESPACE"," ",137],["T_CONSTANT_ENCAPSED_STRING","'.lock'",137],";",["T_WHITESPACE","\n    ",137],"}",["T_WHITESPACE","\n",138],"}",["T_WHITESPACE","\n",139]]