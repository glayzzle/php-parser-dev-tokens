[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * @link http:\/\/www.yiiframework.com\/\n * @copyright Copyright (c) 2008 Yii Software LLC\n * @license http:\/\/www.yiiframework.com\/license\/\n *\/",2],["T_WHITESPACE","\n\n",6],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","yii",8],["T_NS_SEPARATOR","\\",8],["T_STRING","mutex",8],";",["T_WHITESPACE","\n\n",8],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","PDO",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","Yii",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","yii",12],["T_NS_SEPARATOR","\\",12],["T_STRING","base",12],["T_NS_SEPARATOR","\\",12],["T_STRING","InvalidConfigException",12],";",["T_WHITESPACE","\n\n",12],["T_DOC_COMMENT","\/**\n * OracleMutex implements mutex \"lock\" mechanism via Oracle locks.\n *\n * Application configuration example:\n *\n * ```\n * [\n *     'components' => [\n *         'db' => [\n *             'class' => 'yii\\db\\Connection',\n *             'dsn' => 'oci:dbname=LOCAL_XE',\n *              ...\n *         ]\n *         'mutex' => [\n *             'class' => 'yii\\mutex\\OracleMutex',\n *             'lockMode' => 'NL_MODE',\n *             'releaseOnCommit' => true,\n *              ...\n *         ],\n *     ],\n * ]\n * ```\n *\n * @see http:\/\/docs.oracle.com\/cd\/B19306_01\/appdev.102\/b14258\/d_lock.htm\n * @see Mutex\n *\n * @author Alexander Zlakomanov <zlakomanoff@gmail.com>\n * @since 2.0.10\n *\/",14],["T_WHITESPACE","\n",42],["T_CLASS","class",43],["T_WHITESPACE"," ",43],["T_STRING","OracleMutex",43],["T_WHITESPACE"," ",43],["T_EXTENDS","extends",43],["T_WHITESPACE"," ",43],["T_STRING","DbMutex",43],["T_WHITESPACE","\n",43],"{",["T_WHITESPACE","\n    ",44],["T_DOC_COMMENT","\/** available lock modes *\/",45],["T_WHITESPACE","\n    ",45],["T_CONST","const",46],["T_WHITESPACE"," ",46],["T_STRING","MODE_X",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","'X_MODE'",46],";",["T_WHITESPACE","\n    ",46],["T_CONST","const",47],["T_WHITESPACE"," ",47],["T_STRING","MODE_NL",47],["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'NL_MODE'",47],";",["T_WHITESPACE","\n    ",47],["T_CONST","const",48],["T_WHITESPACE"," ",48],["T_STRING","MODE_S",48],["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'S_MODE'",48],";",["T_WHITESPACE","\n    ",48],["T_CONST","const",49],["T_WHITESPACE"," ",49],["T_STRING","MODE_SX",49],["T_WHITESPACE"," ",49],"=",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'SX_MODE'",49],";",["T_WHITESPACE","\n    ",49],["T_CONST","const",50],["T_WHITESPACE"," ",50],["T_STRING","MODE_SS",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'SS_MODE'",50],";",["T_WHITESPACE","\n    ",50],["T_CONST","const",51],["T_WHITESPACE"," ",51],["T_STRING","MODE_SSX",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'SSX_MODE'",51],";",["T_WHITESPACE","\n\n    ",51],["T_DOC_COMMENT","\/**\n     * @var string lock mode to be used.\n     * @see http:\/\/docs.oracle.com\/cd\/B19306_01\/appdev.102\/b14258\/d_lock.htm#CHDBCFDI\n     *\/",53],["T_WHITESPACE","\n    ",56],["T_PUBLIC","public",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$lockMode",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","self",57],["T_DOUBLE_COLON","::",57],["T_STRING","MODE_X",57],";",["T_WHITESPACE","\n    ",57],["T_DOC_COMMENT","\/**\n     * @var bool whether to release lock on commit.\n     *\/",58],["T_WHITESPACE","\n    ",60],["T_PUBLIC","public",61],["T_WHITESPACE"," ",61],["T_VARIABLE","$releaseOnCommit",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","false",61],";",["T_WHITESPACE","\n\n\n    ",61],["T_DOC_COMMENT","\/**\n     * Initializes Oracle specific mutex component implementation.\n     * @throws InvalidConfigException if [[db]] is not Oracle connection.\n     *\/",64],["T_WHITESPACE","\n    ",67],["T_PUBLIC","public",68],["T_WHITESPACE"," ",68],["T_FUNCTION","function",68],["T_WHITESPACE"," ",68],["T_STRING","init",68],"(",")",["T_WHITESPACE","\n    ",68],"{",["T_WHITESPACE","\n        ",69],["T_STRING","parent",70],["T_DOUBLE_COLON","::",70],["T_STRING","init",70],"(",")",";",["T_WHITESPACE","\n        ",70],["T_IF","if",71],["T_WHITESPACE"," ",71],"(",["T_STRING","strpos",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","db",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","driverName",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'oci'",71],")",["T_WHITESPACE"," ",71],["T_IS_NOT_IDENTICAL","!==",71],["T_WHITESPACE"," ",71],["T_LNUMBER","0",71],["T_WHITESPACE"," ",71],["T_BOOLEAN_AND","&&",71],["T_WHITESPACE"," ",71],["T_STRING","strpos",71],"(",["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","db",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","driverName",71],",",["T_WHITESPACE"," ",71],["T_CONSTANT_ENCAPSED_STRING","'odbc'",71],")",["T_WHITESPACE"," ",71],["T_IS_NOT_IDENTICAL","!==",71],["T_WHITESPACE"," ",71],["T_LNUMBER","0",71],")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n            ",71],["T_THROW","throw",72],["T_WHITESPACE"," ",72],["T_NEW","new",72],["T_WHITESPACE"," ",72],["T_STRING","InvalidConfigException",72],"(",["T_CONSTANT_ENCAPSED_STRING","'In order to use OracleMutex connection must be configured to use Oracle database.'",72],")",";",["T_WHITESPACE","\n        ",72],"}",["T_WHITESPACE","\n    ",73],"}",["T_WHITESPACE","\n\n    ",74],["T_DOC_COMMENT","\/**\n     * Acquires lock by given name.\n     * @see http:\/\/docs.oracle.com\/cd\/B19306_01\/appdev.102\/b14258\/d_lock.htm\n     * @param string $name of the lock to be acquired.\n     * @param int $timeout to wait for lock to become released.\n     * @return bool acquiring result.\n     *\/",76],["T_WHITESPACE","\n    ",82],["T_PROTECTED","protected",83],["T_WHITESPACE"," ",83],["T_FUNCTION","function",83],["T_WHITESPACE"," ",83],["T_STRING","acquireLock",83],"(",["T_VARIABLE","$name",83],",",["T_WHITESPACE"," ",83],["T_VARIABLE","$timeout",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_LNUMBER","0",83],")",["T_WHITESPACE","\n    ",83],"{",["T_WHITESPACE","\n        ",84],["T_VARIABLE","$lockStatus",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_STRING","null",85],";",["T_WHITESPACE","\n\n        ",85],["T_DOC_COMMENT","\/** clean vars before using *\/",87],["T_WHITESPACE","\n        ",87],["T_VARIABLE","$releaseOnCommit",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","releaseOnCommit",88],["T_WHITESPACE"," ",88],"?",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'TRUE'",88],["T_WHITESPACE"," ",88],":",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","'FALSE'",88],";",["T_WHITESPACE","\n        ",88],["T_VARIABLE","$timeout",89],["T_WHITESPACE"," ",89],"=",["T_WHITESPACE"," ",89],["T_STRING","abs",89],"(",["T_INT_CAST","(int)",89],["T_VARIABLE","$timeout",89],")",";",["T_WHITESPACE","\n\n        ",89],["T_DOC_COMMENT","\/** inside pl\/sql scopes pdo binding not working correctly :(  *\/",91],["T_WHITESPACE","\n        ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","db",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","createCommand",92],"(",["T_WHITESPACE","\n                ",92],["T_CONSTANT_ENCAPSED_STRING","'DECLARE\n    handle VARCHAR2(128);\nBEGIN\n    DBMS_LOCK.ALLOCATE_UNIQUE(:name, handle);\n    :lockStatus := DBMS_LOCK.REQUEST(handle, DBMS_LOCK.'",93],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_VARIABLE","$this",97],["T_OBJECT_OPERATOR","->",97],["T_STRING","lockMode",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","', '",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_VARIABLE","$timeout",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","', '",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_VARIABLE","$releaseOnCommit",97],["T_WHITESPACE"," ",97],".",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","');\nEND;'",97],",",["T_WHITESPACE","\n                ",98],"[",["T_CONSTANT_ENCAPSED_STRING","':name'",99],["T_WHITESPACE"," ",99],["T_DOUBLE_ARROW","=>",99],["T_WHITESPACE"," ",99],["T_VARIABLE","$name",99],"]",["T_WHITESPACE","\n            ",99],")",["T_WHITESPACE","\n            ",100],["T_OBJECT_OPERATOR","->",101],["T_STRING","bindParam",101],"(",["T_CONSTANT_ENCAPSED_STRING","':lockStatus'",101],",",["T_WHITESPACE"," ",101],["T_VARIABLE","$lockStatus",101],",",["T_WHITESPACE"," ",101],["T_STRING","PDO",101],["T_DOUBLE_COLON","::",101],["T_STRING","PARAM_INT",101],",",["T_WHITESPACE"," ",101],["T_LNUMBER","1",101],")",["T_WHITESPACE","\n            ",101],["T_OBJECT_OPERATOR","->",102],["T_STRING","execute",102],"(",")",";",["T_WHITESPACE","\n\n        ",102],["T_RETURN","return",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$lockStatus",104],["T_WHITESPACE"," ",104],["T_IS_IDENTICAL","===",104],["T_WHITESPACE"," ",104],["T_LNUMBER","0",104],["T_WHITESPACE"," ",104],["T_BOOLEAN_OR","||",104],["T_WHITESPACE"," ",104],["T_VARIABLE","$lockStatus",104],["T_WHITESPACE"," ",104],["T_IS_IDENTICAL","===",104],["T_WHITESPACE"," ",104],["T_CONSTANT_ENCAPSED_STRING","'0'",104],")",";",["T_WHITESPACE","\n    ",104],"}",["T_WHITESPACE","\n\n    ",105],["T_DOC_COMMENT","\/**\n     * Releases lock by given name.\n     * @param string $name of the lock to be released.\n     * @return bool release result.\n     * @see http:\/\/docs.oracle.com\/cd\/B19306_01\/appdev.102\/b14258\/d_lock.htm\n     *\/",107],["T_WHITESPACE","\n    ",112],["T_PROTECTED","protected",113],["T_WHITESPACE"," ",113],["T_FUNCTION","function",113],["T_WHITESPACE"," ",113],["T_STRING","releaseLock",113],"(",["T_VARIABLE","$name",113],")",["T_WHITESPACE","\n    ",113],"{",["T_WHITESPACE","\n        ",114],["T_VARIABLE","$releaseStatus",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_STRING","null",115],";",["T_WHITESPACE","\n        ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","db",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","createCommand",116],"(",["T_WHITESPACE","\n                ",116],["T_CONSTANT_ENCAPSED_STRING","'DECLARE\n    handle VARCHAR2(128);\nBEGIN\n    DBMS_LOCK.ALLOCATE_UNIQUE(:name, handle);\n    :result := DBMS_LOCK.RELEASE(handle);\nEND;'",117],",",["T_WHITESPACE","\n                ",122],"[",["T_CONSTANT_ENCAPSED_STRING","':name'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_VARIABLE","$name",123],"]",["T_WHITESPACE","\n            ",123],")",["T_WHITESPACE","\n            ",124],["T_OBJECT_OPERATOR","->",125],["T_STRING","bindParam",125],"(",["T_CONSTANT_ENCAPSED_STRING","':result'",125],",",["T_WHITESPACE"," ",125],["T_VARIABLE","$releaseStatus",125],",",["T_WHITESPACE"," ",125],["T_STRING","PDO",125],["T_DOUBLE_COLON","::",125],["T_STRING","PARAM_INT",125],",",["T_WHITESPACE"," ",125],["T_LNUMBER","1",125],")",["T_WHITESPACE","\n            ",125],["T_OBJECT_OPERATOR","->",126],["T_STRING","execute",126],"(",")",";",["T_WHITESPACE","\n\n        ",126],["T_RETURN","return",128],["T_WHITESPACE"," ",128],"(",["T_VARIABLE","$releaseStatus",128],["T_WHITESPACE"," ",128],["T_IS_IDENTICAL","===",128],["T_WHITESPACE"," ",128],["T_LNUMBER","0",128],["T_WHITESPACE"," ",128],["T_BOOLEAN_OR","||",128],["T_WHITESPACE"," ",128],["T_VARIABLE","$releaseStatus",128],["T_WHITESPACE"," ",128],["T_IS_IDENTICAL","===",128],["T_WHITESPACE"," ",128],["T_CONSTANT_ENCAPSED_STRING","'0'",128],")",";",["T_WHITESPACE","\n    ",128],"}",["T_WHITESPACE","\n",129],"}",["T_WHITESPACE","\n",130]]