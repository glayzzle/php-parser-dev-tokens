[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * @link http:\/\/www.yiiframework.com\/\n * @copyright Copyright (c) 2008 Yii Software LLC\n * @license http:\/\/www.yiiframework.com\/license\/\n *\/",2],["T_WHITESPACE","\n\n",6],["T_NAMESPACE","namespace",8],["T_WHITESPACE"," ",8],["T_STRING","yii",8],["T_NS_SEPARATOR","\\",8],["T_STRING","filters",8],";",["T_WHITESPACE","\n\n",8],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","Yii",10],";",["T_WHITESPACE","\n",10],["T_USE","use",11],["T_WHITESPACE"," ",11],["T_STRING","yii",11],["T_NS_SEPARATOR","\\",11],["T_STRING","base",11],["T_NS_SEPARATOR","\\",11],["T_STRING","ActionFilter",11],";",["T_WHITESPACE","\n",11],["T_USE","use",12],["T_WHITESPACE"," ",12],["T_STRING","yii",12],["T_NS_SEPARATOR","\\",12],["T_STRING","web",12],["T_NS_SEPARATOR","\\",12],["T_STRING","Request",12],";",["T_WHITESPACE","\n",12],["T_USE","use",13],["T_WHITESPACE"," ",13],["T_STRING","yii",13],["T_NS_SEPARATOR","\\",13],["T_STRING","web",13],["T_NS_SEPARATOR","\\",13],["T_STRING","Response",13],";",["T_WHITESPACE","\n\n",13],["T_DOC_COMMENT","\/**\n * Cors filter implements [Cross Origin Resource Sharing](http:\/\/en.wikipedia.org\/wiki\/Cross-origin_resource_sharing).\n *\n * Make sure to read carefully what CORS does and does not. CORS do not secure your API,\n * but allow the developer to grant access to third party code (ajax calls from external domain).\n *\n * You may use CORS filter by attaching it as a behavior to a controller or module, like the following,\n *\n * ```php\n * public function behaviors()\n * {\n *     return [\n *         'corsFilter' => [\n *             'class' => \\yii\\filters\\Cors::className(),\n *         ],\n *     ];\n * }\n * ```\n *\n * The CORS filter can be specialized to restrict parameters, like this,\n * [MDN CORS Information](https:\/\/developer.mozilla.org\/en-US\/docs\/Web\/HTTP\/Access_control_CORS)\n *\n * ```php\n * public function behaviors()\n * {\n *     return [\n *         'corsFilter' => [\n *             'class' => \\yii\\filters\\Cors::className(),\n *             'cors' => [\n *                 \/\/ restrict access to\n *                 'Origin' => ['http:\/\/www.myserver.com', 'https:\/\/www.myserver.com'],\n *                 'Access-Control-Request-Method' => ['POST', 'PUT'],\n *                 \/\/ Allow only POST and PUT methods\n *                 'Access-Control-Request-Headers' => ['X-Wsse'],\n *                 \/\/ Allow only headers 'X-Wsse'\n *                 'Access-Control-Allow-Credentials' => true,\n *                 \/\/ Allow OPTIONS caching\n *                 'Access-Control-Max-Age' => 3600,\n *                 \/\/ Allow the X-Pagination-Current-Page header to be exposed to the browser.\n *                 'Access-Control-Expose-Headers' => ['X-Pagination-Current-Page'],\n *             ],\n *\n *         ],\n *     ];\n * }\n * ```\n *\n * For more information on how to add the CORS filter to a controller, see\n * the [Guide on REST controllers](guide:rest-controllers#cors).\n *\n * @author Philippe Gaultier <pgaultier@gmail.com>\n * @since 2.0\n *\/",15],["T_WHITESPACE","\n",67],["T_CLASS","class",68],["T_WHITESPACE"," ",68],["T_STRING","Cors",68],["T_WHITESPACE"," ",68],["T_EXTENDS","extends",68],["T_WHITESPACE"," ",68],["T_STRING","ActionFilter",68],["T_WHITESPACE","\n",68],"{",["T_WHITESPACE","\n    ",69],["T_DOC_COMMENT","\/**\n     * @var Request the current request. If not set, the `request` application component will be used.\n     *\/",70],["T_WHITESPACE","\n    ",72],["T_PUBLIC","public",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$request",73],";",["T_WHITESPACE","\n    ",73],["T_DOC_COMMENT","\/**\n     * @var Response the response to be sent. If not set, the `response` application component will be used.\n     *\/",74],["T_WHITESPACE","\n    ",76],["T_PUBLIC","public",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$response",77],";",["T_WHITESPACE","\n    ",77],["T_DOC_COMMENT","\/**\n     * @var array define specific CORS rules for specific actions\n     *\/",78],["T_WHITESPACE","\n    ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$actions",81],["T_WHITESPACE"," ",81],"=",["T_WHITESPACE"," ",81],"[","]",";",["T_WHITESPACE","\n    ",81],["T_DOC_COMMENT","\/**\n     * @var array Basic headers handled for the CORS requests.\n     *\/",82],["T_WHITESPACE","\n    ",84],["T_PUBLIC","public",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$cors",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],"[",["T_WHITESPACE","\n        ",85],["T_CONSTANT_ENCAPSED_STRING","'Origin'",86],["T_WHITESPACE"," ",86],["T_DOUBLE_ARROW","=>",86],["T_WHITESPACE"," ",86],"[",["T_CONSTANT_ENCAPSED_STRING","'*'",86],"]",",",["T_WHITESPACE","\n        ",86],["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Request-Method'",87],["T_WHITESPACE"," ",87],["T_DOUBLE_ARROW","=>",87],["T_WHITESPACE"," ",87],"[",["T_CONSTANT_ENCAPSED_STRING","'GET'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'POST'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'PUT'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'PATCH'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'DELETE'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'HEAD'",87],",",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'OPTIONS'",87],"]",",",["T_WHITESPACE","\n        ",87],["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Request-Headers'",88],["T_WHITESPACE"," ",88],["T_DOUBLE_ARROW","=>",88],["T_WHITESPACE"," ",88],"[",["T_CONSTANT_ENCAPSED_STRING","'*'",88],"]",",",["T_WHITESPACE","\n        ",88],["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Allow-Credentials'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],["T_STRING","null",89],",",["T_WHITESPACE","\n        ",89],["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Max-Age'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],["T_LNUMBER","86400",90],",",["T_WHITESPACE","\n        ",90],["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Expose-Headers'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],"[","]",",",["T_WHITESPACE","\n    ",91],"]",";",["T_WHITESPACE","\n\n\n    ",92],["T_DOC_COMMENT","\/**\n     * @inheritdoc\n     *\/",95],["T_WHITESPACE","\n    ",97],["T_PUBLIC","public",98],["T_WHITESPACE"," ",98],["T_FUNCTION","function",98],["T_WHITESPACE"," ",98],["T_STRING","beforeAction",98],"(",["T_VARIABLE","$action",98],")",["T_WHITESPACE","\n    ",98],"{",["T_WHITESPACE","\n        ",99],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","request",100],["T_WHITESPACE"," ",100],"=",["T_WHITESPACE"," ",100],["T_VARIABLE","$this",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","request",100],["T_WHITESPACE"," ",100],"?",":",["T_WHITESPACE"," ",100],["T_STRING","Yii",100],["T_DOUBLE_COLON","::",100],["T_VARIABLE","$app",100],["T_OBJECT_OPERATOR","->",100],["T_STRING","getRequest",100],"(",")",";",["T_WHITESPACE","\n        ",100],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","response",101],["T_WHITESPACE"," ",101],"=",["T_WHITESPACE"," ",101],["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","response",101],["T_WHITESPACE"," ",101],"?",":",["T_WHITESPACE"," ",101],["T_STRING","Yii",101],["T_DOUBLE_COLON","::",101],["T_VARIABLE","$app",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","getResponse",101],"(",")",";",["T_WHITESPACE","\n\n        ",101],["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","overrideDefaultSettings",103],"(",["T_VARIABLE","$action",103],")",";",["T_WHITESPACE","\n\n        ",103],["T_VARIABLE","$requestCorsHeaders",105],["T_WHITESPACE"," ",105],"=",["T_WHITESPACE"," ",105],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","extractHeaders",105],"(",")",";",["T_WHITESPACE","\n        ",105],["T_VARIABLE","$responseCorsHeaders",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$this",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","prepareHeaders",106],"(",["T_VARIABLE","$requestCorsHeaders",106],")",";",["T_WHITESPACE","\n        ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","addCorsHeaders",107],"(",["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","response",107],",",["T_WHITESPACE"," ",107],["T_VARIABLE","$responseCorsHeaders",107],")",";",["T_WHITESPACE","\n\n        ",107],["T_RETURN","return",109],["T_WHITESPACE"," ",109],["T_STRING","true",109],";",["T_WHITESPACE","\n    ",109],"}",["T_WHITESPACE","\n\n    ",110],["T_DOC_COMMENT","\/**\n     * Override settings for specific action\n     * @param \\yii\\base\\Action $action the action settings to override\n     *\/",112],["T_WHITESPACE","\n    ",115],["T_PUBLIC","public",116],["T_WHITESPACE"," ",116],["T_FUNCTION","function",116],["T_WHITESPACE"," ",116],["T_STRING","overrideDefaultSettings",116],"(",["T_VARIABLE","$action",116],")",["T_WHITESPACE","\n    ",116],"{",["T_WHITESPACE","\n        ",117],["T_IF","if",118],["T_WHITESPACE"," ",118],"(",["T_ISSET","isset",118],"(",["T_VARIABLE","$this",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","actions",118],"[",["T_VARIABLE","$action",118],["T_OBJECT_OPERATOR","->",118],["T_STRING","id",118],"]",")",")",["T_WHITESPACE"," ",118],"{",["T_WHITESPACE","\n            ",118],["T_VARIABLE","$actionParams",119],["T_WHITESPACE"," ",119],"=",["T_WHITESPACE"," ",119],["T_VARIABLE","$this",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","actions",119],"[",["T_VARIABLE","$action",119],["T_OBJECT_OPERATOR","->",119],["T_STRING","id",119],"]",";",["T_WHITESPACE","\n            ",119],["T_VARIABLE","$actionParamsKeys",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_STRING","array_keys",120],"(",["T_VARIABLE","$actionParams",120],")",";",["T_WHITESPACE","\n            ",120],["T_FOREACH","foreach",121],["T_WHITESPACE"," ",121],"(",["T_VARIABLE","$this",121],["T_OBJECT_OPERATOR","->",121],["T_STRING","cors",121],["T_WHITESPACE"," ",121],["T_AS","as",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$headerField",121],["T_WHITESPACE"," ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_VARIABLE","$headerValue",121],")",["T_WHITESPACE"," ",121],"{",["T_WHITESPACE","\n                ",121],["T_IF","if",122],["T_WHITESPACE"," ",122],"(",["T_STRING","in_array",122],"(",["T_VARIABLE","$headerField",122],",",["T_WHITESPACE"," ",122],["T_VARIABLE","$actionParamsKeys",122],")",")",["T_WHITESPACE"," ",122],"{",["T_WHITESPACE","\n                    ",122],["T_VARIABLE","$this",123],["T_OBJECT_OPERATOR","->",123],["T_STRING","cors",123],"[",["T_VARIABLE","$headerField",123],"]",["T_WHITESPACE"," ",123],"=",["T_WHITESPACE"," ",123],["T_VARIABLE","$actionParams",123],"[",["T_VARIABLE","$headerField",123],"]",";",["T_WHITESPACE","\n                ",123],"}",["T_WHITESPACE","\n            ",124],"}",["T_WHITESPACE","\n        ",125],"}",["T_WHITESPACE","\n    ",126],"}",["T_WHITESPACE","\n\n    ",127],["T_DOC_COMMENT","\/**\n     * Extract CORS headers from the request\n     * @return array CORS headers to handle\n     *\/",129],["T_WHITESPACE","\n    ",132],["T_PUBLIC","public",133],["T_WHITESPACE"," ",133],["T_FUNCTION","function",133],["T_WHITESPACE"," ",133],["T_STRING","extractHeaders",133],"(",")",["T_WHITESPACE","\n    ",133],"{",["T_WHITESPACE","\n        ",134],["T_VARIABLE","$headers",135],["T_WHITESPACE"," ",135],"=",["T_WHITESPACE"," ",135],"[","]",";",["T_WHITESPACE","\n        ",135],["T_VARIABLE","$requestHeaders",136],["T_WHITESPACE"," ",136],"=",["T_WHITESPACE"," ",136],["T_STRING","array_keys",136],"(",["T_VARIABLE","$this",136],["T_OBJECT_OPERATOR","->",136],["T_STRING","cors",136],")",";",["T_WHITESPACE","\n        ",136],["T_FOREACH","foreach",137],["T_WHITESPACE"," ",137],"(",["T_VARIABLE","$requestHeaders",137],["T_WHITESPACE"," ",137],["T_AS","as",137],["T_WHITESPACE"," ",137],["T_VARIABLE","$headerField",137],")",["T_WHITESPACE"," ",137],"{",["T_WHITESPACE","\n            ",137],["T_VARIABLE","$serverField",138],["T_WHITESPACE"," ",138],"=",["T_WHITESPACE"," ",138],["T_VARIABLE","$this",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","headerizeToPhp",138],"(",["T_VARIABLE","$headerField",138],")",";",["T_WHITESPACE","\n            ",138],["T_VARIABLE","$headerData",139],["T_WHITESPACE"," ",139],"=",["T_WHITESPACE"," ",139],["T_ISSET","isset",139],"(",["T_VARIABLE","$_SERVER",139],"[",["T_VARIABLE","$serverField",139],"]",")",["T_WHITESPACE"," ",139],"?",["T_WHITESPACE"," ",139],["T_VARIABLE","$_SERVER",139],"[",["T_VARIABLE","$serverField",139],"]",["T_WHITESPACE"," ",139],":",["T_WHITESPACE"," ",139],["T_STRING","null",139],";",["T_WHITESPACE","\n            ",139],["T_IF","if",140],["T_WHITESPACE"," ",140],"(",["T_VARIABLE","$headerData",140],["T_WHITESPACE"," ",140],["T_IS_NOT_IDENTICAL","!==",140],["T_WHITESPACE"," ",140],["T_STRING","null",140],")",["T_WHITESPACE"," ",140],"{",["T_WHITESPACE","\n                ",140],["T_VARIABLE","$headers",141],"[",["T_VARIABLE","$headerField",141],"]",["T_WHITESPACE"," ",141],"=",["T_WHITESPACE"," ",141],["T_VARIABLE","$headerData",141],";",["T_WHITESPACE","\n            ",141],"}",["T_WHITESPACE","\n        ",142],"}",["T_WHITESPACE","\n        ",143],["T_RETURN","return",144],["T_WHITESPACE"," ",144],["T_VARIABLE","$headers",144],";",["T_WHITESPACE","\n    ",144],"}",["T_WHITESPACE","\n\n    ",145],["T_DOC_COMMENT","\/**\n     * For each CORS headers create the specific response\n     * @param array $requestHeaders CORS headers we have detected\n     * @return array CORS headers ready to be sent\n     *\/",147],["T_WHITESPACE","\n    ",151],["T_PUBLIC","public",152],["T_WHITESPACE"," ",152],["T_FUNCTION","function",152],["T_WHITESPACE"," ",152],["T_STRING","prepareHeaders",152],"(",["T_VARIABLE","$requestHeaders",152],")",["T_WHITESPACE","\n    ",152],"{",["T_WHITESPACE","\n        ",153],["T_VARIABLE","$responseHeaders",154],["T_WHITESPACE"," ",154],"=",["T_WHITESPACE"," ",154],"[","]",";",["T_WHITESPACE","\n        ",154],["T_COMMENT","\/\/ handle Origin\n",155],["T_WHITESPACE","        ",156],["T_IF","if",156],["T_WHITESPACE"," ",156],"(",["T_ISSET","isset",156],"(",["T_VARIABLE","$requestHeaders",156],"[",["T_CONSTANT_ENCAPSED_STRING","'Origin'",156],"]",",",["T_WHITESPACE"," ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","cors",156],"[",["T_CONSTANT_ENCAPSED_STRING","'Origin'",156],"]",")",")",["T_WHITESPACE"," ",156],"{",["T_WHITESPACE","\n            ",156],["T_IF","if",157],["T_WHITESPACE"," ",157],"(",["T_STRING","in_array",157],"(",["T_CONSTANT_ENCAPSED_STRING","'*'",157],",",["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","cors",157],"[",["T_CONSTANT_ENCAPSED_STRING","'Origin'",157],"]",")",["T_WHITESPACE"," ",157],["T_BOOLEAN_OR","||",157],["T_WHITESPACE"," ",157],["T_STRING","in_array",157],"(",["T_VARIABLE","$requestHeaders",157],"[",["T_CONSTANT_ENCAPSED_STRING","'Origin'",157],"]",",",["T_WHITESPACE"," ",157],["T_VARIABLE","$this",157],["T_OBJECT_OPERATOR","->",157],["T_STRING","cors",157],"[",["T_CONSTANT_ENCAPSED_STRING","'Origin'",157],"]",")",")",["T_WHITESPACE"," ",157],"{",["T_WHITESPACE","\n                ",157],["T_VARIABLE","$responseHeaders",158],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Allow-Origin'",158],"]",["T_WHITESPACE"," ",158],"=",["T_WHITESPACE"," ",158],["T_VARIABLE","$requestHeaders",158],"[",["T_CONSTANT_ENCAPSED_STRING","'Origin'",158],"]",";",["T_WHITESPACE","\n            ",158],"}",["T_WHITESPACE","\n        ",159],"}",["T_WHITESPACE","\n\n        ",160],["T_VARIABLE","$this",162],["T_OBJECT_OPERATOR","->",162],["T_STRING","prepareAllowHeaders",162],"(",["T_CONSTANT_ENCAPSED_STRING","'Headers'",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$requestHeaders",162],",",["T_WHITESPACE"," ",162],["T_VARIABLE","$responseHeaders",162],")",";",["T_WHITESPACE","\n\n        ",162],["T_IF","if",164],["T_WHITESPACE"," ",164],"(",["T_ISSET","isset",164],"(",["T_VARIABLE","$requestHeaders",164],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Request-Method'",164],"]",")",")",["T_WHITESPACE"," ",164],"{",["T_WHITESPACE","\n            ",164],["T_VARIABLE","$responseHeaders",165],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Allow-Methods'",165],"]",["T_WHITESPACE"," ",165],"=",["T_WHITESPACE"," ",165],["T_STRING","implode",165],"(",["T_CONSTANT_ENCAPSED_STRING","', '",165],",",["T_WHITESPACE"," ",165],["T_VARIABLE","$this",165],["T_OBJECT_OPERATOR","->",165],["T_STRING","cors",165],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Request-Method'",165],"]",")",";",["T_WHITESPACE","\n        ",165],"}",["T_WHITESPACE","\n\n        ",166],["T_IF","if",168],["T_WHITESPACE"," ",168],"(",["T_ISSET","isset",168],"(",["T_VARIABLE","$this",168],["T_OBJECT_OPERATOR","->",168],["T_STRING","cors",168],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Allow-Credentials'",168],"]",")",")",["T_WHITESPACE"," ",168],"{",["T_WHITESPACE","\n            ",168],["T_VARIABLE","$responseHeaders",169],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Allow-Credentials'",169],"]",["T_WHITESPACE"," ",169],"=",["T_WHITESPACE"," ",169],["T_VARIABLE","$this",169],["T_OBJECT_OPERATOR","->",169],["T_STRING","cors",169],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Allow-Credentials'",169],"]",["T_WHITESPACE"," ",169],"?",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'true'",169],["T_WHITESPACE"," ",169],":",["T_WHITESPACE"," ",169],["T_CONSTANT_ENCAPSED_STRING","'false'",169],";",["T_WHITESPACE","\n        ",169],"}",["T_WHITESPACE","\n\n        ",170],["T_IF","if",172],["T_WHITESPACE"," ",172],"(",["T_ISSET","isset",172],"(",["T_VARIABLE","$this",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","cors",172],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Max-Age'",172],"]",")",["T_WHITESPACE"," ",172],["T_BOOLEAN_AND","&&",172],["T_WHITESPACE"," ",172],["T_STRING","Yii",172],["T_DOUBLE_COLON","::",172],["T_VARIABLE","$app",172],["T_OBJECT_OPERATOR","->",172],["T_STRING","getRequest",172],"(",")",["T_OBJECT_OPERATOR","->",172],["T_STRING","getIsOptions",172],"(",")",")",["T_WHITESPACE"," ",172],"{",["T_WHITESPACE","\n            ",172],["T_VARIABLE","$responseHeaders",173],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Max-Age'",173],"]",["T_WHITESPACE"," ",173],"=",["T_WHITESPACE"," ",173],["T_VARIABLE","$this",173],["T_OBJECT_OPERATOR","->",173],["T_STRING","cors",173],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Max-Age'",173],"]",";",["T_WHITESPACE","\n        ",173],"}",["T_WHITESPACE","\n\n        ",174],["T_IF","if",176],["T_WHITESPACE"," ",176],"(",["T_ISSET","isset",176],"(",["T_VARIABLE","$this",176],["T_OBJECT_OPERATOR","->",176],["T_STRING","cors",176],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Expose-Headers'",176],"]",")",")",["T_WHITESPACE"," ",176],"{",["T_WHITESPACE","\n            ",176],["T_VARIABLE","$responseHeaders",177],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Expose-Headers'",177],"]",["T_WHITESPACE"," ",177],"=",["T_WHITESPACE"," ",177],["T_STRING","implode",177],"(",["T_CONSTANT_ENCAPSED_STRING","', '",177],",",["T_WHITESPACE"," ",177],["T_VARIABLE","$this",177],["T_OBJECT_OPERATOR","->",177],["T_STRING","cors",177],"[",["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Expose-Headers'",177],"]",")",";",["T_WHITESPACE","\n        ",177],"}",["T_WHITESPACE","\n\n        ",178],["T_RETURN","return",180],["T_WHITESPACE"," ",180],["T_VARIABLE","$responseHeaders",180],";",["T_WHITESPACE","\n    ",180],"}",["T_WHITESPACE","\n\n    ",181],["T_DOC_COMMENT","\/**\n     * Handle classic CORS request to avoid duplicate code\n     * @param string $type the kind of headers we would handle\n     * @param array $requestHeaders CORS headers request by client\n     * @param array $responseHeaders CORS response headers sent to the client\n     *\/",183],["T_WHITESPACE","\n    ",188],["T_PROTECTED","protected",189],["T_WHITESPACE"," ",189],["T_FUNCTION","function",189],["T_WHITESPACE"," ",189],["T_STRING","prepareAllowHeaders",189],"(",["T_VARIABLE","$type",189],",",["T_WHITESPACE"," ",189],["T_VARIABLE","$requestHeaders",189],",",["T_WHITESPACE"," ",189],"&",["T_VARIABLE","$responseHeaders",189],")",["T_WHITESPACE","\n    ",189],"{",["T_WHITESPACE","\n        ",190],["T_VARIABLE","$requestHeaderField",191],["T_WHITESPACE"," ",191],"=",["T_WHITESPACE"," ",191],["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Request-'",191],["T_WHITESPACE"," ",191],".",["T_WHITESPACE"," ",191],["T_VARIABLE","$type",191],";",["T_WHITESPACE","\n        ",191],["T_VARIABLE","$responseHeaderField",192],["T_WHITESPACE"," ",192],"=",["T_WHITESPACE"," ",192],["T_CONSTANT_ENCAPSED_STRING","'Access-Control-Allow-'",192],["T_WHITESPACE"," ",192],".",["T_WHITESPACE"," ",192],["T_VARIABLE","$type",192],";",["T_WHITESPACE","\n        ",192],["T_IF","if",193],["T_WHITESPACE"," ",193],"(","!",["T_ISSET","isset",193],"(",["T_VARIABLE","$requestHeaders",193],"[",["T_VARIABLE","$requestHeaderField",193],"]",",",["T_WHITESPACE"," ",193],["T_VARIABLE","$this",193],["T_OBJECT_OPERATOR","->",193],["T_STRING","cors",193],"[",["T_VARIABLE","$requestHeaderField",193],"]",")",")",["T_WHITESPACE"," ",193],"{",["T_WHITESPACE","\n            ",193],["T_RETURN","return",194],";",["T_WHITESPACE","\n        ",194],"}",["T_WHITESPACE","\n        ",195],["T_IF","if",196],["T_WHITESPACE"," ",196],"(",["T_STRING","in_array",196],"(",["T_CONSTANT_ENCAPSED_STRING","'*'",196],",",["T_WHITESPACE"," ",196],["T_VARIABLE","$this",196],["T_OBJECT_OPERATOR","->",196],["T_STRING","cors",196],"[",["T_VARIABLE","$requestHeaderField",196],"]",")",")",["T_WHITESPACE"," ",196],"{",["T_WHITESPACE","\n            ",196],["T_VARIABLE","$responseHeaders",197],"[",["T_VARIABLE","$responseHeaderField",197],"]",["T_WHITESPACE"," ",197],"=",["T_WHITESPACE"," ",197],["T_VARIABLE","$this",197],["T_OBJECT_OPERATOR","->",197],["T_STRING","headerize",197],"(",["T_VARIABLE","$requestHeaders",197],"[",["T_VARIABLE","$requestHeaderField",197],"]",")",";",["T_WHITESPACE","\n        ",197],"}",["T_WHITESPACE"," ",198],["T_ELSE","else",198],["T_WHITESPACE"," ",198],"{",["T_WHITESPACE","\n            ",198],["T_VARIABLE","$requestedData",199],["T_WHITESPACE"," ",199],"=",["T_WHITESPACE"," ",199],["T_STRING","preg_split",199],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/[\\\\s,]+\/\"",199],",",["T_WHITESPACE"," ",199],["T_VARIABLE","$requestHeaders",199],"[",["T_VARIABLE","$requestHeaderField",199],"]",",",["T_WHITESPACE"," ",199],"-",["T_LNUMBER","1",199],",",["T_WHITESPACE"," ",199],["T_STRING","PREG_SPLIT_NO_EMPTY",199],")",";",["T_WHITESPACE","\n            ",199],["T_VARIABLE","$acceptedData",200],["T_WHITESPACE"," ",200],"=",["T_WHITESPACE"," ",200],["T_STRING","array_uintersect",200],"(",["T_VARIABLE","$requestedData",200],",",["T_WHITESPACE"," ",200],["T_VARIABLE","$this",200],["T_OBJECT_OPERATOR","->",200],["T_STRING","cors",200],"[",["T_VARIABLE","$requestHeaderField",200],"]",",",["T_WHITESPACE"," ",200],["T_CONSTANT_ENCAPSED_STRING","'strcasecmp'",200],")",";",["T_WHITESPACE","\n            ",200],["T_IF","if",201],["T_WHITESPACE"," ",201],"(","!",["T_EMPTY","empty",201],"(",["T_VARIABLE","$acceptedData",201],")",")",["T_WHITESPACE"," ",201],"{",["T_WHITESPACE","\n                ",201],["T_VARIABLE","$responseHeaders",202],"[",["T_VARIABLE","$responseHeaderField",202],"]",["T_WHITESPACE"," ",202],"=",["T_WHITESPACE"," ",202],["T_STRING","implode",202],"(",["T_CONSTANT_ENCAPSED_STRING","', '",202],",",["T_WHITESPACE"," ",202],["T_VARIABLE","$acceptedData",202],")",";",["T_WHITESPACE","\n            ",202],"}",["T_WHITESPACE","\n        ",203],"}",["T_WHITESPACE","\n    ",204],"}",["T_WHITESPACE","\n\n    ",205],["T_DOC_COMMENT","\/**\n     * Adds the CORS headers to the response\n     * @param Response $response\n     * @param array $headers CORS headers which have been computed\n     *\/",207],["T_WHITESPACE","\n    ",211],["T_PUBLIC","public",212],["T_WHITESPACE"," ",212],["T_FUNCTION","function",212],["T_WHITESPACE"," ",212],["T_STRING","addCorsHeaders",212],"(",["T_VARIABLE","$response",212],",",["T_WHITESPACE"," ",212],["T_VARIABLE","$headers",212],")",["T_WHITESPACE","\n    ",212],"{",["T_WHITESPACE","\n        ",213],["T_IF","if",214],["T_WHITESPACE"," ",214],"(",["T_EMPTY","empty",214],"(",["T_VARIABLE","$headers",214],")",["T_WHITESPACE"," ",214],["T_IS_IDENTICAL","===",214],["T_WHITESPACE"," ",214],["T_STRING","false",214],")",["T_WHITESPACE"," ",214],"{",["T_WHITESPACE","\n            ",214],["T_VARIABLE","$responseHeaders",215],["T_WHITESPACE"," ",215],"=",["T_WHITESPACE"," ",215],["T_VARIABLE","$response",215],["T_OBJECT_OPERATOR","->",215],["T_STRING","getHeaders",215],"(",")",";",["T_WHITESPACE","\n            ",215],["T_FOREACH","foreach",216],["T_WHITESPACE"," ",216],"(",["T_VARIABLE","$headers",216],["T_WHITESPACE"," ",216],["T_AS","as",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$field",216],["T_WHITESPACE"," ",216],["T_DOUBLE_ARROW","=>",216],["T_WHITESPACE"," ",216],["T_VARIABLE","$value",216],")",["T_WHITESPACE"," ",216],"{",["T_WHITESPACE","\n                ",216],["T_VARIABLE","$responseHeaders",217],["T_OBJECT_OPERATOR","->",217],["T_STRING","set",217],"(",["T_VARIABLE","$field",217],",",["T_WHITESPACE"," ",217],["T_VARIABLE","$value",217],")",";",["T_WHITESPACE","\n            ",217],"}",["T_WHITESPACE","\n        ",218],"}",["T_WHITESPACE","\n    ",219],"}",["T_WHITESPACE","\n\n    ",220],["T_DOC_COMMENT","\/**\n     * Convert any string (including php headers with HTTP prefix) to header format like :\n     *  * X-PINGOTHER -> X-Pingother\n     *  * X_PINGOTHER -> X-Pingother\n     * @param string $string string to convert\n     * @return string the result in \"header\" format\n     *\/",222],["T_WHITESPACE","\n    ",228],["T_PROTECTED","protected",229],["T_WHITESPACE"," ",229],["T_FUNCTION","function",229],["T_WHITESPACE"," ",229],["T_STRING","headerize",229],"(",["T_VARIABLE","$string",229],")",["T_WHITESPACE","\n    ",229],"{",["T_WHITESPACE","\n        ",230],["T_VARIABLE","$headers",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","preg_split",231],"(",["T_CONSTANT_ENCAPSED_STRING","\"\/[\\\\s,]+\/\"",231],",",["T_WHITESPACE"," ",231],["T_VARIABLE","$string",231],",",["T_WHITESPACE"," ",231],"-",["T_LNUMBER","1",231],",",["T_WHITESPACE"," ",231],["T_STRING","PREG_SPLIT_NO_EMPTY",231],")",";",["T_WHITESPACE","\n        ",231],["T_VARIABLE","$headers",232],["T_WHITESPACE"," ",232],"=",["T_WHITESPACE"," ",232],["T_STRING","array_map",232],"(",["T_FUNCTION","function",232],["T_WHITESPACE"," ",232],"(",["T_VARIABLE","$element",232],")",["T_WHITESPACE"," ",232],"{",["T_WHITESPACE","\n            ",232],["T_RETURN","return",233],["T_WHITESPACE"," ",233],["T_STRING","str_replace",233],"(",["T_CONSTANT_ENCAPSED_STRING","' '",233],",",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","'-'",233],",",["T_WHITESPACE"," ",233],["T_STRING","ucwords",233],"(",["T_STRING","strtolower",233],"(",["T_STRING","str_replace",233],"(","[",["T_CONSTANT_ENCAPSED_STRING","'_'",233],",",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","'-'",233],"]",",",["T_WHITESPACE"," ",233],"[",["T_CONSTANT_ENCAPSED_STRING","' '",233],",",["T_WHITESPACE"," ",233],["T_CONSTANT_ENCAPSED_STRING","' '",233],"]",",",["T_WHITESPACE"," ",233],["T_VARIABLE","$element",233],")",")",")",")",";",["T_WHITESPACE","\n        ",233],"}",",",["T_WHITESPACE"," ",234],["T_VARIABLE","$headers",234],")",";",["T_WHITESPACE","\n        ",234],["T_RETURN","return",235],["T_WHITESPACE"," ",235],["T_STRING","implode",235],"(",["T_CONSTANT_ENCAPSED_STRING","', '",235],",",["T_WHITESPACE"," ",235],["T_VARIABLE","$headers",235],")",";",["T_WHITESPACE","\n    ",235],"}",["T_WHITESPACE","\n\n    ",236],["T_DOC_COMMENT","\/**\n     * Convert any string (including php headers with HTTP prefix) to header format like :\n     *  * X-Pingother -> HTTP_X_PINGOTHER\n     *  * X PINGOTHER -> HTTP_X_PINGOTHER\n     * @param string $string string to convert\n     * @return string the result in \"php $_SERVER header\" format\n     *\/",238],["T_WHITESPACE","\n    ",244],["T_PROTECTED","protected",245],["T_WHITESPACE"," ",245],["T_FUNCTION","function",245],["T_WHITESPACE"," ",245],["T_STRING","headerizeToPhp",245],"(",["T_VARIABLE","$string",245],")",["T_WHITESPACE","\n    ",245],"{",["T_WHITESPACE","\n        ",246],["T_RETURN","return",247],["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","'HTTP_'",247],["T_WHITESPACE"," ",247],".",["T_WHITESPACE"," ",247],["T_STRING","strtoupper",247],"(",["T_STRING","str_replace",247],"(","[",["T_CONSTANT_ENCAPSED_STRING","' '",247],",",["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","'-'",247],"]",",",["T_WHITESPACE"," ",247],"[",["T_CONSTANT_ENCAPSED_STRING","'_'",247],",",["T_WHITESPACE"," ",247],["T_CONSTANT_ENCAPSED_STRING","'_'",247],"]",",",["T_WHITESPACE"," ",247],["T_VARIABLE","$string",247],")",")",";",["T_WHITESPACE","\n    ",247],"}",["T_WHITESPACE","\n",248],"}",["T_WHITESPACE","\n",249]]