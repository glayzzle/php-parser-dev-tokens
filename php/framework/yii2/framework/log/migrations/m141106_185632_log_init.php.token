[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * @link http:\/\/www.yiiframework.com\/\n * @copyright Copyright (c) 2008 Yii Software LLC\n * @license http:\/\/www.yiiframework.com\/license\/\n *\/",2],["T_WHITESPACE","\n\n",6],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","yii",8],["T_NS_SEPARATOR","\\",8],["T_STRING","base",8],["T_NS_SEPARATOR","\\",8],["T_STRING","InvalidConfigException",8],";",["T_WHITESPACE","\n",8],["T_USE","use",9],["T_WHITESPACE"," ",9],["T_STRING","yii",9],["T_NS_SEPARATOR","\\",9],["T_STRING","db",9],["T_NS_SEPARATOR","\\",9],["T_STRING","Migration",9],";",["T_WHITESPACE","\n",9],["T_USE","use",10],["T_WHITESPACE"," ",10],["T_STRING","yii",10],["T_NS_SEPARATOR","\\",10],["T_STRING","log",10],["T_NS_SEPARATOR","\\",10],["T_STRING","DbTarget",10],";",["T_WHITESPACE","\n\n",10],["T_DOC_COMMENT","\/**\n * Initializes log table.\n *\n * The indexes declared are not required. They are mainly used to improve the performance\n * of some queries about message levels and categories. Depending on your actual needs, you may\n * want to create additional indexes (e.g. index on `log_time`).\n *\n * @author Alexander Makarov <sam@rmcreative.ru>\n * @since 2.0.1\n *\/",12],["T_WHITESPACE","\n",21],["T_CLASS","class",22],["T_WHITESPACE"," ",22],["T_STRING","m141106_185632_log_init",22],["T_WHITESPACE"," ",22],["T_EXTENDS","extends",22],["T_WHITESPACE"," ",22],["T_STRING","Migration",22],["T_WHITESPACE","\n",22],"{",["T_WHITESPACE","\n    ",23],["T_DOC_COMMENT","\/**\n     * @var DbTarget[] Targets to create log table for\n     *\/",24],["T_WHITESPACE","\n    ",26],["T_PRIVATE","private",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$dbTargets",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],"[","]",";",["T_WHITESPACE","\n\n    ",27],["T_DOC_COMMENT","\/**\n     * @throws InvalidConfigException\n     * @return DbTarget[]\n     *\/",29],["T_WHITESPACE","\n    ",32],["T_PROTECTED","protected",33],["T_WHITESPACE"," ",33],["T_FUNCTION","function",33],["T_WHITESPACE"," ",33],["T_STRING","getDbTargets",33],"(",")",["T_WHITESPACE","\n    ",33],"{",["T_WHITESPACE","\n        ",34],["T_IF","if",35],["T_WHITESPACE"," ",35],"(",["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","dbTargets",35],["T_WHITESPACE"," ",35],["T_IS_IDENTICAL","===",35],["T_WHITESPACE"," ",35],"[","]",")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n            ",35],["T_VARIABLE","$log",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_STRING","Yii",36],["T_DOUBLE_COLON","::",36],["T_VARIABLE","$app",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","getLog",36],"(",")",";",["T_WHITESPACE","\n\n            ",36],["T_VARIABLE","$usedTargets",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],"[","]",";",["T_WHITESPACE","\n            ",38],["T_FOREACH","foreach",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$log",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","targets",39],["T_WHITESPACE"," ",39],["T_AS","as",39],["T_WHITESPACE"," ",39],["T_VARIABLE","$target",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n                ",39],["T_IF","if",40],["T_WHITESPACE"," ",40],"(",["T_VARIABLE","$target",40],["T_WHITESPACE"," ",40],["T_INSTANCEOF","instanceof",40],["T_WHITESPACE"," ",40],["T_STRING","DbTarget",40],")",["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n                    ",40],["T_VARIABLE","$currentTarget",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],"[",["T_WHITESPACE","\n                        ",41],["T_VARIABLE","$target",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","db",42],",",["T_WHITESPACE","\n                        ",42],["T_VARIABLE","$target",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","logTable",43],",",["T_WHITESPACE","\n                    ",43],"]",";",["T_WHITESPACE","\n                    ",44],["T_IF","if",45],["T_WHITESPACE"," ",45],"(","!",["T_STRING","in_array",45],"(",["T_VARIABLE","$currentTarget",45],",",["T_WHITESPACE"," ",45],["T_VARIABLE","$usedTargets",45],",",["T_WHITESPACE"," ",45],["T_STRING","true",45],")",")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n                        ",45],["T_COMMENT","\/\/ do not create same table twice\n",46],["T_WHITESPACE","                        ",47],["T_VARIABLE","$usedTargets",47],"[","]",["T_WHITESPACE"," ",47],"=",["T_WHITESPACE"," ",47],["T_VARIABLE","$currentTarget",47],";",["T_WHITESPACE","\n                        ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","dbTargets",48],"[","]",["T_WHITESPACE"," ",48],"=",["T_WHITESPACE"," ",48],["T_VARIABLE","$target",48],";",["T_WHITESPACE","\n                    ",48],"}",["T_WHITESPACE","\n                ",49],"}",["T_WHITESPACE","\n            ",50],"}",["T_WHITESPACE","\n\n            ",51],["T_IF","if",53],["T_WHITESPACE"," ",53],"(",["T_VARIABLE","$this",53],["T_OBJECT_OPERATOR","->",53],["T_STRING","dbTargets",53],["T_WHITESPACE"," ",53],["T_IS_IDENTICAL","===",53],["T_WHITESPACE"," ",53],"[","]",")",["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n                ",53],["T_THROW","throw",54],["T_WHITESPACE"," ",54],["T_NEW","new",54],["T_WHITESPACE"," ",54],["T_STRING","InvalidConfigException",54],"(",["T_CONSTANT_ENCAPSED_STRING","'You should configure \"log\" component to use one or more database targets before executing this migration.'",54],")",";",["T_WHITESPACE","\n            ",54],"}",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n        ",56],["T_RETURN","return",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$this",57],["T_OBJECT_OPERATOR","->",57],["T_STRING","dbTargets",57],";",["T_WHITESPACE","\n    ",57],"}",["T_WHITESPACE","\n\n    ",58],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","up",60],"(",")",["T_WHITESPACE","\n    ",60],"{",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$targets",62],["T_WHITESPACE"," ",62],"=",["T_WHITESPACE"," ",62],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getDbTargets",62],"(",")",";",["T_WHITESPACE","\n        ",62],["T_FOREACH","foreach",63],["T_WHITESPACE"," ",63],"(",["T_VARIABLE","$targets",63],["T_WHITESPACE"," ",63],["T_AS","as",63],["T_WHITESPACE"," ",63],["T_VARIABLE","$target",63],")",["T_WHITESPACE"," ",63],"{",["T_WHITESPACE","\n            ",63],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","db",64],["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_VARIABLE","$target",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","db",64],";",["T_WHITESPACE","\n\n            ",64],["T_VARIABLE","$tableOptions",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_STRING","null",66],";",["T_WHITESPACE","\n            ",66],["T_IF","if",67],["T_WHITESPACE"," ",67],"(",["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","db",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","driverName",67],["T_WHITESPACE"," ",67],["T_IS_IDENTICAL","===",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'mysql'",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n                ",67],["T_COMMENT","\/\/ http:\/\/stackoverflow.com\/questions\/766809\/whats-the-difference-between-utf8-general-ci-and-utf8-unicode-ci\n",68],["T_WHITESPACE","                ",69],["T_VARIABLE","$tableOptions",69],["T_WHITESPACE"," ",69],"=",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'CHARACTER SET utf8 COLLATE utf8_unicode_ci ENGINE=InnoDB'",69],";",["T_WHITESPACE","\n            ",69],"}",["T_WHITESPACE","\n\n            ",70],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","createTable",72],"(",["T_VARIABLE","$target",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","logTable",72],",",["T_WHITESPACE"," ",72],"[",["T_WHITESPACE","\n                ",72],["T_CONSTANT_ENCAPSED_STRING","'id'",73],["T_WHITESPACE"," ",73],["T_DOUBLE_ARROW","=>",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","bigPrimaryKey",73],"(",")",",",["T_WHITESPACE","\n                ",73],["T_CONSTANT_ENCAPSED_STRING","'level'",74],["T_WHITESPACE"," ",74],["T_DOUBLE_ARROW","=>",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","integer",74],"(",")",",",["T_WHITESPACE","\n                ",74],["T_CONSTANT_ENCAPSED_STRING","'category'",75],["T_WHITESPACE"," ",75],["T_DOUBLE_ARROW","=>",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","string",75],"(",")",",",["T_WHITESPACE","\n                ",75],["T_CONSTANT_ENCAPSED_STRING","'log_time'",76],["T_WHITESPACE"," ",76],["T_DOUBLE_ARROW","=>",76],["T_WHITESPACE"," ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","double",76],"(",")",",",["T_WHITESPACE","\n                ",76],["T_CONSTANT_ENCAPSED_STRING","'prefix'",77],["T_WHITESPACE"," ",77],["T_DOUBLE_ARROW","=>",77],["T_WHITESPACE"," ",77],["T_VARIABLE","$this",77],["T_OBJECT_OPERATOR","->",77],["T_STRING","text",77],"(",")",",",["T_WHITESPACE","\n                ",77],["T_CONSTANT_ENCAPSED_STRING","'message'",78],["T_WHITESPACE"," ",78],["T_DOUBLE_ARROW","=>",78],["T_WHITESPACE"," ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","text",78],"(",")",",",["T_WHITESPACE","\n            ",78],"]",",",["T_WHITESPACE"," ",79],["T_VARIABLE","$tableOptions",79],")",";",["T_WHITESPACE","\n\n            ",79],["T_VARIABLE","$this",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","createIndex",81],"(",["T_CONSTANT_ENCAPSED_STRING","'idx_log_level'",81],",",["T_WHITESPACE"," ",81],["T_VARIABLE","$target",81],["T_OBJECT_OPERATOR","->",81],["T_STRING","logTable",81],",",["T_WHITESPACE"," ",81],["T_CONSTANT_ENCAPSED_STRING","'level'",81],")",";",["T_WHITESPACE","\n            ",81],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","createIndex",82],"(",["T_CONSTANT_ENCAPSED_STRING","'idx_log_category'",82],",",["T_WHITESPACE"," ",82],["T_VARIABLE","$target",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","logTable",82],",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'category'",82],")",";",["T_WHITESPACE","\n        ",82],"}",["T_WHITESPACE","\n    ",83],"}",["T_WHITESPACE","\n\n    ",84],["T_PUBLIC","public",86],["T_WHITESPACE"," ",86],["T_FUNCTION","function",86],["T_WHITESPACE"," ",86],["T_STRING","down",86],"(",")",["T_WHITESPACE","\n    ",86],"{",["T_WHITESPACE","\n        ",87],["T_VARIABLE","$targets",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","getDbTargets",88],"(",")",";",["T_WHITESPACE","\n        ",88],["T_FOREACH","foreach",89],["T_WHITESPACE"," ",89],"(",["T_VARIABLE","$targets",89],["T_WHITESPACE"," ",89],["T_AS","as",89],["T_WHITESPACE"," ",89],["T_VARIABLE","$target",89],")",["T_WHITESPACE"," ",89],"{",["T_WHITESPACE","\n            ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","db",90],["T_WHITESPACE"," ",90],"=",["T_WHITESPACE"," ",90],["T_VARIABLE","$target",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","db",90],";",["T_WHITESPACE","\n\n            ",90],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","dropTable",92],"(",["T_VARIABLE","$target",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","logTable",92],")",";",["T_WHITESPACE","\n        ",92],"}",["T_WHITESPACE","\n    ",93],"}",["T_WHITESPACE","\n",94],"}",["T_WHITESPACE","\n",95]]