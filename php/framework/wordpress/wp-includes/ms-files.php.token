[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * Multisite upload handler.\n *\n * @since 3.0.0\n *\n * @package WordPress\n * @subpackage Multisite\n *\/",2],["T_WHITESPACE","\n\n",9],["T_STRING","define",11],"(",["T_WHITESPACE"," ",11],["T_CONSTANT_ENCAPSED_STRING","'SHORTINIT'",11],",",["T_WHITESPACE"," ",11],["T_STRING","true",11],["T_WHITESPACE"," ",11],")",";",["T_WHITESPACE","\n",11],["T_REQUIRE_ONCE","require_once",12],"(",["T_WHITESPACE"," ",12],["T_STRING","dirname",12],"(",["T_WHITESPACE"," ",12],["T_STRING","dirname",12],"(",["T_WHITESPACE"," ",12],["T_FILE","__FILE__",12],["T_WHITESPACE"," ",12],")",["T_WHITESPACE"," ",12],")",["T_WHITESPACE"," ",12],".",["T_WHITESPACE"," ",12],["T_CONSTANT_ENCAPSED_STRING","'\/wp-load.php'",12],["T_WHITESPACE"," ",12],")",";",["T_WHITESPACE","\n\n",12],["T_IF","if",14],["T_WHITESPACE"," ",14],"(",["T_WHITESPACE"," ",14],"!",["T_STRING","is_multisite",14],"(",")",["T_WHITESPACE"," ",14],")",["T_WHITESPACE","\n\t",14],["T_EXIT","die",15],"(",["T_WHITESPACE"," ",15],["T_CONSTANT_ENCAPSED_STRING","'Multisite support not enabled'",15],["T_WHITESPACE"," ",15],")",";",["T_WHITESPACE","\n\n",15],["T_STRING","ms_file_constants",17],"(",")",";",["T_WHITESPACE","\n\n",17],["T_STRING","error_reporting",19],"(",["T_WHITESPACE"," ",19],["T_LNUMBER","0",19],["T_WHITESPACE"," ",19],")",";",["T_WHITESPACE","\n\n",19],["T_IF","if",21],["T_WHITESPACE"," ",21],"(",["T_WHITESPACE"," ",21],["T_VARIABLE","$current_blog",21],["T_OBJECT_OPERATOR","->",21],["T_STRING","archived",21],["T_WHITESPACE"," ",21],["T_IS_EQUAL","==",21],["T_WHITESPACE"," ",21],["T_CONSTANT_ENCAPSED_STRING","'1'",21],["T_WHITESPACE"," ",21],["T_BOOLEAN_OR","||",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$current_blog",21],["T_OBJECT_OPERATOR","->",21],["T_STRING","spam",21],["T_WHITESPACE"," ",21],["T_IS_EQUAL","==",21],["T_WHITESPACE"," ",21],["T_CONSTANT_ENCAPSED_STRING","'1'",21],["T_WHITESPACE"," ",21],["T_BOOLEAN_OR","||",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$current_blog",21],["T_OBJECT_OPERATOR","->",21],["T_STRING","deleted",21],["T_WHITESPACE"," ",21],["T_IS_EQUAL","==",21],["T_WHITESPACE"," ",21],["T_CONSTANT_ENCAPSED_STRING","'1'",21],["T_WHITESPACE"," ",21],")",["T_WHITESPACE"," ",21],"{",["T_WHITESPACE","\n\t",21],["T_STRING","status_header",22],"(",["T_WHITESPACE"," ",22],["T_LNUMBER","404",22],["T_WHITESPACE"," ",22],")",";",["T_WHITESPACE","\n\t",22],["T_EXIT","die",23],"(",["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'404 &#8212; File not found.'",23],["T_WHITESPACE"," ",23],")",";",["T_WHITESPACE","\n",23],"}",["T_WHITESPACE","\n\n",24],["T_VARIABLE","$file",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_STRING","rtrim",26],"(",["T_WHITESPACE"," ",26],["T_STRING","BLOGUPLOADDIR",26],",",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'\/'",26],["T_WHITESPACE"," ",26],")",["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'\/'",26],["T_WHITESPACE"," ",26],".",["T_WHITESPACE"," ",26],["T_STRING","str_replace",26],"(",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'..'",26],",",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","''",26],",",["T_WHITESPACE"," ",26],["T_VARIABLE","$_GET",26],"[",["T_WHITESPACE"," ",26],["T_CONSTANT_ENCAPSED_STRING","'file'",26],["T_WHITESPACE"," ",26],"]",["T_WHITESPACE"," ",26],")",";",["T_WHITESPACE","\n",26],["T_IF","if",27],["T_WHITESPACE"," ",27],"(",["T_WHITESPACE"," ",27],"!",["T_STRING","is_file",27],"(",["T_WHITESPACE"," ",27],["T_VARIABLE","$file",27],["T_WHITESPACE"," ",27],")",["T_WHITESPACE"," ",27],")",["T_WHITESPACE"," ",27],"{",["T_WHITESPACE","\n\t",27],["T_STRING","status_header",28],"(",["T_WHITESPACE"," ",28],["T_LNUMBER","404",28],["T_WHITESPACE"," ",28],")",";",["T_WHITESPACE","\n\t",28],["T_EXIT","die",29],"(",["T_WHITESPACE"," ",29],["T_CONSTANT_ENCAPSED_STRING","'404 &#8212; File not found.'",29],["T_WHITESPACE"," ",29],")",";",["T_WHITESPACE","\n",29],"}",["T_WHITESPACE","\n\n",30],["T_VARIABLE","$mime",32],["T_WHITESPACE"," ",32],"=",["T_WHITESPACE"," ",32],["T_STRING","wp_check_filetype",32],"(",["T_WHITESPACE"," ",32],["T_VARIABLE","$file",32],["T_WHITESPACE"," ",32],")",";",["T_WHITESPACE","\n",32],["T_IF","if",33],["T_WHITESPACE"," ",33],"(",["T_WHITESPACE"," ",33],["T_STRING","false",33],["T_WHITESPACE"," ",33],["T_IS_IDENTICAL","===",33],["T_WHITESPACE"," ",33],["T_VARIABLE","$mime",33],"[",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'type'",33],["T_WHITESPACE"," ",33],"]",["T_WHITESPACE"," ",33],["T_BOOLEAN_AND","&&",33],["T_WHITESPACE"," ",33],["T_STRING","function_exists",33],"(",["T_WHITESPACE"," ",33],["T_CONSTANT_ENCAPSED_STRING","'mime_content_type'",33],["T_WHITESPACE"," ",33],")",["T_WHITESPACE"," ",33],")",["T_WHITESPACE","\n\t",33],["T_VARIABLE","$mime",34],"[",["T_WHITESPACE"," ",34],["T_CONSTANT_ENCAPSED_STRING","'type'",34],["T_WHITESPACE"," ",34],"]",["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_STRING","mime_content_type",34],"(",["T_WHITESPACE"," ",34],["T_VARIABLE","$file",34],["T_WHITESPACE"," ",34],")",";",["T_WHITESPACE","\n\n",34],["T_IF","if",36],["T_WHITESPACE"," ",36],"(",["T_WHITESPACE"," ",36],["T_VARIABLE","$mime",36],"[",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'type'",36],["T_WHITESPACE"," ",36],"]",["T_WHITESPACE"," ",36],")",["T_WHITESPACE","\n\t",36],["T_VARIABLE","$mimetype",37],["T_WHITESPACE"," ",37],"=",["T_WHITESPACE"," ",37],["T_VARIABLE","$mime",37],"[",["T_WHITESPACE"," ",37],["T_CONSTANT_ENCAPSED_STRING","'type'",37],["T_WHITESPACE"," ",37],"]",";",["T_WHITESPACE","\n",37],["T_ELSE","else",38],["T_WHITESPACE","\n\t",38],["T_VARIABLE","$mimetype",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'image\/'",39],["T_WHITESPACE"," ",39],".",["T_WHITESPACE"," ",39],["T_STRING","substr",39],"(",["T_WHITESPACE"," ",39],["T_VARIABLE","$file",39],",",["T_WHITESPACE"," ",39],["T_STRING","strrpos",39],"(",["T_WHITESPACE"," ",39],["T_VARIABLE","$file",39],",",["T_WHITESPACE"," ",39],["T_CONSTANT_ENCAPSED_STRING","'.'",39],["T_WHITESPACE"," ",39],")",["T_WHITESPACE"," ",39],"+",["T_WHITESPACE"," ",39],["T_LNUMBER","1",39],["T_WHITESPACE"," ",39],")",";",["T_WHITESPACE","\n\n",39],["T_STRING","header",41],"(",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'Content-Type: '",41],["T_WHITESPACE"," ",41],".",["T_WHITESPACE"," ",41],["T_VARIABLE","$mimetype",41],["T_WHITESPACE"," ",41],")",";",["T_WHITESPACE"," ",41],["T_COMMENT","\/\/ always send this\n",41],["T_IF","if",42],["T_WHITESPACE"," ",42],"(",["T_WHITESPACE"," ",42],["T_STRING","false",42],["T_WHITESPACE"," ",42],["T_IS_IDENTICAL","===",42],["T_WHITESPACE"," ",42],["T_STRING","strpos",42],"(",["T_WHITESPACE"," ",42],["T_VARIABLE","$_SERVER",42],"[",["T_CONSTANT_ENCAPSED_STRING","'SERVER_SOFTWARE'",42],"]",",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'Microsoft-IIS'",42],["T_WHITESPACE"," ",42],")",["T_WHITESPACE"," ",42],")",["T_WHITESPACE","\n\t",42],["T_STRING","header",43],"(",["T_WHITESPACE"," ",43],["T_CONSTANT_ENCAPSED_STRING","'Content-Length: '",43],["T_WHITESPACE"," ",43],".",["T_WHITESPACE"," ",43],["T_STRING","filesize",43],"(",["T_WHITESPACE"," ",43],["T_VARIABLE","$file",43],["T_WHITESPACE"," ",43],")",["T_WHITESPACE"," ",43],")",";",["T_WHITESPACE","\n\n",43],["T_COMMENT","\/\/ Optional support for X-Sendfile and X-Accel-Redirect\n",45],["T_IF","if",46],["T_WHITESPACE"," ",46],"(",["T_WHITESPACE"," ",46],["T_STRING","WPMU_ACCEL_REDIRECT",46],["T_WHITESPACE"," ",46],")",["T_WHITESPACE"," ",46],"{",["T_WHITESPACE","\n\t",46],["T_STRING","header",47],"(",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'X-Accel-Redirect: '",47],["T_WHITESPACE"," ",47],".",["T_WHITESPACE"," ",47],["T_STRING","str_replace",47],"(",["T_WHITESPACE"," ",47],["T_STRING","WP_CONTENT_DIR",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","''",47],",",["T_WHITESPACE"," ",47],["T_VARIABLE","$file",47],["T_WHITESPACE"," ",47],")",["T_WHITESPACE"," ",47],")",";",["T_WHITESPACE","\n\t",47],["T_EXIT","exit",48],";",["T_WHITESPACE","\n",48],"}",["T_WHITESPACE"," ",49],["T_ELSEIF","elseif",49],["T_WHITESPACE"," ",49],"(",["T_WHITESPACE"," ",49],["T_STRING","WPMU_SENDFILE",49],["T_WHITESPACE"," ",49],")",["T_WHITESPACE"," ",49],"{",["T_WHITESPACE","\n\t",49],["T_STRING","header",50],"(",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'X-Sendfile: '",50],["T_WHITESPACE"," ",50],".",["T_WHITESPACE"," ",50],["T_VARIABLE","$file",50],["T_WHITESPACE"," ",50],")",";",["T_WHITESPACE","\n\t",50],["T_EXIT","exit",51],";",["T_WHITESPACE","\n",51],"}",["T_WHITESPACE","\n\n",52],["T_VARIABLE","$last_modified",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","gmdate",54],"(",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'D, d M Y H:i:s'",54],",",["T_WHITESPACE"," ",54],["T_STRING","filemtime",54],"(",["T_WHITESPACE"," ",54],["T_VARIABLE","$file",54],["T_WHITESPACE"," ",54],")",["T_WHITESPACE"," ",54],")",";",["T_WHITESPACE","\n",54],["T_VARIABLE","$etag",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'\"'",55],["T_WHITESPACE"," ",55],".",["T_WHITESPACE"," ",55],["T_STRING","md5",55],"(",["T_WHITESPACE"," ",55],["T_VARIABLE","$last_modified",55],["T_WHITESPACE"," ",55],")",["T_WHITESPACE"," ",55],".",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'\"'",55],";",["T_WHITESPACE","\n",55],["T_STRING","header",56],"(",["T_WHITESPACE"," ",56],"\"",["T_ENCAPSED_AND_WHITESPACE","Last-Modified: ",56],["T_VARIABLE","$last_modified",56],["T_ENCAPSED_AND_WHITESPACE"," GMT",56],"\"",["T_WHITESPACE"," ",56],")",";",["T_WHITESPACE","\n",56],["T_STRING","header",57],"(",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'ETag: '",57],["T_WHITESPACE"," ",57],".",["T_WHITESPACE"," ",57],["T_VARIABLE","$etag",57],["T_WHITESPACE"," ",57],")",";",["T_WHITESPACE","\n",57],["T_STRING","header",58],"(",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'Expires: '",58],["T_WHITESPACE"," ",58],".",["T_WHITESPACE"," ",58],["T_STRING","gmdate",58],"(",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'D, d M Y H:i:s'",58],",",["T_WHITESPACE"," ",58],["T_STRING","time",58],"(",")",["T_WHITESPACE"," ",58],"+",["T_WHITESPACE"," ",58],["T_LNUMBER","100000000",58],["T_WHITESPACE"," ",58],")",["T_WHITESPACE"," ",58],".",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","' GMT'",58],["T_WHITESPACE"," ",58],")",";",["T_WHITESPACE","\n\n",58],["T_COMMENT","\/\/ Support for Conditional GET - use stripslashes to avoid formatting.php dependency\n",60],["T_VARIABLE","$client_etag",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_ISSET","isset",61],"(",["T_WHITESPACE"," ",61],["T_VARIABLE","$_SERVER",61],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_IF_NONE_MATCH'",61],"]",["T_WHITESPACE"," ",61],")",["T_WHITESPACE"," ",61],"?",["T_WHITESPACE"," ",61],["T_STRING","stripslashes",61],"(",["T_WHITESPACE"," ",61],["T_VARIABLE","$_SERVER",61],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_IF_NONE_MATCH'",61],"]",["T_WHITESPACE"," ",61],")",["T_WHITESPACE"," ",61],":",["T_WHITESPACE"," ",61],["T_STRING","false",61],";",["T_WHITESPACE","\n\n",61],["T_IF","if",63],["T_WHITESPACE"," ",63],"(",["T_WHITESPACE"," ",63],"!",["T_WHITESPACE"," ",63],["T_ISSET","isset",63],"(",["T_WHITESPACE"," ",63],["T_VARIABLE","$_SERVER",63],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_IF_MODIFIED_SINCE'",63],"]",["T_WHITESPACE"," ",63],")",["T_WHITESPACE"," ",63],")",["T_WHITESPACE","\n\t",63],["T_VARIABLE","$_SERVER",64],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_IF_MODIFIED_SINCE'",64],"]",["T_WHITESPACE"," ",64],"=",["T_WHITESPACE"," ",64],["T_STRING","false",64],";",["T_WHITESPACE","\n\n",64],["T_VARIABLE","$client_last_modified",66],["T_WHITESPACE"," ",66],"=",["T_WHITESPACE"," ",66],["T_STRING","trim",66],"(",["T_WHITESPACE"," ",66],["T_VARIABLE","$_SERVER",66],"[",["T_CONSTANT_ENCAPSED_STRING","'HTTP_IF_MODIFIED_SINCE'",66],"]",["T_WHITESPACE"," ",66],")",";",["T_WHITESPACE","\n",66],["T_COMMENT","\/\/ If string is empty, return 0. If not, attempt to parse into a timestamp\n",67],["T_VARIABLE","$client_modified_timestamp",68],["T_WHITESPACE"," ",68],"=",["T_WHITESPACE"," ",68],["T_VARIABLE","$client_last_modified",68],["T_WHITESPACE"," ",68],"?",["T_WHITESPACE"," ",68],["T_STRING","strtotime",68],"(",["T_WHITESPACE"," ",68],["T_VARIABLE","$client_last_modified",68],["T_WHITESPACE"," ",68],")",["T_WHITESPACE"," ",68],":",["T_WHITESPACE"," ",68],["T_LNUMBER","0",68],";",["T_WHITESPACE","\n\n",68],["T_COMMENT","\/\/ Make a timestamp for our most recent modification...\n",70],["T_VARIABLE","$modified_timestamp",71],["T_WHITESPACE"," ",71],"=",["T_WHITESPACE"," ",71],["T_STRING","strtotime",71],"(",["T_VARIABLE","$last_modified",71],")",";",["T_WHITESPACE","\n\n",71],["T_IF","if",73],["T_WHITESPACE"," ",73],"(",["T_WHITESPACE"," ",73],"(",["T_WHITESPACE"," ",73],["T_VARIABLE","$client_last_modified",73],["T_WHITESPACE"," ",73],["T_BOOLEAN_AND","&&",73],["T_WHITESPACE"," ",73],["T_VARIABLE","$client_etag",73],["T_WHITESPACE"," ",73],")",["T_WHITESPACE","\n\t",73],"?",["T_WHITESPACE"," ",74],"(",["T_WHITESPACE"," ",74],"(",["T_WHITESPACE"," ",74],["T_VARIABLE","$client_modified_timestamp",74],["T_WHITESPACE"," ",74],["T_IS_GREATER_OR_EQUAL",">=",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$modified_timestamp",74],")",["T_WHITESPACE"," ",74],["T_BOOLEAN_AND","&&",74],["T_WHITESPACE"," ",74],"(",["T_WHITESPACE"," ",74],["T_VARIABLE","$client_etag",74],["T_WHITESPACE"," ",74],["T_IS_EQUAL","==",74],["T_WHITESPACE"," ",74],["T_VARIABLE","$etag",74],["T_WHITESPACE"," ",74],")",["T_WHITESPACE"," ",74],")",["T_WHITESPACE","\n\t",74],":",["T_WHITESPACE"," ",75],"(",["T_WHITESPACE"," ",75],"(",["T_WHITESPACE"," ",75],["T_VARIABLE","$client_modified_timestamp",75],["T_WHITESPACE"," ",75],["T_IS_GREATER_OR_EQUAL",">=",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$modified_timestamp",75],")",["T_WHITESPACE"," ",75],["T_BOOLEAN_OR","||",75],["T_WHITESPACE"," ",75],"(",["T_WHITESPACE"," ",75],["T_VARIABLE","$client_etag",75],["T_WHITESPACE"," ",75],["T_IS_EQUAL","==",75],["T_WHITESPACE"," ",75],["T_VARIABLE","$etag",75],["T_WHITESPACE"," ",75],")",["T_WHITESPACE"," ",75],")",["T_WHITESPACE","\n\t",75],")",["T_WHITESPACE"," ",76],"{",["T_WHITESPACE","\n\t",76],["T_STRING","status_header",77],"(",["T_WHITESPACE"," ",77],["T_LNUMBER","304",77],["T_WHITESPACE"," ",77],")",";",["T_WHITESPACE","\n\t",77],["T_EXIT","exit",78],";",["T_WHITESPACE","\n",78],"}",["T_WHITESPACE","\n\n",79],["T_COMMENT","\/\/ If we made it this far, just serve the file\n",81],["T_STRING","readfile",82],"(",["T_WHITESPACE"," ",82],["T_VARIABLE","$file",82],["T_WHITESPACE"," ",82],")",";",["T_WHITESPACE","\n",82],["T_STRING","flush",83],"(",")",";",["T_WHITESPACE","\n",83]]