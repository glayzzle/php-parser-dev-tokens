[["T_OPEN_TAG","<?php\n",1],["T_DOC_COMMENT","\/**\n * SSL utilities for Requests\n *\n * @package Requests\n * @subpackage Utilities\n *\/",2],["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * SSL utilities for Requests\n *\n * Collection of utilities for working with and verifying SSL certificates.\n *\n * @package Requests\n * @subpackage Utilities\n *\/",9],["T_WHITESPACE","\n",16],["T_CLASS","class",17],["T_WHITESPACE"," ",17],["T_STRING","Requests_SSL",17],["T_WHITESPACE"," ",17],"{",["T_WHITESPACE","\n\t",17],["T_DOC_COMMENT","\/**\n\t * Verify the certificate against common name and subject alternative names\n\t *\n\t * Unfortunately, PHP doesn't check the certificate against the alternative\n\t * names, leading things like 'https:\/\/www.github.com\/' to be invalid.\n\t * Instead\n\t *\n\t * @see https:\/\/tools.ietf.org\/html\/rfc2818#section-3.1 RFC2818, Section 3.1\n\t *\n\t * @throws Requests_Exception On not obtaining a match for the host (`fsockopen.ssl.no_match`)\n\t * @param string $host Host name to verify against\n\t * @param array $cert Certificate data from openssl_x509_parse()\n\t * @return bool\n\t *\/",18],["T_WHITESPACE","\n\t",31],["T_PUBLIC","public",32],["T_WHITESPACE"," ",32],["T_STATIC","static",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","verify_certificate",32],"(",["T_VARIABLE","$host",32],",",["T_WHITESPACE"," ",32],["T_VARIABLE","$cert",32],")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n\t\t",32],["T_COMMENT","\/\/ Calculate the valid wildcard match if the host is not an IP address\n",33],["T_WHITESPACE","\t\t",34],["T_VARIABLE","$parts",34],["T_WHITESPACE"," ",34],"=",["T_WHITESPACE"," ",34],["T_STRING","explode",34],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",34],",",["T_WHITESPACE"," ",34],["T_VARIABLE","$host",34],")",";",["T_WHITESPACE","\n\t\t",34],["T_IF","if",35],["T_WHITESPACE"," ",35],"(",["T_STRING","ip2long",35],"(",["T_VARIABLE","$host",35],")",["T_WHITESPACE"," ",35],["T_IS_IDENTICAL","===",35],["T_WHITESPACE"," ",35],["T_STRING","false",35],")",["T_WHITESPACE"," ",35],"{",["T_WHITESPACE","\n\t\t\t",35],["T_VARIABLE","$parts",36],"[",["T_LNUMBER","0",36],"]",["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_CONSTANT_ENCAPSED_STRING","'*'",36],";",["T_WHITESPACE","\n\t\t",36],"}",["T_WHITESPACE","\n\t\t",37],["T_VARIABLE","$wildcard",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_STRING","implode",38],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",38],",",["T_WHITESPACE"," ",38],["T_VARIABLE","$parts",38],")",";",["T_WHITESPACE","\n\n\t\t",38],["T_VARIABLE","$has_dns_alt",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_STRING","false",40],";",["T_WHITESPACE","\n\n\t\t",40],["T_COMMENT","\/\/ Check the subjectAltName\n",42],["T_WHITESPACE","\t\t",43],["T_IF","if",43],["T_WHITESPACE"," ",43],"(","!",["T_EMPTY","empty",43],"(",["T_VARIABLE","$cert",43],"[",["T_CONSTANT_ENCAPSED_STRING","'extensions'",43],"]",")",["T_WHITESPACE"," ",43],["T_BOOLEAN_AND","&&",43],["T_WHITESPACE"," ",43],"!",["T_EMPTY","empty",43],"(",["T_VARIABLE","$cert",43],"[",["T_CONSTANT_ENCAPSED_STRING","'extensions'",43],"]","[",["T_CONSTANT_ENCAPSED_STRING","'subjectAltName'",43],"]",")",")",["T_WHITESPACE"," ",43],"{",["T_WHITESPACE","\n\t\t\t",43],["T_VARIABLE","$altnames",44],["T_WHITESPACE"," ",44],"=",["T_WHITESPACE"," ",44],["T_STRING","explode",44],"(",["T_CONSTANT_ENCAPSED_STRING","','",44],",",["T_WHITESPACE"," ",44],["T_VARIABLE","$cert",44],"[",["T_CONSTANT_ENCAPSED_STRING","'extensions'",44],"]","[",["T_CONSTANT_ENCAPSED_STRING","'subjectAltName'",44],"]",")",";",["T_WHITESPACE","\n\t\t\t",44],["T_FOREACH","foreach",45],["T_WHITESPACE"," ",45],"(",["T_VARIABLE","$altnames",45],["T_WHITESPACE"," ",45],["T_AS","as",45],["T_WHITESPACE"," ",45],["T_VARIABLE","$altname",45],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n\t\t\t\t",45],["T_VARIABLE","$altname",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_STRING","trim",46],"(",["T_VARIABLE","$altname",46],")",";",["T_WHITESPACE","\n\t\t\t\t",46],["T_IF","if",47],["T_WHITESPACE"," ",47],"(",["T_STRING","strpos",47],"(",["T_VARIABLE","$altname",47],",",["T_WHITESPACE"," ",47],["T_CONSTANT_ENCAPSED_STRING","'DNS:'",47],")",["T_WHITESPACE"," ",47],["T_IS_NOT_IDENTICAL","!==",47],["T_WHITESPACE"," ",47],["T_LNUMBER","0",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n\t\t\t\t\t",47],["T_CONTINUE","continue",48],";",["T_WHITESPACE","\n\t\t\t\t",48],"}",["T_WHITESPACE","\n\n\t\t\t\t",49],["T_VARIABLE","$has_dns_alt",51],["T_WHITESPACE"," ",51],"=",["T_WHITESPACE"," ",51],["T_STRING","true",51],";",["T_WHITESPACE","\n\n\t\t\t\t",51],["T_COMMENT","\/\/ Strip the 'DNS:' prefix and trim whitespace\n",53],["T_WHITESPACE","\t\t\t\t",54],["T_VARIABLE","$altname",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","trim",54],"(",["T_STRING","substr",54],"(",["T_VARIABLE","$altname",54],",",["T_WHITESPACE"," ",54],["T_LNUMBER","4",54],")",")",";",["T_WHITESPACE","\n\n\t\t\t\t",54],["T_COMMENT","\/\/ Check for a match\n",56],["T_WHITESPACE","\t\t\t\t",57],["T_IF","if",57],["T_WHITESPACE"," ",57],"(",["T_STRING","self",57],["T_DOUBLE_COLON","::",57],["T_STRING","match_domain",57],"(",["T_VARIABLE","$host",57],",",["T_WHITESPACE"," ",57],["T_VARIABLE","$altname",57],")",["T_WHITESPACE"," ",57],["T_IS_IDENTICAL","===",57],["T_WHITESPACE"," ",57],["T_STRING","true",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n\t\t\t\t\t",57],["T_RETURN","return",58],["T_WHITESPACE"," ",58],["T_STRING","true",58],";",["T_WHITESPACE","\n\t\t\t\t",58],"}",["T_WHITESPACE","\n\t\t\t",59],"}",["T_WHITESPACE","\n\t\t",60],"}",["T_WHITESPACE","\n\n\t\t",61],["T_COMMENT","\/\/ Fall back to checking the common name if we didn't get any dNSName\n",63],["T_WHITESPACE","\t\t",64],["T_COMMENT","\/\/ alt names, as per RFC2818\n",64],["T_WHITESPACE","\t\t",65],["T_IF","if",65],["T_WHITESPACE"," ",65],"(","!",["T_VARIABLE","$has_dns_alt",65],["T_WHITESPACE"," ",65],["T_BOOLEAN_AND","&&",65],["T_WHITESPACE"," ",65],"!",["T_EMPTY","empty",65],"(",["T_VARIABLE","$cert",65],"[",["T_CONSTANT_ENCAPSED_STRING","'subject'",65],"]","[",["T_CONSTANT_ENCAPSED_STRING","'CN'",65],"]",")",")",["T_WHITESPACE"," ",65],"{",["T_WHITESPACE","\n\t\t\t",65],["T_COMMENT","\/\/ Check for a match\n",66],["T_WHITESPACE","\t\t\t",67],["T_IF","if",67],["T_WHITESPACE"," ",67],"(",["T_STRING","self",67],["T_DOUBLE_COLON","::",67],["T_STRING","match_domain",67],"(",["T_VARIABLE","$host",67],",",["T_WHITESPACE"," ",67],["T_VARIABLE","$cert",67],"[",["T_CONSTANT_ENCAPSED_STRING","'subject'",67],"]","[",["T_CONSTANT_ENCAPSED_STRING","'CN'",67],"]",")",["T_WHITESPACE"," ",67],["T_IS_IDENTICAL","===",67],["T_WHITESPACE"," ",67],["T_STRING","true",67],")",["T_WHITESPACE"," ",67],"{",["T_WHITESPACE","\n\t\t\t\t",67],["T_RETURN","return",68],["T_WHITESPACE"," ",68],["T_STRING","true",68],";",["T_WHITESPACE","\n\t\t\t",68],"}",["T_WHITESPACE","\n\t\t",69],"}",["T_WHITESPACE","\n\n\t\t",70],["T_RETURN","return",72],["T_WHITESPACE"," ",72],["T_STRING","false",72],";",["T_WHITESPACE","\n\t",72],"}",["T_WHITESPACE","\n\n\t",73],["T_DOC_COMMENT","\/**\n\t * Verify that a reference name is valid\n\t *\n\t * Verifies a dNSName for HTTPS usage, (almost) as per Firefox's rules:\n\t * - Wildcards can only occur in a name with more than 3 components\n\t * - Wildcards can only occur as the last character in the first\n\t *   component\n\t * - Wildcards may be preceded by additional characters\n\t *\n\t * We modify these rules to be a bit stricter and only allow the wildcard\n\t * character to be the full first component; that is, with the exclusion of\n\t * the third rule.\n\t *\n\t * @param string $reference Reference dNSName\n\t * @return boolean Is the name valid?\n\t *\/",75],["T_WHITESPACE","\n\t",90],["T_PUBLIC","public",91],["T_WHITESPACE"," ",91],["T_STATIC","static",91],["T_WHITESPACE"," ",91],["T_FUNCTION","function",91],["T_WHITESPACE"," ",91],["T_STRING","verify_reference_name",91],"(",["T_VARIABLE","$reference",91],")",["T_WHITESPACE"," ",91],"{",["T_WHITESPACE","\n\t\t",91],["T_VARIABLE","$parts",92],["T_WHITESPACE"," ",92],"=",["T_WHITESPACE"," ",92],["T_STRING","explode",92],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",92],",",["T_WHITESPACE"," ",92],["T_VARIABLE","$reference",92],")",";",["T_WHITESPACE","\n\n\t\t",92],["T_COMMENT","\/\/ Check the first part of the name\n",94],["T_WHITESPACE","\t\t",95],["T_VARIABLE","$first",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_STRING","array_shift",95],"(",["T_VARIABLE","$parts",95],")",";",["T_WHITESPACE","\n\n\t\t",95],["T_IF","if",97],["T_WHITESPACE"," ",97],"(",["T_STRING","strpos",97],"(",["T_VARIABLE","$first",97],",",["T_WHITESPACE"," ",97],["T_CONSTANT_ENCAPSED_STRING","'*'",97],")",["T_WHITESPACE"," ",97],["T_IS_NOT_IDENTICAL","!==",97],["T_WHITESPACE"," ",97],["T_STRING","false",97],")",["T_WHITESPACE"," ",97],"{",["T_WHITESPACE","\n\t\t\t",97],["T_COMMENT","\/\/ Check that the wildcard is the full part\n",98],["T_WHITESPACE","\t\t\t",99],["T_IF","if",99],["T_WHITESPACE"," ",99],"(",["T_VARIABLE","$first",99],["T_WHITESPACE"," ",99],["T_IS_NOT_IDENTICAL","!==",99],["T_WHITESPACE"," ",99],["T_CONSTANT_ENCAPSED_STRING","'*'",99],")",["T_WHITESPACE"," ",99],"{",["T_WHITESPACE","\n\t\t\t\t",99],["T_RETURN","return",100],["T_WHITESPACE"," ",100],["T_STRING","false",100],";",["T_WHITESPACE","\n\t\t\t",100],"}",["T_WHITESPACE","\n\n\t\t\t",101],["T_COMMENT","\/\/ Check that we have at least 3 components (including first)\n",103],["T_WHITESPACE","\t\t\t",104],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_STRING","count",104],"(",["T_VARIABLE","$parts",104],")",["T_WHITESPACE"," ",104],"<",["T_WHITESPACE"," ",104],["T_LNUMBER","2",104],")",["T_WHITESPACE"," ",104],"{",["T_WHITESPACE","\n\t\t\t\t",104],["T_RETURN","return",105],["T_WHITESPACE"," ",105],["T_STRING","false",105],";",["T_WHITESPACE","\n\t\t\t",105],"}",["T_WHITESPACE","\n\t\t",106],"}",["T_WHITESPACE","\n\n\t\t",107],["T_COMMENT","\/\/ Check the remaining parts\n",109],["T_WHITESPACE","\t\t",110],["T_FOREACH","foreach",110],["T_WHITESPACE"," ",110],"(",["T_VARIABLE","$parts",110],["T_WHITESPACE"," ",110],["T_AS","as",110],["T_WHITESPACE"," ",110],["T_VARIABLE","$part",110],")",["T_WHITESPACE"," ",110],"{",["T_WHITESPACE","\n\t\t\t",110],["T_IF","if",111],["T_WHITESPACE"," ",111],"(",["T_STRING","strpos",111],"(",["T_VARIABLE","$part",111],",",["T_WHITESPACE"," ",111],["T_CONSTANT_ENCAPSED_STRING","'*'",111],")",["T_WHITESPACE"," ",111],["T_IS_NOT_IDENTICAL","!==",111],["T_WHITESPACE"," ",111],["T_STRING","false",111],")",["T_WHITESPACE"," ",111],"{",["T_WHITESPACE","\n\t\t\t\t",111],["T_RETURN","return",112],["T_WHITESPACE"," ",112],["T_STRING","false",112],";",["T_WHITESPACE","\n\t\t\t",112],"}",["T_WHITESPACE","\n\t\t",113],"}",["T_WHITESPACE","\n\n\t\t",114],["T_COMMENT","\/\/ Nothing found, verified!\n",116],["T_WHITESPACE","\t\t",117],["T_RETURN","return",117],["T_WHITESPACE"," ",117],["T_STRING","true",117],";",["T_WHITESPACE","\n\t",117],"}",["T_WHITESPACE","\n\n\t",118],["T_DOC_COMMENT","\/**\n\t * Match a hostname against a dNSName reference\n\t *\n\t * @param string $host Requested host\n\t * @param string $reference dNSName to match against\n\t * @return boolean Does the domain match?\n\t *\/",120],["T_WHITESPACE","\n\t",126],["T_PUBLIC","public",127],["T_WHITESPACE"," ",127],["T_STATIC","static",127],["T_WHITESPACE"," ",127],["T_FUNCTION","function",127],["T_WHITESPACE"," ",127],["T_STRING","match_domain",127],"(",["T_VARIABLE","$host",127],",",["T_WHITESPACE"," ",127],["T_VARIABLE","$reference",127],")",["T_WHITESPACE"," ",127],"{",["T_WHITESPACE","\n\t\t",127],["T_COMMENT","\/\/ Check if the reference is blacklisted first\n",128],["T_WHITESPACE","\t\t",129],["T_IF","if",129],["T_WHITESPACE"," ",129],"(",["T_STRING","self",129],["T_DOUBLE_COLON","::",129],["T_STRING","verify_reference_name",129],"(",["T_VARIABLE","$reference",129],")",["T_WHITESPACE"," ",129],["T_IS_NOT_IDENTICAL","!==",129],["T_WHITESPACE"," ",129],["T_STRING","true",129],")",["T_WHITESPACE"," ",129],"{",["T_WHITESPACE","\n\t\t\t",129],["T_RETURN","return",130],["T_WHITESPACE"," ",130],["T_STRING","false",130],";",["T_WHITESPACE","\n\t\t",130],"}",["T_WHITESPACE","\n\n\t\t",131],["T_COMMENT","\/\/ Check for a direct match\n",133],["T_WHITESPACE","\t\t",134],["T_IF","if",134],["T_WHITESPACE"," ",134],"(",["T_VARIABLE","$host",134],["T_WHITESPACE"," ",134],["T_IS_IDENTICAL","===",134],["T_WHITESPACE"," ",134],["T_VARIABLE","$reference",134],")",["T_WHITESPACE"," ",134],"{",["T_WHITESPACE","\n\t\t\t",134],["T_RETURN","return",135],["T_WHITESPACE"," ",135],["T_STRING","true",135],";",["T_WHITESPACE","\n\t\t",135],"}",["T_WHITESPACE","\n\n\t\t",136],["T_COMMENT","\/\/ Calculate the valid wildcard match if the host is not an IP address\n",138],["T_WHITESPACE","\t\t",139],["T_COMMENT","\/\/ Also validates that the host has 3 parts or more, as per Firefox's\n",139],["T_WHITESPACE","\t\t",140],["T_COMMENT","\/\/ ruleset.\n",140],["T_WHITESPACE","\t\t",141],["T_IF","if",141],["T_WHITESPACE"," ",141],"(",["T_STRING","ip2long",141],"(",["T_VARIABLE","$host",141],")",["T_WHITESPACE"," ",141],["T_IS_IDENTICAL","===",141],["T_WHITESPACE"," ",141],["T_STRING","false",141],")",["T_WHITESPACE"," ",141],"{",["T_WHITESPACE","\n\t\t\t",141],["T_VARIABLE","$parts",142],["T_WHITESPACE"," ",142],"=",["T_WHITESPACE"," ",142],["T_STRING","explode",142],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",142],",",["T_WHITESPACE"," ",142],["T_VARIABLE","$host",142],")",";",["T_WHITESPACE","\n\t\t\t",142],["T_VARIABLE","$parts",143],"[",["T_LNUMBER","0",143],"]",["T_WHITESPACE"," ",143],"=",["T_WHITESPACE"," ",143],["T_CONSTANT_ENCAPSED_STRING","'*'",143],";",["T_WHITESPACE","\n\t\t\t",143],["T_VARIABLE","$wildcard",144],["T_WHITESPACE"," ",144],"=",["T_WHITESPACE"," ",144],["T_STRING","implode",144],"(",["T_CONSTANT_ENCAPSED_STRING","'.'",144],",",["T_WHITESPACE"," ",144],["T_VARIABLE","$parts",144],")",";",["T_WHITESPACE","\n\t\t\t",144],["T_IF","if",145],["T_WHITESPACE"," ",145],"(",["T_VARIABLE","$wildcard",145],["T_WHITESPACE"," ",145],["T_IS_IDENTICAL","===",145],["T_WHITESPACE"," ",145],["T_VARIABLE","$reference",145],")",["T_WHITESPACE"," ",145],"{",["T_WHITESPACE","\n\t\t\t\t",145],["T_RETURN","return",146],["T_WHITESPACE"," ",146],["T_STRING","true",146],";",["T_WHITESPACE","\n\t\t\t",146],"}",["T_WHITESPACE","\n\t\t",147],"}",["T_WHITESPACE","\n\n\t\t",148],["T_RETURN","return",150],["T_WHITESPACE"," ",150],["T_STRING","false",150],";",["T_WHITESPACE","\n\t",150],"}",["T_WHITESPACE","\n",151],"}"]