[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Thrift",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Server",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Thrift",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Server",5],["T_NS_SEPARATOR","\\",5],["T_STRING","TServer",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Thrift",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Transport",6],["T_NS_SEPARATOR","\\",6],["T_STRING","TTransport",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Thrift",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Exception",7],["T_NS_SEPARATOR","\\",7],["T_STRING","TException",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Thrift",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Exception",8],["T_NS_SEPARATOR","\\",8],["T_STRING","TTransportException",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * A forking implementation of a Thrift server.\n *\n * @package thrift.server\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","TForkingServer",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","TServer",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n  ",15],["T_DOC_COMMENT","\/**\n   * Flag for the main serving loop\n   *\n   * @var bool\n   *\/",16],["T_WHITESPACE","\n  ",20],["T_PRIVATE","private",21],["T_WHITESPACE"," ",21],["T_VARIABLE","$stop_",21],["T_WHITESPACE"," ",21],"=",["T_WHITESPACE"," ",21],["T_STRING","false",21],";",["T_WHITESPACE","\n\n  ",21],["T_DOC_COMMENT","\/**\n   * List of children.\n   *\n   * @var array\n   *\/",23],["T_WHITESPACE","\n  ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_VARIABLE","$children_",28],["T_WHITESPACE"," ",28],"=",["T_WHITESPACE"," ",28],["T_ARRAY","array",28],"(",")",";",["T_WHITESPACE","\n\n  ",28],["T_DOC_COMMENT","\/**\n   * Listens for new client using the supplied\n   * transport. We fork when a new connection\n   * arrives.\n   *\n   * @return void\n   *\/",30],["T_WHITESPACE","\n  ",36],["T_PUBLIC","public",37],["T_WHITESPACE"," ",37],["T_FUNCTION","function",37],["T_WHITESPACE"," ",37],["T_STRING","serve",37],"(",")",["T_WHITESPACE"," ",37],"{",["T_WHITESPACE","\n    ",37],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","transport_",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","listen",38],"(",")",";",["T_WHITESPACE","\n\n    ",38],["T_WHILE","while",40],["T_WHITESPACE"," ",40],"(","!",["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","stop_",40],")",["T_WHITESPACE"," ",40],"{",["T_WHITESPACE","\n      ",40],["T_TRY","try",41],["T_WHITESPACE"," ",41],"{",["T_WHITESPACE","\n        ",41],["T_VARIABLE","$transport",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","transport_",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","accept",42],"(",")",";",["T_WHITESPACE","\n\n        ",42],["T_IF","if",44],["T_WHITESPACE"," ",44],"(",["T_VARIABLE","$transport",44],["T_WHITESPACE"," ",44],["T_IS_NOT_EQUAL","!=",44],["T_WHITESPACE"," ",44],["T_STRING","null",44],")",["T_WHITESPACE"," ",44],"{",["T_WHITESPACE","\n          ",44],["T_VARIABLE","$pid",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_STRING","pcntl_fork",45],"(",")",";",["T_WHITESPACE","\n\n          ",45],["T_IF","if",47],["T_WHITESPACE"," ",47],"(",["T_VARIABLE","$pid",47],["T_WHITESPACE"," ",47],">",["T_WHITESPACE"," ",47],["T_LNUMBER","0",47],")",["T_WHITESPACE"," ",47],"{",["T_WHITESPACE","\n            ",47],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","handleParent",48],"(",["T_VARIABLE","$transport",48],",",["T_WHITESPACE"," ",48],["T_VARIABLE","$pid",48],")",";",["T_WHITESPACE","\n          ",48],"}",["T_WHITESPACE","\n          ",49],["T_ELSE","else",50],["T_WHITESPACE"," ",50],["T_IF","if",50],["T_WHITESPACE"," ",50],"(",["T_VARIABLE","$pid",50],["T_WHITESPACE"," ",50],["T_IS_IDENTICAL","===",50],["T_WHITESPACE"," ",50],["T_LNUMBER","0",50],")",["T_WHITESPACE"," ",50],"{",["T_WHITESPACE","\n            ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","handleChild",51],"(",["T_VARIABLE","$transport",51],")",";",["T_WHITESPACE","\n          ",51],"}",["T_WHITESPACE","\n          ",52],["T_ELSE","else",53],["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n            ",53],["T_THROW","throw",54],["T_WHITESPACE"," ",54],["T_NEW","new",54],["T_WHITESPACE"," ",54],["T_STRING","TException",54],"(",["T_CONSTANT_ENCAPSED_STRING","'Failed to fork'",54],")",";",["T_WHITESPACE","\n          ",54],"}",["T_WHITESPACE","\n        ",55],"}",["T_WHITESPACE","\n      ",56],"}",["T_WHITESPACE","\n      ",57],["T_CATCH","catch",58],["T_WHITESPACE"," ",58],"(",["T_STRING","TTransportException",58],["T_WHITESPACE"," ",58],["T_VARIABLE","$e",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE"," ",58],"}",["T_WHITESPACE","\n\n      ",58],["T_VARIABLE","$this",60],["T_OBJECT_OPERATOR","->",60],["T_STRING","collectChildren",60],"(",")",";",["T_WHITESPACE","\n    ",60],"}",["T_WHITESPACE","\n  ",61],"}",["T_WHITESPACE","\n\n  ",62],["T_DOC_COMMENT","\/**\n   * Code run by the parent\n   *\n   * @param TTransport $transport\n   * @param int $pid\n   * @return void\n   *\/",64],["T_WHITESPACE","\n  ",70],["T_PRIVATE","private",71],["T_WHITESPACE"," ",71],["T_FUNCTION","function",71],["T_WHITESPACE"," ",71],["T_STRING","handleParent",71],"(",["T_STRING","TTransport",71],["T_WHITESPACE"," ",71],["T_VARIABLE","$transport",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$pid",71],")",["T_WHITESPACE"," ",71],"{",["T_WHITESPACE","\n    ",71],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","children_",72],"[",["T_VARIABLE","$pid",72],"]",["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$transport",72],";",["T_WHITESPACE","\n  ",72],"}",["T_WHITESPACE","\n\n  ",73],["T_DOC_COMMENT","\/**\n   * Code run by the child.\n   *\n   * @param TTransport $transport\n   * @return void\n   *\/",75],["T_WHITESPACE","\n  ",80],["T_PRIVATE","private",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","handleChild",81],"(",["T_STRING","TTransport",81],["T_WHITESPACE"," ",81],["T_VARIABLE","$transport",81],")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n    ",81],["T_TRY","try",82],["T_WHITESPACE"," ",82],"{",["T_WHITESPACE","\n      ",82],["T_VARIABLE","$inputTransport",83],["T_WHITESPACE"," ",83],"=",["T_WHITESPACE"," ",83],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","inputTransportFactory_",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","getTransport",83],"(",["T_VARIABLE","$transport",83],")",";",["T_WHITESPACE","\n      ",83],["T_VARIABLE","$outputTransport",84],["T_WHITESPACE"," ",84],"=",["T_WHITESPACE"," ",84],["T_VARIABLE","$this",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","outputTransportFactory_",84],["T_OBJECT_OPERATOR","->",84],["T_STRING","getTransport",84],"(",["T_VARIABLE","$transport",84],")",";",["T_WHITESPACE","\n      ",84],["T_VARIABLE","$inputProtocol",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","inputProtocolFactory_",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","getProtocol",85],"(",["T_VARIABLE","$inputTransport",85],")",";",["T_WHITESPACE","\n      ",85],["T_VARIABLE","$outputProtocol",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","outputProtocolFactory_",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getProtocol",86],"(",["T_VARIABLE","$outputTransport",86],")",";",["T_WHITESPACE","\n      ",86],["T_WHILE","while",87],["T_WHITESPACE"," ",87],"(",["T_VARIABLE","$this",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","processor_",87],["T_OBJECT_OPERATOR","->",87],["T_STRING","process",87],"(",["T_VARIABLE","$inputProtocol",87],",",["T_WHITESPACE"," ",87],["T_VARIABLE","$outputProtocol",87],")",")",["T_WHITESPACE"," ",87],"{",["T_WHITESPACE"," ",87],"}",["T_WHITESPACE","\n      ",87],"@",["T_VARIABLE","$transport",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","close",88],"(",")",";",["T_WHITESPACE","\n    ",88],"}",["T_WHITESPACE","\n    ",89],["T_CATCH","catch",90],["T_WHITESPACE"," ",90],"(",["T_STRING","TTransportException",90],["T_WHITESPACE"," ",90],["T_VARIABLE","$e",90],")",["T_WHITESPACE"," ",90],"{",["T_WHITESPACE"," ",90],"}",["T_WHITESPACE","\n\n    ",90],["T_EXIT","exit",92],"(",["T_LNUMBER","0",92],")",";",["T_WHITESPACE","\n  ",92],"}",["T_WHITESPACE","\n\n  ",93],["T_DOC_COMMENT","\/**\n   * Collects any children we may have\n   *\n   * @return void\n   *\/",95],["T_WHITESPACE","\n  ",99],["T_PRIVATE","private",100],["T_WHITESPACE"," ",100],["T_FUNCTION","function",100],["T_WHITESPACE"," ",100],["T_STRING","collectChildren",100],"(",")",["T_WHITESPACE"," ",100],"{",["T_WHITESPACE","\n    ",100],["T_FOREACH","foreach",101],["T_WHITESPACE"," ",101],"(",["T_VARIABLE","$this",101],["T_OBJECT_OPERATOR","->",101],["T_STRING","children_",101],["T_WHITESPACE"," ",101],["T_AS","as",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$pid",101],["T_WHITESPACE"," ",101],["T_DOUBLE_ARROW","=>",101],["T_WHITESPACE"," ",101],["T_VARIABLE","$transport",101],")",["T_WHITESPACE"," ",101],"{",["T_WHITESPACE","\n      ",101],["T_IF","if",102],["T_WHITESPACE"," ",102],"(",["T_STRING","pcntl_waitpid",102],"(",["T_VARIABLE","$pid",102],",",["T_WHITESPACE"," ",102],["T_VARIABLE","$status",102],",",["T_WHITESPACE"," ",102],["T_STRING","WNOHANG",102],")",["T_WHITESPACE"," ",102],">",["T_WHITESPACE"," ",102],["T_LNUMBER","0",102],")",["T_WHITESPACE"," ",102],"{",["T_WHITESPACE","\n        ",102],["T_UNSET","unset",103],"(",["T_VARIABLE","$this",103],["T_OBJECT_OPERATOR","->",103],["T_STRING","children_",103],"[",["T_VARIABLE","$pid",103],"]",")",";",["T_WHITESPACE","\n        ",103],["T_IF","if",104],["T_WHITESPACE"," ",104],"(",["T_VARIABLE","$transport",104],")",["T_WHITESPACE"," ",104],"@",["T_VARIABLE","$transport",104],["T_OBJECT_OPERATOR","->",104],["T_STRING","close",104],"(",")",";",["T_WHITESPACE","\n      ",104],"}",["T_WHITESPACE","\n    ",105],"}",["T_WHITESPACE","\n  ",106],"}",["T_WHITESPACE","\n\n  ",107],["T_DOC_COMMENT","\/**\n   * Stops the server running. Kills the transport\n   * and then stops the main serving loop\n   *\n   * @return void\n   *\/",109],["T_WHITESPACE","\n  ",114],["T_PUBLIC","public",115],["T_WHITESPACE"," ",115],["T_FUNCTION","function",115],["T_WHITESPACE"," ",115],["T_STRING","stop",115],"(",")",["T_WHITESPACE"," ",115],"{",["T_WHITESPACE","\n    ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","transport_",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","close",116],"(",")",";",["T_WHITESPACE","\n    ",116],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","stop_",117],["T_WHITESPACE"," ",117],"=",["T_WHITESPACE"," ",117],["T_STRING","true",117],";",["T_WHITESPACE","\n  ",117],"}",["T_WHITESPACE","\n",118],"}",["T_WHITESPACE","\n",119]]