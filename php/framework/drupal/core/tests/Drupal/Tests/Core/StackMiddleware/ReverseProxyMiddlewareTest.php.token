[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Tests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","StackMiddleware",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Site",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Settings",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","StackMiddleware",6],["T_NS_SEPARATOR","\\",6],["T_STRING","ReverseProxyMiddleware",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Tests",7],["T_NS_SEPARATOR","\\",7],["T_STRING","UnitTestCase",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Symfony",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Component",8],["T_NS_SEPARATOR","\\",8],["T_STRING","HttpFoundation",8],["T_NS_SEPARATOR","\\",8],["T_STRING","Request",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Unit test the reverse proxy stack middleware.\n *\n * @group StackMiddleware\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","ReverseProxyMiddlewareTest",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","UnitTestCase",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * @var \\Symfony\\Component\\HttpKernel\\HttpKernelInterface|\\PHPUnit_Framework_MockObject_MockObject\n   *\/",17],["T_WHITESPACE","\n  ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$mockHttpKernel",20],";",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",22],["T_WHITESPACE","\n  ",24],["T_PROTECTED","protected",25],["T_WHITESPACE"," ",25],["T_FUNCTION","function",25],["T_WHITESPACE"," ",25],["T_STRING","setUp",25],"(",")",["T_WHITESPACE"," ",25],"{",["T_WHITESPACE","\n    ",25],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","mockHttpKernel",26],["T_WHITESPACE"," ",26],"=",["T_WHITESPACE"," ",26],["T_VARIABLE","$this",26],["T_OBJECT_OPERATOR","->",26],["T_STRING","getMock",26],"(",["T_CONSTANT_ENCAPSED_STRING","'Symfony\\Component\\HttpKernel\\HttpKernelInterface'",26],")",";",["T_WHITESPACE","\n  ",26],"}",["T_WHITESPACE","\n\n  ",27],["T_DOC_COMMENT","\/**\n   * Tests that subscriber does not act when reverse proxy is not set.\n   *\/",29],["T_WHITESPACE","\n  ",31],["T_PUBLIC","public",32],["T_WHITESPACE"," ",32],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","testNoProxy",32],"(",")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n    ",32],["T_VARIABLE","$settings",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_NEW","new",33],["T_WHITESPACE"," ",33],["T_STRING","Settings",33],"(",["T_ARRAY","array",33],"(",")",")",";",["T_WHITESPACE","\n    ",33],["T_VARIABLE","$this",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","assertEquals",34],"(",["T_LNUMBER","0",34],",",["T_WHITESPACE"," ",34],["T_VARIABLE","$settings",34],["T_OBJECT_OPERATOR","->",34],["T_STRING","get",34],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy'",34],")",")",";",["T_WHITESPACE","\n\n    ",34],["T_VARIABLE","$middleware",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_NEW","new",36],["T_WHITESPACE"," ",36],["T_STRING","ReverseProxyMiddleware",36],"(",["T_VARIABLE","$this",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","mockHttpKernel",36],",",["T_WHITESPACE"," ",36],["T_VARIABLE","$settings",36],")",";",["T_WHITESPACE","\n    ",36],["T_COMMENT","\/\/ Mock a request object.\n",37],["T_WHITESPACE","    ",38],["T_VARIABLE","$request",38],["T_WHITESPACE"," ",38],"=",["T_WHITESPACE"," ",38],["T_VARIABLE","$this",38],["T_OBJECT_OPERATOR","->",38],["T_STRING","getMock",38],"(",["T_CONSTANT_ENCAPSED_STRING","'Symfony\\Component\\HttpFoundation\\Request'",38],",",["T_WHITESPACE"," ",38],["T_ARRAY","array",38],"(",["T_CONSTANT_ENCAPSED_STRING","'setTrustedHeaderName'",38],",",["T_WHITESPACE"," ",38],["T_CONSTANT_ENCAPSED_STRING","'setTrustedProxies'",38],")",")",";",["T_WHITESPACE","\n    ",38],["T_COMMENT","\/\/ setTrustedHeaderName() should never fire.\n",39],["T_WHITESPACE","    ",40],["T_VARIABLE","$request",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","expects",40],"(",["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","never",40],"(",")",")",["T_WHITESPACE","\n      ",40],["T_OBJECT_OPERATOR","->",41],["T_STRING","method",41],"(",["T_CONSTANT_ENCAPSED_STRING","'setTrustedHeaderName'",41],")",";",["T_WHITESPACE","\n    ",41],["T_COMMENT","\/\/ Actually call the check method.\n",42],["T_WHITESPACE","    ",43],["T_VARIABLE","$middleware",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","handle",43],"(",["T_VARIABLE","$request",43],")",";",["T_WHITESPACE","\n  ",43],"}",["T_WHITESPACE","\n\n  ",44],["T_DOC_COMMENT","\/**\n   * Tests that subscriber sets trusted headers when reverse proxy is set.\n   *\n   * @dataProvider reverseProxyEnabledProvider\n   *\/",46],["T_WHITESPACE","\n  ",50],["T_PUBLIC","public",51],["T_WHITESPACE"," ",51],["T_FUNCTION","function",51],["T_WHITESPACE"," ",51],["T_STRING","testReverseProxyEnabled",51],"(",["T_VARIABLE","$provided_settings",51],")",["T_WHITESPACE"," ",51],"{",["T_WHITESPACE","\n    ",51],["T_COMMENT","\/\/ Enable reverse proxy and add test values.\n",52],["T_WHITESPACE","    ",53],["T_VARIABLE","$settings",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_NEW","new",53],["T_WHITESPACE"," ",53],["T_STRING","Settings",53],"(",["T_ARRAY","array",53],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy'",53],["T_WHITESPACE"," ",53],["T_DOUBLE_ARROW","=>",53],["T_WHITESPACE"," ",53],["T_LNUMBER","1",53],")",["T_WHITESPACE"," ",53],"+",["T_WHITESPACE"," ",53],["T_VARIABLE","$provided_settings",53],")",";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","trustedHeadersAreSet",54],"(",["T_VARIABLE","$settings",54],")",";",["T_WHITESPACE","\n  ",54],"}",["T_WHITESPACE","\n\n  ",55],["T_DOC_COMMENT","\/**\n   * Data provider for testReverseProxyEnabled.\n   *\/",57],["T_WHITESPACE","\n  ",59],["T_PUBLIC","public",60],["T_WHITESPACE"," ",60],["T_FUNCTION","function",60],["T_WHITESPACE"," ",60],["T_STRING","reverseProxyEnabledProvider",60],"(",")",["T_WHITESPACE"," ",60],"{",["T_WHITESPACE","\n    ",60],["T_RETURN","return",61],["T_WHITESPACE"," ",61],["T_ARRAY","array",61],"(",["T_WHITESPACE","\n      ",61],["T_ARRAY","array",62],"(",["T_WHITESPACE","\n        ",62],["T_ARRAY","array",63],"(",["T_WHITESPACE","\n          ",63],["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_header'",64],["T_WHITESPACE"," ",64],["T_DOUBLE_ARROW","=>",64],["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'X_FORWARDED_FOR_CUSTOMIZED'",64],",",["T_WHITESPACE","\n          ",64],["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_proto_header'",65],["T_WHITESPACE"," ",65],["T_DOUBLE_ARROW","=>",65],["T_WHITESPACE"," ",65],["T_CONSTANT_ENCAPSED_STRING","'X_FORWARDED_PROTO_CUSTOMIZED'",65],",",["T_WHITESPACE","\n          ",65],["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_host_header'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'X_FORWARDED_HOST_CUSTOMIZED'",66],",",["T_WHITESPACE","\n          ",66],["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_port_header'",67],["T_WHITESPACE"," ",67],["T_DOUBLE_ARROW","=>",67],["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'X_FORWARDED_PORT_CUSTOMIZED'",67],",",["T_WHITESPACE","\n          ",67],["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_forwarded_header'",68],["T_WHITESPACE"," ",68],["T_DOUBLE_ARROW","=>",68],["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'FORWARDED_CUSTOMIZED'",68],",",["T_WHITESPACE","\n          ",68],["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_addresses'",69],["T_WHITESPACE"," ",69],["T_DOUBLE_ARROW","=>",69],["T_WHITESPACE"," ",69],["T_ARRAY","array",69],"(",["T_CONSTANT_ENCAPSED_STRING","'127.0.0.2'",69],",",["T_WHITESPACE"," ",69],["T_CONSTANT_ENCAPSED_STRING","'127.0.0.3'",69],")",",",["T_WHITESPACE","\n        ",69],")",",",["T_WHITESPACE","\n      ",70],")",",",["T_WHITESPACE","\n    ",71],")",";",["T_WHITESPACE","\n  ",72],"}",["T_WHITESPACE","\n\n  ",73],["T_DOC_COMMENT","\/**\n   * Tests that trusted header methods are called.\n   *\n   * \\Symfony\\Component\\HttpFoundation\\Request::setTrustedHeaderName() and\n   * \\Symfony\\Component\\HttpFoundation\\Request::setTrustedProxies() should\n   * always be called when reverse proxy settings are enabled.\n   *\n   * @param \\Drupal\\Core\\Site\\Settings $settings\n   *   The settings object that holds reverse proxy configuration.\n   *\/",75],["T_WHITESPACE","\n  ",84],["T_PROTECTED","protected",85],["T_WHITESPACE"," ",85],["T_FUNCTION","function",85],["T_WHITESPACE"," ",85],["T_STRING","trustedHeadersAreSet",85],"(",["T_STRING","Settings",85],["T_WHITESPACE"," ",85],["T_VARIABLE","$settings",85],")",["T_WHITESPACE"," ",85],"{",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$middleware",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_NEW","new",86],["T_WHITESPACE"," ",86],["T_STRING","ReverseProxyMiddleware",86],"(",["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","mockHttpKernel",86],",",["T_WHITESPACE"," ",86],["T_VARIABLE","$settings",86],")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$request",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_NEW","new",87],["T_WHITESPACE"," ",87],["T_STRING","Request",87],"(",")",";",["T_WHITESPACE","\n\n    ",87],["T_VARIABLE","$middleware",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","handle",89],"(",["T_VARIABLE","$request",89],")",";",["T_WHITESPACE","\n    ",89],["T_VARIABLE","$this",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","assertSame",90],"(",["T_VARIABLE","$settings",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","get",90],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_header'",90],")",",",["T_WHITESPACE"," ",90],["T_VARIABLE","$request",90],["T_OBJECT_OPERATOR","->",90],["T_STRING","getTrustedHeaderName",90],"(",["T_VARIABLE","$request",90],["T_DOUBLE_COLON","::",90],["T_STRING","HEADER_CLIENT_IP",90],")",")",";",["T_WHITESPACE","\n    ",90],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","assertSame",91],"(",["T_VARIABLE","$settings",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","get",91],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_proto_header'",91],")",",",["T_WHITESPACE"," ",91],["T_VARIABLE","$request",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","getTrustedHeaderName",91],"(",["T_VARIABLE","$request",91],["T_DOUBLE_COLON","::",91],["T_STRING","HEADER_CLIENT_PROTO",91],")",")",";",["T_WHITESPACE","\n    ",91],["T_VARIABLE","$this",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","assertSame",92],"(",["T_VARIABLE","$settings",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","get",92],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_host_header'",92],")",",",["T_WHITESPACE"," ",92],["T_VARIABLE","$request",92],["T_OBJECT_OPERATOR","->",92],["T_STRING","getTrustedHeaderName",92],"(",["T_VARIABLE","$request",92],["T_DOUBLE_COLON","::",92],["T_STRING","HEADER_CLIENT_HOST",92],")",")",";",["T_WHITESPACE","\n    ",92],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","assertSame",93],"(",["T_VARIABLE","$settings",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","get",93],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_port_header'",93],")",",",["T_WHITESPACE"," ",93],["T_VARIABLE","$request",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","getTrustedHeaderName",93],"(",["T_VARIABLE","$request",93],["T_DOUBLE_COLON","::",93],["T_STRING","HEADER_CLIENT_PORT",93],")",")",";",["T_WHITESPACE","\n    ",93],["T_VARIABLE","$this",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","assertSame",94],"(",["T_VARIABLE","$settings",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","get",94],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_forwarded_header'",94],")",",",["T_WHITESPACE"," ",94],["T_VARIABLE","$request",94],["T_OBJECT_OPERATOR","->",94],["T_STRING","getTrustedHeaderName",94],"(",["T_VARIABLE","$request",94],["T_DOUBLE_COLON","::",94],["T_STRING","HEADER_FORWARDED",94],")",")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$this",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","assertSame",95],"(",["T_VARIABLE","$settings",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","get",95],"(",["T_CONSTANT_ENCAPSED_STRING","'reverse_proxy_addresses'",95],")",",",["T_WHITESPACE"," ",95],["T_VARIABLE","$request",95],["T_OBJECT_OPERATOR","->",95],["T_STRING","getTrustedProxies",95],"(",")",")",";",["T_WHITESPACE","\n  ",95],"}",["T_WHITESPACE","\n\n",96],"}",["T_WHITESPACE","\n",98]]