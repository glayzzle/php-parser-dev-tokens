[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Session",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Session",5],["T_NS_SEPARATOR","\\",5],["T_STRING","UserSession",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","KernelTests",6],["T_NS_SEPARATOR","\\",6],["T_STRING","KernelTestBase",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Test case for account switching.\n *\n * @group Session\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","AccountSwitcherTest",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","KernelTestBase",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_PUBLIC","public",15],["T_WHITESPACE"," ",15],["T_FUNCTION","function",15],["T_WHITESPACE"," ",15],["T_STRING","testAccountSwitching",15],"(",")",["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n    ",15],["T_VARIABLE","$session_handler",16],["T_WHITESPACE"," ",16],"=",["T_WHITESPACE"," ",16],["T_VARIABLE","$this",16],["T_OBJECT_OPERATOR","->",16],["T_STRING","container",16],["T_OBJECT_OPERATOR","->",16],["T_STRING","get",16],"(",["T_CONSTANT_ENCAPSED_STRING","'session_handler.write_safe'",16],")",";",["T_WHITESPACE","\n    ",16],["T_VARIABLE","$user",17],["T_WHITESPACE"," ",17],"=",["T_WHITESPACE"," ",17],["T_VARIABLE","$this",17],["T_OBJECT_OPERATOR","->",17],["T_STRING","container",17],["T_OBJECT_OPERATOR","->",17],["T_STRING","get",17],"(",["T_CONSTANT_ENCAPSED_STRING","'current_user'",17],")",";",["T_WHITESPACE","\n    ",17],["T_VARIABLE","$switcher",18],["T_WHITESPACE"," ",18],"=",["T_WHITESPACE"," ",18],["T_VARIABLE","$this",18],["T_OBJECT_OPERATOR","->",18],["T_STRING","container",18],["T_OBJECT_OPERATOR","->",18],["T_STRING","get",18],"(",["T_CONSTANT_ENCAPSED_STRING","'account_switcher'",18],")",";",["T_WHITESPACE","\n    ",18],["T_VARIABLE","$original_user",19],["T_WHITESPACE"," ",19],"=",["T_WHITESPACE"," ",19],["T_VARIABLE","$user",19],["T_OBJECT_OPERATOR","->",19],["T_STRING","getAccount",19],"(",")",";",["T_WHITESPACE","\n    ",19],["T_VARIABLE","$original_session_saving",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_VARIABLE","$session_handler",20],["T_OBJECT_OPERATOR","->",20],["T_STRING","isSessionWritable",20],"(",")",";",["T_WHITESPACE","\n\n    ",20],["T_COMMENT","\/\/ Switch to user with uid 2.\n",22],["T_WHITESPACE","    ",23],["T_VARIABLE","$switcher",23],["T_OBJECT_OPERATOR","->",23],["T_STRING","switchTo",23],"(",["T_NEW","new",23],["T_WHITESPACE"," ",23],["T_STRING","UserSession",23],"(",["T_ARRAY","array",23],"(",["T_CONSTANT_ENCAPSED_STRING","'uid'",23],["T_WHITESPACE"," ",23],["T_DOUBLE_ARROW","=>",23],["T_WHITESPACE"," ",23],["T_LNUMBER","2",23],")",")",")",";",["T_WHITESPACE","\n\n    ",23],["T_COMMENT","\/\/ Verify that the active user has changed, and that session saving is\n",25],["T_WHITESPACE","    ",26],["T_COMMENT","\/\/ disabled.\n",26],["T_WHITESPACE","    ",27],["T_VARIABLE","$this",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","assertEqual",27],"(",["T_VARIABLE","$user",27],["T_OBJECT_OPERATOR","->",27],["T_STRING","id",27],"(",")",",",["T_WHITESPACE"," ",27],["T_LNUMBER","2",27],",",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'Switched to user 2.'",27],")",";",["T_WHITESPACE","\n    ",27],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","assertFalse",28],"(",["T_VARIABLE","$session_handler",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","isSessionWritable",28],"(",")",",",["T_WHITESPACE"," ",28],["T_CONSTANT_ENCAPSED_STRING","'Session saving is disabled.'",28],")",";",["T_WHITESPACE","\n\n    ",28],["T_COMMENT","\/\/ Perform a second (nested) user account switch.\n",30],["T_WHITESPACE","    ",31],["T_VARIABLE","$switcher",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","switchTo",31],"(",["T_NEW","new",31],["T_WHITESPACE"," ",31],["T_STRING","UserSession",31],"(",["T_ARRAY","array",31],"(",["T_CONSTANT_ENCAPSED_STRING","'uid'",31],["T_WHITESPACE"," ",31],["T_DOUBLE_ARROW","=>",31],["T_WHITESPACE"," ",31],["T_LNUMBER","3",31],")",")",")",";",["T_WHITESPACE","\n    ",31],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","assertEqual",32],"(",["T_VARIABLE","$user",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","id",32],"(",")",",",["T_WHITESPACE"," ",32],["T_LNUMBER","3",32],",",["T_WHITESPACE"," ",32],["T_CONSTANT_ENCAPSED_STRING","'Switched to user 3.'",32],")",";",["T_WHITESPACE","\n\n    ",32],["T_COMMENT","\/\/ Revert to the user session that was active between the first and second\n",34],["T_WHITESPACE","    ",35],["T_COMMENT","\/\/ switch.\n",35],["T_WHITESPACE","    ",36],["T_VARIABLE","$switcher",36],["T_OBJECT_OPERATOR","->",36],["T_STRING","switchBack",36],"(",")",";",["T_WHITESPACE","\n\n    ",36],["T_COMMENT","\/\/ Since we are still in the account from the first switch, session handling\n",38],["T_WHITESPACE","    ",39],["T_COMMENT","\/\/ still needs to be disabled.\n",39],["T_WHITESPACE","    ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","assertEqual",40],"(",["T_VARIABLE","$user",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","id",40],"(",")",",",["T_WHITESPACE"," ",40],["T_LNUMBER","2",40],",",["T_WHITESPACE"," ",40],["T_CONSTANT_ENCAPSED_STRING","'Reverted to user 2.'",40],")",";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","assertFalse",41],"(",["T_VARIABLE","$session_handler",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","isSessionWritable",41],"(",")",",",["T_WHITESPACE"," ",41],["T_CONSTANT_ENCAPSED_STRING","'Session saving still disabled.'",41],")",";",["T_WHITESPACE","\n\n    ",41],["T_COMMENT","\/\/ Revert to the original account which was active before the first switch.\n",43],["T_WHITESPACE","    ",44],["T_VARIABLE","$switcher",44],["T_OBJECT_OPERATOR","->",44],["T_STRING","switchBack",44],"(",")",";",["T_WHITESPACE","\n\n    ",44],["T_COMMENT","\/\/ Assert that the original account is active again, and that session saving\n",46],["T_WHITESPACE","    ",47],["T_COMMENT","\/\/ has been re-enabled.\n",47],["T_WHITESPACE","    ",48],["T_VARIABLE","$this",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","assertEqual",48],"(",["T_VARIABLE","$user",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","id",48],"(",")",",",["T_WHITESPACE"," ",48],["T_VARIABLE","$original_user",48],["T_OBJECT_OPERATOR","->",48],["T_STRING","id",48],"(",")",",",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'Original user correctly restored.'",48],")",";",["T_WHITESPACE","\n    ",48],["T_VARIABLE","$this",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","assertEqual",49],"(",["T_VARIABLE","$session_handler",49],["T_OBJECT_OPERATOR","->",49],["T_STRING","isSessionWritable",49],"(",")",",",["T_WHITESPACE"," ",49],["T_VARIABLE","$original_session_saving",49],",",["T_WHITESPACE"," ",49],["T_CONSTANT_ENCAPSED_STRING","'Original session saving correctly restored.'",49],")",";",["T_WHITESPACE","\n\n    ",49],["T_COMMENT","\/\/ Verify that AccountSwitcherInterface::switchBack() will throw\n",51],["T_WHITESPACE","    ",52],["T_COMMENT","\/\/ an exception if there are no accounts left in the stack.\n",52],["T_WHITESPACE","    ",53],["T_TRY","try",53],["T_WHITESPACE"," ",53],"{",["T_WHITESPACE","\n      ",53],["T_VARIABLE","$switcher",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","switchBack",54],"(",")",";",["T_WHITESPACE","\n      ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","fail",55],"(",["T_CONSTANT_ENCAPSED_STRING","'::switchBack() throws exception if called without previous switch.'",55],")",";",["T_WHITESPACE","\n    ",55],"}",["T_WHITESPACE","\n    ",56],["T_CATCH","catch",57],["T_WHITESPACE"," ",57],"(",["T_NS_SEPARATOR","\\",57],["T_STRING","RuntimeException",57],["T_WHITESPACE"," ",57],["T_VARIABLE","$e",57],")",["T_WHITESPACE"," ",57],"{",["T_WHITESPACE","\n      ",57],["T_IF","if",58],["T_WHITESPACE"," ",58],"(",["T_VARIABLE","$e",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","getMessage",58],"(",")",["T_WHITESPACE"," ",58],["T_IS_EQUAL","==",58],["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'No more accounts to revert to.'",58],")",["T_WHITESPACE"," ",58],"{",["T_WHITESPACE","\n        ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","pass",59],"(",["T_CONSTANT_ENCAPSED_STRING","'::switchBack() throws exception if called without previous switch.'",59],")",";",["T_WHITESPACE","\n      ",59],"}",["T_WHITESPACE","\n      ",60],["T_ELSE","else",61],["T_WHITESPACE"," ",61],"{",["T_WHITESPACE","\n        ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","fail",62],"(",["T_VARIABLE","$e",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","getMessage",62],"(",")",")",";",["T_WHITESPACE","\n      ",62],"}",["T_WHITESPACE","\n    ",63],"}",["T_WHITESPACE","\n  ",64],"}",["T_WHITESPACE","\n\n",65],"}",["T_WHITESPACE","\n",67]]