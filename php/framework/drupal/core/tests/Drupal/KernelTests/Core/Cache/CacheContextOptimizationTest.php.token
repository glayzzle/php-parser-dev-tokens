[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Cache",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","KernelTests",5],["T_NS_SEPARATOR","\\",5],["T_STRING","KernelTestBase",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","simpletest",6],["T_NS_SEPARATOR","\\",6],["T_STRING","UserCreationTrait",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","user",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Entity",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Role",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Tests the cache context optimization.\n *\n * @group Render\n *\/",9],["T_WHITESPACE","\n",13],["T_CLASS","class",14],["T_WHITESPACE"," ",14],["T_STRING","CacheContextOptimizationTest",14],["T_WHITESPACE"," ",14],["T_EXTENDS","extends",14],["T_WHITESPACE"," ",14],["T_STRING","KernelTestBase",14],["T_WHITESPACE"," ",14],"{",["T_WHITESPACE","\n\n  ",14],["T_USE","use",16],["T_WHITESPACE"," ",16],["T_STRING","UserCreationTrait",16],";",["T_WHITESPACE","\n\n  ",16],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var string[]\n   *\/",18],["T_WHITESPACE","\n  ",22],["T_PUBLIC","public",23],["T_WHITESPACE"," ",23],["T_STATIC","static",23],["T_WHITESPACE"," ",23],["T_VARIABLE","$modules",23],["T_WHITESPACE"," ",23],"=",["T_WHITESPACE"," ",23],"[",["T_CONSTANT_ENCAPSED_STRING","'user'",23],",",["T_WHITESPACE"," ",23],["T_CONSTANT_ENCAPSED_STRING","'system'",23],"]",";",["T_WHITESPACE","\n\n  ",23],["T_DOC_COMMENT","\/**\n   * {@inheritdoc}\n   *\/",25],["T_WHITESPACE","\n  ",27],["T_PROTECTED","protected",28],["T_WHITESPACE"," ",28],["T_FUNCTION","function",28],["T_WHITESPACE"," ",28],["T_STRING","setUp",28],"(",")",["T_WHITESPACE"," ",28],"{",["T_WHITESPACE","\n    ",28],["T_STRING","parent",29],["T_DOUBLE_COLON","::",29],["T_STRING","setUp",29],"(",")",";",["T_WHITESPACE","\n    ",29],["T_VARIABLE","$this",30],["T_OBJECT_OPERATOR","->",30],["T_STRING","installEntitySchema",30],"(",["T_CONSTANT_ENCAPSED_STRING","'user'",30],")",";",["T_WHITESPACE","\n    ",30],["T_VARIABLE","$this",31],["T_OBJECT_OPERATOR","->",31],["T_STRING","installConfig",31],"(","[",["T_CONSTANT_ENCAPSED_STRING","'user'",31],"]",")",";",["T_WHITESPACE","\n    ",31],["T_VARIABLE","$this",32],["T_OBJECT_OPERATOR","->",32],["T_STRING","installSchema",32],"(",["T_CONSTANT_ENCAPSED_STRING","'system'",32],",",["T_WHITESPACE"," ",32],"[",["T_CONSTANT_ENCAPSED_STRING","'sequences'",32],"]",")",";",["T_WHITESPACE","\n  ",32],"}",["T_WHITESPACE","\n\n  ",33],["T_DOC_COMMENT","\/**\n   * Ensures that 'user.permissions' cache context is able to define cache tags.\n   *\/",35],["T_WHITESPACE","\n  ",37],["T_PUBLIC","public",38],["T_WHITESPACE"," ",38],["T_FUNCTION","function",38],["T_WHITESPACE"," ",38],["T_STRING","testUserPermissionCacheContextOptimization",38],"(",")",["T_WHITESPACE"," ",38],"{",["T_WHITESPACE","\n    ",38],["T_VARIABLE","$user1",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_VARIABLE","$this",39],["T_OBJECT_OPERATOR","->",39],["T_STRING","createUser",39],"(",")",";",["T_WHITESPACE","\n    ",39],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","assertEqual",40],"(",["T_VARIABLE","$user1",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","id",40],"(",")",",",["T_WHITESPACE"," ",40],["T_LNUMBER","1",40],")",";",["T_WHITESPACE","\n\n    ",40],["T_VARIABLE","$authenticated_user",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","createUser",42],"(","[",["T_CONSTANT_ENCAPSED_STRING","'administer permissions'",42],"]",")",";",["T_WHITESPACE","\n    ",42],["T_VARIABLE","$role",43],["T_WHITESPACE"," ",43],"=",["T_WHITESPACE"," ",43],["T_VARIABLE","$authenticated_user",43],["T_OBJECT_OPERATOR","->",43],["T_STRING","getRoles",43],"(",")","[",["T_LNUMBER","1",43],"]",";",["T_WHITESPACE","\n\n    ",43],["T_VARIABLE","$test_element",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],"[",["T_WHITESPACE","\n      ",45],["T_CONSTANT_ENCAPSED_STRING","'#cache'",46],["T_WHITESPACE"," ",46],["T_DOUBLE_ARROW","=>",46],["T_WHITESPACE"," ",46],"[",["T_WHITESPACE","\n        ",46],["T_CONSTANT_ENCAPSED_STRING","'keys'",47],["T_WHITESPACE"," ",47],["T_DOUBLE_ARROW","=>",47],["T_WHITESPACE"," ",47],"[",["T_CONSTANT_ENCAPSED_STRING","'test'",47],"]",",",["T_WHITESPACE","\n        ",47],["T_CONSTANT_ENCAPSED_STRING","'contexts'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],"[",["T_CONSTANT_ENCAPSED_STRING","'user'",48],",",["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'user.permissions'",48],"]",",",["T_WHITESPACE","\n      ",48],"]",",",["T_WHITESPACE","\n    ",49],"]",";",["T_WHITESPACE","\n    ",50],["T_NS_SEPARATOR","\\",51],["T_STRING","Drupal",51],["T_DOUBLE_COLON","::",51],["T_STRING","service",51],"(",["T_CONSTANT_ENCAPSED_STRING","'account_switcher'",51],")",["T_OBJECT_OPERATOR","->",51],["T_STRING","switchTo",51],"(",["T_VARIABLE","$authenticated_user",51],")",";",["T_WHITESPACE","\n    ",51],["T_VARIABLE","$element",52],["T_WHITESPACE"," ",52],"=",["T_WHITESPACE"," ",52],["T_VARIABLE","$test_element",52],";",["T_WHITESPACE","\n    ",52],["T_VARIABLE","$element",53],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",53],"]",["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'content for authenticated users'",53],";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$output",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_NS_SEPARATOR","\\",54],["T_STRING","Drupal",54],["T_DOUBLE_COLON","::",54],["T_STRING","service",54],"(",["T_CONSTANT_ENCAPSED_STRING","'renderer'",54],")",["T_OBJECT_OPERATOR","->",54],["T_STRING","renderRoot",54],"(",["T_VARIABLE","$element",54],")",";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","assertEqual",55],"(",["T_VARIABLE","$output",55],",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'content for authenticated users'",55],")",";",["T_WHITESPACE","\n\n    ",55],["T_COMMENT","\/\/ Verify that the render caching is working so that other tests can be\n",57],["T_WHITESPACE","    ",58],["T_COMMENT","\/\/ trusted.\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$element",59],["T_WHITESPACE"," ",59],"=",["T_WHITESPACE"," ",59],["T_VARIABLE","$test_element",59],";",["T_WHITESPACE","\n    ",59],["T_VARIABLE","$element",60],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",60],"]",["T_WHITESPACE"," ",60],"=",["T_WHITESPACE"," ",60],["T_CONSTANT_ENCAPSED_STRING","'this should not be visible'",60],";",["T_WHITESPACE","\n    ",60],["T_VARIABLE","$output",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_NS_SEPARATOR","\\",61],["T_STRING","Drupal",61],["T_DOUBLE_COLON","::",61],["T_STRING","service",61],"(",["T_CONSTANT_ENCAPSED_STRING","'renderer'",61],")",["T_OBJECT_OPERATOR","->",61],["T_STRING","renderRoot",61],"(",["T_VARIABLE","$element",61],")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertEqual",62],"(",["T_VARIABLE","$output",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'content for authenticated users'",62],")",";",["T_WHITESPACE","\n\n    ",62],["T_COMMENT","\/\/ Even though the cache contexts have been optimized to only include 'user'\n",64],["T_WHITESPACE","    ",65],["T_COMMENT","\/\/ cache context, the element should have been changed because\n",65],["T_WHITESPACE","    ",66],["T_COMMENT","\/\/ 'user.permissions' cache context defined a cache tags for permission\n",66],["T_WHITESPACE","    ",67],["T_COMMENT","\/\/ changes, which should have bubbled up for the element when it was\n",67],["T_WHITESPACE","    ",68],["T_COMMENT","\/\/ optimized away.\n",68],["T_WHITESPACE","    ",69],["T_STRING","Role",69],["T_DOUBLE_COLON","::",69],["T_STRING","load",69],"(",["T_VARIABLE","$role",69],")",["T_WHITESPACE","\n      ",69],["T_OBJECT_OPERATOR","->",70],["T_STRING","revokePermission",70],"(",["T_CONSTANT_ENCAPSED_STRING","'administer permissions'",70],")",["T_WHITESPACE","\n      ",70],["T_OBJECT_OPERATOR","->",71],["T_STRING","save",71],"(",")",";",["T_WHITESPACE","\n    ",71],["T_VARIABLE","$element",72],["T_WHITESPACE"," ",72],"=",["T_WHITESPACE"," ",72],["T_VARIABLE","$test_element",72],";",["T_WHITESPACE","\n    ",72],["T_VARIABLE","$element",73],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",73],"]",["T_WHITESPACE"," ",73],"=",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'this should be visible'",73],";",["T_WHITESPACE","\n    ",73],["T_VARIABLE","$output",74],["T_WHITESPACE"," ",74],"=",["T_WHITESPACE"," ",74],["T_NS_SEPARATOR","\\",74],["T_STRING","Drupal",74],["T_DOUBLE_COLON","::",74],["T_STRING","service",74],"(",["T_CONSTANT_ENCAPSED_STRING","'renderer'",74],")",["T_OBJECT_OPERATOR","->",74],["T_STRING","renderRoot",74],"(",["T_VARIABLE","$element",74],")",";",["T_WHITESPACE","\n    ",74],["T_VARIABLE","$this",75],["T_OBJECT_OPERATOR","->",75],["T_STRING","assertEqual",75],"(",["T_VARIABLE","$output",75],",",["T_WHITESPACE"," ",75],["T_CONSTANT_ENCAPSED_STRING","'this should be visible'",75],")",";",["T_WHITESPACE","\n  ",75],"}",["T_WHITESPACE","\n\n  ",76],["T_DOC_COMMENT","\/**\n   * Ensures that 'user.roles' still works when it is optimized away.\n   *\/",78],["T_WHITESPACE","\n  ",80],["T_PUBLIC","public",81],["T_WHITESPACE"," ",81],["T_FUNCTION","function",81],["T_WHITESPACE"," ",81],["T_STRING","testUserRolesCacheContextOptimization",81],"(",")",["T_WHITESPACE"," ",81],"{",["T_WHITESPACE","\n    ",81],["T_VARIABLE","$root_user",82],["T_WHITESPACE"," ",82],"=",["T_WHITESPACE"," ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","createUser",82],"(",")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertEqual",83],"(",["T_VARIABLE","$root_user",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","id",83],"(",")",",",["T_WHITESPACE"," ",83],["T_LNUMBER","1",83],")",";",["T_WHITESPACE","\n\n    ",83],["T_VARIABLE","$authenticated_user",85],["T_WHITESPACE"," ",85],"=",["T_WHITESPACE"," ",85],["T_VARIABLE","$this",85],["T_OBJECT_OPERATOR","->",85],["T_STRING","createUser",85],"(","[",["T_CONSTANT_ENCAPSED_STRING","'administer permissions'",85],"]",")",";",["T_WHITESPACE","\n    ",85],["T_VARIABLE","$role",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$authenticated_user",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","getRoles",86],"(",")","[",["T_LNUMBER","1",86],"]",";",["T_WHITESPACE","\n\n    ",86],["T_VARIABLE","$test_element",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],"[",["T_WHITESPACE","\n      ",88],["T_CONSTANT_ENCAPSED_STRING","'#cache'",89],["T_WHITESPACE"," ",89],["T_DOUBLE_ARROW","=>",89],["T_WHITESPACE"," ",89],"[",["T_WHITESPACE","\n        ",89],["T_CONSTANT_ENCAPSED_STRING","'keys'",90],["T_WHITESPACE"," ",90],["T_DOUBLE_ARROW","=>",90],["T_WHITESPACE"," ",90],"[",["T_CONSTANT_ENCAPSED_STRING","'test'",90],"]",",",["T_WHITESPACE","\n        ",90],["T_CONSTANT_ENCAPSED_STRING","'contexts'",91],["T_WHITESPACE"," ",91],["T_DOUBLE_ARROW","=>",91],["T_WHITESPACE"," ",91],"[",["T_CONSTANT_ENCAPSED_STRING","'user'",91],",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'user.roles'",91],"]",",",["T_WHITESPACE","\n      ",91],"]",",",["T_WHITESPACE","\n    ",92],"]",";",["T_WHITESPACE","\n    ",93],["T_NS_SEPARATOR","\\",94],["T_STRING","Drupal",94],["T_DOUBLE_COLON","::",94],["T_STRING","service",94],"(",["T_CONSTANT_ENCAPSED_STRING","'account_switcher'",94],")",["T_OBJECT_OPERATOR","->",94],["T_STRING","switchTo",94],"(",["T_VARIABLE","$authenticated_user",94],")",";",["T_WHITESPACE","\n    ",94],["T_VARIABLE","$element",95],["T_WHITESPACE"," ",95],"=",["T_WHITESPACE"," ",95],["T_VARIABLE","$test_element",95],";",["T_WHITESPACE","\n    ",95],["T_VARIABLE","$element",96],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",96],"]",["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_CONSTANT_ENCAPSED_STRING","'content for authenticated users'",96],";",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$output",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_NS_SEPARATOR","\\",97],["T_STRING","Drupal",97],["T_DOUBLE_COLON","::",97],["T_STRING","service",97],"(",["T_CONSTANT_ENCAPSED_STRING","'renderer'",97],")",["T_OBJECT_OPERATOR","->",97],["T_STRING","renderRoot",97],"(",["T_VARIABLE","$element",97],")",";",["T_WHITESPACE","\n    ",97],["T_VARIABLE","$this",98],["T_OBJECT_OPERATOR","->",98],["T_STRING","assertEqual",98],"(",["T_VARIABLE","$output",98],",",["T_WHITESPACE"," ",98],["T_CONSTANT_ENCAPSED_STRING","'content for authenticated users'",98],")",";",["T_WHITESPACE","\n\n    ",98],["T_COMMENT","\/\/ Verify that the render caching is working so that other tests can be\n",100],["T_WHITESPACE","    ",101],["T_COMMENT","\/\/ trusted.\n",101],["T_WHITESPACE","    ",102],["T_VARIABLE","$element",102],["T_WHITESPACE"," ",102],"=",["T_WHITESPACE"," ",102],["T_VARIABLE","$test_element",102],";",["T_WHITESPACE","\n    ",102],["T_VARIABLE","$element",103],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",103],"]",["T_WHITESPACE"," ",103],"=",["T_WHITESPACE"," ",103],["T_CONSTANT_ENCAPSED_STRING","'this should not be visible'",103],";",["T_WHITESPACE","\n    ",103],["T_VARIABLE","$output",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_NS_SEPARATOR","\\",104],["T_STRING","Drupal",104],["T_DOUBLE_COLON","::",104],["T_STRING","service",104],"(",["T_CONSTANT_ENCAPSED_STRING","'renderer'",104],")",["T_OBJECT_OPERATOR","->",104],["T_STRING","renderRoot",104],"(",["T_VARIABLE","$element",104],")",";",["T_WHITESPACE","\n    ",104],["T_VARIABLE","$this",105],["T_OBJECT_OPERATOR","->",105],["T_STRING","assertEqual",105],"(",["T_VARIABLE","$output",105],",",["T_WHITESPACE"," ",105],["T_CONSTANT_ENCAPSED_STRING","'content for authenticated users'",105],")",";",["T_WHITESPACE","\n\n    ",105],["T_COMMENT","\/\/ Even though the cache contexts have been optimized to only include 'user'\n",107],["T_WHITESPACE","    ",108],["T_COMMENT","\/\/ cache context, the element should have been changed because 'user.roles'\n",108],["T_WHITESPACE","    ",109],["T_COMMENT","\/\/ cache context defined a cache tag for user entity changes, which should\n",109],["T_WHITESPACE","    ",110],["T_COMMENT","\/\/ have bubbled up for the element when it was optimized away.\n",110],["T_WHITESPACE","    ",111],["T_VARIABLE","$authenticated_user",111],["T_OBJECT_OPERATOR","->",111],["T_STRING","removeRole",111],"(",["T_VARIABLE","$role",111],")",";",["T_WHITESPACE","\n    ",111],["T_VARIABLE","$authenticated_user",112],["T_OBJECT_OPERATOR","->",112],["T_STRING","save",112],"(",")",";",["T_WHITESPACE","\n    ",112],["T_VARIABLE","$element",113],["T_WHITESPACE"," ",113],"=",["T_WHITESPACE"," ",113],["T_VARIABLE","$test_element",113],";",["T_WHITESPACE","\n    ",113],["T_VARIABLE","$element",114],"[",["T_CONSTANT_ENCAPSED_STRING","'#markup'",114],"]",["T_WHITESPACE"," ",114],"=",["T_WHITESPACE"," ",114],["T_CONSTANT_ENCAPSED_STRING","'this should be visible'",114],";",["T_WHITESPACE","\n    ",114],["T_VARIABLE","$output",115],["T_WHITESPACE"," ",115],"=",["T_WHITESPACE"," ",115],["T_NS_SEPARATOR","\\",115],["T_STRING","Drupal",115],["T_DOUBLE_COLON","::",115],["T_STRING","service",115],"(",["T_CONSTANT_ENCAPSED_STRING","'renderer'",115],")",["T_OBJECT_OPERATOR","->",115],["T_STRING","renderRoot",115],"(",["T_VARIABLE","$element",115],")",";",["T_WHITESPACE","\n    ",115],["T_VARIABLE","$this",116],["T_OBJECT_OPERATOR","->",116],["T_STRING","assertEqual",116],"(",["T_VARIABLE","$output",116],",",["T_WHITESPACE"," ",116],["T_CONSTANT_ENCAPSED_STRING","'this should be visible'",116],")",";",["T_WHITESPACE","\n  ",116],"}",["T_WHITESPACE","\n\n",117],"}",["T_WHITESPACE","\n",119]]