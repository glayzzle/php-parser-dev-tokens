[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","File",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","StreamWrapper",5],["T_NS_SEPARATOR","\\",5],["T_STRING","StreamWrapperInterface",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","file_test",6],["T_NS_SEPARATOR","\\",6],["T_STRING","StreamWrapper",6],["T_NS_SEPARATOR","\\",6],["T_STRING","DummyReadOnlyStreamWrapper",6],";",["T_WHITESPACE","\n\n",6],["T_DOC_COMMENT","\/**\n * Tests the read-only stream wrapper write functions.\n *\n * @group File\n *\/",8],["T_WHITESPACE","\n",12],["T_CLASS","class",13],["T_WHITESPACE"," ",13],["T_STRING","ReadOnlyStreamWrapperTest",13],["T_WHITESPACE"," ",13],["T_EXTENDS","extends",13],["T_WHITESPACE"," ",13],["T_STRING","FileTestBase",13],["T_WHITESPACE"," ",13],"{",["T_WHITESPACE","\n\n  ",13],["T_DOC_COMMENT","\/**\n   * A stream wrapper scheme to register for the test.\n   *\n   * @var string\n   *\/",15],["T_WHITESPACE","\n  ",19],["T_PROTECTED","protected",20],["T_WHITESPACE"," ",20],["T_VARIABLE","$scheme",20],["T_WHITESPACE"," ",20],"=",["T_WHITESPACE"," ",20],["T_CONSTANT_ENCAPSED_STRING","'dummy-readonly'",20],";",["T_WHITESPACE","\n\n  ",20],["T_DOC_COMMENT","\/**\n   * A fully-qualified stream wrapper class name to register for the test.\n   *\n   * @var string\n   *\/",22],["T_WHITESPACE","\n  ",26],["T_PROTECTED","protected",27],["T_WHITESPACE"," ",27],["T_VARIABLE","$classname",27],["T_WHITESPACE"," ",27],"=",["T_WHITESPACE"," ",27],["T_CONSTANT_ENCAPSED_STRING","'Drupal\\file_test\\StreamWrapper\\DummyReadOnlyStreamWrapper'",27],";",["T_WHITESPACE","\n\n  ",27],["T_DOC_COMMENT","\/**\n   * Test read-only specific behavior.\n   *\/",29],["T_WHITESPACE","\n  ",31],["T_FUNCTION","function",32],["T_WHITESPACE"," ",32],["T_STRING","testReadOnlyBehavior",32],"(",")",["T_WHITESPACE"," ",32],"{",["T_WHITESPACE","\n    ",32],["T_VARIABLE","$type",33],["T_WHITESPACE"," ",33],"=",["T_WHITESPACE"," ",33],["T_STRING","DummyReadOnlyStreamWrapper",33],["T_DOUBLE_COLON","::",33],["T_STRING","getType",33],"(",")",";",["T_WHITESPACE","\n    ",33],["T_COMMENT","\/\/ Checks that the stream wrapper type is not declared as writable.\n",34],["T_WHITESPACE","    ",35],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","assertSame",35],"(",["T_LNUMBER","0",35],",",["T_WHITESPACE"," ",35],["T_VARIABLE","$type",35],["T_WHITESPACE"," ",35],"&",["T_WHITESPACE"," ",35],["T_STRING","StreamWrapperInterface",35],["T_DOUBLE_COLON","::",35],["T_STRING","WRITE",35],")",";",["T_WHITESPACE","\n    ",35],["T_COMMENT","\/\/ Checks that the stream wrapper type is declared as local.\n",36],["T_WHITESPACE","    ",37],["T_VARIABLE","$this",37],["T_OBJECT_OPERATOR","->",37],["T_STRING","assertSame",37],"(",["T_LNUMBER","1",37],",",["T_WHITESPACE"," ",37],["T_VARIABLE","$type",37],["T_WHITESPACE"," ",37],"&",["T_WHITESPACE"," ",37],["T_STRING","StreamWrapperInterface",37],["T_DOUBLE_COLON","::",37],["T_STRING","LOCAL",37],")",";",["T_WHITESPACE","\n\n    ",37],["T_COMMENT","\/\/ Generate a test file\n",39],["T_WHITESPACE","    ",40],["T_VARIABLE","$filename",40],["T_WHITESPACE"," ",40],"=",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","randomMachineName",40],"(",")",";",["T_WHITESPACE","\n    ",40],["T_VARIABLE","$site_path",41],["T_WHITESPACE"," ",41],"=",["T_WHITESPACE"," ",41],["T_VARIABLE","$this",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","container",41],["T_OBJECT_OPERATOR","->",41],["T_STRING","get",41],"(",["T_CONSTANT_ENCAPSED_STRING","'site.path'",41],")",";",["T_WHITESPACE","\n    ",41],["T_VARIABLE","$filepath",42],["T_WHITESPACE"," ",42],"=",["T_WHITESPACE"," ",42],["T_VARIABLE","$site_path",42],["T_WHITESPACE"," ",42],".",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'\/files\/'",42],["T_WHITESPACE"," ",42],".",["T_WHITESPACE"," ",42],["T_VARIABLE","$filename",42],";",["T_WHITESPACE","\n    ",42],["T_STRING","file_put_contents",43],"(",["T_VARIABLE","$filepath",43],",",["T_WHITESPACE"," ",43],["T_VARIABLE","$filename",43],")",";",["T_WHITESPACE","\n\n    ",43],["T_COMMENT","\/\/ Generate a read-only stream wrapper instance\n",45],["T_WHITESPACE","    ",46],["T_VARIABLE","$uri",46],["T_WHITESPACE"," ",46],"=",["T_WHITESPACE"," ",46],["T_VARIABLE","$this",46],["T_OBJECT_OPERATOR","->",46],["T_STRING","scheme",46],["T_WHITESPACE"," ",46],".",["T_WHITESPACE"," ",46],["T_CONSTANT_ENCAPSED_STRING","':\/\/'",46],["T_WHITESPACE"," ",46],".",["T_WHITESPACE"," ",46],["T_VARIABLE","$filename",46],";",["T_WHITESPACE","\n    ",46],["T_NS_SEPARATOR","\\",47],["T_STRING","Drupal",47],["T_DOUBLE_COLON","::",47],["T_STRING","service",47],"(",["T_CONSTANT_ENCAPSED_STRING","'stream_wrapper_manager'",47],")",["T_OBJECT_OPERATOR","->",47],["T_STRING","getViaScheme",47],"(",["T_VARIABLE","$this",47],["T_OBJECT_OPERATOR","->",47],["T_STRING","scheme",47],")",";",["T_WHITESPACE","\n\n    ",47],["T_COMMENT","\/\/ Attempt to open a file in read\/write mode\n",49],["T_WHITESPACE","    ",50],["T_VARIABLE","$handle",50],["T_WHITESPACE"," ",50],"=",["T_WHITESPACE"," ",50],"@",["T_STRING","fopen",50],"(",["T_VARIABLE","$uri",50],",",["T_WHITESPACE"," ",50],["T_CONSTANT_ENCAPSED_STRING","'r+'",50],")",";",["T_WHITESPACE","\n    ",50],["T_VARIABLE","$this",51],["T_OBJECT_OPERATOR","->",51],["T_STRING","assertFalse",51],"(",["T_VARIABLE","$handle",51],",",["T_WHITESPACE"," ",51],["T_CONSTANT_ENCAPSED_STRING","'Unable to open a file for reading and writing with the read-only stream wrapper.'",51],")",";",["T_WHITESPACE","\n    ",51],["T_COMMENT","\/\/ Attempt to open a file in binary read mode\n",52],["T_WHITESPACE","    ",53],["T_VARIABLE","$handle",53],["T_WHITESPACE"," ",53],"=",["T_WHITESPACE"," ",53],["T_STRING","fopen",53],"(",["T_VARIABLE","$uri",53],",",["T_WHITESPACE"," ",53],["T_CONSTANT_ENCAPSED_STRING","'rb'",53],")",";",["T_WHITESPACE","\n    ",53],["T_VARIABLE","$this",54],["T_OBJECT_OPERATOR","->",54],["T_STRING","assertTrue",54],"(",["T_VARIABLE","$handle",54],",",["T_WHITESPACE"," ",54],["T_CONSTANT_ENCAPSED_STRING","'Able to open a file for reading in binary mode with the read-only stream wrapper.'",54],")",";",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$this",55],["T_OBJECT_OPERATOR","->",55],["T_STRING","assertTrue",55],"(",["T_STRING","fclose",55],"(",["T_VARIABLE","$handle",55],")",",",["T_WHITESPACE"," ",55],["T_CONSTANT_ENCAPSED_STRING","'Able to close file opened in binary mode using the read_only stream wrapper.'",55],")",";",["T_WHITESPACE","\n    ",55],["T_COMMENT","\/\/ Attempt to open a file in text read mode\n",56],["T_WHITESPACE","    ",57],["T_VARIABLE","$handle",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","fopen",57],"(",["T_VARIABLE","$uri",57],",",["T_WHITESPACE"," ",57],["T_CONSTANT_ENCAPSED_STRING","'rt'",57],")",";",["T_WHITESPACE","\n    ",57],["T_VARIABLE","$this",58],["T_OBJECT_OPERATOR","->",58],["T_STRING","assertTrue",58],"(",["T_VARIABLE","$handle",58],",",["T_WHITESPACE"," ",58],["T_CONSTANT_ENCAPSED_STRING","'Able to open a file for reading in text mode with the read-only stream wrapper.'",58],")",";",["T_WHITESPACE","\n    ",58],["T_VARIABLE","$this",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","assertTrue",59],"(",["T_STRING","fclose",59],"(",["T_VARIABLE","$handle",59],")",",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'Able to close file opened in text mode using the read_only stream wrapper.'",59],")",";",["T_WHITESPACE","\n    ",59],["T_COMMENT","\/\/ Attempt to open a file in read mode\n",60],["T_WHITESPACE","    ",61],["T_VARIABLE","$handle",61],["T_WHITESPACE"," ",61],"=",["T_WHITESPACE"," ",61],["T_STRING","fopen",61],"(",["T_VARIABLE","$uri",61],",",["T_WHITESPACE"," ",61],["T_CONSTANT_ENCAPSED_STRING","'r'",61],")",";",["T_WHITESPACE","\n    ",61],["T_VARIABLE","$this",62],["T_OBJECT_OPERATOR","->",62],["T_STRING","assertTrue",62],"(",["T_VARIABLE","$handle",62],",",["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'Able to open a file for reading with the read-only stream wrapper.'",62],")",";",["T_WHITESPACE","\n    ",62],["T_COMMENT","\/\/ Attempt to change file permissions\n",63],["T_WHITESPACE","    ",64],["T_VARIABLE","$this",64],["T_OBJECT_OPERATOR","->",64],["T_STRING","assertFalse",64],"(","@",["T_STRING","chmod",64],"(",["T_VARIABLE","$uri",64],",",["T_WHITESPACE"," ",64],["T_LNUMBER","0777",64],")",",",["T_WHITESPACE"," ",64],["T_CONSTANT_ENCAPSED_STRING","'Unable to change file permissions when using read-only stream wrapper.'",64],")",";",["T_WHITESPACE","\n    ",64],["T_COMMENT","\/\/ Attempt to acquire an exclusive lock for writing\n",65],["T_WHITESPACE","    ",66],["T_VARIABLE","$this",66],["T_OBJECT_OPERATOR","->",66],["T_STRING","assertFalse",66],"(","@",["T_STRING","flock",66],"(",["T_VARIABLE","$handle",66],",",["T_WHITESPACE"," ",66],["T_STRING","LOCK_EX",66],["T_WHITESPACE"," ",66],"|",["T_WHITESPACE"," ",66],["T_STRING","LOCK_NB",66],")",",",["T_WHITESPACE"," ",66],["T_CONSTANT_ENCAPSED_STRING","'Unable to acquire an exclusive lock using the read-only stream wrapper.'",66],")",";",["T_WHITESPACE","\n    ",66],["T_COMMENT","\/\/ Attempt to obtain a shared lock\n",67],["T_WHITESPACE","    ",68],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertTrue",68],"(",["T_STRING","flock",68],"(",["T_VARIABLE","$handle",68],",",["T_WHITESPACE"," ",68],["T_STRING","LOCK_SH",68],["T_WHITESPACE"," ",68],"|",["T_WHITESPACE"," ",68],["T_STRING","LOCK_NB",68],")",",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Able to acquire a shared lock using the read-only stream wrapper.'",68],")",";",["T_WHITESPACE","\n    ",68],["T_COMMENT","\/\/ Attempt to release a shared lock\n",69],["T_WHITESPACE","    ",70],["T_VARIABLE","$this",70],["T_OBJECT_OPERATOR","->",70],["T_STRING","assertTrue",70],"(",["T_STRING","flock",70],"(",["T_VARIABLE","$handle",70],",",["T_WHITESPACE"," ",70],["T_STRING","LOCK_UN",70],["T_WHITESPACE"," ",70],"|",["T_WHITESPACE"," ",70],["T_STRING","LOCK_NB",70],")",",",["T_WHITESPACE"," ",70],["T_CONSTANT_ENCAPSED_STRING","'Able to release a shared lock using the read-only stream wrapper.'",70],")",";",["T_WHITESPACE","\n    ",70],["T_COMMENT","\/\/ Attempt to truncate the file\n",71],["T_WHITESPACE","    ",72],["T_VARIABLE","$this",72],["T_OBJECT_OPERATOR","->",72],["T_STRING","assertFalse",72],"(","@",["T_STRING","ftruncate",72],"(",["T_VARIABLE","$handle",72],",",["T_WHITESPACE"," ",72],["T_LNUMBER","0",72],")",",",["T_WHITESPACE"," ",72],["T_CONSTANT_ENCAPSED_STRING","'Unable to truncate using the read-only stream wrapper.'",72],")",";",["T_WHITESPACE","\n    ",72],["T_COMMENT","\/\/ Attempt to write to the file\n",73],["T_WHITESPACE","    ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","assertFalse",74],"(","@",["T_STRING","fwrite",74],"(",["T_VARIABLE","$handle",74],",",["T_WHITESPACE"," ",74],["T_VARIABLE","$this",74],["T_OBJECT_OPERATOR","->",74],["T_STRING","randomMachineName",74],"(",")",")",",",["T_WHITESPACE"," ",74],["T_CONSTANT_ENCAPSED_STRING","'Unable to write to file using the read-only stream wrapper.'",74],")",";",["T_WHITESPACE","\n    ",74],["T_COMMENT","\/\/ Attempt to flush output to the file\n",75],["T_WHITESPACE","    ",76],["T_VARIABLE","$this",76],["T_OBJECT_OPERATOR","->",76],["T_STRING","assertFalse",76],"(","@",["T_STRING","fflush",76],"(",["T_VARIABLE","$handle",76],")",",",["T_WHITESPACE"," ",76],["T_CONSTANT_ENCAPSED_STRING","'Unable to flush output to file using the read-only stream wrapper.'",76],")",";",["T_WHITESPACE","\n    ",76],["T_COMMENT","\/\/ Attempt to close the stream.  (Suppress errors, as fclose triggers fflush.)\n",77],["T_WHITESPACE","    ",78],["T_VARIABLE","$this",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","assertTrue",78],"(",["T_STRING","fclose",78],"(",["T_VARIABLE","$handle",78],")",",",["T_WHITESPACE"," ",78],["T_CONSTANT_ENCAPSED_STRING","'Able to close file using the read_only stream wrapper.'",78],")",";",["T_WHITESPACE","\n    ",78],["T_COMMENT","\/\/ Test the rename() function\n",79],["T_WHITESPACE","    ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","assertFalse",80],"(","@",["T_STRING","rename",80],"(",["T_VARIABLE","$uri",80],",",["T_WHITESPACE"," ",80],["T_VARIABLE","$this",80],["T_OBJECT_OPERATOR","->",80],["T_STRING","scheme",80],["T_WHITESPACE"," ",80],".",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","':\/\/newname.txt'",80],")",",",["T_WHITESPACE"," ",80],["T_CONSTANT_ENCAPSED_STRING","'Unable to rename files using the read-only stream wrapper.'",80],")",";",["T_WHITESPACE","\n    ",80],["T_COMMENT","\/\/ Test the unlink() function\n",81],["T_WHITESPACE","    ",82],["T_VARIABLE","$this",82],["T_OBJECT_OPERATOR","->",82],["T_STRING","assertTrue",82],"(","@",["T_STRING","drupal_unlink",82],"(",["T_VARIABLE","$uri",82],")",",",["T_WHITESPACE"," ",82],["T_CONSTANT_ENCAPSED_STRING","'Able to unlink file using read-only stream wrapper.'",82],")",";",["T_WHITESPACE","\n    ",82],["T_VARIABLE","$this",83],["T_OBJECT_OPERATOR","->",83],["T_STRING","assertTrue",83],"(",["T_STRING","file_exists",83],"(",["T_VARIABLE","$filepath",83],")",",",["T_WHITESPACE"," ",83],["T_CONSTANT_ENCAPSED_STRING","'Unlink File was not actually deleted.'",83],")",";",["T_WHITESPACE","\n\n    ",83],["T_COMMENT","\/\/ Test the mkdir() function by attempting to create a directory.\n",85],["T_WHITESPACE","    ",86],["T_VARIABLE","$dirname",86],["T_WHITESPACE"," ",86],"=",["T_WHITESPACE"," ",86],["T_VARIABLE","$this",86],["T_OBJECT_OPERATOR","->",86],["T_STRING","randomMachineName",86],"(",")",";",["T_WHITESPACE","\n    ",86],["T_VARIABLE","$dir",87],["T_WHITESPACE"," ",87],"=",["T_WHITESPACE"," ",87],["T_VARIABLE","$site_path",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_CONSTANT_ENCAPSED_STRING","'\/files\/'",87],["T_WHITESPACE"," ",87],".",["T_WHITESPACE"," ",87],["T_VARIABLE","$dirname",87],";",["T_WHITESPACE","\n    ",87],["T_VARIABLE","$readonlydir",88],["T_WHITESPACE"," ",88],"=",["T_WHITESPACE"," ",88],["T_VARIABLE","$this",88],["T_OBJECT_OPERATOR","->",88],["T_STRING","scheme",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_CONSTANT_ENCAPSED_STRING","':\/\/'",88],["T_WHITESPACE"," ",88],".",["T_WHITESPACE"," ",88],["T_VARIABLE","$dirname",88],";",["T_WHITESPACE","\n    ",88],["T_VARIABLE","$this",89],["T_OBJECT_OPERATOR","->",89],["T_STRING","assertFalse",89],"(","@",["T_STRING","drupal_mkdir",89],"(",["T_VARIABLE","$readonlydir",89],",",["T_WHITESPACE"," ",89],["T_LNUMBER","0775",89],",",["T_WHITESPACE"," ",89],["T_LNUMBER","0",89],")",",",["T_WHITESPACE"," ",89],["T_CONSTANT_ENCAPSED_STRING","'Unable to create directory with read-only stream wrapper.'",89],")",";",["T_WHITESPACE","\n    ",89],["T_COMMENT","\/\/ Create a temporary directory for testing purposes\n",90],["T_WHITESPACE","    ",91],["T_VARIABLE","$this",91],["T_OBJECT_OPERATOR","->",91],["T_STRING","assertTrue",91],"(",["T_STRING","drupal_mkdir",91],"(",["T_VARIABLE","$dir",91],")",",",["T_WHITESPACE"," ",91],["T_CONSTANT_ENCAPSED_STRING","'Test directory created.'",91],")",";",["T_WHITESPACE","\n    ",91],["T_COMMENT","\/\/ Test the rmdir() function by attempting to remove the directory.\n",92],["T_WHITESPACE","    ",93],["T_VARIABLE","$this",93],["T_OBJECT_OPERATOR","->",93],["T_STRING","assertFalse",93],"(","@",["T_STRING","drupal_rmdir",93],"(",["T_VARIABLE","$readonlydir",93],")",",",["T_WHITESPACE"," ",93],["T_CONSTANT_ENCAPSED_STRING","'Unable to delete directory with read-only stream wrapper.'",93],")",";",["T_WHITESPACE","\n    ",93],["T_COMMENT","\/\/ Remove the temporary directory.\n",94],["T_WHITESPACE","    ",95],["T_STRING","drupal_rmdir",95],"(",["T_VARIABLE","$dir",95],")",";",["T_WHITESPACE","\n  ",95],"}",["T_WHITESPACE","\n\n",96],"}",["T_WHITESPACE","\n",98]]