[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Database",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Core",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Database",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","TransactionOutOfOrderException",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Database",7],["T_NS_SEPARATOR","\\",7],["T_STRING","TransactionNoActiveException",7],";",["T_WHITESPACE","\n\n",7],["T_DOC_COMMENT","\/**\n * Tests the transaction abstraction system.\n *\n * We test nesting by having two transaction layers, an outer and inner. The\n * outer layer encapsulates the inner layer. Our transaction nesting abstraction\n * should allow the outer layer function to call any function it wants,\n * especially the inner layer that starts its own transaction, and be\n * confident that, when the function it calls returns, its own transaction\n * is still \"alive.\"\n *\n * Call structure:\n *   transactionOuterLayer()\n *     Start transaction\n *     transactionInnerLayer()\n *       Start transaction (does nothing in database)\n *       [Maybe decide to roll back]\n *     Do more stuff\n *     Should still be in transaction A\n *\n * @group Database\n *\/",9],["T_WHITESPACE","\n",29],["T_CLASS","class",30],["T_WHITESPACE"," ",30],["T_STRING","TransactionTest",30],["T_WHITESPACE"," ",30],["T_EXTENDS","extends",30],["T_WHITESPACE"," ",30],["T_STRING","DatabaseTestBase",30],["T_WHITESPACE"," ",30],"{",["T_WHITESPACE","\n\n  ",30],["T_DOC_COMMENT","\/**\n   * Encapsulates a transaction's \"inner layer\" with an \"outer layer\".\n   *\n   * This \"outer layer\" transaction starts and then encapsulates the \"inner\n   * layer\" transaction. This nesting is used to evaluate whether the database\n   * transaction API properly supports nesting. By \"properly supports,\" we mean\n   * the outer transaction continues to exist regardless of what functions are\n   * called and whether those functions start their own transactions.\n   *\n   * In contrast, a typical database would commit the outer transaction, start\n   * a new transaction for the inner layer, commit the inner layer transaction,\n   * and then be confused when the outer layer transaction tries to commit its\n   * transaction (which was already committed when the inner transaction\n   * started).\n   *\n   * @param $suffix\n   *   Suffix to add to field values to differentiate tests.\n   * @param $rollback\n   *   Whether or not to try rolling back the transaction when we're done.\n   * @param $ddl_statement\n   *   Whether to execute a DDL statement during the inner transaction.\n   *\/",32],["T_WHITESPACE","\n  ",53],["T_PROTECTED","protected",54],["T_WHITESPACE"," ",54],["T_FUNCTION","function",54],["T_WHITESPACE"," ",54],["T_STRING","transactionOuterLayer",54],"(",["T_VARIABLE","$suffix",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$rollback",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","FALSE",54],",",["T_WHITESPACE"," ",54],["T_VARIABLE","$ddl_statement",54],["T_WHITESPACE"," ",54],"=",["T_WHITESPACE"," ",54],["T_STRING","FALSE",54],")",["T_WHITESPACE"," ",54],"{",["T_WHITESPACE","\n    ",54],["T_VARIABLE","$connection",55],["T_WHITESPACE"," ",55],"=",["T_WHITESPACE"," ",55],["T_STRING","Database",55],["T_DOUBLE_COLON","::",55],["T_STRING","getConnection",55],"(",")",";",["T_WHITESPACE","\n    ",55],["T_VARIABLE","$depth",56],["T_WHITESPACE"," ",56],"=",["T_WHITESPACE"," ",56],["T_VARIABLE","$connection",56],["T_OBJECT_OPERATOR","->",56],["T_STRING","transactionDepth",56],"(",")",";",["T_WHITESPACE","\n    ",56],["T_VARIABLE","$txn",57],["T_WHITESPACE"," ",57],"=",["T_WHITESPACE"," ",57],["T_STRING","db_transaction",57],"(",")",";",["T_WHITESPACE","\n\n    ",57],["T_COMMENT","\/\/ Insert a single row into the testing table.\n",59],["T_WHITESPACE","    ",60],["T_STRING","db_insert",60],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",60],")",["T_WHITESPACE","\n      ",60],["T_OBJECT_OPERATOR","->",61],["T_STRING","fields",61],"(",["T_ARRAY","array",61],"(",["T_WHITESPACE","\n        ",61],["T_CONSTANT_ENCAPSED_STRING","'name'",62],["T_WHITESPACE"," ",62],["T_DOUBLE_ARROW","=>",62],["T_WHITESPACE"," ",62],["T_CONSTANT_ENCAPSED_STRING","'David'",62],["T_WHITESPACE"," ",62],".",["T_WHITESPACE"," ",62],["T_VARIABLE","$suffix",62],",",["T_WHITESPACE","\n        ",62],["T_CONSTANT_ENCAPSED_STRING","'age'",63],["T_WHITESPACE"," ",63],["T_DOUBLE_ARROW","=>",63],["T_WHITESPACE"," ",63],["T_CONSTANT_ENCAPSED_STRING","'24'",63],",",["T_WHITESPACE","\n      ",63],")",")",["T_WHITESPACE","\n      ",64],["T_OBJECT_OPERATOR","->",65],["T_STRING","execute",65],"(",")",";",["T_WHITESPACE","\n\n    ",65],["T_VARIABLE","$this",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","assertTrue",67],"(",["T_VARIABLE","$connection",67],["T_OBJECT_OPERATOR","->",67],["T_STRING","inTransaction",67],"(",")",",",["T_WHITESPACE"," ",67],["T_CONSTANT_ENCAPSED_STRING","'In transaction before calling nested transaction.'",67],")",";",["T_WHITESPACE","\n\n    ",67],["T_COMMENT","\/\/ We're already in a transaction, but we call ->transactionInnerLayer\n",69],["T_WHITESPACE","    ",70],["T_COMMENT","\/\/ to nest another transaction inside the current one.\n",70],["T_WHITESPACE","    ",71],["T_VARIABLE","$this",71],["T_OBJECT_OPERATOR","->",71],["T_STRING","transactionInnerLayer",71],"(",["T_VARIABLE","$suffix",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$rollback",71],",",["T_WHITESPACE"," ",71],["T_VARIABLE","$ddl_statement",71],")",";",["T_WHITESPACE","\n\n    ",71],["T_VARIABLE","$this",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","assertTrue",73],"(",["T_VARIABLE","$connection",73],["T_OBJECT_OPERATOR","->",73],["T_STRING","inTransaction",73],"(",")",",",["T_WHITESPACE"," ",73],["T_CONSTANT_ENCAPSED_STRING","'In transaction after calling nested transaction.'",73],")",";",["T_WHITESPACE","\n\n    ",73],["T_IF","if",75],["T_WHITESPACE"," ",75],"(",["T_VARIABLE","$rollback",75],")",["T_WHITESPACE"," ",75],"{",["T_WHITESPACE","\n      ",75],["T_COMMENT","\/\/ Roll back the transaction, if requested.\n",76],["T_WHITESPACE","      ",77],["T_COMMENT","\/\/ This rollback should propagate to the last savepoint.\n",77],["T_WHITESPACE","      ",78],["T_VARIABLE","$txn",78],["T_OBJECT_OPERATOR","->",78],["T_STRING","rollback",78],"(",")",";",["T_WHITESPACE","\n      ",78],["T_VARIABLE","$this",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","assertTrue",79],"(","(",["T_VARIABLE","$connection",79],["T_OBJECT_OPERATOR","->",79],["T_STRING","transactionDepth",79],"(",")",["T_WHITESPACE"," ",79],["T_IS_EQUAL","==",79],["T_WHITESPACE"," ",79],["T_VARIABLE","$depth",79],")",",",["T_WHITESPACE"," ",79],["T_CONSTANT_ENCAPSED_STRING","'Transaction has rolled back to the last savepoint after calling rollback().'",79],")",";",["T_WHITESPACE","\n    ",79],"}",["T_WHITESPACE","\n  ",80],"}",["T_WHITESPACE","\n\n  ",81],["T_DOC_COMMENT","\/**\n   * Creates an \"inner layer\" transaction.\n   *\n   * This \"inner layer\" transaction is either used alone or nested inside of the\n   * \"outer layer\" transaction.\n   *\n   * @param $suffix\n   *   Suffix to add to field values to differentiate tests.\n   * @param $rollback\n   *   Whether or not to try rolling back the transaction when we're done.\n   * @param $ddl_statement\n   *   Whether to execute a DDL statement during the transaction.\n   *\/",83],["T_WHITESPACE","\n  ",95],["T_PROTECTED","protected",96],["T_WHITESPACE"," ",96],["T_FUNCTION","function",96],["T_WHITESPACE"," ",96],["T_STRING","transactionInnerLayer",96],"(",["T_VARIABLE","$suffix",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$rollback",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","FALSE",96],",",["T_WHITESPACE"," ",96],["T_VARIABLE","$ddl_statement",96],["T_WHITESPACE"," ",96],"=",["T_WHITESPACE"," ",96],["T_STRING","FALSE",96],")",["T_WHITESPACE"," ",96],"{",["T_WHITESPACE","\n    ",96],["T_VARIABLE","$connection",97],["T_WHITESPACE"," ",97],"=",["T_WHITESPACE"," ",97],["T_STRING","Database",97],["T_DOUBLE_COLON","::",97],["T_STRING","getConnection",97],"(",")",";",["T_WHITESPACE","\n\n    ",97],["T_VARIABLE","$depth",99],["T_WHITESPACE"," ",99],"=",["T_WHITESPACE"," ",99],["T_VARIABLE","$connection",99],["T_OBJECT_OPERATOR","->",99],["T_STRING","transactionDepth",99],"(",")",";",["T_WHITESPACE","\n    ",99],["T_COMMENT","\/\/ Start a transaction. If we're being called from ->transactionOuterLayer,\n",100],["T_WHITESPACE","    ",101],["T_COMMENT","\/\/ then we're already in a transaction. Normally, that would make starting\n",101],["T_WHITESPACE","    ",102],["T_COMMENT","\/\/ a transaction here dangerous, but the database API handles this problem\n",102],["T_WHITESPACE","    ",103],["T_COMMENT","\/\/ for us by tracking the nesting and avoiding the danger.\n",103],["T_WHITESPACE","    ",104],["T_VARIABLE","$txn",104],["T_WHITESPACE"," ",104],"=",["T_WHITESPACE"," ",104],["T_STRING","db_transaction",104],"(",")",";",["T_WHITESPACE","\n\n    ",104],["T_VARIABLE","$depth2",106],["T_WHITESPACE"," ",106],"=",["T_WHITESPACE"," ",106],["T_VARIABLE","$connection",106],["T_OBJECT_OPERATOR","->",106],["T_STRING","transactionDepth",106],"(",")",";",["T_WHITESPACE","\n    ",106],["T_VARIABLE","$this",107],["T_OBJECT_OPERATOR","->",107],["T_STRING","assertTrue",107],"(",["T_VARIABLE","$depth",107],["T_WHITESPACE"," ",107],"<",["T_WHITESPACE"," ",107],["T_VARIABLE","$depth2",107],",",["T_WHITESPACE"," ",107],["T_CONSTANT_ENCAPSED_STRING","'Transaction depth is has increased with new transaction.'",107],")",";",["T_WHITESPACE","\n\n    ",107],["T_COMMENT","\/\/ Insert a single row into the testing table.\n",109],["T_WHITESPACE","    ",110],["T_STRING","db_insert",110],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",110],")",["T_WHITESPACE","\n      ",110],["T_OBJECT_OPERATOR","->",111],["T_STRING","fields",111],"(",["T_ARRAY","array",111],"(",["T_WHITESPACE","\n        ",111],["T_CONSTANT_ENCAPSED_STRING","'name'",112],["T_WHITESPACE"," ",112],["T_DOUBLE_ARROW","=>",112],["T_WHITESPACE"," ",112],["T_CONSTANT_ENCAPSED_STRING","'Daniel'",112],["T_WHITESPACE"," ",112],".",["T_WHITESPACE"," ",112],["T_VARIABLE","$suffix",112],",",["T_WHITESPACE","\n        ",112],["T_CONSTANT_ENCAPSED_STRING","'age'",113],["T_WHITESPACE"," ",113],["T_DOUBLE_ARROW","=>",113],["T_WHITESPACE"," ",113],["T_CONSTANT_ENCAPSED_STRING","'19'",113],",",["T_WHITESPACE","\n      ",113],")",")",["T_WHITESPACE","\n      ",114],["T_OBJECT_OPERATOR","->",115],["T_STRING","execute",115],"(",")",";",["T_WHITESPACE","\n\n    ",115],["T_VARIABLE","$this",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","assertTrue",117],"(",["T_VARIABLE","$connection",117],["T_OBJECT_OPERATOR","->",117],["T_STRING","inTransaction",117],"(",")",",",["T_WHITESPACE"," ",117],["T_CONSTANT_ENCAPSED_STRING","'In transaction inside nested transaction.'",117],")",";",["T_WHITESPACE","\n\n    ",117],["T_IF","if",119],["T_WHITESPACE"," ",119],"(",["T_VARIABLE","$ddl_statement",119],")",["T_WHITESPACE"," ",119],"{",["T_WHITESPACE","\n      ",119],["T_VARIABLE","$table",120],["T_WHITESPACE"," ",120],"=",["T_WHITESPACE"," ",120],["T_ARRAY","array",120],"(",["T_WHITESPACE","\n        ",120],["T_CONSTANT_ENCAPSED_STRING","'fields'",121],["T_WHITESPACE"," ",121],["T_DOUBLE_ARROW","=>",121],["T_WHITESPACE"," ",121],["T_ARRAY","array",121],"(",["T_WHITESPACE","\n          ",121],["T_CONSTANT_ENCAPSED_STRING","'id'",122],["T_WHITESPACE"," ",122],["T_DOUBLE_ARROW","=>",122],["T_WHITESPACE"," ",122],["T_ARRAY","array",122],"(",["T_WHITESPACE","\n            ",122],["T_CONSTANT_ENCAPSED_STRING","'type'",123],["T_WHITESPACE"," ",123],["T_DOUBLE_ARROW","=>",123],["T_WHITESPACE"," ",123],["T_CONSTANT_ENCAPSED_STRING","'serial'",123],",",["T_WHITESPACE","\n            ",123],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",124],["T_WHITESPACE"," ",124],["T_DOUBLE_ARROW","=>",124],["T_WHITESPACE"," ",124],["T_STRING","TRUE",124],",",["T_WHITESPACE","\n            ",124],["T_CONSTANT_ENCAPSED_STRING","'not null'",125],["T_WHITESPACE"," ",125],["T_DOUBLE_ARROW","=>",125],["T_WHITESPACE"," ",125],["T_STRING","TRUE",125],",",["T_WHITESPACE","\n          ",125],")",",",["T_WHITESPACE","\n        ",126],")",",",["T_WHITESPACE","\n        ",127],["T_CONSTANT_ENCAPSED_STRING","'primary key'",128],["T_WHITESPACE"," ",128],["T_DOUBLE_ARROW","=>",128],["T_WHITESPACE"," ",128],["T_ARRAY","array",128],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",128],")",",",["T_WHITESPACE","\n      ",128],")",";",["T_WHITESPACE","\n      ",129],["T_STRING","db_create_table",130],"(",["T_CONSTANT_ENCAPSED_STRING","'database_test_1'",130],",",["T_WHITESPACE"," ",130],["T_VARIABLE","$table",130],")",";",["T_WHITESPACE","\n\n      ",130],["T_VARIABLE","$this",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","assertTrue",132],"(",["T_VARIABLE","$connection",132],["T_OBJECT_OPERATOR","->",132],["T_STRING","inTransaction",132],"(",")",",",["T_WHITESPACE"," ",132],["T_CONSTANT_ENCAPSED_STRING","'In transaction inside nested transaction.'",132],")",";",["T_WHITESPACE","\n    ",132],"}",["T_WHITESPACE","\n\n    ",133],["T_IF","if",135],["T_WHITESPACE"," ",135],"(",["T_VARIABLE","$rollback",135],")",["T_WHITESPACE"," ",135],"{",["T_WHITESPACE","\n      ",135],["T_COMMENT","\/\/ Roll back the transaction, if requested.\n",136],["T_WHITESPACE","      ",137],["T_COMMENT","\/\/ This rollback should propagate to the last savepoint.\n",137],["T_WHITESPACE","      ",138],["T_VARIABLE","$txn",138],["T_OBJECT_OPERATOR","->",138],["T_STRING","rollback",138],"(",")",";",["T_WHITESPACE","\n      ",138],["T_VARIABLE","$this",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","assertTrue",139],"(","(",["T_VARIABLE","$connection",139],["T_OBJECT_OPERATOR","->",139],["T_STRING","transactionDepth",139],"(",")",["T_WHITESPACE"," ",139],["T_IS_EQUAL","==",139],["T_WHITESPACE"," ",139],["T_VARIABLE","$depth",139],")",",",["T_WHITESPACE"," ",139],["T_CONSTANT_ENCAPSED_STRING","'Transaction has rolled back to the last savepoint after calling rollback().'",139],")",";",["T_WHITESPACE","\n    ",139],"}",["T_WHITESPACE","\n  ",140],"}",["T_WHITESPACE","\n\n  ",141],["T_DOC_COMMENT","\/**\n   * Tests transaction rollback on a database that supports transactions.\n   *\n   * If the active connection does not support transactions, this test does\n   * nothing.\n   *\/",143],["T_WHITESPACE","\n  ",148],["T_FUNCTION","function",149],["T_WHITESPACE"," ",149],["T_STRING","testTransactionRollBackSupported",149],"(",")",["T_WHITESPACE"," ",149],"{",["T_WHITESPACE","\n    ",149],["T_COMMENT","\/\/ This test won't work right if transactions are not supported.\n",150],["T_WHITESPACE","    ",151],["T_IF","if",151],["T_WHITESPACE"," ",151],"(","!",["T_STRING","Database",151],["T_DOUBLE_COLON","::",151],["T_STRING","getConnection",151],"(",")",["T_OBJECT_OPERATOR","->",151],["T_STRING","supportsTransactions",151],"(",")",")",["T_WHITESPACE"," ",151],"{",["T_WHITESPACE","\n      ",151],["T_RETURN","return",152],";",["T_WHITESPACE","\n    ",152],"}",["T_WHITESPACE","\n    ",153],["T_TRY","try",154],["T_WHITESPACE"," ",154],"{",["T_WHITESPACE","\n      ",154],["T_COMMENT","\/\/ Create two nested transactions. Roll back from the inner one.\n",155],["T_WHITESPACE","      ",156],["T_VARIABLE","$this",156],["T_OBJECT_OPERATOR","->",156],["T_STRING","transactionOuterLayer",156],"(",["T_CONSTANT_ENCAPSED_STRING","'B'",156],",",["T_WHITESPACE"," ",156],["T_STRING","TRUE",156],")",";",["T_WHITESPACE","\n\n      ",156],["T_COMMENT","\/\/ Neither of the rows we inserted in the two transaction layers\n",158],["T_WHITESPACE","      ",159],["T_COMMENT","\/\/ should be present in the tables post-rollback.\n",159],["T_WHITESPACE","      ",160],["T_VARIABLE","$saved_age",160],["T_WHITESPACE"," ",160],"=",["T_WHITESPACE"," ",160],["T_STRING","db_query",160],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",160],",",["T_WHITESPACE"," ",160],["T_ARRAY","array",160],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",160],["T_WHITESPACE"," ",160],["T_DOUBLE_ARROW","=>",160],["T_WHITESPACE"," ",160],["T_CONSTANT_ENCAPSED_STRING","'DavidB'",160],")",")",["T_OBJECT_OPERATOR","->",160],["T_STRING","fetchField",160],"(",")",";",["T_WHITESPACE","\n      ",160],["T_VARIABLE","$this",161],["T_OBJECT_OPERATOR","->",161],["T_STRING","assertNotIdentical",161],"(",["T_VARIABLE","$saved_age",161],",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'24'",161],",",["T_WHITESPACE"," ",161],["T_CONSTANT_ENCAPSED_STRING","'Cannot retrieve DavidB row after commit.'",161],")",";",["T_WHITESPACE","\n      ",161],["T_VARIABLE","$saved_age",162],["T_WHITESPACE"," ",162],"=",["T_WHITESPACE"," ",162],["T_STRING","db_query",162],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",162],",",["T_WHITESPACE"," ",162],["T_ARRAY","array",162],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",162],["T_WHITESPACE"," ",162],["T_DOUBLE_ARROW","=>",162],["T_WHITESPACE"," ",162],["T_CONSTANT_ENCAPSED_STRING","'DanielB'",162],")",")",["T_OBJECT_OPERATOR","->",162],["T_STRING","fetchField",162],"(",")",";",["T_WHITESPACE","\n      ",162],["T_VARIABLE","$this",163],["T_OBJECT_OPERATOR","->",163],["T_STRING","assertNotIdentical",163],"(",["T_VARIABLE","$saved_age",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'19'",163],",",["T_WHITESPACE"," ",163],["T_CONSTANT_ENCAPSED_STRING","'Cannot retrieve DanielB row after commit.'",163],")",";",["T_WHITESPACE","\n    ",163],"}",["T_WHITESPACE","\n    ",164],["T_CATCH","catch",165],["T_WHITESPACE"," ",165],"(",["T_NS_SEPARATOR","\\",165],["T_STRING","Exception",165],["T_WHITESPACE"," ",165],["T_VARIABLE","$e",165],")",["T_WHITESPACE"," ",165],"{",["T_WHITESPACE","\n      ",165],["T_VARIABLE","$this",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","fail",166],"(",["T_VARIABLE","$e",166],["T_OBJECT_OPERATOR","->",166],["T_STRING","getMessage",166],"(",")",")",";",["T_WHITESPACE","\n    ",166],"}",["T_WHITESPACE","\n  ",167],"}",["T_WHITESPACE","\n\n  ",168],["T_DOC_COMMENT","\/**\n   * Tests transaction rollback on a database that doesn't support transactions.\n   *\n   * If the active driver supports transactions, this test does nothing.\n   *\/",170],["T_WHITESPACE","\n  ",174],["T_FUNCTION","function",175],["T_WHITESPACE"," ",175],["T_STRING","testTransactionRollBackNotSupported",175],"(",")",["T_WHITESPACE"," ",175],"{",["T_WHITESPACE","\n    ",175],["T_COMMENT","\/\/ This test won't work right if transactions are supported.\n",176],["T_WHITESPACE","    ",177],["T_IF","if",177],["T_WHITESPACE"," ",177],"(",["T_STRING","Database",177],["T_DOUBLE_COLON","::",177],["T_STRING","getConnection",177],"(",")",["T_OBJECT_OPERATOR","->",177],["T_STRING","supportsTransactions",177],"(",")",")",["T_WHITESPACE"," ",177],"{",["T_WHITESPACE","\n      ",177],["T_RETURN","return",178],";",["T_WHITESPACE","\n    ",178],"}",["T_WHITESPACE","\n    ",179],["T_TRY","try",180],["T_WHITESPACE"," ",180],"{",["T_WHITESPACE","\n      ",180],["T_COMMENT","\/\/ Create two nested transactions. Attempt to roll back from the inner one.\n",181],["T_WHITESPACE","      ",182],["T_VARIABLE","$this",182],["T_OBJECT_OPERATOR","->",182],["T_STRING","transactionOuterLayer",182],"(",["T_CONSTANT_ENCAPSED_STRING","'B'",182],",",["T_WHITESPACE"," ",182],["T_STRING","TRUE",182],")",";",["T_WHITESPACE","\n\n      ",182],["T_COMMENT","\/\/ Because our current database claims to not support transactions,\n",184],["T_WHITESPACE","      ",185],["T_COMMENT","\/\/ the inserted rows should be present despite the attempt to roll back.\n",185],["T_WHITESPACE","      ",186],["T_VARIABLE","$saved_age",186],["T_WHITESPACE"," ",186],"=",["T_WHITESPACE"," ",186],["T_STRING","db_query",186],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",186],",",["T_WHITESPACE"," ",186],["T_ARRAY","array",186],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",186],["T_WHITESPACE"," ",186],["T_DOUBLE_ARROW","=>",186],["T_WHITESPACE"," ",186],["T_CONSTANT_ENCAPSED_STRING","'DavidB'",186],")",")",["T_OBJECT_OPERATOR","->",186],["T_STRING","fetchField",186],"(",")",";",["T_WHITESPACE","\n      ",186],["T_VARIABLE","$this",187],["T_OBJECT_OPERATOR","->",187],["T_STRING","assertIdentical",187],"(",["T_VARIABLE","$saved_age",187],",",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'24'",187],",",["T_WHITESPACE"," ",187],["T_CONSTANT_ENCAPSED_STRING","'DavidB not rolled back, since transactions are not supported.'",187],")",";",["T_WHITESPACE","\n      ",187],["T_VARIABLE","$saved_age",188],["T_WHITESPACE"," ",188],"=",["T_WHITESPACE"," ",188],["T_STRING","db_query",188],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",188],",",["T_WHITESPACE"," ",188],["T_ARRAY","array",188],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",188],["T_WHITESPACE"," ",188],["T_DOUBLE_ARROW","=>",188],["T_WHITESPACE"," ",188],["T_CONSTANT_ENCAPSED_STRING","'DanielB'",188],")",")",["T_OBJECT_OPERATOR","->",188],["T_STRING","fetchField",188],"(",")",";",["T_WHITESPACE","\n      ",188],["T_VARIABLE","$this",189],["T_OBJECT_OPERATOR","->",189],["T_STRING","assertIdentical",189],"(",["T_VARIABLE","$saved_age",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'19'",189],",",["T_WHITESPACE"," ",189],["T_CONSTANT_ENCAPSED_STRING","'DanielB not rolled back, since transactions are not supported.'",189],")",";",["T_WHITESPACE","\n    ",189],"}",["T_WHITESPACE","\n    ",190],["T_CATCH","catch",191],["T_WHITESPACE"," ",191],"(",["T_NS_SEPARATOR","\\",191],["T_STRING","Exception",191],["T_WHITESPACE"," ",191],["T_VARIABLE","$e",191],")",["T_WHITESPACE"," ",191],"{",["T_WHITESPACE","\n      ",191],["T_VARIABLE","$this",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","fail",192],"(",["T_VARIABLE","$e",192],["T_OBJECT_OPERATOR","->",192],["T_STRING","getMessage",192],"(",")",")",";",["T_WHITESPACE","\n    ",192],"}",["T_WHITESPACE","\n  ",193],"}",["T_WHITESPACE","\n\n  ",194],["T_DOC_COMMENT","\/**\n   * Tests a committed transaction.\n   *\n   * The behavior of this test should be identical for connections that support\n   * transactions and those that do not.\n   *\/",196],["T_WHITESPACE","\n  ",201],["T_FUNCTION","function",202],["T_WHITESPACE"," ",202],["T_STRING","testCommittedTransaction",202],"(",")",["T_WHITESPACE"," ",202],"{",["T_WHITESPACE","\n    ",202],["T_TRY","try",203],["T_WHITESPACE"," ",203],"{",["T_WHITESPACE","\n      ",203],["T_COMMENT","\/\/ Create two nested transactions. The changes should be committed.\n",204],["T_WHITESPACE","      ",205],["T_VARIABLE","$this",205],["T_OBJECT_OPERATOR","->",205],["T_STRING","transactionOuterLayer",205],"(",["T_CONSTANT_ENCAPSED_STRING","'A'",205],")",";",["T_WHITESPACE","\n\n      ",205],["T_COMMENT","\/\/ Because we committed, both of the inserted rows should be present.\n",207],["T_WHITESPACE","      ",208],["T_VARIABLE","$saved_age",208],["T_WHITESPACE"," ",208],"=",["T_WHITESPACE"," ",208],["T_STRING","db_query",208],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",208],",",["T_WHITESPACE"," ",208],["T_ARRAY","array",208],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",208],["T_WHITESPACE"," ",208],["T_DOUBLE_ARROW","=>",208],["T_WHITESPACE"," ",208],["T_CONSTANT_ENCAPSED_STRING","'DavidA'",208],")",")",["T_OBJECT_OPERATOR","->",208],["T_STRING","fetchField",208],"(",")",";",["T_WHITESPACE","\n      ",208],["T_VARIABLE","$this",209],["T_OBJECT_OPERATOR","->",209],["T_STRING","assertIdentical",209],"(",["T_VARIABLE","$saved_age",209],",",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'24'",209],",",["T_WHITESPACE"," ",209],["T_CONSTANT_ENCAPSED_STRING","'Can retrieve DavidA row after commit.'",209],")",";",["T_WHITESPACE","\n      ",209],["T_VARIABLE","$saved_age",210],["T_WHITESPACE"," ",210],"=",["T_WHITESPACE"," ",210],["T_STRING","db_query",210],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",210],",",["T_WHITESPACE"," ",210],["T_ARRAY","array",210],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",210],["T_WHITESPACE"," ",210],["T_DOUBLE_ARROW","=>",210],["T_WHITESPACE"," ",210],["T_CONSTANT_ENCAPSED_STRING","'DanielA'",210],")",")",["T_OBJECT_OPERATOR","->",210],["T_STRING","fetchField",210],"(",")",";",["T_WHITESPACE","\n      ",210],["T_VARIABLE","$this",211],["T_OBJECT_OPERATOR","->",211],["T_STRING","assertIdentical",211],"(",["T_VARIABLE","$saved_age",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'19'",211],",",["T_WHITESPACE"," ",211],["T_CONSTANT_ENCAPSED_STRING","'Can retrieve DanielA row after commit.'",211],")",";",["T_WHITESPACE","\n    ",211],"}",["T_WHITESPACE","\n    ",212],["T_CATCH","catch",213],["T_WHITESPACE"," ",213],"(",["T_NS_SEPARATOR","\\",213],["T_STRING","Exception",213],["T_WHITESPACE"," ",213],["T_VARIABLE","$e",213],")",["T_WHITESPACE"," ",213],"{",["T_WHITESPACE","\n      ",213],["T_VARIABLE","$this",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","fail",214],"(",["T_VARIABLE","$e",214],["T_OBJECT_OPERATOR","->",214],["T_STRING","getMessage",214],"(",")",")",";",["T_WHITESPACE","\n    ",214],"}",["T_WHITESPACE","\n  ",215],"}",["T_WHITESPACE","\n\n  ",216],["T_DOC_COMMENT","\/**\n   * Tests the compatibility of transactions with DDL statements.\n   *\/",218],["T_WHITESPACE","\n  ",220],["T_FUNCTION","function",221],["T_WHITESPACE"," ",221],["T_STRING","testTransactionWithDdlStatement",221],"(",")",["T_WHITESPACE"," ",221],"{",["T_WHITESPACE","\n    ",221],["T_COMMENT","\/\/ First, test that a commit works normally, even with DDL statements.\n",222],["T_WHITESPACE","    ",223],["T_VARIABLE","$transaction",223],["T_WHITESPACE"," ",223],"=",["T_WHITESPACE"," ",223],["T_STRING","db_transaction",223],"(",")",";",["T_WHITESPACE","\n    ",223],["T_VARIABLE","$this",224],["T_OBJECT_OPERATOR","->",224],["T_STRING","insertRow",224],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",224],")",";",["T_WHITESPACE","\n    ",224],["T_VARIABLE","$this",225],["T_OBJECT_OPERATOR","->",225],["T_STRING","executeDDLStatement",225],"(",")",";",["T_WHITESPACE","\n    ",225],["T_UNSET","unset",226],"(",["T_VARIABLE","$transaction",226],")",";",["T_WHITESPACE","\n    ",226],["T_VARIABLE","$this",227],["T_OBJECT_OPERATOR","->",227],["T_STRING","assertRowPresent",227],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",227],")",";",["T_WHITESPACE","\n\n    ",227],["T_COMMENT","\/\/ Even in different order.\n",229],["T_WHITESPACE","    ",230],["T_VARIABLE","$this",230],["T_OBJECT_OPERATOR","->",230],["T_STRING","cleanUp",230],"(",")",";",["T_WHITESPACE","\n    ",230],["T_VARIABLE","$transaction",231],["T_WHITESPACE"," ",231],"=",["T_WHITESPACE"," ",231],["T_STRING","db_transaction",231],"(",")",";",["T_WHITESPACE","\n    ",231],["T_VARIABLE","$this",232],["T_OBJECT_OPERATOR","->",232],["T_STRING","executeDDLStatement",232],"(",")",";",["T_WHITESPACE","\n    ",232],["T_VARIABLE","$this",233],["T_OBJECT_OPERATOR","->",233],["T_STRING","insertRow",233],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",233],")",";",["T_WHITESPACE","\n    ",233],["T_UNSET","unset",234],"(",["T_VARIABLE","$transaction",234],")",";",["T_WHITESPACE","\n    ",234],["T_VARIABLE","$this",235],["T_OBJECT_OPERATOR","->",235],["T_STRING","assertRowPresent",235],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",235],")",";",["T_WHITESPACE","\n\n    ",235],["T_COMMENT","\/\/ Even with stacking.\n",237],["T_WHITESPACE","    ",238],["T_VARIABLE","$this",238],["T_OBJECT_OPERATOR","->",238],["T_STRING","cleanUp",238],"(",")",";",["T_WHITESPACE","\n    ",238],["T_VARIABLE","$transaction",239],["T_WHITESPACE"," ",239],"=",["T_WHITESPACE"," ",239],["T_STRING","db_transaction",239],"(",")",";",["T_WHITESPACE","\n    ",239],["T_VARIABLE","$transaction2",240],["T_WHITESPACE"," ",240],"=",["T_WHITESPACE"," ",240],["T_STRING","db_transaction",240],"(",")",";",["T_WHITESPACE","\n    ",240],["T_VARIABLE","$this",241],["T_OBJECT_OPERATOR","->",241],["T_STRING","executeDDLStatement",241],"(",")",";",["T_WHITESPACE","\n    ",241],["T_UNSET","unset",242],"(",["T_VARIABLE","$transaction2",242],")",";",["T_WHITESPACE","\n    ",242],["T_VARIABLE","$transaction3",243],["T_WHITESPACE"," ",243],"=",["T_WHITESPACE"," ",243],["T_STRING","db_transaction",243],"(",")",";",["T_WHITESPACE","\n    ",243],["T_VARIABLE","$this",244],["T_OBJECT_OPERATOR","->",244],["T_STRING","insertRow",244],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",244],")",";",["T_WHITESPACE","\n    ",244],["T_UNSET","unset",245],"(",["T_VARIABLE","$transaction3",245],")",";",["T_WHITESPACE","\n    ",245],["T_UNSET","unset",246],"(",["T_VARIABLE","$transaction",246],")",";",["T_WHITESPACE","\n    ",246],["T_VARIABLE","$this",247],["T_OBJECT_OPERATOR","->",247],["T_STRING","assertRowPresent",247],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",247],")",";",["T_WHITESPACE","\n\n    ",247],["T_COMMENT","\/\/ A transaction after a DDL statement should still work the same.\n",249],["T_WHITESPACE","    ",250],["T_VARIABLE","$this",250],["T_OBJECT_OPERATOR","->",250],["T_STRING","cleanUp",250],"(",")",";",["T_WHITESPACE","\n    ",250],["T_VARIABLE","$transaction",251],["T_WHITESPACE"," ",251],"=",["T_WHITESPACE"," ",251],["T_STRING","db_transaction",251],"(",")",";",["T_WHITESPACE","\n    ",251],["T_VARIABLE","$transaction2",252],["T_WHITESPACE"," ",252],"=",["T_WHITESPACE"," ",252],["T_STRING","db_transaction",252],"(",")",";",["T_WHITESPACE","\n    ",252],["T_VARIABLE","$this",253],["T_OBJECT_OPERATOR","->",253],["T_STRING","executeDDLStatement",253],"(",")",";",["T_WHITESPACE","\n    ",253],["T_UNSET","unset",254],"(",["T_VARIABLE","$transaction2",254],")",";",["T_WHITESPACE","\n    ",254],["T_VARIABLE","$transaction3",255],["T_WHITESPACE"," ",255],"=",["T_WHITESPACE"," ",255],["T_STRING","db_transaction",255],"(",")",";",["T_WHITESPACE","\n    ",255],["T_VARIABLE","$this",256],["T_OBJECT_OPERATOR","->",256],["T_STRING","insertRow",256],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",256],")",";",["T_WHITESPACE","\n    ",256],["T_VARIABLE","$transaction3",257],["T_OBJECT_OPERATOR","->",257],["T_STRING","rollback",257],"(",")",";",["T_WHITESPACE","\n    ",257],["T_UNSET","unset",258],"(",["T_VARIABLE","$transaction3",258],")",";",["T_WHITESPACE","\n    ",258],["T_UNSET","unset",259],"(",["T_VARIABLE","$transaction",259],")",";",["T_WHITESPACE","\n    ",259],["T_VARIABLE","$this",260],["T_OBJECT_OPERATOR","->",260],["T_STRING","assertRowAbsent",260],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",260],")",";",["T_WHITESPACE","\n\n    ",260],["T_COMMENT","\/\/ The behavior of a rollback depends on the type of database server.\n",262],["T_WHITESPACE","    ",263],["T_IF","if",263],["T_WHITESPACE"," ",263],"(",["T_STRING","Database",263],["T_DOUBLE_COLON","::",263],["T_STRING","getConnection",263],"(",")",["T_OBJECT_OPERATOR","->",263],["T_STRING","supportsTransactionalDDL",263],"(",")",")",["T_WHITESPACE"," ",263],"{",["T_WHITESPACE","\n      ",263],["T_COMMENT","\/\/ For database servers that support transactional DDL, a rollback\n",264],["T_WHITESPACE","      ",265],["T_COMMENT","\/\/ of a transaction including DDL statements should be possible.\n",265],["T_WHITESPACE","      ",266],["T_VARIABLE","$this",266],["T_OBJECT_OPERATOR","->",266],["T_STRING","cleanUp",266],"(",")",";",["T_WHITESPACE","\n      ",266],["T_VARIABLE","$transaction",267],["T_WHITESPACE"," ",267],"=",["T_WHITESPACE"," ",267],["T_STRING","db_transaction",267],"(",")",";",["T_WHITESPACE","\n      ",267],["T_VARIABLE","$this",268],["T_OBJECT_OPERATOR","->",268],["T_STRING","insertRow",268],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",268],")",";",["T_WHITESPACE","\n      ",268],["T_VARIABLE","$this",269],["T_OBJECT_OPERATOR","->",269],["T_STRING","executeDDLStatement",269],"(",")",";",["T_WHITESPACE","\n      ",269],["T_VARIABLE","$transaction",270],["T_OBJECT_OPERATOR","->",270],["T_STRING","rollback",270],"(",")",";",["T_WHITESPACE","\n      ",270],["T_UNSET","unset",271],"(",["T_VARIABLE","$transaction",271],")",";",["T_WHITESPACE","\n      ",271],["T_VARIABLE","$this",272],["T_OBJECT_OPERATOR","->",272],["T_STRING","assertRowAbsent",272],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",272],")",";",["T_WHITESPACE","\n\n      ",272],["T_COMMENT","\/\/ Including with stacking.\n",274],["T_WHITESPACE","      ",275],["T_VARIABLE","$this",275],["T_OBJECT_OPERATOR","->",275],["T_STRING","cleanUp",275],"(",")",";",["T_WHITESPACE","\n      ",275],["T_VARIABLE","$transaction",276],["T_WHITESPACE"," ",276],"=",["T_WHITESPACE"," ",276],["T_STRING","db_transaction",276],"(",")",";",["T_WHITESPACE","\n      ",276],["T_VARIABLE","$transaction2",277],["T_WHITESPACE"," ",277],"=",["T_WHITESPACE"," ",277],["T_STRING","db_transaction",277],"(",")",";",["T_WHITESPACE","\n      ",277],["T_VARIABLE","$this",278],["T_OBJECT_OPERATOR","->",278],["T_STRING","executeDDLStatement",278],"(",")",";",["T_WHITESPACE","\n      ",278],["T_UNSET","unset",279],"(",["T_VARIABLE","$transaction2",279],")",";",["T_WHITESPACE","\n      ",279],["T_VARIABLE","$transaction3",280],["T_WHITESPACE"," ",280],"=",["T_WHITESPACE"," ",280],["T_STRING","db_transaction",280],"(",")",";",["T_WHITESPACE","\n      ",280],["T_VARIABLE","$this",281],["T_OBJECT_OPERATOR","->",281],["T_STRING","insertRow",281],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",281],")",";",["T_WHITESPACE","\n      ",281],["T_UNSET","unset",282],"(",["T_VARIABLE","$transaction3",282],")",";",["T_WHITESPACE","\n      ",282],["T_VARIABLE","$transaction",283],["T_OBJECT_OPERATOR","->",283],["T_STRING","rollback",283],"(",")",";",["T_WHITESPACE","\n      ",283],["T_UNSET","unset",284],"(",["T_VARIABLE","$transaction",284],")",";",["T_WHITESPACE","\n      ",284],["T_VARIABLE","$this",285],["T_OBJECT_OPERATOR","->",285],["T_STRING","assertRowAbsent",285],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",285],")",";",["T_WHITESPACE","\n    ",285],"}",["T_WHITESPACE","\n    ",286],["T_ELSE","else",287],["T_WHITESPACE"," ",287],"{",["T_WHITESPACE","\n      ",287],["T_COMMENT","\/\/ For database servers that do not support transactional DDL,\n",288],["T_WHITESPACE","      ",289],["T_COMMENT","\/\/ the DDL statement should commit the transaction stack.\n",289],["T_WHITESPACE","      ",290],["T_VARIABLE","$this",290],["T_OBJECT_OPERATOR","->",290],["T_STRING","cleanUp",290],"(",")",";",["T_WHITESPACE","\n      ",290],["T_VARIABLE","$transaction",291],["T_WHITESPACE"," ",291],"=",["T_WHITESPACE"," ",291],["T_STRING","db_transaction",291],"(",")",";",["T_WHITESPACE","\n      ",291],["T_VARIABLE","$this",292],["T_OBJECT_OPERATOR","->",292],["T_STRING","insertRow",292],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",292],")",";",["T_WHITESPACE","\n      ",292],["T_VARIABLE","$this",293],["T_OBJECT_OPERATOR","->",293],["T_STRING","executeDDLStatement",293],"(",")",";",["T_WHITESPACE","\n      ",293],["T_COMMENT","\/\/ Rollback the outer transaction.\n",294],["T_WHITESPACE","      ",295],["T_TRY","try",295],["T_WHITESPACE"," ",295],"{",["T_WHITESPACE","\n        ",295],["T_VARIABLE","$transaction",296],["T_OBJECT_OPERATOR","->",296],["T_STRING","rollback",296],"(",")",";",["T_WHITESPACE","\n        ",296],["T_UNSET","unset",297],"(",["T_VARIABLE","$transaction",297],")",";",["T_WHITESPACE","\n        ",297],["T_COMMENT","\/\/ @TODO: an exception should be triggered here, but is not, because\n",298],["T_WHITESPACE","        ",299],["T_COMMENT","\/\/ \"ROLLBACK\" fails silently in MySQL if there is no transaction active.\n",299],["T_WHITESPACE","        ",300],["T_COMMENT","\/\/ $this->fail(t('Rolling back a transaction containing DDL should fail.'));\n",300],["T_WHITESPACE","      ",301],"}",["T_WHITESPACE","\n      ",301],["T_CATCH","catch",302],["T_WHITESPACE"," ",302],"(",["T_STRING","TransactionNoActiveException",302],["T_WHITESPACE"," ",302],["T_VARIABLE","$e",302],")",["T_WHITESPACE"," ",302],"{",["T_WHITESPACE","\n        ",302],["T_VARIABLE","$this",303],["T_OBJECT_OPERATOR","->",303],["T_STRING","pass",303],"(",["T_CONSTANT_ENCAPSED_STRING","'Rolling back a transaction containing DDL should fail.'",303],")",";",["T_WHITESPACE","\n      ",303],"}",["T_WHITESPACE","\n      ",304],["T_VARIABLE","$this",305],["T_OBJECT_OPERATOR","->",305],["T_STRING","assertRowPresent",305],"(",["T_CONSTANT_ENCAPSED_STRING","'row'",305],")",";",["T_WHITESPACE","\n    ",305],"}",["T_WHITESPACE","\n  ",306],"}",["T_WHITESPACE","\n\n  ",307],["T_DOC_COMMENT","\/**\n   * Inserts a single row into the testing table.\n   *\/",309],["T_WHITESPACE","\n  ",311],["T_PROTECTED","protected",312],["T_WHITESPACE"," ",312],["T_FUNCTION","function",312],["T_WHITESPACE"," ",312],["T_STRING","insertRow",312],"(",["T_VARIABLE","$name",312],")",["T_WHITESPACE"," ",312],"{",["T_WHITESPACE","\n    ",312],["T_STRING","db_insert",313],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",313],")",["T_WHITESPACE","\n      ",313],["T_OBJECT_OPERATOR","->",314],["T_STRING","fields",314],"(",["T_ARRAY","array",314],"(",["T_WHITESPACE","\n        ",314],["T_CONSTANT_ENCAPSED_STRING","'name'",315],["T_WHITESPACE"," ",315],["T_DOUBLE_ARROW","=>",315],["T_WHITESPACE"," ",315],["T_VARIABLE","$name",315],",",["T_WHITESPACE","\n      ",315],")",")",["T_WHITESPACE","\n      ",316],["T_OBJECT_OPERATOR","->",317],["T_STRING","execute",317],"(",")",";",["T_WHITESPACE","\n  ",317],"}",["T_WHITESPACE","\n\n  ",318],["T_DOC_COMMENT","\/**\n   * Executes a DDL statement.\n   *\/",320],["T_WHITESPACE","\n  ",322],["T_PROTECTED","protected",323],["T_WHITESPACE"," ",323],["T_FUNCTION","function",323],["T_WHITESPACE"," ",323],["T_STRING","executeDDLStatement",323],"(",")",["T_WHITESPACE"," ",323],"{",["T_WHITESPACE","\n    ",323],["T_STATIC","static",324],["T_WHITESPACE"," ",324],["T_VARIABLE","$count",324],["T_WHITESPACE"," ",324],"=",["T_WHITESPACE"," ",324],["T_LNUMBER","0",324],";",["T_WHITESPACE","\n    ",324],["T_VARIABLE","$table",325],["T_WHITESPACE"," ",325],"=",["T_WHITESPACE"," ",325],["T_ARRAY","array",325],"(",["T_WHITESPACE","\n      ",325],["T_CONSTANT_ENCAPSED_STRING","'fields'",326],["T_WHITESPACE"," ",326],["T_DOUBLE_ARROW","=>",326],["T_WHITESPACE"," ",326],["T_ARRAY","array",326],"(",["T_WHITESPACE","\n        ",326],["T_CONSTANT_ENCAPSED_STRING","'id'",327],["T_WHITESPACE"," ",327],["T_DOUBLE_ARROW","=>",327],["T_WHITESPACE"," ",327],["T_ARRAY","array",327],"(",["T_WHITESPACE","\n          ",327],["T_CONSTANT_ENCAPSED_STRING","'type'",328],["T_WHITESPACE"," ",328],["T_DOUBLE_ARROW","=>",328],["T_WHITESPACE"," ",328],["T_CONSTANT_ENCAPSED_STRING","'serial'",328],",",["T_WHITESPACE","\n          ",328],["T_CONSTANT_ENCAPSED_STRING","'unsigned'",329],["T_WHITESPACE"," ",329],["T_DOUBLE_ARROW","=>",329],["T_WHITESPACE"," ",329],["T_STRING","TRUE",329],",",["T_WHITESPACE","\n          ",329],["T_CONSTANT_ENCAPSED_STRING","'not null'",330],["T_WHITESPACE"," ",330],["T_DOUBLE_ARROW","=>",330],["T_WHITESPACE"," ",330],["T_STRING","TRUE",330],",",["T_WHITESPACE","\n        ",330],")",",",["T_WHITESPACE","\n      ",331],")",",",["T_WHITESPACE","\n      ",332],["T_CONSTANT_ENCAPSED_STRING","'primary key'",333],["T_WHITESPACE"," ",333],["T_DOUBLE_ARROW","=>",333],["T_WHITESPACE"," ",333],["T_ARRAY","array",333],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",333],")",",",["T_WHITESPACE","\n    ",333],")",";",["T_WHITESPACE","\n    ",334],["T_STRING","db_create_table",335],"(",["T_CONSTANT_ENCAPSED_STRING","'database_test_'",335],["T_WHITESPACE"," ",335],".",["T_WHITESPACE"," ",335],["T_INC","++",335],["T_VARIABLE","$count",335],",",["T_WHITESPACE"," ",335],["T_VARIABLE","$table",335],")",";",["T_WHITESPACE","\n  ",335],"}",["T_WHITESPACE","\n\n  ",336],["T_DOC_COMMENT","\/**\n   * Starts over for a new test.\n   *\/",338],["T_WHITESPACE","\n  ",340],["T_PROTECTED","protected",341],["T_WHITESPACE"," ",341],["T_FUNCTION","function",341],["T_WHITESPACE"," ",341],["T_STRING","cleanUp",341],"(",")",["T_WHITESPACE"," ",341],"{",["T_WHITESPACE","\n    ",341],["T_STRING","db_truncate",342],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",342],")",["T_WHITESPACE","\n      ",342],["T_OBJECT_OPERATOR","->",343],["T_STRING","execute",343],"(",")",";",["T_WHITESPACE","\n  ",343],"}",["T_WHITESPACE","\n\n  ",344],["T_DOC_COMMENT","\/**\n   * Asserts that a given row is present in the test table.\n   *\n   * @param $name\n   *   The name of the row.\n   * @param $message\n   *   The message to log for the assertion.\n   *\/",346],["T_WHITESPACE","\n  ",353],["T_FUNCTION","function",354],["T_WHITESPACE"," ",354],["T_STRING","assertRowPresent",354],"(",["T_VARIABLE","$name",354],",",["T_WHITESPACE"," ",354],["T_VARIABLE","$message",354],["T_WHITESPACE"," ",354],"=",["T_WHITESPACE"," ",354],["T_STRING","NULL",354],")",["T_WHITESPACE"," ",354],"{",["T_WHITESPACE","\n    ",354],["T_IF","if",355],["T_WHITESPACE"," ",355],"(","!",["T_ISSET","isset",355],"(",["T_VARIABLE","$message",355],")",")",["T_WHITESPACE"," ",355],"{",["T_WHITESPACE","\n      ",355],["T_VARIABLE","$message",356],["T_WHITESPACE"," ",356],"=",["T_WHITESPACE"," ",356],["T_STRING","format_string",356],"(",["T_CONSTANT_ENCAPSED_STRING","'Row %name is present.'",356],",",["T_WHITESPACE"," ",356],["T_ARRAY","array",356],"(",["T_CONSTANT_ENCAPSED_STRING","'%name'",356],["T_WHITESPACE"," ",356],["T_DOUBLE_ARROW","=>",356],["T_WHITESPACE"," ",356],["T_VARIABLE","$name",356],")",")",";",["T_WHITESPACE","\n    ",356],"}",["T_WHITESPACE","\n    ",357],["T_VARIABLE","$present",358],["T_WHITESPACE"," ",358],"=",["T_WHITESPACE"," ",358],["T_BOOL_CAST","(boolean)",358],["T_WHITESPACE"," ",358],["T_STRING","db_query",358],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT 1 FROM {test} WHERE name = :name'",358],",",["T_WHITESPACE"," ",358],["T_ARRAY","array",358],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",358],["T_WHITESPACE"," ",358],["T_DOUBLE_ARROW","=>",358],["T_WHITESPACE"," ",358],["T_VARIABLE","$name",358],")",")",["T_OBJECT_OPERATOR","->",358],["T_STRING","fetchField",358],"(",")",";",["T_WHITESPACE","\n    ",358],["T_RETURN","return",359],["T_WHITESPACE"," ",359],["T_VARIABLE","$this",359],["T_OBJECT_OPERATOR","->",359],["T_STRING","assertTrue",359],"(",["T_VARIABLE","$present",359],",",["T_WHITESPACE"," ",359],["T_VARIABLE","$message",359],")",";",["T_WHITESPACE","\n  ",359],"}",["T_WHITESPACE","\n\n  ",360],["T_DOC_COMMENT","\/**\n   * Asserts that a given row is absent from the test table.\n   *\n   * @param $name\n   *   The name of the row.\n   * @param $message\n   *   The message to log for the assertion.\n   *\/",362],["T_WHITESPACE","\n  ",369],["T_FUNCTION","function",370],["T_WHITESPACE"," ",370],["T_STRING","assertRowAbsent",370],"(",["T_VARIABLE","$name",370],",",["T_WHITESPACE"," ",370],["T_VARIABLE","$message",370],["T_WHITESPACE"," ",370],"=",["T_WHITESPACE"," ",370],["T_STRING","NULL",370],")",["T_WHITESPACE"," ",370],"{",["T_WHITESPACE","\n    ",370],["T_IF","if",371],["T_WHITESPACE"," ",371],"(","!",["T_ISSET","isset",371],"(",["T_VARIABLE","$message",371],")",")",["T_WHITESPACE"," ",371],"{",["T_WHITESPACE","\n      ",371],["T_VARIABLE","$message",372],["T_WHITESPACE"," ",372],"=",["T_WHITESPACE"," ",372],["T_STRING","format_string",372],"(",["T_CONSTANT_ENCAPSED_STRING","'Row %name is absent.'",372],",",["T_WHITESPACE"," ",372],["T_ARRAY","array",372],"(",["T_CONSTANT_ENCAPSED_STRING","'%name'",372],["T_WHITESPACE"," ",372],["T_DOUBLE_ARROW","=>",372],["T_WHITESPACE"," ",372],["T_VARIABLE","$name",372],")",")",";",["T_WHITESPACE","\n    ",372],"}",["T_WHITESPACE","\n    ",373],["T_VARIABLE","$present",374],["T_WHITESPACE"," ",374],"=",["T_WHITESPACE"," ",374],["T_BOOL_CAST","(boolean)",374],["T_WHITESPACE"," ",374],["T_STRING","db_query",374],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT 1 FROM {test} WHERE name = :name'",374],",",["T_WHITESPACE"," ",374],["T_ARRAY","array",374],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",374],["T_WHITESPACE"," ",374],["T_DOUBLE_ARROW","=>",374],["T_WHITESPACE"," ",374],["T_VARIABLE","$name",374],")",")",["T_OBJECT_OPERATOR","->",374],["T_STRING","fetchField",374],"(",")",";",["T_WHITESPACE","\n    ",374],["T_RETURN","return",375],["T_WHITESPACE"," ",375],["T_VARIABLE","$this",375],["T_OBJECT_OPERATOR","->",375],["T_STRING","assertFalse",375],"(",["T_VARIABLE","$present",375],",",["T_WHITESPACE"," ",375],["T_VARIABLE","$message",375],")",";",["T_WHITESPACE","\n  ",375],"}",["T_WHITESPACE","\n\n  ",376],["T_DOC_COMMENT","\/**\n   * Tests transaction stacking, commit, and rollback.\n   *\/",378],["T_WHITESPACE","\n  ",380],["T_FUNCTION","function",381],["T_WHITESPACE"," ",381],["T_STRING","testTransactionStacking",381],"(",")",["T_WHITESPACE"," ",381],"{",["T_WHITESPACE","\n    ",381],["T_COMMENT","\/\/ This test won't work right if transactions are not supported.\n",382],["T_WHITESPACE","    ",383],["T_IF","if",383],["T_WHITESPACE"," ",383],"(","!",["T_STRING","Database",383],["T_DOUBLE_COLON","::",383],["T_STRING","getConnection",383],"(",")",["T_OBJECT_OPERATOR","->",383],["T_STRING","supportsTransactions",383],"(",")",")",["T_WHITESPACE"," ",383],"{",["T_WHITESPACE","\n      ",383],["T_RETURN","return",384],";",["T_WHITESPACE","\n    ",384],"}",["T_WHITESPACE","\n\n    ",385],["T_VARIABLE","$database",387],["T_WHITESPACE"," ",387],"=",["T_WHITESPACE"," ",387],["T_STRING","Database",387],["T_DOUBLE_COLON","::",387],["T_STRING","getConnection",387],"(",")",";",["T_WHITESPACE","\n\n    ",387],["T_COMMENT","\/\/ Standard case: pop the inner transaction before the outer transaction.\n",389],["T_WHITESPACE","    ",390],["T_VARIABLE","$transaction",390],["T_WHITESPACE"," ",390],"=",["T_WHITESPACE"," ",390],["T_STRING","db_transaction",390],"(",")",";",["T_WHITESPACE","\n    ",390],["T_VARIABLE","$this",391],["T_OBJECT_OPERATOR","->",391],["T_STRING","insertRow",391],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",391],")",";",["T_WHITESPACE","\n    ",391],["T_VARIABLE","$transaction2",392],["T_WHITESPACE"," ",392],"=",["T_WHITESPACE"," ",392],["T_STRING","db_transaction",392],"(",")",";",["T_WHITESPACE","\n    ",392],["T_VARIABLE","$this",393],["T_OBJECT_OPERATOR","->",393],["T_STRING","insertRow",393],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",393],")",";",["T_WHITESPACE","\n    ",393],["T_COMMENT","\/\/ Pop the inner transaction.\n",394],["T_WHITESPACE","    ",395],["T_UNSET","unset",395],"(",["T_VARIABLE","$transaction2",395],")",";",["T_WHITESPACE","\n    ",395],["T_VARIABLE","$this",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","assertTrue",396],"(",["T_VARIABLE","$database",396],["T_OBJECT_OPERATOR","->",396],["T_STRING","inTransaction",396],"(",")",",",["T_WHITESPACE"," ",396],["T_CONSTANT_ENCAPSED_STRING","'Still in a transaction after popping the inner transaction'",396],")",";",["T_WHITESPACE","\n    ",396],["T_COMMENT","\/\/ Pop the outer transaction.\n",397],["T_WHITESPACE","    ",398],["T_UNSET","unset",398],"(",["T_VARIABLE","$transaction",398],")",";",["T_WHITESPACE","\n    ",398],["T_VARIABLE","$this",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","assertFalse",399],"(",["T_VARIABLE","$database",399],["T_OBJECT_OPERATOR","->",399],["T_STRING","inTransaction",399],"(",")",",",["T_WHITESPACE"," ",399],["T_CONSTANT_ENCAPSED_STRING","'Transaction closed after popping the outer transaction'",399],")",";",["T_WHITESPACE","\n    ",399],["T_VARIABLE","$this",400],["T_OBJECT_OPERATOR","->",400],["T_STRING","assertRowPresent",400],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",400],")",";",["T_WHITESPACE","\n    ",400],["T_VARIABLE","$this",401],["T_OBJECT_OPERATOR","->",401],["T_STRING","assertRowPresent",401],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",401],")",";",["T_WHITESPACE","\n\n    ",401],["T_COMMENT","\/\/ Pop the transaction in a different order they have been pushed.\n",403],["T_WHITESPACE","    ",404],["T_VARIABLE","$this",404],["T_OBJECT_OPERATOR","->",404],["T_STRING","cleanUp",404],"(",")",";",["T_WHITESPACE","\n    ",404],["T_VARIABLE","$transaction",405],["T_WHITESPACE"," ",405],"=",["T_WHITESPACE"," ",405],["T_STRING","db_transaction",405],"(",")",";",["T_WHITESPACE","\n    ",405],["T_VARIABLE","$this",406],["T_OBJECT_OPERATOR","->",406],["T_STRING","insertRow",406],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",406],")",";",["T_WHITESPACE","\n    ",406],["T_VARIABLE","$transaction2",407],["T_WHITESPACE"," ",407],"=",["T_WHITESPACE"," ",407],["T_STRING","db_transaction",407],"(",")",";",["T_WHITESPACE","\n    ",407],["T_VARIABLE","$this",408],["T_OBJECT_OPERATOR","->",408],["T_STRING","insertRow",408],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",408],")",";",["T_WHITESPACE","\n    ",408],["T_COMMENT","\/\/ Pop the outer transaction, nothing should happen.\n",409],["T_WHITESPACE","    ",410],["T_UNSET","unset",410],"(",["T_VARIABLE","$transaction",410],")",";",["T_WHITESPACE","\n    ",410],["T_VARIABLE","$this",411],["T_OBJECT_OPERATOR","->",411],["T_STRING","insertRow",411],"(",["T_CONSTANT_ENCAPSED_STRING","'inner-after-outer-commit'",411],")",";",["T_WHITESPACE","\n    ",411],["T_VARIABLE","$this",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","assertTrue",412],"(",["T_VARIABLE","$database",412],["T_OBJECT_OPERATOR","->",412],["T_STRING","inTransaction",412],"(",")",",",["T_WHITESPACE"," ",412],["T_CONSTANT_ENCAPSED_STRING","'Still in a transaction after popping the outer transaction'",412],")",";",["T_WHITESPACE","\n    ",412],["T_COMMENT","\/\/ Pop the inner transaction, the whole transaction should commit.\n",413],["T_WHITESPACE","    ",414],["T_UNSET","unset",414],"(",["T_VARIABLE","$transaction2",414],")",";",["T_WHITESPACE","\n    ",414],["T_VARIABLE","$this",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","assertFalse",415],"(",["T_VARIABLE","$database",415],["T_OBJECT_OPERATOR","->",415],["T_STRING","inTransaction",415],"(",")",",",["T_WHITESPACE"," ",415],["T_CONSTANT_ENCAPSED_STRING","'Transaction closed after popping the inner transaction'",415],")",";",["T_WHITESPACE","\n    ",415],["T_VARIABLE","$this",416],["T_OBJECT_OPERATOR","->",416],["T_STRING","assertRowPresent",416],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",416],")",";",["T_WHITESPACE","\n    ",416],["T_VARIABLE","$this",417],["T_OBJECT_OPERATOR","->",417],["T_STRING","assertRowPresent",417],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",417],")",";",["T_WHITESPACE","\n    ",417],["T_VARIABLE","$this",418],["T_OBJECT_OPERATOR","->",418],["T_STRING","assertRowPresent",418],"(",["T_CONSTANT_ENCAPSED_STRING","'inner-after-outer-commit'",418],")",";",["T_WHITESPACE","\n\n    ",418],["T_COMMENT","\/\/ Rollback the inner transaction.\n",420],["T_WHITESPACE","    ",421],["T_VARIABLE","$this",421],["T_OBJECT_OPERATOR","->",421],["T_STRING","cleanUp",421],"(",")",";",["T_WHITESPACE","\n    ",421],["T_VARIABLE","$transaction",422],["T_WHITESPACE"," ",422],"=",["T_WHITESPACE"," ",422],["T_STRING","db_transaction",422],"(",")",";",["T_WHITESPACE","\n    ",422],["T_VARIABLE","$this",423],["T_OBJECT_OPERATOR","->",423],["T_STRING","insertRow",423],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",423],")",";",["T_WHITESPACE","\n    ",423],["T_VARIABLE","$transaction2",424],["T_WHITESPACE"," ",424],"=",["T_WHITESPACE"," ",424],["T_STRING","db_transaction",424],"(",")",";",["T_WHITESPACE","\n    ",424],["T_VARIABLE","$this",425],["T_OBJECT_OPERATOR","->",425],["T_STRING","insertRow",425],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",425],")",";",["T_WHITESPACE","\n    ",425],["T_COMMENT","\/\/ Now rollback the inner transaction.\n",426],["T_WHITESPACE","    ",427],["T_VARIABLE","$transaction2",427],["T_OBJECT_OPERATOR","->",427],["T_STRING","rollback",427],"(",")",";",["T_WHITESPACE","\n    ",427],["T_UNSET","unset",428],"(",["T_VARIABLE","$transaction2",428],")",";",["T_WHITESPACE","\n    ",428],["T_VARIABLE","$this",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","assertTrue",429],"(",["T_VARIABLE","$database",429],["T_OBJECT_OPERATOR","->",429],["T_STRING","inTransaction",429],"(",")",",",["T_WHITESPACE"," ",429],["T_CONSTANT_ENCAPSED_STRING","'Still in a transaction after popping the outer transaction'",429],")",";",["T_WHITESPACE","\n    ",429],["T_COMMENT","\/\/ Pop the outer transaction, it should commit.\n",430],["T_WHITESPACE","    ",431],["T_VARIABLE","$this",431],["T_OBJECT_OPERATOR","->",431],["T_STRING","insertRow",431],"(",["T_CONSTANT_ENCAPSED_STRING","'outer-after-inner-rollback'",431],")",";",["T_WHITESPACE","\n    ",431],["T_UNSET","unset",432],"(",["T_VARIABLE","$transaction",432],")",";",["T_WHITESPACE","\n    ",432],["T_VARIABLE","$this",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","assertFalse",433],"(",["T_VARIABLE","$database",433],["T_OBJECT_OPERATOR","->",433],["T_STRING","inTransaction",433],"(",")",",",["T_WHITESPACE"," ",433],["T_CONSTANT_ENCAPSED_STRING","'Transaction closed after popping the inner transaction'",433],")",";",["T_WHITESPACE","\n    ",433],["T_VARIABLE","$this",434],["T_OBJECT_OPERATOR","->",434],["T_STRING","assertRowPresent",434],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",434],")",";",["T_WHITESPACE","\n    ",434],["T_VARIABLE","$this",435],["T_OBJECT_OPERATOR","->",435],["T_STRING","assertRowAbsent",435],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",435],")",";",["T_WHITESPACE","\n    ",435],["T_VARIABLE","$this",436],["T_OBJECT_OPERATOR","->",436],["T_STRING","assertRowPresent",436],"(",["T_CONSTANT_ENCAPSED_STRING","'outer-after-inner-rollback'",436],")",";",["T_WHITESPACE","\n\n    ",436],["T_COMMENT","\/\/ Rollback the inner transaction after committing the outer one.\n",438],["T_WHITESPACE","    ",439],["T_VARIABLE","$this",439],["T_OBJECT_OPERATOR","->",439],["T_STRING","cleanUp",439],"(",")",";",["T_WHITESPACE","\n    ",439],["T_VARIABLE","$transaction",440],["T_WHITESPACE"," ",440],"=",["T_WHITESPACE"," ",440],["T_STRING","db_transaction",440],"(",")",";",["T_WHITESPACE","\n    ",440],["T_VARIABLE","$this",441],["T_OBJECT_OPERATOR","->",441],["T_STRING","insertRow",441],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",441],")",";",["T_WHITESPACE","\n    ",441],["T_VARIABLE","$transaction2",442],["T_WHITESPACE"," ",442],"=",["T_WHITESPACE"," ",442],["T_STRING","db_transaction",442],"(",")",";",["T_WHITESPACE","\n    ",442],["T_VARIABLE","$this",443],["T_OBJECT_OPERATOR","->",443],["T_STRING","insertRow",443],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",443],")",";",["T_WHITESPACE","\n    ",443],["T_COMMENT","\/\/ Pop the outer transaction, nothing should happen.\n",444],["T_WHITESPACE","    ",445],["T_UNSET","unset",445],"(",["T_VARIABLE","$transaction",445],")",";",["T_WHITESPACE","\n    ",445],["T_VARIABLE","$this",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","assertTrue",446],"(",["T_VARIABLE","$database",446],["T_OBJECT_OPERATOR","->",446],["T_STRING","inTransaction",446],"(",")",",",["T_WHITESPACE"," ",446],["T_CONSTANT_ENCAPSED_STRING","'Still in a transaction after popping the outer transaction'",446],")",";",["T_WHITESPACE","\n    ",446],["T_COMMENT","\/\/ Now rollback the inner transaction, it should rollback.\n",447],["T_WHITESPACE","    ",448],["T_VARIABLE","$transaction2",448],["T_OBJECT_OPERATOR","->",448],["T_STRING","rollback",448],"(",")",";",["T_WHITESPACE","\n    ",448],["T_UNSET","unset",449],"(",["T_VARIABLE","$transaction2",449],")",";",["T_WHITESPACE","\n    ",449],["T_VARIABLE","$this",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","assertFalse",450],"(",["T_VARIABLE","$database",450],["T_OBJECT_OPERATOR","->",450],["T_STRING","inTransaction",450],"(",")",",",["T_WHITESPACE"," ",450],["T_CONSTANT_ENCAPSED_STRING","'Transaction closed after popping the inner transaction'",450],")",";",["T_WHITESPACE","\n    ",450],["T_VARIABLE","$this",451],["T_OBJECT_OPERATOR","->",451],["T_STRING","assertRowPresent",451],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",451],")",";",["T_WHITESPACE","\n    ",451],["T_VARIABLE","$this",452],["T_OBJECT_OPERATOR","->",452],["T_STRING","assertRowAbsent",452],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",452],")",";",["T_WHITESPACE","\n\n    ",452],["T_COMMENT","\/\/ Rollback the outer transaction while the inner transaction is active.\n",454],["T_WHITESPACE","    ",455],["T_COMMENT","\/\/ In that case, an exception will be triggered because we cannot\n",455],["T_WHITESPACE","    ",456],["T_COMMENT","\/\/ ensure that the final result will have any meaning.\n",456],["T_WHITESPACE","    ",457],["T_VARIABLE","$this",457],["T_OBJECT_OPERATOR","->",457],["T_STRING","cleanUp",457],"(",")",";",["T_WHITESPACE","\n    ",457],["T_VARIABLE","$transaction",458],["T_WHITESPACE"," ",458],"=",["T_WHITESPACE"," ",458],["T_STRING","db_transaction",458],"(",")",";",["T_WHITESPACE","\n    ",458],["T_VARIABLE","$this",459],["T_OBJECT_OPERATOR","->",459],["T_STRING","insertRow",459],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",459],")",";",["T_WHITESPACE","\n    ",459],["T_VARIABLE","$transaction2",460],["T_WHITESPACE"," ",460],"=",["T_WHITESPACE"," ",460],["T_STRING","db_transaction",460],"(",")",";",["T_WHITESPACE","\n    ",460],["T_VARIABLE","$this",461],["T_OBJECT_OPERATOR","->",461],["T_STRING","insertRow",461],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",461],")",";",["T_WHITESPACE","\n    ",461],["T_VARIABLE","$transaction3",462],["T_WHITESPACE"," ",462],"=",["T_WHITESPACE"," ",462],["T_STRING","db_transaction",462],"(",")",";",["T_WHITESPACE","\n    ",462],["T_VARIABLE","$this",463],["T_OBJECT_OPERATOR","->",463],["T_STRING","insertRow",463],"(",["T_CONSTANT_ENCAPSED_STRING","'inner2'",463],")",";",["T_WHITESPACE","\n    ",463],["T_COMMENT","\/\/ Rollback the outer transaction.\n",464],["T_WHITESPACE","    ",465],["T_TRY","try",465],["T_WHITESPACE"," ",465],"{",["T_WHITESPACE","\n      ",465],["T_VARIABLE","$transaction",466],["T_OBJECT_OPERATOR","->",466],["T_STRING","rollback",466],"(",")",";",["T_WHITESPACE","\n      ",466],["T_UNSET","unset",467],"(",["T_VARIABLE","$transaction",467],")",";",["T_WHITESPACE","\n      ",467],["T_VARIABLE","$this",468],["T_OBJECT_OPERATOR","->",468],["T_STRING","fail",468],"(",["T_CONSTANT_ENCAPSED_STRING","'Rolling back the outer transaction while the inner transaction is active resulted in an exception.'",468],")",";",["T_WHITESPACE","\n    ",468],"}",["T_WHITESPACE","\n    ",469],["T_CATCH","catch",470],["T_WHITESPACE"," ",470],"(",["T_STRING","TransactionOutOfOrderException",470],["T_WHITESPACE"," ",470],["T_VARIABLE","$e",470],")",["T_WHITESPACE"," ",470],"{",["T_WHITESPACE","\n      ",470],["T_VARIABLE","$this",471],["T_OBJECT_OPERATOR","->",471],["T_STRING","pass",471],"(",["T_CONSTANT_ENCAPSED_STRING","'Rolling back the outer transaction while the inner transaction is active resulted in an exception.'",471],")",";",["T_WHITESPACE","\n    ",471],"}",["T_WHITESPACE","\n    ",472],["T_VARIABLE","$this",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","assertFalse",473],"(",["T_VARIABLE","$database",473],["T_OBJECT_OPERATOR","->",473],["T_STRING","inTransaction",473],"(",")",",",["T_WHITESPACE"," ",473],["T_CONSTANT_ENCAPSED_STRING","'No more in a transaction after rolling back the outer transaction'",473],")",";",["T_WHITESPACE","\n    ",473],["T_COMMENT","\/\/ Try to commit one inner transaction.\n",474],["T_WHITESPACE","    ",475],["T_UNSET","unset",475],"(",["T_VARIABLE","$transaction3",475],")",";",["T_WHITESPACE","\n    ",475],["T_VARIABLE","$this",476],["T_OBJECT_OPERATOR","->",476],["T_STRING","pass",476],"(",["T_CONSTANT_ENCAPSED_STRING","'Trying to commit an inner transaction resulted in an exception.'",476],")",";",["T_WHITESPACE","\n    ",476],["T_COMMENT","\/\/ Try to rollback one inner transaction.\n",477],["T_WHITESPACE","    ",478],["T_TRY","try",478],["T_WHITESPACE"," ",478],"{",["T_WHITESPACE","\n      ",478],["T_VARIABLE","$transaction",479],["T_OBJECT_OPERATOR","->",479],["T_STRING","rollback",479],"(",")",";",["T_WHITESPACE","\n      ",479],["T_UNSET","unset",480],"(",["T_VARIABLE","$transaction2",480],")",";",["T_WHITESPACE","\n      ",480],["T_VARIABLE","$this",481],["T_OBJECT_OPERATOR","->",481],["T_STRING","fail",481],"(",["T_CONSTANT_ENCAPSED_STRING","'Trying to commit an inner transaction resulted in an exception.'",481],")",";",["T_WHITESPACE","\n    ",481],"}",["T_WHITESPACE","\n    ",482],["T_CATCH","catch",483],["T_WHITESPACE"," ",483],"(",["T_STRING","TransactionNoActiveException",483],["T_WHITESPACE"," ",483],["T_VARIABLE","$e",483],")",["T_WHITESPACE"," ",483],"{",["T_WHITESPACE","\n      ",483],["T_VARIABLE","$this",484],["T_OBJECT_OPERATOR","->",484],["T_STRING","pass",484],"(",["T_CONSTANT_ENCAPSED_STRING","'Trying to commit an inner transaction resulted in an exception.'",484],")",";",["T_WHITESPACE","\n    ",484],"}",["T_WHITESPACE","\n    ",485],["T_VARIABLE","$this",486],["T_OBJECT_OPERATOR","->",486],["T_STRING","assertRowAbsent",486],"(",["T_CONSTANT_ENCAPSED_STRING","'outer'",486],")",";",["T_WHITESPACE","\n    ",486],["T_VARIABLE","$this",487],["T_OBJECT_OPERATOR","->",487],["T_STRING","assertRowAbsent",487],"(",["T_CONSTANT_ENCAPSED_STRING","'inner'",487],")",";",["T_WHITESPACE","\n    ",487],["T_VARIABLE","$this",488],["T_OBJECT_OPERATOR","->",488],["T_STRING","assertRowAbsent",488],"(",["T_CONSTANT_ENCAPSED_STRING","'inner2'",488],")",";",["T_WHITESPACE","\n  ",488],"}",["T_WHITESPACE","\n\n  ",489],["T_DOC_COMMENT","\/**\n   * Tests that transactions can continue to be used if a query fails.\n   *\/",491],["T_WHITESPACE","\n  ",493],["T_PUBLIC","public",494],["T_WHITESPACE"," ",494],["T_FUNCTION","function",494],["T_WHITESPACE"," ",494],["T_STRING","testQueryFailureInTransaction",494],"(",")",["T_WHITESPACE"," ",494],"{",["T_WHITESPACE","\n    ",494],["T_VARIABLE","$connection",495],["T_WHITESPACE"," ",495],"=",["T_WHITESPACE"," ",495],["T_STRING","Database",495],["T_DOUBLE_COLON","::",495],["T_STRING","getConnection",495],"(",")",";",["T_WHITESPACE","\n    ",495],["T_VARIABLE","$transaction",496],["T_WHITESPACE"," ",496],"=",["T_WHITESPACE"," ",496],["T_VARIABLE","$connection",496],["T_OBJECT_OPERATOR","->",496],["T_STRING","startTransaction",496],"(",["T_CONSTANT_ENCAPSED_STRING","'test_transaction'",496],")",";",["T_WHITESPACE","\n    ",496],["T_VARIABLE","$connection",497],["T_OBJECT_OPERATOR","->",497],["T_STRING","schema",497],"(",")",["T_OBJECT_OPERATOR","->",497],["T_STRING","dropTable",497],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",497],")",";",["T_WHITESPACE","\n\n    ",497],["T_COMMENT","\/\/ Test a failed query using the query() method.\n",499],["T_WHITESPACE","    ",500],["T_TRY","try",500],["T_WHITESPACE"," ",500],"{",["T_WHITESPACE","\n      ",500],["T_VARIABLE","$connection",501],["T_OBJECT_OPERATOR","->",501],["T_STRING","query",501],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",501],",",["T_WHITESPACE"," ",501],["T_ARRAY","array",501],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",501],["T_WHITESPACE"," ",501],["T_DOUBLE_ARROW","=>",501],["T_WHITESPACE"," ",501],["T_CONSTANT_ENCAPSED_STRING","'David'",501],")",")",["T_OBJECT_OPERATOR","->",501],["T_STRING","fetchField",501],"(",")",";",["T_WHITESPACE","\n      ",501],["T_VARIABLE","$this",502],["T_OBJECT_OPERATOR","->",502],["T_STRING","fail",502],"(",["T_CONSTANT_ENCAPSED_STRING","'Using the query method failed.'",502],")",";",["T_WHITESPACE","\n    ",502],"}",["T_WHITESPACE","\n    ",503],["T_CATCH","catch",504],["T_WHITESPACE"," ",504],"(",["T_NS_SEPARATOR","\\",504],["T_STRING","Exception",504],["T_WHITESPACE"," ",504],["T_VARIABLE","$e",504],")",["T_WHITESPACE"," ",504],"{",["T_WHITESPACE","\n      ",504],["T_VARIABLE","$this",505],["T_OBJECT_OPERATOR","->",505],["T_STRING","pass",505],"(",["T_CONSTANT_ENCAPSED_STRING","'Using the query method failed.'",505],")",";",["T_WHITESPACE","\n    ",505],"}",["T_WHITESPACE","\n\n    ",506],["T_COMMENT","\/\/ Test a failed select query.\n",508],["T_WHITESPACE","    ",509],["T_TRY","try",509],["T_WHITESPACE"," ",509],"{",["T_WHITESPACE","\n      ",509],["T_VARIABLE","$connection",510],["T_OBJECT_OPERATOR","->",510],["T_STRING","select",510],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",510],")",["T_WHITESPACE","\n        ",510],["T_OBJECT_OPERATOR","->",511],["T_STRING","fields",511],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",511],",",["T_WHITESPACE"," ",511],"[",["T_CONSTANT_ENCAPSED_STRING","'name'",511],"]",")",["T_WHITESPACE","\n        ",511],["T_OBJECT_OPERATOR","->",512],["T_STRING","execute",512],"(",")",";",["T_WHITESPACE","\n\n      ",512],["T_VARIABLE","$this",514],["T_OBJECT_OPERATOR","->",514],["T_STRING","fail",514],"(",["T_CONSTANT_ENCAPSED_STRING","'Select query failed.'",514],")",";",["T_WHITESPACE","\n    ",514],"}",["T_WHITESPACE","\n    ",515],["T_CATCH","catch",516],["T_WHITESPACE"," ",516],"(",["T_NS_SEPARATOR","\\",516],["T_STRING","Exception",516],["T_WHITESPACE"," ",516],["T_VARIABLE","$e",516],")",["T_WHITESPACE"," ",516],"{",["T_WHITESPACE","\n      ",516],["T_VARIABLE","$this",517],["T_OBJECT_OPERATOR","->",517],["T_STRING","pass",517],"(",["T_CONSTANT_ENCAPSED_STRING","'Select query failed.'",517],")",";",["T_WHITESPACE","\n    ",517],"}",["T_WHITESPACE","\n\n    ",518],["T_COMMENT","\/\/ Test a failed insert query.\n",520],["T_WHITESPACE","    ",521],["T_TRY","try",521],["T_WHITESPACE"," ",521],"{",["T_WHITESPACE","\n      ",521],["T_VARIABLE","$connection",522],["T_OBJECT_OPERATOR","->",522],["T_STRING","insert",522],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",522],")",["T_WHITESPACE","\n        ",522],["T_OBJECT_OPERATOR","->",523],["T_STRING","fields",523],"(","[",["T_WHITESPACE","\n          ",523],["T_CONSTANT_ENCAPSED_STRING","'name'",524],["T_WHITESPACE"," ",524],["T_DOUBLE_ARROW","=>",524],["T_WHITESPACE"," ",524],["T_CONSTANT_ENCAPSED_STRING","'David'",524],",",["T_WHITESPACE","\n          ",524],["T_CONSTANT_ENCAPSED_STRING","'age'",525],["T_WHITESPACE"," ",525],["T_DOUBLE_ARROW","=>",525],["T_WHITESPACE"," ",525],["T_CONSTANT_ENCAPSED_STRING","'24'",525],",",["T_WHITESPACE","\n        ",525],"]",")",["T_WHITESPACE","\n        ",526],["T_OBJECT_OPERATOR","->",527],["T_STRING","execute",527],"(",")",";",["T_WHITESPACE","\n\n      ",527],["T_VARIABLE","$this",529],["T_OBJECT_OPERATOR","->",529],["T_STRING","fail",529],"(",["T_CONSTANT_ENCAPSED_STRING","'Insert query failed.'",529],")",";",["T_WHITESPACE","\n    ",529],"}",["T_WHITESPACE","\n    ",530],["T_CATCH","catch",531],["T_WHITESPACE"," ",531],"(",["T_NS_SEPARATOR","\\",531],["T_STRING","Exception",531],["T_WHITESPACE"," ",531],["T_VARIABLE","$e",531],")",["T_WHITESPACE"," ",531],"{",["T_WHITESPACE","\n      ",531],["T_VARIABLE","$this",532],["T_OBJECT_OPERATOR","->",532],["T_STRING","pass",532],"(",["T_CONSTANT_ENCAPSED_STRING","'Insert query failed.'",532],")",";",["T_WHITESPACE","\n    ",532],"}",["T_WHITESPACE","\n\n    ",533],["T_COMMENT","\/\/ Test a failed update query.\n",535],["T_WHITESPACE","    ",536],["T_TRY","try",536],["T_WHITESPACE"," ",536],"{",["T_WHITESPACE","\n      ",536],["T_VARIABLE","$connection",537],["T_OBJECT_OPERATOR","->",537],["T_STRING","update",537],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",537],")",["T_WHITESPACE","\n        ",537],["T_OBJECT_OPERATOR","->",538],["T_STRING","fields",538],"(","[",["T_CONSTANT_ENCAPSED_STRING","'name'",538],["T_WHITESPACE"," ",538],["T_DOUBLE_ARROW","=>",538],["T_WHITESPACE"," ",538],["T_CONSTANT_ENCAPSED_STRING","'Tiffany'",538],"]",")",["T_WHITESPACE","\n        ",538],["T_OBJECT_OPERATOR","->",539],["T_STRING","condition",539],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",539],",",["T_WHITESPACE"," ",539],["T_LNUMBER","1",539],")",["T_WHITESPACE","\n        ",539],["T_OBJECT_OPERATOR","->",540],["T_STRING","execute",540],"(",")",";",["T_WHITESPACE","\n\n      ",540],["T_VARIABLE","$this",542],["T_OBJECT_OPERATOR","->",542],["T_STRING","fail",542],"(",["T_CONSTANT_ENCAPSED_STRING","'Update query failed.'",542],")",";",["T_WHITESPACE","\n    ",542],"}",["T_WHITESPACE","\n    ",543],["T_CATCH","catch",544],["T_WHITESPACE"," ",544],"(",["T_NS_SEPARATOR","\\",544],["T_STRING","Exception",544],["T_WHITESPACE"," ",544],["T_VARIABLE","$e",544],")",["T_WHITESPACE"," ",544],"{",["T_WHITESPACE","\n      ",544],["T_VARIABLE","$this",545],["T_OBJECT_OPERATOR","->",545],["T_STRING","pass",545],"(",["T_CONSTANT_ENCAPSED_STRING","'Update query failed.'",545],")",";",["T_WHITESPACE","\n    ",545],"}",["T_WHITESPACE","\n\n    ",546],["T_COMMENT","\/\/ Test a failed delete query.\n",548],["T_WHITESPACE","    ",549],["T_TRY","try",549],["T_WHITESPACE"," ",549],"{",["T_WHITESPACE","\n      ",549],["T_VARIABLE","$connection",550],["T_OBJECT_OPERATOR","->",550],["T_STRING","delete",550],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",550],")",["T_WHITESPACE","\n        ",550],["T_OBJECT_OPERATOR","->",551],["T_STRING","condition",551],"(",["T_CONSTANT_ENCAPSED_STRING","'id'",551],",",["T_WHITESPACE"," ",551],["T_LNUMBER","1",551],")",["T_WHITESPACE","\n        ",551],["T_OBJECT_OPERATOR","->",552],["T_STRING","execute",552],"(",")",";",["T_WHITESPACE","\n\n      ",552],["T_VARIABLE","$this",554],["T_OBJECT_OPERATOR","->",554],["T_STRING","fail",554],"(",["T_CONSTANT_ENCAPSED_STRING","'Delete query failed.'",554],")",";",["T_WHITESPACE","\n    ",554],"}",["T_WHITESPACE","\n    ",555],["T_CATCH","catch",556],["T_WHITESPACE"," ",556],"(",["T_NS_SEPARATOR","\\",556],["T_STRING","Exception",556],["T_WHITESPACE"," ",556],["T_VARIABLE","$e",556],")",["T_WHITESPACE"," ",556],"{",["T_WHITESPACE","\n      ",556],["T_VARIABLE","$this",557],["T_OBJECT_OPERATOR","->",557],["T_STRING","pass",557],"(",["T_CONSTANT_ENCAPSED_STRING","'Delete query failed.'",557],")",";",["T_WHITESPACE","\n    ",557],"}",["T_WHITESPACE","\n\n    ",558],["T_COMMENT","\/\/ Test a failed merge query.\n",560],["T_WHITESPACE","    ",561],["T_TRY","try",561],["T_WHITESPACE"," ",561],"{",["T_WHITESPACE","\n      ",561],["T_VARIABLE","$connection",562],["T_OBJECT_OPERATOR","->",562],["T_STRING","merge",562],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",562],")",["T_WHITESPACE","\n        ",562],["T_OBJECT_OPERATOR","->",563],["T_STRING","key",563],"(",["T_CONSTANT_ENCAPSED_STRING","'job'",563],",",["T_WHITESPACE"," ",563],["T_CONSTANT_ENCAPSED_STRING","'Presenter'",563],")",["T_WHITESPACE","\n        ",563],["T_OBJECT_OPERATOR","->",564],["T_STRING","fields",564],"(","[",["T_WHITESPACE","\n          ",564],["T_CONSTANT_ENCAPSED_STRING","'age'",565],["T_WHITESPACE"," ",565],["T_DOUBLE_ARROW","=>",565],["T_WHITESPACE"," ",565],["T_CONSTANT_ENCAPSED_STRING","'31'",565],",",["T_WHITESPACE","\n          ",565],["T_CONSTANT_ENCAPSED_STRING","'name'",566],["T_WHITESPACE"," ",566],["T_DOUBLE_ARROW","=>",566],["T_WHITESPACE"," ",566],["T_CONSTANT_ENCAPSED_STRING","'Tiffany'",566],",",["T_WHITESPACE","\n        ",566],"]",")",["T_WHITESPACE","\n        ",567],["T_OBJECT_OPERATOR","->",568],["T_STRING","execute",568],"(",")",";",["T_WHITESPACE","\n\n      ",568],["T_VARIABLE","$this",570],["T_OBJECT_OPERATOR","->",570],["T_STRING","fail",570],"(",["T_CONSTANT_ENCAPSED_STRING","'Merge query failed.'",570],")",";",["T_WHITESPACE","\n    ",570],"}",["T_WHITESPACE","\n    ",571],["T_CATCH","catch",572],["T_WHITESPACE"," ",572],"(",["T_NS_SEPARATOR","\\",572],["T_STRING","Exception",572],["T_WHITESPACE"," ",572],["T_VARIABLE","$e",572],")",["T_WHITESPACE"," ",572],"{",["T_WHITESPACE","\n      ",572],["T_VARIABLE","$this",573],["T_OBJECT_OPERATOR","->",573],["T_STRING","pass",573],"(",["T_CONSTANT_ENCAPSED_STRING","'Merge query failed.'",573],")",";",["T_WHITESPACE","\n    ",573],"}",["T_WHITESPACE","\n\n    ",574],["T_COMMENT","\/\/ Test a failed upsert query.\n",576],["T_WHITESPACE","    ",577],["T_TRY","try",577],["T_WHITESPACE"," ",577],"{",["T_WHITESPACE","\n      ",577],["T_VARIABLE","$connection",578],["T_OBJECT_OPERATOR","->",578],["T_STRING","upsert",578],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",578],")",["T_WHITESPACE","\n        ",578],["T_OBJECT_OPERATOR","->",579],["T_STRING","key",579],"(",["T_CONSTANT_ENCAPSED_STRING","'job'",579],")",["T_WHITESPACE","\n        ",579],["T_OBJECT_OPERATOR","->",580],["T_STRING","fields",580],"(","[",["T_CONSTANT_ENCAPSED_STRING","'job'",580],",",["T_WHITESPACE"," ",580],["T_CONSTANT_ENCAPSED_STRING","'age'",580],",",["T_WHITESPACE"," ",580],["T_CONSTANT_ENCAPSED_STRING","'name'",580],"]",")",["T_WHITESPACE","\n        ",580],["T_OBJECT_OPERATOR","->",581],["T_STRING","values",581],"(","[",["T_WHITESPACE","\n          ",581],["T_CONSTANT_ENCAPSED_STRING","'job'",582],["T_WHITESPACE"," ",582],["T_DOUBLE_ARROW","=>",582],["T_WHITESPACE"," ",582],["T_CONSTANT_ENCAPSED_STRING","'Presenter'",582],",",["T_WHITESPACE","\n          ",582],["T_CONSTANT_ENCAPSED_STRING","'age'",583],["T_WHITESPACE"," ",583],["T_DOUBLE_ARROW","=>",583],["T_WHITESPACE"," ",583],["T_LNUMBER","31",583],",",["T_WHITESPACE","\n          ",583],["T_CONSTANT_ENCAPSED_STRING","'name'",584],["T_WHITESPACE"," ",584],["T_DOUBLE_ARROW","=>",584],["T_WHITESPACE"," ",584],["T_CONSTANT_ENCAPSED_STRING","'Tiffany'",584],",",["T_WHITESPACE","\n        ",584],"]",")",["T_WHITESPACE","\n        ",585],["T_OBJECT_OPERATOR","->",586],["T_STRING","execute",586],"(",")",";",["T_WHITESPACE","\n\n      ",586],["T_VARIABLE","$this",588],["T_OBJECT_OPERATOR","->",588],["T_STRING","fail",588],"(",["T_CONSTANT_ENCAPSED_STRING","'Upset query failed.'",588],")",";",["T_WHITESPACE","\n    ",588],"}",["T_WHITESPACE","\n    ",589],["T_CATCH","catch",590],["T_WHITESPACE"," ",590],"(",["T_NS_SEPARATOR","\\",590],["T_STRING","Exception",590],["T_WHITESPACE"," ",590],["T_VARIABLE","$e",590],")",["T_WHITESPACE"," ",590],"{",["T_WHITESPACE","\n      ",590],["T_VARIABLE","$this",591],["T_OBJECT_OPERATOR","->",591],["T_STRING","pass",591],"(",["T_CONSTANT_ENCAPSED_STRING","'Upset query failed.'",591],")",";",["T_WHITESPACE","\n    ",591],"}",["T_WHITESPACE","\n\n    ",592],["T_COMMENT","\/\/ Create the missing schema and insert a row.\n",594],["T_WHITESPACE","    ",595],["T_VARIABLE","$this",595],["T_OBJECT_OPERATOR","->",595],["T_STRING","installSchema",595],"(",["T_CONSTANT_ENCAPSED_STRING","'database_test'",595],",",["T_WHITESPACE"," ",595],"[",["T_CONSTANT_ENCAPSED_STRING","'test'",595],"]",")",";",["T_WHITESPACE","\n    ",595],["T_VARIABLE","$connection",596],["T_OBJECT_OPERATOR","->",596],["T_STRING","insert",596],"(",["T_CONSTANT_ENCAPSED_STRING","'test'",596],")",["T_WHITESPACE","\n      ",596],["T_OBJECT_OPERATOR","->",597],["T_STRING","fields",597],"(",["T_ARRAY","array",597],"(",["T_WHITESPACE","\n        ",597],["T_CONSTANT_ENCAPSED_STRING","'name'",598],["T_WHITESPACE"," ",598],["T_DOUBLE_ARROW","=>",598],["T_WHITESPACE"," ",598],["T_CONSTANT_ENCAPSED_STRING","'David'",598],",",["T_WHITESPACE","\n        ",598],["T_CONSTANT_ENCAPSED_STRING","'age'",599],["T_WHITESPACE"," ",599],["T_DOUBLE_ARROW","=>",599],["T_WHITESPACE"," ",599],["T_CONSTANT_ENCAPSED_STRING","'24'",599],",",["T_WHITESPACE","\n      ",599],")",")",["T_WHITESPACE","\n      ",600],["T_OBJECT_OPERATOR","->",601],["T_STRING","execute",601],"(",")",";",["T_WHITESPACE","\n\n    ",601],["T_COMMENT","\/\/ Commit the transaction.\n",603],["T_WHITESPACE","    ",604],["T_UNSET","unset",604],"(",["T_VARIABLE","$transaction",604],")",";",["T_WHITESPACE","\n\n    ",604],["T_VARIABLE","$saved_age",606],["T_WHITESPACE"," ",606],"=",["T_WHITESPACE"," ",606],["T_VARIABLE","$connection",606],["T_OBJECT_OPERATOR","->",606],["T_STRING","query",606],"(",["T_CONSTANT_ENCAPSED_STRING","'SELECT age FROM {test} WHERE name = :name'",606],",",["T_WHITESPACE"," ",606],["T_ARRAY","array",606],"(",["T_CONSTANT_ENCAPSED_STRING","':name'",606],["T_WHITESPACE"," ",606],["T_DOUBLE_ARROW","=>",606],["T_WHITESPACE"," ",606],["T_CONSTANT_ENCAPSED_STRING","'David'",606],")",")",["T_OBJECT_OPERATOR","->",606],["T_STRING","fetchField",606],"(",")",";",["T_WHITESPACE","\n    ",606],["T_VARIABLE","$this",607],["T_OBJECT_OPERATOR","->",607],["T_STRING","assertEqual",607],"(",["T_CONSTANT_ENCAPSED_STRING","'24'",607],",",["T_WHITESPACE"," ",607],["T_VARIABLE","$saved_age",607],")",";",["T_WHITESPACE","\n  ",607],"}",["T_WHITESPACE","\n\n",608],"}",["T_WHITESPACE","\n",610]]