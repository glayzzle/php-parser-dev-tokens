[["T_OPEN_TAG","<?php\n",1],["T_WHITESPACE","\n",2],["T_NAMESPACE","namespace",3],["T_WHITESPACE"," ",3],["T_STRING","Drupal",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KernelTests",3],["T_NS_SEPARATOR","\\",3],["T_STRING","Core",3],["T_NS_SEPARATOR","\\",3],["T_STRING","KeyValueStore",3],";",["T_WHITESPACE","\n\n",3],["T_USE","use",5],["T_WHITESPACE"," ",5],["T_STRING","Drupal",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Component",5],["T_NS_SEPARATOR","\\",5],["T_STRING","Serialization",5],["T_NS_SEPARATOR","\\",5],["T_STRING","PhpSerialize",5],";",["T_WHITESPACE","\n",5],["T_USE","use",6],["T_WHITESPACE"," ",6],["T_STRING","Drupal",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Core",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],["T_NS_SEPARATOR","\\",6],["T_STRING","Database",6],";",["T_WHITESPACE","\n",6],["T_USE","use",7],["T_WHITESPACE"," ",7],["T_STRING","Drupal",7],["T_NS_SEPARATOR","\\",7],["T_STRING","Core",7],["T_NS_SEPARATOR","\\",7],["T_STRING","KeyValueStore",7],["T_NS_SEPARATOR","\\",7],["T_STRING","DatabaseStorageExpirable",7],";",["T_WHITESPACE","\n",7],["T_USE","use",8],["T_WHITESPACE"," ",8],["T_STRING","Drupal",8],["T_NS_SEPARATOR","\\",8],["T_STRING","KernelTests",8],["T_NS_SEPARATOR","\\",8],["T_STRING","KernelTestBase",8],";",["T_WHITESPACE","\n\n",8],["T_DOC_COMMENT","\/**\n * Tests garbage collection for the expirable key-value database storage.\n *\n * @group KeyValueStore\n *\/",10],["T_WHITESPACE","\n",14],["T_CLASS","class",15],["T_WHITESPACE"," ",15],["T_STRING","GarbageCollectionTest",15],["T_WHITESPACE"," ",15],["T_EXTENDS","extends",15],["T_WHITESPACE"," ",15],["T_STRING","KernelTestBase",15],["T_WHITESPACE"," ",15],"{",["T_WHITESPACE","\n\n  ",15],["T_DOC_COMMENT","\/**\n   * Modules to enable.\n   *\n   * @var array\n   *\/",17],["T_WHITESPACE","\n  ",21],["T_PUBLIC","public",22],["T_WHITESPACE"," ",22],["T_STATIC","static",22],["T_WHITESPACE"," ",22],["T_VARIABLE","$modules",22],["T_WHITESPACE"," ",22],"=",["T_WHITESPACE"," ",22],["T_ARRAY","array",22],"(",["T_CONSTANT_ENCAPSED_STRING","'system'",22],")",";",["T_WHITESPACE","\n\n  ",22],["T_PROTECTED","protected",24],["T_WHITESPACE"," ",24],["T_FUNCTION","function",24],["T_WHITESPACE"," ",24],["T_STRING","setUp",24],"(",")",["T_WHITESPACE"," ",24],"{",["T_WHITESPACE","\n    ",24],["T_STRING","parent",25],["T_DOUBLE_COLON","::",25],["T_STRING","setUp",25],"(",")",";",["T_WHITESPACE","\n\n    ",25],["T_COMMENT","\/\/ These additional tables are necessary due to the call to system_cron().\n",27],["T_WHITESPACE","    ",28],["T_VARIABLE","$this",28],["T_OBJECT_OPERATOR","->",28],["T_STRING","installSchema",28],"(",["T_CONSTANT_ENCAPSED_STRING","'system'",28],",",["T_WHITESPACE"," ",28],["T_ARRAY","array",28],"(",["T_CONSTANT_ENCAPSED_STRING","'key_value_expire'",28],")",")",";",["T_WHITESPACE","\n  ",28],"}",["T_WHITESPACE","\n\n  ",29],["T_DOC_COMMENT","\/**\n   * Tests garbage collection.\n   *\/",31],["T_WHITESPACE","\n  ",33],["T_PUBLIC","public",34],["T_WHITESPACE"," ",34],["T_FUNCTION","function",34],["T_WHITESPACE"," ",34],["T_STRING","testGarbageCollection",34],"(",")",["T_WHITESPACE"," ",34],"{",["T_WHITESPACE","\n    ",34],["T_VARIABLE","$collection",35],["T_WHITESPACE"," ",35],"=",["T_WHITESPACE"," ",35],["T_VARIABLE","$this",35],["T_OBJECT_OPERATOR","->",35],["T_STRING","randomMachineName",35],"(",")",";",["T_WHITESPACE","\n    ",35],["T_VARIABLE","$store",36],["T_WHITESPACE"," ",36],"=",["T_WHITESPACE"," ",36],["T_NEW","new",36],["T_WHITESPACE"," ",36],["T_STRING","DatabaseStorageExpirable",36],"(",["T_VARIABLE","$collection",36],",",["T_WHITESPACE"," ",36],["T_NEW","new",36],["T_WHITESPACE"," ",36],["T_STRING","PhpSerialize",36],"(",")",",",["T_WHITESPACE"," ",36],["T_STRING","Database",36],["T_DOUBLE_COLON","::",36],["T_STRING","getConnection",36],"(",")",")",";",["T_WHITESPACE","\n\n    ",36],["T_COMMENT","\/\/ Insert some items and confirm that they're set.\n",38],["T_WHITESPACE","    ",39],["T_FOR","for",39],["T_WHITESPACE"," ",39],"(",["T_VARIABLE","$i",39],["T_WHITESPACE"," ",39],"=",["T_WHITESPACE"," ",39],["T_LNUMBER","0",39],";",["T_WHITESPACE"," ",39],["T_VARIABLE","$i",39],["T_WHITESPACE"," ",39],["T_IS_SMALLER_OR_EQUAL","<=",39],["T_WHITESPACE"," ",39],["T_LNUMBER","3",39],";",["T_WHITESPACE"," ",39],["T_VARIABLE","$i",39],["T_INC","++",39],")",["T_WHITESPACE"," ",39],"{",["T_WHITESPACE","\n      ",39],["T_VARIABLE","$store",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","setWithExpire",40],"(",["T_CONSTANT_ENCAPSED_STRING","'key_'",40],["T_WHITESPACE"," ",40],".",["T_WHITESPACE"," ",40],["T_VARIABLE","$i",40],",",["T_WHITESPACE"," ",40],["T_VARIABLE","$this",40],["T_OBJECT_OPERATOR","->",40],["T_STRING","randomObject",40],"(",")",",",["T_WHITESPACE"," ",40],["T_STRING","rand",40],"(",["T_LNUMBER","500",40],",",["T_WHITESPACE"," ",40],["T_LNUMBER","100000",40],")",")",";",["T_WHITESPACE","\n    ",40],"}",["T_WHITESPACE","\n    ",41],["T_VARIABLE","$this",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","assertIdentical",42],"(",["T_STRING","sizeof",42],"(",["T_VARIABLE","$store",42],["T_OBJECT_OPERATOR","->",42],["T_STRING","getAll",42],"(",")",")",",",["T_WHITESPACE"," ",42],["T_LNUMBER","4",42],",",["T_WHITESPACE"," ",42],["T_CONSTANT_ENCAPSED_STRING","'Four items were written to the storage.'",42],")",";",["T_WHITESPACE","\n\n    ",42],["T_COMMENT","\/\/ Manually expire the data.\n",44],["T_WHITESPACE","    ",45],["T_FOR","for",45],["T_WHITESPACE"," ",45],"(",["T_VARIABLE","$i",45],["T_WHITESPACE"," ",45],"=",["T_WHITESPACE"," ",45],["T_LNUMBER","0",45],";",["T_WHITESPACE"," ",45],["T_VARIABLE","$i",45],["T_WHITESPACE"," ",45],["T_IS_SMALLER_OR_EQUAL","<=",45],["T_WHITESPACE"," ",45],["T_LNUMBER","3",45],";",["T_WHITESPACE"," ",45],["T_VARIABLE","$i",45],["T_INC","++",45],")",["T_WHITESPACE"," ",45],"{",["T_WHITESPACE","\n      ",45],["T_STRING","db_merge",46],"(",["T_CONSTANT_ENCAPSED_STRING","'key_value_expire'",46],")",["T_WHITESPACE","\n        ",46],["T_OBJECT_OPERATOR","->",47],["T_STRING","keys",47],"(",["T_ARRAY","array",47],"(",["T_WHITESPACE","\n            ",47],["T_CONSTANT_ENCAPSED_STRING","'name'",48],["T_WHITESPACE"," ",48],["T_DOUBLE_ARROW","=>",48],["T_WHITESPACE"," ",48],["T_CONSTANT_ENCAPSED_STRING","'key_'",48],["T_WHITESPACE"," ",48],".",["T_WHITESPACE"," ",48],["T_VARIABLE","$i",48],",",["T_WHITESPACE","\n            ",48],["T_CONSTANT_ENCAPSED_STRING","'collection'",49],["T_WHITESPACE"," ",49],["T_DOUBLE_ARROW","=>",49],["T_WHITESPACE"," ",49],["T_VARIABLE","$collection",49],",",["T_WHITESPACE","\n          ",49],")",")",["T_WHITESPACE","\n        ",50],["T_OBJECT_OPERATOR","->",51],["T_STRING","fields",51],"(",["T_ARRAY","array",51],"(",["T_WHITESPACE","\n            ",51],["T_CONSTANT_ENCAPSED_STRING","'expire'",52],["T_WHITESPACE"," ",52],["T_DOUBLE_ARROW","=>",52],["T_WHITESPACE"," ",52],["T_STRING","REQUEST_TIME",52],["T_WHITESPACE"," ",52],"-",["T_WHITESPACE"," ",52],["T_LNUMBER","1",52],",",["T_WHITESPACE","\n          ",52],")",")",["T_WHITESPACE","\n        ",53],["T_OBJECT_OPERATOR","->",54],["T_STRING","execute",54],"(",")",";",["T_WHITESPACE","\n    ",54],"}",["T_WHITESPACE","\n\n\n    ",55],["T_COMMENT","\/\/ Perform a new set operation and then trigger garbage collection.\n",58],["T_WHITESPACE","    ",59],["T_VARIABLE","$store",59],["T_OBJECT_OPERATOR","->",59],["T_STRING","setWithExpire",59],"(",["T_CONSTANT_ENCAPSED_STRING","'autumn'",59],",",["T_WHITESPACE"," ",59],["T_CONSTANT_ENCAPSED_STRING","'winter'",59],",",["T_WHITESPACE"," ",59],["T_STRING","rand",59],"(",["T_LNUMBER","500",59],",",["T_WHITESPACE"," ",59],["T_LNUMBER","1000000",59],")",")",";",["T_WHITESPACE","\n    ",59],["T_STRING","system_cron",60],"(",")",";",["T_WHITESPACE","\n\n    ",60],["T_COMMENT","\/\/ Query the database and confirm that the stale records were deleted.\n",62],["T_WHITESPACE","    ",63],["T_VARIABLE","$result",63],["T_WHITESPACE"," ",63],"=",["T_WHITESPACE"," ",63],["T_STRING","db_query",63],"(",["T_WHITESPACE","\n      ",63],["T_CONSTANT_ENCAPSED_STRING","'SELECT name, value FROM {key_value_expire} WHERE collection = :collection'",64],",",["T_WHITESPACE","\n      ",64],["T_ARRAY","array",65],"(",["T_WHITESPACE","\n        ",65],["T_CONSTANT_ENCAPSED_STRING","':collection'",66],["T_WHITESPACE"," ",66],["T_DOUBLE_ARROW","=>",66],["T_WHITESPACE"," ",66],["T_VARIABLE","$collection",66],",",["T_WHITESPACE","\n      ",66],")",")",["T_OBJECT_OPERATOR","->",67],["T_STRING","fetchAll",67],"(",")",";",["T_WHITESPACE","\n    ",67],["T_VARIABLE","$this",68],["T_OBJECT_OPERATOR","->",68],["T_STRING","assertIdentical",68],"(",["T_STRING","count",68],"(",["T_VARIABLE","$result",68],")",",",["T_WHITESPACE"," ",68],["T_LNUMBER","1",68],",",["T_WHITESPACE"," ",68],["T_CONSTANT_ENCAPSED_STRING","'Only one item remains after garbage collection'",68],")",";",["T_WHITESPACE","\n\n  ",68],"}",["T_WHITESPACE","\n\n",70],"}",["T_WHITESPACE","\n",72]]